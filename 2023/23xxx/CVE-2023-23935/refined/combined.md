=== Content from github.com_a92a5cff_20250115_091203.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdiscourse%2Fdiscourse%2Fcommit%2Ff31f0b70f82c43d93220ce6fc0d4f57440452f37)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdiscourse%2Fdiscourse%2Fcommit%2Ff31f0b70f82c43d93220ce6fc0d4f57440452f37)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=discourse%2Fdiscourse)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[discourse](/discourse)
/
**[discourse](/discourse/discourse)**
Public

* [Notifications](/login?return_to=%2Fdiscourse%2Fdiscourse) You must be signed in to change notification settings
* [Fork
  8.4k](/login?return_to=%2Fdiscourse%2Fdiscourse)
* [Star
   42.9k](/login?return_to=%2Fdiscourse%2Fdiscourse)

* [Code](/discourse/discourse)
* [Pull requests
  67](/discourse/discourse/pulls)
* [Actions](/discourse/discourse/actions)
* [Security](/discourse/discourse/security)
* [Insights](/discourse/discourse/pulse)

Additional navigation options

* [Code](/discourse/discourse)
* [Pull requests](/discourse/discourse/pulls)
* [Actions](/discourse/discourse/actions)
* [Security](/discourse/discourse/security)
* [Insights](/discourse/discourse/pulse)

## Commit

[Permalink](/discourse/discourse/commit/f31f0b70f82c43d93220ce6fc0d4f57440452f37)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

SECURITY: Hide PM count for tags by default ([#20061](https://github.com/discourse/discourse/pull/20061))

[Browse files](/discourse/discourse/tree/f31f0b70f82c43d93220ce6fc0d4f57440452f37)
Browse the repository at this point in the history

```
Currently `Topic#pm_topic_count` is a count of all personal messages tagged for a given tag. As a result, any user with access to PM tags can poll a sensitive tag to determine if a new personal message has been created using that tag even if the user does not have access to the personal message. We classify this as a minor leak in sensitive information.

With this commit, `Topic#pm_topic_count` is hidden from users by default unless the `display_personal_messages_tag_counts` site setting is enabled.
```

* Loading branch information

[![@tgxworld](https://avatars.githubusercontent.com/u/4335742?s=40&v=4)](/tgxworld)

[tgxworld](/discourse/discourse/commits?author=tgxworld "View all commits by tgxworld")
authored
Jan 31, 2023

1 parent
[0767988](/discourse/discourse/commit/07679888c85414d99c0c69040d20f014619e0b85)

commit f31f0b7

 Show file tree

 Hide file tree

Showing
**8 changed files**
with
**127 additions**
and
**27 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* app

  + assets/javascripts/discourse

    - app/models

      * app/assets/javascripts/discourse/app/models/tag.js
        [tag.js](#diff-0448473abef0fc8c10b7e9839da3320a9add41098c86608a1b0c2c97a38798e2)
    - tests

      * helpers

        + app/assets/javascripts/discourse/tests/helpers/create-pretender.js
          [create-pretender.js](#diff-db86030dcc2cd261585467032c99d51c63223cc41b0de16b41f0df4690bbfbeb)
      * integration/components/select-kit

        + app/assets/javascripts/discourse/tests/integration/components/select-kit/tag-drop-test.js
          [tag-drop-test.js](#diff-9c48b8000db2f5f87fc65ed1764c5f912be6cb9009a2ee1c78654e839ae2e297)
      * unit/models

        + app/assets/javascripts/discourse/tests/unit/models/tag-test.js
          [tag-test.js](#diff-25d4b9c55f5acb708984a0ef15f39755bf3d8cef024877cf4f5fc49da2bc96b5)
  + controllers

    - app/controllers/tags\_controller.rb
      [tags\_controller.rb](#diff-9480a599fcde26e477f1e3b570155eff6818aec8f26fe25783681da39bb310bd)
* config

  + locales

    - config/locales/server.en.yml
      [server.en.yml](#diff-333c4c8cacc2f84633d4894f2aaddb130a6d74f42dd63199462b3d66278f6ce8)
  + config/site\_settings.yml
    [site\_settings.yml](#diff-bff2842c9891df212adcbe8eb22a4a17c9644c676260a0cfa6e7a3953852c5e8)
* spec/requests

  + spec/requests/tags\_controller\_spec.rb
    [tags\_controller\_spec.rb](#diff-8b6ac1b759fdff39a49733b92456edf470ef86e747441b0cda1c39173453ba13)

## There are no files selected for viewing

10 changes: 4 additions & 6 deletions

10
[app/assets/javascripts/discourse/app/models/tag.js](#diff-0448473abef0fc8c10b7e9839da3320a9add41098c86608a1b0c2c97a38798e2 "app/assets/javascripts/discourse/app/models/tag.js")

Show comments

[View file](/discourse/discourse/blob/f31f0b70f82c43d93220ce6fc0d4f57440452f37/app/assets/javascripts/discourse/app/models/tag.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,15 +1,13 @@ |
|  |  | import RestModel from "discourse/models/rest"; |
|  |  | import discourseComputed from "discourse-common/utils/decorators"; |
|  |  | import { readOnly } from "@ember/object/computed"; |
|  |  |  |
|  |  | export default RestModel.extend({ |
|  |  | @discourseComputed("count", "pm\_count") |
|  |  | totalCount(count, pmCount) { |
|  |  | return count + pmCount; |
|  |  | }, |
|  |  | pmOnly: readOnly("pm\_only"), |
|  |  |  |
|  |  | @discourseComputed("count", "pm\_count") |
|  |  | pmOnly(count, pmCount) { |
|  |  | return count === 0 && pmCount > 0; |
|  |  | totalCount(count, pmCount) { |
|  |  | return pmCount ? count + pmCount : count; |
|  |  | }, |
|  |  |  |
|  |  | @discourseComputed("id") |
| Expand Down | |  |

16 changes: 8 additions & 8 deletions

16
[app/assets/javascripts/discourse/tests/helpers/create-pretender.js](#diff-db86030dcc2cd261585467032c99d51c63223cc41b0de16b41f0df4690bbfbeb "app/assets/javascripts/discourse/tests/helpers/create-pretender.js")

Show comments

[View file](/discourse/discourse/blob/f31f0b70f82c43d93220ce6fc0d4f57440452f37/app/assets/javascripts/discourse/tests/helpers/create-pretender.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -100,33 +100,33 @@ export function applyDefaultHandlers(pretender) { |
|  |  | return response({ |
|  |  | tags: [ |
|  |  | { id: "eviltrout", count: 1 }, |
|  |  | { id: "planned", text: "planned", count: 7, pm\_count: 0 }, |
|  |  | { id: "private", text: "private", count: 0, pm\_count: 7 }, |
|  |  | { id: "planned", text: "planned", count: 7, pm\_only: false }, |
|  |  | { id: "private", text: "private", count: 0, pm\_only: true }, |
|  |  | ], |
|  |  | extras: { |
|  |  | tag\_groups: [ |
|  |  | { |
|  |  | id: 2, |
|  |  | name: "Ford Cars", |
|  |  | tags: [ |
|  |  | { id: "Escort", text: "Escort", count: 1, pm\_count: 0 }, |
|  |  | { id: "focus", text: "focus", count: 3, pm\_count: 0 }, |
|  |  | { id: "Escort", text: "Escort", count: 1, pm\_only: false }, |
|  |  | { id: "focus", text: "focus", count: 3, pm\_only: false }, |
|  |  | ], |
|  |  | }, |
|  |  | { |
|  |  | id: 1, |
|  |  | name: "Honda Cars", |
|  |  | tags: [ |
|  |  | { id: "civic", text: "civic", count: 4, pm\_count: 0 }, |
|  |  | { id: "accord", text: "accord", count: 2, pm\_count: 0 }, |
|  |  | { id: "civic", text: "civic", count: 4, pm\_only: false }, |
|  |  | { id: "accord", text: "accord", count: 2, pm\_only: false }, |
|  |  | ], |
|  |  | }, |
|  |  | { |
|  |  | id: 1, |
|  |  | name: "Makes", |
|  |  | tags: [ |
|  |  | { id: "ford", text: "ford", count: 5, pm\_count: 0 }, |
|  |  | { id: "honda", text: "honda", count: 6, pm\_count: 0 }, |
|  |  | { id: "ford", text: "ford", count: 5, pm\_only: false }, |
|  |  | { id: "honda", text: "honda", count: 6, pm\_only: false }, |
|  |  | ], |
|  |  | }, |
|  |  | ], |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[app/assets/javascripts/discourse/tests/integration/components/select-kit/tag-drop-test.js](#diff-9c48b8000db2f5f87fc65ed1764c5f912be6cb9009a2ee1c78654e839ae2e297 "app/assets/javascripts/discourse/tests/integration/components/select-kit/tag-drop-test.js")

Show comments

[View file](/discourse/discourse/blob/f31f0b70f82c43d93220ce6fc0d4f57440452f37/app/assets/javascripts/discourse/tests/integration/components/select-kit/tag-drop-test.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -28,7 +28,7 @@ module("Integration | Component | select-kit/tag-drop", function (hooks) { |
|  |  | pretender.get("/tags/filter/search", (params) => { |
|  |  | if (params.queryParams.q === "dav") { |
|  |  | return response({ |
|  |  | results: [{ id: "David", name: "David", count: 2, pm\_count: 0 }], |
|  |  | results: [{ id: "David", name: "David", count: 2, pm\_only: false }], |
|  |  | }); |
|  |  | } |
|  |  | }); |
| Expand Down | |  |

31 changes: 31 additions & 0 deletions

31
[app/assets/javascripts/discourse/tests/unit/models/tag-test.js](#diff-25d4b9c55f5acb708984a0ef15f39755bf3d8cef024877cf4f5fc49da2bc96b5 "app/assets/javascripts/discourse/tests/unit/models/tag-test.js")

Show comments

[View file](/discourse/discourse/blob/f31f0b70f82c43d93220ce6fc0d4f57440452f37/app/assets/javascripts/discourse/tests/unit/models/tag-test.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,31 @@ |
|  |  | import { module, test } from "qunit"; |
|  |  | import { getOwner } from "discourse-common/lib/get-owner"; |
|  |  | import { setupTest } from "ember-qunit"; |
|  |  |  |
|  |  | module("Unit | Model | tag", function (hooks) { |
|  |  | setupTest(hooks); |
|  |  |  |
|  |  | hooks.beforeEach(function () { |
|  |  | this.store = getOwner(this).lookup("service:store"); |
|  |  | }); |
|  |  |  |
|  |  | test("totalCount when pm\_count is not present", function (assert) { |
|  |  | const tag = this.store.createRecord("tag", { count: 5 }); |
|  |  | assert.strictEqual(tag.totalCount, 5); |
|  |  | }); |
|  |  |  |
|  |  | test("totalCount when pm\_count is present", function (assert) { |
|  |  | const tag = this.store.createRecord("tag", { count: 5, pm\_count: 8 }); |
|  |  | assert.strictEqual(tag.totalCount, 13); |
|  |  | }); |
|  |  |  |
|  |  | test("pmOnly", function (assert) { |
|  |  | const tag = this.store.createRecord("tag", { pm\_only: false }); |
|  |  |  |
|  |  | assert.notOk(tag.pmOnly); |
|  |  |  |
|  |  | tag.set("pm\_only", true); |
|  |  |  |
|  |  | assert.ok(tag.pmOnly); |
|  |  | }); |
|  |  | }); |

10 changes: 8 additions & 2 deletions

10
[app/controllers/tags\_controller.rb](#diff-9480a599fcde26e477f1e3b570155eff6818aec8f26fe25783681da39bb310bd "app/controllers/tags_controller.rb")

Show comments

[View file](/discourse/discourse/blob/f31f0b70f82c43d93220ce6fc0d4f57440452f37/app/controllers/tags_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -401,16 +401,22 @@ def self.tag\_counts\_json(tags, guardian) |
|  |  |  |
|  |  | next if topic\_count == 0 && t.pm\_topic\_count > 0 && !show\_pm\_tags |
|  |  |  |
|  |  | { |
|  |  | attrs = { |
|  |  | id: t.name, |
|  |  | text: t.name, |
|  |  | name: t.name, |
|  |  | description: t.description, |
|  |  | count: topic\_count, |
|  |  | pm\_count: show\_pm\_tags ? t.pm\_topic\_count : 0, |
|  |  | pm\_only: topic\_count == 0 && t.pm\_topic\_count > 0, |
|  |  | target\_tag: |
|  |  | t.target\_tag\_id ? target\_tags.find { |x| x.id == t.target\_tag\_id }&.name : nil, |
|  |  | } |
|  |  |  |
|  |  | if show\_pm\_tags && SiteSetting.display\_personal\_messages\_tag\_counts |
|  |  | attrs[:pm\_count] = t.pm\_topic\_count |
|  |  | end |
|  |  |  |
|  |  | attrs |
|  |  | end |
|  |  | .compact |
|  |  | end |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[config/locales/server.en.yml](#diff-333c4c8cacc2f84633d4894f2aaddb130a6d74f42dd63199462b3d66278f6ce8 "config/locales/server.en.yml")

Show comments

[View file](/discourse/discourse/blob/f31f0b70f82c43d93220ce6fc0d4f57440452f37/config/locales/server.en.yml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1652,6 +1652,7 @@ en: |
|  |  | content\_security\_policy\_script\_src: "Additional allowlisted script sources. The current host and CDN are included by default. See <a href='https://meta.discourse.org/t/mitigate-xss-attacks-with-content-security-policy/104243' target='\_blank'>Mitigate XSS Attacks with Content Security Policy.</a>" |
|  |  | invalidate\_inactive\_admin\_email\_after\_days: "Admin accounts that have not visited the site in this number of days will need to re-validate their email address before logging in. Set to 0 to disable." |
|  |  | include\_secure\_categories\_in\_tag\_counts: "When enabled, count of topics for a tag will include topics that are in read restricted categories for all users. When disabled, normal users are only shown a count of topics for a tag where all the topics are in public categories." |
|  |  | display\_personal\_messages\_tag\_counts: "When enabled, count of personal messages tagged with a given tag will be displayed." |
|  |  | top\_menu: "Determine which items appear in the homepage navigation, and in what order. Example latest|new|unread|categories|top|read|posted|bookmarks" |
|  |  | post\_menu: "Determine which items appear on the post menu, and in what order. Example like|edit|flag|delete|share|bookmark|reply" |
|  |  | post\_menu\_hidden\_items: "The menu items to hide by default in the post menu unless an expansion ellipsis is clicked on." |
| Expand Down | |  |

2 changes: 2 additions & 0 deletions

2
[config/site\_settings.yml](#diff-bff2842c9891df212adcbe8eb22a4a17c9644c676260a0cfa6e7a3953852c5e8 "config/site_settings.yml")

Show comments

[View file](/discourse/discourse/blob/f31f0b70f82c43d93220ce6fc0d4f57440452f37/config/site_settings.yml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1806,6 +1806,8 @@ security: |
|  |  | hidden: true |
|  |  | include\_secure\_categories\_in\_tag\_counts: |
|  |  | default: false |
|  |  | display\_personal\_messages\_tag\_counts: |
|  |  | default: false |
|  |  |  |
|  |  | onebox: |
|  |  | post\_onebox\_maxlength: |
| Expand Down | |  |

82 changes: 72 additions & 10 deletions

82
[spec/requests/tags\_controller\_spec.rb](#diff-8b6ac1b759fdff39a49733b92456edf470ef86e747441b0cda1c39173453ba13 "spec/requests/tags_controller_spec.rb")

Show comments

[View file](/discourse/discourse/blob/f31f0b70f82c43d93220ce6fc0d4f57440452f37/spec/requests/tags_controller_spec.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -12,9 +12,21 @@ |
|  |  |  |
|  |  | describe "#index" do |
|  |  | fab!(:test\_tag) { Fabricate(:tag, name: "test", description: "some description") } |
|  |  |  |
|  |  | fab!(:topic\_tag) do |
|  |  | Fabricate(:tag, name: "topic-test", public\_topic\_count: 1, staff\_topic\_count: 1) |
|  |  | Fabricate( |
|  |  | :tag, |
|  |  | name: "topic-test", |
|  |  | public\_topic\_count: 1, |
|  |  | staff\_topic\_count: 1, |
|  |  | pm\_topic\_count: 5, |
|  |  | ) |
|  |  | end |
|  |  |  |
|  |  | fab!(:pm\_only\_tag) do |
|  |  | Fabricate(:tag, public\_topic\_count: 0, staff\_topic\_count: 0, pm\_topic\_count: 1) |
|  |  | end |
|  |  |  |
|  |  | fab!(:synonym) { Fabricate(:tag, name: "synonym", target\_tag: topic\_tag) } |
|  |  |  |
|  |  | shared\_examples "retrieves the right tags" do |
| Expand All | | @@ -27,13 +39,63 @@ |
|  |  |  |
|  |  | tags = response.parsed\_body["tags"] |
|  |  |  |
|  |  | serialized\_tag = tags.find { |t| t["id"] == test\_tag.name } |
|  |  |  |
|  |  | expect(serialized\_tag["count"]).to eq(0) |
|  |  | expect(serialized\_tag["pm\_count"]).to eq(nil) |
|  |  | expect(serialized\_tag["pm\_only"]).to eq(false) |
|  |  |  |
|  |  | serialized\_tag = tags.find { |t| t["id"] == topic\_tag.name } |
|  |  |  |
|  |  | expect(serialized\_tag["count"]).to eq(1) |
|  |  | expect(serialized\_tag["pm\_count"]).to eq(nil) |
|  |  | expect(serialized\_tag["pm\_only"]).to eq(false) |
|  |  | end |
|  |  |  |
|  |  | it "does not include pm\_count attribute when user cannot tag PM topics even if display\_personal\_messages\_tag\_counts site setting has been enabled" do |
|  |  | SiteSetting.display\_personal\_messages\_tag\_counts = true |
|  |  |  |
|  |  | sign\_in(admin) |
|  |  |  |
|  |  | get "/tags.json" |
|  |  |  |
|  |  | expect(response.status).to eq(200) |
|  |  |  |
|  |  | tags = response.parsed\_body["tags"] |
|  |  |  |
|  |  | expect(tags[0]["name"]).to eq(test\_tag.name) |
|  |  | expect(tags[0]["count"]).to eq(0) |
|  |  | expect(tags[0]["pm\_count"]).to eq(0) |
|  |  | expect(tags[0]["pm\_count"]).to eq(nil) |
|  |  |  |
|  |  | expect(tags[1]["name"]).to eq(topic\_tag.name) |
|  |  | expect(tags[1]["count"]).to eq(1) |
|  |  | expect(tags[1]["pm\_count"]).to eq(0) |
|  |  | expect(tags[1]["pm\_count"]).to eq(nil) |
|  |  | end |
|  |  |  |
|  |  | it "includes pm\_count attribute when user can tag PM topics and display\_personal\_messages\_tag\_counts site setting has been enabled" do |
|  |  | SiteSetting.display\_personal\_messages\_tag\_counts = true |
|  |  | SiteSetting.pm\_tags\_allowed\_for\_groups = Group::AUTO\_GROUPS[:admins] |
|  |  |  |
|  |  | sign\_in(admin) |
|  |  |  |
|  |  | get "/tags.json" |
|  |  |  |
|  |  | expect(response.status).to eq(200) |
|  |  |  |
|  |  | tags = response.parsed\_body["tags"] |
|  |  |  |
|  |  | serialized\_tag = tags.find { |t| t["id"] == test\_tag.name } |
|  |  |  |
|  |  | expect(serialized\_tag["pm\_count"]).to eq(0) |
|  |  | expect(serialized\_tag["pm\_only"]).to eq(false) |
|  |  |  |
|  |  | serialized\_tag = tags.find { |t| t["id"] == topic\_tag.name } |
|  |  |  |
|  |  | expect(serialized\_tag["pm\_count"]).to eq(5) |
|  |  | expect(serialized\_tag["pm\_only"]).to eq(false) |
|  |  |  |
|  |  | serialized\_tag = tags.find { |t| t["id"] == pm\_only\_tag.name } |
|  |  |  |
|  |  | expect(serialized\_tag["pm\_count"]).to eq(1) |
|  |  | expect(serialized\_tag["pm\_only"]).to eq(true) |
|  |  | end |
|  |  |  |
|  |  | it "only retrieve tags that have been used in public topics for non-staff user" do |
| Expand All | | @@ -48,7 +110,7 @@ |
|  |  |  |
|  |  | expect(tags[0]["name"]).to eq(topic\_tag.name) |
|  |  | expect(tags[0]["count"]).to eq(1) |
|  |  | expect(tags[0]["pm\_count"]).to eq(0) |
|  |  | expect(tags[0]["pm\_count"]).to eq(nil) |
|  |  | end |
|  |  | end |
|  |  |  |
| Expand All | | @@ -66,17 +128,17 @@ |
|  |  | context "when enabled" do |
|  |  | before do |
|  |  | SiteSetting.pm\_tags\_allowed\_for\_groups = "1|2|3" |
|  |  | SiteSetting.display\_personal\_messages\_tag\_counts = true |
|  |  | sign\_in(admin) |
|  |  | end |
|  |  |  |
|  |  | it "shows topic tags and pm tags" do |
|  |  | get "/tags.json" |
|  |  | tags = response.parsed\_body["tags"] |
|  |  | expect(tags.length).to eq(2) |
|  |  |  |
|  |  | serialized\_tag = tags.find { |t| t["id"] == topic\_tag.name } |
|  |  | expect(serialized\_tag["count"]).to eq(2) |
|  |  | expect(serialized\_tag["pm\_count"]).to eq(0) |
|  |  | expect(serialized\_tag["pm\_count"]).to eq(5) |
|  |  |  |
|  |  | serialized\_tag = tags.find { |t| t["id"] == test\_tag.name } |
|  |  | expect(serialized\_tag["count"]).to eq(0) |
| Expand Down  Expand Up | | @@ -180,7 +242,7 @@ |
|  |  | expect(tags[0]["text"]).to eq(test\_tag.name) |
|  |  | expect(tags[0]["description"]).to eq(test\_tag.description) |
|  |  | expect(tags[0]["count"]).to eq(0) |
|  |  | expect(tags[0]["pm\_count"]).to eq(0) |
|  |  | expect(tags[0]["pm\_count"]).to eq(nil) |
|  |  | expect(tags[0]["target\_tag"]).to eq(nil) |
|  |  |  |
|  |  | expect(tags[1]["name"]).to eq(topic\_tag.name) |
| Expand All | | @@ -193,7 +255,7 @@ |
|  |  | expect(categories[0]["tags"][0]["text"]).to eq(test\_tag.name) |
|  |  | expect(categories[0]["tags"][0]["description"]).to eq(test\_tag.description) |
|  |  | expect(categories[0]["tags"][0]["count"]).to eq(0) |
|  |  | expect(categories[0]["tags"][0]["pm\_count"]).to eq(0) |
|  |  | expect(categories[0]["tags"][0]["pm\_count"]).to eq(nil) |
|  |  | expect(categories[0]["tags"][0]["target\_tag"]).to eq(nil) |
|  |  | end |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 1 comment on commit `f31f0b7`

[![@discoursebot](https://avatars.githubusercontent.com/u/3698800?s=80&v=4)](/discoursebot)

Copy link

### @discoursebot **[discoursebot](/discoursebot)** commented on `[f31f0b7](/discourse/discourse/commit/f31f0b70f82c43d93220ce6fc0d4f57440452f37)` [May 10, 2024](#commitcomment-141899104)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

This commit has been mentioned on **Discourse Meta**. There might be relevant details there:

<https://meta.discourse.org/t/tag-counts-missing-on-tags-page/307563/7>

Sorry, something went wrong.

All reactions

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdiscourse%2Fdiscourse%2Fcommit%2Ff31f0b70f82c43d93220ce6fc0d4f57440452f37) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_3c4e9c67_20250115_091204.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdiscourse%2Fdiscourse%2Fsecurity%2Fadvisories%2FGHSA-rf8j-mf8c-82v7)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdiscourse%2Fdiscourse%2Fsecurity%2Fadvisories%2FGHSA-rf8j-mf8c-82v7)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=discourse%2Fdiscourse)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[discourse](/discourse)
/
**[discourse](/discourse/discourse)**
Public

* [Notifications](/login?return_to=%2Fdiscourse%2Fdiscourse) You must be signed in to change notification settings
* [Fork
  8.4k](/login?return_to=%2Fdiscourse%2Fdiscourse)
* [Star
   42.9k](/login?return_to=%2Fdiscourse%2Fdiscourse)

* [Code](/discourse/discourse)
* [Pull requests
  67](/discourse/discourse/pulls)
* [Actions](/discourse/discourse/actions)
* [Security](/discourse/discourse/security)
* [Insights](/discourse/discourse/pulse)

Additional navigation options

* [Code](/discourse/discourse)
* [Pull requests](/discourse/discourse/pulls)
* [Actions](/discourse/discourse/actions)
* [Security](/discourse/discourse/security)
* [Insights](/discourse/discourse/pulse)

# Presence of restricted personal messages may be leaked if tagged with a tag

Low

[jomaxro](/jomaxro)
published
GHSA-rf8j-mf8c-82v7
Mar 16, 2023

## Package

Discourse
(Discourse)

## Affected versions

stable <= 3.0.1; beta <= 3.1.0.beta2; tests-passed <= 3.1.0.beta2

## Patched versions

stable > 3.0.1; beta > 3.1.0.beta2; tests-passed > 3.1.0.beta2

## Description

### Impact

Currently, the count of personal messages displayed for a tag is a count of all personal messages regardless of whether the personal message is visible to a given user. As a result, any users can technically poll a sensitive tag to determine if a new personal message is created even if the user does not have access to the personal message.

### Patches

In the patched versions, the count of personal messages tagged with a given tag is hidden by default. To revert to the old behaviour of displaying the count of personal messages for a given tag, an admin may enable the `display_personal_messages_tag_counts` site setting.

### Severity

Low

3.5

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
Low

User interaction
Required

Scope
Unchanged

Confidentiality
Low

Integrity
None

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:L/I:N/A:N

### CVE ID

CVE-2023-23935

### Weaknesses

No CWEs

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


