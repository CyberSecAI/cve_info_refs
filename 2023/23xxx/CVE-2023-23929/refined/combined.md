=== Content from github.com_bed39042_20250114_191631.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvantage6%2Fvantage6%2Fcommit%2F48ebfca42359e9a6743e9598684585e2522cdce8)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvantage6%2Fvantage6%2Fcommit%2F48ebfca42359e9a6743e9598684585e2522cdce8)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=vantage6%2Fvantage6)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[vantage6](/vantage6)
/
**[vantage6](/vantage6/vantage6)**
Public

* [Notifications](/login?return_to=%2Fvantage6%2Fvantage6) You must be signed in to change notification settings
* [Fork
  11](/login?return_to=%2Fvantage6%2Fvantage6)
* [Star
   31](/login?return_to=%2Fvantage6%2Fvantage6)

* [Code](/vantage6/vantage6)
* [Issues
  241](/vantage6/vantage6/issues)
* [Pull requests
  6](/vantage6/vantage6/pulls)
* [Actions](/vantage6/vantage6/actions)
* [Projects
  2](/vantage6/vantage6/projects)
* [Security](/vantage6/vantage6/security)
* [Insights](/vantage6/vantage6/pulse)

Additional navigation options

* [Code](/vantage6/vantage6)
* [Issues](/vantage6/vantage6/issues)
* [Pull requests](/vantage6/vantage6/pulls)
* [Actions](/vantage6/vantage6/actions)
* [Projects](/vantage6/vantage6/projects)
* [Security](/vantage6/vantage6/security)
* [Insights](/vantage6/vantage6/pulse)

## Commit

[Permalink](/vantage6/vantage6/commit/48ebfca42359e9a6743e9598684585e2522cdce8)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-4w59-c3gc-rrhp](https://github.com/advisories/GHSA-4w59-c3gc-rrhp "GHSA-4w59-c3gc-rrhp")

[Browse files](/vantage6/vantage6/tree/48ebfca42359e9a6743e9598684585e2522cdce8)
Browse the repository at this point in the history

```
Introduce maximum length of refresh tokens
```

* Loading branch information

[![@frankcorneliusmartin](https://avatars.githubusercontent.com/u/15981243?s=40&v=4)](/frankcorneliusmartin)

[frankcorneliusmartin](/vantage6/vantage6/commits?author=frankcorneliusmartin "View all commits by frankcorneliusmartin")
authored
Feb 28, 2023

2 parents
[32ec34a](/vantage6/vantage6/commit/32ec34aa5f3a147a0a5622a15aaa789802b769b8)
+
[1095521](/vantage6/vantage6/commit/109552146396b02195bf77f2fd120d73ea15e1f7)

commit 48ebfca

 Show file tree

 Hide file tree

Showing
**8 changed files**
with
**160 additions**
and
**36 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* docs/server/yaml

  + docs/server/yaml/server\_config.yaml
    [server\_config.yaml](#diff-c5720e32f3f4181a3aabed389bbf49df0e0477ca51469a18605a9f06577d5d08)
* vantage6-client/vantage6/client

  + vantage6-client/vantage6/client/\_\_init\_\_.py
    [\_\_init\_\_.py](#diff-69a6539ff08614cba317f57bddb5f0ff560da1a9adb1e9f9d5cf6ff698b34dda)
* vantage6-node/vantage6/node

  + vantage6-node/vantage6/node/\_\_init\_\_.py
    [\_\_init\_\_.py](#diff-641c734edf099ce15a8911efbbe8f0e1b3ff8365531efe558694de1b65b5f489)
  + vantage6-node/vantage6/node/globals.py
    [globals.py](#diff-73464479e39e9a739a18212b4b2914d6ec3246a3afcbaa22cdd72965a26bf830)
  + vantage6-node/vantage6/node/server\_io.py
    [server\_io.py](#diff-77b00aec6b909177ae83a787c606456d2be0cf071f0ba1f1ef6d37306a5affe6)
* vantage6-server/vantage6/server

  + vantage6-server/vantage6/server/\_\_init\_\_.py
    [\_\_init\_\_.py](#diff-4014e6578e3d972b74bc3a6e5536ad94de12cd089f917fa5c05d43d075790bd6)
  + vantage6-server/vantage6/server/globals.py
    [globals.py](#diff-78eb7154d893b718e4617a90b42692dbc5a3f2aff41f89e3e7d768f5fe584a04)
  + resource

    - vantage6-server/vantage6/server/resource/token.py
      [token.py](#diff-9a10b032f4ef30fbf6965ecfbbc540208fba5011606345cd8f5a089c60aac5e4)

## There are no files selected for viewing

12 changes: 9 additions & 3 deletions

12
[docs/server/yaml/server\_config.yaml](#diff-c5720e32f3f4181a3aabed389bbf49df0e0477ca51469a18605a9f06577d5d08 "docs/server/yaml/server_config.yaml")

Show comments

[View file](/vantage6/vantage6/blob/48ebfca42359e9a6743e9598684585e2522cdce8/docs/server/yaml/server_config.yaml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,6 +1,6 @@ |
|  |  | application: {} |
|  |  | # you may also add your configuration here and leave environments empty |
|  |  | ... |
|  |  |  |
|  |  | environments: |
|  |  | # name of the environment (should be 'test', 'prod', 'acc' or 'dev') |
|  |  | test: |
| Expand Down  Expand Up | | @@ -84,6 +84,11 @@ environments: |
|  |  | # set how long reset token provided via email are valid (default 1 hour) |
|  |  | email\_token\_validity\_minutes: 60 |
|  |  |  |
|  |  | # set how long tokens and refresh tokens are valid (default 6 and 48 |
|  |  | # hours, respectively) |
|  |  | token\_expires\_hours: 6 |
|  |  | refresh\_token\_expires\_hours: 48 |
|  |  |  |
|  |  | # If algorithm containers need direct communication between each other |
|  |  | # the server also requires a VPN server. (!) This must be a EduVPN |
|  |  | # instance as vantage6 makes use of their API (!) |
| Expand All | | @@ -102,5 +107,6 @@ environments: |
|  |  | portal\_username: your\_eduvpn\_portal\_user\_name |
|  |  | portal\_userpass: your\_eduvpn\_portal\_user\_password |
|  |  |  |
|  |  | prod: |
|  |  | ... |
|  |  | prod: {} |
|  |  | acc: {} |
|  |  | dev: {} |

1 change: 1 addition & 0 deletions

1
[vantage6-client/vantage6/client/\_\_init\_\_.py](#diff-69a6539ff08614cba317f57bddb5f0ff560da1a9adb1e9f9d5cf6ff698b34dda "vantage6-client/vantage6/client/__init__.py")

Show comments

[View file](/vantage6/vantage6/blob/48ebfca42359e9a6743e9598684585e2522cdce8/vantage6-client/vantage6/client/__init__.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -366,6 +366,7 @@ def refresh\_token(self) -> None: |
|  |  | raise Exception("Authentication Error!") |
|  |  |  |
|  |  | self.\_access\_token = response.json()["access\_token"] |
|  |  | self.\_\_refresh\_token = response.json()["refresh\_token"] |
|  |  |  |
|  |  | # TODO BvB 23-01-23 remove this method in v4+. It is only here for |
|  |  | # backwards compatibility |
| Expand Down | |  |

3 changes: 3 additions & 0 deletions

3
[vantage6-node/vantage6/node/\_\_init\_\_.py](#diff-641c734edf099ce15a8911efbbe8f0e1b3ff8365531efe558694de1b65b5f489 "vantage6-node/vantage6/node/__init__.py")

Show comments

[View file](/vantage6/vantage6/blob/48ebfca42359e9a6743e9598684585e2522cdce8/vantage6-node/vantage6/node/__init__.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -486,6 +486,9 @@ def authenticate(self) -> None: |
|  |  | self.log.critical('Unable to authenticate. Exiting') |
|  |  | exit(1) |
|  |  |  |
|  |  | # start thread to keep the connection alive by refreshing the token |
|  |  | self.server\_io.auto\_refresh\_token() |
|  |  |  |
|  |  | def private\_key\_filename(self) -> Path: |
|  |  | """Get the path to the private key.""" |
|  |  |  |
| Expand Down | |  |

3 changes: 3 additions & 0 deletions

3
[vantage6-node/vantage6/node/globals.py](#diff-73464479e39e9a739a18212b4b2914d6ec3246a3afcbaa22cdd72965a26bf830 "vantage6-node/vantage6/node/globals.py")

Show comments

[View file](/vantage6/vantage6/blob/48ebfca42359e9a6743e9598684585e2522cdce8/vantage6-node/vantage6/node/globals.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -44,3 +44,6 @@ |
|  |  | # SSH TUNNEL RELATED CONSTANTS |
|  |  | # |
|  |  | SSH\_TUNNEL\_IMAGE = "harbor2.vantage6.ai/infrastructure/ssh-tunnel" |
|  |  |  |
|  |  | # start trying to refresh the JWT token 10 minutes before it expires. |
|  |  | REFRESH\_BEFORE\_EXPIRES\_SECONDS = 600 |

24 changes: 24 additions & 0 deletions

24
[vantage6-node/vantage6/node/server\_io.py](#diff-77b00aec6b909177ae83a787c606456d2be0cf071f0ba1f1ef6d37306a5affe6 "vantage6-node/vantage6/node/server_io.py")

Show comments

[View file](/vantage6/vantage6/blob/48ebfca42359e9a6743e9598684585e2522cdce8/vantage6-node/vantage6/node/server_io.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -4,10 +4,14 @@ |
|  |  | """ |
|  |  | import jwt |
|  |  | import datetime |
|  |  | import time |
|  |  |  |
|  |  | from typing import Dict, Tuple |
|  |  | from threading import Thread |
|  |  |  |
|  |  | from vantage6.common import WhoAmI |
|  |  | from vantage6.client import ClientBase |
|  |  | from vantage6.node.globals import REFRESH\_BEFORE\_EXPIRES\_SECONDS |
|  |  |  |
|  |  |  |
|  |  | class NodeClient(ClientBase): |
| Expand Down  Expand Up | | @@ -61,6 +65,26 @@ def authenticate(self, api\_key: str): |
|  |  | organization\_name=organization\_name |
|  |  | ) |
|  |  |  |
|  |  | def auto\_refresh\_token(self) -> None: |
|  |  | """ Start a thread that refreshes token before it expires. """ |
|  |  | # set up thread to refresh token |
|  |  | t = Thread(target=self.\_\_refresh\_token\_worker, daemon=True) |
|  |  | t.start() |
|  |  |  |
|  |  | def \_\_refresh\_token\_worker(self) -> None: |
|  |  | """ Keep refreshing token to prevent it from expiring. """ |
|  |  | while True: |
|  |  | # get the time until the token expires |
|  |  | expiry\_time = jwt.decode( |
|  |  | self.token, options={"verify\_signature": False})["exp"] |
|  |  | time\_until\_expiry = expiry\_time - time.time() |
|  |  | if time\_until\_expiry < REFRESH\_BEFORE\_EXPIRES\_SECONDS: |
|  |  | self.refresh\_token() |
|  |  | else: |
|  |  | time.sleep( |
|  |  | int(time\_until\_expiry - REFRESH\_BEFORE\_EXPIRES\_SECONDS + 1) |
|  |  | ) |
|  |  |  |
|  |  | def request\_token\_for\_container(self, task\_id: int, image: str): |
|  |  | """ Request a container-token at the central server. |
|  |  |  |
| Expand Down | |  |

86 changes: 78 additions & 8 deletions

86
[vantage6-server/vantage6/server/\_\_init\_\_.py](#diff-4014e6578e3d972b74bc3a6e5536ad94de12cd089f917fa5c05d43d075790bd6 "vantage6-server/vantage6/server/__init__.py")

Show comments

[View file](/vantage6/vantage6/blob/48ebfca42359e9a6743e9598684585e2522cdce8/vantage6-server/vantage6/server/__init__.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -36,13 +36,15 @@ |
|  |  | from vantage6.server.permission import RuleNeed, PermissionManager |
|  |  | from vantage6.server.globals import ( |
|  |  | APPNAME, |
|  |  | JWT\_ACCESS\_TOKEN\_EXPIRES, |
|  |  | ACCESS\_TOKEN\_EXPIRES\_HOURS, |
|  |  | JWT\_TEST\_ACCESS\_TOKEN\_EXPIRES, |
|  |  | RESOURCES, |
|  |  | SUPER\_USER\_INFO, |
|  |  | REFRESH\_TOKENS\_EXPIRE, |
|  |  | REFRESH\_TOKENS\_EXPIRE\_HOURS, |
|  |  | DEFAULT\_SUPPORT\_EMAIL\_ADDRESS, |
|  |  | MAX\_RESPONSE\_TIME\_PING |
|  |  | MAX\_RESPONSE\_TIME\_PING, |
|  |  | MIN\_TOKEN\_VALIDITY\_SECONDS, |
|  |  | MIN\_REFRESH\_TOKEN\_EXPIRY\_DELTA, |
|  |  | ) |
|  |  | from vantage6.server.resource.common.swagger\_templates import swagger\_template |
|  |  | from vantage6.server.\_version import \_\_version\_\_ |
| Expand Down  Expand Up | | @@ -145,7 +147,7 @@ def setup\_socket\_connection(self): |
|  |  |  |
|  |  | @staticmethod |
|  |  | def configure\_logging(): |
|  |  | """Turn 3rd party loggers off.""" |
|  |  | """Set third party loggers to a warning level""" |
|  |  |  |
|  |  | # Prevent logging from urllib3 |
|  |  | logging.getLogger("urllib3").setLevel(logging.WARNING) |
| Expand All | | @@ -165,9 +167,6 @@ def configure\_flask(self): |
|  |  | # patch where to obtain token |
|  |  | self.app.config['JWT\_AUTH\_URL\_RULE'] = '/api/token' |
|  |  |  |
|  |  | # False means refresh tokens never expire |
|  |  | self.app.config['JWT\_REFRESH\_TOKEN\_EXPIRES'] = REFRESH\_TOKENS\_EXPIRE |
|  |  |  |
|  |  | # If no secret is set in the config file, one is generated. This |
|  |  | # implies that all (even refresh) tokens will be invalidated on restart |
|  |  | self.app.config['JWT\_SECRET\_KEY'] = self.ctx.config.get( |
| Expand All | | @@ -176,7 +175,20 @@ def configure\_flask(self): |
|  |  | ) |
|  |  |  |
|  |  | # Default expiration time |
|  |  | self.app.config['JWT\_ACCESS\_TOKEN\_EXPIRES'] = JWT\_ACCESS\_TOKEN\_EXPIRES |
|  |  | token\_expiry\_seconds = self.\_get\_jwt\_expiration\_seconds( |
|  |  | config\_key='token\_expires\_hours', |
|  |  | default\_hours=ACCESS\_TOKEN\_EXPIRES\_HOURS |
|  |  | ) |
|  |  | self.app.config['JWT\_ACCESS\_TOKEN\_EXPIRES'] = token\_expiry\_seconds |
|  |  |  |
|  |  | # Set refresh token expiration time |
|  |  | self.app.config['JWT\_REFRESH\_TOKEN\_EXPIRES'] = \ |
|  |  | self.\_get\_jwt\_expiration\_seconds( |
|  |  | config\_key='refresh\_token\_expires\_hours', |
|  |  | default\_hours=REFRESH\_TOKENS\_EXPIRE\_HOURS, |
|  |  | longer\_than=token\_expiry\_seconds + MIN\_REFRESH\_TOKEN\_EXPIRY\_DELTA, |
|  |  | is\_refresh=True |
|  |  | ) |
|  |  |  |
|  |  | # Set an extra long expiration time on access tokens for testing |
|  |  | # TODO: this does not seem needed... |
| Expand Down  Expand Up | | @@ -284,6 +296,64 @@ def static\_from\_root(): |
|  |  | return send\_from\_directory(self.app.static\_folder, |
|  |  | request.path[1:]) |
|  |  |  |
|  |  |  |
|  |  | def \_get\_jwt\_expiration\_seconds( |
|  |  | self, config\_key: str, default\_hours: int, |
|  |  | longer\_than: int = MIN\_TOKEN\_VALIDITY\_SECONDS, |
|  |  | is\_refresh: bool = False |
|  |  | ) -> int: |
|  |  | """ |
|  |  | Return the expiration time for JWT tokens. |
|  |  |  |
|  |  | This time may be specified in the config file. If it is not, the |
|  |  | default value is returned. |
|  |  |  |
|  |  | Parameters |
|  |  | ---------- |
|  |  | config\_key: str |
|  |  | The config key to look for that sets the expiration time |
|  |  | default\_hours: int |
|  |  | The default expiration time in hours |
|  |  | longer\_than: int |
|  |  | The minimum expiration time in hours. |
|  |  | is\_refresh: bool |
|  |  | If True, the expiration time is for a refresh token. If False, it |
|  |  | is for an access token. |
|  |  |  |
|  |  | Returns |
|  |  | ------- |
|  |  | int: |
|  |  | The JWT token expiration time in seconds |
|  |  | """ |
|  |  | hours\_expire = self.ctx.config.get(config\_key) |
|  |  | if hours\_expire is None: |
|  |  | # No value is present in the config file, use default |
|  |  | refresh\_expire = int(float(default\_hours) \* 3600) |
|  |  | elif isinstance(hours\_expire, (int, float)) or \ |
|  |  | hours\_expire.is\_numeric(): |
|  |  | # Numeric value is present in the config file |
|  |  | refresh\_expire = int(float(hours\_expire) \* 3600) |
|  |  | if refresh\_expire < longer\_than: |
|  |  | log.warning( |
|  |  | f"Invalid value for '{config\_key}': {hours\_expire}. Tokens" |
|  |  | f" must be valid for at least {longer\_than} seconds. Using" |
|  |  | f" default value: {REFRESH\_TOKENS\_EXPIRE\_HOURS} hours") |
|  |  | if is\_refresh: |
|  |  | log.warning("Note that refresh tokens should be valid at " |
|  |  | f"least {MIN\_REFRESH\_TOKEN\_EXPIRY\_DELTA} " |
|  |  | "seconds longer than access tokens.") |
|  |  | refresh\_expire = int(float(REFRESH\_TOKENS\_EXPIRE\_HOURS) \* 3600) |
|  |  | else: |
|  |  | # Non-numeric value is present in the config file. Warn and use |
|  |  | # default |
|  |  | log.warning("Invalid value for 'refresh\_token\_expires\_hours':" |
|  |  | f" {hours\_expire}. Using default value: " |
|  |  | f"{REFRESH\_TOKENS\_EXPIRE\_HOURS} hours") |
|  |  | refresh\_expire = int(float(REFRESH\_TOKENS\_EXPIRE\_HOURS) \* 3600) |
|  |  |  |
|  |  | return refresh\_expire |
|  |  |  |
|  |  |  |
|  |  | def configure\_api(self): |
|  |  | """"Define global API output.""" |
|  |  |  |
| Expand Down | |  |

15 changes: 11 additions & 4 deletions

15
[vantage6-server/vantage6/server/globals.py](#diff-78eb7154d893b718e4617a90b42692dbc5a3f2aff41f89e3e7d768f5fe584a04 "vantage6-server/vantage6/server/globals.py")

Show comments

[View file](/vantage6/vantage6/blob/48ebfca42359e9a6743e9598684585e2522cdce8/vantage6-server/vantage6/server/globals.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -16,7 +16,10 @@ |
|  |  | # |
|  |  |  |
|  |  | # Expiretime of JWT tokens |
|  |  | JWT\_ACCESS\_TOKEN\_EXPIRES = datetime.timedelta(hours=6) |
|  |  | ACCESS\_TOKEN\_EXPIRES\_HOURS = datetime.timedelta(hours=6) |
|  |  |  |
|  |  | # minimum validity of JWT Tokens in seconds |
|  |  | MIN\_TOKEN\_VALIDITY\_SECONDS = 1800 |
|  |  |  |
|  |  | # Expiretime of JWT token in a test environment |
|  |  | JWT\_TEST\_ACCESS\_TOKEN\_EXPIRES = datetime.timedelta(days=1) |
| Expand All | | @@ -34,9 +37,13 @@ |
|  |  | "password": "root" |
|  |  | } |
|  |  |  |
|  |  | # Whenever the refresh tokens should expire. Note that setting this to true |
|  |  | # would mean that nodes will disconnect after some time |
|  |  | REFRESH\_TOKENS\_EXPIRE = False |
|  |  | # Expiration time of refresh tokens |
|  |  | REFRESH\_TOKENS\_EXPIRE\_HOURS = 48 |
|  |  |  |
|  |  | # Minimum time in seconds that a refresh token must be valid \*longer than\* the |
|  |  | # access token. This is to prevent the access token from expiring before the |
|  |  | # refresh token. |
|  |  | MIN\_REFRESH\_TOKEN\_EXPIRY\_DELTA = 1 |
|  |  |  |
|  |  | # default support email address |
|  |  | DEFAULT\_SUPPORT\_EMAIL\_ADDRESS = 'support@vantage6.ai' |
| Expand Down | |  |

52 changes: 31 additions & 21 deletions

52
[vantage6-server/vantage6/server/resource/token.py](#diff-9a10b032f4ef30fbf6965ecfbbc540208fba5011606345cd8f5a089c60aac5e4 "vantage6-server/vantage6/server/resource/token.py")

Show comments

[View file](/vantage6/vantage6/blob/48ebfca42359e9a6743e9598684585e2522cdce8/vantage6-server/vantage6/server/resource/token.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -14,6 +14,7 @@ |
|  |  | create\_refresh\_token, |
|  |  | get\_jwt\_identity |
|  |  | ) |
|  |  | from flask\_restful import Api |
|  |  | from http import HTTPStatus |
|  |  |  |
|  |  | from vantage6 import server |
| Expand Down  Expand Up | | @@ -152,18 +153,10 @@ def post(self): |
|  |  | "incorrect!" |
|  |  | }, HTTPStatus.UNAUTHORIZED |
|  |  |  |
|  |  | token = create\_access\_token(user) |
|  |  |  |
|  |  | ret = { |
|  |  | 'access\_token': token, |
|  |  | 'refresh\_token': create\_refresh\_token(user), |
|  |  | 'user\_url': self.api.url\_for(server.resource.user.User, |
|  |  | id=user.id), |
|  |  | 'refresh\_url': self.api.url\_for(RefreshToken), |
|  |  | } |
|  |  | token = \_get\_token\_dict(user, self.api) |
|  |  |  |
|  |  | log.info(f"Succesfull login from {username}") |
|  |  | return ret, HTTPStatus.OK, {'jwt-token': token} |
|  |  | return token, HTTPStatus.OK, {'jwt-token': token['access\_token']} |
|  |  |  |
|  |  | def user\_login(self, username: str, password: str) -> Union[dict, db.User]: |
|  |  | """Returns user a message in case of failed login attempt.""" |
| Expand Down  Expand Up | | @@ -292,17 +285,10 @@ def post(self): |
|  |  | return {"msg": "Api key is not recognized!"}, \ |
|  |  | HTTPStatus.UNAUTHORIZED |
|  |  |  |
|  |  | token = create\_access\_token(node) |
|  |  | ret = { |
|  |  | 'access\_token': token, |
|  |  | 'refresh\_token': create\_refresh\_token(node), |
|  |  | 'node\_url': self.api.url\_for(server.resource.node.Node, |
|  |  | id=node.id), |
|  |  | 'refresh\_url': self.api.url\_for(RefreshToken), |
|  |  | } |
|  |  | token = \_get\_token\_dict(node, self.api) |
|  |  |  |
|  |  | log.info(f"Succesfull login as node '{node.id}' ({node.name})") |
|  |  | return ret, HTTPStatus.OK, {'jwt-token': token} |
|  |  | return token, HTTPStatus.OK, {'jwt-token': token['access\_token']} |
|  |  |  |
|  |  |  |
|  |  | class ContainerToken(ServicesResources): |
| Expand Down  Expand Up | | @@ -412,6 +398,30 @@ def post(self): |
|  |  | user\_or\_node\_id = get\_jwt\_identity() |
|  |  | log.info(f'Refreshing token for user or node "{user\_or\_node\_id}"') |
|  |  | user\_or\_node = db.Authenticatable.get(user\_or\_node\_id) |
|  |  | ret = {'access\_token': create\_access\_token(user\_or\_node)} |
|  |  |  |
|  |  | return ret, HTTPStatus.OK |
|  |  | return \_get\_token\_dict(user\_or\_node, self.api), HTTPStatus.OK |
|  |  |  |
|  |  |  |
|  |  | def \_get\_token\_dict(user\_or\_node: db.Authenticatable, api: Api) -> dict: |
|  |  | """ |
|  |  | Create a dictionary with the tokens and urls for the user or node. |
|  |  |  |
|  |  | Parameters |
|  |  | ---------- |
|  |  | user\_or\_node : db.Authenticatable |
|  |  | The user or node to create the tokens for. |
|  |  | api : Api |
|  |  | The api to create the urls for. |
|  |  | """ |
|  |  | token\_dict = { |
|  |  | 'access\_token': create\_access\_token(user\_or\_node), |
|  |  | 'refresh\_token': create\_refresh\_token(user\_or\_node), |
|  |  | 'refresh\_url': api.url\_for(RefreshToken), |
|  |  | } |
|  |  | if isinstance(user\_or\_node, db.User): |
|  |  | token\_dict['user\_url'] = api.url\_for(server.resource.user.User, |
|  |  | id=user\_or\_node.id) |
|  |  | else: |
|  |  | token\_dict['node\_url'] = api.url\_for(server.resource.node.Node, |
|  |  | id=user\_or\_node.id) |
|  |  | return token\_dict |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `48ebfca`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvantage6%2Fvantage6%2Fcommit%2F48ebfca42359e9a6743e9598684585e2522cdce8) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_ed618c04_20250114_191631.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvantage6%2Fvantage6%2Fsecurity%2Fadvisories%2FGHSA-4w59-c3gc-rrhp)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvantage6%2Fvantage6%2Fsecurity%2Fadvisories%2FGHSA-4w59-c3gc-rrhp)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=vantage6%2Fvantage6)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[vantage6](/vantage6)
/
**[vantage6](/vantage6/vantage6)**
Public

* [Notifications](/login?return_to=%2Fvantage6%2Fvantage6) You must be signed in to change notification settings
* [Fork
  11](/login?return_to=%2Fvantage6%2Fvantage6)
* [Star
   31](/login?return_to=%2Fvantage6%2Fvantage6)

* [Code](/vantage6/vantage6)
* [Issues
  241](/vantage6/vantage6/issues)
* [Pull requests
  6](/vantage6/vantage6/pulls)
* [Actions](/vantage6/vantage6/actions)
* [Projects
  2](/vantage6/vantage6/projects)
* [Security](/vantage6/vantage6/security)
* [Insights](/vantage6/vantage6/pulse)

Additional navigation options

* [Code](/vantage6/vantage6)
* [Issues](/vantage6/vantage6/issues)
* [Pull requests](/vantage6/vantage6/pulls)
* [Actions](/vantage6/vantage6/actions)
* [Projects](/vantage6/vantage6/projects)
* [Security](/vantage6/vantage6/security)
* [Insights](/vantage6/vantage6/pulse)

# Refresh tokens do not expire

Moderate

[frankcorneliusmartin](/frankcorneliusmartin)
published
GHSA-4w59-c3gc-rrhp
Feb 28, 2023

## Package

pip

vantage6
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

<3.8.0

## Patched versions

3.8.0

## Description

From issue:

Problem description

Currently, the refresh token is valid indefinitely. This is bad security practice.

Desired solution

The refresh token should get a validity of 24-48 hours.

Additional context

When implementing this, also check that the refresh token returns a new refresh token

When implementing this, also adapt the UI so that it logs out if refresh token is no longer valid.

When implementing this, ensure that nodes refresh their token periodically so that they do not have to be restarted manually.

### Impact

### Patches

None available

### Workarounds

None available

### Severity

Moderate

### CVE ID

CVE-2023-23929

### Weaknesses

[CWE-613](/advisories?query=cwe%3A613)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


