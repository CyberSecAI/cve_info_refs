=== Content from bugzilla.mozilla.org_634fda66_20250114_221739.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1538028)
* [XML](/show_bug.cgi?ctype=xml&id=1538028)

Closed
[Bug 1538028](/show_bug.cgi?id=1538028)
(CVE-2023-23597)

Opened 6 years ago
Closed 2 years ago

# Privilege escalation from web to file process

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Privilege escalation from web to file process

## Categories

### (Core :: DOM: Navigation, defect, P2)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Navigation#DOM%3A%20Navigation)

DOM: Navigation
▾

Core :: DOM: Navigation
For bugs with HTML’s [navigate](https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate) algorithm and browsing contexts.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Navigation&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Navigation&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Navigation)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P2

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S2

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

109 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| a11y-review | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr60 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=wontfix) |
| firefox-esr68 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=wontfix) |
| firefox-esr102 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=wontfix) |
| firefox66 | [+](/buglist.cgi?f1=cf_tracking_firefox66&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=wontfix) |
| firefox67 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox67&o1=equals&v1=wontfix) |
| firefox68 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox68&o1=equals&v1=wontfix) |
| firefox69 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox69&o1=equals&v1=wontfix) |
| firefox70 | [-](/buglist.cgi?f1=cf_tracking_firefox70&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox70&o1=equals&v1=wontfix) |
| firefox71 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox71&o1=equals&v1=wontfix) |
| firefox107 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox107&o1=equals&v1=wontfix) |
| firefox108 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox108&o1=equals&v1=wontfix) |
| firefox109 | [+](/buglist.cgi?f1=cf_tracking_firefox109&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox109&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr60 |  | wontfix |
| firefox-esr68 |  | wontfix |
| firefox-esr102 |  | wontfix |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox66 | + | wontfix |
| firefox67 |  | wontfix |
| firefox68 |  | wontfix |
| firefox69 |  | wontfix |
| firefox70 | - | wontfix |
| firefox71 |  | wontfix |
| firefox107 |  | wontfix |
| firefox108 |  | wontfix |
| firefox109 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: niklas.baumstark, Assigned: nika)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/fcf93a5a624020bf2256443c69e08b51?d=mm&size=40)  [nika](/user_profile?user_id=534482)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/75bf31b48e75eedfebaa411a76a85155?d=mm&size=40)  [niklas.baumstark](/user_profile?user_id=423505)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/b89a42ca4c4d59c27f33c399bb1ecc7b?d=mm&size=40)  [farre](/user_profile?user_id=566192)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

36 people

## References

### (Depends on 1 open bug)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[1798986](/show_bug.cgi?id=1798986 "RESOLVED FIXED - UnstrippedURI should be tracked in SessionHistory")

[1647550](/show_bug.cgi?id=1647550 "NEW - [meta] Control Document loads entirely from the parent process")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[1799692](/show_bug.cgi?id=1799692 "RESOLVED FIXED - Track TriggeringRemoteType for worker-triggered navigations")

[pwn2own-2019](/show_bug.cgi?id=1539818 "RESOLVED FIXED - [meta] pwn2own 2019")

Dependency [tree](/showdependencytree.cgi?id=1538028&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1538028)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

[1812356](/show_bug.cgi?id=1812356 "RESOLVED FIXED - Crash when loading any resource://android/assets/page.html"), [1838686](/show_bug.cgi?id=1838686 "RESOLVED INCOMPLETE - Crash in [@ CheckAllowLoadByTriggeringRemoteType]")

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [reporter-external] [client-bounty-form] [verif?][post-critsmash-triage][adv-main109+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2023-23597

[Keywords:](/describekeywords.cgi)

[csectype-priv-escalation](/buglist.cgi?keywords=csectype-priv-escalation&resolution=---),
[csectype-sandbox-escape](/buglist.cgi?keywords=csectype-sandbox-escape&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[reporter-external] [client-bounty-form] [verif?][post-critsmash-triage][adv-main109+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a27545836_1689 "6 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
| [btot](/user_profile?user_id=553429) | [qe-verify](#a117995278_553429 "2 years ago") | - |
| --- | --- | --- |
| [btot](/user_profile?user_id=553429) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (5 files)

| [Bug 1538028 - Part 1: Validate SHIP history loads in DocumentLoadListener, r=smaug!](/attachment.cgi?id=9301853)  [2 years ago](#c30)  [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)   48 bytes, text/x-phabricator-request | tjr : [sec-approval+](#a116453866_578488 "2 years ago") | [Details](/attachment.cgi?id=9301853&action=edit) | [Review](/attachment.cgi?id=9301853) |
| --- | --- | --- |
| [Bug 1538028 - Part 2: Track TriggeringRemoteType through nsDocShellLoadState and LoadInfo, r=smaug!,#necko-reviewers!,ckerschb!](/attachment.cgi?id=9301854)  [2 years ago](#c31)  [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)   48 bytes, text/x-phabricator-request | tjr : [sec-approval+](#a116453864_578488 "2 years ago") | [Details](/attachment.cgi?id=9301854&action=edit) | [Review](/attachment.cgi?id=9301854) |
| [Bug 1538028 - Part 3: Validate loads by TriggeringRemoteType, r=smaug!,ckerschb!](/attachment.cgi?id=9301855)  [2 years ago](#c32)  [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)   48 bytes, text/x-phabricator-request | tjr : [sec-approval+](#a116453862_578488 "2 years ago") | [Details](/attachment.cgi?id=9301855&action=edit) | [Review](/attachment.cgi?id=9301855) |
| [Bug 1538028 - Part 4: Pass TriggeringRemoteType through the frontend, r=gijs!](/attachment.cgi?id=9302939)  [2 years ago](#c35)  [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)   48 bytes, text/x-phabricator-request | tjr : [sec-approval+](#c38 "2 years ago") | [Details](/attachment.cgi?id=9302939&action=edit) | [Review](/attachment.cgi?id=9302939) |
| [advisory.txt](/attachment.cgi?id=9312389)  [2 years ago](#c40)  [Frederik Braun [:freddy]](/user_profile?user_id=428608)   359 bytes, text/plain |  | [Details](/attachment.cgi?id=9312389&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Niklas Baumstark](/user_profile?user_id=423505)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1538028#c0)• 6 years ago |
|  | |

This was found via manual analysis of the sandbox code of Firefox 65. I am currently not able to get a Windows debug build for Firefox 66, but I assume the flaw still exists.

Given a renderer exploit, we can perform the following steps:

1. Hook CheckLoadURIWithPrincipal to always return true.
2. Hook PopupBlocker::CanShowPopupByPermission to always allow.
3. Load file:///path/to/stage1.html in an iframe.

   stage1.html file must be readable from within the web sandbox,

   either drop it to temp dir sContentTempDir, or use a UNC path on Windows.

   Every action performed from this document will be associated with

   a security principal for a file:/// origin.
4. In stage1.html, we can do window.open('file:///path/to/stage2.html')

   This will create a new FILE\_REMOTE\_TYPE process.
5. Now re-exploit the new renderer from stage2.html.

Similar to my Pwn2Own bug, steps 1-4 can probably be replaced by appropriate IPC/message manager/XPCOM usage which I have not investigated in detail.

We escalated privileges, because a file process can:

* Access all files [1](https://github.com/mozilla/gecko-dev/blob/177fb00ebaaf69857d8f04334b46a107feb212ac/security/sandbox/win/src/sandboxbroker/sandboxBroker.cpp#L505)
* On Windows, access a USER\_NON\_ADMIN token, rather than USER\_PROTECTED [2](https://github.com/mozilla/gecko-dev/blob/177fb00ebaaf69857d8f04334b46a107feb212ac/security/sandbox/win/src/sandboxbroker/sandboxBroker.cpp#L419)
Flags: sec-bounty?

|  | [Alex Gaynor [:Alex\_Gaynor]](/user_profile?user_id=537703) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a93_537703)• 6 years ago |

Group: firefox-core-security → dom-core-securityComponent: Security → DOM: Content ProcessesKeywords: [csectype-priv-escalation](/buglist.cgi?keywords=csectype-priv-escalation&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)Product: Firefox → Core

|  | [Alex Gaynor [:Alex\_Gaynor]](/user_profile?user_id=537703) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1538028#c1)• 6 years ago |
|  | |

There's two pieces to fixing this I think:

a) Remove the thing where all file:// is SOP with all other file://

b) Change the way we implement file content process from being a special sandbox policy to having the same sandbox semantics and make the parent process responsible for doing file loads, then have the IPC for that enforce SOP correctly.

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a1972_451704)• 6 years ago |

[status-firefox66](/buglist.cgi?f1=cf_status_firefox66&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=affected)
[status-firefox67](/buglist.cgi?f1=cf_status_firefox67&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox67&o1=equals&v1=affected)
[status-firefox68](/buglist.cgi?f1=cf_status_firefox68&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox68&o1=equals&v1=affected)
[tracking-firefox66](/buglist.cgi?f1=cf_tracking_firefox66&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox66&o1=equals&v1=%2B)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a3339_279663)• 6 years ago |

Flags: needinfo?(bobowencode)Priority: -- → P2

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1538028#c2)• 6 years ago |
|  | |

(In reply to Alex Gaynor [:Alex\_Gaynor] from [comment #1](/show_bug.cgi?id=1538028#c1 "RESOLVED FIXED - Privilege escalation from web to file process"))

> There's two pieces to fixing this I think:
>
> a) Remove the thing where all file:// is SOP with all other file://
>
> b) Change the way we implement file content process from being a special sandbox policy to having the same sandbox semantics and make the parent process responsible for doing file loads, then have the IPC for that enforce SOP correctly.

Can we prevent writing the file at all? Or can we at least prevent loading file from locations which are writable from the content process?

|  | [Alex Gaynor [:Alex\_Gaynor]](/user_profile?user_id=537703) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1538028#c3)• 6 years ago |
|  | |

I think we're driving towards blocking writing files -- we already disallow this on macOS, but I don't know how far we off from it.

I think we could blocking loading file:// URIs that are in the content temp directory, though I'm not 100% sure how difficult that'd be.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1538028#c4)• 6 years ago |
|  | |

The file same-origin-policy should be irrelevant because non-same-origin files will still be allowed to link to each other (an early step in CheckLoadURI is a scheme compare. Documents can always link to another document in the same scheme).

What needs to happen is moving the CheckLoadURI step out of the content process, as well as initiating of the navigation. The child should ask the parent to navigate it, and the parent can do the CheckLoadURI and start or block the load. I assume something like this is already in the plan for Fission because the parent will have to decide whether to spin up new processes if the new document is from a different site. (A fission MVP might still have these checks in the child because the 1st worry is NON-compromised child processes doing Spectre attacks, but ultimately we want to protect against compromised child processes too.)

|  | [Gian-Carlo Pascutto [:gcp]](/user_profile?user_id=151147) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1538028#c5)• 6 years ago |
|  | |

> I think we're driving towards blocking writing files
>
> -- we already disallow this on macOS, but I don't know how far we off from it.

The technique would work on Linux as well because it also has a writable content-process-specific tmpdir. Aside from fontconfig wanting to write to T(E)MPDIR, there's things like the shader caches that we redirect into a writable dir.

<https://searchfox.org/mozilla-central/source/security/sandbox/linux/broker/SandboxBrokerPolicyFactory.cpp#466>

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1538028#c6)• 6 years ago |
|  | |

I remember asking whether the parent enforced these checks in a discussion during that presentation in Hawaii. Looks like it never got filed.

I agree with Dan that checking the linking policy in the parent is best way to fix this.

Flags: needinfo?(bobowencode)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a488768_279663)• 6 years ago |

Depends on: [1379635](/show_bug.cgi?id=1379635 "NEW - On Windows narrow down write access to TEMP dir for leak/bloat logging.")

|  | [Andrew Overholt [:overholt]](/user_profile?user_id=442218) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1538028#c7)• 6 years ago |
|  | |

Nika, can you comment on the plans here ([comment 4](/show_bug.cgi?id=1538028#c4 "RESOLVED FIXED - Privilege escalation from web to file process")) and how they jive with our glorious Fission future?

Flags: needinfo?(nika)

|  | [Alex Gaynor [:Alex\_Gaynor]](/user_profile?user_id=537703) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1538028#c8)• 6 years ago |
|  | |

FWIW, Nika's also got a good write up on [bug 1538072](/show_bug.cgi?id=1538072 "NEW"). We shouldn't need fission to solve this, since file processes are already distinct.

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a554821_458623)• 6 years ago |

No longer depends on: [1379635](/show_bug.cgi?id=1379635 "NEW - On Windows narrow down write access to TEMP dir for leak/bloat logging.")

|  | [Alex Gaynor [:Alex\_Gaynor]](/user_profile?user_id=537703) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a574847_537703)• 6 years ago |

Blocks: [pwn2own-2019](/show_bug.cgi?id=1539818 "RESOLVED FIXED - [meta] pwn2own 2019")

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1538028#c9)• 6 years ago |
|  | |

see [comment 8](/show_bug.cgi?id=1538028#c8 "RESOLVED FIXED - Privilege escalation from web to file process") and [bug 1538072](/show_bug.cgi?id=1538072 "NEW") :-)

Flags: needinfo?(nika)

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1538028#c10)• 6 years ago |
|  | |

I don't think we plan to fix this for 66 at this point.

[status-firefox66](/buglist.cgi?f1=cf_status_firefox66&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=wontfix)

|  | [Niklas Baumstark](/user_profile?user_id=423505)  Reporter |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1538028#c11)• 6 years ago |
|  | |

Just a quick question: Will this likely be addressed in 67?

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1538028#c12)• 6 years ago |
|  | |

(In reply to Niklas Baumstark from [comment #11](/show_bug.cgi?id=1538028#c11 "RESOLVED FIXED - Privilege escalation from web to file process"))

> Just a quick question: Will this likely be addressed in 67?

67 release candidates are being made now and there is no patch for this as of yet so, no, it isn't going to be addressed in 67.

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1538028#c13)• 6 years ago |
|  | |

Is there any reason (In reply to Niklas Baumstark from [comment #0](/show_bug.cgi?id=1538028#c0 "RESOLVED FIXED - Privilege escalation from web to file process"))

> 1. Hook CheckLoadURIWithPrincipal to always return true.
> 2. Hook PopupBlocker::CanShowPopupByPermission to always allow.
> 3. Load file:///path/to/stage1.html in an iframe.
>
>    stage1.html file must be readable from within the web sandbox,
>
>    either drop it to temp dir sContentTempDir, or use a UNC path on Windows.
>
>    Every action performed from this document will be associated with
>
>    a security principal for a file:/// origin.
> 4. In stage1.html, we can do window.open('file:///path/to/stage2.html')
>
>    This will create a new FILE\_REMOTE\_TYPE process.
> 5. Now re-exploit the new renderer from stage2.html.

On OSX, after performing 1 & 2 (by just editing the code), I can window.open a file:// URI directly from a website (e.g. <https://ritter.vg/misc/ff/file2.html> ) without needing to do Step 3.

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a8954144_75935)• 6 years ago |

Status: UNCONFIRMED → NEW
[status-firefox67](/buglist.cgi?f1=cf_status_firefox67&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox67&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox67&o1=equals&v1=wontfix)
[status-firefox68](/buglist.cgi?f1=cf_status_firefox68&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox68&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox68&o1=equals&v1=wontfix)
[status-firefox69](/buglist.cgi?f1=cf_status_firefox69&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox69&o1=equals&v1=affected)
[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=%3F)
[status-firefox-esr68](/buglist.cgi?f1=cf_status_firefox_esr68&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=affected)Ever confirmed: true

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a8958070_578488)• 6 years ago |

Assignee: nobody → tom

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1538028#c14)• 5 years ago |
|  | |

Tom, are you intending to work on this for the 70 timeframe?

[status-firefox70](/buglist.cgi?f1=cf_status_firefox70&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox70&o1=equals&v1=affected)
[tracking-firefox70](/buglist.cgi?f1=cf_tracking_firefox70&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox70&o1=equals&v1=%2B)Flags: needinfo?(tom)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1538028#c15)• 5 years ago |
|  | |

(In reply to Liz Henry (:lizzard) from [comment #14](/show_bug.cgi?id=1538028#c14 "RESOLVED FIXED - Privilege escalation from web to file process"))

> Tom, are you intending to work on this for the 70 timeframe?

Blocked on Fission work; explained here: <https://bugzilla.mozilla.org/show_bug.cgi?id=1538072#c20> I'll work on it whenever it becomes unblocked :)

Flags: needinfo?(tom)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1538028#c16)• 5 years ago |
|  | |

Per tjr, this isn't going to be fixed for 70.

[status-firefox69](/buglist.cgi?f1=cf_status_firefox69&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox69&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox69&o1=equals&v1=wontfix)
[status-firefox70](/buglist.cgi?f1=cf_status_firefox70&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox70&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox70&o1=equals&v1=wontfix)
[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=%3F) → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=wontfix)
[tracking-firefox70](/buglist.cgi?f1=cf_tracking_firefox70&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox70&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox70&o1=equals&v1=-)

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a14946925_451704)• 5 years ago |

[status-firefox71](/buglist.cgi?f1=cf_status_firefox71&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox71&o1=equals&v1=affected)

|  | [Andrew Overholt [:overholt]](/user_profile?user_id=442218) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1538028#c17)• 5 years ago |
|  | |

Is the work outlined in <https://bugzilla.mozilla.org/show_bug.cgi?id=1538072#c25> going to be finished soon? If not, is it possible to have some sort of bandaid fix here in the meantime?

Flags: needinfo?(tom)Flags: needinfo?(nika)

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1538028#c18)• 5 years ago |
|  | |

:mwoodrow is working on trying to get more loads initiated by the parent process and going through the DocumentChannel code path, but that's still behind a pref right now (and also not used for file URI loads). Improvements to this code are a starting point for moving where trust is placed for starting navigations, which would allos for us to fix issues such as this one. More work would be required after DocumentChannel is complete to fix this issue as well, though.

I don't know of any easy band-aid fix here, due to how spread out the ways the parent process can ask content to navigate are, and some ugly edge cases. I worry that even DocumentChannel isn't enough to do all of the changes we need, and it may not be possible to block this until the fission session history changes are complete.

There are some easier cases where we could move the decision out of content. For example, we could theoretically check in [RemoteWebNavigation::LoadURI](https://searchfox.org/mozilla-central/rev/7ed8e2d3d1d7a1464ba42763a33fd2e60efcaedc/toolkit/components/remotebrowserutils/RemoteWebNavigation.jsm#93) if the URI is a `file://` URI, and trigger the process switch from the parent in that case.

Unfortunately, there are also some really tricky cases, such as session history. We don't currently have a trusted copy of session history in the parent process, and won't until fission changes are complete, so the content process could lie to us about having a file:// URI as the previous history entry, and "navigate back in history" to that document as a history load. HIstory loads are fundamentally triggered by content right now, so as long as we want to support going back from web to file URIs, we have to somewhat support content triggering file URI loads.

If we did manage to finish doing this, we'd need to add checks in [RedirectLoad](https://searchfox.org/mozilla-central/rev/7ed8e2d3d1d7a1464ba42763a33fd2e60efcaedc/browser/base/content/browser.js#1599-1638) and when creating a popup browser in [RecvCreateWindowInDifferentProcess](https://searchfox.org/mozilla-central/rev/7ed8e2d3d1d7a1464ba42763a33fd2e60efcaedc/dom/ipc/ContentParent.cpp#4980) that the remote type we're going to switch into isn't `file`. I think by the time we've finished all of the infrastructure work needed to do that, though, we have a good chance of having a better solution right around the corner using DocumentChannel loads and friends.

Flags: needinfo?(nika)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a15454929_578488)• 5 years ago |

Flags: needinfo?(tom)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1538028#c19)• 5 years ago |
|  | |

Currently blocked on [bug 1556493](/show_bug.cgi?id=1556493 "NEW - [meta] DocumentChannel"), fission milestone M5.

Assignee: tom → nobodyKeywords: [stalled](/buglist.cgi?keywords=stalled&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1538028#c20)• 5 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1538028&comment_id=14427368 "1 revision") |
|  | |

That's not what the "stalled" keyword means with respect to security bugs. We know what the problem is and we know what the next steps for fixing it are. "stalled" is when the bug investigation is going nowhere, almost always for crashes filed from stack traces that don't have testcases or other steps to reproduce. "stalled" is often the last step before a bug is resolved INCOMPLETE; that's not the case here.

Keywords: [stalled](/buglist.cgi?keywords=stalled&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a17999271_1689)• 5 years ago |

Depends on: [document-channel](/show_bug.cgi?id=1556493 "NEW - [meta] DocumentChannel")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a27545836_1689)• 5 years ago |

Flags: sec-bounty? → sec-bounty+

|  | [Neha Kochar [:neha]](/user_profile?user_id=627348) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a54235997_627348)• 4 years ago |

Depends on: [1647550](/show_bug.cgi?id=1647550 "NEW - [meta] Control Document loads entirely from the parent process")
No longer depends on: [document-channel](/show_bug.cgi?id=1556493 "NEW - [meta] DocumentChannel")

|  | [Jens Stutte [:jstutte]](/user_profile?user_id=646284) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1538028#c21)• 3 years ago |
|  | |

Hi Olli, I was just wondering if the currently set dependency on [bug 1647550](/show_bug.cgi?id=1647550 "NEW - [meta] Control Document loads entirely from the parent process") still reflects the state of play here. I assume that since nika's analysis from 2 years ago many things went ahead here?

Flags: needinfo?(bugs)

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1538028#c22)• 3 years ago |
|  | |

The current dependencies are still there, and we still have a lot of work left to do before we can fully move control over navigation out of the content process. :annyG has been doing some work on [bug 1647550](/show_bug.cgi?id=1647550 "NEW - [meta] Control Document loads entirely from the parent process"), which is definitely one of the big blockers, but there will be more work to do even after that (including shipping Fission & removing the non-SHIP codepath).

Flags: needinfo?(bugs)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a81552595_578488)• 3 years ago |

Keywords: [csectype-sandbox-escape](/buglist.cgi?keywords=csectype-sandbox-escape&resolution=---)

|  | [Hsin-Yi Tsai (she/her) [:hsinyi]](/user_profile?user_id=434964) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a86204436_434964)• 3 years ago |

Component: DOM: Content Processes → DOM: Navigation

|  | [Hsin-Yi Tsai (she/her) [:hsinyi]](/user_profile?user_id=434964) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1538028#c23)• 3 years ago |
|  | |

Currently in our roadmap planning process.

Assignee: nobody → htsai

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a92342780_75935)• 3 years ago |

[status-firefox71](/buglist.cgi?f1=cf_status_firefox71&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox71&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox71&o1=equals&v1=wontfix)
[status-firefox-esr68](/buglist.cgi?f1=cf_status_firefox_esr68&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=wontfix)

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1538028#c24)• 3 years ago |
|  | |

The severity field for this bug is set to normal. However, the bug is flagged with the `sec-high` keyword.

:hsinyi, could you consider increasing the severity of this security bug?

For more information, please visit [auto\_nag documentation](https://wiki.mozilla.org/Release_Management/autonag#severity_high_security.py).

Flags: needinfo?(htsai)

|  | [Hsin-Yi Tsai (she/her) [:hsinyi]](/user_profile?user_id=434964) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a95608872_434964)• 3 years ago |

Severity: normal → S2Flags: needinfo?(htsai)

|  | [Hsin-Yi Tsai (she/her) [:hsinyi]](/user_profile?user_id=434964) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1538028#c25)• 3 years ago |
|  | |

I'm copying offline discussion notes and paste over here.

:bholley and Nika talked about this, and Nika suggested that we could simply keep a hashtable of all the file URIs that were explicitly navigated to by the parent process, and block the navigation if the target isn’t in that list.

So the next step here would be to investigate whether this idea would be workable.

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1538028#c26)• 3 years ago |
|  | |

Peter, my strategy for this involves requiring requests that don't pass CanLoad checks for the URL loaded in the current content process for a BC to originate in the parent process, or a child that they do pass CanLoad checks for, and have the pending request cached in the parent while we wait for the DocumentChannel to ask us to redirect.

The current sticking point is session history navigations, which can originate in the child via session history APIs. I can check them against the parent process session history. The only issue is that I'm not sure how trustworthy that data is. Is there any way a compromised content process could get us to insert an entry in the parent process session history that shouldn't be there, and navigate us there to bypass the extra CanLoad checks?

Flags: needinfo?(peterv)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1538028#c27)• 3 years ago |
|  | |

history.pushState may be able to do odd things.

<https://searchfox.org/mozilla-central/rev/bf6f194694c9d1ae92847f3d4e4c15c2486f3200/docshell/base/nsDocShell.cpp#11193> ->

<https://searchfox.org/mozilla-central/rev/bf6f194694c9d1ae92847f3d4e4c15c2486f3200/docshell/base/nsDocShell.cpp#11940> ->

<https://searchfox.org/mozilla-central/rev/bf6f194694c9d1ae92847f3d4e4c15c2486f3200/docshell/base/BrowsingContext.cpp#3576> ->

<https://searchfox.org/mozilla-central/rev/bf6f194694c9d1ae92847f3d4e4c15c2486f3200/dom/ipc/ContentParent.cpp#7543> ->

<https://searchfox.org/mozilla-central/rev/bf6f194694c9d1ae92847f3d4e4c15c2486f3200/docshell/base/CanonicalBrowsingContext.cpp#1030,1044,1053-1056>

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1538028#c28)• 3 years ago |
|  | |

(In reply to Olli Pettay [:smaug] from [comment #27](/show_bug.cgi?id=1538028#c27 "RESOLVED FIXED - Privilege escalation from web to file process"))

> history.pushState may be able to do odd things.

I think I can deal with that part fairly easily.

|  | [Peter Van der Beken [:peterv]](/user_profile?user_id=24295) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1538028#c29)• 3 years ago |
|  | |

So as Olly said, the pushState code is a path were we insert the data coming from the child into session history. I think anchor navigation is another.

Looking at the other ways to insert entries, for those the data should be coming from the parent in the first place, so those should be ok. We could tighten up same document navigations, seems like something we should be doing anyway.

Flags: needinfo?(peterv)

|  | [Hsin-Yi Tsai (she/her) [:hsinyi]](/user_profile?user_id=434964) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a104332462_434964)• 3 years ago |

Assignee: htsai → kmaglione+bmo

|  | [Gian-Carlo Pascutto [:gcp]](/user_profile?user_id=151147) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a113411857_151147)• 2 years ago |

Assignee: kmaglione+bmo → nika

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a114295502_534482)• 2 years ago |

Depends on: [1798986](/show_bug.cgi?id=1798986 "RESOLVED FIXED - UnstrippedURI should be tracked in SessionHistory")

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1538028#c30)• 2 years ago |
|  | |

Attached file
[Bug 1538028 - Part 1: Validate SHIP history loads in DocumentLoadListener, r=smaug!](attachment.cgi?id=9301853)
— [Details](attachment.cgi?id=9301853&action=edit)

With SHIP, we have a copy of the actual SessionHistoryEntry which is

responsible for a history load locally within the parent process. Using this,

we can validate any session history loads coming from the content process to

ensure that they correspond to actual outstanding history loads.

We can't do this for non-SHIP loads, as session history exists only within the

content process.

Depends on D161196

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1538028#c31)• 2 years ago |
|  | |

Attached file
[Bug 1538028 - Part 2: Track TriggeringRemoteType through nsDocShellLoadState and LoadInfo, r=smaug!,#necko-reviewers!,ckerschb!](attachment.cgi?id=9301854)
— [Details](attachment.cgi?id=9301854&action=edit)

This is done using slightly different mechanisms for each of LoadInfo and

nsDocShellLoadState, and will be used in the next part to validate document

loads based on the RemoteType responsible for the load.

For subresource loads, the TriggeringRemoteType is fairly straightforward - it

is the process which created the channel. We can handle this by getting the

current remote type when creating the channel, and then using the remote type

of the sending process when receiving the LoadInfo over IPC to either replace

the triggering remote type, or validate it.

For document loads, the situation is a bit more complex, as there are at least

3 (potentially-)different processes responsible for different parts of the

navigation:

1. The "Triggering Process" is the process which provided the URI to load.

   This is also the process which provides the Triggering Principal. This is

   the process being tracked in this patch.
2. The "Loading Process" is the process which actually creates the channel and

   starts the load. This may be the same as the triggering process, or may be

   a different process starting the navigation on behalf of the triggering

   process. In general this is the process hosting the current docshell,

   though it may be the parent process in the case of parent-initiated loads.
3. The "Final Process" is the process which receives the response and renders

   the final document. This isn't known at channel creation time, and is

   determined by the result principal and process isolation policy.

This change uses a serializer and special field on nsDocShellLoadState to track

the "Triggering Process" for the load, even as the load state is serialized

between processes by tracking which loads were sent into which content

processes, and matching them up when the parent process sees them again. The

information is then copied into the LoadInfo before configuring the real

channel, so it can be used for security checks.

The "Triggering Process" is overridden to be the parent process for history

loads, as history loads are often started in processes which wouldn't normally

be able to navigate to those pages. This is OK thanks to the changes in part 1

which validate history loads against the real session history when SHIP is

enabled.

Depends on D161197

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)  Assignee |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1538028#c32)• 2 years ago |
|  | |

Attached file
[Bug 1538028 - Part 3: Validate loads by TriggeringRemoteType, r=smaug!,ckerschb!](attachment.cgi?id=9301855)
— [Details](attachment.cgi?id=9301855&action=edit)

The previous part introduced a new mechanism to track the triggering remote

type for a specific load in a reliable way. This adds some basic checks based

on the triggering remote type to the nsContentSecurityManager, while also

providing the potential infrastructure to expand these checks in the future.

As these checks are performed before some other content security checks (to

ensure that they are performed before InitialSecurityCheckDone() is checked),

they may reject a load which would otherwise have been rejected by a later

check. For this reason, the diagnostic assertions added in this part are only

fired if the check appears as though it would otherwise have succeeded. This

check is not fully accurate, however, so may miss some cases.

This is important, as we have some tests, such as service worker navigation

tests, which will try to load file:/// URIs in content processes, and only fail

in the later content security checks.

For now, no checks are performed for non-document loads, though that may change

in the future.

Depends on D161198

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a114712210_534482)• 2 years ago |

Blocks: [1799692](/show_bug.cgi?id=1799692 "RESOLVED FIXED - Track TriggeringRemoteType for worker-triggered navigations")

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)  Assignee |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1538028#c33)• 2 years ago |
|  | |

There's some more work which needs to be done here to make this better beyond the patches which I've already posted, but it will build upon that foundation, so will be added as additional parts.

1. When Fission is disabled, we may start a load using `CreateWindowInDifferentProcess` (which is the original path which was fixed in [bug 1538072](/show_bug.cgi?id=1538072 "NEW")). This code path already has a monkey-patch fix from that bug (<https://searchfox.org/mozilla-central/rev/0b1543e85d13c30a13c57e959ce9815a3f0fa1d3/dom/ipc/ContentParent.cpp#5736-5759>), but ideally it'd also set the triggering remote type like we do here. That being said, the only use of this is with fission disabled, which is only the case on Android, so we can perhaps get away with removing the `CreateWindowInDifferentProcess` codepath completely instead. Other codepaths will start the load in the triggering content process, so shouldn't be impacted. Even if we don't want to remove it, as Android uses it, we could make sure that it can't be called when `UseRemoteSubframes` is enabled.
2. We need to validate loads using the context menu (e.g. from "Open link in new tab"). The easiest way to do this is probably to validate that the principals being used as the triggering principal in [`nsContextMenu.js`](https://searchfox.org/mozilla-central/rev/0b1543e85d13c30a13c57e959ce9815a3f0fa1d3/browser/base/content/nsContextMenu.js#21-22,39) (triggered by [`ContextMenuParent.sys.mjs`](https://searchfox.org/mozilla-central/rev/0b1543e85d13c30a13c57e959ce9815a3f0fa1d3/browser/actors/ContextMenuParent.sys.mjs#20)) are actually from the content process by instead pulling them from `this.manager.documentPrincipal`, rather than trusting the values sent over IPC. Ideally we'd also set the triggering remote type in that situation, but once we block loading system principals in content processes, we should be able to stop the load at the principal level.

   In general, I think it should be possible to get a lot of the fields which are currently being pulled from the content process for `nsContextMenu` from the parent process actor, so perhaps that's another small project to work on at some point.
3. We need to validate loads which are triggered by the content click handler ([`ClickHandlerChild.sys.mjs`](https://searchfox.org/mozilla-central/rev/0b1543e85d13c30a13c57e959ce9815a3f0fa1d3/browser/actors/ClickHandlerChild.sys.mjs#186)). These should have the source process set as the triggering process, and should also pull principals from the parent process, rather than [the content process](https://searchfox.org/mozilla-central/rev/0b1543e85d13c30a13c57e959ce9815a3f0fa1d3/browser/actors/ClickHandlerChild.sys.mjs#165-167), as with `nsContextMenu.js`.

   Much like with `nsContextMenu.js` the bulk of this can probably be done by pulling the information from trusted sources rather than from a content process IPC message, but it'd still be good to set the triggering remote type.
4. Also in `ClickHandlerChild` we have the middle-click paste navigation handler, which if enabled will paste from the clipboard and try to navigate to that URL when middle-clicking on a page. This is another potential issue, as content processes can write to the clipboard (as can arbitrary websites), meaning that they could start any navigation with it. Fortunately, it's been disabled by default on all platforms since [bug 366945](/show_bug.cgi?id=366945 "VERIFIED FIXED - middle-clicking on a page starts a load based on clipboard contents (on unix-like hosts)"), so with a couple of extra checks for the `middlemouse.contentLoadURL` pref, we should be able to avoid it being an issue for most users. I'd prefer to avoid removing the about:config pref in this bug, as I imagine it'll upset some users, based on the comments in that bug.
5. It is possible to navigate and open a content window using the service worker Client APIs. I've filed [bug 1799692](/show_bug.cgi?id=1799692 "RESOLVED FIXED - Track TriggeringRemoteType for worker-triggered navigations") for that issue.

I also looked at drag & drop, as I know dropping a link into a content area can cause a navigation, and we handle the drop event within content, but it looks like we already validate it against the parent process copy of the drag, and downgrade the principal if it was modified by content (<https://searchfox.org/mozilla-central/rev/0b1543e85d13c30a13c57e959ce9815a3f0fa1d3/dom/ipc/BrowserParent.cpp#844-858>), so we should be OK there.

Those are all of the cases which should be impacted off the top of my head, but I may have missed some which we'll need to fix as we find them. I am optimistic that this will block the vast majority of cases, and at the very least it offers us a framework for fixing other cases as well.

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1538028#c34)• 2 years ago |
|  | |

Looks like the `contentLoadURL` pref is already checked when instantiating the actor, so is handled: <https://searchfox.org/mozilla-central/rev/0b1543e85d13c30a13c57e959ce9815a3f0fa1d3/browser/components/BrowserGlue.jsm#452>

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)  Assignee |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1538028#c35)• 2 years ago |
|  | |

Attached file
[Bug 1538028 - Part 4: Pass TriggeringRemoteType through the frontend, r=gijs!](attachment.cgi?id=9302939)
— [Details](attachment.cgi?id=9302939&action=edit)

Propagate the ability to pass triggeringRemoteType through the desktop frontend

in various places, such that it is set when using the context menu or content

click handler.

Depends on D161199

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)  Assignee |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1538028#c36)• 2 years ago |
|  | |

I've put up patches in [bug 1799692](/show_bug.cgi?id=1799692 "RESOLVED FIXED - Track TriggeringRemoteType for worker-triggered navigations") as well, so I'm hoping to potentially land the patches in this bug and that bug at the same time right now, unless issues come up.

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)  Assignee |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1538028#c37)• 2 years ago |
|  | |

Comment on [attachment 9302939](/attachment.cgi?id=9302939 "Bug 1538028 - Part 4: Pass TriggeringRemoteType through the frontend, r=gijs!") [[details]](/attachment.cgi?id=9302939&action=edit "Bug 1538028 - Part 4: Pass TriggeringRemoteType through the frontend, r=gijs!")

[Bug 1538028](/show_bug.cgi?id=1538028 "RESOLVED FIXED - Privilege escalation from web to file process") - Part 4: Pass TriggeringRemoteType through the frontend, r=gijs!

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: This patch is only for a sandbox escape. A sufficiently knowledgeable person could probably figure out how to trigger it if they already had control of a content process, but it would require effort.

The patch doesn't super-paint a bullseye on the problem, but it probably wouldn't be too hard to figure out what it would be fixing.

* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: No
* **Which older supported branches are affected by this flaw?**: all
* **If not all supported branches, which bug introduced the flaw?**: None
* **Do you have backports for the affected branches?**: No
* **If not, how different, hard to create, and risky will they be?**: They will be somewhat difficult to implement. THis patch builds on top of other changes such as [bug 1798986](/show_bug.cgi?id=1798986 "RESOLVED FIXED - UnstrippedURI should be tracked in SessionHistory"), which in turn depends on [bug 1800545](/show_bug.cgi?id=1800545 "RESOLVED FIXED - test_ext_proxy_config.js attempts non-local connections") to avoid test failures. We could potentially uplift this to beta with a lot of effort.

I also currently plan to land this at the same time as [bug 1799692](/show_bug.cgi?id=1799692 "RESOLVED FIXED - Track TriggeringRemoteType for worker-triggered navigations"), as it is required to plug all of the holes I know of which could allow this kind of privilege escalation.

* **How likely is this patch to cause regressions; how much testing does it need?**: This patch is fairly large, but I tried to keep it self-contained to keep regressions down. That being said, I had to take many tries to get all tests (hopefully) green, as this part of our codebase is somewhat fragile.

There is a risk that there is some codepath which we are not aware of which will try to start a file URI load from a content process which will break after this patch. We probably won't be able to find it until the patches land, and we get bug reports from users.

I'm marking android as not impacted, as I don't believe it distinguishes and gives `"file"` content processes a different privilege level, so it is largely unimpacted, though there may still be some impact due to gecko-only permission checks.

* **Is Android affected?**: No
[Attachment #9302939](/attachment.cgi?id=9302939&action=edit "Bug 1538028 - Part 4: Pass TriggeringRemoteType through the frontend, r=gijs!") -
Flags: sec-approval?

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a116206244_534482)• 2 years ago |

[Attachment #9301853](/attachment.cgi?id=9301853&action=edit "Bug 1538028 - Part 1: Validate SHIP history loads in DocumentLoadListener, r=smaug!") -
Flags: sec-approval?
[Attachment #9301854](/attachment.cgi?id=9301854&action=edit "Bug 1538028 - Part 2: Track TriggeringRemoteType through nsDocShellLoadState and LoadInfo, r=smaug!,#necko-reviewers!,ckerschb!") -
Flags: sec-approval?
[Attachment #9301855](/attachment.cgi?id=9301855&action=edit "Bug 1538028 - Part 3: Validate loads by TriggeringRemoteType, r=smaug!,ckerschb!") -
Flags: sec-approval?

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1538028#c38)• 2 years ago |
|  | |

Comment on [attachment 9302939](/attachment.cgi?id=9302939 "Bug 1538028 - Part 4: Pass TriggeringRemoteType through the frontend, r=gijs!") [[details]](/attachment.cgi?id=9302939&action=edit "Bug 1538028 - Part 4: Pass TriggeringRemoteType through the frontend, r=gijs!")

[Bug 1538028](/show_bug.cgi?id=1538028 "RESOLVED FIXED - Privilege escalation from web to file process") - Part 4: Pass TriggeringRemoteType through the frontend, r=gijs!

We discussed this and given the complexity of creating uplifts, and the impact of the vulnerability (it allows an attacker to *read* an arbitrary file on the filesystem, but not write one or plant malware), we are okay with letting it ride the trains out and not uplifting it to Beta or ESR.

[Attachment #9302939](/attachment.cgi?id=9302939&action=edit "Bug 1538028 - Part 4: Pass TriggeringRemoteType through the frontend, r=gijs!") -
Flags: sec-approval? → sec-approval+

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a116453862_578488)• 2 years ago |

[Attachment #9301855](/attachment.cgi?id=9301855&action=edit "Bug 1538028 - Part 3: Validate loads by TriggeringRemoteType, r=smaug!,ckerschb!") -
Flags: sec-approval? → sec-approval+

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a116453864_578488)• 2 years ago |

[Attachment #9301854](/attachment.cgi?id=9301854&action=edit "Bug 1538028 - Part 2: Track TriggeringRemoteType through nsDocShellLoadState and LoadInfo, r=smaug!,#necko-reviewers!,ckerschb!") -
Flags: sec-approval? → sec-approval+

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a116453866_578488)• 2 years ago |

[Attachment #9301853](/attachment.cgi?id=9301853&action=edit "Bug 1538028 - Part 1: Validate SHIP history loads in DocumentLoadListener, r=smaug!") -
Flags: sec-approval? → sec-approval+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a116455955_75935)• 2 years ago |

[status-firefox107](/buglist.cgi?f1=cf_status_firefox107&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox107&o1=equals&v1=wontfix)
[status-firefox108](/buglist.cgi?f1=cf_status_firefox108&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox108&o1=equals&v1=wontfix)
[status-firefox109](/buglist.cgi?f1=cf_status_firefox109&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox109&o1=equals&v1=affected)
[status-firefox-esr102](/buglist.cgi?f1=cf_status_firefox_esr102&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=wontfix)
[tracking-firefox109](/buglist.cgi?f1=cf_tracking_firefox109&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox109&o1=equals&v1=%2B)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1538028#c39)• 2 years ago |
|  | |

Part 1: Validate SHIP history loads in DocumentLoadListener, r=smaug,necko-reviewers,valentin

<https://hg.mozilla.org/integration/autoland/rev/56f54a41965a7f1f0d4a99c8346c5cabfb0bf99d>

<https://hg.mozilla.org/mozilla-central/rev/56f54a41965a>

Part 2: Track TriggeringRemoteType through nsDocShellLoadState and LoadInfo, r=smaug,ckerschb,necko-reviewers,valentin

<https://hg.mozilla.org/integration/autoland/rev/ce306d50bc521dfb2eb0de5cca4de4efa7706823>

<https://hg.mozilla.org/mozilla-central/rev/ce306d50bc52>

Part 3: Validate loads by TriggeringRemoteType, r=smaug,ckerschb

<https://hg.mozilla.org/integration/autoland/rev/ed6d2cdfa32f509cac8d8e5cb0b780cabbd3b611>

<https://hg.mozilla.org/mozilla-central/rev/ed6d2cdfa32f>

Part 4: Pass TriggeringRemoteType through the frontend, r=Gijs,emilio

<https://hg.mozilla.org/integration/autoland/rev/99eeb925a1ab48725345223eda657430d623078b>

<https://hg.mozilla.org/mozilla-central/rev/99eeb925a1ab>

Status: NEW → RESOLVEDClosed: 2 years ago
[status-firefox109](/buglist.cgi?f1=cf_status_firefox109&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox109&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox109&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 109 Branch

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a117460411_1689)• 2 years ago |

Group: dom-core-security → core-security-release

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a117995278_553429)• 2 years ago |

Flags: qe-verify-Whiteboard: [reporter-external] [client-bounty-form] [verif?] → [reporter-external] [client-bounty-form] [verif?][post-critsmash-triage]

|  | [June Wilde (she/her) [:jewilde]](/user_profile?user_id=626341) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a120398560_626341)• 2 years ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?][post-critsmash-triage] → [reporter-external] [client-bounty-form] [verif?][post-critsmash-triage][adv-main109+]

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1538028#c40)• 2 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9312389)
— [Details](attachment.cgi?id=9312389&action=edit)

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a120657351_428608)• 2 years ago |

Alias: CVE-2023-23597

|  | [Makoto Kato [:m\_kato]](/user_profile?user_id=8636) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a128240232_8636)• 2 years ago |

Regressed by: [1812356](/show_bug.cgi?id=1812356 "RESOLVED FIXED - Crash when loading any resource://android/assets/page.html")

|  | [Tom Schuster](/user_profile?user_id=703078) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a128250716_703078)• 2 years ago |

No longer regressed by: [1812356](/show_bug.cgi?id=1812356 "RESOLVED FIXED - Crash when loading any resource://android/assets/page.html")Regressions: [1812356](/show_bug.cgi?id=1812356 "RESOLVED FIXED - Crash when loading any resource://android/assets/page.html")

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a133639658_448747)• 2 years ago |

Regressions: [1838686](/show_bug.cgi?id=1838686 "RESOLVED INCOMPLETE - Crash in [@ CheckAllowLoadByTriggeringRemoteType]")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a136417113_1689)• 1 years ago |

Group: core-security-release

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538028#a163879333_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1538028&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_a227e78f_20250114_221740.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2023-01

## Security Vulnerabilities fixed in Firefox 109

Announced
January 17, 2023
Impact
high
Products
Firefox
Fixed in

* Firefox 109

#### [#CVE-2023-23597: Logic bug in process allocation allowed to read arbitrary files](#CVE-2023-23597)

Reporter
Niklas Baumstark
Impact
high
##### Description

A compromised web child process could disable web security opening restrictions, leading to a new child process being spawned within the `file://` context. Given a reliable exploit primitive, this new process could be exploited again leading to arbitrary file read.

##### References

* [Bug 1538028](https://bugzilla.mozilla.org/show_bug.cgi?id=1538028)

#### [#CVE-2023-23598: Arbitrary file read from GTK drag and drop on Linux](#CVE-2023-23598)

Reporter
Tom Schuster
Impact
high
##### Description

Due to the Firefox GTK wrapper code's use of text/plain for drag data and GTK treating all text/plain MIMEs containing file URLs as being dragged a website could arbitrarily read a file via a call to `DataTransfer.setData`.

##### References

* [Bug 1800425](https://bugzilla.mozilla.org/show_bug.cgi?id=1800425)

#### [#CVE-2023-23599: Malicious command could be hidden in devtools output on Windows](#CVE-2023-23599)

Reporter
Vadim
Impact
moderate
##### Description

When copying a network request from the developer tools panel as a curl command the output was not being properly sanitized and could allow arbitrary commands to be hidden within.

##### References

* [Bug 1777800](https://bugzilla.mozilla.org/show_bug.cgi?id=1777800)

#### [#CVE-2023-23600: Notification permissions persisted between Normal and Private Browsing on Android](#CVE-2023-23600)

Reporter
Kazuki Nomoto of Waseda University
Impact
moderate
##### Description

Per origin notification permissions were being stored in a way that didn't take into account what browsing context the permission was granted in. This lead to the possibility of notifications to be displayed during different browsing sessions.
*This bug only affects Firefox for Android. Other operating systems are unaffected.*

##### References

* [Bug 1787034](https://bugzilla.mozilla.org/show_bug.cgi?id=1787034)

#### [#CVE-2023-23601: URL being dragged from cross-origin iframe into same tab triggers navigation](#CVE-2023-23601)

Reporter
Luan Herrera
Impact
moderate
##### Description

Navigations were being allowed when dragging a URL from a cross-origin iframe into the same tab which could lead to website spoofing attacks

##### References

* [Bug 1794268](https://bugzilla.mozilla.org/show_bug.cgi?id=1794268)

#### [#CVE-2023-23602: Content Security Policy wasn't being correctly applied to WebSockets in WebWorkers](#CVE-2023-23602)

Reporter
Dave Vandyke
Impact
moderate
##### Description

A mishandled security check when creating a WebSocket in a WebWorker caused the Content Security Policy connect-src header to be ignored. This could lead to connections to restricted origins from inside WebWorkers.

##### References

* [Bug 1800890](https://bugzilla.mozilla.org/show_bug.cgi?id=1800890)

#### [#CVE-2023-23603: Calls to console.log allowed bypasing Content Security Policy via format directive](#CVE-2023-23603)

Reporter
Dan Veditz
Impact
low
##### Description

Regular expressions used to filter out forbidden properties and values from style directives in calls to `console.log` weren't accounting for external URLs. Data could then be potentially exfiltrated from the browser.

##### References

* [Bug 1800832](https://bugzilla.mozilla.org/show_bug.cgi?id=1800832)

#### [#CVE-2023-23604: Creation of duplicate SystemPrincipal from less secure contexts](#CVE-2023-23604)

Reporter
Nika Layzell
Impact
low
##### Description

A duplicate `SystemPrincipal` object could be created when parsing a non-system html document via `DOMParser::ParseFromSafeString`. This could have lead to bypassing web security checks.

##### References

* [Bug 1802346](https://bugzilla.mozilla.org/show_bug.cgi?id=1802346)

#### [#CVE-2023-23605: Memory safety bugs fixed in Firefox 109 and Firefox ESR 102.7](#CVE-2023-23605)

Reporter
Mozilla developers
Impact
high
##### Description

Mozilla developers and the Mozilla Fuzzing Team reported memory safety bugs present in Firefox 108 and Firefox ESR 102.6. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 109 and Firefox ESR 102.7](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1764921%2C1802690%2C1806974)

#### [#CVE-2023-23606: Memory safety bugs fixed in Firefox 109](#CVE-2023-23606)

Reporter
Mozilla developers
Impact
high
##### Description

Mozilla developers and the Mozilla Fuzzing Team reported memory safety bugs present in Firefox 108. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 109](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1764974%2C1798591%2C1799201%2C1800446%2C1801248%2C1802100%2C1803393%2C1804626%2C1804971%2C1807004)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)


