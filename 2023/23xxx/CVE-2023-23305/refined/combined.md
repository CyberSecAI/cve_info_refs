=== Content from github.com_8242936e_20250114_184945.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fanvilsecure%2Fgarmin-ciq-app-research%2Fblob%2Fmain%2Fadvisories%2FCVE-2023-23305.md)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fanvilsecure%2Fgarmin-ciq-app-research%2Fblob%2Fmain%2Fadvisories%2FCVE-2023-23305.md)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=anvilsecure%2Fgarmin-ciq-app-research)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[anvilsecure](/anvilsecure)
/
**[garmin-ciq-app-research](/anvilsecure/garmin-ciq-app-research)**
Public

* [Notifications](/login?return_to=%2Fanvilsecure%2Fgarmin-ciq-app-research) You must be signed in to change notification settings
* [Fork
  3](/login?return_to=%2Fanvilsecure%2Fgarmin-ciq-app-research)
* [Star
   55](/login?return_to=%2Fanvilsecure%2Fgarmin-ciq-app-research)

* [Code](/anvilsecure/garmin-ciq-app-research)
* [Issues
  0](/anvilsecure/garmin-ciq-app-research/issues)
* [Pull requests
  0](/anvilsecure/garmin-ciq-app-research/pulls)
* [Actions](/anvilsecure/garmin-ciq-app-research/actions)
* [Projects
  0](/anvilsecure/garmin-ciq-app-research/projects)
* [Security](/anvilsecure/garmin-ciq-app-research/security)
* [Insights](/anvilsecure/garmin-ciq-app-research/pulse)

Additional navigation options

* [Code](/anvilsecure/garmin-ciq-app-research)
* [Issues](/anvilsecure/garmin-ciq-app-research/issues)
* [Pull requests](/anvilsecure/garmin-ciq-app-research/pulls)
* [Actions](/anvilsecure/garmin-ciq-app-research/actions)
* [Projects](/anvilsecure/garmin-ciq-app-research/projects)
* [Security](/anvilsecure/garmin-ciq-app-research/security)
* [Insights](/anvilsecure/garmin-ciq-app-research/pulse)

## Files

 main
## Breadcrumbs

1. [garmin-ciq-app-research](/anvilsecure/garmin-ciq-app-research/tree/main)
2. /[advisories](/anvilsecure/garmin-ciq-app-research/tree/main/advisories)
/
# CVE-2023-23305.md

Copy path Blame  Blame
## Latest commit

## History

[History](/anvilsecure/garmin-ciq-app-research/commits/main/advisories/CVE-2023-23305.md)75 lines (64 loc) · 4.34 KB main
## Breadcrumbs

1. [garmin-ciq-app-research](/anvilsecure/garmin-ciq-app-research/tree/main)
2. /[advisories](/anvilsecure/garmin-ciq-app-research/tree/main/advisories)
/
# CVE-2023-23305.md

Top
## File metadata and controls

* Preview
* Code
* Blame

75 lines (64 loc) · 4.34 KB[Raw](https://github.com/anvilsecure/garmin-ciq-app-research/raw/refs/heads/main/advisories/CVE-2023-23305.md)
# Buffer Overflows in Font Resources

It is possible to embed fonts to a `PRG` file by specifying them in the `font.xml` resource file. The fonts can later be retrieved using `WatchUi.loadResource(Rez.Fonts.myFont);` in the application.

The firmware supports two types of font:

* A legacy non-unicode font format that is no longer generated when compiling a `PRG` application but still supported inside the firmware
* A unicode font format

During compilation, the original font files are stored alongside a custom header that defines several properties. For instance, for non-unicode font, the following header is prefixed to the font data:

| Index | Size in bytes | Name | Value |
| --- | --- | --- | --- |
| 0x00 | 4 | sentinel | `0x0000f23b` |
| 0x04 | 4 | height |  |
| 0x08 | 4 | glyph count |  |
| 0x0c | 4 | min |  |
| 0x10 | 2 | data size |  |
| 0x12 | 3 \* glyph count | glyph table buffer |  |
| n | 4 | glyph sentinel |  |
| n + 4 | 1 \* data size | extra data buffer |  |

When computing the buffers that will hold the font data, integer overflows can occur resulting in an allocated buffer being smaller than expected. When the font data is then copied, the firmware writes out of bounds.

```
e_tvm_error _tvm_app_load_resource(s_tvm_ctx *ctx,int fd,uint app_type,s_tvm_object *resource,s_tvm_object *out)
{
// [...]
      // Anvil: Read header from the font resource
      eVar1 = file_read_4bytes(fd,&font_height);
      psVar2 = (uint)eVar1;
      if (psVar2 != 0x0) goto LAB_047ac2c6;
      eVar1 = file_read_4bytes(fd,(uint *)&font_glyph_count);
// [...]
      if ((psVar2 != (s_tvm_ctx *)0x0) || (psVar2 = file_read_2bytes?(fd,&font_data_size), psVar2 != 0x0)) goto LAB_047ac2c6;
      // Anvil: Computing the size of the buffer to allocate.
	  // Anvil: This can overflow, resulting in the size being smaller than expected
      size_glyph_table_buffer = (font_data_size & 0xffff) + (int)font_glyph_count * 4 + 0x34;
	  // [...]
      // Anvil: Allocating the buffer, which could be smaller than expected
	  tvm_mem_alloc(ctx,size_glyph_table_buffer,0,&glyph_table);
	  // [...]
      // Anvil: Read `font_glyph_count` bytes from the font resource and copy them to the buffer. Since the buffer is smaller than expected, it writes out-of-bounds.
      for (i_glyph = (s_tvm_ctx *)psVar2; i_glyph < font_glyph_count; i_glyph = (s_tvm_ctx *)((int)&i_glyph->unknown-? + 1)) {
        if ((s_tvm_ctx *)psVar2 == (s_tvm_ctx *)0x0) {
          p_current_glyph = &p_glyph_table_data->glyphs_buffer + (int)i_glyph;
          while( true ) {
            // Anvil: Out-of-bound write
            psVar2 = file_read_2bytes(fd,p_current_glyph);
            if ((s_tvm_ctx *)psVar2 != (s_tvm_ctx *)0x0) break;
            iVar2 = file_read-?(fd,&sentinel,1);
            if (iVar2 != 1) {
              // [...]
            }
            // Anvil: Out-of-bound write
            *(undefined *)((int)p_current_glyph + 3) = sentinel._0_1_;
            i_glyph = (s_tvm_ctx *)((int)&i_glyph->unknown-? + 1);
            p_current_glyph = p_current_glyph + 1;
            if (font_glyph_count <= i_glyph) goto LAB_047ac98a;
          }
        }
      }
	  // [...]
}
```

The same vulnerable pattern can be seen for unicode fonts. Although the header is different, the firmware computes the size of the buffer to allocate based on the values specified in the header, which can overflow and result in an allocated buffer smaller than expected.

It is possible to trigger the crash by compiling a `PRG` application and editing its font resource to change the header values with:

* Glyph count: `0x4000001A`
* Font data size: `0x108`

The computed buffer size will be: `(0x108 & 0xffff) + 0x4000001A * 4 + 0x34 = 0x1000001a4`. Since the registers can only hold 32-bit values, it gets truncated to `0x1000001a4 & 0xffffffff = 0x1a4`. The firmware will then attempt to copy `0x4000001A` glyphs to a buffer of `0x1a4` bytes.

The following proof-of-concept triggers the vulnerability: <https://github.com/anvilsecure/garmin-ciq-app-research/blob/main/poc/GRMN-06.prg>

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_8e4d9f78_20250115_113220.html ===
# Buffer Overflows in Font Resources
It is possible to embed fonts to a `PRG` file by specifying them in the `font.xml` resource file. The fonts can later be retrieved using `WatchUi.loadResource(Rez.Fonts.myFont);` in the application.
The firmware supports two types of font:
- A legacy non-unicode font format that is no longer generated when compiling a `PRG` application but still supported inside the firmware
- A unicode font format
During compilation, the original font files are stored alongside a custom header that defines several properties. For instance, for non-unicode font, the following header is prefixed to the font data:
| Index | Size in bytes | Name | Value |
|:-----:|:---------------:|:------------------:|:------------:|
| 0x00 | 4 | sentinel | `0x0000f23b` |
| 0x04 | 4 | height | |
| 0x08 | 4 | glyph count | |
| 0x0c | 4 | min | |
| 0x10 | 2 | data size | |
| 0x12 | 3 \* glyph count | glyph table buffer | |
| n | 4 | glyph sentinel | |
| n + 4 | 1 \* data size | extra data buffer | |
When computing the buffers that will hold the font data, integer overflows can occur resulting in an allocated buffer being smaller than expected. When the font data is then copied, the firmware writes out of bounds.
```c
e\_tvm\_error \_tvm\_app\_load\_resource(s\_tvm\_ctx \*ctx,int fd,uint app\_type,s\_tvm\_object \*resource,s\_tvm\_object \*out)
{
// [...]
// Anvil: Read header from the font resource
eVar1 = file\_read\_4bytes(fd,&font\_height);
psVar2 = (uint)eVar1;
if (psVar2 != 0x0) goto LAB\_047ac2c6;
eVar1 = file\_read\_4bytes(fd,(uint \*)&font\_glyph\_count);
// [...]
if ((psVar2 != (s\_tvm\_ctx \*)0x0) || (psVar2 = file\_read\_2bytes?(fd,&font\_data\_size), psVar2 != 0x0)) goto LAB\_047ac2c6;
// Anvil: Computing the size of the buffer to allocate.
// Anvil: This can overflow, resulting in the size being smaller than expected
size\_glyph\_table\_buffer = (font\_data\_size & 0xffff) + (int)font\_glyph\_count \* 4 + 0x34;
// [...]
// Anvil: Allocating the buffer, which could be smaller than expected
tvm\_mem\_alloc(ctx,size\_glyph\_table\_buffer,0,&glyph\_table);
// [...]
// Anvil: Read `font\_glyph\_count` bytes from the font resource and copy them to the buffer. Since the buffer is smaller than expected, it writes out-of-bounds.
for (i\_glyph = (s\_tvm\_ctx \*)psVar2; i\_glyph < font\_glyph\_count; i\_glyph = (s\_tvm\_ctx \*)((int)&i\_glyph->unknown-? + 1)) {
if ((s\_tvm\_ctx \*)psVar2 == (s\_tvm\_ctx \*)0x0) {
p\_current\_glyph = &p\_glyph\_table\_data->glyphs\_buffer + (int)i\_glyph;
while( true ) {
// Anvil: Out-of-bound write
psVar2 = file\_read\_2bytes(fd,p\_current\_glyph);
if ((s\_tvm\_ctx \*)psVar2 != (s\_tvm\_ctx \*)0x0) break;
iVar2 = file\_read-?(fd,&sentinel,1);
if (iVar2 != 1) {
// [...]
}
// Anvil: Out-of-bound write
\*(undefined \*)((int)p\_current\_glyph + 3) = sentinel.\_0\_1\_;
i\_glyph = (s\_tvm\_ctx \*)((int)&i\_glyph->unknown-? + 1);
p\_current\_glyph = p\_current\_glyph + 1;
if (font\_glyph\_count <= i\_glyph) goto LAB\_047ac98a;
}
}
}
// [...]
}
```
The same vulnerable pattern can be seen for unicode fonts. Although the header is different, the firmware computes the size of the buffer to allocate based on the values specified in the header, which can overflow and result in an allocated buffer smaller than expected.
It is possible to trigger the crash by compiling a `PRG` application and editing its font resource to change the header values with:
- Glyph count: `0x4000001A`
- Font data size: `0x108`
The computed buffer size will be: `(0x108 & 0xffff) + 0x4000001A \* 4 + 0x34 = 0x1000001a4`. Since the registers can only hold 32-bit values, it gets truncated to `0x1000001a4 & 0xffffffff = 0x1a4`. The firmware will then attempt to copy `0x4000001A` glyphs to a buffer of `0x1a4` bytes.
The following proof-of-concept triggers the vulnerability:
