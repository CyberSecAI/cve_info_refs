=== Content from github.com_d5434773_20250114_231019.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMisterTea%2FEternalTerminal)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMisterTea%2FEternalTerminal)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=MisterTea%2FEternalTerminal)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[MisterTea](/MisterTea)
/
**[EternalTerminal](/MisterTea/EternalTerminal)**
Public

* [Notifications](/login?return_to=%2FMisterTea%2FEternalTerminal) You must be signed in to change notification settings
* [Fork
  174](/login?return_to=%2FMisterTea%2FEternalTerminal)
* [Star
   3.1k](/login?return_to=%2FMisterTea%2FEternalTerminal)

Re-Connectable secure remote shell

[mistertea.github.io/EternalTerminal/](https://mistertea.github.io/EternalTerminal/ "https://mistertea.github.io/EternalTerminal/")

### License

[Apache-2.0 license](/MisterTea/EternalTerminal/blob/master/LICENSE)

[3.1k
stars](/MisterTea/EternalTerminal/stargazers) [174
forks](/MisterTea/EternalTerminal/forks) [Branches](/MisterTea/EternalTerminal/branches) [Tags](/MisterTea/EternalTerminal/tags) [Activity](/MisterTea/EternalTerminal/activity)
 [Star](/login?return_to=%2FMisterTea%2FEternalTerminal)

 [Notifications](/login?return_to=%2FMisterTea%2FEternalTerminal) You must be signed in to change notification settings

* [Code](/MisterTea/EternalTerminal)
* [Issues
  83](/MisterTea/EternalTerminal/issues)
* [Pull requests
  0](/MisterTea/EternalTerminal/pulls)
* [Actions](/MisterTea/EternalTerminal/actions)
* [Projects
  0](/MisterTea/EternalTerminal/projects)
* [Security](/MisterTea/EternalTerminal/security)
* [Insights](/MisterTea/EternalTerminal/pulse)

Additional navigation options

* [Code](/MisterTea/EternalTerminal)
* [Issues](/MisterTea/EternalTerminal/issues)
* [Pull requests](/MisterTea/EternalTerminal/pulls)
* [Actions](/MisterTea/EternalTerminal/actions)
* [Projects](/MisterTea/EternalTerminal/projects)
* [Security](/MisterTea/EternalTerminal/security)
* [Insights](/MisterTea/EternalTerminal/pulse)

# MisterTea/EternalTerminal

    master[Branches](/MisterTea/EternalTerminal/branches)[Tags](/MisterTea/EternalTerminal/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[1,009 Commits](/MisterTea/EternalTerminal/commits/master/) | | |
| [.circleci](/MisterTea/EternalTerminal/tree/master/.circleci ".circleci") | | [.circleci](/MisterTea/EternalTerminal/tree/master/.circleci ".circleci") |  |  |
| [.devcontainer](/MisterTea/EternalTerminal/tree/master/.devcontainer ".devcontainer") | | [.devcontainer](/MisterTea/EternalTerminal/tree/master/.devcontainer ".devcontainer") |  |  |
| [.github](/MisterTea/EternalTerminal/tree/master/.github ".github") | | [.github](/MisterTea/EternalTerminal/tree/master/.github ".github") |  |  |
| [cmake](/MisterTea/EternalTerminal/tree/master/cmake "cmake") | | [cmake](/MisterTea/EternalTerminal/tree/master/cmake "cmake") |  |  |
| [debian](/MisterTea/EternalTerminal/tree/master/debian "debian") | | [debian](/MisterTea/EternalTerminal/tree/master/debian "debian") |  |  |
| [docker](/MisterTea/EternalTerminal/tree/master/docker "docker") | | [docker](/MisterTea/EternalTerminal/tree/master/docker "docker") |  |  |
| [docs](/MisterTea/EternalTerminal/tree/master/docs "docs") | | [docs](/MisterTea/EternalTerminal/tree/master/docs "docs") |  |  |
| [etc](/MisterTea/EternalTerminal/tree/master/etc "etc") | | [etc](/MisterTea/EternalTerminal/tree/master/etc "etc") |  |  |
| [external](/MisterTea/EternalTerminal/tree/master/external "external") | | [external](/MisterTea/EternalTerminal/tree/master/external "external") |  |  |
| [init/launchd](/MisterTea/EternalTerminal/tree/master/init/launchd "This path skips through empty directories") | | [init/launchd](/MisterTea/EternalTerminal/tree/master/init/launchd "This path skips through empty directories") |  |  |
| [patches](/MisterTea/EternalTerminal/tree/master/patches "patches") | | [patches](/MisterTea/EternalTerminal/tree/master/patches "patches") |  |  |
| [proto](/MisterTea/EternalTerminal/tree/master/proto "proto") | | [proto](/MisterTea/EternalTerminal/tree/master/proto "proto") |  |  |
| [rc.d](/MisterTea/EternalTerminal/tree/master/rc.d "rc.d") | | [rc.d](/MisterTea/EternalTerminal/tree/master/rc.d "rc.d") |  |  |
| [scripts](/MisterTea/EternalTerminal/tree/master/scripts "scripts") | | [scripts](/MisterTea/EternalTerminal/tree/master/scripts "scripts") |  |  |
| [src](/MisterTea/EternalTerminal/tree/master/src "src") | | [src](/MisterTea/EternalTerminal/tree/master/src "src") |  |  |
| [systemctl](/MisterTea/EternalTerminal/tree/master/systemctl "systemctl") | | [systemctl](/MisterTea/EternalTerminal/tree/master/systemctl "systemctl") |  |  |
| [test](/MisterTea/EternalTerminal/tree/master/test "test") | | [test](/MisterTea/EternalTerminal/tree/master/test "test") |  |  |
| [.clang-format](/MisterTea/EternalTerminal/blob/master/.clang-format ".clang-format") | | [.clang-format](/MisterTea/EternalTerminal/blob/master/.clang-format ".clang-format") |  |  |
| [.codespellrc](/MisterTea/EternalTerminal/blob/master/.codespellrc ".codespellrc") | | [.codespellrc](/MisterTea/EternalTerminal/blob/master/.codespellrc ".codespellrc") |  |  |
| [.gitignore](/MisterTea/EternalTerminal/blob/master/.gitignore ".gitignore") | | [.gitignore](/MisterTea/EternalTerminal/blob/master/.gitignore ".gitignore") |  |  |
| [.gitmodules](/MisterTea/EternalTerminal/blob/master/.gitmodules ".gitmodules") | | [.gitmodules](/MisterTea/EternalTerminal/blob/master/.gitmodules ".gitmodules") |  |  |
| [CMakeLists.txt](/MisterTea/EternalTerminal/blob/master/CMakeLists.txt "CMakeLists.txt") | | [CMakeLists.txt](/MisterTea/EternalTerminal/blob/master/CMakeLists.txt "CMakeLists.txt") |  |  |
| [LICENSE](/MisterTea/EternalTerminal/blob/master/LICENSE "LICENSE") | | [LICENSE](/MisterTea/EternalTerminal/blob/master/LICENSE "LICENSE") |  |  |
| [README.md](/MisterTea/EternalTerminal/blob/master/README.md "README.md") | | [README.md](/MisterTea/EternalTerminal/blob/master/README.md "README.md") |  |  |
| [build\_static.sh](/MisterTea/EternalTerminal/blob/master/build_static.sh "build_static.sh") | | [build\_static.sh](/MisterTea/EternalTerminal/blob/master/build_static.sh "build_static.sh") |  |  |
| [codecov.yml](/MisterTea/EternalTerminal/blob/master/codecov.yml "codecov.yml") | | [codecov.yml](/MisterTea/EternalTerminal/blob/master/codecov.yml "codecov.yml") |  |  |
| [coverage.sh](/MisterTea/EternalTerminal/blob/master/coverage.sh "coverage.sh") | | [coverage.sh](/MisterTea/EternalTerminal/blob/master/coverage.sh "coverage.sh") |  |  |
| [format.sh](/MisterTea/EternalTerminal/blob/master/format.sh "format.sh") | | [format.sh](/MisterTea/EternalTerminal/blob/master/format.sh "format.sh") |  |  |
| [make\_changelog.sh](/MisterTea/EternalTerminal/blob/master/make_changelog.sh "make_changelog.sh") | | [make\_changelog.sh](/MisterTea/EternalTerminal/blob/master/make_changelog.sh "make_changelog.sh") |  |  |
| [make\_rpm\_changelog.sh](/MisterTea/EternalTerminal/blob/master/make_rpm_changelog.sh "make_rpm_changelog.sh") | | [make\_rpm\_changelog.sh](/MisterTea/EternalTerminal/blob/master/make_rpm_changelog.sh "make_rpm_changelog.sh") |  |  |
| [renovate.json](/MisterTea/EternalTerminal/blob/master/renovate.json "renovate.json") | | [renovate.json](/MisterTea/EternalTerminal/blob/master/renovate.json "renovate.json") |  |  |
| [vcpkg.json](/MisterTea/EternalTerminal/blob/master/vcpkg.json "vcpkg.json") | | [vcpkg.json](/MisterTea/EternalTerminal/blob/master/vcpkg.json "vcpkg.json") |  |  |
| View all files | | |

## Repository files navigation

* README
* Apache-2.0 license
# Eternal Terminal

Eternal Terminal is a remote shell that automatically reconnects without interrupting the session.

Website: <https://mistertea.github.io/EternalTerminal/>.

## Integration tests

Circle: [![CircleCI](https://camo.githubusercontent.com/a627cd4b88b32cbe572334111d4aad9862e306bf643655bf3c92f4c74c9c1ba9/68747470733a2f2f636972636c6563692e636f6d2f67682f4d69737465725465612f457465726e616c5465726d696e616c2f747265652f6d61737465722e7376673f7374796c653d737667)](https://circleci.com/gh/MisterTea/EternalTerminal/tree/master)

Linux: [![Linux CI](https://github.com/MisterTea/EternalTerminal/workflows/Linux%20CI/badge.svg?branch=master)](https://github.com/MisterTea/EternalTerminal/workflows/Linux%20CI/badge.svg?branch=master)

## Packaging status

[![Packaging status](https://camo.githubusercontent.com/fab4ed2d35b4bdc2cc1fac335c7ca84eb2dc21912f4c2a8ca06df8d6d959f949/68747470733a2f2f7265706f6c6f67792e6f72672f62616467652f766572746963616c2d616c6c7265706f732f657465726e616c7465726d696e616c2e737667)](https://repology.org/project/eternalterminal/versions)

## Installing

### macOS

The easiest way to install is using Homebrew:

```
brew install MisterTea/et/et
```

If the install fails on including csignal, see [#662 (comment)](https://github.com/MisterTea/EternalTerminal/issues/662#issuecomment-2408889829)

Then if you want a daemon to launch `etserver` on every boot:

On m1 (Apple Silicon) Macs:

```
sudo sed 's:/usr/local/bin/etserver:/opt/homebrew/bin/etserver:g' ../init/launchd/homebrew.mxcl.et.plist | sudo tee /Library/LaunchDaemons/homebrew.mxcl.et.plist
sudo launchctl load -w /Library/LaunchDaemons/homebrew.mxcl.et.plist
```

On x86 Macs:

```
sudo cp ../init/launchd/homebrew.mxcl.et.plist /Library/LaunchDaemons/homebrew.mxcl.et.plist
sudo launchctl load -w /Library/LaunchDaemons/homebrew.mxcl.et.plist
```

Alternatively, a package is available in MacPorts:

```
sudo port install et
```

### Ubuntu

For Ubuntu, use our PPA:

```
sudo add-apt-repository ppa:jgmath2000/et
sudo apt-get update
sudo apt-get install et
```

Or see "Debian/Ubuntu" below to install and build from source (e.g., for ARM).

### Debian

For Debian, use our deb repo:

```
echo "deb [signed-by=/etc/apt/keyrings/et.gpg] https://mistertea.github.io/debian-et/debian-source/ $(grep VERSION_CODENAME /etc/os-release | cut -d= -f2) main" | sudo tee -a /etc/apt/sources.list.d/et.list
sudo mkdir -m 0755 -p /etc/apt/keyrings # only if you're using Debian 11 or older
curl -sSL https://github.com/MisterTea/debian-et/raw/master/et.gpg | sudo tee /etc/apt/keyrings/et.gpg >/dev/null
sudo apt update
sudo apt install et
```

### CentOS 7

Up to the present day the only way to install is to [build from source](#centos-7-1).

### CentOS 8

```
sudo dnf install epel-release
sudo dnf install et
```

### FreeBSD

On FreeBSD, use:

```
pkg install eternalterminal
```

### Fedora (version 29 and later):

```
sudo dnf install et
```

### openSUSE

```
zypper ar -f obs://network
zypper ref
zypper in EternalTerminal
```

### Other Linux

Install dependencies:

* Fedora (tested on 25):

  ```
  sudo dnf install boost-devel libsodium-devel protobuf-devel \
  	protobuf-compiler cmake gflags-devel libcurl-devel
  ```
* Gentoo:

  ```
  sudo emerge dev-libs/boost dev-libs/libsodium \
  	dev-libs/protobuf dev-util/cmake dev-cpp/gflags
  ```

Download and install from source:

```
git clone --recurse-submodules --depth 1 https://github.com/MisterTea/EternalTerminal.git
cd EternalTerminal
mkdir build
cd build
cmake ../
make
sudo make install
```

### Windows

Eternal Terminal works under WSL (Windows Subsystem for Linux). Follow the ubuntu instructions.

### Docker Image

See [docker/README.md](/MisterTea/EternalTerminal/blob/master/docker)

## Verifying

Verify that the client is installed correctly by looking for the `et` executable: `which et`.

Verify that the server is installed correctly by checking the service status: `systemctl status et`. On some operating systems, you may need to enable and start the service manually: `sudo systemctl enable --now et`.

You are ready to start using ET!

## Configuring

If you'd like to modify the server settings (e.g. to change the listening port), edit /etc/et.cfg.

## Using

ET uses ssh for handshaking and encryption, so you must be able to ssh into the machine from the client. Make sure that you can `ssh user@hostname`.

ET uses TCP, so you need an open port on your server. By default, it uses 2022.

Once you have an open port, the syntax is similar to ssh. Username is default to the current username starting the et process, use `-u` or `user@` to specify a different one if necessary.

```
et hostname (etserver running on default port 2022, username is the same as current)
et user@hostname:8000 (etserver running on port 8000, different user)
```

You can specify a jumphost and the port et is running on jumphost using `--jumphost` and `--jport`. If no `--jport` is given, et will try to connect to default port 2022.

```
et hostname -jumphost jump_hostname (etserver running on port 2022 on both hostname and jumphost)
et hostname:8888 --jumphost jump_hostname --jport 9999
```

Additional arguments that et accepts are port forwarding pairs with option `-t "18000:8000, 18001-18003:8001-8003"`, a command to run immediately after the connection is setup through `-c`.

Starting from the latest release, et supports parsing both user-specific and system-wide SSH config files.
The config file is required when your sshd on server/jumphost is listening on a port which is not 22.
Here is an example SSH config file showing how to setup when

* there is a jumphost in the middle
* sshd is listening on a port that is not 22
* connecting to a different username other than the current one.

```
Host dev
  HostName 192.168.1.1
  User fred
  Port 5555
  ProxyJump user@jumphost.example.org:22
```

With the ssh config file set as above, you can simply call et with

```
et dev (etserver running on port 2022 on both hostname and jumphost)
et dev:8000 -jport 9000 (etserver running on port 9000 on jumphost)
```

## Building from Source

### macOS

To build Eternal Terminal on Mac, the easiest way is to grab dependencies with Homebrew:

```
brew install autoconf automake libtool
git clone --recurse-submodules --depth 1 https://github.com/MisterTea/EternalTerminal.git
cd EternalTerminal
mkdir build
cd build
cmake ../
make -j$(nproc) && sudo make install
```

To run an `et` server for testing, run `./etserver`. To run an `et`
server daemon persistently across reboots:

```
sudo cp ../init/launchd/homebrew.mxcl.et.plist /Library/LaunchDaemons
sudo launchctl load -w /Library/LaunchDaemons/homebrew.mxcl.et.plist
```

### Debian/Ubuntu

Grab the deps and then follow this process.

Debian/Ubuntu Dependencies:

```
sudo apt install libsodium-dev autoconf libtool \
	libprotobuf-dev protobuf-compiler libutempter-dev libcurl4-openssl-dev \
    build-essential ninja-build cmake git zip pkg-config
```

Fetch source, build and install:

```
git clone --recurse-submodules --depth 1 https://github.com/MisterTea/EternalTerminal.git
cd EternalTerminal
mkdir build
cd build
# For ARM (including OS/X with apple silicon):
if [[ $(uname -a | grep 'arm\|aarch64') ]]; then export VCPKG_FORCE_SYSTEM_BINARIES=1; fi
cmake -DCPACK_GENERATOR=DEB ../
make -j$(nproc) package
sudo dpkg --install *.deb
```

Once built, the binary only requires `libprotobuf-dev`.

Disable et server by `sudo systemctl disable --now et`

### CentOS 7

Install dependencies:

```
sudo yum install epel-release
sudo yum install cmake3 boost-devel libsodium-devel protobuf-devel \
     protobuf-compiler gflags-devel protobuf-lite-devel libcurl-devel \
     perl-IPC-Cmd perl-Data-Dumper libunwind-devel libutempter-devel
```

Install scl dependencies

```
sudo yum install centos-release-scl
sudo yum install devtoolset-11 devtoolset-11-libatomic-devel rh-git227
```

Download and install from source ([see #238 for details](https://github.com/MisterTea/EternalTerminal/issues/238)):

```
git clone --recurse-submodules --depth 1 https://github.com/MisterTea/EternalTerminal.git
cd EternalTerminal
mkdir build
cd build
scl enable devtoolset-11 rh-git227 'cmake3 ../'
scl enable devtoolset-11 'make && sudo make install'
sudo cp ../systemctl/et.service /etc/systemd/system/
sudo cp ../etc/et.cfg /etc/
```

Find the actual location of et:

```
which etserver
```

Correct the service file (see [#180](https://github.com/MisterTea/EternalTerminal/issues/180) for details).

```
sudo sed -ie "s|ExecStart=[^[:space:]]*[[:space:]]|ExecStart=$(which etserver) |" /etc/systemd/system/et.service
```

Alternatively, open the file /etc/systemd/system/et.service in an editor and correct the `ExectStart=...` line to point to the correct path of the `etserver` binary.

```
ExecStart=/usr/local/bin/etserver --cfgfile=/etc/et.cfg

```

Reload systemd configs:

```
sudo systemctl daemon-reload
```

Start the et service:

```
sudo systemctl enable --now et.service
```

## Building using Docker

Builder Dockerfiles are located at [deployment/](/MisterTea/EternalTerminal/blob/master/deployment). Supported OSes: CentOS 8, openSUSE and Ubuntu.

## Reporting issues

If you have any problems with installation or usage, please [file an issue on GitHub](https://github.com/MisterTea/EternalTerminal/issues).

## Developers

* Jason Gauci: <https://github.com/MisterTea>
* Ailing Zhang: <https://github.com/ailzhang>
* James Short: <https://github.com/jshort>

## About

Re-Connectable secure remote shell

[mistertea.github.io/EternalTerminal/](https://mistertea.github.io/EternalTerminal/ "https://mistertea.github.io/EternalTerminal/")

### Topics

[tmux](/topics/tmux "Topic: tmux")
[ssh](/topics/ssh "Topic: ssh")
[terminal](/topics/terminal "Topic: terminal")
[remote-shell](/topics/remote-shell "Topic: remote-shell")
[mosh](/topics/mosh "Topic: mosh")

### Resources

[Readme](#readme-ov-file)
### License

[Apache-2.0 license](#Apache-2.0-1-ov-file)

[Activity](/MisterTea/EternalTerminal/activity)
### Stars

[**3.1k**
stars](/MisterTea/EternalTerminal/stargazers)
### Watchers

[**33**
watching](/MisterTea/EternalTerminal/watchers)
### Forks

[**174**
forks](/MisterTea/EternalTerminal/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2FMisterTea%2FEternalTerminal&report=MisterTea+%28user%29)

## [Releases 72](/MisterTea/EternalTerminal/releases)

[Eternal Terminal v6.2.9
Latest

May 1, 2024](/MisterTea/EternalTerminal/releases/tag/et-v6.2.9)
[+ 71 releases](/MisterTea/EternalTerminal/releases)

## Sponsor this project

 Sponsor

[Learn more about GitHub Sponsors](/sponsors)

## [Packages 0](/users/MisterTea/packages?repo_name=EternalTerminal)

No packages published

## [Contributors 83](/MisterTea/EternalTerminal/graphs/contributors)

* [![@MisterTea](https://avatars.githubusercontent.com/u/306879?s=64&v=4)](https://github.com/MisterTea)
* [![@begui](https://avatars.githubusercontent.com/u/143328?s=64&v=4)](https://github.com/begui)
* [![@ailzhang](https://avatars.githubusercontent.com/u/5248122?s=64&v=4)](https://github.com/ailzhang)
* [![@jshort](https://avatars.githubusercontent.com/u/1186444?s=64&v=4)](https://github.com/jshort)
* [![@cgull](https://avatars.githubusercontent.com/u/1934797?s=64&v=4)](https://github.com/cgull)
* [![@telser](https://avatars.githubusercontent.com/u/36592?s=64&v=4)](https://github.com/telser)
* [![@jwmcglynn](https://avatars.githubusercontent.com/u/103489?s=64&v=4)](https://github.com/jwmcglynn)
* [![@MichaelBuckley](https://avatars.githubusercontent.com/u/50380?s=64&v=4)](https://github.com/MichaelBuckley)
* [![@bryant1410](https://avatars.githubusercontent.com/u/3905501?s=64&v=4)](https://github.com/bryant1410)
* [![@Migelo](https://avatars.githubusercontent.com/u/6537512?s=64&v=4)](https://github.com/Migelo)
* [![@dandv](https://avatars.githubusercontent.com/u/33569?s=64&v=4)](https://github.com/dandv)
* [![@SuperSandro2000](https://avatars.githubusercontent.com/u/7258858?s=64&v=4)](https://github.com/SuperSandro2000)
* [![@mbtamuli](https://avatars.githubusercontent.com/u/10382077?s=64&v=4)](https://github.com/mbtamuli)
* [![@caruccio](https://avatars.githubusercontent.com/u/540936?s=64&v=4)](https://github.com/caruccio)

[+ 69 contributors](/MisterTea/EternalTerminal/graphs/contributors)

## Languages

* [C++
  88.7%](/MisterTea/EternalTerminal/search?l=c%2B%2B)
* [CMake
  8.0%](/MisterTea/EternalTerminal/search?l=cmake)
* [Shell
  2.9%](/MisterTea/EternalTerminal/search?l=shell)
* [Dockerfile
  0.4%](/MisterTea/EternalTerminal/search?l=dockerfile)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.openwall.com_e83b7678_20250114_231017.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](../../../2023/02/15/6) [[next>]](2) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <Y+5EDY4sEFoKuJ+Z@kasco.suse.de>
Date: Thu, 16 Feb 2023 15:56:12 +0100
From: Matthias Gerstner <mgerstner@...e.de>
To: oss-security@...ts.openwall.com
Subject: EternalTerminal: Review report and findings (predictable /tmp file
 paths and file permission issues, 3 CVEs)

Hello list,

this is a report about a review of the EternalTerminal [1] codebase I
performed and three CVE assignments that happened in this context.
EternalTerminal is an SSH-like remote terminal solution that survives
connection loss and IP roaming. Following is my detailed report which is based
on the v6.2.1 upstream release.

I publish this report today, because the maximum embargo period of 90 days we
offered upstream has been exceeded. Not all issues mentioned in this report
are currently fixed upstream.

[1]: <https://github.com/MisterTea/EternalTerminal>

1) Review Motivation
====================

There have been a number of CVE assignments for EternalTerminal in August
2022:

CVE-2022-24952: DoS triggered remotely by invalid sequence numbers.
CVE-2022-24951: race condition allows local attacker to hijack IPC socket.
CVE-2022-24950: race condition allows authenticated attacker to hijack other
                user's SSH authorization socket.

In light of these issues I have been asked to have a closer look if there
might linger more issues in the project.

2) Basic Design Overview
========================

EternalTerminal initially uses a regular SSH connection to establish a 256 bit
shared secret between client and server. The client invokes the executable
`etterminal` on the remote node via SSH. This creates a random `clientid` /
`passkey` pair which is passed (still on the remote node) to the privileged
`etserver` component via a UNIX domain socket. At this point the `etserver`
component has an entry for the `clientid` and its copy of the shared key for
that client. The `clientid` / `passkey` pair is also written to stdout and
consumed via the SSH connection by the `et` client process. This way the
client gets its copy of the shared key. The `etterminal` helper program on the
server side then backgrounds and keeps running. It implements the PTY that
will later be used for running the EternalTerminal session.

In a second step the client talks to the `etserver` remote instance via IP
port 2022. A Google Protocol Buffer based protocol is used here. An initial
cleartext message is sent that just states the `clientid` and the protocol
version of the client. If the server accepts the parameters then both parties
switch over to a libsodium secretbox encryption based on the 256 bit shared
secret `passkey` and an incrementally increasing nonce value. The server now
attaches the session to the PTY provided by the instance of `etterminal` that
was started earlier via regular SSH.

If the connection is lost then the client can connect to the remote node on
port 2022 again using the same `clientid` to resume a terminal session.

3) Issues
=========

3.a) World Readable Logfiles and Predictable Logfile Names in /tmp
------------------------------------------------------------------

Both etserver and etclient create logfiles directly in the "/tmp"
directory. For reference some example files:

    $ ls -lh /tmp/etserver*
    -rw-r--r-- 1 root root 393 Nov 18 13:44 /tmp/etserver-2022-11-18_13-44.log
    -rw-r----- 1 root root   0 Nov 18 13:44 /tmp/etserver_stderr_2022-11-18_01-44

    $ ls -lh /tmp/etclient*
    -rw-r--r-- 1 someuser users 1.8K Nov 18 13:45 /tmp/etclient-2022-11-18_13_44_52.log
    -rw-r----- 1 someuser users   78 Nov 18 13:44 /tmp/etclient_stderr_2022-11-18_01-44

This has the following problems:

- The stdout logfile is world-readable and the stderr logfile is still group
  readable. This can pose an information leak, depending on the logger
  configuration and what is exactly output during runtime by etserver and
  etclient. Other users on the system can deduce what is happening this way,
  including the `clientid`s used.

- The filenames of these logfiles are pretty predictable, with only minute
  timestamp granularity on the server and second timestamp granularity on the
  client side. This means a local attacker can prepare symlink attacks or
  precreate these files. Luckily on most current Linux systems this is prevented
  by the Linux kernel's symlink protection in world writable directories. Even
  with the protection it still poses a denial-of-service risk, because the
  EternalTerminal processes can fail to start if these files are precreated by
  other users. Without the kernel protection, file creation in privileged
  locations and logfile spoofing would be the impact.

### Upstream Fix

Upstream addressed some of the problems (open() flags, creation mode) in this
commit which is part of release 6.2.2:

<https://github.com/MisterTea/EternalTerminal/commit/92c4c6ada445c1925a8b397f4171ca7735cbda16>

### Further Suggestions

- Ideally the logfiles should go into a dedicated directory e.g. in
  /var/log/et for the server side.
- For the client side a set of logfiles can be kept in the home
  directory, but old logs should be deleted after some time.
  Alternatively client logs can be placed into `/run/user/<uid>/et-logs`
  or a similar location.

### CVE Assignments

Mitre assigned the following CVEs:

- CVE-2022-48257 for the "predictable log filename" aspect.
- CVE-2022-48258 for the "world readable log files" aspect.

3.b) TelemetryService Uses Fixed Paths in /tmp
----------------------------------------------

The TelemetryService class is instantiated using a database path in
"/tmp/.sentry-native-et" for the client and "/tmp/.sentry-native-etserver" for
the server. This is a directory within which further files and directories
will be queried and created during runtime.

Similar to issue 3.a) this allows other users on the system to pre-create this
parent directory which will be used by the `etclient` or `etserver` process.

For example in etserver the following system call sequence with regard
to this database directory can be observed during startup:

```
    mkdir("/tmp//.sentry-native-etserver", 0700) = -1 EEXIST (File exists)
    readlink("/tmp/.sentry-native-etserver", 0x7ffda847e750, 1023) = -1 EINVAL (Invalid argument)
    openat(AT_FDCWD, "/tmp/.sentry-native-etserver/a5323119-72df-430c-ad87-38054a86d7e1.run.lock", O_RDONLY|O_CREAT|O_TRUNC, 0666) = 5
    newfstatat(AT_FDCWD, "/tmp/.sentry-native-etserver/a5323119-72df-430c-ad87-38054a86d7e1.run.lock", {st_mode=S_IFREG|0644, st_size=0, ...}, 0) = 0
    mkdir("/tmp/.sentry-native-etserver", 0700) = -1 EEXIST (File exists)
    mkdir("/tmp/.sentry-native-etserver/a5323119-72df-430c-ad87-38054a86d7e1.run", 0700) = 0
    openat(AT_FDCWD, "/tmp/.sentry-native-etserver/user-consent", O_RDONLY) = -1 ENOENT (No such file or directory)
    newfstatat(AT_FDCWD, "/tmp/.sentry-native-etserver/last_crash", 0x7ffda847fdb0, 0) = -1 ENOENT (No such file or directory)
    openat(AT_FDCWD, "/tmp/.sentry-native-etserver", O_RDONLY|O_NONBLOCK|O_CLOEXEC|O_DIRECTORY) = 6
    newfstatat(AT_FDCWD, "/tmp/.sentry-native-etserver/a5323119-72df-430c-ad87-38054a86d7e1.run", {st_mode=S_IFDIR|0700, st_size=40, ...}, 0) = 0
    openat(AT_FDCWD, "/tmp/.sentry-native-etserver/a5323119-72df-430c-ad87-38054a86d7e1.run.lock", O_RDONLY|O_CREAT|O_TRUNC, 0666) = 7
    newfstatat(AT_FDCWD, "/tmp/.sentry-native-etserver/a5323119-72df-430c-ad87-38054a86d7e1.run.lock", {st_mode=S_IFREG|0644, st_size=0, ...}, 0) = 0
    newfstatat(AT_FDCWD, "/tmp/.sentry-native-etserver/a5323119-72df-430c-ad87-38054a86d7e1.run/session.json", 0x7ffda847faa0, 0) = -1 ENOENT (No such file or directory)
    unlink("/tmp/.sentry-native-etserver/a5323119-72df-430c-ad87-38054a86d7e1.run/session.json") = -1 ENOENT (No such file or directory)
    openat(AT_FDCWD, "/tmp/.sentry-native-etserver/a5323119-72df-430c-ad87-38054a86d7e1.run/session.json", O_RDWR|O_CREAT|O_TRUNC, 0664) = 6
    openat(AT_FDCWD, "/tmp/.sentry-native-etserver/a5323119-72df-430c-ad87-38054a86d7e1.run/session.json", O_RDWR|O_CREAT|O_TRUNC, 0664) = 6
```

A local attacker can create "/tmp/.sentry-native-etserver" with mode 0777
before `etserver` starts. The attacker will then control the complete
directory tree. Even though the TelemetryService backend uses UUIDs, they can
be deduced by waiting for the `.run.lock` file being created, from this time
on the local attacker knows the UUID and can try to win a race condition by
pre-creating also the `<UUID>.run` directory. The information placed there
will then leak to the attacker, but the attacker can also compromise the data
integrity by changing it.

Again, without the Linux kernel's symlink protection mechanism this
issue would provide a lot of possibilities to exploit symlink attacks. And in
the more deeply nested file paths below "/tmp/.sentry-native-etserver" the
symlink protection might not even be triggered.

### Upstream Fix

I do not know of any upstream efforts to fix this.

### Suggested Fix

- The client should create this directory in "/run/user/<UID>/sentry-native-et"
  instead.
- The server should create this directory in e.g. "/run/etserver/sentry-native-etserver"
  instead.

### CVE Assignments

Mitre assigned the following CVE:

- CVE-2023-23558 for the fixed "/tmp" path usage of the TelemetryService component

3.c) Registration of Server Sessions via Local IPC Socket Allows for Simple Reverse Shells
------------------------------------------------------------------------------------------

The socket on the `etserver` side at "/var/run/etserver.idpasskey.fifo" is
world accessible and allows any local user to register a future session with
EternalTerminal that can later be accessed remotely on port 2022. To do so
the local user only needs to get out the clientid and idpasskey registered at
the socket, which can also have static values, because the clientid and
passkey are selected by the client side, not by the privileged server side.

Usually only certain user accounts are allowed to log into a machine, based on
policies found e.g. in the SSH configuration, PAM stack configuration and so
on. Especially users without a valid account (no valid shell set, no password
assigned, locked, etc.) should not be able to log into a machine neither
locally nor remotely. These login policies can easily be circumvented by using
the `etserver` features.

A reverse shell can of course also be created in other ways as soon as a
local user account can execute arbitrary code. What makes it special
with `etserver` is that it will be very well hidden since it is using a
regular facility of the system. What makes this more problematic is that
there is no time limit, a local user account can register such a session
and access it days or event months later remotely, provided that the
`etserver` instance isn't restarted.

Since all that is needed to register a session is access to the local IPC
socket, this even has the potential to allow isolated container processes to
escape network isolation. Even if the process has a detached networking stack
(separate Linux network namespace), the mere access to `etserver`'s IPC socket
allows to create a remote connection to the container from the outside.
Depending on container configurations or other vulnerabilities in container
setups this can be a realistic threat.

### CVE Assignments

Since this is not a tangible vulnerability on its own I did not request a
dedicated CVE for it. I still believe that the topic should be addressed in
some form.

### Upstream Fix

I do not know of any upstream efforts to improve this aspect of
EternalTerminal.

## Suggested Fixes

- Ideally there would be a tighter coupling between the SSH authentication
  part and the connection to port 2022. For example a small PAM module could
  write out a kind of auth cookie during SSH login for the user account context
  that will be verified again once the connection on port 2022 is coming in.
  This should also be time limited so that the session doesn't remain valid
  forever but only for a few minutes or so, if no one actually connects to
  port 2022.

4) Other Suggestions
====================

4.a) srand(1) Calls
-------------------

Currently the following source locations (corresponding to the three main
programs) contain a call to `srand(1)`:

    terminal/TerminalServerMain.cpp:    srand(1);
    terminal/TerminalClientMain.cpp:    srand(1);
    terminal/TerminalMain.cpp:    srand(1);

Luckily the C `rand()` function is only used for non-sensitive things in the
codebase as far as I could see. Still this is bad practice, especially in a
program that is also doing cryptography. Things could get mixed up in the
future. I suggest to create a common init function that properly seeds the
random number generator using real random data e.g. obtained from libsodium.

### Upstream Fix

I do not know of any upstream efforts to improve on this.

4.b) Telemetry Enabled by Default
---------------------------------

I found it a bit irritating that the telemetry service is sending out
crash data by default without explicit user opt-in. Even though it is
anonymised I don't think an OSS program should send out data to third party
remote servers without explicit consent.

There should be at least a compile time option to influence this default
so that integrators of the package can decide which way to go here.

### Upstream Fix

Upstream made the Telemetry opt-in (changed the defaults) via this commit
which is part of release 6.2.2:

<https://github.com/MisterTea/EternalTerminal/commit/7289e04475a8418d376cbc7ecbcc580e23c42bb7>

4.c) Busy-wait Loop in TerminalServer::run()
--------------------------------------------

Currently the while loop there `select()`s with a timeout of 10.000
usec. I can see no purpose for that in the code, but it creates notable
CPU load even in idle in etserver and also makes analyzing the program
harder due to the massive load of system calls resulting from the busy loop.

### Upstream Fix

I do not know of any upstream efforts to improve on this.

4.d) TerminalUserInfo in etserver Receives User Controlled uid/gid Values
-------------------------------------------------------------------------

Currently the `etterminal` program sends the client's uid and gid values to
the privileged `etserver` via a local UNIX domain socket. This information
ends up in the TerminalUserInfo protobuf structure. Currently `etserver` uses
this information only for the jump host configuration in a non-sensitive way
as far as I can see.

For prudence I suggest to change this logic though. The uid and gid values can
be forged by the client and future code changes might miss this fact and
consider this information to be trusted. The safe way to obtain this
information would be to use the `SO_PEERCRED` socket option on the UNIX domain
socket connection on the privileged end. This way the information is obtained
from the kernel and can be trusted.

If it is intentional that clients can set this data then naming the fields
differently and documenting that this is untrusted data is recommended.

### Upstream Fix

I do not know of any upstream efforts to improve on this.

Timeline
========

2022-11-18: I shared an initial report with the upstream author(s) offering
            coordinated disclosure according to the openSUSE disclosure
            policy. Some discussions about fixing parts of the issues started
            but died down again.
            No statement about the desired duration of an embargo period (or
            any at all) was made by upstream. No confirmation of the
            individual issues or wishes regarding CVE assigments have been
            stated.
2023-01-09: I learned from upstream that information about issue 3.a) was
            already public in form of an upstream GitHub pull request. I asked
            about plans for fixes for the remaining findings and about
            upstream's desires for a prolonged embargo period and CVE
            assignments but got no answers.
2023-01-13: I requested the three CVEs mentioned in this report from Mitre for
            the issues that I deemed critical and concrete enough to assign
            CVEs.
2023-01-18: Upstream released version 6.2.2 containing fixes for issue 3.a),
            i.e. for CVE-2022-48257 and CVE-2022-48258.
2023-02-16: The maximum embargo period we offer (90 days) has been exceeded
            and lacking further details from upstream I published all
            information I have.

Best Regards

Matthias

--
Matthias Gerstner <matthias.gerstner@...e.de>
Security Engineer
<https://www.suse.com/security>
GPG Key ID: 0x14C405C971923553

SUSE Software Solutions Germany GmbH
HRB 36809, AG Nürnberg
Geschäftsführer: Ivo Totev, Andrew Myers, Andrew McDonald, Boudien Moerman

Download attachment "[signature.asc](1/1)" of type "application/pgp-signature" (834 bytes)

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from bugzilla.suse.com_0a1b8a00_20250114_231019.html ===


| Bugzilla – Bug 1207126 | VUL-0: CVE-2023-23558: EternalTerminal: TelemetryService uses fixed paths in /tmp | Last modified: 2023-02-17 09:39:47 UTC |
| --- | --- | --- |

|  |
| --- |

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [IDP Log In](/saml2_login.cgi?idp=IDP&target=show_bug.cgi%3Fid%3D1207126)
* |
  [Forgot Password](https://idp-portal.suse.com/univention/self-service/#page=passwordreset)

[**Bug 1207126**](show_bug.cgi?id=1207126)
(CVE-2023-23558)
- VUL-0: CVE-2023-23558: EternalTerminal: TelemetryService uses fixed paths in /tmp

[Summary:](page.cgi?id=glossary.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
VUL-0: CVE-2023-23558: EternalTerminal: TelemetryService uses fixed paths in ...

| | [Status](page.cgi?id=status_resolution_matrix.html): | NEW | | --- | --- | |  | | | [Alias:](page.cgi?id=glossary.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2023-23558 | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | SUSE Security Incidents | | [Classification:](page.cgi?id=glossary.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Novell Products | | [Component:](describecomponents.cgi?product=SUSE Security Incidents "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Audits ([show other bugs](buglist.cgi?component=Audits&product=SUSE%20Security%20Incidents&bug_status=__open__)) | | [Version:](page.cgi?id=glossary.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=glossary.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Other Other | |  | | | [Priority](page.cgi?id=glossary.html#priority): | P3 - Medium **Severity**: Normal | | [Target Milestone:](page.cgi?id=glossary.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=glossary.html#assigned_to "The person in charge of resolving the bug.") | Michael Vetter | | [QA Contact:](page.cgi?id=glossary.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") | Security Team bot | |  | | | [URL:](page.cgi?id=glossary.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=glossary.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=glossary.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=glossary.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2023-01-13 09:45 UTC by Matthias Gerstner | | --- | --- | | Modified: | 2023-02-17 09:39 UTC ([History](show_activity.cgi?id=1207126)) | | CC List: | 2 users (show)  mvetter security-team | |  | | | [See Also:](page.cgi?id=glossary.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Found By:](page.cgi?id=glossary.html#cf_foundby "A custom Drop Down field in this installation of Bugzilla.") | --- | | [Services Priority:](page.cgi?id=glossary.html#cf_nts_priority "A custom Free Text field in this installation of Bugzilla.") |  | | [Business Priority:](page.cgi?id=glossary.html#cf_biz_priority "A custom Free Text field in this installation of Bugzilla.") |  | | [Blocker:](page.cgi?id=glossary.html#cf_blocker "A custom Drop Down field in this installation of Bugzilla.") | --- | | [Marketing QA Status:](page.cgi?id=glossary.html#cf_marketing_qa_status "A custom Drop Down field in this installation of Bugzilla.") | --- | | [IT Deployment:](page.cgi?id=glossary.html#cf_it_deployment "A custom Drop Down field in this installation of Bugzilla.") | --- | |  | |  * [Clone This Bug](enter_bug.cgi?cloned_bug_id=1207126) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [Add an attachment](attachment.cgi?bugid=1207126&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=1207126&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1207126#c0)  Matthias Gerstner   2023-01-13 09:45:10 UTC  ``` +++ This bug was initially created as a clone of [Bug #1204881](show_bug.cgi?id=1204881 "RESOLVED FIXED - AUDIT-TRACKER: EternalTerminal: remote forever alive ssh terminal")  This issue is still kind of private but there is no clear coordination with upstream so we're free to act as it fits our processes.   # 2) TelemetryService Uses Fixed Paths in /tmp   The TelementryService class is instantiated using a database path in  /tmp/.sentry-native-et for the client and /tmp/.sentry-native-etserver  for the server. This is a directory within which further files and  directories will be queried and created during runtime.   Similar to [bug 1207123](show_bug.cgi?id=1207123 "RESOLVED FIXED - VUL-0: CVE-2022-48257: EternalTerminal: Predictable logfile names in /tmp.") and [bug 1207124](show_bug.cgi?id=1207124 "RESOLVED FIXED - VUL-0: CVE-2022-48258: EternalTerminal: etserver and etclient have world-readable logfiles.") this allows other users on the system  to pre-create this parent directory which will be used by the etclient or  etserver processes.   For example in etserver the following system call sequence with regard  to this database directory can be observed during startup:       mkdir("/tmp//.sentry-native-etserver", 0700) = -1 EEXIST (File exists)      readlink("/tmp/.sentry-native-etserver", 0x7ffda847e750, 1023) = -1 EINVAL (Invalid argument)      openat(AT_FDCWD, "/tmp/.sentry-native-etserver/a5323119-72df-430c-ad87-38054a86d7e1.run.lock", O_RDONLY|O_CREAT|O_TRUNC, 0666) = 5      newfstatat(AT_FDCWD, "/tmp/.sentry-native-etserver/a5323119-72df-430c-ad87-38054a86d7e1.run.lock", {st_mode=S_IFREG|0644, st_size=0, ...}, 0) = 0      mkdir("/tmp/.sentry-native-etserver", 0700) = -1 EEXIST (File exists)      mkdir("/tmp/.sentry-native-etserver/a5323119-72df-430c-ad87-38054a86d7e1.run", 0700) = 0      openat(AT_FDCWD, "/tmp/.sentry-native-etserver/user-consent", O_RDONLY) = -1 ENOENT (No such file or directory)      newfstatat(AT_FDCWD, "/tmp/.sentry-native-etserver/last_crash", 0x7ffda847fdb0, 0) = -1 ENOENT (No such file or directory)      openat(AT_FDCWD, "/tmp/.sentry-native-etserver", O_RDONLY|O_NONBLOCK|O_CLOEXEC|O_DIRECTORY) = 6      newfstatat(AT_FDCWD, "/tmp/.sentry-native-etserver/a5323119-72df-430c-ad87-38054a86d7e1.run", {st_mode=S_IFDIR|0700, st_size=40, ...}, 0) = 0      openat(AT_FDCWD, "/tmp/.sentry-native-etserver/a5323119-72df-430c-ad87-38054a86d7e1.run.lock", O_RDONLY|O_CREAT|O_TRUNC, 0666) = 7      newfstatat(AT_FDCWD, "/tmp/.sentry-native-etserver/a5323119-72df-430c-ad87-38054a86d7e1.run.lock", {st_mode=S_IFREG|0644, st_size=0, ...}, 0) = 0      newfstatat(AT_FDCWD, "/tmp/.sentry-native-etserver/a5323119-72df-430c-ad87-38054a86d7e1.run/session.json", 0x7ffda847faa0, 0) = -1 ENOENT (No such file or directory)      unlink("/tmp/.sentry-native-etserver/a5323119-72df-430c-ad87-38054a86d7e1.run/session.json") = -1 ENOENT (No such file or directory)      openat(AT_FDCWD, "/tmp/.sentry-native-etserver/a5323119-72df-430c-ad87-38054a86d7e1.run/session.json", O_RDWR|O_CREAT|O_TRUNC, 0664) = 6      openat(AT_FDCWD, "/tmp/.sentry-native-etserver/a5323119-72df-430c-ad87-38054a86d7e1.run/session.json", O_RDWR|O_CREAT|O_TRUNC, 0664) = 6   A local attacker can create /tmp/.sentry-native-etserver with mode 777  before etserver starts. The attacker will then control the complete  directory tree. Even though the TelementryService backend uses UUIDs,  they can be deduced by waiting for the `.run.lock` file being created,  from this time on the local attacker knows the UUID and can pre-create  also the '<UUID>.run' directory. The information placed there will then  leak to the attacker, but the attacker can also compromise the data  integrity by changing it.   Again, without the Linux kernel's symlink protection mechanism this  issue would provide a lot possibilities to exploit symlink attacks.   ## Suggested Fix   - the client should create this directory in /run/user/<UID>/sentry-native-et instead.  - the server should create this directory in e.g.  /run/etserver/sentry-native-etserver instead. ``` [Comment 3](show_bug.cgi?id=1207126#c3)  Matthias Gerstner   2023-02-16 10:24:19 UTC  ``` Publishing the bug, I will post to oss-sec today, and the CVE has to be published via Mitre. ``` [Comment 4](show_bug.cgi?id=1207126#c4)  Matthias Gerstner   2023-02-17 09:39:47 UTC  ``` My mailing list post can be found here:  <https://www.openwall.com/lists/oss-security/2023/02/16/1>  It summarizes the whole affair in all detail.  For this concrete bug here we could simply devise a patch that changes the directory from /tmp/.sentry-... to /run/user/$UID/sentry-... or setup something with systemd-tmpfiles, also in /run.  I don't know how easy it will be to contribute something like that upstream, since they also seem to cover Windows and other platforms. ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=1207126)
* - [XML](show_bug.cgi?ctype=xml&id=1207126)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=1207126)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [IDP Log In](/saml2_login.cgi?idp=IDP&target=show_bug.cgi%3Fid%3D1207126)
  + |
    [Forgot Password](https://idp-portal.suse.com/univention/self-service/#page=passwordreset)

+ Legal:
+ [openSUSE](http://en.opensuse.org/Terms_of_site)
+ [SUSE](https://www.suse.com/company/legal/)


