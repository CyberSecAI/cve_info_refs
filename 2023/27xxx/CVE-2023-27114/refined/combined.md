=== Content from github.com_78410822_20250115_093252.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fradareorg%2Fradare2%2Fcommit%2Fa15067a8eaa836bcc24b0882712c14d1baa66509)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fradareorg%2Fradare2%2Fcommit%2Fa15067a8eaa836bcc24b0882712c14d1baa66509)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=radareorg%2Fradare2)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[radareorg](/radareorg)
/
**[radare2](/radareorg/radare2)**
Public

* [Notifications](/login?return_to=%2Fradareorg%2Fradare2) You must be signed in to change notification settings
* [Fork
  3k](/login?return_to=%2Fradareorg%2Fradare2)
* [Star
   21k](/login?return_to=%2Fradareorg%2Fradare2)

* [Code](/radareorg/radare2)
* [Issues
  849](/radareorg/radare2/issues)
* [Pull requests
  26](/radareorg/radare2/pulls)
* [Discussions](/radareorg/radare2/discussions)
* [Actions](/radareorg/radare2/actions)
* [Projects
  0](/radareorg/radare2/projects)
* [Security](/radareorg/radare2/security)
* [Insights](/radareorg/radare2/pulse)

Additional navigation options

* [Code](/radareorg/radare2)
* [Issues](/radareorg/radare2/issues)
* [Pull requests](/radareorg/radare2/pulls)
* [Discussions](/radareorg/radare2/discussions)
* [Actions](/radareorg/radare2/actions)
* [Projects](/radareorg/radare2/projects)
* [Security](/radareorg/radare2/security)
* [Insights](/radareorg/radare2/pulse)

## Commit

[Permalink](/radareorg/radare2/commit/a15067a8eaa836bcc24b0882712c14d1baa66509)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix [#21363](https://github.com/radareorg/radare2/issues/21363) - null deref in the wasm disassembler ##crash

[Browse files](/radareorg/radare2/tree/a15067a8eaa836bcc24b0882712c14d1baa66509)
Browse the repository at this point in the history

* Loading branch information

[![@radare](https://avatars.githubusercontent.com/u/917142?s=40&v=4)](/radare)

[radare](/radareorg/radare2/commits?author=radare "View all commits by radare")
committed
Feb 20, 2023

1 parent
[c809882](/radareorg/radare2/commit/c809882f38d0da1d0515cb0181a020045da22dea)

commit a15067a

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**47 additions**
and
**22 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* libr/arch/p/wasm

  + libr/arch/p/wasm/wasm.c
    [wasm.c](#diff-47714dadda979bfead24339d1dffef507f0ae0888837234796af961da0e7eb3f)
* test/db/anal

  + test/db/anal/wasm
    [wasm](#diff-73565bd6f9f524f645439719b6cc82902363e487536679dba5a23f4916d07db6)

## There are no files selected for viewing

44 changes: 22 additions & 22 deletions

44
[libr/arch/p/wasm/wasm.c](#diff-47714dadda979bfead24339d1dffef507f0ae0888837234796af961da0e7eb3f "libr/arch/p/wasm/wasm.c")

Show comments

[View file](/radareorg/radare2/blob/a15067a8eaa836bcc24b0882712c14d1baa66509/libr/arch/p/wasm/wasm.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,11 +1,8 @@ |
|  |  | /\* radare - LGPL - Copyright 2017-2022 - pancake, cgvwzq \*/ |
|  |  | /\* radare - LGPL - Copyright 2017-2023 - pancake, cgvwzq \*/ |
|  |  |  |
|  |  | // http://webassembly.org/docs/binary-encoding/#module-structure |
|  |  |  |
|  |  | #include <r\_asm.h> |
|  |  | #include <r\_lib.h> |
|  |  | #include <string.h> |
|  |  |  |
|  |  | #include <r\_arch.h> |
|  |  | #include "wasm.h" |
|  |  | #include "../../../bin/format/wasm/wasm.h" |
|  |  |  |
| Expand Down  Expand Up | | @@ -611,7 +608,7 @@ R\_IPI int wasm\_dis(WasmOp \*op, const ut8 \*buf, int buf\_len, bool txt) { |
|  |  | case WASM\_OP\_F32REINTERPRETI32: |
|  |  | case WASM\_OP\_F64REINTERPRETI64: |
|  |  | case WASM\_OP\_END: |
|  |  | if (txt) { |
|  |  | if (txt && opdef->txt) { |
|  |  | op->txt = strdup (opdef->txt); |
|  |  | } |
|  |  | break; |
| Expand All | | @@ -624,7 +621,7 @@ R\_IPI int wasm\_dis(WasmOp \*op, const ut8 \*buf, int buf\_len, bool txt) { |
|  |  | if (!(n > 0 && n < buf\_len)) { |
|  |  | goto err; |
|  |  | } |
|  |  | if (txt) { |
|  |  | if (txt && opdef->txt) { |
|  |  | switch (val) { |
|  |  | case R\_BIN\_WASM\_VALUETYPE\_VOID: |
|  |  | op->txt = strdup (opdef->txt); |
| Expand Down  Expand Up | | @@ -660,7 +657,7 @@ R\_IPI int wasm\_dis(WasmOp \*op, const ut8 \*buf, int buf\_len, bool txt) { |
|  |  | if (n <= 0 || n >= buf\_len) { |
|  |  | goto err; |
|  |  | } |
|  |  | if (txt) { |
|  |  | if (txt && opdef->txt) { |
|  |  | op->txt = r\_str\_newf ("%s %d", opdef->txt, op->val); |
|  |  | } |
|  |  | op->len += n; |
| Expand Down  Expand Up | | @@ -693,7 +690,7 @@ R\_IPI int wasm\_dis(WasmOp \*op, const ut8 \*buf, int buf\_len, bool txt) { |
|  |  | goto beach; |
|  |  | } |
|  |  | op->len += n; |
|  |  | if (txt) { |
|  |  | if (txt && opdef->txt) { |
|  |  | RStrBuf \*sb = r\_strbuf\_new (""); |
|  |  | if (sb) { |
|  |  | r\_strbuf\_setf (sb, "%s %d ", opdef->txt, count); |
| Expand Down  Expand Up | | @@ -724,7 +721,7 @@ R\_IPI int wasm\_dis(WasmOp \*op, const ut8 \*buf, int buf\_len, bool txt) { |
|  |  | goto err; |
|  |  | } |
|  |  | reserved &= 0x1; |
|  |  | if (txt) { |
|  |  | if (txt && opdef->txt) { |
|  |  | op->txt = r\_str\_newf ("%s %d %d", opdef->txt, val, reserved); |
|  |  | } |
|  |  | op->len += n; |
| Expand All | | @@ -741,7 +738,7 @@ R\_IPI int wasm\_dis(WasmOp \*op, const ut8 \*buf, int buf\_len, bool txt) { |
|  |  | if (!(n > 0 && n < buf\_len)) { |
|  |  | goto err; |
|  |  | } |
|  |  | if (txt) { |
|  |  | if (txt && opdef->txt) { |
|  |  | op->txt = r\_str\_newf ("%s %d", opdef->txt, val); |
|  |  | } |
|  |  | op->len += n; |
| Expand Down  Expand Up | | @@ -781,7 +778,7 @@ R\_IPI int wasm\_dis(WasmOp \*op, const ut8 \*buf, int buf\_len, bool txt) { |
|  |  | if (!(n > 0 && op->len + n <= buf\_len)) { |
|  |  | goto err; |
|  |  | } |
|  |  | if (txt) { |
|  |  | if (txt && opdef->txt) { |
|  |  | op->txt = r\_str\_newf ("%s %d %d", opdef->txt, flag, offset); |
|  |  | } |
|  |  | op->len += n; |
| Expand All | | @@ -796,7 +793,7 @@ R\_IPI int wasm\_dis(WasmOp \*op, const ut8 \*buf, int buf\_len, bool txt) { |
|  |  | goto err; |
|  |  | } |
|  |  | reserved &= 0x1; |
|  |  | if (txt) { |
|  |  | if (txt && opdef->txt) { |
|  |  | op->txt = r\_str\_newf ("%s %d", opdef->txt, reserved); |
|  |  | } |
|  |  | op->len += n; |
| Expand All | | @@ -809,7 +806,7 @@ R\_IPI int wasm\_dis(WasmOp \*op, const ut8 \*buf, int buf\_len, bool txt) { |
|  |  | if (!(n > 0 && n < buf\_len)) { |
|  |  | goto err; |
|  |  | } |
|  |  | if (txt) { |
|  |  | if (txt && opdef->txt) { |
|  |  | op->txt = r\_str\_newf ("%s %" PFMT32d, opdef->txt, val); |
|  |  | } |
|  |  | op->len += n; |
| Expand All | | @@ -822,7 +819,7 @@ R\_IPI int wasm\_dis(WasmOp \*op, const ut8 \*buf, int buf\_len, bool txt) { |
|  |  | if (!(n > 0 && n < buf\_len)) { |
|  |  | goto err; |
|  |  | } |
|  |  | if (txt) { |
|  |  | if (txt && opdef->txt) { |
|  |  | op->txt = r\_str\_newf ("%s %" PFMT64d, opdef->txt, val); |
|  |  | } |
|  |  | op->len += n; |
| Expand All | | @@ -835,7 +832,7 @@ R\_IPI int wasm\_dis(WasmOp \*op, const ut8 \*buf, int buf\_len, bool txt) { |
|  |  | float f; |
|  |  | } u; |
|  |  | u.v = r\_read\_at\_le32 (buf, 1); |
|  |  | if (txt) { |
|  |  | if (txt && opdef->txt) { |
|  |  | op->txt = r\_str\_newf ("%s %f", opdef->txt, u.f); |
|  |  | } |
|  |  | op->len += 4; |
| Expand All | | @@ -850,7 +847,7 @@ R\_IPI int wasm\_dis(WasmOp \*op, const ut8 \*buf, int buf\_len, bool txt) { |
|  |  | double f; |
|  |  | } u; |
|  |  | u.v = r\_read\_at\_le64 (buf, 1); |
|  |  | if (txt) { |
|  |  | if (txt && opdef->txt) { |
|  |  | op->txt = r\_str\_newf ("%s %f", opdef->txt, u.f); |
|  |  | } |
|  |  | op->len += 8; |
| Expand Down  Expand Up | | @@ -936,7 +933,7 @@ R\_IPI int wasm\_dis(WasmOp \*op, const ut8 \*buf, int buf\_len, bool txt) { |
|  |  | if (!(n > 0 && op->len + n <= buf\_len)) { |
|  |  | goto err; |
|  |  | } |
|  |  | if (txt) { |
|  |  | if (txt && opdef->txt) { |
|  |  | op->txt = r\_str\_newf ("%s %d %d", opdef->txt, flag, offset); |
|  |  | } |
|  |  | op->len += n; |
| Expand Down  Expand Up | | @@ -1108,7 +1105,7 @@ R\_IPI int wasm\_dis(WasmOp \*op, const ut8 \*buf, int buf\_len, bool txt) { |
|  |  | case WASM\_OP\_I8X16ABS: |
|  |  | case WASM\_OP\_I16X8ABS: |
|  |  | case WASM\_OP\_I32X4ABS: |
|  |  | if (txt) { |
|  |  | if (txt && opdef->txt) { |
|  |  | op->txt = strdup (opdef->txt); |
|  |  | } |
|  |  | break; |
| Expand Down  Expand Up | | @@ -1136,7 +1133,7 @@ R\_IPI int wasm\_dis(WasmOp \*op, const ut8 \*buf, int buf\_len, bool txt) { |
|  |  | if (!(n > 0 && n < buf\_len)) { |
|  |  | goto err; |
|  |  | } |
|  |  | if (txt) { |
|  |  | if (txt && opdef->txt) { |
|  |  | op->txt = r\_str\_newf ("%s o:%d a:2^%d", opdef->txt, offset, align); |
|  |  | } |
|  |  | } |
| Expand All | | @@ -1156,7 +1153,7 @@ R\_IPI int wasm\_dis(WasmOp \*op, const ut8 \*buf, int buf\_len, bool txt) { |
|  |  | if (txt) { |
|  |  | op->txt = r\_str\_newf ("%s %02x %02x %02x %02x %02x %02x %02x " \ |
|  |  | "%02x %02x %02x %02x %02x %02x %02x %02x %02x", |
|  |  | opdef->txt, bytes[0], bytes[1], bytes[2], bytes[3], |
|  |  | r\_str\_get (opdef->txt), bytes[0], bytes[1], bytes[2], bytes[3], |
|  |  | bytes[4], bytes[5], bytes[6], bytes[7], bytes[8], |
|  |  | bytes[9], bytes[10], bytes[11], bytes[12], bytes[13], |
|  |  | bytes[14], bytes[15]); |
| Expand All | | @@ -1183,7 +1180,7 @@ R\_IPI int wasm\_dis(WasmOp \*op, const ut8 \*buf, int buf\_len, bool txt) { |
|  |  | } |
|  |  | unsigned char lane = buf[1 + simdop\_size]; |
|  |  | ++op->len; |
|  |  | if (txt) { |
|  |  | if (txt && opdef->txt) { |
|  |  | op->txt = r\_str\_newf ("%s %d", opdef->txt, lane); |
|  |  | } |
|  |  | } |
| Expand All | | @@ -1192,6 +1189,9 @@ R\_IPI int wasm\_dis(WasmOp \*op, const ut8 \*buf, int buf\_len, bool txt) { |
|  |  | } else { |
|  |  | goto err; |
|  |  | } |
|  |  | if (txt && !op->txt) { |
|  |  | op->txt = strdup ("incorrect"); |
|  |  | } |
|  |  | return op->len; |
|  |  |  |
|  |  | err: |
| Expand Down | |  |

25 changes: 25 additions & 0 deletions

25
[test/db/anal/wasm](#diff-73565bd6f9f524f645439719b6cc82902363e487536679dba5a23f4916d07db6 "test/db/anal/wasm")

Show comments

[View file](/radareorg/radare2/blob/a15067a8eaa836bcc24b0882712c14d1baa66509/test/db/anal/wasm)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,25 @@ |
|  |  | NAME=wasm crash test |
|  |  | FILE=bins/wasm/nullderef.wasm |
|  |  | CMDS=<<EOF |
|  |  | pd 10 |
|  |  | EOF |
|  |  | EXPECT=<<EOF |
|  |  | ;-- entry0: |
|  |  | ;-- fcn.0: |
|  |  | 0x000000be 4185feff77 i32.const 251657989 |
|  |  | 0x000000c3 fd0f i8x16.splat |
|  |  | 0x000000c5 fda001 incorrect |
|  |  | 0x000000c8 fd64 incorrect |
|  |  | 0x000000ca 0b end |
|  |  | 0x000000cb 00 trap |
|  |  | 0x000000cc 00 trap |
|  |  | 0x000000cd 00 trap |
|  |  | 0x000000ce 00 trap |
|  |  | 0x000000cf 00 trap |
|  |  | EOF |
|  |  | EXPECT\_ERR=<<EOF |
|  |  | ERROR: unknown section id: 13 |
|  |  | ERROR: unknown section id: 109 |
|  |  | EOF |
|  |  | RUN |
|  |  |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `a15067a`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fradareorg%2Fradare2%2Fcommit%2Fa15067a8eaa836bcc24b0882712c14d1baa66509) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_99c76feb_20250115_093254.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fradareorg%2Fradare2%2Fissues%2F21363)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fradareorg%2Fradare2%2Fissues%2F21363)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=radareorg%2Fradare2)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[radareorg](/radareorg)
/
**[radare2](/radareorg/radare2)**
Public

* [Notifications](/login?return_to=%2Fradareorg%2Fradare2) You must be signed in to change notification settings
* [Fork
  3k](/login?return_to=%2Fradareorg%2Fradare2)
* [Star
   21k](/login?return_to=%2Fradareorg%2Fradare2)

* [Code](/radareorg/radare2)
* [Issues
  849](/radareorg/radare2/issues)
* [Pull requests
  26](/radareorg/radare2/pulls)
* [Discussions](/radareorg/radare2/discussions)
* [Actions](/radareorg/radare2/actions)
* [Projects
  0](/radareorg/radare2/projects)
* [Security](/radareorg/radare2/security)
* [Insights](/radareorg/radare2/pulse)

Additional navigation options

* [Code](/radareorg/radare2)
* [Issues](/radareorg/radare2/issues)
* [Pull requests](/radareorg/radare2/pulls)
* [Discussions](/radareorg/radare2/discussions)
* [Actions](/radareorg/radare2/actions)
* [Projects](/radareorg/radare2/projects)
* [Security](/radareorg/radare2/security)
* [Insights](/radareorg/radare2/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fradareorg%2Fradare2%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fradareorg%2Fradare2%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Segmentation fault in wasm\_dis at p/wasm/wasm.c:1112 #21363

Closed

[Q1IQ](/Q1IQ) opened this issue
Feb 20, 2023
· 1 comment

Closed

# [Segmentation fault in wasm\_dis at p/wasm/wasm.c:1112](#top) #21363

[Q1IQ](/Q1IQ) opened this issue
Feb 20, 2023
· 1 comment

## Comments

[![@Q1IQ](https://avatars.githubusercontent.com/u/52093495?s=80&u=7009866e22d1aa82a4f8d29d13cb52d2f186fdf5&v=4)](/Q1IQ)

Copy link

### **[Q1IQ](/Q1IQ)** commented [Feb 20, 2023](#issue-1591704755)

| Description When parsing the wasm file with r2, using the `pd` command may result in a segmentation fault, because `NULL` was incorrectly passed to `strdup`. Environment ``` # date Mon Feb 20 02:38:13 AKST 2023 # r2 -v radare2 5.8.3 0 @ linux-x86-64 git.5.8.3 commit: 5.8.3 build: 2023-02-16__23:25:48 # uname -ms Linux x86_64 ```  Commit : [39f4292](https://github.com/radareorg/radare2/commit/39f42922d806d5519dcbb32dd3a6d313d888bfd6) Proof of concept [poc.wasm](https://github.com/radareorg/radare2/files/10784008/poc.txt) Stack dump ``` pwndbg> r /pwn/poc.wasm Starting program: /usr/local/bin/r2 /pwn/poc.wasm [Thread debugging using libthread_db enabled] Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1". ERROR: unknown section id: 13 ERROR: unknown section id: 109  -- Check your IO plugins with 'r2 -L' [0x000000be]> pd  Program received signal SIGSEGV, Segmentation fault. __strlen_avx2 () at ../sysdeps/x86_64/multiarch/strlen-avx2.S:65 65	../sysdeps/x86_64/multiarch/strlen-avx2.S: No such file or directory. pwndbg> context LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA ─────────────────────────────────────────────────────[ REGISTERS / show-flags off / show-compact-regs off ]──────────────────────────────────────────────────────  RAX  0x0 *RBX  0x555555555640 (__libc_csu_init) ◂— endbr64  RCX  0x0  RDX  0x0  RDI  0x0 *RSI  0x555555680729 ◂— 0x1000005555550000 *R8   0x7ffff6df5852 (wasm_decode) ◂— endbr64 *R9   0x1f *R10  0x555555559010 ◂— 0x6000700070007 *R11  0x7ffff7d95be0 (main_arena+96) —▸ 0x55555582bd80 ◂— 0x0 *R12  0x5555555551c0 (_start) ◂— endbr64 *R13  0x7fffffffe6d0 ◂— 0x2  R14  0x0  R15  0x0  RBP  0x0 *RSP  0x7fffffffcb48 —▸ 0x7ffff7c48383 (strdup+19) ◂— lea r12, [rax + 1] *RIP  0x7ffff7d316e5 (__strlen_avx2+21) ◂— vpcmpeqb ymm1, ymm0, ymmword ptr [rdi] ──────────────────────────────────────────────────────────────[ DISASM / x86-64 / set emulate on ]───────────────────────────────────────────────────────────────  ► 0x7ffff7d316e5 <__strlen_avx2+21>     vpcmpeqb ymm1, ymm0, ymmword ptr [rdi]    0x7ffff7d316e9 <__strlen_avx2+25>     vpmovmskb eax, ymm1    0x7ffff7d316ed <__strlen_avx2+29>     test   eax, eax    0x7ffff7d316ef <__strlen_avx2+31>     jne    __strlen_avx2+272                <__strlen_avx2+272>     ↓    0x7ffff7d317e0 <__strlen_avx2+272>    tzcnt  eax, eax    0x7ffff7d317e4 <__strlen_avx2+276>    add    rax, rdi    0x7ffff7d317e7 <__strlen_avx2+279>    sub    rax, rdx    0x7ffff7d317ea <__strlen_avx2+282>    vzeroupper    0x7ffff7d317ed <__strlen_avx2+285>    ret     0x7ffff7d317ee <__strlen_avx2+286>    nop    0x7ffff7d317f0 <__strlen_avx2+288>    tzcnt  eax, eax ────────────────────────────────────────────────────────────────────────────[ STACK ]──────────────────────────────────────────────────────────────────────────── 00:0000│ rsp 0x7fffffffcb48 —▸ 0x7ffff7c48383 (strdup+19) ◂— lea r12, [rax + 1] 01:0008│     0x7fffffffcb50 —▸ 0x555555680729 ◂— 0x1000005555550000 02:0010│     0x7fffffffcb58 —▸ 0x7fffffffcca0 —▸ 0x7fffffffcd00 —▸ 0x7fffffffcd40 —▸ 0x7fffffffcda0 ◂— ... 03:0018│     0x7fffffffcb60 —▸ 0x5555555551c0 (_start) ◂— endbr64 04:0020│     0x7fffffffcb68 —▸ 0x7ffff6df4574 (wasm_dis+4394) ◂— mov rdx, rax 05:0028│     0x7fffffffcb70 ◂— 0x0 06:0030│     0x7fffffffcb78 —▸ 0x7ffff7d95b80 (main_arena) ◂— 0x0 07:0038│     0x7fffffffcb80 —▸ 0x555555782140 ◂— '       dd ' ──────────────────────────────────────────────────────────────────────────[ BACKTRACE ]──────────────────────────────────────────────────────────────────────────  ► f 0   0x7ffff7d316e5 __strlen_avx2+21    f 1   0x7ffff7c48383 strdup+19    f 2   0x7ffff6df4574 wasm_dis+4394    f 3   0x7ffff6df5906 wasm_decode+180    f 4   0x7ffff6da22dd r_arch_decode+136    f 5   0x7ffff64ed2e1 r_anal_op+580    f 6   0x7ffff7827c22 r_core_print_disasm+2478    f 7   0x7ffff7772b54 cmd_print+15553 ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── pwndbg> bt #0  __strlen_avx2 () at ../sysdeps/x86_64/multiarch/strlen-avx2.S:65 #1  0x00007ffff7c48383 in __GI___strdup (s=0x0) at strdup.c:41 #2  0x00007ffff6df4574 in wasm_dis (op=0x7fffffffcce0, buf=0x555555680630 "\375\240\001\375d\v", buf_len=249, txt=true) at p/wasm/wasm.c:1112 #3  0x00007ffff6df5906 in wasm_decode (s=0x555555677b10, op=0x555555781c10, mask=R_ARCH_OP_MASK_ALL) at p/wasm/plugin.c:366 #4  0x00007ffff6da22dd in r_arch_decode (a=0x55555559a320, op=0x555555781c10, mask=31) at arch.c:225 #5  0x00007ffff64ed2e1 in r_anal_op (anal=0x55555559c910, op=0x555555781c10, addr=197, data=0x555555559937 "\375\240\001\375d\v", len=249, mask=R_ARCH_OP_MASK_ALL) at op.c:113 #6  0x00007ffff7827c22 in r_core_print_disasm (core=0x7ffff5dea010, addr=190, buf=0x555555559930 "A\205\376\377w\375\017\375\240\001\375d\v", len=256, count=64, pdu_condition_type=pdu_instruction, pdu_condition=0x0, count_bytes=false, json=false, pj=0x0, pdf=0x0) at disasm.c:5727 #7  0x00007ffff7772b54 in cmd_print (data=0x7ffff5dea010, input=0x55555574ff61 "d") at cmd_print.c:6708 #8  0x00007ffff77ef9dc in r_cmd_call (cmd=0x5555555e6ff0, input=0x55555574ff60 "pd") at cmd_api.c:520 #9  0x00007ffff778ca90 in r_core_cmd_subst_i (core=0x7ffff5dea010, cmd=0x55555574ff60 "pd", colon=0x0, tmpseek=0x7fffffffe114) at cmd.c:4930 #10 0x00007ffff77882cb in r_core_cmd_subst (core=0x7ffff5dea010, cmd=0x55555574ff60 "pd") at cmd.c:3760 #11 0x00007ffff778fcd2 in run_cmd_depth (core=0x7ffff5dea010, cmd=0x55555574ef30 "pd") at cmd.c:5829 #12 0x00007ffff779017b in r_core_cmd (core=0x7ffff5dea010, cstr=0x55555574eef0 "pd", log=true) at cmd.c:5913 #13 0x00007ffff76ab199 in r_core_prompt_exec (r=0x7ffff5dea010) at core.c:3556 #14 0x00007ffff76aa6ea in r_core_prompt_loop (r=0x7ffff5dea010) at core.c:3374 #15 0x00007ffff7dc7c9f in r_main_radare2 (argc=2, argv=0x7fffffffe6d8) at radare2.c:1700 #16 0x0000555555555638 in main (argc=2, argv=0x7fffffffe6d8) at radare2.c:104 #17 0x00007ffff7bcd083 in __libc_start_main (main=0x5555555555e0 <main>, argc=2, argv=0x7fffffffe6d8, init=<optimized out>, fini=<optimized out>, rtld_fini=<optimized out>, stack_end=0x7fffffffe6c8) at ../csu/libc-start.c:308 #18 0x00005555555551ee in _start ()  ``` Credit Q1IQ([@Q1IQ](https://github.com/Q1IQ)) |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@trufae](https://avatars.githubusercontent.com/u/6431515?s=80&u=3cd535c1b15121d2a3faec6d57867b9d667cc696&v=4)](/trufae)

Copy link

Collaborator

### **[trufae](/trufae)** commented [Feb 20, 2023](#issuecomment-1436935077)

| thanks! |
| --- |

All reactions

Sorry, something went wrong.

[![@trufae](https://avatars.githubusercontent.com/u/6431515?s=40&u=3cd535c1b15121d2a3faec6d57867b9d667cc696&v=4)](/trufae)
[trufae](/trufae)
closed this as [completed](/radareorg/radare2/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
`[13308c9](/radareorg/radare2/commit/13308c9aad79f9c7a3507ce549fe270103e8ceea)`
[Feb 20, 2023](#event-8561172726)

[trufae](/trufae)
pushed a commit
that referenced
this issue
[Feb 20, 2023](#ref-commit-a15067a)
[![@radare](https://avatars.githubusercontent.com/u/917142?s=40&u=ff3cb2635d392e234764a575e3c3acaf3b1257cd&v=4)](/radare)

`[Fix](/radareorg/radare2/commit/a15067a8eaa836bcc24b0882712c14d1baa66509 "Fix #21363 - null deref in the wasm disassembler ##crash") [#21363](https://github.com/radareorg/radare2/issues/21363) [- null deref in the wasm disassembler ##crash](/radareorg/radare2/commit/a15067a8eaa836bcc24b0882712c14d1baa66509 "Fix #21363 - null deref in the wasm disassembler ##crash")`

`[a15067a](/radareorg/radare2/commit/a15067a8eaa836bcc24b0882712c14d1baa66509)`

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fradareorg%2Fradare2%2Fissues%2F21363)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

2 participants

[![@trufae](https://avatars.githubusercontent.com/u/6431515?s=52&v=4)](/trufae) [![@Q1IQ](https://avatars.githubusercontent.com/u/52093495?s=52&v=4)](/Q1IQ)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


