=== Content from github.com_06e1d9e0_20250114_191410.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxcat2%2Fxcat-core%2Fpull%2F7247)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxcat2%2Fxcat-core%2Fpull%2F7247)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=xcat2%2Fxcat-core)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[xcat2](/xcat2)
/
**[xcat-core](/xcat2/xcat-core)**
Public

* [Notifications](/login?return_to=%2Fxcat2%2Fxcat-core) You must be signed in to change notification settings
* [Fork
  174](/login?return_to=%2Fxcat2%2Fxcat-core)
* [Star
   372](/login?return_to=%2Fxcat2%2Fxcat-core)

* [Code](/xcat2/xcat-core)
* [Issues
  336](/xcat2/xcat-core/issues)
* [Pull requests
  17](/xcat2/xcat-core/pulls)
* [Discussions](/xcat2/xcat-core/discussions)
* [Actions](/xcat2/xcat-core/actions)
* [Projects
  0](/xcat2/xcat-core/projects)
* [Wiki](/xcat2/xcat-core/wiki)
* [Security](/xcat2/xcat-core/security)
* [Insights](/xcat2/xcat-core/pulse)

Additional navigation options

* [Code](/xcat2/xcat-core)
* [Issues](/xcat2/xcat-core/issues)
* [Pull requests](/xcat2/xcat-core/pulls)
* [Discussions](/xcat2/xcat-core/discussions)
* [Actions](/xcat2/xcat-core/actions)
* [Projects](/xcat2/xcat-core/projects)
* [Wiki](/xcat2/xcat-core/wiki)
* [Security](/xcat2/xcat-core/security)
* [Insights](/xcat2/xcat-core/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fxcat2%2Fxcat-core%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fxcat2%2Fxcat-core%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Have server enforce SSH zone separation #7247

 Merged

[besawn](/besawn)
merged 1 commit into
[xcat2:master](/xcat2/xcat-core/tree/master "xcat2/xcat-core:master")
from
[jjohnson42:restrictsshzone](/jjohnson42/xcat-core/tree/restrictsshzone "jjohnson42/xcat-core:restrictsshzone")

Nov 4, 2022

 Merged

# [Have server enforce SSH zone separation](#top) #7247

[besawn](/besawn)
merged 1 commit into
[xcat2:master](/xcat2/xcat-core/tree/master "xcat2/xcat-core:master")
from
[jjohnson42:restrictsshzone](/jjohnson42/xcat-core/tree/restrictsshzone "jjohnson42/xcat-core:restrictsshzone")

Nov 4, 2022

[Conversation
1](/xcat2/xcat-core/pull/7247)
[Commits
1](/xcat2/xcat-core/pull/7247/commits)
[Checks
0](/xcat2/xcat-core/pull/7247/checks)
[Files changed](/xcat2/xcat-core/pull/7247/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![jjohnson42](https://avatars.githubusercontent.com/u/10814490?s=60&v=4)](/jjohnson42)

Copy link

Member

### @jjohnson42 **[jjohnson42](/jjohnson42)** commented [Sep 9, 2022](#issue-1368094643)

When a client requests a zone's ssh credentials, make sure the client is consistent with the specified zone.

Per github user salben21

### The PR is to fix issue 7246

### The modification include

*##item1*

*##item2*

### The UT result

`##The UT output##`

# Please remove this line and below if fix issue

# Please remove this line and above for tasks or features

### The PR is for task *#xxx* or to implement feature #xxx

*##Feature description##*

### The content of the PR:

* *##The mini-design link*
* *##The basic code logic*

### The UT result

`##The UT output##`

Sorry, something went wrong.

All reactions

[![@jjohnson42](https://avatars.githubusercontent.com/u/10814490?s=40&v=4)](/jjohnson42)

`[Have server enforce SSH zone separation](/xcat2/xcat-core/pull/7247/commits/85149c37f49dbca7bd85f1f586960315604fc024 "Have server enforce SSH zone separation

When a client requests a zone's ssh credentials, make sure the
client is consistent with the specified zone.

Per github user salben21")`
 …

`[85149c3](/xcat2/xcat-core/pull/7247/commits/85149c37f49dbca7bd85f1f586960315604fc024)`

```
When a client requests a zone's ssh credentials, make sure the
client is consistent with the specified zone.

Per github user salben21
```

[![@jjohnson42](https://avatars.githubusercontent.com/u/10814490?s=40&v=4)](/jjohnson42)
[jjohnson42](/jjohnson42)
mentioned this pull request
[Sep 9, 2022](#ref-issue-1362210362)

[Unsufficient check in credentials.pm
#7246](/xcat2/xcat-core/issues/7246)

Closed

[![besawn](https://avatars.githubusercontent.com/u/38794505?s=60&v=4)](/besawn)

**[besawn](/besawn)**
approved these changes
[Nov 4, 2022](#pullrequestreview-1169219584)

 [View reviewed changes](/xcat2/xcat-core/pull/7247/files/85149c37f49dbca7bd85f1f586960315604fc024)

Copy link

Member

### @besawn **[besawn](/besawn)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I tested the conditions described in the original issue ([#7246](https://github.com/xcat2/xcat-core/issues/7246)) and the fix contained in this pull request.

The change in this pull request adds additional checking to enforce the following:

1.) Disallow distribution of root keys between zones.

2.) Disallow distribution of root keys within a zone when sshbetweennodes=no for that zone.

Thank you [@salben21](https://github.com/salben21) and [@jjohnson42](https://github.com/jjohnson42) for the contributions.

Sorry, something went wrong.

All reactions

[![@besawn](https://avatars.githubusercontent.com/u/38794505?s=40&v=4)](/besawn)
[besawn](/besawn)
merged commit [`d58445a`](/xcat2/xcat-core/commit/d58445a685159b5e59a4a8f07939f6326708b7fc)
into
xcat2:master

[Nov 4, 2022](https://github.com/xcat2/xcat-core/pull/7247#event-7744165107)

[![@besawn](https://avatars.githubusercontent.com/u/38794505?s=40&v=4)](/besawn)
[besawn](/besawn)
added this to the [2.16.5](/xcat2/xcat-core/milestone/51) milestone
[Nov 4, 2022](#event-7744170060)

[![@besawn](https://avatars.githubusercontent.com/u/38794505?s=40&v=4)](/besawn)
[besawn](/besawn)
added
the
[component:security](/xcat2/xcat-core/labels/component%3Asecurity)
label
[Nov 4, 2022](#event-7744172879)

[![@besawn](https://avatars.githubusercontent.com/u/38794505?s=40&v=4)](/besawn)
[besawn](/besawn)
linked an issue
[Mar 7, 2023](#event-8689292016)
that may be
closed
by this pull request

[Unsufficient check in credentials.pm
#7246](/xcat2/xcat-core/issues/7246)

Closed

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fxcat2%2Fxcat-core%2Fpull%2F7247)

Reviewers

[![@besawn](https://avatars.githubusercontent.com/u/38794505?s=40&v=4)](/besawn) [besawn](/besawn)

besawn approved these changes

Assignees

No one assigned

Labels

[component:security](/xcat2/xcat-core/labels/component%3Asecurity)

Projects

None yet

Milestone

 [**2.16.5**](/xcat2/xcat-core/milestone/51 "2.16.5")

Development

Successfully merging this pull request may close these issues.

 [Unsufficient check in credentials.pm](https://github.com/xcat2/xcat-core/issues/7246)

2 participants

[![@jjohnson42](https://avatars.githubusercontent.com/u/10814490?s=52&v=4)](/jjohnson42) [![@besawn](https://avatars.githubusercontent.com/u/38794505?s=52&v=4)](/besawn)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_13c33a87_20250114_191410.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxcat2%2Fxcat-core%2Fissues%2F7246)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxcat2%2Fxcat-core%2Fissues%2F7246)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=xcat2%2Fxcat-core)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[xcat2](/xcat2)
/
**[xcat-core](/xcat2/xcat-core)**
Public

* [Notifications](/login?return_to=%2Fxcat2%2Fxcat-core) You must be signed in to change notification settings
* [Fork
  174](/login?return_to=%2Fxcat2%2Fxcat-core)
* [Star
   372](/login?return_to=%2Fxcat2%2Fxcat-core)

* [Code](/xcat2/xcat-core)
* [Issues
  336](/xcat2/xcat-core/issues)
* [Pull requests
  17](/xcat2/xcat-core/pulls)
* [Discussions](/xcat2/xcat-core/discussions)
* [Actions](/xcat2/xcat-core/actions)
* [Projects
  0](/xcat2/xcat-core/projects)
* [Wiki](/xcat2/xcat-core/wiki)
* [Security](/xcat2/xcat-core/security)
* [Insights](/xcat2/xcat-core/pulse)

Additional navigation options

* [Code](/xcat2/xcat-core)
* [Issues](/xcat2/xcat-core/issues)
* [Pull requests](/xcat2/xcat-core/pulls)
* [Discussions](/xcat2/xcat-core/discussions)
* [Actions](/xcat2/xcat-core/actions)
* [Projects](/xcat2/xcat-core/projects)
* [Wiki](/xcat2/xcat-core/wiki)
* [Security](/xcat2/xcat-core/security)
* [Insights](/xcat2/xcat-core/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fxcat2%2Fxcat-core%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fxcat2%2Fxcat-core%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Unsufficient check in credentials.pm #7246

Closed

[salben21](/salben21) opened this issue
Sep 5, 2022
· 9 comments
 · Fixed by [#7247](https://github.com/xcat2/xcat-core/pull/7247)

Closed

# [Unsufficient check in credentials.pm](#top) #7246

[salben21](/salben21) opened this issue
Sep 5, 2022
· 9 comments
 · Fixed by [#7247](https://github.com/xcat2/xcat-core/pull/7247)

Assignees
[![@besawn](https://avatars.githubusercontent.com/u/38794505?s=40&v=4)](/besawn)

Labels
[component:security](/xcat2/xcat-core/labels/component%3Asecurity)

Milestone
[2.16.5](/xcat2/xcat-core/milestone/51 "2.16.5")

## Comments

[![@salben21](https://avatars.githubusercontent.com/u/112888685?s=80&v=4)](/salben21)

Copy link

### **[salben21](/salben21)** commented [Sep 5, 2022](#issue-1362210362)

| Hi, I recognize that one can request the ssh\_root\_key's of every zone from every client independently of its zone affiliation by a simple script using getcredentials.awk and allowcred.awk. This is a security issue if you use multiple zones with sshbetweenodes=no to avoid a privilege escalation to other nodes.  It seems that in credentials.pm of the xcatd following checks are missing:  If a ssh\_root\_key was requested check   * if the client is in the zone of the requested key's zone otherwise reject the request. * if the sshbetweennodes is set to yes in the requested zone, otherwise reject the request   best |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@salben21](https://avatars.githubusercontent.com/u/112888685?s=80&v=4)](/salben21)

Copy link

Author

### **[salben21](/salben21)** commented [Sep 6, 2022](#issuecomment-1238474529)

| Workaround for xCAT-server/lib/xcat/plugins/credentials.pm from my side  ```     if ((($parm =~ /^ssh_root_key/) || ($parm =~ /^ssh_root_pub_key/)) && ($foundkeys == 0)) {         my ($rootkeyparm, $zonename) = split(/:/, $parm);         my $client_zonename=xCAT::Zone->getmyzonename($client);                  if ($zonename) {             $parm = $rootkeyparm;           # take the zone off             xCAT::MsgUtils->trace(0, 'I', "credentials: The node ($client) is asking for sshkeys of zone: $zonename.");             if ($client_zonename eq $zonename) {               my $sshbetweenodes_allowed = xCAT::Zone->enableSSHbetweennodes($client);               if (($sshbetweenodes_allowed == 1) || ($parm =~ /^ssh_root_pub_key/)) { # check if sshbetweennodes is allowed or pub key is requested                 $sshrootkeydir = xCAT::Zone->getzonekeydir($zonename);                 if ($sshrootkeydir == 1) {      # error return                     xCAT::MsgUtils->trace(0, 'W', "credentials: The zone: $zonename is not defined.");                 } else {                     $foundkeys = 1;    # don't want to read the zone data twice                 }               } else {                   xCAT::MsgUtils->trace(0, 'E', "credentials: Not allowed to read root's private ssh key because sshbetweennodes is disabled.");                   $sshrootkeydir = 1;               }             } else {                 xCAT::MsgUtils->trace(0, 'E', "credentials: Not allowed to read root's private ssh key of different zone.");                 $sshrootkeydir = 1;             }         } elsif ($client_zonename) { # check if no zonename is submitted but node is in a zone             xCAT::MsgUtils->trace(0, 'E', "credentials: Not allowed to read root's private ssh key of default zone.");             $sshrootkeydir = 1;         }     }  ```  instead of  ```     if ((($parm =~ /^ssh_root_key/) || ($parm =~ /^ssh_root_pub_key/)) && ($foundkeys == 0)) {         my ($rootkeyparm, $zonename) = split(/:/, $parm);         if ($zonename) {             $parm = $rootkeyparm;           # take the zone off             xCAT::MsgUtils->trace(0, 'I', "credentials: The node ($client) is asking for sshkeys of zone: $zonename.");             $sshrootkeydir = xCAT::Zone->getzonekeydir($zonename);             if ($sshrootkeydir == 1) {      # error return                 xCAT::MsgUtils->trace(0, 'W', "credentials: The zone: $zonename is not defined.");             } else {                 $foundkeys = 1;    # don't want to read the zone data twice             }         }     }  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@salben21](https://avatars.githubusercontent.com/u/112888685?s=80&v=4)](/salben21)

Copy link

Author

### **[salben21](/salben21)** commented [Sep 7, 2022](#issuecomment-1239074906)

| By the way: The argument in the description of the function enableSSHbetweennodes in the file [https://github.com/xcat2/xcat-core/tree/master/perl-xCAT/xCAT/Zone.pm] is *nodename* and not *zonename*  =head3 enableSSHbetweennodes Arguments: ~~zonename~~nodename Returns: 1 if the sshbetweennodes attribute is yes/1 or undefined 0 if the sshbetweennodes attribute is no/0 Example: xCAT::Zone->enableSSHbetweennodes(~~$zonename~~$nodename); =cut |
| --- |

All reactions

Sorry, something went wrong.

[![@jjohnson42](https://avatars.githubusercontent.com/u/10814490?s=80&v=4)](/jjohnson42)

Copy link

Member

### **[jjohnson42](/jjohnson42)** commented [Sep 9, 2022](#issuecomment-1241975601)

| BTW, I would be interested on your feedback on the confluent ssh design.  In confluent, no user private keys for root or any other user are ever shared. Same for private host keys, nodes generate their own.  Instead, confluent grants host certificates, sets up host based authentication based on the host certificates, and uses shosts.equiv to implement a variant of 'zones' (in confluent, it's "trustnodes", meaning that you can have asymettric zoning where, for example, the compute could trust the storage without storage trusting the compute).  Further, it implements a context aware where once a node security token is granted, it locks down the interface so that it can't be used, and getting ssh certs requires the initial token. |
| --- |

All reactions

Sorry, something went wrong.

[![@jjohnson42](https://avatars.githubusercontent.com/u/10814490?s=80&v=4)](/jjohnson42)

Copy link

Member

### **[jjohnson42](/jjohnson42)** commented [Sep 9, 2022](#issuecomment-1241975918)

| Oh, and you may want to make this a pull request, it seems straightforward enough to me. |
| --- |

All reactions

Sorry, something went wrong.

[![@jjohnson42](https://avatars.githubusercontent.com/u/10814490?s=40&v=4)](/jjohnson42)
[jjohnson42](/jjohnson42)
added
the
[component:security](/xcat2/xcat-core/labels/component%3Asecurity)
label
[Sep 9, 2022](#event-7356706927)

[![@salben21](https://avatars.githubusercontent.com/u/112888685?s=80&v=4)](/salben21)

Copy link

Author

### **[salben21](/salben21)** commented [Sep 9, 2022](#issuecomment-1242062711) via email • edited Loading

| thanks for the fast reply. If you can make a pull request it would be fine (otherwise I have to fill out the papers). Attached is the latest version of my patch for credetials.pm (I've improved the check when the zone is empty) in a zip file. have a nice weekend, |
| --- |

All reactions

Sorry, something went wrong.

[![@salben21](https://avatars.githubusercontent.com/u/112888685?s=80&v=4)](/salben21)

Copy link

Author

### **[salben21](/salben21)** commented [Sep 9, 2022](#issuecomment-1242069634)

| Here the latest release of the changes:  ```     if ((($parm =~ /^ssh_root_key/) || ($parm =~ /^ssh_root_pub_key/)) && ($foundkeys == 0)) {         my ($rootkeyparm, $zonename) = split(/:/, $parm);         my $client_zonename = xCAT::Zone->getmyzonename($client);         my $default_zonename = xCAT::Zone->getdefaultzone();                  if ($zonename) {             $parm = $rootkeyparm;           # take the zone off             xCAT::MsgUtils->trace(0, 'I', "credentials: The node ($client) is asking for sshkeys of zone: $zonename.");             if ($client_zonename eq $zonename) {                 my $sshbetweenodes_allowed = xCAT::Zone->enableSSHbetweennodes($client);                 if (($sshbetweenodes_allowed == 1) || ($parm =~ /^ssh_root_pub_key/)) { # check if sshbetweennodes is allowed or pub key is requested                     $sshrootkeydir = xCAT::Zone->getzonekeydir($zonename);                     if ($sshrootkeydir == 1) {    # error return                         xCAT::MsgUtils->trace(0, 'W', "credentials: The zone: $zonename is not defined.");                     } else {                         $foundkeys = 1; # don't want to read the zone data twice                     }                 } else {                     xCAT::MsgUtils->trace(0, 'E', "credentials: Not allowed to read root's private ssh key because sshbetweennodes is disabled.");                     $sshrootkeydir = 1;                 }             } else {                 xCAT::MsgUtils->trace(0, 'E', "credentials: Not allowed to read root's private ssh key of different zone.");                 $sshrootkeydir = 1;             }         } elsif ($client_zonename ne $default_zonename) { # check if no zonename is submitted but node is not in default zone             xCAT::MsgUtils->trace(0, 'E', "credentials: Not allowed to read root's private ssh key of default zone.");             $sshrootkeydir = 1;         }     }  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@salben21](https://avatars.githubusercontent.com/u/112888685?s=80&v=4)](/salben21)

Copy link

Author

### **[salben21](/salben21)** commented [Sep 9, 2022](#issuecomment-1242090258)

| Regarding confluent: I didn't dig in the code of confluent. Sorry. |
| --- |

All reactions

Sorry, something went wrong.

[![@jjohnson42](https://avatars.githubusercontent.com/u/10814490?s=80&v=4)](/jjohnson42)

Copy link

Member

### **[jjohnson42](/jjohnson42)** commented [Sep 9, 2022](#issuecomment-1242232304)

| Ok, my attempt of incorporating changes as a pull request: [#7247](https://github.com/xcat2/xcat-core/pull/7247)  Broadly speaking, at least for my part I'm working towards a broadly more hardened design in confluent for these features, and if there is interest in discussion of those security design points, let me know. I hope it is found to be a broadly more secure approach. |
| --- |

All reactions

Sorry, something went wrong.

[![@besawn](https://avatars.githubusercontent.com/u/38794505?s=40&v=4)](/besawn)
[besawn](/besawn)
self-assigned this
[Nov 4, 2022](#event-7744168747)

[![@besawn](https://avatars.githubusercontent.com/u/38794505?s=40&v=4)](/besawn)
[besawn](/besawn)
added this to the [2.16.5](/xcat2/xcat-core/milestone/51) milestone
[Nov 4, 2022](#event-7744169072)

[![@besawn](https://avatars.githubusercontent.com/u/38794505?s=40&v=4)](/besawn)
[besawn](/besawn)
mentioned this issue
[Nov 15, 2022](#ref-pullrequest-1450230632)

[Minor documentation updates
#7287](/xcat2/xcat-core/pull/7287)
 Merged

[![@gurevichmark](https://avatars.githubusercontent.com/u/16106630?s=40&u=f2385c7f230b05b254eea2bd6cffafee6f3012b0&v=4)](/gurevichmark)
[gurevichmark](/gurevichmark)
modified the milestones:
[2.16.5](/xcat2/xcat-core/milestone/51),
[2.16.6](/xcat2/xcat-core/milestone/52)
[Mar 3, 2023](#event-8663034395)

[![@besawn](https://avatars.githubusercontent.com/u/38794505?s=40&v=4)](/besawn)
[besawn](/besawn)
modified the milestones:
[2.16.6](/xcat2/xcat-core/milestone/52),
[2.16.5](/xcat2/xcat-core/milestone/51)
[Mar 7, 2023](#event-8689280478)

[![@besawn](https://avatars.githubusercontent.com/u/38794505?s=80&v=4)](/besawn)

Copy link

Member

### **[besawn](/besawn)** commented [Mar 7, 2023](#issuecomment-1458658071)

| This issue is fixed in xCAT 2.16.5. |
| --- |

All reactions

Sorry, something went wrong.

[![@besawn](https://avatars.githubusercontent.com/u/38794505?s=40&v=4)](/besawn)
[besawn](/besawn)
closed this as [completed](/xcat2/xcat-core/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Mar 7, 2023](#event-8689284395)

[![@besawn](https://avatars.githubusercontent.com/u/38794505?s=40&v=4)](/besawn)
[besawn](/besawn)
linked a pull request
[Mar 7, 2023](#event-8689292040)
that will
close
this issue

[Have server enforce SSH zone separation
#7247](/xcat2/xcat-core/pull/7247)
 Merged

2 tasks

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fxcat2%2Fxcat-core%2Fissues%2F7246)

Assignees

[![@besawn](https://avatars.githubusercontent.com/u/38794505?s=40&v=4)](/besawn) [besawn](/besawn)

Labels

[component:security](/xcat2/xcat-core/labels/component%3Asecurity)

Projects

None yet

Milestone

 [**2.16.5**](/xcat2/xcat-core/milestone/51 "2.16.5")

Development

Successfully merging a pull request may close this issue.

 [Have server enforce SSH zone separation](/xcat2/xcat-core/pull/7247)
 [jjohnson42/xcat-core](/jjohnson42/xcat-core)

4 participants

[![@jjohnson42](https://avatars.githubusercontent.com/u/10814490?s=52&v=4)](/jjohnson42) [![@gurevichmark](https://avatars.githubusercontent.com/u/16106630?s=52&v=4)](/gurevichmark) [![@besawn](https://avatars.githubusercontent.com/u/38794505?s=52&v=4)](/besawn) [![@salben21](https://avatars.githubusercontent.com/u/112888685?s=52&v=4)](/salben21)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_232f5358_20250114_191412.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxcat2%2Fxcat-core%2Fsecurity%2Fadvisories%2FGHSA-hpxg-7428-6jvv)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxcat2%2Fxcat-core%2Fsecurity%2Fadvisories%2FGHSA-hpxg-7428-6jvv)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=xcat2%2Fxcat-core)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[xcat2](/xcat2)
/
**[xcat-core](/xcat2/xcat-core)**
Public

* [Notifications](/login?return_to=%2Fxcat2%2Fxcat-core) You must be signed in to change notification settings
* [Fork
  174](/login?return_to=%2Fxcat2%2Fxcat-core)
* [Star
   372](/login?return_to=%2Fxcat2%2Fxcat-core)

* [Code](/xcat2/xcat-core)
* [Issues
  336](/xcat2/xcat-core/issues)
* [Pull requests
  17](/xcat2/xcat-core/pulls)
* [Discussions](/xcat2/xcat-core/discussions)
* [Actions](/xcat2/xcat-core/actions)
* [Projects
  0](/xcat2/xcat-core/projects)
* [Wiki](/xcat2/xcat-core/wiki)
* [Security](/xcat2/xcat-core/security)
* [Insights](/xcat2/xcat-core/pulse)

Additional navigation options

* [Code](/xcat2/xcat-core)
* [Issues](/xcat2/xcat-core/issues)
* [Pull requests](/xcat2/xcat-core/pulls)
* [Discussions](/xcat2/xcat-core/discussions)
* [Actions](/xcat2/xcat-core/actions)
* [Projects](/xcat2/xcat-core/projects)
* [Wiki](/xcat2/xcat-core/wiki)
* [Security](/xcat2/xcat-core/security)
* [Insights](/xcat2/xcat-core/pulse)

# Insufficient authorization validation between zones when xCAT zones are enabled

High

[besawn](/besawn)
published
GHSA-hpxg-7428-6jvv
Mar 8, 2023

## Package

xCAT-server

## Affected versions

< 2.16.5

## Patched versions

2.16.5

## Description

The xCAT zones feature can be used to divide groups of nodes in the cluster into multiple zones that have independent ssh keys. xCAT zones are optional and not enabled by default. If zones are configured in xCAT, it is possible for a root user from one node to obtain ssh keys from other zones and SSH to any node in any zone, breaking the zone enforcement.

### Impact

Only users that use the optional zones feature are impacted. All versions of xCAT prior to xCAT 2.16.5 are vulnerable.

### Patches

The issue has been fixed in xCAT 2.16.5. Users making use of zones should upgrade to xCAT 2.16.5.

### Workarounds

The problem can be worked around by disabling zones or patching the management node with the fix contained in [#7247](https://github.com/xcat2/xcat-core/pull/7247).

### Acknowledgement

We would like to thank Dr. Stefan Albensoeder (Enercon) for reporting this issue, as well as contributing to the fix.

### References

[#7246](https://github.com/xcat2/xcat-core/issues/7246)

[#7247](https://github.com/xcat2/xcat-core/pull/7247)

### Severity

High

7.2

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
High

User interaction
None

Scope
Unchanged

Confidentiality
High

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H

### CVE ID

CVE-2023-27486

### Weaknesses

No CWEs

### Credits

* [![@salben21](https://avatars.githubusercontent.com/u/112888685?s=40&v=4)](/salben21)
  [salben21](/salben21)
  Remediation developer

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_2d9eb94d_20250114_191412.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxcat2%2Fxcat-core%2Fpull%2F7247%2Fcommits%2F85149c37f49dbca7bd85f1f586960315604fc024)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxcat2%2Fxcat-core%2Fpull%2F7247%2Fcommits%2F85149c37f49dbca7bd85f1f586960315604fc024)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fpull_requests%2Fshow%2Fcommits&source=header-repo&source_repo=xcat2%2Fxcat-core)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[xcat2](/xcat2)
/
**[xcat-core](/xcat2/xcat-core)**
Public

* [Notifications](/login?return_to=%2Fxcat2%2Fxcat-core) You must be signed in to change notification settings
* [Fork
  174](/login?return_to=%2Fxcat2%2Fxcat-core)
* [Star
   372](/login?return_to=%2Fxcat2%2Fxcat-core)

* [Code](/xcat2/xcat-core)
* [Issues
  336](/xcat2/xcat-core/issues)
* [Pull requests
  17](/xcat2/xcat-core/pulls)
* [Discussions](/xcat2/xcat-core/discussions)
* [Actions](/xcat2/xcat-core/actions)
* [Projects
  0](/xcat2/xcat-core/projects)
* [Wiki](/xcat2/xcat-core/wiki)
* [Security](/xcat2/xcat-core/security)
* [Insights](/xcat2/xcat-core/pulse)

Additional navigation options

* [Code](/xcat2/xcat-core)
* [Issues](/xcat2/xcat-core/issues)
* [Pull requests](/xcat2/xcat-core/pulls)
* [Discussions](/xcat2/xcat-core/discussions)
* [Actions](/xcat2/xcat-core/actions)
* [Projects](/xcat2/xcat-core/projects)
* [Wiki](/xcat2/xcat-core/wiki)
* [Security](/xcat2/xcat-core/security)
* [Insights](/xcat2/xcat-core/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fxcat2%2Fxcat-core%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fxcat2%2Fxcat-core%2Fissues%2Fnew%2Fchoose)
to your account

# Have server enforce SSH zone separation #7247

 Merged

[besawn](/besawn)
merged 1 commit into
[xcat2:master](/xcat2/xcat-core/tree/master "xcat2/xcat-core:master")
from
[jjohnson42:restrictsshzone](/jjohnson42/xcat-core/tree/restrictsshzone "jjohnson42/xcat-core:restrictsshzone")

Nov 4, 2022

[Conversation
1](/xcat2/xcat-core/pull/7247)
[Commits
1](/xcat2/xcat-core/pull/7247/commits)
[Checks
0](/xcat2/xcat-core/pull/7247/checks)
[Files changed](/xcat2/xcat-core/pull/7247/files)

 Merged

# [Have server enforce SSH zone separation](#top) #7247

 Changes from **all commits**

Commits

[Show all changes

1 commit](/xcat2/xcat-core/pull/7247/files)
Select commit

[`85149c3`
Have server enforce SSH zone separation

jjohnson42 Sep 9, 2022](/xcat2/xcat-core/pull/7247/commits/85149c37f49dbca7bd85f1f586960315604fc024)

**File filter**

### Filter by extension

Filter by extension

.pm
(1)

All 1 file type selected

---

Viewed files

[Clear filters](/xcat2/xcat-core/pull/7247/commits/85149c37f49dbca7bd85f1f586960315604fc024)

 **Conversations**

Failed to load comments.  Retry

 Loading

 **Jump to**

Jump to file

Failed to load files.  Retry

 Loading

##### Diff view

![Unified Diff View](https://github.githubassets.com/assets/unified-6de447b07fd7.svg)

Unified

![Split Diff View](https://github.githubassets.com/assets/split-b930d4a1df45.svg)

Split

Hide whitespace

 Apply and reload

Show whitespace

##### Diff view

![Unified Diff View](https://github.githubassets.com/assets/unified-6de447b07fd7.svg)

Unified

![Split Diff View](https://github.githubassets.com/assets/split-b930d4a1df45.svg)

Split

Hide whitespace

 Apply and reload

Have server enforce SSH zone separation

```
When a client requests a zone's ssh credentials, make sure the
client is consistent with the specified zone.

Per github user salben21
```

* Loading branch information

[![@jjohnson42](https://avatars.githubusercontent.com/u/10814490?s=40&v=4)](/jjohnson42)

[jjohnson42](/xcat2/xcat-core/commits?author=jjohnson42 "View all commits by jjohnson42")
committed
Sep 9, 2022

commit 85149c37f49dbca7bd85f1f586960315604fc024

## There are no files selected for viewing

26 changes: 21 additions & 5 deletions

26
[xCAT-server/lib/xcat/plugins/credentials.pm](#diff-ef50470427b38340a76807429ce5ac6ac026a3f3d42689b3121331846e0c2355 "xCAT-server/lib/xcat/plugins/credentials.pm")

Show comments

[View file](/jjohnson42/xcat-core/blob/85149c37f49dbca7bd85f1f586960315604fc024/xCAT-server/lib/xcat/plugins/credentials.pm)
Edit file

Delete file

[Open in desktop](https://desktop.github.com)

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -133,18 +133,34 @@ sub process\_request |
|  |  | my $sshrootkeydir = "$root/.ssh"; # old default |
|  |  | if ((($parm =~ /^ssh\_root\_key/) || ($parm =~ /^ssh\_root\_pub\_key/)) && ($foundkeys == 0)) { |
|  |  | my ($rootkeyparm, $zonename) = split(/:/, $parm); |
|  |  | my $client\_zonename = xCAT::Zone->getmyzonename($client); |
|  |  | my $default\_zonename = xCAT::Zone->getdefaultzone(); |
|  |  |  |
|  |  | if ($zonename) { |
|  |  | $parm = $rootkeyparm; # take the zone off |
|  |  | xCAT::MsgUtils->trace(0, 'I', "credentials: The node ($client) is asking for sshkeys of zone: $zonename."); |
|  |  | $sshrootkeydir = xCAT::Zone->getzonekeydir($zonename); |
|  |  | if ($sshrootkeydir == 1) { # error return |
|  |  | xCAT::MsgUtils->trace(0, 'W', "credentials: The zone: $zonename is not defined."); |
|  |  | if ($client\_zonename eq $zonename) { |
|  |  | my $sshbetweenodes\_allowed = xCAT::Zone->enableSSHbetweennodes($client); |
|  |  | if (($sshbetweenodes\_allowed == 1) || ($parm =~ /^ssh\_root\_pub\_key/)) { # check if sshbetweennodes is allowed or pub key is requested |
|  |  | $sshrootkeydir = xCAT::Zone->getzonekeydir($zonename); |
|  |  | if ($sshrootkeydir == 1) { # error return |
|  |  | xCAT::MsgUtils->trace(0, 'W', "credentials: The zone: $zonename is not defined."); |
|  |  | } else { |
|  |  | $foundkeys = 1; # don't want to read the zone data twice |
|  |  | } |
|  |  | } else { |
|  |  | xCAT::MsgUtils->trace(0, 'E', "credentials: Not allowed to read root's private ssh key because sshbetweennodes is disabled."); |
|  |  | $sshrootkeydir = 1; |
|  |  | } |
|  |  | } else { |
|  |  | $foundkeys = 1; # don't want to read the zone data twice |
|  |  | xCAT::MsgUtils->trace(0, 'E', "credentials: Not allowed to read root's private ssh key of different zone."); |
|  |  | $sshrootkeydir = 1; |
|  |  | } |
|  |  | } elsif ($client\_zonename ne $default\_zonename) { # check if no zonename is submitted but node is not in default zone |
|  |  | xCAT::MsgUtils->trace(0, 'E', "credentials: Not allowed to read root's private ssh key of default zone."); |
|  |  | $sshrootkeydir = 1; |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | if ($parm =~ /ssh\_root\_key/) { |
|  |  | unless (-r "$sshrootkeydir/id\_rsa") { |
|  |  | push @{ $rsp->{'error'} }, "Unable to read root's private ssh key"; |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


