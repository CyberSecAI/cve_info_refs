=== Content from github.com_dd455a74_20250114_191137.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fphp-memcached-dev%2Fphp-memcached%2Fissues%2F531)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fphp-memcached-dev%2Fphp-memcached%2Fissues%2F531)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=php-memcached-dev%2Fphp-memcached)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[php-memcached-dev](/php-memcached-dev)
/
**[php-memcached](/php-memcached-dev/php-memcached)**
Public

* [Notifications](/login?return_to=%2Fphp-memcached-dev%2Fphp-memcached) You must be signed in to change notification settings
* [Fork
  324](/login?return_to=%2Fphp-memcached-dev%2Fphp-memcached)
* [Star
   990](/login?return_to=%2Fphp-memcached-dev%2Fphp-memcached)

* [Code](/php-memcached-dev/php-memcached)
* [Issues
  44](/php-memcached-dev/php-memcached/issues)
* [Pull requests
  3](/php-memcached-dev/php-memcached/pulls)
* [Actions](/php-memcached-dev/php-memcached/actions)
* [Projects
  0](/php-memcached-dev/php-memcached/projects)
* [Wiki](/php-memcached-dev/php-memcached/wiki)
* [Security](/php-memcached-dev/php-memcached/security)
* [Insights](/php-memcached-dev/php-memcached/pulse)

Additional navigation options

* [Code](/php-memcached-dev/php-memcached)
* [Issues](/php-memcached-dev/php-memcached/issues)
* [Pull requests](/php-memcached-dev/php-memcached/pulls)
* [Actions](/php-memcached-dev/php-memcached/actions)
* [Projects](/php-memcached-dev/php-memcached/projects)
* [Wiki](/php-memcached-dev/php-memcached/wiki)
* [Security](/php-memcached-dev/php-memcached/security)
* [Insights](/php-memcached-dev/php-memcached/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fphp-memcached-dev%2Fphp-memcached%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fphp-memcached-dev%2Fphp-memcached%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# get returns random values when lower than default OPT\_POLL\_TIMEOUT is set #531

Closed

[ondrejcech](/ondrejcech) opened this issue
Jan 9, 2023
¬∑ 42 comments

Closed

# [get returns random values when lower than default OPT\_POLL\_TIMEOUT is set](#top) #531

[ondrejcech](/ondrejcech) opened this issue
Jan 9, 2023
¬∑ 42 comments

## Comments

[![@ondrejcech](https://avatars.githubusercontent.com/u/4385840?s=80&u=cfc81b4b7d0b6ce0b2c7e5dcf144725bc66ed9e2&v=4)](/ondrejcech)

Copy link

### **[ondrejcech](/ondrejcech)** commented [Jan 9, 2023](#issue-1525131293)

| After upgrading to libmemcached to 3.1.5-6, I'm sometimes (!) getting random results when calling the get method. There's no error, but the returned value is from a different key. This does not happen on every request. I've narrowed this error down to `OPT_POLL_TIMEOUT` option. When set to lower than 500ms this starts to happen. It seems that if `OPT_POLL_TIMEOUT` happens, the library returns a seemingly random value without any error.  It does not happen when `OPT_POLL_TIMEOUT` is set to default 1000ms value or omitted.  Not sure if it's an issue of libmemcached or php-memcached though.  PHP version:  ``` php -v PHP 8.1.12 (cli) (built: Oct 25 2022 17:30:00) (NTS gcc x86_64) Copyright (c) The PHP Group Zend Engine v4.1.12, Copyright (c) Zend Technologies     with Zend OPcache v8.1.12, Copyright (c), by Zend Technologies  ```  memcache\* libraries:  ``` rpm -qa | grep memcached remi-libmemcached-awesome-1.1.3-1.el7.remi.x86_64 libmemcached-1.0.16-5.el7.x86_64 php81-php-pecl-memcached-3.2.0-1.el7.remi.x86_64 libmemcached-opt-libs-1.0.18-2.el7.remi.x86_64 memcached-1.6.16-1.el7.remi.x86_64 php80-php-pecl-memcached-3.1.5-4.el7.remi.x86_64  ```  some memcache stats  ``` echo 'stats' | nc localhost 11211 STAT version 1.6.16 STAT libevent 2.0.21-stable END  ```  I will be more than happy to provide more debug info. |
| --- |
| The text was updated successfully, but these errors were encountered: |

 üëç
13
 VitBartunek, JanusLukas, Talavasek, Rikatemu, aiphee, ales-k, jpros-glami, jirka-grunt, SakalCZ, stepancechglami, and 3 more reacted with thumbs up emoji

All reactions

* üëç
  13 reactions

[![@sodabrew](https://avatars.githubusercontent.com/u/39406?s=80&v=4)](/sodabrew)

Copy link

Contributor

### **[sodabrew](/sodabrew)** commented [Jan 9, 2023](#issuecomment-1376175017) ‚Ä¢ edited Loading

| Are the many thumbs up coming from people who are able to reproduce this problem? If so, please post your php-memcached and libmemcached and memcached versions |
| --- |

All reactions

Sorry, something went wrong.

[![@ondrejcech](https://avatars.githubusercontent.com/u/4385840?s=80&u=cfc81b4b7d0b6ce0b2c7e5dcf144725bc66ed9e2&v=4)](/ondrejcech)

Copy link

Author

### **[ondrejcech](/ondrejcech)** commented [Jan 10, 2023](#issuecomment-1376932463)

| [@sodabrew](https://github.com/sodabrew) TBH, I think most of the thumbs-up comes from the same project. That volume just means how important the issue is for us. |
| --- |

All reactions

Sorry, something went wrong.

[![@k0ka](https://avatars.githubusercontent.com/u/203597?s=80&u=b4c9ccbadd78b6d803467db5b039083fce71fb49&v=4)](/k0ka)

Copy link

### **[k0ka](/k0ka)** commented [Jan 25, 2023](#issuecomment-1403822875)

| Hi,  Thanks God I'm not alone. It looks like I have the same problem. Here is my debug info:   1. I have quite an old container. The project runs properly there.  ``` php 7.4.13: php-pecl-memcached-3.1.5-1.el8.remi.7.4.x86_64 libmemcached-libs-1.0.18-15.el8.x86_64  ```  2. I tried to update it two times:  ``` php 7.4.33  php-pecl-memcached-3.2.0-1.el8.remi.7.4.x86_64 remi-libmemcached-awesome-1.1.3-1.el8.remi.x86_64  ```  and  ``` php 8.1.14 php-pecl-memcached-3.2.0-1.el8.remi.8.1.x86_64 remi-libmemcached-awesome-1.1.3-1.el8.remi.x86_64  ```  both had that weird behavior.   3. it was reproduced both in a localhost memcached and remote memcached cluster (several servers). I'm using the latest `docker.io/library/memcached:1.6-alpine` 4. I narrowed the problem to `php-pecl-memcached` (or `libmemcached-awesome`). I just logged every `get` key and returned the value just after calling `Memcached::get`. Sometimes it returns a value for another key that was requested before. 5. The value is always from the same request. So it was requested during the same page processing. We have a lot of pages so I'm pretty sure it is not a value from another request. 6. (It looks like) it is only reproduced if `persistent_id` is set during `Memcached` construction and is not unique. 7. The ordinal chance for it is less than 1%. However I've found these settings that make chance much bigger, and got this issue reproduced on my test server very reliably. Here are all my options:  ```                 Memcached::OPT_BINARY_PROTOCOL => true,                 Memcached::OPT_TCP_NODELAY => true,                                  Memcached::OPT_DISTRIBUTION => Memcached::DISTRIBUTION_CONSISTENT,                 Memcached::OPT_LIBKETAMA_COMPATIBLE => true,                  Memcached::OPT_SERIALIZER => Memcached::SERIALIZER_IGBINARY,                 Memcached::OPT_REMOVE_FAILED_SERVERS => true,                  Memcached::OPT_RETRY_TIMEOUT => 60, // seconds                 Memcached::OPT_CONNECT_TIMEOUT => 20, // milliseconds                 Memcached::OPT_POLL_TIMEOUT => 20, // milliseconds                 Memcached::OPT_RECV_TIMEOUT => 20*1000, // microseconds                 Memcached::OPT_SEND_TIMEOUT => 20*1000, // microseconds                  Memcached::OPT_SERVER_FAILURE_LIMIT => 10,  ```  Commenting the first two options out makes is not reproducible on the test server, but it still happens on the prod.   8. I dumped messages between php and memcached for a page that had problem on it (it is binary protocol). The php got same values for 2 keys: `joyreactor:/koka_joyreactor_identityworks_ru/ru/all/sf_cache_partial/main/__motto/sf_cache_key/40cd750bba9870f18aada2478b24840a` and `joyreactor:/koka_joyreactor_identityworks_ru/ru/all/sf_cache_partial/people/__weekTop/sf_cache_key/40cd750bba9870f18aada2478b24840a`. Here is how it looks like from tcp view (I snipped unrelated packets and response data):  ``` 13:44:30.249726 IP (tos 0x0, ttl 64, id 28370, offset 0, flags [DF], proto TCP (6), length 203)     127.0.0.1.56144 > 127.0.0.1.11211: Flags [P.], cksum 0xfebf (incorrect -> 0xc43c),     seq 4035:4186, ack 29271, win 2207, options [nop,nop,TS val 3561905189 ecr 3561905188], length 151     0x0000:  4500 00cb 6ed2 4000 4006 cd58 7f00 0001  E...n.@.@..X....     0x0010:  7f00 0001 db50 2bcb 3be1 4abe c434 d160  .....P+.;.J..4.`     0x0020:  8018 089f febf 0000 0101 080a d44e 5c25  .............N\%     0x0030:  d44e 5c24 800d 007f 0000 0000 0000 007f  .N\$............     0x0040:  003e 0000 0000 0000 0000 0000 6a6f 7972  .>..........joyr     0x0050:  6561 6374 6f72 3a2f 6b6f 6b61 5f6a 6f79  eactor:/koka_joy     0x0060:  7265 6163 746f 725f 6964 656e 7469 7479  reactor_identity     0x0070:  776f 726b 735f 7275 2f72 752f 616c 6c2f  works_ru/ru/all/     0x0080:  7366 5f63 6163 6865 5f70 6172 7469 616c  sf_cache_partial     0x0090:  2f6d 6169 6e2f 5f5f 6d6f 7474 6f2f 7366  /main/__motto/sf     0x00a0:  5f63 6163 6865 5f6b 6579 2f34 3063 6437  _cache_key/40cd7     0x00b0:  3530 6262 6139 3837 3066 3138 6161 6461  50bba9870f18aada     0x00c0:  3234 3738 6232 3438 3430 61              2478b24840a  13:44:30.249758 IP (tos 0x0, ttl 64, id 48713, offset 0, flags [DF], proto TCP (6), length 699)     127.0.0.1.11211 > 127.0.0.1.56144: Flags [P.], cksum 0x00b0 (incorrect -> 0x8df0),      seq 29271:29918, ack 4186, win 169, options [nop,nop,TS val 3561905189 ecr 3561905189], length 647     0x0000:  4500 02bb be49 4000 4006 7bf1 7f00 0001  E....I@.@.{.....     0x0010:  7f00 0001 2bcb db50 c434 d160 3be1 4b55  ....+..P.4.`;.KU     0x0020:  8018 00a9 00b0 0000 0101 080a d44e 5c25  .............N\%     0x0030:  d44e 5c25 810d 007f 0400 0000 0000 026f  .N\%...........o     0x0040:  003e 0000 0000 0000 0000 0045 0000 0000  .>.........E....     0x0050:  6a6f 7972 6561 6374 6f72 3a2f 6b6f 6b61  joyreactor:/koka     0x0060:  5f6a 6f79 7265 6163 746f 725f 6964 656e  _joyreactor_iden     0x0070:  7469 7479 776f 726b 735f 7275 2f72 752f  tityworks_ru/ru/     0x0080:  616c 6c2f 7366 5f63 6163 6865 5f70 6172  all/sf_cache_par     0x0090:  7469 616c 2f6d 6169 6e2f 5f5f 6d6f 7474  tial/main/__mott     0x00a0:  6f2f 7366 5f63 6163 6865 5f6b 6579 2f34  o/sf_cache_key/4     0x00b0:  3063 6437 3530 6262 6139 3837 3066 3138  0cd750bba9870f18     0x00c0:  6161 6461 3234 3738 6232 3438 3430 6161  aada2478b24840aa     0x00d0:  3a32 3a7b 733a 373a 2263 6f6e 7465 6e74  :2:{s:7:"content     0x00e0:  223b 733a 3530 3a22 d0a0 d0b5 d0bc d0b8  ";s:50:"........     0x00f0:  d0bd d0b8 d181 d186 d0b5 d0bd d186 d0b8  ................     0x0100:  d18f 20d0 b820 d180 d0b8 d0b3 d0b8 d0b4  ................     0x0110:  d0bd d0be d181 d182 d18c 223b 733a 383a  ..........";s:8: ... SNIP ...  13:44:30.249763 IP (tos 0x0, ttl 64, id 28371, offset 0, flags [DF], proto TCP (6), length 76)     127.0.0.1.56144 > 127.0.0.1.11211: Flags [P.], cksum 0xfe40 (incorrect -> 0x683e),      seq 4186:4210, ack 29918, win 2236, options [nop,nop,TS val 3561905189 ecr 3561905189], length 24     0x0000:  4500 004c 6ed3 4000 4006 cdd6 7f00 0001  E..Ln.@.@.......     0x0010:  7f00 0001 db50 2bcb 3be1 4b55 c434 d3e7  .....P+.;.KU.4..     0x0020:  8018 08bc fe40 0000 0101 080a d44e 5c25  .....@.......N\%     0x0030:  d44e 5c25 800a 0000 0000 0000 0000 0000  .N\%............     0x0040:  003f 0000 0000 0000 0000 0000            .?..........  13:44:30.249769 IP (tos 0x0, ttl 64, id 48714, offset 0, flags [DF], proto TCP (6), length 76)     127.0.0.1.11211 > 127.0.0.1.56144: Flags [P.], cksum 0xfe40 (incorrect -> 0x6f39),      seq 29918:29942, ack 4210, win 169, options [nop,nop,TS val 3561905189 ecr 3561905189], length 24     0x0000:  4500 004c be4a 4000 4006 7e5f 7f00 0001  E..L.J@.@.~_....     0x0010:  7f00 0001 2bcb db50 c434 d3e7 3be1 4b6d  ....+..P.4..;.Km     0x0020:  8018 00a9 fe40 0000 0101 080a d44e 5c25  .....@.......N\%     0x0030:  d44e 5c25 810a 0000 0000 0000 0000 0000  .N\%............     0x0040:  003f 0000 0000 0000 0000 0000            .?..........  13:44:30.249923 IP (tos 0x0, ttl 64, id 28372, offset 0, flags [DF], proto TCP (6), length 203)     127.0.0.1.56144 > 127.0.0.1.11211: Flags [P.], cksum 0xfebf (incorrect -> 0xc0ce),      seq 4210:4361, ack 29942, win 2236, options [nop,nop,TS val 3561905189 ecr 3561905189], length 151     0x0000:  4500 00cb 6ed4 4000 4006 cd56 7f00 0001  E...n.@.@..V....     0x0010:  7f00 0001 db50 2bcb 3be1 4b6d c434 d3ff  .....P+.;.Km.4..     0x0020:  8018 08bc febf 0000 0101 080a d44e 5c25  .............N\%     0x0030:  d44e 5c25 800d 007f 0000 0000 0000 007f  .N\%............     0x0040:  0040 0000 0000 0000 0000 0000 6a6f 7972  .@..........joyr     0x0050:  6561 6374 6f72 3a2f 6b6f 6b61 5f6a 6f79  eactor:/koka_joy     0x0060:  7265 6163 746f 725f 6964 656e 7469 7479  reactor_identity     0x0070:  776f 726b 735f 7275 2f72 752f 616c 6c2f  works_ru/ru/all/     0x0080:  7366 5f63 6163 6865 5f70 6172 7469 616c  sf_cache_partial     0x0090:  2f6d 6169 6e2f 5f5f 6d6f 7474 6f2f 7366  /main/__motto/sf     0x00a0:  5f63 6163 6865 5f6b 6579 2f34 3063 6437  _cache_key/40cd7     0x00b0:  3530 6262 6139 3837 3066 3138 6161 6461  50bba9870f18aada     0x00c0:  3234 3738 6232 3438 3430 61              2478b24840a  13:44:30.249954 IP (tos 0x0, ttl 64, id 48715, offset 0, flags [DF], proto TCP (6), length 699)     127.0.0.1.11211 > 127.0.0.1.56144: Flags [P.], cksum 0x00b0 (incorrect -> 0x8a9e),      seq 29942:30589, ack 4361, win 171, options [nop,nop,TS val 3561905189 ecr 3561905189], length 647     0x0000:  4500 02bb be4b 4000 4006 7bef 7f00 0001  E....K@.@.{.....     0x0010:  7f00 0001 2bcb db50 c434 d3ff 3be1 4c04  ....+..P.4..;.L.     0x0020:  8018 00ab 00b0 0000 0101 080a d44e 5c25  .............N\%     0x0030:  d44e 5c25 810d 007f 0400 0000 0000 026f  .N\%...........o     0x0040:  0040 0000 0000 0000 0000 0045 0000 0000  .@.........E....     0x0050:  6a6f 7972 6561 6374 6f72 3a2f 6b6f 6b61  joyreactor:/koka     0x0060:  5f6a 6f79 7265 6163 746f 725f 6964 656e  _joyreactor_iden     0x0070:  7469 7479 776f 726b 735f 7275 2f72 752f  tityworks_ru/ru/     0x0080:  616c 6c2f 7366 5f63 6163 6865 5f70 6172  all/sf_cache_par     0x0090:  7469 616c 2f6d 6169 6e2f 5f5f 6d6f 7474  tial/main/__mott     0x00a0:  6f2f 7366 5f63 6163 6865 5f6b 6579 2f34  o/sf_cache_key/4     0x00b0:  3063 6437 3530 6262 6139 3837 3066 3138  0cd750bba9870f18     0x00c0:  6161 6461 3234 3738 6232 3438 3430 6161  aada2478b24840aa     0x00d0:  3a32 3a7b 733a 373a 2263 6f6e 7465 6e74  :2:{s:7:"content     0x00e0:  223b 733a 3530 3a22 d0a0 d0b5 d0bc d0b8  ";s:50:"........     0x00f0:  d0bd d0b8 d181 d186 d0b5 d0bd d186 d0b8  ................     0x0100:  d18f 20d0 b820 d180 d0b8 d0b3 d0b8 d0b4  ................     0x0110:  d0bd d0be d181 d182 d18c 223b 733a 383a  ..........";s:8: ... SNIP ...  13:44:30.249959 IP (tos 0x0, ttl 64, id 28373, offset 0, flags [DF], proto TCP (6), length 76)     127.0.0.1.56144 > 127.0.0.1.11211: Flags [P.], cksum 0xfe40 (incorrect -> 0x64d0),      seq 4361:4385, ack 30589, win 2266, options [nop,nop,TS val 3561905189 ecr 3561905189], length 24     0x0000:  4500 004c 6ed5 4000 4006 cdd4 7f00 0001  E..Ln.@.@.......     0x0010:  7f00 0001 db50 2bcb 3be1 4c04 c434 d686  .....P+.;.L..4..     0x0020:  8018 08da fe40 0000 0101 080a d44e 5c25  .....@.......N\%     0x0030:  d44e 5c25 800a 0000 0000 0000 0000 0000  .N\%............     0x0040:  0041 0000 0000 0000 0000 0000            .A..........  13:44:30.249965 IP (tos 0x0, ttl 64, id 48716, offset 0, flags [DF], proto TCP (6), length 76)     127.0.0.1.11211 > 127.0.0.1.56144: Flags [P.], cksum 0xfe40 (incorrect -> 0x6be7),      seq 30589:30613, ack 4385, win 171, options [nop,nop,TS val 3561905189 ecr 3561905189], length 24     0x0000:  4500 004c be4c 4000 4006 7e5d 7f00 0001  E..L.L@.@.~]....     0x0010:  7f00 0001 2bcb db50 c434 d686 3be1 4c1c  ....+..P.4..;.L.     0x0020:  8018 00ab fe40 0000 0101 080a d44e 5c25  .....@.......N\%     0x0030:  d44e 5c25 810a 0000 0000 0000 0000 0000  .N\%............     0x0040:  0041 0000 0000 0000 0000 0000            .A..........  13:44:30.250907 IP (tos 0x0, ttl 64, id 28374, offset 0, flags [DF], proto TCP (6), length 207)     127.0.0.1.56144 > 127.0.0.1.11211: Flags [P.], cksum 0xfec3 (incorrect -> 0x0182),      seq 4385:4540, ack 30613, win 2266, options [nop,nop,TS val 3561905190 ecr 3561905189], length 155     0x0000:  4500 00cf 6ed6 4000 4006 cd50 7f00 0001  E...n.@.@..P....     0x0010:  7f00 0001 db50 2bcb 3be1 4c1c c434 d69e  .....P+.;.L..4..     0x0020:  8018 08da fec3 0000 0101 080a d44e 5c26  .............N\&     0x0030:  d44e 5c25 800d 0083 0000 0000 0000 0083  .N\%............     0x0040:  0042 0000 0000 0000 0000 0000 6a6f 7972  .B..........joyr     0x0050:  6561 6374 6f72 3a2f 6b6f 6b61 5f6a 6f79  eactor:/koka_joy     0x0060:  7265 6163 746f 725f 6964 656e 7469 7479  reactor_identity     0x0070:  776f 726b 735f 7275 2f72 752f 616c 6c2f  works_ru/ru/all/     0x0080:  7366 5f63 6163 6865 5f70 6172 7469 616c  sf_cache_partial     0x0090:  2f70 656f 706c 652f 5f5f 7765 656b 546f  /people/__weekTo     0x00a0:  702f 7366 5f63 6163 6865 5f6b 6579 2f34  p/sf_cache_key/4     0x00b0:  3063 6437 3530 6262 6139 3837 3066 3138  0cd750bba9870f18     0x00c0:  6161 6461 3234 3738 6232 3438 3430 61    aada2478b24840a  13:44:30.250939 IP (tos 0x0, ttl 64, id 48717, offset 0, flags [DF], proto TCP (6), length 2051)     127.0.0.1.11211 > 127.0.0.1.56144: Flags [P.], cksum 0x05f8 (incorrect -> 0x8a94),      seq 30613:32612, ack 4540, win 173, options [nop,nop,TS val 3561905190 ecr 3561905190], length 1999     0x0000:  4500 0803 be4d 4000 4006 76a5 7f00 0001  E....M@.@.v.....     0x0010:  7f00 0001 2bcb db50 c434 d69e 3be1 4cb7  ....+..P.4..;.L.     0x0020:  8018 00ad 05f8 0000 0101 080a d44e 5c26  .............N\&     0x0030:  d44e 5c26 810d 0083 0400 0000 0000 07b7  .N\&............     0x0040:  0042 0000 0000 0000 0000 0048 0000 0050  .B.........H...P     0x0050:  6a6f 7972 6561 6374 6f72 3a2f 6b6f 6b61  joyreactor:/koka     0x0060:  5f6a 6f79 7265 6163 746f 725f 6964 656e  _joyreactor_iden     0x0070:  7469 7479 776f 726b 735f 7275 2f72 752f  tityworks_ru/ru/     0x0080:  616c 6c2f 7366 5f63 6163 6865 5f70 6172  all/sf_cache_par     0x0090:  7469 616c 2f70 656f 706c 652f 5f5f 7765  tial/people/__we     0x00a0:  656b 546f 702f 7366 5f63 6163 6865 5f6b  ekTop/sf_cache_k     0x00b0:  6579 2f34 3063 6437 3530 6262 6139 3837  ey/40cd750bba987     0x00c0:  3066 3138 6161 6461 3234 3738 6232 3438  0f18aada2478b248     0x00d0:  3430 61da 1a00 001f 613a 323a 7b73 3a37  40a.....a:2:{s:7     0x00e0:  3a22 636f 6e74 656e 7422 3b73 3a36 3433  :"content";s:643     0x00f0:  303a 223c 6469 7620 1863 6c61 7373 3d22  0:"<div..class="     0x0100:  7369 6465 6261 725f 626c 6f63 6b22 3e3c  sidebar_block"><     0x0110:  6832 e003 1910 6865 6164 6572 223e d0a2  h2....header">.. ... SNIP ...   ```   What is interesting there:   * the first key is requested two times. But php only requests it once. * the second key is requested too, and the server returns the right value for it (with `<div class`) * however the php-pecl-memcached returned the first value for the second key.   I guess something inside libraries retried the first key request and considers its second response as the response for the second key.  Most probably that's a problem is `libmemcached-awesome`. In this case, could you help composing an issue for them? |
| --- |

 üëç
3
 ondrejcech, aiphee, and SakalCZ reacted with thumbs up emoji

All reactions

* üëç
  3 reactions

Sorry, something went wrong.

[![@sodabrew](https://avatars.githubusercontent.com/u/39406?s=80&v=4)](/sodabrew)

Copy link

Contributor

### **[sodabrew](/sodabrew)** commented [Jan 25, 2023](#issuecomment-1403917373) ‚Ä¢ edited Loading

| This is awesome debugging info! Tag [@m6w6](https://github.com/m6w6), and maybe just open a tracking issue on awesomized/libmemcahed that links back here.  I'm thinking it may be useful to construct a C test harness that isolates to libmemcahed without PHP involved. |
| --- |

All reactions

Sorry, something went wrong.

[![@m6w6](https://avatars.githubusercontent.com/u/1265282?s=80&v=4)](/m6w6)

Copy link

Contributor

### **[m6w6](/m6w6)** commented [Jan 25, 2023](#issuecomment-1404069738)

| Thanks for your effort!  Any chance for some code that would reproduce this issue?  It's unfortunate, that it has always been tried to upgrade both at the same time, so neither pecl-memcached nor libmemcached-awesome can be ruled out...  That's suspicious, at least:  (It looks like) it is only reproduced if persistent\_id is set during Memcached construction and is not unique.  I'll have a look at `POLL_TIMEOUT` in the meantime, but TBH, it doesn't look too promising that I'll "just be able to see" something... |
| --- |

All reactions

Sorry, something went wrong.

[![@k0ka](https://avatars.githubusercontent.com/u/203597?s=80&u=b4c9ccbadd78b6d803467db5b039083fce71fb49&v=4)](/k0ka)

Copy link

### **[k0ka](/k0ka)** commented [Jan 26, 2023](#issuecomment-1405331844)

| I can confirm setting `OPT_POLL_TIMEOUT` to default value `1000` fixes the problem.  I guess it's some sort of "race condition" bug. I tried to run a simple script with a lot of gets, but the bug wasn't reproduced on it. On my test server it is randomly shown once per 5-10 requests. |
| --- |

All reactions

Sorry, something went wrong.

[![@m6w6](https://avatars.githubusercontent.com/u/1265282?s=80&v=4)](/m6w6)

Copy link

Contributor

### **[m6w6](/m6w6)** commented [Feb 1, 2023](#issuecomment-1412128051)

| It could be, that I found a [related commit](https://github.com/awesomized/libmemcached/commit/011ea033d902722b9744ea9f28e646734ffdcaf2). Hang on. |
| --- |

All reactions

Sorry, something went wrong.

[![@k0ka](https://avatars.githubusercontent.com/u/203597?s=80&u=b4c9ccbadd78b6d803467db5b039083fce71fb49&v=4)](/k0ka)

Copy link

### **[k0ka](/k0ka)** commented [Feb 1, 2023](#issuecomment-1412155400)

| I'm still debugging it. I already found that it works perfectly until timeout occurs.  it returns an error like this `(0x5585c02958b0) A TIMEOUT OCCURRED, time out, host: localhost:11211 -> /builddir/build/BUILD/libmemcached-6e713c39031ff312164cc3ff12f943f8e8e01885/src/libmemcached/io.cc:220`  And after that it starts sending wrong responses quite often until process is restarted. I'm going to continue debugging it soon using gdb and most probably will post here some results tomorrow. |
| --- |

All reactions

Sorry, something went wrong.

[![@k0ka](https://avatars.githubusercontent.com/u/203597?s=80&u=b4c9ccbadd78b6d803467db5b039083fce71fb49&v=4)](/k0ka)

Copy link

### **[k0ka](/k0ka)** commented [Feb 2, 2023](#issuecomment-1413566085)

| I guess there are two bad things:   1. `libmemcached-awesome` sometimes throws `A TIMEOUT OCCURRED` even though it must not happen. 20ms poll timeout is more than enough for a localhost connection. 2. `php-pecl-memcached` does something wrong when this timeout comes in.   I added logs to php to print everything that is returned from `Memcached::get` immediately after it. Here is the log of one failed page request:  ```     [0] => Array         (             [type] => get             [key] => joyreactor:symfony.routing.data             [value] => a:104:{s:52:"parse_/post/4849934_1321ec5d5af53bbf347fa27ea57d3d4b";...             [error] => SUCCESS         )      [1] => Array         (             [type] => get             [key] => joyreactor:/koka_joyreactor_identityworks_ru/ru/all/sf_cache_partial/post/__postSeo/sf_cache_key/4849934_v6             [value] => a:2:{s:7:"content";s:514:"<div class="sidebar_block"><h2 class="sideheader">...             [error] => SUCCESS         )      [2] => Array         (             [type] => get             [key] => joyreactor:/koka_joyreactor_identityworks_ru/ru/all/sf_cache_partial/post/__postSeo/sf_cache_key/4849934_v6             [value] => a:2:{s:7:"content";s:1742:"0|{"title":"\u041a\u0430\u043c\u0435\u043d\u043d\u043e\u0443\u0433\u043e...                               [error] => SUCCESS         )      [3] => Array         (             [type] => get             [key] => joyreactor:/koka_joyreactor_identityworks_ru/ru/all/sf_cache_partial/post/__post_cached/sf_cache_key/4849934_noauth             [value] => a:2:{s:7:"content";s:2512:"0|<div class="article post-normal"><div class="post_top">...             [error] => SUCCESS         )  ```  We have 4 requests there. The 2nd and 3rd request requests the same key. The return value on the 2nd request is not right. It returned a value from another key (that was in the end of the previous request). The right value is returned in the 3rd response.  I set 2 breakpoints in the `libmemcached-awesome` and returned key that was queried there: 1)  ``` br memcached_mget printf "mget = %s\n", keys[0]  ```    ``` br memcached_fetch_result printf "fetch = %s\n", result->item_key  ```  Here is what was printed:  ``` mget = joyreactor:routing:4:symfony.routing.data fetch = fetch = joyreactor:routing:4:symfony.routing.data‚ñío% mget = joyreactor:/koka_joyreactor_identityworks_ru/ru/all/sf_cache_partial/post/__postSeo/sf_cache_key/4849934_v6 fetch = fetch = joyreactor:/koka_joyreactor_identityworks_ru/ru/all/sf_cache_partial/people/__onlineUsers/sf_cache_key/40cd750bba9870f18aada2478b24840a fetch = joyreactor:/koka_joyreactor_identityworks_ru/ru/all/sf_cache_partial/post/__postSeo/sf_cache_key/4849934_v6750bba9870f18aada2478b24840a mget = joyreactor:/koka_joyreactor_identityworks_ru/ru/all/sf_cache_partial/post/__postSeo/sf_cache_key/4849934_v6 fetch = fetch = joyreactor:/koka_joyreactor_identityworks_ru/ru/all/sf_cache_partial/post/__postSeo/sf_cache_key/4849934_v6 mget = joyreactor:/koka_joyreactor_identityworks_ru/ru/all/sf_cache_partial/post/__post_cached/sf_cache_key/4849934_noauth fetch = fetch = joyreactor:/koka_joyreactor_identityworks_ru/ru/all/sf_cache_partial/post/__post_cached/sf_cache_key/4849934_noauth  ```  As you can see, after the 2nd mget it requests old key first (`__onlineUsers`) and then requests the right key (`__postSeo`) but ignores its result.  In both logs I skipped everything after the 4th request. There was 19 requests to memcached on the page. |
| --- |

All reactions

Sorry, something went wrong.

[![@k0ka](https://avatars.githubusercontent.com/u/203597?s=80&u=b4c9ccbadd78b6d803467db5b039083fce71fb49&v=4)](/k0ka)

Copy link

### **[k0ka](/k0ka)** commented [Feb 2, 2023](#issuecomment-1413572414)

| Let me know if you need any other internal information to debug it. |
| --- |

All reactions

Sorry, something went wrong.

[![@m6w6](https://avatars.githubusercontent.com/u/1265282?s=80&v=4)](/m6w6)

Copy link

Contributor

### **[m6w6](/m6w6)** commented [Feb 7, 2023](#issuecomment-1421119886)

| This might be an even better candidate: [awesomized/libmemcached@d7a0084](https://github.com/awesomized/libmemcached/commit/d7a0084bf99d618d1dc26a54fd413db7ae8b8e63) |
| --- |

All reactions

Sorry, something went wrong.

[![@m6w6](https://avatars.githubusercontent.com/u/1265282?s=80&v=4)](/m6w6)

Copy link

Contributor

### **[m6w6](/m6w6)** commented [Feb 18, 2023](#issuecomment-1435717558)

| I'd need someone to confirm/decline any offending commit to proceed; or/and (even better) a reliable reproduce case. |
| --- |

All reactions

Sorry, something went wrong.

[![@m6w6](https://avatars.githubusercontent.com/u/1265282?s=80&v=4)](/m6w6)

Copy link

Contributor

### **[m6w6](/m6w6)** commented [Feb 20, 2023](#issuecomment-1437045164)

| Hey! Did anyone have a chance to test whether their issue was solved with reverting either commit? |
| --- |

All reactions

Sorry, something went wrong.

[![@k0ka](https://avatars.githubusercontent.com/u/203597?s=80&u=b4c9ccbadd78b6d803467db5b039083fce71fb49&v=4)](/k0ka)

Copy link

### **[k0ka](/k0ka)** commented [Feb 27, 2023](#issuecomment-1446520435)

| Hi,  Sorry for long response. I set the test environment. Reverted that commit ([k0ka/libmemcached@6197650](https://github.com/k0ka/libmemcached/commit/61976509ab214ee5f73b4a23de3eaa727cd2cd43)). But when I'm building rpm with this patch (from Remi's srpm) it hangs on test 31: `memcached_noblock`.  Should I try to revert only changes in `response.cc`? |
| --- |

All reactions

Sorry, something went wrong.

[![@m6w6](https://avatars.githubusercontent.com/u/1265282?s=80&v=4)](/m6w6)

Copy link

Contributor

### **[m6w6](/m6w6)** commented [Feb 28, 2023](#issuecomment-1447910944)

| I remember fiddling around with this test when looking for offending commits. It's probably a bad test in itself.  IIRC, just make <https://github.com/k0ka/libmemcached/blob/v1.x/test/tests/memcached/noblock.cpp#L13> read:  ``` auto num = 10000; ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@k0ka](https://avatars.githubusercontent.com/u/203597?s=80&u=b4c9ccbadd78b6d803467db5b039083fce71fb49&v=4)](/k0ka)

Copy link

### **[k0ka](/k0ka)** commented [Feb 28, 2023](#issuecomment-1448593190)

| Yep, this fixes the problem with the test. However, I haven't run it yet.  I'm trying to reproduce the bug as a test. I ended up with this code:  ``` #include "test/lib/common.hpp" #include "test/lib/MemcachedCluster.hpp"  TEST_CASE("memcached_poll_timeout") {   auto test = MemcachedCluster::network();   auto memc = &test.memc;    REQUIRE_SUCCESS(memcached_behavior_set(memc, MEMCACHED_BEHAVIOR_NO_BLOCK, 1));   REQUIRE_SUCCESS(memcached_behavior_set(memc, MEMCACHED_BEHAVIOR_BINARY_PROTOCOL, 1));   REQUIRE_SUCCESS(memcached_behavior_set(memc, MEMCACHED_BEHAVIOR_TCP_NODELAY, 0));   REQUIRE_SUCCESS(memcached_behavior_set(memc, MEMCACHED_BEHAVIOR_POLL_TIMEOUT, 20));   REQUIRE_SUCCESS(memcached_behavior_set(memc, MEMCACHED_BEHAVIOR_RCV_TIMEOUT, 20*1000));   REQUIRE_SUCCESS(memcached_behavior_set(memc, MEMCACHED_BEHAVIOR_SND_TIMEOUT, 20*1000));   REQUIRE_SUCCESS(memcached_behavior_set(memc, MEMCACHED_BEHAVIOR_RETRY_TIMEOUT, 60));   REQUIRE_SUCCESS(memcached_behavior_set(memc, MEMCACHED_BEHAVIOR_CONNECT_TIMEOUT, 20));     memcached_return_t rc;   size_t len;    auto num = 500;   auto hit = 0u;   auto rnd = random_ascii_string(128);    REQUIRE_SUCCESS(memcached_flush(memc, 0));    for (auto i = 0; i < num; ++i) {     auto setKey = rnd + to_string(i);     REQUIRE_SUCCESS(memcached_set(memc, setKey.c_str(), setKey.length(), setKey.c_str(),                                   setKey.length(), 1, 0));   }   memcached_quit(memc);    auto timeoutAchieved = false;   for (auto i = 0; i < num; ++i) {     for (auto j = 0; j < i; ++j) {       auto getKey = rnd + to_string(j);       auto len = getKey.length();       char key[MEMCACHED_MAX_KEY];       memcpy(key, getKey.c_str(), len + 1);       const char *keys[1] = {key};        REQUIRE_SUCCESS(memcached_mget(memc, keys, &len, 1));       auto numResults = 0;       while (auto rv = memcached_fetch(memc, key, nullptr, &len, nullptr, &rc)) {         REQUIRE(!timeoutAchieved);          REQUIRE_SUCCESS(rc);         free(rv);          numResults++;         REQUIRE(numResults == 1);       }        if (MEMCACHED_END == rc || MEMCACHED_NOTFOUND == rc ){         continue;       }        if (MEMCACHED_TIMEOUT == rc){         timeoutAchieved = true;         continue;       }        INFO(rc);       REQUIRE(false);     }   } } ```  However it just hangs after `timeoutAchieved` became true and `memcached_fetch` runs. Is that expected behavior? |
| --- |

All reactions

Sorry, something went wrong.

[m6w6](/m6w6)
added a commit
to awesomized/libmemcached
that referenced
this issue
[Mar 1, 2023](#ref-commit-11ad514)
[![@m6w6](https://avatars.githubusercontent.com/u/1265282?s=40&v=4)](/m6w6)

`[test: poll_timeout; see](/awesomized/libmemcached/commit/11ad51482c0481d8ef8fc2b8efa8293ffd48d95d "test: poll_timeout; see php-memcached-dev/php-memcached#531") [php-memcached-dev/php-memcached#531](https://github.com/php-memcached-dev/php-memcached/issues/531)`

`[11ad514](/awesomized/libmemcached/commit/11ad51482c0481d8ef8fc2b8efa8293ffd48d95d)`

[![@m6w6](https://avatars.githubusercontent.com/u/1265282?s=80&v=4)](/m6w6)

Copy link

Contributor

### **[m6w6](/m6w6)** commented [Mar 1, 2023](#issuecomment-1449644379)

| That's interesting. It doesn't hang, though; it just takes a very long time on linux. See <https://github.com/awesomized/libmemcached/actions/runs/4301629917> |
| --- |

All reactions

Sorry, something went wrong.

[![@m6w6](https://avatars.githubusercontent.com/u/1265282?s=80&v=4)](/m6w6)

Copy link

Contributor

### **[m6w6](/m6w6)** commented [Mar 1, 2023](#issuecomment-1449646527)

| Thanks, for the test case, though. I'll try to debug it on Linux later. |
| --- |

All reactions

Sorry, something went wrong.

[![@k0ka](https://avatars.githubusercontent.com/u/203597?s=80&u=b4c9ccbadd78b6d803467db5b039083fce71fb49&v=4)](/k0ka)

Copy link

### **[k0ka](/k0ka)** commented [Mar 1, 2023](#issuecomment-1449652128)

| I also don't understand why it returns `MEMCACHED_NOTFOUND` sometimes. The main idea of the test if just to set 500 keys and then query them several times. |
| --- |

All reactions

Sorry, something went wrong.

[![@k0ka](https://avatars.githubusercontent.com/u/203597?s=80&u=b4c9ccbadd78b6d803467db5b039083fce71fb49&v=4)](/k0ka)

Copy link

### **[k0ka](/k0ka)** commented [Mar 1, 2023](#issuecomment-1449667052) ‚Ä¢ edited Loading

| In your test runs `timeoutAchieved` is never set to true (if it is set the test will fail). On my test server it happens every run. Maybe you should decrease `MEMCACHED_BEHAVIOR_POLL_TIMEOUT` ?  I tested it with MEMCACHED\_BEHAVIOR\_POLL\_TIMEOUT=1000 and 20. It never happens on 1000 and always happens on 20. |
| --- |

All reactions

Sorry, something went wrong.

[![@k0ka](https://avatars.githubusercontent.com/u/203597?s=80&u=b4c9ccbadd78b6d803467db5b039083fce71fb49&v=4)](/k0ka)

Copy link

### **[k0ka](/k0ka)** commented [Mar 1, 2023](#issuecomment-1449695561)

| So, I'm using `rockylinux 8` (RHEL clone). Compile flags are taken from the remi's srpm:  `/usr/bin/cmake -DCMAKE_C_FLAGS_RELEASE:STRING=-DNDEBUG -DCMAKE_CXX_FLAGS_RELEASE:STRING=-DNDEBUG -DCMAKE_Fortran_FLAGS_RELEASE:STRING=-DNDEBUG -DCMAKE_VERBOSE_MAKEFILE:BOOL=ON -DCMAKE_INSTALL_PREFIX:PATH=/opt/libmemcached-awesome -DINCLUDE_INSTALL_DIR:PATH=/opt/libmemcached-awesome/include -DLIB_INSTALL_DIR:PATH=/opt/libmemcached-awesome/lib64 -DSYSCONF_INSTALL_DIR:PATH=/etc -DSHARE_INSTALL_PREFIX:PATH=/opt/libmemcached-awesome/share -DLIB_SUFFIX=64 -DBUILD_SHARED_LIBS:BOOL=ON -DBUILD_TESTING:BOOL=ON -DBUILD_DOCS_MAN:BOOL=ON -DBUILD_DOCS_MANGZ:BOOL=OFF -DENABLE_SASL:BOOL=ON -DENABLE_DTRACE:BOOL=ON -DENABLE_OPENSSL_CRYPTO:BOOL=ON -DENABLE_HASH_HSIEH:BOOL=ON -DENABLE_HASH_FNV64:BOOL=ON -DENABLE_HASH_MURMUR:BOOL=ON -DENABLE_MEMASLAP:BOOL=ON -S .` |
| --- |

All reactions

Sorry, something went wrong.

[![@m6w6](https://avatars.githubusercontent.com/u/1265282?s=80&v=4)](/m6w6)

Copy link

Contributor

### **[m6w6](/m6w6)** commented [Mar 1, 2023](#issuecomment-1449703405)

| Thanks for the extra info. Can you also share some words about your hardware? |
| --- |

All reactions

Sorry, something went wrong.

[![@k0ka](https://avatars.githubusercontent.com/u/203597?s=80&u=b4c9ccbadd78b6d803467db5b039083fce71fb49&v=4)](/k0ka)

Copy link

### **[k0ka](/k0ka)** commented [Mar 1, 2023](#issuecomment-1449710971)

| ``` [root@serv52 koka]# lscpu Architecture:        x86_64 CPU op-mode(s):      32-bit, 64-bit Byte Order:          Little Endian CPU(s):              12 On-line CPU(s) list: 0-11 Thread(s) per core:  2 Core(s) per socket:  6 Socket(s):           1 NUMA node(s):        1 Vendor ID:           AuthenticAMD BIOS Vendor ID:      Advanced Micro Devices, Inc. CPU family:          23 Model:               113 Model name:          AMD Ryzen 5 3600 6-Core Processor BIOS Model name:     AMD Ryzen 5 3600 6-Core Processor Stepping:            0 CPU MHz:             3600.000 CPU max MHz:         4208.2031 CPU min MHz:         2200.0000 BogoMIPS:            7185.82 Virtualization:      AMD-V L1d cache:           32K L1i cache:           32K L2 cache:            512K L3 cache:            16384K NUMA node0 CPU(s):   0-11 Flags:               fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ht syscall nx mmxext fxsr_opt pdpe1gb rdtscp lm constant_tsc rep_good nopl nonstop_tsc cpuid extd_apicid aperfmperf pni pclmulqdq monitor ssse3 fma cx16 sse4_1 sse4_2 movbe popcnt aes xsave avx f16c rdrand lahf_lm cmp_legacy svm extapic cr8_legacy abm sse4a misalignsse 3dnowprefetch osvw ibs skinit wdt tce topoext perfctr_core perfctr_nb bpext perfctr_llc mwaitx cpb cat_l3 cdp_l3 hw_pstate ssbd mba ibpb stibp vmmcall fsgsbase bmi1 avx2 smep bmi2 cqm rdt_a rdseed adx smap clflushopt clwb sha_ni xsaveopt xsavec xgetbv1 xsaves cqm_llc cqm_occup_llc cqm_mbm_total cqm_mbm_local clzero irperf xsaveerptr wbnoinvd arat npt lbrv svm_lock nrip_save tsc_scale vmcb_clean flushbyasid decodeassists pausefilter pfthreshold avic v_vmsave_vmload vgif v_spec_ctrl umip rdpid overflow_recov succor smca sme sev sev_es [root@serv52 koka]# uname -a Linux serv52.identityworks.ru 4.18.0-372.9.1.el8.x86_64 #1 SMP Tue May 10 14:48:47 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@k0ka](https://avatars.githubusercontent.com/u/203597?s=80&u=b4c9ccbadd78b6d803467db5b039083fce71fb49&v=4)](/k0ka)

Copy link

### **[k0ka](/k0ka)** commented [Mar 1, 2023](#issuecomment-1450253405)

| I finally created a docker container with this patch. It looks like this bug is gone - I wasn't able to reproduce it with that commit reverted. However I still see quite a lot of "TIMEOUT OCCURRED" errors. About 5%. The memcached is on the same server.  ```     [14] => Array         (             [type] => get             [key] => /koka_joyreactor_identityworks_ru/ru/all/sf_cache_partial/people/__onlineUsers/sf_cache_key/40cd750bba9870f18aada2478b24840a             [value] =>              [error] => (0x55fa3332e5d0) A TIMEOUT OCCURRED, time out,  host: localhost:11211 -> /root/rpmbuild/BUILD/libmemcached-6e713c39031ff312164cc3ff12f943f8e8e01885/src/libmemcached/io.cc:220         )      [15] => Array         (             [type] => get             [key] => /koka_joyreactor_identityworks_ru/ru/all/sf_cache_partial/people/__onlineUsers/sf_cache_key/40cd750bba9870f18aada2478b24840a             [value] =>              [error] => SUCCESS         )  ``` |
| --- |

All reactions

Sorry, something went wrong.

[m6w6](/m6w6)
added a commit
to awesomized/libmemcached
that referenced
this issue
[Mar 1, 2023](#ref-commit-48dcc61)
[![@m6w6](https://avatars.githubusercontent.com/u/1265282?s=40&v=4)](/m6w6)

`[revert most of](/awesomized/libmemcached/commit/48dcc61a4919f6f3d5ee164630a843f2d8b8ade9 "revert most of d7a0084bf99d618d1dc26a54fd413db7ae8b8e63

See php-memcached-dev/php-memcached#531") [d7a0084](https://github.com/awesomized/libmemcached/commit/d7a0084bf99d618d1dc26a54fd413db7ae8b8e63)`
‚Ä¶

`[48dcc61](/awesomized/libmemcached/commit/48dcc61a4919f6f3d5ee164630a843f2d8b8ade9)`

```
See [php-memcached-dev/php-memcached#531](https://github.com/php-memcached-dev/php-memcached/issues/531)
```

[![@m6w6](https://avatars.githubusercontent.com/u/1265282?s=80&v=4)](/m6w6)

Copy link

Contributor

### **[m6w6](/m6w6)** commented [Mar 1, 2023](#issuecomment-1450428066)

| Just realised, your test is doing `500!` gets on 500 existing and `500! - 500` non-existent keys... (! means factorial)... yikes! ü§£  Anyway, I *think*, in normal circumstances, with this low of a timeout, there's still the previous response floating around, since, well, a timeout occurred while trying to fetch it, and the next request will happily fetch the previous response the next time.  I also *think*, these timeouts are really low, even computers sometimes need some time to think ü§î If the server is going to fail, it will also fail with a timeout of 100ms.  Please have a try with [awesomized/libmemcached@48dcc61a](https://github.com/awesomized/libmemcached/commit/48dcc61a) and see if it fixes your issues; it basically reverts 90% of [awesomized/libmemcached@d7a0084](https://github.com/awesomized/libmemcached/commit/d7a0084bf99d618d1dc26a54fd413db7ae8b8e63)  Thank you! |
| --- |

All reactions

Sorry, something went wrong.

[![@k0ka](https://avatars.githubusercontent.com/u/203597?s=80&u=b4c9ccbadd78b6d803467db5b039083fce71fb49&v=4)](/k0ka)

Copy link

### **[k0ka](/k0ka)** commented [Mar 1, 2023](#issuecomment-1450548637)

| it's not 500! iterations, it's only 500\*250 iterations.  And 100ms is way too much for a bare metal server. The full page is generated in 200-300ms including several sql requests and 15-20 memcached requests. It took less than 1ms to process a memcached request - you may check my tcpdump log. It has timestamps. |
| --- |

All reactions

Sorry, something went wrong.

[![@m6w6](https://avatars.githubusercontent.com/u/1265282?s=80&v=4)](/m6w6)

Copy link

Contributor

### **[m6w6](/m6w6)** commented [Mar 1, 2023](#issuecomment-1450624492)

| it's not 500! iterations, it's only 500\*250 iterations.  Uhm, I may have been sidetracked, please enlighten me!  And 100ms is way too much for a bare metal server. The full page is generated in 200-300ms including several sql requests and 15-20 memcached requests. It took less than 1ms to process a memcached request - you may check my tcpdump log. It has timestamps.  I unterstand your sentiment, but i have been trying to understand Linux clock granularity for the past couple hours.  If a server fails, it doesn't matter If in 20 or 200 ms.  Most probably I've been looking in the wrong corners... |
| --- |

All reactions

Sorry, something went wrong.

[![@k0ka](https://avatars.githubusercontent.com/u/203597?s=80&u=b4c9ccbadd78b6d803467db5b039083fce71fb49&v=4)](/k0ka)

Copy link

### **[k0ka](/k0ka)** commented [Mar 1, 2023](#issuecomment-1450631539)

| Please have a try with [awesomized/libmemcached@48dcc61a](https://github.com/awesomized/libmemcached/commit/48dcc61a) and see if it fixes your issues; it basically reverts 90% of [awesomized/libmemcached@d7a0084](https://github.com/awesomized/libmemcached/commit/d7a0084bf99d618d1dc26a54fd413db7ae8b8e63)  I checked it, it works the same way - it fixes the most nasty bug with "wrong key return". However the timeout still occurs.  I'm pretty sure it's not right. I can get tcpdump of interaction with memcached server to see timings. |
| --- |

All reactions

Sorry, something went wrong.

[![@k0ka](https://avatars.githubusercontent.com/u/203597?s=80&u=b4c9ccbadd78b6d803467db5b039083fce71fb49&v=4)](/k0ka)

Copy link

### **[k0ka](/k0ka)** commented [Mar 1, 2023](#issuecomment-1450638073)

| it's not 500! iterations, it's only 500\*250 iterations.  Uhm, I may have been sidetracked, please enlighten me!  The current test is:  ``` 1) create 500 keys. 2) for i from 0 to 500:         for j from 0 to i:             get j-th key  ```  so the first iteration goes from 0 to 0 and asks for 1 keys, the 2nd - from 0 to 1 and asks for 2 keys, 3rd - from 0 to 2 and asks 3 keys, nth goes from 0 to n and asks for n keys. 1 + 2 + 3 + ... + n = (n \* n-1)/2  (actually it goes from 0 to i-1, so it asks even less keys) |
| --- |

All reactions

Sorry, something went wrong.

[![@m6w6](https://avatars.githubusercontent.com/u/1265282?s=80&v=4)](/m6w6)

Copy link

Contributor

### **[m6w6](/m6w6)** commented [Mar 1, 2023](#issuecomment-1450731067)

| Yep, but for  `num` times. |
| --- |

All reactions

Sorry, something went wrong.

[![@k0ka](https://avatars.githubusercontent.com/u/203597?s=80&u=b4c9ccbadd78b6d803467db5b039083fce71fb49&v=4)](/k0ka)

Copy link

### **[k0ka](/k0ka)** commented [Mar 1, 2023](#issuecomment-1450745978) ‚Ä¢ edited Loading

| why num times? it executes `memcached_mget` with 1 key inside of two cycles. And fetches only 1 key.  Anyway, I narrowed my test to this:  ``` #include "test/lib/common.hpp" #include "test/lib/MemcachedCluster.hpp"  TEST_CASE("memcached_poll_timeout") {   auto test = MemcachedCluster{Cluster{Server{MEMCACHED_BINARY, {"-p", "11211"}}, 1}};   auto memc = &test.memc;    REQUIRE_SUCCESS(memcached_behavior_set(memc, MEMCACHED_BEHAVIOR_NO_BLOCK, 1));   REQUIRE_SUCCESS(memcached_behavior_set(memc, MEMCACHED_BEHAVIOR_BINARY_PROTOCOL, 0));   REQUIRE_SUCCESS(memcached_behavior_set(memc, MEMCACHED_BEHAVIOR_TCP_NODELAY, 0));   REQUIRE_SUCCESS(memcached_behavior_set(memc, MEMCACHED_BEHAVIOR_POLL_TIMEOUT, 20));   REQUIRE_SUCCESS(memcached_behavior_set(memc, MEMCACHED_BEHAVIOR_RCV_TIMEOUT, 20 * 1000));   REQUIRE_SUCCESS(memcached_behavior_set(memc, MEMCACHED_BEHAVIOR_SND_TIMEOUT, 20 * 1000));   REQUIRE_SUCCESS(memcached_behavior_set(memc, MEMCACHED_BEHAVIOR_RETRY_TIMEOUT, 60));   // REQUIRE_SUCCESS(memcached_behavior_set(memc, MEMCACHED_BEHAVIOR_CONNECT_TIMEOUT, 20));    memcached_return_t rc;    auto num = 100'000;    REQUIRE_SUCCESS(memcached_flush(memc, 0));    const char* key = "testkey1";   auto len = strlen(key);    REQUIRE_SUCCESS(memcached_set(memc, key, len, key, len, 1, 0));   memcached_quit(memc);    const char *keys[1] = {key};    for (auto i = 0; i < num; ++i) {     REQUIRE_SUCCESS(memcached_mget(memc, keys, &len, 1));      auto numResults = 0;     while (auto rv = memcached_fetch(memc, nullptr, nullptr, nullptr, nullptr, &rc)) {       REQUIRE_SUCCESS(rc);       free(rv);        numResults++;       REQUIRE(numResults == 1);     }      if (MEMCACHED_END == rc) {       continue;     }      INFO(rc << " on iteration " << i);     REQUIRE(false);   } } ```  So it only sets one key `testkey1` and mgets it 100'000 times.  It constantly fails for me on about 60-70 000 iteration. But it is the `memcached` server fail.  ``` 19:33:10.916117 IP (tos 0x0, ttl 64, id 45519, offset 0, flags [DF], proto TCP (6), length 66)     127.0.0.1.56098 > 127.0.0.1.11211: Flags [P.], cksum 0xfe36 (incorrect -> 0xec93), seq 978181:978195, ack 2445451, win 128, options [nop,nop,TS val 2401858559 ecr 2401858559], length 14         0x0000:  4500 0042 b1cf 4000 4006 8ae4 7f00 0001  E..B..@.@.......         0x0010:  7f00 0001 db22 2bcb e142 3258 8ddf 27d6  ....."+..B2X..'.         0x0020:  8018 0080 fe36 0000 0101 080a 8f29 73ff  .....6.......)s.         0x0030:  8f29 73ff 6765 7420 7465 7374 6b65 7931  .)s.get.testkey1         0x0040:  0d0a                                     .. 19:33:10.916121 IP (tos 0x0, ttl 64, id 56988, offset 0, flags [DF], proto TCP (6), length 87)     127.0.0.1.11211 > 127.0.0.1.56098: Flags [P.], cksum 0xfe4b (incorrect -> 0x3301), seq 2445451:2445486, ack 978195, win 128, options [nop,nop,TS val 2401858559 ecr 2401858559], length 35         0x0000:  4500 0057 de9c 4000 4006 5e02 7f00 0001  E..W..@.@.^.....         0x0010:  7f00 0001 2bcb db22 8ddf 27d6 e142 3266  ....+.."..'..B2f         0x0020:  8018 0080 fe4b 0000 0101 080a 8f29 73ff  .....K.......)s.         0x0030:  8f29 73ff 5641 4c55 4520 7465 7374 6b65  .)s.VALUE.testke         0x0040:  7931 2030 2038 0d0a 7465 7374 6b65 7931  y1.0.8..testkey1         0x0050:  0d0a 454e 440d 0a                        ..END.. 19:33:10.916129 IP (tos 0x0, ttl 64, id 45520, offset 0, flags [DF], proto TCP (6), length 66)     127.0.0.1.56098 > 127.0.0.1.11211: Flags [P.], cksum 0xfe36 (incorrect -> 0xec62), seq 978195:978209, ack 2445486, win 128, options [nop,nop,TS val 2401858559 ecr 2401858559], length 14         0x0000:  4500 0042 b1d0 4000 4006 8ae3 7f00 0001  E..B..@.@.......         0x0010:  7f00 0001 db22 2bcb e142 3266 8ddf 27f9  ....."+..B2f..'.         0x0020:  8018 0080 fe36 0000 0101 080a 8f29 73ff  .....6.......)s.         0x0030:  8f29 73ff 6765 7420 7465 7374 6b65 7931  .)s.get.testkey1         0x0040:  0d0a                                     .. 19:33:10.916149 IP (tos 0x0, ttl 64, id 56989, offset 0, flags [DF], proto TCP (6), length 57)     127.0.0.1.11211 > 127.0.0.1.56098: Flags [P.], cksum 0xfe2d (incorrect -> 0x0e02), seq 2445486:2445491, ack 978209, win 128, options [nop,nop,TS val 2401858560 ecr 2401858559], length 5         0x0000:  4500 0039 de9d 4000 4006 5e1f 7f00 0001  E..9..@.@.^.....         0x0010:  7f00 0001 2bcb db22 8ddf 27f9 e142 3274  ....+.."..'..B2t         0x0020:  8018 0080 fe2d 0000 0101 080a 8f29 7400  .....-.......)t.         0x0030:  8f29 73ff 454e 440d 0a                   .)s.END..  ```  I guess we might accept [awesomized/libmemcached@48dcc61a](https://github.com/awesomized/libmemcached/commit/48dcc61a) as the fix for this problem. |
| --- |

All reactions

Sorry, something went wrong.

[![@k0ka](https://avatars.githubusercontent.com/u/203597?s=80&u=b4c9ccbadd78b6d803467db5b039083fce71fb49&v=4)](/k0ka)

Copy link

### **[k0ka](/k0ka)** commented [Mar 1, 2023](#issuecomment-1450755350)

| wait, I'm dumb. I set key to 1 sec lifetime. That's why it is expired. Making more testing... |
| --- |

All reactions

Sorry, something went wrong.

[![@k0ka](https://avatars.githubusercontent.com/u/203597?s=80&u=b4c9ccbadd78b6d803467db5b039083fce71fb49&v=4)](/k0ka)

Copy link

### **[k0ka](/k0ka)** commented [Mar 1, 2023](#issuecomment-1450832701)

| Or I'm a genius (accidentally)! It looks like problems starts when a key is expired. It only happens when `BINARY_PROTOCOL` is on. The problem is in the memcached server. It just answers very long for a key that doesn't exist.  ``` #include "test/lib/common.hpp" #include "test/lib/MemcachedCluster.hpp"  TEST_CASE("memcached_poll_timeout") {   auto test = MemcachedCluster{Cluster{Server{MEMCACHED_BINARY, {"-p", "11211"}}, 1}};   auto memc = &test.memc;    REQUIRE_SUCCESS(memcached_behavior_set(memc, MEMCACHED_BEHAVIOR_NO_BLOCK, 1));   REQUIRE_SUCCESS(memcached_behavior_set(memc, MEMCACHED_BEHAVIOR_TCP_NODELAY, 0));   REQUIRE_SUCCESS(memcached_behavior_set(memc, MEMCACHED_BEHAVIOR_BINARY_PROTOCOL, 1));   REQUIRE_SUCCESS(memcached_behavior_set(memc, MEMCACHED_BEHAVIOR_POLL_TIMEOUT, 20));    memcached_return_t rc;    REQUIRE_SUCCESS(memcached_flush(memc, 0));    const char* key = "testkey1";   auto len = strlen(key);    const char *keys[1] = {key};    REQUIRE_SUCCESS(memcached_mget(memc, keys, &len, 1));    auto numResults = 0;   while (auto rv = memcached_fetch(memc, nullptr, nullptr, nullptr, nullptr, &rc)) {     REQUIRE_SUCCESS(rc);     free(rv);      numResults++;     REQUIRE(numResults == 1);   }    if (MEMCACHED_END != rc && MEMCACHED_NOTFOUND != rc) {     INFO(rc);     REQUIRE(false);   } } ```  This test always fails with rc=31 (MEMCACHED\_TIMEOUT) for me. Setting `BINARY_PROTOCOL` to `0` makes the test passes perfectly. If I set `POLL_TIMEOUT` to `100` the test will pass but fetch would take quite a lot of time (about 40ms for each request).  TL;DR:   1. `BINARY_PROTOCOL` must be set to 0 in production (I heard about it somewhere already). 2. querying non-existent key with `BINARY_PROTOCOL`=1 and small `POLL_TIMEOUT` is a good way to reliably get `MEMCACHED_TIMEOUT` error for tests to simulate a server that is not completely down. 3. It looks like [awesomized/libmemcached@48dcc61a](https://github.com/awesomized/libmemcached/commit/48dcc61a) fixes the problem. |
| --- |

 üòÑ
1
 vsushkov reacted with laugh emoji
 üëÄ
1
 killerbees19 reacted with eyes emoji

All reactions

* üòÑ
  1 reaction
* üëÄ
  1 reaction

Sorry, something went wrong.

[![@k0ka](https://avatars.githubusercontent.com/u/203597?s=80&u=b4c9ccbadd78b6d803467db5b039083fce71fb49&v=4)](/k0ka)

Copy link

### **[k0ka](/k0ka)** commented [Mar 1, 2023](#issuecomment-1450863713) ‚Ä¢ edited Loading

| And here is a test that does it:  ``` #include "test/lib/common.hpp" #include "test/lib/MemcachedCluster.hpp"  TEST_CASE("memcached_poll_timeout") {   auto test = MemcachedCluster{Cluster{Server{MEMCACHED_BINARY, {"-p", "11211"}}, 1}};   auto memc = &test.memc;    REQUIRE_SUCCESS(memcached_behavior_set(memc, MEMCACHED_BEHAVIOR_NO_BLOCK, 1));   REQUIRE_SUCCESS(memcached_behavior_set(memc, MEMCACHED_BEHAVIOR_TCP_NODELAY, 0));   REQUIRE_SUCCESS(memcached_behavior_set(memc, MEMCACHED_BEHAVIOR_BINARY_PROTOCOL, 0));   REQUIRE_SUCCESS(memcached_behavior_set(memc, MEMCACHED_BEHAVIOR_POLL_TIMEOUT, 1000));    memcached_return_t rc;   size_t len;    auto num = 100;   auto rnd = random_ascii_string(128);    for (auto i = 0; i < num; ++i) {     auto setKey = rnd + to_string(i);     REQUIRE_SUCCESS(memcached_set(memc, setKey.c_str(), setKey.length(), setKey.c_str(),                                   setKey.length(), 0, 0));   }   memcached_quit(memc);    for (auto i = 0; i < num; ++i) {     for (auto j = 0; j <= i; ++j) {       auto getKey = rnd + to_string(j);       auto len = getKey.length();       char key[MEMCACHED_MAX_KEY];       memcpy(key, getKey.c_str(), len + 1);       const char *keys[1] = {key};        if (0 == j){         REQUIRE_SUCCESS(memcached_behavior_set(memc, MEMCACHED_BEHAVIOR_POLL_TIMEOUT, 0));       }        REQUIRE_SUCCESS(memcached_mget(memc, keys, &len, 1));        auto numResults = 0;       while (auto rv = memcached_fetch(memc, key, nullptr, &len, nullptr, &rc)) {         REQUIRE_SUCCESS(rc);         free(rv);          numResults++;         REQUIRE(numResults == 1);       }        if (0 == j){         REQUIRE(MEMCACHED_TIMEOUT == rc);         REQUIRE_SUCCESS(memcached_behavior_set(memc, MEMCACHED_BEHAVIOR_POLL_TIMEOUT, 1000));         continue;       }        if (MEMCACHED_END == rc){         continue;       }        INFO(rc);       REQUIRE(false);     }   } } ```  On my server it always fails on the current version of libmemcached, but always passes after [awesomized/libmemcached@48dcc61a](https://github.com/awesomized/libmemcached/commit/48dcc61a) is applied.  Here is what it does:   1. it creates keys from 0 to num-1. 2. for i from 0 to num-1, it asks for keys 0, 1, 2, ... i, i in separate mget requests. Each request asks for only one key. 3. the key 0 is always queried with `POLL_TIMEOUT` set to 0. The library must return `MEMCACHED_TIMEOUT` in this case. 4. it queries other `i-1` keys after timeout. And checks that only one result is returned. 5. at some point it returns two results via `memcached_fetch` and assertion `REQUIRE(numResults == 1);` fails   Upd: made the test more reliable. |
| --- |

All reactions

Sorry, something went wrong.

[m6w6](/m6w6)
added a commit
to awesomized/libmemcached
that referenced
this issue
[Mar 2, 2023](#ref-commit-c4150c3)
[![@m6w6](https://avatars.githubusercontent.com/u/1265282?s=40&v=4)](/m6w6)

`[tests: add test for](/awesomized/libmemcached/commit/c4150c3ae1ba9fa96fc42ad32c972d599e88e9bd "tests: add test for php-memcached-dev/php-memcached#531") [php-memcached-dev/php-memcached#531](https://github.com/php-memcached-dev/php-memcached/issues/531)`

`[c4150c3](/awesomized/libmemcached/commit/c4150c3ae1ba9fa96fc42ad32c972d599e88e9bd)`

[![@m6w6](https://avatars.githubusercontent.com/u/1265282?s=80&v=4)](/m6w6)

Copy link

Contributor

### **[m6w6](/m6w6)** commented [Mar 2, 2023](#issuecomment-1452109600)

| Hey, I pushed a much simpler test case; in case you didn't notice.  Unfortunately the fix for this problem is simple & hard (like in the branch) or complicated & considerate (I'll try to write something up until tomorrow).  If your observation of "memcached is choking on missing-key+binary-proto", we should file a decent issue on <https://github.com/memcached/memcached>, IMO. I'll also try to have a look at this.  Finally, I'm definitely *not* understanding why `memcached_io_poll` immediately returns when the timeout is set to zero? Maybe the socket actually IS readable without a timeout?  Unfortunately, the libmemcached legacy is a over-engineered mess; someone should think about making a new meta-protocol-only client library. Maybe [@dormando](https://github.com/dormando)'s proxy code would be a good fit for a new client library? |
| --- |

All reactions

Sorry, something went wrong.

[![@dormando](https://avatars.githubusercontent.com/u/66832?s=80&v=4)](/dormando)

Copy link

### **[dormando](/dormando)** commented [Mar 2, 2023](#issuecomment-1452563833)

| Hi. Sorry I've only skimmed this; that sounds like a nasty bug.  RE client replacement, this issue on php-memcached is probably the wrong place to discuss, so I created an issue topic over here: [dormando/mcmc#2](https://github.com/dormando/mcmc/issues/2)  TL:DR; I wrote a core of a client parser (it's messy because I didn't know what direction to go in at the time) which is in use for the proxy code + some other utilities. I'm trying to find time to expand this into a full client soon but am not sure what a useful replacement looks like.  I wrote up my goals and would invite anyone on this thread who cares (certainly [@m6w6](https://github.com/m6w6) as you seem to have taken ownership of libmemcached) to come help with at least feedback if not code. |
| --- |

All reactions

Sorry, something went wrong.

[![@k0ka](https://avatars.githubusercontent.com/u/203597?s=80&u=b4c9ccbadd78b6d803467db5b039083fce71fb49&v=4)](/k0ka)

Copy link

### **[k0ka](/k0ka)** commented [Mar 3, 2023](#issuecomment-1453082550)

| Finally, I'm definitely not understanding why memcached\_io\_poll immediately returns when the timeout is set to zero? Maybe the socket actually IS readable without a timeout?  My guess is: in most cases it will return timeout. As we asked something from the server and it took some time to process our request. So they decided to make poll\_timeout=0 a convenient way to get TIMEOUT error. It's definitely usable in tests. Maybe it can be used in some weird real world examples. |
| --- |

All reactions

Sorry, something went wrong.

[![@k0ka](https://avatars.githubusercontent.com/u/203597?s=40&u=b4c9ccbadd78b6d803467db5b039083fce71fb49&v=4)](/k0ka)
[k0ka](/k0ka)
mentioned this issue
[Mar 3, 2023](#ref-issue-1608101207)

[Slow response for non-existent key via binary protocol.
memcached/memcached#1003](/memcached/memcached/issues/1003)

Closed

[m6w6](/m6w6)
added a commit
to awesomized/libmemcached
that referenced
this issue
[Mar 6, 2023](#ref-commit-92d1885)
[![@m6w6](https://avatars.githubusercontent.com/u/1265282?s=40&v=4)](/m6w6)

`[prepare v1.1.4](/awesomized/libmemcached/commit/92d18858b417309f6bdee6bce464a4f3d6a375fd "prepare v1.1.4

* Fix [gh #107](https://github.com/awesomized/libmemcached/issues/107):
  macOS: deprecated sasl API (improve detection of `libsasl2`).
* Fix [gh #131](https://github.com/awesomized/libmemcached/issues/131):
  Consider renaming tools (add `CLIENT_PREFIX` build option; default: `mem`)
* Fix [gh #132](https://github.com/awesomized/libmemcached/issues/132):
  Add build of static library (add `BUILD_SHARED_LIBS` build option; default: `ON`).
* Fix [gh #134](https://github.com/awesomized/libmemcached/issues/134):
  Update client option documentation.
* Fix [gh #136](https://github.com/awesomized/libmemcached/issues/136):
  `libmemcachedutil` is underlinked (link against libmemcached).
* Fix [gh php-memcached#531](https://github.com/php-memcached-dev/php-memcached/issues/531):
  `get` returns random values when lower than default `OPT_POLL_TIMEOUT` is set.")`
‚Ä¶

`[92d1885](/awesomized/libmemcached/commit/92d18858b417309f6bdee6bce464a4f3d6a375fd)`

```
* Fix [gh [#107](https://github.com/awesomized/libmemcached/issues/107)]([#107](https://github.com/awesomized/libmemcached/issues/107)):
  macOS: deprecated sasl API (improve detection of `libsasl2`).
* Fix [gh [#131](https://github.com/awesomized/libmemcached/issues/131)]([#131](https://github.com/awesomized/libmemcached/issues/131)):
  Consider renaming tools (add `CLIENT_PREFIX` build option; default: `mem`)
* Fix [gh [#132](https://github.com/awesomized/libmemcached/issues/132)]([#132](https://github.com/awesomized/libmemcached/issues/132)):
  Add build of static library (add `BUILD_SHARED_LIBS` build option; default: `ON`).
* Fix [gh [#134](https://github.com/awesomized/libmemcached/issues/134)]([#134](https://github.com/awesomized/libmemcached/issues/134)):
  Update client option documentation.
* Fix [gh [#136](https://github.com/awesomized/libmemcached/issues/136)]([#136](https://github.com/awesomized/libmemcached/issues/136)):
  `libmemcachedutil` is underlinked (link against libmemcached).
* Fix [gh php-memcached#531]([php-memcached-dev/php-memcached#531](https://github.com/php-memcached-dev/php-memcached/issues/531)):
  `get` returns random values when lower than default `OPT_POLL_TIMEOUT` is set.
```

[![@WPprodigy](https://avatars.githubusercontent.com/u/8536129?s=80&v=4)](/WPprodigy)

Copy link

### **[WPprodigy](/WPprodigy)** commented [Jul 17, 2023](#issuecomment-1638937605) ‚Ä¢ edited Loading

| Wanted to mention (for others that may come looking) that I've seen this occurring even without `OPT_POLL_TIMEOUT` configured. The only two possibly related options that were set are:  ``` Memcached::OPT_CONNECT_TIMEOUT => 1000, (which is the default) Memcached::OPT_TCP_NODELAY     => true,  ```  Notably this issue only occurs when the memcached server nodes are experiencing some sort of stress, like kernel blocking under memory pressure and page eviction.  I've had a hard time replicating without `OPT_POLL_TIMEOUT`, but can do so consistently with that option here <https://github.com/WPprodigy/memcached-inconsistency-debugging/> by sending pause/continue signals to the memcached servers . And can also confirm that updating libmemcached from 1.1.3 to 1.1.4 does resolve what I've replicated in that test environment. TBD still if it will iron out the issue in production.  Update: Can replicate without `OPT_POLL_TIMEOUT`(using only the two options listed above, or even no overrides at all) by sending SIGSTOP/SIGCONT signals rather than SIGHUP/SIGCONT. Even happens without persistent connections. I've updating the replication repo with the new signals. Also resolves itself in libmemcached 1.1.4, so I think we're all good here üéâ |
| --- |

 üëç
3
 m6w6, ppolo99, and ondrejcech reacted with thumbs up emoji

All reactions

* üëç
  3 reactions

Sorry, something went wrong.

[![@ondrejcech](https://avatars.githubusercontent.com/u/4385840?s=80&u=cfc81b4b7d0b6ce0b2c7e5dcf144725bc66ed9e2&v=4)](/ondrejcech)

Copy link

Author

### **[ondrejcech](/ondrejcech)** commented [Jul 20, 2023](#issuecomment-1643963658)

| Because we've moved to Redis, I can't tell if this issue is fixed by ibmemcached 1.1.4. Can someone else please confirm that so I can close this issue? cc [@k0ka](https://github.com/k0ka) [@m6w6](https://github.com/m6w6) |
| --- |

All reactions

Sorry, something went wrong.

[![@k0ka](https://avatars.githubusercontent.com/u/203597?s=80&u=b4c9ccbadd78b6d803467db5b039083fce71fb49&v=4)](/k0ka)

Copy link

### **[k0ka](/k0ka)** commented [Jul 20, 2023](#issuecomment-1644015344)

| yep, it was fixed |
| --- |

All reactions

Sorry, something went wrong.

[![@ondrejcech](https://avatars.githubusercontent.com/u/4385840?s=80&u=cfc81b4b7d0b6ce0b2c7e5dcf144725bc66ed9e2&v=4)](/ondrejcech)

Copy link

Author

### **[ondrejcech](/ondrejcech)** commented [Jul 21, 2023](#issuecomment-1645050759)

| Thank you! |
| --- |

All reactions

Sorry, something went wrong.

[![@ondrejcech](https://avatars.githubusercontent.com/u/4385840?s=40&u=cfc81b4b7d0b6ce0b2c7e5dcf144725bc66ed9e2&v=4)](/ondrejcech)
[ondrejcech](/ondrejcech)
closed this as [completed](/php-memcached-dev/php-memcached/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Jul 21, 2023](#event-9881864492)

[![@sodabrew](https://avatars.githubusercontent.com/u/39406?s=80&v=4)](/sodabrew)

Copy link

Contributor

### **[sodabrew](/sodabrew)** commented [Jul 21, 2023](#issuecomment-1645052851)

| Thank you all for the report, reproduction case, and follow-up that this was fixed upstream! |
| --- |

All reactions

Sorry, something went wrong.

[![@tommey](https://avatars.githubusercontent.com/u/903833?s=40&v=4)](/tommey)
[tommey](/tommey)
mentioned this issue
[Feb 6, 2024](#ref-issue-2120281820)

[libmemcached 1.1.4 to be packaged with critical fix
oerdnj/deb.sury.org#2075](/oerdnj/deb.sury.org/issues/2075)

Closed

3 tasks

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fphp-memcached-dev%2Fphp-memcached%2Fissues%2F531)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

6 participants

[![@sodabrew](https://avatars.githubusercontent.com/u/39406?s=52&v=4)](/sodabrew) [![@dormando](https://avatars.githubusercontent.com/u/66832?s=52&v=4)](/dormando) [![@k0ka](https://avatars.githubusercontent.com/u/203597?s=52&v=4)](/k0ka) [![@m6w6](https://avatars.githubusercontent.com/u/1265282?s=52&v=4)](/m6w6) [![@ondrejcech](https://avatars.githubusercontent.com/u/4385840?s=52&v=4)](/ondrejcech) [![@WPprodigy](https://avatars.githubusercontent.com/u/8536129?s=52&v=4)](/WPprodigy)

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_ab3515dd_20250114_191133.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fawesomized%2Flibmemcached%2Fcommit%2F48dcc61a)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fawesomized%2Flibmemcached%2Fcommit%2F48dcc61a)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=awesomized%2Flibmemcached)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[awesomized](/awesomized)
/
**[libmemcached](/awesomized/libmemcached)**
Public

* [Notifications](/login?return_to=%2Fawesomized%2Flibmemcached) You must be signed in to change notification settings
* [Fork
  26](/login?return_to=%2Fawesomized%2Flibmemcached)
* [Star
   45](/login?return_to=%2Fawesomized%2Flibmemcached)

* [Code](/awesomized/libmemcached)
* [Issues
  15](/awesomized/libmemcached/issues)
* [Pull requests
  2](/awesomized/libmemcached/pulls)
* [Discussions](/awesomized/libmemcached/discussions)
* [Actions](/awesomized/libmemcached/actions)
* [Security](/awesomized/libmemcached/security)
* [Insights](/awesomized/libmemcached/pulse)

Additional navigation options

* [Code](/awesomized/libmemcached)
* [Issues](/awesomized/libmemcached/issues)
* [Pull requests](/awesomized/libmemcached/pulls)
* [Discussions](/awesomized/libmemcached/discussions)
* [Actions](/awesomized/libmemcached/actions)
* [Security](/awesomized/libmemcached/security)
* [Insights](/awesomized/libmemcached/pulse)

## Commit

[Permalink](/awesomized/libmemcached/commit/48dcc61a4919f6f3d5ee164630a843f2d8b8ade9)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

revert most of [d7a0084](https://github.com/awesomized/libmemcached/commit/d7a0084bf99d618d1dc26a54fd413db7ae8b8e63)

[Browse files](/awesomized/libmemcached/tree/48dcc61a4919f6f3d5ee164630a843f2d8b8ade9)
Browse the repository at this point in the history

```
See [php-memcached-dev/php-memcached#531](https://github.com/php-memcached-dev/php-memcached/issues/531)
```

* Loading branch information

[![@m6w6](https://avatars.githubusercontent.com/u/1265282?s=40&v=4)](/m6w6)

[m6w6](/awesomized/libmemcached/commits?author=m6w6 "View all commits by m6w6")
committed
Mar 1, 2023

1 parent
[279113c](/awesomized/libmemcached/commit/279113c84c6059e4d0f75a2102c05ecc0daa0d19)

commit 48dcc61

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**1 addition**
and
**7 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* src/libmemcached

  + src/libmemcached/purge.cc
    [purge.cc](#diff-11d398c9073f36d5b9be3353b8e1cec35a6250740000fa37296d903b3b7abf9b)
  + src/libmemcached/response.cc
    [response.cc](#diff-0cc4cf87343d594efb97fec03b270f5e8413fd4d2ce88b565db74f0ac2f0bf26)
* test/tests/memcached

  + test/tests/memcached/noblock.cpp
    [noblock.cpp](#diff-d2023a935337f8587f97742c32776d48cf1721450d431e9d77df7352c07edb7b)

## There are no files selected for viewing

3 changes: 0 additions & 3 deletions

3
[src/libmemcached/purge.cc](#diff-11d398c9073f36d5b9be3353b8e1cec35a6250740000fa37296d903b3b7abf9b "src/libmemcached/purge.cc")

Show comments

[View file](/awesomized/libmemcached/blob/48dcc61a4919f6f3d5ee164630a843f2d8b8ade9/src/libmemcached/purge.cc)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -108,9 +108,6 @@ bool memcached\_purge(memcached\_instance\_st \*ptr) { |
|  |  | WATCHPOINT\_ERROR(rc); |
|  |  | is\_successful = false; |
|  |  | } |
|  |  | if (rc == MEMCACHED\_TIMEOUT) { |
|  |  | break; |
|  |  | } |
|  |  |  |
|  |  | if (ptr->root->callbacks) { |
|  |  | memcached\_callback\_st cb = \*ptr->root->callbacks; |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[src/libmemcached/response.cc](#diff-0cc4cf87343d594efb97fec03b270f5e8413fd4d2ce88b565db74f0ac2f0bf26 "src/libmemcached/response.cc")

Show comments

[View file](/awesomized/libmemcached/blob/48dcc61a4919f6f3d5ee164630a843f2d8b8ade9/src/libmemcached/response.cc)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -761,7 +761,7 @@ static memcached\_return\_t \_read\_one\_response(memcached\_instance\_st \*instance, ch |
|  |  | rc = textual\_read\_one\_response(instance, buffer, buffer\_length, result); |
|  |  | } |
|  |  |  |
|  |  | if (memcached\_fatal(rc) && rc != MEMCACHED\_TIMEOUT) { |
|  |  | if (memcached\_fatal(rc)) { |
|  |  | memcached\_io\_reset(instance); |
|  |  | } |
|  |  |  |
| Expand Down | |  |

3 changes: 0 additions & 3 deletions

3
[test/tests/memcached/noblock.cpp](#diff-d2023a935337f8587f97742c32776d48cf1721450d431e9d77df7352c07edb7b "test/tests/memcached/noblock.cpp")

Show comments

[View file](/awesomized/libmemcached/blob/48dcc61a4919f6f3d5ee164630a843f2d8b8ade9/test/tests/memcached/noblock.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -23,9 +23,6 @@ TEST\_CASE("memcached\_noblock") { |
|  |  | break; |
|  |  | case MEMCACHED\_TIMEOUT: |
|  |  | case MEMCACHED\_WRITE\_FAILURE: |
|  |  | if(!timeout) { |
|  |  | --i; |
|  |  | } |
|  |  | ++hit; |
|  |  | REQUIRE(true); |
|  |  | break; |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `48dcc61`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fawesomized%2Flibmemcached%2Fcommit%2F48dcc61a) to comment.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_d8e55a30_20250114_191134.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fawesomized%2Flibmemcached%2Freleases%2Ftag%2F1.1.4)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fawesomized%2Flibmemcached%2Freleases%2Ftag%2F1.1.4)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=awesomized%2Flibmemcached)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[awesomized](/awesomized)
/
**[libmemcached](/awesomized/libmemcached)**
Public

* [Notifications](/login?return_to=%2Fawesomized%2Flibmemcached) You must be signed in to change notification settings
* [Fork
  26](/login?return_to=%2Fawesomized%2Flibmemcached)
* [Star
   45](/login?return_to=%2Fawesomized%2Flibmemcached)

* [Code](/awesomized/libmemcached/tree/1.1.4)
* [Issues
  15](/awesomized/libmemcached/issues)
* [Pull requests
  2](/awesomized/libmemcached/pulls)
* [Discussions](/awesomized/libmemcached/discussions)
* [Actions](/awesomized/libmemcached/actions)
* [Security](/awesomized/libmemcached/security)
* [Insights](/awesomized/libmemcached/pulse)

Additional navigation options

* [Code](/awesomized/libmemcached/tree/1.1.4)
* [Issues](/awesomized/libmemcached/issues)
* [Pull requests](/awesomized/libmemcached/pulls)
* [Discussions](/awesomized/libmemcached/discussions)
* [Actions](/awesomized/libmemcached/actions)
* [Security](/awesomized/libmemcached/security)
* [Insights](/awesomized/libmemcached/pulse)

1. [Releases](/awesomized/libmemcached/releases)
2. [1.1.4](/awesomized/libmemcached/releases/tag/1.1.4)

# v 1.1.4

[Latest](/awesomized/libmemcached/releases/latest)

[Latest](/awesomized/libmemcached/releases/latest)

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/awesomized/libmemcached/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...1.1.4)

 Loading

[View all tags](/awesomized/libmemcached/tags)

![@m6w6](https://avatars.githubusercontent.com/u/1265282?s=40&v=4)
[m6w6](/m6w6)
released this
06 Mar 11:31

¬∑
[4 commits](/awesomized/libmemcached/compare/1.1.4...v1.x)
to v1.x
since this release

[1.1.4](/awesomized/libmemcached/tree/1.1.4)

[`92d1885`](/awesomized/libmemcached/commit/92d18858b417309f6bdee6bce464a4f3d6a375fd)

This commit was signed with the committer‚Äôs **verified signature**.

[![](https://avatars.githubusercontent.com/u/1265282?s=64&v=4)](/m6w6)
[m6w6](/m6w6)
Michael Wallner

GPG key ID: 480E3E14B0A4C7C7

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

* Fix [gh https://github.com/awesomized/libmemcached/issues/107](https://github.com/awesomized/libmemcached/issues/107):

  macOS: deprecated sasl API (improve detection of `libsasl2`).
* Fix [gh https://github.com/awesomized/libmemcached/issues/131](https://github.com/awesomized/libmemcached/issues/131):

  Consider renaming tools (add `CLIENT_PREFIX` build option; default: `mem`)
* Fix [gh https://github.com/awesomized/libmemcached/issues/132](https://github.com/awesomized/libmemcached/issues/132):

  Add build of static library (add `BUILD_SHARED_LIBS` build option; default: `ON`).
* Fix [gh https://github.com/awesomized/libmemcached/issues/134](https://github.com/awesomized/libmemcached/issues/134):

  Update client option documentation.
* Fix [gh https://github.com/awesomized/libmemcached/issues/136](https://github.com/awesomized/libmemcached/issues/136):

  `libmemcachedutil` is underlinked (link against libmemcached).
* Fix [gh php-memcached#531](https://github.com/php-memcached-dev/php-memcached/issues/531):

  `get` returns random values when lower than default `OPT_POLL_TIMEOUT` is set.

 Assets
2

 Loading

All reactions

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_2e59e2d9_20250114_191135.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fawesomized%2Flibmemcached%2Fsecurity%2Fadvisories%2FGHSA-wwmh-39wj-fx59)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fawesomized%2Flibmemcached%2Fsecurity%2Fadvisories%2FGHSA-wwmh-39wj-fx59)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=awesomized%2Flibmemcached)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[awesomized](/awesomized)
/
**[libmemcached](/awesomized/libmemcached)**
Public

* [Notifications](/login?return_to=%2Fawesomized%2Flibmemcached) You must be signed in to change notification settings
* [Fork
  26](/login?return_to=%2Fawesomized%2Flibmemcached)
* [Star
   45](/login?return_to=%2Fawesomized%2Flibmemcached)

* [Code](/awesomized/libmemcached)
* [Issues
  15](/awesomized/libmemcached/issues)
* [Pull requests
  2](/awesomized/libmemcached/pulls)
* [Discussions](/awesomized/libmemcached/discussions)
* [Actions](/awesomized/libmemcached/actions)
* [Security](/awesomized/libmemcached/security)
* [Insights](/awesomized/libmemcached/pulse)

Additional navigation options

* [Code](/awesomized/libmemcached)
* [Issues](/awesomized/libmemcached/issues)
* [Pull requests](/awesomized/libmemcached/pulls)
* [Discussions](/awesomized/libmemcached/discussions)
* [Actions](/awesomized/libmemcached/actions)
* [Security](/awesomized/libmemcached/security)
* [Insights](/awesomized/libmemcached/pulse)

# Disclosure of unrelated data

Moderate

[m6w6](/m6w6)
published
GHSA-wwmh-39wj-fx59
Mar 7, 2023

## Package

libmemcached-awesome

## Affected versions

>1.0.18 <1.1.4

## Patched versions

1.1.4

## Description

### Impact

`libmemcached` could return data for a previously requested key, if that previous request timed out due to a low `POLL_TIMEOUT`.

### Patches

Version [v1.1.4](https://github.com/awesomized/libmemcached/releases/tag/1.1.4) with the appropriate patch has already been released.

### Workarounds

There are several ways to workaround or lower the probability of this bug affecting you:

* use a reasonably high `POLL_TIMEOUT` setting, like the default
* use separate libmemcached connections for unrelated data
* do not re-use libmemcached connections in an unknown state

### References

* [php-memcached-dev/php-memcached#531](https://github.com/php-memcached-dev/php-memcached/issues/531)
* [awesomized/libmemcached/GHSA-wwmh-39wj-fx59](https://github.com/awesomized/libmemcached/security/advisories/GHSA-wwmh-39wj-fx59)

### Severity

Moderate

6.5

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
Low

Integrity
Low

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:N

### CVE ID

CVE-2023-27478

### Weaknesses

No CWEs

### Credits

* [![@k0ka](https://avatars.githubusercontent.com/u/203597?s=40&v=4)](/k0ka)
  [k0ka](/k0ka)
  Analyst

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.


