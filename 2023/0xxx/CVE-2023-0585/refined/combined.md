=== Content from plugins.trac.wordpress.org_21644249_20250114_201435.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fall-in-one-seo-pack%2Ftags%2F4.2.9%2Fapp%2FCommon%2FMain%2FUpdates.php%3Fv%3D2829340)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/all-in-one-seo-pack/trunk/app/Common/Main/Updates.php?rev=2814301 "Revision 2814301")
* [Next Revision](/browser/all-in-one-seo-pack/trunk/app/Common/Main/Updates.php?rev=2866377 "Revision 2866377") →
* [Blame](/browser/all-in-one-seo-pack/trunk/app/Common/Main/Updates.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/all-in-one-seo-pack/tags/4.2.9/app/Common/Main/Updates.php)

---

# [source:](/browser?order=name "Go to repository root") [all-in-one-seo-pack](/browser/all-in-one-seo-pack?order=name "View all-in-one-seo-pack")/[tags](/browser/all-in-one-seo-pack/tags?order=name "View tags")/[4.2.9](/browser/all-in-one-seo-pack/tags/4.2.9?order=name "View 4.2.9")/[app](/browser/all-in-one-seo-pack/tags/4.2.9/app?order=name "View app")/[Common](/browser/all-in-one-seo-pack/tags/4.2.9/app/Common?order=name "View Common")/[Main](/browser/all-in-one-seo-pack/tags/4.2.9/app/Common/Main?order=name "View Main")/[Updates.php](/browser/all-in-one-seo-pack/tags/4.2.9/app/Common/Main/Updates.php?order=name "View Updates.php")

View diff against:

View revision:

| [Last change](/changeset/2829340/all-in-one-seo-pack/trunk/app/Common/Main/Updates.php "View differences") on this file was [2829340](/changeset/2829340/ "View changeset 2829340"), checked in by cristianrossi, [2 years ago](/timeline?from=2022-12-06T12%3A31%3A50Z&precision=second "See timeline at 12/06/2022 12:31:50 PM") |
| --- |
| 4.2.8 |
| **File size:** 46.1 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | namespace AIOSEO\Plugin\Common\Main; |
| [3](#L3) |  |
| [4](#L4) | use \AIOSEO\Plugin\Common\Models; |
| [5](#L5) |  |
| [6](#L6) | // Exit if accessed directly. |
| [7](#L7) | if ( ! defined( 'ABSPATH' ) ) { |
| [8](#L8) | exit; |
| [9](#L9) | } |
| [10](#L10) |  |
| [11](#L11) | /\*\* |
| [12](#L12) | \* Updater class. |
| [13](#L13) | \* |
| [14](#L14) | \* @since 4.0.0 |
| [15](#L15) | \*/ |
| [16](#L16) | class Updates { |
| [17](#L17) | /\*\* |
| [18](#L18) | \* Class constructor. |
| [19](#L19) | \* |
| [20](#L20) | \* @since 4.0.0 |
| [21](#L21) | \*/ |
| [22](#L22) | public function \_\_construct() { |
| [23](#L23) | add\_action( 'aioseo\_v4\_migrate\_post\_schema', [ $this, 'migratePostSchema' ] ); |
| [24](#L24) | add\_action( 'aioseo\_v4\_migrate\_post\_schema\_default', [ $this, 'migratePostSchemaDefault' ] ); |
| [25](#L25) |  |
| [26](#L26) | if ( wp\_doing\_ajax() || wp\_doing\_cron() ) { |
| [27](#L27) | return; |
| [28](#L28) | } |
| [29](#L29) |  |
| [30](#L30) | add\_action( 'init', [ $this, 'init' ], 1001 ); |
| [31](#L31) | add\_action( 'init', [ $this, 'runUpdates' ], 1002 ); |
| [32](#L32) | add\_action( 'init', [ $this, 'updateLatestVersion' ], 3000 ); |
| [33](#L33) | } |
| [34](#L34) |  |
| [35](#L35) | /\*\* |
| [36](#L36) | \* Sets the latest active version if it is not set yet. |
| [37](#L37) | \* |
| [38](#L38) | \* @since 4.0.0 |
| [39](#L39) | \* |
| [40](#L40) | \* @return void |
| [41](#L41) | \*/ |
| [42](#L42) | public function init() { |
| [43](#L43) | if ( '0.0' !== aioseo()->internalOptions->internal->lastActiveVersion ) { |
| [44](#L44) | return; |
| [45](#L45) | } |
| [46](#L46) |  |
| [47](#L47) | // It's possible the user may not have capabilities. Let's add them now. |
| [48](#L48) | aioseo()->access->addCapabilities(); |
| [49](#L49) |  |
| [50](#L50) | $oldOptions = get\_option( 'aioseop\_options' ); |
| [51](#L51) | if ( ! empty( $oldOptions['last\_active\_version'] ) ) { |
| [52](#L52) | aioseo()->internalOptions->internal->lastActiveVersion = $oldOptions['last\_active\_version']; |
| [53](#L53) | } |
| [54](#L54) |  |
| [55](#L55) | $this->addInitialCustomTablesForV4(); |
| [56](#L56) | add\_action( 'wp\_loaded', [ $this, 'setDefaultSocialImages' ], 1001 ); |
| [57](#L57) | } |
| [58](#L58) |  |
| [59](#L59) | /\*\* |
| [60](#L60) | \* Runs our migrations. |
| [61](#L61) | \* |
| [62](#L62) | \* @since 4.0.0 |
| [63](#L63) | \* |
| [64](#L64) | \* @return void |
| [65](#L65) | \*/ |
| [66](#L66) | public function runUpdates() { |
| [67](#L67) | // The dynamic options have not yet fully loaded, so let's refresh here to force that to happen. |
| [68](#L68) | aioseo()->dynamicOptions->refresh(); // TODO: Check if we still need this since it already runs on 999 in the main AIOSEO file. |
| [69](#L69) |  |
| [70](#L70) | $lastActiveVersion = aioseo()->internalOptions->internal->lastActiveVersion; |
| [71](#L71) | if ( version\_compare( $lastActiveVersion, '4.0.5', '<' ) ) { |
| [72](#L72) | $this->addImageScanDateColumn(); |
| [73](#L73) | } |
| [74](#L74) |  |
| [75](#L75) | if ( version\_compare( $lastActiveVersion, '4.0.6', '<' ) ) { |
| [76](#L76) | $this->disableTwitterUseOgDefault(); |
| [77](#L77) | $this->updateMaxImagePreviewDefault(); |
| [78](#L78) | } |
| [79](#L79) |  |
| [80](#L80) | if ( ! aioseo()->pro && version\_compare( $lastActiveVersion, '4.0.6', '=' ) && 'posts' !== get\_option( 'show\_on\_front' ) ) { |
| [81](#L81) | aioseo()->migration->helpers->redoMigration(); |
| [82](#L82) | } |
| [83](#L83) |  |
| [84](#L84) | if ( version\_compare( $lastActiveVersion, '4.0.13', '<' ) ) { |
| [85](#L85) | $this->removeDuplicateRecords(); |
| [86](#L86) | } |
| [87](#L87) |  |
| [88](#L88) | if ( version\_compare( $lastActiveVersion, '4.0.17', '<' ) ) { |
| [89](#L89) | $this->removeLocationColumn(); |
| [90](#L90) | } |
| [91](#L91) |  |
| [92](#L92) | if ( version\_compare( $lastActiveVersion, '4.1.2', '<' ) ) { |
| [93](#L93) | $this->clearProductImages(); |
| [94](#L94) | } |
| [95](#L95) |  |
| [96](#L96) | if ( version\_compare( $lastActiveVersion, '4.1.3', '<' ) ) { |
| [97](#L97) | $this->addNotificationsNewColumn(); |
| [98](#L98) | $this->noindexWooCommercePages(); |
| [99](#L99) | $this->accessControlNewCapabilities(); |
| [100](#L100) | } |
| [101](#L101) |  |
| [102](#L102) | if ( version\_compare( $lastActiveVersion, '4.1.3.3', '<' ) ) { |
| [103](#L103) | $this->accessControlNewCapabilities(); |
| [104](#L104) | } |
| [105](#L105) |  |
| [106](#L106) | if ( version\_compare( $lastActiveVersion, '4.1.4.3', '<' ) ) { |
| [107](#L107) | $this->migrateDynamicSettings(); |
| [108](#L108) | } |
| [109](#L109) |  |
| [110](#L110) | if ( version\_compare( $lastActiveVersion, '4.1.5', '<' ) ) { |
| [111](#L111) | aioseo()->actionScheduler->unschedule( 'aioseo\_cleanup\_action\_scheduler' ); |
| [112](#L112) | // Schedule routine to remove our old transients from the options table. |
| [113](#L113) | aioseo()->actionScheduler->scheduleSingle( aioseo()->core->cachePrune->getOptionCacheCleanAction(), MINUTE\_IN\_SECONDS ); |
| [114](#L114) |  |
| [115](#L115) | // Refresh with new Redirects capability. |
| [116](#L116) | $this->accessControlNewCapabilities(); |
| [117](#L117) |  |
| [118](#L118) | // Regenerate the sitemap if using a static one to update the data for the new stylesheets. |
| [119](#L119) | aioseo()->sitemap->regenerateStaticSitemap(); |
| [120](#L120) |  |
| [121](#L121) | $this->fixSchemaTypeDefault(); |
| [122](#L122) | } |
| [123](#L123) |  |
| [124](#L124) | if ( version\_compare( $lastActiveVersion, '4.1.6', '<' ) ) { |
| [125](#L125) | // Remove the recurring scheduled action for notifications. |
| [126](#L126) | aioseo()->actionScheduler->unschedule( 'aioseo\_admin\_notifications\_update' ); |
| [127](#L127) |  |
| [128](#L128) | $this->migrateOgTwitterImageColumns(); |
| [129](#L129) |  |
| [130](#L130) | // Set the OG data to false for current installs. |
| [131](#L131) | aioseo()->options->social->twitter->general->useOgData = false; |
| [132](#L132) | } |
| [133](#L133) |  |
| [134](#L134) | if ( version\_compare( $lastActiveVersion, '4.1.8', '<' ) ) { |
| [135](#L135) | $this->addLimitModifiedDateColumn(); |
| [136](#L136) |  |
| [137](#L137) | // Refresh with new Redirects Page capability. |
| [138](#L138) | $this->accessControlNewCapabilities(); |
| [139](#L139) | } |
| [140](#L140) |  |
| [141](#L141) | if ( version\_compare( $lastActiveVersion, '4.1.9', '<' ) ) { |
| [142](#L142) | $this->fixTaxonomyTags(); |
| [143](#L143) | $this->removeRevisionRecords(); |
| [144](#L144) | } |
| [145](#L145) |  |
| [146](#L146) | if ( version\_compare( $lastActiveVersion, '4.0.0', '>=' ) && version\_compare( $lastActiveVersion, '4.2.0', '<' ) ) { |
| [147](#L147) | $this->migrateDeprecatedRunShortcodesSetting(); |
| [148](#L148) | } |
| [149](#L149) |  |
| [150](#L150) | if ( version\_compare( $lastActiveVersion, '4.2.1', '<' ) ) { |
| [151](#L151) | // Force WordPress to flush the rewrite rules. |
| [152](#L152) | aioseo()->options->flushRewriteRules(); |
| [153](#L153) |  |
| [154](#L154) | Models\Notification::deleteNotificationByName( 'deprecated-filters' ); |
| [155](#L155) | Models\Notification::deleteNotificationByName( 'deprecated-filters-v2' ); |
| [156](#L156) | } |
| [157](#L157) |  |
| [158](#L158) | if ( version\_compare( $lastActiveVersion, '4.2.2', '<' ) ) { |
| [159](#L159) | aioseo()->internalOptions->database->installedTables = ''; |
| [160](#L160) |  |
| [161](#L161) | $this->addOptionsColumn(); |
| [162](#L162) | $this->removeTabsColumn(); |
| [163](#L163) | $this->migrateUserContactMethods(); |
| [164](#L164) |  |
| [165](#L165) | // Unschedule any static sitemap regeneration actions to remove any that failed and are still in-progress as a result. |
| [166](#L166) | aioseo()->actionScheduler->unschedule( 'aioseo\_static\_sitemap\_regeneration' ); |
| [167](#L167) | } |
| [168](#L168) |  |
| [169](#L169) | if ( version\_compare( $lastActiveVersion, '4.2.4', '<' ) ) { |
| [170](#L170) | $this->migrateContactTypes(); |
| [171](#L171) | $this->addNotificationsAddonColumn(); |
| [172](#L172) | } |
| [173](#L173) |  |
| [174](#L174) | if ( version\_compare( $lastActiveVersion, '4.2.5', '<' ) ) { |
| [175](#L175) | $this->addSchemaColumn(); |
| [176](#L176) | $this->schedulePostSchemaMigration(); |
| [177](#L177) | } |
| [178](#L178) |  |
| [179](#L179) | if ( version\_compare( $lastActiveVersion, '4.2.4.2', '>' ) && version\_compare( $lastActiveVersion, '4.2.6', '<' ) ) { |
| [180](#L180) | // The default graphs only need to be remigrated if the user was on 4.2.5 or 4.2.5.1. |
| [181](#L181) | $this->schedulePostSchemaDefaultMigration(); |
| [182](#L182) | } |
| [183](#L183) |  |
| [184](#L184) | if ( version\_compare( $lastActiveVersion, '4.2.8', '<' ) ) { |
| [185](#L185) | $this->migrateDashboardWidgetsOptions(); |
| [186](#L186) | } |
| [187](#L187) |  |
| [188](#L188) | do\_action( 'aioseo\_run\_updates', $lastActiveVersion ); |
| [189](#L189) |  |
| [190](#L190) | // Always clear the cache if the last active version is different from our current. |
| [191](#L191) | if ( version\_compare( $lastActiveVersion, AIOSEO\_VERSION, '<' ) ) { |
| [192](#L192) | aioseo()->core->cache->clear(); |
| [193](#L193) | } |
| [194](#L194) | } |
| [195](#L195) |  |
| [196](#L196) | /\*\* |
| [197](#L197) | \* Retrieve the raw options from the database for migration. |
| [198](#L198) | \* |
| [199](#L199) | \* @since 4.1.4 |
| [200](#L200) | \* |
| [201](#L201) | \* @return array An array of options. |
| [202](#L202) | \*/ |
| [203](#L203) | private function getRawOptions() { |
| [204](#L204) | // Options from the DB. |
| [205](#L205) | $commonOptions = json\_decode( get\_option( aioseo()->options->optionsName ), true ); |
| [206](#L206) | if ( empty( $commonOptions ) ) { |
| [207](#L207) | $commonOptions = []; |
| [208](#L208) | } |
| [209](#L209) |  |
| [210](#L210) | return $commonOptions; |
| [211](#L211) | } |
| [212](#L212) |  |
| [213](#L213) | /\*\* |
| [214](#L214) | \* Updates the latest version after all migrations and updates have run. |
| [215](#L215) | \* |
| [216](#L216) | \* @since 4.0.3 |
| [217](#L217) | \* |
| [218](#L218) | \* @return void |
| [219](#L219) | \*/ |
| [220](#L220) | public function updateLatestVersion() { |
| [221](#L221) | if ( aioseo()->internalOptions->internal->lastActiveVersion === aioseo()->version ) { |
| [222](#L222) | return; |
| [223](#L223) | } |
| [224](#L224) |  |
| [225](#L225) | aioseo()->internalOptions->internal->lastActiveVersion = aioseo()->version; |
| [226](#L226) |  |
| [227](#L227) | // Bust the tableExists and columnExists cache. |
| [228](#L228) | aioseo()->internalOptions->database->installedTables = ''; |
| [229](#L229) |  |
| [230](#L230) | // Bust the DB cache so we can make sure that everything is fresh. |
| [231](#L231) | aioseo()->core->db->bustCache(); |
| [232](#L232) | } |
| [233](#L233) |  |
| [234](#L234) | /\*\* |
| [235](#L235) | \* Adds our custom tables for V4. |
| [236](#L236) | \* |
| [237](#L237) | \* @since 4.0.0 |
| [238](#L238) | \* |
| [239](#L239) | \* @return void |
| [240](#L240) | \*/ |
| [241](#L241) | public function addInitialCustomTablesForV4() { |
| [242](#L242) | $db             = aioseo()->core->db->db; |
| [243](#L243) | $charsetCollate = ''; |
| [244](#L244) |  |
| [245](#L245) | if ( ! empty( $db->charset ) ) { |
| [246](#L246) | $charsetCollate .= "DEFAULT CHARACTER SET {$db->charset}"; |
| [247](#L247) | } |
| [248](#L248) | if ( ! empty( $db->collate ) ) { |
| [249](#L249) | $charsetCollate .= " COLLATE {$db->collate}"; |
| [250](#L250) | } |
| [251](#L251) |  |
| [252](#L252) | // Check for notifications table. |
| [253](#L253) | if ( ! aioseo()->core->db->tableExists( 'aioseo\_notifications' ) ) { |
| [254](#L254) | $tableName = $db->prefix . 'aioseo\_notifications'; |
| [255](#L255) |  |
| [256](#L256) | aioseo()->core->db->execute( |
| [257](#L257) | "CREATE TABLE {$tableName} ( |
| [258](#L258) | id bigint(20) unsigned NOT NULL AUTO\_INCREMENT, |
| [259](#L259) | slug varchar(13) NOT NULL, |
| [260](#L260) | title text NOT NULL, |
| [261](#L261) | content longtext NOT NULL, |
| [262](#L262) | type varchar(64) NOT NULL, |
| [263](#L263) | level text NOT NULL, |
| [264](#L264) | notification\_id bigint(20) unsigned DEFAULT NULL, |
| [265](#L265) | notification\_name varchar(255) DEFAULT NULL, |
| [266](#L266) | start datetime DEFAULT NULL, |
| [267](#L267) | end datetime DEFAULT NULL, |
| [268](#L268) | button1\_label varchar(255) DEFAULT NULL, |
| [269](#L269) | button1\_action varchar(255) DEFAULT NULL, |
| [270](#L270) | button2\_label varchar(255) DEFAULT NULL, |
| [271](#L271) | button2\_action varchar(255) DEFAULT NULL, |
| [272](#L272) | dismissed tinyint(1) NOT NULL DEFAULT 0, |
| [273](#L273) | created datetime NOT NULL, |
| [274](#L274) | updated datetime NOT NULL, |
| [275](#L275) | PRIMARY KEY (id), |
| [276](#L276) | UNIQUE KEY ndx\_aioseo\_notifications\_slug (slug), |
| [277](#L277) | KEY ndx\_aioseo\_notifications\_dates (start, end), |
| [278](#L278) | KEY ndx\_aioseo\_notifications\_type (type), |
| [279](#L279) | KEY ndx\_aioseo\_notifications\_dismissed (dismissed) |
| [280](#L280) | ) {$charsetCollate};" |
| [281](#L281) | ); |
| [282](#L282) | } |
| [283](#L283) |  |
| [284](#L284) | if ( ! aioseo()->core->db->tableExists( 'aioseo\_posts' ) ) { |
| [285](#L285) | $tableName = $db->prefix . 'aioseo\_posts'; |
| [286](#L286) |  |
| [287](#L287) | // Incorrect defaults are adjusted below through migrations. |
| [288](#L288) | aioseo()->core->db->execute( |
| [289](#L289) | "CREATE TABLE {$tableName} ( |
| [290](#L290) | id bigint(20) unsigned NOT NULL AUTO\_INCREMENT, |
| [291](#L291) | post\_id bigint(20) unsigned NOT NULL, |
| [292](#L292) | title text DEFAULT NULL, |
| [293](#L293) | description text DEFAULT NULL, |
| [294](#L294) | keywords mediumtext DEFAULT NULL, |
| [295](#L295) | keyphrases longtext DEFAULT NULL, |
| [296](#L296) | page\_analysis longtext DEFAULT NULL, |
| [297](#L297) | canonical\_url text DEFAULT NULL, |
| [298](#L298) | og\_title text DEFAULT NULL, |
| [299](#L299) | og\_description text DEFAULT NULL, |
| [300](#L300) | og\_object\_type varchar(64) DEFAULT 'default', |
| [301](#L301) | og\_image\_type varchar(64) DEFAULT 'default', |
| [302](#L302) | og\_image\_custom\_url text DEFAULT NULL, |
| [303](#L303) | og\_image\_custom\_fields text DEFAULT NULL, |
| [304](#L304) | og\_custom\_image\_width int(11) DEFAULT NULL, |
| [305](#L305) | og\_custom\_image\_height int(11) DEFAULT NULL, |
| [306](#L306) | og\_video varchar(255) DEFAULT NULL, |
| [307](#L307) | og\_custom\_url text DEFAULT NULL, |
| [308](#L308) | og\_article\_section text DEFAULT NULL, |
| [309](#L309) | og\_article\_tags text DEFAULT NULL, |
| [310](#L310) | twitter\_use\_og tinyint(1) DEFAULT 1, |
| [311](#L311) | twitter\_card varchar(64) DEFAULT 'default', |
| [312](#L312) | twitter\_image\_type varchar(64) DEFAULT 'default', |
| [313](#L313) | twitter\_image\_custom\_url text DEFAULT NULL, |
| [314](#L314) | twitter\_image\_custom\_fields text DEFAULT NULL, |
| [315](#L315) | twitter\_title text DEFAULT NULL, |
| [316](#L316) | twitter\_description text DEFAULT NULL, |
| [317](#L317) | seo\_score int(11) DEFAULT 0 NOT NULL, |
| [318](#L318) | schema\_type varchar(20) DEFAULT NULL, |
| [319](#L319) | schema\_type\_options longtext DEFAULT NULL, |
| [320](#L320) | pillar\_content tinyint(1) DEFAULT NULL, |
| [321](#L321) | robots\_default tinyint(1) DEFAULT 1 NOT NULL, |
| [322](#L322) | robots\_noindex tinyint(1) DEFAULT 0 NOT NULL, |
| [323](#L323) | robots\_noarchive tinyint(1) DEFAULT 0 NOT NULL, |
| [324](#L324) | robots\_nosnippet tinyint(1) DEFAULT 0 NOT NULL, |
| [325](#L325) | robots\_nofollow tinyint(1) DEFAULT 0 NOT NULL, |
| [326](#L326) | robots\_noimageindex tinyint(1) DEFAULT 0 NOT NULL, |
| [327](#L327) | robots\_noodp tinyint(1) DEFAULT 0 NOT NULL, |
| [328](#L328) | robots\_notranslate tinyint(1) DEFAULT 0 NOT NULL, |
| [329](#L329) | robots\_max\_snippet int(11) DEFAULT NULL, |
| [330](#L330) | robots\_max\_videopreview int(11) DEFAULT NULL, |
| [331](#L331) | robots\_max\_imagepreview varchar(20) DEFAULT 'none', |
| [332](#L332) | tabs mediumtext DEFAULT NULL, |
| [333](#L333) | images longtext DEFAULT NULL, |
| [334](#L334) | priority tinytext DEFAULT NULL, |
| [335](#L335) | frequency tinytext DEFAULT NULL, |
| [336](#L336) | videos longtext DEFAULT NULL, |
| [337](#L337) | video\_thumbnail text DEFAULT NULL, |
| [338](#L338) | video\_scan\_date datetime DEFAULT NULL, |
| [339](#L339) | local\_seo longtext DEFAULT NULL, |
| [340](#L340) | created datetime NOT NULL, |
| [341](#L341) | updated datetime NOT NULL, |
| [342](#L342) | PRIMARY KEY (id), |
| [343](#L343) | KEY ndx\_aioseo\_posts\_post\_id (post\_id) |
| [344](#L344) | ) {$charsetCollate};" |
| [345](#L345) | ); |
| [346](#L346) | } |
| [347](#L347) |  |
| [348](#L348) | // Reset the cache for the installed tables. |
| [349](#L349) | aioseo()->internalOptions->database->installedTables = ''; |
| [350](#L350) | } |
| [351](#L351) |  |
| [352](#L352) | /\*\* |
| [353](#L353) | \* Sets the default social images. |
| [354](#L354) | \* |
| [355](#L355) | \* @since 4.0.0 |
| [356](#L356) | \* |
| [357](#L357) | \* @return void |
| [358](#L358) | \*/ |
| [359](#L359) | public function setDefaultSocialImages() { |
| [360](#L360) | $siteLogo = aioseo()->helpers->getSiteLogoUrl(); |
| [361](#L361) | if ( $siteLogo && ! aioseo()->internalOptions->internal->migratedVersion ) { |
| [362](#L362) | if ( ! aioseo()->options->social->facebook->general->defaultImagePosts ) { |
| [363](#L363) | aioseo()->options->social->facebook->general->defaultImagePosts = $siteLogo; |
| [364](#L364) | } |
| [365](#L365) | if ( ! aioseo()->options->social->twitter->general->defaultImagePosts ) { |
| [366](#L366) | aioseo()->options->social->twitter->general->defaultImagePosts = $siteLogo; |
| [367](#L367) | } |
| [368](#L368) | } |
| [369](#L369) | } |
| [370](#L370) |  |
| [371](#L371) | /\*\* |
| [372](#L372) | \* Adds the image scan date column to our posts table. |
| [373](#L373) | \* |
| [374](#L374) | \* @since 4.0.5 |
| [375](#L375) | \* |
| [376](#L376) | \* @return void |
| [377](#L377) | \*/ |
| [378](#L378) | public function addImageScanDateColumn() { |
| [379](#L379) | if ( ! aioseo()->core->db->columnExists( 'aioseo\_posts', 'image\_scan\_date' ) ) { |
| [380](#L380) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [381](#L381) | aioseo()->core->db->execute( |
| [382](#L382) | "ALTER TABLE {$tableName} |
| [383](#L383) | ADD image\_scan\_date datetime DEFAULT NULL AFTER images" |
| [384](#L384) | ); |
| [385](#L385) |  |
| [386](#L386) | // Reset the cache for the installed tables. |
| [387](#L387) | aioseo()->internalOptions->database->installedTables = ''; |
| [388](#L388) | } |
| [389](#L389) | } |
| [390](#L390) |  |
| [391](#L391) | /\*\* |
| [392](#L392) | \* Modifes the default value of the twitter\_use\_og column. |
| [393](#L393) | \* |
| [394](#L394) | \* @since 4.0.6 |
| [395](#L395) | \* |
| [396](#L396) | \* @return void |
| [397](#L397) | \*/ |
| [398](#L398) | protected function disableTwitterUseOgDefault() { |
| [399](#L399) | if ( aioseo()->core->db->tableExists( 'aioseo\_posts' ) ) { |
| [400](#L400) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [401](#L401) | aioseo()->core->db->execute( |
| [402](#L402) | "ALTER TABLE {$tableName} |
| [403](#L403) | MODIFY twitter\_use\_og tinyint(1) DEFAULT 0" |
| [404](#L404) | ); |
| [405](#L405) | } |
| [406](#L406) | } |
| [407](#L407) |  |
| [408](#L408) | /\*\* |
| [409](#L409) | \* Modifes the default value of the robots\_max\_imagepreview column. |
| [410](#L410) | \* |
| [411](#L411) | \* @since 4.0.6 |
| [412](#L412) | \* |
| [413](#L413) | \* @return void |
| [414](#L414) | \*/ |
| [415](#L415) | protected function updateMaxImagePreviewDefault() { |
| [416](#L416) | if ( aioseo()->core->db->tableExists( 'aioseo\_posts' ) ) { |
| [417](#L417) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [418](#L418) | aioseo()->core->db->execute( |
| [419](#L419) | "ALTER TABLE {$tableName} |
| [420](#L420) | MODIFY robots\_max\_imagepreview varchar(20) DEFAULT 'large'" |
| [421](#L421) | ); |
| [422](#L422) | } |
| [423](#L423) | } |
| [424](#L424) |  |
| [425](#L425) | /\*\* |
| [426](#L426) | \* Deletes duplicate records in our custom tables. |
| [427](#L427) | \* |
| [428](#L428) | \* @since 4.0.13 |
| [429](#L429) | \* |
| [430](#L430) | \* @return void |
| [431](#L431) | \*/ |
| [432](#L432) | public function removeDuplicateRecords() { |
| [433](#L433) | $duplicates = aioseo()->core->db->start( 'aioseo\_posts' ) |
| [434](#L434) | ->select( 'post\_id, min(id) as id' ) |
| [435](#L435) | ->groupBy( 'post\_id having count(post\_id) > 1' ) |
| [436](#L436) | ->orderBy( 'count(post\_id) DESC' ) |
| [437](#L437) | ->run() |
| [438](#L438) | ->result(); |
| [439](#L439) |  |
| [440](#L440) | if ( empty( $duplicates ) ) { |
| [441](#L441) | return; |
| [442](#L442) | } |
| [443](#L443) |  |
| [444](#L444) | foreach ( $duplicates as $duplicate ) { |
| [445](#L445) | $postId        = $duplicate->post\_id; |
| [446](#L446) | $firstRecordId = $duplicate->id; |
| [447](#L447) |  |
| [448](#L448) | aioseo()->core->db->delete( 'aioseo\_posts' ) |
| [449](#L449) | ->whereRaw( "( id > $firstRecordId AND post\_id = $postId )" ) |
| [450](#L450) | ->run(); |
| [451](#L451) | } |
| [452](#L452) | } |
| [453](#L453) |  |
| [454](#L454) | /\*\* |
| [455](#L455) | \* Removes the location column. |
| [456](#L456) | \* |
| [457](#L457) | \* @since 4.0.17 |
| [458](#L458) | \* |
| [459](#L459) | \* @return void |
| [460](#L460) | \*/ |
| [461](#L461) | public function removeLocationColumn() { |
| [462](#L462) | if ( aioseo()->core->db->columnExists( 'aioseo\_posts', 'location' ) ) { |
| [463](#L463) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [464](#L464) | aioseo()->core->db->execute( |
| [465](#L465) | "ALTER TABLE {$tableName} |
| [466](#L466) | DROP location" |
| [467](#L467) | ); |
| [468](#L468) | } |
| [469](#L469) | } |
| [470](#L470) |  |
| [471](#L471) | /\*\* |
| [472](#L472) | \* Clears the image data for WooCommerce Products so that we scan them again and include product gallery images. |
| [473](#L473) | \* |
| [474](#L474) | \* @since 4.1.2 |
| [475](#L475) | \* |
| [476](#L476) | \* @return void |
| [477](#L477) | \*/ |
| [478](#L478) | public function clearProductImages() { |
| [479](#L479) | if ( ! aioseo()->helpers->isWooCommerceActive() ) { |
| [480](#L480) | return; |
| [481](#L481) | } |
| [482](#L482) |  |
| [483](#L483) | aioseo()->core->db->update( 'aioseo\_posts as ap' ) |
| [484](#L484) | ->join( 'posts as p', 'ap.post\_id = p.ID' ) |
| [485](#L485) | ->where( 'p.post\_type', 'product' ) |
| [486](#L486) | ->set( |
| [487](#L487) | [ |
| [488](#L488) | 'images'          => null, |
| [489](#L489) | 'image\_scan\_date' => null |
| [490](#L490) | ] |
| [491](#L491) | ) |
| [492](#L492) | ->run(); |
| [493](#L493) | } |
| [494](#L494) |  |
| [495](#L495) | /\*\* |
| [496](#L496) | \* Adds the new flag to the notifications table. |
| [497](#L497) | \* |
| [498](#L498) | \* @since 4.1.3 |
| [499](#L499) | \* |
| [500](#L500) | \* @return void |
| [501](#L501) | \*/ |
| [502](#L502) | public function addNotificationsNewColumn() { |
| [503](#L503) | if ( ! aioseo()->core->db->columnExists( 'aioseo\_notifications', 'new' ) ) { |
| [504](#L504) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_notifications'; |
| [505](#L505) | aioseo()->core->db->execute( |
| [506](#L506) | "ALTER TABLE {$tableName} |
| [507](#L507) | ADD new tinyint(1) NOT NULL DEFAULT 1 AFTER dismissed" |
| [508](#L508) | ); |
| [509](#L509) |  |
| [510](#L510) | // Reset the cache for the installed tables. |
| [511](#L511) | aioseo()->internalOptions->database->installedTables = ''; |
| [512](#L512) |  |
| [513](#L513) | aioseo()->core->db |
| [514](#L514) | ->update( 'aioseo\_notifications' ) |
| [515](#L515) | ->where( 'new', 1 ) |
| [516](#L516) | ->set( 'new', 0 ) |
| [517](#L517) | ->run(); |
| [518](#L518) | } |
| [519](#L519) | } |
| [520](#L520) |  |
| [521](#L521) | /\*\* |
| [522](#L522) | \* Noindexes the WooCommerce cart, checkout and account pages. |
| [523](#L523) | \* |
| [524](#L524) | \* @since 4.1.3 |
| [525](#L525) | \* |
| [526](#L526) | \* @return void |
| [527](#L527) | \*/ |
| [528](#L528) | public function noindexWooCommercePages() { |
| [529](#L529) | if ( ! aioseo()->helpers->isWooCommerceActive() ) { |
| [530](#L530) | return; |
| [531](#L531) | } |
| [532](#L532) |  |
| [533](#L533) | $cartId     = (int) get\_option( 'woocommerce\_cart\_page\_id' ); |
| [534](#L534) | $checkoutId = (int) get\_option( 'woocommerce\_checkout\_page\_id' ); |
| [535](#L535) | $accountId  = (int) get\_option( 'woocommerce\_myaccount\_page\_id' ); |
| [536](#L536) |  |
| [537](#L537) | $cartPage     = Models\Post::getPost( $cartId ); |
| [538](#L538) | $checkoutPage = Models\Post::getPost( $checkoutId ); |
| [539](#L539) | $accountPage  = Models\Post::getPost( $accountId ); |
| [540](#L540) |  |
| [541](#L541) | $newMeta = [ |
| [542](#L542) | 'robots\_default' => false, |
| [543](#L543) | 'robots\_noindex' => true |
| [544](#L544) | ]; |
| [545](#L545) |  |
| [546](#L546) | if ( $cartPage->exists() ) { |
| [547](#L547) | $cartPage->set( $newMeta ); |
| [548](#L548) | $cartPage->save(); |
| [549](#L549) | } |
| [550](#L550) | if ( $checkoutPage->exists() ) { |
| [551](#L551) | $checkoutPage->set( $newMeta ); |
| [552](#L552) | $checkoutPage->save(); |
| [553](#L553) | } |
| [554](#L554) | if ( $accountPage->exists() ) { |
| [555](#L555) | $accountPage->set( $newMeta ); |
| [556](#L556) | $accountPage->save(); |
| [557](#L557) | } |
| [558](#L558) | } |
| [559](#L559) |  |
| [560](#L560) | /\*\* |
| [561](#L561) | \* Adds the new capabilities for all the roles. |
| [562](#L562) | \* |
| [563](#L563) | \* @since 4.1.3 |
| [564](#L564) | \* |
| [565](#L565) | \* @return void |
| [566](#L566) | \*/ |
| [567](#L567) | protected function accessControlNewCapabilities() { |
| [568](#L568) | aioseo()->access->addCapabilities(); |
| [569](#L569) | } |
| [570](#L570) |  |
| [571](#L571) | /\*\* |
| [572](#L572) | \* Migrate dynamic settings to a separate options structure. |
| [573](#L573) | \* |
| [574](#L574) | \* @since 4.1.4 |
| [575](#L575) | \* |
| [576](#L576) | \* @return void |
| [577](#L577) | \*/ |
| [578](#L578) | protected function migrateDynamicSettings() { |
| [579](#L579) | $rawOptions = $this->getRawOptions(); |
| [580](#L580) | $options    = aioseo()->dynamicOptions->noConflict(); |
| [581](#L581) |  |
| [582](#L582) | // Sitemap post type priorities/frequencies. |
| [583](#L583) | if ( |
| [584](#L584) | ! empty( $rawOptions['sitemap']['dynamic']['priority']['postTypes'] ) |
| [585](#L585) | ) { |
| [586](#L586) | foreach ( $rawOptions['sitemap']['dynamic']['priority']['postTypes'] as $postTypeName => $data ) { |
| [587](#L587) | if ( $options->sitemap->priority->postTypes->has( $postTypeName ) ) { |
| [588](#L588) | $options->sitemap->priority->postTypes->$postTypeName->priority  = $data['priority']; |
| [589](#L589) | $options->sitemap->priority->postTypes->$postTypeName->frequency = $data['frequency']; |
| [590](#L590) | } |
| [591](#L591) | } |
| [592](#L592) | } |
| [593](#L593) |  |
| [594](#L594) | // Sitemap taxonomy priorities/frequencies. |
| [595](#L595) | if ( |
| [596](#L596) | ! empty( $rawOptions['sitemap']['dynamic']['priority']['taxonomies'] ) |
| [597](#L597) | ) { |
| [598](#L598) | foreach ( $rawOptions['sitemap']['dynamic']['priority']['taxonomies'] as $taxonomyName => $data ) { |
| [599](#L599) | if ( $options->sitemap->priority->taxonomies->has( $taxonomyName ) ) { |
| [600](#L600) | $options->sitemap->priority->taxonomies->$taxonomyName->priority  = $data['priority']; |
| [601](#L601) | $options->sitemap->priority->taxonomies->$taxonomyName->frequency = $data['frequency']; |
| [602](#L602) | } |
| [603](#L603) | } |
| [604](#L604) | } |
| [605](#L605) |  |
| [606](#L606) | // Facebook post type object types. |
| [607](#L607) | if ( |
| [608](#L608) | ! empty( $rawOptions['social']['facebook']['general']['dynamic']['postTypes'] ) |
| [609](#L609) | ) { |
| [610](#L610) | foreach ( $rawOptions['social']['facebook']['general']['dynamic']['postTypes'] as $postTypeName => $data ) { |
| [611](#L611) | if ( $options->social->facebook->general->postTypes->has( $postTypeName ) ) { |
| [612](#L612) | $options->social->facebook->general->postTypes->$postTypeName->objectType = $data['objectType']; |
| [613](#L613) | } |
| [614](#L614) | } |
| [615](#L615) | } |
| [616](#L616) |  |
| [617](#L617) | // Search appearance post type data. |
| [618](#L618) | if ( |
| [619](#L619) | ! empty( $rawOptions['searchAppearance']['dynamic']['postTypes'] ) |
| [620](#L620) | ) { |
| [621](#L621) | foreach ( $rawOptions['searchAppearance']['dynamic']['postTypes'] as $postTypeName => $data ) { |
| [622](#L622) | if ( $options->searchAppearance->postTypes->has( $postTypeName ) ) { |
| [623](#L623) | $options->searchAppearance->postTypes->$postTypeName->show            = $data['show']; |
| [624](#L624) | $options->searchAppearance->postTypes->$postTypeName->title           = $data['title']; |
| [625](#L625) | $options->searchAppearance->postTypes->$postTypeName->metaDescription = $data['metaDescription']; |
| [626](#L626) | $options->searchAppearance->postTypes->$postTypeName->schemaType      = $data['schemaType']; |
| [627](#L627) | $options->searchAppearance->postTypes->$postTypeName->webPageType     = $data['webPageType']; |
| [628](#L628) | $options->searchAppearance->postTypes->$postTypeName->articleType     = $data['articleType']; |
| [629](#L629) | $options->searchAppearance->postTypes->$postTypeName->customFields    = $data['customFields']; |
| [630](#L630) |  |
| [631](#L631) | // Advanced settings. |
| [632](#L632) | $advanced = ! empty( $data['advanced']['robotsMeta'] ) ? $data['advanced']['robotsMeta'] : null; |
| [633](#L633) | if ( ! empty( $advanced ) ) { |
| [634](#L634) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->default         = $data['advanced']['robotsMeta']['default']; |
| [635](#L635) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->noindex         = $data['advanced']['robotsMeta']['noindex']; |
| [636](#L636) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->nofollow        = $data['advanced']['robotsMeta']['nofollow']; |
| [637](#L637) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->noarchive       = $data['advanced']['robotsMeta']['noarchive']; |
| [638](#L638) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->noimageindex    = $data['advanced']['robotsMeta']['noimageindex']; |
| [639](#L639) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->notranslate     = $data['advanced']['robotsMeta']['notranslate']; |
| [640](#L640) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->nosnippet       = $data['advanced']['robotsMeta']['nosnippet']; |
| [641](#L641) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->noodp           = $data['advanced']['robotsMeta']['noodp']; |
| [642](#L642) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->maxSnippet      = $data['advanced']['robotsMeta']['maxSnippet']; |
| [643](#L643) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->maxVideoPreview = $data['advanced']['robotsMeta']['maxVideoPreview']; |
| [644](#L644) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->maxImagePreview = $data['advanced']['robotsMeta']['maxImagePreview']; |
| [645](#L645) | $options->searchAppearance->postTypes->$postTypeName->advanced->showDateInGooglePreview     = $data['advanced']['showDateInGooglePreview']; |
| [646](#L646) | $options->searchAppearance->postTypes->$postTypeName->advanced->showPostThumbnailInSearch   = $data['advanced']['showPostThumbnailInSearch']; |
| [647](#L647) | $options->searchAppearance->postTypes->$postTypeName->advanced->showMetaBox                 = $data['advanced']['showMetaBox']; |
| [648](#L648) | $options->searchAppearance->postTypes->$postTypeName->advanced->bulkEditing                 = $data['advanced']['bulkEditing']; |
| [649](#L649) | } |
| [650](#L650) |  |
| [651](#L651) | if ( 'attachment' === $postTypeName ) { |
| [652](#L652) | $options->searchAppearance->postTypes->$postTypeName->redirectAttachmentUrls = $data['redirectAttachmentUrls']; |
| [653](#L653) | } |
| [654](#L654) | } |
| [655](#L655) | } |
| [656](#L656) | } |
| [657](#L657) |  |
| [658](#L658) | // Search appearance taxonomy data. |
| [659](#L659) | if ( |
| [660](#L660) | ! empty( $rawOptions['searchAppearance']['dynamic']['taxonomies'] ) |
| [661](#L661) | ) { |
| [662](#L662) | foreach ( $rawOptions['searchAppearance']['dynamic']['taxonomies'] as $taxonomyName => $data ) { |
| [663](#L663) | if ( $options->searchAppearance->taxonomies->has( $taxonomyName ) ) { |
| [664](#L664) | $options->searchAppearance->taxonomies->$taxonomyName->show            = $data['show']; |
| [665](#L665) | $options->searchAppearance->taxonomies->$taxonomyName->title           = $data['title']; |
| [666](#L666) | $options->searchAppearance->taxonomies->$taxonomyName->metaDescription = $data['metaDescription']; |
| [667](#L667) |  |
| [668](#L668) | // Advanced settings. |
| [669](#L669) | $advanced = ! empty( $data['advanced']['robotsMeta'] ) ? $data['advanced']['robotsMeta'] : null; |
| [670](#L670) | if ( ! empty( $advanced ) ) { |
| [671](#L671) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->default         = $data['advanced']['robotsMeta']['default']; |
| [672](#L672) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->noindex         = $data['advanced']['robotsMeta']['noindex']; |
| [673](#L673) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->nofollow        = $data['advanced']['robotsMeta']['nofollow']; |
| [674](#L674) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->noarchive       = $data['advanced']['robotsMeta']['noarchive']; |
| [675](#L675) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->noimageindex    = $data['advanced']['robotsMeta']['noimageindex']; |
| [676](#L676) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->notranslate     = $data['advanced']['robotsMeta']['notranslate']; |
| [677](#L677) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->nosnippet       = $data['advanced']['robotsMeta']['nosnippet']; |
| [678](#L678) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->noodp           = $data['advanced']['robotsMeta']['noodp']; |
| [679](#L679) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->maxSnippet      = $data['advanced']['robotsMeta']['maxSnippet']; |
| [680](#L680) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->maxVideoPreview = $data['advanced']['robotsMeta']['maxVideoPreview']; |
| [681](#L681) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->maxImagePreview = $data['advanced']['robotsMeta']['maxImagePreview']; |
| [682](#L682) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->showDateInGooglePreview     = $data['advanced']['showDateInGooglePreview']; |
| [683](#L683) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->showPostThumbnailInSearch   = $data['advanced']['showPostThumbnailInSearch']; |
| [684](#L684) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->showMetaBox                 = $data['advanced']['showMetaBox']; |
| [685](#L685) | } |
| [686](#L686) | } |
| [687](#L687) | } |
| [688](#L688) | } |
| [689](#L689) | } |
| [690](#L690) |  |
| [691](#L691) | /\*\* |
| [692](#L692) | \* Fixes the default value for the post schema type. |
| [693](#L693) | \* |
| [694](#L694) | \* @since 4.1.5 |
| [695](#L695) | \* |
| [696](#L696) | \* @return void |
| [697](#L697) | \*/ |
| [698](#L698) | private function fixSchemaTypeDefault() { |
| [699](#L699) | if ( aioseo()->core->db->tableExists( 'aioseo\_posts' ) && aioseo()->core->db->columnExists( 'aioseo\_posts', 'schema\_type' ) ) { |
| [700](#L700) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [701](#L701) | aioseo()->core->db->execute( |
| [702](#L702) | "ALTER TABLE {$tableName} |
| [703](#L703) | MODIFY schema\_type varchar(20) DEFAULT 'default'" |
| [704](#L704) | ); |
| [705](#L705) | } |
| [706](#L706) | } |
| [707](#L707) |  |
| [708](#L708) | /\*\* |
| [709](#L709) | \* Add in image with/height columns and image URL for caching. |
| [710](#L710) | \* |
| [711](#L711) | \* @since 4.1.6 |
| [712](#L712) | \* |
| [713](#L713) | \* @return void |
| [714](#L714) | \*/ |
| [715](#L715) | protected function migrateOgTwitterImageColumns() { |
| [716](#L716) | if ( aioseo()->core->db->tableExists( 'aioseo\_posts' ) ) { |
| [717](#L717) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [718](#L718) |  |
| [719](#L719) | // OG Columns. |
| [720](#L720) | if ( ! aioseo()->core->db->columnExists( 'aioseo\_posts', 'og\_image\_url' ) ) { |
| [721](#L721) | aioseo()->core->db->execute( |
| [722](#L722) | "ALTER TABLE {$tableName} ADD og\_image\_url text DEFAULT NULL AFTER og\_image\_type" |
| [723](#L723) | ); |
| [724](#L724) | } |
| [725](#L725) |  |
| [726](#L726) | if ( aioseo()->core->db->columnExists( 'aioseo\_posts', 'og\_custom\_image\_height' ) ) { |
| [727](#L727) | aioseo()->core->db->execute( |
| [728](#L728) | "ALTER TABLE {$tableName} CHANGE COLUMN og\_custom\_image\_height og\_image\_height int(11) DEFAULT NULL AFTER og\_image\_url" |
| [729](#L729) | ); |
| [730](#L730) | } elseif ( ! aioseo()->core->db->columnExists( 'aioseo\_posts', 'og\_image\_height' ) ) { |
| [731](#L731) | aioseo()->core->db->execute( |
| [732](#L732) | "ALTER TABLE {$tableName} ADD og\_image\_height int(11) DEFAULT NULL AFTER og\_image\_url" |
| [733](#L733) | ); |
| [734](#L734) | } |
| [735](#L735) |  |
| [736](#L736) | if ( aioseo()->core->db->columnExists( 'aioseo\_posts', 'og\_custom\_image\_width' ) ) { |
| [737](#L737) | aioseo()->core->db->execute( |
| [738](#L738) | "ALTER TABLE {$tableName} CHANGE COLUMN og\_custom\_image\_width og\_image\_width int(11) DEFAULT NULL AFTER og\_image\_url" |
| [739](#L739) | ); |
| [740](#L740) | } elseif ( ! aioseo()->core->db->columnExists( 'aioseo\_posts', 'og\_image\_width' ) ) { |
| [741](#L741) | aioseo()->core->db->execute( |
| [742](#L742) | "ALTER TABLE {$tableName} ADD og\_image\_width int(11) DEFAULT NULL AFTER og\_image\_url" |
| [743](#L743) | ); |
| [744](#L744) | } |
| [745](#L745) |  |
| [746](#L746) | // Twitter image url columnn. |
| [747](#L747) | if ( ! aioseo()->core->db->columnExists( 'aioseo\_posts', 'twitter\_image\_url' ) ) { |
| [748](#L748) | aioseo()->core->db->execute( |
| [749](#L749) | "ALTER TABLE {$tableName} ADD twitter\_image\_url text DEFAULT NULL AFTER twitter\_image\_type" |
| [750](#L750) | ); |
| [751](#L751) | } |
| [752](#L752) |  |
| [753](#L753) | // Reset the cache for the installed tables. |
| [754](#L754) | aioseo()->internalOptions->database->installedTables = ''; |
| [755](#L755) | } |
| [756](#L756) | } |
| [757](#L757) |  |
| [758](#L758) | /\*\* |
| [759](#L759) | \* Adds the limit modified date column to our posts table. |
| [760](#L760) | \* |
| [761](#L761) | \* @since 4.1.8 |
| [762](#L762) | \* |
| [763](#L763) | \* @return void |
| [764](#L764) | \*/ |
| [765](#L765) | private function addLimitModifiedDateColumn() { |
| [766](#L766) | if ( ! aioseo()->core->db->columnExists( 'aioseo\_posts', 'limit\_modified\_date' ) ) { |
| [767](#L767) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [768](#L768) | aioseo()->core->db->execute( |
| [769](#L769) | "ALTER TABLE {$tableName} |
| [770](#L770) | ADD limit\_modified\_date tinyint(1) NOT NULL DEFAULT 0 AFTER local\_seo" |
| [771](#L771) | ); |
| [772](#L772) |  |
| [773](#L773) | // Reset the cache for the installed tables. |
| [774](#L774) | aioseo()->internalOptions->database->installedTables = ''; |
| [775](#L775) | } |
| [776](#L776) | } |
| [777](#L777) |  |
| [778](#L778) | /\*\* |
| [779](#L779) | \* Fixes tags that should not be in the search appearance taxonomy options. |
| [780](#L780) | \* |
| [781](#L781) | \* @since 4.1.9 |
| [782](#L782) | \* |
| [783](#L783) | \* @return void |
| [784](#L784) | \*/ |
| [785](#L785) | protected function fixTaxonomyTags() { |
| [786](#L786) | $searchAppearanceTaxonomies = aioseo()->dynamicOptions->searchAppearance->taxonomies->all(); |
| [787](#L787) |  |
| [788](#L788) | $replaces = [ |
| [789](#L789) | '#breadcrumb\_separator' => '#separator\_sa', |
| [790](#L790) | '#breadcrumb\_'          => '#', |
| [791](#L791) | '#blog\_title'           => '#site\_title' |
| [792](#L792) | ]; |
| [793](#L793) |  |
| [794](#L794) | foreach ( $searchAppearanceTaxonomies as $taxonomy => $searchAppearanceTaxonomy ) { |
| [795](#L795) | aioseo()->dynamicOptions->searchAppearance->taxonomies->{$taxonomy}->title = str\_replace( |
| [796](#L796) | array\_keys( $replaces ), |
| [797](#L797) | array\_values( $replaces ), |
| [798](#L798) | $searchAppearanceTaxonomy['title'] |
| [799](#L799) | ); |
| [800](#L800) |  |
| [801](#L801) | aioseo()->dynamicOptions->searchAppearance->taxonomies->{$taxonomy}->metaDescription = str\_replace( |
| [802](#L802) | array\_keys( $replaces ), |
| [803](#L803) | array\_values( $replaces ), |
| [804](#L804) | $searchAppearanceTaxonomy['metaDescription'] |
| [805](#L805) | ); |
| [806](#L806) | } |
| [807](#L807) | } |
| [808](#L808) |  |
| [809](#L809) | /\*\* |
| [810](#L810) | \* Removes any AIOSEO Post records for revisions. |
| [811](#L811) | \* |
| [812](#L812) | \* @since 4.1.9 |
| [813](#L813) | \* |
| [814](#L814) | \* @return void |
| [815](#L815) | \*/ |
| [816](#L816) | private function removeRevisionRecords() { |
| [817](#L817) | $postsTableName       = aioseo()->core->db->prefix . 'posts'; |
| [818](#L818) | $aioseoPostsTableName = aioseo()->core->db->prefix . 'aioseo\_posts'; |
| [819](#L819) | aioseo()->core->db->execute( |
| [820](#L820) | "DELETE FROM `$aioseoPostsTableName` |
| [821](#L821) | WHERE `post\_id` IN ( |
| [822](#L822) | SELECT `ID` |
| [823](#L823) | FROM `$postsTableName` |
| [824](#L824) | WHERE `post\_parent` != 0 |
| [825](#L825) | AND `post\_type` = 'revision' |
| [826](#L826) | AND `post\_status` = 'inherit' |
| [827](#L827) | )" |
| [828](#L828) | ); |
| [829](#L829) | } |
| [830](#L830) |  |
| [831](#L831) | /\*\* |
| [832](#L832) | \* Enables the new shortcodes parsing setting if it was already enabled before as a deprecated setting. |
| [833](#L833) | \* |
| [834](#L834) | \* @since 4.2.0 |
| [835](#L835) | \* |
| [836](#L836) | \* @return void |
| [837](#L837) | \*/ |
| [838](#L838) | private function migrateDeprecatedRunShortcodesSetting() { |
| [839](#L839) | if ( |
| [840](#L840) | in\_array( 'runShortcodesInDescription', aioseo()->internalOptions->deprecatedOptions, true ) && |
| [841](#L841) | ! aioseo()->options->deprecated->searchAppearance->advanced->runShortcodesInDescription |
| [842](#L842) | ) { |
| [843](#L843) | return; |
| [844](#L844) | } |
| [845](#L845) |  |
| [846](#L846) | aioseo()->options->searchAppearance->advanced->runShortcodes = true; |
| [847](#L847) | } |
| [848](#L848) |  |
| [849](#L849) | /\*\* |
| [850](#L850) | \* Add options column. |
| [851](#L851) | \* |
| [852](#L852) | \* @since 4.2.2 |
| [853](#L853) | \* |
| [854](#L854) | \* @return void |
| [855](#L855) | \*/ |
| [856](#L856) | private function addOptionsColumn() { |
| [857](#L857) | if ( ! aioseo()->core->db->columnExists( 'aioseo\_posts', 'options' ) ) { |
| [858](#L858) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [859](#L859) | aioseo()->core->db->execute( |
| [860](#L860) | "ALTER TABLE {$tableName} |
| [861](#L861) | ADD `options` longtext DEFAULT NULL AFTER `limit\_modified\_date`" |
| [862](#L862) | ); |
| [863](#L863) |  |
| [864](#L864) | // Reset the cache for the installed tables. |
| [865](#L865) | aioseo()->internalOptions->database->installedTables = ''; |
| [866](#L866) | } |
| [867](#L867) | } |
| [868](#L868) |  |
| [869](#L869) | /\*\* |
| [870](#L870) | \* Remove the tabs column as it is unnecessary. |
| [871](#L871) | \* |
| [872](#L872) | \* @since 4.2.2 |
| [873](#L873) | \* |
| [874](#L874) | \* @return void |
| [875](#L875) | \*/ |
| [876](#L876) | protected function removeTabsColumn() { |
| [877](#L877) | if ( aioseo()->core->db->columnExists( 'aioseo\_posts', 'tabs' ) ) { |
| [878](#L878) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [879](#L879) | aioseo()->core->db->execute( |
| [880](#L880) | "ALTER TABLE {$tableName} |
| [881](#L881) | DROP tabs" |
| [882](#L882) | ); |
| [883](#L883) | } |
| [884](#L884) | } |
| [885](#L885) |  |
| [886](#L886) | /\*\* |
| [887](#L887) | \* Migrates the user contact methods to the new format. |
| [888](#L888) | \* |
| [889](#L889) | \* @since 4.2.2 |
| [890](#L890) | \* |
| [891](#L891) | \* @return void |
| [892](#L892) | \*/ |
| [893](#L893) | private function migrateUserContactMethods() { |
| [894](#L894) | $userMetaTableName = aioseo()->core->db->prefix . 'usermeta'; |
| [895](#L895) |  |
| [896](#L896) | aioseo()->core->db->execute( |
| [897](#L897) | "UPDATE `$userMetaTableName` |
| [898](#L898) | SET `meta\_key` = 'aioseo\_facebook\_page\_url' |
| [899](#L899) | WHERE `meta\_key` = 'aioseo\_facebook'" |
| [900](#L900) | ); |
| [901](#L901) |  |
| [902](#L902) | aioseo()->core->db->execute( |
| [903](#L903) | "UPDATE `$userMetaTableName` |
| [904](#L904) | SET `meta\_key` = 'aioseo\_twitter\_url' |
| [905](#L905) | WHERE `meta\_key` = 'aioseo\_twitter'" |
| [906](#L906) | ); |
| [907](#L907) | } |
| [908](#L908) |  |
| [909](#L909) | /\*\* |
| [910](#L910) | \* Migrates some older values in the Knowledge Panel contact type setting that were removed. |
| [911](#L911) | \* |
| [912](#L912) | \* @since 4.2.4 |
| [913](#L913) | \* |
| [914](#L914) | \* @return void |
| [915](#L915) | \*/ |
| [916](#L916) | public function migrateContactTypes() { |
| [917](#L917) | $oldValue          = aioseo()->options->searchAppearance->global->schema->contactType; |
| [918](#L918) | $oldValueLowerCase = strtolower( (string) $oldValue ); |
| [919](#L919) |  |
| [920](#L920) | // Return if there is no value set or manual input is being used. |
| [921](#L921) | if ( ! $oldValue || 'manual' === $oldValueLowerCase ) { |
| [922](#L922) | return; |
| [923](#L923) | } |
| [924](#L924) |  |
| [925](#L925) | switch ( $oldValueLowerCase ) { |
| [926](#L926) | case 'billing support': |
| [927](#L927) | case 'customer support': |
| [928](#L928) | case 'reservations': |
| [929](#L929) | case 'sales': |
| [930](#L930) | case 'technical support': |
| [931](#L931) | // If we still support the value, do nothing. |
| [932](#L932) | return; |
| [933](#L933) | default: |
| [934](#L934) | // Otherwise, migrate the existing value to the manual input field. |
| [935](#L935) | if ( 'bagage tracking' === $oldValueLowerCase ) { |
| [936](#L936) | // Let's also fix this old typo. |
| [937](#L937) | $oldValue = 'Baggage Tracking'; |
| [938](#L938) | } |
| [939](#L939) |  |
| [940](#L940) | aioseo()->options->searchAppearance->global->schema->contactType       = 'manual'; |
| [941](#L941) | aioseo()->options->searchAppearance->global->schema->contactTypeManual = $oldValue; |
| [942](#L942) | } |
| [943](#L943) | } |
| [944](#L944) |  |
| [945](#L945) | /\*\* |
| [946](#L946) | \* Add an addon column to the notifications table. |
| [947](#L947) | \* |
| [948](#L948) | \* @since 4.2.4 |
| [949](#L949) | \* |
| [950](#L950) | \* @return void |
| [951](#L951) | \*/ |
| [952](#L952) | private function addNotificationsAddonColumn() { |
| [953](#L953) | if ( ! aioseo()->core->db->columnExists( 'aioseo\_notifications', 'addon' ) ) { |
| [954](#L954) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_notifications'; |
| [955](#L955) | aioseo()->core->db->execute( |
| [956](#L956) | "ALTER TABLE {$tableName} |
| [957](#L957) | ADD `addon` varchar(64) DEFAULT NULL AFTER `slug`" |
| [958](#L958) | ); |
| [959](#L959) |  |
| [960](#L960) | // Reset the cache for the installed tables. |
| [961](#L961) | aioseo()->internalOptions->database->installedTables = ''; |
| [962](#L962) | } |
| [963](#L963) | } |
| [964](#L964) |  |
| [965](#L965) | /\*\* |
| [966](#L966) | \* Adds the schema column. |
| [967](#L967) | \* |
| [968](#L968) | \* @since 4.2.5 |
| [969](#L969) | \* |
| [970](#L970) | \* @return void |
| [971](#L971) | \*/ |
| [972](#L972) | private function addSchemaColumn() { |
| [973](#L973) | if ( ! aioseo()->core->db->columnExists( 'aioseo\_posts', 'schema' ) ) { |
| [974](#L974) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [975](#L975) | aioseo()->core->db->execute( |
| [976](#L976) | "ALTER TABLE {$tableName} |
| [977](#L977) | ADD `schema` longtext DEFAULT NULL AFTER `seo\_score`" |
| [978](#L978) | ); |
| [979](#L979) | } |
| [980](#L980) | } |
| [981](#L981) |  |
| [982](#L982) | /\*\* |
| [983](#L983) | \* Schedules the post schema migration. |
| [984](#L984) | \* |
| [985](#L985) | \* @since 4.2.5 |
| [986](#L986) | \* |
| [987](#L987) | \* @return void |
| [988](#L988) | \*/ |
| [989](#L989) | private function schedulePostSchemaMigration() { |
| [990](#L990) | aioseo()->actionScheduler->scheduleSingle( 'aioseo\_v4\_migrate\_post\_schema', 10 ); |
| [991](#L991) | } |
| [992](#L992) |  |
| [993](#L993) | /\*\* |
| [994](#L994) | \* Migrates then post schema to the new JSON column. |
| [995](#L995) | \* |
| [996](#L996) | \* @since 4.2.5 |
| [997](#L997) | \* |
| [998](#L998) | \* @return void |
| [999](#L999) | \*/ |
| [1000](#L1000) | public function migratePostSchema() { |
| [1001](#L1001) | $posts = aioseo()->core->db->start( 'aioseo\_posts' ) |
| [1002](#L1002) | ->select( '\*' ) |
| [1003](#L1003) | ->whereRaw( '`schema` IS NULL' ) |
| [1004](#L1004) | ->limit( 40 ) |
| [1005](#L1005) | ->run() |
| [1006](#L1006) | ->models( 'AIOSEO\\Plugin\\Common\\Models\\Post' ); |
| [1007](#L1007) |  |
| [1008](#L1008) | if ( empty( $posts ) ) { |
| [1009](#L1009) | return; |
| [1010](#L1010) | } |
| [1011](#L1011) |  |
| [1012](#L1012) | foreach ( $posts as $post ) { |
| [1013](#L1013) | $this->migratePostSchemaHelper( $post ); |
| [1014](#L1014) | } |
| [1015](#L1015) |  |
| [1016](#L1016) | // Once done, schedule the next action. |
| [1017](#L1017) | aioseo()->actionScheduler->scheduleSingle( 'aioseo\_v4\_migrate\_post\_schema', 30 ); |
| [1018](#L1018) | } |
| [1019](#L1019) |  |
| [1020](#L1020) | /\*\* |
| [1021](#L1021) | \* Schedules the post schema migration to fix the default graphs. |
| [1022](#L1022) | \* |
| [1023](#L1023) | \* @since 4.2.6 |
| [1024](#L1024) | \* |
| [1025](#L1025) | \* @return void |
| [1026](#L1026) | \*/ |
| [1027](#L1027) | private function schedulePostSchemaDefaultMigration() { |
| [1028](#L1028) | aioseo()->actionScheduler->scheduleSingle( 'aioseo\_v4\_migrate\_post\_schema\_default', 10 ); |
| [1029](#L1029) |  |
| [1030](#L1030) | if ( ! aioseo()->cache->get( 'v4\_migrate\_post\_schema\_default\_date' ) ) { |
| [1031](#L1031) | aioseo()->cache->update( 'v4\_migrate\_post\_schema\_default\_date', gmdate( 'Y-m-d H:i:s' ), 3 \* MONTH\_IN\_SECONDS ); |
| [1032](#L1032) | } |
| [1033](#L1033) | } |
| [1034](#L1034) |  |
| [1035](#L1035) | /\*\* |
| [1036](#L1036) | \* Updates the dashboardWidgets with the new array format. |
| [1037](#L1037) | \* |
| [1038](#L1038) | \* @since 4.2.8 |
| [1039](#L1039) | \* |
| [1040](#L1040) | \* @return void |
| [1041](#L1041) | \*/ |
| [1042](#L1042) | private function migrateDashboardWidgetsOptions() { |
| [1043](#L1043) | $rawOptions = $this->getRawOptions(); |
| [1044](#L1044) |  |
| [1045](#L1045) | if ( empty( $rawOptions ) || ! is\_bool( $rawOptions['advanced']['dashboardWidgets'] ) ) { |
| [1046](#L1046) | return; |
| [1047](#L1047) | } |
| [1048](#L1048) |  |
| [1049](#L1049) | $widgets = [ 'seoNews' ]; |
| [1050](#L1050) |  |
| [1051](#L1051) | // If the dashboardWidgets was activated, let's turn on the other widgets. |
| [1052](#L1052) | if ( $rawOptions['advanced']['dashboardWidgets'] ) { |
| [1053](#L1053) | $widgets[] = 'seoOverview'; |
| [1054](#L1054) | $widgets[] = 'seoSetup'; |
| [1055](#L1055) | } |
| [1056](#L1056) |  |
| [1057](#L1057) | aioseo()->options->advanced->dashboardWidgets = $widgets; |
| [1058](#L1058) | } |
| [1059](#L1059) |  |
| [1060](#L1060) | /\*\* |
| [1061](#L1061) | \* Migrates the post schema to the new JSON column again for posts using the default. |
| [1062](#L1062) | \* This is needed to fix an oversight because in 4.2.5 we didn't migrate any properties set to the default graph. |
| [1063](#L1063) | \* |
| [1064](#L1064) | \* @since 4.2.6 |
| [1065](#L1065) | \* |
| [1066](#L1066) | \* @return void |
| [1067](#L1067) | \*/ |
| [1068](#L1068) | public function migratePostSchemaDefault() { |
| [1069](#L1069) | $migrationStartDate = aioseo()->cache->get( 'v4\_migrate\_post\_schema\_default\_date' ); |
| [1070](#L1070) | if ( ! $migrationStartDate ) { |
| [1071](#L1071) | return; |
| [1072](#L1072) | } |
| [1073](#L1073) |  |
| [1074](#L1074) | $posts = aioseo()->core->db->start( 'aioseo\_posts' ) |
| [1075](#L1075) | ->select( '\*' ) |
| [1076](#L1076) | ->where( 'schema\_type =', 'default' ) |
| [1077](#L1077) | ->whereRaw( "updated < '$migrationStartDate'" ) |
| [1078](#L1078) | ->limit( 40 ) |
| [1079](#L1079) | ->run() |
| [1080](#L1080) | ->models( 'AIOSEO\\Plugin\\Common\\Models\\Post' ); |
| [1081](#L1081) |  |
| [1082](#L1082) | if ( empty( $posts ) ) { |
| [1083](#L1083) | aioseo()->cache->delete( 'v4\_migrate\_post\_schema\_default\_date' ); |
| [1084](#L1084) |  |
| [1085](#L1085) | return; |
| [1086](#L1086) | } |
| [1087](#L1087) |  |
| [1088](#L1088) | foreach ( $posts as $post ) { |
| [1089](#L1089) | $this->migratePostSchemaHelper( $post ); |
| [1090](#L1090) | } |
| [1091](#L1091) |  |
| [1092](#L1092) | // Once done, schedule the next action. |
| [1093](#L1093) | aioseo()->actionScheduler->scheduleSingle( 'aioseo\_v4\_migrate\_post\_schema\_default', 30 ); |
| [1094](#L1094) | } |
| [1095](#L1095) |  |
| [1096](#L1096) | /\*\* |
| [1097](#L1097) | \* Helper function for the schema migration. |
| [1098](#L1098) | \* |
| [1099](#L1099) | \* @since  4.2.5 |
| [1100](#L1100) | \* |
| [1101](#L1101) | \* @param  Post $aioseoPost The AIOSEO post object. |
| [1102](#L1102) | \* @return Post             The modified AIOSEO post object. |
| [1103](#L1103) | \*/ |
| [1104](#L1104) | public function migratePostSchemaHelper( $aioseoPost ) { |
| [1105](#L1105) | $post              = aioseo()->helpers->getPost( $aioseoPost->post\_id ); |
| [1106](#L1106) | $schemaType        = $aioseoPost->schema\_type; |
| [1107](#L1107) | $schemaTypeOptions = json\_decode( (string) $aioseoPost->schema\_type\_options ); |
| [1108](#L1108) | $schemaOptions     = Models\Post::getDefaultSchemaOptions( '', $post ); |
| [1109](#L1109) |  |
| [1110](#L1110) | if ( empty( $schemaTypeOptions ) ) { |
| [1111](#L1111) | $aioseoPost->schema = $schemaOptions; |
| [1112](#L1112) | $aioseoPost->save(); |
| [1113](#L1113) |  |
| [1114](#L1114) | return $aioseoPost; |
| [1115](#L1115) | } |
| [1116](#L1116) |  |
| [1117](#L1117) | // If the post is set to the default schema type, set the default for post type but then also get the properties. |
| [1118](#L1118) | $isDefault = 'default' === $schemaType; |
| [1119](#L1119) | if ( $isDefault ) { |
| [1120](#L1120) | $dynamicOptions = aioseo()->dynamicOptions->noConflict(); |
| [1121](#L1121) | if ( ! empty( $post->post\_type ) && $dynamicOptions->searchAppearance->postTypes->has( $post->post\_type ) ) { |
| [1122](#L1122) | $schemaOptions->default->graphName = $dynamicOptions->searchAppearance->postTypes->{$post->post\_type}->schemaType; |
| [1123](#L1123) | $schemaType                        = $dynamicOptions->searchAppearance->postTypes->{$post->post\_type}->schemaType; |
| [1124](#L1124) | } |
| [1125](#L1125) | } |
| [1126](#L1126) |  |
| [1127](#L1127) | $graph = []; |
| [1128](#L1128) | switch ( $schemaType ) { |
| [1129](#L1129) | case 'Article': |
| [1130](#L1130) | $graph = [ |
| [1131](#L1131) | 'id'         => 'aioseo-article-' . uniqid(), |
| [1132](#L1132) | 'slug'       => 'article', |
| [1133](#L1133) | 'graphName'  => 'Article', |
| [1134](#L1134) | 'label'      => \_\_( 'Article', 'all-in-one-seo-pack' ), |
| [1135](#L1135) | 'properties' => [ |
| [1136](#L1136) | 'type'        => ! empty( $schemaTypeOptions->article->articleType ) ? $schemaTypeOptions->article->articleType : 'Article', |
| [1137](#L1137) | 'name'        => '#post\_title', |
| [1138](#L1138) | 'headline'    => '#post\_title', |
| [1139](#L1139) | 'description' => '#post\_excerpt', |
| [1140](#L1140) | 'image'       => '', |
| [1141](#L1141) | 'keywords'    => '', |
| [1142](#L1142) | 'author'      => [ |
| [1143](#L1143) | 'name' => '#author\_name', |
| [1144](#L1144) | 'url'  => '#author\_url' |
| [1145](#L1145) | ], |
| [1146](#L1146) | 'dates'       => [ |
| [1147](#L1147) | 'include'       => true, |
| [1148](#L1148) | 'datePublished' => '', |
| [1149](#L1149) | 'dateModified'  => '' |
| [1150](#L1150) | ] |
| [1151](#L1151) | ] |
| [1152](#L1152) | ]; |
| [1153](#L1153) | break; |
| [1154](#L1154) | case 'Course': |
| [1155](#L1155) | $graph = [ |
| [1156](#L1156) | 'id'         => 'aioseo-course-' . uniqid(), |
| [1157](#L1157) | 'slug'       => 'course', |
| [1158](#L1158) | 'graphName'  => 'Course', |
| [1159](#L1159) | 'label'      => \_\_( 'Course', 'all-in-one-seo-pack' ), |
| [1160](#L1160) | 'properties' => [ |
| [1161](#L1161) | 'name'        => ! empty( $schemaTypeOptions->course->name ) ? $schemaTypeOptions->course->name : '#post\_title', |
| [1162](#L1162) | 'description' => ! empty( $schemaTypeOptions->course->description ) ? $schemaTypeOptions->course->description : '#post\_excerpt', |
| [1163](#L1163) | 'provider'    => [ |
| [1164](#L1164) | 'name'  => ! empty( $schemaTypeOptions->course->provider ) ? $schemaTypeOptions->course->provider : '', |
| [1165](#L1165) | 'url'   => '', |
| [1166](#L1166) | 'image' => '' |
| [1167](#L1167) | ] |
| [1168](#L1168) | ] |
| [1169](#L1169) | ]; |
| [1170](#L1170) | break; |
| [1171](#L1171) | case 'Product': |
| [1172](#L1172) | $graph = [ |
| [1173](#L1173) | 'id'         => 'aioseo-product-' . uniqid(), |
| [1174](#L1174) | 'slug'       => 'product', |
| [1175](#L1175) | 'graphName'  => 'Product', |
| [1176](#L1176) | 'label'      => \_\_( 'Product', 'all-in-one-seo-pack' ), |
| [1177](#L1177) | 'properties' => [ |
| [1178](#L1178) | 'autogenerate' => true, |
| [1179](#L1179) | 'name'         => '#post\_title', |
| [1180](#L1180) | 'description'  => ! empty( $schemaTypeOptions->product->description ) ? $schemaTypeOptions->product->description : '#post\_excerpt', |
| [1181](#L1181) | 'brand'        => ! empty( $schemaTypeOptions->product->brand ) ? $schemaTypeOptions->product->brand : '', |
| [1182](#L1182) | 'image'        => '', |
| [1183](#L1183) | 'identifiers'  => [ |
| [1184](#L1184) | 'sku'  => ! empty( $schemaTypeOptions->product->sku ) ? $schemaTypeOptions->product->sku : '', |
| [1185](#L1185) | 'gtin' => '', |
| [1186](#L1186) | 'mpn'  => '' |
| [1187](#L1187) | ], |
| [1188](#L1188) | 'offer'        => [ |
| [1189](#L1189) | 'price'        => ! empty( $schemaTypeOptions->product->price ) ? (float) $schemaTypeOptions->product->price : '', |
| [1190](#L1190) | 'currency'     => ! empty( $schemaTypeOptions->product->currency ) ? $schemaTypeOptions->product->currency : '', |
| [1191](#L1191) | 'availability' => ! empty( $schemaTypeOptions->product->availability ) ? $schemaTypeOptions->product->availability : '', |
| [1192](#L1192) | 'validUntil'   => ! empty( $schemaTypeOptions->product->priceValidUntil ) ? $schemaTypeOptions->product->priceValidUntil : '' |
| [1193](#L1193) | ], |
| [1194](#L1194) | 'rating'       => [ |
| [1195](#L1195) | 'minimum' => 1, |
| [1196](#L1196) | 'maximum' => 5 |
| [1197](#L1197) | ], |
| [1198](#L1198) | 'reviews'      => [] |
| [1199](#L1199) | ] |
| [1200](#L1200) | ]; |
| [1201](#L1201) |  |
| [1202](#L1202) | $identifierType = ! empty( $schemaTypeOptions->product->identifierType ) ? $schemaTypeOptions->product->identifierType : ''; |
| [1203](#L1203) | if ( preg\_match( '/gtin/i', $identifierType ) ) { |
| [1204](#L1204) | $graph['properties']['identifiers']['gtin'] = $identifierType; |
| [1205](#L1205) | } |
| [1206](#L1206) |  |
| [1207](#L1207) | if ( preg\_match( '/mpn/i', $identifierType ) ) { |
| [1208](#L1208) | $graph['properties']['identifiers']['mpn'] = $identifierType; |
| [1209](#L1209) | } |
| [1210](#L1210) |  |
| [1211](#L1211) | $reviews = ! empty( $schemaTypeOptions->product->reviews ) ? $schemaTypeOptions->product->reviews : []; |
| [1212](#L1212) | if ( ! empty( $reviews ) ) { |
| [1213](#L1213) | foreach ( $reviews as $reviewData ) { |
| [1214](#L1214) | $reviewData = json\_decode( $reviewData ); |
| [1215](#L1215) | if ( empty( $reviewData ) ) { |
| [1216](#L1216) | continue; |
| [1217](#L1217) | } |
| [1218](#L1218) |  |
| [1219](#L1219) | $graph['properties']['reviews'][] = [ |
| [1220](#L1220) | 'rating'   => $reviewData->rating, |
| [1221](#L1221) | 'headline' => $reviewData->headline, |
| [1222](#L1222) | 'content'  => $reviewData->content, |
| [1223](#L1223) | 'author'   => $reviewData->author |
| [1224](#L1224) | ]; |
| [1225](#L1225) | } |
| [1226](#L1226) | } |
| [1227](#L1227) | break; |
| [1228](#L1228) | case 'Recipe': |
| [1229](#L1229) | $graph = [ |
| [1230](#L1230) | 'id'         => 'aioseo-recipe-' . uniqid(), |
| [1231](#L1231) | 'slug'       => 'recipe', |
| [1232](#L1232) | 'graphName'  => 'Recipe', |
| [1233](#L1233) | 'label'      => \_\_( 'Recipe', 'all-in-one-seo-pack' ), |
| [1234](#L1234) | 'properties' => [ |
| [1235](#L1235) | 'name'         => ! empty( $schemaTypeOptions->recipe->name ) ? $schemaTypeOptions->recipe->name : '#post\_title', |
| [1236](#L1236) | 'description'  => ! empty( $schemaTypeOptions->recipe->description ) ? $schemaTypeOptions->recipe->description : '#post\_excerpt', |
| [1237](#L1237) | 'author'       => ! empty( $schemaTypeOptions->recipe->author ) ? $schemaTypeOptions->recipe->author : '#author\_name', |
| [1238](#L1238) | 'ingredients'  => ! empty( $schemaTypeOptions->recipe->ingredients ) ? $schemaTypeOptions->recipe->ingredients : '', |
| [1239](#L1239) | 'dishType'     => ! empty( $schemaTypeOptions->recipe->dishType ) ? $schemaTypeOptions->recipe->dishType : '', |
| [1240](#L1240) | 'cuisineType'  => ! empty( $schemaTypeOptions->recipe->cuisineType ) ? $schemaTypeOptions->recipe->cuisineType : '', |
| [1241](#L1241) | 'keywords'     => ! empty( $schemaTypeOptions->recipe->keywords ) ? $schemaTypeOptions->recipe->keywords : '', |
| [1242](#L1242) | 'image'        => ! empty( $schemaTypeOptions->recipe->image ) ? $schemaTypeOptions->recipe->image : '', |
| [1243](#L1243) | 'nutrition'    => [ |
| [1244](#L1244) | 'servings' => ! empty( $schemaTypeOptions->recipe->servings ) ? $schemaTypeOptions->recipe->servings : '', |
| [1245](#L1245) | 'calories' => ! empty( $schemaTypeOptions->recipe->calories ) ? $schemaTypeOptions->recipe->calories : '' |
| [1246](#L1246) | ], |
| [1247](#L1247) | 'timeRequired' => [ |
| [1248](#L1248) | 'preparation' => ! empty( $schemaTypeOptions->recipe->preparationTime ) ? $schemaTypeOptions->recipe->preparationTime : '', |
| [1249](#L1249) | 'cooking'     => ! empty( $schemaTypeOptions->recipe->cookingTime ) ? $schemaTypeOptions->recipe->cookingTime : '' |
| [1250](#L1250) | ], |
| [1251](#L1251) | 'instructions' => [] |
| [1252](#L1252) | ] |
| [1253](#L1253) | ]; |
| [1254](#L1254) |  |
| [1255](#L1255) | $instructions = ! empty( $schemaTypeOptions->recipe->instructions ) ? $schemaTypeOptions->recipe->instructions : []; |
| [1256](#L1256) | if ( ! empty( $instructions ) ) { |
| [1257](#L1257) | foreach ( $instructions as $instructionData ) { |
| [1258](#L1258) | $instructionData = json\_decode( $instructionData ); |
| [1259](#L1259) | if ( empty( $instructionData ) ) { |
| [1260](#L1260) | continue; |
| [1261](#L1261) | } |
| [1262](#L1262) |  |
| [1263](#L1263) | $graph['properties']['instructions'][] = [ |
| [1264](#L1264) | 'name'  => '', |
| [1265](#L1265) | 'text'  => $instructionData->content, |
| [1266](#L1266) | 'image' => '' |
| [1267](#L1267) | ]; |
| [1268](#L1268) | } |
| [1269](#L1269) | } |
| [1270](#L1270) | break; |
| [1271](#L1271) | case 'SoftwareApplication': |
| [1272](#L1272) | $graph = [ |
| [1273](#L1273) | 'id'         => 'aioseo-software-application-' . uniqid(), |
| [1274](#L1274) | 'slug'       => 'software-application', |
| [1275](#L1275) | 'graphName'  => 'SoftwareApplication', |
| [1276](#L1276) | 'label'      => \_\_( 'Software', 'all-in-one-seo-pack' ), |
| [1277](#L1277) | 'properties' => [ |
| [1278](#L1278) | 'name'            => ! empty( $schemaTypeOptions->software->name ) ? $schemaTypeOptions->software->name : '#post\_title', |
| [1279](#L1279) | 'description'     => '#post\_excerpt', |
| [1280](#L1280) | 'price'           => ! empty( $schemaTypeOptions->software->price ) ? (float) $schemaTypeOptions->software->price : '', |
| [1281](#L1281) | 'currency'        => ! empty( $schemaTypeOptions->software->currency ) ? $schemaTypeOptions->software->currency : '', |
| [1282](#L1282) | 'operatingSystem' => ! empty( $schemaTypeOptions->software->operatingSystems ) ? $schemaTypeOptions->software->operatingSystems : '', |
| [1283](#L1283) | 'category'        => ! empty( $schemaTypeOptions->software->category ) ? $schemaTypeOptions->software->category : '', |
| [1284](#L1284) | 'rating'          => [ |
| [1285](#L1285) | 'value'   => '', |
| [1286](#L1286) | 'minimum' => 1, |
| [1287](#L1287) | 'maximum' => 5 |
| [1288](#L1288) | ], |
| [1289](#L1289) | 'review'          => [ |
| [1290](#L1290) | 'headline' => '', |
| [1291](#L1291) | 'content'  => '', |
| [1292](#L1292) | 'author'   => '' |
| [1293](#L1293) | ] |
| [1294](#L1294) | ] |
| [1295](#L1295) | ]; |
| [1296](#L1296) |  |
| [1297](#L1297) | $reviews = ! empty( $schemaTypeOptions->software->reviews ) ? $schemaTypeOptions->software->reviews : []; |
| [1298](#L1298) | if ( ! empty( $reviews[0] ) ) { |
| [1299](#L1299) | $reviewData = json\_decode( $reviews[0] ); |
| [1300](#L1300) | if ( empty( $reviewData ) ) { |
| [1301](#L1301) | break; |
| [1302](#L1302) | } |
| [1303](#L1303) |  |
| [1304](#L1304) | $graph['properties']['rating']['value'] = $reviewData->rating; |
| [1305](#L1305) | $graph['properties']['review'] = [ |
| [1306](#L1306) | 'headline' => $reviewData->headline, |
| [1307](#L1307) | 'content'  => $reviewData->content, |
| [1308](#L1308) | 'author'   => $reviewData->author |
| [1309](#L1309) | ]; |
| [1310](#L1310) | } |
| [1311](#L1311) | break; |
| [1312](#L1312) | case 'WebPage': |
| [1313](#L1313) | if ( 'FAQPage' === $schemaTypeOptions->webPage->webPageType ) { |
| [1314](#L1314) | $graph = [ |
| [1315](#L1315) | 'id'         => 'aioseo-faq-page-' . uniqid(), |
| [1316](#L1316) | 'slug'       => 'faq-page', |
| [1317](#L1317) | 'graphName'  => 'FAQPage', |
| [1318](#L1318) | 'label'      => \_\_( 'FAQ Page', 'all-in-one-seo-pack' ), |
| [1319](#L1319) | 'properties' => [ |
| [1320](#L1320) | 'type'        => $schemaTypeOptions->webPage->webPageType, |
| [1321](#L1321) | 'name'        => '#post\_title', |
| [1322](#L1322) | 'description' => '#post\_excerpt', |
| [1323](#L1323) | 'questions'   => [] |
| [1324](#L1324) | ] |
| [1325](#L1325) | ]; |
| [1326](#L1326) |  |
| [1327](#L1327) | $faqs = $schemaTypeOptions->faq->pages; |
| [1328](#L1328) | if ( ! empty( $faqs ) ) { |
| [1329](#L1329) | foreach ( $faqs as $faqData ) { |
| [1330](#L1330) | $faqData = json\_decode( $faqData ); |
| [1331](#L1331) | if ( empty( $faqData ) ) { |
| [1332](#L1332) | continue; |
| [1333](#L1333) | } |
| [1334](#L1334) |  |
| [1335](#L1335) | $graph['properties']['questions'][] = [ |
| [1336](#L1336) | 'question' => $faqData->question, |
| [1337](#L1337) | 'answer'   => $faqData->answer |
| [1338](#L1338) | ]; |
| [1339](#L1339) | } |
| [1340](#L1340) | } |
| [1341](#L1341) | } else { |
| [1342](#L1342) | $graph = [ |
| [1343](#L1343) | 'id'         => 'aioseo-web-page-' . uniqid(), |
| [1344](#L1344) | 'slug'       => 'web-page', |
| [1345](#L1345) | 'graphName'  => 'WebPage', |
| [1346](#L1346) | 'label'      => \_\_( 'Web Page', 'all-in-one-seo-pack' ), |
| [1347](#L1347) | 'properties' => [ |
| [1348](#L1348) | 'type'        => $schemaTypeOptions->webPage->webPageType, |
| [1349](#L1349) | 'name'        => '', |
| [1350](#L1350) | 'description' => '' |
| [1351](#L1351) | ] |
| [1352](#L1352) | ]; |
| [1353](#L1353) | } |
| [1354](#L1354) | break; |
| [1355](#L1355) | case 'default': |
| [1356](#L1356) | $dynamicOptions = aioseo()->dynamicOptions->noConflict(); |
| [1357](#L1357) | if ( ! empty( $post->post\_type ) && $dynamicOptions->searchAppearance->postTypes->has( $post->post\_type ) ) { |
| [1358](#L1358) | $schemaOptions->defaultGraph = $dynamicOptions->searchAppearance->postTypes->{$post->post\_type}->schemaType; |
| [1359](#L1359) | } |
| [1360](#L1360) | break; |
| [1361](#L1361) | case 'none': |
| [1362](#L1362) | // If "none', we simply don't have to migrate anything. |
| [1363](#L1363) | default: |
| [1364](#L1364) | break; |
| [1365](#L1365) | } |
| [1366](#L1366) |  |
| [1367](#L1367) | if ( ! empty( $graph ) ) { |
| [1368](#L1368) | if ( $isDefault ) { |
| [1369](#L1369) | $schemaOptions->default->data->{$schemaType} = $graph; |
| [1370](#L1370) | } else { |
| [1371](#L1371) | $schemaOptions->graphs[]           = $graph; |
| [1372](#L1372) | $schemaOptions->default->isEnabled = false; |
| [1373](#L1373) | } |
| [1374](#L1374) | } |
| [1375](#L1375) |  |
| [1376](#L1376) | $aioseoPost->schema = $schemaOptions; |
| [1377](#L1377) | $aioseoPost->save(); |
| [1378](#L1378) |  |
| [1379](#L1379) | return $aioseoPost; |
| [1380](#L1380) | } |
| [1381](#L1381) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/all-in-one-seo-pack/tags/4.2.9/app/Common/Main/Updates.php?format=txt)
* [Original Format](/export/3222465/all-in-one-seo-pack/tags/4.2.9/app/Common/Main/Updates.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_bfe24ccc_20250114_201431.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fall-in-one-seo-pack%2Ftags%2F4.2.9%2Fapp%2FCommon%2FMain%2FUpdates.php%3Fv%3D2829340)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/all-in-one-seo-pack/trunk/app/Common/Main/Updates.php?rev=2814301 "Revision 2814301")
* [Next Revision](/browser/all-in-one-seo-pack/trunk/app/Common/Main/Updates.php?rev=2866377 "Revision 2866377") →
* [Blame](/browser/all-in-one-seo-pack/trunk/app/Common/Main/Updates.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/all-in-one-seo-pack/tags/4.2.9/app/Common/Main/Updates.php)

---

# [source:](/browser?order=name "Go to repository root") [all-in-one-seo-pack](/browser/all-in-one-seo-pack?order=name "View all-in-one-seo-pack")/[tags](/browser/all-in-one-seo-pack/tags?order=name "View tags")/[4.2.9](/browser/all-in-one-seo-pack/tags/4.2.9?order=name "View 4.2.9")/[app](/browser/all-in-one-seo-pack/tags/4.2.9/app?order=name "View app")/[Common](/browser/all-in-one-seo-pack/tags/4.2.9/app/Common?order=name "View Common")/[Main](/browser/all-in-one-seo-pack/tags/4.2.9/app/Common/Main?order=name "View Main")/[Updates.php](/browser/all-in-one-seo-pack/tags/4.2.9/app/Common/Main/Updates.php?order=name "View Updates.php")

View diff against:

View revision:

| [Last change](/changeset/2829340/all-in-one-seo-pack/trunk/app/Common/Main/Updates.php "View differences") on this file was [2829340](/changeset/2829340/ "View changeset 2829340"), checked in by cristianrossi, [2 years ago](/timeline?from=2022-12-06T12%3A31%3A50Z&precision=second "See timeline at 12/06/2022 12:31:50 PM") |
| --- |
| 4.2.8 |
| **File size:** 46.1 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | namespace AIOSEO\Plugin\Common\Main; |
| [3](#L3) |  |
| [4](#L4) | use \AIOSEO\Plugin\Common\Models; |
| [5](#L5) |  |
| [6](#L6) | // Exit if accessed directly. |
| [7](#L7) | if ( ! defined( 'ABSPATH' ) ) { |
| [8](#L8) | exit; |
| [9](#L9) | } |
| [10](#L10) |  |
| [11](#L11) | /\*\* |
| [12](#L12) | \* Updater class. |
| [13](#L13) | \* |
| [14](#L14) | \* @since 4.0.0 |
| [15](#L15) | \*/ |
| [16](#L16) | class Updates { |
| [17](#L17) | /\*\* |
| [18](#L18) | \* Class constructor. |
| [19](#L19) | \* |
| [20](#L20) | \* @since 4.0.0 |
| [21](#L21) | \*/ |
| [22](#L22) | public function \_\_construct() { |
| [23](#L23) | add\_action( 'aioseo\_v4\_migrate\_post\_schema', [ $this, 'migratePostSchema' ] ); |
| [24](#L24) | add\_action( 'aioseo\_v4\_migrate\_post\_schema\_default', [ $this, 'migratePostSchemaDefault' ] ); |
| [25](#L25) |  |
| [26](#L26) | if ( wp\_doing\_ajax() || wp\_doing\_cron() ) { |
| [27](#L27) | return; |
| [28](#L28) | } |
| [29](#L29) |  |
| [30](#L30) | add\_action( 'init', [ $this, 'init' ], 1001 ); |
| [31](#L31) | add\_action( 'init', [ $this, 'runUpdates' ], 1002 ); |
| [32](#L32) | add\_action( 'init', [ $this, 'updateLatestVersion' ], 3000 ); |
| [33](#L33) | } |
| [34](#L34) |  |
| [35](#L35) | /\*\* |
| [36](#L36) | \* Sets the latest active version if it is not set yet. |
| [37](#L37) | \* |
| [38](#L38) | \* @since 4.0.0 |
| [39](#L39) | \* |
| [40](#L40) | \* @return void |
| [41](#L41) | \*/ |
| [42](#L42) | public function init() { |
| [43](#L43) | if ( '0.0' !== aioseo()->internalOptions->internal->lastActiveVersion ) { |
| [44](#L44) | return; |
| [45](#L45) | } |
| [46](#L46) |  |
| [47](#L47) | // It's possible the user may not have capabilities. Let's add them now. |
| [48](#L48) | aioseo()->access->addCapabilities(); |
| [49](#L49) |  |
| [50](#L50) | $oldOptions = get\_option( 'aioseop\_options' ); |
| [51](#L51) | if ( ! empty( $oldOptions['last\_active\_version'] ) ) { |
| [52](#L52) | aioseo()->internalOptions->internal->lastActiveVersion = $oldOptions['last\_active\_version']; |
| [53](#L53) | } |
| [54](#L54) |  |
| [55](#L55) | $this->addInitialCustomTablesForV4(); |
| [56](#L56) | add\_action( 'wp\_loaded', [ $this, 'setDefaultSocialImages' ], 1001 ); |
| [57](#L57) | } |
| [58](#L58) |  |
| [59](#L59) | /\*\* |
| [60](#L60) | \* Runs our migrations. |
| [61](#L61) | \* |
| [62](#L62) | \* @since 4.0.0 |
| [63](#L63) | \* |
| [64](#L64) | \* @return void |
| [65](#L65) | \*/ |
| [66](#L66) | public function runUpdates() { |
| [67](#L67) | // The dynamic options have not yet fully loaded, so let's refresh here to force that to happen. |
| [68](#L68) | aioseo()->dynamicOptions->refresh(); // TODO: Check if we still need this since it already runs on 999 in the main AIOSEO file. |
| [69](#L69) |  |
| [70](#L70) | $lastActiveVersion = aioseo()->internalOptions->internal->lastActiveVersion; |
| [71](#L71) | if ( version\_compare( $lastActiveVersion, '4.0.5', '<' ) ) { |
| [72](#L72) | $this->addImageScanDateColumn(); |
| [73](#L73) | } |
| [74](#L74) |  |
| [75](#L75) | if ( version\_compare( $lastActiveVersion, '4.0.6', '<' ) ) { |
| [76](#L76) | $this->disableTwitterUseOgDefault(); |
| [77](#L77) | $this->updateMaxImagePreviewDefault(); |
| [78](#L78) | } |
| [79](#L79) |  |
| [80](#L80) | if ( ! aioseo()->pro && version\_compare( $lastActiveVersion, '4.0.6', '=' ) && 'posts' !== get\_option( 'show\_on\_front' ) ) { |
| [81](#L81) | aioseo()->migration->helpers->redoMigration(); |
| [82](#L82) | } |
| [83](#L83) |  |
| [84](#L84) | if ( version\_compare( $lastActiveVersion, '4.0.13', '<' ) ) { |
| [85](#L85) | $this->removeDuplicateRecords(); |
| [86](#L86) | } |
| [87](#L87) |  |
| [88](#L88) | if ( version\_compare( $lastActiveVersion, '4.0.17', '<' ) ) { |
| [89](#L89) | $this->removeLocationColumn(); |
| [90](#L90) | } |
| [91](#L91) |  |
| [92](#L92) | if ( version\_compare( $lastActiveVersion, '4.1.2', '<' ) ) { |
| [93](#L93) | $this->clearProductImages(); |
| [94](#L94) | } |
| [95](#L95) |  |
| [96](#L96) | if ( version\_compare( $lastActiveVersion, '4.1.3', '<' ) ) { |
| [97](#L97) | $this->addNotificationsNewColumn(); |
| [98](#L98) | $this->noindexWooCommercePages(); |
| [99](#L99) | $this->accessControlNewCapabilities(); |
| [100](#L100) | } |
| [101](#L101) |  |
| [102](#L102) | if ( version\_compare( $lastActiveVersion, '4.1.3.3', '<' ) ) { |
| [103](#L103) | $this->accessControlNewCapabilities(); |
| [104](#L104) | } |
| [105](#L105) |  |
| [106](#L106) | if ( version\_compare( $lastActiveVersion, '4.1.4.3', '<' ) ) { |
| [107](#L107) | $this->migrateDynamicSettings(); |
| [108](#L108) | } |
| [109](#L109) |  |
| [110](#L110) | if ( version\_compare( $lastActiveVersion, '4.1.5', '<' ) ) { |
| [111](#L111) | aioseo()->actionScheduler->unschedule( 'aioseo\_cleanup\_action\_scheduler' ); |
| [112](#L112) | // Schedule routine to remove our old transients from the options table. |
| [113](#L113) | aioseo()->actionScheduler->scheduleSingle( aioseo()->core->cachePrune->getOptionCacheCleanAction(), MINUTE\_IN\_SECONDS ); |
| [114](#L114) |  |
| [115](#L115) | // Refresh with new Redirects capability. |
| [116](#L116) | $this->accessControlNewCapabilities(); |
| [117](#L117) |  |
| [118](#L118) | // Regenerate the sitemap if using a static one to update the data for the new stylesheets. |
| [119](#L119) | aioseo()->sitemap->regenerateStaticSitemap(); |
| [120](#L120) |  |
| [121](#L121) | $this->fixSchemaTypeDefault(); |
| [122](#L122) | } |
| [123](#L123) |  |
| [124](#L124) | if ( version\_compare( $lastActiveVersion, '4.1.6', '<' ) ) { |
| [125](#L125) | // Remove the recurring scheduled action for notifications. |
| [126](#L126) | aioseo()->actionScheduler->unschedule( 'aioseo\_admin\_notifications\_update' ); |
| [127](#L127) |  |
| [128](#L128) | $this->migrateOgTwitterImageColumns(); |
| [129](#L129) |  |
| [130](#L130) | // Set the OG data to false for current installs. |
| [131](#L131) | aioseo()->options->social->twitter->general->useOgData = false; |
| [132](#L132) | } |
| [133](#L133) |  |
| [134](#L134) | if ( version\_compare( $lastActiveVersion, '4.1.8', '<' ) ) { |
| [135](#L135) | $this->addLimitModifiedDateColumn(); |
| [136](#L136) |  |
| [137](#L137) | // Refresh with new Redirects Page capability. |
| [138](#L138) | $this->accessControlNewCapabilities(); |
| [139](#L139) | } |
| [140](#L140) |  |
| [141](#L141) | if ( version\_compare( $lastActiveVersion, '4.1.9', '<' ) ) { |
| [142](#L142) | $this->fixTaxonomyTags(); |
| [143](#L143) | $this->removeRevisionRecords(); |
| [144](#L144) | } |
| [145](#L145) |  |
| [146](#L146) | if ( version\_compare( $lastActiveVersion, '4.0.0', '>=' ) && version\_compare( $lastActiveVersion, '4.2.0', '<' ) ) { |
| [147](#L147) | $this->migrateDeprecatedRunShortcodesSetting(); |
| [148](#L148) | } |
| [149](#L149) |  |
| [150](#L150) | if ( version\_compare( $lastActiveVersion, '4.2.1', '<' ) ) { |
| [151](#L151) | // Force WordPress to flush the rewrite rules. |
| [152](#L152) | aioseo()->options->flushRewriteRules(); |
| [153](#L153) |  |
| [154](#L154) | Models\Notification::deleteNotificationByName( 'deprecated-filters' ); |
| [155](#L155) | Models\Notification::deleteNotificationByName( 'deprecated-filters-v2' ); |
| [156](#L156) | } |
| [157](#L157) |  |
| [158](#L158) | if ( version\_compare( $lastActiveVersion, '4.2.2', '<' ) ) { |
| [159](#L159) | aioseo()->internalOptions->database->installedTables = ''; |
| [160](#L160) |  |
| [161](#L161) | $this->addOptionsColumn(); |
| [162](#L162) | $this->removeTabsColumn(); |
| [163](#L163) | $this->migrateUserContactMethods(); |
| [164](#L164) |  |
| [165](#L165) | // Unschedule any static sitemap regeneration actions to remove any that failed and are still in-progress as a result. |
| [166](#L166) | aioseo()->actionScheduler->unschedule( 'aioseo\_static\_sitemap\_regeneration' ); |
| [167](#L167) | } |
| [168](#L168) |  |
| [169](#L169) | if ( version\_compare( $lastActiveVersion, '4.2.4', '<' ) ) { |
| [170](#L170) | $this->migrateContactTypes(); |
| [171](#L171) | $this->addNotificationsAddonColumn(); |
| [172](#L172) | } |
| [173](#L173) |  |
| [174](#L174) | if ( version\_compare( $lastActiveVersion, '4.2.5', '<' ) ) { |
| [175](#L175) | $this->addSchemaColumn(); |
| [176](#L176) | $this->schedulePostSchemaMigration(); |
| [177](#L177) | } |
| [178](#L178) |  |
| [179](#L179) | if ( version\_compare( $lastActiveVersion, '4.2.4.2', '>' ) && version\_compare( $lastActiveVersion, '4.2.6', '<' ) ) { |
| [180](#L180) | // The default graphs only need to be remigrated if the user was on 4.2.5 or 4.2.5.1. |
| [181](#L181) | $this->schedulePostSchemaDefaultMigration(); |
| [182](#L182) | } |
| [183](#L183) |  |
| [184](#L184) | if ( version\_compare( $lastActiveVersion, '4.2.8', '<' ) ) { |
| [185](#L185) | $this->migrateDashboardWidgetsOptions(); |
| [186](#L186) | } |
| [187](#L187) |  |
| [188](#L188) | do\_action( 'aioseo\_run\_updates', $lastActiveVersion ); |
| [189](#L189) |  |
| [190](#L190) | // Always clear the cache if the last active version is different from our current. |
| [191](#L191) | if ( version\_compare( $lastActiveVersion, AIOSEO\_VERSION, '<' ) ) { |
| [192](#L192) | aioseo()->core->cache->clear(); |
| [193](#L193) | } |
| [194](#L194) | } |
| [195](#L195) |  |
| [196](#L196) | /\*\* |
| [197](#L197) | \* Retrieve the raw options from the database for migration. |
| [198](#L198) | \* |
| [199](#L199) | \* @since 4.1.4 |
| [200](#L200) | \* |
| [201](#L201) | \* @return array An array of options. |
| [202](#L202) | \*/ |
| [203](#L203) | private function getRawOptions() { |
| [204](#L204) | // Options from the DB. |
| [205](#L205) | $commonOptions = json\_decode( get\_option( aioseo()->options->optionsName ), true ); |
| [206](#L206) | if ( empty( $commonOptions ) ) { |
| [207](#L207) | $commonOptions = []; |
| [208](#L208) | } |
| [209](#L209) |  |
| [210](#L210) | return $commonOptions; |
| [211](#L211) | } |
| [212](#L212) |  |
| [213](#L213) | /\*\* |
| [214](#L214) | \* Updates the latest version after all migrations and updates have run. |
| [215](#L215) | \* |
| [216](#L216) | \* @since 4.0.3 |
| [217](#L217) | \* |
| [218](#L218) | \* @return void |
| [219](#L219) | \*/ |
| [220](#L220) | public function updateLatestVersion() { |
| [221](#L221) | if ( aioseo()->internalOptions->internal->lastActiveVersion === aioseo()->version ) { |
| [222](#L222) | return; |
| [223](#L223) | } |
| [224](#L224) |  |
| [225](#L225) | aioseo()->internalOptions->internal->lastActiveVersion = aioseo()->version; |
| [226](#L226) |  |
| [227](#L227) | // Bust the tableExists and columnExists cache. |
| [228](#L228) | aioseo()->internalOptions->database->installedTables = ''; |
| [229](#L229) |  |
| [230](#L230) | // Bust the DB cache so we can make sure that everything is fresh. |
| [231](#L231) | aioseo()->core->db->bustCache(); |
| [232](#L232) | } |
| [233](#L233) |  |
| [234](#L234) | /\*\* |
| [235](#L235) | \* Adds our custom tables for V4. |
| [236](#L236) | \* |
| [237](#L237) | \* @since 4.0.0 |
| [238](#L238) | \* |
| [239](#L239) | \* @return void |
| [240](#L240) | \*/ |
| [241](#L241) | public function addInitialCustomTablesForV4() { |
| [242](#L242) | $db             = aioseo()->core->db->db; |
| [243](#L243) | $charsetCollate = ''; |
| [244](#L244) |  |
| [245](#L245) | if ( ! empty( $db->charset ) ) { |
| [246](#L246) | $charsetCollate .= "DEFAULT CHARACTER SET {$db->charset}"; |
| [247](#L247) | } |
| [248](#L248) | if ( ! empty( $db->collate ) ) { |
| [249](#L249) | $charsetCollate .= " COLLATE {$db->collate}"; |
| [250](#L250) | } |
| [251](#L251) |  |
| [252](#L252) | // Check for notifications table. |
| [253](#L253) | if ( ! aioseo()->core->db->tableExists( 'aioseo\_notifications' ) ) { |
| [254](#L254) | $tableName = $db->prefix . 'aioseo\_notifications'; |
| [255](#L255) |  |
| [256](#L256) | aioseo()->core->db->execute( |
| [257](#L257) | "CREATE TABLE {$tableName} ( |
| [258](#L258) | id bigint(20) unsigned NOT NULL AUTO\_INCREMENT, |
| [259](#L259) | slug varchar(13) NOT NULL, |
| [260](#L260) | title text NOT NULL, |
| [261](#L261) | content longtext NOT NULL, |
| [262](#L262) | type varchar(64) NOT NULL, |
| [263](#L263) | level text NOT NULL, |
| [264](#L264) | notification\_id bigint(20) unsigned DEFAULT NULL, |
| [265](#L265) | notification\_name varchar(255) DEFAULT NULL, |
| [266](#L266) | start datetime DEFAULT NULL, |
| [267](#L267) | end datetime DEFAULT NULL, |
| [268](#L268) | button1\_label varchar(255) DEFAULT NULL, |
| [269](#L269) | button1\_action varchar(255) DEFAULT NULL, |
| [270](#L270) | button2\_label varchar(255) DEFAULT NULL, |
| [271](#L271) | button2\_action varchar(255) DEFAULT NULL, |
| [272](#L272) | dismissed tinyint(1) NOT NULL DEFAULT 0, |
| [273](#L273) | created datetime NOT NULL, |
| [274](#L274) | updated datetime NOT NULL, |
| [275](#L275) | PRIMARY KEY (id), |
| [276](#L276) | UNIQUE KEY ndx\_aioseo\_notifications\_slug (slug), |
| [277](#L277) | KEY ndx\_aioseo\_notifications\_dates (start, end), |
| [278](#L278) | KEY ndx\_aioseo\_notifications\_type (type), |
| [279](#L279) | KEY ndx\_aioseo\_notifications\_dismissed (dismissed) |
| [280](#L280) | ) {$charsetCollate};" |
| [281](#L281) | ); |
| [282](#L282) | } |
| [283](#L283) |  |
| [284](#L284) | if ( ! aioseo()->core->db->tableExists( 'aioseo\_posts' ) ) { |
| [285](#L285) | $tableName = $db->prefix . 'aioseo\_posts'; |
| [286](#L286) |  |
| [287](#L287) | // Incorrect defaults are adjusted below through migrations. |
| [288](#L288) | aioseo()->core->db->execute( |
| [289](#L289) | "CREATE TABLE {$tableName} ( |
| [290](#L290) | id bigint(20) unsigned NOT NULL AUTO\_INCREMENT, |
| [291](#L291) | post\_id bigint(20) unsigned NOT NULL, |
| [292](#L292) | title text DEFAULT NULL, |
| [293](#L293) | description text DEFAULT NULL, |
| [294](#L294) | keywords mediumtext DEFAULT NULL, |
| [295](#L295) | keyphrases longtext DEFAULT NULL, |
| [296](#L296) | page\_analysis longtext DEFAULT NULL, |
| [297](#L297) | canonical\_url text DEFAULT NULL, |
| [298](#L298) | og\_title text DEFAULT NULL, |
| [299](#L299) | og\_description text DEFAULT NULL, |
| [300](#L300) | og\_object\_type varchar(64) DEFAULT 'default', |
| [301](#L301) | og\_image\_type varchar(64) DEFAULT 'default', |
| [302](#L302) | og\_image\_custom\_url text DEFAULT NULL, |
| [303](#L303) | og\_image\_custom\_fields text DEFAULT NULL, |
| [304](#L304) | og\_custom\_image\_width int(11) DEFAULT NULL, |
| [305](#L305) | og\_custom\_image\_height int(11) DEFAULT NULL, |
| [306](#L306) | og\_video varchar(255) DEFAULT NULL, |
| [307](#L307) | og\_custom\_url text DEFAULT NULL, |
| [308](#L308) | og\_article\_section text DEFAULT NULL, |
| [309](#L309) | og\_article\_tags text DEFAULT NULL, |
| [310](#L310) | twitter\_use\_og tinyint(1) DEFAULT 1, |
| [311](#L311) | twitter\_card varchar(64) DEFAULT 'default', |
| [312](#L312) | twitter\_image\_type varchar(64) DEFAULT 'default', |
| [313](#L313) | twitter\_image\_custom\_url text DEFAULT NULL, |
| [314](#L314) | twitter\_image\_custom\_fields text DEFAULT NULL, |
| [315](#L315) | twitter\_title text DEFAULT NULL, |
| [316](#L316) | twitter\_description text DEFAULT NULL, |
| [317](#L317) | seo\_score int(11) DEFAULT 0 NOT NULL, |
| [318](#L318) | schema\_type varchar(20) DEFAULT NULL, |
| [319](#L319) | schema\_type\_options longtext DEFAULT NULL, |
| [320](#L320) | pillar\_content tinyint(1) DEFAULT NULL, |
| [321](#L321) | robots\_default tinyint(1) DEFAULT 1 NOT NULL, |
| [322](#L322) | robots\_noindex tinyint(1) DEFAULT 0 NOT NULL, |
| [323](#L323) | robots\_noarchive tinyint(1) DEFAULT 0 NOT NULL, |
| [324](#L324) | robots\_nosnippet tinyint(1) DEFAULT 0 NOT NULL, |
| [325](#L325) | robots\_nofollow tinyint(1) DEFAULT 0 NOT NULL, |
| [326](#L326) | robots\_noimageindex tinyint(1) DEFAULT 0 NOT NULL, |
| [327](#L327) | robots\_noodp tinyint(1) DEFAULT 0 NOT NULL, |
| [328](#L328) | robots\_notranslate tinyint(1) DEFAULT 0 NOT NULL, |
| [329](#L329) | robots\_max\_snippet int(11) DEFAULT NULL, |
| [330](#L330) | robots\_max\_videopreview int(11) DEFAULT NULL, |
| [331](#L331) | robots\_max\_imagepreview varchar(20) DEFAULT 'none', |
| [332](#L332) | tabs mediumtext DEFAULT NULL, |
| [333](#L333) | images longtext DEFAULT NULL, |
| [334](#L334) | priority tinytext DEFAULT NULL, |
| [335](#L335) | frequency tinytext DEFAULT NULL, |
| [336](#L336) | videos longtext DEFAULT NULL, |
| [337](#L337) | video\_thumbnail text DEFAULT NULL, |
| [338](#L338) | video\_scan\_date datetime DEFAULT NULL, |
| [339](#L339) | local\_seo longtext DEFAULT NULL, |
| [340](#L340) | created datetime NOT NULL, |
| [341](#L341) | updated datetime NOT NULL, |
| [342](#L342) | PRIMARY KEY (id), |
| [343](#L343) | KEY ndx\_aioseo\_posts\_post\_id (post\_id) |
| [344](#L344) | ) {$charsetCollate};" |
| [345](#L345) | ); |
| [346](#L346) | } |
| [347](#L347) |  |
| [348](#L348) | // Reset the cache for the installed tables. |
| [349](#L349) | aioseo()->internalOptions->database->installedTables = ''; |
| [350](#L350) | } |
| [351](#L351) |  |
| [352](#L352) | /\*\* |
| [353](#L353) | \* Sets the default social images. |
| [354](#L354) | \* |
| [355](#L355) | \* @since 4.0.0 |
| [356](#L356) | \* |
| [357](#L357) | \* @return void |
| [358](#L358) | \*/ |
| [359](#L359) | public function setDefaultSocialImages() { |
| [360](#L360) | $siteLogo = aioseo()->helpers->getSiteLogoUrl(); |
| [361](#L361) | if ( $siteLogo && ! aioseo()->internalOptions->internal->migratedVersion ) { |
| [362](#L362) | if ( ! aioseo()->options->social->facebook->general->defaultImagePosts ) { |
| [363](#L363) | aioseo()->options->social->facebook->general->defaultImagePosts = $siteLogo; |
| [364](#L364) | } |
| [365](#L365) | if ( ! aioseo()->options->social->twitter->general->defaultImagePosts ) { |
| [366](#L366) | aioseo()->options->social->twitter->general->defaultImagePosts = $siteLogo; |
| [367](#L367) | } |
| [368](#L368) | } |
| [369](#L369) | } |
| [370](#L370) |  |
| [371](#L371) | /\*\* |
| [372](#L372) | \* Adds the image scan date column to our posts table. |
| [373](#L373) | \* |
| [374](#L374) | \* @since 4.0.5 |
| [375](#L375) | \* |
| [376](#L376) | \* @return void |
| [377](#L377) | \*/ |
| [378](#L378) | public function addImageScanDateColumn() { |
| [379](#L379) | if ( ! aioseo()->core->db->columnExists( 'aioseo\_posts', 'image\_scan\_date' ) ) { |
| [380](#L380) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [381](#L381) | aioseo()->core->db->execute( |
| [382](#L382) | "ALTER TABLE {$tableName} |
| [383](#L383) | ADD image\_scan\_date datetime DEFAULT NULL AFTER images" |
| [384](#L384) | ); |
| [385](#L385) |  |
| [386](#L386) | // Reset the cache for the installed tables. |
| [387](#L387) | aioseo()->internalOptions->database->installedTables = ''; |
| [388](#L388) | } |
| [389](#L389) | } |
| [390](#L390) |  |
| [391](#L391) | /\*\* |
| [392](#L392) | \* Modifes the default value of the twitter\_use\_og column. |
| [393](#L393) | \* |
| [394](#L394) | \* @since 4.0.6 |
| [395](#L395) | \* |
| [396](#L396) | \* @return void |
| [397](#L397) | \*/ |
| [398](#L398) | protected function disableTwitterUseOgDefault() { |
| [399](#L399) | if ( aioseo()->core->db->tableExists( 'aioseo\_posts' ) ) { |
| [400](#L400) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [401](#L401) | aioseo()->core->db->execute( |
| [402](#L402) | "ALTER TABLE {$tableName} |
| [403](#L403) | MODIFY twitter\_use\_og tinyint(1) DEFAULT 0" |
| [404](#L404) | ); |
| [405](#L405) | } |
| [406](#L406) | } |
| [407](#L407) |  |
| [408](#L408) | /\*\* |
| [409](#L409) | \* Modifes the default value of the robots\_max\_imagepreview column. |
| [410](#L410) | \* |
| [411](#L411) | \* @since 4.0.6 |
| [412](#L412) | \* |
| [413](#L413) | \* @return void |
| [414](#L414) | \*/ |
| [415](#L415) | protected function updateMaxImagePreviewDefault() { |
| [416](#L416) | if ( aioseo()->core->db->tableExists( 'aioseo\_posts' ) ) { |
| [417](#L417) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [418](#L418) | aioseo()->core->db->execute( |
| [419](#L419) | "ALTER TABLE {$tableName} |
| [420](#L420) | MODIFY robots\_max\_imagepreview varchar(20) DEFAULT 'large'" |
| [421](#L421) | ); |
| [422](#L422) | } |
| [423](#L423) | } |
| [424](#L424) |  |
| [425](#L425) | /\*\* |
| [426](#L426) | \* Deletes duplicate records in our custom tables. |
| [427](#L427) | \* |
| [428](#L428) | \* @since 4.0.13 |
| [429](#L429) | \* |
| [430](#L430) | \* @return void |
| [431](#L431) | \*/ |
| [432](#L432) | public function removeDuplicateRecords() { |
| [433](#L433) | $duplicates = aioseo()->core->db->start( 'aioseo\_posts' ) |
| [434](#L434) | ->select( 'post\_id, min(id) as id' ) |
| [435](#L435) | ->groupBy( 'post\_id having count(post\_id) > 1' ) |
| [436](#L436) | ->orderBy( 'count(post\_id) DESC' ) |
| [437](#L437) | ->run() |
| [438](#L438) | ->result(); |
| [439](#L439) |  |
| [440](#L440) | if ( empty( $duplicates ) ) { |
| [441](#L441) | return; |
| [442](#L442) | } |
| [443](#L443) |  |
| [444](#L444) | foreach ( $duplicates as $duplicate ) { |
| [445](#L445) | $postId        = $duplicate->post\_id; |
| [446](#L446) | $firstRecordId = $duplicate->id; |
| [447](#L447) |  |
| [448](#L448) | aioseo()->core->db->delete( 'aioseo\_posts' ) |
| [449](#L449) | ->whereRaw( "( id > $firstRecordId AND post\_id = $postId )" ) |
| [450](#L450) | ->run(); |
| [451](#L451) | } |
| [452](#L452) | } |
| [453](#L453) |  |
| [454](#L454) | /\*\* |
| [455](#L455) | \* Removes the location column. |
| [456](#L456) | \* |
| [457](#L457) | \* @since 4.0.17 |
| [458](#L458) | \* |
| [459](#L459) | \* @return void |
| [460](#L460) | \*/ |
| [461](#L461) | public function removeLocationColumn() { |
| [462](#L462) | if ( aioseo()->core->db->columnExists( 'aioseo\_posts', 'location' ) ) { |
| [463](#L463) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [464](#L464) | aioseo()->core->db->execute( |
| [465](#L465) | "ALTER TABLE {$tableName} |
| [466](#L466) | DROP location" |
| [467](#L467) | ); |
| [468](#L468) | } |
| [469](#L469) | } |
| [470](#L470) |  |
| [471](#L471) | /\*\* |
| [472](#L472) | \* Clears the image data for WooCommerce Products so that we scan them again and include product gallery images. |
| [473](#L473) | \* |
| [474](#L474) | \* @since 4.1.2 |
| [475](#L475) | \* |
| [476](#L476) | \* @return void |
| [477](#L477) | \*/ |
| [478](#L478) | public function clearProductImages() { |
| [479](#L479) | if ( ! aioseo()->helpers->isWooCommerceActive() ) { |
| [480](#L480) | return; |
| [481](#L481) | } |
| [482](#L482) |  |
| [483](#L483) | aioseo()->core->db->update( 'aioseo\_posts as ap' ) |
| [484](#L484) | ->join( 'posts as p', 'ap.post\_id = p.ID' ) |
| [485](#L485) | ->where( 'p.post\_type', 'product' ) |
| [486](#L486) | ->set( |
| [487](#L487) | [ |
| [488](#L488) | 'images'          => null, |
| [489](#L489) | 'image\_scan\_date' => null |
| [490](#L490) | ] |
| [491](#L491) | ) |
| [492](#L492) | ->run(); |
| [493](#L493) | } |
| [494](#L494) |  |
| [495](#L495) | /\*\* |
| [496](#L496) | \* Adds the new flag to the notifications table. |
| [497](#L497) | \* |
| [498](#L498) | \* @since 4.1.3 |
| [499](#L499) | \* |
| [500](#L500) | \* @return void |
| [501](#L501) | \*/ |
| [502](#L502) | public function addNotificationsNewColumn() { |
| [503](#L503) | if ( ! aioseo()->core->db->columnExists( 'aioseo\_notifications', 'new' ) ) { |
| [504](#L504) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_notifications'; |
| [505](#L505) | aioseo()->core->db->execute( |
| [506](#L506) | "ALTER TABLE {$tableName} |
| [507](#L507) | ADD new tinyint(1) NOT NULL DEFAULT 1 AFTER dismissed" |
| [508](#L508) | ); |
| [509](#L509) |  |
| [510](#L510) | // Reset the cache for the installed tables. |
| [511](#L511) | aioseo()->internalOptions->database->installedTables = ''; |
| [512](#L512) |  |
| [513](#L513) | aioseo()->core->db |
| [514](#L514) | ->update( 'aioseo\_notifications' ) |
| [515](#L515) | ->where( 'new', 1 ) |
| [516](#L516) | ->set( 'new', 0 ) |
| [517](#L517) | ->run(); |
| [518](#L518) | } |
| [519](#L519) | } |
| [520](#L520) |  |
| [521](#L521) | /\*\* |
| [522](#L522) | \* Noindexes the WooCommerce cart, checkout and account pages. |
| [523](#L523) | \* |
| [524](#L524) | \* @since 4.1.3 |
| [525](#L525) | \* |
| [526](#L526) | \* @return void |
| [527](#L527) | \*/ |
| [528](#L528) | public function noindexWooCommercePages() { |
| [529](#L529) | if ( ! aioseo()->helpers->isWooCommerceActive() ) { |
| [530](#L530) | return; |
| [531](#L531) | } |
| [532](#L532) |  |
| [533](#L533) | $cartId     = (int) get\_option( 'woocommerce\_cart\_page\_id' ); |
| [534](#L534) | $checkoutId = (int) get\_option( 'woocommerce\_checkout\_page\_id' ); |
| [535](#L535) | $accountId  = (int) get\_option( 'woocommerce\_myaccount\_page\_id' ); |
| [536](#L536) |  |
| [537](#L537) | $cartPage     = Models\Post::getPost( $cartId ); |
| [538](#L538) | $checkoutPage = Models\Post::getPost( $checkoutId ); |
| [539](#L539) | $accountPage  = Models\Post::getPost( $accountId ); |
| [540](#L540) |  |
| [541](#L541) | $newMeta = [ |
| [542](#L542) | 'robots\_default' => false, |
| [543](#L543) | 'robots\_noindex' => true |
| [544](#L544) | ]; |
| [545](#L545) |  |
| [546](#L546) | if ( $cartPage->exists() ) { |
| [547](#L547) | $cartPage->set( $newMeta ); |
| [548](#L548) | $cartPage->save(); |
| [549](#L549) | } |
| [550](#L550) | if ( $checkoutPage->exists() ) { |
| [551](#L551) | $checkoutPage->set( $newMeta ); |
| [552](#L552) | $checkoutPage->save(); |
| [553](#L553) | } |
| [554](#L554) | if ( $accountPage->exists() ) { |
| [555](#L555) | $accountPage->set( $newMeta ); |
| [556](#L556) | $accountPage->save(); |
| [557](#L557) | } |
| [558](#L558) | } |
| [559](#L559) |  |
| [560](#L560) | /\*\* |
| [561](#L561) | \* Adds the new capabilities for all the roles. |
| [562](#L562) | \* |
| [563](#L563) | \* @since 4.1.3 |
| [564](#L564) | \* |
| [565](#L565) | \* @return void |
| [566](#L566) | \*/ |
| [567](#L567) | protected function accessControlNewCapabilities() { |
| [568](#L568) | aioseo()->access->addCapabilities(); |
| [569](#L569) | } |
| [570](#L570) |  |
| [571](#L571) | /\*\* |
| [572](#L572) | \* Migrate dynamic settings to a separate options structure. |
| [573](#L573) | \* |
| [574](#L574) | \* @since 4.1.4 |
| [575](#L575) | \* |
| [576](#L576) | \* @return void |
| [577](#L577) | \*/ |
| [578](#L578) | protected function migrateDynamicSettings() { |
| [579](#L579) | $rawOptions = $this->getRawOptions(); |
| [580](#L580) | $options    = aioseo()->dynamicOptions->noConflict(); |
| [581](#L581) |  |
| [582](#L582) | // Sitemap post type priorities/frequencies. |
| [583](#L583) | if ( |
| [584](#L584) | ! empty( $rawOptions['sitemap']['dynamic']['priority']['postTypes'] ) |
| [585](#L585) | ) { |
| [586](#L586) | foreach ( $rawOptions['sitemap']['dynamic']['priority']['postTypes'] as $postTypeName => $data ) { |
| [587](#L587) | if ( $options->sitemap->priority->postTypes->has( $postTypeName ) ) { |
| [588](#L588) | $options->sitemap->priority->postTypes->$postTypeName->priority  = $data['priority']; |
| [589](#L589) | $options->sitemap->priority->postTypes->$postTypeName->frequency = $data['frequency']; |
| [590](#L590) | } |
| [591](#L591) | } |
| [592](#L592) | } |
| [593](#L593) |  |
| [594](#L594) | // Sitemap taxonomy priorities/frequencies. |
| [595](#L595) | if ( |
| [596](#L596) | ! empty( $rawOptions['sitemap']['dynamic']['priority']['taxonomies'] ) |
| [597](#L597) | ) { |
| [598](#L598) | foreach ( $rawOptions['sitemap']['dynamic']['priority']['taxonomies'] as $taxonomyName => $data ) { |
| [599](#L599) | if ( $options->sitemap->priority->taxonomies->has( $taxonomyName ) ) { |
| [600](#L600) | $options->sitemap->priority->taxonomies->$taxonomyName->priority  = $data['priority']; |
| [601](#L601) | $options->sitemap->priority->taxonomies->$taxonomyName->frequency = $data['frequency']; |
| [602](#L602) | } |
| [603](#L603) | } |
| [604](#L604) | } |
| [605](#L605) |  |
| [606](#L606) | // Facebook post type object types. |
| [607](#L607) | if ( |
| [608](#L608) | ! empty( $rawOptions['social']['facebook']['general']['dynamic']['postTypes'] ) |
| [609](#L609) | ) { |
| [610](#L610) | foreach ( $rawOptions['social']['facebook']['general']['dynamic']['postTypes'] as $postTypeName => $data ) { |
| [611](#L611) | if ( $options->social->facebook->general->postTypes->has( $postTypeName ) ) { |
| [612](#L612) | $options->social->facebook->general->postTypes->$postTypeName->objectType = $data['objectType']; |
| [613](#L613) | } |
| [614](#L614) | } |
| [615](#L615) | } |
| [616](#L616) |  |
| [617](#L617) | // Search appearance post type data. |
| [618](#L618) | if ( |
| [619](#L619) | ! empty( $rawOptions['searchAppearance']['dynamic']['postTypes'] ) |
| [620](#L620) | ) { |
| [621](#L621) | foreach ( $rawOptions['searchAppearance']['dynamic']['postTypes'] as $postTypeName => $data ) { |
| [622](#L622) | if ( $options->searchAppearance->postTypes->has( $postTypeName ) ) { |
| [623](#L623) | $options->searchAppearance->postTypes->$postTypeName->show            = $data['show']; |
| [624](#L624) | $options->searchAppearance->postTypes->$postTypeName->title           = $data['title']; |
| [625](#L625) | $options->searchAppearance->postTypes->$postTypeName->metaDescription = $data['metaDescription']; |
| [626](#L626) | $options->searchAppearance->postTypes->$postTypeName->schemaType      = $data['schemaType']; |
| [627](#L627) | $options->searchAppearance->postTypes->$postTypeName->webPageType     = $data['webPageType']; |
| [628](#L628) | $options->searchAppearance->postTypes->$postTypeName->articleType     = $data['articleType']; |
| [629](#L629) | $options->searchAppearance->postTypes->$postTypeName->customFields    = $data['customFields']; |
| [630](#L630) |  |
| [631](#L631) | // Advanced settings. |
| [632](#L632) | $advanced = ! empty( $data['advanced']['robotsMeta'] ) ? $data['advanced']['robotsMeta'] : null; |
| [633](#L633) | if ( ! empty( $advanced ) ) { |
| [634](#L634) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->default         = $data['advanced']['robotsMeta']['default']; |
| [635](#L635) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->noindex         = $data['advanced']['robotsMeta']['noindex']; |
| [636](#L636) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->nofollow        = $data['advanced']['robotsMeta']['nofollow']; |
| [637](#L637) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->noarchive       = $data['advanced']['robotsMeta']['noarchive']; |
| [638](#L638) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->noimageindex    = $data['advanced']['robotsMeta']['noimageindex']; |
| [639](#L639) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->notranslate     = $data['advanced']['robotsMeta']['notranslate']; |
| [640](#L640) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->nosnippet       = $data['advanced']['robotsMeta']['nosnippet']; |
| [641](#L641) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->noodp           = $data['advanced']['robotsMeta']['noodp']; |
| [642](#L642) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->maxSnippet      = $data['advanced']['robotsMeta']['maxSnippet']; |
| [643](#L643) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->maxVideoPreview = $data['advanced']['robotsMeta']['maxVideoPreview']; |
| [644](#L644) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->maxImagePreview = $data['advanced']['robotsMeta']['maxImagePreview']; |
| [645](#L645) | $options->searchAppearance->postTypes->$postTypeName->advanced->showDateInGooglePreview     = $data['advanced']['showDateInGooglePreview']; |
| [646](#L646) | $options->searchAppearance->postTypes->$postTypeName->advanced->showPostThumbnailInSearch   = $data['advanced']['showPostThumbnailInSearch']; |
| [647](#L647) | $options->searchAppearance->postTypes->$postTypeName->advanced->showMetaBox                 = $data['advanced']['showMetaBox']; |
| [648](#L648) | $options->searchAppearance->postTypes->$postTypeName->advanced->bulkEditing                 = $data['advanced']['bulkEditing']; |
| [649](#L649) | } |
| [650](#L650) |  |
| [651](#L651) | if ( 'attachment' === $postTypeName ) { |
| [652](#L652) | $options->searchAppearance->postTypes->$postTypeName->redirectAttachmentUrls = $data['redirectAttachmentUrls']; |
| [653](#L653) | } |
| [654](#L654) | } |
| [655](#L655) | } |
| [656](#L656) | } |
| [657](#L657) |  |
| [658](#L658) | // Search appearance taxonomy data. |
| [659](#L659) | if ( |
| [660](#L660) | ! empty( $rawOptions['searchAppearance']['dynamic']['taxonomies'] ) |
| [661](#L661) | ) { |
| [662](#L662) | foreach ( $rawOptions['searchAppearance']['dynamic']['taxonomies'] as $taxonomyName => $data ) { |
| [663](#L663) | if ( $options->searchAppearance->taxonomies->has( $taxonomyName ) ) { |
| [664](#L664) | $options->searchAppearance->taxonomies->$taxonomyName->show            = $data['show']; |
| [665](#L665) | $options->searchAppearance->taxonomies->$taxonomyName->title           = $data['title']; |
| [666](#L666) | $options->searchAppearance->taxonomies->$taxonomyName->metaDescription = $data['metaDescription']; |
| [667](#L667) |  |
| [668](#L668) | // Advanced settings. |
| [669](#L669) | $advanced = ! empty( $data['advanced']['robotsMeta'] ) ? $data['advanced']['robotsMeta'] : null; |
| [670](#L670) | if ( ! empty( $advanced ) ) { |
| [671](#L671) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->default         = $data['advanced']['robotsMeta']['default']; |
| [672](#L672) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->noindex         = $data['advanced']['robotsMeta']['noindex']; |
| [673](#L673) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->nofollow        = $data['advanced']['robotsMeta']['nofollow']; |
| [674](#L674) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->noarchive       = $data['advanced']['robotsMeta']['noarchive']; |
| [675](#L675) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->noimageindex    = $data['advanced']['robotsMeta']['noimageindex']; |
| [676](#L676) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->notranslate     = $data['advanced']['robotsMeta']['notranslate']; |
| [677](#L677) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->nosnippet       = $data['advanced']['robotsMeta']['nosnippet']; |
| [678](#L678) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->noodp           = $data['advanced']['robotsMeta']['noodp']; |
| [679](#L679) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->maxSnippet      = $data['advanced']['robotsMeta']['maxSnippet']; |
| [680](#L680) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->maxVideoPreview = $data['advanced']['robotsMeta']['maxVideoPreview']; |
| [681](#L681) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->maxImagePreview = $data['advanced']['robotsMeta']['maxImagePreview']; |
| [682](#L682) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->showDateInGooglePreview     = $data['advanced']['showDateInGooglePreview']; |
| [683](#L683) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->showPostThumbnailInSearch   = $data['advanced']['showPostThumbnailInSearch']; |
| [684](#L684) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->showMetaBox                 = $data['advanced']['showMetaBox']; |
| [685](#L685) | } |
| [686](#L686) | } |
| [687](#L687) | } |
| [688](#L688) | } |
| [689](#L689) | } |
| [690](#L690) |  |
| [691](#L691) | /\*\* |
| [692](#L692) | \* Fixes the default value for the post schema type. |
| [693](#L693) | \* |
| [694](#L694) | \* @since 4.1.5 |
| [695](#L695) | \* |
| [696](#L696) | \* @return void |
| [697](#L697) | \*/ |
| [698](#L698) | private function fixSchemaTypeDefault() { |
| [699](#L699) | if ( aioseo()->core->db->tableExists( 'aioseo\_posts' ) && aioseo()->core->db->columnExists( 'aioseo\_posts', 'schema\_type' ) ) { |
| [700](#L700) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [701](#L701) | aioseo()->core->db->execute( |
| [702](#L702) | "ALTER TABLE {$tableName} |
| [703](#L703) | MODIFY schema\_type varchar(20) DEFAULT 'default'" |
| [704](#L704) | ); |
| [705](#L705) | } |
| [706](#L706) | } |
| [707](#L707) |  |
| [708](#L708) | /\*\* |
| [709](#L709) | \* Add in image with/height columns and image URL for caching. |
| [710](#L710) | \* |
| [711](#L711) | \* @since 4.1.6 |
| [712](#L712) | \* |
| [713](#L713) | \* @return void |
| [714](#L714) | \*/ |
| [715](#L715) | protected function migrateOgTwitterImageColumns() { |
| [716](#L716) | if ( aioseo()->core->db->tableExists( 'aioseo\_posts' ) ) { |
| [717](#L717) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [718](#L718) |  |
| [719](#L719) | // OG Columns. |
| [720](#L720) | if ( ! aioseo()->core->db->columnExists( 'aioseo\_posts', 'og\_image\_url' ) ) { |
| [721](#L721) | aioseo()->core->db->execute( |
| [722](#L722) | "ALTER TABLE {$tableName} ADD og\_image\_url text DEFAULT NULL AFTER og\_image\_type" |
| [723](#L723) | ); |
| [724](#L724) | } |
| [725](#L725) |  |
| [726](#L726) | if ( aioseo()->core->db->columnExists( 'aioseo\_posts', 'og\_custom\_image\_height' ) ) { |
| [727](#L727) | aioseo()->core->db->execute( |
| [728](#L728) | "ALTER TABLE {$tableName} CHANGE COLUMN og\_custom\_image\_height og\_image\_height int(11) DEFAULT NULL AFTER og\_image\_url" |
| [729](#L729) | ); |
| [730](#L730) | } elseif ( ! aioseo()->core->db->columnExists( 'aioseo\_posts', 'og\_image\_height' ) ) { |
| [731](#L731) | aioseo()->core->db->execute( |
| [732](#L732) | "ALTER TABLE {$tableName} ADD og\_image\_height int(11) DEFAULT NULL AFTER og\_image\_url" |
| [733](#L733) | ); |
| [734](#L734) | } |
| [735](#L735) |  |
| [736](#L736) | if ( aioseo()->core->db->columnExists( 'aioseo\_posts', 'og\_custom\_image\_width' ) ) { |
| [737](#L737) | aioseo()->core->db->execute( |
| [738](#L738) | "ALTER TABLE {$tableName} CHANGE COLUMN og\_custom\_image\_width og\_image\_width int(11) DEFAULT NULL AFTER og\_image\_url" |
| [739](#L739) | ); |
| [740](#L740) | } elseif ( ! aioseo()->core->db->columnExists( 'aioseo\_posts', 'og\_image\_width' ) ) { |
| [741](#L741) | aioseo()->core->db->execute( |
| [742](#L742) | "ALTER TABLE {$tableName} ADD og\_image\_width int(11) DEFAULT NULL AFTER og\_image\_url" |
| [743](#L743) | ); |
| [744](#L744) | } |
| [745](#L745) |  |
| [746](#L746) | // Twitter image url columnn. |
| [747](#L747) | if ( ! aioseo()->core->db->columnExists( 'aioseo\_posts', 'twitter\_image\_url' ) ) { |
| [748](#L748) | aioseo()->core->db->execute( |
| [749](#L749) | "ALTER TABLE {$tableName} ADD twitter\_image\_url text DEFAULT NULL AFTER twitter\_image\_type" |
| [750](#L750) | ); |
| [751](#L751) | } |
| [752](#L752) |  |
| [753](#L753) | // Reset the cache for the installed tables. |
| [754](#L754) | aioseo()->internalOptions->database->installedTables = ''; |
| [755](#L755) | } |
| [756](#L756) | } |
| [757](#L757) |  |
| [758](#L758) | /\*\* |
| [759](#L759) | \* Adds the limit modified date column to our posts table. |
| [760](#L760) | \* |
| [761](#L761) | \* @since 4.1.8 |
| [762](#L762) | \* |
| [763](#L763) | \* @return void |
| [764](#L764) | \*/ |
| [765](#L765) | private function addLimitModifiedDateColumn() { |
| [766](#L766) | if ( ! aioseo()->core->db->columnExists( 'aioseo\_posts', 'limit\_modified\_date' ) ) { |
| [767](#L767) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [768](#L768) | aioseo()->core->db->execute( |
| [769](#L769) | "ALTER TABLE {$tableName} |
| [770](#L770) | ADD limit\_modified\_date tinyint(1) NOT NULL DEFAULT 0 AFTER local\_seo" |
| [771](#L771) | ); |
| [772](#L772) |  |
| [773](#L773) | // Reset the cache for the installed tables. |
| [774](#L774) | aioseo()->internalOptions->database->installedTables = ''; |
| [775](#L775) | } |
| [776](#L776) | } |
| [777](#L777) |  |
| [778](#L778) | /\*\* |
| [779](#L779) | \* Fixes tags that should not be in the search appearance taxonomy options. |
| [780](#L780) | \* |
| [781](#L781) | \* @since 4.1.9 |
| [782](#L782) | \* |
| [783](#L783) | \* @return void |
| [784](#L784) | \*/ |
| [785](#L785) | protected function fixTaxonomyTags() { |
| [786](#L786) | $searchAppearanceTaxonomies = aioseo()->dynamicOptions->searchAppearance->taxonomies->all(); |
| [787](#L787) |  |
| [788](#L788) | $replaces = [ |
| [789](#L789) | '#breadcrumb\_separator' => '#separator\_sa', |
| [790](#L790) | '#breadcrumb\_'          => '#', |
| [791](#L791) | '#blog\_title'           => '#site\_title' |
| [792](#L792) | ]; |
| [793](#L793) |  |
| [794](#L794) | foreach ( $searchAppearanceTaxonomies as $taxonomy => $searchAppearanceTaxonomy ) { |
| [795](#L795) | aioseo()->dynamicOptions->searchAppearance->taxonomies->{$taxonomy}->title = str\_replace( |
| [796](#L796) | array\_keys( $replaces ), |
| [797](#L797) | array\_values( $replaces ), |
| [798](#L798) | $searchAppearanceTaxonomy['title'] |
| [799](#L799) | ); |
| [800](#L800) |  |
| [801](#L801) | aioseo()->dynamicOptions->searchAppearance->taxonomies->{$taxonomy}->metaDescription = str\_replace( |
| [802](#L802) | array\_keys( $replaces ), |
| [803](#L803) | array\_values( $replaces ), |
| [804](#L804) | $searchAppearanceTaxonomy['metaDescription'] |
| [805](#L805) | ); |
| [806](#L806) | } |
| [807](#L807) | } |
| [808](#L808) |  |
| [809](#L809) | /\*\* |
| [810](#L810) | \* Removes any AIOSEO Post records for revisions. |
| [811](#L811) | \* |
| [812](#L812) | \* @since 4.1.9 |
| [813](#L813) | \* |
| [814](#L814) | \* @return void |
| [815](#L815) | \*/ |
| [816](#L816) | private function removeRevisionRecords() { |
| [817](#L817) | $postsTableName       = aioseo()->core->db->prefix . 'posts'; |
| [818](#L818) | $aioseoPostsTableName = aioseo()->core->db->prefix . 'aioseo\_posts'; |
| [819](#L819) | aioseo()->core->db->execute( |
| [820](#L820) | "DELETE FROM `$aioseoPostsTableName` |
| [821](#L821) | WHERE `post\_id` IN ( |
| [822](#L822) | SELECT `ID` |
| [823](#L823) | FROM `$postsTableName` |
| [824](#L824) | WHERE `post\_parent` != 0 |
| [825](#L825) | AND `post\_type` = 'revision' |
| [826](#L826) | AND `post\_status` = 'inherit' |
| [827](#L827) | )" |
| [828](#L828) | ); |
| [829](#L829) | } |
| [830](#L830) |  |
| [831](#L831) | /\*\* |
| [832](#L832) | \* Enables the new shortcodes parsing setting if it was already enabled before as a deprecated setting. |
| [833](#L833) | \* |
| [834](#L834) | \* @since 4.2.0 |
| [835](#L835) | \* |
| [836](#L836) | \* @return void |
| [837](#L837) | \*/ |
| [838](#L838) | private function migrateDeprecatedRunShortcodesSetting() { |
| [839](#L839) | if ( |
| [840](#L840) | in\_array( 'runShortcodesInDescription', aioseo()->internalOptions->deprecatedOptions, true ) && |
| [841](#L841) | ! aioseo()->options->deprecated->searchAppearance->advanced->runShortcodesInDescription |
| [842](#L842) | ) { |
| [843](#L843) | return; |
| [844](#L844) | } |
| [845](#L845) |  |
| [846](#L846) | aioseo()->options->searchAppearance->advanced->runShortcodes = true; |
| [847](#L847) | } |
| [848](#L848) |  |
| [849](#L849) | /\*\* |
| [850](#L850) | \* Add options column. |
| [851](#L851) | \* |
| [852](#L852) | \* @since 4.2.2 |
| [853](#L853) | \* |
| [854](#L854) | \* @return void |
| [855](#L855) | \*/ |
| [856](#L856) | private function addOptionsColumn() { |
| [857](#L857) | if ( ! aioseo()->core->db->columnExists( 'aioseo\_posts', 'options' ) ) { |
| [858](#L858) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [859](#L859) | aioseo()->core->db->execute( |
| [860](#L860) | "ALTER TABLE {$tableName} |
| [861](#L861) | ADD `options` longtext DEFAULT NULL AFTER `limit\_modified\_date`" |
| [862](#L862) | ); |
| [863](#L863) |  |
| [864](#L864) | // Reset the cache for the installed tables. |
| [865](#L865) | aioseo()->internalOptions->database->installedTables = ''; |
| [866](#L866) | } |
| [867](#L867) | } |
| [868](#L868) |  |
| [869](#L869) | /\*\* |
| [870](#L870) | \* Remove the tabs column as it is unnecessary. |
| [871](#L871) | \* |
| [872](#L872) | \* @since 4.2.2 |
| [873](#L873) | \* |
| [874](#L874) | \* @return void |
| [875](#L875) | \*/ |
| [876](#L876) | protected function removeTabsColumn() { |
| [877](#L877) | if ( aioseo()->core->db->columnExists( 'aioseo\_posts', 'tabs' ) ) { |
| [878](#L878) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [879](#L879) | aioseo()->core->db->execute( |
| [880](#L880) | "ALTER TABLE {$tableName} |
| [881](#L881) | DROP tabs" |
| [882](#L882) | ); |
| [883](#L883) | } |
| [884](#L884) | } |
| [885](#L885) |  |
| [886](#L886) | /\*\* |
| [887](#L887) | \* Migrates the user contact methods to the new format. |
| [888](#L888) | \* |
| [889](#L889) | \* @since 4.2.2 |
| [890](#L890) | \* |
| [891](#L891) | \* @return void |
| [892](#L892) | \*/ |
| [893](#L893) | private function migrateUserContactMethods() { |
| [894](#L894) | $userMetaTableName = aioseo()->core->db->prefix . 'usermeta'; |
| [895](#L895) |  |
| [896](#L896) | aioseo()->core->db->execute( |
| [897](#L897) | "UPDATE `$userMetaTableName` |
| [898](#L898) | SET `meta\_key` = 'aioseo\_facebook\_page\_url' |
| [899](#L899) | WHERE `meta\_key` = 'aioseo\_facebook'" |
| [900](#L900) | ); |
| [901](#L901) |  |
| [902](#L902) | aioseo()->core->db->execute( |
| [903](#L903) | "UPDATE `$userMetaTableName` |
| [904](#L904) | SET `meta\_key` = 'aioseo\_twitter\_url' |
| [905](#L905) | WHERE `meta\_key` = 'aioseo\_twitter'" |
| [906](#L906) | ); |
| [907](#L907) | } |
| [908](#L908) |  |
| [909](#L909) | /\*\* |
| [910](#L910) | \* Migrates some older values in the Knowledge Panel contact type setting that were removed. |
| [911](#L911) | \* |
| [912](#L912) | \* @since 4.2.4 |
| [913](#L913) | \* |
| [914](#L914) | \* @return void |
| [915](#L915) | \*/ |
| [916](#L916) | public function migrateContactTypes() { |
| [917](#L917) | $oldValue          = aioseo()->options->searchAppearance->global->schema->contactType; |
| [918](#L918) | $oldValueLowerCase = strtolower( (string) $oldValue ); |
| [919](#L919) |  |
| [920](#L920) | // Return if there is no value set or manual input is being used. |
| [921](#L921) | if ( ! $oldValue || 'manual' === $oldValueLowerCase ) { |
| [922](#L922) | return; |
| [923](#L923) | } |
| [924](#L924) |  |
| [925](#L925) | switch ( $oldValueLowerCase ) { |
| [926](#L926) | case 'billing support': |
| [927](#L927) | case 'customer support': |
| [928](#L928) | case 'reservations': |
| [929](#L929) | case 'sales': |
| [930](#L930) | case 'technical support': |
| [931](#L931) | // If we still support the value, do nothing. |
| [932](#L932) | return; |
| [933](#L933) | default: |
| [934](#L934) | // Otherwise, migrate the existing value to the manual input field. |
| [935](#L935) | if ( 'bagage tracking' === $oldValueLowerCase ) { |
| [936](#L936) | // Let's also fix this old typo. |
| [937](#L937) | $oldValue = 'Baggage Tracking'; |
| [938](#L938) | } |
| [939](#L939) |  |
| [940](#L940) | aioseo()->options->searchAppearance->global->schema->contactType       = 'manual'; |
| [941](#L941) | aioseo()->options->searchAppearance->global->schema->contactTypeManual = $oldValue; |
| [942](#L942) | } |
| [943](#L943) | } |
| [944](#L944) |  |
| [945](#L945) | /\*\* |
| [946](#L946) | \* Add an addon column to the notifications table. |
| [947](#L947) | \* |
| [948](#L948) | \* @since 4.2.4 |
| [949](#L949) | \* |
| [950](#L950) | \* @return void |
| [951](#L951) | \*/ |
| [952](#L952) | private function addNotificationsAddonColumn() { |
| [953](#L953) | if ( ! aioseo()->core->db->columnExists( 'aioseo\_notifications', 'addon' ) ) { |
| [954](#L954) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_notifications'; |
| [955](#L955) | aioseo()->core->db->execute( |
| [956](#L956) | "ALTER TABLE {$tableName} |
| [957](#L957) | ADD `addon` varchar(64) DEFAULT NULL AFTER `slug`" |
| [958](#L958) | ); |
| [959](#L959) |  |
| [960](#L960) | // Reset the cache for the installed tables. |
| [961](#L961) | aioseo()->internalOptions->database->installedTables = ''; |
| [962](#L962) | } |
| [963](#L963) | } |
| [964](#L964) |  |
| [965](#L965) | /\*\* |
| [966](#L966) | \* Adds the schema column. |
| [967](#L967) | \* |
| [968](#L968) | \* @since 4.2.5 |
| [969](#L969) | \* |
| [970](#L970) | \* @return void |
| [971](#L971) | \*/ |
| [972](#L972) | private function addSchemaColumn() { |
| [973](#L973) | if ( ! aioseo()->core->db->columnExists( 'aioseo\_posts', 'schema' ) ) { |
| [974](#L974) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [975](#L975) | aioseo()->core->db->execute( |
| [976](#L976) | "ALTER TABLE {$tableName} |
| [977](#L977) | ADD `schema` longtext DEFAULT NULL AFTER `seo\_score`" |
| [978](#L978) | ); |
| [979](#L979) | } |
| [980](#L980) | } |
| [981](#L981) |  |
| [982](#L982) | /\*\* |
| [983](#L983) | \* Schedules the post schema migration. |
| [984](#L984) | \* |
| [985](#L985) | \* @since 4.2.5 |
| [986](#L986) | \* |
| [987](#L987) | \* @return void |
| [988](#L988) | \*/ |
| [989](#L989) | private function schedulePostSchemaMigration() { |
| [990](#L990) | aioseo()->actionScheduler->scheduleSingle( 'aioseo\_v4\_migrate\_post\_schema', 10 ); |
| [991](#L991) | } |
| [992](#L992) |  |
| [993](#L993) | /\*\* |
| [994](#L994) | \* Migrates then post schema to the new JSON column. |
| [995](#L995) | \* |
| [996](#L996) | \* @since 4.2.5 |
| [997](#L997) | \* |
| [998](#L998) | \* @return void |
| [999](#L999) | \*/ |
| [1000](#L1000) | public function migratePostSchema() { |
| [1001](#L1001) | $posts = aioseo()->core->db->start( 'aioseo\_posts' ) |
| [1002](#L1002) | ->select( '\*' ) |
| [1003](#L1003) | ->whereRaw( '`schema` IS NULL' ) |
| [1004](#L1004) | ->limit( 40 ) |
| [1005](#L1005) | ->run() |
| [1006](#L1006) | ->models( 'AIOSEO\\Plugin\\Common\\Models\\Post' ); |
| [1007](#L1007) |  |
| [1008](#L1008) | if ( empty( $posts ) ) { |
| [1009](#L1009) | return; |
| [1010](#L1010) | } |
| [1011](#L1011) |  |
| [1012](#L1012) | foreach ( $posts as $post ) { |
| [1013](#L1013) | $this->migratePostSchemaHelper( $post ); |
| [1014](#L1014) | } |
| [1015](#L1015) |  |
| [1016](#L1016) | // Once done, schedule the next action. |
| [1017](#L1017) | aioseo()->actionScheduler->scheduleSingle( 'aioseo\_v4\_migrate\_post\_schema', 30 ); |
| [1018](#L1018) | } |
| [1019](#L1019) |  |
| [1020](#L1020) | /\*\* |
| [1021](#L1021) | \* Schedules the post schema migration to fix the default graphs. |
| [1022](#L1022) | \* |
| [1023](#L1023) | \* @since 4.2.6 |
| [1024](#L1024) | \* |
| [1025](#L1025) | \* @return void |
| [1026](#L1026) | \*/ |
| [1027](#L1027) | private function schedulePostSchemaDefaultMigration() { |
| [1028](#L1028) | aioseo()->actionScheduler->scheduleSingle( 'aioseo\_v4\_migrate\_post\_schema\_default', 10 ); |
| [1029](#L1029) |  |
| [1030](#L1030) | if ( ! aioseo()->cache->get( 'v4\_migrate\_post\_schema\_default\_date' ) ) { |
| [1031](#L1031) | aioseo()->cache->update( 'v4\_migrate\_post\_schema\_default\_date', gmdate( 'Y-m-d H:i:s' ), 3 \* MONTH\_IN\_SECONDS ); |
| [1032](#L1032) | } |
| [1033](#L1033) | } |
| [1034](#L1034) |  |
| [1035](#L1035) | /\*\* |
| [1036](#L1036) | \* Updates the dashboardWidgets with the new array format. |
| [1037](#L1037) | \* |
| [1038](#L1038) | \* @since 4.2.8 |
| [1039](#L1039) | \* |
| [1040](#L1040) | \* @return void |
| [1041](#L1041) | \*/ |
| [1042](#L1042) | private function migrateDashboardWidgetsOptions() { |
| [1043](#L1043) | $rawOptions = $this->getRawOptions(); |
| [1044](#L1044) |  |
| [1045](#L1045) | if ( empty( $rawOptions ) || ! is\_bool( $rawOptions['advanced']['dashboardWidgets'] ) ) { |
| [1046](#L1046) | return; |
| [1047](#L1047) | } |
| [1048](#L1048) |  |
| [1049](#L1049) | $widgets = [ 'seoNews' ]; |
| [1050](#L1050) |  |
| [1051](#L1051) | // If the dashboardWidgets was activated, let's turn on the other widgets. |
| [1052](#L1052) | if ( $rawOptions['advanced']['dashboardWidgets'] ) { |
| [1053](#L1053) | $widgets[] = 'seoOverview'; |
| [1054](#L1054) | $widgets[] = 'seoSetup'; |
| [1055](#L1055) | } |
| [1056](#L1056) |  |
| [1057](#L1057) | aioseo()->options->advanced->dashboardWidgets = $widgets; |
| [1058](#L1058) | } |
| [1059](#L1059) |  |
| [1060](#L1060) | /\*\* |
| [1061](#L1061) | \* Migrates the post schema to the new JSON column again for posts using the default. |
| [1062](#L1062) | \* This is needed to fix an oversight because in 4.2.5 we didn't migrate any properties set to the default graph. |
| [1063](#L1063) | \* |
| [1064](#L1064) | \* @since 4.2.6 |
| [1065](#L1065) | \* |
| [1066](#L1066) | \* @return void |
| [1067](#L1067) | \*/ |
| [1068](#L1068) | public function migratePostSchemaDefault() { |
| [1069](#L1069) | $migrationStartDate = aioseo()->cache->get( 'v4\_migrate\_post\_schema\_default\_date' ); |
| [1070](#L1070) | if ( ! $migrationStartDate ) { |
| [1071](#L1071) | return; |
| [1072](#L1072) | } |
| [1073](#L1073) |  |
| [1074](#L1074) | $posts = aioseo()->core->db->start( 'aioseo\_posts' ) |
| [1075](#L1075) | ->select( '\*' ) |
| [1076](#L1076) | ->where( 'schema\_type =', 'default' ) |
| [1077](#L1077) | ->whereRaw( "updated < '$migrationStartDate'" ) |
| [1078](#L1078) | ->limit( 40 ) |
| [1079](#L1079) | ->run() |
| [1080](#L1080) | ->models( 'AIOSEO\\Plugin\\Common\\Models\\Post' ); |
| [1081](#L1081) |  |
| [1082](#L1082) | if ( empty( $posts ) ) { |
| [1083](#L1083) | aioseo()->cache->delete( 'v4\_migrate\_post\_schema\_default\_date' ); |
| [1084](#L1084) |  |
| [1085](#L1085) | return; |
| [1086](#L1086) | } |
| [1087](#L1087) |  |
| [1088](#L1088) | foreach ( $posts as $post ) { |
| [1089](#L1089) | $this->migratePostSchemaHelper( $post ); |
| [1090](#L1090) | } |
| [1091](#L1091) |  |
| [1092](#L1092) | // Once done, schedule the next action. |
| [1093](#L1093) | aioseo()->actionScheduler->scheduleSingle( 'aioseo\_v4\_migrate\_post\_schema\_default', 30 ); |
| [1094](#L1094) | } |
| [1095](#L1095) |  |
| [1096](#L1096) | /\*\* |
| [1097](#L1097) | \* Helper function for the schema migration. |
| [1098](#L1098) | \* |
| [1099](#L1099) | \* @since  4.2.5 |
| [1100](#L1100) | \* |
| [1101](#L1101) | \* @param  Post $aioseoPost The AIOSEO post object. |
| [1102](#L1102) | \* @return Post             The modified AIOSEO post object. |
| [1103](#L1103) | \*/ |
| [1104](#L1104) | public function migratePostSchemaHelper( $aioseoPost ) { |
| [1105](#L1105) | $post              = aioseo()->helpers->getPost( $aioseoPost->post\_id ); |
| [1106](#L1106) | $schemaType        = $aioseoPost->schema\_type; |
| [1107](#L1107) | $schemaTypeOptions = json\_decode( (string) $aioseoPost->schema\_type\_options ); |
| [1108](#L1108) | $schemaOptions     = Models\Post::getDefaultSchemaOptions( '', $post ); |
| [1109](#L1109) |  |
| [1110](#L1110) | if ( empty( $schemaTypeOptions ) ) { |
| [1111](#L1111) | $aioseoPost->schema = $schemaOptions; |
| [1112](#L1112) | $aioseoPost->save(); |
| [1113](#L1113) |  |
| [1114](#L1114) | return $aioseoPost; |
| [1115](#L1115) | } |
| [1116](#L1116) |  |
| [1117](#L1117) | // If the post is set to the default schema type, set the default for post type but then also get the properties. |
| [1118](#L1118) | $isDefault = 'default' === $schemaType; |
| [1119](#L1119) | if ( $isDefault ) { |
| [1120](#L1120) | $dynamicOptions = aioseo()->dynamicOptions->noConflict(); |
| [1121](#L1121) | if ( ! empty( $post->post\_type ) && $dynamicOptions->searchAppearance->postTypes->has( $post->post\_type ) ) { |
| [1122](#L1122) | $schemaOptions->default->graphName = $dynamicOptions->searchAppearance->postTypes->{$post->post\_type}->schemaType; |
| [1123](#L1123) | $schemaType                        = $dynamicOptions->searchAppearance->postTypes->{$post->post\_type}->schemaType; |
| [1124](#L1124) | } |
| [1125](#L1125) | } |
| [1126](#L1126) |  |
| [1127](#L1127) | $graph = []; |
| [1128](#L1128) | switch ( $schemaType ) { |
| [1129](#L1129) | case 'Article': |
| [1130](#L1130) | $graph = [ |
| [1131](#L1131) | 'id'         => 'aioseo-article-' . uniqid(), |
| [1132](#L1132) | 'slug'       => 'article', |
| [1133](#L1133) | 'graphName'  => 'Article', |
| [1134](#L1134) | 'label'      => \_\_( 'Article', 'all-in-one-seo-pack' ), |
| [1135](#L1135) | 'properties' => [ |
| [1136](#L1136) | 'type'        => ! empty( $schemaTypeOptions->article->articleType ) ? $schemaTypeOptions->article->articleType : 'Article', |
| [1137](#L1137) | 'name'        => '#post\_title', |
| [1138](#L1138) | 'headline'    => '#post\_title', |
| [1139](#L1139) | 'description' => '#post\_excerpt', |
| [1140](#L1140) | 'image'       => '', |
| [1141](#L1141) | 'keywords'    => '', |
| [1142](#L1142) | 'author'      => [ |
| [1143](#L1143) | 'name' => '#author\_name', |
| [1144](#L1144) | 'url'  => '#author\_url' |
| [1145](#L1145) | ], |
| [1146](#L1146) | 'dates'       => [ |
| [1147](#L1147) | 'include'       => true, |
| [1148](#L1148) | 'datePublished' => '', |
| [1149](#L1149) | 'dateModified'  => '' |
| [1150](#L1150) | ] |
| [1151](#L1151) | ] |
| [1152](#L1152) | ]; |
| [1153](#L1153) | break; |
| [1154](#L1154) | case 'Course': |
| [1155](#L1155) | $graph = [ |
| [1156](#L1156) | 'id'         => 'aioseo-course-' . uniqid(), |
| [1157](#L1157) | 'slug'       => 'course', |
| [1158](#L1158) | 'graphName'  => 'Course', |
| [1159](#L1159) | 'label'      => \_\_( 'Course', 'all-in-one-seo-pack' ), |
| [1160](#L1160) | 'properties' => [ |
| [1161](#L1161) | 'name'        => ! empty( $schemaTypeOptions->course->name ) ? $schemaTypeOptions->course->name : '#post\_title', |
| [1162](#L1162) | 'description' => ! empty( $schemaTypeOptions->course->description ) ? $schemaTypeOptions->course->description : '#post\_excerpt', |
| [1163](#L1163) | 'provider'    => [ |
| [1164](#L1164) | 'name'  => ! empty( $schemaTypeOptions->course->provider ) ? $schemaTypeOptions->course->provider : '', |
| [1165](#L1165) | 'url'   => '', |
| [1166](#L1166) | 'image' => '' |
| [1167](#L1167) | ] |
| [1168](#L1168) | ] |
| [1169](#L1169) | ]; |
| [1170](#L1170) | break; |
| [1171](#L1171) | case 'Product': |
| [1172](#L1172) | $graph = [ |
| [1173](#L1173) | 'id'         => 'aioseo-product-' . uniqid(), |
| [1174](#L1174) | 'slug'       => 'product', |
| [1175](#L1175) | 'graphName'  => 'Product', |
| [1176](#L1176) | 'label'      => \_\_( 'Product', 'all-in-one-seo-pack' ), |
| [1177](#L1177) | 'properties' => [ |
| [1178](#L1178) | 'autogenerate' => true, |
| [1179](#L1179) | 'name'         => '#post\_title', |
| [1180](#L1180) | 'description'  => ! empty( $schemaTypeOptions->product->description ) ? $schemaTypeOptions->product->description : '#post\_excerpt', |
| [1181](#L1181) | 'brand'        => ! empty( $schemaTypeOptions->product->brand ) ? $schemaTypeOptions->product->brand : '', |
| [1182](#L1182) | 'image'        => '', |
| [1183](#L1183) | 'identifiers'  => [ |
| [1184](#L1184) | 'sku'  => ! empty( $schemaTypeOptions->product->sku ) ? $schemaTypeOptions->product->sku : '', |
| [1185](#L1185) | 'gtin' => '', |
| [1186](#L1186) | 'mpn'  => '' |
| [1187](#L1187) | ], |
| [1188](#L1188) | 'offer'        => [ |
| [1189](#L1189) | 'price'        => ! empty( $schemaTypeOptions->product->price ) ? (float) $schemaTypeOptions->product->price : '', |
| [1190](#L1190) | 'currency'     => ! empty( $schemaTypeOptions->product->currency ) ? $schemaTypeOptions->product->currency : '', |
| [1191](#L1191) | 'availability' => ! empty( $schemaTypeOptions->product->availability ) ? $schemaTypeOptions->product->availability : '', |
| [1192](#L1192) | 'validUntil'   => ! empty( $schemaTypeOptions->product->priceValidUntil ) ? $schemaTypeOptions->product->priceValidUntil : '' |
| [1193](#L1193) | ], |
| [1194](#L1194) | 'rating'       => [ |
| [1195](#L1195) | 'minimum' => 1, |
| [1196](#L1196) | 'maximum' => 5 |
| [1197](#L1197) | ], |
| [1198](#L1198) | 'reviews'      => [] |
| [1199](#L1199) | ] |
| [1200](#L1200) | ]; |
| [1201](#L1201) |  |
| [1202](#L1202) | $identifierType = ! empty( $schemaTypeOptions->product->identifierType ) ? $schemaTypeOptions->product->identifierType : ''; |
| [1203](#L1203) | if ( preg\_match( '/gtin/i', $identifierType ) ) { |
| [1204](#L1204) | $graph['properties']['identifiers']['gtin'] = $identifierType; |
| [1205](#L1205) | } |
| [1206](#L1206) |  |
| [1207](#L1207) | if ( preg\_match( '/mpn/i', $identifierType ) ) { |
| [1208](#L1208) | $graph['properties']['identifiers']['mpn'] = $identifierType; |
| [1209](#L1209) | } |
| [1210](#L1210) |  |
| [1211](#L1211) | $reviews = ! empty( $schemaTypeOptions->product->reviews ) ? $schemaTypeOptions->product->reviews : []; |
| [1212](#L1212) | if ( ! empty( $reviews ) ) { |
| [1213](#L1213) | foreach ( $reviews as $reviewData ) { |
| [1214](#L1214) | $reviewData = json\_decode( $reviewData ); |
| [1215](#L1215) | if ( empty( $reviewData ) ) { |
| [1216](#L1216) | continue; |
| [1217](#L1217) | } |
| [1218](#L1218) |  |
| [1219](#L1219) | $graph['properties']['reviews'][] = [ |
| [1220](#L1220) | 'rating'   => $reviewData->rating, |
| [1221](#L1221) | 'headline' => $reviewData->headline, |
| [1222](#L1222) | 'content'  => $reviewData->content, |
| [1223](#L1223) | 'author'   => $reviewData->author |
| [1224](#L1224) | ]; |
| [1225](#L1225) | } |
| [1226](#L1226) | } |
| [1227](#L1227) | break; |
| [1228](#L1228) | case 'Recipe': |
| [1229](#L1229) | $graph = [ |
| [1230](#L1230) | 'id'         => 'aioseo-recipe-' . uniqid(), |
| [1231](#L1231) | 'slug'       => 'recipe', |
| [1232](#L1232) | 'graphName'  => 'Recipe', |
| [1233](#L1233) | 'label'      => \_\_( 'Recipe', 'all-in-one-seo-pack' ), |
| [1234](#L1234) | 'properties' => [ |
| [1235](#L1235) | 'name'         => ! empty( $schemaTypeOptions->recipe->name ) ? $schemaTypeOptions->recipe->name : '#post\_title', |
| [1236](#L1236) | 'description'  => ! empty( $schemaTypeOptions->recipe->description ) ? $schemaTypeOptions->recipe->description : '#post\_excerpt', |
| [1237](#L1237) | 'author'       => ! empty( $schemaTypeOptions->recipe->author ) ? $schemaTypeOptions->recipe->author : '#author\_name', |
| [1238](#L1238) | 'ingredients'  => ! empty( $schemaTypeOptions->recipe->ingredients ) ? $schemaTypeOptions->recipe->ingredients : '', |
| [1239](#L1239) | 'dishType'     => ! empty( $schemaTypeOptions->recipe->dishType ) ? $schemaTypeOptions->recipe->dishType : '', |
| [1240](#L1240) | 'cuisineType'  => ! empty( $schemaTypeOptions->recipe->cuisineType ) ? $schemaTypeOptions->recipe->cuisineType : '', |
| [1241](#L1241) | 'keywords'     => ! empty( $schemaTypeOptions->recipe->keywords ) ? $schemaTypeOptions->recipe->keywords : '', |
| [1242](#L1242) | 'image'        => ! empty( $schemaTypeOptions->recipe->image ) ? $schemaTypeOptions->recipe->image : '', |
| [1243](#L1243) | 'nutrition'    => [ |
| [1244](#L1244) | 'servings' => ! empty( $schemaTypeOptions->recipe->servings ) ? $schemaTypeOptions->recipe->servings : '', |
| [1245](#L1245) | 'calories' => ! empty( $schemaTypeOptions->recipe->calories ) ? $schemaTypeOptions->recipe->calories : '' |
| [1246](#L1246) | ], |
| [1247](#L1247) | 'timeRequired' => [ |
| [1248](#L1248) | 'preparation' => ! empty( $schemaTypeOptions->recipe->preparationTime ) ? $schemaTypeOptions->recipe->preparationTime : '', |
| [1249](#L1249) | 'cooking'     => ! empty( $schemaTypeOptions->recipe->cookingTime ) ? $schemaTypeOptions->recipe->cookingTime : '' |
| [1250](#L1250) | ], |
| [1251](#L1251) | 'instructions' => [] |
| [1252](#L1252) | ] |
| [1253](#L1253) | ]; |
| [1254](#L1254) |  |
| [1255](#L1255) | $instructions = ! empty( $schemaTypeOptions->recipe->instructions ) ? $schemaTypeOptions->recipe->instructions : []; |
| [1256](#L1256) | if ( ! empty( $instructions ) ) { |
| [1257](#L1257) | foreach ( $instructions as $instructionData ) { |
| [1258](#L1258) | $instructionData = json\_decode( $instructionData ); |
| [1259](#L1259) | if ( empty( $instructionData ) ) { |
| [1260](#L1260) | continue; |
| [1261](#L1261) | } |
| [1262](#L1262) |  |
| [1263](#L1263) | $graph['properties']['instructions'][] = [ |
| [1264](#L1264) | 'name'  => '', |
| [1265](#L1265) | 'text'  => $instructionData->content, |
| [1266](#L1266) | 'image' => '' |
| [1267](#L1267) | ]; |
| [1268](#L1268) | } |
| [1269](#L1269) | } |
| [1270](#L1270) | break; |
| [1271](#L1271) | case 'SoftwareApplication': |
| [1272](#L1272) | $graph = [ |
| [1273](#L1273) | 'id'         => 'aioseo-software-application-' . uniqid(), |
| [1274](#L1274) | 'slug'       => 'software-application', |
| [1275](#L1275) | 'graphName'  => 'SoftwareApplication', |
| [1276](#L1276) | 'label'      => \_\_( 'Software', 'all-in-one-seo-pack' ), |
| [1277](#L1277) | 'properties' => [ |
| [1278](#L1278) | 'name'            => ! empty( $schemaTypeOptions->software->name ) ? $schemaTypeOptions->software->name : '#post\_title', |
| [1279](#L1279) | 'description'     => '#post\_excerpt', |
| [1280](#L1280) | 'price'           => ! empty( $schemaTypeOptions->software->price ) ? (float) $schemaTypeOptions->software->price : '', |
| [1281](#L1281) | 'currency'        => ! empty( $schemaTypeOptions->software->currency ) ? $schemaTypeOptions->software->currency : '', |
| [1282](#L1282) | 'operatingSystem' => ! empty( $schemaTypeOptions->software->operatingSystems ) ? $schemaTypeOptions->software->operatingSystems : '', |
| [1283](#L1283) | 'category'        => ! empty( $schemaTypeOptions->software->category ) ? $schemaTypeOptions->software->category : '', |
| [1284](#L1284) | 'rating'          => [ |
| [1285](#L1285) | 'value'   => '', |
| [1286](#L1286) | 'minimum' => 1, |
| [1287](#L1287) | 'maximum' => 5 |
| [1288](#L1288) | ], |
| [1289](#L1289) | 'review'          => [ |
| [1290](#L1290) | 'headline' => '', |
| [1291](#L1291) | 'content'  => '', |
| [1292](#L1292) | 'author'   => '' |
| [1293](#L1293) | ] |
| [1294](#L1294) | ] |
| [1295](#L1295) | ]; |
| [1296](#L1296) |  |
| [1297](#L1297) | $reviews = ! empty( $schemaTypeOptions->software->reviews ) ? $schemaTypeOptions->software->reviews : []; |
| [1298](#L1298) | if ( ! empty( $reviews[0] ) ) { |
| [1299](#L1299) | $reviewData = json\_decode( $reviews[0] ); |
| [1300](#L1300) | if ( empty( $reviewData ) ) { |
| [1301](#L1301) | break; |
| [1302](#L1302) | } |
| [1303](#L1303) |  |
| [1304](#L1304) | $graph['properties']['rating']['value'] = $reviewData->rating; |
| [1305](#L1305) | $graph['properties']['review'] = [ |
| [1306](#L1306) | 'headline' => $reviewData->headline, |
| [1307](#L1307) | 'content'  => $reviewData->content, |
| [1308](#L1308) | 'author'   => $reviewData->author |
| [1309](#L1309) | ]; |
| [1310](#L1310) | } |
| [1311](#L1311) | break; |
| [1312](#L1312) | case 'WebPage': |
| [1313](#L1313) | if ( 'FAQPage' === $schemaTypeOptions->webPage->webPageType ) { |
| [1314](#L1314) | $graph = [ |
| [1315](#L1315) | 'id'         => 'aioseo-faq-page-' . uniqid(), |
| [1316](#L1316) | 'slug'       => 'faq-page', |
| [1317](#L1317) | 'graphName'  => 'FAQPage', |
| [1318](#L1318) | 'label'      => \_\_( 'FAQ Page', 'all-in-one-seo-pack' ), |
| [1319](#L1319) | 'properties' => [ |
| [1320](#L1320) | 'type'        => $schemaTypeOptions->webPage->webPageType, |
| [1321](#L1321) | 'name'        => '#post\_title', |
| [1322](#L1322) | 'description' => '#post\_excerpt', |
| [1323](#L1323) | 'questions'   => [] |
| [1324](#L1324) | ] |
| [1325](#L1325) | ]; |
| [1326](#L1326) |  |
| [1327](#L1327) | $faqs = $schemaTypeOptions->faq->pages; |
| [1328](#L1328) | if ( ! empty( $faqs ) ) { |
| [1329](#L1329) | foreach ( $faqs as $faqData ) { |
| [1330](#L1330) | $faqData = json\_decode( $faqData ); |
| [1331](#L1331) | if ( empty( $faqData ) ) { |
| [1332](#L1332) | continue; |
| [1333](#L1333) | } |
| [1334](#L1334) |  |
| [1335](#L1335) | $graph['properties']['questions'][] = [ |
| [1336](#L1336) | 'question' => $faqData->question, |
| [1337](#L1337) | 'answer'   => $faqData->answer |
| [1338](#L1338) | ]; |
| [1339](#L1339) | } |
| [1340](#L1340) | } |
| [1341](#L1341) | } else { |
| [1342](#L1342) | $graph = [ |
| [1343](#L1343) | 'id'         => 'aioseo-web-page-' . uniqid(), |
| [1344](#L1344) | 'slug'       => 'web-page', |
| [1345](#L1345) | 'graphName'  => 'WebPage', |
| [1346](#L1346) | 'label'      => \_\_( 'Web Page', 'all-in-one-seo-pack' ), |
| [1347](#L1347) | 'properties' => [ |
| [1348](#L1348) | 'type'        => $schemaTypeOptions->webPage->webPageType, |
| [1349](#L1349) | 'name'        => '', |
| [1350](#L1350) | 'description' => '' |
| [1351](#L1351) | ] |
| [1352](#L1352) | ]; |
| [1353](#L1353) | } |
| [1354](#L1354) | break; |
| [1355](#L1355) | case 'default': |
| [1356](#L1356) | $dynamicOptions = aioseo()->dynamicOptions->noConflict(); |
| [1357](#L1357) | if ( ! empty( $post->post\_type ) && $dynamicOptions->searchAppearance->postTypes->has( $post->post\_type ) ) { |
| [1358](#L1358) | $schemaOptions->defaultGraph = $dynamicOptions->searchAppearance->postTypes->{$post->post\_type}->schemaType; |
| [1359](#L1359) | } |
| [1360](#L1360) | break; |
| [1361](#L1361) | case 'none': |
| [1362](#L1362) | // If "none', we simply don't have to migrate anything. |
| [1363](#L1363) | default: |
| [1364](#L1364) | break; |
| [1365](#L1365) | } |
| [1366](#L1366) |  |
| [1367](#L1367) | if ( ! empty( $graph ) ) { |
| [1368](#L1368) | if ( $isDefault ) { |
| [1369](#L1369) | $schemaOptions->default->data->{$schemaType} = $graph; |
| [1370](#L1370) | } else { |
| [1371](#L1371) | $schemaOptions->graphs[]           = $graph; |
| [1372](#L1372) | $schemaOptions->default->isEnabled = false; |
| [1373](#L1373) | } |
| [1374](#L1374) | } |
| [1375](#L1375) |  |
| [1376](#L1376) | $aioseoPost->schema = $schemaOptions; |
| [1377](#L1377) | $aioseoPost->save(); |
| [1378](#L1378) |  |
| [1379](#L1379) | return $aioseoPost; |
| [1380](#L1380) | } |
| [1381](#L1381) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/all-in-one-seo-pack/tags/4.2.9/app/Common/Main/Updates.php?format=txt)
* [Original Format](/export/3222465/all-in-one-seo-pack/tags/4.2.9/app/Common/Main/Updates.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_c157510c_20250114_201441.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D2859011%2540all-in-one-seo-pack%252Ftrunk%26old%3D2847431%2540all-in-one-seo-pack%252Ftrunk)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Reverse Diff](/changeset/2847431/all-in-one-seo-pack/trunk?old=2859011&old_path=%2Fall-in-one-seo-pack%2Ftrunk)

---

# Changes in [all-in-one-seo-pack/trunk](/browser/all-in-one-seo-pack/trunk?rev=2859011 "Show entry in browser") [[2847431:2859011]](/log/all-in-one-seo-pack/trunk?rev=2859011&stop_rev=2847431 "Show revision log")

Location:
[all-in-one-seo-pack/trunk](/browser/all-in-one-seo-pack/trunk?rev=2859011)
Files:

276 added
249 deleted
47 edited

* [all\_in\_one\_seo\_pack.php](/browser/all-in-one-seo-pack/trunk/all_in_one_seo_pack.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/all_in_one_seo_pack.php?old=2847431&old_path=all-in-one-seo-pack%2Ftrunk%2Fall_in_one_seo_pack.php "Show differences"))
* [app/AIOSEO.php](/browser/all-in-one-seo-pack/trunk/app/AIOSEO.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/AIOSEO.php?old=2829340&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FAIOSEO.php "Show differences"))
* [app/AIOSEOAbstract.php](/browser/all-in-one-seo-pack/trunk/app/AIOSEOAbstract.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/AIOSEOAbstract.php?old=2814301&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FAIOSEOAbstract.php "Show differences"))
* [app/Common/Admin/Admin.php](/browser/all-in-one-seo-pack/trunk/app/Common/Admin/Admin.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Admin/Admin.php?old=2847431&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FAdmin%2FAdmin.php "Show differences"))
* [app/Common/Admin/SlugMonitor.php](/browser/all-in-one-seo-pack/trunk/app/Common/Admin/SlugMonitor.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Admin/SlugMonitor.php?old=2797158&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FAdmin%2FSlugMonitor.php "Show differences"))
* [app/Common/Breadcrumbs/Frontend.php](/browser/all-in-one-seo-pack/trunk/app/Common/Breadcrumbs/Frontend.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Breadcrumbs/Frontend.php?old=2847431&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FBreadcrumbs%2FFrontend.php "Show differences"))
* [app/Common/Meta/Meta.php](/browser/all-in-one-seo-pack/trunk/app/Common/Meta/Meta.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Meta/Meta.php?old=2814301&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FMeta%2FMeta.php "Show differences"))
* [app/Common/Models/Model.php](/browser/all-in-one-seo-pack/trunk/app/Common/Models/Model.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Models/Model.php?old=2814301&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FModels%2FModel.php "Show differences"))
* [app/Common/Models/Notification.php](/browser/all-in-one-seo-pack/trunk/app/Common/Models/Notification.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Models/Notification.php?old=2771019&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FModels%2FNotification.php "Show differences"))
* [app/Common/Models/Post.php](/browser/all-in-one-seo-pack/trunk/app/Common/Models/Post.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Models/Post.php?old=2847431&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FModels%2FPost.php "Show differences"))
* [app/Common/Options/InternalOptions.php](/browser/all-in-one-seo-pack/trunk/app/Common/Options/InternalOptions.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Options/InternalOptions.php?old=2814301&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FOptions%2FInternalOptions.php "Show differences"))
* [app/Common/Options/Options.php](/browser/all-in-one-seo-pack/trunk/app/Common/Options/Options.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Options/Options.php?old=2829340&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FOptions%2FOptions.php "Show differences"))
* [app/Common/Rss.php](/browser/all-in-one-seo-pack/trunk/app/Common/Rss.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Rss.php?old=2771019&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FRss.php "Show differences"))
* [app/Common/Schema/Context.php](/browser/all-in-one-seo-pack/trunk/app/Common/Schema/Context.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Schema/Context.php?old=2829340&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FSchema%2FContext.php "Show differences"))
* [app/Common/Schema/Graphs/Traits/Image.php](/browser/all-in-one-seo-pack/trunk/app/Common/Schema/Graphs/Traits/Image.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Schema/Graphs/Traits/Image.php?old=2784020&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FSchema%2FGraphs%2FTraits%2FImage.php "Show differences"))
* [app/Common/Schema/Schema.php](/browser/all-in-one-seo-pack/trunk/app/Common/Schema/Schema.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Schema/Schema.php?old=2847431&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FSchema%2FSchema.php "Show differences"))
* [app/Common/SearchStatistics](/browser/all-in-one-seo-pack/trunk/app/Common/SearchStatistics?rev=2859011 "Show entry in browser")
  (added)
* [app/Common/SearchStatistics/SearchStatistics.php](/browser/all-in-one-seo-pack/trunk/app/Common/SearchStatistics/SearchStatistics.php?rev=2859011 "Show entry in browser")
  (added)
* [app/Common/Sitemap/Html/CompactArchive.php](/browser/all-in-one-seo-pack/trunk/app/Common/Sitemap/Html/CompactArchive.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Sitemap/Html/CompactArchive.php?old=2655963&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FSitemap%2FHtml%2FCompactArchive.php "Show differences"))
* [app/Common/Sitemap/Html/Frontend.php](/browser/all-in-one-seo-pack/trunk/app/Common/Sitemap/Html/Frontend.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Sitemap/Html/Frontend.php?old=2829340&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FSitemap%2FHtml%2FFrontend.php "Show differences"))
* [app/Common/Sitemap/Image/Image.php](/browser/all-in-one-seo-pack/trunk/app/Common/Sitemap/Image/Image.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Sitemap/Image/Image.php?old=2814301&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FSitemap%2FImage%2FImage.php "Show differences"))
* [app/Common/Sitemap/Ping.php](/browser/all-in-one-seo-pack/trunk/app/Common/Sitemap/Ping.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Sitemap/Ping.php?old=2814301&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FSitemap%2FPing.php "Show differences"))
* [app/Common/Sitemap/Root.php](/browser/all-in-one-seo-pack/trunk/app/Common/Sitemap/Root.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Sitemap/Root.php?old=2829340&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FSitemap%2FRoot.php "Show differences"))
* [app/Common/Social/Twitter.php](/browser/all-in-one-seo-pack/trunk/app/Common/Social/Twitter.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Social/Twitter.php?old=2829340&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FSocial%2FTwitter.php "Show differences"))
* [app/Common/Standalone/LimitModifiedDate.php](/browser/all-in-one-seo-pack/trunk/app/Common/Standalone/LimitModifiedDate.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Standalone/LimitModifiedDate.php?old=2714839&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FStandalone%2FLimitModifiedDate.php "Show differences"))
* [app/Common/Standalone/PageBuilders/Divi.php](/browser/all-in-one-seo-pack/trunk/app/Common/Standalone/PageBuilders/Divi.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Standalone/PageBuilders/Divi.php?old=2784020&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FStandalone%2FPageBuilders%2FDivi.php "Show differences"))
* [app/Common/Standalone/Standalone.php](/browser/all-in-one-seo-pack/trunk/app/Common/Standalone/Standalone.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Standalone/Standalone.php?old=2829340&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FStandalone%2FStandalone.php "Show differences"))
* [app/Common/Tools/RobotsTxt.php](/browser/all-in-one-seo-pack/trunk/app/Common/Tools/RobotsTxt.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Tools/RobotsTxt.php?old=2814301&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FTools%2FRobotsTxt.php "Show differences"))
* [app/Common/Traits/Assets.php](/browser/all-in-one-seo-pack/trunk/app/Common/Traits/Assets.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Traits/Assets.php?old=2814301&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FTraits%2FAssets.php "Show differences"))
* [app/Common/Traits/Helpers/ThirdParty.php](/browser/all-in-one-seo-pack/trunk/app/Common/Traits/Helpers/ThirdParty.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Traits/Helpers/ThirdParty.php?old=2847431&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FTraits%2FHelpers%2FThirdParty.php "Show differences"))
* [app/Common/Traits/Helpers/Vue.php](/browser/all-in-one-seo-pack/trunk/app/Common/Traits/Helpers/Vue.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Traits/Helpers/Vue.php?old=2847431&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FTraits%2FHelpers%2FVue.php "Show differences"))
* [app/Common/Traits/Helpers/Wp.php](/browser/all-in-one-seo-pack/trunk/app/Common/Traits/Helpers/Wp.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Traits/Helpers/Wp.php?old=2829340&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FTraits%2FHelpers%2FWp.php "Show differences"))
* [app/Common/Traits/Helpers/WpContext.php](/browser/all-in-one-seo-pack/trunk/app/Common/Traits/Helpers/WpContext.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Traits/Helpers/WpContext.php?old=2829340&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FTraits%2FHelpers%2FWpContext.php "Show differences"))
* [app/Common/Utils/Access.php](/browser/all-in-one-seo-pack/trunk/app/Common/Utils/Access.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Utils/Access.php?old=2814301&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FUtils%2FAccess.php "Show differences"))
* [app/Common/Utils/ActionScheduler.php](/browser/all-in-one-seo-pack/trunk/app/Common/Utils/ActionScheduler.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Utils/ActionScheduler.php?old=2814301&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FUtils%2FActionScheduler.php "Show differences"))
* [app/Common/Utils/Assets.php](/browser/all-in-one-seo-pack/trunk/app/Common/Utils/Assets.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Utils/Assets.php?old=2714839&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FUtils%2FAssets.php "Show differences"))
* [app/Common/Utils/Blocks.php](/browser/all-in-one-seo-pack/trunk/app/Common/Utils/Blocks.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Utils/Blocks.php?old=2784020&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FUtils%2FBlocks.php "Show differences"))
* [app/Common/Utils/Database.php](/browser/all-in-one-seo-pack/trunk/app/Common/Utils/Database.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Utils/Database.php?old=2814301&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FUtils%2FDatabase.php "Show differences"))
* [app/Common/Utils/Features.php](/browser/all-in-one-seo-pack/trunk/app/Common/Utils/Features.php?rev=2859011 "Show entry in browser")
  (added)
* [app/Common/Utils/Tags.php](/browser/all-in-one-seo-pack/trunk/app/Common/Utils/Tags.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Utils/Tags.php?old=2814301&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FUtils%2FTags.php "Show differences"))
* [app/Common/Utils/VueSettings.php](/browser/all-in-one-seo-pack/trunk/app/Common/Utils/VueSettings.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/app/Common/Utils/VueSettings.php?old=2814301&old_path=all-in-one-seo-pack%2Ftrunk%2Fapp%2FCommon%2FUtils%2FVueSettings.php "Show differences"))
* [dist/Lite/assets/about-b16aa7a8.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/about-b16aa7a8.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/about.d6075d27.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/about.d6075d27.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/app-a315e8e3.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/app-a315e8e3.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/app.817a4f26.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/app.817a4f26.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/autotrack-dd5c63d1.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/autotrack-dd5c63d1.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/autotrack.ca946afc.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/autotrack.ca946afc.js?rev=2701317 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/blocks-7fc28d11.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/blocks-7fc28d11.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/blocks.7959ca04.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/blocks.7959ca04.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/connect-a71429c6.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/connect-a71429c6.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/connect-pro-1ff1bf1a.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/connect-pro-1ff1bf1a.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/connect-pro.9c5ca338.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/connect-pro.9c5ca338.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/connect.6c6c7feb.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/connect.6c6c7feb.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/css/Dashboard.c88ff925.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/Dashboard.c88ff925.css?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/css/FacebookPreview.43de9c16.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/FacebookPreview.43de9c16.css?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/css/FacebookPreview.44882a5d.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/FacebookPreview.44882a5d.css?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/css/GoogleSearchPreview.03951371.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/GoogleSearchPreview.03951371.css?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/css/GoogleSearchPreview.c6958fc6.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/GoogleSearchPreview.c6958fc6.css?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/css/Header.1d119f8c.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/Header.1d119f8c.css?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/css/Header.934e9974.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/Header.934e9974.css?rev=2784020 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/css/HtmlSitemap.06de4db8.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/HtmlSitemap.06de4db8.css?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/css/HtmlSitemap.64be2979.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/HtmlSitemap.64be2979.css?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/css/Index.18a70921.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/Index.18a70921.css?rev=2784020 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/css/Index.b175e011.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/Index.b175e011.css?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/css/KeywordRankings.f0e89dc2.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/KeywordRankings.f0e89dc2.css?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/css/KeywordsGraph.6b9db545.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/KeywordsGraph.6b9db545.css?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/css/Main.bcabc363.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/Main.bcabc363.css?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/css/Overview.2f77226a.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/Overview.2f77226a.css?rev=2829340 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/css/Overview.63555ee7.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/Overview.63555ee7.css?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/css/PostsTable.47e2116b.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/PostsTable.47e2116b.css?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/css/ScoreButton.30a33f11.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/ScoreButton.30a33f11.css?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/css/SeoSetup.855cd6a8.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/SeoSetup.855cd6a8.css?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/css/SeoStatistics.71c5ea25.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/SeoStatistics.71c5ea25.css?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/css/Table.14a882e0.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/Table.14a882e0.css?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/css/Table.687a96c5.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/Table.687a96c5.css?rev=2797158 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/css/Table.7858fdb8.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/Table.7858fdb8.css?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/css/Tabs.45148af3.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/Tabs.45148af3.css?rev=2829340 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/css/Tabs.fb196b90.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/Tabs.fb196b90.css?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/css/TwitterPreview.9dbddd95.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/TwitterPreview.9dbddd95.css?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/css/TwitterPreview.dfa7e10d.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/TwitterPreview.dfa7e10d.css?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/css/WebmasterTools.17917145.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/WebmasterTools.17917145.css?rev=2814301 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/css/WebmasterTools.db017be0.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/WebmasterTools.db017be0.css?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/css/admin-bar.12d38ef7.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/admin-bar.12d38ef7.css?rev=2784020 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/css/admin-bar.8221d1e4.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/admin-bar.8221d1e4.css?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/css/main.2557653b.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/main.2557653b.css?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/css/main.2dd8f607.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/main.2dd8f607.css?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/css/main.2f61ee19.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/main.2f61ee19.css?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/css/main.51d25559.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/main.51d25559.css?rev=2784020 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/css/main.7c141cb6.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/main.7c141cb6.css?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/css/main.8c66e7e5.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/main.8c66e7e5.css?rev=2797158 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/css/main.8efbdbea.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/main.8efbdbea.css?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/css/main.9b3d2e28.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/main.9b3d2e28.css?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/css/main.d197e7a5.css](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/css/main.d197e7a5.css?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/dashboard-e6080bf9.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/dashboard-e6080bf9.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/dashboard-widgets-75a3934f.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/dashboard-widgets-75a3934f.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/dashboard-widgets.e06c63a1.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/dashboard-widgets.e06c63a1.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/dashboard.afb3a2a9.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/dashboard.afb3a2a9.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/divi-1fd3b15d.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/divi-1fd3b15d.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/divi-admin-2f0f3fbd.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/divi-admin-2f0f3fbd.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/divi-admin.c822f508.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/divi-admin.c822f508.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/divi.ae5512dd.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/divi.ae5512dd.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/elementor-14abeb28.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/elementor-14abeb28.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/elementor.8cbf0bff.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/elementor.8cbf0bff.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/feature-manager-b9290f16.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/feature-manager-b9290f16.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/feature-manager.9331beab.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/feature-manager.9331beab.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/flyout-menu-e058dd7e.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/flyout-menu-e058dd7e.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/flyout-menu.209b933f.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/flyout-menu.209b933f.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/follow-up-emails-nav-bar-3a807b71.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/follow-up-emails-nav-bar-3a807b71.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/follow-up-emails-nav-bar.714d3c99.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/follow-up-emails-nav-bar.714d3c99.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/headline-analyzer-8fe27efa.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/headline-analyzer-8fe27efa.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/headline-analyzer.8ea480f3.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/headline-analyzer.8ea480f3.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/AboutUs.19e86053.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/AboutUs.19e86053.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/AboutUs.e44b5452.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/AboutUs.e44b5452.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/AccessControl.162fa91e.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/AccessControl.162fa91e.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/AccessControl.fdacb58f.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/AccessControl.fdacb58f.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/AddPlus.9af097bc.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/AddPlus.9af097bc.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/AddPlus.cf0828ed.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/AddPlus.cf0828ed.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/AdditionalInformation.76e0307f.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/AdditionalInformation.76e0307f.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/AdditionalInformation.a3121ed5.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/AdditionalInformation.a3121ed5.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/AdditionalPages.2733b4dd.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/AdditionalPages.2733b4dd.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/AdditionalPages.83f47359.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/AdditionalPages.83f47359.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Advanced.9073f51e.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Advanced.9073f51e.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Advanced.b012ce43.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Advanced.b012ce43.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Advanced.ce54e8d7.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Advanced.ce54e8d7.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Advanced.eea0d820.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Advanced.eea0d820.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/AnalyzeCompetitorSite.33e6c00a.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/AnalyzeCompetitorSite.33e6c00a.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/AnalyzeCompetitorSite.6b8676f3.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/AnalyzeCompetitorSite.6b8676f3.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/AnimatedDannie.9f651816.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/AnimatedDannie.9f651816.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/AnimatedDannie.fdf80ede.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/AnimatedDannie.fdf80ede.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/AnimatedNumber.932b583a.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/AnimatedNumber.932b583a.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/AnimatedNumber.c7763fcb.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/AnimatedNumber.c7763fcb.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/App.91b79a40.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/App.91b79a40.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/App.a588f5fa.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/App.a588f5fa.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/App.ae62bc30.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/App.ae62bc30.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/App.e8764334.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/App.e8764334.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Archives.0f8f1755.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Archives.0f8f1755.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Archives.38861c98.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Archives.38861c98.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/BadBotBlocker.e92f956d.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/BadBotBlocker.e92f956d.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/BadBotBlocker.f097589b.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/BadBotBlocker.f097589b.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Blur.ce0e3f00.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Blur.ce0e3f00.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Blur.f36c594d.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Blur.f36c594d.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Book.6f107e9b.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Book.6f107e9b.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Book.9dd59972.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Book.9dd59972.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Breadcrumbs.0e8b2bcd.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Breadcrumbs.0e8b2bcd.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Breadcrumbs.f2e60b76.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Breadcrumbs.f2e60b76.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Build.3089a56c.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Build.3089a56c.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Build.6a71ce0a.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Build.6a71ce0a.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Card.72525ad5.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Card.72525ad5.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Card.b5f85ba0.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Card.b5f85ba0.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Caret.2b15c7cb.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Caret.2b15c7cb.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Caret.6d7f2e24.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Caret.6d7f2e24.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Category.6273682a.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Category.6273682a.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Category.b3f68ac0.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Category.b3f68ac0.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/CheckSolid.10f380cf.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/CheckSolid.10f380cf.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/CheckSolid.731d2c48.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/CheckSolid.731d2c48.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Checkbox.60ba2f56.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Checkbox.60ba2f56.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Checkbox.eb948ddb.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Checkbox.eb948ddb.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Checkmark.57e6a235.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Checkmark.57e6a235.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Checkmark.f26f6201.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Checkmark.f26f6201.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/CommonSitemap.7f174e42.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/CommonSitemap.7f174e42.js?rev=2701458 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/CommonSitemap.bfe9fab6.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/CommonSitemap.bfe9fab6.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/ContentTypes.7b9187c1.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/ContentTypes.7b9187c1.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/ContentTypes.ed51d1ad.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/ContentTypes.ed51d1ad.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Dashboard.6688f603.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Dashboard.6688f603.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/DatabaseTools.d03ba366.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/DatabaseTools.d03ba366.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/DatabaseTools.f8ae773f.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/DatabaseTools.f8ae773f.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/DisplayInfo.0c51c2a9.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/DisplayInfo.0c51c2a9.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/DisplayInfo.ff0090d8.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/DisplayInfo.ff0090d8.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/DonutChartWithLegend.0cf1920e.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/DonutChartWithLegend.0cf1920e.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/DonutChartWithLegend.72361d7c.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/DonutChartWithLegend.72361d7c.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Download.ef366516.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Download.ef366516.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Download.fb11a0bb.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Download.fb11a0bb.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Editor.039b9218.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Editor.039b9218.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Editor.6c63930c.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Editor.6c63930c.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Exclamation.b2dd0993.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Exclamation.b2dd0993.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Exclamation.fd45a7b0.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Exclamation.fd45a7b0.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/ExcludePosts.42b40f44.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/ExcludePosts.42b40f44.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/ExcludePosts.c2d5fd97.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/ExcludePosts.c2d5fd97.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/External.4c957e9a.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/External.4c957e9a.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/External.d2f08f8f.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/External.d2f08f8f.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Eye.57c925d7.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Eye.57c925d7.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Eye.82da6b1c.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Eye.82da6b1c.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Facebook.46b4244a.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Facebook.46b4244a.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Facebook.99580b2f.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Facebook.99580b2f.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/FacebookPreview.a5059d52.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/FacebookPreview.a5059d52.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/FacebookPreview.b0480b70.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/FacebookPreview.b0480b70.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/FeatureManager.9fe8649b.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/FeatureManager.9fe8649b.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/FeatureManager.ded34de2.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/FeatureManager.ded34de2.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Features.4775e264.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Features.4775e264.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Features.dc7cbf09.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Features.dc7cbf09.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Gear.184e0c65.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Gear.184e0c65.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Gear.c30cbc7e.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Gear.c30cbc7e.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/GeneralSettings.27e4cfc1.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/GeneralSettings.27e4cfc1.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/GeneralSettings.c2126245.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/GeneralSettings.c2126245.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/GeneralSitemap.798079c1.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/GeneralSitemap.798079c1.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/GeneralSitemap.e69bb8e0.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/GeneralSitemap.e69bb8e0.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/GettingStarted.255dd85f.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/GettingStarted.255dd85f.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/GettingStarted.2a7f4e1a.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/GettingStarted.2a7f4e1a.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/GettingStarted.d6719975.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/GettingStarted.d6719975.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/GettingStarted.da5e4e39.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/GettingStarted.da5e4e39.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/GlobalSettings.91862e17.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/GlobalSettings.91862e17.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/GlobalSettings.9edea5be.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/GlobalSettings.9edea5be.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/GoogleSearchPreview.1f5696cc.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/GoogleSearchPreview.1f5696cc.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/GoogleSearchPreview.eed33a70.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/GoogleSearchPreview.eed33a70.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Header.36447f36.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Header.36447f36.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Header.5bc3a821.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Header.5bc3a821.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Header.812916b6.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Header.812916b6.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Header.f5e32717.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Header.f5e32717.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/HeadlineAnalyzer.6bee5f45.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/HeadlineAnalyzer.6bee5f45.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/HeadlineAnalyzer.c1caecf2.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/HeadlineAnalyzer.c1caecf2.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/HighlightToggle.62b97732.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/HighlightToggle.62b97732.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/HighlightToggle.a9c09bdd.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/HighlightToggle.a9c09bdd.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/History.3424d012.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/History.3424d012.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/History.92b5f031.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/History.92b5f031.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/HtaccessEditor.d039df5a.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/HtaccessEditor.d039df5a.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/HtaccessEditor.d4fc51fe.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/HtaccessEditor.d4fc51fe.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/HtmlSitemap.6c23e491.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/HtmlSitemap.6c23e491.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/HtmlSitemap.70ae82d1.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/HtmlSitemap.70ae82d1.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/HtmlTagsEditor.d6900a4d.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/HtmlTagsEditor.d6900a4d.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/HtmlTagsEditor.df784f97.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/HtmlTagsEditor.df784f97.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Image.00bca9a1.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Image.00bca9a1.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Image.cdb0a2bf.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Image.cdb0a2bf.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/ImageSeo.287a8e5c.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/ImageSeo.287a8e5c.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/ImageSeo.47aac051.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/ImageSeo.47aac051.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Img.137dcbf1.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Img.137dcbf1.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Img.e81d8dfc.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Img.e81d8dfc.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Import.1e9aa5a0.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Import.1e9aa5a0.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Import.e76b8d87.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Import.e76b8d87.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/ImportExport.4c26d750.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/ImportExport.4c26d750.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/ImportExport.b6e3d3a7.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/ImportExport.b6e3d3a7.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Index.4d840078.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Index.4d840078.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Index.69c50f98.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Index.69c50f98.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Index.6f0889b8.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Index.6f0889b8.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Index.9d561265.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Index.9d561265.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Index.c4701ef0.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Index.c4701ef0.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Index.d9b82af4.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Index.d9b82af4.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Index.f53574a9.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Index.f53574a9.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Index.fa02c77a.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Index.fa02c77a.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Index.fa79d954.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Index.fa79d954.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Index.ffa20ee1.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Index.ffa20ee1.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Information.1adeabd0.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Information.1adeabd0.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Information.93f80cbf.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Information.93f80cbf.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/InternalOutbound.88729746.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/InternalOutbound.88729746.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/InternalOutbound.e736afb6.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/InternalOutbound.e736afb6.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/JsonValues.08065e69.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/JsonValues.08065e69.js?rev=2701458 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/JsonValues.870a4901.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/JsonValues.870a4901.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/KeywordRankings.414c923e.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/KeywordRankings.414c923e.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/KeywordsGraph.9bbcedbd.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/KeywordsGraph.9bbcedbd.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/LicenseKey.45132c11.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/LicenseKey.45132c11.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/LicenseKey.696ab853.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/LicenseKey.696ab853.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/LicenseKeyBar.0e10c35c.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/LicenseKeyBar.0e10c35c.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/LicenseKeyBar.f7493613.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/LicenseKeyBar.f7493613.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/List.41118d8d.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/List.41118d8d.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Locations.076b3132.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Locations.076b3132.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Locations.efd5af74.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Locations.efd5af74.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Logo.8785cc9f.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Logo.8785cc9f.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Logo.a68bde64.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Logo.a68bde64.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/LogoGear.16108a75.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/LogoGear.16108a75.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/LogoGear.e2de68dd.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/LogoGear.e2de68dd.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Main.02fcbfb3.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Main.02fcbfb3.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Main.0ac42aca.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Main.0ac42aca.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Main.1c650ae2.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Main.1c650ae2.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Main.2626925e.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Main.2626925e.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Main.2df18367.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Main.2df18367.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Main.3e0af95b.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Main.3e0af95b.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Main.483bdd73.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Main.483bdd73.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Main.5552d010.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Main.5552d010.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Main.695a0d91.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Main.695a0d91.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Main.6979764c.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Main.6979764c.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Main.6bcd790b.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Main.6bcd790b.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Main.73c4e2a2.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Main.73c4e2a2.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Main.7c58dace.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Main.7c58dace.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Main.8582dd61.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Main.8582dd61.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Main.8a85e426.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Main.8a85e426.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Main.9346c7f9.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Main.9346c7f9.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Main.954f1ec2.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Main.954f1ec2.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Main.9a68d03e.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Main.9a68d03e.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Main.9bf3b780.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Main.9bf3b780.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Main.a2d71687.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Main.a2d71687.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Main.a9807ec2.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Main.a9807ec2.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Main.abf4e47e.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Main.abf4e47e.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Main.ad832381.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Main.ad832381.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Main.b1ae6228.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Main.b1ae6228.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Main.b9af4c7c.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Main.b9af4c7c.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Main.c249f123.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Main.c249f123.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Main.cc5a2344.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Main.cc5a2344.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Main.d2f7808e.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Main.d2f7808e.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Main.e52c9415.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Main.e52c9415.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Main.eb1a8c2f.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Main.eb1a8c2f.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Main.eb46f443.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Main.eb46f443.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Main.fcabf48c.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Main.fcabf48c.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Main.ff8818b1.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Main.ff8818b1.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Maps.428beeb5.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Maps.428beeb5.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Maps.ccd04160.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Maps.ccd04160.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/MaxCounts.12b45bab.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/MaxCounts.12b45bab.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/MaxCounts.5a7ca2fd.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/MaxCounts.5a7ca2fd.js?rev=2758544 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Media.5d30d159.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Media.5d30d159.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Media.79e8aa22.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Media.79e8aa22.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Message.4e485e01.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Message.4e485e01.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Message.e3aa5301.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Message.e3aa5301.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/MetaTag.1c306c27.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/MetaTag.1c306c27.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/MetaTag.ceacc375.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/MetaTag.ceacc375.js?rev=2701458 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Monsterinsights.6ecaeaf1.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Monsterinsights.6ecaeaf1.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Monsterinsights.bc539eda.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Monsterinsights.bc539eda.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/NetworkSiteSelector.7b3f1c34.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/NetworkSiteSelector.7b3f1c34.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/NetworkSiteSelector.e515ad74.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/NetworkSiteSelector.e515ad74.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/NewsChannel.34f76348.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/NewsChannel.34f76348.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/NewsChannel.c9e68f53.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/NewsChannel.c9e68f53.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/NewsSitemap.3d816fc7.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/NewsSitemap.3d816fc7.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/NewsSitemap.89b2570b.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/NewsSitemap.89b2570b.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/OpeningHours.89e9fbe5.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/OpeningHours.89e9fbe5.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/OpeningHours.cef30cde.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/OpeningHours.cef30cde.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Overview.096578a7.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Overview.096578a7.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Overview.281920ad.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Overview.281920ad.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Overview.5d0ba62a.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Overview.5d0ba62a.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Overview.95245c6a.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Overview.95245c6a.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Phone.20bcc5b5.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Phone.20bcc5b5.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Phone.c26b4769.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Phone.c26b4769.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Pinterest.22ede40b.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Pinterest.22ede40b.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Pinterest.5548df6e.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Pinterest.5548df6e.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Plus.6984df43.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Plus.6984df43.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Plus.e2e13f40.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Plus.e2e13f40.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Portal.18dad338.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Portal.18dad338.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Portal.bf51c1bd.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Portal.bf51c1bd.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/PostTypeOptions.a223de38.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/PostTypeOptions.a223de38.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/PostTypeOptions.ee4ec72f.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/PostTypeOptions.ee4ec72f.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/PostTypes.9ab32454.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/PostTypes.9ab32454.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/PostsTable.581ca350.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/PostsTable.581ca350.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/ProBadge.66f48bdc.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/ProBadge.66f48bdc.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/ProBadge.7aea483a.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/ProBadge.7aea483a.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Profile.c44d4735.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Profile.c44d4735.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Profile.df12425d.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Profile.df12425d.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Radio.2eaa81c8.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Radio.2eaa81c8.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Radio.7965b35c.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Radio.7965b35c.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/RadioToggle.980c8ff8.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/RadioToggle.980c8ff8.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/RadioToggle.e6e54396.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/RadioToggle.e6e54396.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Redirects.00e97fac.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Redirects.00e97fac.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Redirects.36fd2d15.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Redirects.36fd2d15.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Redirects.843d2415.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Redirects.843d2415.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Redirects.b010d031.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Redirects.b010d031.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Refresh.8f2b379b.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Refresh.8f2b379b.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Refresh.b8ffa5ea.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Refresh.b8ffa5ea.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/RequiredPlans.14d47bd8.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/RequiredPlans.14d47bd8.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/RequiredPlans.bfdab808.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/RequiredPlans.bfdab808.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/RequiresUpdate.5342b97f.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/RequiresUpdate.5342b97f.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/RequiresUpdate.72442782.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/RequiresUpdate.72442782.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/RequiresUpdate.aa6ac104.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/RequiresUpdate.aa6ac104.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/RequiresUpdate.bddf7adc.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/RequiresUpdate.bddf7adc.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/RobotsEditor.ab36cb5a.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/RobotsEditor.ab36cb5a.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/RobotsEditor.dbe5e599.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/RobotsEditor.dbe5e599.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/RobotsMeta.5a1b6c31.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/RobotsMeta.5a1b6c31.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/RobotsMeta.7658d7de.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/RobotsMeta.7658d7de.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Rocket.a0e2bb67.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Rocket.a0e2bb67.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Rocket.dc643d1e.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Rocket.dc643d1e.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Row.0fac0011.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Row.0fac0011.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Row.2f03c6a0.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Row.2f03c6a0.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Row.67f2b082.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Row.67f2b082.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Row.830f6397.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Row.830f6397.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/RssContent.1f710229.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/RssContent.1f710229.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/RssContent.d845ee21.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/RssContent.d845ee21.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/RssSitemap.2936fcb4.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/RssSitemap.2936fcb4.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/RssSitemap.a2a652b5.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/RssSitemap.a2a652b5.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/SaveChanges.68e73792.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/SaveChanges.68e73792.js?rev=2829340 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/SaveChanges.e40a9083.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/SaveChanges.e40a9083.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Schema.13e022be.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Schema.13e022be.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Schema.1bb90cd0.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Schema.1bb90cd0.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Score.cd8edd8e.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Score.cd8edd8e.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Score.cf6f1269.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Score.cf6f1269.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/ScoreButton.392b731e.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/ScoreButton.392b731e.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/SearchAppearance.89cb8425.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/SearchAppearance.89cb8425.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/SearchAppearance.969989b4.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/SearchAppearance.969989b4.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/SeoAuditChecklist.6519d96f.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/SeoAuditChecklist.6519d96f.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/SeoAuditChecklist.d446c005.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/SeoAuditChecklist.d446c005.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/SeoSetup.a73f38ca.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/SeoSetup.a73f38ca.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/SeoSiteAnalysisResults.a11d6c16.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/SeoSiteAnalysisResults.a11d6c16.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/SeoSiteAnalysisResults.bacd9460.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/SeoSiteAnalysisResults.bacd9460.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/SeoSiteScore.29a89953.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/SeoSiteScore.29a89953.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/SeoSiteScore.48a1cf92.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/SeoSiteScore.48a1cf92.js?rev=2758544 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/SeoStatistics.e1150d3d.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/SeoStatistics.e1150d3d.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Settings.1efb0c2b.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Settings.1efb0c2b.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Settings.26e66713.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Settings.26e66713.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/SettingsRow.12bb257d.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/SettingsRow.12bb257d.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/SettingsRow.edbb3005.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/SettingsRow.edbb3005.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/SettingsSeparator.469d3c61.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/SettingsSeparator.469d3c61.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/SettingsSeparator.783a306a.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/SettingsSeparator.783a306a.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/SitemapsPro.3d63bff4.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/SitemapsPro.3d63bff4.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/SitemapsPro.9f695869.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/SitemapsPro.9f695869.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Slide.15a07930.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Slide.15a07930.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Slide.fe1da4fd.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Slide.fe1da4fd.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/SmartRecommendations.4a299106.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/SmartRecommendations.4a299106.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/SmartRecommendations.f9aaac66.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/SmartRecommendations.f9aaac66.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/SocialProfiles.3a32791d.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/SocialProfiles.3a32791d.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/SocialProfiles.5686d0ec.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/SocialProfiles.5686d0ec.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/SocialProfiles.80583cb6.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/SocialProfiles.80583cb6.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/SocialProfiles.d67a93a5.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/SocialProfiles.d67a93a5.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Standalone.9c6e0f23.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Standalone.9c6e0f23.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Standalone.aee167f9.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Standalone.aee167f9.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Statistics.0134656c.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Statistics.0134656c.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Steps.7006c727.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Steps.7006c727.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Steps.ca25f1e7.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Steps.ca25f1e7.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Success.847f9024.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Success.847f9024.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Success.eeed06a9.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Success.eeed06a9.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Support.85587a91.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Support.85587a91.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Support.c2b646be.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Support.c2b646be.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/SystemStatus.234141c6.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/SystemStatus.234141c6.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/SystemStatus.3e3ca754.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/SystemStatus.3e3ca754.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Table.15c6826e.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Table.15c6826e.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Table.28e3c562.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Table.28e3c562.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Table.8c51f443.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Table.8c51f443.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Tabs.659e6500.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Tabs.659e6500.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Tabs.7e75fbc5.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Tabs.7e75fbc5.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Taxonomies.3375f048.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Taxonomies.3375f048.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Taxonomies.5882e9c2.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Taxonomies.5882e9c2.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Textarea.55026f9a.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Textarea.55026f9a.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Textarea.ce149d81.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Textarea.ce149d81.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/TitleDescription.6c62fffc.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/TitleDescription.6c62fffc.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/TitleDescription.90b09e0e.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/TitleDescription.90b09e0e.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Tooltip.68a8a92b.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Tooltip.68a8a92b.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Tooltip.e966c16d.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Tooltip.e966c16d.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/TruSeoScore.339d22e1.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/TruSeoScore.339d22e1.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/TruSeoScore.98a47fd6.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/TruSeoScore.98a47fd6.js?rev=2758544 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Twitter.6fd26a42.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Twitter.6fd26a42.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Twitter.79b93d10.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Twitter.79b93d10.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Twitter.e15822f4.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Twitter.e15822f4.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Twitter.f7212d36.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Twitter.f7212d36.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/TwitterPreview.919e18e3.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/TwitterPreview.919e18e3.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/TwitterPreview.93aa406c.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/TwitterPreview.93aa406c.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/UnfilteredHtml.d75a5c16.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/UnfilteredHtml.d75a5c16.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/UnfilteredHtml.dac94963.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/UnfilteredHtml.dac94963.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Url.781a1d48.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Url.781a1d48.js?rev=2701458 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Url.c71d5763.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Url.c71d5763.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/VideoCamera.8ac2fbea.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/VideoCamera.8ac2fbea.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/VideoCamera.8d2a0e18.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/VideoCamera.8d2a0e18.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/VideoSitemap.9fdbd473.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/VideoSitemap.9fdbd473.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/VideoSitemap.b990e080.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/VideoSitemap.b990e080.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/WebmasterTools.2cb6a6eb.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/WebmasterTools.2cb6a6eb.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/WebmasterTools.629bc1d6.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/WebmasterTools.629bc1d6.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/WebmasterTools.a9c57409.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/WebmasterTools.a9c57409.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/WebmasterTools.d09eb479.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/WebmasterTools.d09eb479.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/Welcome.64efd54a.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Welcome.64efd54a.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/Welcome.c38628e7.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/Welcome.c38628e7.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/WpTable.68e67998.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/WpTable.68e67998.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/WpTable.e7a99c57.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/WpTable.e7a99c57.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/\_baseIsEqual.4e44c7e9.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/_baseIsEqual.4e44c7e9.js?rev=2784020 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/\_baseIsEqual.d77fde19.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/_baseIsEqual.d77fde19.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/\_baseSet.302745a5.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/_baseSet.302745a5.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/\_baseSet.ea8ad201.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/_baseSet.ea8ad201.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/\_commonjsHelpers.10c44588.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/_commonjsHelpers.10c44588.js?rev=2784020 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/\_commonjsHelpers.f84db168.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/_commonjsHelpers.f84db168.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/\_getTag.7fd653d3.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/_getTag.7fd653d3.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/\_getTag.e79f4b6e.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/_getTag.e79f4b6e.js?rev=2784020 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/\_plugin-vue2\_normalizer.61652a7c.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/_plugin-vue2_normalizer.61652a7c.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/\_plugin-vue2\_normalizer.d86aa1f3.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/_plugin-vue2_normalizer.d86aa1f3.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/attachments.482685b4.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/attachments.482685b4.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/attachments.540ad25c.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/attachments.540ad25c.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/cleanForSlug.961c836c.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/cleanForSlug.961c836c.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/cleanForSlug.d330f33d.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/cleanForSlug.d330f33d.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/client.1a03de11.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/client.1a03de11.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/client.e62d6c37.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/client.e62d6c37.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/constants.59a77347.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/constants.59a77347.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/constants.a33ff6d4.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/constants.a33ff6d4.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/debounce.02a3f204.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/debounce.02a3f204.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/debounce.2f582e4a.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/debounce.2f582e4a.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/default-i18n.31663a66.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/default-i18n.31663a66.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/default-i18n.3a91e0e5.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/default-i18n.3a91e0e5.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/elemLoaded.9a6eb745.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/elemLoaded.9a6eb745.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/elemLoaded.b1f6e29c.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/elemLoaded.b1f6e29c.js?rev=2701458 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/em.090410fb.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/em.090410fb.js?rev=2784020 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/em.5c60dd9c.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/em.5c60dd9c.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/helpers.a2b0759e.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/helpers.a2b0759e.js?rev=2829340 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/helpers.de7566d0.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/helpers.de7566d0.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/html.bcbe747e.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/html.bcbe747e.js?rev=2829340 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/html.f941cb8b.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/html.f941cb8b.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/index.3751d023.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/index.3751d023.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/index.37c799e3.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/index.37c799e3.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/index.5dd9aaae.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/index.5dd9aaae.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/index.8eedf1b9.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/index.8eedf1b9.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/index.90da704f.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/index.90da704f.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/index.a952769c.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/index.a952769c.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/index.cf60653e.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/index.cf60653e.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/index.e4297cd1.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/index.e4297cd1.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/isArrayLikeObject.5268a676.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/isArrayLikeObject.5268a676.js?rev=2784020 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/isArrayLikeObject.cf278c5f.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/isArrayLikeObject.cf278c5f.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/isEmpty.423f67e4.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/isEmpty.423f67e4.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/isEmpty.a9afd21a.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/isEmpty.a9afd21a.js?rev=2784020 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/isEqual.4da9f366.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/isEqual.4da9f366.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/isEqual.90be431f.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/isEqual.90be431f.js?rev=2784020 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/isString.d994875c.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/isString.d994875c.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/loadTruSeo.386f041b.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/loadTruSeo.386f041b.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/loadTruSeo.c40b2cb1.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/loadTruSeo.c40b2cb1.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/news-sitemap.1ec2e03a.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/news-sitemap.1ec2e03a.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/news-sitemap.36087ff1.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/news-sitemap.36087ff1.js?rev=2784020 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/params.597cd0f5.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/params.597cd0f5.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/params.bea1a08d.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/params.bea1a08d.js?rev=2701458 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/popup.25df8419.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/popup.25df8419.js?rev=2701458 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/popup.b60b699f.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/popup.b60b699f.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/portal-vue.esm.98f2e05b.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/portal-vue.esm.98f2e05b.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/portal-vue.esm.c4534d19.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/portal-vue.esm.c4534d19.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/toNumber.7c0bef22.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/toNumber.7c0bef22.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/toNumber.ddc9ccbc.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/toNumber.ddc9ccbc.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/translations.b7a6f669.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/translations.b7a6f669.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/translations.c394afe3.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/translations.c394afe3.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/url.37788892.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/url.37788892.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/js/url.f2cad11f.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/url.f2cad11f.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/vuex.esm.19624049.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/vuex.esm.19624049.js?rev=2829340 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/js/vuex.esm.8fdeb4b6.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/js/vuex.esm.8fdeb4b6.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/limit-modified-date-88280165.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/limit-modified-date-88280165.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/limit-modified-date.3e9f8706.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/limit-modified-date.3e9f8706.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/link-assistant-e2204b86.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/link-assistant-e2204b86.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/link-assistant.e241826d.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/link-assistant.e241826d.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/link-format-a4ce2fcc.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/link-format-a4ce2fcc.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/link-format.79d4f8fe.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/link-format.79d4f8fe.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/local-business-seo-4ed993c7.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/local-business-seo-4ed993c7.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/local-business-seo.678896f2.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/local-business-seo.678896f2.js?rev=2701317 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/local-seo-49b32a19.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/local-seo-49b32a19.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/local-seo.105ccf62.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/local-seo.105ccf62.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/main-04cbef6b.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/main-04cbef6b.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/main.f71ec915.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/main.f71ec915.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/modal-portal-b7e66f9c.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/modal-portal-b7e66f9c.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/modal-portal.a393b4d5.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/modal-portal.a393b4d5.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/monsterinsights-c4c46c48.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/monsterinsights-c4c46c48.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/monsterinsights.2a1b06b8.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/monsterinsights.2a1b06b8.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/notifications-d7084fc9.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/notifications-d7084fc9.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/notifications.0eb58065.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/notifications.0eb58065.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/plugins-c47c0878.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/plugins-c47c0878.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/plugins.ff15dd7a.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/plugins.ff15dd7a.js?rev=2701317 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/post-settings-a377de34.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/post-settings-a377de34.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/post-settings.64a701f6.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/post-settings.64a701f6.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/posts-table-7d7dc403.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/posts-table-7d7dc403.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/posts-table.d8fa5126.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/posts-table.d8fa5126.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/publish-panel-82605da7.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/publish-panel-82605da7.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/publish-panel.81f345a2.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/publish-panel.81f345a2.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/redirects-add-redirect-478d310a.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/redirects-add-redirect-478d310a.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/redirects-add-redirect.f5fa5213.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/redirects-add-redirect.f5fa5213.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/redirects-b5525ebe.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/redirects-b5525ebe.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/redirects.c30d03d3.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/redirects.c30d03d3.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/search-appearance-126d605d.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/search-appearance-126d605d.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/search-appearance.fe0dea3e.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/search-appearance.fe0dea3e.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/search-statistics-a8edb7ab.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/search-statistics-a8edb7ab.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/seedprod-f707dc3e.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/seedprod-f707dc3e.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/seedprod.b710c9ff.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/seedprod.b710c9ff.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/seo-analysis-d8c80ed1.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/seo-analysis-d8c80ed1.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/seo-analysis.a358418a.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/seo-analysis.a358418a.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/seo-preview-e2d4af4a.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/seo-preview-e2d4af4a.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/seo-preview.ff4f7954.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/seo-preview.ff4f7954.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/settings-782798ed.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/settings-782798ed.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/settings.4f87e841.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/settings.4f87e841.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/setup-wizard-8a1b8b3e.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/setup-wizard-8a1b8b3e.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/setup-wizard.2076bf29.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/setup-wizard.2076bf29.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/sitemaps-4fd0e878.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/sitemaps-4fd0e878.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/sitemaps.843b0243.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/sitemaps.843b0243.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/social-networks-cd0b7dff.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/social-networks-cd0b7dff.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/social-networks.bc349523.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/social-networks.bc349523.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/svg/google.11566b88.svg](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/svg/google.11566b88.svg?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/tools-53e24ab1.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/tools-53e24ab1.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/tools.d54028de.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/tools.d54028de.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/tru-seo-analyzer-5ad33634.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/tru-seo-analyzer-5ad33634.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/tru-seo-analyzer.08b29b96.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/tru-seo-analyzer.08b29b96.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/user-profile-tab-e64736b8.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/user-profile-tab-e64736b8.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/user-profile-tab.d3935492.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/user-profile-tab.d3935492.js?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/assets/wp-notices-a7398236.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/wp-notices-a7398236.js?rev=2859011 "Show entry in browser")
  (added)
* [dist/Lite/assets/wp-notices.63441e97.js](/browser/all-in-one-seo-pack/trunk/dist/Lite/assets/wp-notices.63441e97.js?rev=2784020 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/manifest-assets.php](/browser/all-in-one-seo-pack/trunk/dist/Lite/manifest-assets.php?rev=2847431 "Show what was removed (content at revision 2847431)")
  (deleted)
* [dist/Lite/manifest.php](/browser/all-in-one-seo-pack/trunk/dist/Lite/manifest.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/dist/Lite/manifest.php?old=2847431&old_path=all-in-one-seo-pack%2Ftrunk%2Fdist%2FLite%2Fmanifest.php "Show differences"))
* [languages/aioseo-lite.php](/browser/all-in-one-seo-pack/trunk/languages/aioseo-lite.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/languages/aioseo-lite.php?old=2847431&old_path=all-in-one-seo-pack%2Ftrunk%2Flanguages%2Faioseo-lite.php "Show differences"))
* [languages/aioseo-pro.php](/browser/all-in-one-seo-pack/trunk/languages/aioseo-pro.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/languages/aioseo-pro.php?old=2847431&old_path=all-in-one-seo-pack%2Ftrunk%2Flanguages%2Faioseo-pro.php "Show differences"))
* [languages/aioseo.pot](/browser/all-in-one-seo-pack/trunk/languages/aioseo.pot?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/languages/aioseo.pot?old=2847431&old_path=all-in-one-seo-pack%2Ftrunk%2Flanguages%2Faioseo.pot "Show differences"))
* [readme.txt](/browser/all-in-one-seo-pack/trunk/readme.txt?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/readme.txt?old=2847431&old_path=all-in-one-seo-pack%2Ftrunk%2Freadme.txt "Show differences"))
* [vendor/autoload.php](/browser/all-in-one-seo-pack/trunk/vendor/autoload.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/vendor/autoload.php?old=2847431&old_path=all-in-one-seo-pack%2Ftrunk%2Fvendor%2Fautoload.php "Show differences"))
* [vendor/composer/autoload\_real.php](/browser/all-in-one-seo-pack/trunk/vendor/composer/autoload_real.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/vendor/composer/autoload_real.php?old=2847431&old_path=all-in-one-seo-pack%2Ftrunk%2Fvendor%2Fcomposer%2Fautoload_real.php "Show differences"))
* [vendor/composer/autoload\_static.php](/browser/all-in-one-seo-pack/trunk/vendor/composer/autoload_static.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/vendor/composer/autoload_static.php?old=2847431&old_path=all-in-one-seo-pack%2Ftrunk%2Fvendor%2Fcomposer%2Fautoload_static.php "Show differences"))
* [vendor/composer/installed.php](/browser/all-in-one-seo-pack/trunk/vendor/composer/installed.php?rev=2859011 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2859011/all-in-one-seo-pack/trunk/vendor/composer/installed.php?old=2847431&old_path=all-in-one-seo-pack%2Ftrunk%2Fvendor%2Fcomposer%2Finstalled.php "Show differences"))

**Changeset view not shown**, since the total size (4.0 MB) exceeds
[4.0 MB](/wiki/TracIni#changeset-max_diff_bytes-option)

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=2859011&old=2847431&new_path=%2Fall-in-one-seo-pack%2Ftrunk&old_path=%2Fall-in-one-seo-pack%2Ftrunk)
* [Zip Archive](?format=zip&new=2859011&old=2847431&new_path=%2Fall-in-one-seo-pack%2Ftrunk&old_path=%2Fall-in-one-seo-pack%2Ftrunk)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_e907197c_20250114_201438.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fall-in-one-seo-pack%2Ftags%2F4.2.9%2Fapp%2FCommon%2FMain%2FUpdates.php%3Fv%3D2829340)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/all-in-one-seo-pack/trunk/app/Common/Main/Updates.php?rev=2814301 "Revision 2814301")
* [Next Revision](/browser/all-in-one-seo-pack/trunk/app/Common/Main/Updates.php?rev=2866377 "Revision 2866377") →
* [Blame](/browser/all-in-one-seo-pack/trunk/app/Common/Main/Updates.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/all-in-one-seo-pack/tags/4.2.9/app/Common/Main/Updates.php)

---

# [source:](/browser?order=name "Go to repository root") [all-in-one-seo-pack](/browser/all-in-one-seo-pack?order=name "View all-in-one-seo-pack")/[tags](/browser/all-in-one-seo-pack/tags?order=name "View tags")/[4.2.9](/browser/all-in-one-seo-pack/tags/4.2.9?order=name "View 4.2.9")/[app](/browser/all-in-one-seo-pack/tags/4.2.9/app?order=name "View app")/[Common](/browser/all-in-one-seo-pack/tags/4.2.9/app/Common?order=name "View Common")/[Main](/browser/all-in-one-seo-pack/tags/4.2.9/app/Common/Main?order=name "View Main")/[Updates.php](/browser/all-in-one-seo-pack/tags/4.2.9/app/Common/Main/Updates.php?order=name "View Updates.php")

View diff against:

View revision:

| [Last change](/changeset/2829340/all-in-one-seo-pack/trunk/app/Common/Main/Updates.php "View differences") on this file was [2829340](/changeset/2829340/ "View changeset 2829340"), checked in by cristianrossi, [2 years ago](/timeline?from=2022-12-06T12%3A31%3A50Z&precision=second "See timeline at 12/06/2022 12:31:50 PM") |
| --- |
| 4.2.8 |
| **File size:** 46.1 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | namespace AIOSEO\Plugin\Common\Main; |
| [3](#L3) |  |
| [4](#L4) | use \AIOSEO\Plugin\Common\Models; |
| [5](#L5) |  |
| [6](#L6) | // Exit if accessed directly. |
| [7](#L7) | if ( ! defined( 'ABSPATH' ) ) { |
| [8](#L8) | exit; |
| [9](#L9) | } |
| [10](#L10) |  |
| [11](#L11) | /\*\* |
| [12](#L12) | \* Updater class. |
| [13](#L13) | \* |
| [14](#L14) | \* @since 4.0.0 |
| [15](#L15) | \*/ |
| [16](#L16) | class Updates { |
| [17](#L17) | /\*\* |
| [18](#L18) | \* Class constructor. |
| [19](#L19) | \* |
| [20](#L20) | \* @since 4.0.0 |
| [21](#L21) | \*/ |
| [22](#L22) | public function \_\_construct() { |
| [23](#L23) | add\_action( 'aioseo\_v4\_migrate\_post\_schema', [ $this, 'migratePostSchema' ] ); |
| [24](#L24) | add\_action( 'aioseo\_v4\_migrate\_post\_schema\_default', [ $this, 'migratePostSchemaDefault' ] ); |
| [25](#L25) |  |
| [26](#L26) | if ( wp\_doing\_ajax() || wp\_doing\_cron() ) { |
| [27](#L27) | return; |
| [28](#L28) | } |
| [29](#L29) |  |
| [30](#L30) | add\_action( 'init', [ $this, 'init' ], 1001 ); |
| [31](#L31) | add\_action( 'init', [ $this, 'runUpdates' ], 1002 ); |
| [32](#L32) | add\_action( 'init', [ $this, 'updateLatestVersion' ], 3000 ); |
| [33](#L33) | } |
| [34](#L34) |  |
| [35](#L35) | /\*\* |
| [36](#L36) | \* Sets the latest active version if it is not set yet. |
| [37](#L37) | \* |
| [38](#L38) | \* @since 4.0.0 |
| [39](#L39) | \* |
| [40](#L40) | \* @return void |
| [41](#L41) | \*/ |
| [42](#L42) | public function init() { |
| [43](#L43) | if ( '0.0' !== aioseo()->internalOptions->internal->lastActiveVersion ) { |
| [44](#L44) | return; |
| [45](#L45) | } |
| [46](#L46) |  |
| [47](#L47) | // It's possible the user may not have capabilities. Let's add them now. |
| [48](#L48) | aioseo()->access->addCapabilities(); |
| [49](#L49) |  |
| [50](#L50) | $oldOptions = get\_option( 'aioseop\_options' ); |
| [51](#L51) | if ( ! empty( $oldOptions['last\_active\_version'] ) ) { |
| [52](#L52) | aioseo()->internalOptions->internal->lastActiveVersion = $oldOptions['last\_active\_version']; |
| [53](#L53) | } |
| [54](#L54) |  |
| [55](#L55) | $this->addInitialCustomTablesForV4(); |
| [56](#L56) | add\_action( 'wp\_loaded', [ $this, 'setDefaultSocialImages' ], 1001 ); |
| [57](#L57) | } |
| [58](#L58) |  |
| [59](#L59) | /\*\* |
| [60](#L60) | \* Runs our migrations. |
| [61](#L61) | \* |
| [62](#L62) | \* @since 4.0.0 |
| [63](#L63) | \* |
| [64](#L64) | \* @return void |
| [65](#L65) | \*/ |
| [66](#L66) | public function runUpdates() { |
| [67](#L67) | // The dynamic options have not yet fully loaded, so let's refresh here to force that to happen. |
| [68](#L68) | aioseo()->dynamicOptions->refresh(); // TODO: Check if we still need this since it already runs on 999 in the main AIOSEO file. |
| [69](#L69) |  |
| [70](#L70) | $lastActiveVersion = aioseo()->internalOptions->internal->lastActiveVersion; |
| [71](#L71) | if ( version\_compare( $lastActiveVersion, '4.0.5', '<' ) ) { |
| [72](#L72) | $this->addImageScanDateColumn(); |
| [73](#L73) | } |
| [74](#L74) |  |
| [75](#L75) | if ( version\_compare( $lastActiveVersion, '4.0.6', '<' ) ) { |
| [76](#L76) | $this->disableTwitterUseOgDefault(); |
| [77](#L77) | $this->updateMaxImagePreviewDefault(); |
| [78](#L78) | } |
| [79](#L79) |  |
| [80](#L80) | if ( ! aioseo()->pro && version\_compare( $lastActiveVersion, '4.0.6', '=' ) && 'posts' !== get\_option( 'show\_on\_front' ) ) { |
| [81](#L81) | aioseo()->migration->helpers->redoMigration(); |
| [82](#L82) | } |
| [83](#L83) |  |
| [84](#L84) | if ( version\_compare( $lastActiveVersion, '4.0.13', '<' ) ) { |
| [85](#L85) | $this->removeDuplicateRecords(); |
| [86](#L86) | } |
| [87](#L87) |  |
| [88](#L88) | if ( version\_compare( $lastActiveVersion, '4.0.17', '<' ) ) { |
| [89](#L89) | $this->removeLocationColumn(); |
| [90](#L90) | } |
| [91](#L91) |  |
| [92](#L92) | if ( version\_compare( $lastActiveVersion, '4.1.2', '<' ) ) { |
| [93](#L93) | $this->clearProductImages(); |
| [94](#L94) | } |
| [95](#L95) |  |
| [96](#L96) | if ( version\_compare( $lastActiveVersion, '4.1.3', '<' ) ) { |
| [97](#L97) | $this->addNotificationsNewColumn(); |
| [98](#L98) | $this->noindexWooCommercePages(); |
| [99](#L99) | $this->accessControlNewCapabilities(); |
| [100](#L100) | } |
| [101](#L101) |  |
| [102](#L102) | if ( version\_compare( $lastActiveVersion, '4.1.3.3', '<' ) ) { |
| [103](#L103) | $this->accessControlNewCapabilities(); |
| [104](#L104) | } |
| [105](#L105) |  |
| [106](#L106) | if ( version\_compare( $lastActiveVersion, '4.1.4.3', '<' ) ) { |
| [107](#L107) | $this->migrateDynamicSettings(); |
| [108](#L108) | } |
| [109](#L109) |  |
| [110](#L110) | if ( version\_compare( $lastActiveVersion, '4.1.5', '<' ) ) { |
| [111](#L111) | aioseo()->actionScheduler->unschedule( 'aioseo\_cleanup\_action\_scheduler' ); |
| [112](#L112) | // Schedule routine to remove our old transients from the options table. |
| [113](#L113) | aioseo()->actionScheduler->scheduleSingle( aioseo()->core->cachePrune->getOptionCacheCleanAction(), MINUTE\_IN\_SECONDS ); |
| [114](#L114) |  |
| [115](#L115) | // Refresh with new Redirects capability. |
| [116](#L116) | $this->accessControlNewCapabilities(); |
| [117](#L117) |  |
| [118](#L118) | // Regenerate the sitemap if using a static one to update the data for the new stylesheets. |
| [119](#L119) | aioseo()->sitemap->regenerateStaticSitemap(); |
| [120](#L120) |  |
| [121](#L121) | $this->fixSchemaTypeDefault(); |
| [122](#L122) | } |
| [123](#L123) |  |
| [124](#L124) | if ( version\_compare( $lastActiveVersion, '4.1.6', '<' ) ) { |
| [125](#L125) | // Remove the recurring scheduled action for notifications. |
| [126](#L126) | aioseo()->actionScheduler->unschedule( 'aioseo\_admin\_notifications\_update' ); |
| [127](#L127) |  |
| [128](#L128) | $this->migrateOgTwitterImageColumns(); |
| [129](#L129) |  |
| [130](#L130) | // Set the OG data to false for current installs. |
| [131](#L131) | aioseo()->options->social->twitter->general->useOgData = false; |
| [132](#L132) | } |
| [133](#L133) |  |
| [134](#L134) | if ( version\_compare( $lastActiveVersion, '4.1.8', '<' ) ) { |
| [135](#L135) | $this->addLimitModifiedDateColumn(); |
| [136](#L136) |  |
| [137](#L137) | // Refresh with new Redirects Page capability. |
| [138](#L138) | $this->accessControlNewCapabilities(); |
| [139](#L139) | } |
| [140](#L140) |  |
| [141](#L141) | if ( version\_compare( $lastActiveVersion, '4.1.9', '<' ) ) { |
| [142](#L142) | $this->fixTaxonomyTags(); |
| [143](#L143) | $this->removeRevisionRecords(); |
| [144](#L144) | } |
| [145](#L145) |  |
| [146](#L146) | if ( version\_compare( $lastActiveVersion, '4.0.0', '>=' ) && version\_compare( $lastActiveVersion, '4.2.0', '<' ) ) { |
| [147](#L147) | $this->migrateDeprecatedRunShortcodesSetting(); |
| [148](#L148) | } |
| [149](#L149) |  |
| [150](#L150) | if ( version\_compare( $lastActiveVersion, '4.2.1', '<' ) ) { |
| [151](#L151) | // Force WordPress to flush the rewrite rules. |
| [152](#L152) | aioseo()->options->flushRewriteRules(); |
| [153](#L153) |  |
| [154](#L154) | Models\Notification::deleteNotificationByName( 'deprecated-filters' ); |
| [155](#L155) | Models\Notification::deleteNotificationByName( 'deprecated-filters-v2' ); |
| [156](#L156) | } |
| [157](#L157) |  |
| [158](#L158) | if ( version\_compare( $lastActiveVersion, '4.2.2', '<' ) ) { |
| [159](#L159) | aioseo()->internalOptions->database->installedTables = ''; |
| [160](#L160) |  |
| [161](#L161) | $this->addOptionsColumn(); |
| [162](#L162) | $this->removeTabsColumn(); |
| [163](#L163) | $this->migrateUserContactMethods(); |
| [164](#L164) |  |
| [165](#L165) | // Unschedule any static sitemap regeneration actions to remove any that failed and are still in-progress as a result. |
| [166](#L166) | aioseo()->actionScheduler->unschedule( 'aioseo\_static\_sitemap\_regeneration' ); |
| [167](#L167) | } |
| [168](#L168) |  |
| [169](#L169) | if ( version\_compare( $lastActiveVersion, '4.2.4', '<' ) ) { |
| [170](#L170) | $this->migrateContactTypes(); |
| [171](#L171) | $this->addNotificationsAddonColumn(); |
| [172](#L172) | } |
| [173](#L173) |  |
| [174](#L174) | if ( version\_compare( $lastActiveVersion, '4.2.5', '<' ) ) { |
| [175](#L175) | $this->addSchemaColumn(); |
| [176](#L176) | $this->schedulePostSchemaMigration(); |
| [177](#L177) | } |
| [178](#L178) |  |
| [179](#L179) | if ( version\_compare( $lastActiveVersion, '4.2.4.2', '>' ) && version\_compare( $lastActiveVersion, '4.2.6', '<' ) ) { |
| [180](#L180) | // The default graphs only need to be remigrated if the user was on 4.2.5 or 4.2.5.1. |
| [181](#L181) | $this->schedulePostSchemaDefaultMigration(); |
| [182](#L182) | } |
| [183](#L183) |  |
| [184](#L184) | if ( version\_compare( $lastActiveVersion, '4.2.8', '<' ) ) { |
| [185](#L185) | $this->migrateDashboardWidgetsOptions(); |
| [186](#L186) | } |
| [187](#L187) |  |
| [188](#L188) | do\_action( 'aioseo\_run\_updates', $lastActiveVersion ); |
| [189](#L189) |  |
| [190](#L190) | // Always clear the cache if the last active version is different from our current. |
| [191](#L191) | if ( version\_compare( $lastActiveVersion, AIOSEO\_VERSION, '<' ) ) { |
| [192](#L192) | aioseo()->core->cache->clear(); |
| [193](#L193) | } |
| [194](#L194) | } |
| [195](#L195) |  |
| [196](#L196) | /\*\* |
| [197](#L197) | \* Retrieve the raw options from the database for migration. |
| [198](#L198) | \* |
| [199](#L199) | \* @since 4.1.4 |
| [200](#L200) | \* |
| [201](#L201) | \* @return array An array of options. |
| [202](#L202) | \*/ |
| [203](#L203) | private function getRawOptions() { |
| [204](#L204) | // Options from the DB. |
| [205](#L205) | $commonOptions = json\_decode( get\_option( aioseo()->options->optionsName ), true ); |
| [206](#L206) | if ( empty( $commonOptions ) ) { |
| [207](#L207) | $commonOptions = []; |
| [208](#L208) | } |
| [209](#L209) |  |
| [210](#L210) | return $commonOptions; |
| [211](#L211) | } |
| [212](#L212) |  |
| [213](#L213) | /\*\* |
| [214](#L214) | \* Updates the latest version after all migrations and updates have run. |
| [215](#L215) | \* |
| [216](#L216) | \* @since 4.0.3 |
| [217](#L217) | \* |
| [218](#L218) | \* @return void |
| [219](#L219) | \*/ |
| [220](#L220) | public function updateLatestVersion() { |
| [221](#L221) | if ( aioseo()->internalOptions->internal->lastActiveVersion === aioseo()->version ) { |
| [222](#L222) | return; |
| [223](#L223) | } |
| [224](#L224) |  |
| [225](#L225) | aioseo()->internalOptions->internal->lastActiveVersion = aioseo()->version; |
| [226](#L226) |  |
| [227](#L227) | // Bust the tableExists and columnExists cache. |
| [228](#L228) | aioseo()->internalOptions->database->installedTables = ''; |
| [229](#L229) |  |
| [230](#L230) | // Bust the DB cache so we can make sure that everything is fresh. |
| [231](#L231) | aioseo()->core->db->bustCache(); |
| [232](#L232) | } |
| [233](#L233) |  |
| [234](#L234) | /\*\* |
| [235](#L235) | \* Adds our custom tables for V4. |
| [236](#L236) | \* |
| [237](#L237) | \* @since 4.0.0 |
| [238](#L238) | \* |
| [239](#L239) | \* @return void |
| [240](#L240) | \*/ |
| [241](#L241) | public function addInitialCustomTablesForV4() { |
| [242](#L242) | $db             = aioseo()->core->db->db; |
| [243](#L243) | $charsetCollate = ''; |
| [244](#L244) |  |
| [245](#L245) | if ( ! empty( $db->charset ) ) { |
| [246](#L246) | $charsetCollate .= "DEFAULT CHARACTER SET {$db->charset}"; |
| [247](#L247) | } |
| [248](#L248) | if ( ! empty( $db->collate ) ) { |
| [249](#L249) | $charsetCollate .= " COLLATE {$db->collate}"; |
| [250](#L250) | } |
| [251](#L251) |  |
| [252](#L252) | // Check for notifications table. |
| [253](#L253) | if ( ! aioseo()->core->db->tableExists( 'aioseo\_notifications' ) ) { |
| [254](#L254) | $tableName = $db->prefix . 'aioseo\_notifications'; |
| [255](#L255) |  |
| [256](#L256) | aioseo()->core->db->execute( |
| [257](#L257) | "CREATE TABLE {$tableName} ( |
| [258](#L258) | id bigint(20) unsigned NOT NULL AUTO\_INCREMENT, |
| [259](#L259) | slug varchar(13) NOT NULL, |
| [260](#L260) | title text NOT NULL, |
| [261](#L261) | content longtext NOT NULL, |
| [262](#L262) | type varchar(64) NOT NULL, |
| [263](#L263) | level text NOT NULL, |
| [264](#L264) | notification\_id bigint(20) unsigned DEFAULT NULL, |
| [265](#L265) | notification\_name varchar(255) DEFAULT NULL, |
| [266](#L266) | start datetime DEFAULT NULL, |
| [267](#L267) | end datetime DEFAULT NULL, |
| [268](#L268) | button1\_label varchar(255) DEFAULT NULL, |
| [269](#L269) | button1\_action varchar(255) DEFAULT NULL, |
| [270](#L270) | button2\_label varchar(255) DEFAULT NULL, |
| [271](#L271) | button2\_action varchar(255) DEFAULT NULL, |
| [272](#L272) | dismissed tinyint(1) NOT NULL DEFAULT 0, |
| [273](#L273) | created datetime NOT NULL, |
| [274](#L274) | updated datetime NOT NULL, |
| [275](#L275) | PRIMARY KEY (id), |
| [276](#L276) | UNIQUE KEY ndx\_aioseo\_notifications\_slug (slug), |
| [277](#L277) | KEY ndx\_aioseo\_notifications\_dates (start, end), |
| [278](#L278) | KEY ndx\_aioseo\_notifications\_type (type), |
| [279](#L279) | KEY ndx\_aioseo\_notifications\_dismissed (dismissed) |
| [280](#L280) | ) {$charsetCollate};" |
| [281](#L281) | ); |
| [282](#L282) | } |
| [283](#L283) |  |
| [284](#L284) | if ( ! aioseo()->core->db->tableExists( 'aioseo\_posts' ) ) { |
| [285](#L285) | $tableName = $db->prefix . 'aioseo\_posts'; |
| [286](#L286) |  |
| [287](#L287) | // Incorrect defaults are adjusted below through migrations. |
| [288](#L288) | aioseo()->core->db->execute( |
| [289](#L289) | "CREATE TABLE {$tableName} ( |
| [290](#L290) | id bigint(20) unsigned NOT NULL AUTO\_INCREMENT, |
| [291](#L291) | post\_id bigint(20) unsigned NOT NULL, |
| [292](#L292) | title text DEFAULT NULL, |
| [293](#L293) | description text DEFAULT NULL, |
| [294](#L294) | keywords mediumtext DEFAULT NULL, |
| [295](#L295) | keyphrases longtext DEFAULT NULL, |
| [296](#L296) | page\_analysis longtext DEFAULT NULL, |
| [297](#L297) | canonical\_url text DEFAULT NULL, |
| [298](#L298) | og\_title text DEFAULT NULL, |
| [299](#L299) | og\_description text DEFAULT NULL, |
| [300](#L300) | og\_object\_type varchar(64) DEFAULT 'default', |
| [301](#L301) | og\_image\_type varchar(64) DEFAULT 'default', |
| [302](#L302) | og\_image\_custom\_url text DEFAULT NULL, |
| [303](#L303) | og\_image\_custom\_fields text DEFAULT NULL, |
| [304](#L304) | og\_custom\_image\_width int(11) DEFAULT NULL, |
| [305](#L305) | og\_custom\_image\_height int(11) DEFAULT NULL, |
| [306](#L306) | og\_video varchar(255) DEFAULT NULL, |
| [307](#L307) | og\_custom\_url text DEFAULT NULL, |
| [308](#L308) | og\_article\_section text DEFAULT NULL, |
| [309](#L309) | og\_article\_tags text DEFAULT NULL, |
| [310](#L310) | twitter\_use\_og tinyint(1) DEFAULT 1, |
| [311](#L311) | twitter\_card varchar(64) DEFAULT 'default', |
| [312](#L312) | twitter\_image\_type varchar(64) DEFAULT 'default', |
| [313](#L313) | twitter\_image\_custom\_url text DEFAULT NULL, |
| [314](#L314) | twitter\_image\_custom\_fields text DEFAULT NULL, |
| [315](#L315) | twitter\_title text DEFAULT NULL, |
| [316](#L316) | twitter\_description text DEFAULT NULL, |
| [317](#L317) | seo\_score int(11) DEFAULT 0 NOT NULL, |
| [318](#L318) | schema\_type varchar(20) DEFAULT NULL, |
| [319](#L319) | schema\_type\_options longtext DEFAULT NULL, |
| [320](#L320) | pillar\_content tinyint(1) DEFAULT NULL, |
| [321](#L321) | robots\_default tinyint(1) DEFAULT 1 NOT NULL, |
| [322](#L322) | robots\_noindex tinyint(1) DEFAULT 0 NOT NULL, |
| [323](#L323) | robots\_noarchive tinyint(1) DEFAULT 0 NOT NULL, |
| [324](#L324) | robots\_nosnippet tinyint(1) DEFAULT 0 NOT NULL, |
| [325](#L325) | robots\_nofollow tinyint(1) DEFAULT 0 NOT NULL, |
| [326](#L326) | robots\_noimageindex tinyint(1) DEFAULT 0 NOT NULL, |
| [327](#L327) | robots\_noodp tinyint(1) DEFAULT 0 NOT NULL, |
| [328](#L328) | robots\_notranslate tinyint(1) DEFAULT 0 NOT NULL, |
| [329](#L329) | robots\_max\_snippet int(11) DEFAULT NULL, |
| [330](#L330) | robots\_max\_videopreview int(11) DEFAULT NULL, |
| [331](#L331) | robots\_max\_imagepreview varchar(20) DEFAULT 'none', |
| [332](#L332) | tabs mediumtext DEFAULT NULL, |
| [333](#L333) | images longtext DEFAULT NULL, |
| [334](#L334) | priority tinytext DEFAULT NULL, |
| [335](#L335) | frequency tinytext DEFAULT NULL, |
| [336](#L336) | videos longtext DEFAULT NULL, |
| [337](#L337) | video\_thumbnail text DEFAULT NULL, |
| [338](#L338) | video\_scan\_date datetime DEFAULT NULL, |
| [339](#L339) | local\_seo longtext DEFAULT NULL, |
| [340](#L340) | created datetime NOT NULL, |
| [341](#L341) | updated datetime NOT NULL, |
| [342](#L342) | PRIMARY KEY (id), |
| [343](#L343) | KEY ndx\_aioseo\_posts\_post\_id (post\_id) |
| [344](#L344) | ) {$charsetCollate};" |
| [345](#L345) | ); |
| [346](#L346) | } |
| [347](#L347) |  |
| [348](#L348) | // Reset the cache for the installed tables. |
| [349](#L349) | aioseo()->internalOptions->database->installedTables = ''; |
| [350](#L350) | } |
| [351](#L351) |  |
| [352](#L352) | /\*\* |
| [353](#L353) | \* Sets the default social images. |
| [354](#L354) | \* |
| [355](#L355) | \* @since 4.0.0 |
| [356](#L356) | \* |
| [357](#L357) | \* @return void |
| [358](#L358) | \*/ |
| [359](#L359) | public function setDefaultSocialImages() { |
| [360](#L360) | $siteLogo = aioseo()->helpers->getSiteLogoUrl(); |
| [361](#L361) | if ( $siteLogo && ! aioseo()->internalOptions->internal->migratedVersion ) { |
| [362](#L362) | if ( ! aioseo()->options->social->facebook->general->defaultImagePosts ) { |
| [363](#L363) | aioseo()->options->social->facebook->general->defaultImagePosts = $siteLogo; |
| [364](#L364) | } |
| [365](#L365) | if ( ! aioseo()->options->social->twitter->general->defaultImagePosts ) { |
| [366](#L366) | aioseo()->options->social->twitter->general->defaultImagePosts = $siteLogo; |
| [367](#L367) | } |
| [368](#L368) | } |
| [369](#L369) | } |
| [370](#L370) |  |
| [371](#L371) | /\*\* |
| [372](#L372) | \* Adds the image scan date column to our posts table. |
| [373](#L373) | \* |
| [374](#L374) | \* @since 4.0.5 |
| [375](#L375) | \* |
| [376](#L376) | \* @return void |
| [377](#L377) | \*/ |
| [378](#L378) | public function addImageScanDateColumn() { |
| [379](#L379) | if ( ! aioseo()->core->db->columnExists( 'aioseo\_posts', 'image\_scan\_date' ) ) { |
| [380](#L380) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [381](#L381) | aioseo()->core->db->execute( |
| [382](#L382) | "ALTER TABLE {$tableName} |
| [383](#L383) | ADD image\_scan\_date datetime DEFAULT NULL AFTER images" |
| [384](#L384) | ); |
| [385](#L385) |  |
| [386](#L386) | // Reset the cache for the installed tables. |
| [387](#L387) | aioseo()->internalOptions->database->installedTables = ''; |
| [388](#L388) | } |
| [389](#L389) | } |
| [390](#L390) |  |
| [391](#L391) | /\*\* |
| [392](#L392) | \* Modifes the default value of the twitter\_use\_og column. |
| [393](#L393) | \* |
| [394](#L394) | \* @since 4.0.6 |
| [395](#L395) | \* |
| [396](#L396) | \* @return void |
| [397](#L397) | \*/ |
| [398](#L398) | protected function disableTwitterUseOgDefault() { |
| [399](#L399) | if ( aioseo()->core->db->tableExists( 'aioseo\_posts' ) ) { |
| [400](#L400) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [401](#L401) | aioseo()->core->db->execute( |
| [402](#L402) | "ALTER TABLE {$tableName} |
| [403](#L403) | MODIFY twitter\_use\_og tinyint(1) DEFAULT 0" |
| [404](#L404) | ); |
| [405](#L405) | } |
| [406](#L406) | } |
| [407](#L407) |  |
| [408](#L408) | /\*\* |
| [409](#L409) | \* Modifes the default value of the robots\_max\_imagepreview column. |
| [410](#L410) | \* |
| [411](#L411) | \* @since 4.0.6 |
| [412](#L412) | \* |
| [413](#L413) | \* @return void |
| [414](#L414) | \*/ |
| [415](#L415) | protected function updateMaxImagePreviewDefault() { |
| [416](#L416) | if ( aioseo()->core->db->tableExists( 'aioseo\_posts' ) ) { |
| [417](#L417) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [418](#L418) | aioseo()->core->db->execute( |
| [419](#L419) | "ALTER TABLE {$tableName} |
| [420](#L420) | MODIFY robots\_max\_imagepreview varchar(20) DEFAULT 'large'" |
| [421](#L421) | ); |
| [422](#L422) | } |
| [423](#L423) | } |
| [424](#L424) |  |
| [425](#L425) | /\*\* |
| [426](#L426) | \* Deletes duplicate records in our custom tables. |
| [427](#L427) | \* |
| [428](#L428) | \* @since 4.0.13 |
| [429](#L429) | \* |
| [430](#L430) | \* @return void |
| [431](#L431) | \*/ |
| [432](#L432) | public function removeDuplicateRecords() { |
| [433](#L433) | $duplicates = aioseo()->core->db->start( 'aioseo\_posts' ) |
| [434](#L434) | ->select( 'post\_id, min(id) as id' ) |
| [435](#L435) | ->groupBy( 'post\_id having count(post\_id) > 1' ) |
| [436](#L436) | ->orderBy( 'count(post\_id) DESC' ) |
| [437](#L437) | ->run() |
| [438](#L438) | ->result(); |
| [439](#L439) |  |
| [440](#L440) | if ( empty( $duplicates ) ) { |
| [441](#L441) | return; |
| [442](#L442) | } |
| [443](#L443) |  |
| [444](#L444) | foreach ( $duplicates as $duplicate ) { |
| [445](#L445) | $postId        = $duplicate->post\_id; |
| [446](#L446) | $firstRecordId = $duplicate->id; |
| [447](#L447) |  |
| [448](#L448) | aioseo()->core->db->delete( 'aioseo\_posts' ) |
| [449](#L449) | ->whereRaw( "( id > $firstRecordId AND post\_id = $postId )" ) |
| [450](#L450) | ->run(); |
| [451](#L451) | } |
| [452](#L452) | } |
| [453](#L453) |  |
| [454](#L454) | /\*\* |
| [455](#L455) | \* Removes the location column. |
| [456](#L456) | \* |
| [457](#L457) | \* @since 4.0.17 |
| [458](#L458) | \* |
| [459](#L459) | \* @return void |
| [460](#L460) | \*/ |
| [461](#L461) | public function removeLocationColumn() { |
| [462](#L462) | if ( aioseo()->core->db->columnExists( 'aioseo\_posts', 'location' ) ) { |
| [463](#L463) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [464](#L464) | aioseo()->core->db->execute( |
| [465](#L465) | "ALTER TABLE {$tableName} |
| [466](#L466) | DROP location" |
| [467](#L467) | ); |
| [468](#L468) | } |
| [469](#L469) | } |
| [470](#L470) |  |
| [471](#L471) | /\*\* |
| [472](#L472) | \* Clears the image data for WooCommerce Products so that we scan them again and include product gallery images. |
| [473](#L473) | \* |
| [474](#L474) | \* @since 4.1.2 |
| [475](#L475) | \* |
| [476](#L476) | \* @return void |
| [477](#L477) | \*/ |
| [478](#L478) | public function clearProductImages() { |
| [479](#L479) | if ( ! aioseo()->helpers->isWooCommerceActive() ) { |
| [480](#L480) | return; |
| [481](#L481) | } |
| [482](#L482) |  |
| [483](#L483) | aioseo()->core->db->update( 'aioseo\_posts as ap' ) |
| [484](#L484) | ->join( 'posts as p', 'ap.post\_id = p.ID' ) |
| [485](#L485) | ->where( 'p.post\_type', 'product' ) |
| [486](#L486) | ->set( |
| [487](#L487) | [ |
| [488](#L488) | 'images'          => null, |
| [489](#L489) | 'image\_scan\_date' => null |
| [490](#L490) | ] |
| [491](#L491) | ) |
| [492](#L492) | ->run(); |
| [493](#L493) | } |
| [494](#L494) |  |
| [495](#L495) | /\*\* |
| [496](#L496) | \* Adds the new flag to the notifications table. |
| [497](#L497) | \* |
| [498](#L498) | \* @since 4.1.3 |
| [499](#L499) | \* |
| [500](#L500) | \* @return void |
| [501](#L501) | \*/ |
| [502](#L502) | public function addNotificationsNewColumn() { |
| [503](#L503) | if ( ! aioseo()->core->db->columnExists( 'aioseo\_notifications', 'new' ) ) { |
| [504](#L504) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_notifications'; |
| [505](#L505) | aioseo()->core->db->execute( |
| [506](#L506) | "ALTER TABLE {$tableName} |
| [507](#L507) | ADD new tinyint(1) NOT NULL DEFAULT 1 AFTER dismissed" |
| [508](#L508) | ); |
| [509](#L509) |  |
| [510](#L510) | // Reset the cache for the installed tables. |
| [511](#L511) | aioseo()->internalOptions->database->installedTables = ''; |
| [512](#L512) |  |
| [513](#L513) | aioseo()->core->db |
| [514](#L514) | ->update( 'aioseo\_notifications' ) |
| [515](#L515) | ->where( 'new', 1 ) |
| [516](#L516) | ->set( 'new', 0 ) |
| [517](#L517) | ->run(); |
| [518](#L518) | } |
| [519](#L519) | } |
| [520](#L520) |  |
| [521](#L521) | /\*\* |
| [522](#L522) | \* Noindexes the WooCommerce cart, checkout and account pages. |
| [523](#L523) | \* |
| [524](#L524) | \* @since 4.1.3 |
| [525](#L525) | \* |
| [526](#L526) | \* @return void |
| [527](#L527) | \*/ |
| [528](#L528) | public function noindexWooCommercePages() { |
| [529](#L529) | if ( ! aioseo()->helpers->isWooCommerceActive() ) { |
| [530](#L530) | return; |
| [531](#L531) | } |
| [532](#L532) |  |
| [533](#L533) | $cartId     = (int) get\_option( 'woocommerce\_cart\_page\_id' ); |
| [534](#L534) | $checkoutId = (int) get\_option( 'woocommerce\_checkout\_page\_id' ); |
| [535](#L535) | $accountId  = (int) get\_option( 'woocommerce\_myaccount\_page\_id' ); |
| [536](#L536) |  |
| [537](#L537) | $cartPage     = Models\Post::getPost( $cartId ); |
| [538](#L538) | $checkoutPage = Models\Post::getPost( $checkoutId ); |
| [539](#L539) | $accountPage  = Models\Post::getPost( $accountId ); |
| [540](#L540) |  |
| [541](#L541) | $newMeta = [ |
| [542](#L542) | 'robots\_default' => false, |
| [543](#L543) | 'robots\_noindex' => true |
| [544](#L544) | ]; |
| [545](#L545) |  |
| [546](#L546) | if ( $cartPage->exists() ) { |
| [547](#L547) | $cartPage->set( $newMeta ); |
| [548](#L548) | $cartPage->save(); |
| [549](#L549) | } |
| [550](#L550) | if ( $checkoutPage->exists() ) { |
| [551](#L551) | $checkoutPage->set( $newMeta ); |
| [552](#L552) | $checkoutPage->save(); |
| [553](#L553) | } |
| [554](#L554) | if ( $accountPage->exists() ) { |
| [555](#L555) | $accountPage->set( $newMeta ); |
| [556](#L556) | $accountPage->save(); |
| [557](#L557) | } |
| [558](#L558) | } |
| [559](#L559) |  |
| [560](#L560) | /\*\* |
| [561](#L561) | \* Adds the new capabilities for all the roles. |
| [562](#L562) | \* |
| [563](#L563) | \* @since 4.1.3 |
| [564](#L564) | \* |
| [565](#L565) | \* @return void |
| [566](#L566) | \*/ |
| [567](#L567) | protected function accessControlNewCapabilities() { |
| [568](#L568) | aioseo()->access->addCapabilities(); |
| [569](#L569) | } |
| [570](#L570) |  |
| [571](#L571) | /\*\* |
| [572](#L572) | \* Migrate dynamic settings to a separate options structure. |
| [573](#L573) | \* |
| [574](#L574) | \* @since 4.1.4 |
| [575](#L575) | \* |
| [576](#L576) | \* @return void |
| [577](#L577) | \*/ |
| [578](#L578) | protected function migrateDynamicSettings() { |
| [579](#L579) | $rawOptions = $this->getRawOptions(); |
| [580](#L580) | $options    = aioseo()->dynamicOptions->noConflict(); |
| [581](#L581) |  |
| [582](#L582) | // Sitemap post type priorities/frequencies. |
| [583](#L583) | if ( |
| [584](#L584) | ! empty( $rawOptions['sitemap']['dynamic']['priority']['postTypes'] ) |
| [585](#L585) | ) { |
| [586](#L586) | foreach ( $rawOptions['sitemap']['dynamic']['priority']['postTypes'] as $postTypeName => $data ) { |
| [587](#L587) | if ( $options->sitemap->priority->postTypes->has( $postTypeName ) ) { |
| [588](#L588) | $options->sitemap->priority->postTypes->$postTypeName->priority  = $data['priority']; |
| [589](#L589) | $options->sitemap->priority->postTypes->$postTypeName->frequency = $data['frequency']; |
| [590](#L590) | } |
| [591](#L591) | } |
| [592](#L592) | } |
| [593](#L593) |  |
| [594](#L594) | // Sitemap taxonomy priorities/frequencies. |
| [595](#L595) | if ( |
| [596](#L596) | ! empty( $rawOptions['sitemap']['dynamic']['priority']['taxonomies'] ) |
| [597](#L597) | ) { |
| [598](#L598) | foreach ( $rawOptions['sitemap']['dynamic']['priority']['taxonomies'] as $taxonomyName => $data ) { |
| [599](#L599) | if ( $options->sitemap->priority->taxonomies->has( $taxonomyName ) ) { |
| [600](#L600) | $options->sitemap->priority->taxonomies->$taxonomyName->priority  = $data['priority']; |
| [601](#L601) | $options->sitemap->priority->taxonomies->$taxonomyName->frequency = $data['frequency']; |
| [602](#L602) | } |
| [603](#L603) | } |
| [604](#L604) | } |
| [605](#L605) |  |
| [606](#L606) | // Facebook post type object types. |
| [607](#L607) | if ( |
| [608](#L608) | ! empty( $rawOptions['social']['facebook']['general']['dynamic']['postTypes'] ) |
| [609](#L609) | ) { |
| [610](#L610) | foreach ( $rawOptions['social']['facebook']['general']['dynamic']['postTypes'] as $postTypeName => $data ) { |
| [611](#L611) | if ( $options->social->facebook->general->postTypes->has( $postTypeName ) ) { |
| [612](#L612) | $options->social->facebook->general->postTypes->$postTypeName->objectType = $data['objectType']; |
| [613](#L613) | } |
| [614](#L614) | } |
| [615](#L615) | } |
| [616](#L616) |  |
| [617](#L617) | // Search appearance post type data. |
| [618](#L618) | if ( |
| [619](#L619) | ! empty( $rawOptions['searchAppearance']['dynamic']['postTypes'] ) |
| [620](#L620) | ) { |
| [621](#L621) | foreach ( $rawOptions['searchAppearance']['dynamic']['postTypes'] as $postTypeName => $data ) { |
| [622](#L622) | if ( $options->searchAppearance->postTypes->has( $postTypeName ) ) { |
| [623](#L623) | $options->searchAppearance->postTypes->$postTypeName->show            = $data['show']; |
| [624](#L624) | $options->searchAppearance->postTypes->$postTypeName->title           = $data['title']; |
| [625](#L625) | $options->searchAppearance->postTypes->$postTypeName->metaDescription = $data['metaDescription']; |
| [626](#L626) | $options->searchAppearance->postTypes->$postTypeName->schemaType      = $data['schemaType']; |
| [627](#L627) | $options->searchAppearance->postTypes->$postTypeName->webPageType     = $data['webPageType']; |
| [628](#L628) | $options->searchAppearance->postTypes->$postTypeName->articleType     = $data['articleType']; |
| [629](#L629) | $options->searchAppearance->postTypes->$postTypeName->customFields    = $data['customFields']; |
| [630](#L630) |  |
| [631](#L631) | // Advanced settings. |
| [632](#L632) | $advanced = ! empty( $data['advanced']['robotsMeta'] ) ? $data['advanced']['robotsMeta'] : null; |
| [633](#L633) | if ( ! empty( $advanced ) ) { |
| [634](#L634) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->default         = $data['advanced']['robotsMeta']['default']; |
| [635](#L635) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->noindex         = $data['advanced']['robotsMeta']['noindex']; |
| [636](#L636) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->nofollow        = $data['advanced']['robotsMeta']['nofollow']; |
| [637](#L637) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->noarchive       = $data['advanced']['robotsMeta']['noarchive']; |
| [638](#L638) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->noimageindex    = $data['advanced']['robotsMeta']['noimageindex']; |
| [639](#L639) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->notranslate     = $data['advanced']['robotsMeta']['notranslate']; |
| [640](#L640) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->nosnippet       = $data['advanced']['robotsMeta']['nosnippet']; |
| [641](#L641) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->noodp           = $data['advanced']['robotsMeta']['noodp']; |
| [642](#L642) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->maxSnippet      = $data['advanced']['robotsMeta']['maxSnippet']; |
| [643](#L643) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->maxVideoPreview = $data['advanced']['robotsMeta']['maxVideoPreview']; |
| [644](#L644) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->maxImagePreview = $data['advanced']['robotsMeta']['maxImagePreview']; |
| [645](#L645) | $options->searchAppearance->postTypes->$postTypeName->advanced->showDateInGooglePreview     = $data['advanced']['showDateInGooglePreview']; |
| [646](#L646) | $options->searchAppearance->postTypes->$postTypeName->advanced->showPostThumbnailInSearch   = $data['advanced']['showPostThumbnailInSearch']; |
| [647](#L647) | $options->searchAppearance->postTypes->$postTypeName->advanced->showMetaBox                 = $data['advanced']['showMetaBox']; |
| [648](#L648) | $options->searchAppearance->postTypes->$postTypeName->advanced->bulkEditing                 = $data['advanced']['bulkEditing']; |
| [649](#L649) | } |
| [650](#L650) |  |
| [651](#L651) | if ( 'attachment' === $postTypeName ) { |
| [652](#L652) | $options->searchAppearance->postTypes->$postTypeName->redirectAttachmentUrls = $data['redirectAttachmentUrls']; |
| [653](#L653) | } |
| [654](#L654) | } |
| [655](#L655) | } |
| [656](#L656) | } |
| [657](#L657) |  |
| [658](#L658) | // Search appearance taxonomy data. |
| [659](#L659) | if ( |
| [660](#L660) | ! empty( $rawOptions['searchAppearance']['dynamic']['taxonomies'] ) |
| [661](#L661) | ) { |
| [662](#L662) | foreach ( $rawOptions['searchAppearance']['dynamic']['taxonomies'] as $taxonomyName => $data ) { |
| [663](#L663) | if ( $options->searchAppearance->taxonomies->has( $taxonomyName ) ) { |
| [664](#L664) | $options->searchAppearance->taxonomies->$taxonomyName->show            = $data['show']; |
| [665](#L665) | $options->searchAppearance->taxonomies->$taxonomyName->title           = $data['title']; |
| [666](#L666) | $options->searchAppearance->taxonomies->$taxonomyName->metaDescription = $data['metaDescription']; |
| [667](#L667) |  |
| [668](#L668) | // Advanced settings. |
| [669](#L669) | $advanced = ! empty( $data['advanced']['robotsMeta'] ) ? $data['advanced']['robotsMeta'] : null; |
| [670](#L670) | if ( ! empty( $advanced ) ) { |
| [671](#L671) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->default         = $data['advanced']['robotsMeta']['default']; |
| [672](#L672) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->noindex         = $data['advanced']['robotsMeta']['noindex']; |
| [673](#L673) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->nofollow        = $data['advanced']['robotsMeta']['nofollow']; |
| [674](#L674) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->noarchive       = $data['advanced']['robotsMeta']['noarchive']; |
| [675](#L675) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->noimageindex    = $data['advanced']['robotsMeta']['noimageindex']; |
| [676](#L676) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->notranslate     = $data['advanced']['robotsMeta']['notranslate']; |
| [677](#L677) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->nosnippet       = $data['advanced']['robotsMeta']['nosnippet']; |
| [678](#L678) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->noodp           = $data['advanced']['robotsMeta']['noodp']; |
| [679](#L679) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->maxSnippet      = $data['advanced']['robotsMeta']['maxSnippet']; |
| [680](#L680) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->maxVideoPreview = $data['advanced']['robotsMeta']['maxVideoPreview']; |
| [681](#L681) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->maxImagePreview = $data['advanced']['robotsMeta']['maxImagePreview']; |
| [682](#L682) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->showDateInGooglePreview     = $data['advanced']['showDateInGooglePreview']; |
| [683](#L683) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->showPostThumbnailInSearch   = $data['advanced']['showPostThumbnailInSearch']; |
| [684](#L684) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->showMetaBox                 = $data['advanced']['showMetaBox']; |
| [685](#L685) | } |
| [686](#L686) | } |
| [687](#L687) | } |
| [688](#L688) | } |
| [689](#L689) | } |
| [690](#L690) |  |
| [691](#L691) | /\*\* |
| [692](#L692) | \* Fixes the default value for the post schema type. |
| [693](#L693) | \* |
| [694](#L694) | \* @since 4.1.5 |
| [695](#L695) | \* |
| [696](#L696) | \* @return void |
| [697](#L697) | \*/ |
| [698](#L698) | private function fixSchemaTypeDefault() { |
| [699](#L699) | if ( aioseo()->core->db->tableExists( 'aioseo\_posts' ) && aioseo()->core->db->columnExists( 'aioseo\_posts', 'schema\_type' ) ) { |
| [700](#L700) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [701](#L701) | aioseo()->core->db->execute( |
| [702](#L702) | "ALTER TABLE {$tableName} |
| [703](#L703) | MODIFY schema\_type varchar(20) DEFAULT 'default'" |
| [704](#L704) | ); |
| [705](#L705) | } |
| [706](#L706) | } |
| [707](#L707) |  |
| [708](#L708) | /\*\* |
| [709](#L709) | \* Add in image with/height columns and image URL for caching. |
| [710](#L710) | \* |
| [711](#L711) | \* @since 4.1.6 |
| [712](#L712) | \* |
| [713](#L713) | \* @return void |
| [714](#L714) | \*/ |
| [715](#L715) | protected function migrateOgTwitterImageColumns() { |
| [716](#L716) | if ( aioseo()->core->db->tableExists( 'aioseo\_posts' ) ) { |
| [717](#L717) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [718](#L718) |  |
| [719](#L719) | // OG Columns. |
| [720](#L720) | if ( ! aioseo()->core->db->columnExists( 'aioseo\_posts', 'og\_image\_url' ) ) { |
| [721](#L721) | aioseo()->core->db->execute( |
| [722](#L722) | "ALTER TABLE {$tableName} ADD og\_image\_url text DEFAULT NULL AFTER og\_image\_type" |
| [723](#L723) | ); |
| [724](#L724) | } |
| [725](#L725) |  |
| [726](#L726) | if ( aioseo()->core->db->columnExists( 'aioseo\_posts', 'og\_custom\_image\_height' ) ) { |
| [727](#L727) | aioseo()->core->db->execute( |
| [728](#L728) | "ALTER TABLE {$tableName} CHANGE COLUMN og\_custom\_image\_height og\_image\_height int(11) DEFAULT NULL AFTER og\_image\_url" |
| [729](#L729) | ); |
| [730](#L730) | } elseif ( ! aioseo()->core->db->columnExists( 'aioseo\_posts', 'og\_image\_height' ) ) { |
| [731](#L731) | aioseo()->core->db->execute( |
| [732](#L732) | "ALTER TABLE {$tableName} ADD og\_image\_height int(11) DEFAULT NULL AFTER og\_image\_url" |
| [733](#L733) | ); |
| [734](#L734) | } |
| [735](#L735) |  |
| [736](#L736) | if ( aioseo()->core->db->columnExists( 'aioseo\_posts', 'og\_custom\_image\_width' ) ) { |
| [737](#L737) | aioseo()->core->db->execute( |
| [738](#L738) | "ALTER TABLE {$tableName} CHANGE COLUMN og\_custom\_image\_width og\_image\_width int(11) DEFAULT NULL AFTER og\_image\_url" |
| [739](#L739) | ); |
| [740](#L740) | } elseif ( ! aioseo()->core->db->columnExists( 'aioseo\_posts', 'og\_image\_width' ) ) { |
| [741](#L741) | aioseo()->core->db->execute( |
| [742](#L742) | "ALTER TABLE {$tableName} ADD og\_image\_width int(11) DEFAULT NULL AFTER og\_image\_url" |
| [743](#L743) | ); |
| [744](#L744) | } |
| [745](#L745) |  |
| [746](#L746) | // Twitter image url columnn. |
| [747](#L747) | if ( ! aioseo()->core->db->columnExists( 'aioseo\_posts', 'twitter\_image\_url' ) ) { |
| [748](#L748) | aioseo()->core->db->execute( |
| [749](#L749) | "ALTER TABLE {$tableName} ADD twitter\_image\_url text DEFAULT NULL AFTER twitter\_image\_type" |
| [750](#L750) | ); |
| [751](#L751) | } |
| [752](#L752) |  |
| [753](#L753) | // Reset the cache for the installed tables. |
| [754](#L754) | aioseo()->internalOptions->database->installedTables = ''; |
| [755](#L755) | } |
| [756](#L756) | } |
| [757](#L757) |  |
| [758](#L758) | /\*\* |
| [759](#L759) | \* Adds the limit modified date column to our posts table. |
| [760](#L760) | \* |
| [761](#L761) | \* @since 4.1.8 |
| [762](#L762) | \* |
| [763](#L763) | \* @return void |
| [764](#L764) | \*/ |
| [765](#L765) | private function addLimitModifiedDateColumn() { |
| [766](#L766) | if ( ! aioseo()->core->db->columnExists( 'aioseo\_posts', 'limit\_modified\_date' ) ) { |
| [767](#L767) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [768](#L768) | aioseo()->core->db->execute( |
| [769](#L769) | "ALTER TABLE {$tableName} |
| [770](#L770) | ADD limit\_modified\_date tinyint(1) NOT NULL DEFAULT 0 AFTER local\_seo" |
| [771](#L771) | ); |
| [772](#L772) |  |
| [773](#L773) | // Reset the cache for the installed tables. |
| [774](#L774) | aioseo()->internalOptions->database->installedTables = ''; |
| [775](#L775) | } |
| [776](#L776) | } |
| [777](#L777) |  |
| [778](#L778) | /\*\* |
| [779](#L779) | \* Fixes tags that should not be in the search appearance taxonomy options. |
| [780](#L780) | \* |
| [781](#L781) | \* @since 4.1.9 |
| [782](#L782) | \* |
| [783](#L783) | \* @return void |
| [784](#L784) | \*/ |
| [785](#L785) | protected function fixTaxonomyTags() { |
| [786](#L786) | $searchAppearanceTaxonomies = aioseo()->dynamicOptions->searchAppearance->taxonomies->all(); |
| [787](#L787) |  |
| [788](#L788) | $replaces = [ |
| [789](#L789) | '#breadcrumb\_separator' => '#separator\_sa', |
| [790](#L790) | '#breadcrumb\_'          => '#', |
| [791](#L791) | '#blog\_title'           => '#site\_title' |
| [792](#L792) | ]; |
| [793](#L793) |  |
| [794](#L794) | foreach ( $searchAppearanceTaxonomies as $taxonomy => $searchAppearanceTaxonomy ) { |
| [795](#L795) | aioseo()->dynamicOptions->searchAppearance->taxonomies->{$taxonomy}->title = str\_replace( |
| [796](#L796) | array\_keys( $replaces ), |
| [797](#L797) | array\_values( $replaces ), |
| [798](#L798) | $searchAppearanceTaxonomy['title'] |
| [799](#L799) | ); |
| [800](#L800) |  |
| [801](#L801) | aioseo()->dynamicOptions->searchAppearance->taxonomies->{$taxonomy}->metaDescription = str\_replace( |
| [802](#L802) | array\_keys( $replaces ), |
| [803](#L803) | array\_values( $replaces ), |
| [804](#L804) | $searchAppearanceTaxonomy['metaDescription'] |
| [805](#L805) | ); |
| [806](#L806) | } |
| [807](#L807) | } |
| [808](#L808) |  |
| [809](#L809) | /\*\* |
| [810](#L810) | \* Removes any AIOSEO Post records for revisions. |
| [811](#L811) | \* |
| [812](#L812) | \* @since 4.1.9 |
| [813](#L813) | \* |
| [814](#L814) | \* @return void |
| [815](#L815) | \*/ |
| [816](#L816) | private function removeRevisionRecords() { |
| [817](#L817) | $postsTableName       = aioseo()->core->db->prefix . 'posts'; |
| [818](#L818) | $aioseoPostsTableName = aioseo()->core->db->prefix . 'aioseo\_posts'; |
| [819](#L819) | aioseo()->core->db->execute( |
| [820](#L820) | "DELETE FROM `$aioseoPostsTableName` |
| [821](#L821) | WHERE `post\_id` IN ( |
| [822](#L822) | SELECT `ID` |
| [823](#L823) | FROM `$postsTableName` |
| [824](#L824) | WHERE `post\_parent` != 0 |
| [825](#L825) | AND `post\_type` = 'revision' |
| [826](#L826) | AND `post\_status` = 'inherit' |
| [827](#L827) | )" |
| [828](#L828) | ); |
| [829](#L829) | } |
| [830](#L830) |  |
| [831](#L831) | /\*\* |
| [832](#L832) | \* Enables the new shortcodes parsing setting if it was already enabled before as a deprecated setting. |
| [833](#L833) | \* |
| [834](#L834) | \* @since 4.2.0 |
| [835](#L835) | \* |
| [836](#L836) | \* @return void |
| [837](#L837) | \*/ |
| [838](#L838) | private function migrateDeprecatedRunShortcodesSetting() { |
| [839](#L839) | if ( |
| [840](#L840) | in\_array( 'runShortcodesInDescription', aioseo()->internalOptions->deprecatedOptions, true ) && |
| [841](#L841) | ! aioseo()->options->deprecated->searchAppearance->advanced->runShortcodesInDescription |
| [842](#L842) | ) { |
| [843](#L843) | return; |
| [844](#L844) | } |
| [845](#L845) |  |
| [846](#L846) | aioseo()->options->searchAppearance->advanced->runShortcodes = true; |
| [847](#L847) | } |
| [848](#L848) |  |
| [849](#L849) | /\*\* |
| [850](#L850) | \* Add options column. |
| [851](#L851) | \* |
| [852](#L852) | \* @since 4.2.2 |
| [853](#L853) | \* |
| [854](#L854) | \* @return void |
| [855](#L855) | \*/ |
| [856](#L856) | private function addOptionsColumn() { |
| [857](#L857) | if ( ! aioseo()->core->db->columnExists( 'aioseo\_posts', 'options' ) ) { |
| [858](#L858) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [859](#L859) | aioseo()->core->db->execute( |
| [860](#L860) | "ALTER TABLE {$tableName} |
| [861](#L861) | ADD `options` longtext DEFAULT NULL AFTER `limit\_modified\_date`" |
| [862](#L862) | ); |
| [863](#L863) |  |
| [864](#L864) | // Reset the cache for the installed tables. |
| [865](#L865) | aioseo()->internalOptions->database->installedTables = ''; |
| [866](#L866) | } |
| [867](#L867) | } |
| [868](#L868) |  |
| [869](#L869) | /\*\* |
| [870](#L870) | \* Remove the tabs column as it is unnecessary. |
| [871](#L871) | \* |
| [872](#L872) | \* @since 4.2.2 |
| [873](#L873) | \* |
| [874](#L874) | \* @return void |
| [875](#L875) | \*/ |
| [876](#L876) | protected function removeTabsColumn() { |
| [877](#L877) | if ( aioseo()->core->db->columnExists( 'aioseo\_posts', 'tabs' ) ) { |
| [878](#L878) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [879](#L879) | aioseo()->core->db->execute( |
| [880](#L880) | "ALTER TABLE {$tableName} |
| [881](#L881) | DROP tabs" |
| [882](#L882) | ); |
| [883](#L883) | } |
| [884](#L884) | } |
| [885](#L885) |  |
| [886](#L886) | /\*\* |
| [887](#L887) | \* Migrates the user contact methods to the new format. |
| [888](#L888) | \* |
| [889](#L889) | \* @since 4.2.2 |
| [890](#L890) | \* |
| [891](#L891) | \* @return void |
| [892](#L892) | \*/ |
| [893](#L893) | private function migrateUserContactMethods() { |
| [894](#L894) | $userMetaTableName = aioseo()->core->db->prefix . 'usermeta'; |
| [895](#L895) |  |
| [896](#L896) | aioseo()->core->db->execute( |
| [897](#L897) | "UPDATE `$userMetaTableName` |
| [898](#L898) | SET `meta\_key` = 'aioseo\_facebook\_page\_url' |
| [899](#L899) | WHERE `meta\_key` = 'aioseo\_facebook'" |
| [900](#L900) | ); |
| [901](#L901) |  |
| [902](#L902) | aioseo()->core->db->execute( |
| [903](#L903) | "UPDATE `$userMetaTableName` |
| [904](#L904) | SET `meta\_key` = 'aioseo\_twitter\_url' |
| [905](#L905) | WHERE `meta\_key` = 'aioseo\_twitter'" |
| [906](#L906) | ); |
| [907](#L907) | } |
| [908](#L908) |  |
| [909](#L909) | /\*\* |
| [910](#L910) | \* Migrates some older values in the Knowledge Panel contact type setting that were removed. |
| [911](#L911) | \* |
| [912](#L912) | \* @since 4.2.4 |
| [913](#L913) | \* |
| [914](#L914) | \* @return void |
| [915](#L915) | \*/ |
| [916](#L916) | public function migrateContactTypes() { |
| [917](#L917) | $oldValue          = aioseo()->options->searchAppearance->global->schema->contactType; |
| [918](#L918) | $oldValueLowerCase = strtolower( (string) $oldValue ); |
| [919](#L919) |  |
| [920](#L920) | // Return if there is no value set or manual input is being used. |
| [921](#L921) | if ( ! $oldValue || 'manual' === $oldValueLowerCase ) { |
| [922](#L922) | return; |
| [923](#L923) | } |
| [924](#L924) |  |
| [925](#L925) | switch ( $oldValueLowerCase ) { |
| [926](#L926) | case 'billing support': |
| [927](#L927) | case 'customer support': |
| [928](#L928) | case 'reservations': |
| [929](#L929) | case 'sales': |
| [930](#L930) | case 'technical support': |
| [931](#L931) | // If we still support the value, do nothing. |
| [932](#L932) | return; |
| [933](#L933) | default: |
| [934](#L934) | // Otherwise, migrate the existing value to the manual input field. |
| [935](#L935) | if ( 'bagage tracking' === $oldValueLowerCase ) { |
| [936](#L936) | // Let's also fix this old typo. |
| [937](#L937) | $oldValue = 'Baggage Tracking'; |
| [938](#L938) | } |
| [939](#L939) |  |
| [940](#L940) | aioseo()->options->searchAppearance->global->schema->contactType       = 'manual'; |
| [941](#L941) | aioseo()->options->searchAppearance->global->schema->contactTypeManual = $oldValue; |
| [942](#L942) | } |
| [943](#L943) | } |
| [944](#L944) |  |
| [945](#L945) | /\*\* |
| [946](#L946) | \* Add an addon column to the notifications table. |
| [947](#L947) | \* |
| [948](#L948) | \* @since 4.2.4 |
| [949](#L949) | \* |
| [950](#L950) | \* @return void |
| [951](#L951) | \*/ |
| [952](#L952) | private function addNotificationsAddonColumn() { |
| [953](#L953) | if ( ! aioseo()->core->db->columnExists( 'aioseo\_notifications', 'addon' ) ) { |
| [954](#L954) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_notifications'; |
| [955](#L955) | aioseo()->core->db->execute( |
| [956](#L956) | "ALTER TABLE {$tableName} |
| [957](#L957) | ADD `addon` varchar(64) DEFAULT NULL AFTER `slug`" |
| [958](#L958) | ); |
| [959](#L959) |  |
| [960](#L960) | // Reset the cache for the installed tables. |
| [961](#L961) | aioseo()->internalOptions->database->installedTables = ''; |
| [962](#L962) | } |
| [963](#L963) | } |
| [964](#L964) |  |
| [965](#L965) | /\*\* |
| [966](#L966) | \* Adds the schema column. |
| [967](#L967) | \* |
| [968](#L968) | \* @since 4.2.5 |
| [969](#L969) | \* |
| [970](#L970) | \* @return void |
| [971](#L971) | \*/ |
| [972](#L972) | private function addSchemaColumn() { |
| [973](#L973) | if ( ! aioseo()->core->db->columnExists( 'aioseo\_posts', 'schema' ) ) { |
| [974](#L974) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [975](#L975) | aioseo()->core->db->execute( |
| [976](#L976) | "ALTER TABLE {$tableName} |
| [977](#L977) | ADD `schema` longtext DEFAULT NULL AFTER `seo\_score`" |
| [978](#L978) | ); |
| [979](#L979) | } |
| [980](#L980) | } |
| [981](#L981) |  |
| [982](#L982) | /\*\* |
| [983](#L983) | \* Schedules the post schema migration. |
| [984](#L984) | \* |
| [985](#L985) | \* @since 4.2.5 |
| [986](#L986) | \* |
| [987](#L987) | \* @return void |
| [988](#L988) | \*/ |
| [989](#L989) | private function schedulePostSchemaMigration() { |
| [990](#L990) | aioseo()->actionScheduler->scheduleSingle( 'aioseo\_v4\_migrate\_post\_schema', 10 ); |
| [991](#L991) | } |
| [992](#L992) |  |
| [993](#L993) | /\*\* |
| [994](#L994) | \* Migrates then post schema to the new JSON column. |
| [995](#L995) | \* |
| [996](#L996) | \* @since 4.2.5 |
| [997](#L997) | \* |
| [998](#L998) | \* @return void |
| [999](#L999) | \*/ |
| [1000](#L1000) | public function migratePostSchema() { |
| [1001](#L1001) | $posts = aioseo()->core->db->start( 'aioseo\_posts' ) |
| [1002](#L1002) | ->select( '\*' ) |
| [1003](#L1003) | ->whereRaw( '`schema` IS NULL' ) |
| [1004](#L1004) | ->limit( 40 ) |
| [1005](#L1005) | ->run() |
| [1006](#L1006) | ->models( 'AIOSEO\\Plugin\\Common\\Models\\Post' ); |
| [1007](#L1007) |  |
| [1008](#L1008) | if ( empty( $posts ) ) { |
| [1009](#L1009) | return; |
| [1010](#L1010) | } |
| [1011](#L1011) |  |
| [1012](#L1012) | foreach ( $posts as $post ) { |
| [1013](#L1013) | $this->migratePostSchemaHelper( $post ); |
| [1014](#L1014) | } |
| [1015](#L1015) |  |
| [1016](#L1016) | // Once done, schedule the next action. |
| [1017](#L1017) | aioseo()->actionScheduler->scheduleSingle( 'aioseo\_v4\_migrate\_post\_schema', 30 ); |
| [1018](#L1018) | } |
| [1019](#L1019) |  |
| [1020](#L1020) | /\*\* |
| [1021](#L1021) | \* Schedules the post schema migration to fix the default graphs. |
| [1022](#L1022) | \* |
| [1023](#L1023) | \* @since 4.2.6 |
| [1024](#L1024) | \* |
| [1025](#L1025) | \* @return void |
| [1026](#L1026) | \*/ |
| [1027](#L1027) | private function schedulePostSchemaDefaultMigration() { |
| [1028](#L1028) | aioseo()->actionScheduler->scheduleSingle( 'aioseo\_v4\_migrate\_post\_schema\_default', 10 ); |
| [1029](#L1029) |  |
| [1030](#L1030) | if ( ! aioseo()->cache->get( 'v4\_migrate\_post\_schema\_default\_date' ) ) { |
| [1031](#L1031) | aioseo()->cache->update( 'v4\_migrate\_post\_schema\_default\_date', gmdate( 'Y-m-d H:i:s' ), 3 \* MONTH\_IN\_SECONDS ); |
| [1032](#L1032) | } |
| [1033](#L1033) | } |
| [1034](#L1034) |  |
| [1035](#L1035) | /\*\* |
| [1036](#L1036) | \* Updates the dashboardWidgets with the new array format. |
| [1037](#L1037) | \* |
| [1038](#L1038) | \* @since 4.2.8 |
| [1039](#L1039) | \* |
| [1040](#L1040) | \* @return void |
| [1041](#L1041) | \*/ |
| [1042](#L1042) | private function migrateDashboardWidgetsOptions() { |
| [1043](#L1043) | $rawOptions = $this->getRawOptions(); |
| [1044](#L1044) |  |
| [1045](#L1045) | if ( empty( $rawOptions ) || ! is\_bool( $rawOptions['advanced']['dashboardWidgets'] ) ) { |
| [1046](#L1046) | return; |
| [1047](#L1047) | } |
| [1048](#L1048) |  |
| [1049](#L1049) | $widgets = [ 'seoNews' ]; |
| [1050](#L1050) |  |
| [1051](#L1051) | // If the dashboardWidgets was activated, let's turn on the other widgets. |
| [1052](#L1052) | if ( $rawOptions['advanced']['dashboardWidgets'] ) { |
| [1053](#L1053) | $widgets[] = 'seoOverview'; |
| [1054](#L1054) | $widgets[] = 'seoSetup'; |
| [1055](#L1055) | } |
| [1056](#L1056) |  |
| [1057](#L1057) | aioseo()->options->advanced->dashboardWidgets = $widgets; |
| [1058](#L1058) | } |
| [1059](#L1059) |  |
| [1060](#L1060) | /\*\* |
| [1061](#L1061) | \* Migrates the post schema to the new JSON column again for posts using the default. |
| [1062](#L1062) | \* This is needed to fix an oversight because in 4.2.5 we didn't migrate any properties set to the default graph. |
| [1063](#L1063) | \* |
| [1064](#L1064) | \* @since 4.2.6 |
| [1065](#L1065) | \* |
| [1066](#L1066) | \* @return void |
| [1067](#L1067) | \*/ |
| [1068](#L1068) | public function migratePostSchemaDefault() { |
| [1069](#L1069) | $migrationStartDate = aioseo()->cache->get( 'v4\_migrate\_post\_schema\_default\_date' ); |
| [1070](#L1070) | if ( ! $migrationStartDate ) { |
| [1071](#L1071) | return; |
| [1072](#L1072) | } |
| [1073](#L1073) |  |
| [1074](#L1074) | $posts = aioseo()->core->db->start( 'aioseo\_posts' ) |
| [1075](#L1075) | ->select( '\*' ) |
| [1076](#L1076) | ->where( 'schema\_type =', 'default' ) |
| [1077](#L1077) | ->whereRaw( "updated < '$migrationStartDate'" ) |
| [1078](#L1078) | ->limit( 40 ) |
| [1079](#L1079) | ->run() |
| [1080](#L1080) | ->models( 'AIOSEO\\Plugin\\Common\\Models\\Post' ); |
| [1081](#L1081) |  |
| [1082](#L1082) | if ( empty( $posts ) ) { |
| [1083](#L1083) | aioseo()->cache->delete( 'v4\_migrate\_post\_schema\_default\_date' ); |
| [1084](#L1084) |  |
| [1085](#L1085) | return; |
| [1086](#L1086) | } |
| [1087](#L1087) |  |
| [1088](#L1088) | foreach ( $posts as $post ) { |
| [1089](#L1089) | $this->migratePostSchemaHelper( $post ); |
| [1090](#L1090) | } |
| [1091](#L1091) |  |
| [1092](#L1092) | // Once done, schedule the next action. |
| [1093](#L1093) | aioseo()->actionScheduler->scheduleSingle( 'aioseo\_v4\_migrate\_post\_schema\_default', 30 ); |
| [1094](#L1094) | } |
| [1095](#L1095) |  |
| [1096](#L1096) | /\*\* |
| [1097](#L1097) | \* Helper function for the schema migration. |
| [1098](#L1098) | \* |
| [1099](#L1099) | \* @since  4.2.5 |
| [1100](#L1100) | \* |
| [1101](#L1101) | \* @param  Post $aioseoPost The AIOSEO post object. |
| [1102](#L1102) | \* @return Post             The modified AIOSEO post object. |
| [1103](#L1103) | \*/ |
| [1104](#L1104) | public function migratePostSchemaHelper( $aioseoPost ) { |
| [1105](#L1105) | $post              = aioseo()->helpers->getPost( $aioseoPost->post\_id ); |
| [1106](#L1106) | $schemaType        = $aioseoPost->schema\_type; |
| [1107](#L1107) | $schemaTypeOptions = json\_decode( (string) $aioseoPost->schema\_type\_options ); |
| [1108](#L1108) | $schemaOptions     = Models\Post::getDefaultSchemaOptions( '', $post ); |
| [1109](#L1109) |  |
| [1110](#L1110) | if ( empty( $schemaTypeOptions ) ) { |
| [1111](#L1111) | $aioseoPost->schema = $schemaOptions; |
| [1112](#L1112) | $aioseoPost->save(); |
| [1113](#L1113) |  |
| [1114](#L1114) | return $aioseoPost; |
| [1115](#L1115) | } |
| [1116](#L1116) |  |
| [1117](#L1117) | // If the post is set to the default schema type, set the default for post type but then also get the properties. |
| [1118](#L1118) | $isDefault = 'default' === $schemaType; |
| [1119](#L1119) | if ( $isDefault ) { |
| [1120](#L1120) | $dynamicOptions = aioseo()->dynamicOptions->noConflict(); |
| [1121](#L1121) | if ( ! empty( $post->post\_type ) && $dynamicOptions->searchAppearance->postTypes->has( $post->post\_type ) ) { |
| [1122](#L1122) | $schemaOptions->default->graphName = $dynamicOptions->searchAppearance->postTypes->{$post->post\_type}->schemaType; |
| [1123](#L1123) | $schemaType                        = $dynamicOptions->searchAppearance->postTypes->{$post->post\_type}->schemaType; |
| [1124](#L1124) | } |
| [1125](#L1125) | } |
| [1126](#L1126) |  |
| [1127](#L1127) | $graph = []; |
| [1128](#L1128) | switch ( $schemaType ) { |
| [1129](#L1129) | case 'Article': |
| [1130](#L1130) | $graph = [ |
| [1131](#L1131) | 'id'         => 'aioseo-article-' . uniqid(), |
| [1132](#L1132) | 'slug'       => 'article', |
| [1133](#L1133) | 'graphName'  => 'Article', |
| [1134](#L1134) | 'label'      => \_\_( 'Article', 'all-in-one-seo-pack' ), |
| [1135](#L1135) | 'properties' => [ |
| [1136](#L1136) | 'type'        => ! empty( $schemaTypeOptions->article->articleType ) ? $schemaTypeOptions->article->articleType : 'Article', |
| [1137](#L1137) | 'name'        => '#post\_title', |
| [1138](#L1138) | 'headline'    => '#post\_title', |
| [1139](#L1139) | 'description' => '#post\_excerpt', |
| [1140](#L1140) | 'image'       => '', |
| [1141](#L1141) | 'keywords'    => '', |
| [1142](#L1142) | 'author'      => [ |
| [1143](#L1143) | 'name' => '#author\_name', |
| [1144](#L1144) | 'url'  => '#author\_url' |
| [1145](#L1145) | ], |
| [1146](#L1146) | 'dates'       => [ |
| [1147](#L1147) | 'include'       => true, |
| [1148](#L1148) | 'datePublished' => '', |
| [1149](#L1149) | 'dateModified'  => '' |
| [1150](#L1150) | ] |
| [1151](#L1151) | ] |
| [1152](#L1152) | ]; |
| [1153](#L1153) | break; |
| [1154](#L1154) | case 'Course': |
| [1155](#L1155) | $graph = [ |
| [1156](#L1156) | 'id'         => 'aioseo-course-' . uniqid(), |
| [1157](#L1157) | 'slug'       => 'course', |
| [1158](#L1158) | 'graphName'  => 'Course', |
| [1159](#L1159) | 'label'      => \_\_( 'Course', 'all-in-one-seo-pack' ), |
| [1160](#L1160) | 'properties' => [ |
| [1161](#L1161) | 'name'        => ! empty( $schemaTypeOptions->course->name ) ? $schemaTypeOptions->course->name : '#post\_title', |
| [1162](#L1162) | 'description' => ! empty( $schemaTypeOptions->course->description ) ? $schemaTypeOptions->course->description : '#post\_excerpt', |
| [1163](#L1163) | 'provider'    => [ |
| [1164](#L1164) | 'name'  => ! empty( $schemaTypeOptions->course->provider ) ? $schemaTypeOptions->course->provider : '', |
| [1165](#L1165) | 'url'   => '', |
| [1166](#L1166) | 'image' => '' |
| [1167](#L1167) | ] |
| [1168](#L1168) | ] |
| [1169](#L1169) | ]; |
| [1170](#L1170) | break; |
| [1171](#L1171) | case 'Product': |
| [1172](#L1172) | $graph = [ |
| [1173](#L1173) | 'id'         => 'aioseo-product-' . uniqid(), |
| [1174](#L1174) | 'slug'       => 'product', |
| [1175](#L1175) | 'graphName'  => 'Product', |
| [1176](#L1176) | 'label'      => \_\_( 'Product', 'all-in-one-seo-pack' ), |
| [1177](#L1177) | 'properties' => [ |
| [1178](#L1178) | 'autogenerate' => true, |
| [1179](#L1179) | 'name'         => '#post\_title', |
| [1180](#L1180) | 'description'  => ! empty( $schemaTypeOptions->product->description ) ? $schemaTypeOptions->product->description : '#post\_excerpt', |
| [1181](#L1181) | 'brand'        => ! empty( $schemaTypeOptions->product->brand ) ? $schemaTypeOptions->product->brand : '', |
| [1182](#L1182) | 'image'        => '', |
| [1183](#L1183) | 'identifiers'  => [ |
| [1184](#L1184) | 'sku'  => ! empty( $schemaTypeOptions->product->sku ) ? $schemaTypeOptions->product->sku : '', |
| [1185](#L1185) | 'gtin' => '', |
| [1186](#L1186) | 'mpn'  => '' |
| [1187](#L1187) | ], |
| [1188](#L1188) | 'offer'        => [ |
| [1189](#L1189) | 'price'        => ! empty( $schemaTypeOptions->product->price ) ? (float) $schemaTypeOptions->product->price : '', |
| [1190](#L1190) | 'currency'     => ! empty( $schemaTypeOptions->product->currency ) ? $schemaTypeOptions->product->currency : '', |
| [1191](#L1191) | 'availability' => ! empty( $schemaTypeOptions->product->availability ) ? $schemaTypeOptions->product->availability : '', |
| [1192](#L1192) | 'validUntil'   => ! empty( $schemaTypeOptions->product->priceValidUntil ) ? $schemaTypeOptions->product->priceValidUntil : '' |
| [1193](#L1193) | ], |
| [1194](#L1194) | 'rating'       => [ |
| [1195](#L1195) | 'minimum' => 1, |
| [1196](#L1196) | 'maximum' => 5 |
| [1197](#L1197) | ], |
| [1198](#L1198) | 'reviews'      => [] |
| [1199](#L1199) | ] |
| [1200](#L1200) | ]; |
| [1201](#L1201) |  |
| [1202](#L1202) | $identifierType = ! empty( $schemaTypeOptions->product->identifierType ) ? $schemaTypeOptions->product->identifierType : ''; |
| [1203](#L1203) | if ( preg\_match( '/gtin/i', $identifierType ) ) { |
| [1204](#L1204) | $graph['properties']['identifiers']['gtin'] = $identifierType; |
| [1205](#L1205) | } |
| [1206](#L1206) |  |
| [1207](#L1207) | if ( preg\_match( '/mpn/i', $identifierType ) ) { |
| [1208](#L1208) | $graph['properties']['identifiers']['mpn'] = $identifierType; |
| [1209](#L1209) | } |
| [1210](#L1210) |  |
| [1211](#L1211) | $reviews = ! empty( $schemaTypeOptions->product->reviews ) ? $schemaTypeOptions->product->reviews : []; |
| [1212](#L1212) | if ( ! empty( $reviews ) ) { |
| [1213](#L1213) | foreach ( $reviews as $reviewData ) { |
| [1214](#L1214) | $reviewData = json\_decode( $reviewData ); |
| [1215](#L1215) | if ( empty( $reviewData ) ) { |
| [1216](#L1216) | continue; |
| [1217](#L1217) | } |
| [1218](#L1218) |  |
| [1219](#L1219) | $graph['properties']['reviews'][] = [ |
| [1220](#L1220) | 'rating'   => $reviewData->rating, |
| [1221](#L1221) | 'headline' => $reviewData->headline, |
| [1222](#L1222) | 'content'  => $reviewData->content, |
| [1223](#L1223) | 'author'   => $reviewData->author |
| [1224](#L1224) | ]; |
| [1225](#L1225) | } |
| [1226](#L1226) | } |
| [1227](#L1227) | break; |
| [1228](#L1228) | case 'Recipe': |
| [1229](#L1229) | $graph = [ |
| [1230](#L1230) | 'id'         => 'aioseo-recipe-' . uniqid(), |
| [1231](#L1231) | 'slug'       => 'recipe', |
| [1232](#L1232) | 'graphName'  => 'Recipe', |
| [1233](#L1233) | 'label'      => \_\_( 'Recipe', 'all-in-one-seo-pack' ), |
| [1234](#L1234) | 'properties' => [ |
| [1235](#L1235) | 'name'         => ! empty( $schemaTypeOptions->recipe->name ) ? $schemaTypeOptions->recipe->name : '#post\_title', |
| [1236](#L1236) | 'description'  => ! empty( $schemaTypeOptions->recipe->description ) ? $schemaTypeOptions->recipe->description : '#post\_excerpt', |
| [1237](#L1237) | 'author'       => ! empty( $schemaTypeOptions->recipe->author ) ? $schemaTypeOptions->recipe->author : '#author\_name', |
| [1238](#L1238) | 'ingredients'  => ! empty( $schemaTypeOptions->recipe->ingredients ) ? $schemaTypeOptions->recipe->ingredients : '', |
| [1239](#L1239) | 'dishType'     => ! empty( $schemaTypeOptions->recipe->dishType ) ? $schemaTypeOptions->recipe->dishType : '', |
| [1240](#L1240) | 'cuisineType'  => ! empty( $schemaTypeOptions->recipe->cuisineType ) ? $schemaTypeOptions->recipe->cuisineType : '', |
| [1241](#L1241) | 'keywords'     => ! empty( $schemaTypeOptions->recipe->keywords ) ? $schemaTypeOptions->recipe->keywords : '', |
| [1242](#L1242) | 'image'        => ! empty( $schemaTypeOptions->recipe->image ) ? $schemaTypeOptions->recipe->image : '', |
| [1243](#L1243) | 'nutrition'    => [ |
| [1244](#L1244) | 'servings' => ! empty( $schemaTypeOptions->recipe->servings ) ? $schemaTypeOptions->recipe->servings : '', |
| [1245](#L1245) | 'calories' => ! empty( $schemaTypeOptions->recipe->calories ) ? $schemaTypeOptions->recipe->calories : '' |
| [1246](#L1246) | ], |
| [1247](#L1247) | 'timeRequired' => [ |
| [1248](#L1248) | 'preparation' => ! empty( $schemaTypeOptions->recipe->preparationTime ) ? $schemaTypeOptions->recipe->preparationTime : '', |
| [1249](#L1249) | 'cooking'     => ! empty( $schemaTypeOptions->recipe->cookingTime ) ? $schemaTypeOptions->recipe->cookingTime : '' |
| [1250](#L1250) | ], |
| [1251](#L1251) | 'instructions' => [] |
| [1252](#L1252) | ] |
| [1253](#L1253) | ]; |
| [1254](#L1254) |  |
| [1255](#L1255) | $instructions = ! empty( $schemaTypeOptions->recipe->instructions ) ? $schemaTypeOptions->recipe->instructions : []; |
| [1256](#L1256) | if ( ! empty( $instructions ) ) { |
| [1257](#L1257) | foreach ( $instructions as $instructionData ) { |
| [1258](#L1258) | $instructionData = json\_decode( $instructionData ); |
| [1259](#L1259) | if ( empty( $instructionData ) ) { |
| [1260](#L1260) | continue; |
| [1261](#L1261) | } |
| [1262](#L1262) |  |
| [1263](#L1263) | $graph['properties']['instructions'][] = [ |
| [1264](#L1264) | 'name'  => '', |
| [1265](#L1265) | 'text'  => $instructionData->content, |
| [1266](#L1266) | 'image' => '' |
| [1267](#L1267) | ]; |
| [1268](#L1268) | } |
| [1269](#L1269) | } |
| [1270](#L1270) | break; |
| [1271](#L1271) | case 'SoftwareApplication': |
| [1272](#L1272) | $graph = [ |
| [1273](#L1273) | 'id'         => 'aioseo-software-application-' . uniqid(), |
| [1274](#L1274) | 'slug'       => 'software-application', |
| [1275](#L1275) | 'graphName'  => 'SoftwareApplication', |
| [1276](#L1276) | 'label'      => \_\_( 'Software', 'all-in-one-seo-pack' ), |
| [1277](#L1277) | 'properties' => [ |
| [1278](#L1278) | 'name'            => ! empty( $schemaTypeOptions->software->name ) ? $schemaTypeOptions->software->name : '#post\_title', |
| [1279](#L1279) | 'description'     => '#post\_excerpt', |
| [1280](#L1280) | 'price'           => ! empty( $schemaTypeOptions->software->price ) ? (float) $schemaTypeOptions->software->price : '', |
| [1281](#L1281) | 'currency'        => ! empty( $schemaTypeOptions->software->currency ) ? $schemaTypeOptions->software->currency : '', |
| [1282](#L1282) | 'operatingSystem' => ! empty( $schemaTypeOptions->software->operatingSystems ) ? $schemaTypeOptions->software->operatingSystems : '', |
| [1283](#L1283) | 'category'        => ! empty( $schemaTypeOptions->software->category ) ? $schemaTypeOptions->software->category : '', |
| [1284](#L1284) | 'rating'          => [ |
| [1285](#L1285) | 'value'   => '', |
| [1286](#L1286) | 'minimum' => 1, |
| [1287](#L1287) | 'maximum' => 5 |
| [1288](#L1288) | ], |
| [1289](#L1289) | 'review'          => [ |
| [1290](#L1290) | 'headline' => '', |
| [1291](#L1291) | 'content'  => '', |
| [1292](#L1292) | 'author'   => '' |
| [1293](#L1293) | ] |
| [1294](#L1294) | ] |
| [1295](#L1295) | ]; |
| [1296](#L1296) |  |
| [1297](#L1297) | $reviews = ! empty( $schemaTypeOptions->software->reviews ) ? $schemaTypeOptions->software->reviews : []; |
| [1298](#L1298) | if ( ! empty( $reviews[0] ) ) { |
| [1299](#L1299) | $reviewData = json\_decode( $reviews[0] ); |
| [1300](#L1300) | if ( empty( $reviewData ) ) { |
| [1301](#L1301) | break; |
| [1302](#L1302) | } |
| [1303](#L1303) |  |
| [1304](#L1304) | $graph['properties']['rating']['value'] = $reviewData->rating; |
| [1305](#L1305) | $graph['properties']['review'] = [ |
| [1306](#L1306) | 'headline' => $reviewData->headline, |
| [1307](#L1307) | 'content'  => $reviewData->content, |
| [1308](#L1308) | 'author'   => $reviewData->author |
| [1309](#L1309) | ]; |
| [1310](#L1310) | } |
| [1311](#L1311) | break; |
| [1312](#L1312) | case 'WebPage': |
| [1313](#L1313) | if ( 'FAQPage' === $schemaTypeOptions->webPage->webPageType ) { |
| [1314](#L1314) | $graph = [ |
| [1315](#L1315) | 'id'         => 'aioseo-faq-page-' . uniqid(), |
| [1316](#L1316) | 'slug'       => 'faq-page', |
| [1317](#L1317) | 'graphName'  => 'FAQPage', |
| [1318](#L1318) | 'label'      => \_\_( 'FAQ Page', 'all-in-one-seo-pack' ), |
| [1319](#L1319) | 'properties' => [ |
| [1320](#L1320) | 'type'        => $schemaTypeOptions->webPage->webPageType, |
| [1321](#L1321) | 'name'        => '#post\_title', |
| [1322](#L1322) | 'description' => '#post\_excerpt', |
| [1323](#L1323) | 'questions'   => [] |
| [1324](#L1324) | ] |
| [1325](#L1325) | ]; |
| [1326](#L1326) |  |
| [1327](#L1327) | $faqs = $schemaTypeOptions->faq->pages; |
| [1328](#L1328) | if ( ! empty( $faqs ) ) { |
| [1329](#L1329) | foreach ( $faqs as $faqData ) { |
| [1330](#L1330) | $faqData = json\_decode( $faqData ); |
| [1331](#L1331) | if ( empty( $faqData ) ) { |
| [1332](#L1332) | continue; |
| [1333](#L1333) | } |
| [1334](#L1334) |  |
| [1335](#L1335) | $graph['properties']['questions'][] = [ |
| [1336](#L1336) | 'question' => $faqData->question, |
| [1337](#L1337) | 'answer'   => $faqData->answer |
| [1338](#L1338) | ]; |
| [1339](#L1339) | } |
| [1340](#L1340) | } |
| [1341](#L1341) | } else { |
| [1342](#L1342) | $graph = [ |
| [1343](#L1343) | 'id'         => 'aioseo-web-page-' . uniqid(), |
| [1344](#L1344) | 'slug'       => 'web-page', |
| [1345](#L1345) | 'graphName'  => 'WebPage', |
| [1346](#L1346) | 'label'      => \_\_( 'Web Page', 'all-in-one-seo-pack' ), |
| [1347](#L1347) | 'properties' => [ |
| [1348](#L1348) | 'type'        => $schemaTypeOptions->webPage->webPageType, |
| [1349](#L1349) | 'name'        => '', |
| [1350](#L1350) | 'description' => '' |
| [1351](#L1351) | ] |
| [1352](#L1352) | ]; |
| [1353](#L1353) | } |
| [1354](#L1354) | break; |
| [1355](#L1355) | case 'default': |
| [1356](#L1356) | $dynamicOptions = aioseo()->dynamicOptions->noConflict(); |
| [1357](#L1357) | if ( ! empty( $post->post\_type ) && $dynamicOptions->searchAppearance->postTypes->has( $post->post\_type ) ) { |
| [1358](#L1358) | $schemaOptions->defaultGraph = $dynamicOptions->searchAppearance->postTypes->{$post->post\_type}->schemaType; |
| [1359](#L1359) | } |
| [1360](#L1360) | break; |
| [1361](#L1361) | case 'none': |
| [1362](#L1362) | // If "none', we simply don't have to migrate anything. |
| [1363](#L1363) | default: |
| [1364](#L1364) | break; |
| [1365](#L1365) | } |
| [1366](#L1366) |  |
| [1367](#L1367) | if ( ! empty( $graph ) ) { |
| [1368](#L1368) | if ( $isDefault ) { |
| [1369](#L1369) | $schemaOptions->default->data->{$schemaType} = $graph; |
| [1370](#L1370) | } else { |
| [1371](#L1371) | $schemaOptions->graphs[]           = $graph; |
| [1372](#L1372) | $schemaOptions->default->isEnabled = false; |
| [1373](#L1373) | } |
| [1374](#L1374) | } |
| [1375](#L1375) |  |
| [1376](#L1376) | $aioseoPost->schema = $schemaOptions; |
| [1377](#L1377) | $aioseoPost->save(); |
| [1378](#L1378) |  |
| [1379](#L1379) | return $aioseoPost; |
| [1380](#L1380) | } |
| [1381](#L1381) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/all-in-one-seo-pack/tags/4.2.9/app/Common/Main/Updates.php?format=txt)
* [Original Format](/export/3222465/all-in-one-seo-pack/tags/4.2.9/app/Common/Main/Updates.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_83d807a3_20250114_201440.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fall-in-one-seo-pack%2Ftags%2F4.2.9%2Fapp%2FCommon%2FMain%2FUpdates.php%3Fv%3D2829340)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/all-in-one-seo-pack/trunk/app/Common/Main/Updates.php?rev=2814301 "Revision 2814301")
* [Next Revision](/browser/all-in-one-seo-pack/trunk/app/Common/Main/Updates.php?rev=2866377 "Revision 2866377") →
* [Blame](/browser/all-in-one-seo-pack/trunk/app/Common/Main/Updates.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/all-in-one-seo-pack/tags/4.2.9/app/Common/Main/Updates.php)

---

# [source:](/browser?order=name "Go to repository root") [all-in-one-seo-pack](/browser/all-in-one-seo-pack?order=name "View all-in-one-seo-pack")/[tags](/browser/all-in-one-seo-pack/tags?order=name "View tags")/[4.2.9](/browser/all-in-one-seo-pack/tags/4.2.9?order=name "View 4.2.9")/[app](/browser/all-in-one-seo-pack/tags/4.2.9/app?order=name "View app")/[Common](/browser/all-in-one-seo-pack/tags/4.2.9/app/Common?order=name "View Common")/[Main](/browser/all-in-one-seo-pack/tags/4.2.9/app/Common/Main?order=name "View Main")/[Updates.php](/browser/all-in-one-seo-pack/tags/4.2.9/app/Common/Main/Updates.php?order=name "View Updates.php")

View diff against:

View revision:

| [Last change](/changeset/2829340/all-in-one-seo-pack/trunk/app/Common/Main/Updates.php "View differences") on this file was [2829340](/changeset/2829340/ "View changeset 2829340"), checked in by cristianrossi, [2 years ago](/timeline?from=2022-12-06T12%3A31%3A50Z&precision=second "See timeline at 12/06/2022 12:31:50 PM") |
| --- |
| 4.2.8 |
| **File size:** 46.1 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | namespace AIOSEO\Plugin\Common\Main; |
| [3](#L3) |  |
| [4](#L4) | use \AIOSEO\Plugin\Common\Models; |
| [5](#L5) |  |
| [6](#L6) | // Exit if accessed directly. |
| [7](#L7) | if ( ! defined( 'ABSPATH' ) ) { |
| [8](#L8) | exit; |
| [9](#L9) | } |
| [10](#L10) |  |
| [11](#L11) | /\*\* |
| [12](#L12) | \* Updater class. |
| [13](#L13) | \* |
| [14](#L14) | \* @since 4.0.0 |
| [15](#L15) | \*/ |
| [16](#L16) | class Updates { |
| [17](#L17) | /\*\* |
| [18](#L18) | \* Class constructor. |
| [19](#L19) | \* |
| [20](#L20) | \* @since 4.0.0 |
| [21](#L21) | \*/ |
| [22](#L22) | public function \_\_construct() { |
| [23](#L23) | add\_action( 'aioseo\_v4\_migrate\_post\_schema', [ $this, 'migratePostSchema' ] ); |
| [24](#L24) | add\_action( 'aioseo\_v4\_migrate\_post\_schema\_default', [ $this, 'migratePostSchemaDefault' ] ); |
| [25](#L25) |  |
| [26](#L26) | if ( wp\_doing\_ajax() || wp\_doing\_cron() ) { |
| [27](#L27) | return; |
| [28](#L28) | } |
| [29](#L29) |  |
| [30](#L30) | add\_action( 'init', [ $this, 'init' ], 1001 ); |
| [31](#L31) | add\_action( 'init', [ $this, 'runUpdates' ], 1002 ); |
| [32](#L32) | add\_action( 'init', [ $this, 'updateLatestVersion' ], 3000 ); |
| [33](#L33) | } |
| [34](#L34) |  |
| [35](#L35) | /\*\* |
| [36](#L36) | \* Sets the latest active version if it is not set yet. |
| [37](#L37) | \* |
| [38](#L38) | \* @since 4.0.0 |
| [39](#L39) | \* |
| [40](#L40) | \* @return void |
| [41](#L41) | \*/ |
| [42](#L42) | public function init() { |
| [43](#L43) | if ( '0.0' !== aioseo()->internalOptions->internal->lastActiveVersion ) { |
| [44](#L44) | return; |
| [45](#L45) | } |
| [46](#L46) |  |
| [47](#L47) | // It's possible the user may not have capabilities. Let's add them now. |
| [48](#L48) | aioseo()->access->addCapabilities(); |
| [49](#L49) |  |
| [50](#L50) | $oldOptions = get\_option( 'aioseop\_options' ); |
| [51](#L51) | if ( ! empty( $oldOptions['last\_active\_version'] ) ) { |
| [52](#L52) | aioseo()->internalOptions->internal->lastActiveVersion = $oldOptions['last\_active\_version']; |
| [53](#L53) | } |
| [54](#L54) |  |
| [55](#L55) | $this->addInitialCustomTablesForV4(); |
| [56](#L56) | add\_action( 'wp\_loaded', [ $this, 'setDefaultSocialImages' ], 1001 ); |
| [57](#L57) | } |
| [58](#L58) |  |
| [59](#L59) | /\*\* |
| [60](#L60) | \* Runs our migrations. |
| [61](#L61) | \* |
| [62](#L62) | \* @since 4.0.0 |
| [63](#L63) | \* |
| [64](#L64) | \* @return void |
| [65](#L65) | \*/ |
| [66](#L66) | public function runUpdates() { |
| [67](#L67) | // The dynamic options have not yet fully loaded, so let's refresh here to force that to happen. |
| [68](#L68) | aioseo()->dynamicOptions->refresh(); // TODO: Check if we still need this since it already runs on 999 in the main AIOSEO file. |
| [69](#L69) |  |
| [70](#L70) | $lastActiveVersion = aioseo()->internalOptions->internal->lastActiveVersion; |
| [71](#L71) | if ( version\_compare( $lastActiveVersion, '4.0.5', '<' ) ) { |
| [72](#L72) | $this->addImageScanDateColumn(); |
| [73](#L73) | } |
| [74](#L74) |  |
| [75](#L75) | if ( version\_compare( $lastActiveVersion, '4.0.6', '<' ) ) { |
| [76](#L76) | $this->disableTwitterUseOgDefault(); |
| [77](#L77) | $this->updateMaxImagePreviewDefault(); |
| [78](#L78) | } |
| [79](#L79) |  |
| [80](#L80) | if ( ! aioseo()->pro && version\_compare( $lastActiveVersion, '4.0.6', '=' ) && 'posts' !== get\_option( 'show\_on\_front' ) ) { |
| [81](#L81) | aioseo()->migration->helpers->redoMigration(); |
| [82](#L82) | } |
| [83](#L83) |  |
| [84](#L84) | if ( version\_compare( $lastActiveVersion, '4.0.13', '<' ) ) { |
| [85](#L85) | $this->removeDuplicateRecords(); |
| [86](#L86) | } |
| [87](#L87) |  |
| [88](#L88) | if ( version\_compare( $lastActiveVersion, '4.0.17', '<' ) ) { |
| [89](#L89) | $this->removeLocationColumn(); |
| [90](#L90) | } |
| [91](#L91) |  |
| [92](#L92) | if ( version\_compare( $lastActiveVersion, '4.1.2', '<' ) ) { |
| [93](#L93) | $this->clearProductImages(); |
| [94](#L94) | } |
| [95](#L95) |  |
| [96](#L96) | if ( version\_compare( $lastActiveVersion, '4.1.3', '<' ) ) { |
| [97](#L97) | $this->addNotificationsNewColumn(); |
| [98](#L98) | $this->noindexWooCommercePages(); |
| [99](#L99) | $this->accessControlNewCapabilities(); |
| [100](#L100) | } |
| [101](#L101) |  |
| [102](#L102) | if ( version\_compare( $lastActiveVersion, '4.1.3.3', '<' ) ) { |
| [103](#L103) | $this->accessControlNewCapabilities(); |
| [104](#L104) | } |
| [105](#L105) |  |
| [106](#L106) | if ( version\_compare( $lastActiveVersion, '4.1.4.3', '<' ) ) { |
| [107](#L107) | $this->migrateDynamicSettings(); |
| [108](#L108) | } |
| [109](#L109) |  |
| [110](#L110) | if ( version\_compare( $lastActiveVersion, '4.1.5', '<' ) ) { |
| [111](#L111) | aioseo()->actionScheduler->unschedule( 'aioseo\_cleanup\_action\_scheduler' ); |
| [112](#L112) | // Schedule routine to remove our old transients from the options table. |
| [113](#L113) | aioseo()->actionScheduler->scheduleSingle( aioseo()->core->cachePrune->getOptionCacheCleanAction(), MINUTE\_IN\_SECONDS ); |
| [114](#L114) |  |
| [115](#L115) | // Refresh with new Redirects capability. |
| [116](#L116) | $this->accessControlNewCapabilities(); |
| [117](#L117) |  |
| [118](#L118) | // Regenerate the sitemap if using a static one to update the data for the new stylesheets. |
| [119](#L119) | aioseo()->sitemap->regenerateStaticSitemap(); |
| [120](#L120) |  |
| [121](#L121) | $this->fixSchemaTypeDefault(); |
| [122](#L122) | } |
| [123](#L123) |  |
| [124](#L124) | if ( version\_compare( $lastActiveVersion, '4.1.6', '<' ) ) { |
| [125](#L125) | // Remove the recurring scheduled action for notifications. |
| [126](#L126) | aioseo()->actionScheduler->unschedule( 'aioseo\_admin\_notifications\_update' ); |
| [127](#L127) |  |
| [128](#L128) | $this->migrateOgTwitterImageColumns(); |
| [129](#L129) |  |
| [130](#L130) | // Set the OG data to false for current installs. |
| [131](#L131) | aioseo()->options->social->twitter->general->useOgData = false; |
| [132](#L132) | } |
| [133](#L133) |  |
| [134](#L134) | if ( version\_compare( $lastActiveVersion, '4.1.8', '<' ) ) { |
| [135](#L135) | $this->addLimitModifiedDateColumn(); |
| [136](#L136) |  |
| [137](#L137) | // Refresh with new Redirects Page capability. |
| [138](#L138) | $this->accessControlNewCapabilities(); |
| [139](#L139) | } |
| [140](#L140) |  |
| [141](#L141) | if ( version\_compare( $lastActiveVersion, '4.1.9', '<' ) ) { |
| [142](#L142) | $this->fixTaxonomyTags(); |
| [143](#L143) | $this->removeRevisionRecords(); |
| [144](#L144) | } |
| [145](#L145) |  |
| [146](#L146) | if ( version\_compare( $lastActiveVersion, '4.0.0', '>=' ) && version\_compare( $lastActiveVersion, '4.2.0', '<' ) ) { |
| [147](#L147) | $this->migrateDeprecatedRunShortcodesSetting(); |
| [148](#L148) | } |
| [149](#L149) |  |
| [150](#L150) | if ( version\_compare( $lastActiveVersion, '4.2.1', '<' ) ) { |
| [151](#L151) | // Force WordPress to flush the rewrite rules. |
| [152](#L152) | aioseo()->options->flushRewriteRules(); |
| [153](#L153) |  |
| [154](#L154) | Models\Notification::deleteNotificationByName( 'deprecated-filters' ); |
| [155](#L155) | Models\Notification::deleteNotificationByName( 'deprecated-filters-v2' ); |
| [156](#L156) | } |
| [157](#L157) |  |
| [158](#L158) | if ( version\_compare( $lastActiveVersion, '4.2.2', '<' ) ) { |
| [159](#L159) | aioseo()->internalOptions->database->installedTables = ''; |
| [160](#L160) |  |
| [161](#L161) | $this->addOptionsColumn(); |
| [162](#L162) | $this->removeTabsColumn(); |
| [163](#L163) | $this->migrateUserContactMethods(); |
| [164](#L164) |  |
| [165](#L165) | // Unschedule any static sitemap regeneration actions to remove any that failed and are still in-progress as a result. |
| [166](#L166) | aioseo()->actionScheduler->unschedule( 'aioseo\_static\_sitemap\_regeneration' ); |
| [167](#L167) | } |
| [168](#L168) |  |
| [169](#L169) | if ( version\_compare( $lastActiveVersion, '4.2.4', '<' ) ) { |
| [170](#L170) | $this->migrateContactTypes(); |
| [171](#L171) | $this->addNotificationsAddonColumn(); |
| [172](#L172) | } |
| [173](#L173) |  |
| [174](#L174) | if ( version\_compare( $lastActiveVersion, '4.2.5', '<' ) ) { |
| [175](#L175) | $this->addSchemaColumn(); |
| [176](#L176) | $this->schedulePostSchemaMigration(); |
| [177](#L177) | } |
| [178](#L178) |  |
| [179](#L179) | if ( version\_compare( $lastActiveVersion, '4.2.4.2', '>' ) && version\_compare( $lastActiveVersion, '4.2.6', '<' ) ) { |
| [180](#L180) | // The default graphs only need to be remigrated if the user was on 4.2.5 or 4.2.5.1. |
| [181](#L181) | $this->schedulePostSchemaDefaultMigration(); |
| [182](#L182) | } |
| [183](#L183) |  |
| [184](#L184) | if ( version\_compare( $lastActiveVersion, '4.2.8', '<' ) ) { |
| [185](#L185) | $this->migrateDashboardWidgetsOptions(); |
| [186](#L186) | } |
| [187](#L187) |  |
| [188](#L188) | do\_action( 'aioseo\_run\_updates', $lastActiveVersion ); |
| [189](#L189) |  |
| [190](#L190) | // Always clear the cache if the last active version is different from our current. |
| [191](#L191) | if ( version\_compare( $lastActiveVersion, AIOSEO\_VERSION, '<' ) ) { |
| [192](#L192) | aioseo()->core->cache->clear(); |
| [193](#L193) | } |
| [194](#L194) | } |
| [195](#L195) |  |
| [196](#L196) | /\*\* |
| [197](#L197) | \* Retrieve the raw options from the database for migration. |
| [198](#L198) | \* |
| [199](#L199) | \* @since 4.1.4 |
| [200](#L200) | \* |
| [201](#L201) | \* @return array An array of options. |
| [202](#L202) | \*/ |
| [203](#L203) | private function getRawOptions() { |
| [204](#L204) | // Options from the DB. |
| [205](#L205) | $commonOptions = json\_decode( get\_option( aioseo()->options->optionsName ), true ); |
| [206](#L206) | if ( empty( $commonOptions ) ) { |
| [207](#L207) | $commonOptions = []; |
| [208](#L208) | } |
| [209](#L209) |  |
| [210](#L210) | return $commonOptions; |
| [211](#L211) | } |
| [212](#L212) |  |
| [213](#L213) | /\*\* |
| [214](#L214) | \* Updates the latest version after all migrations and updates have run. |
| [215](#L215) | \* |
| [216](#L216) | \* @since 4.0.3 |
| [217](#L217) | \* |
| [218](#L218) | \* @return void |
| [219](#L219) | \*/ |
| [220](#L220) | public function updateLatestVersion() { |
| [221](#L221) | if ( aioseo()->internalOptions->internal->lastActiveVersion === aioseo()->version ) { |
| [222](#L222) | return; |
| [223](#L223) | } |
| [224](#L224) |  |
| [225](#L225) | aioseo()->internalOptions->internal->lastActiveVersion = aioseo()->version; |
| [226](#L226) |  |
| [227](#L227) | // Bust the tableExists and columnExists cache. |
| [228](#L228) | aioseo()->internalOptions->database->installedTables = ''; |
| [229](#L229) |  |
| [230](#L230) | // Bust the DB cache so we can make sure that everything is fresh. |
| [231](#L231) | aioseo()->core->db->bustCache(); |
| [232](#L232) | } |
| [233](#L233) |  |
| [234](#L234) | /\*\* |
| [235](#L235) | \* Adds our custom tables for V4. |
| [236](#L236) | \* |
| [237](#L237) | \* @since 4.0.0 |
| [238](#L238) | \* |
| [239](#L239) | \* @return void |
| [240](#L240) | \*/ |
| [241](#L241) | public function addInitialCustomTablesForV4() { |
| [242](#L242) | $db             = aioseo()->core->db->db; |
| [243](#L243) | $charsetCollate = ''; |
| [244](#L244) |  |
| [245](#L245) | if ( ! empty( $db->charset ) ) { |
| [246](#L246) | $charsetCollate .= "DEFAULT CHARACTER SET {$db->charset}"; |
| [247](#L247) | } |
| [248](#L248) | if ( ! empty( $db->collate ) ) { |
| [249](#L249) | $charsetCollate .= " COLLATE {$db->collate}"; |
| [250](#L250) | } |
| [251](#L251) |  |
| [252](#L252) | // Check for notifications table. |
| [253](#L253) | if ( ! aioseo()->core->db->tableExists( 'aioseo\_notifications' ) ) { |
| [254](#L254) | $tableName = $db->prefix . 'aioseo\_notifications'; |
| [255](#L255) |  |
| [256](#L256) | aioseo()->core->db->execute( |
| [257](#L257) | "CREATE TABLE {$tableName} ( |
| [258](#L258) | id bigint(20) unsigned NOT NULL AUTO\_INCREMENT, |
| [259](#L259) | slug varchar(13) NOT NULL, |
| [260](#L260) | title text NOT NULL, |
| [261](#L261) | content longtext NOT NULL, |
| [262](#L262) | type varchar(64) NOT NULL, |
| [263](#L263) | level text NOT NULL, |
| [264](#L264) | notification\_id bigint(20) unsigned DEFAULT NULL, |
| [265](#L265) | notification\_name varchar(255) DEFAULT NULL, |
| [266](#L266) | start datetime DEFAULT NULL, |
| [267](#L267) | end datetime DEFAULT NULL, |
| [268](#L268) | button1\_label varchar(255) DEFAULT NULL, |
| [269](#L269) | button1\_action varchar(255) DEFAULT NULL, |
| [270](#L270) | button2\_label varchar(255) DEFAULT NULL, |
| [271](#L271) | button2\_action varchar(255) DEFAULT NULL, |
| [272](#L272) | dismissed tinyint(1) NOT NULL DEFAULT 0, |
| [273](#L273) | created datetime NOT NULL, |
| [274](#L274) | updated datetime NOT NULL, |
| [275](#L275) | PRIMARY KEY (id), |
| [276](#L276) | UNIQUE KEY ndx\_aioseo\_notifications\_slug (slug), |
| [277](#L277) | KEY ndx\_aioseo\_notifications\_dates (start, end), |
| [278](#L278) | KEY ndx\_aioseo\_notifications\_type (type), |
| [279](#L279) | KEY ndx\_aioseo\_notifications\_dismissed (dismissed) |
| [280](#L280) | ) {$charsetCollate};" |
| [281](#L281) | ); |
| [282](#L282) | } |
| [283](#L283) |  |
| [284](#L284) | if ( ! aioseo()->core->db->tableExists( 'aioseo\_posts' ) ) { |
| [285](#L285) | $tableName = $db->prefix . 'aioseo\_posts'; |
| [286](#L286) |  |
| [287](#L287) | // Incorrect defaults are adjusted below through migrations. |
| [288](#L288) | aioseo()->core->db->execute( |
| [289](#L289) | "CREATE TABLE {$tableName} ( |
| [290](#L290) | id bigint(20) unsigned NOT NULL AUTO\_INCREMENT, |
| [291](#L291) | post\_id bigint(20) unsigned NOT NULL, |
| [292](#L292) | title text DEFAULT NULL, |
| [293](#L293) | description text DEFAULT NULL, |
| [294](#L294) | keywords mediumtext DEFAULT NULL, |
| [295](#L295) | keyphrases longtext DEFAULT NULL, |
| [296](#L296) | page\_analysis longtext DEFAULT NULL, |
| [297](#L297) | canonical\_url text DEFAULT NULL, |
| [298](#L298) | og\_title text DEFAULT NULL, |
| [299](#L299) | og\_description text DEFAULT NULL, |
| [300](#L300) | og\_object\_type varchar(64) DEFAULT 'default', |
| [301](#L301) | og\_image\_type varchar(64) DEFAULT 'default', |
| [302](#L302) | og\_image\_custom\_url text DEFAULT NULL, |
| [303](#L303) | og\_image\_custom\_fields text DEFAULT NULL, |
| [304](#L304) | og\_custom\_image\_width int(11) DEFAULT NULL, |
| [305](#L305) | og\_custom\_image\_height int(11) DEFAULT NULL, |
| [306](#L306) | og\_video varchar(255) DEFAULT NULL, |
| [307](#L307) | og\_custom\_url text DEFAULT NULL, |
| [308](#L308) | og\_article\_section text DEFAULT NULL, |
| [309](#L309) | og\_article\_tags text DEFAULT NULL, |
| [310](#L310) | twitter\_use\_og tinyint(1) DEFAULT 1, |
| [311](#L311) | twitter\_card varchar(64) DEFAULT 'default', |
| [312](#L312) | twitter\_image\_type varchar(64) DEFAULT 'default', |
| [313](#L313) | twitter\_image\_custom\_url text DEFAULT NULL, |
| [314](#L314) | twitter\_image\_custom\_fields text DEFAULT NULL, |
| [315](#L315) | twitter\_title text DEFAULT NULL, |
| [316](#L316) | twitter\_description text DEFAULT NULL, |
| [317](#L317) | seo\_score int(11) DEFAULT 0 NOT NULL, |
| [318](#L318) | schema\_type varchar(20) DEFAULT NULL, |
| [319](#L319) | schema\_type\_options longtext DEFAULT NULL, |
| [320](#L320) | pillar\_content tinyint(1) DEFAULT NULL, |
| [321](#L321) | robots\_default tinyint(1) DEFAULT 1 NOT NULL, |
| [322](#L322) | robots\_noindex tinyint(1) DEFAULT 0 NOT NULL, |
| [323](#L323) | robots\_noarchive tinyint(1) DEFAULT 0 NOT NULL, |
| [324](#L324) | robots\_nosnippet tinyint(1) DEFAULT 0 NOT NULL, |
| [325](#L325) | robots\_nofollow tinyint(1) DEFAULT 0 NOT NULL, |
| [326](#L326) | robots\_noimageindex tinyint(1) DEFAULT 0 NOT NULL, |
| [327](#L327) | robots\_noodp tinyint(1) DEFAULT 0 NOT NULL, |
| [328](#L328) | robots\_notranslate tinyint(1) DEFAULT 0 NOT NULL, |
| [329](#L329) | robots\_max\_snippet int(11) DEFAULT NULL, |
| [330](#L330) | robots\_max\_videopreview int(11) DEFAULT NULL, |
| [331](#L331) | robots\_max\_imagepreview varchar(20) DEFAULT 'none', |
| [332](#L332) | tabs mediumtext DEFAULT NULL, |
| [333](#L333) | images longtext DEFAULT NULL, |
| [334](#L334) | priority tinytext DEFAULT NULL, |
| [335](#L335) | frequency tinytext DEFAULT NULL, |
| [336](#L336) | videos longtext DEFAULT NULL, |
| [337](#L337) | video\_thumbnail text DEFAULT NULL, |
| [338](#L338) | video\_scan\_date datetime DEFAULT NULL, |
| [339](#L339) | local\_seo longtext DEFAULT NULL, |
| [340](#L340) | created datetime NOT NULL, |
| [341](#L341) | updated datetime NOT NULL, |
| [342](#L342) | PRIMARY KEY (id), |
| [343](#L343) | KEY ndx\_aioseo\_posts\_post\_id (post\_id) |
| [344](#L344) | ) {$charsetCollate};" |
| [345](#L345) | ); |
| [346](#L346) | } |
| [347](#L347) |  |
| [348](#L348) | // Reset the cache for the installed tables. |
| [349](#L349) | aioseo()->internalOptions->database->installedTables = ''; |
| [350](#L350) | } |
| [351](#L351) |  |
| [352](#L352) | /\*\* |
| [353](#L353) | \* Sets the default social images. |
| [354](#L354) | \* |
| [355](#L355) | \* @since 4.0.0 |
| [356](#L356) | \* |
| [357](#L357) | \* @return void |
| [358](#L358) | \*/ |
| [359](#L359) | public function setDefaultSocialImages() { |
| [360](#L360) | $siteLogo = aioseo()->helpers->getSiteLogoUrl(); |
| [361](#L361) | if ( $siteLogo && ! aioseo()->internalOptions->internal->migratedVersion ) { |
| [362](#L362) | if ( ! aioseo()->options->social->facebook->general->defaultImagePosts ) { |
| [363](#L363) | aioseo()->options->social->facebook->general->defaultImagePosts = $siteLogo; |
| [364](#L364) | } |
| [365](#L365) | if ( ! aioseo()->options->social->twitter->general->defaultImagePosts ) { |
| [366](#L366) | aioseo()->options->social->twitter->general->defaultImagePosts = $siteLogo; |
| [367](#L367) | } |
| [368](#L368) | } |
| [369](#L369) | } |
| [370](#L370) |  |
| [371](#L371) | /\*\* |
| [372](#L372) | \* Adds the image scan date column to our posts table. |
| [373](#L373) | \* |
| [374](#L374) | \* @since 4.0.5 |
| [375](#L375) | \* |
| [376](#L376) | \* @return void |
| [377](#L377) | \*/ |
| [378](#L378) | public function addImageScanDateColumn() { |
| [379](#L379) | if ( ! aioseo()->core->db->columnExists( 'aioseo\_posts', 'image\_scan\_date' ) ) { |
| [380](#L380) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [381](#L381) | aioseo()->core->db->execute( |
| [382](#L382) | "ALTER TABLE {$tableName} |
| [383](#L383) | ADD image\_scan\_date datetime DEFAULT NULL AFTER images" |
| [384](#L384) | ); |
| [385](#L385) |  |
| [386](#L386) | // Reset the cache for the installed tables. |
| [387](#L387) | aioseo()->internalOptions->database->installedTables = ''; |
| [388](#L388) | } |
| [389](#L389) | } |
| [390](#L390) |  |
| [391](#L391) | /\*\* |
| [392](#L392) | \* Modifes the default value of the twitter\_use\_og column. |
| [393](#L393) | \* |
| [394](#L394) | \* @since 4.0.6 |
| [395](#L395) | \* |
| [396](#L396) | \* @return void |
| [397](#L397) | \*/ |
| [398](#L398) | protected function disableTwitterUseOgDefault() { |
| [399](#L399) | if ( aioseo()->core->db->tableExists( 'aioseo\_posts' ) ) { |
| [400](#L400) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [401](#L401) | aioseo()->core->db->execute( |
| [402](#L402) | "ALTER TABLE {$tableName} |
| [403](#L403) | MODIFY twitter\_use\_og tinyint(1) DEFAULT 0" |
| [404](#L404) | ); |
| [405](#L405) | } |
| [406](#L406) | } |
| [407](#L407) |  |
| [408](#L408) | /\*\* |
| [409](#L409) | \* Modifes the default value of the robots\_max\_imagepreview column. |
| [410](#L410) | \* |
| [411](#L411) | \* @since 4.0.6 |
| [412](#L412) | \* |
| [413](#L413) | \* @return void |
| [414](#L414) | \*/ |
| [415](#L415) | protected function updateMaxImagePreviewDefault() { |
| [416](#L416) | if ( aioseo()->core->db->tableExists( 'aioseo\_posts' ) ) { |
| [417](#L417) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [418](#L418) | aioseo()->core->db->execute( |
| [419](#L419) | "ALTER TABLE {$tableName} |
| [420](#L420) | MODIFY robots\_max\_imagepreview varchar(20) DEFAULT 'large'" |
| [421](#L421) | ); |
| [422](#L422) | } |
| [423](#L423) | } |
| [424](#L424) |  |
| [425](#L425) | /\*\* |
| [426](#L426) | \* Deletes duplicate records in our custom tables. |
| [427](#L427) | \* |
| [428](#L428) | \* @since 4.0.13 |
| [429](#L429) | \* |
| [430](#L430) | \* @return void |
| [431](#L431) | \*/ |
| [432](#L432) | public function removeDuplicateRecords() { |
| [433](#L433) | $duplicates = aioseo()->core->db->start( 'aioseo\_posts' ) |
| [434](#L434) | ->select( 'post\_id, min(id) as id' ) |
| [435](#L435) | ->groupBy( 'post\_id having count(post\_id) > 1' ) |
| [436](#L436) | ->orderBy( 'count(post\_id) DESC' ) |
| [437](#L437) | ->run() |
| [438](#L438) | ->result(); |
| [439](#L439) |  |
| [440](#L440) | if ( empty( $duplicates ) ) { |
| [441](#L441) | return; |
| [442](#L442) | } |
| [443](#L443) |  |
| [444](#L444) | foreach ( $duplicates as $duplicate ) { |
| [445](#L445) | $postId        = $duplicate->post\_id; |
| [446](#L446) | $firstRecordId = $duplicate->id; |
| [447](#L447) |  |
| [448](#L448) | aioseo()->core->db->delete( 'aioseo\_posts' ) |
| [449](#L449) | ->whereRaw( "( id > $firstRecordId AND post\_id = $postId )" ) |
| [450](#L450) | ->run(); |
| [451](#L451) | } |
| [452](#L452) | } |
| [453](#L453) |  |
| [454](#L454) | /\*\* |
| [455](#L455) | \* Removes the location column. |
| [456](#L456) | \* |
| [457](#L457) | \* @since 4.0.17 |
| [458](#L458) | \* |
| [459](#L459) | \* @return void |
| [460](#L460) | \*/ |
| [461](#L461) | public function removeLocationColumn() { |
| [462](#L462) | if ( aioseo()->core->db->columnExists( 'aioseo\_posts', 'location' ) ) { |
| [463](#L463) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [464](#L464) | aioseo()->core->db->execute( |
| [465](#L465) | "ALTER TABLE {$tableName} |
| [466](#L466) | DROP location" |
| [467](#L467) | ); |
| [468](#L468) | } |
| [469](#L469) | } |
| [470](#L470) |  |
| [471](#L471) | /\*\* |
| [472](#L472) | \* Clears the image data for WooCommerce Products so that we scan them again and include product gallery images. |
| [473](#L473) | \* |
| [474](#L474) | \* @since 4.1.2 |
| [475](#L475) | \* |
| [476](#L476) | \* @return void |
| [477](#L477) | \*/ |
| [478](#L478) | public function clearProductImages() { |
| [479](#L479) | if ( ! aioseo()->helpers->isWooCommerceActive() ) { |
| [480](#L480) | return; |
| [481](#L481) | } |
| [482](#L482) |  |
| [483](#L483) | aioseo()->core->db->update( 'aioseo\_posts as ap' ) |
| [484](#L484) | ->join( 'posts as p', 'ap.post\_id = p.ID' ) |
| [485](#L485) | ->where( 'p.post\_type', 'product' ) |
| [486](#L486) | ->set( |
| [487](#L487) | [ |
| [488](#L488) | 'images'          => null, |
| [489](#L489) | 'image\_scan\_date' => null |
| [490](#L490) | ] |
| [491](#L491) | ) |
| [492](#L492) | ->run(); |
| [493](#L493) | } |
| [494](#L494) |  |
| [495](#L495) | /\*\* |
| [496](#L496) | \* Adds the new flag to the notifications table. |
| [497](#L497) | \* |
| [498](#L498) | \* @since 4.1.3 |
| [499](#L499) | \* |
| [500](#L500) | \* @return void |
| [501](#L501) | \*/ |
| [502](#L502) | public function addNotificationsNewColumn() { |
| [503](#L503) | if ( ! aioseo()->core->db->columnExists( 'aioseo\_notifications', 'new' ) ) { |
| [504](#L504) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_notifications'; |
| [505](#L505) | aioseo()->core->db->execute( |
| [506](#L506) | "ALTER TABLE {$tableName} |
| [507](#L507) | ADD new tinyint(1) NOT NULL DEFAULT 1 AFTER dismissed" |
| [508](#L508) | ); |
| [509](#L509) |  |
| [510](#L510) | // Reset the cache for the installed tables. |
| [511](#L511) | aioseo()->internalOptions->database->installedTables = ''; |
| [512](#L512) |  |
| [513](#L513) | aioseo()->core->db |
| [514](#L514) | ->update( 'aioseo\_notifications' ) |
| [515](#L515) | ->where( 'new', 1 ) |
| [516](#L516) | ->set( 'new', 0 ) |
| [517](#L517) | ->run(); |
| [518](#L518) | } |
| [519](#L519) | } |
| [520](#L520) |  |
| [521](#L521) | /\*\* |
| [522](#L522) | \* Noindexes the WooCommerce cart, checkout and account pages. |
| [523](#L523) | \* |
| [524](#L524) | \* @since 4.1.3 |
| [525](#L525) | \* |
| [526](#L526) | \* @return void |
| [527](#L527) | \*/ |
| [528](#L528) | public function noindexWooCommercePages() { |
| [529](#L529) | if ( ! aioseo()->helpers->isWooCommerceActive() ) { |
| [530](#L530) | return; |
| [531](#L531) | } |
| [532](#L532) |  |
| [533](#L533) | $cartId     = (int) get\_option( 'woocommerce\_cart\_page\_id' ); |
| [534](#L534) | $checkoutId = (int) get\_option( 'woocommerce\_checkout\_page\_id' ); |
| [535](#L535) | $accountId  = (int) get\_option( 'woocommerce\_myaccount\_page\_id' ); |
| [536](#L536) |  |
| [537](#L537) | $cartPage     = Models\Post::getPost( $cartId ); |
| [538](#L538) | $checkoutPage = Models\Post::getPost( $checkoutId ); |
| [539](#L539) | $accountPage  = Models\Post::getPost( $accountId ); |
| [540](#L540) |  |
| [541](#L541) | $newMeta = [ |
| [542](#L542) | 'robots\_default' => false, |
| [543](#L543) | 'robots\_noindex' => true |
| [544](#L544) | ]; |
| [545](#L545) |  |
| [546](#L546) | if ( $cartPage->exists() ) { |
| [547](#L547) | $cartPage->set( $newMeta ); |
| [548](#L548) | $cartPage->save(); |
| [549](#L549) | } |
| [550](#L550) | if ( $checkoutPage->exists() ) { |
| [551](#L551) | $checkoutPage->set( $newMeta ); |
| [552](#L552) | $checkoutPage->save(); |
| [553](#L553) | } |
| [554](#L554) | if ( $accountPage->exists() ) { |
| [555](#L555) | $accountPage->set( $newMeta ); |
| [556](#L556) | $accountPage->save(); |
| [557](#L557) | } |
| [558](#L558) | } |
| [559](#L559) |  |
| [560](#L560) | /\*\* |
| [561](#L561) | \* Adds the new capabilities for all the roles. |
| [562](#L562) | \* |
| [563](#L563) | \* @since 4.1.3 |
| [564](#L564) | \* |
| [565](#L565) | \* @return void |
| [566](#L566) | \*/ |
| [567](#L567) | protected function accessControlNewCapabilities() { |
| [568](#L568) | aioseo()->access->addCapabilities(); |
| [569](#L569) | } |
| [570](#L570) |  |
| [571](#L571) | /\*\* |
| [572](#L572) | \* Migrate dynamic settings to a separate options structure. |
| [573](#L573) | \* |
| [574](#L574) | \* @since 4.1.4 |
| [575](#L575) | \* |
| [576](#L576) | \* @return void |
| [577](#L577) | \*/ |
| [578](#L578) | protected function migrateDynamicSettings() { |
| [579](#L579) | $rawOptions = $this->getRawOptions(); |
| [580](#L580) | $options    = aioseo()->dynamicOptions->noConflict(); |
| [581](#L581) |  |
| [582](#L582) | // Sitemap post type priorities/frequencies. |
| [583](#L583) | if ( |
| [584](#L584) | ! empty( $rawOptions['sitemap']['dynamic']['priority']['postTypes'] ) |
| [585](#L585) | ) { |
| [586](#L586) | foreach ( $rawOptions['sitemap']['dynamic']['priority']['postTypes'] as $postTypeName => $data ) { |
| [587](#L587) | if ( $options->sitemap->priority->postTypes->has( $postTypeName ) ) { |
| [588](#L588) | $options->sitemap->priority->postTypes->$postTypeName->priority  = $data['priority']; |
| [589](#L589) | $options->sitemap->priority->postTypes->$postTypeName->frequency = $data['frequency']; |
| [590](#L590) | } |
| [591](#L591) | } |
| [592](#L592) | } |
| [593](#L593) |  |
| [594](#L594) | // Sitemap taxonomy priorities/frequencies. |
| [595](#L595) | if ( |
| [596](#L596) | ! empty( $rawOptions['sitemap']['dynamic']['priority']['taxonomies'] ) |
| [597](#L597) | ) { |
| [598](#L598) | foreach ( $rawOptions['sitemap']['dynamic']['priority']['taxonomies'] as $taxonomyName => $data ) { |
| [599](#L599) | if ( $options->sitemap->priority->taxonomies->has( $taxonomyName ) ) { |
| [600](#L600) | $options->sitemap->priority->taxonomies->$taxonomyName->priority  = $data['priority']; |
| [601](#L601) | $options->sitemap->priority->taxonomies->$taxonomyName->frequency = $data['frequency']; |
| [602](#L602) | } |
| [603](#L603) | } |
| [604](#L604) | } |
| [605](#L605) |  |
| [606](#L606) | // Facebook post type object types. |
| [607](#L607) | if ( |
| [608](#L608) | ! empty( $rawOptions['social']['facebook']['general']['dynamic']['postTypes'] ) |
| [609](#L609) | ) { |
| [610](#L610) | foreach ( $rawOptions['social']['facebook']['general']['dynamic']['postTypes'] as $postTypeName => $data ) { |
| [611](#L611) | if ( $options->social->facebook->general->postTypes->has( $postTypeName ) ) { |
| [612](#L612) | $options->social->facebook->general->postTypes->$postTypeName->objectType = $data['objectType']; |
| [613](#L613) | } |
| [614](#L614) | } |
| [615](#L615) | } |
| [616](#L616) |  |
| [617](#L617) | // Search appearance post type data. |
| [618](#L618) | if ( |
| [619](#L619) | ! empty( $rawOptions['searchAppearance']['dynamic']['postTypes'] ) |
| [620](#L620) | ) { |
| [621](#L621) | foreach ( $rawOptions['searchAppearance']['dynamic']['postTypes'] as $postTypeName => $data ) { |
| [622](#L622) | if ( $options->searchAppearance->postTypes->has( $postTypeName ) ) { |
| [623](#L623) | $options->searchAppearance->postTypes->$postTypeName->show            = $data['show']; |
| [624](#L624) | $options->searchAppearance->postTypes->$postTypeName->title           = $data['title']; |
| [625](#L625) | $options->searchAppearance->postTypes->$postTypeName->metaDescription = $data['metaDescription']; |
| [626](#L626) | $options->searchAppearance->postTypes->$postTypeName->schemaType      = $data['schemaType']; |
| [627](#L627) | $options->searchAppearance->postTypes->$postTypeName->webPageType     = $data['webPageType']; |
| [628](#L628) | $options->searchAppearance->postTypes->$postTypeName->articleType     = $data['articleType']; |
| [629](#L629) | $options->searchAppearance->postTypes->$postTypeName->customFields    = $data['customFields']; |
| [630](#L630) |  |
| [631](#L631) | // Advanced settings. |
| [632](#L632) | $advanced = ! empty( $data['advanced']['robotsMeta'] ) ? $data['advanced']['robotsMeta'] : null; |
| [633](#L633) | if ( ! empty( $advanced ) ) { |
| [634](#L634) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->default         = $data['advanced']['robotsMeta']['default']; |
| [635](#L635) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->noindex         = $data['advanced']['robotsMeta']['noindex']; |
| [636](#L636) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->nofollow        = $data['advanced']['robotsMeta']['nofollow']; |
| [637](#L637) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->noarchive       = $data['advanced']['robotsMeta']['noarchive']; |
| [638](#L638) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->noimageindex    = $data['advanced']['robotsMeta']['noimageindex']; |
| [639](#L639) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->notranslate     = $data['advanced']['robotsMeta']['notranslate']; |
| [640](#L640) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->nosnippet       = $data['advanced']['robotsMeta']['nosnippet']; |
| [641](#L641) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->noodp           = $data['advanced']['robotsMeta']['noodp']; |
| [642](#L642) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->maxSnippet      = $data['advanced']['robotsMeta']['maxSnippet']; |
| [643](#L643) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->maxVideoPreview = $data['advanced']['robotsMeta']['maxVideoPreview']; |
| [644](#L644) | $options->searchAppearance->postTypes->$postTypeName->advanced->robotsMeta->maxImagePreview = $data['advanced']['robotsMeta']['maxImagePreview']; |
| [645](#L645) | $options->searchAppearance->postTypes->$postTypeName->advanced->showDateInGooglePreview     = $data['advanced']['showDateInGooglePreview']; |
| [646](#L646) | $options->searchAppearance->postTypes->$postTypeName->advanced->showPostThumbnailInSearch   = $data['advanced']['showPostThumbnailInSearch']; |
| [647](#L647) | $options->searchAppearance->postTypes->$postTypeName->advanced->showMetaBox                 = $data['advanced']['showMetaBox']; |
| [648](#L648) | $options->searchAppearance->postTypes->$postTypeName->advanced->bulkEditing                 = $data['advanced']['bulkEditing']; |
| [649](#L649) | } |
| [650](#L650) |  |
| [651](#L651) | if ( 'attachment' === $postTypeName ) { |
| [652](#L652) | $options->searchAppearance->postTypes->$postTypeName->redirectAttachmentUrls = $data['redirectAttachmentUrls']; |
| [653](#L653) | } |
| [654](#L654) | } |
| [655](#L655) | } |
| [656](#L656) | } |
| [657](#L657) |  |
| [658](#L658) | // Search appearance taxonomy data. |
| [659](#L659) | if ( |
| [660](#L660) | ! empty( $rawOptions['searchAppearance']['dynamic']['taxonomies'] ) |
| [661](#L661) | ) { |
| [662](#L662) | foreach ( $rawOptions['searchAppearance']['dynamic']['taxonomies'] as $taxonomyName => $data ) { |
| [663](#L663) | if ( $options->searchAppearance->taxonomies->has( $taxonomyName ) ) { |
| [664](#L664) | $options->searchAppearance->taxonomies->$taxonomyName->show            = $data['show']; |
| [665](#L665) | $options->searchAppearance->taxonomies->$taxonomyName->title           = $data['title']; |
| [666](#L666) | $options->searchAppearance->taxonomies->$taxonomyName->metaDescription = $data['metaDescription']; |
| [667](#L667) |  |
| [668](#L668) | // Advanced settings. |
| [669](#L669) | $advanced = ! empty( $data['advanced']['robotsMeta'] ) ? $data['advanced']['robotsMeta'] : null; |
| [670](#L670) | if ( ! empty( $advanced ) ) { |
| [671](#L671) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->default         = $data['advanced']['robotsMeta']['default']; |
| [672](#L672) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->noindex         = $data['advanced']['robotsMeta']['noindex']; |
| [673](#L673) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->nofollow        = $data['advanced']['robotsMeta']['nofollow']; |
| [674](#L674) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->noarchive       = $data['advanced']['robotsMeta']['noarchive']; |
| [675](#L675) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->noimageindex    = $data['advanced']['robotsMeta']['noimageindex']; |
| [676](#L676) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->notranslate     = $data['advanced']['robotsMeta']['notranslate']; |
| [677](#L677) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->nosnippet       = $data['advanced']['robotsMeta']['nosnippet']; |
| [678](#L678) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->noodp           = $data['advanced']['robotsMeta']['noodp']; |
| [679](#L679) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->maxSnippet      = $data['advanced']['robotsMeta']['maxSnippet']; |
| [680](#L680) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->maxVideoPreview = $data['advanced']['robotsMeta']['maxVideoPreview']; |
| [681](#L681) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->robotsMeta->maxImagePreview = $data['advanced']['robotsMeta']['maxImagePreview']; |
| [682](#L682) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->showDateInGooglePreview     = $data['advanced']['showDateInGooglePreview']; |
| [683](#L683) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->showPostThumbnailInSearch   = $data['advanced']['showPostThumbnailInSearch']; |
| [684](#L684) | $options->searchAppearance->taxonomies->$taxonomyName->advanced->showMetaBox                 = $data['advanced']['showMetaBox']; |
| [685](#L685) | } |
| [686](#L686) | } |
| [687](#L687) | } |
| [688](#L688) | } |
| [689](#L689) | } |
| [690](#L690) |  |
| [691](#L691) | /\*\* |
| [692](#L692) | \* Fixes the default value for the post schema type. |
| [693](#L693) | \* |
| [694](#L694) | \* @since 4.1.5 |
| [695](#L695) | \* |
| [696](#L696) | \* @return void |
| [697](#L697) | \*/ |
| [698](#L698) | private function fixSchemaTypeDefault() { |
| [699](#L699) | if ( aioseo()->core->db->tableExists( 'aioseo\_posts' ) && aioseo()->core->db->columnExists( 'aioseo\_posts', 'schema\_type' ) ) { |
| [700](#L700) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [701](#L701) | aioseo()->core->db->execute( |
| [702](#L702) | "ALTER TABLE {$tableName} |
| [703](#L703) | MODIFY schema\_type varchar(20) DEFAULT 'default'" |
| [704](#L704) | ); |
| [705](#L705) | } |
| [706](#L706) | } |
| [707](#L707) |  |
| [708](#L708) | /\*\* |
| [709](#L709) | \* Add in image with/height columns and image URL for caching. |
| [710](#L710) | \* |
| [711](#L711) | \* @since 4.1.6 |
| [712](#L712) | \* |
| [713](#L713) | \* @return void |
| [714](#L714) | \*/ |
| [715](#L715) | protected function migrateOgTwitterImageColumns() { |
| [716](#L716) | if ( aioseo()->core->db->tableExists( 'aioseo\_posts' ) ) { |
| [717](#L717) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [718](#L718) |  |
| [719](#L719) | // OG Columns. |
| [720](#L720) | if ( ! aioseo()->core->db->columnExists( 'aioseo\_posts', 'og\_image\_url' ) ) { |
| [721](#L721) | aioseo()->core->db->execute( |
| [722](#L722) | "ALTER TABLE {$tableName} ADD og\_image\_url text DEFAULT NULL AFTER og\_image\_type" |
| [723](#L723) | ); |
| [724](#L724) | } |
| [725](#L725) |  |
| [726](#L726) | if ( aioseo()->core->db->columnExists( 'aioseo\_posts', 'og\_custom\_image\_height' ) ) { |
| [727](#L727) | aioseo()->core->db->execute( |
| [728](#L728) | "ALTER TABLE {$tableName} CHANGE COLUMN og\_custom\_image\_height og\_image\_height int(11) DEFAULT NULL AFTER og\_image\_url" |
| [729](#L729) | ); |
| [730](#L730) | } elseif ( ! aioseo()->core->db->columnExists( 'aioseo\_posts', 'og\_image\_height' ) ) { |
| [731](#L731) | aioseo()->core->db->execute( |
| [732](#L732) | "ALTER TABLE {$tableName} ADD og\_image\_height int(11) DEFAULT NULL AFTER og\_image\_url" |
| [733](#L733) | ); |
| [734](#L734) | } |
| [735](#L735) |  |
| [736](#L736) | if ( aioseo()->core->db->columnExists( 'aioseo\_posts', 'og\_custom\_image\_width' ) ) { |
| [737](#L737) | aioseo()->core->db->execute( |
| [738](#L738) | "ALTER TABLE {$tableName} CHANGE COLUMN og\_custom\_image\_width og\_image\_width int(11) DEFAULT NULL AFTER og\_image\_url" |
| [739](#L739) | ); |
| [740](#L740) | } elseif ( ! aioseo()->core->db->columnExists( 'aioseo\_posts', 'og\_image\_width' ) ) { |
| [741](#L741) | aioseo()->core->db->execute( |
| [742](#L742) | "ALTER TABLE {$tableName} ADD og\_image\_width int(11) DEFAULT NULL AFTER og\_image\_url" |
| [743](#L743) | ); |
| [744](#L744) | } |
| [745](#L745) |  |
| [746](#L746) | // Twitter image url columnn. |
| [747](#L747) | if ( ! aioseo()->core->db->columnExists( 'aioseo\_posts', 'twitter\_image\_url' ) ) { |
| [748](#L748) | aioseo()->core->db->execute( |
| [749](#L749) | "ALTER TABLE {$tableName} ADD twitter\_image\_url text DEFAULT NULL AFTER twitter\_image\_type" |
| [750](#L750) | ); |
| [751](#L751) | } |
| [752](#L752) |  |
| [753](#L753) | // Reset the cache for the installed tables. |
| [754](#L754) | aioseo()->internalOptions->database->installedTables = ''; |
| [755](#L755) | } |
| [756](#L756) | } |
| [757](#L757) |  |
| [758](#L758) | /\*\* |
| [759](#L759) | \* Adds the limit modified date column to our posts table. |
| [760](#L760) | \* |
| [761](#L761) | \* @since 4.1.8 |
| [762](#L762) | \* |
| [763](#L763) | \* @return void |
| [764](#L764) | \*/ |
| [765](#L765) | private function addLimitModifiedDateColumn() { |
| [766](#L766) | if ( ! aioseo()->core->db->columnExists( 'aioseo\_posts', 'limit\_modified\_date' ) ) { |
| [767](#L767) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [768](#L768) | aioseo()->core->db->execute( |
| [769](#L769) | "ALTER TABLE {$tableName} |
| [770](#L770) | ADD limit\_modified\_date tinyint(1) NOT NULL DEFAULT 0 AFTER local\_seo" |
| [771](#L771) | ); |
| [772](#L772) |  |
| [773](#L773) | // Reset the cache for the installed tables. |
| [774](#L774) | aioseo()->internalOptions->database->installedTables = ''; |
| [775](#L775) | } |
| [776](#L776) | } |
| [777](#L777) |  |
| [778](#L778) | /\*\* |
| [779](#L779) | \* Fixes tags that should not be in the search appearance taxonomy options. |
| [780](#L780) | \* |
| [781](#L781) | \* @since 4.1.9 |
| [782](#L782) | \* |
| [783](#L783) | \* @return void |
| [784](#L784) | \*/ |
| [785](#L785) | protected function fixTaxonomyTags() { |
| [786](#L786) | $searchAppearanceTaxonomies = aioseo()->dynamicOptions->searchAppearance->taxonomies->all(); |
| [787](#L787) |  |
| [788](#L788) | $replaces = [ |
| [789](#L789) | '#breadcrumb\_separator' => '#separator\_sa', |
| [790](#L790) | '#breadcrumb\_'          => '#', |
| [791](#L791) | '#blog\_title'           => '#site\_title' |
| [792](#L792) | ]; |
| [793](#L793) |  |
| [794](#L794) | foreach ( $searchAppearanceTaxonomies as $taxonomy => $searchAppearanceTaxonomy ) { |
| [795](#L795) | aioseo()->dynamicOptions->searchAppearance->taxonomies->{$taxonomy}->title = str\_replace( |
| [796](#L796) | array\_keys( $replaces ), |
| [797](#L797) | array\_values( $replaces ), |
| [798](#L798) | $searchAppearanceTaxonomy['title'] |
| [799](#L799) | ); |
| [800](#L800) |  |
| [801](#L801) | aioseo()->dynamicOptions->searchAppearance->taxonomies->{$taxonomy}->metaDescription = str\_replace( |
| [802](#L802) | array\_keys( $replaces ), |
| [803](#L803) | array\_values( $replaces ), |
| [804](#L804) | $searchAppearanceTaxonomy['metaDescription'] |
| [805](#L805) | ); |
| [806](#L806) | } |
| [807](#L807) | } |
| [808](#L808) |  |
| [809](#L809) | /\*\* |
| [810](#L810) | \* Removes any AIOSEO Post records for revisions. |
| [811](#L811) | \* |
| [812](#L812) | \* @since 4.1.9 |
| [813](#L813) | \* |
| [814](#L814) | \* @return void |
| [815](#L815) | \*/ |
| [816](#L816) | private function removeRevisionRecords() { |
| [817](#L817) | $postsTableName       = aioseo()->core->db->prefix . 'posts'; |
| [818](#L818) | $aioseoPostsTableName = aioseo()->core->db->prefix . 'aioseo\_posts'; |
| [819](#L819) | aioseo()->core->db->execute( |
| [820](#L820) | "DELETE FROM `$aioseoPostsTableName` |
| [821](#L821) | WHERE `post\_id` IN ( |
| [822](#L822) | SELECT `ID` |
| [823](#L823) | FROM `$postsTableName` |
| [824](#L824) | WHERE `post\_parent` != 0 |
| [825](#L825) | AND `post\_type` = 'revision' |
| [826](#L826) | AND `post\_status` = 'inherit' |
| [827](#L827) | )" |
| [828](#L828) | ); |
| [829](#L829) | } |
| [830](#L830) |  |
| [831](#L831) | /\*\* |
| [832](#L832) | \* Enables the new shortcodes parsing setting if it was already enabled before as a deprecated setting. |
| [833](#L833) | \* |
| [834](#L834) | \* @since 4.2.0 |
| [835](#L835) | \* |
| [836](#L836) | \* @return void |
| [837](#L837) | \*/ |
| [838](#L838) | private function migrateDeprecatedRunShortcodesSetting() { |
| [839](#L839) | if ( |
| [840](#L840) | in\_array( 'runShortcodesInDescription', aioseo()->internalOptions->deprecatedOptions, true ) && |
| [841](#L841) | ! aioseo()->options->deprecated->searchAppearance->advanced->runShortcodesInDescription |
| [842](#L842) | ) { |
| [843](#L843) | return; |
| [844](#L844) | } |
| [845](#L845) |  |
| [846](#L846) | aioseo()->options->searchAppearance->advanced->runShortcodes = true; |
| [847](#L847) | } |
| [848](#L848) |  |
| [849](#L849) | /\*\* |
| [850](#L850) | \* Add options column. |
| [851](#L851) | \* |
| [852](#L852) | \* @since 4.2.2 |
| [853](#L853) | \* |
| [854](#L854) | \* @return void |
| [855](#L855) | \*/ |
| [856](#L856) | private function addOptionsColumn() { |
| [857](#L857) | if ( ! aioseo()->core->db->columnExists( 'aioseo\_posts', 'options' ) ) { |
| [858](#L858) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [859](#L859) | aioseo()->core->db->execute( |
| [860](#L860) | "ALTER TABLE {$tableName} |
| [861](#L861) | ADD `options` longtext DEFAULT NULL AFTER `limit\_modified\_date`" |
| [862](#L862) | ); |
| [863](#L863) |  |
| [864](#L864) | // Reset the cache for the installed tables. |
| [865](#L865) | aioseo()->internalOptions->database->installedTables = ''; |
| [866](#L866) | } |
| [867](#L867) | } |
| [868](#L868) |  |
| [869](#L869) | /\*\* |
| [870](#L870) | \* Remove the tabs column as it is unnecessary. |
| [871](#L871) | \* |
| [872](#L872) | \* @since 4.2.2 |
| [873](#L873) | \* |
| [874](#L874) | \* @return void |
| [875](#L875) | \*/ |
| [876](#L876) | protected function removeTabsColumn() { |
| [877](#L877) | if ( aioseo()->core->db->columnExists( 'aioseo\_posts', 'tabs' ) ) { |
| [878](#L878) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [879](#L879) | aioseo()->core->db->execute( |
| [880](#L880) | "ALTER TABLE {$tableName} |
| [881](#L881) | DROP tabs" |
| [882](#L882) | ); |
| [883](#L883) | } |
| [884](#L884) | } |
| [885](#L885) |  |
| [886](#L886) | /\*\* |
| [887](#L887) | \* Migrates the user contact methods to the new format. |
| [888](#L888) | \* |
| [889](#L889) | \* @since 4.2.2 |
| [890](#L890) | \* |
| [891](#L891) | \* @return void |
| [892](#L892) | \*/ |
| [893](#L893) | private function migrateUserContactMethods() { |
| [894](#L894) | $userMetaTableName = aioseo()->core->db->prefix . 'usermeta'; |
| [895](#L895) |  |
| [896](#L896) | aioseo()->core->db->execute( |
| [897](#L897) | "UPDATE `$userMetaTableName` |
| [898](#L898) | SET `meta\_key` = 'aioseo\_facebook\_page\_url' |
| [899](#L899) | WHERE `meta\_key` = 'aioseo\_facebook'" |
| [900](#L900) | ); |
| [901](#L901) |  |
| [902](#L902) | aioseo()->core->db->execute( |
| [903](#L903) | "UPDATE `$userMetaTableName` |
| [904](#L904) | SET `meta\_key` = 'aioseo\_twitter\_url' |
| [905](#L905) | WHERE `meta\_key` = 'aioseo\_twitter'" |
| [906](#L906) | ); |
| [907](#L907) | } |
| [908](#L908) |  |
| [909](#L909) | /\*\* |
| [910](#L910) | \* Migrates some older values in the Knowledge Panel contact type setting that were removed. |
| [911](#L911) | \* |
| [912](#L912) | \* @since 4.2.4 |
| [913](#L913) | \* |
| [914](#L914) | \* @return void |
| [915](#L915) | \*/ |
| [916](#L916) | public function migrateContactTypes() { |
| [917](#L917) | $oldValue          = aioseo()->options->searchAppearance->global->schema->contactType; |
| [918](#L918) | $oldValueLowerCase = strtolower( (string) $oldValue ); |
| [919](#L919) |  |
| [920](#L920) | // Return if there is no value set or manual input is being used. |
| [921](#L921) | if ( ! $oldValue || 'manual' === $oldValueLowerCase ) { |
| [922](#L922) | return; |
| [923](#L923) | } |
| [924](#L924) |  |
| [925](#L925) | switch ( $oldValueLowerCase ) { |
| [926](#L926) | case 'billing support': |
| [927](#L927) | case 'customer support': |
| [928](#L928) | case 'reservations': |
| [929](#L929) | case 'sales': |
| [930](#L930) | case 'technical support': |
| [931](#L931) | // If we still support the value, do nothing. |
| [932](#L932) | return; |
| [933](#L933) | default: |
| [934](#L934) | // Otherwise, migrate the existing value to the manual input field. |
| [935](#L935) | if ( 'bagage tracking' === $oldValueLowerCase ) { |
| [936](#L936) | // Let's also fix this old typo. |
| [937](#L937) | $oldValue = 'Baggage Tracking'; |
| [938](#L938) | } |
| [939](#L939) |  |
| [940](#L940) | aioseo()->options->searchAppearance->global->schema->contactType       = 'manual'; |
| [941](#L941) | aioseo()->options->searchAppearance->global->schema->contactTypeManual = $oldValue; |
| [942](#L942) | } |
| [943](#L943) | } |
| [944](#L944) |  |
| [945](#L945) | /\*\* |
| [946](#L946) | \* Add an addon column to the notifications table. |
| [947](#L947) | \* |
| [948](#L948) | \* @since 4.2.4 |
| [949](#L949) | \* |
| [950](#L950) | \* @return void |
| [951](#L951) | \*/ |
| [952](#L952) | private function addNotificationsAddonColumn() { |
| [953](#L953) | if ( ! aioseo()->core->db->columnExists( 'aioseo\_notifications', 'addon' ) ) { |
| [954](#L954) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_notifications'; |
| [955](#L955) | aioseo()->core->db->execute( |
| [956](#L956) | "ALTER TABLE {$tableName} |
| [957](#L957) | ADD `addon` varchar(64) DEFAULT NULL AFTER `slug`" |
| [958](#L958) | ); |
| [959](#L959) |  |
| [960](#L960) | // Reset the cache for the installed tables. |
| [961](#L961) | aioseo()->internalOptions->database->installedTables = ''; |
| [962](#L962) | } |
| [963](#L963) | } |
| [964](#L964) |  |
| [965](#L965) | /\*\* |
| [966](#L966) | \* Adds the schema column. |
| [967](#L967) | \* |
| [968](#L968) | \* @since 4.2.5 |
| [969](#L969) | \* |
| [970](#L970) | \* @return void |
| [971](#L971) | \*/ |
| [972](#L972) | private function addSchemaColumn() { |
| [973](#L973) | if ( ! aioseo()->core->db->columnExists( 'aioseo\_posts', 'schema' ) ) { |
| [974](#L974) | $tableName = aioseo()->core->db->db->prefix . 'aioseo\_posts'; |
| [975](#L975) | aioseo()->core->db->execute( |
| [976](#L976) | "ALTER TABLE {$tableName} |
| [977](#L977) | ADD `schema` longtext DEFAULT NULL AFTER `seo\_score`" |
| [978](#L978) | ); |
| [979](#L979) | } |
| [980](#L980) | } |
| [981](#L981) |  |
| [982](#L982) | /\*\* |
| [983](#L983) | \* Schedules the post schema migration. |
| [984](#L984) | \* |
| [985](#L985) | \* @since 4.2.5 |
| [986](#L986) | \* |
| [987](#L987) | \* @return void |
| [988](#L988) | \*/ |
| [989](#L989) | private function schedulePostSchemaMigration() { |
| [990](#L990) | aioseo()->actionScheduler->scheduleSingle( 'aioseo\_v4\_migrate\_post\_schema', 10 ); |
| [991](#L991) | } |
| [992](#L992) |  |
| [993](#L993) | /\*\* |
| [994](#L994) | \* Migrates then post schema to the new JSON column. |
| [995](#L995) | \* |
| [996](#L996) | \* @since 4.2.5 |
| [997](#L997) | \* |
| [998](#L998) | \* @return void |
| [999](#L999) | \*/ |
| [1000](#L1000) | public function migratePostSchema() { |
| [1001](#L1001) | $posts = aioseo()->core->db->start( 'aioseo\_posts' ) |
| [1002](#L1002) | ->select( '\*' ) |
| [1003](#L1003) | ->whereRaw( '`schema` IS NULL' ) |
| [1004](#L1004) | ->limit( 40 ) |
| [1005](#L1005) | ->run() |
| [1006](#L1006) | ->models( 'AIOSEO\\Plugin\\Common\\Models\\Post' ); |
| [1007](#L1007) |  |
| [1008](#L1008) | if ( empty( $posts ) ) { |
| [1009](#L1009) | return; |
| [1010](#L1010) | } |
| [1011](#L1011) |  |
| [1012](#L1012) | foreach ( $posts as $post ) { |
| [1013](#L1013) | $this->migratePostSchemaHelper( $post ); |
| [1014](#L1014) | } |
| [1015](#L1015) |  |
| [1016](#L1016) | // Once done, schedule the next action. |
| [1017](#L1017) | aioseo()->actionScheduler->scheduleSingle( 'aioseo\_v4\_migrate\_post\_schema', 30 ); |
| [1018](#L1018) | } |
| [1019](#L1019) |  |
| [1020](#L1020) | /\*\* |
| [1021](#L1021) | \* Schedules the post schema migration to fix the default graphs. |
| [1022](#L1022) | \* |
| [1023](#L1023) | \* @since 4.2.6 |
| [1024](#L1024) | \* |
| [1025](#L1025) | \* @return void |
| [1026](#L1026) | \*/ |
| [1027](#L1027) | private function schedulePostSchemaDefaultMigration() { |
| [1028](#L1028) | aioseo()->actionScheduler->scheduleSingle( 'aioseo\_v4\_migrate\_post\_schema\_default', 10 ); |
| [1029](#L1029) |  |
| [1030](#L1030) | if ( ! aioseo()->cache->get( 'v4\_migrate\_post\_schema\_default\_date' ) ) { |
| [1031](#L1031) | aioseo()->cache->update( 'v4\_migrate\_post\_schema\_default\_date', gmdate( 'Y-m-d H:i:s' ), 3 \* MONTH\_IN\_SECONDS ); |
| [1032](#L1032) | } |
| [1033](#L1033) | } |
| [1034](#L1034) |  |
| [1035](#L1035) | /\*\* |
| [1036](#L1036) | \* Updates the dashboardWidgets with the new array format. |
| [1037](#L1037) | \* |
| [1038](#L1038) | \* @since 4.2.8 |
| [1039](#L1039) | \* |
| [1040](#L1040) | \* @return void |
| [1041](#L1041) | \*/ |
| [1042](#L1042) | private function migrateDashboardWidgetsOptions() { |
| [1043](#L1043) | $rawOptions = $this->getRawOptions(); |
| [1044](#L1044) |  |
| [1045](#L1045) | if ( empty( $rawOptions ) || ! is\_bool( $rawOptions['advanced']['dashboardWidgets'] ) ) { |
| [1046](#L1046) | return; |
| [1047](#L1047) | } |
| [1048](#L1048) |  |
| [1049](#L1049) | $widgets = [ 'seoNews' ]; |
| [1050](#L1050) |  |
| [1051](#L1051) | // If the dashboardWidgets was activated, let's turn on the other widgets. |
| [1052](#L1052) | if ( $rawOptions['advanced']['dashboardWidgets'] ) { |
| [1053](#L1053) | $widgets[] = 'seoOverview'; |
| [1054](#L1054) | $widgets[] = 'seoSetup'; |
| [1055](#L1055) | } |
| [1056](#L1056) |  |
| [1057](#L1057) | aioseo()->options->advanced->dashboardWidgets = $widgets; |
| [1058](#L1058) | } |
| [1059](#L1059) |  |
| [1060](#L1060) | /\*\* |
| [1061](#L1061) | \* Migrates the post schema to the new JSON column again for posts using the default. |
| [1062](#L1062) | \* This is needed to fix an oversight because in 4.2.5 we didn't migrate any properties set to the default graph. |
| [1063](#L1063) | \* |
| [1064](#L1064) | \* @since 4.2.6 |
| [1065](#L1065) | \* |
| [1066](#L1066) | \* @return void |
| [1067](#L1067) | \*/ |
| [1068](#L1068) | public function migratePostSchemaDefault() { |
| [1069](#L1069) | $migrationStartDate = aioseo()->cache->get( 'v4\_migrate\_post\_schema\_default\_date' ); |
| [1070](#L1070) | if ( ! $migrationStartDate ) { |
| [1071](#L1071) | return; |
| [1072](#L1072) | } |
| [1073](#L1073) |  |
| [1074](#L1074) | $posts = aioseo()->core->db->start( 'aioseo\_posts' ) |
| [1075](#L1075) | ->select( '\*' ) |
| [1076](#L1076) | ->where( 'schema\_type =', 'default' ) |
| [1077](#L1077) | ->whereRaw( "updated < '$migrationStartDate'" ) |
| [1078](#L1078) | ->limit( 40 ) |
| [1079](#L1079) | ->run() |
| [1080](#L1080) | ->models( 'AIOSEO\\Plugin\\Common\\Models\\Post' ); |
| [1081](#L1081) |  |
| [1082](#L1082) | if ( empty( $posts ) ) { |
| [1083](#L1083) | aioseo()->cache->delete( 'v4\_migrate\_post\_schema\_default\_date' ); |
| [1084](#L1084) |  |
| [1085](#L1085) | return; |
| [1086](#L1086) | } |
| [1087](#L1087) |  |
| [1088](#L1088) | foreach ( $posts as $post ) { |
| [1089](#L1089) | $this->migratePostSchemaHelper( $post ); |
| [1090](#L1090) | } |
| [1091](#L1091) |  |
| [1092](#L1092) | // Once done, schedule the next action. |
| [1093](#L1093) | aioseo()->actionScheduler->scheduleSingle( 'aioseo\_v4\_migrate\_post\_schema\_default', 30 ); |
| [1094](#L1094) | } |
| [1095](#L1095) |  |
| [1096](#L1096) | /\*\* |
| [1097](#L1097) | \* Helper function for the schema migration. |
| [1098](#L1098) | \* |
| [1099](#L1099) | \* @since  4.2.5 |
| [1100](#L1100) | \* |
| [1101](#L1101) | \* @param  Post $aioseoPost The AIOSEO post object. |
| [1102](#L1102) | \* @return Post             The modified AIOSEO post object. |
| [1103](#L1103) | \*/ |
| [1104](#L1104) | public function migratePostSchemaHelper( $aioseoPost ) { |
| [1105](#L1105) | $post              = aioseo()->helpers->getPost( $aioseoPost->post\_id ); |
| [1106](#L1106) | $schemaType        = $aioseoPost->schema\_type; |
| [1107](#L1107) | $schemaTypeOptions = json\_decode( (string) $aioseoPost->schema\_type\_options ); |
| [1108](#L1108) | $schemaOptions     = Models\Post::getDefaultSchemaOptions( '', $post ); |
| [1109](#L1109) |  |
| [1110](#L1110) | if ( empty( $schemaTypeOptions ) ) { |
| [1111](#L1111) | $aioseoPost->schema = $schemaOptions; |
| [1112](#L1112) | $aioseoPost->save(); |
| [1113](#L1113) |  |
| [1114](#L1114) | return $aioseoPost; |
| [1115](#L1115) | } |
| [1116](#L1116) |  |
| [1117](#L1117) | // If the post is set to the default schema type, set the default for post type but then also get the properties. |
| [1118](#L1118) | $isDefault = 'default' === $schemaType; |
| [1119](#L1119) | if ( $isDefault ) { |
| [1120](#L1120) | $dynamicOptions = aioseo()->dynamicOptions->noConflict(); |
| [1121](#L1121) | if ( ! empty( $post->post\_type ) && $dynamicOptions->searchAppearance->postTypes->has( $post->post\_type ) ) { |
| [1122](#L1122) | $schemaOptions->default->graphName = $dynamicOptions->searchAppearance->postTypes->{$post->post\_type}->schemaType; |
| [1123](#L1123) | $schemaType                        = $dynamicOptions->searchAppearance->postTypes->{$post->post\_type}->schemaType; |
| [1124](#L1124) | } |
| [1125](#L1125) | } |
| [1126](#L1126) |  |
| [1127](#L1127) | $graph = []; |
| [1128](#L1128) | switch ( $schemaType ) { |
| [1129](#L1129) | case 'Article': |
| [1130](#L1130) | $graph = [ |
| [1131](#L1131) | 'id'         => 'aioseo-article-' . uniqid(), |
| [1132](#L1132) | 'slug'       => 'article', |
| [1133](#L1133) | 'graphName'  => 'Article', |
| [1134](#L1134) | 'label'      => \_\_( 'Article', 'all-in-one-seo-pack' ), |
| [1135](#L1135) | 'properties' => [ |
| [1136](#L1136) | 'type'        => ! empty( $schemaTypeOptions->article->articleType ) ? $schemaTypeOptions->article->articleType : 'Article', |
| [1137](#L1137) | 'name'        => '#post\_title', |
| [1138](#L1138) | 'headline'    => '#post\_title', |
| [1139](#L1139) | 'description' => '#post\_excerpt', |
| [1140](#L1140) | 'image'       => '', |
| [1141](#L1141) | 'keywords'    => '', |
| [1142](#L1142) | 'author'      => [ |
| [1143](#L1143) | 'name' => '#author\_name', |
| [1144](#L1144) | 'url'  => '#author\_url' |
| [1145](#L1145) | ], |
| [1146](#L1146) | 'dates'       => [ |
| [1147](#L1147) | 'include'       => true, |
| [1148](#L1148) | 'datePublished' => '', |
| [1149](#L1149) | 'dateModified'  => '' |
| [1150](#L1150) | ] |
| [1151](#L1151) | ] |
| [1152](#L1152) | ]; |
| [1153](#L1153) | break; |
| [1154](#L1154) | case 'Course': |
| [1155](#L1155) | $graph = [ |
| [1156](#L1156) | 'id'         => 'aioseo-course-' . uniqid(), |
| [1157](#L1157) | 'slug'       => 'course', |
| [1158](#L1158) | 'graphName'  => 'Course', |
| [1159](#L1159) | 'label'      => \_\_( 'Course', 'all-in-one-seo-pack' ), |
| [1160](#L1160) | 'properties' => [ |
| [1161](#L1161) | 'name'        => ! empty( $schemaTypeOptions->course->name ) ? $schemaTypeOptions->course->name : '#post\_title', |
| [1162](#L1162) | 'description' => ! empty( $schemaTypeOptions->course->description ) ? $schemaTypeOptions->course->description : '#post\_excerpt', |
| [1163](#L1163) | 'provider'    => [ |
| [1164](#L1164) | 'name'  => ! empty( $schemaTypeOptions->course->provider ) ? $schemaTypeOptions->course->provider : '', |
| [1165](#L1165) | 'url'   => '', |
| [1166](#L1166) | 'image' => '' |
| [1167](#L1167) | ] |
| [1168](#L1168) | ] |
| [1169](#L1169) | ]; |
| [1170](#L1170) | break; |
| [1171](#L1171) | case 'Product': |
| [1172](#L1172) | $graph = [ |
| [1173](#L1173) | 'id'         => 'aioseo-product-' . uniqid(), |
| [1174](#L1174) | 'slug'       => 'product', |
| [1175](#L1175) | 'graphName'  => 'Product', |
| [1176](#L1176) | 'label'      => \_\_( 'Product', 'all-in-one-seo-pack' ), |
| [1177](#L1177) | 'properties' => [ |
| [1178](#L1178) | 'autogenerate' => true, |
| [1179](#L1179) | 'name'         => '#post\_title', |
| [1180](#L1180) | 'description'  => ! empty( $schemaTypeOptions->product->description ) ? $schemaTypeOptions->product->description : '#post\_excerpt', |
| [1181](#L1181) | 'brand'        => ! empty( $schemaTypeOptions->product->brand ) ? $schemaTypeOptions->product->brand : '', |
| [1182](#L1182) | 'image'        => '', |
| [1183](#L1183) | 'identifiers'  => [ |
| [1184](#L1184) | 'sku'  => ! empty( $schemaTypeOptions->product->sku ) ? $schemaTypeOptions->product->sku : '', |
| [1185](#L1185) | 'gtin' => '', |
| [1186](#L1186) | 'mpn'  => '' |
| [1187](#L1187) | ], |
| [1188](#L1188) | 'offer'        => [ |
| [1189](#L1189) | 'price'        => ! empty( $schemaTypeOptions->product->price ) ? (float) $schemaTypeOptions->product->price : '', |
| [1190](#L1190) | 'currency'     => ! empty( $schemaTypeOptions->product->currency ) ? $schemaTypeOptions->product->currency : '', |
| [1191](#L1191) | 'availability' => ! empty( $schemaTypeOptions->product->availability ) ? $schemaTypeOptions->product->availability : '', |
| [1192](#L1192) | 'validUntil'   => ! empty( $schemaTypeOptions->product->priceValidUntil ) ? $schemaTypeOptions->product->priceValidUntil : '' |
| [1193](#L1193) | ], |
| [1194](#L1194) | 'rating'       => [ |
| [1195](#L1195) | 'minimum' => 1, |
| [1196](#L1196) | 'maximum' => 5 |
| [1197](#L1197) | ], |
| [1198](#L1198) | 'reviews'      => [] |
| [1199](#L1199) | ] |
| [1200](#L1200) | ]; |
| [1201](#L1201) |  |
| [1202](#L1202) | $identifierType = ! empty( $schemaTypeOptions->product->identifierType ) ? $schemaTypeOptions->product->identifierType : ''; |
| [1203](#L1203) | if ( preg\_match( '/gtin/i', $identifierType ) ) { |
| [1204](#L1204) | $graph['properties']['identifiers']['gtin'] = $identifierType; |
| [1205](#L1205) | } |
| [1206](#L1206) |  |
| [1207](#L1207) | if ( preg\_match( '/mpn/i', $identifierType ) ) { |
| [1208](#L1208) | $graph['properties']['identifiers']['mpn'] = $identifierType; |
| [1209](#L1209) | } |
| [1210](#L1210) |  |
| [1211](#L1211) | $reviews = ! empty( $schemaTypeOptions->product->reviews ) ? $schemaTypeOptions->product->reviews : []; |
| [1212](#L1212) | if ( ! empty( $reviews ) ) { |
| [1213](#L1213) | foreach ( $reviews as $reviewData ) { |
| [1214](#L1214) | $reviewData = json\_decode( $reviewData ); |
| [1215](#L1215) | if ( empty( $reviewData ) ) { |
| [1216](#L1216) | continue; |
| [1217](#L1217) | } |
| [1218](#L1218) |  |
| [1219](#L1219) | $graph['properties']['reviews'][] = [ |
| [1220](#L1220) | 'rating'   => $reviewData->rating, |
| [1221](#L1221) | 'headline' => $reviewData->headline, |
| [1222](#L1222) | 'content'  => $reviewData->content, |
| [1223](#L1223) | 'author'   => $reviewData->author |
| [1224](#L1224) | ]; |
| [1225](#L1225) | } |
| [1226](#L1226) | } |
| [1227](#L1227) | break; |
| [1228](#L1228) | case 'Recipe': |
| [1229](#L1229) | $graph = [ |
| [1230](#L1230) | 'id'         => 'aioseo-recipe-' . uniqid(), |
| [1231](#L1231) | 'slug'       => 'recipe', |
| [1232](#L1232) | 'graphName'  => 'Recipe', |
| [1233](#L1233) | 'label'      => \_\_( 'Recipe', 'all-in-one-seo-pack' ), |
| [1234](#L1234) | 'properties' => [ |
| [1235](#L1235) | 'name'         => ! empty( $schemaTypeOptions->recipe->name ) ? $schemaTypeOptions->recipe->name : '#post\_title', |
| [1236](#L1236) | 'description'  => ! empty( $schemaTypeOptions->recipe->description ) ? $schemaTypeOptions->recipe->description : '#post\_excerpt', |
| [1237](#L1237) | 'author'       => ! empty( $schemaTypeOptions->recipe->author ) ? $schemaTypeOptions->recipe->author : '#author\_name', |
| [1238](#L1238) | 'ingredients'  => ! empty( $schemaTypeOptions->recipe->ingredients ) ? $schemaTypeOptions->recipe->ingredients : '', |
| [1239](#L1239) | 'dishType'     => ! empty( $schemaTypeOptions->recipe->dishType ) ? $schemaTypeOptions->recipe->dishType : '', |
| [1240](#L1240) | 'cuisineType'  => ! empty( $schemaTypeOptions->recipe->cuisineType ) ? $schemaTypeOptions->recipe->cuisineType : '', |
| [1241](#L1241) | 'keywords'     => ! empty( $schemaTypeOptions->recipe->keywords ) ? $schemaTypeOptions->recipe->keywords : '', |
| [1242](#L1242) | 'image'        => ! empty( $schemaTypeOptions->recipe->image ) ? $schemaTypeOptions->recipe->image : '', |
| [1243](#L1243) | 'nutrition'    => [ |
| [1244](#L1244) | 'servings' => ! empty( $schemaTypeOptions->recipe->servings ) ? $schemaTypeOptions->recipe->servings : '', |
| [1245](#L1245) | 'calories' => ! empty( $schemaTypeOptions->recipe->calories ) ? $schemaTypeOptions->recipe->calories : '' |
| [1246](#L1246) | ], |
| [1247](#L1247) | 'timeRequired' => [ |
| [1248](#L1248) | 'preparation' => ! empty( $schemaTypeOptions->recipe->preparationTime ) ? $schemaTypeOptions->recipe->preparationTime : '', |
| [1249](#L1249) | 'cooking'     => ! empty( $schemaTypeOptions->recipe->cookingTime ) ? $schemaTypeOptions->recipe->cookingTime : '' |
| [1250](#L1250) | ], |
| [1251](#L1251) | 'instructions' => [] |
| [1252](#L1252) | ] |
| [1253](#L1253) | ]; |
| [1254](#L1254) |  |
| [1255](#L1255) | $instructions = ! empty( $schemaTypeOptions->recipe->instructions ) ? $schemaTypeOptions->recipe->instructions : []; |
| [1256](#L1256) | if ( ! empty( $instructions ) ) { |
| [1257](#L1257) | foreach ( $instructions as $instructionData ) { |
| [1258](#L1258) | $instructionData = json\_decode( $instructionData ); |
| [1259](#L1259) | if ( empty( $instructionData ) ) { |
| [1260](#L1260) | continue; |
| [1261](#L1261) | } |
| [1262](#L1262) |  |
| [1263](#L1263) | $graph['properties']['instructions'][] = [ |
| [1264](#L1264) | 'name'  => '', |
| [1265](#L1265) | 'text'  => $instructionData->content, |
| [1266](#L1266) | 'image' => '' |
| [1267](#L1267) | ]; |
| [1268](#L1268) | } |
| [1269](#L1269) | } |
| [1270](#L1270) | break; |
| [1271](#L1271) | case 'SoftwareApplication': |
| [1272](#L1272) | $graph = [ |
| [1273](#L1273) | 'id'         => 'aioseo-software-application-' . uniqid(), |
| [1274](#L1274) | 'slug'       => 'software-application', |
| [1275](#L1275) | 'graphName'  => 'SoftwareApplication', |
| [1276](#L1276) | 'label'      => \_\_( 'Software', 'all-in-one-seo-pack' ), |
| [1277](#L1277) | 'properties' => [ |
| [1278](#L1278) | 'name'            => ! empty( $schemaTypeOptions->software->name ) ? $schemaTypeOptions->software->name : '#post\_title', |
| [1279](#L1279) | 'description'     => '#post\_excerpt', |
| [1280](#L1280) | 'price'           => ! empty( $schemaTypeOptions->software->price ) ? (float) $schemaTypeOptions->software->price : '', |
| [1281](#L1281) | 'currency'        => ! empty( $schemaTypeOptions->software->currency ) ? $schemaTypeOptions->software->currency : '', |
| [1282](#L1282) | 'operatingSystem' => ! empty( $schemaTypeOptions->software->operatingSystems ) ? $schemaTypeOptions->software->operatingSystems : '', |
| [1283](#L1283) | 'category'        => ! empty( $schemaTypeOptions->software->category ) ? $schemaTypeOptions->software->category : '', |
| [1284](#L1284) | 'rating'          => [ |
| [1285](#L1285) | 'value'   => '', |
| [1286](#L1286) | 'minimum' => 1, |
| [1287](#L1287) | 'maximum' => 5 |
| [1288](#L1288) | ], |
| [1289](#L1289) | 'review'          => [ |
| [1290](#L1290) | 'headline' => '', |
| [1291](#L1291) | 'content'  => '', |
| [1292](#L1292) | 'author'   => '' |
| [1293](#L1293) | ] |
| [1294](#L1294) | ] |
| [1295](#L1295) | ]; |
| [1296](#L1296) |  |
| [1297](#L1297) | $reviews = ! empty( $schemaTypeOptions->software->reviews ) ? $schemaTypeOptions->software->reviews : []; |
| [1298](#L1298) | if ( ! empty( $reviews[0] ) ) { |
| [1299](#L1299) | $reviewData = json\_decode( $reviews[0] ); |
| [1300](#L1300) | if ( empty( $reviewData ) ) { |
| [1301](#L1301) | break; |
| [1302](#L1302) | } |
| [1303](#L1303) |  |
| [1304](#L1304) | $graph['properties']['rating']['value'] = $reviewData->rating; |
| [1305](#L1305) | $graph['properties']['review'] = [ |
| [1306](#L1306) | 'headline' => $reviewData->headline, |
| [1307](#L1307) | 'content'  => $reviewData->content, |
| [1308](#L1308) | 'author'   => $reviewData->author |
| [1309](#L1309) | ]; |
| [1310](#L1310) | } |
| [1311](#L1311) | break; |
| [1312](#L1312) | case 'WebPage': |
| [1313](#L1313) | if ( 'FAQPage' === $schemaTypeOptions->webPage->webPageType ) { |
| [1314](#L1314) | $graph = [ |
| [1315](#L1315) | 'id'         => 'aioseo-faq-page-' . uniqid(), |
| [1316](#L1316) | 'slug'       => 'faq-page', |
| [1317](#L1317) | 'graphName'  => 'FAQPage', |
| [1318](#L1318) | 'label'      => \_\_( 'FAQ Page', 'all-in-one-seo-pack' ), |
| [1319](#L1319) | 'properties' => [ |
| [1320](#L1320) | 'type'        => $schemaTypeOptions->webPage->webPageType, |
| [1321](#L1321) | 'name'        => '#post\_title', |
| [1322](#L1322) | 'description' => '#post\_excerpt', |
| [1323](#L1323) | 'questions'   => [] |
| [1324](#L1324) | ] |
| [1325](#L1325) | ]; |
| [1326](#L1326) |  |
| [1327](#L1327) | $faqs = $schemaTypeOptions->faq->pages; |
| [1328](#L1328) | if ( ! empty( $faqs ) ) { |
| [1329](#L1329) | foreach ( $faqs as $faqData ) { |
| [1330](#L1330) | $faqData = json\_decode( $faqData ); |
| [1331](#L1331) | if ( empty( $faqData ) ) { |
| [1332](#L1332) | continue; |
| [1333](#L1333) | } |
| [1334](#L1334) |  |
| [1335](#L1335) | $graph['properties']['questions'][] = [ |
| [1336](#L1336) | 'question' => $faqData->question, |
| [1337](#L1337) | 'answer'   => $faqData->answer |
| [1338](#L1338) | ]; |
| [1339](#L1339) | } |
| [1340](#L1340) | } |
| [1341](#L1341) | } else { |
| [1342](#L1342) | $graph = [ |
| [1343](#L1343) | 'id'         => 'aioseo-web-page-' . uniqid(), |
| [1344](#L1344) | 'slug'       => 'web-page', |
| [1345](#L1345) | 'graphName'  => 'WebPage', |
| [1346](#L1346) | 'label'      => \_\_( 'Web Page', 'all-in-one-seo-pack' ), |
| [1347](#L1347) | 'properties' => [ |
| [1348](#L1348) | 'type'        => $schemaTypeOptions->webPage->webPageType, |
| [1349](#L1349) | 'name'        => '', |
| [1350](#L1350) | 'description' => '' |
| [1351](#L1351) | ] |
| [1352](#L1352) | ]; |
| [1353](#L1353) | } |
| [1354](#L1354) | break; |
| [1355](#L1355) | case 'default': |
| [1356](#L1356) | $dynamicOptions = aioseo()->dynamicOptions->noConflict(); |
| [1357](#L1357) | if ( ! empty( $post->post\_type ) && $dynamicOptions->searchAppearance->postTypes->has( $post->post\_type ) ) { |
| [1358](#L1358) | $schemaOptions->defaultGraph = $dynamicOptions->searchAppearance->postTypes->{$post->post\_type}->schemaType; |
| [1359](#L1359) | } |
| [1360](#L1360) | break; |
| [1361](#L1361) | case 'none': |
| [1362](#L1362) | // If "none', we simply don't have to migrate anything. |
| [1363](#L1363) | default: |
| [1364](#L1364) | break; |
| [1365](#L1365) | } |
| [1366](#L1366) |  |
| [1367](#L1367) | if ( ! empty( $graph ) ) { |
| [1368](#L1368) | if ( $isDefault ) { |
| [1369](#L1369) | $schemaOptions->default->data->{$schemaType} = $graph; |
| [1370](#L1370) | } else { |
| [1371](#L1371) | $schemaOptions->graphs[]           = $graph; |
| [1372](#L1372) | $schemaOptions->default->isEnabled = false; |
| [1373](#L1373) | } |
| [1374](#L1374) | } |
| [1375](#L1375) |  |
| [1376](#L1376) | $aioseoPost->schema = $schemaOptions; |
| [1377](#L1377) | $aioseoPost->save(); |
| [1378](#L1378) |  |
| [1379](#L1379) | return $aioseoPost; |
| [1380](#L1380) | } |
| [1381](#L1381) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/all-in-one-seo-pack/tags/4.2.9/app/Common/Main/Updates.php?format=txt)
* [Original Format](/export/3222465/all-in-one-seo-pack/tags/4.2.9/app/Common/Main/Updates.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_a44e11fe_20250114_201443.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# All in One SEO Pack <= 4.2.9 - Authenticated (Administrator+) Stored Cross-Site Scripting

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   All in One SEO Pack <= 4.2.9 - Authenticated (Administrator+) Stored Cross-Site Scripting

4.4

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:H/PR:H/UI:N/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:H/PR:H/UI:N/S:C/C:L/I:L/A:N)

| CVE | [CVE-2023-0585](https://www.cve.org/CVERecord?id=CVE-2023-0585) |
| --- | --- |
| CVSS | 4.4 (Medium) |
| Publicly Published | February 24, 2023 |
| Last Updated | January 22, 2024 |
| Researchers | [Marco Wotschka - Wordfence](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/marco-wotschka)  [Ivan Kuzymchak - Wordfence](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/ivan-kuzymchak) |

### Description

The All in One SEO Pack plugin for WordPress is vulnerable to Stored Cross-Site Scripting via multiple parameters in versions up to, and including, 4.2.9 due to insufficient input sanitization and output escaping. This makes it possible for authenticated attackers with Administrator role or above to inject arbitrary web scripts in pages that will execute whenever a user accesses an injected page.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/all-in-one-seo-pack/tags/4.2.9/app/Common/Main/Updates.php?v=2829340#L624)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/all-in-one-seo-pack/tags/4.2.9/app/Common/Main/Updates.php?v=2829340#L625)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/all-in-one-seo-pack/tags/4.2.9/app/Common/Main/Updates.php?v=2829340#L665)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/all-in-one-seo-pack/tags/4.2.9/app/Common/Main/Updates.php?v=2829340#L666)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&new=2859011%40all-in-one-seo-pack%2Ftrunk&old=2847431%40all-in-one-seo-pack%2Ftrunk&sfp_email=&sfph_mail=)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fall-in-one-seo-pack%2Fall-in-one-seo-pack-429-authenticated-administrator-stored-cross-site-scripting&t=All%20in%20One%20SEO%20Pack%20%3C%3D%204.2.9%20-%20Authenticated%20%28Administrator%2B%29%20Stored%20Cross-Site%20Scripting "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fall-in-one-seo-pack%2Fall-in-one-seo-pack-429-authenticated-administrator-stored-cross-site-scripting&text=All%20in%20One%20SEO%20Pack%20%3C%3D%204.2.9%20-%20Authenticated%20%28Administrator%2B%29%20Stored%20Cross-Site%20Scripting "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fall-in-one-seo-pack%2Fall-in-one-seo-pack-429-authenticated-administrator-stored-cross-site-scripting "LinkedIn")
Email

## Vulnerability Details for All in One SEO – Powerful SEO Plugin to Boost SEO Rankings & Increase Traffic

#### [All in One SEO – Powerful SEO Plugin to Boost SEO Rankings & Increase Traffic](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/all-in-one-seo-pack)

| Software Type | Plugin |
| --- | --- |
| Software Slug | all-in-one-seo-pack [(view on wordpress.org)](https://wordpress.org/plugins/all-in-one-seo-pack) |
| Patched? | Yes |
| Remediation | Update to version 4.3.0, or a newer patched version |
| Affected Version | * <= 4.2.9 |
| Patched Version | * 4.3.0 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation


