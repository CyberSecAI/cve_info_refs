=== Content from gitlab.com_6e9da92a_20250114_181714.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2023](/gitlab-org/cves/-/tree/master/2023)
* [**CVE-2023-0223.json**](/gitlab-org/cves/-/blob/master/2023/CVE-2023-0223.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2023/CVE-2023-0223.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2023/CVE-2023-0223.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![🤖 GitLab Bot 🤖's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 "🤖 GitLab Bot 🤖")](/gitlab-bot)

  Mar 04, 2023

  [6a2f78b0](/gitlab-org/cves/-/commit/6a2f78b065529d9a7e913f3c76e96ab90ee0fdef)
  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/6a2f78b065529d9a7e913f3c76e96ab90ee0fdef)
  ·
  6a2f78b0

  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Mar 04, 2023

  6a2f78b0

  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/6a2f78b065529d9a7e913f3c76e96ab90ee0fdef)
  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Mar 04, 2023

Loading



=== Content from gitlab.com_53703f99_20250114_181714.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Release Description visible in public projects despite release set as project members only

**[HackerOne report #1824226](https://hackerone.com/reports/1824226)** by `ashish_r_padelkar` on 2023-01-05, assigned to [@fvpotvin](/fvpotvin "Félix Veillette-Potvin"):

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

##### Summary

Hello,

This is similar to #1725841 which is fixed but there is a TAG api which leaks the release description.

`Release` can be restricted for `Only Project Members` in project settings. This should ensure that no release information is visible outside team members.

However, anyone can see release `Description`  in public projects through tags API at `https://gitlab.com/api/v4/projects/<ID>/repository/tags` even when releases are set as project members only.

##### Steps to reproduce

1. As a project owner, set your project as public with `Releases` as `Only Project Members` at `https://gitlab.com/<NameSpace>/<ProjectName>/edit#js-general-project-settings`.

[![Screen_Shot_2023-01-06_at_12.48.34_AM.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/9b835f02a07df458ffdd661b5f822527e15fb787/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f64396365626637362d353532662d343430652d393135642d6636623732353033653337362f53637265656e5f53686f745f323032332d30312d30365f61745f31322e34382e33345f414d2e706e67)

2.Now create a `Release` at `https://gitlab.com/<NameSpace>/<ProjectName>/-/releases`. Put something important within Description field .

3.Access the `https://gitlab.com/<NameSpace>/<ProjectName>/-/releases` without authentication but you will get 404 as Release is only visible for Team members.

4.Now visit TAGs API unauthenticated `https://gitlab.com/api/v4/projects/<ID>/repository/tags` and you should see `Release` array in response with Description field leaking from releases which may contain important information which shouldn't be visible to unauthenticated users (or guest users).

##### Examples

You can visit my test project tags `https://gitlab.com/api/v4/projects/40882501/repository/tags`. search for `Release` array in response and you should find `Description` field which you can read.

##### What is the current *bug* behavior?

Release Description are disclosed in tag API despite release set as project members only.

##### What is the expected *correct* behavior?

Release Description should not be visible for unauthenticated users when they are set as only project members

##### Output of checks

This bug happens on GitLab.com `GitLab Enterprise Edition 15.8.0-pre be1706d789a`

Regards,

Ashish

#### Impact

Release Description visible in public projects despite release set as project members only

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [Screen\_Shot\_2023-01-06\_at\_12.48.34\_AM.png](https://h1.sec.gitlab.net/a/d9cebf76-552f-440e-915d-f6b72503e376/Screen_Shot_2023-01-06_at_12.48.34_AM.png)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

## Implementation plan

Check `:read_release` permission in Tags API before showing Releases with Tags. Also applies to `get ':id/repository/tags/:tag_name'` endpoint.

```
diff --git a/lib/api/entities/tag.rb b/lib/api/entities/tag.rb
index 713bae64d5c3..e249fd189fc5 100644
--- a/lib/api/entities/tag.rb
+++ b/lib/api/entities/tag.rb
@@ -12,7 +12,7 @@ class Tag < Grape::Entity
       end

       # rubocop: disable CodeReuse/ActiveRecord
-      expose :release, using: Entities::TagRelease do |repo_tag, options|
+      expose :release, using: Entities::TagRelease, if: -> (*) { options[:show_releases] } do |repo_tag, options|
         options[:project].releases.find_by(tag: repo_tag.name)
       end
       # rubocop: enable CodeReuse/ActiveRecord
diff --git a/lib/api/tags.rb b/lib/api/tags.rb
index 4ddf22c726fa..081c41452517 100644
--- a/lib/api/tags.rb
+++ b/lib/api/tags.rb
@@ -45,7 +45,13 @@ class Tags < ::API::Base

         paginated_tags = Gitlab::Pagination::GitalyKeysetPager.new(self, user_project).paginate(tags_finder)

-        present_cached paginated_tags, with: Entities::Tag, project: user_project, cache_context: -> (_tag) { user_project.cache_key }
+        show_releases = can?(current_user, :read_release, user_project)
+
+        present_cached paginated_tags,
+                       with: Entities::Tag,
+                       project: user_project,
+                       cache_context: -> (_tag) { [user_project.cache_key, show_releases].join(':') },
+                       show_releases: show_releases

       rescue Gitlab::Git::InvalidPageToken => e
         unprocessable_entity!(e.message)
```

Edited Feb 01, 2023 by [Alishan Ladhani](/ali-gitlab)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


