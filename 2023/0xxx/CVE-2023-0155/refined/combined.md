=== Content from gitlab.com_dac8ebfd_20250114_194051.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2023](/gitlab-org/cves/-/tree/master/2023)
* [**CVE-2023-0155.json**](/gitlab-org/cves/-/blob/master/2023/CVE-2023-0155.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2023/CVE-2023-0155.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2023/CVE-2023-0155.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![🤖 GitLab Bot 🤖's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 "🤖 GitLab Bot 🤖")](/gitlab-bot)

  May 03, 2023

  [acdee4fd](/gitlab-org/cves/-/commit/acdee4fdfaf2e44bd5cc887111e2280d131d6d20)
  [Publishing 0 updated advisories and 2 new advisories](/gitlab-org/cves/-/commit/acdee4fdfaf2e44bd5cc887111e2280d131d6d20)
  ·
  acdee4fd

  [🤖 GitLab Bot 🤖](/gitlab-bot) authored May 03, 2023

  acdee4fd

  [Publishing 0 updated advisories and 2 new advisories](/gitlab-org/cves/-/commit/acdee4fdfaf2e44bd5cc887111e2280d131d6d20)
  [🤖 GitLab Bot 🤖](/gitlab-bot) authored May 03, 2023

Loading



=== Content from gitlab.com_9990bfbd_20250114_194052.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Framing of arbitrary content (leading to open redirects) on any page allowing user controlled markdown

**[HackerOne report #1817250](https://hackerone.com/reports/1817250)** by `joaxcar` on 2022-12-26, assigned to `Ottilia Westerlund`:

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

#### Summary

In the latest GitLab release 15.7.0 there was an MR added that allows users to embed links to `https://observe.gitlab.com` into any rendered markdown content. The MR is here [!104081 (merged)](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/104081 "Embed observability")

This does not seem to be a feature that GitLab is actively pushing at the moment as it is not mentioned in the 15.7 release notes. But it is not behind a feature flag and is thus active both on Gitlab.com and on self-hosted instances.

The new feature takes any link starting with `https://observe.gitlab.com` and embeds an iframe with the link as the `src` attribute in the rendered markdown. Using this Vue code in `app/assets/javascripts/behaviors/markdown/render_observability.js`

```
 return new Vue({
    el: element,
    render(h) {
      return h('iframe', {
        style: {
          height: '366px',
          width: '768px',
        },
        attrs: {
          src: getFrameSrc(url),
          frameBorder: '0',
        },
      });
    },
  });
};
```

This iframe is not sandboxed and framed pages can thus behave in unintended ways. The framed page can use popups, run javascript and also navigate the top window (causing a sort of open redirect that can be injected at arbitrary locations in GitLab).

The code responsible for finding `observe` links in markdown is this line from `lib/banzai/filter/inline_observability_filter.rb`

```
def xpath_search
   "descendant-or-self::a[starts-with([@]href, '#{Gitlab::Observability.observability_url}')]"
end
```

As you can see here the selector only looks for anchor tags that have a href attribute that starts with the value in `Gitlab::Observability.observability_url`. This variable is at the moment a hardcoded value from `lib/gitlab/observability.rb` namely `https://observe.gitlab.com`. The problem here is that the value in the variable does not end in a slash. This makes the selector also match these examples

* <https://observe.gitlab.com.example.com>
* <https://observe.gitlab.com@example.com> (Firefox and Safari only)

Both of which can be attacker-controlled. This allows an attacker to link arbitrary content that will be added as an iframe anywhere in GitLab where markdown is rendered.

There are some mitigating factors here. On Gitlab.com there is a CSP in place that restricts what pages can be framed under the domain. This makes it hard for an attacker to cause any serious harm with the described attack (even if there are some phishing issues that can be abused).

The impact is much more severe if this is used on a self-hosted instance without proper CSP in place. If an attacker has the option to frame arbitrary pages the attacker can launch DoS / open redirect attacks where the attacker frames a page that navigates the top page to an attacker-controlled page. This will turn any `issue`, `merge request`, `code preview`, `wiki`, or any other page containing markdown into an open redirect that will also work as a local DoS, as any page could be made unreachable.

#### Steps to reproduce

Do these steps in Firefox. See later in my report for a discussion of this

1. Start up a self-hosted instance of GitLab
2. Log in as the attacker
3. Go to any project and create an `issue` (or go to an existing `issue`)
4. In the description field type

```
https://observe.gitlab.com@joaxcar.com/poc/gitlab/redir.html
```

1. Click create/save
2. You will now be redirected to `https://example.com`
3. Try to visit the `issue` page again, you will be redirected again

#### Impact

Framing of arbitrary content on ANY page rendering markdown. Allowing for phishing and/or DoS of pages by having arbitrary GitLab pages redirect to attacker-controlled content. The redirect will also work as DoS by not allowing users to access issues, MRs, wikis, project and group pages, and so on.

#### What is the current *bug* behavior?

GitLab ads an iframe to any link starting with `https://observe.gitlab.com` in any markdown content, including `https://observe.gitlab.com@example.com` and `https://observe.gitlab.com.example.com`

#### What is the expected *correct* behavior?

Only links that point to the actual `https://observe.gitlab.com` domain should get rendered

#### Relevant logs and/or screenshots

[![frame.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/ff85b3dfab8883f3c11d060975c087493c14e717/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f37356238383731332d663232652d343836302d386338392d3933356665343866316366392f6672616d652e706e67)

#### Output of checks

This bug happens on GitLab.com

#### Note on browser compatibility

Browsers have different mitigations when it comes to securing content in iframes. Chrome will for example not allow frames of links containing `basic auth`, meaning username:password. And thus Chrome will not allow the `https://observe.gitlab.com@example.com` attack. All browsers allow framing of `https://observe.gitlab.com.example.com`. But this requires the attacker to issue a valid certificate for the domain as normal wildcard certificates will not work on multi-level subdomains. This is not an issue and is easy to do, but for the sake of simplicity, I required to use Firefox in my PoC. I will get back as soon as I have registered a valid cert for the Chrome attack.

#### Impact

Framing of arbitrary content on ANY page rendering markdown. Allowing for phishing and/or DoS of pages by having arbitrary GitLab pages redirect to attacker-controlled content. The redirect will also work as DoS by not allowing users to access issues, MRs, wikis, project and group pages, and so on.

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [frame.png](https://h1.sec.gitlab.net/a/75b88713-f22e-4860-8c89-935fe48f1cf9/frame.png)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


