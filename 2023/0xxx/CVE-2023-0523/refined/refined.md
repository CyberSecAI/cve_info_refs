```json
{
  "vulnerability": {
    "root_cause": "The application uses `.html_safe` on a flash message that includes user-controlled input (email address), allowing arbitrary HTML injection.",
    "weaknesses": [
      "Improper neutralization of input during web page generation ('Cross-site Scripting')"
    ],
    "impact": "Cross-site scripting (XSS) can be triggered, potentially leading to session hijacking, arbitrary code execution in the user's browser, or other malicious activities. Specifically, if an administrator impersonates a user whose email contains malicious HTML, the administrator's session could be compromised.",
    "attack_vectors": {
      "vector_1": "A malicious user registers an account and then modifies their email address to include HTML tags/payload. When the 'soft email confirmation' message is displayed, the HTML payload is rendered.",
       "vector_2": "An administrator impersonates a user with the malicious email. The XSS is triggered in the administrator's session."
    },
    "required_capabilities": {
        "attacker": "Ability to create a user account and modify their email address.",
        "victim": "Administrator with the capability to impersonate users."
    },
    "details": "The vulnerability exists within the `confirm_email_warning.rb` file, specifically within the `set_confirm_warning` method. The `html_safe` call on the flash message enables the rendering of HTML tags included in the email address. This issue is present on self-managed instances when the :soft_email_confirmation feature flag is enabled. The attacker's modified email address is not visible to the admin on the user profile page, which conceals the XSS attack until impersonation."
  }
}
```