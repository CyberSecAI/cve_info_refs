=== Content from github.com_8691f393_20250115_093551.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgitpod-io%2Fgitpod%2Freleases%2Ftag%2Frelease-2022.11.2)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgitpod-io%2Fgitpod%2Freleases%2Ftag%2Frelease-2022.11.2)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=gitpod-io%2Fgitpod)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[gitpod-io](/gitpod-io)
/
**[gitpod](/gitpod-io/gitpod)**
Public

* [Notifications](/login?return_to=%2Fgitpod-io%2Fgitpod) You must be signed in to change notification settings
* [Fork
  1.3k](/login?return_to=%2Fgitpod-io%2Fgitpod)
* [Star
   13.1k](/login?return_to=%2Fgitpod-io%2Fgitpod)

* [Code](/gitpod-io/gitpod/tree/release-2022.11.2)
* [Issues
  463](/gitpod-io/gitpod/issues)
* [Pull requests
  14](/gitpod-io/gitpod/pulls)
* [Actions](/gitpod-io/gitpod/actions)
* [Security](/gitpod-io/gitpod/security)
* [Insights](/gitpod-io/gitpod/pulse)

Additional navigation options

* [Code](/gitpod-io/gitpod/tree/release-2022.11.2)
* [Issues](/gitpod-io/gitpod/issues)
* [Pull requests](/gitpod-io/gitpod/pulls)
* [Actions](/gitpod-io/gitpod/actions)
* [Security](/gitpod-io/gitpod/security)
* [Insights](/gitpod-io/gitpod/pulse)

1. [Releases](/gitpod-io/gitpod/releases)
2. [release-2022.11.2](/gitpod-io/gitpod/releases/tag/release-2022.11.2)

# 2022.11.2

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/gitpod-io/gitpod/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...release-2022.11.2)

 Loading

[View all tags](/gitpod-io/gitpod/tags)

![@corneliusludmann](https://avatars.githubusercontent.com/u/24960040?s=40&v=4)
[corneliusludmann](/corneliusludmann)
released this
01 Mar 16:05

·
[4131 commits](/gitpod-io/gitpod/compare/release-2022.11.2...main)
to main
since this release

[release-2022.11.2](/gitpod-io/gitpod/tree/release-2022.11.2)

[`72e822c`](/gitpod-io/gitpod/commit/72e822c8dbc247382ff1e02032dec2231fe89698)

Hotfix release with security fixes. More information can be found [here](https://app.safebase.io/portal/71ccd717-aa2d-4a1e-942e-c768d37e9e0c/preview?product=default&orgId=71ccd717-aa2d-4a1e-942e-c768d37e9e0c&tcuUid=1d505bda-9a38-4ca5-8724-052e6337f34d).

Docker image:: `eu.gcr.io/gitpod-core-dev/build/installer:release-2022.11.2.16`

 Assets
2

 Loading

All reactions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_cb5d10ea_20250115_093543.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgitpod-io%2Fgitpod%2Fcommit%2F12956988eec0031f42ffdfa3bdc3359f65628f9f)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgitpod-io%2Fgitpod%2Fcommit%2F12956988eec0031f42ffdfa3bdc3359f65628f9f)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=gitpod-io%2Fgitpod)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[gitpod-io](/gitpod-io)
/
**[gitpod](/gitpod-io/gitpod)**
Public

* [Notifications](/login?return_to=%2Fgitpod-io%2Fgitpod) You must be signed in to change notification settings
* [Fork
  1.3k](/login?return_to=%2Fgitpod-io%2Fgitpod)
* [Star
   13.1k](/login?return_to=%2Fgitpod-io%2Fgitpod)

* [Code](/gitpod-io/gitpod)
* [Issues
  463](/gitpod-io/gitpod/issues)
* [Pull requests
  14](/gitpod-io/gitpod/pulls)
* [Actions](/gitpod-io/gitpod/actions)
* [Security](/gitpod-io/gitpod/security)
* [Insights](/gitpod-io/gitpod/pulse)

Additional navigation options

* [Code](/gitpod-io/gitpod)
* [Issues](/gitpod-io/gitpod/issues)
* [Pull requests](/gitpod-io/gitpod/pulls)
* [Actions](/gitpod-io/gitpod/actions)
* [Security](/gitpod-io/gitpod/security)
* [Insights](/gitpod-io/gitpod/pulse)

## Commit

[Permalink](/gitpod-io/gitpod/commit/12956988eec0031f42ffdfa3bdc3359f65628f9f)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[server] strict same site origin for /api/gitpod endpoint

[Browse files](/gitpod-io/gitpod/tree/12956988eec0031f42ffdfa3bdc3359f65628f9f)
Browse the repository at this point in the history

* Loading branch information

[![@corneliusludmann](https://avatars.githubusercontent.com/u/24960040?s=40&v=4)](/corneliusludmann)

[corneliusludmann](/gitpod-io/gitpod/commits?author=corneliusludmann "View all commits by corneliusludmann")
committed
Feb 23, 2023

1 parent
[3c79f0c](/gitpod-io/gitpod/commit/3c79f0c68c9e480f0e8daf65c44a484296161786)

commit 1295698

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**96 additions**
and
**20 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* components/server/src

  + components/server/src/express-util.spec.ts
    [express-util.spec.ts](#diff-c29beadedbff5bb4fe4d63ab5d9fd088cd36927b5aebc205bd2d411238dbbe12)
  + components/server/src/express-util.ts
    [express-util.ts](#diff-afb02a2ba5397f62d4eaf365273e0336e8b20fe0fb39ee0f8276573e72d016e0)
  + components/server/src/server.ts
    [server.ts](#diff-bd6f821f67d3f4ea170ed2d0e38f54fd9094bf17aaaa5cbdba1dd8179adbaa35)

## There are no files selected for viewing

58 changes: 56 additions & 2 deletions

58
[components/server/src/express-util.spec.ts](#diff-c29beadedbff5bb4fe4d63ab5d9fd088cd36927b5aebc205bd2d411238dbbe12 "components/server/src/express-util.spec.ts")

Show comments

[View file](/gitpod-io/gitpod/blob/12956988eec0031f42ffdfa3bdc3359f65628f9f/components/server/src/express-util.spec.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -15,6 +15,7 @@ describe("express-util", function () { |
|  |  | const result = isAllowedWebsocketDomain( |
|  |  | "http://3000-moccasin-ferret-155799b3.ws-eu.gpl-2732-ws-csrf.staging.gitpod.io", |
|  |  | HOSTURL\_HOSTNAME, |
|  |  | false, |
|  |  | ); |
|  |  | expect(result).to.be.false; |
|  |  | }); |
| Expand All | | @@ -23,12 +24,43 @@ describe("express-util", function () { |
|  |  | const result = isAllowedWebsocketDomain( |
|  |  | "http://moccasin-ferret-155799b3.ws-eu.gpl-2732-ws-csrf.staging.gitpod.io", |
|  |  | HOSTURL\_HOSTNAME, |
|  |  | false, |
|  |  | ); |
|  |  | expect(result).to.be.true; |
|  |  | }); |
|  |  |  |
|  |  | it("should return true for dashboard", function () { |
|  |  | const result = isAllowedWebsocketDomain("http://gpl-2732-ws-csrf.staging.gitpod.io", HOSTURL\_HOSTNAME); |
|  |  | const result = isAllowedWebsocketDomain( |
|  |  | "http://gpl-2732-ws-csrf.staging.gitpod.io", |
|  |  | HOSTURL\_HOSTNAME, |
|  |  | false, |
|  |  | ); |
|  |  | expect(result).to.be.true; |
|  |  | }); |
|  |  | it("should return false for workspace-port locations (strict)", function () { |
|  |  | const result = isAllowedWebsocketDomain( |
|  |  | "http://3000-moccasin-ferret-155799b3.ws-eu.gpl-2732-ws-csrf.staging.gitpod.io", |
|  |  | HOSTURL\_HOSTNAME, |
|  |  | true, |
|  |  | ); |
|  |  | expect(result).to.be.false; |
|  |  | }); |
|  |  |  |
|  |  | it("should return true for workspace locations (strict)", function () { |
|  |  | const result = isAllowedWebsocketDomain( |
|  |  | "http://moccasin-ferret-155799b3.ws-eu.gpl-2732-ws-csrf.staging.gitpod.io", |
|  |  | HOSTURL\_HOSTNAME, |
|  |  | true, |
|  |  | ); |
|  |  | expect(result).to.be.false; |
|  |  | }); |
|  |  |  |
|  |  | it("should return true for dashboard (strict)", function () { |
|  |  | const result = isAllowedWebsocketDomain( |
|  |  | "http://gpl-2732-ws-csrf.staging.gitpod.io", |
|  |  | HOSTURL\_HOSTNAME, |
|  |  | true, |
|  |  | ); |
|  |  | expect(result).to.be.true; |
|  |  | }); |
|  |  | }); |
| Expand All | | @@ -38,12 +70,34 @@ describe("express-util", function () { |
|  |  | const result = isAllowedWebsocketDomain( |
|  |  | "https://8000-black-capybara-dy6e3fgz.ws-eu08.gitpod.io", |
|  |  | HOSTURL\_HOSTNAME, |
|  |  | false, |
|  |  | ); |
|  |  | expect(result).to.be.false; |
|  |  | }); |
|  |  |  |
|  |  | it("should return true for workspace locations", function () { |
|  |  | const result = isAllowedWebsocketDomain("https://bronze-bird-p2q226d8.ws-eu08.gitpod.io", HOSTURL\_HOSTNAME); |
|  |  | const result = isAllowedWebsocketDomain( |
|  |  | "https://bronze-bird-p2q226d8.ws-eu08.gitpod.io", |
|  |  | HOSTURL\_HOSTNAME, |
|  |  | false, |
|  |  | ); |
|  |  | expect(result).to.be.true; |
|  |  | }); |
|  |  | it("should return false for workspace-port locations (strict)", function () { |
|  |  | const result = isAllowedWebsocketDomain( |
|  |  | "https://8000-black-capybara-dy6e3fgz.ws-eu08.gitpod.io", |
|  |  | HOSTURL\_HOSTNAME, |
|  |  | true, |
|  |  | ); |
|  |  | expect(result).to.be.false; |
|  |  | }); |
|  |  |  |
|  |  | it("should return false for workspace locations (strict)", function () { |
|  |  | const result = isAllowedWebsocketDomain( |
|  |  | "https://bronze-bird-p2q226d8.ws-eu08.gitpod.io", |
|  |  | HOSTURL\_HOSTNAME, |
|  |  | true, |
|  |  | ); |
|  |  | expect(result).to.be.true; |
|  |  | }); |
|  |  | }); |
| Expand Down | |  |

25 changes: 16 additions & 9 deletions

25
[components/server/src/express-util.ts](#diff-afb02a2ba5397f62d4eaf365273e0336e8b20fe0fb39ee0f8276573e72d016e0 "components/server/src/express-util.ts")

Show comments

[View file](/gitpod-io/gitpod/blob/12956988eec0031f42ffdfa3bdc3359f65628f9f/components/server/src/express-util.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -7,8 +7,9 @@ |
|  |  | import { URL } from "url"; |
|  |  | import \* as express from "express"; |
|  |  | import \* as crypto from "crypto"; |
|  |  | import { GitpodHostUrl } from "@gitpod/gitpod-protocol/lib/util/gitpod-host-url"; |
|  |  | import \* as session from "express-session"; |
|  |  | import { log } from "@gitpod/gitpod-protocol/lib/util/logging"; |
|  |  | import { GitpodHostUrl } from "@gitpod/gitpod-protocol/lib/util/gitpod-host-url"; |
|  |  |  |
|  |  | export const query = (...tuples: [string, string][]) => { |
|  |  | if (tuples.length === 0) { |
| Expand All | | @@ -17,23 +18,29 @@ export const query = (...tuples: [string, string][]) => { |
|  |  | return "?" + tuples.map((t) => `${t[0]}=${encodeURIComponent(t[1])}`).join("&"); |
|  |  | }; |
|  |  |  |
|  |  | // We do not precise UUID parsing here, we just want to distinguish three cases: |
|  |  | // - the base domain |
|  |  | // - a frontend domain (workspace domain) |
|  |  | // - a workspace port domain |
|  |  | // We control all of those values and the base domain, so we don't need to much effort |
|  |  | export const isAllowedWebsocketDomain = (originHeader: any, gitpodHostName: string): boolean => { |
|  |  | // Strict: We only allow connections from the base domain, so disallow connections from all other Origins |
|  |  | // Only (current) exception: If no Origin header is set, skip the check! |
|  |  | // Non-Strict: "rely" on subdomain parsing (do we still need this?) |
|  |  | export const isAllowedWebsocketDomain = (originHeader: string, gitpodHostName: string, strict: boolean): boolean => { |
|  |  | if (!originHeader || typeof originHeader !== "string") { |
|  |  | // TODO(gpl) Can we get rid of this dependency alltogether? |
|  |  | log.warn("Origin header check not applied because of empty Origin header!"); |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | var originHostname = ""; |
|  |  | try { |
|  |  | const originUrl = new URL(originHeader); |
|  |  | originHostname = originUrl.hostname; |
|  |  | const originHostname = originUrl.hostname; |
|  |  | if (originHostname === gitpodHostName) { |
|  |  | return true; |
|  |  | } |
|  |  |  |
|  |  | if (strict) { |
|  |  | return false; |
|  |  | } |
|  |  | // TODO(gpl) This is only used for Bearer-Token authentication. |
|  |  | // Does this restriction help at all, or can we remove it entirely? |
|  |  | log.warn("Origin header check based on looksLikeWorkspaceHostname"); |
|  |  | if (looksLikeWorkspaceHostname(originUrl, gitpodHostName)) { |
|  |  | return true; |
|  |  | } else { |
| Expand Down | |  |

33 changes: 24 additions & 9 deletions

33
[components/server/src/server.ts](#diff-bd6f821f67d3f4ea170ed2d0e38f54fd9094bf17aaaa5cbdba1dd8179adbaa35 "components/server/src/server.ts")

Show comments

[View file](/gitpod-io/gitpod/blob/12956988eec0031f42ffdfa3bdc3359f65628f9f/components/server/src/server.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -146,13 +146,14 @@ export class Server<C extends GitpodClient, S extends GitpodServer> { |
|  |  | // Websocket for client connection |
|  |  | const websocketConnectionHandler = this.websocketConnectionHandler; |
|  |  | this.eventEmitter.on(Server.EVENT\_ON\_START, (httpServer) => { |
|  |  | // CSRF protection: check "Origin" header, it must be either: |
|  |  | // - gitpod.io (hostUrl.hostname) or |
|  |  | // - a workspace location (ending of hostUrl.hostname) |
|  |  | // CSRF protection: check "Origin" header: |
|  |  | // - for cookie/session auth: MUST be gitpod.io (hostUrl.hostname) |
|  |  | // - for Bearer auth: MUST be sth with the same base domain (\*.gitpod.io) (is this required?) |
|  |  | // - edge case: empty "Origin" is always permitted (can this be removed?) |
|  |  | // We rely on the origin header being set correctly (needed by regular clients to use Gitpod: |
|  |  | // CORS allows subdomains to access gitpod.io) |
|  |  | const verifyCSRF = (origin: string) => { |
|  |  | let allowedRequest = isAllowedWebsocketDomain(origin, this.config.hostUrl.url.hostname); |
|  |  | const verifyOrigin = (origin: string, strict: boolean) => { |
|  |  | let allowedRequest = isAllowedWebsocketDomain(origin, this.config.hostUrl.url.hostname, strict); |
|  |  | if (!allowedRequest && this.config.insecureNoDomain) { |
|  |  | log.warn("Websocket connection CSRF guard disabled"); |
|  |  | allowedRequest = true; |
| Expand All | | @@ -164,21 +165,35 @@ export class Server<C extends GitpodClient, S extends GitpodServer> { |
|  |  | \* Verify the web socket handshake request. |
|  |  | \*/ |
|  |  | const verifyClient: ws.VerifyClientCallbackAsync = async (info, callback) => { |
|  |  | if (!verifyCSRF(info.origin)) { |
|  |  | log.warn("Websocket connection attempt with non-matching Origin header: " + info.origin); |
|  |  | return callback(false, 403); |
|  |  | } |
|  |  | let authenticatedUsingBearerToken = false; |
|  |  | if (info.req.url === "/v1") { |
|  |  | // Connection attempt with Bearer-Token: be less strict for now |
|  |  | if (!verifyOrigin(info.origin, false)) { |
|  |  | log.warn("Websocket connection attempt with non-matching Origin header: " + info.origin); |
|  |  | return callback(false, 403); |
|  |  | } |
|  |  |  |
|  |  | try { |
|  |  | await this.bearerAuth.auth(info.req as express.Request); |
|  |  | authenticatedUsingBearerToken = true; |
|  |  | } catch (e) { |
|  |  | if (isBearerAuthError(e)) { |
|  |  | return callback(false, 401, e.message); |
|  |  | } |
|  |  | log.warn("authentication failed: ", e); |
|  |  | return callback(false, 500); |
|  |  | } |
|  |  | // intentional fall-through to cookie/session based authentication |
|  |  | } |
|  |  |  |
|  |  | if (!authenticatedUsingBearerToken) { |
|  |  | // Connection attempt with cookie/session based authentication: be strict about where we accept connections from! |
|  |  | if (!verifyOrigin(info.origin, true)) { |
|  |  | log.warn("Websocket connection attempt with non-matching Origin header: " + info.origin); |
|  |  | return callback(false, 403); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | return callback(true); |
|  |  | }; |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `1295698`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgitpod-io%2Fgitpod%2Fcommit%2F12956988eec0031f42ffdfa3bdc3359f65628f9f) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_a3297285_20250115_093546.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgitpod-io%2Fgitpod%2Fcommit%2F673ab6856fa04c13b7b1f2a968e4d090f1d94e4f)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgitpod-io%2Fgitpod%2Fcommit%2F673ab6856fa04c13b7b1f2a968e4d090f1d94e4f)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=gitpod-io%2Fgitpod)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[gitpod-io](/gitpod-io)
/
**[gitpod](/gitpod-io/gitpod)**
Public

* [Notifications](/login?return_to=%2Fgitpod-io%2Fgitpod) You must be signed in to change notification settings
* [Fork
  1.3k](/login?return_to=%2Fgitpod-io%2Fgitpod)
* [Star
   13.1k](/login?return_to=%2Fgitpod-io%2Fgitpod)

* [Code](/gitpod-io/gitpod)
* [Issues
  463](/gitpod-io/gitpod/issues)
* [Pull requests
  14](/gitpod-io/gitpod/pulls)
* [Actions](/gitpod-io/gitpod/actions)
* [Security](/gitpod-io/gitpod/security)
* [Insights](/gitpod-io/gitpod/pulse)

Additional navigation options

* [Code](/gitpod-io/gitpod)
* [Issues](/gitpod-io/gitpod/issues)
* [Pull requests](/gitpod-io/gitpod/pulls)
* [Actions](/gitpod-io/gitpod/actions)
* [Security](/gitpod-io/gitpod/security)
* [Insights](/gitpod-io/gitpod/pulse)

## Commit

[Permalink](/gitpod-io/gitpod/commit/673ab6856fa04c13b7b1f2a968e4d090f1d94e4f)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Use context to store and populate origin

[Browse files](/gitpod-io/gitpod/tree/673ab6856fa04c13b7b1f2a968e4d090f1d94e4f)
Browse the repository at this point in the history

* Loading branch information

[![@easyCZ](https://avatars.githubusercontent.com/u/1419286?s=40&v=4)](/easyCZ) [![@corneliusludmann](https://avatars.githubusercontent.com/u/24960040?s=40&v=4)](/corneliusludmann)

[easyCZ](/gitpod-io/gitpod/commits?author=easyCZ "View all commits by easyCZ")
authored and
[corneliusludmann](/gitpod-io/gitpod/commits?author=corneliusludmann "View all commits by corneliusludmann")
committed
Feb 23, 2023

1 parent
[76896ac](/gitpod-io/gitpod/commit/76896ac16b90a0a43da1e6948b211a5c09993ee5)

commit 673ab68

 Show file tree

 Hide file tree

Showing
**10 changed files**
with
**191 additions**
and
**20 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* components/public-api-server/pkg

  + auth

    - components/public-api-server/pkg/auth/context.go
      [context.go](#diff-468ae7e5737cf23e6db12d13cb7d9352d8c2f1b792ac047513e0a3c360a22300)
    - components/public-api-server/pkg/auth/context\_test.go
      [context\_test.go](#diff-b8a04b1295d1725c01cf35d714c5f8677c0c29a3efe234f20fedf7dd03188e8d)
    - components/public-api-server/pkg/auth/middleware.go
      [middleware.go](#diff-ff785812db58f04f5c97608bea9386f6bb4eecb0b8310928e86ddc60ed9bacad)
  + origin

    - components/public-api-server/pkg/origin/context.go
      [context.go](#diff-e50f5f70397df6334a92af540f19cb928920bb16c016b38d315650f6b6753fae)
    - components/public-api-server/pkg/origin/context\_test.go
      [context\_test.go](#diff-6351043a811081cebb73d6789dec7b5fdbfab91940443627d65a1cc29636aab5)
    - components/public-api-server/pkg/origin/middleware.go
      [middleware.go](#diff-047a94b34799333300ec3fabb6264c83698097858ac3a48392cf083e39558620)
    - components/public-api-server/pkg/origin/middleware\_test.go
      [middleware\_test.go](#diff-10895ca101723741346f1b644837f4a6921acd2160072752de85e90b0582c0d3)
  + proxy

    - components/public-api-server/pkg/proxy/conn.go
      [conn.go](#diff-8f1993723f4f079dad5a0bbe056f22edb9a38ae518b38fc380c3172ab84571c4)
    - components/public-api-server/pkg/proxy/conn\_test.go
      [conn\_test.go](#diff-05267fc764a19c22814948cd01de7508228534102f32e686043b49dd4341184d)
  + server

    - components/public-api-server/pkg/server/server.go
      [server.go](#diff-893ee9fde09321f184961c0cf435273ce8bd2a3fb07a3631797f8068a2ef5767)

## There are no files selected for viewing

9 changes: 3 additions & 6 deletions

9
[components/public-api-server/pkg/auth/context.go](#diff-468ae7e5737cf23e6db12d13cb7d9352d8c2f1b792ac047513e0a3c360a22300 "components/public-api-server/pkg/auth/context.go")

Show comments

[View file](/gitpod-io/gitpod/blob/673ab6856fa04c13b7b1f2a968e4d090f1d94e4f/components/public-api-server/pkg/auth/context.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -25,8 +25,6 @@ const ( |
|  |  | type Token struct { |
|  |  | Type TokenType |
|  |  | Value string |
|  |  | // Only relevant for CookieTokenType |
|  |  | OriginHeader string |
|  |  | } |
|  |  |  |
|  |  | func NewAccessToken(token string) Token { |
| Expand All | | @@ -36,11 +34,10 @@ func NewAccessToken(token string) Token { |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | func NewCookieToken(cookie string, origin string) Token { |
|  |  | func NewCookieToken(cookie string) Token { |
|  |  | return Token{ |
|  |  | Type: CookieTokenType, |
|  |  | Value: cookie, |
|  |  | OriginHeader: origin, |
|  |  | Type: CookieTokenType, |
|  |  | Value: cookie, |
|  |  | } |
|  |  | } |
|  |  |  |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[components/public-api-server/pkg/auth/context\_test.go](#diff-b8a04b1295d1725c01cf35d714c5f8677c0c29a3efe234f20fedf7dd03188e8d "components/public-api-server/pkg/auth/context_test.go")

Show comments

[View file](/gitpod-io/gitpod/blob/673ab6856fa04c13b7b1f2a968e4d090f1d94e4f/components/public-api-server/pkg/auth/context_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -20,7 +20,7 @@ func TestTokenToAndFromContext\_AccessToken(t \*testing.T) { |
|  |  | } |
|  |  |  |
|  |  | func TestTokenToAndFromContext\_CookieToken(t \*testing.T) { |
|  |  | token := NewCookieToken("my\_token", "gitpod.io") |
|  |  | token := NewCookieToken("my\_token") |
|  |  |  |
|  |  | extracted, err := TokenFromContext(TokenToContext(context.Background(), token)) |
|  |  | require.NoError(t, err) |
| Expand Down | |  |

3 changes: 1 addition & 2 deletions

3
[components/public-api-server/pkg/auth/middleware.go](#diff-ff785812db58f04f5c97608bea9386f6bb4eecb0b8310928e86ddc60ed9bacad "components/public-api-server/pkg/auth/middleware.go")

Show comments

[View file](/gitpod-io/gitpod/blob/673ab6856fa04c13b7b1f2a968e4d090f1d94e4f/components/public-api-server/pkg/auth/middleware.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -41,9 +41,8 @@ func tokenFromRequest(ctx context.Context, req connect.AnyRequest) (Token, error |
|  |  | } |
|  |  |  |
|  |  | cookie := req.Header().Get("Cookie") |
|  |  | origin := req.Header().Get("Origin") |
|  |  | if cookie != "" { |
|  |  | return NewCookieToken(cookie, origin), nil |
|  |  | return NewCookieToken(cookie), nil |
|  |  | } |
|  |  |  |
|  |  | return Token{}, connect.NewError(connect.CodeUnauthenticated, fmt.Errorf("No access token or cookie credentials available on request.")) |
| Expand Down | |  |

27 changes: 27 additions & 0 deletions

27
[components/public-api-server/pkg/origin/context.go](#diff-e50f5f70397df6334a92af540f19cb928920bb16c016b38d315650f6b6753fae "components/public-api-server/pkg/origin/context.go")

Show comments

[View file](/gitpod-io/gitpod/blob/673ab6856fa04c13b7b1f2a968e4d090f1d94e4f/components/public-api-server/pkg/origin/context.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,27 @@ |
|  |  | // Copyright (c) 2023 Gitpod GmbH. All rights reserved. |
|  |  | // Licensed under the GNU Affero General Public License (AGPL). |
|  |  | // See License.AGPL.txt in the project root for license information. |
|  |  |  |
|  |  | package origin |
|  |  |  |
|  |  | import ( |
|  |  | "context" |
|  |  | ) |
|  |  |  |
|  |  | type contextKey int |
|  |  |  |
|  |  | const ( |
|  |  | originContextKey contextKey = iota |
|  |  | ) |
|  |  |  |
|  |  | func ToContext(ctx context.Context, origin string) context.Context { |
|  |  | return context.WithValue(ctx, originContextKey, origin) |
|  |  | } |
|  |  |  |
|  |  | func FromContext(ctx context.Context) string { |
|  |  | if val, ok := ctx.Value(originContextKey).(string); ok { |
|  |  | return val |
|  |  | } |
|  |  |  |
|  |  | return "" |
|  |  | } |

17 changes: 17 additions & 0 deletions

17
[components/public-api-server/pkg/origin/context\_test.go](#diff-6351043a811081cebb73d6789dec7b5fdbfab91940443627d65a1cc29636aab5 "components/public-api-server/pkg/origin/context_test.go")

Show comments

[View file](/gitpod-io/gitpod/blob/673ab6856fa04c13b7b1f2a968e4d090f1d94e4f/components/public-api-server/pkg/origin/context_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,17 @@ |
|  |  | // Copyright (c) 2023 Gitpod GmbH. All rights reserved. |
|  |  | // Licensed under the GNU Affero General Public License (AGPL). |
|  |  | // See License.AGPL.txt in the project root for license information. |
|  |  |  |
|  |  | package origin |
|  |  |  |
|  |  | import ( |
|  |  | "context" |
|  |  | "testing" |
|  |  |  |
|  |  | "github.com/stretchr/testify/require" |
|  |  | ) |
|  |  |  |
|  |  | func TestToFromContext(t \*testing.T) { |
|  |  | require.Equal(t, "some-origin", FromContext(ToContext(context.Background(), "some-origin")), "origin stored on context is extracted") |
|  |  | require.Equal(t, "", FromContext(context.Background()), "context without origin value returns empty") |
|  |  | } |

48 changes: 48 additions & 0 deletions

48
[components/public-api-server/pkg/origin/middleware.go](#diff-047a94b34799333300ec3fabb6264c83698097858ac3a48392cf083e39558620 "components/public-api-server/pkg/origin/middleware.go")

Show comments

[View file](/gitpod-io/gitpod/blob/673ab6856fa04c13b7b1f2a968e4d090f1d94e4f/components/public-api-server/pkg/origin/middleware.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,48 @@ |
|  |  | // Copyright (c) 2023 Gitpod GmbH. All rights reserved. |
|  |  | // Licensed under the GNU Affero General Public License (AGPL). |
|  |  | // See License.AGPL.txt in the project root for license information. |
|  |  |  |
|  |  | package origin |
|  |  |  |
|  |  | import ( |
|  |  | "context" |
|  |  |  |
|  |  | "github.com/bufbuild/connect-go" |
|  |  | ) |
|  |  |  |
|  |  | func NewInterceptor() \*Interceptor { |
|  |  | return &Interceptor{} |
|  |  | } |
|  |  |  |
|  |  | type Interceptor struct{} |
|  |  |  |
|  |  | func (i \*Interceptor) WrapUnary(next connect.UnaryFunc) connect.UnaryFunc { |
|  |  | return connect.UnaryFunc(func(ctx context.Context, req connect.AnyRequest) (connect.AnyResponse, error) { |
|  |  | if req.Spec().IsClient { |
|  |  | req.Header().Add("Origin", FromContext(ctx)) |
|  |  | } else { |
|  |  | origin := req.Header().Get("Origin") |
|  |  | ctx = ToContext(ctx, origin) |
|  |  | } |
|  |  |  |
|  |  | return next(ctx, req) |
|  |  | }) |
|  |  | } |
|  |  |  |
|  |  | func (a \*Interceptor) WrapStreamingClient(next connect.StreamingClientFunc) connect.StreamingClientFunc { |
|  |  | return func(ctx context.Context, s connect.Spec) connect.StreamingClientConn { |
|  |  | conn := next(ctx, s) |
|  |  | conn.RequestHeader().Add("Origin", FromContext(ctx)) |
|  |  |  |
|  |  | return conn |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | func (a \*Interceptor) WrapStreamingHandler(next connect.StreamingHandlerFunc) connect.StreamingHandlerFunc { |
|  |  | return func(ctx context.Context, conn connect.StreamingHandlerConn) error { |
|  |  | origin := conn.RequestHeader().Get("Origin") |
|  |  | ctx = ToContext(ctx, origin) |
|  |  |  |
|  |  | return next(ctx, conn) |
|  |  | } |
|  |  | } |

36 changes: 36 additions & 0 deletions

36
[components/public-api-server/pkg/origin/middleware\_test.go](#diff-10895ca101723741346f1b644837f4a6921acd2160072752de85e90b0582c0d3 "components/public-api-server/pkg/origin/middleware_test.go")

Show comments

[View file](/gitpod-io/gitpod/blob/673ab6856fa04c13b7b1f2a968e4d090f1d94e4f/components/public-api-server/pkg/origin/middleware_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,36 @@ |
|  |  | // Copyright (c) 2023 Gitpod GmbH. All rights reserved. |
|  |  | // Licensed under the GNU Affero General Public License (AGPL). |
|  |  | // See License.AGPL.txt in the project root for license information. |
|  |  |  |
|  |  | package origin |
|  |  |  |
|  |  | import ( |
|  |  | "context" |
|  |  | "testing" |
|  |  |  |
|  |  | "github.com/bufbuild/connect-go" |
|  |  | "github.com/stretchr/testify/require" |
|  |  | ) |
|  |  |  |
|  |  | func TestInterceptor\_Unary(t \*testing.T) { |
|  |  | requestPaylaod := "request" |
|  |  | origin := "my-origin" |
|  |  |  |
|  |  | type response struct { |
|  |  | origin string |
|  |  | } |
|  |  |  |
|  |  | handler := connect.UnaryFunc(func(ctx context.Context, ar connect.AnyRequest) (connect.AnyResponse, error) { |
|  |  | origin := FromContext(ctx) |
|  |  | return connect.NewResponse(&response{origin: origin}), nil |
|  |  | }) |
|  |  |  |
|  |  | ctx := context.Background() |
|  |  | request := connect.NewRequest(&requestPaylaod) |
|  |  | request.Header().Add("Origin", origin) |
|  |  |  |
|  |  | interceptor := NewInterceptor() |
|  |  | resp, err := interceptor.WrapUnary(handler)(ctx, request) |
|  |  | require.NoError(t, err) |
|  |  | require.Equal(t, &response{origin: origin}, resp.Any()) |
|  |  | } |

30 changes: 23 additions & 7 deletions

30
[components/public-api-server/pkg/proxy/conn.go](#diff-8f1993723f4f079dad5a0bbe056f22edb9a38ae518b38fc380c3172ab84571c4 "components/public-api-server/pkg/proxy/conn.go")

Show comments

[View file](/gitpod-io/gitpod/blob/673ab6856fa04c13b7b1f2a968e4d090f1d94e4f/components/public-api-server/pkg/proxy/conn.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -14,6 +14,7 @@ import ( |
|  |  | "github.com/gitpod-io/gitpod/common-go/log" |
|  |  | gitpod "github.com/gitpod-io/gitpod/gitpod-protocol" |
|  |  | "github.com/gitpod-io/gitpod/public-api-server/pkg/auth" |
|  |  | "github.com/gitpod-io/gitpod/public-api-server/pkg/origin" |
|  |  | "github.com/grpc-ecosystem/go-grpc-middleware/logging/logrus/ctxlogrus" |
|  |  |  |
|  |  | lru "github.com/hashicorp/golang-lru" |
| Expand Down  Expand Up | | @@ -41,14 +42,14 @@ func (p \*NoConnectionPool) Get(ctx context.Context, token auth.Token) (gitpod.AP |
|  |  | opts := gitpod.ConnectToServerOpts{ |
|  |  | Context: ctx, |
|  |  | Log: logger, |
|  |  | Origin: origin.FromContext(ctx), |
|  |  | } |
|  |  |  |
|  |  | switch token.Type { |
|  |  | case auth.AccessTokenType: |
|  |  | opts.Token = token.Value |
|  |  | case auth.CookieTokenType: |
|  |  | opts.Cookie = token.Value |
|  |  | opts.Origin = token.OriginHeader |
|  |  | default: |
|  |  | return nil, errors.New("unknown token type") |
|  |  | } |
| Expand Down  Expand Up | | @@ -83,11 +84,12 @@ func NewConnectionPool(address \*url.URL, poolSize int) (\*ConnectionPool, error) |
|  |  |  |
|  |  | return &ConnectionPool{ |
|  |  | cache: cache, |
|  |  | connConstructor: func(token auth.Token) (gitpod.APIInterface, error) { |
|  |  | connConstructor: func(ctx context.Context, token auth.Token) (gitpod.APIInterface, error) { |
|  |  | opts := gitpod.ConnectToServerOpts{ |
|  |  | // We're using Background context as we want the connection to persist beyond the lifecycle of a single request |
|  |  | Context: context.Background(), |
|  |  | Log: log.Log, |
|  |  | Origin: origin.FromContext(ctx), |
|  |  | CloseHandler: func(\_ error) { |
|  |  | cache.Remove(token) |
|  |  | connectionPoolSize.Dec() |
| Expand All | | @@ -99,7 +101,6 @@ func NewConnectionPool(address \*url.URL, poolSize int) (\*ConnectionPool, error) |
|  |  | opts.Token = token.Value |
|  |  | case auth.CookieTokenType: |
|  |  | opts.Cookie = token.Value |
|  |  | opts.Origin = token.OriginHeader |
|  |  | default: |
|  |  | return nil, errors.New("unknown token type") |
|  |  | } |
| Expand All | | @@ -120,15 +121,23 @@ func NewConnectionPool(address \*url.URL, poolSize int) (\*ConnectionPool, error) |
|  |  |  |
|  |  | } |
|  |  |  |
|  |  | type conenctionPoolCacheKey struct { |
|  |  | token auth.Token |
|  |  | origin string |
|  |  | } |
|  |  |  |
|  |  | type ConnectionPool struct { |
|  |  | connConstructor func(token auth.Token) (gitpod.APIInterface, error) |
|  |  | connConstructor func(context.Context, auth.Token) (gitpod.APIInterface, error) |
|  |  |  |
|  |  | // cache stores token to connection mapping |
|  |  | cache \*lru.Cache |
|  |  | } |
|  |  |  |
|  |  | func (p \*ConnectionPool) Get(ctx context.Context, token auth.Token) (gitpod.APIInterface, error) { |
|  |  | cached, found := p.cache.Get(token) |
|  |  | origin := origin.FromContext(ctx) |
|  |  |  |
|  |  | cacheKey := p.cacheKey(token, origin) |
|  |  | cached, found := p.cache.Get(cacheKey) |
|  |  | reportCacheOutcome(found) |
|  |  | if found { |
|  |  | conn, ok := cached.(\*gitpod.APIoverJSONRPC) |
| Expand All | | @@ -137,17 +146,24 @@ func (p \*ConnectionPool) Get(ctx context.Context, token auth.Token) (gitpod.APII |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | conn, err := p.connConstructor(token) |
|  |  | conn, err := p.connConstructor(ctx, token) |
|  |  | if err != nil { |
|  |  | return nil, fmt.Errorf("failed to create new connection to server: %w", err) |
|  |  | } |
|  |  |  |
|  |  | p.cache.Add(token, conn) |
|  |  | p.cache.Add(cacheKey, conn) |
|  |  | connectionPoolSize.Inc() |
|  |  |  |
|  |  | return conn, nil |
|  |  | } |
|  |  |  |
|  |  | func (p \*ConnectionPool) cacheKey(token auth.Token, origin string) conenctionPoolCacheKey { |
|  |  | return conenctionPoolCacheKey{ |
|  |  | token: token, |
|  |  | origin: origin, |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | func getEndpointBasedOnToken(t auth.Token, u \*url.URL) (string, error) { |
|  |  | switch t.Type { |
|  |  | case auth.AccessTokenType: |
| Expand Down | |  |

37 changes: 33 additions & 4 deletions

37
[components/public-api-server/pkg/proxy/conn\_test.go](#diff-05267fc764a19c22814948cd01de7508228534102f32e686043b49dd4341184d "components/public-api-server/pkg/proxy/conn_test.go")

Show comments

[View file](/gitpod-io/gitpod/blob/673ab6856fa04c13b7b1f2a968e4d090f1d94e4f/components/public-api-server/pkg/proxy/conn_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -11,6 +11,7 @@ import ( |
|  |  |  |
|  |  | gitpod "github.com/gitpod-io/gitpod/gitpod-protocol" |
|  |  | "github.com/gitpod-io/gitpod/public-api-server/pkg/auth" |
|  |  | "github.com/gitpod-io/gitpod/public-api-server/pkg/origin" |
|  |  | "github.com/golang/mock/gomock" |
|  |  | lru "github.com/hashicorp/golang-lru" |
|  |  | "github.com/stretchr/testify/require" |
| Expand All | | @@ -25,7 +26,7 @@ func TestConnectionPool(t \*testing.T) { |
|  |  | require.NoError(t, err) |
|  |  | pool := &ConnectionPool{ |
|  |  | cache: cache, |
|  |  | connConstructor: func(token auth.Token) (gitpod.APIInterface, error) { |
|  |  | connConstructor: func(ctx context.Context, token auth.Token) (gitpod.APIInterface, error) { |
|  |  | return srv, nil |
|  |  | }, |
|  |  | } |
| Expand All | | @@ -45,8 +46,36 @@ func TestConnectionPool(t \*testing.T) { |
|  |  | \_, err = pool.Get(context.Background(), bazToken) |
|  |  | require.NoError(t, err) |
|  |  | require.Equal(t, 2, pool.cache.Len(), "must keep only last two connectons") |
|  |  | require.True(t, pool.cache.Contains(barToken)) |
|  |  | require.True(t, pool.cache.Contains(bazToken)) |
|  |  | require.True(t, pool.cache.Contains(pool.cacheKey(barToken, ""))) |
|  |  | require.True(t, pool.cache.Contains(pool.cacheKey(bazToken, ""))) |
|  |  | } |
|  |  |  |
|  |  | func TestConnectionPool\_ByDistinctOrigins(t \*testing.T) { |
|  |  | ctrl := gomock.NewController(t) |
|  |  | defer ctrl.Finish() |
|  |  | srv := gitpod.NewMockAPIInterface(ctrl) |
|  |  |  |
|  |  | cache, err := lru.New(2) |
|  |  | require.NoError(t, err) |
|  |  | pool := &ConnectionPool{ |
|  |  | cache: cache, |
|  |  | connConstructor: func(ctx context.Context, token auth.Token) (gitpod.APIInterface, error) { |
|  |  | return srv, nil |
|  |  | }, |
|  |  | } |
|  |  |  |
|  |  | token := auth.NewAccessToken("foo") |
|  |  |  |
|  |  | ctxWithOriginA := origin.ToContext(context.Background(), "originA") |
|  |  | ctxWithOriginB := origin.ToContext(context.Background(), "originB") |
|  |  |  |
|  |  | \_, err = pool.Get(ctxWithOriginA, token) |
|  |  | require.NoError(t, err) |
|  |  | require.Equal(t, 1, pool.cache.Len()) |
|  |  |  |
|  |  | \_, err = pool.Get(ctxWithOriginB, token) |
|  |  | require.NoError(t, err) |
|  |  | require.Equal(t, 2, pool.cache.Len()) |
|  |  | } |
|  |  |  |
|  |  | func TestEndpointBasedOnToken(t \*testing.T) { |
| Expand All | | @@ -57,7 +86,7 @@ func TestEndpointBasedOnToken(t \*testing.T) { |
|  |  | require.NoError(t, err) |
|  |  | require.Equal(t, "wss://gitpod.io/api/v1", endpointForAccessToken) |
|  |  |  |
|  |  | endpointForCookie, err := getEndpointBasedOnToken(auth.NewCookieToken("foo", "server"), u) |
|  |  | endpointForCookie, err := getEndpointBasedOnToken(auth.NewCookieToken("foo"), u) |
|  |  | require.NoError(t, err) |
|  |  | require.Equal(t, "wss://gitpod.io/api/gitpod", endpointForCookie) |
|  |  | } |

2 changes: 2 additions & 0 deletions

2
[components/public-api-server/pkg/server/server.go](#diff-893ee9fde09321f184961c0cf435273ce8bd2a3fb07a3631797f8068a2ef5767 "components/public-api-server/pkg/server/server.go")

Show comments

[View file](/gitpod-io/gitpod/blob/673ab6856fa04c13b7b1f2a968e4d090f1d94e4f/components/public-api-server/pkg/server/server.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -26,6 +26,7 @@ import ( |
|  |  | "github.com/gitpod-io/gitpod/public-api-server/pkg/apiv1" |
|  |  | "github.com/gitpod-io/gitpod/public-api-server/pkg/auth" |
|  |  | "github.com/gitpod-io/gitpod/public-api-server/pkg/billingservice" |
|  |  | "github.com/gitpod-io/gitpod/public-api-server/pkg/origin" |
|  |  | "github.com/gitpod-io/gitpod/public-api-server/pkg/proxy" |
|  |  | "github.com/gitpod-io/gitpod/public-api-server/pkg/webhooks" |
|  |  | "github.com/sirupsen/logrus" |
| Expand Down  Expand Up | | @@ -112,6 +113,7 @@ func register(srv \*baseserver.Server, connPool proxy.ServerConnectionPool, expCl |
|  |  | NewMetricsInterceptor(connectMetrics), |
|  |  | NewLogInterceptor(log.Log), |
|  |  | auth.NewServerInterceptor(), |
|  |  | origin.NewInterceptor(), |
|  |  | ), |
|  |  | } |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `673ab68`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgitpod-io%2Fgitpod%2Fcommit%2F673ab6856fa04c13b7b1f2a968e4d090f1d94e4f) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_21de8061_20250115_093548.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgitpod-io%2Fgitpod%2Fpull%2F16378)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgitpod-io%2Fgitpod%2Fpull%2F16378)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=gitpod-io%2Fgitpod)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[gitpod-io](/gitpod-io)
/
**[gitpod](/gitpod-io/gitpod)**
Public

* [Notifications](/login?return_to=%2Fgitpod-io%2Fgitpod) You must be signed in to change notification settings
* [Fork
  1.3k](/login?return_to=%2Fgitpod-io%2Fgitpod)
* [Star
   13.1k](/login?return_to=%2Fgitpod-io%2Fgitpod)

* [Code](/gitpod-io/gitpod)
* [Issues
  463](/gitpod-io/gitpod/issues)
* [Pull requests
  14](/gitpod-io/gitpod/pulls)
* [Actions](/gitpod-io/gitpod/actions)
* [Security](/gitpod-io/gitpod/security)
* [Insights](/gitpod-io/gitpod/pulse)

Additional navigation options

* [Code](/gitpod-io/gitpod)
* [Issues](/gitpod-io/gitpod/issues)
* [Pull requests](/gitpod-io/gitpod/pulls)
* [Actions](/gitpod-io/gitpod/actions)
* [Security](/gitpod-io/gitpod/security)
* [Insights](/gitpod-io/gitpod/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fgitpod-io%2Fgitpod%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fgitpod-io%2Fgitpod%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# [server] strict same site origin for /api/gitpod endpoint #16378

 Merged

[roboquat](/roboquat)
merged 1 commit into
[main](/gitpod-io/gitpod/tree/main "gitpod-io/gitpod:main")
from
[ak/strict\_server](/gitpod-io/gitpod/tree/ak/strict_server "gitpod-io/gitpod:ak/strict_server")

Feb 14, 2023

 Merged

# [[server] strict same site origin for /api/gitpod endpoint](#top) #16378

[roboquat](/roboquat)
merged 1 commit into
[main](/gitpod-io/gitpod/tree/main "gitpod-io/gitpod:main")
from
[ak/strict\_server](/gitpod-io/gitpod/tree/ak/strict_server "gitpod-io/gitpod:ak/strict_server")

Feb 14, 2023

[Conversation
23](/gitpod-io/gitpod/pull/16378)
[Commits
1](/gitpod-io/gitpod/pull/16378/commits)
[Checks
0](/gitpod-io/gitpod/pull/16378/checks)
[Files changed](/gitpod-io/gitpod/pull/16378/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![akosyakov](https://avatars.githubusercontent.com/u/3082655?s=60&v=4)](/akosyakov)

Copy link

Member

### @akosyakov **[akosyakov](/akosyakov)** commented [Feb 13, 2023](#issue-1582693844) • edited by jeanp413 Loading

## Description

Strict same site origin for /api/gitpod endpoint

## How to test

1. Trying to create a websocket connection from workspace origin should fail `new WebSocket("wss://ak-strict-server.preview.gitpod-dev.com/api/gitpod")`

## Release Notes

```
NONE

```
## Documentation

## Build Options:

* /werft with-github-actions

  Experimental feature to run the build with GitHub Actions (and not in Werft).
* leeway-no-cache

  leeway-target=components:all
* /werft no-test

  Run Leeway with `--dont-test`

Publish Options

* /werft publish-to-npm
* /werft publish-to-jb-marketplace

Installer Options

* with-ee-license
* with-slow-database
* with-dedicated-emulation
* with-ws-manager-mk2
* workspace-feature-flags

  Add desired feature flags to the end of the line above, space separated
#### Preview Environment Options:

* /werft with-local-preview

  If enabled this will build `install/preview`
* /werft with-preview
* /werft with-large-vm
* /werft with-gce-vm

  If enabled this will create the environment on GCE infra
* /werft with-integration-tests=all

  Valid options are `all`, `workspace`, `webapp`, `ide`, `jetbrains`, `vscode`, `ssh`

Sorry, something went wrong.

All reactions

[![@roboquat](https://avatars.githubusercontent.com/u/87151047?s=40&u=3e9b38b6904b22fd7c6598e58507461b5dcaf6de&v=4)](/roboquat)
[roboquat](/roboquat)
added
[release-note-none](/gitpod-io/gitpod/labels/release-note-none)
[do-not-merge/work-in-progress](/gitpod-io/gitpod/labels/do-not-merge/work-in-progress)
labels
[Feb 13, 2023](#event-8506584098)

[![@werft-gitpod-dev-com](https://avatars.githubusercontent.com/in/78311?s=80&v=4)](/apps/werft-gitpod-dev-com)

Copy link

### **[werft-gitpod-dev-com](/apps/werft-gitpod-dev-com) bot** commented [Feb 13, 2023](#issuecomment-1428268036)

| started the job as [gitpod-build-ak-strict-server.1](https://werft.gitpod-dev.com/job/gitpod-build-ak-strict-server.1) because the annotations in the pull request description changed (with `.werft/` from `main`) |
| --- |

All reactions

Sorry, something went wrong.

[![@roboquat](https://avatars.githubusercontent.com/u/87151047?s=40&u=3e9b38b6904b22fd7c6598e58507461b5dcaf6de&v=4)](/roboquat)
[roboquat](/roboquat)
added
the
[size/S](/gitpod-io/gitpod/labels/size/S)
label
[Feb 13, 2023](#event-8506585287)

[![@iQQBot](https://avatars.githubusercontent.com/u/8299500?s=80&u=07eafe528d9dc8c520f49b433b8ededeaa87bc9a&v=4)](/iQQBot)

Copy link

Contributor

### **[iQQBot](/iQQBot)** commented [Feb 13, 2023](#issuecomment-1428293996) • edited by werft-gitpod-dev-com bot Loading

| /werft run  👍 started the job as [gitpod-build-ak-strict-server.2](https://werft.gitpod-dev.com/job/gitpod-build-ak-strict-server.2) (with `.werft/` from `main`) |
| --- |

All reactions

Sorry, something went wrong.

 [![@jeanp413](https://avatars.githubusercontent.com/u/25115070?s=40&u=b62fcdb74680dea7ed55bed6bd9952336719dbbb&v=4)](/jeanp413)
[jeanp413](/jeanp413)
[force-pushed](/gitpod-io/gitpod/compare/2b69cad4e3423f3f9c65669ef99af65df1e1a6c6..b1bfaef66a62d59d01180b2df5b55644fb978016)
the
ak/strict\_server

branch
from
[`2b69cad`](/gitpod-io/gitpod/commit/2b69cad4e3423f3f9c65669ef99af65df1e1a6c6) to
[`b1bfaef`](/gitpod-io/gitpod/commit/b1bfaef66a62d59d01180b2df5b55644fb978016)  [Compare](/gitpod-io/gitpod/compare/2b69cad4e3423f3f9c65669ef99af65df1e1a6c6..b1bfaef66a62d59d01180b2df5b55644fb978016)
[February 13, 2023 17:11](#event-8506864316)

[![@roboquat](https://avatars.githubusercontent.com/u/87151047?s=40&u=3e9b38b6904b22fd7c6598e58507461b5dcaf6de&v=4)](/roboquat)
[roboquat](/roboquat)
added
[size/M](/gitpod-io/gitpod/labels/size/M)
and removed
[size/S](/gitpod-io/gitpod/labels/size/S)
labels
[Feb 13, 2023](#event-8506865959)

 [![@jeanp413](https://avatars.githubusercontent.com/u/25115070?s=40&u=b62fcdb74680dea7ed55bed6bd9952336719dbbb&v=4)](/jeanp413)
[jeanp413](/jeanp413)
[force-pushed](/gitpod-io/gitpod/compare/b1bfaef66a62d59d01180b2df5b55644fb978016..7f6514c25bd5096122a410dad5dbd2d243f4a59f)
the
ak/strict\_server

branch
from
[`b1bfaef`](/gitpod-io/gitpod/commit/b1bfaef66a62d59d01180b2df5b55644fb978016) to
[`7f6514c`](/gitpod-io/gitpod/commit/7f6514c25bd5096122a410dad5dbd2d243f4a59f)  [Compare](/gitpod-io/gitpod/compare/b1bfaef66a62d59d01180b2df5b55644fb978016..7f6514c25bd5096122a410dad5dbd2d243f4a59f)
[February 13, 2023 17:34](#event-8507101188)

[![jeanp413](https://avatars.githubusercontent.com/u/25115070?s=60&v=4)](/jeanp413)

**[jeanp413](/jeanp413)**
reviewed
[Feb 13, 2023](#pullrequestreview-1296176181)

 [View reviewed changes](/gitpod-io/gitpod/pull/16378/files)

[components/server/src/express-util.ts](/gitpod-io/gitpod/pull/16378/files#diff-afb02a2ba5397f62d4eaf365273e0336e8b20fe0fb39ee0f8276573e72d016e0)

Show resolved

Hide resolved

 [![@jeanp413](https://avatars.githubusercontent.com/u/25115070?s=40&u=b62fcdb74680dea7ed55bed6bd9952336719dbbb&v=4)](/jeanp413)
[jeanp413](/jeanp413)
marked this pull request as ready for review
[February 13, 2023 17:55](#event-8507300919)

 [![@jeanp413](https://avatars.githubusercontent.com/u/25115070?s=40&u=b62fcdb74680dea7ed55bed6bd9952336719dbbb&v=4)](/jeanp413)
[jeanp413](/jeanp413)
requested a review
from a team
[February 13, 2023 17:55](#event-8507301007)

[![@roboquat](https://avatars.githubusercontent.com/u/87151047?s=40&u=3e9b38b6904b22fd7c6598e58507461b5dcaf6de&v=4)](/roboquat)
[roboquat](/roboquat)
removed
the
[do-not-merge/work-in-progress](/gitpod-io/gitpod/labels/do-not-merge/work-in-progress)
label
[Feb 13, 2023](#event-8507301261)

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
added
the
[team: webapp](/gitpod-io/gitpod/labels/team%3A%20webapp)
Issue belongs to the WebApp team
label
[Feb 13, 2023](#event-8507302882)

[![@jeanp413](https://avatars.githubusercontent.com/u/25115070?s=80&u=b62fcdb74680dea7ed55bed6bd9952336719dbbb&v=4)](/jeanp413)

Copy link

Member

### **[jeanp413](/jeanp413)** commented [Feb 13, 2023](#issuecomment-1428403473)

| /hold |
| --- |

All reactions

Sorry, something went wrong.

[![@roboquat](https://avatars.githubusercontent.com/u/87151047?s=40&u=3e9b38b6904b22fd7c6598e58507461b5dcaf6de&v=4)](/roboquat)
[roboquat](/roboquat)
added
the
[do-not-merge/hold](/gitpod-io/gitpod/labels/do-not-merge/hold)
label
[Feb 13, 2023](#event-8507310395)

 [![@jeanp413](https://avatars.githubusercontent.com/u/25115070?s=40&u=b62fcdb74680dea7ed55bed6bd9952336719dbbb&v=4)](/jeanp413)
[jeanp413](/jeanp413)
[force-pushed](/gitpod-io/gitpod/compare/7f6514c25bd5096122a410dad5dbd2d243f4a59f..a92d7597e50948e4a440e71a10158c10e7418be6)
the
ak/strict\_server

branch
from
[`7f6514c`](/gitpod-io/gitpod/commit/7f6514c25bd5096122a410dad5dbd2d243f4a59f) to
[`a92d759`](/gitpod-io/gitpod/commit/a92d7597e50948e4a440e71a10158c10e7418be6)  [Compare](/gitpod-io/gitpod/compare/7f6514c25bd5096122a410dad5dbd2d243f4a59f..a92d7597e50948e4a440e71a10158c10e7418be6)
[February 13, 2023 18:17](#event-8507510439)

[![AlexTugarev](https://avatars.githubusercontent.com/u/914497?s=60&v=4)](/AlexTugarev)

**[AlexTugarev](/AlexTugarev)**
reviewed
[Feb 13, 2023](#pullrequestreview-1296304165)

 [View reviewed changes](/gitpod-io/gitpod/pull/16378/files)

[components/server/src/server.ts](/gitpod-io/gitpod/pull/16378/files#diff-bd6f821f67d3f4ea170ed2d0e38f54fd9094bf17aaaa5cbdba1dd8179adbaa35)
Outdated

Show resolved

Hide resolved

 [![@AlexTugarev](https://avatars.githubusercontent.com/u/914497?s=40&u=0c97727302c7d0f054bcc9ea32b36b8b36d31fd3&v=4)](/AlexTugarev)
[AlexTugarev](/AlexTugarev)
requested a review
from [geropl](/geropl)
[February 14, 2023 09:22](#event-8513129756)

[![@AlexTugarev](https://avatars.githubusercontent.com/u/914497?s=80&u=0c97727302c7d0f054bcc9ea32b36b8b36d31fd3&v=4)](/AlexTugarev)

Copy link

Member

### **[AlexTugarev](/AlexTugarev)** commented [Feb 14, 2023](#issuecomment-1429416481)

| [@geropl](https://github.com/geropl), just FYI, I did a quick test and this kind of change does provide an effective blocking. |
| --- |

 ❤️
2
 geropl and securitymirco reacted with heart emoji

All reactions

* ❤️
  2 reactions

Sorry, something went wrong.

 [![@geropl](https://avatars.githubusercontent.com/u/32448529?s=40&u=2ca742eb0615cdafabea00f7bf3b2c0ebb99d9d3&v=4)](/geropl)
[geropl](/geropl)
[force-pushed](/gitpod-io/gitpod/compare/a92d7597e50948e4a440e71a10158c10e7418be6..a17c7368b199fda3d6f8d6c4e1443f29c06d6e33)
the
ak/strict\_server

branch
from
[`a92d759`](/gitpod-io/gitpod/commit/a92d7597e50948e4a440e71a10158c10e7418be6) to
[`a17c736`](/gitpod-io/gitpod/commit/a17c7368b199fda3d6f8d6c4e1443f29c06d6e33)  [Compare](/gitpod-io/gitpod/compare/a92d7597e50948e4a440e71a10158c10e7418be6..a17c7368b199fda3d6f8d6c4e1443f29c06d6e33)
[February 14, 2023 12:17](#event-8514852043)

[![@roboquat](https://avatars.githubusercontent.com/u/87151047?s=40&u=3e9b38b6904b22fd7c6598e58507461b5dcaf6de&v=4)](/roboquat)
[roboquat](/roboquat)
added
[size/L](/gitpod-io/gitpod/labels/size/L)
and removed
[size/M](/gitpod-io/gitpod/labels/size/M)
labels
[Feb 14, 2023](#event-8514853228)

[![AlexTugarev](https://avatars.githubusercontent.com/u/914497?s=60&v=4)](/AlexTugarev)

**[AlexTugarev](/AlexTugarev)**
reviewed
[Feb 14, 2023](#pullrequestreview-1297502951)

 [View reviewed changes](/gitpod-io/gitpod/pull/16378/files)

[components/server/src/express-util.ts](/gitpod-io/gitpod/pull/16378/files#diff-afb02a2ba5397f62d4eaf365273e0336e8b20fe0fb39ee0f8276573e72d016e0)

|  |  | if (!originHeader) { |
| --- | --- | --- |
|  |  | // TODO(gpl) Can we get rid of this dependency alltogether? |

Copy link

Member

### @AlexTugarev **[AlexTugarev](/AlexTugarev)** [Feb 14, 2023](#discussion_r1105755001)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Not sure how to read that comment. Could you clarify?

Is it planned to disallow creation of the WebSocket connection from clients other than browser agents?

If not, this check remains less meaningful outside of browser, i.e. from other clients it would be possible to set origin to any value. This is the reason to skip here and provide a signal, that this is browser-only security mechanism.

Sorry, something went wrong.

All reactions

Copy link

Member

### @geropl **[geropl](/geropl)** [Feb 14, 2023](#discussion_r1105773644)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

> Is it planned to disallow creation of the WebSocket connection from clients other than browser agents?

Yes, at least for session/cookie authentiction. BearerAuth could keep working with the check `!originHeader && !strict`.

I basically want to have more insight into how this branch is used. 👍

Sorry, something went wrong.

All reactions

[![@geropl](https://avatars.githubusercontent.com/u/32448529?s=80&u=2ca742eb0615cdafabea00f7bf3b2c0ebb99d9d3&v=4)](/geropl)

Copy link

Member

### **[geropl](/geropl)** commented [Feb 14, 2023](#issuecomment-1429693441)

| [@akosyakov](https://github.com/akosyakov) [@AlexTugarev](https://github.com/AlexTugarev) Could somebody help with testing local IDEs? I get "SSH test connection error: ip:22 connection refused" |
| --- |

All reactions

Sorry, something went wrong.

[![@akosyakov](https://avatars.githubusercontent.com/u/3082655?s=80&u=bd3b06379e946b0f71052790934d5201e3107abb&v=4)](/akosyakov)

Copy link

Member

Author

### **[akosyakov](/akosyakov)** commented [Feb 14, 2023](#issuecomment-1429700494)

| [@akosyakov](https://github.com/akosyakov) [@AlexTugarev](https://github.com/AlexTugarev) Could somebody help with testing local IDEs? I get "SSH test connection error: ip:22 connection refused"  cc [@iQQBot](https://github.com/iQQBot) maybe you can help? |
| --- |

All reactions

Sorry, something went wrong.

[![@geropl](https://avatars.githubusercontent.com/u/32448529?s=40&v=4)](/geropl)

`[[server] strict same site origin for /api/gitpod endpoint](/gitpod-io/gitpod/pull/16378/commits/4c322c72ce226da032fcce2fcf68cd1ceb508363 "[server] strict same site origin for /api/gitpod endpoint")`

`[4c322c7](/gitpod-io/gitpod/pull/16378/commits/4c322c72ce226da032fcce2fcf68cd1ceb508363)`

 [![@geropl](https://avatars.githubusercontent.com/u/32448529?s=40&u=2ca742eb0615cdafabea00f7bf3b2c0ebb99d9d3&v=4)](/geropl)
[geropl](/geropl)
[force-pushed](/gitpod-io/gitpod/compare/a17c7368b199fda3d6f8d6c4e1443f29c06d6e33..4c322c72ce226da032fcce2fcf68cd1ceb508363)
the
ak/strict\_server

branch
from
[`a17c736`](/gitpod-io/gitpod/commit/a17c7368b199fda3d6f8d6c4e1443f29c06d6e33) to
[`4c322c7`](/gitpod-io/gitpod/commit/4c322c72ce226da032fcce2fcf68cd1ceb508363)  [Compare](/gitpod-io/gitpod/compare/a17c7368b199fda3d6f8d6c4e1443f29c06d6e33..4c322c72ce226da032fcce2fcf68cd1ceb508363)
[February 14, 2023 12:55](#event-8515186379)

[![@geropl](https://avatars.githubusercontent.com/u/32448529?s=80&u=2ca742eb0615cdafabea00f7bf3b2c0ebb99d9d3&v=4)](/geropl)

Copy link

Member

### **[geropl](/geropl)** commented [Feb 14, 2023](#issuecomment-1429787429)

| Done with testing, just worked after [@iQQBot](https://github.com/iQQBot) fixed the ingress proxy 🙏 |
| --- |

All reactions

Sorry, something went wrong.

[![geropl](https://avatars.githubusercontent.com/u/32448529?s=60&v=4)](/geropl)

**[geropl](/geropl)**
approved these changes
[Feb 14, 2023](#pullrequestreview-1297656674)

 [View reviewed changes](/gitpod-io/gitpod/pull/16378/files/4c322c72ce226da032fcce2fcf68cd1ceb508363)

Copy link

Member

### @geropl **[geropl](/geropl)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Thanks [@akosyakov](https://github.com/akosyakov) , ended up taking over most of your code with one change and some more comments/logs. 🙏

Tested and LGTM ✔️

Sorry, something went wrong.

All reactions

[![@geropl](https://avatars.githubusercontent.com/u/32448529?s=80&u=2ca742eb0615cdafabea00f7bf3b2c0ebb99d9d3&v=4)](/geropl)

Copy link

Member

### **[geropl](/geropl)** commented [Feb 14, 2023](#issuecomment-1429790712)

| /unhold |
| --- |

All reactions

Sorry, something went wrong.

[![@roboquat](https://avatars.githubusercontent.com/u/87151047?s=40&u=3e9b38b6904b22fd7c6598e58507461b5dcaf6de&v=4)](/roboquat)
[roboquat](/roboquat)
removed
the
[do-not-merge/hold](/gitpod-io/gitpod/labels/do-not-merge/hold)
label
[Feb 14, 2023](#event-8515801748)

[![@roboquat](https://avatars.githubusercontent.com/u/87151047?s=40&u=3e9b38b6904b22fd7c6598e58507461b5dcaf6de&v=4)](/roboquat)
[roboquat](/roboquat)
merged commit [`2c4390a`](/gitpod-io/gitpod/commit/2c4390ac2673f9db8e5baee99fec100c1be1ac3b)
into
main

[Feb 14, 2023](https://github.com/gitpod-io/gitpod/pull/16378#event-8515808870)

 [![@roboquat](https://avatars.githubusercontent.com/u/87151047?s=40&u=3e9b38b6904b22fd7c6598e58507461b5dcaf6de&v=4)](/roboquat)
[roboquat](/roboquat)
deleted the
ak/strict\_server

branch
[February 14, 2023 14:00](#event-8515809406)

[![@roboquat](https://avatars.githubusercontent.com/u/87151047?s=40&u=3e9b38b6904b22fd7c6598e58507461b5dcaf6de&v=4)](/roboquat)
[roboquat](/roboquat)
added
[deployed: webapp](/gitpod-io/gitpod/labels/deployed%3A%20webapp)
Meta team change is running in production
[deployed](/gitpod-io/gitpod/labels/deployed)
Change is completely running in production
labels
[Feb 14, 2023](#event-8516268863)

[![@GoVulnBot](https://avatars.githubusercontent.com/u/96493708?s=40&v=4)](/GoVulnBot)
[GoVulnBot](/GoVulnBot)
mentioned this pull request
[Mar 3, 2023](#ref-issue-1608219900)

[x/vulndb: potential Go vuln in github.com/gitpod-io/gitpod: CVE-2023-0957
golang/vulndb#1605](/golang/vulndb/issues/1605)

Closed

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fgitpod-io%2Fgitpod%2Fpull%2F16378)

Reviewers

[![@jeanp413](https://avatars.githubusercontent.com/u/25115070?s=40&v=4)](/jeanp413) [jeanp413](/jeanp413)

jeanp413 left review comments

[![@easyCZ](https://avatars.githubusercontent.com/u/1419286?s=40&v=4)](/easyCZ) [easyCZ](/easyCZ)

easyCZ left review comments

[![@AlexTugarev](https://avatars.githubusercontent.com/u/914497?s=40&v=4)](/AlexTugarev) [AlexTugarev](/AlexTugarev)

AlexTugarev left review comments

[![@geropl](https://avatars.githubusercontent.com/u/32448529?s=40&v=4)](/geropl) [geropl](/geropl)

geropl approved these changes

Assignees

No one assigned

Labels

[deployed: webapp](/gitpod-io/gitpod/labels/deployed%3A%20webapp)
Meta team change is running in production
[deployed](/gitpod-io/gitpod/labels/deployed)
Change is completely running in production
[release-note-none](/gitpod-io/gitpod/labels/release-note-none)
[size/L](/gitpod-io/gitpod/labels/size/L)
[team: webapp](/gitpod-io/gitpod/labels/team%3A%20webapp)
Issue belongs to the WebApp team

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

7 participants

[![@akosyakov](https://avatars.githubusercontent.com/u/3082655?s=52&v=4)](/akosyakov) [![@iQQBot](https://avatars.githubusercontent.com/u/8299500?s=52&v=4)](/iQQBot) [![@jeanp413](https://avatars.githubusercontent.com/u/25115070?s=52&v=4)](/jeanp413) [![@AlexTugarev](https://avatars.githubusercontent.com/u/914497?s=52&v=4)](/AlexTugarev) [![@geropl](https://avatars.githubusercontent.com/u/32448529?s=52&v=4)](/geropl) [![@easyCZ](https://avatars.githubusercontent.com/u/1419286?s=52&v=4)](/easyCZ) [![@roboquat](https://avatars.githubusercontent.com/u/87151047?s=52&v=4)](/roboquat)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_70c4961a_20250115_093551.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgitpod-io%2Fgitpod%2Fpull%2F16405)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgitpod-io%2Fgitpod%2Fpull%2F16405)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=gitpod-io%2Fgitpod)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[gitpod-io](/gitpod-io)
/
**[gitpod](/gitpod-io/gitpod)**
Public

* [Notifications](/login?return_to=%2Fgitpod-io%2Fgitpod) You must be signed in to change notification settings
* [Fork
  1.3k](/login?return_to=%2Fgitpod-io%2Fgitpod)
* [Star
   13.1k](/login?return_to=%2Fgitpod-io%2Fgitpod)

* [Code](/gitpod-io/gitpod)
* [Issues
  463](/gitpod-io/gitpod/issues)
* [Pull requests
  14](/gitpod-io/gitpod/pulls)
* [Actions](/gitpod-io/gitpod/actions)
* [Security](/gitpod-io/gitpod/security)
* [Insights](/gitpod-io/gitpod/pulse)

Additional navigation options

* [Code](/gitpod-io/gitpod)
* [Issues](/gitpod-io/gitpod/issues)
* [Pull requests](/gitpod-io/gitpod/pulls)
* [Actions](/gitpod-io/gitpod/actions)
* [Security](/gitpod-io/gitpod/security)
* [Insights](/gitpod-io/gitpod/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fgitpod-io%2Fgitpod%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fgitpod-io%2Fgitpod%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# [public-api-server] Forward Origin header where provided #16405

 Merged

[roboquat](/roboquat)
merged 2 commits into
[main](/gitpod-io/gitpod/tree/main "gitpod-io/gitpod:main")
from
[gpl/papi-forward](/gitpod-io/gitpod/tree/gpl/papi-forward "gitpod-io/gitpod:gpl/papi-forward")

Feb 15, 2023

 Merged

# [[public-api-server] Forward Origin header where provided](#top) #16405

[roboquat](/roboquat)
merged 2 commits into
[main](/gitpod-io/gitpod/tree/main "gitpod-io/gitpod:main")
from
[gpl/papi-forward](/gitpod-io/gitpod/tree/gpl/papi-forward "gitpod-io/gitpod:gpl/papi-forward")

Feb 15, 2023

[Conversation
25](/gitpod-io/gitpod/pull/16405)
[Commits
2](/gitpod-io/gitpod/pull/16405/commits)
[Checks
0](/gitpod-io/gitpod/pull/16405/checks)
[Files changed](/gitpod-io/gitpod/pull/16405/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![geropl](https://avatars.githubusercontent.com/u/32448529?s=60&v=4)](/geropl)

Copy link

Member

### @geropl **[geropl](/geropl)** commented [Feb 15, 2023](#issue-1585303168) • edited Loading

## Description

## Related Issue(s)

Fixes #

## How to test

* Go to <https://gpl-papi-forward.preview.gitpod-dev.com/workspaces>
* open the network tab
* create an Organization
* notice all the public-api calls going through

## Release Notes

```
NONE

```
## Documentation

## Build Options:

* /werft with-github-actions

  Experimental feature to run the build with GitHub Actions (and not in Werft).
* leeway-no-cache

  leeway-target=components:all
* /werft no-test

  Run Leeway with `--dont-test`

Publish Options

* /werft publish-to-npm
* /werft publish-to-jb-marketplace

Installer Options

* with-ee-license
* with-slow-database
* with-dedicated-emulation
* with-ws-manager-mk2
* workspace-feature-flags

  Add desired feature flags to the end of the line above, space separated
#### Preview Environment Options:

* /werft with-local-preview

  If enabled this will build `install/preview`
* /werft with-preview
* /werft with-large-vm
* /werft with-gce-vm

  If enabled this will create the environment on GCE infra
* /werft with-integration-tests=all

  Valid options are `all`, `workspace`, `webapp`, `ide`, `jetbrains`, `vscode`, `ssh`

Sorry, something went wrong.

All reactions

 [![@geropl](https://avatars.githubusercontent.com/u/32448529?s=40&u=2ca742eb0615cdafabea00f7bf3b2c0ebb99d9d3&v=4)](/geropl)
[geropl](/geropl)
requested a review
from a team
[February 15, 2023 06:35](#event-8522547486)

[![@roboquat](https://avatars.githubusercontent.com/u/87151047?s=40&u=3e9b38b6904b22fd7c6598e58507461b5dcaf6de&v=4)](/roboquat)
[roboquat](/roboquat)
added
the
[release-note-none](/gitpod-io/gitpod/labels/release-note-none)
label
[Feb 15, 2023](#event-8522547636)

[![@werft-gitpod-dev-com](https://avatars.githubusercontent.com/in/78311?s=80&v=4)](/apps/werft-gitpod-dev-com)

Copy link

### **[werft-gitpod-dev-com](/apps/werft-gitpod-dev-com) bot** commented [Feb 15, 2023](#issuecomment-1430832230)

| started the job as [gitpod-build-gpl-papi-forward.2](https://werft.gitpod-dev.com/job/gitpod-build-gpl-papi-forward.2) because the annotations in the pull request description changed (with `.werft/` from `main`) |
| --- |

All reactions

Sorry, something went wrong.

[![@roboquat](https://avatars.githubusercontent.com/u/87151047?s=40&u=3e9b38b6904b22fd7c6598e58507461b5dcaf6de&v=4)](/roboquat)
[roboquat](/roboquat)
added
the
[size/M](/gitpod-io/gitpod/labels/size/M)
label
[Feb 15, 2023](#event-8522548405)

[![@geropl](https://avatars.githubusercontent.com/u/32448529?s=80&u=2ca742eb0615cdafabea00f7bf3b2c0ebb99d9d3&v=4)](/geropl)

Copy link

Member

Author

### **[geropl](/geropl)** commented [Feb 15, 2023](#issuecomment-1430832259)

| /hold for testing in preview env |
| --- |

All reactions

Sorry, something went wrong.

[![@roboquat](https://avatars.githubusercontent.com/u/87151047?s=40&u=3e9b38b6904b22fd7c6598e58507461b5dcaf6de&v=4)](/roboquat)
[roboquat](/roboquat)
added
the
[do-not-merge/hold](/gitpod-io/gitpod/labels/do-not-merge/hold)
label
[Feb 15, 2023](#event-8522548852)

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
added
the
[team: webapp](/gitpod-io/gitpod/labels/team%3A%20webapp)
Issue belongs to the WebApp team
label
[Feb 15, 2023](#event-8522549209)

 [![@geropl](https://avatars.githubusercontent.com/u/32448529?s=40&u=2ca742eb0615cdafabea00f7bf3b2c0ebb99d9d3&v=4)](/geropl)
[geropl](/geropl)
[force-pushed](/gitpod-io/gitpod/compare/f70eeed78e580ea037174d1bc61da36f01184b62..fee7ee4e8edea197acf7aa3cd44b0818f4e82956)
the
gpl/papi-forward

branch
from
[`f70eeed`](/gitpod-io/gitpod/commit/f70eeed78e580ea037174d1bc61da36f01184b62) to
[`fee7ee4`](/gitpod-io/gitpod/commit/fee7ee4e8edea197acf7aa3cd44b0818f4e82956)  [Compare](/gitpod-io/gitpod/compare/f70eeed78e580ea037174d1bc61da36f01184b62..fee7ee4e8edea197acf7aa3cd44b0818f4e82956)
[February 15, 2023 07:03](#event-8522728935)

[![@geropl](https://avatars.githubusercontent.com/u/32448529?s=40&v=4)](/geropl)

`[[public-api-server] Forward Origin header where provided](/gitpod-io/gitpod/pull/16405/commits/6f6fedd320d55a55e696cc6f654a0f1f5587951b "[public-api-server] Forward Origin header where provided")`

`[6f6fedd](/gitpod-io/gitpod/pull/16405/commits/6f6fedd320d55a55e696cc6f654a0f1f5587951b)`

 [![@geropl](https://avatars.githubusercontent.com/u/32448529?s=40&u=2ca742eb0615cdafabea00f7bf3b2c0ebb99d9d3&v=4)](/geropl)
[geropl](/geropl)
[force-pushed](/gitpod-io/gitpod/compare/fee7ee4e8edea197acf7aa3cd44b0818f4e82956..6f6fedd320d55a55e696cc6f654a0f1f5587951b)
the
gpl/papi-forward

branch
from
[`fee7ee4`](/gitpod-io/gitpod/commit/fee7ee4e8edea197acf7aa3cd44b0818f4e82956) to
[`6f6fedd`](/gitpod-io/gitpod/commit/6f6fedd320d55a55e696cc6f654a0f1f5587951b)  [Compare](/gitpod-io/gitpod/compare/fee7ee4e8edea197acf7aa3cd44b0818f4e82956..6f6fedd320d55a55e696cc6f654a0f1f5587951b)
[February 15, 2023 07:06](#event-8522750871)

[![@geropl](https://avatars.githubusercontent.com/u/32448529?s=80&u=2ca742eb0615cdafabea00f7bf3b2c0ebb99d9d3&v=4)](/geropl)

Copy link

Member

Author

### **[geropl](/geropl)** commented [Feb 15, 2023](#issuecomment-1430890147) • edited by werft-gitpod-dev-com bot Loading

| /werft run  👍 started the job as [gitpod-build-gpl-papi-forward.5](https://werft.gitpod-dev.com/job/gitpod-build-gpl-papi-forward.5) (with `.werft/` from `main`)  🐌 DB... |
| --- |

All reactions

Sorry, something went wrong.

[![easyCZ](https://avatars.githubusercontent.com/u/1419286?s=60&v=4)](/easyCZ)

**[easyCZ](/easyCZ)**
reviewed
[Feb 15, 2023](#pullrequestreview-1298990245)

 [View reviewed changes](/gitpod-io/gitpod/pull/16405/files/6f6fedd320d55a55e696cc6f654a0f1f5587951b)

[components/public-api-server/pkg/auth/context.go](/gitpod-io/gitpod/pull/16405/files/6f6fedd320d55a55e696cc6f654a0f1f5587951b#diff-468ae7e5737cf23e6db12d13cb7d9352d8c2f1b792ac047513e0a3c360a22300)
Outdated

Show resolved

Hide resolved

[![easyCZ](https://avatars.githubusercontent.com/u/1419286?s=60&v=4)](/easyCZ)

**[easyCZ](/easyCZ)**
reviewed
[Feb 15, 2023](#pullrequestreview-1298991031)

 [View reviewed changes](/gitpod-io/gitpod/pull/16405/files/6f6fedd320d55a55e696cc6f654a0f1f5587951b)

[components/public-api-server/pkg/proxy/conn.go](/gitpod-io/gitpod/pull/16405/files/6f6fedd320d55a55e696cc6f654a0f1f5587951b#diff-8f1993723f4f079dad5a0bbe056f22edb9a38ae518b38fc380c3172ab84571c4)
Outdated

Show resolved

Hide resolved

[![@roboquat](https://avatars.githubusercontent.com/u/87151047?s=40&u=3e9b38b6904b22fd7c6598e58507461b5dcaf6de&v=4)](/roboquat)
[roboquat](/roboquat)
added
[size/L](/gitpod-io/gitpod/labels/size/L)
and removed
[size/M](/gitpod-io/gitpod/labels/size/M)
labels
[Feb 15, 2023](#event-8525651863)

 [![@easyCZ](https://avatars.githubusercontent.com/u/1419286?s=40&u=a84694fc031d5747d8bbd785359da09a16ef5882&v=4)](/easyCZ)
[easyCZ](/easyCZ)
[force-pushed](/gitpod-io/gitpod/compare/394330f7c0eea71f94ad4d9018d78e437062a454..3483089bc8f86e023f51cbb44eb772d68259b82d)
the
gpl/papi-forward

branch
from
[`394330f`](/gitpod-io/gitpod/commit/394330f7c0eea71f94ad4d9018d78e437062a454) to
[`3483089`](/gitpod-io/gitpod/commit/3483089bc8f86e023f51cbb44eb772d68259b82d)  [Compare](/gitpod-io/gitpod/compare/394330f7c0eea71f94ad4d9018d78e437062a454..3483089bc8f86e023f51cbb44eb772d68259b82d)
[February 15, 2023 12:56](#event-8525771168)

[![@easyCZ](https://avatars.githubusercontent.com/u/1419286?s=80&u=a84694fc031d5747d8bbd785359da09a16ef5882&v=4)](/easyCZ)

Copy link

Member

### **[easyCZ](/easyCZ)** commented [Feb 15, 2023](#issuecomment-1431328627) • edited Loading

| [@geropl](https://github.com/geropl) Added the context-style approach.   1. Middleware always extracts the Origin 2. The cached client constructor always populates it with the extracted value 3. Also udpated the cache key to include the origin, to prevent one origin being used to populate the cache, and another to (ab)use it |
| --- |

 👀
1
 geropl reacted with eyes emoji

All reactions

* 👀
  1 reaction

Sorry, something went wrong.

[![@easyCZ](https://avatars.githubusercontent.com/u/1419286?s=40&v=4)](/easyCZ)

`[Use context to store and populate origin](/gitpod-io/gitpod/pull/16405/commits/21275b3e562867d7a0f0e094e019a5a4432bafaa "Use context to store and populate origin")`

`[21275b3](/gitpod-io/gitpod/pull/16405/commits/21275b3e562867d7a0f0e094e019a5a4432bafaa)`

 [![@easyCZ](https://avatars.githubusercontent.com/u/1419286?s=40&u=a84694fc031d5747d8bbd785359da09a16ef5882&v=4)](/easyCZ)
[easyCZ](/easyCZ)
[force-pushed](/gitpod-io/gitpod/compare/3483089bc8f86e023f51cbb44eb772d68259b82d..21275b3e562867d7a0f0e094e019a5a4432bafaa)
the
gpl/papi-forward

branch
from
[`3483089`](/gitpod-io/gitpod/commit/3483089bc8f86e023f51cbb44eb772d68259b82d) to
[`21275b3`](/gitpod-io/gitpod/commit/21275b3e562867d7a0f0e094e019a5a4432bafaa)  [Compare](/gitpod-io/gitpod/compare/3483089bc8f86e023f51cbb44eb772d68259b82d..21275b3e562867d7a0f0e094e019a5a4432bafaa)
[February 15, 2023 12:59](#event-8525797329)

[![geropl](https://avatars.githubusercontent.com/u/32448529?s=60&v=4)](/geropl)

**[geropl](/geropl)**
commented
[Feb 15, 2023](#pullrequestreview-1299448402)

 [View reviewed changes](/gitpod-io/gitpod/pull/16405/files/21275b3e562867d7a0f0e094e019a5a4432bafaa)

[components/public-api-server/pkg/origin/context.go](/gitpod-io/gitpod/pull/16405/files/21275b3e562867d7a0f0e094e019a5a4432bafaa#diff-e50f5f70397df6334a92af540f19cb928920bb16c016b38d315650f6b6753fae)

|  |  | ) |
| --- | --- | --- |
|  |  |  |
|  |  | func ToContext(ctx context.Context, origin string) context.Context { |
|  |  | return context.WithValue(ctx, originContextKey, origin) |

Copy link

Member

Author

### @geropl **[geropl](/geropl)** [Feb 15, 2023](#discussion_r1107094795)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Ah, I like this!

Sorry, something went wrong.

All reactions

[![geropl](https://avatars.githubusercontent.com/u/32448529?s=60&v=4)](/geropl)

**[geropl](/geropl)**
commented
[Feb 15, 2023](#pullrequestreview-1299453961)

 [View reviewed changes](/gitpod-io/gitpod/pull/16405/files/21275b3e562867d7a0f0e094e019a5a4432bafaa)

[components/public-api-server/pkg/origin/middleware.go](/gitpod-io/gitpod/pull/16405/files/21275b3e562867d7a0f0e094e019a5a4432bafaa#diff-047a94b34799333300ec3fabb6264c83698097858ac3a48392cf083e39558620)

|  |  | func (i \*Interceptor) WrapUnary(next connect.UnaryFunc) connect.UnaryFunc { |
| --- | --- | --- |
|  |  | return connect.UnaryFunc(func(ctx context.Context, req connect.AnyRequest) (connect.AnyResponse, error) { |
|  |  | if req.Spec().IsClient { |
|  |  | req.Header().Add("Origin", FromContext(ctx)) |

Copy link

Member

Author

### @geropl **[geropl](/geropl)** [Feb 15, 2023](#discussion_r1107098514)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Trying to understand what this branch is for: Is this interceptor both usable for servers and clients (e.g., when forwarding upstream)? 🤔

Sorry, something went wrong.

All reactions

Copy link

Member

### @easyCZ **[easyCZ](/easyCZ)** [Feb 15, 2023](#discussion_r1107100940) • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Correct. The way the interceptor is implemented (as per the interceptor inteface) is that you could write a single interceptor for both clients, and servers.

Here, we don't focus on the client version too much, but we do "make it work" by honouring the value that was on the context.

Sorry, something went wrong.

 👍
1
 geropl reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

[![geropl](https://avatars.githubusercontent.com/u/32448529?s=60&v=4)](/geropl)

**[geropl](/geropl)**
commented
[Feb 15, 2023](#pullrequestreview-1299454835)

 [View reviewed changes](/gitpod-io/gitpod/pull/16405/files/21275b3e562867d7a0f0e094e019a5a4432bafaa)

[components/public-api-server/pkg/proxy/conn.go](/gitpod-io/gitpod/pull/16405/files/21275b3e562867d7a0f0e094e019a5a4432bafaa#diff-8f1993723f4f079dad5a0bbe056f22edb9a38ae518b38fc380c3172ab84571c4)

|  |  |  |
| --- | --- | --- |
|  |  | // cache stores token to connection mapping |
|  |  | cache \*lru.Cache |
|  |  | } |
|  |  |  |
|  |  | func (p \*ConnectionPool) Get(ctx context.Context, token auth.Token) (gitpod.APIInterface, error) { |
|  |  | cached, found := p.cache.Get(token) |

Copy link

Member

Author

### @geropl **[geropl](/geropl)** [Feb 15, 2023](#discussion_r1107099159)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

💯

Sorry, something went wrong.

All reactions

[![@geropl](https://avatars.githubusercontent.com/u/32448529?s=80&u=2ca742eb0615cdafabea00f7bf3b2c0ebb99d9d3&v=4)](/geropl)

Copy link

Member

Author

### **[geropl](/geropl)** commented [Feb 15, 2023](#issuecomment-1431340590) • edited Loading

| [@easyCZ](https://github.com/easyCZ) Thank you, I like it (and tested and works) ✔️  Would you go ahead and approve your own code? 🙃 |
| --- |

All reactions

Sorry, something went wrong.

[![easyCZ](https://avatars.githubusercontent.com/u/1419286?s=60&v=4)](/easyCZ)

**[easyCZ](/easyCZ)**
approved these changes
[Feb 15, 2023](#pullrequestreview-1299461592)

 [View reviewed changes](/gitpod-io/gitpod/pull/16405/files/21275b3e562867d7a0f0e094e019a5a4432bafaa)

[![@easyCZ](https://avatars.githubusercontent.com/u/1419286?s=80&u=a84694fc031d5747d8bbd785359da09a16ef5882&v=4)](/easyCZ)

Copy link

Member

### **[easyCZ](/easyCZ)** commented [Feb 15, 2023](#issuecomment-1431345142) • edited by werft-gitpod-dev-com bot Loading

| Would you go ahead and approve your own code? 🙃  Care to create a few more "blank check" PRs for me? |
| --- |

 😄
1
 geropl reacted with laugh emoji

All reactions

* 😄
  1 reaction

Sorry, something went wrong.

[![@easyCZ](https://avatars.githubusercontent.com/u/1419286?s=80&u=a84694fc031d5747d8bbd785359da09a16ef5882&v=4)](/easyCZ)

Copy link

Member

### **[easyCZ](/easyCZ)** commented [Feb 15, 2023](#issuecomment-1431472907)

| /unhold |
| --- |

All reactions

Sorry, something went wrong.

[![@roboquat](https://avatars.githubusercontent.com/u/87151047?s=40&u=3e9b38b6904b22fd7c6598e58507461b5dcaf6de&v=4)](/roboquat)
[roboquat](/roboquat)
removed
the
[do-not-merge/hold](/gitpod-io/gitpod/labels/do-not-merge/hold)
label
[Feb 15, 2023](#event-8526791388)

[![@roboquat](https://avatars.githubusercontent.com/u/87151047?s=40&u=3e9b38b6904b22fd7c6598e58507461b5dcaf6de&v=4)](/roboquat)
[roboquat](/roboquat)
merged commit [`0a7ca4c`](/gitpod-io/gitpod/commit/0a7ca4c08afc83dc6e801198f8f979a6a7c67d1f)
into
main

[Feb 15, 2023](https://github.com/gitpod-io/gitpod/pull/16405#event-8526799984)

 [![@roboquat](https://avatars.githubusercontent.com/u/87151047?s=40&u=3e9b38b6904b22fd7c6598e58507461b5dcaf6de&v=4)](/roboquat)
[roboquat](/roboquat)
deleted the
gpl/papi-forward

branch
[February 15, 2023 14:39](#event-8526800316)

[![@roboquat](https://avatars.githubusercontent.com/u/87151047?s=40&u=3e9b38b6904b22fd7c6598e58507461b5dcaf6de&v=4)](/roboquat)
[roboquat](/roboquat)
added
the
[deployed: webapp](/gitpod-io/gitpod/labels/deployed%3A%20webapp)
Meta team change is running in production
label
[Feb 16, 2023](#event-8534073415)

[![@roboquat](https://avatars.githubusercontent.com/u/87151047?s=40&u=3e9b38b6904b22fd7c6598e58507461b5dcaf6de&v=4)](/roboquat)
[roboquat](/roboquat)
added
the
[deployed](/gitpod-io/gitpod/labels/deployed)
Change is completely running in production
label
[Feb 16, 2023](#event-8534073539)

[![@GoVulnBot](https://avatars.githubusercontent.com/u/96493708?s=40&v=4)](/GoVulnBot)
[GoVulnBot](/GoVulnBot)
mentioned this pull request
[Mar 3, 2023](#ref-issue-1608219900)

[x/vulndb: potential Go vuln in github.com/gitpod-io/gitpod: CVE-2023-0957
golang/vulndb#1605](/golang/vulndb/issues/1605)

Closed

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fgitpod-io%2Fgitpod%2Fpull%2F16405)

Reviewers

[![@easyCZ](https://avatars.githubusercontent.com/u/1419286?s=40&v=4)](/easyCZ) [easyCZ](/easyCZ)

easyCZ approved these changes

Assignees

No one assigned

Labels

[deployed: webapp](/gitpod-io/gitpod/labels/deployed%3A%20webapp)
Meta team change is running in production
[deployed](/gitpod-io/gitpod/labels/deployed)
Change is completely running in production
[release-note-none](/gitpod-io/gitpod/labels/release-note-none)
[size/L](/gitpod-io/gitpod/labels/size/L)
[team: webapp](/gitpod-io/gitpod/labels/team%3A%20webapp)
Issue belongs to the WebApp team

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

3 participants

[![@geropl](https://avatars.githubusercontent.com/u/32448529?s=52&v=4)](/geropl) [![@easyCZ](https://avatars.githubusercontent.com/u/1419286?s=52&v=4)](/easyCZ) [![@roboquat](https://avatars.githubusercontent.com/u/87151047?s=52&v=4)](/roboquat)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from snyk.io_e82d3af9_20250115_093552.html ===
You need to enable JavaScript to run this app.[Skip to main content](#main-content)

* Products

  Products

  + [What is Snyk?

    Developer-first security in action](/product/)
  + [Snyk Code

    Secure your code as it's written](/product/snyk-code/)
  + [Snyk Open Source

    Avoid vulnerable dependencies](/product/open-source-security-management/)
  + [Snyk Container

    Keep your base images secure](/product/container-vulnerability-management/)
  + [Snyk IaC

    Fix IaC misconfigurations in-code](/product/infrastructure-as-code-security/)
  + [Snyk AppRisk

    Reduce risk across your business](/product/snyk-apprisk/)
  + [Pricing](/plans/)

  Solutions

  + [Why Snyk?

    Modern security in a single platform](/platform/)
  + [Application security

    Build secure, stay secure](/solutions/application-security/)
  + [Software supply chain security

    Mitigate supply chain risk](/solutions/software-supply-chain-security/)
  + [Secure-AI-generated code

    AI writes, Snyk secures](/solutions/secure-ai-generated-code/)
  + [Zero-day vulnerabilities

    Fix the first day with Snyk](/solutions/zero-day-vulnerability-security/)
  + [Security Intelligence

    Comprehensive vulnerability data](/platform/security-intelligence/)

  Platform

  + [DeepCode AI

    Purpose-built security AI](/platform/deepcode-ai/)
  + [Integrations

    SDLC-spanning security](/integrations/)
  + [Code Checker

    Write better code for free](/code-checker/)

  Audience

  + [Snyk for devs

    Dev-centric info on demand](https://go.snyk.io/2024-dev-onboarding.html)
  + [Snyk for government

    Mission-informed AppSec](/government-security-solution/)
  + [Leaders handbook

    SAST essentials for genAI](/lp/securing-ai-generated-code/)![default-report.b205b2e0](https://res.cloudinary.com/snyk/image/upload/v1729618965/default-report.b205b2e0.svg)

  Secure Adoption in Gen AI Era Report

  [Read report](https://go.snyk.io/secure-adoption-in-genai-era.html "Read report")
* Resources

  Our resources

  + [Resource library

    Browse our extensive database](/resource-library/)
  + [Customer resources

    The one stop shop for customers](/customer-resources/)
  + [Ethical hacking

    How ethical hacking can help you](/ethical-hacking-resources/)
  + [Security leaders

    Insights from industry leaders](/security-leaders/)
  + [Top 10 vulns

    See the most common vuln types](/snyk-top-10/)
  + [Blog Section](/blog/)
  + [Snyk's podcasts](/podcasts/the-secure-developer/)
  + [Snyk’s YouTube](https://www.youtube.com/snyksec)

  Our ecosystem

  + [Snyk Learn

    Security education from Snyk](https://learn.snyk.io)
  + [Snyk user docs

    Get started with Snyk](https://docs.snyk.io/)
  + [Snyk Support

    How can we help?](https://support.snyk.io/hc/en-us)
  + [Snyk Vuln Database

    Find new vulnerabilities](https://security.snyk.io/)
  + [Snyk Updates

    Stay in the loop](https://updates.snyk.io/)

  Our community

  + [Events & webinars](/events/)
  + [Ambassadors](/snyk-ambassadors/)
  + [Discord channel](https://snyk.co/discordcommunity)![feature-snyk-snowflake](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1717461856%2Ffeature-snyk-snowflake.jpg&w=2560&q=75)

  Extend the power of your AppSec data with the new Snyk and Snowflake integration

  [Read blog](/blog/snyk-snowflake-data-share/ "Read blog")
* Company

  Company

  ## The developer security platform

  Snyk gives you the visibility, context, and control you need to work alongside developers on reducing application risk.

  [More about us](/about/ "More about us")
  + [Our services

    Maximize your AppSec ROI](/services/)
  + [Our customers

    We help customers save time and money](/customers/)
  + [Our partners

    Bringing business class security with partners](/partners/)
  + [Case studies

    Check out our customer stories and stats](/case-studies/)
  + [Newsroom

    See the latest press releases](/news/)
  + [Contact us

    Get in touch with any feedback or questions](/contact-us/)
  + [Careers

    Join Snyk today](/careers/)![Snyk_Probely](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1730905024%2FSnyk_Probely.jpg&w=2560&q=75)

  Snyk Acquires Developer-First DAST Provider Probely

  [Read press release](/news/snyk-acquires-developer-first-dast-provider-probely/ "Read press release")
* [Pricing](/plans/)

ENSelect your languageEnglishDeutschFrançais日本語Português (BR)Login

Free and Team Plan Customers

* [Snyk

  app.snyk.io](https://app.snyk.io)

Enterprise Plan Customers

* [*🇺🇸*

  Snyk US - 1

  app.snyk.io](https://app.snyk.io)
* [*🇺🇸*

  Snyk US - 2

  app.us.snyk.io](https://app.us.snyk.io)
* [*🇪🇺*

  Snyk EU

  app.eu.snyk.io](https://app.eu.snyk.io)
* [*🇦🇺*

  Snyk AU

  app.au.snyk.io](https://app.au.snyk.io)

The region where your data is hosted follows local agreements, and it may not align with your own location. [Find out more](https://docs.snyk.io/working-with-snyk/regional-hosting-and-data-residency).[Sign up](https://app.snyk.io/signup "Sign up")[Book a live demo](/schedule-a-demo/ "Book a live demo")[Snyk Blog](/blog/)
# Gitpod remote code execution 0-day vulnerability via WebSockets

Written by: ![Elliot Ward](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1717438164%2Felliot.png&w=48&q=75)

[Elliot Ward](/contributors/elliot-ward/)

![blog-feature-pypi-spoof](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1676482568%2Fblog-feature-pypi-spoof.jpg&w=2560&q=75)

February 27, 2023

 0 mins read
## TLDR

This article walks us through a current Snyk Security Labs research project focusing on cloud based development environments (CDEs) — which resulted in a full workspace takeover on the Gitpod platform and extended to the user’s SCM account. The issues here have been responsibly disclosed to Gitpod and were resolved within a single working day!

## Cloud development environments and Gitpod

As more and more companies begin to leverage cloud-based development environments for benefits such as improved performance, developer experience, consistent development environments, and low setup times, we couldn’t help but wonder about the security implications of adopting these cloud based IDEs.

First, let’s provide a brief overview of how CDEs operate so we can understand the difference between cloud-based and traditional, local-workstation based development — and how it changes the developer security landscape.

In contrast to traditional development, CDEs run on a cloud hosted machine with an IDE backend. This typically provides a web application version of the IDE and support for integrating with a locally installed IDE over SSH, giving users a seamless and familiar experience. When using a CDE, the organization’s code and any supporting services, such as a development database, are hosted within the cloud. Check out the following diagram for a visual representation of information flow in a CDE.

![blog-websocket-takeover-cde-diagram](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1677520205%2Fblog-websocket-takeover-cde-diagram.jpg&w=1240&q=75)

The security risks of locally installed development environments are not new. However, they historically haven’t received much attention from developers. In May 2021, Snyk disclosed [vulnerable VS Code extensions](/blog/visual-studio-code-extension-security-vulnerabilities-deep-dive/) that lead to a 1-click data leak or arbitrary command execution. These traditional workstation-based development environments, such as a local instance of VS Code or IntelliJ, carry other information security concerns — including hardware failure, data security, and malware. While these concerns can be addressed by employing Full Disk Encryption, version control, backups, and anti-malware systems, many questions remain unanswered with the adoption of cloud-based development environments:

* What happens if a cloud IDE workspace is infected with malware?
* What happens when access controls are insufficient and allow cross-user or even cross-organization access to workspaces?
* What happens when a rogue developer exfiltrates company intellectual property from a cloud-hosted machine outside the visibility of the organization's data loss prevention or endpoint security software?

In a current security research project here at Snyk, we examine the security implications of adopting cloud based IDEs. In this article we present a case study of one of the vulnerabilities discovered during our initial exploration in the Gitpod platform.

## Examining the Gitpod platform

**Disclaimer:** When it came to looking at cloud IDE solutions for our research, we settled on either self-hosted or cloud-based solutions, where the vendor has a clearly defined security policy providing safe harbor for researchers.

One of the most popular CDE’s is [Gitpod](https://www.gitpod.io/). Its wide adoption and extended feature set — including automated backups, Git integration out of the box, and multiple IDE backends — ensured that Gitpod was among the first products we looked into.

The first stage of our research involved becoming familiar with the basic workflows of Gitpod, setting up an organization, and experimenting with the product while capturing traffic using Burpsuite to observe the various APIs and transactions. We then pulled the Gitpod source code from GitHub to study the inner workings of its APIs, and reviewed any relevant architecture documentation to better understand each of the components and their function. A great resource for this was a [video that provided an initial deep dive into the architecture of Gitpod](https://www.youtube.com/watch?v=svV-uE0Cdjk). At a high level, Gitpod leverages multiple microservices deployed in a Kubernetes environment, where each user workspace is deployed to a dedicated ephemeral pod.

Gitpod’s primary set of external components are concerned with the dashboard, authentication, and the creation and management of workspaces, organizations, and accounts. At its core, the main component here is aptly named *server*, a TypeScript application that exposes a JSONRPC API over WebSocket that is consumed by a React frontend called *dashboard*.

From the dashboard, it’s easy to integrate with a SCM provider, such as GitHub or Bitbucket, to import a repository and spin up a development environment — which then serves the source code and provides a working Git environment. Once the workspace is provisioned, it is made accessible via `SSH` and `HTTPS` on a subdomain of gitpod.io (i.e `https://[WORKSPACE_NAME].[CLUSTER_NAME].gitpod.io`) through a Golang-based component called *ws-proxy*.

The security vulnerability that was discovered through our research relates primarily to the *server* component and the JSONRPC served over a WebSocket connection, which ultimately led to a workspace takeover in Gitpod.

## Technical details

### WebSockets and Same Origin Policy

WebSocket is a technology that allows for real-time, two-way communication between a client (typically a web browser) and a server. It enables a persistent connection between the client and server, allowing for continuous “real-time” data transfer without the need for repeated HTTP requests.

An interesting aspect of WebSockets from a security perspective, is that a browser security mechanism, the [Same Origin Policy](https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy) (SOP), does not apply. This is the security control which prevents a website from issuing an AJAX request to another website and being able to read the response. If this were possible, it would present a security concern because browsers typically submit cookies along with every request (even for Cross Origin requests, such as [CSRF related attacks](https://learn.snyk.io/lessons/csrf-attack/javascript/)). Without SOP, any website would be able to issue requests to foreign websites and obtain your data from other domains.

This leads us to the vulnerability class known as Cross-Site WebSocket Hijacking. This attack is similar to a combination of a Cross-Site Request Forgery and CORS misconfiguration. When a WebSocket handshake relies solely upon HTTP cookies for authentication, a malicious website is able to instantiate a new WebSocket connection to the vulnerable application, allowing an attacker to both send and receive data through the connection.

When reviewing an application with WebSocket connections, it’s always worth examining this in depth. Let’s take a look at the WebSocket request for the Gitpod server.

![blog-websocket-takeover-gitpod.io-upgrade](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1677520235%2Fblog-websocket-takeover-gitpod.io-upgrade.jpg&w=2560&q=75)![blog-websocket-takeover-switching-protocols-feb-9](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1677520235%2Fblog-websocket-takeover-switching-protocols-feb-9.jpg&w=2560&q=75)

In normal circumstances, the connection is successfully upgraded to a WebSocket and communication begins. There was no additional authentication taking place within the WebSocket exchange itself, and the JSONRPC can be invoked via the WebSocket connection.

![blog-websocket-takeover-jsonrpc-2.0](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1677520235%2Fblog-websocket-takeover-jsonrpc-2.0.jpg&w=1240&q=75)

So far, we’ve found no additional authentication taking place within the established channel — a good sign for any potential attackers. Now, let's verify that no additional *Origin* checks are taking place by taking a handshake we have observed and tampering with the *Origin* header.

![blog-websocket-takeover-origin-workspace-id](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1677520235%2Fblog-websocket-takeover-origin-workspace-id.jpg&w=2560&q=75)![blog-websocket-takeover-switching-protocols-feb-12](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1677520235%2Fblog-websocket-takeover-switching-protocols-feb-12.jpg&w=2560&q=75)

This looks promising! It seems that the domain `evil.com` is able to issue Cross-Origin WebSocket requests to `gitpod.io`. However, another security mechanism introduces a challenge.

### SameSite Cookie bypass

SameSite cookies are a fairly recent addition, providing partial mitigation against Cross-Site Request Forgery (CSRF) attacks. While not everyone has adopted them, most popular browsers have made the default value for all cookies which do not explicitly disable `SameSite` to be `Lax`. So while the underlying vulnerability is present, without a bypass for `SameSite` cookies our attack would largely be theoretical and only work against a subset of outdated and niche browsers.

So what is a `site` in the context of `SameSite`? Simply put, the site corresponds to the combination of the scheme and the registrable domain (if any) of the origin’s host. If we look at the specifications for `SameSite` we can see that subdomains are not considered. This is more relaxed than the specification of an Origin used by the Same Origin Policy, which is comprised of a scheme + host (including subdomains) + port (eg: https://security.snyk.io:8443).

![blog-websocket-takeover-url-breakdown](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1677520235%2Fblog-websocket-takeover-url-breakdown.jpg&w=2560&q=75)

Earlier, we observed that the workspace was exposed via a subdomain on `gitpod.io`. In the context of `SameSite`, the workspace URL is considered to be the same site as `gitpod.io`. So, it should be possible for one workspace to issue a cross-domain `SameSite` request to a `*.gitpod.io` domain with the original user’s cookies attached. Let’s see if we can leverage an attacker controlled workspace to serve a WebSocket Hijacking payload.

To first verify that the cookies are indeed transmitted and the WebSocket communication is successfully achieved, let's open the browser console from a workspace and attempt to initiate a WebSocket connection.

![blog-websocket-takeover-gitpod-outline-cropped](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1677695393%2Fblog-websocket-takeover-gitpod-outline-cropped.jpg&w=2560&q=75)

As we can see in the above screenshot, we attempt to open a new WebSocket connection and, once open, submit a JSONRPC request. We can see in the console output that a message has been received containing the result of our request, confirming that the cookies are submitted and the origin is permitted to open a websocket to `gitpod.io`.

We now need a way to serve JavaScript from the workspace that can be accessed by a Gitpod user. When looking through the features available, it is possible to expose ports in the workspace and make them accessible using a command line utility called `gitpod-cli` — available on the path inside the workspace by typing `gp`. We can invoke `gp ports expose 8080`, and then set up a basic Python web server using `python -m http.server 8080`. This in turn creates a new subdomain where the exposed port can be accessed as shown below.

![blog-websocket-takeover-consol-error](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1677520236%2Fblog-websocket-takeover-consol-error.jpg&w=2560&q=75)

However, the connection failed. This is somewhat concerning and requires more investigation. Here we open the source code and start looking for what could be causing the problem. We found the following regular expression pattern, which appears to be used to extract the workspace name from the URL.

![blog-websocket-takeover-base-workspace-id](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1677520236%2Fblog-websocket-takeover-base-workspace-id.jpg&w=2560&q=75)

The way this matching is performed results in the wrong workspace name being extracted, as demonstrated in the following screenshot:

![blog-websocket-takeover-test-string](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1677520235%2Fblog-websocket-takeover-test-string.jpg&w=2560&q=75)

So, it looks like we can’t serve our content from an exposed port inside the Gitpod hosted workspace and we need another way. By now we already know that we have privileged access to a machine that's running the VS Code service and is serving requests issued to our workspace URL — so can we abuse this in some way?

The initial idea was to terminate the `vscode` process and start a Python web server to serve an HTML file. Unfortunately, this did not work and resulted in the workspace being restarted. This appeared to be performed by a local service `supervisor`. While testing this approach we noticed that when we terminated the process without binding another process to the VS Code port, the `supervisor` service will automatically restart the `vscode` process, resulting in a brief hang to the UI without a full restart of the workspace.

This brought a promising idea. Can we patch VS Code to serve a built-in exploit for us?

Patching VS Code was relatively easy. By comparing the original VS Code server source code to the distributed version, we quickly found a convenient location to serve the exploit.

VS Code contains an API endpoint at `/version`, which returns the commit of the current version:

![blog-websocket-takeover-pathname-version](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1677520235%2Fblog-websocket-takeover-pathname-version.jpg&w=2560&q=75)

We modified it so that the correct `Content-Type` of `text/html` and the contents of an HTML file were returned. Now, we terminated the `vscode` process, allowing our newly introduced changes to load into a newly spawned VS Code process instance:

![blog-websocket-takeover-template-python](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1677520235%2Fblog-websocket-takeover-template-python.jpg&w=2560&q=75)

Finally, we can leverage the JSONRPC methods `getLoggedInUser`, `getGitpodTokens`, `getOwnerToken`, and `addSSHPublicKey` to build a payload that grants us full control over the user’s workspaces when an unsuspecting Gitpod user visits our link!

Here it is in action:

![blog-websocket-takeover-pwnpod-info](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1677520236%2Fblog-websocket-takeover-pwnpod-info.jpg&w=2560&q=75)

We can see that we’ve been able to extract some sensitive information about the user account, and are notified that our SSH key has been added to the account. Let's see if we can SSH to the workspace:

![blog-websocket-takeover-task-list-redacted](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1677520236%2Fblog-websocket-takeover-task-list-redacted.jpg&w=2560&q=75)

Mission successful! As shown above, we have full access to the user’s workspaces after they’ve visited a link we sent them!

## Timeline

* Mon, Feb. 13, 2023 - Vulnerability disclosed to vendor
* Mon, Feb. 13, 2023 - Vendor acknowledges vulnerability
* Tue, Feb. 14, 2023 - New version released and deployed to production SaaS Gitpod instance
* Tue, Feb. 22, 2023 - CVE-2023-0957 assigned
* Wed, Mar. 1, 2023 - Vendor releases [new version for Gitpod Self-Hosted](https://github.com/gitpod-io/gitpod/releases/tag/release-2022.11.2) and issues advisory

## Summary

In this post, we presented the first findings from our current research into Cloud Development Environments (CDEs) — which allowed a full account takeover through visiting a link, exploiting a commonly misunderstood vulnerability (WebSocket Hijacking), and leveraging a practical SameSite cookie bypass. As cloud developer workspaces are becoming increasingly popular, it's important to consider the additional risks that are introduced.

We would like to praise Gitpod for their fantastic turnaround on addressing this security vulnerability, and look forward to presenting more of our findings on cloud-based remote development solutions in the near future.

## IaC security designed for devs

Snyk secures your infrastructure as code from SDLC to runtime in the cloud with a unified policy as code engine so every team can develop, deploy, and operate safely.

[Book a live demo](/schedule-a-demo/ "Book a live demo")Posted in:[Application Security](/blog/?topic=application-security)[Cloud Security](/blog/?topic=cloud-security)[IaC Security](/blog/?topic=iac-security)[Engineering](/blog/?topic=engineering)[Vulnerability Insights](/blog/?topic=vulnerability-insights)[Security Labs](/blog/?topic=security-labs)![blog-feature-pypi-spoof](/_next/image/?url=https%3A%2F%2Fres.cloudinary.com%2Fsnyk%2Fimage%2Fupload%2Fv1676482568%2Fblog-feature-pypi-spoof.jpg&w=2560&q=75)
### Snyk Top 10: Vulnerabilites you should know

Find out which types of vulnerabilities are most likely to appear in your projects based on Snyk scan results and security research.

[See the report](/snyk-top-10/ "See the report")
## Products & Solutions

* [What is Snyk?](/product/)
* [Developer Security Platform](/platform/)
* [Pricing](/plans/)
## Our Resources

* [Resource library](/resource-library/)
* [Blog](/blog/)
* [Snyk’s podcasts](/podcasts/the-secure-developer/)
## Our Ecosystem

* [Snyk Learn](/platform/learn/)
* [Snyk User Docs](https://docs.snyk.io/)
* [Snyk Support](https://support.snyk.io/hc/en-us)
* [Snyk Vuln Database](https://security.snyk.io/)
* [Snyk Updates](https://updates.snyk.io/)
* [Snyk Trust Center](https://trust.snyk.io/home)
## Company & Community

* [About Snyk](/about/)
* [Contact us](/contact-us/)
* [Book a demo](/schedule-a-demo/)
* [Careers](/careers/)
* [Events & webinars](/events/)
* [Ambassadors](/snyk-ambassadors/)
## Why Snyk

* [Snyk With GitHub](/comparison/github-and-snyk/)
* [Snyk vs Veracode](/comparison/snyk-vs-veracode/)
* [Snyk vs Checkmarx](/comparison/snyk-vs-checkmarx/)
* [Snyk vs Synopsys](/comparison/snyk-vs-synopsys/)

## The developer security platform

Snyk gives you the visibility, context, and control you need to work alongside developers on reducing application risk.

[More about us](/about/ "More about us")

© 2025 Snyk Limited
Registered in England and Wales

* [Legal terms](/policies/terms-of-service/)
* [Privacy Notice](/policies/privacy/)
* [Terms of use](/policies/website-terms-of-use/)
* [California residents: do not sell my information](https://preferences.snyk.io/dont_sell)

