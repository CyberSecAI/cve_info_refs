=== Content from github.com_5e65503a_20250114_194421.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxwiki%2Fxwiki-platform%2Fsecurity%2Fadvisories%2FGHSA-92wp-r7hm-42g7)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxwiki%2Fxwiki-platform%2Fsecurity%2Fadvisories%2FGHSA-92wp-r7hm-42g7)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=xwiki%2Fxwiki-platform)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[xwiki](/xwiki)
/
**[xwiki-platform](/xwiki/xwiki-platform)**
Public

* [Notifications](/login?return_to=%2Fxwiki%2Fxwiki-platform) You must be signed in to change notification settings
* [Fork
  554](/login?return_to=%2Fxwiki%2Fxwiki-platform)
* [Star
   1k](/login?return_to=%2Fxwiki%2Fxwiki-platform)

* [Code](/xwiki/xwiki-platform)
* [Pull requests
  139](/xwiki/xwiki-platform/pulls)
* [Actions](/xwiki/xwiki-platform/actions)
* [Projects
  0](/xwiki/xwiki-platform/projects)
* [Security](/xwiki/xwiki-platform/security)
* [Insights](/xwiki/xwiki-platform/pulse)

Additional navigation options

* [Code](/xwiki/xwiki-platform)
* [Pull requests](/xwiki/xwiki-platform/pulls)
* [Actions](/xwiki/xwiki-platform/actions)
* [Projects](/xwiki/xwiki-platform/projects)
* [Security](/xwiki/xwiki-platform/security)
* [Insights](/xwiki/xwiki-platform/pulse)

# Saving a document with a large object number leads to persistent OOM errors

Moderate

[tmortagne](/tmortagne)
published
GHSA-92wp-r7hm-42g7
Mar 1, 2023

## Package

maven

org.xwiki.platform:xwiki-platform-oldcore
([Maven](/advisories?query=ecosystem%3Amaven))

## Affected versions

< 14.0-rc-1

## Patched versions

14.0-rc-1

## Description

### Impact

It's possible to make the farm unusable by adding an object to a page with a huge number (e.g. 67108863). This will most of the time fill the memory allocated to XWiki and make it unusable every time this document is manipulated.

### Patches

It has been patched in XWiki 14.0

### Workarounds

There is no workaround.

### References

<https://jira.xwiki.org/browse/XWIKI-19223>

### For more information

If you have any questions or comments about this advisory:

* Open an issue in [Jira XWiki](https://jira.xwiki.org)
* Email us at our security mailing list

### Severity

Moderate

5.7

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
Low

User interaction
Required

Scope
Unchanged

Confidentiality
None

Integrity
None

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:N/A:H

### CVE ID

CVE-2023-26470

### Weaknesses

[CWE-400](/advisories?query=cwe%3A400)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from jira.xwiki.org_903f1d4a_20250114_194421.html ===


[Log in](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-19223)[Skip to main content](#main)[Skip to sidebar](#sidebar)Linked ApplicationsLoading…[![XWiki.org JIRA](/s/-65z3d2/930000/8ws80b/_/jira-logo-scaled.png)](https://jira.xwiki.org/secure/MyJiraHome.jspa)

* [Dashboards](/secure/Dashboard.jspa "View and manage your dashboards")
* [Projects](/secure/BrowseProjects.jspa "View recent projects and browse a list of projects")
* [Issues](/issues/ "Search for issues and view recent issues")

* Give feedback to Atlassian
* [Help](https://docs.atlassian.com/jira/jcore-docs-093/ "Help")
  + [Jira Core help](https://docs.atlassian.com/jira/jcore-docs-093/ "Go to the online documentation for Jira Core")
  + [Keyboard Shortcuts](/secure/ViewKeyboardShortcuts%21default.jspa "Get more information about Jira's Keyboard Shortcuts")
  + [About Jira](/secure/AboutPage.jspa "Get more information about Jira")
  + [Jira Credits](/secure/credits/AroundTheWorld%21default.jspa "See who did what")
* [Log In](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-19223)

![Uploaded image for project: 'XWiki Platform'](https://jira.xwiki.org/secure/projectavatar?pid=10010&avatarId=13602)

1. [XWiki Platform](/browse/XWIKI)
2. [XWIKI-19223](/browse/XWIKI-19223)

# Saving a document with a large object number leads to persistent OOM errors

[Log In](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-19223 "Log In")ClosedExportnull

XMLWordPrintable
#### Details

* **Type:**
  ![](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.") Bug
* **Resolution:**
  Fixed
* **Priority:**
  ![](/images/icons/priorities/major.svg "Major - Major loss of function.") Major
* **Fix Version/s:**
  [14.0-rc-1](/issues/?jql=project+%3D+XWIKI+AND+fixVersion+%3D+14.0-rc-1 "14.0-rc-1 ")
* **Affects Version/s:**
  7.1-milestone-1
* **Component/s:**
  [Old Core](/issues/?jql=project+%3D+XWIKI+AND+component+%3D+%22Old+Core%22 "Old Core ")
* **Labels:**
  + [attack\_stability](/issues/?jql=labels+%3D+attack_stability "attack_stability")
  + [attacker\_edit](/issues/?jql=labels+%3D+attacker_edit "attacker_edit")
  + [bugfixingday](/issues/?jql=labels+%3D+bugfixingday "bugfixingday")
  + [security](/issues/?jql=labels+%3D+security "security")

* **Tests:**
  Unit
* **Difficulty:**
  Unknown
* **Documentation:**
  <https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-92wp-r7hm-42g7>
* **Documentation in Release Notes:**
  N/A
* **Similar issues:**

#### Description

When creating an object with a huge object number, we currently store null entries for all objects numbers that have no object associated. So if you create an object with id 67108863, you get 67108863 null entries. As each null is a 64-bit pointer, this needs 512MiB memory per copy of the document. With a memory limit of 1GiB, this is enough for one copy but not two. Saving thus still works but any code that wants to display the document or a part of it creates a clone which is both slow and ends in an OOM error. Object numbers till close to 2³¹ should be supported given enough memory and thus give a memory usage of up to 16GiB per copy of the document.

A possible fix seems to be to store the objects in a Map<Integer, BaseObject>, though this might not fix the performance problems unless all code is adjusted to never iterate over the full list of objects.

**Steps to Reproduce:**

1. Create a document
2. Open the object editor and add an object of any type
3. Open the web developer tools and change the HTML code:
   1. Change name="YourClass\_0\_yourProperty" to name="YourClass\_67108863\_yourProperty" at the input of a property
   2. Add a new hidden input <input type="hidden" name="objectPolicy" value="updateOrCreate" />.
4. Press save.

**Expected Result**

The document is saved successfully and can be displayed afterwards.

**Actual Result**

While the document is saved to the database, the save action fails with an OOM and afterwards all panes like the navigation or recent changes or other views that involve the document fail with an OOM error. It is also not possible to load the object editor again to remove the object.

#### Attachments

#### Issue Links

causes

![Bug - A problem which impairs or prevents the functions of the product.](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.")
[XWIKI-19494](/browse/XWIKI-19494)
XWikiDocument objects inserted through #readObjectsFromForm can break it

* ![Blocker - Blocks development and/or testing work, production could not run.](/images/icons/priorities/blocker.svg "Blocker - Blocks development and/or testing work, production could not run.")
* Closed

is duplicated by

![Bug - A problem which impairs or prevents the functions of the product.](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.")
[XWIKI-14870](/browse/XWIKI-14870)
Deleting objects might create persistent NULL object in the object list

* ![Major - Major loss of function.](/images/icons/priorities/major.svg "Major - Major loss of function.")
* Closed

#### Activity

#### People

Assignee:

![tmortagne](https://jira.xwiki.org/secure/useravatar?size=small&avatarId=10222)
Thomas Mortagne

Reporter:

![MichaelHamann](https://jira.xwiki.org/secure/useravatar?size=small&avatarId=10222)
Michael Hamann

Votes:
0
Vote for this issue

Watchers:
2
Start watching this issue

#### Dates

Created:

10/Dec/21 11:18

Updated:

01/Mar/23 17:46

Resolved:

23/Dec/21 14:21

Date of First Response:

23/Dec/21 2:21 PM

* Atlassian Jira [Project Management Software](https://www.atlassian.com/software/jira)
* [About Jira](/secure/AboutPage.jspa/secure/AboutPage.jspa)
* [Report a problem](/secure/CreateIssue%21default.jspa)

Powered by a free Atlassian [Jira](http://www.atlassian.com/software/jira) open source license for XWiki.org. Try Jira - [bug tracking software](http://www.atlassian.com/software/jira) for *your* team.

[Atlassian](http://www.atlassian.com/)



=== Content from github.com_e71d85b2_20250114_194420.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxwiki%2Fxwiki-platform%2Fcommit%2Ffdfce062642b0ac062da5cda033d25482f4600fa)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxwiki%2Fxwiki-platform%2Fcommit%2Ffdfce062642b0ac062da5cda033d25482f4600fa)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=xwiki%2Fxwiki-platform)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[xwiki](/xwiki)
/
**[xwiki-platform](/xwiki/xwiki-platform)**
Public

* [Notifications](/login?return_to=%2Fxwiki%2Fxwiki-platform) You must be signed in to change notification settings
* [Fork
  554](/login?return_to=%2Fxwiki%2Fxwiki-platform)
* [Star
   1k](/login?return_to=%2Fxwiki%2Fxwiki-platform)

* [Code](/xwiki/xwiki-platform)
* [Pull requests
  139](/xwiki/xwiki-platform/pulls)
* [Actions](/xwiki/xwiki-platform/actions)
* [Projects
  0](/xwiki/xwiki-platform/projects)
* [Security](/xwiki/xwiki-platform/security)
* [Insights](/xwiki/xwiki-platform/pulse)

Additional navigation options

* [Code](/xwiki/xwiki-platform)
* [Pull requests](/xwiki/xwiki-platform/pulls)
* [Actions](/xwiki/xwiki-platform/actions)
* [Projects](/xwiki/xwiki-platform/projects)
* [Security](/xwiki/xwiki-platform/security)
* [Insights](/xwiki/xwiki-platform/pulse)

## Commit

[Permalink](/xwiki/xwiki-platform/commit/fdfce062642b0ac062da5cda033d25482f4600fa)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

XWIKI-19223: Improve xobject memory storage in XWikidocument

[Browse files](/xwiki/xwiki-platform/tree/fdfce062642b0ac062da5cda033d25482f4600fa)
Browse the repository at this point in the history

```
* fix List#remove implementation
* override List#clear implementation for performances
```

* Loading branch information

[![@tmortagne](https://avatars.githubusercontent.com/u/89175?s=40&v=4)](/tmortagne)

[tmortagne](/xwiki/xwiki-platform/commits?author=tmortagne "View all commits by tmortagne")
committed
Jan 11, 2022

1 parent
[6b10ebe](/xwiki/xwiki-platform/commit/6b10ebe00aabd50d6500474682c7aec659eddf99)

commit fdfce06

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**39 additions**
and
**6 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* xwiki-platform-core/xwiki-platform-oldcore/src

  + main/java/com/xpn/xwiki/internal/doc

    - xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/internal/doc/BaseObjects.java
      [BaseObjects.java](#diff-627cea04316b360eff3fb4ac04d3c8986b1c91031e56ad7dacf1ba0fbfef1a6e)
  + test/java/com/xpn/xwiki/internal/doc

    - xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/internal/doc/BaseObjectsTest.java
      [BaseObjectsTest.java](#diff-5089602ae3dfdd1320eb5f1b9bd2b35dc18ca980a1d4c229e4639462c06f28f5)

## There are no files selected for viewing

23 changes: 21 additions & 2 deletions

23
[...orm-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/internal/doc/BaseObjects.java](#diff-627cea04316b360eff3fb4ac04d3c8986b1c91031e56ad7dacf1ba0fbfef1a6e "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/internal/doc/BaseObjects.java")

Show comments

[View file](/xwiki/xwiki-platform/blob/fdfce062642b0ac062da5cda033d25482f4600fa/xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/internal/doc/BaseObjects.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -102,7 +102,7 @@ public void add(int index, BaseObject element) |
|  |  | // Check if the index is valid |
|  |  | rangeCheckForAdd(index); |
|  |  |  |
|  |  | // Move right values |
|  |  | // Shifts right values to the right |
|  |  | if (index < this.size) { |
|  |  | for (int i = this.size - 1; i >= index; --i) { |
|  |  | put(i + 1, get(i)); |
| Expand All | | @@ -128,7 +128,26 @@ public BaseObject remove(int index) |
|  |  | { |
|  |  | rangeCheck(index); |
|  |  |  |
|  |  | return this.map.remove(index); |
|  |  | BaseObject previous = this.map.remove(index); |
|  |  |  |
|  |  | // Shifts right values to the left |
|  |  | if (index < this.size - 1) { |
|  |  | for (int i = index; i < this.size - 1; ++i) { |
|  |  | put(i, get(i + 1)); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | // The list is one element shorter |
|  |  | --this.size; |
|  |  |  |
|  |  | return previous; |
|  |  | } |
|  |  |  |
|  |  | @Override |
|  |  | public void clear() |
|  |  | { |
|  |  | this.map.clear(); |
|  |  | this.size = 0; |
|  |  | } |
|  |  |  |
|  |  | private void rangeCheck(int index) |
| Expand Down | |  |

22 changes: 18 additions & 4 deletions

22
[...core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/internal/doc/BaseObjectsTest.java](#diff-5089602ae3dfdd1320eb5f1b9bd2b35dc18ca980a1d4c229e4639462c06f28f5 "xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/internal/doc/BaseObjectsTest.java")

Show comments

[View file](/xwiki/xwiki-platform/blob/fdfce062642b0ac062da5cda033d25482f4600fa/xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/internal/doc/BaseObjectsTest.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -120,12 +120,26 @@ void remove() |
|  |  | assertEquals(3, objects.size()); |
|  |  |  |
|  |  | objects.remove(0); |
|  |  | objects.remove(2); |
|  |  |  |
|  |  | assertNull(objects.get(0)); |
|  |  | assertSame(XOBJ2, objects.get(1)); |
|  |  | assertNull(objects.get(2)); |
|  |  | assertEquals(2, objects.size()); |
|  |  | assertSame(XOBJ2, objects.get(0)); |
|  |  | assertSame(XOBJ3, objects.get(1)); |
|  |  |  |
|  |  | objects.remove(1); |
|  |  |  |
|  |  | assertEquals(1, objects.size()); |
|  |  | assertSame(XOBJ2, objects.get(0)); |
|  |  | } |
|  |  |  |
|  |  | @Test |
|  |  | void clear() |
|  |  | { |
|  |  | BaseObjects objects = new BaseObjects(Arrays.asList(XOBJ1, XOBJ2, XOBJ3)); |
|  |  |  |
|  |  | assertEquals(3, objects.size()); |
|  |  |  |
|  |  | objects.clear(); |
|  |  |  |
|  |  | assertEquals(0, objects.size()); |
|  |  | } |
|  |  | } |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `fdfce06`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxwiki%2Fxwiki-platform%2Fcommit%2Ffdfce062642b0ac062da5cda033d25482f4600fa) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_2bf03a56_20250114_194418.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxwiki%2Fxwiki-platform%2Fcommit%2Fdb3d1c62fc5fb59fefcda3b86065d2d362f55164)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxwiki%2Fxwiki-platform%2Fcommit%2Fdb3d1c62fc5fb59fefcda3b86065d2d362f55164)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=xwiki%2Fxwiki-platform)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[xwiki](/xwiki)
/
**[xwiki-platform](/xwiki/xwiki-platform)**
Public

* [Notifications](/login?return_to=%2Fxwiki%2Fxwiki-platform) You must be signed in to change notification settings
* [Fork
  554](/login?return_to=%2Fxwiki%2Fxwiki-platform)
* [Star
   1k](/login?return_to=%2Fxwiki%2Fxwiki-platform)

* [Code](/xwiki/xwiki-platform)
* [Pull requests
  139](/xwiki/xwiki-platform/pulls)
* [Actions](/xwiki/xwiki-platform/actions)
* [Projects
  0](/xwiki/xwiki-platform/projects)
* [Security](/xwiki/xwiki-platform/security)
* [Insights](/xwiki/xwiki-platform/pulse)

Additional navigation options

* [Code](/xwiki/xwiki-platform)
* [Pull requests](/xwiki/xwiki-platform/pulls)
* [Actions](/xwiki/xwiki-platform/actions)
* [Projects](/xwiki/xwiki-platform/projects)
* [Security](/xwiki/xwiki-platform/security)
* [Insights](/xwiki/xwiki-platform/pulse)

## Commit

[Permalink](/xwiki/xwiki-platform/commit/db3d1c62fc5fb59fefcda3b86065d2d362f55164)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

XWIKI-19223: Improve xobject memory storage in XWikidocument

[Browse files](/xwiki/xwiki-platform/tree/db3d1c62fc5fb59fefcda3b86065d2d362f55164)
Browse the repository at this point in the history

* Loading branch information

[![@tmortagne](https://avatars.githubusercontent.com/u/89175?s=40&v=4)](/tmortagne)

[tmortagne](/xwiki/xwiki-platform/commits?author=tmortagne "View all commits by tmortagne")
committed
Dec 23, 2021

1 parent
[703dc60](/xwiki/xwiki-platform/commit/703dc60694f8bf229a3b4ddae3c2b23a36762d4e)

commit db3d1c6

 Show file tree

 Hide file tree

Showing
**4 changed files**
with
**303 additions**
and
**21 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* xwiki-platform-core/xwiki-platform-oldcore

  + xwiki-platform-core/xwiki-platform-oldcore/pom.xml
    [pom.xml](#diff-f374920833a57432bb19e251ce5f6a17a78a4467bd72f4e98f321576f8be0700)
  + src

    - main/java/com/xpn/xwiki

      * doc

        + xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/doc/XWikiDocument.java
          [XWikiDocument.java](#diff-bb23b7b80163e5c6cac4ba4592802e30d01ac1d463466454d47e8eaa5bf021d9)
      * internal/doc

        + xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/internal/doc/BaseObjects.java
          [BaseObjects.java](#diff-627cea04316b360eff3fb4ac04d3c8986b1c91031e56ad7dacf1ba0fbfef1a6e)
    - test/java/com/xpn/xwiki/internal/doc

      * xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/internal/doc/BaseObjectsTest.java
        [BaseObjectsTest.java](#diff-5089602ae3dfdd1320eb5f1b9bd2b35dc18ca980a1d4c229e4639462c06f28f5)

## There are no files selected for viewing

4 changes: 4 additions & 0 deletions

4
[xwiki-platform-core/xwiki-platform-oldcore/pom.xml](#diff-f374920833a57432bb19e251ce5f6a17a78a4467bd72f4e98f321576f8be0700 "xwiki-platform-core/xwiki-platform-oldcore/pom.xml")

Show comments

[View file](/xwiki/xwiki-platform/blob/db3d1c62fc5fb59fefcda3b86065d2d362f55164/xwiki-platform-core/xwiki-platform-oldcore/pom.xml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -607,6 +607,10 @@ |
|  |  | <version>1.6</version> |
|  |  | <scope>test</scope> |
|  |  | </dependency> |
|  |  | <dependency> |
|  |  | <groupId>com.google.guava</groupId> |
|  |  | <artifactId>guava-testlib</artifactId> |
|  |  | </dependency> |
|  |  |  |
|  |  | <dependency> |
|  |  | <groupId>org.xwiki.commons</groupId> |
| Expand Down | |  |

37 changes: 16 additions & 21 deletions

37
[...i-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/doc/XWikiDocument.java](#diff-bb23b7b80163e5c6cac4ba4592802e30d01ac1d463466454d47e8eaa5bf021d9 "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/doc/XWikiDocument.java")

Show comments

[View file](/xwiki/xwiki-platform/blob/db3d1c62fc5fb59fefcda3b86065d2d362f55164/xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/doc/XWikiDocument.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -49,6 +49,7 @@ |
|  |  | import java.util.SortedMap; |
|  |  | import java.util.TreeMap; |
|  |  | import java.util.Vector; |
|  |  | import java.util.concurrent.ConcurrentSkipListMap; |
|  |  | import java.util.regex.Matcher; |
|  |  | import java.util.regex.Pattern; |
|  |  | import java.util.zip.ZipEntry; |
| Expand Down  Expand Up | | @@ -167,6 +168,7 @@ |
|  |  | import com.xpn.xwiki.doc.merge.MergeResult; |
|  |  | import com.xpn.xwiki.doc.rcs.XWikiRCSNodeInfo; |
|  |  | import com.xpn.xwiki.internal.cache.rendering.RenderingCache; |
|  |  | import com.xpn.xwiki.internal.doc.BaseObjects; |
|  |  | import com.xpn.xwiki.internal.doc.XWikiAttachmentList; |
|  |  | import com.xpn.xwiki.internal.filter.XWikiDocumentFilterUtils; |
|  |  | import com.xpn.xwiki.internal.render.OldRendering; |
| Expand Down  Expand Up | | @@ -504,10 +506,10 @@ private static LinkParser getLinkParser() { |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Map holding document objects indexed by XClass references (i.e. Document References since a XClass reference |
|  |  | \* points to a document). The map is not synchronized, and uses a TreeMap implementation to preserve index ordering |
|  |  | \* (consistent sorted order for output to XML, rendering in velocity, etc.) |
|  |  | \* points to a document). The preserve index ordering (consistent sorted order for output to XML, rendering in |
|  |  | \* velocity, etc.) |
|  |  | \*/ |
|  |  | private Map<DocumentReference, List<BaseObject>> xObjects = new TreeMap<DocumentReference, List<BaseObject>>(); |
|  |  | private Map<DocumentReference, BaseObjects> xObjects = new ConcurrentSkipListMap<>(); |
|  |  |  |
|  |  | private final XWikiAttachmentList attachmentList = new XWikiAttachmentList(XWikiDocument.this); |
|  |  |  |
| Expand Down  Expand Up | | @@ -2544,7 +2546,7 @@ public void setXClass(BaseClass xwikiClass) |
|  |  | \*/ |
|  |  | public Map<DocumentReference, List<BaseObject>> getXObjects() |
|  |  | { |
|  |  | return this.xObjects; |
|  |  | return (Map) this.xObjects; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
| Expand Down  Expand Up | | @@ -2572,7 +2574,9 @@ public void setXObjects(Map<DocumentReference, List<BaseObject>> objects) |
|  |  | } |
|  |  |  |
|  |  | // Replace the current objects with the provided ones. |
|  |  | this.xObjects = objects; |
|  |  | Map<DocumentReference, BaseObjects> objectsCopy = new ConcurrentSkipListMap<>(); |
|  |  | objects.forEach((k, v) -> objectsCopy.put(k, new BaseObjects(v))); |
|  |  | this.xObjects = objectsCopy; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
| Expand Down  Expand Up | | @@ -2636,9 +2640,9 @@ public int createXObject(EntityReference classReference, XWikiContext context) t |
|  |  | BaseObject object = BaseClass.newCustomClassInstance(absoluteClassReference, context); |
|  |  | object.setOwnerDocument(this); |
|  |  | object.setXClassReference(classReference); |
|  |  | List<BaseObject> objects = this.xObjects.get(absoluteClassReference); |
|  |  | BaseObjects objects = this.xObjects.get(absoluteClassReference); |
|  |  | if (objects == null) { |
|  |  | objects = new ArrayList<BaseObject>(); |
|  |  | objects = new BaseObjects(); |
|  |  | this.xObjects.put(absoluteClassReference, objects); |
|  |  | } |
|  |  | objects.add(object); |
| Expand Down  Expand Up | | @@ -2758,16 +2762,7 @@ public void setXObjects(DocumentReference classReference, List<BaseObject> objec |
|  |  | } |
|  |  |  |
|  |  | // Add new objects |
|  |  | if (objects.isEmpty()) { |
|  |  | // Pretty wrong but can't remove that for retro compatibility reasons... |
|  |  | // Note that it means that someone can put an unmodifiable list here make impossible to add any object of |
|  |  | // this class. |
|  |  | this.xObjects.put(classReference, objects); |
|  |  | } else { |
|  |  | for (BaseObject baseObject : objects) { |
|  |  | addXObject(classReference, baseObject); |
|  |  | } |
|  |  | } |
|  |  | this.xObjects.put(classReference, new BaseObjects(objects)); |
|  |  |  |
|  |  | setMetaDataDirty(true); |
|  |  | } |
| Expand Down  Expand Up | | @@ -3062,9 +3057,9 @@ public void setXObject(DocumentReference classReference, int nb, BaseObject obje |
|  |  | object.setNumber(nb); |
|  |  | } |
|  |  |  |
|  |  | List<BaseObject> objects = this.xObjects.get(classReference); |
|  |  | BaseObjects objects = this.xObjects.get(classReference); |
|  |  | if (objects == null) { |
|  |  | objects = new ArrayList<BaseObject>(); |
|  |  | objects = new BaseObjects(); |
|  |  | this.xObjects.put(classReference, objects); |
|  |  | } |
|  |  | while (nb >= objects.size()) { |
| Expand All | | @@ -3088,9 +3083,9 @@ public void setXObject(int nb, BaseObject object) |
|  |  | object.setOwnerDocument(this); |
|  |  | object.setNumber(nb); |
|  |  |  |
|  |  | List<BaseObject> objects = this.xObjects.get(object.getXClassReference()); |
|  |  | BaseObjects objects = this.xObjects.get(object.getXClassReference()); |
|  |  | if (objects == null) { |
|  |  | objects = new ArrayList<BaseObject>(); |
|  |  | objects = new BaseObjects(); |
|  |  | this.xObjects.put(object.getXClassReference(), objects); |
|  |  | } |
|  |  | while (nb >= objects.size()) { |
| Expand Down | |  |

152 changes: 152 additions & 0 deletions

152
[...orm-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/internal/doc/BaseObjects.java](#diff-627cea04316b360eff3fb4ac04d3c8986b1c91031e56ad7dacf1ba0fbfef1a6e "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/internal/doc/BaseObjects.java")

Show comments

[View file](/xwiki/xwiki-platform/blob/db3d1c62fc5fb59fefcda3b86065d2d362f55164/xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/internal/doc/BaseObjects.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,152 @@ |
|  |  | /\* |
|  |  | \* See the NOTICE file distributed with this work for additional |
|  |  | \* information regarding copyright ownership. |
|  |  | \* |
|  |  | \* This is free software; you can redistribute it and/or modify it |
|  |  | \* under the terms of the GNU Lesser General Public License as |
|  |  | \* published by the Free Software Foundation; either version 2.1 of |
|  |  | \* the License, or (at your option) any later version. |
|  |  | \* |
|  |  | \* This software is distributed in the hope that it will be useful, |
|  |  | \* but WITHOUT ANY WARRANTY; without even the implied warranty of |
|  |  | \* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU |
|  |  | \* Lesser General Public License for more details. |
|  |  | \* |
|  |  | \* You should have received a copy of the GNU Lesser General Public |
|  |  | \* License along with this software; if not, write to the Free |
|  |  | \* Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA |
|  |  | \* 02110-1301 USA, or see the FSF site: http://www.fsf.org. |
|  |  | \*/ |
|  |  | package com.xpn.xwiki.internal.doc; |
|  |  |  |
|  |  | import java.util.AbstractList; |
|  |  | import java.util.Collection; |
|  |  | import java.util.Map; |
|  |  | import java.util.concurrent.ConcurrentSkipListMap; |
|  |  |  |
|  |  | import com.xpn.xwiki.objects.BaseObject; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Implement a list of {@link BaseObject} as seen by a document (meaning that the list index matched the object number) |
|  |  | \* using a {@link Map} storage to avoid wasting memory with null entries. |
|  |  | \* |
|  |  | \* @version $Id$ |
|  |  | \* @since 14.0RC1 |
|  |  | \*/ |
|  |  | // TODO: expose APIs to navigate non null objects directly instead of going through each entry and skipping explicitly |
|  |  | // null ones |
|  |  | public class BaseObjects extends AbstractList<BaseObject> |
|  |  | { |
|  |  | // Sort keys so that it's possible to navigate non null entries without going through them all |
|  |  | private Map<Integer, BaseObject> map = new ConcurrentSkipListMap<>(); |
|  |  |  |
|  |  | private int size; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Constructs an empty list. |
|  |  | \*/ |
|  |  | public BaseObjects() |
|  |  | { |
|  |  |  |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Constructs a list containing the elements of the specified collection, in the order they are returned by the |
|  |  | \* collection's iterator. |
|  |  | \* |
|  |  | \* @param collection the collection to copy |
|  |  | \*/ |
|  |  | public BaseObjects(Collection<BaseObject> collection) |
|  |  | { |
|  |  | collection.forEach(this::add); |
|  |  | } |
|  |  |  |
|  |  | @Override |
|  |  | public BaseObject get(int index) |
|  |  | { |
|  |  | rangeCheck(index); |
|  |  |  |
|  |  | return this.map.get(index); |
|  |  | } |
|  |  |  |
|  |  | @Override |
|  |  | public int size() |
|  |  | { |
|  |  | return this.size; |
|  |  | } |
|  |  |  |
|  |  | private BaseObject put(int index, BaseObject element) |
|  |  | { |
|  |  | BaseObject old; |
|  |  | if (element == null) { |
|  |  | // We don't want to keep null values in memory |
|  |  | old = this.map.remove(index); |
|  |  | } else { |
|  |  | // Make sure the object number is right |
|  |  | element.setNumber(index); |
|  |  |  |
|  |  | old = this.map.put(index, element); |
|  |  | } |
|  |  |  |
|  |  | // Increment size if needed |
|  |  | if (this.size <= index) { |
|  |  | this.size = index + 1; |
|  |  | } |
|  |  |  |
|  |  | return old; |
|  |  | } |
|  |  |  |
|  |  | @Override |
|  |  | public void add(int index, BaseObject element) |
|  |  | { |
|  |  | // Check if the index is valid |
|  |  | rangeCheckForAdd(index); |
|  |  |  |
|  |  | // Move right values |
|  |  | if (index < this.size) { |
|  |  | for (int i = this.size - 1; i >= index; --i) { |
|  |  | put(i + 1, get(i)); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | // Insert new value |
|  |  | put(index, element); |
|  |  | } |
|  |  |  |
|  |  | @Override |
|  |  | public BaseObject set(int index, BaseObject element) |
|  |  | { |
|  |  | // Check if the index is valid |
|  |  | rangeCheck(index); |
|  |  |  |
|  |  | // Set the value and remember the old one |
|  |  | return put(index, element); |
|  |  | } |
|  |  |  |
|  |  | @Override |
|  |  | public BaseObject remove(int index) |
|  |  | { |
|  |  | rangeCheck(index); |
|  |  |  |
|  |  | return this.map.remove(index); |
|  |  | } |
|  |  |  |
|  |  | private void rangeCheck(int index) |
|  |  | { |
|  |  | if (index < 0 || index >= this.size) { |
|  |  | throw new IndexOutOfBoundsException(outOfBoundsMsg(index)); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | private void rangeCheckForAdd(int index) |
|  |  | { |
|  |  | if (index < 0 || index > this.size || index == Integer.MAX\_VALUE) { |
|  |  | throw new IndexOutOfBoundsException(outOfBoundsMsg(index)); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | private String outOfBoundsMsg(int index) |
|  |  | { |
|  |  | return "Index: " + index + ", Size: " + size; |
|  |  | } |
|  |  | } |

131 changes: 131 additions & 0 deletions

131
[...core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/internal/doc/BaseObjectsTest.java](#diff-5089602ae3dfdd1320eb5f1b9bd2b35dc18ca980a1d4c229e4639462c06f28f5 "xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/internal/doc/BaseObjectsTest.java")

Show comments

[View file](/xwiki/xwiki-platform/blob/db3d1c62fc5fb59fefcda3b86065d2d362f55164/xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/internal/doc/BaseObjectsTest.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,131 @@ |
|  |  | /\* |
|  |  | \* See the NOTICE file distributed with this work for additional |
|  |  | \* information regarding copyright ownership. |
|  |  | \* |
|  |  | \* This is free software; you can redistribute it and/or modify it |
|  |  | \* under the terms of the GNU Lesser General Public License as |
|  |  | \* published by the Free Software Foundation; either version 2.1 of |
|  |  | \* the License, or (at your option) any later version. |
|  |  | \* |
|  |  | \* This software is distributed in the hope that it will be useful, |
|  |  | \* but WITHOUT ANY WARRANTY; without even the implied warranty of |
|  |  | \* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU |
|  |  | \* Lesser General Public License for more details. |
|  |  | \* |
|  |  | \* You should have received a copy of the GNU Lesser General Public |
|  |  | \* License along with this software; if not, write to the Free |
|  |  | \* Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA |
|  |  | \* 02110-1301 USA, or see the FSF site: http://www.fsf.org. |
|  |  | \*/ |
|  |  | package com.xpn.xwiki.internal.doc; |
|  |  |  |
|  |  | import java.util.Arrays; |
|  |  |  |
|  |  | import org.junit.jupiter.api.Test; |
|  |  |  |
|  |  | import com.xpn.xwiki.objects.BaseObject; |
|  |  |  |
|  |  | import static org.junit.jupiter.api.Assertions.assertEquals; |
|  |  | import static org.junit.jupiter.api.Assertions.assertNull; |
|  |  | import static org.junit.jupiter.api.Assertions.assertSame; |
|  |  | import static org.junit.jupiter.api.Assertions.assertThrows; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Validate {@link BaseObjects}. |
|  |  | \* |
|  |  | \* @version $Id$ |
|  |  | \*/ |
|  |  | public class BaseObjectsTest |
|  |  | { |
|  |  | private static class TestBaseObject extends BaseObject |
|  |  | { |
|  |  | @Override |
|  |  | public String toString() |
|  |  | { |
|  |  | return String.valueOf(getNumber()); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | private static final BaseObject XOBJ1 = new TestBaseObject(); |
|  |  |  |
|  |  | private static final BaseObject XOBJ2 = new TestBaseObject(); |
|  |  |  |
|  |  | private static final BaseObject XOBJ3 = new TestBaseObject(); |
|  |  |  |
|  |  | private static final BaseObject XOBJ4 = new TestBaseObject(); |
|  |  |  |
|  |  | @Test |
|  |  | void add() |
|  |  | { |
|  |  | BaseObjects objects = new BaseObjects(); |
|  |  |  |
|  |  | assertEquals(0, objects.size()); |
|  |  |  |
|  |  | objects.add(XOBJ1); |
|  |  |  |
|  |  | assertEquals(1, objects.size()); |
|  |  |  |
|  |  | objects.add(null); |
|  |  |  |
|  |  | assertEquals(2, objects.size()); |
|  |  |  |
|  |  | objects.add(XOBJ2); |
|  |  |  |
|  |  | assertEquals(3, objects.size()); |
|  |  | assertSame(XOBJ1, objects.get(0)); |
|  |  | assertEquals(0, objects.get(0).getNumber()); |
|  |  | assertNull(objects.get(1)); |
|  |  | assertSame(XOBJ2, objects.get(2)); |
|  |  | assertEquals(2, objects.get(2).getNumber()); |
|  |  |  |
|  |  | objects.add(1, XOBJ3); |
|  |  |  |
|  |  | assertEquals(4, objects.size()); |
|  |  | assertSame(XOBJ1, objects.get(0)); |
|  |  | assertEquals(0, objects.get(0).getNumber()); |
|  |  | assertSame(XOBJ3, objects.get(1)); |
|  |  | assertEquals(1, objects.get(1).getNumber()); |
|  |  | assertNull(objects.get(2)); |
|  |  | assertSame(XOBJ2, objects.get(3)); |
|  |  | assertEquals(3, objects.get(3).getNumber()); |
|  |  |  |
|  |  | assertThrows(IndexOutOfBoundsException.class, () -> objects.add(Integer.MAX\_VALUE, XOBJ4)); |
|  |  | } |
|  |  |  |
|  |  | @Test |
|  |  | void set() |
|  |  | { |
|  |  | BaseObjects objects = new BaseObjects(); |
|  |  |  |
|  |  | assertEquals(0, objects.size()); |
|  |  |  |
|  |  | assertThrows(IndexOutOfBoundsException.class, () -> objects.set(0, XOBJ1)); |
|  |  |  |
|  |  | objects.add(XOBJ1); |
|  |  | objects.add(XOBJ2); |
|  |  | objects.add(XOBJ3); |
|  |  |  |
|  |  | objects.set(1, XOBJ4); |
|  |  |  |
|  |  | assertSame(XOBJ1, objects.get(0)); |
|  |  | assertSame(XOBJ4, objects.get(1)); |
|  |  | assertSame(XOBJ3, objects.get(2)); |
|  |  | } |
|  |  |  |
|  |  | @Test |
|  |  | void remove() |
|  |  | { |
|  |  | BaseObjects objects = new BaseObjects(Arrays.asList(XOBJ1, XOBJ2, XOBJ3)); |
|  |  |  |
|  |  | assertEquals(3, objects.size()); |
|  |  |  |
|  |  | objects.remove(0); |
|  |  | objects.remove(2); |
|  |  |  |
|  |  | assertNull(objects.get(0)); |
|  |  | assertSame(XOBJ2, objects.get(1)); |
|  |  | assertNull(objects.get(2)); |
|  |  |  |
|  |  | assertEquals(3, objects.size()); |
|  |  | } |
|  |  | } |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `db3d1c6`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxwiki%2Fxwiki-platform%2Fcommit%2Fdb3d1c62fc5fb59fefcda3b86065d2d362f55164) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_c3e8c283_20250114_194416.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxwiki%2Fxwiki-platform%2Fcommit%2F04e5a89d2879b160cdfaea846024d3d9c1a525e6)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxwiki%2Fxwiki-platform%2Fcommit%2F04e5a89d2879b160cdfaea846024d3d9c1a525e6)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=xwiki%2Fxwiki-platform)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[xwiki](/xwiki)
/
**[xwiki-platform](/xwiki/xwiki-platform)**
Public

* [Notifications](/login?return_to=%2Fxwiki%2Fxwiki-platform) You must be signed in to change notification settings
* [Fork
  554](/login?return_to=%2Fxwiki%2Fxwiki-platform)
* [Star
   1k](/login?return_to=%2Fxwiki%2Fxwiki-platform)

* [Code](/xwiki/xwiki-platform)
* [Pull requests
  139](/xwiki/xwiki-platform/pulls)
* [Actions](/xwiki/xwiki-platform/actions)
* [Projects
  0](/xwiki/xwiki-platform/projects)
* [Security](/xwiki/xwiki-platform/security)
* [Insights](/xwiki/xwiki-platform/pulse)

Additional navigation options

* [Code](/xwiki/xwiki-platform)
* [Pull requests](/xwiki/xwiki-platform/pulls)
* [Actions](/xwiki/xwiki-platform/actions)
* [Projects](/xwiki/xwiki-platform/projects)
* [Security](/xwiki/xwiki-platform/security)
* [Insights](/xwiki/xwiki-platform/pulse)

## Commit

[Permalink](/xwiki/xwiki-platform/commit/04e5a89d2879b160cdfaea846024d3d9c1a525e6)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

XWIKI-19223: Saving a document with a large object number leads to pe…

[Browse files](/xwiki/xwiki-platform/tree/04e5a89d2879b160cdfaea846024d3d9c1a525e6)
Browse the repository at this point in the history

```
…rsistent OOM errors
```

* Loading branch information

[![@tmortagne](https://avatars.githubusercontent.com/u/89175?s=40&v=4)](/tmortagne)

[tmortagne](/xwiki/xwiki-platform/commits?author=tmortagne "View all commits by tmortagne")
committed
Jan 5, 2022

1 parent
[b83a797](/xwiki/xwiki-platform/commit/b83a79763e7eae97360752712654637161c94538)

commit 04e5a89

Showing
**1 changed file**
with
**1 addition**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

1 change: 1 addition & 0 deletions

1
[xwiki-platform-core/xwiki-platform-oldcore/pom.xml](#diff-f374920833a57432bb19e251ce5f6a17a78a4467bd72f4e98f321576f8be0700 "xwiki-platform-core/xwiki-platform-oldcore/pom.xml")

Show comments

[View file](/xwiki/xwiki-platform/blob/04e5a89d2879b160cdfaea846024d3d9c1a525e6/xwiki-platform-core/xwiki-platform-oldcore/pom.xml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -610,6 +610,7 @@ |
|  |  | <dependency> |
|  |  | <groupId>com.google.guava</groupId> |
|  |  | <artifactId>guava-testlib</artifactId> |
|  |  | <scope>test</scope> |
|  |  | </dependency> |
|  |  |  |
|  |  | <dependency> |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `04e5a89`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxwiki%2Fxwiki-platform%2Fcommit%2F04e5a89d2879b160cdfaea846024d3d9c1a525e6) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


