=== Content from github.com_cc5a9096_20250115_085049.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdirectus%2Fdirectus%2Freleases%2Ftag%2Fv9.23.0)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdirectus%2Fdirectus%2Freleases%2Ftag%2Fv9.23.0)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=directus%2Fdirectus)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[directus](/directus)
/
**[directus](/directus/directus)**
Public

* [Notifications](/login?return_to=%2Fdirectus%2Fdirectus) You must be signed in to change notification settings
* [Fork
  4k](/login?return_to=%2Fdirectus%2Fdirectus)
* [Star
   28.7k](/login?return_to=%2Fdirectus%2Fdirectus)

* [Code](/directus/directus/tree/v9.23.0)
* [Issues
  531](/directus/directus/issues)
* [Pull requests
  17](/directus/directus/pulls)
* [Discussions](/directus/directus/discussions)
* [Actions](/directus/directus/actions)
* [Projects
  0](/directus/directus/projects)
* [Security](/directus/directus/security)
* [Insights](/directus/directus/pulse)

Additional navigation options

* [Code](/directus/directus/tree/v9.23.0)
* [Issues](/directus/directus/issues)
* [Pull requests](/directus/directus/pulls)
* [Discussions](/directus/directus/discussions)
* [Actions](/directus/directus/actions)
* [Projects](/directus/directus/projects)
* [Security](/directus/directus/security)
* [Insights](/directus/directus/pulse)

1. [Releases](/directus/directus/releases)
2. [v9.23.0](/directus/directus/releases/tag/v9.23.0)

# v9.23.0

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/directus/directus/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v9.23.0)

 Loading

[View all tags](/directus/directus/tags)

![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)
[github-actions](/apps/github-actions)
released this
28 Feb 17:52

¬∑
[2640 commits](/directus/directus/compare/v9.23.0...main)
to main
since this release

[v9.23.0](/directus/directus/tree/v9.23.0)

[`47b9824`](/directus/directus/commit/47b9824954fd6538406d1ae754ec99f4744e5cff)

This commit was signed with the committer‚Äôs **verified signature**.

[![](https://avatars.githubusercontent.com/u/9141017?s=64&v=4)](/rijkvanzanten)
[rijkvanzanten](/rijkvanzanten)
Rijk van Zanten

GPG key ID: AB1FB4B0A33EA978

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

## v9.23.0 (February 28, 2023)

### ‚ú® New Features

* **API**
  + [#14713](https://github.com/directus/directus/pull/14713) Expose schema endpoints (by [@azrikahar](https://github.com/azrikahar))

### üöÄ Improvements

* **API**
  + [#17633](https://github.com/directus/directus/pull/17633) Catch IPTC and XMP extraction errors (by [@licitdev](https://github.com/licitdev))
  + [#17615](https://github.com/directus/directus/pull/17615) Additionally check for varchar when casting UUID in apply diff (by [@azrikahar](https://github.com/azrikahar))
  + [#17481](https://github.com/directus/directus/pull/17481) Allow offset and page args for GraphQL aggregated queries (by [@licitdev](https://github.com/licitdev))
  + [#17448](https://github.com/directus/directus/pull/17448) Allow for custom robots.txt (by [@Nitwel](https://github.com/Nitwel))
  + [#16773](https://github.com/directus/directus/pull/16773) Flows improvements (by [@Nitwel](https://github.com/Nitwel))
* **App**
  + [#17416](https://github.com/directus/directus/pull/17416) Make sort fields hidden by default (by [@Nitwel](https://github.com/Nitwel))
  + [#17199](https://github.com/directus/directus/pull/17199) Update locale name for zh-TW (by [@azrikahar](https://github.com/azrikahar))
  + [#16773](https://github.com/directus/directus/pull/16773) Flows improvements (by [@Nitwel](https://github.com/Nitwel))
  + [#15269](https://github.com/directus/directus/pull/15269) Improve preview of relational columns in tabular layout (by [@Nitwel](https://github.com/Nitwel))

### üêõ Bug Fixes

* **API**
  + [#17622](https://github.com/directus/directus/pull/17622) Catch ICC parse errors to avoid server crash (by [@TeyKey1](https://github.com/TeyKey1))
  + [#17499](https://github.com/directus/directus/pull/17499) Throw validation error after authorization (by [@licitdev](https://github.com/licitdev))
  + [#17441](https://github.com/directus/directus/pull/17441) Fix using strings for flow trigger collections (by [@Nitwel](https://github.com/Nitwel))
  + [#17350](https://github.com/directus/directus/pull/17350) Update axios (by [@rijkvanzanten](https://github.com/rijkvanzanten))
  + [#17343](https://github.com/directus/directus/pull/17343) Fix sort added by offset not removed for MSSQL (by [@licitdev](https://github.com/licitdev))
  + [#17268](https://github.com/directus/directus/pull/17268) GraphQL return original error ([#17168](https://github.com/directus/directus/issues/17168)) (by [@LeBenLeBen](https://github.com/LeBenLeBen))
  + [#17240](https://github.com/directus/directus/pull/17240) Update knex version (by [@azrikahar](https://github.com/azrikahar))
  + [#17181](https://github.com/directus/directus/pull/17181) Fix operations output being undefined (by [@Nitwel](https://github.com/Nitwel))
  + [#17120](https://github.com/directus/directus/pull/17120) Fix url encoding query parameters and added tests (by [@tofran](https://github.com/tofran))
  + [#17113](https://github.com/directus/directus/pull/17113) Fix GraphQL server health output (by [@br41nslug](https://github.com/br41nslug))
  + [#17066](https://github.com/directus/directus/pull/17066) Fix CreateMany action hooks (by [@licitdev](https://github.com/licitdev))
  + [#16773](https://github.com/directus/directus/pull/16773) Flows improvements (by [@Nitwel](https://github.com/Nitwel))
* **App**
  + [#17609](https://github.com/directus/directus/pull/17609) Fix infinite recursion (by [@Nitwel](https://github.com/Nitwel))
  + [#17588](https://github.com/directus/directus/pull/17588) Fix Local Auth Provider Form being Hidden (by [@connorsimply](https://github.com/connorsimply))
  + [#17446](https://github.com/directus/directus/pull/17446) Fix problems with manual sort (by [@Nitwel](https://github.com/Nitwel))
  + [#17443](https://github.com/directus/directus/pull/17443) Always show error in tabular layout (by [@Nitwel](https://github.com/Nitwel))
  + [#17441](https://github.com/directus/directus/pull/17441) Fix using strings for flow trigger collections (by [@Nitwel](https://github.com/Nitwel))
  + [#17439](https://github.com/directus/directus/pull/17439) Display proper pages for selected items (by [@Nitwel](https://github.com/Nitwel))
  + [#17432](https://github.com/directus/directus/pull/17432) Fix span with space in it (by [@Nitwel](https://github.com/Nitwel))
  + [#17415](https://github.com/directus/directus/pull/17415) Fix loading of relational fields in group (by [@Nitwel](https://github.com/Nitwel))
  + [#17412](https://github.com/directus/directus/pull/17412) Allow for rendering lists in template string (by [@Nitwel](https://github.com/Nitwel))
  + [#17411](https://github.com/directus/directus/pull/17411) Fix checkbox flickering (by [@Nitwel](https://github.com/Nitwel))
  + [#17394](https://github.com/directus/directus/pull/17394) Support selecting multiple files in v-upload (by [@Nitwel](https://github.com/Nitwel))
  + [#17392](https://github.com/directus/directus/pull/17392) Fix applying corresponding changes (by [@Nitwel](https://github.com/Nitwel))
  + [#17325](https://github.com/directus/directus/pull/17325) Fix issue with expand transition not working on initial collapse (by [@addisonElliott](https://github.com/addisonElliott))
  + [#17323](https://github.com/directus/directus/pull/17323) Fix bug with v-checkbox-tree where leaf nodes are treated like branch nodes with no children (by [@addisonElliott](https://github.com/addisonElliott))
  + [#17254](https://github.com/directus/directus/pull/17254) Fix field configuration view not updating when navigating between different fields in New Field drawer (by [@jay-p-b-7span](https://github.com/jay-p-b-7span))
  + [#17236](https://github.com/directus/directus/pull/17236) Use img tag for images on module bar (by [@licitdev](https://github.com/licitdev))
  + [#17216](https://github.com/directus/directus/pull/17216) Image is displayed to small in the Editing Image panel (by [@jay-p-b-7span](https://github.com/jay-p-b-7span))
  + [#17210](https://github.com/directus/directus/pull/17210) Fix fetching from related collection in drawer item (by [@licitdev](https://github.com/licitdev))
  + [#17202](https://github.com/directus/directus/pull/17202) Re-added frontend sorting for flows (by [@br41nslug](https://github.com/br41nslug))
  + [#17184](https://github.com/directus/directus/pull/17184) Use countDistinct for item and total counts (by [@licitdev](https://github.com/licitdev))
  + [#17182](https://github.com/directus/directus/pull/17182) Revert "Disable field selection for alias fields in the system-filter component when functions are used" (by [@Nitwel](https://github.com/Nitwel))
  + [#17139](https://github.com/directus/directus/pull/17139) Catch logout error (by [@licitdev](https://github.com/licitdev))
  + [#16832](https://github.com/directus/directus/pull/16832) Hide related fields without read permissions (by [@br41nslug](https://github.com/br41nslug))
  + [#16773](https://github.com/directus/directus/pull/16773) Flows improvements (by [@Nitwel](https://github.com/Nitwel))
  + [#16139](https://github.com/directus/directus/pull/16139) Fix insights filtering (by [@licitdev](https://github.com/licitdev))
  + [#15549](https://github.com/directus/directus/pull/15549) Fix display fields on selected items (by [@Nitwel](https://github.com/Nitwel))
  + [#15269](https://github.com/directus/directus/pull/15269) Improve preview of relational columns in tabular layout (by [@Nitwel](https://github.com/Nitwel))
* **Extensions**
  + [#17565](https://github.com/directus/directus/pull/17565) Add directory check when getting extensions real paths (by [@licitdev](https://github.com/licitdev))
  + [#17179](https://github.com/directus/directus/pull/17179) Passthrough all package.json data (by [@Nitwel](https://github.com/Nitwel))
* **Misc.**
  + [#17381](https://github.com/directus/directus/pull/17381) Fix incorrect skipping of m2m tests (by [@licitdev](https://github.com/licitdev))

### üßΩ Optimizations

* **Misc.**
  + [#17361](https://github.com/directus/directus/pull/17361) Port remaining tests into E2E blackbox (by [@licitdev](https://github.com/licitdev))

### üì¶ Dependency Updates

* [#17353](https://github.com/directus/directus/pull/17353) Patch Tuesday üê∏ (by [@paescuj](https://github.com/paescuj))
* [#17240](https://github.com/directus/directus/pull/17240) Update knex version (by [@azrikahar](https://github.com/azrikahar))

### Contributors

* [![@LeBenLeBen](https://avatars.githubusercontent.com/u/793344?s=64&v=4)](https://github.com/LeBenLeBen)
* [![@addisonElliott](https://avatars.githubusercontent.com/u/1342819?s=64&v=4)](https://github.com/addisonElliott)
* [![@paescuj](https://avatars.githubusercontent.com/u/5363448?s=64&v=4)](https://github.com/paescuj)
* [![@tofran](https://avatars.githubusercontent.com/u/5692603?s=64&v=4)](https://github.com/tofran)
* [![@rijkvanzanten](https://avatars.githubusercontent.com/u/9141017?s=64&v=4)](https://github.com/rijkvanzanten)
* [![@br41nslug](https://avatars.githubusercontent.com/u/9389634?s=64&v=4)](https://github.com/br41nslug)
* [![@connorwinston](https://avatars.githubusercontent.com/u/12714889?s=64&v=4)](https://github.com/connorwinston)
* [![@Nitwel](https://avatars.githubusercontent.com/u/22577866?s=64&v=4)](https://github.com/Nitwel)
* [![@licitdev](https://avatars.githubusercontent.com/u/26413686?s=64&v=4)](https://github.com/licitdev)
* [![@azrikahar](https://avatars.githubusercontent.com/u/42867097?s=64&v=4)](https://github.com/azrikahar)
* [![@TeyKey1](https://avatars.githubusercontent.com/u/78312153?s=64&v=4)](https://github.com/TeyKey1)
* [![@jay-p-b-7span](https://avatars.githubusercontent.com/u/93135924?s=64&v=4)](https://github.com/jay-p-b-7span)

LeBenLeBen, addisonElliott, and 10 other contributors

 Assets
2

 Loading

 ‚ù§Ô∏è
9
 cesarsalesgomes, plckr, RobinvanderVliet, luciandavidescu, DrJume, stylefieber, paulvonber, davidpurkiss, and petitroto reacted with heart emoji
 üöÄ
15
 ihadabs, ramonvanbezouw, mundry, falmanna, mathielen, PrplHaz4, janekth, domdus, stylefieber, paulvonber, and 5 more reacted with rocket emoji

All reactions

* ‚ù§Ô∏è
  9 reactions
* üöÄ
  15 reactions

 22 people reacted

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_f04573c0_20250115_085051.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdirectus%2Fdirectus%2Fsecurity%2Fadvisories%2FGHSA-j3rg-3rgm-537h)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdirectus%2Fdirectus%2Fsecurity%2Fadvisories%2FGHSA-j3rg-3rgm-537h)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=directus%2Fdirectus)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[directus](/directus)
/
**[directus](/directus/directus)**
Public

* [Notifications](/login?return_to=%2Fdirectus%2Fdirectus) You must be signed in to change notification settings
* [Fork
  4k](/login?return_to=%2Fdirectus%2Fdirectus)
* [Star
   28.7k](/login?return_to=%2Fdirectus%2Fdirectus)

* [Code](/directus/directus)
* [Issues
  531](/directus/directus/issues)
* [Pull requests
  17](/directus/directus/pulls)
* [Discussions](/directus/directus/discussions)
* [Actions](/directus/directus/actions)
* [Projects
  0](/directus/directus/projects)
* [Security](/directus/directus/security)
* [Insights](/directus/directus/pulse)

Additional navigation options

* [Code](/directus/directus)
* [Issues](/directus/directus/issues)
* [Pull requests](/directus/directus/pulls)
* [Discussions](/directus/directus/discussions)
* [Actions](/directus/directus/actions)
* [Projects](/directus/directus/projects)
* [Security](/directus/directus/security)
* [Insights](/directus/directus/pulse)

# SSRF On File Import

Moderate

[br41nslug](/br41nslug)
published
GHSA-j3rg-3rgm-537h
Mar 3, 2023

## Package

npm

directus
([npm](/advisories?query=ecosystem%3Anpm))

## Affected versions

<=9.22.4

## Patched versions

v9.23.0

## Description

### Summary

Directus versions <=9.22.4 is vulnerable to Server-Side Request Forgery (SSRF) when importing a file from a remote web server (POST to `/files/import`). An attacker can bypass the security controls that were implemented to patch vulnerability [CVE-2022-23080](https://security.snyk.io/vuln/SNYK-JS-DIRECTUS-2934713) by performing a [DNS rebinding attack](https://en.wikipedia.org/wiki/DNS_rebinding) and view sensitive data from internal servers or perform a local port scan (eg. can access internal metadata API for AWS at `http://169.254.169.254` event if `169.254.169.254` is in the deny IP list).

### Details

*Give all details on the vulnerability. Pointing to the incriminated source code is very helpful for the maintainer.*

DNS rebinding attacks work by running a DNS name server that resolves two different IP addresses when a domain is resolved simultaneously. This type of attack can be exploited to bypass the IP address deny list validation that was added to [`/api/src/services/file.ts`](https://github.com/directus/directus/blob/main/api/src/services/files.ts) for the function `importOne` to mitigate the previous SSRF vulnerability [CVE-2022-23080](https://security.snyk.io/vuln/SNYK-JS-DIRECTUS-2934713). The validation in [`/api/src/services/file.ts`](https://github.com/directus/directus/blob/main/api/src/services/files.ts) first checks if the resolved IP address for a domain name does not a resolve to an IP address in the deny list:

```
let ip = resolvedUrl.hostname;

if (net.isIP(ip) === 0) {
    try {
        ip = (await lookupDNS(ip)).address;
    } catch (err: any) {
        logger.warn(err, `Couldn't lookup the DNS for url ${importURL}`);
        throw new ServiceUnavailableException(`Couldn't fetch file from url "${importURL}"`, {
            service: 'external-file',
        });
    }
}

if (env.IMPORT_IP_DENY_LIST.includes('0.0.0.0')) {
    const networkInterfaces = os.networkInterfaces();

    for (const networkInfo of Object.values(networkInterfaces)) {
        if (!networkInfo) continue;

        for (const info of networkInfo) {
            if (info.address === ip) {
                logger.warn(`Requested URL ${importURL} resolves to localhost.`);
                throw new ServiceUnavailableException(`Couldn't fetch file from url "${importURL}"`, {
                    service: 'external-file',
                });
            }
        }
    }
}

if (env.IMPORT_IP_DENY_LIST.includes(ip)) {
    logger.warn(`Requested URL ${importURL} resolves to a denied IP address.`);
    throw new ServiceUnavailableException(`Couldn't fetch file from url "${importURL}"`, {
        service: 'external-file',
    });
}
```

Once it validates that the resolved IP address is not in the deny list, then it uses `axios` to `GET` the url and saves the response content.

```
try {
    fileResponse = await axios.get<Readable>(encodeURL(importURL), {
        responseType: 'stream',
    });
} catch (err: any) {
    logger.warn(err, `Couldn't fetch file from url "${importURL}"`);
    throw new ServiceUnavailableException(`Couldn't fetch file from url "${importURL}"`, {
        service: 'external-file',
    });
}
```

However, this validation check and fetching the web resource causes to DNS queries that enable a DNS rebinding attack. On the first DNS query, an attacker controlled name server can be configured to resolve to an external IP address that is not in the deny list to bypass the validation. Then when `axios` is called, the name server resolves the domain name to a local IP address.

### PoC

To demonstrate we will be using an online tool named [rebinder](https://lock.cmpxchg8b.com/rebinder.html). Rebinder randomly changes the IP address it resolves to depending on the subdomain. For an example, `7f000001.8efa468e.rbndr.us` can resolve to either `142.250.70.142` (google.com) or **`127.0.0.1`**. Sending multiple `POST` requests to `/files/import` using this domain will eventually cause a resolution to `142.250.70.142` first to bypass the validation then fetch the sensitive from an internal server when `axios` is called.

The following screenshots show what it looks like when a successful attack occurs.

*Downloading a file named `secret.txt` from a webserver running from `http://127.0.0.1/secret.txt`*

[![image](https://user-images.githubusercontent.com/6276577/218124035-26f7f0c3-47b3-424d-b4d4-bd3b47161983.png)](https://user-images.githubusercontent.com/6276577/218124035-26f7f0c3-47b3-424d-b4d4-bd3b47161983.png)

*Receiving the request from the internal server. Note that the incoming connection is from **127.0.0.1**.*

[![image](https://user-images.githubusercontent.com/6276577/218124119-87b8d5d6-934d-4e07-be4d-066616a9a435.png)](https://user-images.githubusercontent.com/6276577/218124119-87b8d5d6-934d-4e07-be4d-066616a9a435.png)

*After downloading the file it leaks the content of the secret file.*

[![image](https://user-images.githubusercontent.com/6276577/218122210-87b2e478-1081-4830-a9ea-e5d9f39bb129.png)](https://user-images.githubusercontent.com/6276577/218122210-87b2e478-1081-4830-a9ea-e5d9f39bb129.png)

### Impact

An attacker can exploit this vulnerability to access highly sensitive internal server and steal sensitive information. An example is on Cloud Environments that utilise internal APIs for managing machine and privileges. For an example, if `directus` is hosted on AWS EC2 instance and has an IAM role assigned to the EC2 instance then an attacker can exploit this vulnerability to steal the AWS access keys to impersonate the EC2 instance using the AWS API.

### Severity

Moderate

5.0

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
Low

User interaction
None

Scope
Changed

Confidentiality
Low

Integrity
None

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:N/A:N

### CVE ID

CVE-2023-26492

### Weaknesses

[CWE-918](/advisories?query=cwe%3A918)

### Credits

* [![@Ccamm](https://avatars.githubusercontent.com/u/6276577?s=40&v=4)](/Ccamm)
  [Ccamm](/Ccamm)
  Reporter
* [![@votr123](https://avatars.githubusercontent.com/u/31153313?s=40&v=4)](/votr123)
  [votr123](/votr123)
  Reporter

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_daf1d8cf_20250115_085046.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdirectus%2Fdirectus%2Fcommit%2Fff53d3e69a602d05342e15d9bb616884833ddbff)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdirectus%2Fdirectus%2Fcommit%2Fff53d3e69a602d05342e15d9bb616884833ddbff)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=directus%2Fdirectus)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[directus](/directus)
/
**[directus](/directus/directus)**
Public

* [Notifications](/login?return_to=%2Fdirectus%2Fdirectus) You must be signed in to change notification settings
* [Fork
  4k](/login?return_to=%2Fdirectus%2Fdirectus)
* [Star
   28.7k](/login?return_to=%2Fdirectus%2Fdirectus)

* [Code](/directus/directus)
* [Issues
  531](/directus/directus/issues)
* [Pull requests
  17](/directus/directus/pulls)
* [Discussions](/directus/directus/discussions)
* [Actions](/directus/directus/actions)
* [Projects
  0](/directus/directus/projects)
* [Security](/directus/directus/security)
* [Insights](/directus/directus/pulse)

Additional navigation options

* [Code](/directus/directus)
* [Issues](/directus/directus/issues)
* [Pull requests](/directus/directus/pulls)
* [Discussions](/directus/directus/discussions)
* [Actions](/directus/directus/actions)
* [Projects](/directus/directus/projects)
* [Security](/directus/directus/security)
* [Insights](/directus/directus/pulse)

## Commit

[Permalink](/directus/directus/commit/ff53d3e69a602d05342e15d9bb616884833ddbff)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Cleanup request handler

[Browse files](/directus/directus/tree/ff53d3e69a602d05342e15d9bb616884833ddbff)
Browse the repository at this point in the history

```
Squashed commit of the following:

commit [9036869](https://github.com/directus/directus/commit/90368698c81ed731c6d9be8b02bfa8ad1b5edd3f)
Author: rijkvanzanten <rijkvanzanten@me.com>
Date:   Mon Feb 13 15:49:12 2023 -0500

    Cleanup

commit [61514f4](https://github.com/directus/directus/commit/61514f45096c22878527f4813fcb78d3b19e4687)
Author: rijkvanzanten <rijkvanzanten@me.com>
Date:   Mon Feb 13 15:44:15 2023 -0500

    Rename to index

commit [38fe6b8](https://github.com/directus/directus/commit/38fe6b84facf17409586d5103ff46081121232cc)
Author: rijkvanzanten <rijkvanzanten@me.com>
Date:   Mon Feb 13 15:41:23 2023 -0500

    Test coverage 100%

commit [f2e36db](https://github.com/directus/directus/commit/f2e36db95eb2ac744667f9d57cedbb7b883a574e)
Author: rijkvanzanten <rijkvanzanten@me.com>
Date:   Mon Feb 13 15:22:45 2023 -0500

    Split up handler from validator

commit [800ac19](https://github.com/directus/directus/commit/800ac1968afe065464fbd399dcb33861ce9fd5b2)
Author: Pascal Jufer <pascal-jufer@bluewin.ch>
Date:   Mon Feb 13 20:44:48 2023 +0100

    Use shared axios instance with URL check for outgoing requests
```

* Loading branch information

[![@rijkvanzanten](https://avatars.githubusercontent.com/u/9141017?s=40&v=4)](/rijkvanzanten)

[rijkvanzanten](/directus/directus/commits?author=rijkvanzanten "View all commits by rijkvanzanten")
committed
Feb 13, 2023

1 parent
[ea91c40](/directus/directus/commit/ea91c4073368d8f76fc7141bc491b9d6b561fef8)

commit ff53d3e

 Show file tree

 Hide file tree

Showing
**11 changed files**
with
**223 additions**
and
**73 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* api/src

  + api/src/env.ts
    [env.ts](#diff-08db4c2c874e5cb71cb4b6caf511f45f26a590a4592fd6d2ebb2a1f0d580a5f3)
  + operations/request

    - api/src/operations/request/index.test.ts
      [index.test.ts](#diff-ff5896cd35333ef2e2fa53599178966decb6e9e9055ea9c82b5f987b75cc6477)
    - api/src/operations/request/index.ts
      [index.ts](#diff-5e503bbeb09d890eeb8efccf6fa5d56b394da7d4ea5dc29daa9256e722fe6d01)
  + request

    - api/src/request/index.test.ts
      [index.test.ts](#diff-20c692d2ef871f5848db840c86765e2583ed9ecae539e4df6c759656152fea5a)
    - api/src/request/index.ts
      [index.ts](#diff-fb47cba69545050b47ff3eb17695b824de0feb7e5db2df43c08f44a0c020f1d3)
    - api/src/request/response-interceptor.test.ts
      [response-interceptor.test.ts](#diff-7510dec2abf47b03e1591c2f0bbbbb594ec597187a7d86535236d9628eb112d5)
    - api/src/request/response-interceptor.ts
      [response-interceptor.ts](#diff-746cdb1639e605c0caa09f147ca734a9ab0664df74051de49b10d28863491fbf)
    - api/src/request/validate-ip.test.ts
      [validate-ip.test.ts](#diff-4c48d72a632ed2ce706700472ec6d1a2ec18c1b42baeded01b723f57dca91daa)
    - api/src/request/validate-ip.ts
      [validate-ip.ts](#diff-ab679f863c137fae79bfe431099ddb76c901b05199a583ea1048e89aec473463)
  + services

    - api/src/services/files.ts
      [files.ts](#diff-989e6837090c2d3ad803a8b7c8bd70c3b1d7706ce90732839b0d61eb1dd82dcc)
  + api/src/webhooks.ts
    [webhooks.ts](#diff-6899d395c207f8c4c23ad547b9defcf86cde3923df7a048d9f8b75752a8ee478)

## There are no files selected for viewing

2 changes: 1 addition & 1 deletion

2
[api/src/env.ts](#diff-08db4c2c874e5cb71cb4b6caf511f45f26a590a4592fd6d2ebb2a1f0d580a5f3 "api/src/env.ts")

Show comments

[View file](/directus/directus/blob/ff53d3e69a602d05342e15d9bb616884833ddbff/api/src/env.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -257,7 +257,7 @@ const defaults: Record<string, any> = { |
|  |  | IP\_TRUST\_PROXY: true, |
|  |  | IP\_CUSTOM\_HEADER: false, |
|  |  |  |
|  |  | IMPORT\_IP\_DENY\_LIST: '0.0.0.0', |
|  |  | IMPORT\_IP\_DENY\_LIST: ['0.0.0.0', '169.254.169.254'], |
|  |  |  |
|  |  | SERVE\_APP: true, |
|  |  |  |
| Expand Down | |  |

15 changes: 8 additions & 7 deletions

15
[api/src/operations/request/index.test.ts](#diff-ff5896cd35333ef2e2fa53599178966decb6e9e9055ea9c82b5f987b75cc6477 "api/src/operations/request/index.test.ts")

Show comments

[View file](/directus/directus/blob/ff53d3e69a602d05342e15d9bb616884833ddbff/api/src/operations/request/index.test.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2,13 +2,14 @@ import { afterEach, expect, test, vi } from 'vitest'; |
|  |  |  |
|  |  | const axiosDefault = vi.fn(); |
|  |  |  |
|  |  | vi.mock('axios', () => ({ |
|  |  | default: axiosDefault.mockResolvedValue({ |
|  |  | status: 200, |
|  |  | statusText: 'OK', |
|  |  | headers: {}, |
|  |  | data: {}, |
|  |  | }), |
|  |  | vi.mock('../../request', () => ({ |
|  |  | getAxios: () => |
|  |  | axiosDefault.mockResolvedValue({ |
|  |  | status: 200, |
|  |  | statusText: 'OK', |
|  |  | headers: {}, |
|  |  | data: {}, |
|  |  | }), |
|  |  | })); |
|  |  |  |
|  |  | const url = '/'; |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[api/src/operations/request/index.ts](#diff-5e503bbeb09d890eeb8efccf6fa5d56b394da7d4ea5dc29daa9256e722fe6d01 "api/src/operations/request/index.ts")

Show comments

[View file](/directus/directus/blob/ff53d3e69a602d05342e15d9bb616884833ddbff/api/src/operations/request/index.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,5 +1,6 @@ |
|  |  | import { defineOperationApi, parseJSON } from '@directus/shared/utils'; |
|  |  | import encodeUrl from 'encodeurl'; |
|  |  | import { getAxios } from '../../request/index'; |
|  |  |  |
|  |  | type Options = { |
|  |  | url: string; |
| Expand All | | @@ -12,8 +13,6 @@ export default defineOperationApi<Options>({ |
|  |  | id: 'request', |
|  |  |  |
|  |  | handler: async ({ url, method, body, headers }) => { |
|  |  | const axios = (await import('axios')).default; |
|  |  |  |
|  |  | const customHeaders = |
|  |  | headers?.reduce((acc, { header, value }) => { |
|  |  | acc[header] = value; |
| Expand All | | @@ -24,6 +23,7 @@ export default defineOperationApi<Options>({ |
|  |  | customHeaders['Content-Type'] = 'application/json'; |
|  |  | } |
|  |  |  |
|  |  | const axios = await getAxios(); |
|  |  | const result = await axios({ |
|  |  | url: encodeUrl(url), |
|  |  | method, |
| Expand Down | |  |

31 changes: 31 additions & 0 deletions

31
[api/src/request/index.test.ts](#diff-20c692d2ef871f5848db840c86765e2583ed9ecae539e4df6c759656152fea5a "api/src/request/index.test.ts")

Show comments

[View file](/directus/directus/blob/ff53d3e69a602d05342e15d9bb616884833ddbff/api/src/request/index.test.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,31 @@ |
|  |  | import { test, vi, afterEach, beforeEach, expect } from 'vitest'; |
|  |  | import { getAxios, \_cache } from './index'; |
|  |  | import axios from 'axios'; |
|  |  | import type { AxiosInstance } from 'axios'; |
|  |  |  |
|  |  | vi.mock('axios'); |
|  |  |  |
|  |  | let mockAxiosInstance: AxiosInstance; |
|  |  |  |
|  |  | beforeEach(() => { |
|  |  | mockAxiosInstance = { |
|  |  | interceptors: { |
|  |  | response: { |
|  |  | use: vi.fn(), |
|  |  | }, |
|  |  | }, |
|  |  | } as unknown as AxiosInstance; |
|  |  |  |
|  |  | vi.mocked(axios.create).mockReturnValue(mockAxiosInstance); |
|  |  | }); |
|  |  |  |
|  |  | afterEach(() => { |
|  |  | vi.resetAllMocks(); |
|  |  | \_cache.axiosInstance = null; |
|  |  | }); |
|  |  |  |
|  |  | test('Creates and returns new axios instance if cache is empty', async () => { |
|  |  | const instance = await getAxios(); |
|  |  | expect(axios.create).toHaveBeenCalled(); |
|  |  | expect(instance).toBe(mockAxiosInstance); |
|  |  | }); |

16 changes: 16 additions & 0 deletions

16
[api/src/request/index.ts](#diff-fb47cba69545050b47ff3eb17695b824de0feb7e5db2df43c08f44a0c020f1d3 "api/src/request/index.ts")

Show comments

[View file](/directus/directus/blob/ff53d3e69a602d05342e15d9bb616884833ddbff/api/src/request/index.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,16 @@ |
|  |  | import type { AxiosInstance } from 'axios'; |
|  |  | import { responseInterceptor } from './response-interceptor'; |
|  |  |  |
|  |  | export const \_cache: { axiosInstance: AxiosInstance | null } = { |
|  |  | axiosInstance: null, |
|  |  | }; |
|  |  |  |
|  |  | export async function getAxios() { |
|  |  | if (!\_cache.axiosInstance) { |
|  |  | const axios = (await import('axios')).default; |
|  |  | \_cache.axiosInstance = axios.create(); |
|  |  | \_cache.axiosInstance.interceptors.response.use(responseInterceptor); |
|  |  | } |
|  |  |  |
|  |  | return \_cache.axiosInstance; |
|  |  | } |

44 changes: 44 additions & 0 deletions

44
[api/src/request/response-interceptor.test.ts](#diff-7510dec2abf47b03e1591c2f0bbbbb594ec597187a7d86535236d9628eb112d5 "api/src/request/response-interceptor.test.ts")

Show comments

[View file](/directus/directus/blob/ff53d3e69a602d05342e15d9bb616884833ddbff/api/src/request/response-interceptor.test.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,44 @@ |
|  |  | import { randIp, randUrl } from '@ngneat/falso'; |
|  |  | import type { AxiosResponse } from 'axios'; |
|  |  | import { afterEach, beforeEach, expect, test, vi } from 'vitest'; |
|  |  | import { responseInterceptor } from './response-interceptor'; |
|  |  | import { validateIP } from './validate-ip'; |
|  |  |  |
|  |  | vi.mock('./validate-ip'); |
|  |  |  |
|  |  | let sample: { |
|  |  | remoteAddress: string; |
|  |  | url: string; |
|  |  | }; |
|  |  |  |
|  |  | let sampleResponseConfig: AxiosResponse<any, any>; |
|  |  |  |
|  |  | beforeEach(() => { |
|  |  | sample = { |
|  |  | remoteAddress: randIp(), |
|  |  | url: randUrl(), |
|  |  | }; |
|  |  |  |
|  |  | sampleResponseConfig = { |
|  |  | request: { |
|  |  | socket: { |
|  |  | remoteAddress: sample.remoteAddress, |
|  |  | }, |
|  |  | url: sample.url, |
|  |  | }, |
|  |  | } as AxiosResponse<any, any>; |
|  |  | }); |
|  |  |  |
|  |  | afterEach(() => { |
|  |  | vi.resetAllMocks(); |
|  |  | }); |
|  |  |  |
|  |  | test(`Calls validateIP with IP/url from axios request config`, async () => { |
|  |  | await responseInterceptor(sampleResponseConfig); |
|  |  | expect(validateIP).toHaveBeenCalledWith(sample.remoteAddress, sample.url); |
|  |  | }); |
|  |  |  |
|  |  | test(`Returns passed in config as-is`, async () => { |
|  |  | const config = await responseInterceptor(sampleResponseConfig); |
|  |  | expect(config).toBe(sampleResponseConfig); |
|  |  | }); |

7 changes: 7 additions & 0 deletions

7
[api/src/request/response-interceptor.ts](#diff-746cdb1639e605c0caa09f147ca734a9ab0664df74051de49b10d28863491fbf "api/src/request/response-interceptor.ts")

Show comments

[View file](/directus/directus/blob/ff53d3e69a602d05342e15d9bb616884833ddbff/api/src/request/response-interceptor.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,7 @@ |
|  |  | import type { AxiosResponse } from 'axios'; |
|  |  | import { validateIP } from './validate-ip'; |
|  |  |  |
|  |  | export const responseInterceptor = async (config: AxiosResponse<any, any>) => { |
|  |  | await validateIP(config.request.socket.remoteAddress, config.request.url); |
|  |  | return config; |
|  |  | }; |

81 changes: 81 additions & 0 deletions

81
[api/src/request/validate-ip.test.ts](#diff-4c48d72a632ed2ce706700472ec6d1a2ec18c1b42baeded01b723f57dca91daa "api/src/request/validate-ip.test.ts")

Show comments

[View file](/directus/directus/blob/ff53d3e69a602d05342e15d9bb616884833ddbff/api/src/request/validate-ip.test.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,81 @@ |
|  |  | import { randIp, randUrl } from '@ngneat/falso'; |
|  |  | import os from 'node:os'; |
|  |  | import { afterEach, beforeEach, expect, test, vi } from 'vitest'; |
|  |  | import { getEnv } from '../env'; |
|  |  | import { validateIP } from './validate-ip'; |
|  |  |  |
|  |  | vi.mock('../env'); |
|  |  | vi.mock('node:os'); |
|  |  |  |
|  |  | let sample: { |
|  |  | ip: string; |
|  |  | url: string; |
|  |  | }; |
|  |  |  |
|  |  | beforeEach(() => { |
|  |  | sample = { |
|  |  | ip: randIp(), |
|  |  | url: randUrl(), |
|  |  | }; |
|  |  | }); |
|  |  |  |
|  |  | afterEach(() => { |
|  |  | vi.resetAllMocks(); |
|  |  | }); |
|  |  |  |
|  |  | test(`Does nothing if IP is valid`, async () => { |
|  |  | vi.mocked(getEnv).mockReturnValue({ IMPORT\_IP\_DENY\_LIST: [] }); |
|  |  | await validateIP(sample.ip, sample.url); |
|  |  | }); |
|  |  |  |
|  |  | test(`Throws error if passed IP is denylisted`, async () => { |
|  |  | vi.mocked(getEnv).mockReturnValue({ IMPORT\_IP\_DENY\_LIST: [sample.ip] }); |
|  |  |  |
|  |  | try { |
|  |  | await validateIP(sample.ip, sample.url); |
|  |  | } catch (err: any) { |
|  |  | expect(err).toBeInstanceOf(Error); |
|  |  | expect(err.message).toBe(`Requested URL "${sample.url}" resolves to a denied IP address`); |
|  |  | } |
|  |  | }); |
|  |  |  |
|  |  | test(`Checks against IPs of local networkInterfaces if IP deny list contains 0.0.0.0`, async () => { |
|  |  | vi.mocked(getEnv).mockReturnValue({ IMPORT\_IP\_DENY\_LIST: ['0.0.0.0'] }); |
|  |  | vi.mocked(os.networkInterfaces).mockReturnValue({}); |
|  |  | await validateIP(sample.ip, sample.url); |
|  |  | expect(os.networkInterfaces).toHaveBeenCalledOnce(); |
|  |  | }); |
|  |  |  |
|  |  | test(`Throws error if IP address matches resolved localhost IP`, async () => { |
|  |  | vi.mocked(getEnv).mockReturnValue({ IMPORT\_IP\_DENY\_LIST: ['0.0.0.0'] }); |
|  |  | vi.mocked(os.networkInterfaces).mockReturnValue({ |
|  |  | fa0: undefined, |
|  |  | lo0: [ |
|  |  | { |
|  |  | address: '127.0.0.1', |
|  |  | netmask: '255.0.0.0', |
|  |  | family: 'IPv4', |
|  |  | mac: '00:00:00:00:00:00', |
|  |  | internal: true, |
|  |  | cidr: '127.0.0.1/8', |
|  |  | }, |
|  |  | ], |
|  |  | en0: [ |
|  |  | { |
|  |  | address: sample.ip, |
|  |  | netmask: '255.0.0.0', |
|  |  | family: 'IPv4', |
|  |  | mac: '00:00:00:00:00:00', |
|  |  | internal: true, |
|  |  | cidr: '127.0.0.1/8', |
|  |  | }, |
|  |  | ], |
|  |  | }); |
|  |  |  |
|  |  | try { |
|  |  | await validateIP(sample.ip, sample.url); |
|  |  | } catch (err: any) { |
|  |  | expect(err).toBeInstanceOf(Error); |
|  |  | expect(err.message).toBe(`Requested URL "${sample.url}" resolves to a denied IP address`); |
|  |  | } |
|  |  | }); |

24 changes: 24 additions & 0 deletions

24
[api/src/request/validate-ip.ts](#diff-ab679f863c137fae79bfe431099ddb76c901b05199a583ea1048e89aec473463 "api/src/request/validate-ip.ts")

Show comments

[View file](/directus/directus/blob/ff53d3e69a602d05342e15d9bb616884833ddbff/api/src/request/validate-ip.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,24 @@ |
|  |  | import os from 'node:os'; |
|  |  | import { getEnv } from '../env'; |
|  |  |  |
|  |  | export const validateIP = async (ip: string, url: string) => { |
|  |  | const env = getEnv(); |
|  |  |  |
|  |  | if (env.IMPORT\_IP\_DENY\_LIST.includes(ip)) { |
|  |  | throw new Error(`Requested URL "${url}" resolves to a denied IP address`); |
|  |  | } |
|  |  |  |
|  |  | if (env.IMPORT\_IP\_DENY\_LIST.includes('0.0.0.0')) { |
|  |  | const networkInterfaces = os.networkInterfaces(); |
|  |  |  |
|  |  | for (const networkInfo of Object.values(networkInterfaces)) { |
|  |  | if (!networkInfo) continue; |
|  |  |  |
|  |  | for (const info of networkInfo) { |
|  |  | if (info.address === ip) { |
|  |  | throw new Error(`Requested URL "${url}" resolves to a denied IP address`); |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  | }; |

62 changes: 4 additions & 58 deletions

62
[api/src/services/files.ts](#diff-989e6837090c2d3ad803a8b7c8bd70c3b1d7706ce90732839b0d61eb1dd82dcc "api/src/services/files.ts")

Show comments

[View file](/directus/directus/blob/ff53d3e69a602d05342e15d9bb616884833ddbff/api/src/services/files.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,22 +1,19 @@ |
|  |  | import { toArray } from '@directus/shared/utils'; |
|  |  | import { lookup } from 'dns'; |
|  |  | import encodeURL from 'encodeurl'; |
|  |  | import exif from 'exif-reader'; |
|  |  | import { parse as parseIcc } from 'icc'; |
|  |  | import { clone, pick } from 'lodash'; |
|  |  | import { extension } from 'mime-types'; |
|  |  | import net from 'net'; |
|  |  | import type { Readable } from 'node:stream'; |
|  |  | import { pipeline } from 'node:stream/promises'; |
|  |  | import os from 'os'; |
|  |  | import path from 'path'; |
|  |  | import sharp from 'sharp'; |
|  |  | import url, { URL } from 'url'; |
|  |  | import { promisify } from 'util'; |
|  |  | import url from 'url'; |
|  |  | import emitter from '../emitter'; |
|  |  | import env from '../env'; |
|  |  | import { ForbiddenException, InvalidPayloadException, ServiceUnavailableException } from '../exceptions'; |
|  |  | import logger from '../logger'; |
|  |  | import { getAxios } from '../request/index'; |
|  |  | import { getStorage } from '../storage'; |
|  |  | import { AbstractServiceOptions, File, Metadata, MutationOptions, PrimaryKey } from '../types'; |
|  |  | import { parseIptc, parseXmp } from '../utils/parse-image-metadata'; |
| Expand All | | @@ -25,8 +22,6 @@ import { ItemsService } from './items'; |
|  |  | // @ts-ignore |
|  |  | import formatTitle from '@directus/format-title'; |
|  |  |  |
|  |  | const lookupDNS = promisify(lookup); |
|  |  |  |
|  |  | export class FilesService extends ItemsService { |
|  |  | constructor(options: AbstractServiceOptions) { |
|  |  | super('directus\_files', options); |
| Expand Down  Expand Up | | @@ -224,8 +219,6 @@ export class FilesService extends ItemsService { |
|  |  | \* Import a single file from an external URL |
|  |  | \*/ |
|  |  | async importOne(importURL: string, body: Partial<File>): Promise<PrimaryKey> { |
|  |  | const axios = (await import('axios')).default; |
|  |  |  |
|  |  | const fileCreatePermissions = this.accountability?.permissions?.find( |
|  |  | (permission) => permission.collection === 'directus\_files' && permission.action === 'create' |
|  |  | ); |
| Expand All | | @@ -234,62 +227,15 @@ export class FilesService extends ItemsService { |
|  |  | throw new ForbiddenException(); |
|  |  | } |
|  |  |  |
|  |  | let resolvedUrl; |
|  |  |  |
|  |  | try { |
|  |  | resolvedUrl = new URL(importURL); |
|  |  | } catch (err: any) { |
|  |  | logger.warn(err, `Requested URL ${importURL} isn't a valid URL`); |
|  |  | throw new ServiceUnavailableException(`Couldn't fetch file from url "${importURL}"`, { |
|  |  | service: 'external-file', |
|  |  | }); |
|  |  | } |
|  |  |  |
|  |  | let ip = resolvedUrl.hostname; |
|  |  |  |
|  |  | if (net.isIP(ip) === 0) { |
|  |  | try { |
|  |  | ip = (await lookupDNS(ip)).address; |
|  |  | } catch (err: any) { |
|  |  | logger.warn(err, `Couldn't lookup the DNS for url ${importURL}`); |
|  |  | throw new ServiceUnavailableException(`Couldn't fetch file from url "${importURL}"`, { |
|  |  | service: 'external-file', |
|  |  | }); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | if (env.IMPORT\_IP\_DENY\_LIST.includes('0.0.0.0')) { |
|  |  | const networkInterfaces = os.networkInterfaces(); |
|  |  |  |
|  |  | for (const networkInfo of Object.values(networkInterfaces)) { |
|  |  | if (!networkInfo) continue; |
|  |  |  |
|  |  | for (const info of networkInfo) { |
|  |  | if (info.address === ip) { |
|  |  | logger.warn(`Requested URL ${importURL} resolves to localhost.`); |
|  |  | throw new ServiceUnavailableException(`Couldn't fetch file from url "${importURL}"`, { |
|  |  | service: 'external-file', |
|  |  | }); |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | if (env.IMPORT\_IP\_DENY\_LIST.includes(ip)) { |
|  |  | logger.warn(`Requested URL ${importURL} resolves to a denied IP address.`); |
|  |  | throw new ServiceUnavailableException(`Couldn't fetch file from url "${importURL}"`, { |
|  |  | service: 'external-file', |
|  |  | }); |
|  |  | } |
|  |  |  |
|  |  | let fileResponse; |
|  |  |  |
|  |  | try { |
|  |  | const axios = await getAxios(); |
|  |  | fileResponse = await axios.get<Readable>(encodeURL(importURL), { |
|  |  | responseType: 'stream', |
|  |  | }); |
|  |  | } catch (err: any) { |
|  |  | logger.warn(err, `Couldn't fetch file from url "${importURL}"`); |
|  |  | logger.warn(err, `Couldn't fetch file from URL "${importURL}"`); |
|  |  | throw new ServiceUnavailableException(`Couldn't fetch file from url "${importURL}"`, { |
|  |  | service: 'external-file', |
|  |  | }); |
| Expand Down | |  |

10 changes: 5 additions & 5 deletions

10
[api/src/webhooks.ts](#diff-6899d395c207f8c4c23ad547b9defcf86cde3923df7a048d9f8b75752a8ee478 "api/src/webhooks.ts")

Show comments

[View file](/directus/directus/blob/ff53d3e69a602d05342e15d9bb616884833ddbff/api/src/webhooks.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,11 +1,12 @@ |
|  |  | import { ActionHandler } from '@directus/shared/types'; |
|  |  | import getDatabase from './database'; |
|  |  | import emitter from './emitter'; |
|  |  | import logger from './logger'; |
|  |  | import { Webhook, WebhookHeader } from './types'; |
|  |  | import { getMessenger } from './messenger'; |
|  |  | import { getAxios } from './request/index'; |
|  |  | import { WebhooksService } from './services'; |
|  |  | import { Webhook, WebhookHeader } from './types'; |
|  |  | import { getSchema } from './utils/get-schema'; |
|  |  | import { ActionHandler } from '@directus/shared/types'; |
|  |  | import { getMessenger } from './messenger'; |
|  |  | import { JobQueue } from './utils/job-queue'; |
|  |  |  |
|  |  | let registered: { event: string; handler: ActionHandler }[] = []; |
| Expand Down  Expand Up | | @@ -55,9 +56,8 @@ export function unregister(): void { |
|  |  |  |
|  |  | function createHandler(webhook: Webhook, event: string): ActionHandler { |
|  |  | return async (meta, context) => { |
|  |  | const axios = (await import('axios')).default; |
|  |  |  |
|  |  | if (webhook.collections.includes(meta.collection) === false) return; |
|  |  | const axios = await getAxios(); |
|  |  |  |
|  |  | const webhookPayload = { |
|  |  | event, |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `ff53d3e`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdirectus%2Fdirectus%2Fcommit%2Fff53d3e69a602d05342e15d9bb616884833ddbff) to comment.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.


