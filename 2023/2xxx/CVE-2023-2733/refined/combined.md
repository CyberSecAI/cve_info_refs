=== Content from www.wordfence.com_271db5c2_20250114_221508.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# MStore API <= 3.9.0 - Authentication Bypass

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   MStore API <= 3.9.0 - Authentication Bypass

9.8

**Authentication Bypass Using an Alternate Path or Channel**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

| CVE | [CVE-2023-2733](https://www.cve.org/CVERecord?id=CVE-2023-2733) |
| --- | --- |
| CVSS | 9.8 (Critical) |
| Publicly Published | May 17, 2023 |
| Last Updated | January 22, 2024 |
| Researcher | [István Márton - Wordfence](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/lana-codes) |

### Description

The MStore API plugin for WordPress is vulnerable to authentication bypass in versions up to, and including, 3.9.0. This is due to insufficient verification on the user being supplied during the coupon redemption REST API request through the plugin. This makes it possible for unauthenticated attackers to log in as any existing user on the site, such as an administrator, if they have access to the user id.

Wordfence blocked **6 attacks** targeting this vulnerability in the past 24 hours.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/mstore-api/tags/3.9.0/controllers/flutter-woo.php#L734)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&new=2913397%40mstore-api&old=2910707%40mstore-api&sfp_email=&sfph_mail=#file60)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fmstore-api%2Fmstore-api-390-authentication-bypass&t=MStore%20API%20%3C%3D%203.9.0%20-%20Authentication%20Bypass "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fmstore-api%2Fmstore-api-390-authentication-bypass&text=MStore%20API%20%3C%3D%203.9.0%20-%20Authentication%20Bypass "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fmstore-api%2Fmstore-api-390-authentication-bypass "LinkedIn")
Email

## Vulnerability Details for MStore API – Create Native Android & iOS Apps On The Cloud

#### [MStore API – Create Native Android & iOS Apps On The Cloud](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/mstore-api)

| Software Type | Plugin |
| --- | --- |
| Software Slug | mstore-api [(view on wordpress.org)](https://wordpress.org/plugins/mstore-api) |
| Patched? | Yes |
| Remediation | Update to version 3.9.1, or a newer patched version |
| Affected Version | * <= 3.9.0 |
| Patched Version | * 3.9.1 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_f4bbacb1_20250114_221504.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fmstore-api%2Ftags%2F3.9.0%2Fcontrollers%2Fflutter-woo.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Blame](/browser/mstore-api/tags/3.9.0/controllers/flutter-woo.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/mstore-api/tags/3.9.0/controllers/flutter-woo.php)

---

# [source:](/browser?order=name "Go to repository root") [mstore-api](/browser/mstore-api?order=name "View mstore-api")/[tags](/browser/mstore-api/tags?order=name "View tags")/[3.9.0](/browser/mstore-api/tags/3.9.0?order=name "View 3.9.0")/[controllers](/browser/mstore-api/tags/3.9.0/controllers?order=name "View controllers")/[flutter-woo.php](/browser/mstore-api/tags/3.9.0/controllers/flutter-woo.php?order=name "View flutter-woo.php")

View diff against:

View revision:

| [Last change](/changeset/2910532/mstore-api/tags/3.9.0/controllers/flutter-woo.php "View differences") on this file was [2910532](/changeset/2910532/ "View changeset 2910532"), checked in by inspireui, [21 months ago](/timeline?from=2023-05-10T08%3A15%3A16Z&precision=second "See timeline at 05/10/2023 08:15:16 AM") |
| --- |
| version 3.9.0 |
| * Property **svn:eol-style** set to   *`native`* | |
| **File size:** 54.1 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | require\_once(\_\_DIR\_\_ . '/flutter-base.php'); |
| [3](#L3) |  |
| [4](#L4) | /\* |
| [5](#L5) | \* Base REST Controller for flutter |
| [6](#L6) | \* |
| [7](#L7) | \* @since 1.4.0 |
| [8](#L8) | \* |
| [9](#L9) | \* @package shipping |
| [10](#L10) | \*/ |
| [11](#L11) |  |
| [12](#L12) | class FlutterWoo extends FlutterBaseController |
| [13](#L13) | { |
| [14](#L14) | /\*\* |
| [15](#L15) | \* Endpoint namespace |
| [16](#L16) | \* |
| [17](#L17) | \* @var string |
| [18](#L18) | \*/ |
| [19](#L19) | protected $namespace = 'api/flutter\_woo'; |
| [20](#L20) |  |
| [21](#L21) | /\*\* |
| [22](#L22) | \* Register all routes releated with stores |
| [23](#L23) | \* |
| [24](#L24) | \* @return void |
| [25](#L25) | \*/ |
| [26](#L26) | public function \_\_construct() |
| [27](#L27) | { |
| [28](#L28) | add\_action('rest\_api\_init', array($this, 'register\_flutter\_woo\_routes')); |
| [29](#L29) | } |
| [30](#L30) |  |
| [31](#L31) | public function register\_flutter\_woo\_routes() |
| [32](#L32) | { |
| [33](#L33) | register\_rest\_route($this->namespace, '/shipping\_methods', array( |
| [34](#L34) | array( |
| [35](#L35) | 'methods' => WP\_REST\_Server::CREATABLE, |
| [36](#L36) | 'callback' => array($this, 'shipping\_methods'), |
| [37](#L37) | 'permission\_callback' => function () { |
| [38](#L38) | return parent::checkApiPermission(); |
| [39](#L39) | } |
| [40](#L40) | ), |
| [41](#L41) | )); |
| [42](#L42) |  |
| [43](#L43) | register\_rest\_route($this->namespace, '/ddates', array( |
| [44](#L44) | array( |
| [45](#L45) | 'methods' => "GET", |
| [46](#L46) | 'callback' => array($this, 'get\_ddates'), |
| [47](#L47) | 'permission\_callback' => function () { |
| [48](#L48) | return parent::checkApiPermission(); |
| [49](#L49) | } |
| [50](#L50) | ), |
| [51](#L51) | )); |
| [52](#L52) |  |
| [53](#L53) | register\_rest\_route($this->namespace, '/payment\_methods', array( |
| [54](#L54) | array( |
| [55](#L55) | 'methods' => WP\_REST\_Server::CREATABLE, |
| [56](#L56) | 'callback' => array($this, 'payment\_methods'), |
| [57](#L57) | 'permission\_callback' => function () { |
| [58](#L58) | return parent::checkApiPermission(); |
| [59](#L59) | } |
| [60](#L60) | ), |
| [61](#L61) | )); |
| [62](#L62) |  |
| [63](#L63) | register\_rest\_route($this->namespace, '/coupon', array( |
| [64](#L64) | array( |
| [65](#L65) | 'methods' => WP\_REST\_Server::CREATABLE, |
| [66](#L66) | 'callback' => array($this, 'coupon'), |
| [67](#L67) | 'permission\_callback' => function () { |
| [68](#L68) | return parent::checkApiPermission(); |
| [69](#L69) | } |
| [70](#L70) | ), |
| [71](#L71) | )); |
| [72](#L72) |  |
| [73](#L73) | register\_rest\_route($this->namespace, '/cart', array( |
| [74](#L74) | array( |
| [75](#L75) | 'methods' => "GET", |
| [76](#L76) | 'callback' => array($this, 'get\_cart'), |
| [77](#L77) | 'permission\_callback' => function () { |
| [78](#L78) | return parent::checkApiPermission(); |
| [79](#L79) | } |
| [80](#L80) | ), |
| [81](#L81) | )); |
| [82](#L82) |  |
| [83](#L83) | register\_rest\_route($this->namespace, '/cart', array( |
| [84](#L84) | array( |
| [85](#L85) | 'methods' => "POST", |
| [86](#L86) | 'callback' => array($this, 'sync\_cart\_from\_mobile'), |
| [87](#L87) | 'permission\_callback' => function () { |
| [88](#L88) | return parent::checkApiPermission(); |
| [89](#L89) | } |
| [90](#L90) | ), |
| [91](#L91) | )); |
| [92](#L92) |  |
| [93](#L93) | $config\_file = array( |
| [94](#L94) | array( |
| [95](#L95) | 'methods' => WP\_REST\_Server::CREATABLE, |
| [96](#L96) | 'callback' => array($this, 'upload\_config\_file'), |
| [97](#L97) | 'permission\_callback' => array($this, 'check\_upload\_file\_permission'), |
| [98](#L98) | ), |
| [99](#L99) | ); |
| [100](#L100) | register\_rest\_route($this->namespace, '/config-file', $config\_file); |
| [101](#L101) |  |
| [102](#L102) | register\_rest\_route($this->namespace, '/taxes', array( |
| [103](#L103) | array( |
| [104](#L104) | 'methods' => "POST", |
| [105](#L105) | 'callback' => array($this, 'get\_taxes'), |
| [106](#L106) | 'permission\_callback' => function () { |
| [107](#L107) | return parent::checkApiPermission(); |
| [108](#L108) | } |
| [109](#L109) | ), |
| [110](#L110) | )); |
| [111](#L111) |  |
| [112](#L112) | register\_rest\_route($this->namespace, '/points', array( |
| [113](#L113) | array( |
| [114](#L114) | 'methods' => "GET", |
| [115](#L115) | 'callback' => array($this, 'get\_points'), |
| [116](#L116) | 'permission\_callback' => function () { |
| [117](#L117) | return parent::checkApiPermission(); |
| [118](#L118) | } |
| [119](#L119) | ), |
| [120](#L120) | )); |
| [121](#L121) |  |
| [122](#L122) | register\_rest\_route($this->namespace, '/points', array( |
| [123](#L123) | array( |
| [124](#L124) | 'methods' => "PATCH", |
| [125](#L125) | 'callback' => array($this, 'update\_points'), |
| [126](#L126) | 'permission\_callback' => function () { |
| [127](#L127) | return parent::checkApiPermission(); |
| [128](#L128) | } |
| [129](#L129) | ), |
| [130](#L130) | )); |
| [131](#L131) |  |
| [132](#L132) | register\_rest\_route($this->namespace, '/products/reviews', array( |
| [133](#L133) | array( |
| [134](#L134) | 'methods' => "POST", |
| [135](#L135) | 'callback' => array($this, 'create\_product\_review'), |
| [136](#L136) | 'permission\_callback' => function () { |
| [137](#L137) | return parent::checkApiPermission(); |
| [138](#L138) | } |
| [139](#L139) | ), |
| [140](#L140) | )); |
| [141](#L141) | register\_rest\_route($this->namespace, '/products/dynamic', array( |
| [142](#L142) | array( |
| [143](#L143) | 'methods' => "GET", |
| [144](#L144) | 'callback' => array($this, 'get\_product\_from\_dynamic\_link'), |
| [145](#L145) | 'permission\_callback' => function () { |
| [146](#L146) | return parent::checkApiPermission(); |
| [147](#L147) | } |
| [148](#L148) | ), |
| [149](#L149) | )); |
| [150](#L150) | register\_rest\_route($this->namespace, '/product-category/dynamic', array( |
| [151](#L151) | array( |
| [152](#L152) | 'methods' => "GET", |
| [153](#L153) | 'callback' => array($this, 'get\_product\_category\_from\_dynamic\_link'), |
| [154](#L154) | 'permission\_callback' => function () { |
| [155](#L155) | return parent::checkApiPermission(); |
| [156](#L156) | } |
| [157](#L157) | ), |
| [158](#L158) | )); |
| [159](#L159) | register\_rest\_route($this->namespace, '/blog/dynamic', array( |
| [160](#L160) | array( |
| [161](#L161) | 'methods' => "GET", |
| [162](#L162) | 'callback' => array($this, 'get\_blog\_from\_dynamic\_link'), |
| [163](#L163) | 'permission\_callback' => function () { |
| [164](#L164) | return parent::checkApiPermission(); |
| [165](#L165) | } |
| [166](#L166) | ), |
| [167](#L167) | )); |
| [168](#L168) |  |
| [169](#L169) | register\_rest\_route( $this->namespace,  '/blog/create', array( |
| [170](#L170) | array( |
| [171](#L171) | 'methods' => "POST", |
| [172](#L172) | 'callback' => array( $this, 'create\_blog' ), |
| [173](#L173) | 'permission\_callback' => function () { |
| [174](#L174) | return parent::checkApiPermission(); |
| [175](#L175) | } |
| [176](#L176) | ), |
| [177](#L177) | )); |
| [178](#L178) |  |
| [179](#L179) | register\_rest\_route( $this->namespace,  '/blog/comment', array( |
| [180](#L180) | array( |
| [181](#L181) | 'methods' => "POST", |
| [182](#L182) | 'callback' => array( $this, 'create\_comment' ), |
| [183](#L183) | 'permission\_callback' => function () { |
| [184](#L184) | return parent::checkApiPermission(); |
| [185](#L185) | } |
| [186](#L186) | ), |
| [187](#L187) | )); |
| [188](#L188) |  |
| [189](#L189) | register\_rest\_route($this->namespace, '/scanner', array( |
| [190](#L190) | array( |
| [191](#L191) | 'methods' => "GET", |
| [192](#L192) | 'callback' => array($this, 'get\_data\_from\_scanner'), |
| [193](#L193) | 'permission\_callback' => function () { |
| [194](#L194) | return parent::checkApiPermission(); |
| [195](#L195) | } |
| [196](#L196) | ), |
| [197](#L197) | )); |
| [198](#L198) |  |
| [199](#L199) | register\_rest\_route( $this->namespace,  '/products'. '/(?P<id>[\d]+)'.'/check', array( |
| [200](#L200) | 'args' => array( |
| [201](#L201) | 'id' => array( |
| [202](#L202) | 'description' => \_\_('Unique identifier for the resource.', 'woocommerce'), |
| [203](#L203) | 'type' => 'integer', |
| [204](#L204) | ), |
| [205](#L205) | ), |
| [206](#L206) | array( |
| [207](#L207) | 'methods' => "GET", |
| [208](#L208) | 'callback' => array( $this, 'check\_product' ), |
| [209](#L209) | 'permission\_callback' => function () { |
| [210](#L210) | return parent::checkApiPermission(); |
| [211](#L211) | } |
| [212](#L212) | ), |
| [213](#L213) | )); |
| [214](#L214) |  |
| [215](#L215) | register\_rest\_route( $this->namespace,  '/products'. '/(?P<id>[\d]+)'.'/rating\_counts', array( |
| [216](#L216) | 'args' => array( |
| [217](#L217) | 'id' => array( |
| [218](#L218) | 'description' => \_\_('Unique identifier for the resource.', 'woocommerce'), |
| [219](#L219) | 'type' => 'integer', |
| [220](#L220) | ), |
| [221](#L221) | ), |
| [222](#L222) | array( |
| [223](#L223) | 'methods' => "GET", |
| [224](#L224) | 'callback' => array( $this, 'get\_product\_rating\_counts' ), |
| [225](#L225) | 'permission\_callback' => function () { |
| [226](#L226) | return parent::checkApiPermission(); |
| [227](#L227) | } |
| [228](#L228) | ), |
| [229](#L229) | )); |
| [230](#L230) |  |
| [231](#L231) | register\_rest\_route($this->namespace, '/products/video', array( |
| [232](#L232) | array( |
| [233](#L233) | 'methods' => "GET", |
| [234](#L234) | 'callback' => array($this, 'get\_products\_video'), |
| [235](#L235) | 'permission\_callback' => function () { |
| [236](#L236) | return parent::checkApiPermission(); |
| [237](#L237) | } |
| [238](#L238) | ), |
| [239](#L239) | )); |
| [240](#L240) | } |
| [241](#L241) |  |
| [242](#L242) | function get\_data\_from\_scanner($request){ |
| [243](#L243) | $data = sanitize\_text\_field($request['data']); |
| [244](#L244) | $token = sanitize\_text\_field($request['token']); |
| [245](#L245) | if(isset($data) && is\_numeric($data)){ |
| [246](#L246) | $type = get\_post\_type($data); |
| [247](#L247) |  |
| [248](#L248) | if($type){ |
| [249](#L249) | if($type == 'product'){ |
| [250](#L250) | $controller = new CUSTOM\_WC\_REST\_Products\_Controller(); |
| [251](#L251) | $req = new WP\_REST\_Request('GET'); |
| [252](#L252) | $params = array('status' =>'published', 'include' => [$data], 'page'=>1, 'per\_page'=>10); |
| [253](#L253) | $req->set\_query\_params($params); |
| [254](#L254) | $response = $controller->get\_items($req); |
| [255](#L255) | return array( |
| [256](#L256) | 'type' => $type, |
| [257](#L257) | 'data' => $response->get\_data(), |
| [258](#L258) | ); |
| [259](#L259) | } |
| [260](#L260) |  |
| [261](#L261) |  |
| [262](#L262) | if($type == 'shop\_order'){ |
| [263](#L263) | if (isset($token)) { |
| [264](#L264) | $cookie = urldecode(base64\_decode($token)); |
| [265](#L265) | } else { |
| [266](#L266) | return parent::sendError("unauthorized", "You are not allowed to do this", 401); |
| [267](#L267) | } |
| [268](#L268) | $user\_id = validateCookieLogin($cookie); |
| [269](#L269) | if (is\_wp\_error($user\_id)) { |
| [270](#L270) | return $user\_id; |
| [271](#L271) | } |
| [272](#L272) |  |
| [273](#L273) |  |
| [274](#L274) | $api = new WC\_REST\_Orders\_V1\_Controller(); |
| [275](#L275) | $order = wc\_get\_order($data); |
| [276](#L276) | $customer\_id = $order->get\_user\_id(); |
| [277](#L277) | if($user\_id != $customer\_id){ |
| [278](#L278) | return parent::sendError("unauthorized", "You are not allowed to do this", 401); |
| [279](#L279) | } |
| [280](#L280) | $response = $api->prepare\_item\_for\_response($order, $request); |
| [281](#L281) | $order = $response->get\_data(); |
| [282](#L282) | $count = count($order["line\_items"]); |
| [283](#L283) | $order["product\_count"] = $count; |
| [284](#L284) | $line\_items = array(); |
| [285](#L285) | for ($i = 0; $i < $count; $i++) { |
| [286](#L286) | $image = wp\_get\_attachment\_image\_src( |
| [287](#L287) | get\_post\_thumbnail\_id($product\_id) |
| [288](#L288) | ); |
| [289](#L289) | if (!is\_null($image[0])) { |
| [290](#L290) | $order["line\_items"][$i]["featured\_image"] = $image[0]; |
| [291](#L291) | } |
| [292](#L292) | $order\_item = new WC\_Order\_Item\_Product($order["line\_items"][$i]["id"]); |
| [293](#L293) | $order["line\_items"][$i]["meta"] = $order\_item->get\_meta\_data(); |
| [294](#L294) | if (is\_plugin\_active('wc-frontend-manager-delivery/wc-frontend-manager-delivery.php')) { |
| [295](#L295) | $table\_name = $wpdb->prefix . "wcfm\_delivery\_orders"; |
| [296](#L296) | $sql = "SELECT delivery\_boy FROM `{$table\_name}`"; |
| [297](#L297) | $sql .= " WHERE 1=1"; |
| [298](#L298) | $sql .= " AND product\_id = '{$product\_id}'"; |
| [299](#L299) | $sql .= " AND order\_id = '{$item->order\_id}'"; |
| [300](#L300) | $users = $wpdb->get\_results($sql); |
| [301](#L301) |  |
| [302](#L302) | if (count($users) > 0) { |
| [303](#L303) | $user = get\_userdata($users[0]->delivery\_boy); |
| [304](#L304) | $order["line\_items"][$i]['delivery\_user'] = [ |
| [305](#L305) | "id" => $user->ID, |
| [306](#L306) | "name" => $user->display\_name, |
| [307](#L307) | "profile\_picture" => $profile\_pic, |
| [308](#L308) | ]; |
| [309](#L309) | } |
| [310](#L310) | } |
| [311](#L311) | $line\_items[] = $order["line\_items"][$i]; |
| [312](#L312) | } |
| [313](#L313) | $order["line\_items"] = $line\_items; |
| [314](#L314) |  |
| [315](#L315) | return array( |
| [316](#L316) | 'type' => $type, |
| [317](#L317) | 'data' => [$order], |
| [318](#L318) | ); |
| [319](#L319) | } |
| [320](#L320) | } |
| [321](#L321) | } |
| [322](#L322) | return parent::sendError("invalid\_data", "Invalid data", 400); |
| [323](#L323) | } |
| [324](#L324) |  |
| [325](#L325) | function check\_upload\_file\_permission($request){ |
| [326](#L326) | $base\_permission = parent::checkApiPermission(); |
| [327](#L327) | if(!$base\_permission){ |
| [328](#L328) | return false; |
| [329](#L329) | } |
| [330](#L330) | $cookie = $request->get\_header("User-Cookie"); |
| [331](#L331) | if (isset($cookie) && $cookie != null) { |
| [332](#L332) | $user\_id = validateCookieLogin($cookie); |
| [333](#L333) | if (is\_wp\_error($user\_id)) { |
| [334](#L334) | return false; |
| [335](#L335) | } |
| [336](#L336) | return is\_super\_admin( $user\_id ); |
| [337](#L337) | } |
| [338](#L338) | return false; |
| [339](#L339) | } |
| [340](#L340) |  |
| [341](#L341) | /\*\* |
| [342](#L342) | \* Check any prerequisites for our REST request. |
| [343](#L343) | \*/ |
| [344](#L344) | private function check\_prerequisites() |
| [345](#L345) | { |
| [346](#L346) | if (defined('WC\_ABSPATH')) { |
| [347](#L347) | // WC 3.6+ - Cart and other frontend functions are not included for REST requests. |
| [348](#L348) | include\_once WC\_ABSPATH . 'includes/wc-cart-functions.php'; |
| [349](#L349) | include\_once WC\_ABSPATH . 'includes/wc-notice-functions.php'; |
| [350](#L350) | include\_once WC\_ABSPATH . 'includes/wc-template-hooks.php'; |
| [351](#L351) | } |
| [352](#L352) |  |
| [353](#L353) | if (null === WC()->session) { |
| [354](#L354) | $session\_class = apply\_filters('woocommerce\_session\_handler', 'WC\_Session\_Handler'); |
| [355](#L355) |  |
| [356](#L356) | WC()->session = new $session\_class(); |
| [357](#L357) | WC()->session->init(); |
| [358](#L358) | } |
| [359](#L359) |  |
| [360](#L360) | if (null === WC()->customer) { |
| [361](#L361) | WC()->customer = new WC\_Customer(get\_current\_user\_id(), true); |
| [362](#L362) | } |
| [363](#L363) |  |
| [364](#L364) | if (null === WC()->cart) { |
| [365](#L365) | WC()->cart = new WC\_Cart(); |
| [366](#L366) | } |
| [367](#L367) | WC()->cart->empty\_cart(true); |
| [368](#L368) | } |
| [369](#L369) |  |
| [370](#L370) | function get\_product\_from\_dynamic\_link($request) |
| [371](#L371) | { |
| [372](#L372) | if (isset($request['url'])) { |
| [373](#L373) | $url = $request['url']; |
| [374](#L374) | $langs = ["en", "ar", "vi"]; |
| [375](#L375) | foreach( $langs as $lang ) { |
| [376](#L376) | $url = str\_replace("/". $lang,"",$url); |
| [377](#L377) | } |
| [378](#L378) | $product\_id = url\_to\_postid($url); |
| [379](#L379) | $controller = new CUSTOM\_WC\_REST\_Products\_Controller(); |
| [380](#L380) | $req = new WP\_REST\_Request('GET'); |
| [381](#L381) | //$params = array('status' => 'published', 'include[0]' => $product\_id, 'page'=>1, 'per\_page'=>10, 'lang'=>'en'); |
| [382](#L382) | $params = array('status' => 'published', 'include' => [$product\_id], 'page'=>1, 'per\_page'=>10, 'lang'=>'en'); |
| [383](#L383) | $req->set\_query\_params($params); |
| [384](#L384) |  |
| [385](#L385) | $response = $controller->get\_items($req); |
| [386](#L386) | return $response->get\_data(); |
| [387](#L387) | } |
| [388](#L388) | return parent::sendError("invalid\_url", "Not Found", 404); |
| [389](#L389) | } |
| [390](#L390) |  |
| [391](#L391) | function get\_product\_category\_from\_dynamic\_link($request) |
| [392](#L392) | { |
| [393](#L393) | if (isset($request['url'])) { |
| [394](#L394) | $url = $request['url']; |
| [395](#L395) | $items = explode("/", $url); |
| [396](#L396) | $slug = null; |
| [397](#L397) | for ($i = count($items) - 1; $i >= 0; $i--) { |
| [398](#L398) | if (strlen($items[$i]) > 0) { |
| [399](#L399) | $slug = $items[$i]; |
| [400](#L400) | break; |
| [401](#L401) | } |
| [402](#L402) | } |
| [403](#L403) | $term = get\_term\_by('slug', $slug, 'product\_cat'); |
| [404](#L404) | if ($term != false) { |
| [405](#L405) | $controller = new WC\_REST\_Product\_Categories\_Controller(); |
| [406](#L406) | $req = new WP\_REST\_Request('GET'); |
| [407](#L407) | $params = array('include' => [$term->term\_id], 'page'=>1, 'per\_page'=>10); |
| [408](#L408) | $req->set\_query\_params($params); |
| [409](#L409) | $response = $controller->get\_items($req); |
| [410](#L410) | return $response->get\_data(); |
| [411](#L411) | } else { |
| [412](#L412) | return parent::sendError("invalid\_url", "Not Found", 404); |
| [413](#L413) | } |
| [414](#L414) | } |
| [415](#L415) | } |
| [416](#L416) |  |
| [417](#L417) | /\*\* |
| [418](#L418) | \* Add a product to the cart. |
| [419](#L419) | \* |
| [420](#L420) | \* @param int $product\_id contains the id of the product to add to the cart. |
| [421](#L421) | \* @param int $quantity contains the quantity of the item to add. |
| [422](#L422) | \* @param int $variation\_id ID of the variation being added to the cart. |
| [423](#L423) | \* @param array $variation attribute values. |
| [424](#L424) | \* @param array $cart\_item\_data extra cart item data we want to pass into the item. |
| [425](#L425) | \* @return string|bool $cart\_item\_key |
| [426](#L426) | \* @throws Exception Plugins can throw an exception to prevent adding to cart. |
| [427](#L427) | \*/ |
| [428](#L428) | public function add\_to\_cart($product\_id = 0, $quantity = 1, $variation\_id = 0, $variation = array(), $cart\_item\_data = array()) |
| [429](#L429) | { |
| [430](#L430) | try { |
| [431](#L431) | $product\_id = absint($product\_id); |
| [432](#L432) | $variation\_id = absint($variation\_id); |
| [433](#L433) |  |
| [434](#L434) | // Ensure we don't add a variation to the cart directly by variation ID. |
| [435](#L435) | if ('product\_variation' === get\_post\_type($product\_id)) { |
| [436](#L436) | $variation\_id = $product\_id; |
| [437](#L437) | $product\_id = wp\_get\_post\_parent\_id($variation\_id); |
| [438](#L438) | } |
| [439](#L439) |  |
| [440](#L440) | $product\_data = wc\_get\_product($variation\_id ? $variation\_id : $product\_id); |
| [441](#L441) | $quantity = apply\_filters('woocommerce\_add\_to\_cart\_quantity', $quantity, $product\_id); |
| [442](#L442) |  |
| [443](#L443) | if ($quantity <= 0) { |
| [444](#L444) | throw new Exception("The quantity must be a valid number greater than 0"); |
| [445](#L445) | } |
| [446](#L446) | if (!$product\_data) { |
| [447](#L447) | throw new Exception("The product is not found"); |
| [448](#L448) | } |
| [449](#L449) | if ('trash' === $product\_data->get\_status()) { |
| [450](#L450) | throw new Exception("The product is trash"); |
| [451](#L451) | } |
| [452](#L452) |  |
| [453](#L453) | // Load cart item data - may be added by other plugins. |
| [454](#L454) | $cart\_item\_data = (array)apply\_filters('woocommerce\_add\_cart\_item\_data', $cart\_item\_data, $product\_id, $variation\_id, $quantity); |
| [455](#L455) |  |
| [456](#L456) | // Generate a ID based on product ID, variation ID, variation data, and other cart item data. |
| [457](#L457) | $cart\_id = WC()->cart->generate\_cart\_id($product\_id, $variation\_id, $variation, $cart\_item\_data); |
| [458](#L458) |  |
| [459](#L459) | // Find the cart item key in the existing cart. |
| [460](#L460) | $cart\_item\_key = WC()->cart->find\_product\_in\_cart($cart\_id); |
| [461](#L461) |  |
| [462](#L462) | // Force quantity to 1 if sold individually and check for existing item in cart. |
| [463](#L463) | if ($product\_data->is\_sold\_individually()) { |
| [464](#L464) | $quantity = apply\_filters('woocommerce\_add\_to\_cart\_sold\_individually\_quantity', 1, $quantity, $product\_id, $variation\_id, $cart\_item\_data); |
| [465](#L465) | $found\_in\_cart = apply\_filters('woocommerce\_add\_to\_cart\_sold\_individually\_found\_in\_cart', $cart\_item\_key && WC()->cart->cart\_contents[$cart\_item\_key]['quantity'] > 0, $product\_id, $variation\_id, $cart\_item\_data, $cart\_id); |
| [466](#L466) |  |
| [467](#L467) | if ($found\_in\_cart) { |
| [468](#L468) | /\* translators: %s: product name \*/ |
| [469](#L469) | throw new Exception(sprintf('<a href="%s" class="button wc-forward">%s</a> %s', wc\_get\_cart\_url(), \_\_('View cart', 'woocommerce'), sprintf(\_\_('You cannot add another "%s" to your cart.', 'woocommerce'), $product\_data->get\_name()))); |
| [470](#L470) | } |
| [471](#L471) | } |
| [472](#L472) |  |
| [473](#L473) | // if (!$product\_data->is\_purchasable()) { |
| [474](#L474) | //     $message = \_\_('Sorry, this product cannot be purchased.', 'woocommerce'); |
| [475](#L475) | //     /\*\* |
| [476](#L476) | //      \* Filters message about product unable to be purchased. |
| [477](#L477) | //      \* |
| [478](#L478) | //      \* @param string $message Message. |
| [479](#L479) | //      \* @param WC\_Product $product\_data Product data. |
| [480](#L480) | //      \* @since 3.8.0 |
| [481](#L481) | //      \*/ |
| [482](#L482) | //     $message = apply\_filters('woocommerce\_cart\_product\_cannot\_be\_purchased\_message', $message, $product\_data); |
| [483](#L483) | //     throw new Exception($message); |
| [484](#L484) | // } |
| [485](#L485) |  |
| [486](#L486) | // Stock check - only check if we're managing stock and backorders are not allowed. |
| [487](#L487) | if (!$product\_data->is\_in\_stock()) { |
| [488](#L488) | /\* translators: %s: product name \*/ |
| [489](#L489) | throw new Exception(sprintf(\_\_('You cannot add &quot;%s&quot; to the cart because the product is out of stock.', 'woocommerce'), $product\_data->get\_name())); |
| [490](#L490) | } |
| [491](#L491) |  |
| [492](#L492) | if (!$product\_data->has\_enough\_stock($quantity)) { |
| [493](#L493) | /\* translators: 1: product name 2: quantity in stock \*/ |
| [494](#L494) | throw new Exception(sprintf(\_\_('You cannot add that amount of &quot;%1$s&quot; to the cart because there is not enough stock (%2$s remaining).', 'woocommerce'), $product\_data->get\_name(), wc\_format\_stock\_quantity\_for\_display($product\_data->get\_stock\_quantity(), $product\_data))); |
| [495](#L495) | } |
| [496](#L496) |  |
| [497](#L497) | // Stock check - this time accounting for whats already in-cart. |
| [498](#L498) | if ($product\_data->managing\_stock()) { |
| [499](#L499) | $products\_qty\_in\_cart = WC()->cart->get\_cart\_item\_quantities(); |
| [500](#L500) |  |
| [501](#L501) | if (isset($products\_qty\_in\_cart[$product\_data->get\_stock\_managed\_by\_id()]) && !$product\_data->has\_enough\_stock($products\_qty\_in\_cart[$product\_data->get\_stock\_managed\_by\_id()] + $quantity)) { |
| [502](#L502) | throw new Exception( |
| [503](#L503) | sprintf( |
| [504](#L504) | '<a href="%s" class="button wc-forward">%s</a> %s', |
| [505](#L505) | wc\_get\_cart\_url(), |
| [506](#L506) | \_\_('View cart', 'woocommerce'), |
| [507](#L507) | /\* translators: 1: quantity in stock 2: current quantity \*/ |
| [508](#L508) | sprintf(\_\_('You cannot add that amount to the cart &mdash; we have %1$s in stock and you already have %2$s in your cart.', 'woocommerce'), wc\_format\_stock\_quantity\_for\_display($product\_data->get\_stock\_quantity(), $product\_data), wc\_format\_stock\_quantity\_for\_display($products\_qty\_in\_cart[$product\_data->get\_stock\_managed\_by\_id()], $product\_data)) |
| [509](#L509) | ) |
| [510](#L510) | ); |
| [511](#L511) | } |
| [512](#L512) | } |
| [513](#L513) |  |
| [514](#L514) | // If cart\_item\_key is set, the item is already in the cart. |
| [515](#L515) | if ($cart\_item\_key) { |
| [516](#L516) | $new\_quantity = $quantity + WC()->cart->cart\_contents[$cart\_item\_key]['quantity']; |
| [517](#L517) | WC()->cart->set\_quantity($cart\_item\_key, $new\_quantity, false); |
| [518](#L518) | } else { |
| [519](#L519) | $cart\_item\_key = $cart\_id; |
| [520](#L520) |  |
| [521](#L521) | // Add item after merging with $cart\_item\_data - hook to allow plugins to modify cart item. |
| [522](#L522) | WC()->cart->cart\_contents[$cart\_item\_key] = apply\_filters( |
| [523](#L523) | 'woocommerce\_add\_cart\_item', |
| [524](#L524) | array\_merge( |
| [525](#L525) | $cart\_item\_data, |
| [526](#L526) | array( |
| [527](#L527) | 'key' => $cart\_item\_key, |
| [528](#L528) | 'product\_id' => $product\_id, |
| [529](#L529) | 'variation\_id' => $variation\_id, |
| [530](#L530) | 'variation' => $variation, |
| [531](#L531) | 'quantity' => $quantity, |
| [532](#L532) | 'data' => $product\_data, |
| [533](#L533) | 'data\_hash' => wc\_get\_cart\_item\_data\_hash($product\_data), |
| [534](#L534) | ) |
| [535](#L535) | ), |
| [536](#L536) | $cart\_item\_key |
| [537](#L537) | ); |
| [538](#L538) | } |
| [539](#L539) |  |
| [540](#L540) | WC()->cart->cart\_contents = apply\_filters('woocommerce\_cart\_contents\_changed', WC()->cart->cart\_contents); |
| [541](#L541) |  |
| [542](#L542) | do\_action('woocommerce\_add\_to\_cart', $cart\_item\_key, $product\_id, $quantity, $variation\_id, $variation, $cart\_item\_data); |
| [543](#L543) |  |
| [544](#L544) | return true; |
| [545](#L545) |  |
| [546](#L546) | } catch (Exception $e) { |
| [547](#L547) | if ($e->getMessage()) { |
| [548](#L548) | return html\_entity\_decode(strip\_tags($e->getMessage())); |
| [549](#L549) | } |
| [550](#L550) | return false; |
| [551](#L551) | } |
| [552](#L552) | } |
| [553](#L553) |  |
| [554](#L554) | private function add\_items\_to\_cart($products, $isValidate = true) |
| [555](#L555) | { |
| [556](#L556) | try { |
| [557](#L557) | foreach ($products as $product) { |
| [558](#L558) | $productId = absint($product['product\_id']); |
| [559](#L559) |  |
| [560](#L560) | $quantity = $product['quantity']; |
| [561](#L561) | $variationId = isset($product['variation\_id']) ? $product['variation\_id'] : ""; |
| [562](#L562) |  |
| [563](#L563) | $attributes = []; |
| [564](#L564) | if (isset($product["meta\_data"])) { |
| [565](#L565) | foreach ($product["meta\_data"] as $item) { |
| [566](#L566) | $attributes[strtolower($item["key"])] = $item["value"]; |
| [567](#L567) | } |
| [568](#L568) | } |
| [569](#L569) |  |
| [570](#L570) | // Check the product variation |
| [571](#L571) | if (!empty($variationId)) { |
| [572](#L572) | $productVariable = new WC\_Product\_Variable($productId); |
| [573](#L573) | $listVariations = $productVariable->get\_available\_variations(); |
| [574](#L574) | foreach ($listVariations as $vartiation => $value) { |
| [575](#L575) | if ($variationId == $value['variation\_id']) { |
| [576](#L576) | $attributes = array\_merge($value['attributes'], $attributes); |
| [577](#L577) | $error = $this->add\_to\_cart($productId, $quantity, $variationId, $attributes); |
| [578](#L578) | if ((is\_string($error) || $error == false) && $isValidate) { |
| [579](#L579) | throw new Exception($error); |
| [580](#L580) | } |
| [581](#L581) | } |
| [582](#L582) | } |
| [583](#L583) | } else { |
| [584](#L584) | parseMetaDataForBookingProduct($product); |
| [585](#L585) | $error = $this->add\_to\_cart($productId, $quantity, 0, $attributes); |
| [586](#L586) | if ((is\_string($error) || $error == false) && $isValidate) { |
| [587](#L587) | throw new Exception($error); |
| [588](#L588) | } |
| [589](#L589) | } |
| [590](#L590) | } |
| [591](#L591) | return true; |
| [592](#L592) | } catch (Exception $e) { |
| [593](#L593) | return $e->getMessage(); |
| [594](#L594) | } |
| [595](#L595) |  |
| [596](#L596) | } |
| [597](#L597) |  |
| [598](#L598) | public function shipping\_methods($request) |
| [599](#L599) | { |
| [600](#L600) | $json = file\_get\_contents('php://input'); |
| [601](#L601) | $body = json\_decode($json, TRUE); |
| [602](#L602) |  |
| [603](#L603) | $this->check\_prerequisites(); |
| [604](#L604) |  |
| [605](#L605) | $shipping = $body["shipping"]; |
| [606](#L606) | WC()->customer->set\_shipping\_first\_name($shipping["first\_name"]); |
| [607](#L607) | WC()->customer->set\_shipping\_last\_name($shipping["last\_name"]); |
| [608](#L608) | WC()->customer->set\_shipping\_company($shipping["company"]); |
| [609](#L609) | WC()->customer->set\_shipping\_address\_1($shipping["address\_1"]); |
| [610](#L610) | WC()->customer->set\_shipping\_address\_2($shipping["address\_2"]); |
| [611](#L611) | WC()->customer->set\_shipping\_city($shipping["city"]); |
| [612](#L612) | WC()->customer->set\_shipping\_state($shipping["state"]); |
| [613](#L613) | WC()->customer->set\_shipping\_postcode($shipping["postcode"]); |
| [614](#L614) | WC()->customer->set\_shipping\_country($shipping["country"]); |
| [615](#L615) |  |
| [616](#L616) | $error = $this->add\_items\_to\_cart($body['line\_items'], false); |
| [617](#L617) | if (is\_string($error)) { |
| [618](#L618) | return parent::sendError("invalid\_item", $error, 400); |
| [619](#L619) | } |
| [620](#L620) |  |
| [621](#L621) | if(isset($body['coupon\_lines']) && is\_array($body['coupon\_lines']) && count($body['coupon\_lines']) > 0){ |
| [622](#L622) | WC()->cart->apply\_coupon($body['coupon\_lines'][0]['code']); |
| [623](#L623) | } |
| [624](#L624) |  |
| [625](#L625) | /\* set calculation type if product is subscription to get shipping methods for subscription product have trial days \*/ |
| [626](#L626) | if (is\_plugin\_active('woocommerce-subscriptions/woocommerce-subscriptions.php')) { |
| [627](#L627) | foreach ($body['line\_items'] as $product) { |
| [628](#L628) | $productId = absint($product['product\_id']); |
| [629](#L629) | $variationId = isset($product['variation\_id']) ? absint($product['variation\_id']) : 0; |
| [630](#L630) | $product\_data = wc\_get\_product($variationId != 0 ? $variationId : $productId); |
| [631](#L631) | if (class\_exists('WC\_Subscriptions\_Product') && WC\_Subscriptions\_Product::is\_subscription($product\_data)) { |
| [632](#L632) | WC\_Subscriptions\_Cart::set\_calculation\_type('recurring\_total'); |
| [633](#L633) | break; |
| [634](#L634) | } |
| [635](#L635) | } |
| [636](#L636) | } |
| [637](#L637) |  |
| [638](#L638) | if( apply\_filters( 'wcfmmp\_is\_allow\_checkout\_user\_location', true ) ) { |
| [639](#L639) | if ( !empty($shipping["wcfmmp\_user\_location"]) ) { |
| [640](#L640) | WC()->customer->set\_props( array( 'wcfmmp\_user\_location' => sanitize\_text\_field( $shipping["wcfmmp\_user\_location"] ) ) ); |
| [641](#L641) | WC()->session->set( '\_wcfmmp\_user\_location', sanitize\_text\_field( $shipping["wcfmmp\_user\_location"] ) ); |
| [642](#L642) | } |
| [643](#L643) | if ( !empty($shipping["wcfmmp\_user\_location\_lat"]) ) { |
| [644](#L644) | WC()->session->set( '\_wcfmmp\_user\_location\_lat', sanitize\_text\_field( $shipping['wcfmmp\_user\_location\_lat'] ) ); |
| [645](#L645) | } |
| [646](#L646) | if ( !empty( $shipping['wcfmmp\_user\_location\_lng'] ) ) { |
| [647](#L647) | WC()->session->set( '\_wcfmmp\_user\_location\_lng', sanitize\_text\_field( $shipping['wcfmmp\_user\_location\_lng'] ) ); |
| [648](#L648) | } |
| [649](#L649) | } |
| [650](#L650) |  |
| [651](#L651) | $shipping\_methods = WC()->shipping->calculate\_shipping(WC()->cart->get\_shipping\_packages()); |
| [652](#L652) | $required\_shipping = WC()->cart->needs\_shipping() && WC()->cart->show\_shipping(); |
| [653](#L653) |  |
| [654](#L654) | if(count( $shipping\_methods) == 0){ |
| [655](#L655) | return new WP\_Error(400, 'No Shipping', array('required\_shipping' => $required\_shipping)); |
| [656](#L656) | } |
| [657](#L657) |  |
| [658](#L658) | $results = []; |
| [659](#L659) | foreach ($shipping\_methods as $shipping\_method) { |
| [660](#L660) | $rates = $shipping\_method['rates']; |
| [661](#L661) | foreach ($rates as $rate) { |
| [662](#L662) | $results[] = [ |
| [663](#L663) | "id" => $rate->get\_id(), |
| [664](#L664) | "method\_id" => $rate->get\_method\_id(), |
| [665](#L665) | "instance\_id" => $rate->get\_instance\_id(), |
| [666](#L666) | "label" => $rate->get\_label(), |
| [667](#L667) | "cost" => $rate->get\_cost(), |
| [668](#L668) | "taxes" => $rate->get\_taxes(), |
| [669](#L669) | "shipping\_tax" => $rate->get\_shipping\_tax() |
| [670](#L670) | ]; |
| [671](#L671) | } |
| [672](#L672) | } |
| [673](#L673) | return $results; |
| [674](#L674) | } |
| [675](#L675) |  |
| [676](#L676) | public function payment\_methods($request) |
| [677](#L677) | { |
| [678](#L678) | $json = file\_get\_contents('php://input'); |
| [679](#L679) | $body = json\_decode($json, TRUE); |
| [680](#L680) |  |
| [681](#L681) | $cookie = $request->get\_header("User-Cookie"); |
| [682](#L682) | if (isset($cookie) && $cookie != null) { |
| [683](#L683) | $user\_id = validateCookieLogin($cookie); |
| [684](#L684) | if (is\_wp\_error($user\_id)) { |
| [685](#L685) | return $user\_id; |
| [686](#L686) | } |
| [687](#L687) | wp\_set\_current\_user($user\_id); |
| [688](#L688) | } elseif (isset($body['customer\_id']) && $body['customer\_id'] != null) { |
| [689](#L689) | wp\_set\_current\_user($body['customer\_id']); |
| [690](#L690) | } |
| [691](#L691) |  |
| [692](#L692) | $this->check\_prerequisites(); |
| [693](#L693) |  |
| [694](#L694) | $shipping = $body["shipping"]; |
| [695](#L695) | if (isset($shipping)) { |
| [696](#L696) | WC()->customer->set\_shipping\_first\_name($shipping["first\_name"]); |
| [697](#L697) | WC()->customer->set\_shipping\_last\_name($shipping["last\_name"]); |
| [698](#L698) | WC()->customer->set\_shipping\_company($shipping["company"]); |
| [699](#L699) | WC()->customer->set\_shipping\_address\_1($shipping["address\_1"]); |
| [700](#L700) | WC()->customer->set\_shipping\_address\_2($shipping["address\_2"]); |
| [701](#L701) | WC()->customer->set\_shipping\_city($shipping["city"]); |
| [702](#L702) | WC()->customer->set\_shipping\_state($shipping["state"]); |
| [703](#L703) | WC()->customer->set\_shipping\_postcode($shipping["postcode"]); |
| [704](#L704) | WC()->customer->set\_shipping\_country($shipping["country"]); |
| [705](#L705) | } |
| [706](#L706) | //Fix to show COD based on the country for WooCommerce Multilingual & Multicurrency |
| [707](#L707) | if(is\_plugin\_active('woocommerce-multilingual/wpml-woocommerce.php') && !is\_plugin\_active('elementor-pro/elementor-pro.php')){ |
| [708](#L708) | $\_GET['wc-ajax'] = 'update\_order\_review'; |
| [709](#L709) | $\_POST['country'] = $shipping["country"]; |
| [710](#L710) | } |
| [711](#L711) |  |
| [712](#L712) | $error = $this->add\_items\_to\_cart($body['line\_items']); |
| [713](#L713) | if (is\_string($error)) { |
| [714](#L714) | return parent::sendError("invalid\_item", $error, 400); |
| [715](#L715) | } |
| [716](#L716) | if(isset($body['coupon\_lines']) && is\_array($body['coupon\_lines']) && count($body['coupon\_lines']) > 0){ |
| [717](#L717) | WC()->cart->apply\_coupon($body['coupon\_lines'][0]['code']); |
| [718](#L718) | } |
| [719](#L719) | if (isset($body["shipping\_lines"]) && !empty($body["shipping\_lines"])) { |
| [720](#L720) | $shippings = []; |
| [721](#L721) | foreach ($body["shipping\_lines"] as $shipping\_line) { |
| [722](#L722) | $shippings[] = $shipping\_line["method\_id"]; |
| [723](#L723) | } |
| [724](#L724) | WC()->session->set('chosen\_shipping\_methods', $shippings); |
| [725](#L725) | } |
| [726](#L726) | $payment\_methods = WC()->payment\_gateways->get\_available\_payment\_gateways(); |
| [727](#L727) | $results = []; |
| [728](#L728) | foreach ($payment\_methods as $key => $value) { |
| [729](#L729) | $results[] = ["id" => $value->id, "title" => $value->title, "method\_title" => $value->method\_title, "description" => $value->description]; |
| [730](#L730) | } |
| [731](#L731) | return $results; |
| [732](#L732) | } |
| [733](#L733) |  |
| [734](#L734) | public function coupon($request) |
| [735](#L735) | { |
| [736](#L736) | $json = file\_get\_contents('php://input'); |
| [737](#L737) | $body = json\_decode($json, TRUE); |
| [738](#L738) |  |
| [739](#L739) | $this->check\_prerequisites(); |
| [740](#L740) | $error = $this->add\_items\_to\_cart($body['line\_items']); |
| [741](#L741) | if (is\_string($error)) { |
| [742](#L742) | return parent::sendError("invalid\_item", $error, 400); |
| [743](#L743) | } |
| [744](#L744) |  |
| [745](#L745) | if (isset($body["customer\_id"]) && $body["customer\_id"] != null) { |
| [746](#L746) | $userId = $body["customer\_id"]; |
| [747](#L747) | $user = get\_userdata($userId); |
| [748](#L748) | if ($user) { |
| [749](#L749) | wp\_set\_current\_user($userId, $user->user\_login); |
| [750](#L750) | wp\_set\_auth\_cookie($userId); |
| [751](#L751) | WC()->customer = new WC\_Customer($userId, true); |
| [752](#L752) | } |
| [753](#L753) | } |
| [754](#L754) |  |
| [755](#L755) | $coupon\_code = $body["coupon\_code"]; |
| [756](#L756) |  |
| [757](#L757) | // Coupons are globally disabled. |
| [758](#L758) | if (!wc\_coupons\_enabled()) { |
| [759](#L759) | return parent::sendError("invalid\_coupon", "Coupon is disabled", 400); |
| [760](#L760) | } |
| [761](#L761) |  |
| [762](#L762) | // Sanitize coupon code. |
| [763](#L763) | $coupon\_code = wc\_format\_coupon\_code($coupon\_code); |
| [764](#L764) |  |
| [765](#L765) | // Get the coupon. |
| [766](#L766) | $the\_coupon = new WC\_Coupon($coupon\_code); |
| [767](#L767) |  |
| [768](#L768) | // Prevent adding coupons by post ID. |
| [769](#L769) | if ($the\_coupon->get\_code() !== $coupon\_code) { |
| [770](#L770) | $the\_coupon->set\_code($coupon\_code); |
| [771](#L771) | return parent::sendError("invalid\_coupon", $the\_coupon->get\_coupon\_error(WC\_Coupon::E\_WC\_COUPON\_NOT\_EXIST), 400); |
| [772](#L772) | } |
| [773](#L773) |  |
| [774](#L774) | // Check it can be used with cart. |
| [775](#L775) | if (!$the\_coupon->is\_valid()) { |
| [776](#L776) | return parent::sendError("invalid\_coupon", html\_entity\_decode(strip\_tags($the\_coupon->get\_error\_message())), 400); |
| [777](#L777) | } |
| [778](#L778) |  |
| [779](#L779) | // Check if applied. |
| [780](#L780) | if (WC()->cart->has\_discount($coupon\_code)) { |
| [781](#L781) | WC()->cart->remove\_coupons(); |
| [782](#L782) | } |
| [783](#L783) |  |
| [784](#L784) | // If its individual use then remove other coupons. |
| [785](#L785) | if ($the\_coupon->get\_individual\_use()) { |
| [786](#L786) |  |
| [787](#L787) | foreach (WC()->cart->applied\_coupons as $applied\_coupon) { |
| [788](#L788) | $keep\_key = array\_search($applied\_coupon, $coupons\_to\_keep, true); |
| [789](#L789) | if (false === $keep\_key) { |
| [790](#L790) | WC()->cart->remove\_coupon($applied\_coupon); |
| [791](#L791) | } else { |
| [792](#L792) | unset($coupons\_to\_keep[$keep\_key]); |
| [793](#L793) | } |
| [794](#L794) | } |
| [795](#L795) |  |
| [796](#L796) | if (!empty($coupons\_to\_keep)) { |
| [797](#L797) | WC()->cart->applied\_coupons += $coupons\_to\_keep; |
| [798](#L798) | } |
| [799](#L799) | } |
| [800](#L800) |  |
| [801](#L801) | WC()->cart->set\_applied\_coupons([$coupon\_code]); |
| [802](#L802) | WC()->cart->calculate\_totals(); |
| [803](#L803) |  |
| [804](#L804) | $price = WC()->cart->get\_coupon\_discount\_amount($the\_coupon->get\_code(), WC()->cart->display\_cart\_ex\_tax); |
| [805](#L805) | return ["coupon" => $this->get\_formatted\_coupon\_data($the\_coupon), "discount" => $price]; |
| [806](#L806) | } |
| [807](#L807) |  |
| [808](#L808) | protected function get\_formatted\_coupon\_data($object) |
| [809](#L809) | { |
| [810](#L810) | $data = $object->get\_data(); |
| [811](#L811) |  |
| [812](#L812) | $format\_decimal = array('amount', 'minimum\_amount', 'maximum\_amount'); |
| [813](#L813) | $format\_date = array('date\_created', 'date\_modified', 'date\_expires'); |
| [814](#L814) | $format\_null = array('usage\_limit', 'usage\_limit\_per\_user', 'limit\_usage\_to\_x\_items'); |
| [815](#L815) |  |
| [816](#L816) | // Format decimal values. |
| [817](#L817) | foreach ($format\_decimal as $key) { |
| [818](#L818) | $data[$key] = wc\_format\_decimal($data[$key], 2); |
| [819](#L819) | } |
| [820](#L820) |  |
| [821](#L821) | // Format date values. |
| [822](#L822) | foreach ($format\_date as $key) { |
| [823](#L823) | $datetime = $data[$key]; |
| [824](#L824) | $data[$key] = wc\_rest\_prepare\_date\_response($datetime, false); |
| [825](#L825) | $data[$key . '\_gmt'] = wc\_rest\_prepare\_date\_response($datetime); |
| [826](#L826) | } |
| [827](#L827) |  |
| [828](#L828) | // Format null values. |
| [829](#L829) | foreach ($format\_null as $key) { |
| [830](#L830) | $data[$key] = $data[$key] ? $data[$key] : null; |
| [831](#L831) | } |
| [832](#L832) |  |
| [833](#L833) | return array( |
| [834](#L834) | 'id' => $object->get\_id(), |
| [835](#L835) | 'code' => $data['code'], |
| [836](#L836) | 'amount' => $data['amount'], |
| [837](#L837) | 'date\_created' => $data['date\_created'], |
| [838](#L838) | 'date\_created\_gmt' => $data['date\_created\_gmt'], |
| [839](#L839) | 'date\_modified' => $data['date\_modified'], |
| [840](#L840) | 'date\_modified\_gmt' => $data['date\_modified\_gmt'], |
| [841](#L841) | 'discount\_type' => $data['discount\_type'], |
| [842](#L842) | 'description' => $data['description'], |
| [843](#L843) | 'date\_expires' => $data['date\_expires'], |
| [844](#L844) | 'date\_expires\_gmt' => $data['date\_expires\_gmt'], |
| [845](#L845) | 'usage\_count' => $data['usage\_count'], |
| [846](#L846) | 'individual\_use' => $data['individual\_use'], |
| [847](#L847) | 'product\_ids' => $data['product\_ids'], |
| [848](#L848) | 'excluded\_product\_ids' => $data['excluded\_product\_ids'], |
| [849](#L849) | 'usage\_limit' => $data['usage\_limit'], |
| [850](#L850) | 'usage\_limit\_per\_user' => $data['usage\_limit\_per\_user'], |
| [851](#L851) | 'limit\_usage\_to\_x\_items' => $data['limit\_usage\_to\_x\_items'], |
| [852](#L852) | 'free\_shipping' => $data['free\_shipping'], |
| [853](#L853) | 'product\_categories' => $data['product\_categories'], |
| [854](#L854) | 'excluded\_product\_categories' => $data['excluded\_product\_categories'], |
| [855](#L855) | 'exclude\_sale\_items' => $data['exclude\_sale\_items'], |
| [856](#L856) | 'minimum\_amount' => $data['minimum\_amount'], |
| [857](#L857) | 'maximum\_amount' => $data['maximum\_amount'], |
| [858](#L858) | 'email\_restrictions' => $data['email\_restrictions'], |
| [859](#L859) | 'used\_by' => $data['used\_by'], |
| [860](#L860) | 'meta\_data' => $data['meta\_data'], |
| [861](#L861) | ); |
| [862](#L862) | } |
| [863](#L863) |  |
| [864](#L864) | public function get\_cart($request) |
| [865](#L865) | { |
| [866](#L866) | $cookie = $request["cookie"]; |
| [867](#L867) | if (isset($request["token"])) { |
| [868](#L868) | $cookie = urldecode(base64\_decode($request["token"])); |
| [869](#L869) | } |
| [870](#L870) | $user\_id = validateCookieLogin($cookie); |
| [871](#L871) | if (is\_wp\_error($user\_id)) { |
| [872](#L872) | return $user\_id; |
| [873](#L873) | } |
| [874](#L874) |  |
| [875](#L875) | // Get an instance of the WC\_Session\_Handler Object |
| [876](#L876) | $session\_handler = new WC\_Session\_Handler(); |
| [877](#L877) |  |
| [878](#L878) | // Get the user session from its user ID: |
| [879](#L879) | $session = $session\_handler->get\_session($user\_id); |
| [880](#L880) |  |
| [881](#L881) | // Get cart items array |
| [882](#L882) | $cart\_items = maybe\_unserialize($session['cart']); |
| [883](#L883) |  |
| [884](#L884) | $items = []; |
| [885](#L885) |  |
| [886](#L886) | // Loop through cart items and get cart items details |
| [887](#L887) | $product\_controller = new WC\_REST\_Products\_Controller(); |
| [888](#L888) | $product\_variation\_controller = new WC\_REST\_Product\_Variations\_Controller(); |
| [889](#L889) | if(is\_array($cart\_items)){ |
| [890](#L890) | foreach ($cart\_items as $cart\_item\_key => $cart\_item) { |
| [891](#L891) | $product\_id = $cart\_item['product\_id']; |
| [892](#L892) | $variation\_id = $cart\_item['variation\_id']; |
| [893](#L893) | $quantity = $cart\_item['quantity']; |
| [894](#L894) |  |
| [895](#L895) | $product = wc\_get\_product($product\_id); |
| [896](#L896) | $product\_data = $product\_controller->prepare\_object\_for\_response($product, $request)->get\_data(); |
| [897](#L897) |  |
| [898](#L898) | if ($variation\_id != 0) { |
| [899](#L899) | $variation = new WC\_Product\_Variation($variation\_id); |
| [900](#L900) | $variation\_data = $product\_variation\_controller->prepare\_object\_for\_response($variation, $request)->get\_data(); |
| [901](#L901) | } else { |
| [902](#L902) | $variation\_data = null; |
| [903](#L903) | } |
| [904](#L904) | $items[] = ["product" => $product\_data, "quantity" => $quantity, "variation" => $variation\_data]; |
| [905](#L905) | } |
| [906](#L906) | } |
| [907](#L907) |  |
| [908](#L908) | return $items; |
| [909](#L909) | } |
| [910](#L910) |  |
| [911](#L911) | public function sync\_cart\_from\_mobile($request) |
| [912](#L912) | { |
| [913](#L913) | $json = file\_get\_contents('php://input'); |
| [914](#L914) | $body = json\_decode($json, TRUE); |
| [915](#L915) |  |
| [916](#L916) | if (defined('WC\_ABSPATH')) { |
| [917](#L917) | // WC 3.6+ - Cart and other frontend functions are not included for REST requests. |
| [918](#L918) | include\_once WC\_ABSPATH . 'includes/wc-cart-functions.php'; |
| [919](#L919) | } |
| [920](#L920) |  |
| [921](#L921) | $user\_id = $body["customer\_id"]; |
| [922](#L922) |  |
| [923](#L923) | $session\_expiring = time() + intval(apply\_filters('wc\_session\_expiring', 60 \* 60 \* 47)); // 47 Hours. |
| [924](#L924) | $session\_expiration = time() + intval(apply\_filters('wc\_session\_expiration', 60 \* 60 \* 48)); // 48 Hours. |
| [925](#L925) | $to\_hash = $user\_id . '|' . $session\_expiration; |
| [926](#L926) | $cookie\_hash = hash\_hmac('md5', $to\_hash, wp\_hash($to\_hash)); |
| [927](#L927) | $\_COOKIE['wp\_woocommerce\_session\_' . COOKIEHASH] = $user\_id . "||" . $session\_expiration . "||" . $session\_expiring . "||" . $cookie\_hash; |
| [928](#L928) |  |
| [929](#L929) | $user = get\_userdata($user\_id); |
| [930](#L930) | wp\_set\_current\_user($user\_id, $user->user\_login); |
| [931](#L931) | wp\_set\_auth\_cookie($user\_id); |
| [932](#L932) |  |
| [933](#L933) | // Get an instance of the WC\_Session\_Handler Object |
| [934](#L934) | WC()->session = new WC\_Session\_Handler(); |
| [935](#L935) | WC()->session->init(); |
| [936](#L936) |  |
| [937](#L937) | WC()->customer = new WC\_Customer(get\_current\_user\_id(), true); |
| [938](#L938) |  |
| [939](#L939) | WC()->cart = new WC\_Cart(); |
| [940](#L940) | WC()->cart->empty\_cart(); |
| [941](#L941) |  |
| [942](#L942) | $products = $body['line\_items']; |
| [943](#L943) | foreach ($products as $product) { |
| [944](#L944) | $productId = absint($product['product\_id']); |
| [945](#L945) |  |
| [946](#L946) | $quantity = $product['quantity']; |
| [947](#L947) | $variationId = isset($product['variation\_id']) ? $product['variation\_id'] : ""; |
| [948](#L948) |  |
| [949](#L949) | $attributes = []; |
| [950](#L950) | foreach ($product["meta\_data"] as $item) { |
| [951](#L951) | $attributes[$item["key"]] = $item["value"]; |
| [952](#L952) | } |
| [953](#L953) | // Check the product variation |
| [954](#L954) | if (!empty($variationId)) { |
| [955](#L955) | $productVariable = new WC\_Product\_Variable($productId); |
| [956](#L956) | $listVariations = $productVariable->get\_available\_variations(); |
| [957](#L957) | foreach ($listVariations as $vartiation => $value) { |
| [958](#L958) | if ($variationId == $value['variation\_id']) { |
| [959](#L959) | $attributes = array\_merge($value['attributes'], $attributes); |
| [960](#L960) | WC()->cart->add\_to\_cart($productId, $quantity, $variationId, $attributes); |
| [961](#L961) | } |
| [962](#L962) | } |
| [963](#L963) | } else { |
| [964](#L964) | WC()->cart->add\_to\_cart($productId, $quantity, 0, $attributes); |
| [965](#L965) | } |
| [966](#L966) | } |
| [967](#L967) |  |
| [968](#L968) | return WC()->cart->get\_totals(); |
| [969](#L969) | } |
| [970](#L970) |  |
| [971](#L971) | public function upload\_config\_file($request){ |
| [972](#L972) | if (!isset($\_FILES['file'])) { |
| [973](#L973) | return parent::sendError("invalid\_key","Key must be 'file'", 400); |
| [974](#L974) | } |
| [975](#L975) | $file = $\_FILES['file']; |
| [976](#L976) | if ($file["size"] == 0) { |
| [977](#L977) | return parent::sendError("invalid\_file","File is required", 400); |
| [978](#L978) | } |
| [979](#L979) |  |
| [980](#L980) | if ($file["type"] !== "application/json") { |
| [981](#L981) | return parent::sendError("invalid\_file","You need to upload json file", 400); |
| [982](#L982) | } |
| [983](#L983) |  |
| [984](#L984) | $errMsg = FlutterUtils::upload\_file\_by\_admin($file); |
| [985](#L985) | if ($errMsg != null) { |
| [986](#L986) | return parent::sendError("invalid\_file","You need to upload config\_xx.json file", 400); |
| [987](#L987) | } |
| [988](#L988) | return FlutterUtils::get\_json\_file\_url($file['name']); |
| [989](#L989) | } |
| [990](#L990) |  |
| [991](#L991) | public function get\_taxes($request) |
| [992](#L992) | { |
| [993](#L993) | $json = file\_get\_contents('php://input'); |
| [994](#L994) | $body = json\_decode($json, TRUE); |
| [995](#L995) |  |
| [996](#L996) | $this->check\_prerequisites(); |
| [997](#L997) |  |
| [998](#L998) | $shipping = $body["shipping"]; |
| [999](#L999) | if (isset($shipping)) { |
| [1000](#L1000) | WC()->customer->set\_shipping\_first\_name($shipping["first\_name"]); |
| [1001](#L1001) | WC()->customer->set\_shipping\_last\_name($shipping["last\_name"]); |
| [1002](#L1002) | WC()->customer->set\_shipping\_company($shipping["company"]); |
| [1003](#L1003) | WC()->customer->set\_shipping\_address\_1($shipping["address\_1"]); |
| [1004](#L1004) | WC()->customer->set\_shipping\_address\_2($shipping["address\_2"]); |
| [1005](#L1005) | WC()->customer->set\_shipping\_city($shipping["city"]); |
| [1006](#L1006) | WC()->customer->set\_shipping\_state($shipping["state"]); |
| [1007](#L1007) | WC()->customer->set\_shipping\_postcode($shipping["postcode"]); |
| [1008](#L1008) | WC()->customer->set\_shipping\_country($shipping["country"]); |
| [1009](#L1009) | } |
| [1010](#L1010) |  |
| [1011](#L1011) | $billing = $body["billing"]; |
| [1012](#L1012) | if (isset($billing)) { |
| [1013](#L1013) | WC()->customer->set\_billing\_first\_name($billing["first\_name"]); |
| [1014](#L1014) | WC()->customer->set\_billing\_last\_name($billing["last\_name"]); |
| [1015](#L1015) | WC()->customer->set\_billing\_company($billing["company"]); |
| [1016](#L1016) | WC()->customer->set\_billing\_address\_1($billing["address\_1"]); |
| [1017](#L1017) | WC()->customer->set\_billing\_address\_2($billing["address\_2"]); |
| [1018](#L1018) | WC()->customer->set\_billing\_city($billing["city"]); |
| [1019](#L1019) | WC()->customer->set\_billing\_state($billing["state"]); |
| [1020](#L1020) | WC()->customer->set\_billing\_postcode($billing["postcode"]); |
| [1021](#L1021) | WC()->customer->set\_billing\_country($billing["country"]); |
| [1022](#L1022) | WC()->customer->set\_billing\_email($billing["email"]); |
| [1023](#L1023) | WC()->customer->set\_billing\_phone($billing["phone"]); |
| [1024](#L1024) | } |
| [1025](#L1025) |  |
| [1026](#L1026) | $error = $this->add\_items\_to\_cart($body['line\_items']); |
| [1027](#L1027) | if (is\_string($error)) { |
| [1028](#L1028) | return parent::sendError("invalid\_item", $error, 400); |
| [1029](#L1029) | } |
| [1030](#L1030) | if(isset($body['coupon\_lines']) && is\_array($body['coupon\_lines']) && count($body['coupon\_lines']) > 0){ |
| [1031](#L1031) | WC()->cart->apply\_coupon($body['coupon\_lines'][0]['code']); |
| [1032](#L1032) | } |
| [1033](#L1033) | if (isset($body["shipping\_lines"]) && !empty($body["shipping\_lines"])) { |
| [1034](#L1034) | $shippings = []; |
| [1035](#L1035) | foreach ($body["shipping\_lines"] as $shipping\_line) { |
| [1036](#L1036) | $shippings[] = $shipping\_line["method\_id"]; |
| [1037](#L1037) | } |
| [1038](#L1038) | WC()->session->set('chosen\_shipping\_methods', $shippings); |
| [1039](#L1039) | } |
| [1040](#L1040) |  |
| [1041](#L1041) | $results = []; |
| [1042](#L1042) | if (wc\_tax\_enabled()) { |
| [1043](#L1043) | $taxable\_address = WC()->customer->get\_taxable\_address(); |
| [1044](#L1044) | $estimated\_text = ''; |
| [1045](#L1045) |  |
| [1046](#L1046) | if (WC()->customer->is\_customer\_outside\_base() && !WC()->customer->has\_calculated\_shipping()) { |
| [1047](#L1047) | /\* translators: %s location. \*/ |
| [1048](#L1048) | $estimated\_text = sprintf(esc\_html\_\_('(estimated for %s)', 'woocommerce'), WC()->countries->estimated\_for\_prefix($taxable\_address[0]) . WC()->countries->countries[$taxable\_address[0]]); |
| [1049](#L1049) | } |
| [1050](#L1050) |  |
| [1051](#L1051) | if ('itemized' === get\_option('woocommerce\_tax\_total\_display')) { |
| [1052](#L1052) | foreach (WC()->cart->get\_tax\_totals() as $code => $tax) { // phpcs:ignore WordPress.WP.GlobalVariablesOverride.Prohibited |
| [1053](#L1053) | $results[] = ["label" => $tax->label . " " . $estimated\_text, "value" => $tax->amount]; |
| [1054](#L1054) | } |
| [1055](#L1055) | } else { |
| [1056](#L1056) | $results[] = ["label" => WC()->countries->tax\_or\_vat() . $estimated\_text, "value" => WC()->cart->get\_taxes\_total()]; |
| [1057](#L1057) | } |
| [1058](#L1058) |  |
| [1059](#L1059) | return ["items" => $results, "taxes\_total" => count($results) > 0 ? WC()->cart->get\_taxes\_total() : "0", "is\_including\_tax" => WC()->cart->display\_prices\_including\_tax()]; |
| [1060](#L1060) | }else{ |
| [1061](#L1061) | return ["items" => [], "taxes\_total" => "0", "is\_including\_tax" => false]; |
| [1062](#L1062) | } |
| [1063](#L1063) | } |
| [1064](#L1064) |  |
| [1065](#L1065) | public function get\_points($request) |
| [1066](#L1066) | { |
| [1067](#L1067) | if (!is\_plugin\_active('woocommerce-points-and-rewards/woocommerce-points-and-rewards.php')) { |
| [1068](#L1068) | return parent::sendError("invalid\_plugin", "You need to install WooCommerce Points and Rewards plugin to use this api", 404); |
| [1069](#L1069) | } |
| [1070](#L1070) |  |
| [1071](#L1071) | $cookie = $request["cookie"]; |
| [1072](#L1072) | if (isset($request["token"])) { |
| [1073](#L1073) | $cookie = urldecode(base64\_decode($request["token"])); |
| [1074](#L1074) | } |
| [1075](#L1075) | $user\_id = validateCookieLogin($cookie); |
| [1076](#L1076) | if (is\_wp\_error($user\_id)) { |
| [1077](#L1077) | return $user\_id; |
| [1078](#L1078) | } |
| [1079](#L1079) | if ('yes' === get\_option('wc\_points\_rewards\_partial\_redemption\_enabled')) { |
| [1080](#L1080) | $myPoints = WC\_Points\_Rewards\_Manager::get\_users\_points($user\_id); |
| [1081](#L1081) | list($points, $monetary\_value) = explode(':', get\_option('wc\_points\_rewards\_redeem\_points\_ratio', '')); |
| [1082](#L1082) | $max\_product\_point\_discount = get\_option('wc\_points\_rewards\_max\_discount'); |
| [1083](#L1083) | $max\_point\_discount = get\_option('wc\_points\_rewards\_cart\_max\_discount'); |
| [1084](#L1084) |  |
| [1085](#L1085) | return ["points" => $myPoints, "cart\_price\_rate" => floatval($monetary\_value), "cart\_points\_rate" => intval($points), "max\_point\_discount" => $max\_point\_discount, "max\_product\_point\_discount" => $max\_product\_point\_discount]; |
| [1086](#L1086) | } else { |
| [1087](#L1087) | return parent::sendError("disabled\_redemption", "Disabled partial redemption", 400); |
| [1088](#L1088) | } |
| [1089](#L1089) | } |
| [1090](#L1090) |  |
| [1091](#L1091) | public function update\_points($request) |
| [1092](#L1092) | { |
| [1093](#L1093) | if (!is\_plugin\_active('woocommerce-points-and-rewards/woocommerce-points-and-rewards.php')) { |
| [1094](#L1094) | return parent::sendError("invalid\_plugin", "You need to install Points and Rewards for WooCommerce plugin to use this api", 404); |
| [1095](#L1095) | } |
| [1096](#L1096) |  |
| [1097](#L1097) | $json = file\_get\_contents('php://input'); |
| [1098](#L1098) | $body = json\_decode($json, TRUE); |
| [1099](#L1099) |  |
| [1100](#L1100) | $order\_id = $body["order\_id"]; |
| [1101](#L1101) | $cookie = $body["cookie"]; |
| [1102](#L1102) | $user\_id = validateCookieLogin($cookie); |
| [1103](#L1103) | if (is\_wp\_error($user\_id)) { |
| [1104](#L1104) | return $user\_id; |
| [1105](#L1105) | } |
| [1106](#L1106) |  |
| [1107](#L1107) | $user = get\_user\_by('ID', $user\_id); |
| [1108](#L1108) | $user\_email = $user->user\_email; |
| [1109](#L1109) |  |
| [1110](#L1110) | $get\_points = WC\_Points\_Rewards\_Manager::get\_users\_points($user\_id); |
| [1111](#L1111) | list($points, $monetary\_value) = explode(':', get\_option('wc\_points\_rewards\_redeem\_points\_ratio', '')); |
| [1112](#L1112) | $order = wc\_get\_order($order\_id); |
| [1113](#L1113) | if (isset($order) && !empty($order)) { |
| [1114](#L1114) | /\*Order Fees\*/ |
| [1115](#L1115) | $order\_fees = $order->get\_fees(); |
| [1116](#L1116) | if (!empty($order\_fees)) { |
| [1117](#L1117) | foreach ($order\_fees as $fee\_item\_id => $fee\_item) { |
| [1118](#L1118) | $fee\_id = $fee\_item\_id; |
| [1119](#L1119) | $fee\_name = $fee\_item->get\_name(); |
| [1120](#L1120) | $fee\_amount = $fee\_item->get\_total(); |
| [1121](#L1121) | if (isset($fee\_name) && !empty($fee\_name) && 'Cart Discount' == $fee\_name) { |
| [1122](#L1122) | $fee\_amount = -($fee\_amount); |
| [1123](#L1123) | $fee\_to\_point = ceil((intval($points) \* $fee\_amount) / floatval($monetary\_value)); |
| [1124](#L1124) | $remaining\_point = $get\_points - $fee\_to\_point; |
| [1125](#L1125) | if ($remaining\_point >= 0) { |
| [1126](#L1126) | /\*update the users points in the\*/ |
| [1127](#L1127) | WC\_Points\_Rewards\_Manager::set\_points\_balance($user\_id, $remaining\_point, 'order-redeem'); |
| [1128](#L1128) | } |
| [1129](#L1129) | } |
| [1130](#L1130) | } |
| [1131](#L1131) | } |
| [1132](#L1132) | } |
| [1133](#L1133) | return true; |
| [1134](#L1134) | } |
| [1135](#L1135) |  |
| [1136](#L1136) | public function create\_product\_review($request) |
| [1137](#L1137) | { |
| [1138](#L1138) | $images = $request['images']; |
| [1139](#L1139) | $controller = new WC\_REST\_Product\_Reviews\_Controller(); |
| [1140](#L1140) | $response = $controller->create\_item($request); |
| [1141](#L1141) | if(is\_wp\_error($response)){ |
| [1142](#L1142) | return array( |
| [1143](#L1143) | 'message'=>$response->get\_error\_message ()); |
| [1144](#L1144) | } |
| [1145](#L1145) | $comment\_id = $response->get\_data()['id']; |
| [1146](#L1146) | if(is\_plugin\_active('wc-multivendor-marketplace/wc-multivendor-marketplace.php')){ |
| [1147](#L1147) | global $WCFMmp; |
| [1148](#L1148) | $WCFMmp->wcfmmp\_reviews->wcfmmp\_add\_store\_review( $comment\_id ); |
| [1149](#L1149) | } |
| [1150](#L1150) | if(is\_plugin\_active('woo-photo-reviews/woo-photo-reviews.php') || is\_plugin\_active('woocommerce-photo-reviews/woocommerce-photo-reviews.php')){ |
| [1151](#L1151) | if(isset($images)){ |
| [1152](#L1152) | $images = $images; |
| [1153](#L1153) | $images = array\_filter(explode(',', $images)); |
| [1154](#L1154) | $count = 0; |
| [1155](#L1155) | $img\_arr = array(); |
| [1156](#L1156) | $user\_id = get\_comment($comment\_id)->user\_id; |
| [1157](#L1157) | foreach($images as $image){ |
| [1158](#L1158) | $img\_id = upload\_image\_from\_mobile($image, $count ,$user\_id); |
| [1159](#L1159) | $img\_arr[] = $img\_id; |
| [1160](#L1160) | $count++; |
| [1161](#L1161) | } |
| [1162](#L1162) | update\_comment\_meta( $comment\_id, 'reviews-images', $img\_arr ); |
| [1163](#L1163) | } |
| [1164](#L1164) | } |
| [1165](#L1165) | return $response; |
| [1166](#L1166) | } |
| [1167](#L1167) |  |
| [1168](#L1168) | public function get\_ddates($request) |
| [1169](#L1169) | { |
| [1170](#L1170) | if (is\_plugin\_active('wc-frontend-manager-delivery/wc-frontend-manager-delivery.php')) { |
| [1171](#L1171) | if (isset($request['id'])) { |
| [1172](#L1172) | $helper = new FlutterWCFMHelper(); |
| [1173](#L1173) | return $helper->generate\_vendor\_delivery\_time\_checkout\_field($request['id']); |
| [1174](#L1174) | }else{ |
| [1175](#L1175) | return parent::sendError("required\_vendor\_id", "id is required", 400); |
| [1176](#L1176) | } |
| [1177](#L1177) | }else if (is\_plugin\_active('order-delivery-date/order\_delivery\_date.php')) { |
| [1178](#L1178) | $number\_of\_dates = get\_option('orddd\_number\_of\_dates'); |
| [1179](#L1179) | $options = ORDDD\_Functions::orddd\_get\_dates\_for\_dropdown($number\_of\_dates); |
| [1180](#L1180) | $arr = array(); |
| [1181](#L1181) | foreach ($options as $k => $v) { |
| [1182](#L1182) | if ($k == 'select') { |
| [1183](#L1183) | continue; |
| [1184](#L1184) | } |
| [1185](#L1185) | $date['timestamp'] = strtotime($k); |
| [1186](#L1186) | $date['date'] = $k; |
| [1187](#L1187) | $arr[] = $date; |
| [1188](#L1188) | } |
| [1189](#L1189) | return $arr; |
| [1190](#L1190) | }else{ |
| [1191](#L1191) | return parent::sendError("invalid\_plugin", "You need to install Order Delivery Date for WooCommerce or WOOCOMMERCE FRONTEND MANAGER - DELIVERY plugin to use this api", 404); |
| [1192](#L1192) | } |
| [1193](#L1193) | } |
| [1194](#L1194) |  |
| [1195](#L1195) | function check\_product($request){ |
| [1196](#L1196) | $params = $request->get\_url\_params(); |
| [1197](#L1197) | $token = sanitize\_text\_field($request['token']); |
| [1198](#L1198) | $postid = sanitize\_text\_field($params['id']); |
| [1199](#L1199) |  |
| [1200](#L1200) | if (!empty($token)) { |
| [1201](#L1201) | $cookie = urldecode(base64\_decode($token)); |
| [1202](#L1202) | } |
| [1203](#L1203) | if(!empty($cookie)){ |
| [1204](#L1204) | $userid = validateCookieLogin($cookie); |
| [1205](#L1205) | if (is\_wp\_error($userid)) { |
| [1206](#L1206) | return $userid; |
| [1207](#L1207) | } |
| [1208](#L1208) | wp\_set\_current\_user($userid); |
| [1209](#L1209) | }else{ |
| [1210](#L1210) | wp\_set\_current\_user(0); |
| [1211](#L1211) | } |
| [1212](#L1212) |  |
| [1213](#L1213) | if (!is\_plugin\_active('indeed-membership-pro/indeed-membership-pro.php')) { |
| [1214](#L1214) | return parent::sendError("invalid\_plugin", "You need to install Ultimate Membership Pro plugin to use this api", 404); |
| [1215](#L1215) | } |
| [1216](#L1216) |  |
| [1217](#L1217) | $meta\_arr = ihc\_post\_metas($postid); |
| [1218](#L1218) | $errMsg = null; |
| [1219](#L1219) | if(isset($meta\_arr['ihc\_mb\_type']) && $meta\_arr['ihc\_mb\_type'] == 'block'){ |
| [1220](#L1220) | $errMsg = 'This item is blocked'; |
| [1221](#L1221) | }else { |
| [1222](#L1222) | if(isset($meta\_arr['ihc\_mb\_who'])){ |
| [1223](#L1223) | //getting current user type and target user types |
| [1224](#L1224) | $current\_user = ihc\_get\_user\_type(); |
| [1225](#L1225) | if($meta\_arr['ihc\_mb\_who']!=-1 && $meta\_arr['ihc\_mb\_who']!=''){ |
| [1226](#L1226) | $target\_users = explode(',', $meta\_arr['ihc\_mb\_who']); |
| [1227](#L1227) | } else { |
| [1228](#L1228) | $target\_users = FALSE; |
| [1229](#L1229) | } |
| [1230](#L1230) | //test if current user must be redirect |
| [1231](#L1231) | if($current\_user=='admin'){ |
| [1232](#L1232) | return true;//show always for admin |
| [1233](#L1233) | } |
| [1234](#L1234) |  |
| [1235](#L1235) | $result = ihc\_test\_if\_must\_block($meta\_arr['ihc\_mb\_type'], $current\_user, $target\_users, $postid); |
| [1236](#L1236) |  |
| [1237](#L1237) | if($result == 0){ |
| [1238](#L1238) | return true; |
| [1239](#L1239) | } |
| [1240](#L1240) | if($result == 2){ |
| [1241](#L1241) | $errMsg = 'This item is expired'; |
| [1242](#L1242) | }else { |
| [1243](#L1243) | $errMsg = 'This item is blocked'; |
| [1244](#L1244) | } |
| [1245](#L1245) |  |
| [1246](#L1246) | if($meta\_arr['ihc\_mb\_block\_type']=='redirect'){ |
| [1247](#L1247) | return parent::sendError('redirect', $errMsg, 401); |
| [1248](#L1248) | }else{ |
| [1249](#L1249) | return parent::sendError('replace\_content', $meta\_arr['ihc\_replace\_content'], 401); |
| [1250](#L1250) | } |
| [1251](#L1251) | } |
| [1252](#L1252) | return true; |
| [1253](#L1253) | } |
| [1254](#L1254) | } |
| [1255](#L1255) |  |
| [1256](#L1256) | function get\_blog\_from\_dynamic\_link($request) |
| [1257](#L1257) | { |
| [1258](#L1258) | $helper = new FlutterBlogHelper(); |
| [1259](#L1259) | return $helper->get\_blog\_from\_dynamic\_link($request); |
| [1260](#L1260) | } |
| [1261](#L1261) |  |
| [1262](#L1262) | function create\_blog($request){ |
| [1263](#L1263) | $helper = new FlutterBlogHelper(); |
| [1264](#L1264) | return $helper->create\_blog($request); |
| [1265](#L1265) | } |
| [1266](#L1266) |  |
| [1267](#L1267) | function create\_comment($request){ |
| [1268](#L1268) | $helper = new FlutterBlogHelper(); |
| [1269](#L1269) | return $helper->create\_comment($request); |
| [1270](#L1270) | } |
| [1271](#L1271) |  |
| [1272](#L1272) | function get\_product\_rating\_counts($request){ |
| [1273](#L1273) | $params = $request->get\_url\_params(); |
| [1274](#L1274) | $productId = sanitize\_text\_field($params['id']); |
| [1275](#L1275) | $product = wc\_get\_product( $productId ); |
| [1276](#L1276) | $rating\_1 = $product->get\_rating\_count(1); |
| [1277](#L1277) | $rating\_2 = $product->get\_rating\_count(2); |
| [1278](#L1278) | $rating\_3 = $product->get\_rating\_count(3); |
| [1279](#L1279) | $rating\_4 = $product->get\_rating\_count(4); |
| [1280](#L1280) | $rating\_5 = $product->get\_rating\_count(5); |
| [1281](#L1281) | return ["rating\_1" => $rating\_1, "rating\_2" => $rating\_2, "rating\_3" => $rating\_3, "rating\_4" => $rating\_4, "rating\_5" => $rating\_5]; |
| [1282](#L1282) | } |
| [1283](#L1283) |  |
| [1284](#L1284) | function get\_products\_video($request){ |
| [1285](#L1285) | global $wpdb; |
| [1286](#L1286) | $table\_name = $wpdb->prefix . "postmeta"; |
| [1287](#L1287) | $page = 1; |
| [1288](#L1288) | $per\_page = 10; |
| [1289](#L1289) |  |
| [1290](#L1290) | if (isset($request['page'])) { |
| [1291](#L1291) | $page = sanitize\_text\_field($request['page']); |
| [1292](#L1292) | if(!is\_numeric($page)){ |
| [1293](#L1293) | $page = 1; |
| [1294](#L1294) | } |
| [1295](#L1295) | } |
| [1296](#L1296) | if (isset($request['per\_page'])) { |
| [1297](#L1297) | $per\_page = sanitize\_text\_field($request['per\_page']); |
| [1298](#L1298) | if(!is\_numeric($per\_page)){ |
| [1299](#L1299) | $per\_page = 10; |
| [1300](#L1300) | } |
| [1301](#L1301) | } |
| [1302](#L1302) | $page = ($page - 1) \* $per\_page; |
| [1303](#L1303) | $items = $wpdb->get\_results("SELECT \* FROM $table\_name WHERE meta\_key='\_mstore\_video\_url' AND meta\_value IS NOT NULL AND meta\_value <> '' LIMIT $per\_page OFFSET $page"); |
| [1304](#L1304) |  |
| [1305](#L1305) | if(count($items) > 0){ |
| [1306](#L1306) | $controller = new CUSTOM\_WC\_REST\_Products\_Controller(); |
| [1307](#L1307) | $req = new WP\_REST\_Request('GET'); |
| [1308](#L1308) | $params = array('include' => array\_map(function($item){ |
| [1309](#L1309) | return $item->post\_id; |
| [1310](#L1310) | }, $items)); |
| [1311](#L1311) | $req->set\_query\_params($params); |
| [1312](#L1312) | $response = $controller->get\_items($req); |
| [1313](#L1313) | return $response->get\_data(); |
| [1314](#L1314) | }else{ |
| [1315](#L1315) | return []; |
| [1316](#L1316) | } |
| [1317](#L1317) | } |
| [1318](#L1318) | } |
| [1319](#L1319) |  |
| [1320](#L1320) | new FlutterWoo; |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/mstore-api/tags/3.9.0/controllers/flutter-woo.php?format=txt)
* [Original Format](/export/3222488/mstore-api/tags/3.9.0/controllers/flutter-woo.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_e4d0f34b_20250114_221506.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D2913397%2540mstore-api%26old%3D2910707%2540mstore-api)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Reverse Diff](/changeset/2910707/mstore-api?old=2913397&old_path=%2Fmstore-api)

---

# Changes in [mstore-api](/browser/mstore-api?rev=2913397 "Show entry in browser") [[2910707:2913397]](/log/mstore-api?rev=2913397&stop_rev=2910707 "Show revision log")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Location:
[mstore-api](/browser/mstore-api?rev=2913397)
Files:

59 added
5 edited

* [tags/3.9.1](/browser/mstore-api/tags/3.9.1?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/assets](/browser/mstore-api/tags/3.9.1/assets?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/assets/css](/browser/mstore-api/tags/3.9.1/assets/css?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/assets/css/mstore-order-style.css](/browser/mstore-api/tags/3.9.1/assets/css/mstore-order-style.css?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/assets/js](/browser/mstore-api/tags/3.9.1/assets/js?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/assets/js/mstore-inspireui.js](/browser/mstore-api/tags/3.9.1/assets/js/mstore-inspireui.js?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers](/browser/mstore-api/tags/3.9.1/controllers?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/flutter-base.php](/browser/mstore-api/tags/3.9.1/controllers/flutter-base.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/flutter-blog.php](/browser/mstore-api/tags/3.9.1/controllers/flutter-blog.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/flutter-booking.php](/browser/mstore-api/tags/3.9.1/controllers/flutter-booking.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/flutter-customer.php](/browser/mstore-api/tags/3.9.1/controllers/flutter-customer.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/flutter-delivery.php](/browser/mstore-api/tags/3.9.1/controllers/flutter-delivery.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/flutter-flutterwave.php](/browser/mstore-api/tags/3.9.1/controllers/flutter-flutterwave.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/flutter-home.php](/browser/mstore-api/tags/3.9.1/controllers/flutter-home.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/flutter-midtrans.php](/browser/mstore-api/tags/3.9.1/controllers/flutter-midtrans.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/flutter-multi-vendor.php](/browser/mstore-api/tags/3.9.1/controllers/flutter-multi-vendor.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/flutter-myfatoorah.php](/browser/mstore-api/tags/3.9.1/controllers/flutter-myfatoorah.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/flutter-notification.php](/browser/mstore-api/tags/3.9.1/controllers/flutter-notification.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/flutter-order.php](/browser/mstore-api/tags/3.9.1/controllers/flutter-order.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/flutter-paid-memberships-pro.php](/browser/mstore-api/tags/3.9.1/controllers/flutter-paid-memberships-pro.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/flutter-paystack.php](/browser/mstore-api/tags/3.9.1/controllers/flutter-paystack.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/flutter-paytm.php](/browser/mstore-api/tags/3.9.1/controllers/flutter-paytm.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/flutter-products.php](/browser/mstore-api/tags/3.9.1/controllers/flutter-products.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/flutter-stripe.php](/browser/mstore-api/tags/3.9.1/controllers/flutter-stripe.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/flutter-tera-wallet.php](/browser/mstore-api/tags/3.9.1/controllers/flutter-tera-wallet.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/flutter-user.php](/browser/mstore-api/tags/3.9.1/controllers/flutter-user.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/flutter-vendor-admin.php](/browser/mstore-api/tags/3.9.1/controllers/flutter-vendor-admin.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/flutter-vendor.php](/browser/mstore-api/tags/3.9.1/controllers/flutter-vendor.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/flutter-wholesale.php](/browser/mstore-api/tags/3.9.1/controllers/flutter-wholesale.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/flutter-woo.php](/browser/mstore-api/tags/3.9.1/controllers/flutter-woo.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/helpers](/browser/mstore-api/tags/3.9.1/controllers/helpers?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/helpers/blog-helper.php](/browser/mstore-api/tags/3.9.1/controllers/helpers/blog-helper.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/helpers/delivery-wcfm-helper.php](/browser/mstore-api/tags/3.9.1/controllers/helpers/delivery-wcfm-helper.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/helpers/delivery-woo-helper.php](/browser/mstore-api/tags/3.9.1/controllers/helpers/delivery-woo-helper.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/helpers/flutter-stripe-helper.php](/browser/mstore-api/tags/3.9.1/controllers/helpers/flutter-stripe-helper.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/helpers/product-management.php](/browser/mstore-api/tags/3.9.1/controllers/helpers/product-management.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/helpers/vendor-admin-dokan-helper.php](/browser/mstore-api/tags/3.9.1/controllers/helpers/vendor-admin-dokan-helper.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/helpers/vendor-admin-wcfm-helper.php](/browser/mstore-api/tags/3.9.1/controllers/helpers/vendor-admin-wcfm-helper.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/helpers/vendor-admin-woo-helper.php](/browser/mstore-api/tags/3.9.1/controllers/helpers/vendor-admin-woo-helper.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/helpers/vendor-wcfm.php](/browser/mstore-api/tags/3.9.1/controllers/helpers/vendor-wcfm.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/listing-rest-api](/browser/mstore-api/tags/3.9.1/controllers/listing-rest-api?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/listing-rest-api/class.api.fields.php](/browser/mstore-api/tags/3.9.1/controllers/listing-rest-api/class.api.fields.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/controllers/listing-rest-api/mylisting-functions.php](/browser/mstore-api/tags/3.9.1/controllers/listing-rest-api/mylisting-functions.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/functions](/browser/mstore-api/tags/3.9.1/functions?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/functions/index.php](/browser/mstore-api/tags/3.9.1/functions/index.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/functions/utils.php](/browser/mstore-api/tags/3.9.1/functions/utils.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/functions/video-setting-embed.php](/browser/mstore-api/tags/3.9.1/functions/video-setting-embed.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/mstore-api.php](/browser/mstore-api/tags/3.9.1/mstore-api.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/readme.txt](/browser/mstore-api/tags/3.9.1/readme.txt?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/templates](/browser/mstore-api/tags/3.9.1/templates?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/templates/admin](/browser/mstore-api/tags/3.9.1/templates/admin?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/templates/admin/mstore-api-admin-dashboard.php](/browser/mstore-api/tags/3.9.1/templates/admin/mstore-api-admin-dashboard.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/templates/class-mobile-detect.php](/browser/mstore-api/tags/3.9.1/templates/class-mobile-detect.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/templates/class-page-templater.php](/browser/mstore-api/tags/3.9.1/templates/class-page-templater.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/templates/class-rename-generate.php](/browser/mstore-api/tags/3.9.1/templates/class-rename-generate.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/templates/class-templater.php](/browser/mstore-api/tags/3.9.1/templates/class-templater.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/templates/mstore-api-admin-page.php](/browser/mstore-api/tags/3.9.1/templates/mstore-api-admin-page.php?rev=2913397 "Show entry in browser")
  (added)
* [tags/3.9.1/templates/mstore-api-template.php](/browser/mstore-api/tags/3.9.1/templates/mstore-api-template.php?rev=2913397 "Show entry in browser")
  (added)
* [trunk/controllers/flutter-notification.php](/browser/mstore-api/trunk/controllers/flutter-notification.php?rev=2913397 "Show entry in browser")
  (added)
* [trunk/controllers/flutter-user.php](/browser/mstore-api/trunk/controllers/flutter-user.php?rev=2913397 "Show entry in browser")
  (modified)
  ([2 diffs](#file59 "Show differences"))
* [trunk/controllers/flutter-woo.php](/browser/mstore-api/trunk/controllers/flutter-woo.php?rev=2913397 "Show entry in browser")
  (modified)
  ([1 diff](#file60 "Show differences"))
* [trunk/functions/index.php](/browser/mstore-api/trunk/functions/index.php?rev=2913397 "Show entry in browser")
  (modified)
  ([5 diffs](#file61 "Show differences"))
* [trunk/mstore-api.php](/browser/mstore-api/trunk/mstore-api.php?rev=2913397 "Show entry in browser")
  (modified)
  ([2 diffs](#file62 "Show differences"))
* [trunk/readme.txt](/browser/mstore-api/trunk/readme.txt?rev=2913397 "Show entry in browser")
  (modified)
  ([2 diffs](#file63 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [mstore-api/trunk/controllers/flutter-user.php](/changeset/2913397/mstore-api/trunk/controllers/flutter-user.php?old=2910532&old_path=mstore-api%2Ftrunk%2Fcontrollers%2Fflutter-user.php "Show the [2910707:2913397] differences restricted to mstore-api/trunk/controllers/flutter-user.php")

  | [r2910707](/browser/mstore-api/trunk/controllers/flutter-user.php?rev=2910532#L215 "Show revision 2910707 of this file in browser") | [r2913397](/browser/mstore-api/trunk/controllers/flutter-user.php?rev=2913397#L215 "Show revision 2913397 of this file in browser") |  |
  | --- | --- | --- |
  | 215 | 215 | 'methods' => 'GET', |
  | 216 | 216 | 'callback' => array($this, 'check\_user'), |
  | 217 |  | ~~'permission\_callback' => function () {~~ |
  | 218 |  | ~~return parent::checkApiPermission();~~ |
  | 219 |  | ~~}~~ |
  | 220 |  | ~~),~~ |
  | 221 |  | ~~));~~ |
  | 222 |  |  |
  | 223 |  | ~~register\_rest\_route($this->namespace, '/test\_push\_notification', array(~~ |
  | 224 |  | ~~array(~~ |
  | 225 |  | ~~'methods' => 'POST',~~ |
  | 226 |  | ~~'callback' => array($this, 'test\_push\_notification'),~~ |
  | 227 |  | ~~'permission\_callback' => function () {~~ |
  | 228 |  | ~~return parent::checkApiPermission();~~ |
  | 229 |  | ~~}~~ |
  | 230 |  | ~~),~~ |
  | 231 |  | ~~));~~ |
  | 232 |  |  |
  | 233 |  | ~~register\_rest\_route($this->namespace, '/test\_push\_notification\_created\_order', array(~~ |
  | 234 |  | ~~array(~~ |
  | 235 |  | ~~'methods' => 'POST',~~ |
  | 236 |  | ~~'callback' => array($this, 'test\_push\_notification\_created\_order'),~~ |
  | 237 | 217 | 'permission\_callback' => function () { |
  | 238 | 218 | return parent::checkApiPermission(); |
  | […](/browser/mstore-api/trunk/controllers/flutter-user.php?rev=2910532#L1194) | […](/browser/mstore-api/trunk/controllers/flutter-user.php?rev=2913397#L1174) |  |
  | 1194 | 1174 | } |
  | 1195 | 1175 |  |
  | 1196 |  | ~~public function test\_push\_notification()~~ |
  | 1197 |  | ~~{~~ |
  | 1198 |  | ~~$json = file\_get\_contents('php://input');~~ |
  | 1199 |  | ~~$params = json\_decode($json);~~ |
  | 1200 |  | ~~$email = $params->email;~~ |
  | 1201 |  | ~~$is\_manager = $params->is\_manager;~~ |
  | 1202 |  | ~~$is\_delivery = $params->is\_delivery;~~ |
  | 1203 |  | ~~$user = get\_user\_by('email', $email);~~ |
  | 1204 |  | ~~$user\_id = $user->ID;~~ |
  | 1205 |  | ~~$serverKey = get\_option("mstore\_firebase\_server\_key");~~ |
  | 1206 |  | ~~$status = false;~~ |
  | 1207 |  | ~~$is\_onesignal = $params->is\_onesignal;~~ |
  | 1208 |  | ~~if($is\_onesignal){~~ |
  | 1209 |  | ~~$status = one\_signal\_push\_notification("Fluxstore", "Test push notification", array($user\_id));~~ |
  | 1210 |  | ~~return ['status' => $status];~~ |
  | 1211 |  | ~~}~~ |
  | 1212 |  | ~~if (isset($is\_manager)) {~~ |
  | 1213 |  | ~~if ($is\_manager) {~~ |
  | 1214 |  | ~~$deviceToken = get\_user\_meta($user\_id, 'mstore\_manager\_device\_token', true);~~ |
  | 1215 |  | ~~if ($deviceToken) {~~ |
  | 1216 |  | ~~$status = pushNotification("Fluxstore", "Test push notification", $deviceToken);~~ |
  | 1217 |  | ~~}~~ |
  | 1218 |  | ~~}~~ |
  | 1219 |  | ~~return ["deviceToken" => $deviceToken, 'serverKey' => $serverKey, 'status' => $status];~~ |
  | 1220 |  | ~~}~~ |
  | 1221 |  | ~~if (isset($is\_delivery)) {~~ |
  | 1222 |  | ~~if ($is\_delivery) {~~ |
  | 1223 |  | ~~$deviceToken = get\_user\_meta($user\_id, 'mstore\_delivery\_device\_token', true);~~ |
  | 1224 |  | ~~if ($deviceToken) {~~ |
  | 1225 |  | ~~$status = pushNotification("Fluxstore", "Test push notification", $deviceToken);~~ |
  | 1226 |  | ~~}~~ |
  | 1227 |  | ~~}~~ |
  | 1228 |  | ~~return ["deviceToken" => $deviceToken, 'serverKey' => $serverKey, 'status' => $status];~~ |
  | 1229 |  | ~~}~~ |
  | 1230 |  | ~~$deviceToken = get\_user\_meta($user\_id, 'mstore\_device\_token', true);~~ |
  | 1231 |  | ~~if ($deviceToken) {~~ |
  | 1232 |  | ~~$status = pushNotification("Fluxstore", "Test push notification", $deviceToken);~~ |
  | 1233 |  | ~~}~~ |
  | 1234 |  | ~~return ["deviceToken" => $deviceToken, 'serverKey' => $serverKey, 'status' => $status];~~ |
  | 1235 |  | ~~}~~ |
  | 1236 |  |  |
  | 1237 |  | ~~function test\_push\_notification\_created\_order(){~~ |
  | 1238 |  | ~~$json = file\_get\_contents('php://input');~~ |
  | 1239 |  | ~~$params = json\_decode($json);~~ |
  | 1240 |  | ~~return trackNewOrder($params->order\_id);~~ |
  | 1241 |  | ~~}~~ |
  | 1242 |  |  |
  | 1243 | 1176 | function chat\_notification() |
  | 1244 | 1177 | { |
* ## [mstore-api/trunk/controllers/flutter-woo.php](/changeset/2913397/mstore-api/trunk/controllers/flutter-woo.php?old=2910532&old_path=mstore-api%2Ftrunk%2Fcontrollers%2Fflutter-woo.php "Show the [2910707:2913397] differences restricted to mstore-api/trunk/controllers/flutter-woo.php")

  | [r2910707](/browser/mstore-api/trunk/controllers/flutter-woo.php?rev=2910532#L743 "Show revision 2910707 of this file in browser") | [r2913397](/browser/mstore-api/trunk/controllers/flutter-woo.php?rev=2913397#L743 "Show revision 2913397 of this file in browser") |  |
  | --- | --- | --- |
  | 743 | 743 | } |
  | 744 | 744 |  |
  | 745 |  | if (isset($body["customer\_id"]) && $body["customer\_id"] != null) { |
  | 746 |  | $userId = $body["customer\_id"]; |
  | 747 |  | $user = get\_userdata($userId); |
  | 748 |  | if ($user) { |
  | 749 |  | wp\_set\_current\_user($userId, $user->user\_login); |
  | 750 |  | wp\_set\_auth\_cookie($userId); |
  | 751 |  | WC()->customer = new WC\_Customer($userId, true); |
  | 752 |  | } |
  |  | 745 | $cookie = $request->get\_header("User-Cookie"); |
  |  | 746 | if (isset($cookie) && $cookie != null) { |
  |  | 747 | $user\_id = validateCookieLogin($cookie); |
  |  | 748 | if (is\_wp\_error($user\_id)) { |
  |  | 749 | return $user\_id; |
  |  | 750 | } |
  |  | 751 | wp\_set\_current\_user($user\_id); |
  |  | 752 | wp\_set\_auth\_cookie($user\_id); |
  |  | 753 | WC()->customer = new WC\_Customer($user\_id, true); |
  | 753 | 754 | } |
  | 754 | 755 |  |
* ## [mstore-api/trunk/functions/index.php](/changeset/2913397/mstore-api/trunk/functions/index.php?old=2910532&old_path=mstore-api%2Ftrunk%2Ffunctions%2Findex.php "Show the [2910707:2913397] differences restricted to mstore-api/trunk/functions/index.php")

  | [r2910707](/browser/mstore-api/trunk/functions/index.php?rev=2910532#L113 "Show revision 2910707 of this file in browser") | [r2913397](/browser/mstore-api/trunk/functions/index.php?rev=2913397#L113 "Show revision 2913397 of this file in browser") |  |
  | --- | --- | --- |
  | 113 | 113 |  |
  | 114 | 114 | if (isset($deviceToken) && $deviceToken != false) { |
  | 115 |  | ~~pushNotification(~~$title, $message, $deviceToken); |
  | 116 |  | } |
  | 117 |  | ~~one\_signal\_push\_notification($title,$message,array($userId)~~); |
  |  | 115 | \_pushNotificationFirebase($userId,$title, $message, $deviceToken); |
  |  | 116 | } |
  |  | 117 | \_pushNotificationOneSignal($userId, $title,$message); |
  | 118 | 118 | } |
  | 119 | 119 |  |
  | […](/browser/mstore-api/trunk/functions/index.php?rev=2910532#L142) | […](/browser/mstore-api/trunk/functions/index.php?rev=2913397#L142) |  |
  | 142 | 142 | $result = $wpdb->get\_results($sql); |
  | 143 | 143 |  |
  | 144 |  | ~~$user\_ids = array();~~ |
  | 145 | 144 | foreach ($result as $item) { |
  | 146 |  | ~~$user\_ids[]=$item->delivery\_boy;~~ |
  | 147 | 145 | $deviceToken = get\_user\_meta($item->delivery\_boy, 'mstore\_delivery\_device\_token', true); |
  | 148 | 146 | if (isset($deviceToken) && $deviceToken != false) { |
  | 149 |  | ~~pushNotification(~~$title, $message, $deviceToken); |
  |  | 147 | \_pushNotificationFirebase($item->delivery\_boy,$title, $message, $deviceToken); |
  | 150 | 148 | } |
  | 151 |  | ~~}~~ |
  | 152 |  | ~~one\_signal\_push\_notification($title,$message, $user\_ids);~~ |
  |  | 149 | \_pushNotificationOneSignal($title,$message, $item->delivery\_boy); |
  |  | 150 | } |
  | 153 | 151 | } |
  | 154 | 152 |  |
  | […](/browser/mstore-api/trunk/functions/index.php?rev=2910532#L176) | […](/browser/mstore-api/trunk/functions/index.php?rev=2913397#L174) |  |
  | 176 | 174 | $deviceToken = get\_user\_meta($driver\_id, 'mstore\_delivery\_device\_token', true); |
  | 177 | 175 | if (isset($deviceToken) && $deviceToken != false) { |
  | 178 |  | ~~pushNotification(~~$title, $message, $deviceToken); |
  |  | 176 | \_pushNotificationFirebase($driver\_id,$title, $message, $deviceToken); |
  | 179 | 177 | $wpdb->insert($table\_name, array( |
  | 180 | 178 | 'message' => $message, |
  | […](/browser/mstore-api/trunk/functions/index.php?rev=2910532#L202) | […](/browser/mstore-api/trunk/functions/index.php?rev=2913397#L200) |  |
  | 202 | 200 | $deviceToken = get\_user\_meta($order\_seller\_id, 'mstore\_device\_token', true); |
  | 203 | 201 | if (isset($deviceToken) && $deviceToken != false) { |
  | 204 |  | ~~pushNotification(~~$title, $message, $deviceToken); |
  |  | 202 | \_pushNotificationFirebase($order\_seller\_id,$title, $message, $deviceToken); |
  | 205 | 203 | } |
  | 206 | 204 | $managerDeviceToken = get\_user\_meta($order\_seller\_id, 'mstore\_manager\_device\_token', true); |
  | 207 | 205 | if (isset($managerDeviceToken) && $managerDeviceToken != false) { |
  | 208 |  | ~~pushNotification(~~$title, $message, $managerDeviceToken); |
  |  | 206 | \_pushNotificationFirebase($order\_seller\_id,$title, $message, $managerDeviceToken); |
  | 209 | 207 | if (is\_plugin\_active('wc-multivendor-marketplace/wc-multivendor-marketplace.php')) { |
  | 210 | 208 | wcfm\_message\_on\_new\_order($order\_id); |
  | 211 | 209 | } |
  | 212 | 210 | } |
  | 213 |  | ~~one\_signal\_push\_notification($title, $message, array($order\_seller\_id)~~); |
  |  | 211 | \_pushNotificationOneSignal($order\_seller\_id,$title, $message); |
  | 214 | 212 | } |
  | 215 | 213 |  |
  | […](/browser/mstore-api/trunk/functions/index.php?rev=2910532#L611) | […](/browser/mstore-api/trunk/functions/index.php?rev=2913397#L609) |  |
  | 611 | 609 | $managerDeviceToken = get\_user\_meta($seller\_id, 'mstore\_manager\_device\_token', true); |
  | 612 | 610 | if (isset($managerDeviceToken) && $managerDeviceToken != false) { |
  | 613 |  | pushNotification($title, $message, $managerDeviceToken); |
  | 614 |  | } |
  | 615 |  | one\_signal\_push\_notification($title, $message, array($seller\_id)); |
  | 616 |  | } |
  |  | 611 | \_pushNotificationFirebase($seller\_id, $title, $message, $managerDeviceToken); |
  |  | 612 | } |
  |  | 613 | \_pushNotificationOneSignal($seller\_id,$title, $message); |
  |  | 614 | } |
  |  | 615 | } |
  |  | 616 |  |
  |  | 617 | function \_pushNotificationFirebase($user\_id, $title, $message, $deviceToken){ |
  |  | 618 | $is\_on = isNotificationEnabled($user\_id); |
  |  | 619 | if($is\_on){ |
  |  | 620 | pushNotification($title, $message, $deviceToken); |
  |  | 621 | } |
  |  | 622 | } |
  |  | 623 |  |
  |  | 624 | function \_pushNotificationOneSignal($user\_id, $title, $message){ |
  |  | 625 | $is\_on = isNotificationEnabled($user\_id); |
  |  | 626 | if($is\_on){ |
  |  | 627 | one\_signal\_push\_notification($title,$message,array($userId)); |
  |  | 628 | } |
  |  | 629 | } |
  |  | 630 |  |
  |  | 631 | function isNotificationEnabled($user\_id){ |
  |  | 632 | $is\_on = get\_user\_meta($user\_id, "mstore\_notification\_status", true); |
  |  | 633 | return  $is\_on === "" || $is\_on === "on"; |
  | 617 | 634 | } |
  | 618 | 635 | ?> |
* ## [mstore-api/trunk/mstore-api.php](/changeset/2913397/mstore-api/trunk/mstore-api.php?old=2910532&old_path=mstore-api%2Ftrunk%2Fmstore-api.php "Show the [2910707:2913397] differences restricted to mstore-api/trunk/mstore-api.php")

  | [r2910707](/browser/mstore-api/trunk/mstore-api.php?rev=2910532#L4 "Show revision 2910707 of this file in browser") | [r2913397](/browser/mstore-api/trunk/mstore-api.php?rev=2913397#L4 "Show revision 2913397 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* Plugin URI: https://github.com/inspireui/mstore-api |
  | 5 | 5 | \* Description: The MStore API Plugin which is used for the MStore and FluxStore Mobile App |
  | 6 |  | \* Version: 3.9.~~0~~ |
  |  | 6 | \* Version: 3.9.1 |
  | 7 | 7 | \* Author: InspireUI |
  | 8 | 8 | \* Author URI: https://inspireui.com |
  | […](/browser/mstore-api/trunk/mstore-api.php?rev=2910532#L37) | […](/browser/mstore-api/trunk/mstore-api.php?rev=2913397#L37) |  |
  | 37 | 37 | include\_once plugin\_dir\_path(\_\_FILE\_\_) . "controllers/flutter-wholesale.php"; |
  | 38 | 38 | include\_once plugin\_dir\_path(\_\_FILE\_\_) . "controllers/flutter-stripe.php"; |
  |  | 39 | include\_once plugin\_dir\_path(\_\_FILE\_\_) . "controllers/flutter-notification.php"; |
  | 39 | 40 |  |
  | 40 | 41 | class MstoreCheckOut |
  | 41 | 42 | { |
  | 42 |  | public $version = '3.9.~~0~~'; |
  |  | 43 | public $version = '3.9.1'; |
  | 43 | 44 |  |
  | 44 | 45 | public function \_\_construct() |
* ## [mstore-api/trunk/readme.txt](/changeset/2913397/mstore-api/trunk/readme.txt?old=2910532&old_path=mstore-api%2Ftrunk%2Freadme.txt "Show the [2910707:2913397] differences restricted to mstore-api/trunk/readme.txt")

  | [r2910707](/browser/mstore-api/trunk/readme.txt?rev=2910532#L4 "Show revision 2910707 of this file in browser") | [r2913397](/browser/mstore-api/trunk/readme.txt?rev=2913397#L4 "Show revision 2913397 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Requires at least: 4.4 |
  | 5 | 5 | Tested up to:      6.0.0 |
  | 6 |  | Stable tag:        3.9.~~0~~ |
  |  | 6 | Stable tag:        3.9.1 |
  | 7 | 7 | License:           GPL-2.0 |
  | 8 | 8 | License URI:       https://www.gnu.org/licenses/gpl-2.0.html |
  | […](/browser/mstore-api/trunk/readme.txt?rev=2910532#L44) | […](/browser/mstore-api/trunk/readme.txt?rev=2913397#L44) |  |
  | 44 | 44 |  |
  | 45 | 45 | == Changelog == |
  |  | 46 | = 3.9.1 = |
  |  | 47 | \* Fix security issue for coupon api |
  |  | 48 |  |
  | 46 | 49 | = 3.9.0 = |
  | 47 | 50 | \* Fix to push notification to seller when order created |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=2913397&old=2910707&new_path=%2Fmstore-api&old_path=%2Fmstore-api)
* [Zip Archive](?format=zip&new=2913397&old=2910707&new_path=%2Fmstore-api&old_path=%2Fmstore-api)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


