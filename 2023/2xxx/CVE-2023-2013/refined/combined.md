=== Content from gitlab.com_c7a0b74c_20250114_205127.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2023](/gitlab-org/cves/-/tree/master/2023)
* [**CVE-2023-2013.json**](/gitlab-org/cves/-/blob/master/2023/CVE-2023-2013.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2023/CVE-2023-2013.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2023/CVE-2023-2013.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![ðŸ¤– GitLab Bot ðŸ¤–'s avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 "ðŸ¤– GitLab Bot ðŸ¤–")](/gitlab-bot)

  Jun 06, 2023

  [c4fb8467](/gitlab-org/cves/-/commit/c4fb8467c212168aca07c0d4f2185ed51486be7e)
  [Publishing 0 updated advisories and 10 new advisories](/gitlab-org/cves/-/commit/c4fb8467c212168aca07c0d4f2185ed51486be7e)
  Â·
  c4fb8467

  [ðŸ¤– GitLab Bot ðŸ¤–](/gitlab-bot) authored Jun 06, 2023

  c4fb8467

  [Publishing 0 updated advisories and 10 new advisories](/gitlab-org/cves/-/commit/c4fb8467c212168aca07c0d4f2185ed51486be7e)
  [ðŸ¤– GitLab Bot ðŸ¤–](/gitlab-bot) authored Jun 06, 2023

Loading



=== Content from gitlab.com_a1f50991_20250114_205128.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Ambiguous branch name exploitation

âš  **Please read [the process](https://gitlab.com/gitlab-org/release/docs/-/blob/master/general/security/developer.md) on how to fix security issues before starting to work on the issue. Vulnerabilities must be fixed in a security mirror.**

**[HackerOne report #1940441](https://hackerone.com/reports/1940441)** by `inspector-ambitious` on 2023-04-10, assigned to [@fvpotvin](/fvpotvin "FÃ©lix Veillette-Potvin"):

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

#### Summary

##### Introduction

I previously reported #1831547 and #1831543, they have been closed and fixed. However I wanted to retest them carefully over the weekend and I managed to replicate the issue again but this time using a branch called `heads/main` !

##### A quick recap about symbolic ref names

The following is extracted from this [documentation](https://git-scm.com/docs/gitrevisions#Documentation/gitrevisions.txt-emltrefnamegtemegemmasterememheadsmasterememrefsheadsmasterem).

> A symbolic ref name. E.g. `master` typically means the commit object referenced by `refs/heads/master`. If you happen to have both `heads/master` and `tags/master`, you can explicitly say heads/master to tell Git which one you mean. When ambiguous, a `<refname>` is disambiguated by taking the first match in the following rules:
>
> If $GIT\_DIR/`<refname>` exists, that is what you mean (this is usually useful only for HEAD, FETCH\_HEAD, ORIG\_HEAD, MERGE\_HEAD and CHERRY\_PICK\_HEAD);
>
> * otherwise, refs/`<refname>` if it exists;
> * otherwise, refs/tags/`<refname>` if it exists;
> * otherwise, refs/heads/`<refname>` if it exists;
> * otherwise, refs/remotes/`<refname>` if it exists;
> * otherwise, refs/remotes/`<refname>`/HEAD if it exists.

In the following exploitation scenario, we're going to abuse the fact that the following symbolic reference name

`heads/foo`, can resolve to two distinct branches either `refs/heads/foo` or `refs/heads/heads/foo`.

#### Steps to reproduce

This scenario was tested on `gitlab.com`.

##### Step 1: The malicious `heads/main` default branch

A user named `victim01` creates an empty new repository named `ambiguity` (without a README).

[![image.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/52b4e7f888ab7877ed762d608507537746ade607/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f64353766643137352d343238612d343164342d386232632d6337396334666334663438332f696d6167652e706e67)

`victim01` will then create a branch named `heads/main` containing a malicious script named `./script.sh`. That branch will become the default branch since the repository was empty.

From the command line, it would look like this

```
git clone git@gitlab.com:evilcorporation/ambiguity.git
cd ambiguity
echo "echo 'execute malicious code'" >> script.sh
chmod +x script.sh
git add script.sh
git commit -m "malicious script"
git branch -M hack
git push origin hack:refs/heads/heads/main
```

[![image.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/c4ec887a756e1d52883f08670c65dd196c15fd14/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f34643864326363332d346133632d343133332d626235622d3938343762383638636534362f696d6167652e706e67)

Note in the screenshot above that the default branch is `heads/main` and the commit name is `malicious script`.

##### Step 2: The genuine `main` branch

Then `victim01` creates a `main` branch in the repository containing as well a `./script.sh` but this time the content of `./script.sh` is genuine and safe to execute.

From the command line, it would look like this

```
mkdir ambiguity_genuine
cdambiguity_genuine
echo "echo 'this is genuine'" >> script.sh
chmod +x script.sh
git init
git add script.sh
git commit -m "genuine script"
git branch -M genuine
git remote add origin  git@gitlab.com:evilcorporation/ambiguity.git
git push origin genuine:refs/heads/main
```

##### Step 3: The victim clone the repo and execute the script

Now let's say the user `user1` goes to the repository `https://gitlab.com/evilcorporation/ambiguity.git/`, `user1` will see the following.

[![image.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/c05f06c4db10dfcee4db0ad27f8c1bafa45aad12/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f65626130313932302d376539372d346638322d613931642d3738656561363530656361612f696d6167652e706e67)

[![image.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/691e3514ae9578de841901675e05f2e8702a2793/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f64363838656263662d653033332d343162622d393266382d6231336463303532633631372f696d6167652e706e67)

While the default branch is `heads/main`, `user1` will see the content of `main` branch instead, note the commit name `genuine script`. And if `user1` was cloning the repository and executing `script.sh`, it will be the malicious code that would be executed instead.

[![image.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/b0cad943db3dfdec4556ee878075d0a79d0311ad/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f37653662313139622d363437322d346436312d396337362d3561383834366237626631382f696d6167652e706e67)

I also tested the download of the zip file and it is vulnerable this time ! (contrary to previous report), the `victim` would download the content `heads/main` branch, see below the extraction of the zip and the output of `script.sh`

[![image.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/5041de2685d445595c4ff4ed472812b2a09e9368/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f64643065363464302d623865362d346263362d393563322d6632643065343163643436312f696d6167652e706e67)

### Output of checks

This bug happens on GitLab.com

### Impact

Malicious repositories could be created to lure users into executing what they think is safe code, resulting in the takeover of the victim system.

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [image.png](https://h1.sec.gitlab.net/a/d57fd175-428a-41d4-8b2c-c79c4fc4f483/image.png)
* [image.png](https://h1.sec.gitlab.net/a/4d8d2cc3-4a3c-4133-bb5b-9847b868ce46/image.png)
* [image.png](https://h1.sec.gitlab.net/a/eba01920-7e97-4f82-a91d-78eea650ecaa/image.png)
* [image.png](https://h1.sec.gitlab.net/a/7e6b119b-6472-4d61-9c76-5a8846b7bf18/image.png)
* [image.png](https://h1.sec.gitlab.net/a/dd0e64d0-b8e6-4bc6-95c2-f2d0e41cd461/image.png)
* [image.png](https://h1.sec.gitlab.net/a/d688ebcf-e033-41bb-92f8-b13dc052c617/image.png)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


