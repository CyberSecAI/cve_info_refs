=== Content from plugins.trac.wordpress.org_a344fe27_20250114_190026.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D2911239%2540wp-security-audit-log%252Ftrunk%26old%3D2897171%2540wp-security-audit-log%252Ftrunk)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Reverse Diff](/changeset/2897171/wp-security-audit-log/trunk?old=2911239&old_path=%2Fwp-security-audit-log%2Ftrunk)

---

# Changes in [wp-security-audit-log/trunk](/browser/wp-security-audit-log/trunk?rev=2911239 "Show entry in browser") [[2897171:2911239]](/log/wp-security-audit-log/trunk?rev=2911239&stop_rev=2897171 "Show revision log")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Location:
[wp-security-audit-log/trunk](/browser/wp-security-audit-log/trunk?rev=2911239)
Files:

73 added
1 deleted
41 edited

* [classes/AuditLogGridView.php](/browser/wp-security-audit-log/trunk/classes/AuditLogGridView.php?rev=2911237 "Show entry in browser")
  (modified)
  ([7 diffs](#file0 "Show differences"))
* [classes/AuditLogListView.php](/browser/wp-security-audit-log/trunk/classes/AuditLogListView.php?rev=2911237 "Show entry in browser")
  (modified)
  ([2 diffs](#file1 "Show differences"))
* [classes/Controllers/class-alert-manager.php](/browser/wp-security-audit-log/trunk/classes/Controllers/class-alert-manager.php?rev=2911237 "Show entry in browser")
  (modified)
  ([2 diffs](#file2 "Show differences"))
* [classes/Controllers/class-sensors-load-manager.php](/browser/wp-security-audit-log/trunk/classes/Controllers/class-sensors-load-manager.php?rev=2911237 "Show entry in browser")
  (modified)
  ([2 diffs](#file3 "Show differences"))
* [classes/Entities/class-metadata-entity.php](/browser/wp-security-audit-log/trunk/classes/Entities/class-metadata-entity.php?rev=2911237 "Show entry in browser")
  (modified)
  ([2 diffs](#file4 "Show differences"))
* [classes/Entities/class-occurrences-entity.php](/browser/wp-security-audit-log/trunk/classes/Entities/class-occurrences-entity.php?rev=2911237 "Show entry in browser")
  (modified)
  ([1 diff](#file5 "Show differences"))
* [classes/Helpers/class-plugins-helper.php](/browser/wp-security-audit-log/trunk/classes/Helpers/class-plugins-helper.php?rev=2911237 "Show entry in browser")
  (modified)
  ([1 diff](#file6 "Show differences"))
* [classes/Helpers/class-settings-helper.php](/browser/wp-security-audit-log/trunk/classes/Helpers/class-settings-helper.php?rev=2911237 "Show entry in browser")
  (modified)
  ([10 diffs](#file7 "Show differences"))
* [classes/Helpers/class-wp-helper.php](/browser/wp-security-audit-log/trunk/classes/Helpers/class-wp-helper.php?rev=2911237 "Show entry in browser")
  (modified)
  ([1 diff](#file8 "Show differences"))
* [classes/Migration/class-migration.php](/browser/wp-security-audit-log/trunk/classes/Migration/class-migration.php?rev=2911237 "Show entry in browser")
  (modified)
  ([12 diffs](#file9 "Show differences"))
* [classes/Ref.php](/browser/wp-security-audit-log/trunk/classes/Ref.php?rev=2911237 "Show entry in browser")
  (modified)
  ([5 diffs](#file10 "Show differences"))
* [classes/Select2](/browser/wp-security-audit-log/trunk/classes/Select2?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets](/browser/wp-security-audit-log/trunk/classes/Select2/assets?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/css](/browser/wp-security-audit-log/trunk/classes/Select2/assets/css?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/css/select2.css](/browser/wp-security-audit-log/trunk/classes/Select2/assets/css/select2.css?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/css/select2.min.css](/browser/wp-security-audit-log/trunk/classes/Select2/assets/css/select2.min.css?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/css/wp-overrides.css](/browser/wp-security-audit-log/trunk/classes/Select2/assets/css/wp-overrides.css?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/af.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/af.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/ar.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/ar.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/az.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/az.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/bg.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/bg.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/bn.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/bn.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/bs.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/bs.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/build.txt](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/build.txt?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/ca.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/ca.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/cs.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/cs.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/da.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/da.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/de.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/de.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/dsb.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/dsb.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/el.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/el.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/en.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/en.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/es.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/es.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/et.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/et.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/eu.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/eu.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/fa.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/fa.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/fi.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/fi.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/fr.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/fr.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/gl.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/gl.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/he.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/he.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/hi.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/hi.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/hr.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/hr.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/hsb.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/hsb.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/hu.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/hu.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/hy.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/hy.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/id.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/id.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/is.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/is.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/it.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/it.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/ja.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/ja.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/ka.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/ka.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/km.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/km.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/ko.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/ko.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/lt.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/lt.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/lv.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/lv.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/mk.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/mk.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/ms.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/ms.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/nb.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/nb.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/ne.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/ne.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/nl.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/nl.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/pl.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/pl.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/ps.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/ps.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/pt-BR.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/pt-BR.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/pt.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/pt.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/ro.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/ro.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/ru.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/ru.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/sk.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/sk.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/sl.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/sl.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/sq.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/sq.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/sr-Cyrl.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/sr-Cyrl.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/sr.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/sr.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/sv.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/sv.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/th.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/th.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/tk.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/tk.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/tr.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/tr.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/uk.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/uk.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/vi.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/vi.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/zh-CN.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/zh-CN.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/i18n/zh-TW.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/i18n/zh-TW.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/select2.full.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/select2.full.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/select2.full.min.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/select2.full.min.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/select2.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/select2.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/assets/js/select2.min.js](/browser/wp-security-audit-log/trunk/classes/Select2/assets/js/select2.min.js?rev=2911237 "Show entry in browser")
  (added)
* [classes/Select2/class-select2-wpws.php](/browser/wp-security-audit-log/trunk/classes/Select2/class-select2-wpws.php?rev=2911237 "Show entry in browser")
  (added)
* [classes/SensorManager.php](/browser/wp-security-audit-log/trunk/classes/SensorManager.php?rev=2911237 "Show entry in browser")
  (modified)
  ([2 diffs](#file84 "Show differences"))
* [classes/Settings.php](/browser/wp-security-audit-log/trunk/classes/Settings.php?rev=2911237 "Show entry in browser")
  (modified)
  ([6 diffs](#file85 "Show differences"))
* [classes/Views/AuditLog.php](/browser/wp-security-audit-log/trunk/classes/Views/AuditLog.php?rev=2911237 "Show entry in browser")
  (modified)
  ([9 diffs](#file86 "Show differences"))
* [classes/Views/Settings.php](/browser/wp-security-audit-log/trunk/classes/Views/Settings.php?rev=2911237 "Show entry in browser")
  (modified)
  ([11 diffs](#file87 "Show differences"))
* [classes/WPSensors/class-wp-content-sensor.php](/browser/wp-security-audit-log/trunk/classes/WPSensors/class-wp-content-sensor.php?rev=2911237 "Show entry in browser")
  (modified)
  ([1 diff](#file88 "Show differences"))
* [classes/WPSensors/class-wp-log-in-out-sensor.php](/browser/wp-security-audit-log/trunk/classes/WPSensors/class-wp-log-in-out-sensor.php?rev=2911237 "Show entry in browser")
  (modified)
  ([8 diffs](#file89 "Show differences"))
* [classes/WPSensors/class-wp-multisite-sensor.php](/browser/wp-security-audit-log/trunk/classes/WPSensors/class-wp-multisite-sensor.php?rev=2911237 "Show entry in browser")
  (modified)
  ([1 diff](#file90 "Show differences"))
* [classes/WPSensors/class-wp-register-sensor.php](/browser/wp-security-audit-log/trunk/classes/WPSensors/class-wp-register-sensor.php?rev=2911237 "Show entry in browser")
  (modified)
  ([2 diffs](#file91 "Show differences"))
* [css/auditlog.css](/browser/wp-security-audit-log/trunk/css/auditlog.css?rev=2911237 "Show entry in browser")
  (modified)
  ([5 diffs](#file92 "Show differences"))
* [js/auditlog.js](/browser/wp-security-audit-log/trunk/js/auditlog.js?rev=2911237 "Show entry in browser")
  (modified)
  ([2 diffs](#file93 "Show differences"))
* [languages/wp-security-audit-log.pot](/browser/wp-security-audit-log/trunk/languages/wp-security-audit-log.pot?rev=2911237 "Show entry in browser")
  (modified)
  ([3 diffs](#file94 "Show differences"))
* [nofs/lib/class-wsal-freemius.php](/browser/wp-security-audit-log/trunk/nofs/lib/class-wsal-freemius.php?rev=2911237 "Show entry in browser")
  (modified)
  ([1 diff](#file95 "Show differences"))
* [readme.txt](/browser/wp-security-audit-log/trunk/readme.txt?rev=2911239 "Show entry in browser")
  (modified)
  ([2 diffs](#file96 "Show differences"))
* [sdk/wsal-freemius.php](/browser/wp-security-audit-log/trunk/sdk/wsal-freemius.php?rev=2911237 "Show entry in browser")
  (modified)
  ([1 diff](#file97 "Show differences"))
* [third-party/vendor/autoload.php](/browser/wp-security-audit-log/trunk/third-party/vendor/autoload.php?rev=2911237 "Show entry in browser")
  (modified)
  ([1 diff](#file98 "Show differences"))
* [third-party/vendor/classes/wp-async-request.php](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-async-request.php?rev=2911237 "Show entry in browser")
  (modified)
  ([8 diffs](#file99 "Show differences"))
* [third-party/vendor/classes/wp-background-process.php](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2911237 "Show entry in browser")
  (modified)
  ([27 diffs](#file100 "Show differences"))
* [third-party/vendor/composer/ClassLoader.php](/browser/wp-security-audit-log/trunk/third-party/vendor/composer/ClassLoader.php?rev=2911237 "Show entry in browser")
  (modified)
  ([4 diffs](#file101 "Show differences"))
* [third-party/vendor/composer/autoload\_real.php](/browser/wp-security-audit-log/trunk/third-party/vendor/composer/autoload_real.php?rev=2911237 "Show entry in browser")
  (modified)
  ([2 diffs](#file102 "Show differences"))
* [third-party/vendor/composer/autoload\_static.php](/browser/wp-security-audit-log/trunk/third-party/vendor/composer/autoload_static.php?rev=2911237 "Show entry in browser")
  (modified)
  ([2 diffs](#file103 "Show differences"))
* [third-party/vendor/wp-background-processing.php](/browser/wp-security-audit-log/trunk/third-party/vendor/wp-background-processing.php?rev=2911237 "Show entry in browser")
  (modified)
  ([1 diff](#file104 "Show differences"))
* [vendor/autoload.php](/browser/wp-security-audit-log/trunk/vendor/autoload.php?rev=2911237 "Show entry in browser")
  (modified)
  ([1 diff](#file105 "Show differences"))
* [vendor/composer/ClassLoader.php](/browser/wp-security-audit-log/trunk/vendor/composer/ClassLoader.php?rev=2911237 "Show entry in browser")
  (modified)
  ([4 diffs](#file106 "Show differences"))
* [vendor/composer/autoload\_classmap.php](/browser/wp-security-audit-log/trunk/vendor/composer/autoload_classmap.php?rev=2911237 "Show entry in browser")
  (modified)
  ([1 diff](#file107 "Show differences"))
* [vendor/composer/autoload\_files.php](/browser/wp-security-audit-log/trunk/vendor/composer/autoload_files.php?rev=2911237 "Show entry in browser")
  (modified)
  ([1 diff](#file108 "Show differences"))
* [vendor/composer/autoload\_real.php](/browser/wp-security-audit-log/trunk/vendor/composer/autoload_real.php?rev=2911237 "Show entry in browser")
  (modified)
  ([3 diffs](#file109 "Show differences"))
* [vendor/composer/autoload\_static.php](/browser/wp-security-audit-log/trunk/vendor/composer/autoload_static.php?rev=2911237 "Show entry in browser")
  (modified)
  ([3 diffs](#file110 "Show differences"))
* [vendor/composer/installed.json](/browser/wp-security-audit-log/trunk/vendor/composer/installed.json?rev=2911237 "Show entry in browser")
  (modified)
  ([9 diffs](#file111 "Show differences"))
* [vendor/composer/installed.php](/browser/wp-security-audit-log/trunk/vendor/composer/installed.php?rev=2911237 "Show entry in browser")
  (modified)
  ([4 diffs](#file112 "Show differences"))
* [vendor/wpwhitesecurity/select2-wpwhitesecurity](/browser/wp-security-audit-log/trunk/vendor/wpwhitesecurity/select2-wpwhitesecurity?rev=2749070 "Show what was removed (content at revision 2897171)")
  (deleted)
* [wp-security-audit-log.php](/browser/wp-security-audit-log/trunk/wp-security-audit-log.php?rev=2911237 "Show entry in browser")
  (modified)
  ([10 diffs](#file114 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [wp-security-audit-log/trunk/classes/AuditLogGridView.php](/changeset/2911237/wp-security-audit-log/trunk/classes/AuditLogGridView.php?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Fclasses%2FAuditLogGridView.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/classes/AuditLogGridView.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/classes/AuditLogGridView.php?rev=2897171#L226 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/classes/AuditLogGridView.php?rev=2911237#L226 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 226 | 226 | } |
  | 227 | 227 |  |
  |  | 228 | // phpcs:disable |
  |  | 229 | // phpcs:enable |
  | 228 | 230 | } |
  | 229 | 231 |  |
  | […](/browser/wp-security-audit-log/trunk/classes/AuditLogGridView.php?rev=2897171#L414) | […](/browser/wp-security-audit-log/trunk/classes/AuditLogGridView.php?rev=2911237#L416) |  |
  | 414 | 416 | $uhtml   = '<a class="tooltip" data-tooltip="' . esc\_attr( $tooltip ) . '" data-user="' . $user->user\_login . '" href="' . $user\_edit\_link . '" target="\_blank">' . esc\_html( $display\_name ) . '</a>'; |
  | 415 | 417 |  |
  |  | 418 | // phpcs:disable |
  |  | 419 | // phpcs:enable |
  | 416 | 420 |  |
  | 417 | 421 | $roles = WSAL\_Utilities\_UsersUtils::get\_roles\_label( $item['user\_roles'] ); |
  | […](/browser/wp-security-audit-log/trunk/classes/AuditLogGridView.php?rev=2897171#L452) | […](/browser/wp-security-audit-log/trunk/classes/AuditLogGridView.php?rev=2911237#L456) |  |
  | 452 | 456 | // If there's no IP... |
  | 453 | 457 | if ( is\_null( $scip ) || '' === $scip ) { |
  | 454 |  | return '<i>unknown</i>'; |
  |  | 458 | if ( isset( $item['meta\_values'] ) && isset( $item['meta\_values']['OtherIPs'] ) ) { |
  |  | 459 | if ( is\_array( $item['meta\_values']['OtherIPs'] ) ) { |
  |  | 460 | $scip = reset( $item['meta\_values']['OtherIPs'] )[0]; |
  |  | 461 | } |
  |  | 462 | } else { |
  |  | 463 | return '<i>unknown</i>'; |
  |  | 464 | } |
  | 455 | 465 | } |
  | 456 | 466 |  |
  | […](/browser/wp-security-audit-log/trunk/classes/AuditLogGridView.php?rev=2897171#L463) | […](/browser/wp-security-audit-log/trunk/classes/AuditLogGridView.php?rev=2911237#L473) |  |
  | 463 | 473 | $oips\_html = "<a class='search-ip' data-tooltip='$tooltip' data-ip='$scip' target='\_blank' href='$link'>" . esc\_html( $scip ) . '</a>'; |
  | 464 | 474 | } |
  | 465 |  | } else { |
  | 466 |  | if ( count( $oips ) < 2 ) { |
  |  | 475 | } elseif ( count( $oips ) < 2 ) { |
  | 467 | 476 | $oips\_html = "<a target='\_blank' href='$link'>" . esc\_html( $scip ) . '</a>'; |
  | 468 |  | ~~}~~ |
  | 469 | 477 | } |
  | 470 | 478 |  |
  | […](/browser/wp-security-audit-log/trunk/classes/AuditLogGridView.php?rev=2897171#L527) | […](/browser/wp-security-audit-log/trunk/classes/AuditLogGridView.php?rev=2911237#L535) |  |
  | 527 | 535 | $url     = admin\_url( 'admin-ajax.php' ) . '?action=AjaxInspector&amp;occurrence=' . $item['id']; |
  | 528 | 536 | $tooltip = esc\_attr\_\_( 'View all details of this change', 'wp-security-audit-log' ); |
  | 529 |  | return '<a class="more-info ~~thickbox" data-tooltip="' . $tooltip . '" title="' . \_\_( 'Alert Data I~~nspector', 'wp-security-audit-log' ) . '"' |
  | 530 |  | ~~. ' href="' . $url . '&amp;TB\_iframe=true&amp;width=600&amp;height=550">&hellip;~~</a>'; |
  |  | 537 | return '<a class="more-info button button-secondary thickbox" data-tooltip="' . $tooltip . '" title="' . \_\_( 'Event data inspector', 'wp-security-audit-log' ) . '"' |
  |  | 538 | . ' href="' . $url . '&amp;TB\_iframe=true&amp;width=600&amp;height=550">' . \_\_( 'More details...', 'wp-security-audit-log' ) . '</a>'; |
  | 531 | 539 | default: |
  | 532 |  | return isset( $item[~~$column\_name~~] ) |
  | 533 |  | ? esc\_html( $item[~~$column\_name~~] ) |
  |  | 540 | return isset( $item[ $column\_name ] ) |
  |  | 541 | ? esc\_html( $item[ $column\_name ] ) |
  | 534 | 542 | : 'Column "' . esc\_html( $column\_name ) . '" not found'; |
  | 535 | 543 | } |
  | […](/browser/wp-security-audit-log/trunk/classes/AuditLogGridView.php?rev=2897171#L624) | […](/browser/wp-security-audit-log/trunk/classes/AuditLogGridView.php?rev=2911237#L632) |  |
  | 624 | 632 | $columns['cb']     = '<label class="screen-reader-text" for="cb-select-all-' . $cb\_counter . '">' . \_\_( 'Select All' ) . '</label>' |
  | 625 | 633 | . '<input id="cb-select-all-' . $cb\_counter . '" type="checkbox" />'; |
  | 626 |  | ~~$cb\_counter++~~; |
  |  | 634 | ++$cb\_counter; |
  | 627 | 635 | } |
  | 628 | 636 |  |
  | […](/browser/wp-security-audit-log/trunk/classes/AuditLogGridView.php?rev=2897171#L707) | […](/browser/wp-security-audit-log/trunk/classes/AuditLogGridView.php?rev=2911237#L715) |  |
  | 707 | 715 | \*/ |
  | 708 | 716 | public function query\_events( $paged = 0 ) { |
  |  | 717 | // phpcs:disable |
  |  | 718 | // phpcs:enable |
  | 709 | 719 |  |
  | 710 | 720 | // TO DO: Get rid of OccurrenceQuery and use the Occurrence Model. |
* ## [wp-security-audit-log/trunk/classes/AuditLogListView.php](/changeset/2911237/wp-security-audit-log/trunk/classes/AuditLogListView.php?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Fclasses%2FAuditLogListView.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/classes/AuditLogListView.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/classes/AuditLogListView.php?rev=2897171#L448 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/classes/AuditLogListView.php?rev=2911237#L448 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 448 | 448 | // If there's no IP... |
  | 449 | 449 | if ( is\_null( $scip ) || '' === $scip ) { |
  | 450 |  | return '<i>unknown</i>'; |
  |  | 450 | if ( isset( $item['meta\_values'] ) && isset( $item['meta\_values']['OtherIPs'] ) ) { |
  |  | 451 | if ( is\_array( $item['meta\_values']['OtherIPs'] ) ) { |
  |  | 452 | $scip = reset( $item['meta\_values']['OtherIPs'] )[0]; |
  |  | 453 | } |
  |  | 454 | } else { |
  |  | 455 | return '<i>unknown</i>'; |
  |  | 456 | } |
  | 451 | 457 | } |
  | 452 | 458 |  |
  | […](/browser/wp-security-audit-log/trunk/classes/AuditLogListView.php?rev=2897171#L498) | […](/browser/wp-security-audit-log/trunk/classes/AuditLogListView.php?rev=2911237#L504) |  |
  | 498 | 504 | $url     = admin\_url( 'admin-ajax.php' ) . '?action=AjaxInspector&amp;occurrence=' . $item['id']; |
  | 499 | 505 | $tooltip = esc\_attr\_\_( 'View all details of this change', 'wp-security-audit-log' ); |
  | 500 |  | return '<a class="more-info ~~thickbox" data-tooltip="' . $tooltip . '" title="' . \_\_( 'Alert Data I~~nspector', 'wp-security-audit-log' ) . '"' |
  | 501 |  | . ' href="' . $url . '&amp;TB\_iframe=true&amp;width=600&amp;height=550">~~&hellip;~~</a>'; |
  |  | 506 | return '<a class="more-info button button-secondary thickbox" data-tooltip="' . $tooltip . '" title="' . \_\_( 'Event data inspector', 'wp-security-audit-log' ) . '"' |
  |  | 507 | . ' href="' . $url . '&amp;TB\_iframe=true&amp;width=600&amp;height=550">' . \_\_( 'More details...', 'wp-security-audit-log' ) . '</a>'; |
  | 502 | 508 | case 'object': |
  | 503 | 509 | return ( isset( $item['meta\_values']['Object'] ) && ! empty( $item['meta\_values']['Object'] ) ) ? Alert\_Manager::get\_event\_objects\_data( $item['meta\_values']['Object'] ) : ''; |
* ## [wp-security-audit-log/trunk/classes/Controllers/class-alert-manager.php](/changeset/2911237/wp-security-audit-log/trunk/classes/Controllers/class-alert-manager.php?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Fclasses%2FControllers%2Fclass-alert-manager.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/classes/Controllers/class-alert-manager.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/classes/Controllers/class-alert-manager.php?rev=2897171#L412 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/classes/Controllers/class-alert-manager.php?rev=2911237#L412 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 412 | 412 | public static function is\_disabled\_user( $user ) { |
  | 413 | 413 | if ( empty( self::$excluded\_users ) ) { |
  | 414 |  | self::$excluded\_users = Settings\_Helper::get\_option\_value( 'excluded-users', array() ); |
  | 415 |  | } |
  | 416 |  |  |
  | 417 |  | if ( ! \is\_array( self::$excluded\_users ) ) { |
  | 418 |  | self::$excluded\_users = array( self::$excluded\_users ); |
  |  | 414 | self::$excluded\_users = Settings\_Helper::get\_excluded\_monitoring\_users(); |
  | 419 | 415 | } |
  | 420 | 416 |  |
  | […](/browser/wp-security-audit-log/trunk/classes/Controllers/class-alert-manager.php?rev=2897171#L435) | […](/browser/wp-security-audit-log/trunk/classes/Controllers/class-alert-manager.php?rev=2911237#L431) |  |
  | 435 | 431 |  |
  | 436 | 432 | if ( empty( self::$excluded\_roles ) ) { |
  | 437 |  | self::$excluded\_roles = Settings\_Helper::get\_~~option\_value( 'excluded-roles', array()~~ ); |
  |  | 433 | self::$excluded\_roles = Settings\_Helper::get\_excluded\_monitoring\_roles(); |
  | 438 | 434 | } |
  | 439 | 435 |  |
* ## [wp-security-audit-log/trunk/classes/Controllers/class-sensors-load-manager.php](/changeset/2911237/wp-security-audit-log/trunk/classes/Controllers/class-sensors-load-manager.php?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Fclasses%2FControllers%2Fclass-sensors-load-manager.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/classes/Controllers/class-sensors-load-manager.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/classes/Controllers/class-sensors-load-manager.php?rev=2897171#L15 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/classes/Controllers/class-sensors-load-manager.php?rev=2911237#L15 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 15 | 15 | namespace WSAL\Controllers; |
  | 16 | 16 |  |
  |  | 17 | use WSAL\Helpers\WP\_Helper; |
  | 17 | 18 | use WSAL\Helpers\Classes\_Helper; |
  | 18 | 19 |  |
  | […](/browser/wp-security-audit-log/trunk/classes/Controllers/class-sensors-load-manager.php?rev=2897171#L90) | […](/browser/wp-security-audit-log/trunk/classes/Controllers/class-sensors-load-manager.php?rev=2911237#L91) |  |
  | 90 | 91 | } |
  | 91 | 92 |  |
  | 92 |  | if ( ~~\WpSecurityAuditLog~~::is\_login\_screen() && ! is\_user\_logged\_in() ) { |
  |  | 93 | if ( WP\_Helper::is\_login\_screen() && ! is\_user\_logged\_in() ) { |
  | 93 | 94 | // Here we need to load only the Sensors which are login enabled. |
  | 94 | 95 | foreach ( $sensors as $key => &$sensor ) { |
* ## [wp-security-audit-log/trunk/classes/Entities/class-metadata-entity.php](/changeset/2911237/wp-security-audit-log/trunk/classes/Entities/class-metadata-entity.php?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Fclasses%2FEntities%2Fclass-metadata-entity.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/classes/Entities/class-metadata-entity.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/classes/Entities/class-metadata-entity.php?rev=2897171#L57 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/classes/Entities/class-metadata-entity.php?rev=2911237#L57 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 57 | 57 | `value` longtext NOT NULL, |
  | 58 | 58 | PRIMARY KEY (`id`), |
  | 59 |  | KEY `occurrence\_name` (`occurrence\_id`,`name`) |
  |  | 59 | KEY `occurrence\_name` (`occurrence\_id`,`name`), |
  |  | 60 | KEY `name\_value` (`name`,`value`(64)) |
  | 60 | 61 | ) |
  | 61 | 62 | ' . self::get\_connection()->get\_charset\_collate() . ';'; |
  | […](/browser/wp-security-audit-log/trunk/classes/Entities/class-metadata-entity.php?rev=2897171#L63) | […](/browser/wp-security-audit-log/trunk/classes/Entities/class-metadata-entity.php?rev=2911237#L64) |  |
  | 63 | 64 | return self::maybe\_create\_table( $table\_name, $wp\_entity\_sql ); |
  | 64 | 65 | } |
  |  | 66 |  |
  |  | 67 | /\*\* |
  |  | 68 | \* Sets an index (if not there already) |
  |  | 69 | \* |
  |  | 70 | \* @return void |
  |  | 71 | \* |
  |  | 72 | \* @since 4.5.1 |
  |  | 73 | \*/ |
  |  | 74 | public static function create\_indexes() { |
  |  | 75 | $db\_connection = self::get\_connection(); |
  |  | 76 | // check if an index exists. |
  |  | 77 | $index\_exists = false; |
  |  | 78 | if ( $db\_connection->query( 'SELECT COUNT(1) IndexIsThere FROM INFORMATION\_SCHEMA.STATISTICS WHERE table\_schema=DATABASE() AND table\_name="' . self::get\_table\_name() . '" AND index\_name="name\_value"' ) ) { |
  |  | 79 | // query succeeded, does index exist? |
  |  | 80 | $index\_exists = ( isset( $db\_connection->last\_result[0]->IndexIsThere ) ) ? $db\_connection->last\_result[0]->IndexIsThere : false; |
  |  | 81 | } |
  |  | 82 | // if no index exists then make one. |
  |  | 83 | if ( ! $index\_exists ) { |
  |  | 84 | $db\_connection->query( 'CREATE INDEX name\_value ON ' . self::get\_table\_name() . ' (name, value(64))' ); |
  |  | 85 | } |
  |  | 86 | } |
  | 65 | 87 | } |
  | 66 | 88 | } |
* ## [wp-security-audit-log/trunk/classes/Entities/class-occurrences-entity.php](/changeset/2911237/wp-security-audit-log/trunk/classes/Entities/class-occurrences-entity.php?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Fclasses%2FEntities%2Fclass-occurrences-entity.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/classes/Entities/class-occurrences-entity.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/classes/Entities/class-occurrences-entity.php?rev=2897171#L225 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/classes/Entities/class-occurrences-entity.php?rev=2911237#L225 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 225 | 225 | $sqls = 'INSERT INTO `' . Metadata\_Entity::get\_table\_name() . "` ($fields) VALUES " . rtrim( $sqls, ',' ); |
  | 226 | 226 |  |
  |  | 227 | self::get\_connection()->suppress\_errors( true ); |
  | 227 | 228 | self::get\_connection()->query( $sqls ); |
  |  | 229 |  |
  |  | 230 | if ( '' !== self::get\_connection()->last\_error ) { |
  |  | 231 | if ( 1146 === Metadata\_Entity::get\_last\_sql\_error( self::get\_connection() ) ) { |
  |  | 232 | if ( Metadata\_Entity::create\_table() ) { |
  |  | 233 | self::get\_connection()->query( $sqls ); |
  |  | 234 | } |
  |  | 235 | } |
  |  | 236 | } |
  |  | 237 | self::get\_connection()->suppress\_errors( false ); |
  | 228 | 238 | } |
  | 229 | 239 | } |
  | 230 | 240 | } |
  | 231 | 241 | } |
  |  | 242 |  |
  |  | 243 | /\*\* |
  |  | 244 | \* Sets an index (if not there already) |
  |  | 245 | \* |
  |  | 246 | \* @return void |
  |  | 247 | \* |
  |  | 248 | \* @since 4.5.1 |
  |  | 249 | \*/ |
  |  | 250 | public static function create\_indexes() { |
  |  | 251 | $index\_exists  = false; |
  |  | 252 | $db\_connection = self::get\_connection(); |
  |  | 253 | // check if an index exists. |
  |  | 254 | if ( $db\_connection->query( 'SELECT COUNT(1) IndexIsThere FROM INFORMATION\_SCHEMA.STATISTICS WHERE table\_schema=DATABASE() AND table\_name="' . self::get\_table\_name() . '" AND index\_name="created\_on"' ) ) { |
  |  | 255 | // query succeeded, does index exist? |
  |  | 256 | $index\_exists = ( isset( $db\_connection->last\_result[0]->IndexIsThere ) ) ? $db\_connection->last\_result[0]->IndexIsThere : false; |
  |  | 257 | } |
  |  | 258 | // if no index exists then make one. |
  |  | 259 | if ( ! $index\_exists ) { |
  |  | 260 | $db\_connection->query( 'CREATE INDEX created\_on ON ' . self::get\_table\_name() . ' (created\_on)' ); |
  |  | 261 | } |
  |  | 262 | } |
  | 232 | 263 | } |
  | 233 | 264 | } |
* ## [wp-security-audit-log/trunk/classes/Helpers/class-plugins-helper.php](/changeset/2911237/wp-security-audit-log/trunk/classes/Helpers/class-plugins-helper.php?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Fclasses%2FHelpers%2Fclass-plugins-helper.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/classes/Helpers/class-plugins-helper.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/classes/Helpers/class-plugins-helper.php?rev=2897171#L8 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/classes/Helpers/class-plugins-helper.php?rev=2911237#L8 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 | \* @since 4.5.0 |
  | 9 | 9 | \* |
  | 10 |  | \* @copyright  ~~%%YEAR%%~~ WP White Security |
  |  | 10 | \* @copyright  2023 WP White Security |
  | 11 | 11 | \* @license    https://www.apache.org/licenses/LICENSE-2.0 Apache License 2.0 |
  | 12 | 12 | \* |
* ## [wp-security-audit-log/trunk/classes/Helpers/class-settings-helper.php](/changeset/2911237/wp-security-audit-log/trunk/classes/Helpers/class-settings-helper.php?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Fclasses%2FHelpers%2Fclass-settings-helper.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/classes/Helpers/class-settings-helper.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/classes/Helpers/class-settings-helper.php?rev=2897171#L81 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/classes/Helpers/class-settings-helper.php?rev=2911237#L81 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 81 | 81 |  |
  | 82 | 82 | /\*\* |
  |  | 83 | \* Users excluded from monitoring. |
  |  | 84 | \* |
  |  | 85 | \* @var array |
  |  | 86 | \* |
  |  | 87 | \* @since 4.5.0 |
  |  | 88 | \*/ |
  |  | 89 | private static $excluded\_roles = array(); |
  |  | 90 |  |
  |  | 91 | /\*\* |
  | 83 | 92 | \* Holds the main IP of the client. |
  | 84 | 93 | \* |
  | […](/browser/wp-security-audit-log/trunk/classes/Helpers/class-settings-helper.php?rev=2897171#L124) | […](/browser/wp-security-audit-log/trunk/classes/Helpers/class-settings-helper.php?rev=2911237#L133) |  |
  | 124 | 133 | \*/ |
  | 125 | 134 | private static $database\_logging\_enabled = null; |
  |  | 135 |  |
  |  | 136 | /\*\* |
  |  | 137 | \* Is the database logging enabled or not. |
  |  | 138 | \* |
  |  | 139 | \* @var bool |
  |  | 140 | \* |
  |  | 141 | \* @since 4.5.1 |
  |  | 142 | \*/ |
  |  | 143 | private static $frontend\_events = null; |
  | 126 | 144 |  |
  | 127 | 145 | /\*\* |
  | […](/browser/wp-security-audit-log/trunk/classes/Helpers/class-settings-helper.php?rev=2897171#L364) | […](/browser/wp-security-audit-log/trunk/classes/Helpers/class-settings-helper.php?rev=2911237#L382) |  |
  | 364 | 382 | \*/ |
  | 365 | 383 | public static function get\_all\_mirrors() { |
  | 366 |  | $mirrors\_options = self::get\_options\_by\_prefix( WSAL\_MIRROR\_PREFIX, true ); |
  |  | 384 | $mirrors\_options = self::get\_options\_by\_prefix( \WSAL\_MIRROR\_PREFIX, true ); |
  | 367 | 385 |  |
  | 368 | 386 | $mirrors = array(); |
  | […](/browser/wp-security-audit-log/trunk/classes/Helpers/class-settings-helper.php?rev=2897171#L499) | […](/browser/wp-security-audit-log/trunk/classes/Helpers/class-settings-helper.php?rev=2911237#L517) |  |
  | 499 | 517 | if ( self::get\_boolean\_option\_value( 'use-proxy-ip' ) ) { |
  | 500 | 518 | // TODO: The algorithm below just gets the first IP in the list...we might want to make this more intelligent somehow. |
  | 501 |  | self::$main\_client\_ip = isset( self::get\_client\_ips()[0] ) ? self::get\_client\_ips()[0] : null; |
  |  | 519 | $ips                  = self::get\_client\_ips(); |
  |  | 520 | $ips                  = reset( $ips ); |
  |  | 521 | self::$main\_client\_ip = isset( $ips[0] ) ? $ips[0] : ''; |
  | 502 | 522 | } elseif ( isset( $\_SERVER['REMOTE\_ADDR'] ) ) { |
  | 503 | 523 | $ip                   = sanitize\_text\_field( wp\_unslash( $\_SERVER['REMOTE\_ADDR'] ) ); |
  | […](/browser/wp-security-audit-log/trunk/classes/Helpers/class-settings-helper.php?rev=2897171#L964) | […](/browser/wp-security-audit-log/trunk/classes/Helpers/class-settings-helper.php?rev=2911237#L984) |  |
  | 964 | 984 | public static function get\_excluded\_monitoring\_users() { |
  | 965 | 985 | if ( empty( self::$excluded\_users ) ) { |
  | 966 |  | self::$excluded\_users = ~~array\_unique( array\_filter( explode( ',', self::get\_option\_value( 'excluded-users', '' ) )~~ ) ); |
  |  | 986 | self::$excluded\_users = self::get\_option\_value( 'excluded-users', array() ); |
  | 967 | 987 | } |
  | 968 | 988 |  |
  | […](/browser/wp-security-audit-log/trunk/classes/Helpers/class-settings-helper.php?rev=2897171#L979) | […](/browser/wp-security-audit-log/trunk/classes/Helpers/class-settings-helper.php?rev=2911237#L999) |  |
  | 979 | 999 | public static function set\_excluded\_monitoring\_users( $users ) { |
  | 980 | 1000 | $old\_value = self::get\_option\_value( 'excluded-users', array() ); |
  | 981 |  | $changes   = self::determine\_added\_and\_removed\_items( $old\_value, ~~implode( ',', $users )~~ ); |
  |  | 1001 | $changes   = self::determine\_added\_and\_removed\_items( $old\_value, $users ); |
  | 982 | 1002 |  |
  | 983 | 1003 | if ( ! empty( $changes['added'] ) ) { |
  | […](/browser/wp-security-audit-log/trunk/classes/Helpers/class-settings-helper.php?rev=2897171#L1007) | […](/browser/wp-security-audit-log/trunk/classes/Helpers/class-settings-helper.php?rev=2911237#L1027) |  |
  | 1007 | 1027 |  |
  | 1008 | 1028 | self::$excluded\_users = $users; |
  | 1009 |  | self::set\_option\_value( 'excluded-users', esc\_html( implode( ',', self::$excluded\_users ) ) ); |
  |  | 1029 | self::set\_option\_value( 'excluded-users', array\_unique( array\_filter( $users ) ) ); |
  |  | 1030 | } |
  |  | 1031 |  |
  |  | 1032 | /\*\* |
  |  | 1033 | \* Set roles excluded from monitoring. |
  |  | 1034 | \* |
  |  | 1035 | \* @param array $roles - Array of roles. |
  |  | 1036 | \*/ |
  |  | 1037 | public static function set\_excluded\_monitoring\_roles( $roles ) { |
  |  | 1038 | // Trigger alert. |
  |  | 1039 | $old\_value = self::get\_option\_value( 'excluded-roles', array() ); |
  |  | 1040 | $changes   = self::determine\_added\_and\_removed\_items( $old\_value, $roles ); |
  |  | 1041 |  |
  |  | 1042 | if ( ! empty( $changes['added'] ) ) { |
  |  | 1043 | foreach ( $changes['added'] as $user ) { |
  |  | 1044 | Alert\_Manager::trigger\_event( |
  |  | 1045 | 6054, |
  |  | 1046 | array( |
  |  | 1047 | 'role'           => $user, |
  |  | 1048 | 'previous\_users' => ( empty( $old\_value ) ) ? self::tidy\_blank\_values( $old\_value ) : str\_replace( ',', ', ', $old\_value ), |
  |  | 1049 | 'EventType'      => 'added', |
  |  | 1050 | ) |
  |  | 1051 | ); |
  |  | 1052 | } |
  |  | 1053 | } |
  |  | 1054 | if ( ! empty( $changes['removed'] ) && ! empty( $old\_value ) ) { |
  |  | 1055 | foreach ( $changes['removed'] as $user ) { |
  |  | 1056 | Alert\_Manager::trigger\_event( |
  |  | 1057 | 6054, |
  |  | 1058 | array( |
  |  | 1059 | 'role'           => $user, |
  |  | 1060 | 'previous\_users' => empty( $old\_value ) ? self::tidy\_blank\_values( $old\_value ) : str\_replace( ',', ', ', $old\_value ), |
  |  | 1061 | 'EventType'      => 'removed', |
  |  | 1062 | ) |
  |  | 1063 | ); |
  |  | 1064 | } |
  |  | 1065 | } |
  |  | 1066 |  |
  |  | 1067 | self::$excluded\_roles = $roles; |
  |  | 1068 | self::set\_option\_value( 'excluded-roles', array\_unique( array\_filter( $roles ) ) ); |
  |  | 1069 | } |
  |  | 1070 |  |
  |  | 1071 | /\*\* |
  |  | 1072 | \* Get roles excluded from monitoring. |
  |  | 1073 | \*/ |
  |  | 1074 | public static function get\_excluded\_monitoring\_roles() { |
  |  | 1075 | if ( empty( self::$excluded\_roles ) ) { |
  |  | 1076 | self::$excluded\_roles = self::get\_option\_value( 'excluded-roles', array() ); |
  |  | 1077 | } |
  |  | 1078 |  |
  |  | 1079 | return self::$excluded\_roles; |
  | 1010 | 1080 | } |
  | 1011 | 1081 |  |
  | […](/browser/wp-security-audit-log/trunk/classes/Helpers/class-settings-helper.php?rev=2897171#L1126) | […](/browser/wp-security-audit-log/trunk/classes/Helpers/class-settings-helper.php?rev=2911237#L1196) |  |
  | 1126 | 1196 |  |
  | 1127 | 1197 | // Work out the working directory base path. |
  | 1128 |  | if ( defined( 'WSAL\_WORKING\_DIR\_PATH' ) ) { |
  | 1129 |  | $result = trailingslashit( WSAL\_WORKING\_DIR\_PATH ); |
  |  | 1198 | if ( defined( '\WSAL\_WORKING\_DIR\_PATH' ) ) { |
  |  | 1199 | $result = trailingslashit( \WSAL\_WORKING\_DIR\_PATH ); |
  | 1130 | 1200 | } else { |
  | 1131 | 1201 | $upload\_dir = wp\_upload\_dir( null, false ); |
  | […](/browser/wp-security-audit-log/trunk/classes/Helpers/class-settings-helper.php?rev=2897171#L1187) | […](/browser/wp-security-audit-log/trunk/classes/Helpers/class-settings-helper.php?rev=2911237#L1257) |  |
  | 1187 | 1257 | \*/ |
  | 1188 | 1258 | public static function get\_frontend\_events() { |
  | 1189 |  | // Option defaults. |
  | 1190 |  | $default = array( |
  | 1191 |  | 'register'    => false, |
  | 1192 |  | 'login'       => false, |
  | 1193 |  | 'woocommerce' => false, |
  | 1194 |  | ); |
  |  | 1259 | if ( null === self::$frontend\_events ) { |
  |  | 1260 | // Option defaults. |
  |  | 1261 | $default               = array( |
  |  | 1262 | 'register'    => false, |
  |  | 1263 | 'login'       => false, |
  |  | 1264 | 'woocommerce' => false, |
  |  | 1265 | ); |
  |  | 1266 | self::$frontend\_events = self::get\_option\_value( self::FRONT\_END\_EVENTS\_OPTION\_NAME, $default ); |
  |  | 1267 | } |
  | 1195 | 1268 |  |
  | 1196 | 1269 | // Get the option. |
  | 1197 |  | return self::~~get\_option\_value( self::FRONT\_END\_EVENTS\_OPTION\_NAME, $default )~~; |
  |  | 1270 | return self::$frontend\_events; |
  | 1198 | 1271 | } |
  | 1199 | 1272 |  |
  | […](/browser/wp-security-audit-log/trunk/classes/Helpers/class-settings-helper.php?rev=2897171#L1208) | […](/browser/wp-security-audit-log/trunk/classes/Helpers/class-settings-helper.php?rev=2911237#L1281) |  |
  | 1208 | 1281 | \*/ |
  | 1209 | 1282 | public static function set\_frontend\_events( $value = array() ) { |
  |  | 1283 | self::$frontend\_events = $value; |
  | 1210 | 1284 | return self::set\_option\_value( self::FRONT\_END\_EVENTS\_OPTION\_NAME, $value, true ); |
  | 1211 | 1285 | } |
* ## [wp-security-audit-log/trunk/classes/Helpers/class-wp-helper.php](/changeset/2911237/wp-security-audit-log/trunk/classes/Helpers/class-wp-helper.php?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Fclasses%2FHelpers%2Fclass-wp-helper.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/classes/Helpers/class-wp-helper.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/classes/Helpers/class-wp-helper.php?rev=2897171#L552 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/classes/Helpers/class-wp-helper.php?rev=2911237#L552 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 552 | 552 | \*/ |
  | 553 | 553 | public static function is\_login\_screen(): bool { |
  | 554 |  | if ( isset( $\_SERVER['PHP\_SELF'] ) && 'wp-login.php' === basename( \sanitize\_text\_field( \wp\_unslash( $\_SERVER['PHP\_SELF'] ) ) ) ) { |
  | 555 |  | return true; |
  | 556 |  | } |
  | 557 |  |  |
  | 558 |  | return false; |
  |  | 554 |  |
  |  | 555 | $login =  parse\_url( site\_url( 'wp-login.php' ), PHP\_URL\_PATH ) === parse\_url( $\_SERVER['REQUEST\_URI'], PHP\_URL\_PATH ); // phpcs:ignore |
  |  | 556 |  |
  |  | 557 | return \apply\_filters( 'wsal\_login\_screen\_url', $login ); |
  | 559 | 558 | } |
  | 560 | 559 |  |
* ## [wp-security-audit-log/trunk/classes/Migration/class-migration.php](/changeset/2911237/wp-security-audit-log/trunk/classes/Migration/class-migration.php?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Fclasses%2FMigration%2Fclass-migration.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/classes/Migration/class-migration.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/classes/Migration/class-migration.php?rev=2897171#L14 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/classes/Migration/class-migration.php?rev=2911237#L14 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 14 | 14 | defined( 'ABSPATH' ) || exit; // Exit if accessed directly. |
  | 15 | 15 |  |
  | 16 |  | ~~use \WSAL\Helpers\WP\_Helper;~~ |
  | 17 | 16 | use WSAL\_Settings; |
  | 18 | 17 | use WSAL\_Ext\_MirrorLogger; |
  |  | 18 | use \WSAL\Helpers\WP\_Helper; |
  |  | 19 | use WSAL\Helpers\Settings\_Helper; |
  | 19 | 20 |  |
  | 20 | 21 | /\*\* |
  | […](/browser/wp-security-audit-log/trunk/classes/Migration/class-migration.php?rev=2897171#L84) | […](/browser/wp-security-audit-log/trunk/classes/Migration/class-migration.php?rev=2911237#L85) |  |
  | 84 | 85 | $wsal::load\_freemius(); |
  | 85 | 86 | $wsal::load\_defaults(); |
  | 86 |  |  |
  | 87 |  | ~~// Load dependencies.~~ |
  | 88 |  | ~~// if ( ! isset( $wsal->alerts ) ) {~~ |
  | 89 |  | ~~//  $wsal->alerts = new \WSAL\_AlertManager( $wsal );~~ |
  | 90 |  | ~~// }~~ |
  | 91 |  |  |
  | 92 |  | ~~// if ( ! isset( $wsal->constants ) ) {~~ |
  | 93 |  | ~~//  $wsal->constants = new \WSAL\_ConstantManager();~~ |
  | 94 |  | ~~// }~~ |
  | 95 |  |  |
  | 96 |  | ~~// $wsal->sensors = new \WSAL\_SensorManager( $wsal );~~ |
  | 97 | 87 |  |
  | 98 | 88 | $disabled\_alerts = WP\_Helper::get\_global\_option( 'disabled-alerts', false ); |
  | […](/browser/wp-security-audit-log/trunk/classes/Migration/class-migration.php?rev=2897171#L123) | […](/browser/wp-security-audit-log/trunk/classes/Migration/class-migration.php?rev=2911237#L113) |  |
  | 123 | 113 | \* @since 3.2.3.3 |
  | 124 | 114 | \*/ |
  | 125 |  | if ( ! ~~\WSAL\Helpers\~~Settings\_Helper::get\_boolean\_option\_value( 'mwp-child-stealth-mode', false ) ) { |
  |  | 115 | if ( ! Settings\_Helper::get\_boolean\_option\_value( 'mwp-child-stealth-mode', false ) ) { |
  | 126 | 116 | $wsal->settings()->set\_mainwp\_child\_stealth\_mode(); |
  | 127 | 117 | } |
  | […](/browser/wp-security-audit-log/trunk/classes/Migration/class-migration.php?rev=2897171#L139) | […](/browser/wp-security-audit-log/trunk/classes/Migration/class-migration.php?rev=2911237#L129) |  |
  | 139 | 129 |  |
  | 140 | 130 | // Remove 'system' entry from the front-end events array as it was removed along with 404 tracking. |
  | 141 |  | $frontend\_events = ~~\WSAL\Helpers\~~Settings\_Helper::get\_frontend\_events(); |
  |  | 131 | $frontend\_events = Settings\_Helper::get\_frontend\_events(); |
  | 142 | 132 | if ( array\_key\_exists( 'system', $frontend\_events ) ) { |
  | 143 | 133 | unset( $frontend\_events['system'] ); |
  | 144 |  | ~~\WSAL\Helpers\~~Settings\_Helper::set\_frontend\_events( $frontend\_events ); |
  |  | 134 | Settings\_Helper::set\_frontend\_events( $frontend\_events ); |
  | 145 | 135 | } |
  | 146 | 136 |  |
  | […](/browser/wp-security-audit-log/trunk/classes/Migration/class-migration.php?rev=2897171#L177) | […](/browser/wp-security-audit-log/trunk/classes/Migration/class-migration.php?rev=2911237#L167) |  |
  | 177 | 167 | $scheduled\_hook\_mirroring = 'wsal\_run\_mirroring'; |
  | 178 | 168 |  |
  | 179 |  | $mirrors = ~~\WSAL\Helpers\~~Settings\_Helper::get\_all\_mirrors(); |
  |  | 169 | $mirrors = Settings\_Helper::get\_all\_mirrors(); |
  | 180 | 170 | if ( ! empty( $mirrors ) ) { |
  | 181 | 171 | foreach ( $mirrors as $mirror ) { |
  | […](/browser/wp-security-audit-log/trunk/classes/Migration/class-migration.php?rev=2897171#L243) | […](/browser/wp-security-audit-log/trunk/classes/Migration/class-migration.php?rev=2911237#L233) |  |
  | 243 | 233 |  |
  | 244 | 234 | if ( ! is\_null( $wsal->external\_db\_util ) ) { |
  | 245 |  | $connections = ~~\WSAL\Helpers\~~Settings\_Helper::get\_all\_connections(); |
  |  | 235 | $connections = Settings\_Helper::get\_all\_connections(); |
  | 246 | 236 | if ( ! empty( $connections ) ) { |
  | 247 | 237 | foreach ( $connections as $connection ) { |
  | 248 | 238 | if ( \WSAL\Extensions\ExternalDB\Mirrors\WSAL\_Ext\_Mirrors\_AWSCloudWatchConnection::get\_type() === $connection['type'] ) { |
  | 249 |  | ~~\WSAL\Helpers\~~Settings\_Helper::set\_boolean\_option\_value( 'show-aws-sdk-config-nudge-4\_3\_2', true ); |
  |  | 239 | Settings\_Helper::set\_boolean\_option\_value( 'show-aws-sdk-config-nudge-4\_3\_2', true ); |
  | 250 | 240 | break; |
  | 251 | 241 | } |
  | […](/browser/wp-security-audit-log/trunk/classes/Migration/class-migration.php?rev=2897171#L408) | […](/browser/wp-security-audit-log/trunk/classes/Migration/class-migration.php?rev=2911237#L398) |  |
  | 408 | 398 | $mirrors\_in\_use = false; |
  | 409 | 399 | if ( ! is\_null( $wsal->external\_db\_util ) ) { |
  | 410 |  | $mirrors        = ~~\WSAL\Helpers\~~Settings\_Helper::get\_all\_mirrors(); |
  |  | 400 | $mirrors        = Settings\_Helper::get\_all\_mirrors(); |
  | 411 | 401 | $mirrors\_in\_use = ! empty( $mirrors ); |
  | 412 | 402 | } |
  | […](/browser/wp-security-audit-log/trunk/classes/Migration/class-migration.php?rev=2897171#L427) | […](/browser/wp-security-audit-log/trunk/classes/Migration/class-migration.php?rev=2911237#L417) |  |
  | 427 | 417 |  |
  | 428 | 418 | if ( $notifications\_in\_use || $mirrors\_in\_use ) { |
  | 429 |  | ~~\WSAL\Helpers\~~Settings\_Helper::set\_boolean\_option\_value( 'show-helper-plugin-needed-nudge', true, false ); |
  |  | 419 | Settings\_Helper::set\_boolean\_option\_value( 'show-helper-plugin-needed-nudge', true, false ); |
  | 430 | 420 | } |
  | 431 | 421 | } |
  | […](/browser/wp-security-audit-log/trunk/classes/Migration/class-migration.php?rev=2897171#L495) | […](/browser/wp-security-audit-log/trunk/classes/Migration/class-migration.php?rev=2911237#L485) |  |
  | 495 | 485 |  |
  | 496 | 486 | \WSAL\Entities\Occurrences\_Entity::set\_connection( |
  | 497 |  | ( new \WSAL\_Connector\_MySQLDB( $connection\_config ) )->get\_connection() |
  | 498 |  | ); |
  |  | 487 | ( new \WSAL\_Connector\_MySQLDB( $connection\_config ) )->get\_connection() |
  |  | 488 | ); |
  | 499 | 489 |  |
  | 500 | 490 | // If one of the new columns exists there is no need to alter the table. |
  | 501 | 491 | $column\_exists = \WSAL\Entities\Occurrences\_Entity::check\_column( |
  | 502 |  | \WSAL\Entities\Occurrences\_Entity::get\_table\_name(), |
  | 503 |  | 'client\_ip', |
  | 504 |  | 'varchar( 255 )' |
  |  | 492 | \WSAL\Entities\Occurrences\_Entity::get\_table\_name(), |
  |  | 493 | 'client\_ip', |
  |  | 494 | 'varchar( 255 )' |
  | 505 | 495 | ); |
  | 506 | 496 | if ( ! $column\_exists ) { |
  | […](/browser/wp-security-audit-log/trunk/classes/Migration/class-migration.php?rev=2897171#L573) | […](/browser/wp-security-audit-log/trunk/classes/Migration/class-migration.php?rev=2911237#L563) |  |
  | 573 | 563 | } |
  | 574 | 564 | } |
  |  | 565 |  |
  | 575 | 566 | /\*\* |
  | 576 | 567 | \* Migration for version upto 4.4.3 |
  | […](/browser/wp-security-audit-log/trunk/classes/Migration/class-migration.php?rev=2897171#L585) | […](/browser/wp-security-audit-log/trunk/classes/Migration/class-migration.php?rev=2911237#L576) |  |
  | 585 | 576 | if ( class\_exists( 'WSAL\_Ext\_MirrorLogger' ) && method\_exists( '\WSAL\Helpers\Settings\_Helper', 'get\_working\_dir\_path\_static' ) ) { |
  | 586 | 577 |  |
  | 587 |  | $working\_dir\_path = ~~\WSAL\Helpers\~~Settings\_Helper::get\_working\_dir\_path\_static(); |
  |  | 578 | $working\_dir\_path = Settings\_Helper::get\_working\_dir\_path\_static(); |
  | 588 | 579 |  |
  | 589 | 580 | if ( file\_exists( $working\_dir\_path . WSAL\_Ext\_MirrorLogger::FILE\_NAME\_FAILED\_LOGS . '.json' ) ) { |
  | […](/browser/wp-security-audit-log/trunk/classes/Migration/class-migration.php?rev=2897171#L599) | […](/browser/wp-security-audit-log/trunk/classes/Migration/class-migration.php?rev=2911237#L590) |  |
  | 599 | 590 | } |
  | 600 | 591 | } |
  |  | 592 |  |
  |  | 593 | /\*\* |
  |  | 594 | \* Migration for version upto 4.5.0 |
  |  | 595 | \* |
  |  | 596 | \* Note: The migration methods need to be in line with the @see WSAL\Utils\Abstract\_Migration::$pad\_length |
  |  | 597 | \* |
  |  | 598 | \* @return void |
  |  | 599 | \*/ |
  |  | 600 | protected static function migrate\_up\_to\_4450() { |
  |  | 601 | \WSAL\Entities\Metadata\_Entity::create\_indexes(); |
  |  | 602 | \WSAL\Entities\Occurrences\_Entity::create\_indexes(); |
  |  | 603 | } |
  |  | 604 |  |
  |  | 605 | /\*\* |
  |  | 606 | \* Migration for version upto 4.5.2 |
  |  | 607 | \* |
  |  | 608 | \* Converts excluded users to array |
  |  | 609 | \* |
  |  | 610 | \* Note: The migration methods need to be in line with the @see WSAL\Utils\Abstract\_Migration::$pad\_length |
  |  | 611 | \* |
  |  | 612 | \* @return void |
  |  | 613 | \*/ |
  |  | 614 | protected static function migrate\_up\_to\_4520() { |
  |  | 615 | $excluded\_users = Settings\_Helper::get\_option\_value( 'excluded-users', array() ); |
  |  | 616 | if ( is\_string( $excluded\_users ) ) { |
  |  | 617 | $excluded\_users = array\_unique( array\_filter( explode( ',', $excluded\_users ) ) ); |
  |  | 618 | Settings\_Helper::set\_option\_value( 'excluded-users', $excluded\_users ); |
  |  | 619 | } |
  |  | 620 | $excluded\_roles = Settings\_Helper::get\_option\_value( 'excluded-roles', array() ); |
  |  | 621 | if ( is\_string( $excluded\_roles ) ) { |
  |  | 622 | $excluded\_roles = array\_unique( array\_filter( explode( ',', $excluded\_roles ) ) ); |
  |  | 623 | Settings\_Helper::set\_option\_value( 'excluded-roles', $excluded\_roles ); |
  |  | 624 | } |
  |  | 625 | } |
  | 601 | 626 | } |
  | 602 | 627 | } |
* ## [wp-security-audit-log/trunk/classes/Ref.php](/changeset/2911237/wp-security-audit-log/trunk/classes/Ref.php?old=2749058&old_path=wp-security-audit-log%2Ftrunk%2Fclasses%2FRef.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/classes/Ref.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/classes/Ref.php?rev=2749058#L1389 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/classes/Ref.php?rev=2911237#L1389 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 1389 | 1389 | } |
  | 1390 | 1390 |  |
  | 1391 |  | $max = max( array\_map( ~~'static~~::strLen', array\_keys( $subject ) ) ); |
  |  | 1391 | $max = max( array\_map( self::class . '::strLen', array\_keys( $subject ) ) ); |
  | 1392 | 1392 | $subject[ static::MARKER\_KEY ] = true; |
  | 1393 | 1393 |  |
  | […](/browser/wp-security-audit-log/trunk/classes/Ref.php?rev=2749058#L1529) | […](/browser/wp-security-audit-log/trunk/classes/Ref.php?rev=2911237#L1529) |  |
  | 1529 | 1529 | } |
  | 1530 | 1530 |  |
  | 1531 |  | $max = max( array\_map( ~~'static~~::strLen', array\_keys( $meta ) ) ); |
  |  | 1531 | $max = max( array\_map( self::class . '::strLen', array\_keys( $meta ) ) ); |
  | 1532 | 1532 | foreach ( $meta as $key => $value ) { |
  | 1533 | 1533 | $this->fmt->startRow(); |
  | […](/browser/wp-security-audit-log/trunk/classes/Ref.php?rev=2749058#L1666) | […](/browser/wp-security-audit-log/trunk/classes/Ref.php?rev=2911237#L1666) |  |
  | 1666 | 1666 | $errors = \DateTime::getLastErrors(); |
  | 1667 | 1667 |  |
  | 1668 |  | if ( (~~$errors['warning\_count'] < 1) && ($errors['error\_count']~~ < 1) ) { |
  |  | 1668 | if ( (((int)$errors['warning\_count']) < 1) && (((int)$errors['error\_count']) < 1) ) { |
  | 1669 | 1669 | $now    = new \Datetime( 'now' ); |
  | 1670 | 1670 | $nowUtc = new \Datetime( 'now', new \DateTimeZone( 'UTC' ) ); |
  | […](/browser/wp-security-audit-log/trunk/classes/Ref.php?rev=2749058#L1929) | […](/browser/wp-security-audit-log/trunk/classes/Ref.php?rev=2911237#L1929) |  |
  | 1929 | 1929 | if ( $constants ) { |
  | 1930 | 1930 | $this->fmt->sectionTitle( 'Constants' ); |
  | 1931 |  | $max = max( array\_map( ~~'static~~::strLen', array\_keys( $constants ) ) ); |
  |  | 1931 | $max = max( array\_map( self::class . '::strLen', array\_keys( $constants ) ) ); |
  | 1932 | 1932 | foreach ( $constants as $name => $value ) { |
  | 1933 | 1933 | $meta = null; |
  | […](/browser/wp-security-audit-log/trunk/classes/Ref.php?rev=2749058#L2954) | […](/browser/wp-security-audit-log/trunk/classes/Ref.php?rev=2911237#L2954) |  |
  | 2954 | 2954 | \*/ |
  | 2955 | 2955 | protected static function escape( $var ) { |
  | 2956 |  | return is\_array( $var ) ? array\_map( ~~'static~~::escape', $var ) : htmlspecialchars( $var, ENT\_QUOTES ); |
  |  | 2956 | return is\_array( $var ) ? array\_map( self::class . '::escape', $var ) : htmlspecialchars( $var, ENT\_QUOTES ); |
  | 2957 | 2957 | } |
  | 2958 | 2958 |  |
* ## [wp-security-audit-log/trunk/classes/SensorManager.php](/changeset/2911237/wp-security-audit-log/trunk/classes/SensorManager.php?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Fclasses%2FSensorManager.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/classes/SensorManager.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/classes/SensorManager.php?rev=2897171#L14 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/classes/SensorManager.php?rev=2911237#L14 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 14 | 14 | } |
  | 15 | 15 |  |
  |  | 16 | use WSAL\Helpers\WP\_Helper; |
  | 16 | 17 | use \WSAL\Helpers\Classes\_Helper; |
  | 17 | 18 | /\*\* |
  | […](/browser/wp-security-audit-log/trunk/classes/SensorManager.php?rev=2897171#L210) | […](/browser/wp-security-audit-log/trunk/classes/SensorManager.php?rev=2911237#L211) |  |
  | 210 | 211 |  |
  | 211 | 212 | // Only LogInOut and Register sensors should load on login page. |
  | 212 |  | if ( W~~pSecurityAuditLog~~::is\_login\_screen() ) { |
  |  | 213 | if ( WP\_Helper::is\_login\_screen() ) { |
  | 213 | 214 | if ( in\_array( $filename, array( 'Register', 'LogInOut' ), true ) ) { |
  | 214 | 215 | return true; |
* ## [wp-security-audit-log/trunk/classes/Settings.php](/changeset/2911237/wp-security-audit-log/trunk/classes/Settings.php?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Fclasses%2FSettings.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/classes/Settings.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/classes/Settings.php?rev=2897171#L67 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/classes/Settings.php?rev=2911237#L67 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 67 | 67 | \*/ |
  | 68 | 68 | protected $per\_page = null; |
  | 69 |  |  |
  | 70 |  | ~~/\*\*~~ |
  | 71 |  | ~~\* Roles excluded from monitoring.~~ |
  | 72 |  | ~~\*~~ |
  | 73 |  | ~~\* @var array~~ |
  | 74 |  | ~~\*/~~ |
  | 75 |  | ~~protected $excluded\_roles = array();~~ |
  | 76 | 69 |  |
  | 77 | 70 | /\*\* |
  | […](/browser/wp-security-audit-log/trunk/classes/Settings.php?rev=2897171#L708) | […](/browser/wp-security-audit-log/trunk/classes/Settings.php?rev=2911237#L701) |  |
  | 708 | 701 | $this->site\_admins = $wpdb->get\_col( $sql ); // phpcs:ignore |
  | 709 | 702 | } |
  | 710 |  | } else { |
  | 711 |  | if ( empty( $this->site\_admins ) ) { |
  |  | 703 | } elseif ( empty( $this->site\_admins ) ) { |
  | 712 | 704 | $query = 'role=administrator&fields[]=user\_login'; |
  | 713 |  | foreach ( get\_users( $query ) as $user ) { |
  | 714 |  | $this->site\_admins[] = $user->user\_login; |
  | 715 |  | } |
  |  | 705 | foreach ( get\_users( $query ) as $user ) { |
  |  | 706 | $this->site\_admins[] = $user->user\_login; |
  | 716 | 707 | } |
  | 717 | 708 | } |
  | […](/browser/wp-security-audit-log/trunk/classes/Settings.php?rev=2897171#L942) | […](/browser/wp-security-audit-log/trunk/classes/Settings.php?rev=2911237#L933) |  |
  | 942 | 933 | \* |
  | 943 | 934 | \* @return string |
  | 944 |  | \* |
  |  | 935 | \* |
  | 945 | 936 | \* @deprecated 4.5 - Use \WSAL\Helpers\Settings\_Helper::normalize\_ip() |
  | 946 | 937 | \*/ |
  | […](/browser/wp-security-audit-log/trunk/classes/Settings.php?rev=2897171#L1042) | […](/browser/wp-security-audit-log/trunk/classes/Settings.php?rev=2911237#L1033) |  |
  | 1042 | 1033 | \* @deprecated 4.5 - Use \WSAL\Helpers\Settings\_Helper::get\_excluded\_post\_types() |
  | 1043 | 1034 | \*/ |
  | 1044 |  | public function get\_excluded\_post\_types(): array { |
  |  | 1035 | public function get\_excluded\_post\_types(): array { |
  | 1045 | 1036 | \_deprecated\_function( \_\_FUNCTION\_\_, '4.5', '\WSAL\Helpers\Settings\_Helper::get\_excluded\_post\_types()' ); |
  | 1046 | 1037 |  |
  | […](/browser/wp-security-audit-log/trunk/classes/Settings.php?rev=2897171#L1052) | […](/browser/wp-security-audit-log/trunk/classes/Settings.php?rev=2911237#L1043) |  |
  | 1052 | 1043 | \* |
  | 1053 | 1044 | \* @param array $roles - Array of roles. |
  |  | 1045 | \* |
  |  | 1046 | \* @deprecated 4.5.1 - Use \WSAL\Helpers\Settings\_Helper::set\_excluded\_monitoring\_roles() |
  | 1054 | 1047 | \*/ |
  | 1055 | 1048 | public function set\_excluded\_monitoring\_roles( $roles ) { |
  | 1056 |  | // Trigger alert. |
  | 1057 |  | $old\_value = WSAL\Helpers\Settings\_Helper::get\_option\_value( 'excluded-roles', array() ); |
  | 1058 |  | $changes   = \WSAL\Helpers\Settings\_Helper::determine\_added\_and\_removed\_items( $old\_value, implode( ',', $roles ) ); |
  | 1059 |  |  |
  | 1060 |  | if ( ! empty( $changes['added'] ) ) { |
  | 1061 |  | foreach ( $changes['added'] as $user ) { |
  | 1062 |  | Alert\_Manager::trigger\_event( |
  | 1063 |  | 6054, |
  | 1064 |  | array( |
  | 1065 |  | 'role'           => $user, |
  | 1066 |  | 'previous\_users' => ( empty( $old\_value ) ) ? \WSAL\Helpers\Settings\_Helper::tidy\_blank\_values( $old\_value ) : str\_replace( ',', ', ', $old\_value ), |
  | 1067 |  | 'EventType'      => 'added', |
  | 1068 |  | ) |
  | 1069 |  | ); |
  | 1070 |  | } |
  | 1071 |  | } |
  | 1072 |  | if ( ! empty( $changes['removed'] ) && ! empty( $old\_value ) ) { |
  | 1073 |  | foreach ( $changes['removed'] as $user ) { |
  | 1074 |  | Alert\_Manager::trigger\_event( |
  | 1075 |  | 6054, |
  | 1076 |  | array( |
  | 1077 |  | 'role'           => $user, |
  | 1078 |  | 'previous\_users' => empty( $old\_value ) ? \WSAL\Helpers\Settings\_Helper::tidy\_blank\_values( $old\_value ) : str\_replace( ',', ', ', $old\_value ), |
  | 1079 |  | 'EventType'      => 'removed', |
  | 1080 |  | ) |
  | 1081 |  | ); |
  | 1082 |  | } |
  | 1083 |  | } |
  | 1084 |  |  |
  | 1085 |  | $this->excluded\_roles = $roles; |
  | 1086 |  | \WSAL\Helpers\Settings\_Helper::set\_option\_value( 'excluded-roles', esc\_html( implode( ',', $roles ) ) ); |
  |  | 1049 | \_deprecated\_function( \_\_FUNCTION\_\_, '4.5.1', '\WSAL\Helpers\Settings\_Helper::set\_excluded\_monitoring\_roles()' ); |
  |  | 1050 |  |
  |  | 1051 | return \WSAL\Helpers\Settings\_Helper::set\_excluded\_monitoring\_users( $roles ); |
  | 1087 | 1052 | } |
  | 1088 | 1053 |  |
  | 1089 | 1054 | /\*\* |
  | 1090 | 1055 | \* Get roles excluded from monitoring. |
  |  | 1056 | \* |
  |  | 1057 | \* @deprecated 4.5.1 - Use \WSAL\Helpers\Settings\_Helper::get\_excluded\_monitoring\_roles() |
  | 1091 | 1058 | \*/ |
  | 1092 | 1059 | public function get\_excluded\_monitoring\_roles() { |
  | 1093 |  | if ( empty( $this->excluded\_roles ) ) { |
  | 1094 |  | $this->excluded\_roles = array\_unique( array\_filter( explode( ',', WSAL\Helpers\Settings\_Helper::get\_option\_value( 'excluded-roles', '' ) ) ) ); |
  | 1095 |  | } |
  | 1096 |  |  |
  | 1097 |  | return $this->excluded\_roles; |
  |  | 1060 | \_deprecated\_function( \_\_FUNCTION\_\_, '4.5.1', '\WSAL\Helpers\Settings\_Helper::get\_excluded\_monitoring\_roles()' ); |
  |  | 1061 |  |
  |  | 1062 | return \WSAL\Helpers\Settings\_Helper::get\_excluded\_monitoring\_roles(); |
  | 1098 | 1063 | } |
  | 1099 | 1064 |  |
  | […](/browser/wp-security-audit-log/trunk/classes/Settings.php?rev=2897171#L1571) | […](/browser/wp-security-audit-log/trunk/classes/Settings.php?rev=2911237#L1536) |  |
  | 1571 | 1536 | // we have no business here - the token is valid and within users, but we are looking |
  | 1572 | 1537 | // for roles |
  | 1573 |  | if ( false !== $type && 'ExRole' === $type ) { |
  |  | 1538 | if ( false !== $type && 'ExRole' === $type ) { |
  | 1574 | 1539 |  |
  | 1575 | 1540 | } else { |
* ## [wp-security-audit-log/trunk/classes/Views/AuditLog.php](/changeset/2911237/wp-security-audit-log/trunk/classes/Views/AuditLog.php?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Fclasses%2FViews%2FAuditLog.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/classes/Views/AuditLog.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/classes/Views/AuditLog.php?rev=2897171#L141 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/classes/Views/AuditLog.php?rev=2911237#L141 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 141 | 141 | 'skipped' === \WSAL\Helpers\Settings\_Helper::get\_option\_value( 'freemius\_state', 'anonymous' ) ) |
  | 142 | 142 | ) { |
  | 143 |  | $wsal\_premium\_advert = \WSAL\Helpers\Settings\_Helper::get\_option\_value( 'premium-advert', false ); // Get the advert to display. |
  | 144 |  | $wsal\_premium\_advert = false !== $wsal\_premium\_advert ? (int) $wsal\_premium\_advert : 0; // Set the default. |
  |  | 143 | $wsal\_premium\_advert = \WSAL\Helpers\Settings\_Helper::get\_option\_value( 'premium-advert', false ); // Get the advert to display. |
  |  | 144 | $wsal\_premium\_advert = false !== $wsal\_premium\_advert ? (int) $wsal\_premium\_advert : 0; // Set the default. |
  | 145 | 145 |  |
  | 146 | 146 | $more\_info = add\_query\_arg( |
  | […](/browser/wp-security-audit-log/trunk/classes/Views/AuditLog.php?rev=2897171#L200) | […](/browser/wp-security-audit-log/trunk/classes/Views/AuditLog.php?rev=2911237#L200) |  |
  | 200 | 200 | } |
  | 201 | 201 |  |
  |  | 202 | // phpcs:disable |
  |  | 203 | // phpcs:enable |
  | 202 | 204 |  |
  | 203 | 205 | // Check anonymous mode. |
  | […](/browser/wp-security-audit-log/trunk/classes/Views/AuditLog.php?rev=2897171#L229) | […](/browser/wp-security-audit-log/trunk/classes/Views/AuditLog.php?rev=2911237#L231) |  |
  | 229 | 231 | $screen = get\_current\_screen(); |
  | 230 | 232 |  |
  |  | 233 | // phpcs:disable |
  |  | 234 | // phpcs:enable |
  | 231 | 235 |  |
  | 232 | 236 | if ( $is\_current\_view && in\_array( $screen->base, array( 'toplevel\_page\_wsal-auditlog', 'toplevel\_page\_wsal-auditlog-network' ), true ) ) { |
  | […](/browser/wp-security-audit-log/trunk/classes/Views/AuditLog.php?rev=2897171#L243) | […](/browser/wp-security-audit-log/trunk/classes/Views/AuditLog.php?rev=2911237#L247) |  |
  | 243 | 247 | $predefined\_plugins\_check = array\_column( $predefined\_plugins, 'addon\_for' ); |
  | 244 | 248 |  |
  |  | 249 | $plugin\_filenames = array\_unique( $plugin\_filenames ); |
  |  | 250 |  |
  | 245 | 251 | // Loop through plugins and create an array of slugs, we will compare these against the plugins we have addons for. |
  | 246 | 252 | $we\_have\_addon = array\_intersect( $plugin\_filenames, $predefined\_plugins\_check ); |
  | […](/browser/wp-security-audit-log/trunk/classes/Views/AuditLog.php?rev=2897171#L258) | […](/browser/wp-security-audit-log/trunk/classes/Views/AuditLog.php?rev=2911237#L264) |  |
  | 258 | 264 |  |
  | 259 | 265 | if ( ! $is\_dismissed ) { |
  | 260 |  | // @codingStandardsIgnoreStart |
  | 261 |  | $image\_filename     = array\_search( $addon, array\_column( $predefined\_plugins, 'addon\_for', 'image\_filename' ) ); |
  | 262 |  | $title              = array\_search( $addon, array\_column( $predefined\_plugins, 'addon\_for', 'title' ) ); |
  | 263 |  | $plugin\_description = array\_search( $addon, array\_column( $predefined\_plugins, 'addon\_for', 'plugin\_description' ) ); |
  | 264 |  | // @codingStandardsIgnoreEnd |
  |  | 266 |  |
  |  | 267 | $image\_filename     = array\_search( $addon, array\_column( $predefined\_plugins, 'addon\_for', 'image\_filename' ), true ); |
  |  | 268 | $title              = array\_search( $addon, array\_column( $predefined\_plugins, 'addon\_for', 'title' ), true ); |
  |  | 269 | $plugin\_description = array\_search( $addon, array\_column( $predefined\_plugins, 'addon\_for', 'plugin\_description' ), true ); |
  |  | 270 |  |
  | 265 | 271 | ?> |
  | 266 | 272 | <div class="notice notice-information is-dismissible notice-addon-available" id="wsal-notice-addon-available-<?php echo esc\_attr( $addon ); ?>" data-addon="<?php echo esc\_attr( $addon ); ?>"> |
  | […](/browser/wp-security-audit-log/trunk/classes/Views/AuditLog.php?rev=2897171#L615) | […](/browser/wp-security-audit-log/trunk/classes/Views/AuditLog.php?rev=2911237#L621) |  |
  | 615 | 621 | } |
  | 616 | 622 |  |
  |  | 623 | // phpcs:disable |
  |  | 624 | // phpcs:enable |
  | 617 | 625 |  |
  | 618 | 626 | $occ = new WSAL\_Models\_Occurrence(); |
  | […](/browser/wp-security-audit-log/trunk/classes/Views/AuditLog.php?rev=2897171#L654) | […](/browser/wp-security-audit-log/trunk/classes/Views/AuditLog.php?rev=2911237#L662) |  |
  | 654 | 662 | $old = (int) $post\_array['logcount']; |
  | 655 | 663 |  |
  |  | 664 | // phpcs:disable |
  |  | 665 | // phpcs:enable |
  | 656 | 666 |  |
  | 657 | 667 | // Check for new total number of alerts. |
  | […](/browser/wp-security-audit-log/trunk/classes/Views/AuditLog.php?rev=2897171#L711) | […](/browser/wp-security-audit-log/trunk/classes/Views/AuditLog.php?rev=2911237#L721) |  |
  | 711 | 721 | } |
  | 712 | 722 |  |
  |  | 723 | // phpcs:disable |
  |  | 724 | // phpcs:enable |
  | 713 | 725 |  |
  | 714 | 726 | /\*\* |
  | […](/browser/wp-security-audit-log/trunk/classes/Views/AuditLog.php?rev=2897171#L1121) | […](/browser/wp-security-audit-log/trunk/classes/Views/AuditLog.php?rev=2911237#L1133) |  |
  | 1121 | 1133 | } |
  | 1122 | 1134 |  |
  |  | 1135 | // phpcs:disable |
  |  | 1136 | // phpcs:enable |
  | 1123 | 1137 |  |
  | 1124 | 1138 | /\*\* |
* ## [wp-security-audit-log/trunk/classes/Views/Settings.php](/changeset/2911237/wp-security-audit-log/trunk/classes/Views/Settings.php?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Fclasses%2FViews%2FSettings.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/classes/Views/Settings.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/classes/Views/Settings.php?rev=2897171#L155 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/classes/Views/Settings.php?rev=2911237#L155 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 155 | 155 |  |
  | 156 | 156 | // Get the current tab. |
  | 157 |  | $current\_tab       =( isset( $\_GET['tab'] ) ) ? \sanitize\_text\_field( \wp\_unslash( $\_GET['tab'] ) ) : ''; |
  |  | 157 | $current\_tab       = ( isset( $\_GET['tab'] ) ) ? \sanitize\_text\_field( \wp\_unslash( $\_GET['tab'] ) ) : ''; |
  | 158 | 158 | $this->current\_tab = empty( $current\_tab ) ? 'general' : $current\_tab; |
  | 159 | 159 | } |
  | […](/browser/wp-security-audit-log/trunk/classes/Views/Settings.php?rev=2897171#L277) | […](/browser/wp-security-audit-log/trunk/classes/Views/Settings.php?rev=2911237#L277) |  |
  | 277 | 277 | \*/ |
  | 278 | 278 | public function ajax\_run\_cleanup() { |
  |  | 279 | // Verify nonce. |
  |  | 280 | if ( ! isset( $\_REQUEST['nonce'] ) || false === wp\_verify\_nonce( \sanitize\_text\_field( \wp\_unslash( $\_REQUEST['nonce'] ) ), 'wsal-run-cleanup' ) ) { |
  |  | 281 | wp\_send\_json\_error( esc\_html\_\_( 'Insecure request.', 'wp-security-audit-log' ) ); |
  |  | 282 | } |
  |  | 283 |  |
  | 279 | 284 | if ( ! $this->plugin->settings()->current\_user\_can( 'edit' ) ) { |
  | 280 | 285 | die( 'Access Denied.' ); |
  | […](/browser/wp-security-audit-log/trunk/classes/Views/Settings.php?rev=2897171#L286) | […](/browser/wp-security-audit-log/trunk/classes/Views/Settings.php?rev=2911237#L291) |  |
  | 286 | 291 |  |
  | 287 | 292 | // phpcs:disable |
  | 288 |  | // phpcs:~~dis~~able |
  |  | 293 | // phpcs:enable |
  | 289 | 294 |  |
  | 290 | 295 | // Calculate limit timestamp. |
  | […](/browser/wp-security-audit-log/trunk/classes/Views/Settings.php?rev=2897171#L295) | […](/browser/wp-security-audit-log/trunk/classes/Views/Settings.php?rev=2911237#L300) |  |
  | 295 | 300 | // $query->add\_condition( 'created\_on <= %s', intval( $max\_stamp ) ); // Add limits of timestamp. |
  | 296 | 301 | // $results = $query->get\_adapter()->execute\_query( $query ); |
  | 297 |  | $items ~~= \WSAL\Entities\Occurrences\_Entity::count('created\_on <= %s', intval( $max\_stamp )~~); |
  |  | 302 | $items = \WSAL\Entities\Occurrences\_Entity::count( 'created\_on <= %s', intval( $max\_stamp ) ); |
  | 298 | 303 | if ( $items ) { |
  | 299 | 304 | $this->plugin->clean\_up(); |
  | […](/browser/wp-security-audit-log/trunk/classes/Views/Settings.php?rev=2897171#L978) | […](/browser/wp-security-audit-log/trunk/classes/Views/Settings.php?rev=2911237#L983) |  |
  | 978 | 983 | $retention\_help\_text = \_\_( '<a href="https://wpactivitylog.com/pricing/?utm\_source=plugin&utm\_medium=referral&utm\_campaign=WSAL&utm\_content=settings+pages" target="\_blank">Upgrade to Premium</a> to store the activity log data in an external database.', 'wp-security-audit-log' ); |
  | 979 | 984 |  |
  |  | 985 | // phpcs:disable |
  |  | 986 | // phpcs:enable |
  | 980 | 987 | echo wp\_kses( $retention\_help\_text, $this->plugin->allowed\_html\_tags ); |
  | 981 | 988 | ?> |
  | […](/browser/wp-security-audit-log/trunk/classes/Views/Settings.php?rev=2897171#L983) | […](/browser/wp-security-audit-log/trunk/classes/Views/Settings.php?rev=2911237#L990) |  |
  | 983 | 990 |  |
  | 984 | 991 | <?php |
  |  | 992 | // phpcs:disable |
  | 985 | 993 | /\* @free:start \*/ |
  |  | 994 | // phpcs:enable |
  | 986 | 995 | // Ensure it doesn't load a 2nd time for premium users. |
  | 987 | 996 | if ( ! wsal\_freemius()->can\_use\_premium\_code() ) { |
  | 988 | 997 | $this->render\_retention\_settings\_table(); |
  | 989 | 998 | } |
  |  | 999 | // phpcs:disable |
  | 990 | 1000 | /\* @free:end \*/ |
  |  | 1001 | // phpcs:enable |
  | 991 | 1002 | ?> |
  | 992 | 1003 |  |
  | […](/browser/wp-security-audit-log/trunk/classes/Views/Settings.php?rev=2897171#L1243) | […](/browser/wp-security-audit-log/trunk/classes/Views/Settings.php?rev=2911237#L1254) |  |
  | 1243 | 1254 | <br style="clear: both;"/> |
  | 1244 | 1255 | <div id="ExRoleList"> |
  | 1245 |  | <?php foreach ( ~~$this->plugin->settings()->~~get\_excluded\_monitoring\_roles() as $item ) : ?> |
  |  | 1256 | <?php foreach ( \WSAL\Helpers\Settings\_Helper::get\_excluded\_monitoring\_roles() as $item ) : ?> |
  | 1246 | 1257 | <span class="sectoken-<?php echo esc\_attr( $this->get\_token\_type( $item ) ); ?>"> |
  | 1247 | 1258 | <input type="hidden" name="ExRoles[]" value="<?php echo esc\_attr( $item ); ?>"/> |
  | […](/browser/wp-security-audit-log/trunk/classes/Views/Settings.php?rev=2897171#L1368) | […](/browser/wp-security-audit-log/trunk/classes/Views/Settings.php?rev=2911237#L1379) |  |
  | 1368 | 1379 |  |
  | 1369 | 1380 | \WSAL\Helpers\Settings\_Helper::set\_excluded\_monitoring\_users( isset( $post\_array['ExUsers'] ) ? $post\_array['ExUsers'] : array() ); |
  | 1370 |  | ~~$this->plugin->settings()->~~set\_excluded\_monitoring\_roles( isset( $post\_array['ExRoles'] ) ? $post\_array['ExRoles'] : array() ); |
  |  | 1381 | \WSAL\Helpers\Settings\_Helper::set\_excluded\_monitoring\_roles( isset( $post\_array['ExRoles'] ) ? $post\_array['ExRoles'] : array() ); |
  | 1371 | 1382 | \WSAL\Helpers\Settings\_Helper::set\_excluded\_post\_meta\_fields( isset( $post\_array['PostMetas'] ) ? $post\_array['PostMetas'] : array() ); |
  | 1372 | 1383 | \WSAL\Helpers\Settings\_Helper::set\_excluded\_user\_meta\_fields( isset( $post\_array['UserMetas'] ) ? $post\_array['UserMetas'] : array() ); |
  | […](/browser/wp-security-audit-log/trunk/classes/Views/Settings.php?rev=2897171#L1769) | […](/browser/wp-security-audit-log/trunk/classes/Views/Settings.php?rev=2911237#L1780) |  |
  | 1769 | 1780 | // $alerts = array(); |
  | 1770 | 1781 | // foreach ( $registered\_alerts as $alert => $details ) { |
  | 1771 |  | // $alerts[] = (string) $details->code; |
  |  | 1782 | // $alerts[] = (string) $details->code; |
  | 1772 | 1783 | // } |
  | 1773 | 1784 |  |
  | […](/browser/wp-security-audit-log/trunk/classes/Views/Settings.php?rev=2897171#L1941) | […](/browser/wp-security-audit-log/trunk/classes/Views/Settings.php?rev=2911237#L1952) |  |
  | 1941 | 1952 | <?php |
  | 1942 | 1953 | foreach ( $pruning\_unit\_options as $option => $label ) { |
  | 1943 |  | echo '<option value="' . esc\_attr( $option ) . '" ' . selected( $pruning\_unit, $option, true ) . '>' . ucwords( $label ) . '</option>'; // phpcs:~~disabl~~e |
  |  | 1954 | echo '<option value="' . esc\_attr( $option ) . '" ' . selected( $pruning\_unit, $option, true ) . '>' . ucwords( $label ) . '</option>'; // phpcs:ignore |
  | 1944 | 1955 | } |
  | 1945 | 1956 | ?> |
  | […](/browser/wp-security-audit-log/trunk/classes/Views/Settings.php?rev=2897171#L1957) | […](/browser/wp-security-audit-log/trunk/classes/Views/Settings.php?rev=2911237#L1968) |  |
  | 1957 | 1968 | esc\_html( human\_time\_diff( current\_time( 'timestamp' ), $next ) ) |
  | 1958 | 1969 | ); |
  | 1959 |  | echo '<!-- ' . esc\_html( date( 'dMy H:i:s', $next ) ) . ' --> '; |
  |  | 1970 | echo '<!-- ' . esc\_html( gmdate( 'dMy H:i:s', $next ) ) . ' --> '; |
  | 1960 | 1971 | echo esc\_html\_\_( 'You can run the purging process now by clicking the button below.', 'wp-security-audit-log' ); |
  | 1961 | 1972 | ?> |
  | 1962 | 1973 | </p> |
  | 1963 | 1974 | <p> |
  | 1964 |  | <a class="button-primary" href="<?php echo esc\_url( add\_query\_arg( ~~'action', 'AjaxRunCleanup', admin\_url( 'admin-ajax.php' ) ) ); ?>"~~><?php esc\_html\_e( 'Purge Old Data', 'wp-security-audit-log' ); ?></a> |
  |  | 1975 | <a class="button-primary" href="<?php echo esc\_url( add\_query\_arg( ['action'=> 'AjaxRunCleanup', 'nonce'=> wp\_create\_nonce( 'wsal-run-cleanup' )], admin\_url( 'admin-ajax.php' ) ) ); ?>" data-nonce="<?php echo esc\_attr( wp\_create\_nonce( 'wsal-run-cleanup' ) ); ?>" ><?php esc\_html\_e( 'Purge Old Data', 'wp-security-audit-log' ); ?></a> |
  | 1965 | 1976 | </p> |
  | 1966 | 1977 | <?php endif; ?> |
* ## [wp-security-audit-log/trunk/classes/WPSensors/class-wp-content-sensor.php](/changeset/2911237/wp-security-audit-log/trunk/classes/WPSensors/class-wp-content-sensor.php?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Fclasses%2FWPSensors%2Fclass-wp-content-sensor.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/classes/WPSensors/class-wp-content-sensor.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/classes/WPSensors/class-wp-content-sensor.php?rev=2897171#L1620 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/classes/WPSensors/class-wp-content-sensor.php?rev=2911237#L1620 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 1620 | 1620 | $post\_events = array\_merge( $post\_events, array\_keys( Alert\_Manager::get\_alerts\_by\_sub\_category( 'Coupons' ) ) ); |
  | 1621 | 1621 |  |
  |  | 1622 | $post\_events = array\_merge( $post\_events, array\_keys( Alert\_Manager::get\_alerts\_by\_sub\_category( 'Tags' ) ) ); |
  |  | 1623 |  |
  |  | 1624 | $post\_events = array\_merge( $post\_events, array\_keys( Alert\_Manager::get\_alerts\_by\_sub\_category( 'Categories' ) ) ); |
  |  | 1625 |  |
  |  | 1626 | $post\_events = array\_merge( $post\_events, array\_keys( Alert\_Manager::get\_alerts\_by\_sub\_category( 'Custom Fields' ) ) ); |
  |  | 1627 |  |
  |  | 1628 | $post\_events = array\_merge( $post\_events, array\_keys( Alert\_Manager::get\_alerts\_by\_sub\_category( 'Custom Fields (ACF)' ) ) ); |
  |  | 1629 |  |
  |  | 1630 | $post\_events = array\_merge( $post\_events, array\_keys( Alert\_Manager::get\_alerts\_by\_sub\_category( 'Comments' ) ) ); |
  |  | 1631 |  |
  |  | 1632 | $post\_events = array\_merge( $post\_events, array\_keys( Alert\_Manager::get\_alerts\_by\_sub\_category( 'Custom Post Types' ) ) ); |
  |  | 1633 |  |
  |  | 1634 | $post\_events = array\_merge( $post\_events, array\_keys( Alert\_Manager::get\_alerts\_by\_sub\_category( 'Pages' ) ) ); |
  |  | 1635 |  |
  | 1622 | 1636 | foreach ( $post\_events as $event ) { |
  | 1623 | 1637 | if ( Alert\_Manager::will\_or\_has\_triggered( $event ) || Alert\_Manager::was\_triggered\_recently( $event ) ) { |
* ## [wp-security-audit-log/trunk/classes/WPSensors/class-wp-log-in-out-sensor.php](/changeset/2911237/wp-security-audit-log/trunk/classes/WPSensors/class-wp-log-in-out-sensor.php?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Fclasses%2FWPSensors%2Fclass-wp-log-in-out-sensor.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/classes/WPSensors/class-wp-log-in-out-sensor.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/classes/WPSensors/class-wp-log-in-out-sensor.php?rev=2897171#L16 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/classes/WPSensors/class-wp-log-in-out-sensor.php?rev=2911237#L16 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | use WSAL\Helpers\WP\_Helper; |
  | 17 | 17 | use WSAL\Helpers\User\_Helper; |
  |  | 18 | use WSAL\Helpers\Settings\_Helper; |
  | 18 | 19 | use WSAL\Controllers\Alert\_Manager; |
  | 19 | 20 |  |
  | […](/browser/wp-security-audit-log/trunk/classes/WPSensors/class-wp-log-in-out-sensor.php?rev=2897171#L96) | […](/browser/wp-security-audit-log/trunk/classes/WPSensors/class-wp-log-in-out-sensor.php?rev=2911237#L97) |  |
  | 96 | 97 | public static function is\_login\_sensor() { |
  | 97 | 98 | return self::$login\_sensor; |
  |  | 99 | } |
  |  | 100 |  |
  |  | 101 | /\*\* |
  |  | 102 | \* That needs to be registered as a frontend sensor, when the admin sets the plugin to monitor the login from 3rd parties. |
  |  | 103 | \* |
  |  | 104 | \* @return boolean |
  |  | 105 | \* |
  |  | 106 | \* @since 4.5.1 |
  |  | 107 | \*/ |
  |  | 108 | public static function is\_frontend\_sensor(): bool { |
  |  | 109 | $frontend\_events = Settings\_Helper::get\_frontend\_events(); |
  |  | 110 | $should\_load     = ! empty( $frontend\_events['register'] ) || ! empty( $frontend\_events['login'] ); |
  |  | 111 |  |
  |  | 112 | if ( $should\_load ) { |
  |  | 113 | return true; |
  |  | 114 | } |
  |  | 115 |  |
  |  | 116 | return false; |
  | 98 | 117 | } |
  | 99 | 118 |  |
  | […](/browser/wp-security-audit-log/trunk/classes/WPSensors/class-wp-log-in-out-sensor.php?rev=2897171#L204) | […](/browser/wp-security-audit-log/trunk/classes/WPSensors/class-wp-log-in-out-sensor.php?rev=2911237#L223) |  |
  | 204 | 223 | if ( self::$current\_user->ID ) { |
  | 205 | 224 | // get the list of excluded users. |
  | 206 |  | $excluded\_users    = ~~\WSAL\Helpers\~~Settings\_Helper::get\_excluded\_monitoring\_users(); |
  |  | 225 | $excluded\_users    = Settings\_Helper::get\_excluded\_monitoring\_users(); |
  | 207 | 226 | $excluded\_user\_ids = array(); |
  | 208 | 227 | // convert excluded usernames into IDs. |
  | […](/browser/wp-security-audit-log/trunk/classes/WPSensors/class-wp-log-in-out-sensor.php?rev=2897171#L237) | […](/browser/wp-security-audit-log/trunk/classes/WPSensors/class-wp-log-in-out-sensor.php?rev=2911237#L256) |  |
  | 237 | 256 | \*/ |
  | 238 | 257 | protected static function get\_login\_failure\_log\_limit() { |
  | 239 |  | return ~~\WSAL\Helpers\~~Settings\_Helper::get\_option\_value( 'log-failed-login-limit', 10 ); |
  |  | 258 | return Settings\_Helper::get\_option\_value( 'log-failed-login-limit', 10 ); |
  | 240 | 259 | } |
  | 241 | 260 |  |
  | […](/browser/wp-security-audit-log/trunk/classes/WPSensors/class-wp-log-in-out-sensor.php?rev=2897171#L248) | […](/browser/wp-security-audit-log/trunk/classes/WPSensors/class-wp-log-in-out-sensor.php?rev=2911237#L267) |  |
  | 248 | 267 | \*/ |
  | 249 | 268 | protected static function get\_visitor\_login\_failure\_log\_limit() { |
  | 250 |  | return intval( ~~\WSAL\Helpers\~~Settings\_Helper::get\_option\_value( 'log-visitor-failed-login-limit', 10 ) ); |
  |  | 269 | return intval( Settings\_Helper::get\_option\_value( 'log-visitor-failed-login-limit', 10 ) ); |
  | 251 | 270 | } |
  | 252 | 271 |  |
  | […](/browser/wp-security-audit-log/trunk/classes/WPSensors/class-wp-log-in-out-sensor.php?rev=2897171#L344) | […](/browser/wp-security-audit-log/trunk/classes/WPSensors/class-wp-log-in-out-sensor.php?rev=2911237#L363) |  |
  | 344 | 363 | $d = (int) $d; |
  | 345 | 364 |  |
  | 346 |  | $ip = ~~\WSAL\Helpers\~~Settings\_Helper::get\_main\_client\_ip(); |
  |  | 365 | $ip = Settings\_Helper::get\_main\_client\_ip(); |
  | 347 | 366 |  |
  | 348 | 367 | // Filter $\_POST global array for security. |
  | […](/browser/wp-security-audit-log/trunk/classes/WPSensors/class-wp-log-in-out-sensor.php?rev=2897171#L520) | […](/browser/wp-security-audit-log/trunk/classes/WPSensors/class-wp-log-in-out-sensor.php?rev=2911237#L539) |  |
  | 520 | 539 | \* Current user switched to another user event. |
  | 521 | 540 | \* |
  | 522 |  | ~~\* @since 3.4~~ |
  | 523 |  | ~~\*~~ |
  | 524 | 541 | \* @param int $new\_user\_id - New user id. |
  | 525 | 542 | \* @param int $old\_user\_id - Old user id. |
  | […](/browser/wp-security-audit-log/trunk/classes/WPSensors/class-wp-log-in-out-sensor.php?rev=2897171#L527) | […](/browser/wp-security-audit-log/trunk/classes/WPSensors/class-wp-log-in-out-sensor.php?rev=2911237#L544) |  |
  | 527 | 544 | \* @since 4.5.0 |
  | 528 | 545 | \*/ |
  | 529 |  | public function user\_switched\_event( $new\_user\_id, $old\_user\_id ) { |
  |  | 546 | public static function user\_switched\_event( $new\_user\_id, $old\_user\_id ) { |
  | 530 | 547 | $target\_user       = get\_user\_by( 'ID', $new\_user\_id ); |
  | 531 | 548 | $target\_user\_roles = User\_Helper::get\_user\_roles( $target\_user ); |
* ## [wp-security-audit-log/trunk/classes/WPSensors/class-wp-multisite-sensor.php](/changeset/2911237/wp-security-audit-log/trunk/classes/WPSensors/class-wp-multisite-sensor.php?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Fclasses%2FWPSensors%2Fclass-wp-multisite-sensor.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/classes/WPSensors/class-wp-multisite-sensor.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/classes/WPSensors/class-wp-multisite-sensor.php?rev=2897171#L248 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/classes/WPSensors/class-wp-multisite-sensor.php?rev=2911237#L248 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 248 | 248 | } |
  | 249 | 249 |  |
  | 250 |  | $blog\_title = strip\_tags( $\_POST['blog']['title'] ); // phpcs:ignore |
  |  | 250 | if ( isset( $\_POST['blog'] ) && isset( $\_POST['blog']['title'] ) ) { |
  |  | 251 | $blog\_title = strip\_tags( $\_POST['blog']['title'] ); |
  |  | 252 | } elseif ( isset( $\_POST['target\_title'] )  ) { |
  |  | 253 | $blog\_title = strip\_tags( $\_POST['target\_title'] ); |
  |  | 254 | } else { |
  |  | 255 | $blog\_title = WP\_Helper::get\_blog\_info( $new\_blog->blog\_id )['name']; |
  |  | 256 | } |
  | 251 | 257 | $blog\_url   = untrailingslashit( $home\_scheme . '://' . $new\_blog->domain . $new\_blog->path ); |
  | 252 | 258 |  |
* ## [wp-security-audit-log/trunk/classes/WPSensors/class-wp-register-sensor.php](/changeset/2911237/wp-security-audit-log/trunk/classes/WPSensors/class-wp-register-sensor.php?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Fclasses%2FWPSensors%2Fclass-wp-register-sensor.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/classes/WPSensors/class-wp-register-sensor.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/classes/WPSensors/class-wp-register-sensor.php?rev=2897171#L15 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/classes/WPSensors/class-wp-register-sensor.php?rev=2911237#L15 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 15 | 15 |  |
  | 16 | 16 | use WSAL\Helpers\WP\_Helper; |
  |  | 17 | use WSAL\Helpers\Settings\_Helper; |
  | 17 | 18 | use WSAL\Controllers\Alert\_Manager; |
  | 18 | 19 |  |
  | […](/browser/wp-security-audit-log/trunk/classes/WPSensors/class-wp-register-sensor.php?rev=2897171#L71) | […](/browser/wp-security-audit-log/trunk/classes/WPSensors/class-wp-register-sensor.php?rev=2911237#L72) |  |
  | 71 | 72 |  |
  | 72 | 73 | /\*\* |
  |  | 74 | \* That needs to be registered as a frontend sensor, when the admin sets the plugin to monitor the login from 3rd parties. |
  |  | 75 | \* |
  |  | 76 | \* @return boolean |
  |  | 77 | \* |
  |  | 78 | \* @since 4.5.1 |
  |  | 79 | \*/ |
  |  | 80 | public static function is\_frontend\_sensor(): bool { |
  |  | 81 | $frontend\_events = Settings\_Helper::get\_frontend\_events(); |
  |  | 82 | $should\_load     = ! empty( $frontend\_events['register'] ) || ! empty( $frontend\_events['login'] ) || ! empty( $frontend\_events['woocommerce'] ); |
  |  | 83 |  |
  |  | 84 | if ( $should\_load ) { |
  |  | 85 | return true; |
  |  | 86 | } |
  |  | 87 |  |
  |  | 88 | return false; |
  |  | 89 | } |
  |  | 90 |  |
  |  | 91 | /\*\* |
  | 73 | 92 | \* When a user registers, action 'user\_register' is fired because it is part of the function 'wp\_insert\_user'. We |
  | 74 | 93 | \* can assume event 4000 if the current session is not logged in. |
* ## [wp-security-audit-log/trunk/css/auditlog.css](/changeset/2911237/wp-security-audit-log/trunk/css/auditlog.css?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Fcss%2Fauditlog.css "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/css/auditlog.css")

  | [r2897171](/browser/wp-security-audit-log/trunk/css/auditlog.css?rev=2897171#L78 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/css/auditlog.css?rev=2911237#L78 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 78 | 78 | position: absolute; |
  | 79 | 79 | bottom: 0; |
  | 80 |  | right: ~~0~~; |
  |  | 80 | right: -100px; |
  | 81 | 81 | width: 0; |
  | 82 | 82 | height: 0; |
  | […](/browser/wp-security-audit-log/trunk/css/auditlog.css?rev=2897171#L88) | […](/browser/wp-security-audit-log/trunk/css/auditlog.css?rev=2911237#L88) |  |
  | 88 | 88 | position: absolute; |
  | 89 | 89 | bottom: 6px; |
  | 90 |  | right: ~~6~~px; |
  |  | 90 | right: -94px; |
  | 91 | 91 | background: white; |
  | 92 | 92 | box-shadow: rgb(0 0 0 / 24%) 0px 3px 8px; |
  | […](/browser/wp-security-audit-log/trunk/css/auditlog.css?rev=2897171#L148) | […](/browser/wp-security-audit-log/trunk/css/auditlog.css?rev=2911237#L148) |  |
  | 148 | 148 |  |
  | 149 | 149 | .more-info { |
  | 150 |  | float: right; |
  | 151 |  | display: block; |
  | 152 |  | ~~width: 16px~~; |
  | 153 |  | ~~height: 16~~px; |
  | 154 |  | color: #FFF; |
  | 155 |  | ~~font-weight: bold~~; |
  | 156 |  | ~~font-size: 13px~~; |
  | 157 |  | ~~line-height: 10px~~; |
  | 158 |  | ~~text-align: center~~; |
  | 159 |  | ~~border-radius: 32px~~; |
  | 160 |  | ~~margin-left: 8px~~; |
  | 161 |  | ~~background: #AAA~~; |
  |  | 150 | float: right; |
  |  | 151 | display: block; |
  |  | 152 | width: auto; |
  |  | 153 | height: 15px; |
  |  | 154 | color: #FFF; |
  |  | 155 | font-size: 11px !important; |
  |  | 156 | line-height: 27px !important; |
  |  | 157 | text-align: center; |
  |  | 158 | border-radius: 32px; |
  |  | 159 | padding: 0 8px !important; |
  |  | 160 | border-color: #ddd !important; |
  |  | 161 | background: #f6f7f7; |
  | 162 | 162 | } |
  | 163 | 163 |  |
  | […](/browser/wp-security-audit-log/trunk/css/auditlog.css?rev=2897171#L498) | […](/browser/wp-security-audit-log/trunk/css/auditlog.css?rev=2911237#L498) |  |
  | 498 | 498 | } |
  | 499 | 499 |  |
  |  | 500 | .wp-list-table #data { |
  |  | 501 | width: 80px; |
  |  | 502 | } |
  |  | 503 |  |
  | 500 | 504 | .column-crtd { |
  | 501 | 505 | width: 135px; |
  | […](/browser/wp-security-audit-log/trunk/css/auditlog.css?rev=2897171#L507) | […](/browser/wp-security-audit-log/trunk/css/auditlog.css?rev=2911237#L511) |  |
  | 507 | 511 | .wp-list-table.wsal-table-grid .data { |
  | 508 | 512 | width: 120px; |
  | 509 |  | ~~}~~ |
  | 510 |  |  |
  | 511 |  | ~~.wsal-table-grid .more-info {~~ |
  | 512 |  | ~~float: inherit;~~ |
  | 513 |  | ~~width: 35px;~~ |
  | 514 |  | ~~height: 35px;~~ |
  | 515 |  | ~~font-size: 2em;~~ |
  | 516 |  | ~~line-height: 0.65em;~~ |
  | 517 | 513 | } |
  | 518 | 514 |  |
* ## [wp-security-audit-log/trunk/js/auditlog.js](/changeset/2911237/wp-security-audit-log/trunk/js/auditlog.js?old=2749070&old_path=wp-security-audit-log%2Ftrunk%2Fjs%2Fauditlog.js "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/js/auditlog.js")

  | [r2897171](/browser/wp-security-audit-log/trunk/js/auditlog.js?rev=2749070#L221 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/js/auditlog.js?rev=2911237#L221 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 221 | 221 | } |
  | 222 | 222 |  |
  | 223 |  | function WsalDBChange(value) { |
  |  | 223 | function WsalDBChange(value, nonce) { |
  | 224 | 224 | jQuery.ajax({ |
  | 225 | 225 | type: 'POST', |
  | […](/browser/wp-security-audit-log/trunk/js/auditlog.js?rev=2749070#L228) | […](/browser/wp-security-audit-log/trunk/js/auditlog.js?rev=2911237#L228) |  |
  | 228 | 228 | data: { |
  | 229 | 229 | action: 'AjaxSwitchDB', |
  |  | 230 | nonce: nonce, |
  | 230 | 231 | selected\_db: value |
  | 231 | 232 | }, |
* ## [wp-security-audit-log/trunk/languages/wp-security-audit-log.pot](/changeset/2911237/wp-security-audit-log/trunk/languages/wp-security-audit-log.pot?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Flanguages%2Fwp-security-audit-log.pot "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/languages/wp-security-audit-log.pot")

  | [r2897171](/browser/wp-security-audit-log/trunk/languages/wp-security-audit-log.pot?rev=2897171#L3 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/languages/wp-security-audit-log.pot?rev=2911237#L3 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | msgid "" |
  | 4 | 4 | msgstr "" |
  | 5 |  | "Project-Id-Version: WP Activity Log 4.5.~~0~~\n" |
  |  | 5 | "Project-Id-Version: WP Activity Log 4.5.2\n" |
  | 6 | 6 | "Report-Msgid-Bugs-To: https://wordpress.org/support/plugin/wp-security-audit-log\n" |
  | 7 | 7 | "Last-Translator: WP White Security <info@wpwhitesecurity.com>\n" |
  | […](/browser/wp-security-audit-log/trunk/languages/wp-security-audit-log.pot?rev=2897171#L10) | […](/browser/wp-security-audit-log/trunk/languages/wp-security-audit-log.pot?rev=2911237#L10) |  |
  | 10 | 10 | "Content-Type: text/plain; charset=UTF-8\n" |
  | 11 | 11 | "Content-Transfer-Encoding: 8bit\n" |
  | 12 |  | "POT-Creation-Date: 2023-0~~4-11T09:21:04~~+00:00\n" |
  |  | 12 | "POT-Creation-Date: 2023-05-11T14:19:31+00:00\n" |
  | 13 | 13 | "PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n" |
  | 14 |  | "X-Generator: WP-CLI 2.~~7.1~~\n" |
  |  | 14 | "X-Generator: WP-CLI 2.6.0\n" |
  | 15 | 15 | "X-Domain: wp-security-audit-log\n" |
  | 16 | 16 |  |
  | […](/browser/wp-security-audit-log/trunk/languages/wp-security-audit-log.pot?rev=2897171#L36) | […](/browser/wp-security-audit-log/trunk/languages/wp-security-audit-log.pot?rev=2911237#L36) |  |
  | 36 | 36 |  |
  | 37 | 37 | #. translators: User's first name |
  | 38 |  | #: wp-security-audit-log.php:71~~5~~ |
  | 39 |  | #: wp-security-audit-log.php:74~~3~~ |
  |  | 38 | #: wp-security-audit-log.php:716 |
  |  | 39 | #: wp-security-audit-log.php:744 |
  | 40 | 40 | msgid "Hey %s" |
  | 41 | 41 | msgstr "" |
  | 42 | 42 |  |
  | 43 |  | #: wp-security-audit-log.php:7~~19~~ |
  |  | 43 | #: wp-security-audit-log.php:720 |
  | 44 | 44 | msgid "Never miss an important update! Opt-in to our security and feature updates notifications, and non-sensitive diagnostic tracking with freemius.com." |
  | 45 |  | ~~msgstr ""~~ |
  | 46 |  |  |
  | 47 |  | ~~#: wp-security-audit-log.php:720~~ |
  | 48 |  | ~~#: wp-security-audit-log.php:755~~ |
  | 49 |  | ~~msgid "Note: "~~ |
  | 50 | 45 | msgstr "" |
  | 51 | 46 |  |
  | 52 | 47 | #: wp-security-audit-log.php:721 |
  | 53 | 48 | #: wp-security-audit-log.php:756 |
  |  | 49 | msgid "Note: " |
  |  | 50 | msgstr "" |
  |  | 51 |  |
  |  | 52 | #: wp-security-audit-log.php:722 |
  |  | 53 | #: wp-security-audit-log.php:757 |
  | 54 | 54 | msgid "NO ACTIVITY LOG ACTIVITY & DATA IS SENT BACK TO OUR SERVERS." |
  | 55 | 55 | msgstr "" |
  | 56 | 56 |  |
  | 57 | 57 | #. translators: 1: Plugin name. 2: Plugin name. 2: Freemius link. 4: Plugin name. |
  | 58 |  | #: wp-security-audit-log.php:7~~49~~ |
  |  | 58 | #: wp-security-audit-log.php:750 |
  | 59 | 59 | msgid "Please help us improve %1$s! If you opt-in, some non-sensitive data about your usage of %2$s will be sent to %3$s, a diagnostic tracking service we use. If you skip this, that's okay! %2$s will still work just fine." |
  | 60 | 60 | msgstr "" |
  | 61 | 61 |  |
  | 62 |  | #: wp-security-audit-log.php:79~~3~~ |
  |  | 62 | #: wp-security-audit-log.php:794 |
  | 63 | 63 | msgid "You need to activate the licence key to use WP Activity Log Premium. %s" |
  | 64 | 64 | msgstr "" |
  | 65 | 65 |  |
  | 66 |  | #: wp-security-audit-log.php:79~~4~~ |
  |  | 66 | #: wp-security-audit-log.php:795 |
  | 67 | 67 | msgid "Activate the licence key now" |
  | 68 | 68 | msgstr "" |
  | 69 | 69 |  |
  | 70 | 70 | #. Translators: Expired message and time |
  | 71 |  | #: wp-security-audit-log.php:81~~8~~ |
  |  | 71 | #: wp-security-audit-log.php:819 |
  | 72 | 72 | msgid "%s You need to renew your license to continue using premium features." |
  | 73 | 73 | msgstr "" |
  | 74 | 74 |  |
  | 75 | 75 | #. Translators: Number of sites |
  | 76 |  | #: wp-security-audit-log.php:82~~1~~ |
  |  | 76 | #: wp-security-audit-log.php:822 |
  | 77 | 77 | msgid "The license is limited to %s sub-sites. You need to upgrade your license to cover all the sub-sites on this network." |
  | 78 | 78 | msgstr "" |
  | 79 | 79 |  |
  | 80 |  | #: wp-security-audit-log.php:91~~6~~ |
  |  | 80 | #: wp-security-audit-log.php:917 |
  | 81 | 81 | msgid "Error: You do not have sufficient permissions to disable this custom field." |
  | 82 | 82 | msgstr "" |
  | 83 | 83 |  |
  | 84 | 84 | #. translators: name of meta field (in bold) |
  | 85 |  | #: wp-security-audit-log.php:96~~2~~ |
  |  | 85 | #: wp-security-audit-log.php:963 |
  | 86 | 86 | msgid "Custom field %s is no longer being monitored." |
  | 87 | 87 | msgstr "" |
  | 88 | 88 |  |
  | 89 | 89 | #. translators: setting tab name "Excluded Objects" |
  | 90 |  | #: wp-security-audit-log.php:96~~8~~ |
  |  | 90 | #: wp-security-audit-log.php:969 |
  | 91 | 91 | msgid "Enable the monitoring of this custom field again from the %s tab in the plugin settings." |
  | 92 | 92 | msgstr "" |
  | 93 | 93 |  |
  | 94 |  | #: wp-security-audit-log.php:9~~69~~ |
  |  | 94 | #: wp-security-audit-log.php:970 |
  | 95 | 95 | msgid "Excluded Objects" |
  | 96 | 96 | msgstr "" |
  | 97 | 97 |  |
  | 98 |  | #: wp-security-audit-log.php:98~~2~~ |
  |  | 98 | #: wp-security-audit-log.php:983 |
  | 99 | 99 | msgid "Error: You do not have sufficient permissions to disable this alert." |
  | 100 | 100 | msgstr "" |
  | 101 | 101 |  |
  | 102 |  | #: wp-security-audit-log.php:100~~2~~ |
  |  | 102 | #: wp-security-audit-log.php:1003 |
  | 103 | 103 | msgid "Alert %1$s is no longer being monitored.<br /> %2$s" |
  | 104 | 104 | msgstr "" |
  | 105 | 105 |  |
  | 106 |  | #: wp-security-audit-log.php:100~~4~~ |
  |  | 106 | #: wp-security-audit-log.php:1005 |
  | 107 | 107 | msgid "You can enable this alert again from the Enable/Disable Alerts node in the plugin menu." |
  | 108 | 108 | msgstr "" |
  | 109 | 109 |  |
  | 110 |  | #: wp-security-audit-log.php:103~~5~~ |
  |  | 110 | #: wp-security-audit-log.php:1036 |
  | 111 | 111 | msgid "Installing, please wait" |
  | 112 | 112 | msgstr "" |
  | 113 | 113 |  |
  | 114 |  | #: wp-security-audit-log.php:103~~6~~ |
  |  | 114 | #: wp-security-audit-log.php:1037 |
  | 115 | 115 | msgid "Already installed" |
  | 116 | 116 | msgstr "" |
  | 117 | 117 |  |
  | 118 |  | #: wp-security-audit-log.php:103~~7~~ |
  |  | 118 | #: wp-security-audit-log.php:1038 |
  | 119 | 119 | msgid "Extension installed" |
  | 120 | 120 | msgstr "" |
  | 121 | 121 |  |
  | 122 |  | #: wp-security-audit-log.php:103~~8~~ |
  |  | 122 | #: wp-security-audit-log.php:1039 |
  | 123 | 123 | msgid "Extension activated" |
  | 124 | 124 | msgstr "" |
  | 125 | 125 |  |
  | 126 |  | #: wp-security-audit-log.php:10~~39~~ |
  |  | 126 | #: wp-security-audit-log.php:1040 |
  | 127 | 127 | msgid "Install failed" |
  | 128 | 128 | msgstr "" |
  | 129 | 129 |  |
  | 130 |  | #: wp-security-audit-log.php:104~~0~~ |
  |  | 130 | #: wp-security-audit-log.php:1041 |
  | 131 | 131 | msgid "Reloading page" |
  | 132 | 132 | msgstr "" |
  | 133 | 133 |  |
  | 134 | 134 | #. Translators: %s: PHP Version |
  | 135 |  | #: wp-security-audit-log.php:107~~6~~ |
  |  | 135 | #: wp-security-audit-log.php:1077 |
  | 136 | 136 | msgid "You are using a version of PHP that is older than %s, which is no longer supported." |
  | 137 | 137 | msgstr "" |
  | 138 | 138 |  |
  | 139 |  | #: wp-security-audit-log.php:107~~8~~ |
  |  | 139 | #: wp-security-audit-log.php:1079 |
  | 140 | 140 | msgid "Contact us on <a href=\"mailto:plugins@wpwhitesecurity.com\">plugins@wpwhitesecurity.com</a> to help you switch the version of PHP you are using." |
  | 141 | 141 | msgstr "" |
  | 142 | 142 |  |
  | 143 | 143 | #. Translators: %s: Activity Log for MainWP plugin hyperlink |
  | 144 |  | #: wp-security-audit-log.php:108~~3~~ |
  |  | 144 | #: wp-security-audit-log.php:1084 |
  | 145 | 145 | msgid "Please install the %s plugin on the MainWP dashboard." |
  | 146 | 146 | msgstr "" |
  | 147 | 147 |  |
  | 148 | 148 | #. Translators: %s: Activity Log for MainWP plugin hyperlink |
  | 149 |  | #: wp-security-audit-log.php:108~~3~~ |
  |  | 149 | #: wp-security-audit-log.php:1084 |
  | 150 | 150 | msgid "Activity Log for MainWP" |
  | 151 | 151 | msgstr "" |
  | 152 | 152 |  |
  | 153 | 153 | #. Translators: %s: Getting started guide hyperlink |
  | 154 |  | #: wp-security-audit-log.php:108~~5~~ |
  |  | 154 | #: wp-security-audit-log.php:1086 |
  | 155 | 155 | msgid "The WP Activity Log should be installed on the child sites only. Refer to the %s for more information." |
  | 156 | 156 | msgstr "" |
  | 157 | 157 |  |
  | 158 | 158 | #. Translators: %s: Getting started guide hyperlink |
  | 159 |  | #: wp-security-audit-log.php:108~~5~~ |
  |  | 159 | #: wp-security-audit-log.php:1086 |
  | 160 | 160 | msgid "getting started guide" |
  | 161 | 161 | msgstr "" |
  | 162 | 162 |  |
  | 163 |  | #: wp-security-audit-log.php:148~~1~~ |
  |  | 163 | #: wp-security-audit-log.php:1482 |
  | 164 | 164 | msgid "For security and auditing purposes, a record of all of your logged-in actions and changes within the WordPress dashboard will be recorded in an activity log with the <a href=\"https://wpactivitylog.com/\" target=\"\_blank\">WP Activity Log plugin</a>. The audit log also includes the IP address where you accessed this site from." |
  | 165 | 165 | msgstr "" |
  | 166 | 166 |  |
  | 167 |  | #: wp-security-audit-log.php:150~~0~~ |
  |  | 167 | #: wp-security-audit-log.php:1501 |
  | 168 | 168 | msgid "Every 6 hours" |
  | 169 | 169 | msgstr "" |
  | 170 | 170 |  |
  | 171 |  | #: wp-security-audit-log.php:150~~4~~ |
  |  | 171 | #: wp-security-audit-log.php:1505 |
  | 172 | 172 | msgid "Every 45 minutes" |
  | 173 | 173 | msgstr "" |
  | 174 | 174 |  |
  | 175 |  | #: wp-security-audit-log.php:150~~8~~ |
  |  | 175 | #: wp-security-audit-log.php:1509 |
  | 176 | 176 | msgid "Every 30 minutes" |
  | 177 | 177 | msgstr "" |
  | 178 | 178 |  |
  | 179 |  | #: wp-security-audit-log.php:151~~2~~ |
  |  | 179 | #: wp-security-audit-log.php:1513 |
  | 180 | 180 | msgid "Every 15 minutes" |
  | 181 | 181 | msgstr "" |
  | 182 | 182 |  |
  | 183 |  | #: wp-security-audit-log.php:151~~6~~ |
  |  | 183 | #: wp-security-audit-log.php:1517 |
  | 184 | 184 | msgid "Every 10 minutes" |
  | 185 | 185 | msgstr "" |
  | 186 | 186 |  |
  | 187 |  | #: wp-security-audit-log.php:152~~0~~ |
  |  | 187 | #: wp-security-audit-log.php:1521 |
  | 188 | 188 | msgid "Every 5 minutes" |
  | 189 | 189 | msgstr "" |
  | 190 | 190 |  |
  | 191 | 191 | #. translators: 1. Deprecated method name 2. Version since deprecated |
  | 192 |  | #: wp-security-audit-log.php:153~~4~~ |
  |  | 192 | #: wp-security-audit-log.php:1535 |
  | 193 | 193 | msgid "Method %1$s is deprecated since version %2$s!" |
  | 194 | 194 | msgstr "" |
* ## [wp-security-audit-log/trunk/nofs/lib/class-wsal-freemius.php](/changeset/2911237/wp-security-audit-log/trunk/nofs/lib/class-wsal-freemius.php?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Fnofs%2Flib%2Fclass-wsal-freemius.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/nofs/lib/class-wsal-freemius.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/nofs/lib/class-wsal-freemius.php?rev=2897171#L86 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/nofs/lib/class-wsal-freemius.php?rev=2911237#L86 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 86 | 86 |  |
  | 87 | 87 | public function is\_free\_plan() { |
  | 88 |  | ~~return true;~~ |
  | 89 | 88 | return true; |
  | 90 | 89 | } |
* ## [wp-security-audit-log/trunk/readme.txt](/changeset/2911239/wp-security-audit-log/trunk/readme.txt?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Freadme.txt "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/readme.txt")

  | [r2897171](/browser/wp-security-audit-log/trunk/readme.txt?rev=2897171#L4 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/readme.txt?rev=2911239#L4 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | License: GPLv3 |
  | 5 | 5 | License URI: https://www.gnu.org/licenses/gpl.html |
  | 6 |  | Tags: activity log, security audit log, user tracking, security event log, audit trail, user activity |
  |  | 6 | Tags: activity log, security audit log, user tracking, security event log, audit trail, user activity, changelog, history, log, website changes |
  | 7 | 7 | Requires at least: 5.0 |
  | 8 | 8 | Tested up to: 6.2 |
  | 9 |  | Stable tag: 4.5.~~0~~ |
  |  | 9 | Stable tag: 4.5.2 |
  | 10 | 10 | Requires PHP: 7.2 |
  | 11 | 11 |  |
  | […](/browser/wp-security-audit-log/trunk/readme.txt?rev=2897171#L210) | […](/browser/wp-security-audit-log/trunk/readme.txt?rev=2911239#L210) |  |
  | 210 | 210 | == Changelog == |
  | 211 | 211 |  |
  | 212 |  | = 4.5.0 (2023-04-12) = |
  | 213 |  |  |
  | 214 |  | Release notes: [Announcing WP Activity Log 4.5](https://wpactivitylog.com/wsal-4-5-0/) |
  |  | 212 | = 4.5.2 (2023-05-11) = |
  | 215 | 213 |  |
  | 216 | 214 | \* \*\*Plugin & features improvements\*\* |
  | 217 |  | \* Refactoring the plugin's code phase 1 - improved performance, reliability and maintainability. |
  | 218 |  | \* Better support for PHP8 - addressed all reported warnings and fatal errors. |
  | 219 |  | \* Event ID 2002 is now reported when a user changes something in a post for which the plugin does not have a specific event ID. |
  | 220 |  | \* Added checks to the excluded objects placeholders to ensure users do not specify wrong objects in the wrong setting. |
  | 221 |  | \* Replaced technical term severity labels with friendly ones. For example WSAL\_HIGH is now High severity. |
  | 222 |  | \* Added some new help text and improved existing help text in some pages throughout the plugin. |
  | 223 |  | \* Improved support for RTL setups in the activity log viewer. |
  | 224 |  | \* Removed code related to the migration of events when using an external database from the Free edition of the plugin. |
  | 225 |  | \* Improved the way the database table changes are detected by the plugin - all event IDs used for database changes monitoring are now enabled by default. |
  | 226 |  | \* Improved the sensor that detects page changes (page created, deleted or changed) done automatically via plugins. |
  | 227 |  | \* UI/UX  improvements in the reports page and the settings for the periodic reports. |
  |  | 215 | \* Improved PHP 8.2 compatability. |
  |  | 216 | \* Replaced the elipsis icon used for the Event data viewer with a "More details" button in the activity log viewer. |
  |  | 217 | \* Updated a number of hooks (better interoperability) used in custom sensors. |
  |  | 218 | \* Improved the "installed plugin" check to only show one extension notification when both the free and premium edition of a plugin are installed at the same time. |
  |  | 219 | \* Activity log data is also automatically deleted from the archive database when using the logs data deletion tool. |
  |  | 220 |  |
  |  | 221 | \* \*\*Security updates\*\* |
  |  | 222 | \* Fixed a number of CSRFs, missing authorization & missing capabilities checks discovered by Marco from Wordfence. |
  | 228 | 223 |  |
  | 229 | 224 | \* \*\*Bug fixes\*\* |
  | 230 |  | \* Fixed: Intermittent fatal error in UserSessionsTracking.php when loggin in from custom login pages (like WooCommerce). |
  | 231 |  | \* Fixed: Event ID 7009 (user changed the maximum upload file size for a site on a multisite network) was wrongly logged instead event ID 7011(user changed the maximum upload file size for the network). |
  | 232 |  | \* Fixed: Renaming a menu was not reported correctly, event ID 2085 (Changed menu items order) was reported instead. |
  | 233 |  | \* Fixed: Error reported in the message of event ID 6060 (Changed the status of an event ID). |
  | 234 |  | \* Fixed: WP Activity Log now keeps a log when it is activated or deactivated. |
  | 235 |  | \* Fixed: Deleting events with "Informational" severity delets all events in the log. |
  | 236 |  | \* Fixed: Fatal error in class-alert-manager.php when excluding a user and its role at the same time. |
  | 237 |  | \* Fixed: Super Admin role added to Admin user in logs on a single site. |
  | 238 |  | \* Fixed: PHP warning in /classes/Sensors/Multisite.php on a multisite network when running NOFS edition of the plugin on some specific multisite network setup. |
  | 239 |  | \* Fixed: Plugin version update notice still shown in the NOFS edition of the plugin even when the plugin is up to date. |
  | 240 |  | \* Fixed: When objets are excluded from the activity log. |
  | 241 |  | \* Fixed: Event ID 6052 (Changed activity log retention settings) was not reported if the setting is already on "delete events older than" and the user changes the number of months or years. |
  | 242 |  | \* Fixed: Event IDs 6053 - 6058, used to keep a log of when objects are excluded from the activity log are not reported in a multisite network environment. |
  | 243 |  | \* Fixed: Site title change not reported (Event ID 6059). |
  | 244 |  | \* Fixed: Event ID 6034 (Purged activity log) also reported along site event ID 6006 when resetting plugin settings to default. |
  | 245 |  |  |
  | 246 |  | Refer to the [complete plugin changelog](https://wpactivitylog.com/support/kb/plugin-changelog/?utm\_source=wordpress.org&utm\_medium=referral&utm\_campaign=WSAL&utm\_content=plugin+repos+description) for more detailed information about what was new, improved and fixed in previous versions of the WP Activity Log plugin.. |
  |  | 225 | \* Fixed: Fatal error reported when cloning a site on a multisite network with the NS Cloner plugin. |
  |  | 226 | \* Fixed: Plugin was not retrieving the correct IP address when using a reverse proxy since update 4.5.0. |
  |  | 227 | \* Addressed a number of PHP Warnings reported when using the WP Rocket plugin to purge the cache. |
  |  | 228 | \* Fixed: PHP warning when saving Exclude Objects settings. |
  |  | 229 | \* Setting up a mirroring connection and configuring the mirror of logs was not being reported in the logs. |
  |  | 230 | \* Fixed: Fatal error when using the User Switching plugin to switch a user's session. |
  |  | 231 | \* Fixed: Logins from non-native login forms (such as those from WooCommerce) were not captured correctly since update 4.5.0. |
  |  | 232 | \* Fixed: Plugin not terminating existing user session when the seting to "overwrite existing session" was enabled. |
  |  | 233 |  |
  |  | 234 | Refer to the [complete plugin changelog](https://wpactivitylog.com/support/kb/plugin-changelog/?utm\_source=wordpress.org&utm\_medium=referral&utm\_campaign=WSAL&utm\_content=plugin+repos+description) for more detailed information about what was new, improved and fixed in previous versions of the WP Activity Log plugin. |
* ## [wp-security-audit-log/trunk/sdk/wsal-freemius.php](/changeset/2911237/wp-security-audit-log/trunk/sdk/wsal-freemius.php?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Fsdk%2Fwsal-freemius.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/sdk/wsal-freemius.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/sdk/wsal-freemius.php?rev=2897171#L45 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/sdk/wsal-freemius.php?rev=2911237#L45 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 45 | 45 | $freemius\_state = \WSAL\Helpers\Settings\_Helper::get\_option\_value( 'wsal\_freemius\_state', 'anonymous' ); |
  | 46 | 46 | $is\_anonymous   = ( 'anonymous' === $freemius\_state || 'skipped' === $freemius\_state ); |
  | 47 |  | $is\_premium     = ~~tru~~e; |
  |  | 47 | $is\_premium     = false; |
  | 48 | 48 | $is\_anonymous   = $is\_premium ? false : $is\_anonymous; |
  | 49 | 49 |  |
* ## [wp-security-audit-log/trunk/third-party/vendor/autoload.php](/changeset/2911237/wp-security-audit-log/trunk/third-party/vendor/autoload.php?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Fthird-party%2Fvendor%2Fautoload.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/third-party/vendor/autoload.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/third-party/vendor/autoload.php?rev=2897171#L4 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/third-party/vendor/autoload.php?rev=2911237#L4 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 |  |
  | 5 | 5 | if (PHP\_VERSION\_ID < 50600) { |
  | 6 |  | if (!headers\_sent()) { |
  | 7 |  | header('HTTP/1.1 500 Internal Server Error'); |
  | 8 |  | } |
  | 9 |  | $err = 'Composer 2.3.0 dropped support for autoloading on PHP <5.6 and you are running '.PHP\_VERSION.', please upgrade PHP or use Composer 2.2 LTS via "composer self-update --2.2". Aborting.'.PHP\_EOL; |
  | 10 |  | if (!ini\_get('display\_errors')) { |
  | 11 |  | if (PHP\_SAPI === 'cli' || PHP\_SAPI === 'phpdbg') { |
  | 12 |  | fwrite(STDERR, $err); |
  | 13 |  | } elseif (!headers\_sent()) { |
  | 14 |  | echo $err; |
  | 15 |  | } |
  | 16 |  | } |
  | 17 |  | trigger\_error( |
  | 18 |  | $err, |
  | 19 |  | E\_USER\_ERROR |
  | 20 |  | ); |
  |  | 6 | echo 'Composer 2.3.0 dropped support for autoloading on PHP <5.6 and you are running '.PHP\_VERSION.', please upgrade PHP or use Composer 2.2 LTS via "composer self-update --2.2". Aborting.'.PHP\_EOL; |
  |  | 7 | exit(1); |
  | 21 | 8 | } |
  | 22 | 9 |  |
  | 23 | 10 | require\_once \_\_DIR\_\_ . '/composer/autoload\_real.php'; |
  | 24 | 11 |  |
  | 25 |  | return ComposerAutoloaderInit~~201f86ba52b29dc488d34f8e732c3d2f~~::getLoader(); |
  |  | 12 | return ComposerAutoloaderInite241c7387a5aac99f296110be12551fd::getLoader(); |
* ## [wp-security-audit-log/trunk/third-party/vendor/classes/wp-async-request.php](/changeset/2911237/wp-security-audit-log/trunk/third-party/vendor/classes/wp-async-request.php?old=2749070&old_path=wp-security-audit-log%2Ftrunk%2Fthird-party%2Fvendor%2Fclasses%2Fwp-async-request.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/third-party/vendor/classes/wp-async-request.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-async-request.php?rev=2749070#L50 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-async-request.php?rev=2911237#L50 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 50 | 50 | protected $data = array(); |
  | 51 | 51 | /\*\* |
  | 52 |  | \* Initiate new async request |
  |  | 52 | \* Initiate new async request. |
  | 53 | 53 | \*/ |
  | 54 | 54 | public function \_\_construct() |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-async-request.php?rev=2749070#L59) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-async-request.php?rev=2911237#L59) |  |
  | 59 | 59 | } |
  | 60 | 60 | /\*\* |
  | 61 |  | \* Set data used during the request |
  |  | 61 | \* Set data used during the request. |
  | 62 | 62 | \* |
  | 63 | 63 | \* @param array $data Data. |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-async-request.php?rev=2749070#L71) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-async-request.php?rev=2911237#L71) |  |
  | 71 | 71 | } |
  | 72 | 72 | /\*\* |
  | 73 |  | \* Dispatch the async request |
  |  | 73 | \* Dispatch the async request. |
  | 74 | 74 | \* |
  | 75 |  | \* @return array|WP\_Error |
  |  | 75 | \* @return array|WP\_Error|false HTTP Response array, WP\_Error on failure, or false if not attempted. |
  | 76 | 76 | \*/ |
  | 77 | 77 | public function dispatch() |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-async-request.php?rev=2749070#L82) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-async-request.php?rev=2911237#L82) |  |
  | 82 | 82 | } |
  | 83 | 83 | /\*\* |
  | 84 |  | \* Get query args |
  |  | 84 | \* Get query args. |
  | 85 | 85 | \* |
  | 86 | 86 | \* @return array |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-async-request.php?rev=2749070#L100) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-async-request.php?rev=2911237#L100) |  |
  | 100 | 100 | } |
  | 101 | 101 | /\*\* |
  | 102 |  | \* Get query URL |
  |  | 102 | \* Get query URL. |
  | 103 | 103 | \* |
  | 104 | 104 | \* @return string |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-async-request.php?rev=2749070#L118) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-async-request.php?rev=2911237#L118) |  |
  | 118 | 118 | } |
  | 119 | 119 | /\*\* |
  | 120 |  | \* Get post args |
  |  | 120 | \* Get post args. |
  | 121 | 121 | \* |
  | 122 | 122 | \* @return array |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-async-request.php?rev=2749070#L127) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-async-request.php?rev=2911237#L127) |  |
  | 127 | 127 | return $this->post\_args; |
  | 128 | 128 | } |
  | 129 |  | $args = array('timeout' => 0.01, 'blocking' => \false, 'body' => $this->data, 'cookies' => $\_COOKIE, 'sslverify' => apply\_filters('https\_local\_ssl\_verify', \false)); |
  |  | 129 | $args = array( |
  |  | 130 | 'timeout' => 0.01, |
  |  | 131 | 'blocking' => \false, |
  |  | 132 | 'body' => $this->data, |
  |  | 133 | 'cookies' => $\_COOKIE, |
  |  | 134 | // Passing cookies ensures request is performed as initiating user. |
  |  | 135 | 'sslverify' => apply\_filters('https\_local\_ssl\_verify', \false), |
  |  | 136 | ); |
  | 130 | 137 | /\*\* |
  | 131 | 138 | \* Filters the post arguments used during an async request. |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-async-request.php?rev=2749070#L136) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-async-request.php?rev=2911237#L143) |  |
  | 136 | 143 | } |
  | 137 | 144 | /\*\* |
  | 138 |  | \* Maybe handle |
  |  | 145 | \* Maybe handle a dispatched request. |
  | 139 | 146 | \* |
  | 140 | 147 | \* Check for correct nonce and pass to handler. |
  |  | 148 | \* |
  |  | 149 | \* @return void|mixed |
  | 141 | 150 | \*/ |
  | 142 | 151 | public function maybe\_handle() |
  | 143 | 152 | { |
  | 144 |  | // Don't lock up other requests while processing |
  |  | 153 | // Don't lock up other requests while processing. |
  | 145 | 154 | \session\_write\_close(); |
  | 146 | 155 | check\_ajax\_referer($this->identifier, 'nonce'); |
  | 147 | 156 | $this->handle(); |
  | 148 |  | wp\_die(); |
  |  | 157 | return $this->maybe\_wp\_die(); |
  | 149 | 158 | } |
  | 150 | 159 | /\*\* |
  | 151 |  | \* Handle |
  |  | 160 | \* Should the process exit with wp\_die? |
  |  | 161 | \* |
  |  | 162 | \* @param mixed $return What to return if filter says don't die, default is null. |
  |  | 163 | \* |
  |  | 164 | \* @return void|mixed |
  |  | 165 | \*/ |
  |  | 166 | protected function maybe\_wp\_die($return = null) |
  |  | 167 | { |
  |  | 168 | /\*\* |
  |  | 169 | \* Should wp\_die be used? |
  |  | 170 | \* |
  |  | 171 | \* @return bool |
  |  | 172 | \*/ |
  |  | 173 | if (apply\_filters($this->identifier . '\_wp\_die', \true)) { |
  |  | 174 | wp\_die(); |
  |  | 175 | } |
  |  | 176 | return $return; |
  |  | 177 | } |
  |  | 178 | /\*\* |
  |  | 179 | \* Handle a dispatched request. |
  | 152 | 180 | \* |
  | 153 | 181 | \* Override this method to perform any actions required |
* ## [wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php](/changeset/2911237/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?old=2749070&old_path=wp-security-audit-log%2Ftrunk%2Fthird-party%2Fvendor%2Fclasses%2Fwp-background-process.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2749070#L37 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2911237#L37 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 37 | 37 | \* Cron\_hook\_identifier |
  | 38 | 38 | \* |
  | 39 |  | \* @var ~~mixed~~ |
  |  | 39 | \* @var string |
  | 40 | 40 | \* @access protected |
  | 41 | 41 | \*/ |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2749070#L44) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2911237#L44) |  |
  | 44 | 44 | \* Cron\_interval\_identifier |
  | 45 | 45 | \* |
  | 46 |  | \* @var ~~mixed~~ |
  |  | 46 | \* @var string |
  | 47 | 47 | \* @access protected |
  | 48 | 48 | \*/ |
  | 49 | 49 | protected $cron\_interval\_identifier; |
  | 50 | 50 | /\*\* |
  | 51 |  | \* Initiate new background process |
  |  | 51 | \* The status set when process is cancelling. |
  |  | 52 | \* |
  |  | 53 | \* @var int |
  |  | 54 | \*/ |
  |  | 55 | const STATUS\_CANCELLED = 1; |
  |  | 56 | /\*\* |
  |  | 57 | \* The status set when process is paused or pausing. |
  |  | 58 | \* |
  |  | 59 | \* @var int; |
  |  | 60 | \*/ |
  |  | 61 | const STATUS\_PAUSED = 2; |
  |  | 62 | /\*\* |
  |  | 63 | \* Initiate new background process. |
  | 52 | 64 | \*/ |
  | 53 | 65 | public function \_\_construct() |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2749070#L60) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2911237#L72) |  |
  | 60 | 72 | } |
  | 61 | 73 | /\*\* |
  | 62 |  | \* ~~Dispatch~~ |
  |  | 74 | \* Schedule the cron healthcheck and dispatch an async request to start processing the queue. |
  | 63 | 75 | \* |
  | 64 | 76 | \* @access public |
  | 65 |  | \* @return ~~void~~ |
  |  | 77 | \* @return array|WP\_Error|false HTTP Response array, WP\_Error on failure, or false if not attempted. |
  | 66 | 78 | \*/ |
  | 67 | 79 | public function dispatch() |
  | 68 | 80 | { |
  |  | 81 | if ($this->is\_processing()) { |
  |  | 82 | // Process already running. |
  |  | 83 | return \false; |
  |  | 84 | } |
  | 69 | 85 | // Schedule the cron healthcheck. |
  | 70 | 86 | $this->schedule\_event(); |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2749070#L73) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2911237#L89) |  |
  | 73 | 89 | } |
  | 74 | 90 | /\*\* |
  | 75 |  | \* Push to queue |
  |  | 91 | \* Push to the queue. |
  |  | 92 | \* |
  |  | 93 | \* Note, save must be called in order to persist queued items to a batch for processing. |
  | 76 | 94 | \* |
  | 77 | 95 | \* @param mixed $data Data. |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2749070#L85) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2911237#L103) |  |
  | 85 | 103 | } |
  | 86 | 104 | /\*\* |
  | 87 |  | \* Save ~~queue~~ |
  |  | 105 | \* Save the queued items for future processing. |
  | 88 | 106 | \* |
  | 89 | 107 | \* @return $this |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2749070#L95) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2911237#L113) |  |
  | 95 | 113 | update\_site\_option($key, $this->data); |
  | 96 | 114 | } |
  |  | 115 | // Clean out data so that new data isn't prepended with closed session's data. |
  |  | 116 | $this->data = array(); |
  | 97 | 117 | return $this; |
  | 98 | 118 | } |
  | 99 | 119 | /\*\* |
  | 100 |  | \* Update ~~queue~~ |
  |  | 120 | \* Update a batch's queued items. |
  | 101 | 121 | \* |
  | 102 | 122 | \* @param string $key  Key. |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2749070#L113) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2911237#L133) |  |
  | 113 | 133 | } |
  | 114 | 134 | /\*\* |
  | 115 |  | \* Delete ~~queue~~ |
  |  | 135 | \* Delete a batch of queued items. |
  | 116 | 136 | \* |
  | 117 | 137 | \* @param string $key Key. |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2749070#L125) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2911237#L145) |  |
  | 125 | 145 | } |
  | 126 | 146 | /\*\* |
  | 127 |  | \* Generate key |
  |  | 147 | \* Delete entire job queue. |
  |  | 148 | \*/ |
  |  | 149 | public function delete\_all() |
  |  | 150 | { |
  |  | 151 | $batches = $this->get\_batches(); |
  |  | 152 | foreach ($batches as $batch) { |
  |  | 153 | $this->delete($batch->key); |
  |  | 154 | } |
  |  | 155 | delete\_site\_option($this->get\_status\_key()); |
  |  | 156 | $this->cancelled(); |
  |  | 157 | } |
  |  | 158 | /\*\* |
  |  | 159 | \* Cancel job on next batch. |
  |  | 160 | \*/ |
  |  | 161 | public function cancel() |
  |  | 162 | { |
  |  | 163 | update\_site\_option($this->get\_status\_key(), self::STATUS\_CANCELLED); |
  |  | 164 | // Just in case the job was paused at the time. |
  |  | 165 | $this->dispatch(); |
  |  | 166 | } |
  |  | 167 | /\*\* |
  |  | 168 | \* Has the process been cancelled? |
  |  | 169 | \* |
  |  | 170 | \* @return bool |
  |  | 171 | \*/ |
  |  | 172 | public function is\_cancelled() |
  |  | 173 | { |
  |  | 174 | $status = get\_site\_option($this->get\_status\_key(), 0); |
  |  | 175 | if (absint($status) === self::STATUS\_CANCELLED) { |
  |  | 176 | return \true; |
  |  | 177 | } |
  |  | 178 | return \false; |
  |  | 179 | } |
  |  | 180 | /\*\* |
  |  | 181 | \* Called when background process has been cancelled. |
  |  | 182 | \*/ |
  |  | 183 | protected function cancelled() |
  |  | 184 | { |
  |  | 185 | do\_action($this->identifier . '\_cancelled'); |
  |  | 186 | } |
  |  | 187 | /\*\* |
  |  | 188 | \* Pause job on next batch. |
  |  | 189 | \*/ |
  |  | 190 | public function pause() |
  |  | 191 | { |
  |  | 192 | update\_site\_option($this->get\_status\_key(), self::STATUS\_PAUSED); |
  |  | 193 | } |
  |  | 194 | /\*\* |
  |  | 195 | \* Is the job paused? |
  |  | 196 | \* |
  |  | 197 | \* @return bool |
  |  | 198 | \*/ |
  |  | 199 | public function is\_paused() |
  |  | 200 | { |
  |  | 201 | $status = get\_site\_option($this->get\_status\_key(), 0); |
  |  | 202 | if (absint($status) === self::STATUS\_PAUSED) { |
  |  | 203 | return \true; |
  |  | 204 | } |
  |  | 205 | return \false; |
  |  | 206 | } |
  |  | 207 | /\*\* |
  |  | 208 | \* Called when background process has been paused. |
  |  | 209 | \*/ |
  |  | 210 | protected function paused() |
  |  | 211 | { |
  |  | 212 | do\_action($this->identifier . '\_paused'); |
  |  | 213 | } |
  |  | 214 | /\*\* |
  |  | 215 | \* Resume job. |
  |  | 216 | \*/ |
  |  | 217 | public function resume() |
  |  | 218 | { |
  |  | 219 | delete\_site\_option($this->get\_status\_key()); |
  |  | 220 | $this->schedule\_event(); |
  |  | 221 | $this->dispatch(); |
  |  | 222 | $this->resumed(); |
  |  | 223 | } |
  |  | 224 | /\*\* |
  |  | 225 | \* Called when background process has been resumed. |
  |  | 226 | \*/ |
  |  | 227 | protected function resumed() |
  |  | 228 | { |
  |  | 229 | do\_action($this->identifier . '\_resumed'); |
  |  | 230 | } |
  |  | 231 | /\*\* |
  |  | 232 | \* Is queued? |
  |  | 233 | \* |
  |  | 234 | \* @return bool |
  |  | 235 | \*/ |
  |  | 236 | public function is\_queued() |
  |  | 237 | { |
  |  | 238 | return !$this->is\_queue\_empty(); |
  |  | 239 | } |
  |  | 240 | /\*\* |
  |  | 241 | \* Is the tool currently active, e.g. starting, working, paused or cleaning up? |
  |  | 242 | \* |
  |  | 243 | \* @return bool |
  |  | 244 | \*/ |
  |  | 245 | public function is\_active() |
  |  | 246 | { |
  |  | 247 | return $this->is\_queued() || $this->is\_processing() || $this->is\_paused() || $this->is\_cancelled(); |
  |  | 248 | } |
  |  | 249 | /\*\* |
  |  | 250 | \* Generate key for a batch. |
  | 128 | 251 | \* |
  | 129 | 252 | \* Generates a unique key based on microtime. Queue items are |
  | 130 | 253 | \* given a unique key so that they can be merged upon save. |
  | 131 | 254 | \* |
  | 132 |  | \* @param int $length Length. |
  |  | 255 | \* @param int    $length Optional max length to trim key to, defaults to 64 characters. |
  |  | 256 | \* @param string $key    Optional string to append to identifier before hash, defaults to "batch". |
  | 133 | 257 | \* |
  | 134 | 258 | \* @return string |
  | 135 | 259 | \*/ |
  | 136 |  | protected function generate\_key($length = 64) |
  | 137 |  | { |
  | 138 |  | $unique = \md5(\microtime() . ~~\~~rand()); |
  | 139 |  | $prepend = $this->identifier . '\_~~batch~~\_'; |
  |  | 260 | protected function generate\_key($length = 64, $key = 'batch') |
  |  | 261 | { |
  |  | 262 | $unique = \md5(\microtime() . wp\_rand()); |
  |  | 263 | $prepend = $this->identifier . '\_' . $key . '\_'; |
  | 140 | 264 | return \substr($prepend . $unique, 0, $length); |
  | 141 | 265 | } |
  | 142 | 266 | /\*\* |
  | 143 |  | \* Maybe process queue |
  |  | 267 | \* Get the status key. |
  |  | 268 | \* |
  |  | 269 | \* @return string |
  |  | 270 | \*/ |
  |  | 271 | protected function get\_status\_key() |
  |  | 272 | { |
  |  | 273 | return $this->identifier . '\_status'; |
  |  | 274 | } |
  |  | 275 | /\*\* |
  |  | 276 | \* Maybe process a batch of queued items. |
  | 144 | 277 | \* |
  | 145 | 278 | \* Checks whether data exists within the queue and that |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2749070#L148) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2911237#L281) |  |
  | 148 | 281 | public function maybe\_handle() |
  | 149 | 282 | { |
  | 150 |  | // Don't lock up other requests while processing |
  |  | 283 | // Don't lock up other requests while processing. |
  | 151 | 284 | \session\_write\_close(); |
  | 152 |  | if ($this->is\_process~~\_runn~~ing()) { |
  |  | 285 | if ($this->is\_processing()) { |
  | 153 | 286 | // Background process already running. |
  | 154 |  | wp\_die(); |
  |  | 287 | return $this->maybe\_wp\_die(); |
  |  | 288 | } |
  |  | 289 | if ($this->is\_cancelled()) { |
  |  | 290 | $this->clear\_scheduled\_event(); |
  |  | 291 | $this->delete\_all(); |
  |  | 292 | return $this->maybe\_wp\_die(); |
  |  | 293 | } |
  |  | 294 | if ($this->is\_paused()) { |
  |  | 295 | $this->clear\_scheduled\_event(); |
  |  | 296 | $this->paused(); |
  |  | 297 | return $this->maybe\_wp\_die(); |
  | 155 | 298 | } |
  | 156 | 299 | if ($this->is\_queue\_empty()) { |
  | 157 | 300 | // No data to process. |
  | 158 |  | wp\_die(); |
  |  | 301 | return $this->maybe\_wp\_die(); |
  | 159 | 302 | } |
  | 160 | 303 | check\_ajax\_referer($this->identifier, 'nonce'); |
  | 161 | 304 | $this->handle(); |
  | 162 |  | wp\_die(); |
  | 163 |  | } |
  | 164 |  | /\*\* |
  | 165 |  | \* Is queue empty |
  |  | 305 | return $this->maybe\_wp\_die(); |
  |  | 306 | } |
  |  | 307 | /\*\* |
  |  | 308 | \* Is queue empty? |
  | 166 | 309 | \* |
  | 167 | 310 | \* @return bool |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2749070#L169) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2911237#L312) |  |
  | 169 | 312 | protected function is\_queue\_empty() |
  | 170 | 313 | { |
  | 171 |  | global $wpdb; |
  | 172 |  | $table = $wpdb->options; |
  | 173 |  | $column = 'option\_name'; |
  | 174 |  | if (is\_multisite()) { |
  | 175 |  | $table = $wpdb->sitemeta; |
  | 176 |  | $column = 'meta\_key'; |
  | 177 |  | } |
  | 178 |  | $key = $wpdb->esc\_like($this->identifier . '\_batch\_') . '%'; |
  | 179 |  | $count = $wpdb->get\_var($wpdb->prepare("\n\t\t\tSELECT COUNT(\*)\n\t\t\tFROM {$table}\n\t\t\tWHERE {$column} LIKE %s\n\t\t", $key)); |
  | 180 |  | return $count > 0 ? \false : \true; |
  | 181 |  | } |
  | 182 |  | /\*\* |
  | 183 |  | \* Is process running |
  |  | 314 | return empty($this->get\_batch()); |
  |  | 315 | } |
  |  | 316 | /\*\* |
  |  | 317 | \* Is process running? |
  | 184 | 318 | \* |
  | 185 | 319 | \* Check whether the current process is already running |
  | 186 | 320 | \* in a background process. |
  |  | 321 | \* |
  |  | 322 | \* @return bool |
  |  | 323 | \* |
  |  | 324 | \* @deprecated 1.1.0 Superseded. |
  |  | 325 | \* @see        is\_processing() |
  | 187 | 326 | \*/ |
  | 188 | 327 | protected function is\_process\_running() |
  |  | 328 | { |
  |  | 329 | return $this->is\_processing(); |
  |  | 330 | } |
  |  | 331 | /\*\* |
  |  | 332 | \* Is the background process currently running? |
  |  | 333 | \* |
  |  | 334 | \* @return bool |
  |  | 335 | \*/ |
  |  | 336 | public function is\_processing() |
  | 189 | 337 | { |
  | 190 | 338 | if (get\_site\_transient($this->identifier . '\_process\_lock')) { |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2749070#L195) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2911237#L343) |  |
  | 195 | 343 | } |
  | 196 | 344 | /\*\* |
  | 197 |  | \* Lock process |
  |  | 345 | \* Lock process. |
  | 198 | 346 | \* |
  | 199 | 347 | \* Lock the process so that multiple instances can't run simultaneously. |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2749070#L211) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2911237#L359) |  |
  | 211 | 359 | } |
  | 212 | 360 | /\*\* |
  | 213 |  | \* Unlock process |
  |  | 361 | \* Unlock process. |
  | 214 | 362 | \* |
  | 215 | 363 | \* Unlock the process so that other instances can spawn. |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2749070#L223) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2911237#L371) |  |
  | 223 | 371 | } |
  | 224 | 372 | /\*\* |
  | 225 |  | \* Get batch |
  | 226 |  | \* |
  | 227 |  | \* @return stdClass Return the first batch ~~from the queue~~ |
  |  | 373 | \* Get batch. |
  |  | 374 | \* |
  |  | 375 | \* @return stdClass Return the first batch of queued items. |
  | 228 | 376 | \*/ |
  | 229 | 377 | protected function get\_batch() |
  | 230 | 378 | { |
  |  | 379 | return \array\_reduce($this->get\_batches(1), function ($carry, $batch) { |
  |  | 380 | return $batch; |
  |  | 381 | }, array()); |
  |  | 382 | } |
  |  | 383 | /\*\* |
  |  | 384 | \* Get batches. |
  |  | 385 | \* |
  |  | 386 | \* @param int $limit Number of batches to return, defaults to all. |
  |  | 387 | \* |
  |  | 388 | \* @return array of stdClass |
  |  | 389 | \*/ |
  |  | 390 | public function get\_batches($limit = 0) |
  |  | 391 | { |
  | 231 | 392 | global $wpdb; |
  |  | 393 | if (empty($limit) || !\is\_int($limit)) { |
  |  | 394 | $limit = 0; |
  |  | 395 | } |
  | 232 | 396 | $table = $wpdb->options; |
  | 233 | 397 | $column = 'option\_name'; |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2749070#L241) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2911237#L405) |  |
  | 241 | 405 | } |
  | 242 | 406 | $key = $wpdb->esc\_like($this->identifier . '\_batch\_') . '%'; |
  | 243 |  | $query = $wpdb->get\_row($wpdb->prepare("\n\t\t\tSELECT \*\n\t\t\tFROM {$table}\n\t\t\tWHERE {$column} LIKE %s\n\t\t\tORDER BY {$key\_column} ASC\n\t\t\tLIMIT 1\n\t\t", $key)); |
  | 244 |  | $batch = new \stdClass(); |
  | 245 |  | $batch->key = $query->{$column}; |
  | 246 |  | $batch->data = maybe\_unserialize($query->{$value\_column}); |
  | 247 |  | return $batch; |
  | 248 |  | } |
  | 249 |  | /\*\* |
  | 250 |  | \* Handle |
  |  | 407 | $sql = ' |
  |  | 408 | SELECT \* |
  |  | 409 | FROM ' . $table . ' |
  |  | 410 | WHERE ' . $column . ' LIKE %s |
  |  | 411 | ORDER BY ' . $key\_column . ' ASC |
  |  | 412 | '; |
  |  | 413 | $args = array($key); |
  |  | 414 | if (!empty($limit)) { |
  |  | 415 | $sql .= ' LIMIT %d'; |
  |  | 416 | $args[] = $limit; |
  |  | 417 | } |
  |  | 418 | $items = $wpdb->get\_results($wpdb->prepare($sql, $args)); |
  |  | 419 | // phpcs:ignore WordPress.DB.PreparedSQL.NotPrepared |
  |  | 420 | $batches = array(); |
  |  | 421 | if (!empty($items)) { |
  |  | 422 | $batches = \array\_map(function ($item) use($column, $value\_column) { |
  |  | 423 | $batch = new \stdClass(); |
  |  | 424 | $batch->key = $item->{$column}; |
  |  | 425 | $batch->data = maybe\_unserialize($item->{$value\_column}); |
  |  | 426 | return $batch; |
  |  | 427 | }, $items); |
  |  | 428 | } |
  |  | 429 | return $batches; |
  |  | 430 | } |
  |  | 431 | /\*\* |
  |  | 432 | \* Handle a dispatched request. |
  | 251 | 433 | \* |
  | 252 | 434 | \* Pass each queue item to the task handler, while remaining |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2749070#L256) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2911237#L438) |  |
  | 256 | 438 | { |
  | 257 | 439 | $this->lock\_process(); |
  |  | 440 | /\*\* |
  |  | 441 | \* Number of seconds to sleep between batches. Defaults to 0 seconds, minimum 0. |
  |  | 442 | \* |
  |  | 443 | \* @param int $seconds |
  |  | 444 | \*/ |
  |  | 445 | $throttle\_seconds = \max(0, apply\_filters($this->identifier . '\_seconds\_between\_batches', apply\_filters($this->prefix . '\_seconds\_between\_batches', 0))); |
  | 258 | 446 | do { |
  | 259 | 447 | $batch = $this->get\_batch(); |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2749070#L265) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2911237#L453) |  |
  | 265 | 453 | unset($batch->data[$key]); |
  | 266 | 454 | } |
  |  | 455 | // Keep the batch up to date while processing it. |
  |  | 456 | if (!empty($batch->data)) { |
  |  | 457 | $this->update($batch->key, $batch->data); |
  |  | 458 | } |
  |  | 459 | // Let the server breathe a little. |
  |  | 460 | \sleep($throttle\_seconds); |
  | 267 | 461 | if ($this->time\_exceeded() || $this->memory\_exceeded()) { |
  | 268 | 462 | // Batch limits reached. |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2749070#L270) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2911237#L464) |  |
  | 270 | 464 | } |
  | 271 | 465 | } |
  | 272 |  | // Update or delete current batch. |
  | 273 |  | if (!empty($batch->data)) { |
  | 274 |  | $this->update($batch->key, $batch->data); |
  | 275 |  | } else { |
  |  | 466 | // Delete current batch if fully processed. |
  |  | 467 | if (empty($batch->data)) { |
  | 276 | 468 | $this->delete($batch->key); |
  | 277 | 469 | } |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2749070#L284) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2911237#L476) |  |
  | 284 | 476 | $this->complete(); |
  | 285 | 477 | } |
  | 286 |  | wp\_die(); |
  | 287 |  | } |
  | 288 |  | /\*\* |
  | 289 |  | \* Memory exceeded |
  |  | 478 | return $this->maybe\_wp\_die(); |
  |  | 479 | } |
  |  | 480 | /\*\* |
  |  | 481 | \* Memory exceeded? |
  | 290 | 482 | \* |
  | 291 | 483 | \* Ensures the batch process never exceeds 90% |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2749070#L306) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2911237#L498) |  |
  | 306 | 498 | } |
  | 307 | 499 | /\*\* |
  | 308 |  | \* Get memory limit |
  |  | 500 | \* Get memory limit in bytes. |
  | 309 | 501 | \* |
  | 310 | 502 | \* @return int |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2749070#L325) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2911237#L517) |  |
  | 325 | 517 | } |
  | 326 | 518 | /\*\* |
  | 327 |  | \* Time ~~exceeded.~~ |
  |  | 519 | \* Time limit exceeded? |
  | 328 | 520 | \* |
  | 329 | 521 | \* Ensures the batch never exceeds a sensible time limit. |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2749070#L343) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2911237#L535) |  |
  | 343 | 535 | } |
  | 344 | 536 | /\*\* |
  | 345 |  | \* Complete. |
  |  | 537 | \* Complete processing. |
  | 346 | 538 | \* |
  | 347 | 539 | \* Override if applicable, but ensure that the below actions are |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2749070#L350) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2911237#L542) |  |
  | 350 | 542 | protected function complete() |
  | 351 | 543 | { |
  | 352 |  | // Unschedule the cron healthcheck. |
  |  | 544 | delete\_site\_option($this->get\_status\_key()); |
  |  | 545 | // Remove the cron healthcheck job from the cron schedule. |
  | 353 | 546 | $this->clear\_scheduled\_event(); |
  | 354 |  | } |
  | 355 |  | /\*\* |
  | 356 |  | \* Schedule cron healthcheck |
  |  | 547 | $this->completed(); |
  |  | 548 | } |
  |  | 549 | /\*\* |
  |  | 550 | \* Called when background process has completed. |
  |  | 551 | \*/ |
  |  | 552 | protected function completed() |
  |  | 553 | { |
  |  | 554 | do\_action($this->identifier . '\_completed'); |
  |  | 555 | } |
  |  | 556 | /\*\* |
  |  | 557 | \* Schedule the cron healthcheck job. |
  | 357 | 558 | \* |
  | 358 | 559 | \* @access public |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2749070#L364) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2911237#L565) |  |
  | 364 | 565 | public function schedule\_cron\_healthcheck($schedules) |
  | 365 | 566 | { |
  | 366 |  | $interval = apply\_filters($this->~~identifier . '\_cron\_interval'~~, 5); |
  |  | 567 | $interval = apply\_filters($this->cron\_interval\_identifier, 5); |
  | 367 | 568 | if (\property\_exists($this, 'cron\_interval')) { |
  | 368 |  | $interval = apply\_filters($this->identifier . '\_cron\_interval', $this->cron\_interval); |
  | 369 |  | } |
  | 370 |  | // Adds every 5 minutes to the existing schedules. |
  | 371 |  | $schedules[$this->identifier . '\_cron\_interval'] = array('interval' => \MINUTE\_IN\_SECONDS \* $interval, 'display' => \sprintf(\_\_('Every %d Minutes'), $interval)); |
  |  | 569 | $interval = apply\_filters($this->cron\_interval\_identifier, $this->cron\_interval); |
  |  | 570 | } |
  |  | 571 | if (1 === $interval) { |
  |  | 572 | $display = \_\_('Every Minute'); |
  |  | 573 | } else { |
  |  | 574 | $display = \sprintf(\_\_('Every %d Minutes'), $interval); |
  |  | 575 | } |
  |  | 576 | // Adds an "Every NNN Minute(s)" schedule to the existing cron schedules. |
  |  | 577 | $schedules[$this->cron\_interval\_identifier] = array('interval' => \MINUTE\_IN\_SECONDS \* $interval, 'display' => $display); |
  | 372 | 578 | return $schedules; |
  | 373 | 579 | } |
  | 374 | 580 | /\*\* |
  | 375 |  | \* Handle cron healthcheck |
  |  | 581 | \* Handle cron healthcheck event. |
  | 376 | 582 | \* |
  | 377 | 583 | \* Restart the background process if not already running |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2749070#L380) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2911237#L586) |  |
  | 380 | 586 | public function handle\_cron\_healthcheck() |
  | 381 | 587 | { |
  | 382 |  | if ($this->is\_process~~\_runn~~ing()) { |
  |  | 588 | if ($this->is\_processing()) { |
  | 383 | 589 | // Background process already running. |
  | 384 | 590 | exit; |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2749070#L389) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2911237#L595) |  |
  | 389 | 595 | exit; |
  | 390 | 596 | } |
  | 391 |  | $this->handle(); |
  | 392 |  | exit; |
  | 393 |  | } |
  | 394 |  | /\*\* |
  | 395 |  | \* Schedule event |
  |  | 597 | $this->dispatch(); |
  |  | 598 | } |
  |  | 599 | /\*\* |
  |  | 600 | \* Schedule the cron healthcheck event. |
  | 396 | 601 | \*/ |
  | 397 | 602 | protected function schedule\_event() |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2749070#L402) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2911237#L607) |  |
  | 402 | 607 | } |
  | 403 | 608 | /\*\* |
  | 404 |  | \* Clear scheduled ~~event~~ |
  |  | 609 | \* Clear scheduled cron healthcheck event. |
  | 405 | 610 | \*/ |
  | 406 | 611 | protected function clear\_scheduled\_event() |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2749070#L412) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/classes/wp-background-process.php?rev=2911237#L617) |  |
  | 412 | 617 | } |
  | 413 | 618 | /\*\* |
  | 414 |  | \* Cancel Process |
  | 415 |  | \* |
  | 416 |  | \* Stop processing queue items, clear cronjob and delete batch. |
  | 417 |  | \* |
  |  | 619 | \* Cancel the background process. |
  |  | 620 | \* |
  |  | 621 | \* Stop processing queue items, clear cron job and delete batch. |
  |  | 622 | \* |
  |  | 623 | \* @deprecated 1.1.0 Superseded. |
  |  | 624 | \* @see        cancel() |
  | 418 | 625 | \*/ |
  | 419 | 626 | public function cancel\_process() |
  | 420 | 627 | { |
  | 421 |  | if (!$this->is\_queue\_empty()) { |
  | 422 |  | $batch = $this->get\_batch(); |
  | 423 |  | $this->delete($batch->key); |
  | 424 |  | wp\_clear\_scheduled\_hook($this->cron\_hook\_identifier); |
  | 425 |  | } |
  | 426 |  | } |
  | 427 |  | /\*\* |
  | 428 |  | \* Task |
  |  | 628 | $this->cancel(); |
  |  | 629 | } |
  |  | 630 | /\*\* |
  |  | 631 | \* Perform task with queued item. |
  | 429 | 632 | \* |
  | 430 | 633 | \* Override this method to perform any actions required on each |
* ## [wp-security-audit-log/trunk/third-party/vendor/composer/ClassLoader.php](/changeset/2911237/wp-security-audit-log/trunk/third-party/vendor/composer/ClassLoader.php?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Fthird-party%2Fvendor%2Fcomposer%2FClassLoader.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/third-party/vendor/composer/ClassLoader.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/third-party/vendor/composer/ClassLoader.php?rev=2897171#L43 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/third-party/vendor/composer/ClassLoader.php?rev=2911237#L43 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 43 | 43 | class ClassLoader |
  | 44 | 44 | { |
  | 45 |  | ~~/\*\* @var \Closure(string):void \*/~~ |
  | 46 |  | ~~private static $includeFile;~~ |
  | 47 |  |  |
  | 48 | 45 | /\*\* @var ?string \*/ |
  | 49 | 46 | private $vendorDir; |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/composer/ClassLoader.php?rev=2897171#L110) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/composer/ClassLoader.php?rev=2911237#L107) |  |
  | 110 | 107 | { |
  | 111 | 108 | $this->vendorDir = $vendorDir; |
  | 112 |  | ~~self::initializeIncludeClosure();~~ |
  | 113 | 109 | } |
  | 114 | 110 |  |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/composer/ClassLoader.php?rev=2897171#L430) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/composer/ClassLoader.php?rev=2911237#L426) |  |
  | 430 | 426 | { |
  | 431 | 427 | if ($file = $this->findFile($class)) { |
  | 432 |  | $includeFile = self::$includeFile; |
  | 433 |  | $includeFile($file); |
  |  | 428 | includeFile($file); |
  | 434 | 429 |  |
  | 435 | 430 | return true; |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/composer/ClassLoader.php?rev=2897171#L561) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/composer/ClassLoader.php?rev=2911237#L556) |  |
  | 561 | 556 | return false; |
  | 562 | 557 | } |
  | 563 |  |  |
  | 564 |  | ~~/\*\*~~ |
  | 565 |  | ~~\* @return void~~ |
  | 566 |  | ~~\*/~~ |
  | 567 |  | ~~private static function initializeIncludeClosure()~~ |
  | 568 |  | ~~{~~ |
  | 569 |  | ~~if (self::$includeFile !== null) {~~ |
  | 570 |  | ~~return;~~ |
  | 571 |  | ~~}~~ |
  | 572 |  |  |
  | 573 |  | ~~/\*\*~~ |
  | 574 |  | ~~\* Scope isolated include.~~ |
  | 575 |  | ~~\*~~ |
  | 576 |  | ~~\* Prevents access to $this/self from included files.~~ |
  | 577 |  | ~~\*~~ |
  | 578 |  | ~~\* @param  string $file~~ |
  | 579 |  | ~~\* @return void~~ |
  | 580 |  | ~~\*/~~ |
  | 581 |  | ~~self::$includeFile = \Closure::bind(static function($file) {~~ |
  | 582 |  | ~~include $file;~~ |
  | 583 |  | ~~}, null, null);~~ |
  | 584 |  | ~~}~~ |
  | 585 | 558 | } |
  |  | 559 |  |
  |  | 560 | /\*\* |
  |  | 561 | \* Scope isolated include. |
  |  | 562 | \* |
  |  | 563 | \* Prevents access to $this/self from included files. |
  |  | 564 | \* |
  |  | 565 | \* @param  string $file |
  |  | 566 | \* @return void |
  |  | 567 | \* @private |
  |  | 568 | \*/ |
  |  | 569 | function includeFile($file) |
  |  | 570 | { |
  |  | 571 | include $file; |
  |  | 572 | } |
* ## [wp-security-audit-log/trunk/third-party/vendor/composer/autoload\_real.php](/changeset/2911237/wp-security-audit-log/trunk/third-party/vendor/composer/autoload_real.php?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Fthird-party%2Fvendor%2Fcomposer%2Fautoload_real.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/third-party/vendor/composer/autoload_real.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/third-party/vendor/composer/autoload_real.php?rev=2897171#L3 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/third-party/vendor/composer/autoload_real.php?rev=2911237#L3 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | // autoload\_real.php @generated by Composer |
  | 4 | 4 |  |
  | 5 |  | class ComposerAutoloaderInit~~201f86ba52b29dc488d34f8e732c3d2f~~ |
  |  | 5 | class ComposerAutoloaderInite241c7387a5aac99f296110be12551fd |
  | 6 | 6 | { |
  | 7 | 7 | private static $loader; |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/composer/autoload_real.php?rev=2897171#L23) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/composer/autoload_real.php?rev=2911237#L23) |  |
  | 23 | 23 | } |
  | 24 | 24 |  |
  | 25 |  | spl\_autoload\_register(array('ComposerAutoloaderInit~~201f86ba52b29dc488d34f8e732c3d2f~~', 'loadClassLoader'), true, true); |
  |  | 25 | spl\_autoload\_register(array('ComposerAutoloaderInite241c7387a5aac99f296110be12551fd', 'loadClassLoader'), true, true); |
  | 26 | 26 | self::$loader = $loader = new \Composer\Autoload\ClassLoader(\dirname(\_\_DIR\_\_)); |
  | 27 |  | spl\_autoload\_unregister(array('ComposerAutoloaderInit~~201f86ba52b29dc488d34f8e732c3d2f~~', 'loadClassLoader')); |
  |  | 27 | spl\_autoload\_unregister(array('ComposerAutoloaderInite241c7387a5aac99f296110be12551fd', 'loadClassLoader')); |
  | 28 | 28 |  |
  | 29 | 29 | require \_\_DIR\_\_ . '/autoload\_static.php'; |
  | 30 |  | call\_user\_func(\Composer\Autoload\ComposerStaticInit~~201f86ba52b29dc488d34f8e732c3d2f~~::getInitializer($loader)); |
  |  | 30 | call\_user\_func(\Composer\Autoload\ComposerStaticInite241c7387a5aac99f296110be12551fd::getInitializer($loader)); |
  | 31 | 31 |  |
  | 32 | 32 | $loader->setClassMapAuthoritative(true); |
* ## [wp-security-audit-log/trunk/third-party/vendor/composer/autoload\_static.php](/changeset/2911237/wp-security-audit-log/trunk/third-party/vendor/composer/autoload_static.php?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Fthird-party%2Fvendor%2Fcomposer%2Fautoload_static.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/third-party/vendor/composer/autoload_static.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/third-party/vendor/composer/autoload_static.php?rev=2897171#L5 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/third-party/vendor/composer/autoload_static.php?rev=2911237#L5 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | namespace Composer\Autoload; |
  | 6 | 6 |  |
  | 7 |  | class ComposerStaticInit~~201f86ba52b29dc488d34f8e732c3d2f~~ |
  |  | 7 | class ComposerStaticInite241c7387a5aac99f296110be12551fd |
  | 8 | 8 | { |
  | 9 | 9 | public static $classMap = array ( |
  | […](/browser/wp-security-audit-log/trunk/third-party/vendor/composer/autoload_static.php?rev=2897171#L16) | […](/browser/wp-security-audit-log/trunk/third-party/vendor/composer/autoload_static.php?rev=2911237#L16) |  |
  | 16 | 16 | { |
  | 17 | 17 | return \Closure::bind(function () use ($loader) { |
  | 18 |  | $loader->classMap = ComposerStaticInit~~201f86ba52b29dc488d34f8e732c3d2f~~::$classMap; |
  |  | 18 | $loader->classMap = ComposerStaticInite241c7387a5aac99f296110be12551fd::$classMap; |
  | 19 | 19 |  |
  | 20 | 20 | }, null, ClassLoader::class); |
* ## [wp-security-audit-log/trunk/third-party/vendor/wp-background-processing.php](/changeset/2911237/wp-security-audit-log/trunk/third-party/vendor/wp-background-processing.php?old=2749070&old_path=wp-security-audit-log%2Ftrunk%2Fthird-party%2Fvendor%2Fwp-background-processing.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/third-party/vendor/wp-background-processing.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/third-party/vendor/wp-background-processing.php?rev=2749070#L10 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/third-party/vendor/wp-background-processing.php?rev=2911237#L10 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 10 | 10 | /\* |
  | 11 | 11 | Plugin Name: WP Background Processing |
  | 12 |  | Plugin URI: https://github.com/~~A5hleyRich~~/wp-background-processing |
  |  | 12 | Plugin URI: https://github.com/deliciousbrains/wp-background-processing |
  | 13 | 13 | Description: Asynchronous requests and background processing in WordPress. |
  | 14 | 14 | Author: Delicious Brains Inc. |
  | 15 | 15 | Version: 1.0 |
  | 16 | 16 | Author URI: https://deliciousbrains.com/ |
  | 17 |  | GitHub Plugin URI: https://github.com/~~A5hleyRich~~/wp-background-processing |
  |  | 17 | GitHub Plugin URI: https://github.com/deliciousbrains/wp-background-processing |
  | 18 | 18 | GitHub Branch: master |
  | 19 | 19 | \*/ |
* ## [wp-security-audit-log/trunk/vendor/autoload.php](/changeset/2911237/wp-security-audit-log/trunk/vendor/autoload.php?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Fvendor%2Fautoload.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/vendor/autoload.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/vendor/autoload.php?rev=2897171#L4 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/vendor/autoload.php?rev=2911237#L4 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 |  |
  | 5 | 5 | if (PHP\_VERSION\_ID < 50600) { |
  | 6 |  | if (!headers\_sent()) { |
  | 7 |  | header('HTTP/1.1 500 Internal Server Error'); |
  | 8 |  | } |
  | 9 |  | $err = 'Composer 2.3.0 dropped support for autoloading on PHP <5.6 and you are running '.PHP\_VERSION.', please upgrade PHP or use Composer 2.2 LTS via "composer self-update --2.2". Aborting.'.PHP\_EOL; |
  | 10 |  | if (!ini\_get('display\_errors')) { |
  | 11 |  | if (PHP\_SAPI === 'cli' || PHP\_SAPI === 'phpdbg') { |
  | 12 |  | fwrite(STDERR, $err); |
  | 13 |  | } elseif (!headers\_sent()) { |
  | 14 |  | echo $err; |
  | 15 |  | } |
  | 16 |  | } |
  | 17 |  | trigger\_error( |
  | 18 |  | $err, |
  | 19 |  | E\_USER\_ERROR |
  | 20 |  | ); |
  |  | 6 | echo 'Composer 2.3.0 dropped support for autoloading on PHP <5.6 and you are running '.PHP\_VERSION.', please upgrade PHP or use Composer 2.2 LTS via "composer self-update --2.2". Aborting.'.PHP\_EOL; |
  |  | 7 | exit(1); |
  | 21 | 8 | } |
  | 22 | 9 |  |
  | 23 | 10 | require\_once \_\_DIR\_\_ . '/composer/autoload\_real.php'; |
  | 24 | 11 |  |
  | 25 |  | return ComposerAutoloaderInit~~d9d3dcc1572b67d66b72324849a8befc~~::getLoader(); |
  |  | 12 | return ComposerAutoloaderInita2507426f604506cb47388e3fa33b5f5::getLoader(); |
* ## [wp-security-audit-log/trunk/vendor/composer/ClassLoader.php](/changeset/2911237/wp-security-audit-log/trunk/vendor/composer/ClassLoader.php?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Fvendor%2Fcomposer%2FClassLoader.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/vendor/composer/ClassLoader.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/vendor/composer/ClassLoader.php?rev=2897171#L43 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/vendor/composer/ClassLoader.php?rev=2911237#L43 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 43 | 43 | class ClassLoader |
  | 44 | 44 | { |
  | 45 |  | ~~/\*\* @var \Closure(string):void \*/~~ |
  | 46 |  | ~~private static $includeFile;~~ |
  | 47 |  |  |
  | 48 | 45 | /\*\* @var ?string \*/ |
  | 49 | 46 | private $vendorDir; |
  | […](/browser/wp-security-audit-log/trunk/vendor/composer/ClassLoader.php?rev=2897171#L110) | […](/browser/wp-security-audit-log/trunk/vendor/composer/ClassLoader.php?rev=2911237#L107) |  |
  | 110 | 107 | { |
  | 111 | 108 | $this->vendorDir = $vendorDir; |
  | 112 |  | ~~self::initializeIncludeClosure();~~ |
  | 113 | 109 | } |
  | 114 | 110 |  |
  | […](/browser/wp-security-audit-log/trunk/vendor/composer/ClassLoader.php?rev=2897171#L430) | […](/browser/wp-security-audit-log/trunk/vendor/composer/ClassLoader.php?rev=2911237#L426) |  |
  | 430 | 426 | { |
  | 431 | 427 | if ($file = $this->findFile($class)) { |
  | 432 |  | $includeFile = self::$includeFile; |
  | 433 |  | $includeFile($file); |
  |  | 428 | includeFile($file); |
  | 434 | 429 |  |
  | 435 | 430 | return true; |
  | […](/browser/wp-security-audit-log/trunk/vendor/composer/ClassLoader.php?rev=2897171#L561) | […](/browser/wp-security-audit-log/trunk/vendor/composer/ClassLoader.php?rev=2911237#L556) |  |
  | 561 | 556 | return false; |
  | 562 | 557 | } |
  | 563 |  |  |
  | 564 |  | ~~/\*\*~~ |
  | 565 |  | ~~\* @return void~~ |
  | 566 |  | ~~\*/~~ |
  | 567 |  | ~~private static function initializeIncludeClosure()~~ |
  | 568 |  | ~~{~~ |
  | 569 |  | ~~if (self::$includeFile !== null) {~~ |
  | 570 |  | ~~return;~~ |
  | 571 |  | ~~}~~ |
  | 572 |  |  |
  | 573 |  | ~~/\*\*~~ |
  | 574 |  | ~~\* Scope isolated include.~~ |
  | 575 |  | ~~\*~~ |
  | 576 |  | ~~\* Prevents access to $this/self from included files.~~ |
  | 577 |  | ~~\*~~ |
  | 578 |  | ~~\* @param  string $file~~ |
  | 579 |  | ~~\* @return void~~ |
  | 580 |  | ~~\*/~~ |
  | 581 |  | ~~self::$includeFile = \Closure::bind(static function($file) {~~ |
  | 582 |  | ~~include $file;~~ |
  | 583 |  | ~~}, null, null);~~ |
  | 584 |  | ~~}~~ |
  | 585 | 558 | } |
  |  | 559 |  |
  |  | 560 | /\*\* |
  |  | 561 | \* Scope isolated include. |
  |  | 562 | \* |
  |  | 563 | \* Prevents access to $this/self from included files. |
  |  | 564 | \* |
  |  | 565 | \* @param  string $file |
  |  | 566 | \* @return void |
  |  | 567 | \* @private |
  |  | 568 | \*/ |
  |  | 569 | function includeFile($file) |
  |  | 570 | { |
  |  | 571 | include $file; |
  |  | 572 | } |
* ## [wp-security-audit-log/trunk/vendor/composer/autoload\_classmap.php](/changeset/2911237/wp-security-audit-log/trunk/vendor/composer/autoload_classmap.php?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Fvendor%2Fcomposer%2Fautoload_classmap.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/vendor/composer/autoload_classmap.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/vendor/composer/autoload_classmap.php?rev=2897171#L12 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/vendor/composer/autoload_classmap.php?rev=2911237#L12 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 12 | 12 | 'RHtmlFormatter' => $baseDir . '/classes/Ref.php', |
  | 13 | 13 | 'RTextFormatter' => $baseDir . '/classes/Ref.php', |
  |  | 14 | 'Tools\\Select2\_WPWS' => $baseDir . '/classes/Select2/class-select2-wpws.php', |
  | 14 | 15 | 'WSAL\\Actions\\Pluging\_Installer' => $baseDir . '/classes/Actions/class-plugin-installer.php', |
  | 15 | 16 | 'WSAL\\Adapter\\WSAL\_Adapters\_MySQL\_ActiveRecord' => $baseDir . '/classes/Adapters/MySQL/ActiveRecordAdapter.php', |
* ## [wp-security-audit-log/trunk/vendor/composer/autoload\_files.php](/changeset/2911237/wp-security-audit-log/trunk/vendor/composer/autoload_files.php?old=2752642&old_path=wp-security-audit-log%2Ftrunk%2Fvendor%2Fcomposer%2Fautoload_files.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/vendor/composer/autoload_files.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/vendor/composer/autoload_files.php?rev=2752642#L8 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/vendor/composer/autoload_files.php?rev=2911237#L8 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 | return array( |
  | 9 | 9 | '2007ccaa29a9efd0493ee82176c977d1' => $vendorDir . '/wpwhitesecurity/import-export-plugin-settings/SettingsImportExport.php', |
  | 10 |  | ~~'ed8f7d07f343dc9e7c5d31cc6cd4019b' => $vendorDir . '/wpwhitesecurity/select2-wpwhitesecurity/load.php',~~ |
  | 11 | 10 | ); |
* ## [wp-security-audit-log/trunk/vendor/composer/autoload\_real.php](/changeset/2911237/wp-security-audit-log/trunk/vendor/composer/autoload_real.php?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Fvendor%2Fcomposer%2Fautoload_real.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/vendor/composer/autoload_real.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/vendor/composer/autoload_real.php?rev=2897171#L3 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/vendor/composer/autoload_real.php?rev=2911237#L3 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | // autoload\_real.php @generated by Composer |
  | 4 | 4 |  |
  | 5 |  | class ComposerAutoloaderInit~~d9d3dcc1572b67d66b72324849a8befc~~ |
  |  | 5 | class ComposerAutoloaderInita2507426f604506cb47388e3fa33b5f5 |
  | 6 | 6 | { |
  | 7 | 7 | private static $loader; |
  | […](/browser/wp-security-audit-log/trunk/vendor/composer/autoload_real.php?rev=2897171#L23) | […](/browser/wp-security-audit-log/trunk/vendor/composer/autoload_real.php?rev=2911237#L23) |  |
  | 23 | 23 | } |
  | 24 | 24 |  |
  | 25 |  | spl\_autoload\_register(array('ComposerAutoloaderInit~~d9d3dcc1572b67d66b72324849a8befc~~', 'loadClassLoader'), true, true); |
  |  | 25 | spl\_autoload\_register(array('ComposerAutoloaderInita2507426f604506cb47388e3fa33b5f5', 'loadClassLoader'), true, true); |
  | 26 | 26 | self::$loader = $loader = new \Composer\Autoload\ClassLoader(\dirname(\_\_DIR\_\_)); |
  | 27 |  | spl\_autoload\_unregister(array('ComposerAutoloaderInit~~d9d3dcc1572b67d66b72324849a8befc~~', 'loadClassLoader')); |
  |  | 27 | spl\_autoload\_unregister(array('ComposerAutoloaderInita2507426f604506cb47388e3fa33b5f5', 'loadClassLoader')); |
  | 28 | 28 |  |
  | 29 | 29 | require \_\_DIR\_\_ . '/autoload\_static.php'; |
  | 30 |  | call\_user\_func(\Composer\Autoload\ComposerStaticInit~~d9d3dcc1572b67d66b72324849a8befc~~::getInitializer($loader)); |
  |  | 30 | call\_user\_func(\Composer\Autoload\ComposerStaticInita2507426f604506cb47388e3fa33b5f5::getInitializer($loader)); |
  | 31 | 31 |  |
  | 32 | 32 | $loader->register(true); |
  | 33 | 33 |  |
  | 34 |  | $filesToLoad = \Composer\Autoload\ComposerStaticInitd9d3dcc1572b67d66b72324849a8befc::$files; |
  | 35 |  | $requireFile = \Closure::bind(static function ($fileIdentifier, $file) { |
  | 36 |  | if (empty($GLOBALS['\_\_composer\_autoload\_files'][$fileIdentifier])) { |
  | 37 |  | $GLOBALS['\_\_composer\_autoload\_files'][$fileIdentifier] = true; |
  | 38 |  |  |
  | 39 |  | require $file; |
  | 40 |  | } |
  | 41 |  | }, null, null); |
  | 42 |  | foreach ($filesToLoad as $fileIdentifier => $file) { |
  | 43 |  | $requireFile($fileIdentifier, $file); |
  |  | 34 | $includeFiles = \Composer\Autoload\ComposerStaticInita2507426f604506cb47388e3fa33b5f5::$files; |
  |  | 35 | foreach ($includeFiles as $fileIdentifier => $file) { |
  |  | 36 | composerRequirea2507426f604506cb47388e3fa33b5f5($fileIdentifier, $file); |
  | 44 | 37 | } |
  | 45 | 38 |  |
  | […](/browser/wp-security-audit-log/trunk/vendor/composer/autoload_real.php?rev=2897171#L47) | […](/browser/wp-security-audit-log/trunk/vendor/composer/autoload_real.php?rev=2911237#L40) |  |
  | 47 | 40 | } |
  | 48 | 41 | } |
  |  | 42 |  |
  |  | 43 | /\*\* |
  |  | 44 | \* @param string $fileIdentifier |
  |  | 45 | \* @param string $file |
  |  | 46 | \* @return void |
  |  | 47 | \*/ |
  |  | 48 | function composerRequirea2507426f604506cb47388e3fa33b5f5($fileIdentifier, $file) |
  |  | 49 | { |
  |  | 50 | if (empty($GLOBALS['\_\_composer\_autoload\_files'][$fileIdentifier])) { |
  |  | 51 | $GLOBALS['\_\_composer\_autoload\_files'][$fileIdentifier] = true; |
  |  | 52 |  |
  |  | 53 | require $file; |
  |  | 54 | } |
  |  | 55 | } |
* ## [wp-security-audit-log/trunk/vendor/composer/autoload\_static.php](/changeset/2911237/wp-security-audit-log/trunk/vendor/composer/autoload_static.php?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Fvendor%2Fcomposer%2Fautoload_static.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/vendor/composer/autoload_static.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/vendor/composer/autoload_static.php?rev=2897171#L5 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/vendor/composer/autoload_static.php?rev=2911237#L5 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | namespace Composer\Autoload; |
  | 6 | 6 |  |
  | 7 |  | class ComposerStaticInit~~d9d3dcc1572b67d66b72324849a8befc~~ |
  |  | 7 | class ComposerStaticInita2507426f604506cb47388e3fa33b5f5 |
  | 8 | 8 | { |
  | 9 | 9 | public static $files = array ( |
  | 10 | 10 | '2007ccaa29a9efd0493ee82176c977d1' => \_\_DIR\_\_ . '/..' . '/wpwhitesecurity/import-export-plugin-settings/SettingsImportExport.php', |
  | 11 |  | ~~'ed8f7d07f343dc9e7c5d31cc6cd4019b' => \_\_DIR\_\_ . '/..' . '/wpwhitesecurity/select2-wpwhitesecurity/load.php',~~ |
  | 12 | 11 | ); |
  | 13 | 12 |  |
  | […](/browser/wp-security-audit-log/trunk/vendor/composer/autoload_static.php?rev=2897171#L37) | […](/browser/wp-security-audit-log/trunk/vendor/composer/autoload_static.php?rev=2911237#L36) |  |
  | 37 | 36 | 'RHtmlFormatter' => \_\_DIR\_\_ . '/../..' . '/classes/Ref.php', |
  | 38 | 37 | 'RTextFormatter' => \_\_DIR\_\_ . '/../..' . '/classes/Ref.php', |
  |  | 38 | 'Tools\\Select2\_WPWS' => \_\_DIR\_\_ . '/../..' . '/classes/Select2/class-select2-wpws.php', |
  | 39 | 39 | 'WSAL\\Actions\\Pluging\_Installer' => \_\_DIR\_\_ . '/../..' . '/classes/Actions/class-plugin-installer.php', |
  | 40 | 40 | 'WSAL\\Adapter\\WSAL\_Adapters\_MySQL\_ActiveRecord' => \_\_DIR\_\_ . '/../..' . '/classes/Adapters/MySQL/ActiveRecordAdapter.php', |
  | […](/browser/wp-security-audit-log/trunk/vendor/composer/autoload_static.php?rev=2897171#L179) | […](/browser/wp-security-audit-log/trunk/vendor/composer/autoload_static.php?rev=2911237#L179) |  |
  | 179 | 179 | { |
  | 180 | 180 | return \Closure::bind(function () use ($loader) { |
  | 181 |  | $loader->prefixLengthsPsr4 = ComposerStaticInit~~d9d3dcc1572b67d66b72324849a8befc~~::$prefixLengthsPsr4; |
  | 182 |  | $loader->prefixDirsPsr4 = ComposerStaticInit~~d9d3dcc1572b67d66b72324849a8befc~~::$prefixDirsPsr4; |
  | 183 |  | $loader->classMap = ComposerStaticInit~~d9d3dcc1572b67d66b72324849a8befc~~::$classMap; |
  |  | 181 | $loader->prefixLengthsPsr4 = ComposerStaticInita2507426f604506cb47388e3fa33b5f5::$prefixLengthsPsr4; |
  |  | 182 | $loader->prefixDirsPsr4 = ComposerStaticInita2507426f604506cb47388e3fa33b5f5::$prefixDirsPsr4; |
  |  | 183 | $loader->classMap = ComposerStaticInita2507426f604506cb47388e3fa33b5f5::$classMap; |
  | 184 | 184 |  |
  | 185 | 185 | }, null, ClassLoader::class); |
* ## [wp-security-audit-log/trunk/vendor/composer/installed.json](/changeset/2911237/wp-security-audit-log/trunk/vendor/composer/installed.json?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Fvendor%2Fcomposer%2Finstalled.json "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/vendor/composer/installed.json")

  | [r2897171](/browser/wp-security-audit-log/trunk/vendor/composer/installed.json?rev=2897171#L3 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/vendor/composer/installed.json?rev=2911237#L3 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | { |
  | 4 | 4 | "name": "deliciousbrains/wp-background-processing", |
  | 5 |  | "version": "1.~~0.2~~", |
  | 6 |  | "version\_normalized": "1.~~0.2~~.0", |
  |  | 5 | "version": "1.1.0", |
  |  | 6 | "version\_normalized": "1.1.0.0", |
  | 7 | 7 | "source": { |
  | 8 | 8 | "type": "git", |
  | 9 | 9 | "url": "https://github.com/deliciousbrains/wp-background-processing.git", |
  | 10 |  | "reference": "~~2cbee1abd1b49e1133cd8f611df4d4fc5a8b9800~~" |
  |  | 10 | "reference": "d5ef95cecba7f792ddca3e3bd70ebfb90dc4996d" |
  | 11 | 11 | }, |
  | 12 | 12 | "dist": { |
  | 13 | 13 | "type": "zip", |
  | 14 |  | "url": "https://api.github.com/repos/deliciousbrains/wp-background-processing/zipball/~~2cbee1abd1b49e1133cd8f611df4d4fc5a8b9800~~", |
  | 15 |  | "reference": "~~2cbee1abd1b49e1133cd8f611df4d4fc5a8b9800~~", |
  |  | 14 | "url": "https://api.github.com/repos/deliciousbrains/wp-background-processing/zipball/d5ef95cecba7f792ddca3e3bd70ebfb90dc4996d", |
  |  | 15 | "reference": "d5ef95cecba7f792ddca3e3bd70ebfb90dc4996d", |
  | 16 | 16 | "shasum": "" |
  | 17 | 17 | }, |
  | 18 | 18 | "require": { |
  | 19 |  | "php": ">=5.2" |
  |  | 19 | "php": ">=5.6" |
  |  | 20 | }, |
  |  | 21 | "require-dev": { |
  |  | 22 | "phpcompatibility/phpcompatibility-wp": "\*", |
  |  | 23 | "phpunit/phpunit": "^8.0", |
  |  | 24 | "spryker/code-sniffer": "^0.17.18", |
  |  | 25 | "wp-coding-standards/wpcs": "^2.3", |
  |  | 26 | "yoast/phpunit-polyfills": "^1.0" |
  | 20 | 27 | }, |
  | 21 | 28 | "suggest": { |
  | 22 | 29 | "coenjacobs/mozart": "Easily wrap this library with your own prefix, to prevent collisions when multiple plugins use this library" |
  | 23 | 30 | }, |
  | 24 |  | "time": "202~~0-07-31T07:00:11~~+00:00", |
  |  | 31 | "time": "2023-04-18T12:32:25+00:00", |
  | 25 | 32 | "type": "library", |
  | 26 | 33 | "installation-source": "dist", |
  | […](/browser/wp-security-audit-log/trunk/vendor/composer/installed.json?rev=2897171#L43) | […](/browser/wp-security-audit-log/trunk/vendor/composer/installed.json?rev=2911237#L50) |  |
  | 43 | 50 | "support": { |
  | 44 | 51 | "issues": "https://github.com/deliciousbrains/wp-background-processing/issues", |
  | 45 |  | "source": "https://github.com/deliciousbrains/wp-background-processing/tree/~~master~~" |
  |  | 52 | "source": "https://github.com/deliciousbrains/wp-background-processing/tree/1.1.0" |
  | 46 | 53 | }, |
  | 47 | 54 | "install-path": "../deliciousbrains/wp-background-processing" |
  | […](/browser/wp-security-audit-log/trunk/vendor/composer/installed.json?rev=2897171#L49) | […](/browser/wp-security-audit-log/trunk/vendor/composer/installed.json?rev=2911237#L56) |  |
  | 49 | 56 | { |
  | 50 | 57 | "name": "freemius/wordpress-sdk", |
  | 51 |  | "version": "2.5.~~6~~", |
  | 52 |  | "version\_normalized": "2.5.~~6~~.0", |
  |  | 58 | "version": "2.5.7", |
  |  | 59 | "version\_normalized": "2.5.7.0", |
  | 53 | 60 | "source": { |
  | 54 | 61 | "type": "git", |
  | 55 | 62 | "url": "https://github.com/Freemius/wordpress-sdk.git", |
  | 56 |  | "reference": "~~095fc9ced29efef5b18f9b7242bb80b0b4ac6aff~~" |
  |  | 63 | "reference": "78b876e227905373b94fecdd5e5449bcc4d63407" |
  | 57 | 64 | }, |
  | 58 | 65 | "dist": { |
  | 59 | 66 | "type": "zip", |
  | 60 |  | "url": "https://api.github.com/repos/Freemius/wordpress-sdk/zipball/~~095fc9ced29efef5b18f9b7242bb80b0b4ac6aff~~", |
  | 61 |  | "reference": "~~095fc9ced29efef5b18f9b7242bb80b0b4ac6aff~~", |
  |  | 67 | "url": "https://api.github.com/repos/Freemius/wordpress-sdk/zipball/78b876e227905373b94fecdd5e5449bcc4d63407", |
  |  | 68 | "reference": "78b876e227905373b94fecdd5e5449bcc4d63407", |
  | 62 | 69 | "shasum": "" |
  | 63 | 70 | }, |
  | […](/browser/wp-security-audit-log/trunk/vendor/composer/installed.json?rev=2897171#L65) | […](/browser/wp-security-audit-log/trunk/vendor/composer/installed.json?rev=2911237#L72) |  |
  | 65 | 72 | "php": ">=5.2" |
  | 66 | 73 | }, |
  | 67 |  | "time": "2023-0~~3-28T10:40:38~~+00:00", |
  |  | 74 | "time": "2023-04-24T06:32:35+00:00", |
  | 68 | 75 | "type": "library", |
  | 69 | 76 | "installation-source": "dist", |
  | […](/browser/wp-security-audit-log/trunk/vendor/composer/installed.json?rev=2897171#L85) | […](/browser/wp-security-audit-log/trunk/vendor/composer/installed.json?rev=2911237#L92) |  |
  | 85 | 92 | "support": { |
  | 86 | 93 | "issues": "https://github.com/Freemius/wordpress-sdk/issues", |
  | 87 |  | "source": "https://github.com/Freemius/wordpress-sdk/tree/2.5.~~6~~" |
  |  | 94 | "source": "https://github.com/Freemius/wordpress-sdk/tree/2.5.7" |
  | 88 | 95 | }, |
  | 89 | 96 | "install-path": "../freemius/wordpress-sdk" |
  | […](/browser/wp-security-audit-log/trunk/vendor/composer/installed.json?rev=2897171#L91) | […](/browser/wp-security-audit-log/trunk/vendor/composer/installed.json?rev=2911237#L98) |  |
  | 91 | 98 | { |
  | 92 | 99 | "name": "woocommerce/action-scheduler", |
  | 93 |  | "version": "3.~~5.4~~", |
  | 94 |  | "version\_normalized": "3.~~5.4~~.0", |
  |  | 100 | "version": "3.6.0", |
  |  | 101 | "version\_normalized": "3.6.0.0", |
  | 95 | 102 | "source": { |
  | 96 | 103 | "type": "git", |
  | 97 | 104 | "url": "https://github.com/woocommerce/action-scheduler.git", |
  | 98 |  | "reference": "~~9533e71b0eba4a519721dde84a34dfb161f11eb8~~" |
  |  | 105 | "reference": "1373570a9ee03a0be31c73df086d1e4343a27347" |
  | 99 | 106 | }, |
  | 100 | 107 | "dist": { |
  | 101 | 108 | "type": "zip", |
  | 102 |  | "url": "https://api.github.com/repos/woocommerce/action-scheduler/zipball/~~9533e71b0eba4a519721dde84a34dfb161f11eb8~~", |
  | 103 |  | "reference": "~~9533e71b0eba4a519721dde84a34dfb161f11eb8~~", |
  |  | 109 | "url": "https://api.github.com/repos/woocommerce/action-scheduler/zipball/1373570a9ee03a0be31c73df086d1e4343a27347", |
  |  | 110 | "reference": "1373570a9ee03a0be31c73df086d1e4343a27347", |
  | 104 | 111 | "shasum": "" |
  | 105 | 112 | }, |
  | […](/browser/wp-security-audit-log/trunk/vendor/composer/installed.json?rev=2897171#L110) | […](/browser/wp-security-audit-log/trunk/vendor/composer/installed.json?rev=2911237#L117) |  |
  | 110 | 117 | "yoast/phpunit-polyfills": "^1.0" |
  | 111 | 118 | }, |
  | 112 |  | "time": "2023-0~~1-17T20:20:43~~+00:00", |
  |  | 119 | "time": "2023-05-10T19:25:40+00:00", |
  | 113 | 120 | "type": "wordpress-plugin", |
  | 114 | 121 | "extra": { |
  | […](/browser/wp-security-audit-log/trunk/vendor/composer/installed.json?rev=2897171#L128) | […](/browser/wp-security-audit-log/trunk/vendor/composer/installed.json?rev=2911237#L135) |  |
  | 128 | 135 | "support": { |
  | 129 | 136 | "issues": "https://github.com/woocommerce/action-scheduler/issues", |
  | 130 |  | "source": "https://github.com/woocommerce/action-scheduler/tree/3.~~5.4~~" |
  |  | 137 | "source": "https://github.com/woocommerce/action-scheduler/tree/3.6.0" |
  | 131 | 138 | }, |
  | 132 | 139 | "install-path": "../woocommerce/action-scheduler" |
  | […](/browser/wp-security-audit-log/trunk/vendor/composer/installed.json?rev=2897171#L170) | […](/browser/wp-security-audit-log/trunk/vendor/composer/installed.json?rev=2911237#L177) |  |
  | 170 | 177 | }, |
  | 171 | 178 | "install-path": "../wpwhitesecurity/import-export-plugin-settings" |
  | 172 |  | ~~},~~ |
  | 173 |  | ~~{~~ |
  | 174 |  | ~~"name": "wpwhitesecurity/select2-wpwhitesecurity",~~ |
  | 175 |  | ~~"version": "1.0.2",~~ |
  | 176 |  | ~~"version\_normalized": "1.0.2.0",~~ |
  | 177 |  | ~~"source": {~~ |
  | 178 |  | ~~"type": "git",~~ |
  | 179 |  | ~~"url": "https://github.com/wpwhitesecurity/select2-wpwhitesecurity.git",~~ |
  | 180 |  | ~~"reference": "d56f367bcd22ba0836cd2ee6e88a1a3902f01ad3"~~ |
  | 181 |  | ~~},~~ |
  | 182 |  | ~~"dist": {~~ |
  | 183 |  | ~~"type": "zip",~~ |
  | 184 |  | ~~"url": "https://api.github.com/repos/wpwhitesecurity/select2-wpwhitesecurity/zipball/d56f367bcd22ba0836cd2ee6e88a1a3902f01ad3",~~ |
  | 185 |  | ~~"reference": "d56f367bcd22ba0836cd2ee6e88a1a3902f01ad3",~~ |
  | 186 |  | ~~"shasum": ""~~ |
  | 187 |  | ~~},~~ |
  | 188 |  | ~~"require": {~~ |
  | 189 |  | ~~"php": ">=7.0"~~ |
  | 190 |  | ~~},~~ |
  | 191 |  | ~~"time": "2022-03-16T08:53:12+00:00",~~ |
  | 192 |  | ~~"type": "library",~~ |
  | 193 |  | ~~"installation-source": "dist",~~ |
  | 194 |  | ~~"autoload": {~~ |
  | 195 |  | ~~"files": [~~ |
  | 196 |  | ~~"load.php"~~ |
  | 197 |  | ~~]~~ |
  | 198 |  | ~~},~~ |
  | 199 |  | ~~"authors": [~~ |
  | 200 |  | ~~{~~ |
  | 201 |  | ~~"name": "WP White Security",~~ |
  | 202 |  | ~~"email": "info@wpwhitesecurity.com"~~ |
  | 203 |  | ~~}~~ |
  | 204 |  | ~~],~~ |
  | 205 |  | ~~"description": "Select2 integration library for WordPress",~~ |
  | 206 |  | ~~"support": {~~ |
  | 207 |  | ~~"source": "https://github.com/wpwhitesecurity/select2-wpwhitesecurity/tree/v1.0.2",~~ |
  | 208 |  | ~~"issues": "https://github.com/wpwhitesecurity/select2-wpwhitesecurity/issues"~~ |
  | 209 |  | ~~},~~ |
  | 210 |  | ~~"install-path": "../wpwhitesecurity/select2-wpwhitesecurity"~~ |
  | 211 | 179 | } |
  | 212 | 180 | ], |
* ## [wp-security-audit-log/trunk/vendor/composer/installed.php](/changeset/2911237/wp-security-audit-log/trunk/vendor/composer/installed.php?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Fvendor%2Fcomposer%2Finstalled.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/vendor/composer/installed.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/vendor/composer/installed.php?rev=2897171#L12 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/vendor/composer/installed.php?rev=2911237#L12 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 12 | 12 | 'versions' => array( |
  | 13 | 13 | 'deliciousbrains/wp-background-processing' => array( |
  | 14 |  | 'pretty\_version' => '1.~~0.2~~', |
  | 15 |  | 'version' => '1.~~0.2~~.0', |
  | 16 |  | 'reference' => '~~2cbee1abd1b49e1133cd8f611df4d4fc5a8b9800~~', |
  |  | 14 | 'pretty\_version' => '1.1.0', |
  |  | 15 | 'version' => '1.1.0.0', |
  |  | 16 | 'reference' => 'd5ef95cecba7f792ddca3e3bd70ebfb90dc4996d', |
  | 17 | 17 | 'type' => 'library', |
  | 18 | 18 | 'install\_path' => \_\_DIR\_\_ . '/../deliciousbrains/wp-background-processing', |
  | […](/browser/wp-security-audit-log/trunk/vendor/composer/installed.php?rev=2897171#L21) | […](/browser/wp-security-audit-log/trunk/vendor/composer/installed.php?rev=2911237#L21) |  |
  | 21 | 21 | ), |
  | 22 | 22 | 'freemius/wordpress-sdk' => array( |
  | 23 |  | 'pretty\_version' => '2.5.~~6~~', |
  | 24 |  | 'version' => '2.5.~~6~~.0', |
  | 25 |  | 'reference' => '~~095fc9ced29efef5b18f9b7242bb80b0b4ac6aff~~', |
  |  | 23 | 'pretty\_version' => '2.5.7', |
  |  | 24 | 'version' => '2.5.7.0', |
  |  | 25 | 'reference' => '78b876e227905373b94fecdd5e5449bcc4d63407', |
  | 26 | 26 | 'type' => 'library', |
  | 27 | 27 | 'install\_path' => \_\_DIR\_\_ . '/../freemius/wordpress-sdk', |
  | […](/browser/wp-security-audit-log/trunk/vendor/composer/installed.php?rev=2897171#L30) | […](/browser/wp-security-audit-log/trunk/vendor/composer/installed.php?rev=2911237#L30) |  |
  | 30 | 30 | ), |
  | 31 | 31 | 'woocommerce/action-scheduler' => array( |
  | 32 |  | 'pretty\_version' => '3.~~5.4~~', |
  | 33 |  | 'version' => '3.~~5.4~~.0', |
  | 34 |  | 'reference' => '~~9533e71b0eba4a519721dde84a34dfb161f11eb8~~', |
  |  | 32 | 'pretty\_version' => '3.6.0', |
  |  | 33 | 'version' => '3.6.0.0', |
  |  | 34 | 'reference' => '1373570a9ee03a0be31c73df086d1e4343a27347', |
  | 35 | 35 | 'type' => 'wordpress-plugin', |
  | 36 | 36 | 'install\_path' => \_\_DIR\_\_ . '/../woocommerce/action-scheduler', |
  | […](/browser/wp-security-audit-log/trunk/vendor/composer/installed.php?rev=2897171#L56) | […](/browser/wp-security-audit-log/trunk/vendor/composer/installed.php?rev=2911237#L56) |  |
  | 56 | 56 | 'dev\_requirement' => false, |
  | 57 | 57 | ), |
  | 58 |  | ~~'wpwhitesecurity/select2-wpwhitesecurity' => array(~~ |
  | 59 |  | ~~'pretty\_version' => '1.0.2',~~ |
  | 60 |  | ~~'version' => '1.0.2.0',~~ |
  | 61 |  | ~~'reference' => 'd56f367bcd22ba0836cd2ee6e88a1a3902f01ad3',~~ |
  | 62 |  | ~~'type' => 'library',~~ |
  | 63 |  | ~~'install\_path' => \_\_DIR\_\_ . '/../wpwhitesecurity/select2-wpwhitesecurity',~~ |
  | 64 |  | ~~'aliases' => array(),~~ |
  | 65 |  | ~~'dev\_requirement' => false,~~ |
  | 66 |  | ~~),~~ |
  | 67 | 58 | ), |
  | 68 | 59 | ); |
* ## [wp-security-audit-log/trunk/wp-security-audit-log.php](/changeset/2911237/wp-security-audit-log/trunk/wp-security-audit-log.php?old=2897171&old_path=wp-security-audit-log%2Ftrunk%2Fwp-security-audit-log.php "Show the [2897171:2911239] differences restricted to wp-security-audit-log/trunk/wp-security-audit-log.php")

  | [r2897171](/browser/wp-security-audit-log/trunk/wp-security-audit-log.php?rev=2897171#L3 "Show revision 2897171 of this file in browser") | [r2911239](/browser/wp-security-audit-log/trunk/wp-security-audit-log.php?rev=2911237#L3 "Show revision 2911239 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | \* WP Activity Log. |
  | 4 | 4 | \* |
  | 5 |  | \* @copyright Copyright (C) 2013-~~%%YEAR%%~~, WP White Security - support@wpwhitesecurity.com |
  |  | 5 | \* @copyright Copyright (C) 2013-2023, WP White Security - support@wpwhitesecurity.com |
  | 6 | 6 | \* @license   http://www.gnu.org/licenses/gpl-3.0.html GNU General Public License, version 3 or higher |
  | 7 | 7 | \* |
  | 8 | 8 | \* @wordpress-plugin |
  | 9 | 9 | \* Plugin Name: WP Activity Log |
  | 10 |  | \* Version:     4.5.~~0~~ |
  |  | 10 | \* Version:     4.5.2 |
  | 11 | 11 | \* Plugin URI:  https://wpactivitylog.com/ |
  | 12 | 12 | \* Description: Identify WordPress security issues before they become a problem. Keep track of everything happening on your WordPress, including users activity. Similar to Linux Syslog, WP Activity Log generates an activity log with a record of everything that happens on your WordPress websites. |
  | […](/browser/wp-security-audit-log/trunk/wp-security-audit-log.php?rev=2897171#L56) | […](/browser/wp-security-audit-log/trunk/wp-security-audit-log.php?rev=2911237#L56) |  |
  | 56 | 56 |  |
  | 57 | 57 | if ( ! defined( 'WSAL\_PREFIX' ) ) { |
  | 58 |  | define( 'WSAL\_VERSION', '4.5.~~0~~' ); |
  |  | 58 | define( 'WSAL\_VERSION', '4.5.2' ); |
  | 59 | 59 | define( 'WSAL\_PREFIX', 'wsal\_' ); |
  | 60 | 60 | define( 'WSAL\_PREFIX\_PAGE', 'wsal-' ); |
  | […](/browser/wp-security-audit-log/trunk/wp-security-audit-log.php?rev=2897171#L86) | […](/browser/wp-security-audit-log/trunk/wp-security-audit-log.php?rev=2911237#L86) |  |
  | 86 | 86 | } |
  | 87 | 87 |  |
  |  | 88 | /\*\* |
  |  | 89 | \* Connections Prefix. |
  |  | 90 | \*/ |
  |  | 91 | if ( ! defined( 'WSAL\_CONN\_PREFIX' ) ) { |
  |  | 92 | define( 'WSAL\_CONN\_PREFIX', 'connection-' ); |
  |  | 93 | } |
  |  | 94 | if ( ! defined( 'WSAL\_MIRROR\_PREFIX' ) ) { |
  |  | 95 | define( 'WSAL\_MIRROR\_PREFIX', 'mirror-' ); |
  |  | 96 | } |
  |  | 97 |  |
  | 88 | 98 | /\* @free:start \*/ |
  | 89 | 99 | if ( ! function\_exists( 'wsal\_disable\_freemius\_on\_free' ) ) { |
  | […](/browser/wp-security-audit-log/trunk/wp-security-audit-log.php?rev=2897171#L237) | […](/browser/wp-security-audit-log/trunk/wp-security-audit-log.php?rev=2911237#L247) |  |
  | 237 | 247 |  |
  | 238 | 248 | add\_action( |
  | 239 |  | ~~$bootstrap\_hook[0]~~, |
  |  | 249 | 'init', |
  | 240 | 250 | function() { |
  | 241 | 251 | WSAL\Controllers\Alert\_Manager::init(); |
  | […](/browser/wp-security-audit-log/trunk/wp-security-audit-log.php?rev=2897171#L304) | […](/browser/wp-security-audit-log/trunk/wp-security-audit-log.php?rev=2911237#L314) |  |
  | 304 | 314 | public static function is\_frontend() { |
  | 305 | 315 | return ! is\_admin() |
  | 306 |  | && ! ~~self~~::is\_login\_screen() |
  |  | 316 | && ! WP\_Helper::is\_login\_screen() |
  | 307 | 317 | && ( ! defined( 'WP\_CLI' ) || ! WP\_CLI ) |
  | 308 | 318 | && ( ! defined( 'DOING\_CRON' ) || ! DOING\_CRON ) |
  | […](/browser/wp-security-audit-log/trunk/wp-security-audit-log.php?rev=2897171#L318) | […](/browser/wp-security-audit-log/trunk/wp-security-audit-log.php?rev=2911237#L328) |  |
  | 318 | 328 | public static function is\_frontend\_page() { |
  | 319 | 329 | return ! is\_admin() |
  | 320 |  | && ! ~~self~~::is\_login\_screen() |
  |  | 330 | && ! WP\_Helper::is\_login\_screen() |
  | 321 | 331 | && ( ! defined( 'WP\_CLI' ) || ! WP\_CLI ) |
  | 322 | 332 | && ( ! defined( 'DOING\_CRON' ) || ! DOING\_CRON ) |
  | […](/browser/wp-security-audit-log/trunk/wp-security-audit-log.php?rev=2897171#L497) | […](/browser/wp-security-audit-log/trunk/wp-security-audit-log.php?rev=2911237#L507) |  |
  | 497 | 507 |  |
  | 498 | 508 | /\*\* |
  | 499 |  | ~~\* Whether the current page is the login screen.~~ |
  | 500 |  | ~~\*~~ |
  | 501 |  | ~~\* @return bool~~ |
  | 502 |  | ~~\*/~~ |
  | 503 |  | ~~public static function is\_login\_screen() {~~ |
  | 504 |  | ~~return parse\_url( site\_url( 'wp-login.php' ), PHP\_URL\_PATH ) === parse\_url( $\_SERVER['REQUEST\_URI'], PHP\_URL\_PATH ); // phpcs:ignore~~ |
  | 505 |  | ~~}~~ |
  | 506 |  |  |
  | 507 |  | ~~/\*\*~~ |
  | 508 | 509 | \* Load Freemius SDK. |
  | 509 | 510 | \*/ |
  | […](/browser/wp-security-audit-log/trunk/wp-security-audit-log.php?rev=2897171#L594) | […](/browser/wp-security-audit-log/trunk/wp-security-audit-log.php?rev=2911237#L595) |  |
  | 594 | 595 | } |
  | 595 | 596 |  |
  | 596 |  | if ( $is\_admin\_blocking\_plugins\_support\_enabled || is\_admin() || ~~self~~::is\_login\_screen() || self::is\_rest\_api() || ( defined( 'DOING\_CRON' ) && DOING\_CRON ) || ( defined( 'WP\_CLI' ) && WP\_CLI ) ) { |
  |  | 597 | if ( $is\_admin\_blocking\_plugins\_support\_enabled || is\_admin() || WP\_Helper::is\_login\_screen() || self::is\_rest\_api() || ( defined( 'DOING\_CRON' ) && DOING\_CRON ) || ( defined( 'WP\_CLI' ) && WP\_CLI ) ) { |
  | 597 | 598 |  |
  | 598 | 599 | self::load\_freemius(); |
  | […](/browser/wp-security-audit-log/trunk/wp-security-audit-log.php?rev=2897171#L842) | […](/browser/wp-security-audit-log/trunk/wp-security-audit-log.php?rev=2911237#L843) |  |
  | 842 | 843 | // $this->sensors = new WSAL\_SensorManager( $this ); |
  | 843 | 844 |  |
  | 844 |  | Sensors\_Load\_Manager::load\_sensors(); |
  |  | 845 | // Sensors\_Load\_Manager::load\_sensors(); |
  | 845 | 846 |  |
  | 846 | 847 | if ( is\_admin() ) { |
  | […](/browser/wp-security-audit-log/trunk/wp-security-audit-log.php?rev=2897171#L1111) | […](/browser/wp-security-audit-log/trunk/wp-security-audit-log.php?rev=2911237#L1112) |  |
  | 1111 | 1112 | // run any installs. |
  | 1112 | 1113 | self::get\_connector()->install\_all(); |
  | 1113 |  | self::get\_connector()->get\_adapter( 'Occurrence' )->create\_indexes(); |
  | 1114 |  | self::get\_connector()->get\_adapter( 'Meta' )->create\_indexes(); |
  |  | 1114 | // self::get\_connector()->get\_adapter( 'Occurrence' )->create\_indexes(); |
  |  | 1115 | // self::get\_connector()->get\_adapter( 'Meta' )->create\_indexes(); |
  | 1115 | 1116 |  |
  | 1116 | 1117 |  |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=2911239&old=2897171&new_path=%2Fwp-security-audit-log%2Ftrunk&old_path=%2Fwp-security-audit-log%2Ftrunk)
* [Zip Archive](?format=zip&new=2911239&old=2897171&new_path=%2Fwp-security-audit-log%2Ftrunk&old_path=%2Fwp-security-audit-log%2Ftrunk)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_766f3fed_20250114_190028.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# WP Activity Log <= 4.5.0 - Cross-Site Request Forgery via ajax\_run\_cleanup

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   WP Activity Log <= 4.5.0 - Cross-Site Request Forgery via ajax\_run\_cleanup

4.3

**Cross-Site Request Forgery (CSRF)**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:L/A:N)

| CVE | [CVE-2023-2286](https://www.cve.org/CVERecord?id=CVE-2023-2286) |
| --- | --- |
| CVSS | 4.3 (Medium) |
| Publicly Published | May 17, 2023 |
| Last Updated | January 22, 2024 |
| Researcher | [Marco Wotschka - Wordfence](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/marco-wotschka) |

### Description

The WP Activity Log for WordPress is vulnerable to Cross-Site Request Forgery in versions up to, and including, 4.5.0. This is due to missing or incorrect nonce validation on the ajax\_run\_cleanup function. This makes it possible for unauthenticated attackers to invoke this function via a forged request granted they can trick a site administrator into performing an action such as clicking on a link.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/wp-security-audit-log/trunk/classes/Views/Settings.php#L278)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&new=2911239%40wp-security-audit-log%2Ftrunk&old=2897171%40wp-security-audit-log%2Ftrunk&sfp_email=&sfph_mail=)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fdetail%2Fwp-activity-log-450-cross-site-request-forgery-via-ajax-run-cleanup&t=WP%20Activity%20Log%20%3C%3D%204.5.0%20-%20Cross-Site%20Request%20Forgery%20via%20ajax_run_cleanup "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fdetail%2Fwp-activity-log-450-cross-site-request-forgery-via-ajax-run-cleanup&text=WP%20Activity%20Log%20%3C%3D%204.5.0%20-%20Cross-Site%20Request%20Forgery%20via%20ajax_run_cleanup "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fdetail%2Fwp-activity-log-450-cross-site-request-forgery-via-ajax-run-cleanup "LinkedIn")
Email

## 2 affected software packages

#### [WP Activity Log](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/wp-security-audit-log)

| Software Type | Plugin |
| --- | --- |
| Software Slug | wp-security-audit-log [(view on wordpress.org)](https://wordpress.org/plugins/wp-security-audit-log) |
| Patched? | Yes |
| Remediation | Update to version 4.5.2, or a newer patched version |
| Affected Version | * <= 4.5.0 |
| Patched Version | * 4.5.2 |

#### [WP Activity Log Premium](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/wp-security-audit-log-premium)

| Software Type | Plugin |
| --- | --- |
| Software Slug | wp-security-audit-log-premium |
| Patched? | Yes |
| Remediation | Update to version 4.5.2, or a newer patched version |
| Affected Version | * <= 4.5.0 |
| Patched Version | * 4.5.2 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_2d0db68c_20250114_190019.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fwp-security-audit-log%2Ftrunk%2Fclasses%2FViews%2FSettings.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/wp-security-audit-log/trunk/classes/Views/Settings.php?rev=3150790 "Revision 3150790")
* Next Revision →
* [Blame](/browser/wp-security-audit-log/trunk/classes/Views/Settings.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/wp-security-audit-log/trunk/classes/Views/Settings.php)

---

# [source:](/browser?order=name "Go to repository root") [wp-security-audit-log](/browser/wp-security-audit-log?order=name "View wp-security-audit-log")/[trunk](/browser/wp-security-audit-log/trunk?order=name "View trunk")/[classes](/browser/wp-security-audit-log/trunk/classes?order=name "View classes")/[Views](/browser/wp-security-audit-log/trunk/classes/Views?order=name "View Views")/[Settings.php](/browser/wp-security-audit-log/trunk/classes/Views/Settings.php?order=name "View Settings.php")

View diff against:

View revision:

| [Last change](/changeset/3186441/wp-security-audit-log/trunk/classes/Views/Settings.php "View differences") on this file was [3186441](/changeset/3186441/ "View changeset 3186441"), checked in by melapress, [2 months ago](/timeline?from=2024-11-12T11%3A20%3A52Z&precision=second "See timeline at 11/12/2024 11:20:52 AM") |
| --- |
| Uploading update 5.2.2 |
| **File size:** 76.9 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* Settings Page |
| [4](#L4) | \* |
| [5](#L5) | \* Settings page of the plugin. |
| [6](#L6) | \* |
| [7](#L7) | \* @since      1.0.0 |
| [8](#L8) | \* @package    wsal |
| [9](#L9) | \* @subpackage views |
| [10](#L10) | \*/ |
| [11](#L11) |  |
| [12](#L12) | use WSAL\Helpers\WP\_Helper; |
| [13](#L13) | use WSAL\Helpers\User\_Helper; |
| [14](#L14) | use WSAL\Controllers\Constants; |
| [15](#L15) | use WSAL\Controllers\Connection; |
| [16](#L16) | use WSAL\Helpers\Settings\_Helper; |
| [17](#L17) | use WSAL\Controllers\Alert\_Manager; |
| [18](#L18) | use WSAL\Controllers\Database\_Manager; |
| [19](#L19) | use WSAL\Helpers\Plugin\_Settings\_Helper; |
| [20](#L20) | use WSAL\Entities\Archive\Delete\_Records; |
| [21](#L21) |  |
| [22](#L22) | // Exit if accessed directly. |
| [23](#L23) | if ( ! defined( 'ABSPATH' ) ) { |
| [24](#L24) | exit; |
| [25](#L25) | } |
| [26](#L26) |  |
| [27](#L27) | /\*\* |
| [28](#L28) | \* Class: WSAL\_Views\_Settings |
| [29](#L29) | \* |
| [30](#L30) | \* Settings view class to handle settings page functions. |
| [31](#L31) | \* |
| [32](#L32) | \* @since      1.0.0 |
| [33](#L33) | \* |
| [34](#L34) | \* @package    wsal |
| [35](#L35) | \* @subpackage views |
| [36](#L36) | \*/ |
| [37](#L37) | class WSAL\_Views\_Settings extends WSAL\_AbstractView { |
| [38](#L38) |  |
| [39](#L39) | /\*\* |
| [40](#L40) | \* Adapter Message. |
| [41](#L41) | \* |
| [42](#L42) | \* @var string |
| [43](#L43) | \*/ |
| [44](#L44) | public $adapter\_msg = ''; |
| [45](#L45) |  |
| [46](#L46) | /\*\* |
| [47](#L47) | \* WSAL Setting Tabs. |
| [48](#L48) | \* |
| [49](#L49) | \* @since 3.2.3 |
| [50](#L50) | \* |
| [51](#L51) | \* @var array |
| [52](#L52) | \*/ |
| [53](#L53) | private $wsal\_setting\_tabs = array(); |
| [54](#L54) |  |
| [55](#L55) | /\*\* |
| [56](#L56) | \* Current Setting Tab. |
| [57](#L57) | \* |
| [58](#L58) | \* @since 3.2.3 |
| [59](#L59) | \* |
| [60](#L60) | \* @var string |
| [61](#L61) | \*/ |
| [62](#L62) | private $current\_tab = ''; |
| [63](#L63) |  |
| [64](#L64) | /\*\* |
| [65](#L65) | \* Method: Constructor. |
| [66](#L66) | \* |
| [67](#L67) | \* @param WpSecurityAuditLog $plugin - Instance of WpSecurityAuditLog. |
| [68](#L68) | \*/ |
| [69](#L69) | public function \_\_construct( WpSecurityAuditLog $plugin ) { |
| [70](#L70) | parent::\_\_construct( $plugin ); |
| [71](#L71) | add\_action( 'admin\_init', array( $this, 'setup\_settings\_tabs' ) ); |
| [72](#L72) | add\_action( 'wp\_ajax\_AjaxCheckSecurityToken', array( $this, 'ajax\_check\_security\_token' ) ); |
| [73](#L73) | add\_action( 'wp\_ajax\_AjaxRunCleanup', array( $this, 'ajax\_run\_cleanup' ) ); |
| [74](#L74) | add\_action( 'wp\_ajax\_AjaxGetAllUsers', array( $this, 'ajax\_get\_all\_users' ) ); |
| [75](#L75) | add\_action( 'wp\_ajax\_AjaxGetAllRoles', array( $this, 'ajax\_get\_all\_roles' ) ); |
| [76](#L76) | add\_action( 'wp\_ajax\_AjaxGetAllCPT', array( $this, 'ajax\_get\_all\_cpts' ) ); |
| [77](#L77) | add\_action( 'wp\_ajax\_AjaxGetAllStatuses', array( $this, 'ajax\_get\_all\_stati' ) ); |
| [78](#L78) | add\_action( 'wp\_ajax\_wsal\_reset\_settings', array( $this, 'reset\_settings' ) ); |
| [79](#L79) | add\_action( 'wp\_ajax\_wsal\_purge\_activity', array( $this, 'purge\_activity' ) ); |
| [80](#L80) | add\_action( 'wp\_ajax\_wsal\_ajax\_get\_all\_severities', array( $this, 'ajax\_get\_all\_severities' ) ); |
| [81](#L81) | add\_action( 'wp\_ajax\_wsal\_ajax\_get\_all\_event\_types', array( $this, 'ajax\_get\_all\_event\_types' ) ); |
| [82](#L82) | add\_action( 'wp\_ajax\_wsal\_ajax\_get\_all\_object\_types', array( $this, 'ajax\_get\_all\_object\_types' ) ); |
| [83](#L83) | add\_action( 'wp\_ajax\_wsal\_ajax\_get\_all\_event\_ids', array( $this, 'ajax\_get\_all\_event\_ids' ) ); |
| [84](#L84) | } |
| [85](#L85) |  |
| [86](#L86) | /\*\* |
| [87](#L87) | \* Setup WSAL Settings Page Tabs. |
| [88](#L88) | \* |
| [89](#L89) | \* @since 3.4 |
| [90](#L90) | \*/ |
| [91](#L91) | public function setup\_settings\_tabs() { |
| [92](#L92) |  |
| [93](#L93) | // Verify that the current page is WSAL settings page. |
| [94](#L94) | $page = isset( $\_GET['page'] ) ? \sanitize\_text\_field( wp\_unslash( $\_GET['page'] ) ) : false; |
| [95](#L95) | if ( empty( $page ) || $this->get\_safe\_view\_name() !== $page ) { |
| [96](#L96) | return; |
| [97](#L97) | } |
| [98](#L98) |  |
| [99](#L99) | // Tab links. |
| [100](#L100) | $wsal\_setting\_tabs = array( |
| [101](#L101) | 'general'           => array( |
| [102](#L102) | 'name'     => esc\_html\_\_( 'General', 'wp-security-audit-log' ), |
| [103](#L103) | 'link'     => add\_query\_arg( 'tab', 'general', $this->get\_url() ), |
| [104](#L104) | 'render'   => array( $this, 'tab\_general' ), |
| [105](#L105) | 'save'     => array( $this, 'tab\_general\_save' ), |
| [106](#L106) | 'priority' => 10, |
| [107](#L107) | ), |
| [108](#L108) | 'audit-log'         => array( |
| [109](#L109) | 'name'     => esc\_html\_\_( 'Activity log viewer', 'wp-security-audit-log' ), |
| [110](#L110) | 'link'     => add\_query\_arg( 'tab', 'audit-log', $this->get\_url() ), |
| [111](#L111) | 'render'   => array( $this, 'tab\_audit\_log' ), |
| [112](#L112) | 'save'     => array( $this, 'tab\_audit\_log\_save' ), |
| [113](#L113) | 'priority' => 20, |
| [114](#L114) | ), |
| [115](#L115) | 'file-changes'      => array( |
| [116](#L116) | 'name'     => esc\_html\_\_( 'File changes', 'wp-security-audit-log' ), |
| [117](#L117) | 'link'     => add\_query\_arg( 'tab', 'file-changes', $this->get\_url() ), |
| [118](#L118) | 'render'   => array( $this, 'tab\_file\_changes' ), |
| [119](#L119) | 'priority' => 30, |
| [120](#L120) | ), |
| [121](#L121) | 'exclude-objects'   => array( |
| [122](#L122) | 'name'     => esc\_html\_\_( 'Exclude objects', 'wp-security-audit-log' ), |
| [123](#L123) | 'link'     => add\_query\_arg( 'tab', 'exclude-objects', $this->get\_url() ), |
| [124](#L124) | 'render'   => array( $this, 'tab\_exclude\_objects' ), |
| [125](#L125) | 'save'     => array( $this, 'tab\_exclude\_objects\_save' ), |
| [126](#L126) | 'priority' => 40, |
| [127](#L127) | ), |
| [128](#L128) | 'advanced-settings' => array( |
| [129](#L129) | 'name'     => esc\_html\_\_( 'Advanced settings', 'wp-security-audit-log' ), |
| [130](#L130) | 'link'     => add\_query\_arg( 'tab', 'advanced-settings', $this->get\_url() ), |
| [131](#L131) | 'render'   => array( $this, 'tab\_advanced\_settings' ), |
| [132](#L132) | 'save'     => array( $this, 'tab\_advanced\_settings\_save' ), |
| [133](#L133) | 'priority' => 100, |
| [134](#L134) | ), |
| [135](#L135) | ); |
| [136](#L136) |  |
| [137](#L137) | /\*\* |
| [138](#L138) | \* Filter: `wsal\_setting\_tabs` |
| [139](#L139) | \* |
| [140](#L140) | \* This filter is used to filter the tabs of WSAL settings page. |
| [141](#L141) | \* |
| [142](#L142) | \* Setting tabs structure: |
| [143](#L143) | \*     $wsal\_setting\_tabs['unique-tab-id'] = array( |
| [144](#L144) | \*         'name'     => Name of the tab, |
| [145](#L145) | \*         'link'     => Link of the tab, |
| [146](#L146) | \*         'render'   => This function is used to render HTML elements in the tab, |
| [147](#L147) | \*         'name'     => This function is used to save the related setting of the tab, |
| [148](#L148) | \*         'priority' => Priority of the tab, |
| [149](#L149) | \*     ); |
| [150](#L150) | \* |
| [151](#L151) | \* @param array $wsal\_setting\_tabs – Array of WSAL Setting Tabs. |
| [152](#L152) | \* |
| [153](#L153) | \* @since 3.2.3 |
| [154](#L154) | \*/ |
| [155](#L155) | $wsal\_setting\_tabs = apply\_filters( 'wsal\_setting\_tabs', $wsal\_setting\_tabs ); |
| [156](#L156) |  |
| [157](#L157) | // Sort by priority. |
| [158](#L158) | array\_multisort( array\_column( $wsal\_setting\_tabs, 'priority' ), SORT\_ASC, $wsal\_setting\_tabs ); |
| [159](#L159) |  |
| [160](#L160) | $this->wsal\_setting\_tabs = $wsal\_setting\_tabs; |
| [161](#L161) |  |
| [162](#L162) | // Get the current tab. |
| [163](#L163) | $current\_tab       = ( isset( $\_GET['tab'] ) ) ? \sanitize\_text\_field( \wp\_unslash( $\_GET['tab'] ) ) : ''; |
| [164](#L164) | $this->current\_tab = empty( $current\_tab ) ? 'general' : $current\_tab; |
| [165](#L165) | } |
| [166](#L166) |  |
| [167](#L167) | /\*\* |
| [168](#L168) | \* {@inheritDoc} |
| [169](#L169) | \*/ |
| [170](#L170) | public function has\_plugin\_shortcut\_link() { |
| [171](#L171) | return true; |
| [172](#L172) | } |
| [173](#L173) |  |
| [174](#L174) | /\*\* |
| [175](#L175) | \* {@inheritDoc} |
| [176](#L176) | \*/ |
| [177](#L177) | public function get\_title() { |
| [178](#L178) | return esc\_html\_\_( 'Settings', 'wp-security-audit-log' ); |
| [179](#L179) | } |
| [180](#L180) |  |
| [181](#L181) | /\*\* |
| [182](#L182) | \* {@inheritDoc} |
| [183](#L183) | \*/ |
| [184](#L184) | public function get\_icon() { |
| [185](#L185) | return 'dashicons-admin-generic'; |
| [186](#L186) | } |
| [187](#L187) |  |
| [188](#L188) | /\*\* |
| [189](#L189) | \* {@inheritDoc} |
| [190](#L190) | \*/ |
| [191](#L191) | public function get\_name() { |
| [192](#L192) | return esc\_html\_\_( 'Settings', 'wp-security-audit-log' ); |
| [193](#L193) | } |
| [194](#L194) |  |
| [195](#L195) | /\*\* |
| [196](#L196) | \* {@inheritDoc} |
| [197](#L197) | \*/ |
| [198](#L198) | public function get\_weight() { |
| [199](#L199) | return 8; |
| [200](#L200) | } |
| [201](#L201) |  |
| [202](#L202) | /\*\* |
| [203](#L203) | \* Method: Save settings. |
| [204](#L204) | \* |
| [205](#L205) | \* @throws Exception - Unrecognized settings tab error. |
| [206](#L206) | \*/ |
| [207](#L207) | protected function save() { |
| [208](#L208) | // Bail early if user does not have sufficient permissions to save. |
| [209](#L209) | if ( ! Settings\_Helper::current\_user\_can( 'edit' ) ) { |
| [210](#L210) | throw new Exception( esc\_html\_\_( 'Current user is not allowed to save settings.', 'wp-security-audit-log' ) ); |
| [211](#L211) | } |
| [212](#L212) | // Call respective tab save functions if they are set. Nonce is already verified at this point. |
| [213](#L213) | if ( ! empty( $this->current\_tab ) && ! empty( $this->wsal\_setting\_tabs[ $this->current\_tab ]['save'] ) ) { |
| [214](#L214) | call\_user\_func( $this->wsal\_setting\_tabs[ $this->current\_tab ]['save'] ); |
| [215](#L215) | } else { |
| [216](#L216) | throw new Exception( esc\_html\_\_( 'Unknown settings tab.', 'wp-security-audit-log' ) ); |
| [217](#L217) | } |
| [218](#L218) | } |
| [219](#L219) |  |
| [220](#L220) | /\*\* |
| [221](#L221) | \* Method: Check security token. |
| [222](#L222) | \*/ |
| [223](#L223) | public function ajax\_check\_security\_token() { |
| [224](#L224) | if ( ! Settings\_Helper::current\_user\_can( 'edit' ) ) { |
| [225](#L225) | echo wp\_json\_encode( |
| [226](#L226) | array( |
| [227](#L227) | 'success' => false, |
| [228](#L228) | 'message' => esc\_html\_\_( 'Access Denied.', 'wp-security-audit-log' ), |
| [229](#L229) | ) |
| [230](#L230) | ); |
| [231](#L231) | die(); |
| [232](#L232) | } |
| [233](#L233) |  |
| [234](#L234) | $nonce = isset( $\_POST['nonce'] ) ? \sanitize\_text\_field( \wp\_unslash( $\_POST['nonce'] ) ) : false; |
| [235](#L235) | $token = isset( $\_POST['token'] ) ? \sanitize\_text\_field( \wp\_unslash( $\_POST['token'] ) ) : false; |
| [236](#L236) |  |
| [237](#L237) | if ( empty( $nonce ) || ! \wp\_verify\_nonce( $nonce, 'wsal-exclude-nonce' ) ) { |
| [238](#L238) | echo wp\_json\_encode( |
| [239](#L239) | array( |
| [240](#L240) | 'success' => false, |
| [241](#L241) | 'message' => esc\_html\_\_( 'Nonce verification failed.', 'wp-security-audit-log' ), |
| [242](#L242) | ) |
| [243](#L243) | ); |
| [244](#L244) | die(); |
| [245](#L245) | } |
| [246](#L246) |  |
| [247](#L247) | if ( empty( $token ) ) { |
| [248](#L248) | echo wp\_json\_encode( |
| [249](#L249) | array( |
| [250](#L250) | 'success' => false, |
| [251](#L251) | 'message' => esc\_html\_\_( 'Invalid input.', 'wp-security-audit-log' ), |
| [252](#L252) | ) |
| [253](#L253) | ); |
| [254](#L254) | die(); |
| [255](#L255) | } |
| [256](#L256) |  |
| [257](#L257) | $input\_type = isset( $\_POST['type'] ) ? \sanitize\_text\_field( \wp\_unslash( $\_POST['type'] ) ) : false; |
| [258](#L258) |  |
| [259](#L259) | echo wp\_json\_encode( |
| [260](#L260) | array( |
| [261](#L261) | 'success'   => true, |
| [262](#L262) | 'token'     => $token, |
| [263](#L263) | 'tokenType' => esc\_html( Plugin\_Settings\_Helper::get\_token\_type( $token, $input\_type ) ), |
| [264](#L264) | ) |
| [265](#L265) | ); |
| [266](#L266) | die(); |
| [267](#L267) | } |
| [268](#L268) |  |
| [269](#L269) | /\*\* |
| [270](#L270) | \* Method: Run cleanup. |
| [271](#L271) | \*/ |
| [272](#L272) | public function ajax\_run\_cleanup() { |
| [273](#L273) | // Verify nonce. |
| [274](#L274) | if ( ! isset( $\_REQUEST['nonce'] ) || false === wp\_verify\_nonce( \sanitize\_text\_field( \wp\_unslash( $\_REQUEST['nonce'] ) ), 'wsal-run-cleanup' ) ) { |
| [275](#L275) | wp\_send\_json\_error( esc\_html\_\_( 'Insecure request.', 'wp-security-audit-log' ) ); |
| [276](#L276) | } |
| [277](#L277) |  |
| [278](#L278) | if ( ! Settings\_Helper::current\_user\_can( 'edit' ) ) { |
| [279](#L279) | die( 'Access Denied.' ); |
| [280](#L280) | } |
| [281](#L281) |  |
| [282](#L282) | $now       = time(); |
| [283](#L283) | $max\_sdate = Plugin\_Settings\_Helper::get\_pruning\_date(); // Pruning date. |
| [284](#L284) | $archiving = Settings\_Helper::is\_archiving\_set\_and\_enabled(); |
| [285](#L285) |  |
| [286](#L286) | // phpcs:disable |
| [287](#L287) | // phpcs:enable |
| [288](#L288) |  |
| [289](#L289) | // Calculate limit timestamp. |
| [290](#L290) | $max\_stamp = $now - ( strtotime( $max\_sdate ) - $now ); |
| [291](#L291) |  |
| [292](#L292) | $items = array(); |
| [293](#L293) |  |
| [294](#L294) | if ( $archiving ) { |
| [295](#L295) | $connection\_name = Settings\_Helper::get\_option\_value( 'archive-connection' ); |
| [296](#L296) |  |
| [297](#L297) | $wsal\_db = Connection::get\_connection( $connection\_name ); |
| [298](#L298) |  |
| [299](#L299) | $items = Delete\_Records::delete( array(), 0, array( 'created\_on <= %s' => intval( $max\_stamp ) ), $wsal\_db ); |
| [300](#L300) | } |
| [301](#L301) |  |
| [302](#L302) | $main\_items = Delete\_Records::delete( array(), 0, array( 'created\_on <= %s' => intval( $max\_stamp ) ) ); |
| [303](#L303) |  |
| [304](#L304) | if ( $archiving ) { |
| [305](#L305) | $archiving\_args = array( |
| [306](#L306) | 'page' => 'wsal-ext-settings', |
| [307](#L307) | 'tab'  => 'archiving', |
| [308](#L308) | ); |
| [309](#L309) | $archiving\_url  = add\_query\_arg( $archiving\_args, \network\_admin\_url( 'admin.php' ) ); |
| [310](#L310) | wp\_safe\_redirect( $archiving\_url ); |
| [311](#L311) | } else { |
| [312](#L312) | if ( ( is\_array( $items ) && count( $items ) ) || ( is\_array( $main\_items ) && count( $main\_items ) ) ) { |
| [313](#L313) | $redirect\_args = array( |
| [314](#L314) | 'tab'     => 'audit-log', |
| [315](#L315) | 'pruning' => 1, |
| [316](#L316) | ); |
| [317](#L317) | } else { |
| [318](#L318) | $redirect\_args = array( |
| [319](#L319) | 'tab'     => 'audit-log', |
| [320](#L320) | 'pruning' => 0, |
| [321](#L321) | ); |
| [322](#L322) | } |
| [323](#L323) | wp\_safe\_redirect( add\_query\_arg( $redirect\_args, $this->get\_url() ) ); |
| [324](#L324) | } |
| [325](#L325) | exit; |
| [326](#L326) | } |
| [327](#L327) |  |
| [328](#L328) | /\*\* |
| [329](#L329) | \* {@inheritDoc} |
| [330](#L330) | \*/ |
| [331](#L331) | public function render() { |
| [332](#L332) | // Verify nonce if a form is submitted. |
| [333](#L333) | if ( isset( $\_POST['\_wpnonce'] ) ) { |
| [334](#L334) | check\_admin\_referer( 'wsal-settings' ); |
| [335](#L335) | } |
| [336](#L336) |  |
| [337](#L337) | if ( ! Settings\_Helper::current\_user\_can( 'edit' ) ) { |
| [338](#L338) | wp\_die( esc\_html\_\_( 'You do not have sufficient permissions to access this page.', 'wp-security-audit-log' ) ); |
| [339](#L339) | } |
| [340](#L340) |  |
| [341](#L341) | // Check to see if section parameter is set in the URL. |
| [342](#L342) | $section = isset( $\_GET['section'] ) ? \sanitize\_text\_field( wp\_unslash( $\_GET['section'] ) ) : false; |
| [343](#L343) |  |
| [344](#L344) | if ( isset( $\_POST['submit'] ) ) { |
| [345](#L345) | try { |
| [346](#L346) | $this->save(); // Save settings. |
| [347](#L347) | if ( 'sms-provider' === $this->current\_tab && $section && 'test' === $section ) : |
| [348](#L348) | ?> |
| [349](#L349) | <div class="updated"> |
| [350](#L350) | <p><?php esc\_html\_e( 'Message sent successfully.', 'wp-security-audit-log' ); ?></p> |
| [351](#L351) | </div> |
| [352](#L352) | <?php else : ?> |
| [353](#L353) | <div class="updated"> |
| [354](#L354) | <p><?php esc\_html\_e( 'Settings have been saved.', 'wp-security-audit-log' ); ?></p> |
| [355](#L355) | </div> |
| [356](#L356) | <?php |
| [357](#L357) | endif; |
| [358](#L358) | } catch ( Exception $ex ) { |
| [359](#L359) | ?> |
| [360](#L360) | <div class="error"> |
| [361](#L361) | <p><?php esc\_html\_e( 'Error: ', 'wp-security-audit-log' ); ?><?php echo esc\_html( $ex->getMessage() ); ?></p> |
| [362](#L362) | </div> |
| [363](#L363) | <?php |
| [364](#L364) | } |
| [365](#L365) | } |
| [366](#L366) |  |
| [367](#L367) | if ( isset( $\_POST['import'] ) ) { |
| [368](#L368) | call\_user\_func( $this->wsal\_setting\_tabs[ $this->current\_tab ]['save'] ); |
| [369](#L369) | } |
| [370](#L370) |  |
| [371](#L371) | if ( isset( $\_GET['pruning'] ) && '1' === $\_GET['pruning'] ) { |
| [372](#L372) | ?> |
| [373](#L373) | <div class="updated"> |
| [374](#L374) | <p><?php esc\_html\_e( 'Old data successfully purged.', 'wp-security-audit-log' ); ?></p> |
| [375](#L375) | </div> |
| [376](#L376) | <?php |
| [377](#L377) | } elseif ( isset( $\_GET['pruning'] ) && '0' === $\_GET['pruning'] ) { |
| [378](#L378) | ?> |
| [379](#L379) | <div class="error"> |
| [380](#L380) | <p><?php esc\_html\_e( 'No data is old enough to be purged.', 'wp-security-audit-log' ); ?></p> |
| [381](#L381) | </div> |
| [382](#L382) | <?php |
| [383](#L383) | } |
| [384](#L384) | ?> |
| [385](#L385) | <nav id="wsal-tabs" class="nav-tab-wrapper"> |
| [386](#L386) | <?php foreach ( $this->wsal\_setting\_tabs as $tab\_id => $tab ) : ?> |
| [387](#L387) | <a href="<?php echo esc\_url( $tab['link'] ); ?>" class="nav-tab <?php echo ( $tab\_id === $this->current\_tab ) ? 'nav-tab-active' : false; ?>"> |
| [388](#L388) | <?php echo esc\_html( $tab['name'] ); ?> |
| [389](#L389) | </a> |
| [390](#L390) | <?php endforeach; ?> |
| [391](#L391) | </nav> |
| [392](#L392) |  |
| [393](#L393) | <form id="audit-log-settings" method="post"> |
| [394](#L394) | <input type="hidden" name="page" value="<?php echo isset( $\_GET['page'] ) ? esc\_attr( \sanitize\_text\_field( wp\_unslash( $\_GET['page'] ) ) ) : false; ?>" /> |
| [395](#L395) | <input type="hidden" id="ajaxurl" value="<?php echo esc\_attr( admin\_url( 'admin-ajax.php' ) ); ?>" /> |
| [396](#L396) | <?php wp\_nonce\_field( 'wsal-settings' ); ?> |
| [397](#L397) |  |
| [398](#L398) | <div id="audit-log-adverts"></div> |
| [399](#L399) | <div class="nav-tabs"> |
| [400](#L400) | <?php |
| [401](#L401) | if ( ! empty( $this->current\_tab ) && ! empty( $this->wsal\_setting\_tabs[ $this->current\_tab ]['render'] ) ) { |
| [402](#L402) | call\_user\_func( $this->wsal\_setting\_tabs[ $this->current\_tab ]['render'] ); |
| [403](#L403) | } else { |
| [404](#L404) | call\_user\_func( $this->wsal\_setting\_tabs['general']['render'] ); |
| [405](#L405) | } |
| [406](#L406) | ?> |
| [407](#L407) | </div> |
| [408](#L408) | <?php |
| [409](#L409) | if ( 'sms-provider' === $this->current\_tab && $section && 'test' === $section ) { |
| [410](#L410) | \submit\_button( esc\_html\_\_( 'Send Message', 'wp-security-audit-log' ) ); |
| [411](#L411) | } elseif ( 'settings-export-import' !== $this->current\_tab ) { |
| [412](#L412) | \submit\_button(); |
| [413](#L413) | } |
| [414](#L414) | ?> |
| [415](#L415) | </form> |
| [416](#L416) |  |
| [417](#L417) | <script> |
| [418](#L418) | function delete\_confirm(elementRef) { |
| [419](#L419) | if (elementRef.checked) { |
| [420](#L420) | if ( window.confirm('<?php esc\_html\_e( 'Do you want to remove all data when the plugin is deleted?', 'wp-security-audit-log' ); ?>') == false ) { |
| [421](#L421) | elementRef.checked = false; |
| [422](#L422) | // Ensure the "no" option is reselected. |
| [423](#L423) | jQuery('#delete\_data\_no').click(); |
| [424](#L424) | } |
| [425](#L425) | } |
| [426](#L426) | } |
| [427](#L427) |  |
| [428](#L428) | jQuery( document ).ready( function() { |
| [429](#L429) | // Enable/disable setting. |
| [430](#L430) | function wsal\_update\_setting( checkbox, setting ) { |
| [431](#L431) | if ( checkbox.prop( 'checked' ) ) { |
| [432](#L432) | setting.removeProp( 'disabled' ); |
| [433](#L433) | } else { |
| [434](#L434) | setting.prop( 'disabled', 'disabled' ); |
| [435](#L435) | } |
| [436](#L436) | } |
| [437](#L437) |  |
| [438](#L438) | // Login page notification settings. |
| [439](#L439) | var login\_page\_notif = jQuery( 'input[name=login\_page\_notification]' ); |
| [440](#L440) | var login\_page\_notif\_text = jQuery( '#login\_page\_notification\_text' ); |
| [441](#L441) |  |
| [442](#L442) | // Check the change event on checkbox. |
| [443](#L443) | login\_page\_notif.on( 'change', function() { |
| [444](#L444) | wsal\_update\_setting( login\_page\_notif, login\_page\_notif\_text ); |
| [445](#L445) | } ); |
| [446](#L446) |  |
| [447](#L447) | // Proxy settings. |
| [448](#L448) | var proxy\_ip\_setting = jQuery( 'input[name=EnableProxyIpCapture]' ); |
| [449](#L449) | var ip\_filtering = jQuery( '#EnableIpFiltering' ); |
| [450](#L450) | wsal\_update\_setting( proxy\_ip\_setting, ip\_filtering ); |
| [451](#L451) | proxy\_ip\_setting.on( 'change', function() { |
| [452](#L452) | wsal\_update\_setting( proxy\_ip\_setting, ip\_filtering ); |
| [453](#L453) | } ); |
| [454](#L454) | } ); |
| [455](#L455) | </script> |
| [456](#L456) | <?php |
| [457](#L457) | } |
| [458](#L458) |  |
| [459](#L459) | /\*\* |
| [460](#L460) | \* Tab: `General` |
| [461](#L461) | \*/ |
| [462](#L462) | private function tab\_general() { |
| [463](#L463) | $enforced\_settings                                   = Plugin\_Settings\_Helper::get\_mainwp\_enforced\_settings(); |
| [464](#L464) | $login\_page\_notification\_settings\_enforced\_by\_mainwp = array\_key\_exists( 'login\_notification\_enabled', $enforced\_settings ); |
| [465](#L465) | $incognito\_setting\_enforced\_by\_mainwp                = array\_key\_exists( 'incognito\_mode\_enabled', $enforced\_settings ); |
| [466](#L466) |  |
| [467](#L467) | ?> |
| [468](#L468) |  |
| [469](#L469) | <h3><?php esc\_html\_e( 'Display latest events widget in Dashboard & Admin bar', 'wp-security-audit-log' ); ?></h3> |
| [470](#L470) | <p class="description"> |
| [471](#L471) | <?php |
| [472](#L472) | echo sprintf( |
| [473](#L473) | /\* translators: Max number of dashboard widget alerts. \*/ |
| [474](#L474) | esc\_html\_\_( 'The events widget displays the latest %d security events in the dashboard and the admin bar notification displays the latest event.', 'wp-security-audit-log' ), |
| [475](#L475) | esc\_html( Settings\_Helper::DASHBOARD\_WIDGET\_MAX\_ALERTS ) |
| [476](#L476) | ); |
| [477](#L477) | ?> |
| [478](#L478) | </p> |
| [479](#L479) | <table class="form-table wsal-tab"> |
| [480](#L480) | <tbody> |
| [481](#L481) | <tr> |
| [482](#L482) | <th><label for="dwoption\_on"><?php esc\_html\_e( 'Dashboard Widget', 'wp-security-audit-log' ); ?></label></th> |
| [483](#L483) | <td> |
| [484](#L484) | <fieldset> |
| [485](#L485) | <?php $dwe = ! Settings\_Helper::get\_boolean\_option\_value( 'disable-widgets' ); ?> |
| [486](#L486) | <label for="dwoption\_on"> |
| [487](#L487) | <input type="radio" name="EnableDashboardWidgets" id="dwoption\_on" style="margin-top: -2px;" <?php checked( $dwe ); ?> value="1"> |
| [488](#L488) | <span><?php esc\_html\_e( 'Yes', 'wp-security-audit-log' ); ?></span> |
| [489](#L489) | </label> |
| [490](#L490) | <br/> |
| [491](#L491) | <label for="dwoption\_off"> |
| [492](#L492) | <input type="radio" name="EnableDashboardWidgets" id="dwoption\_off" style="margin-top: -2px;" <?php checked( $dwe, false ); ?>  value="0"> |
| [493](#L493) | <span><?php esc\_html\_e( 'No', 'wp-security-audit-log' ); ?></span> |
| [494](#L494) | </label> |
| [495](#L495) | </fieldset> |
| [496](#L496) | </td> |
| [497](#L497) | </tr> |
| [498](#L498) | <!-- / Events Dashboard Widget --> |
| [499](#L499) |  |
| [500](#L500) | <tr> |
| [501](#L501) | <?php |
| [502](#L502) | $disabled = ''; |
| [503](#L503) | $label    = esc\_html\_\_( 'Admin Bar Notification', 'wp-security-audit-log' ); |
| [504](#L504) | if ( wsal\_freemius()->is\_free\_plan() ) { |
| [505](#L505) | $disabled = 'disabled'; |
| [506](#L506) | $label    = esc\_html\_\_( 'Admin Bar Notification', 'wp-security-audit-log' ); |
| [507](#L507) | } |
| [508](#L508) | ?> |
| [509](#L509) | <th><label for="admin\_bar\_notif\_on"><?php echo esc\_html( $label ); ?></label></th> |
| [510](#L510) | <td> |
| [511](#L511) | <fieldset <?php echo esc\_attr( $disabled ); ?>> |
| [512](#L512) | <?php $abn = ! Settings\_Helper::get\_boolean\_option\_value( 'disable-admin-bar-notif', true ); ?> |
| [513](#L513) | <label for="admin\_bar\_notif\_on"> |
| [514](#L514) | <input type="radio" name="admin\_bar\_notif" id="admin\_bar\_notif\_on" style="margin-top: -2px;" <?php checked( $abn ); ?> value="1"> |
| [515](#L515) | <span><?php esc\_html\_e( 'Yes', 'wp-security-audit-log' ); ?></span> |
| [516](#L516) | </label> |
| [517](#L517) | <br/> |
| [518](#L518) | <label for="admin\_bar\_notif\_off"> |
| [519](#L519) | <input type="radio" name="admin\_bar\_notif" id="admin\_bar\_notif\_off" style="margin-top: -2px;" <?php checked( $abn, false ); ?>  value="0"> |
| [520](#L520) | <span><?php esc\_html\_e( 'No', 'wp-security-audit-log' ); ?></span> |
| [521](#L521) | </label> |
| [522](#L522) | </fieldset> |
| [523](#L523) | </td> |
| [524](#L524) | </tr> |
| [525](#L525) | <!-- / Admin Bar Notification --> |
| [526](#L526) |  |
| [527](#L527) | <tr> |
| [528](#L528) | <?php |
| [529](#L529) | $disabled = ''; |
| [530](#L530) | $label    = esc\_html\_\_( 'Admin Bar Notification Updates', 'wp-security-audit-log' ); |
| [531](#L531) | if ( wsal\_freemius()->is\_free\_plan() ) { |
| [532](#L532) | $disabled = 'disabled'; |
| [533](#L533) | $label    = esc\_html\_\_( 'Admin Bar Notification Updates', 'wp-security-audit-log' ); |
| [534](#L534) | } |
| [535](#L535) | ?> |
| [536](#L536) | <th><label for="admin\_bar\_notif\_refresh"><?php echo esc\_html( $label ); ?></label></th> |
| [537](#L537) | <td> |
| [538](#L538) | <fieldset <?php echo esc\_attr( $disabled ); ?>> |
| [539](#L539) | <?php $abn\_updates = WSAL\Helpers\Settings\_Helper::get\_option\_value( 'admin-bar-notif-updates', 'page-refresh' ); ?> |
| [540](#L540) | <label for="admin\_bar\_notif\_realtime"> |
| [541](#L541) | <input type="radio" name="admin\_bar\_notif\_updates" id="admin\_bar\_notif\_realtime" style="margin-top: -2px;" <?php checked( $abn\_updates, 'real-time' ); ?> value="real-time"> |
| [542](#L542) | <span><?php esc\_html\_e( 'Update in near real time', 'wp-security-audit-log' ); ?></span> |
| [543](#L543) | </label> |
| [544](#L544) | <br/> |
| [545](#L545) | <label for="admin\_bar\_notif\_refresh"> |
| [546](#L546) | <input type="radio" name="admin\_bar\_notif\_updates" id="admin\_bar\_notif\_refresh" style="margin-top: -2px;" <?php checked( $abn\_updates, 'page-refresh' ); ?>  value="page-refresh"> |
| [547](#L547) | <span><?php esc\_html\_e( 'Update only on page refreshes', 'wp-security-audit-log' ); ?></span> |
| [548](#L548) | </label> |
| [549](#L549) | </fieldset> |
| [550](#L550) | </td> |
| [551](#L551) | </tr> |
| [552](#L552) | <!-- / Admin Bar Notification Updates --> |
| [553](#L553) | </tbody> |
| [554](#L554) | </table> |
| [555](#L555) | <!-- Dashboard Widget --> |
| [556](#L556) |  |
| [557](#L557) | <h3><?php esc\_html\_e( 'Add user notification on the WordPress login page', 'wp-security-audit-log' ); ?></h3> |
| [558](#L558) | <p class="description"><?php esc\_html\_e( 'Many compliance regulations (such as the GDPR) require website administrators to tell the users of their website that all the changes they do when logged in are being logged.', 'wp-security-audit-log' ); ?></p> |
| [559](#L559) | <table class="form-table wsal-tab"> |
| [560](#L560) | <tbody> |
| [561](#L561) | <tr> |
| [562](#L562) | <th><label for="login\_page\_notification"><?php esc\_html\_e( 'Login Page Notification', 'wp-security-audit-log' ); ?></label></th> |
| [563](#L563) | <td> |
| [564](#L564) | <fieldset <?php echo disabled( $login\_page\_notification\_settings\_enforced\_by\_mainwp ); ?>> |
| [565](#L565) | <?php |
| [566](#L566) | // Get login page notification checkbox. |
| [567](#L567) | $wsal\_lpn = Settings\_Helper::get\_boolean\_option\_value( 'login\_page\_notification', false ); |
| [568](#L568) | if ( $wsal\_lpn && 'true' === $wsal\_lpn ) { |
| [569](#L569) | // If option exists, value is true then set to true. |
| [570](#L570) | $wsal\_lpn = true; |
| [571](#L571) | } elseif ( $wsal\_lpn && 'false' === $wsal\_lpn ) { |
| [572](#L572) | // If option exists, value is false then set to false. |
| [573](#L573) | $wsal\_lpn = false; |
| [574](#L574) | } elseif ( ! $wsal\_lpn ) { |
| [575](#L575) | // Default option value. |
| [576](#L576) | $wsal\_lpn = false; |
| [577](#L577) | } |
| [578](#L578) | ?> |
| [579](#L579) | <label for="wsal\_lpn\_yes"> |
| [580](#L580) | <input type="radio" name="login\_page\_notification" id="wsal\_lpn\_yes" <?php checked( $wsal\_lpn ); ?> value="true" /> |
| [581](#L581) | <?php esc\_html\_e( 'Yes', 'wp-security-audit-log' ); ?> |
| [582](#L582) | </label> |
| [583](#L583) | <br /> |
| [584](#L584) | <?php |
| [585](#L585) | // Get login page notification text. |
| [586](#L586) | $wsal\_lpn\_text = WSAL\Helpers\Settings\_Helper::get\_option\_value( 'login\_page\_notification\_text', false ); |
| [587](#L587) | if ( ! $wsal\_lpn\_text ) { |
| [588](#L588) | $wsal\_lpn\_text = \_\_( 'For security and auditing purposes, a record of all of your logged-in actions and changes within the WordPress dashboard will be recorded in an activity log with the <a href="https://melapress.com/?utm\_source=plugin&utm\_medium=referral&utm\_campaign=wsal&utm\_content=settings+pages" target="\_blank">WP Activity Log plugin</a>. The audit log also includes the IP address where you accessed this site from.', 'wp-security-audit-log' ); |
| [589](#L589) | } |
| [590](#L590) | // Allowed HTML tags for this setting. |
| [591](#L591) | $allowed\_tags = array( |
| [592](#L592) | 'a' => array( |
| [593](#L593) | 'href'   => array(), |
| [594](#L594) | 'title'  => array(), |
| [595](#L595) | 'target' => array(), |
| [596](#L596) | ), |
| [597](#L597) | ); |
| [598](#L598) |  |
| [599](#L599) | ?> |
| [600](#L600) | <textarea name="login\_page\_notification\_text" |
| [601](#L601) | id="login\_page\_notification\_text" |
| [602](#L602) | cols="60" rows="6" |
| [603](#L603) | <?php echo ( $wsal\_lpn ) ? false : 'disabled'; ?> |
| [604](#L604) | ><?php echo wp\_kses( $wsal\_lpn\_text, $allowed\_tags ); ?></textarea> |
| [605](#L605) | <br/> |
| [606](#L606) | <p class="description"> |
| [607](#L607) | <?php echo wp\_kses( \_\_( '<strong>Note: </strong>', 'wp-security-audit-log' ), Plugin\_Settings\_Helper::get\_allowed\_html\_tags() ) . esc\_html\_\_( 'The only HTML code allowed in the login page notification is for links ( < a href >< /a > ).', 'wp-security-audit-log' ); // phpcs:ignore ?> |
| [608](#L608) | </p> |
| [609](#L609) | <br /> |
| [610](#L610) |  |
| [611](#L611) | <label for="wsal\_lpn\_no"> |
| [612](#L612) | <input type="radio" name="login\_page\_notification" id="wsal\_lpn\_no" <?php checked( $wsal\_lpn, false ); ?> value="false" /> |
| [613](#L613) | <?php esc\_html\_e( 'No', 'wp-security-audit-log' ); ?> |
| [614](#L614) | </label> |
| [615](#L615) | </fieldset> |
| [616](#L616) | </td> |
| [617](#L617) | </tr> |
| [618](#L618) | <!-- / Login Page Notification --> |
| [619](#L619) | </tbody> |
| [620](#L620) | </table> |
| [621](#L621) | <!-- Login Page Notification --> |
| [622](#L622) |  |
| [623](#L623) | <h3><?php esc\_html\_e( 'Is your website running behind a firewall or reverse proxy?', 'wp-security-audit-log' ); ?></h3> |
| [624](#L624) | <p class="description"> |
| [625](#L625) | <?php |
| [626](#L626) | echo sprintf( |
| [627](#L627) | /\* translators: Learn more link. \*/ |
| [628](#L628) | esc\_html\_\_( 'If your website is running behind a firewall set this option to yes so the plugin retrieves the end user’s IP address from the proxy header - %s.', 'wp-security-audit-log' ), |
| [629](#L629) | '<a href="https://melapress.com/support/kb/wp-activity-log-support-reverse-proxies-web-application-firewalls/?utm\_source=plugin&utm\_medium=link&utm\_campaign=wsal" target="\_blank">' . esc\_html\_\_( 'learn more', 'wp-security-audit-log' ) . '</a>' |
| [630](#L630) | ); |
| [631](#L631) | ?> |
| [632](#L632) | </p> |
| [633](#L633) | <table class="form-table wsal-tab"> |
| [634](#L634) | <tbody> |
| [635](#L635) | <tr> |
| [636](#L636) | <th><label for="pioption\_on"><?php esc\_html\_e( 'Reverse Proxy / Firewall Options', 'wp-security-audit-log' ); ?></label></th> |
| [637](#L637) | <td> |
| [638](#L638) | <fieldset> |
| [639](#L639) | <label for="enable\_proxy\_ip\_capture\_yes"> |
| [640](#L640) | <input type="radio" name="EnableProxyIpCapture" value="1" id="enable\_proxy\_ip\_capture\_yes" <?php checked( Settings\_Helper::get\_boolean\_option\_value( 'use-proxy-ip' ) ); ?> /> |
| [641](#L641) | <?php esc\_html\_e( 'Yes', 'wp-security-audit-log' ); ?> |
| [642](#L642) | </label> |
| [643](#L643) | <br/> |
| [644](#L644) | <label for="EnableIpFiltering"> |
| [645](#L645) | <input type="checkbox" name="EnableIpFiltering" value="1" id="EnableIpFiltering" <?php checked( Plugin\_Settings\_Helper::is\_internal\_ips\_filtered() ); ?> /> |
| [646](#L646) | <?php esc\_html\_e( 'Filter internal IP addresses from the proxy headers. Enable this option only if you are      are still seeing the internal IP addresses of the firewall or proxy.', 'wp-security-audit-log' ); ?> |
| [647](#L647) | </label> |
| [648](#L648) | <br/> |
| [649](#L649) | <label for="enable\_proxy\_ip\_capture\_no"> |
| [650](#L650) | <input type="radio" name="EnableProxyIpCapture" value="0" id="enable\_proxy\_ip\_capture\_no" <?php checked( Settings\_Helper::get\_boolean\_option\_value( 'use-proxy-ip' ), false ); ?> /> |
| [651](#L651) | <?php esc\_html\_e( 'No', 'wp-security-audit-log' ); ?> |
| [652](#L652) | </label> |
| [653](#L653) | <br /> |
| [654](#L654) | </fieldset> |
| [655](#L655) | </td> |
| [656](#L656) | </tr> |
| [657](#L657) | <!-- / Reverse Proxy / Firewall Options --> |
| [658](#L658) | </tbody> |
| [659](#L659) | </table> |
| [660](#L660) | <!-- Reverse Proxy --> |
| [661](#L661) |  |
| [662](#L662) | <h3><?php esc\_html\_e( 'Who can change the plugin settings?', 'wp-security-audit-log' ); ?></h3> |
| [663](#L663) | <p class="description"> |
| [664](#L664) | <?php |
| [665](#L665) | $allowed\_tags = array( |
| [666](#L666) | 'a' => array( |
| [667](#L667) | 'href'   => true, |
| [668](#L668) | 'target' => true, |
| [669](#L669) | ), |
| [670](#L670) | ); |
| [671](#L671) | echo wp\_kses( |
| [672](#L672) | sprintf( |
| [673](#L673) | /\* translators: Learn more link. \*/ |
| [674](#L674) | esc\_html\_\_( 'By default only users with administrator role (single site) and super administrator role (multisite) can change the settings of the plugin. Though you can restrict the privileges to just your user - %s.', 'wp-security-audit-log' ), |
| [675](#L675) | '<a href="https://melapress.com/support/kb/wp-activity-log-managing-plugin-privileges/?utm\_source=plugin&utm\_medium=link&utm\_campaign=wsal" target="\_blank">' . \_\_( 'learn more', 'wp-security-audit-log' ) . '</a>' |
| [676](#L676) | ), |
| [677](#L677) | $allowed\_tags |
| [678](#L678) | ); |
| [679](#L679) | $restrict\_settings = Plugin\_Settings\_Helper::get\_restrict\_plugin\_setting(); |
| [680](#L680) | ?> |
| [681](#L681) | </p> |
| [682](#L682) | <table class="form-table wsal-tab"> |
| [683](#L683) | <tbody> |
| [684](#L684) | <tr> |
| [685](#L685) | <th><label for="RestrictAdmins"><?php esc\_html\_e( 'Restrict plugin access', 'wp-security-audit-log' ); ?></label></th> |
| [686](#L686) | <td> |
| [687](#L687) | <fieldset> |
| [688](#L688) | <label for="only\_me"> |
| [689](#L689) | <input type="radio" name="restrict-plugin-settings" id="only\_me" value="only\_me" <?php checked( $restrict\_settings, 'only\_me' ); ?> /> |
| [690](#L690) | <?php esc\_html\_e( 'Only me', 'wp-security-audit-log' ); ?> |
| [691](#L691) | </label> |
| [692](#L692) | <br/> |
| [693](#L693) | <label for="only\_admins"> |
| [694](#L694) | <input type="radio" name="restrict-plugin-settings" id="only\_admins" value="only\_admins" <?php checked( $restrict\_settings, 'only\_admins' ); ?> /> |
| [695](#L695) | <?php |
| [696](#L696) | if ( WP\_Helper::is\_multisite() ) { |
| [697](#L697) | esc\_html\_e( 'All superadmins', 'wp-security-audit-log' ); |
| [698](#L698) | } else { |
| [699](#L699) | esc\_html\_e( 'All administrators', 'wp-security-audit-log' ); |
| [700](#L700) | } |
| [701](#L701) | ?> |
| [702](#L702) | </label> |
| [703](#L703) | <br/> |
| [704](#L704) | </fieldset> |
| [705](#L705) | </td> |
| [706](#L706) | </tr> |
| [707](#L707) | <!-- / Restrict Plugin Access --> |
| [708](#L708) | </tbody> |
| [709](#L709) | </table> |
| [710](#L710) | <!-- Restrict Plugin Access --> |
| [711](#L711) |  |
| [712](#L712) | <h3><?php esc\_html\_e( 'Allow other users to view the activity log', 'wp-security-audit-log' ); ?></h3> |
| [713](#L713) | <p class="description"> |
| [714](#L714) | <?php |
| [715](#L715) | $is\_multisite = WP\_Helper::is\_multisite(); |
| [716](#L716) | if ( $is\_multisite ) { |
| [717](#L717) | $section\_label = esc\_html\_\_( 'By default only super administrators and the child sites\' administrators can view the WordPress activity log. Though you can change this by using the setting below.', 'wp-security-audit-log' ); |
| [718](#L718) | } else { |
| [719](#L719) | $section\_label = esc\_html\_\_( 'You can specify the username of the user that you want to allow. If you want to add all the users with a specific role, you can also specify their role here.', 'wp-security-audit-log' ); |
| [720](#L720) | } |
| [721](#L721) |  |
| [722](#L722) | echo wp\_kses( |
| [723](#L723) | $section\_label . ' - <a href="https://melapress.com/support/kb/wp-activity-log-allow-users-read-access-activity-log/?utm\_source=plugin&utm\_medium=link&utm\_campaign=wsal" target="\_blank">' . \_\_( 'learn more', 'wp-security-audit-log' ) . '</a>', |
| [724](#L724) | $allowed\_tags |
| [725](#L725) | ); |
| [726](#L726) | ?> |
| [727](#L727) | </p> |
| [728](#L728) | <?php if ( $is\_multisite ) : ?> |
| [729](#L729) | <table class="form-table wsal-tab"> |
| [730](#L730) | <tbody> |
| [731](#L731) | <tr> |
| [732](#L732) | <th><?php esc\_html\_e( 'Can view events', 'wp-security-audit-log' ); ?></th> |
| [733](#L733) | <td> |
| [734](#L734) | <fieldset> |
| [735](#L735) | <?php |
| [736](#L736) | $restrict\_settings          = Plugin\_Settings\_Helper::get\_restrict\_log\_viewer(); |
| [737](#L737) | $viewer\_restriction\_options = array( |
| [738](#L738) | 'only\_me'          => \_\_( 'Only me', 'wp-security-audit-log' ), |
| [739](#L739) | 'only\_superadmins' => \_\_( 'Super administators only', 'wp-security-audit-log' ), |
| [740](#L740) | 'only\_admins'      => \_\_( 'Super administators and site administrators', 'wp-security-audit-log' ), |
| [741](#L741) | ); |
| [742](#L742) | ?> |
| [743](#L743) | <?php foreach ( $viewer\_restriction\_options as $option => $label ) : ?> |
| [744](#L744) | <label for="<?php esc\_attr( 'log\_viewer\_' . $option ); ?>"> |
| [745](#L745) | <?php $disabled = ( 'only\_me' === $option && 'only\_superadmins' === $restrict\_settings ); ?> |
| [746](#L746) | <input type="radio" name="restrict-log-viewer" id="<?php esc\_attr( 'log\_viewer\_' . $option ); ?>" value="<?php echo esc\_attr( $option ); ?>" <?php checked( $restrict\_settings, $option ); ?> <?php disabled( $disabled ); ?> /> |
| [747](#L747) | <?php echo esc\_html( $label ); ?> |
| [748](#L748) | </label> |
| [749](#L749) | <br/> |
| [750](#L750) | <?php endforeach; ?> |
| [751](#L751) | </fieldset> |
| [752](#L752) | </td> |
| [753](#L753) | </tr> |
| [754](#L754) | </tbody> |
| [755](#L755) | </table> |
| [756](#L756) | <p class="description"><?php esc\_html\_e( 'To allow someone who does not have an admin role to view the activity log, specify them in the below setting.', 'wp-security-audit-log' ); ?></p> |
| [757](#L757) | <?php endif; ?> |
| [758](#L758) | <table class="form-table wsal-tab"> |
| [759](#L759) | <tbody> |
| [760](#L760) | <tr> |
| [761](#L761) | <?php $row\_label = $is\_multisite ? esc\_html\_\_( 'Can also view events', 'wp-security-audit-log' ) : esc\_html\_\_( 'Can view events', 'wp-security-audit-log' ); ?> |
| [762](#L762) | <th><label for="ViewerQueryBox"><?php echo $row\_label; // phpcs:ignore ?></label></th> |
| [763](#L763) | <td> |
| [764](#L764) | <fieldset> |
| [765](#L765) | <label> |
| [766](#L766) | <input type="text" id="ViewerQueryBox" style="width: 250px;"> |
| [767](#L767) | <input type="button" id="ViewerQueryAdd" class="button-primary" value="<?php esc\_attr\_e( 'Add', 'wp-security-audit-log' ); ?>"> |
| [768](#L768) |  |
| [769](#L769) | <p class="description"> |
| [770](#L770) | <?php esc\_html\_e( 'Specify the username or the users which do not have an admin role but can also see the WordPress activity role. You can also specify roles.', 'wp-security-audit-log' ); ?> |
| [771](#L771) | </p> |
| [772](#L772) | </label> |
| [773](#L773) |  |
| [774](#L774) | <div id="ViewerList"> |
| [775](#L775) | <?php |
| [776](#L776) | foreach ( Plugin\_Settings\_Helper::get\_allowed\_plugin\_viewers() as $item ) : |
| [777](#L777) | if ( User\_Helper::get\_current\_user()->user\_login === $item ) { |
| [778](#L778) | continue; |
| [779](#L779) | } |
| [780](#L780) | ?> |
| [781](#L781) | <span class="sectoken-<?php echo esc\_attr( Plugin\_Settings\_Helper::get\_token\_type( $item ) ); ?>"> |
| [782](#L782) | <input type="hidden" name="Viewers[]" value="<?php echo esc\_attr( $item ); ?>"/> |
| [783](#L783) | <?php echo esc\_html( $item ); ?> |
| [784](#L784) | <a href="javascript:;" title="<?php esc\_attr\_e( 'Remove', 'wp-security-audit-log' ); ?>">&times;</a> |
| [785](#L785) | </span> |
| [786](#L786) | <?php endforeach; ?> |
| [787](#L787) | </div> |
| [788](#L788) | </fieldset> |
| [789](#L789) | </td> |
| [790](#L790) | </tr> |
| [791](#L791) | <!-- / Can View Alerts --> |
| [792](#L792) | </tbody> |
| [793](#L793) | </table> |
| [794](#L794) | <!-- Can View Events --> |
| [795](#L795) |  |
| [796](#L796) | <h3><?php esc\_html\_e( 'Which email address should the plugin use as a from address?', 'wp-security-audit-log' ); ?></h3> |
| [797](#L797) | <p class="description"><?php esc\_html\_e( 'By default when the plugin sends an email notification it uses the email address specified in this website’s general settings. Though you can change the email address and display name from this section.', 'wp-security-audit-log' ); ?></p> |
| [798](#L798) | <table class="form-table wsal-tab"> |
| [799](#L799) | <tbody> |
| [800](#L800) | <tr> |
| [801](#L801) | <th><label for="FromEmail"><?php esc\_html\_e( 'From Email & Name', 'wp-security-audit-log' ); ?></label></th> |
| [802](#L802) | <td> |
| [803](#L803) | <fieldset> |
| [804](#L804) | <?php $use\_email = Settings\_Helper::get\_option\_value( 'use-email', 'default\_email' ); ?> |
| [805](#L805) | <label for="default\_email"> |
| [806](#L806) | <input type="radio" name="use-email" id="default\_email" value="default\_email" <?php checked( $use\_email, 'default\_email' ); ?> /> |
| [807](#L807) | <?php esc\_html\_e( 'Use the email address from the WordPress general settings', 'wp-security-audit-log' ); ?> |
| [808](#L808) | </label> |
| [809](#L809) | <br> |
| [810](#L810) | <label for="custom\_email"> |
| [811](#L811) | <input type="radio" name="use-email" id="custom\_email" value="custom\_email" <?php checked( $use\_email, 'custom\_email' ); ?> /> |
| [812](#L812) | <?php esc\_html\_e( 'Use another email address', 'wp-security-audit-log' ); ?> |
| [813](#L813) | </label> |
| [814](#L814) | <br> |
| [815](#L815) | <label for="FromEmail"> |
| [816](#L816) | <?php esc\_html\_e( 'Email Address', 'wp-security-audit-log' ); ?> |
| [817](#L817) | <input type="email" id="FromEmail" name="FromEmail" value="<?php echo esc\_attr( WSAL\Helpers\Settings\_Helper::get\_option\_value( 'from-email' ) ); ?>" /> |
| [818](#L818) | </label> |
| [819](#L819) | <br> |
| [820](#L820) | <label for="DisplayName"> |
| [821](#L821) | <?php esc\_html\_e( 'Display Name', 'wp-security-audit-log' ); ?>&nbsp; |
| [822](#L822) | <input type="text" id="DisplayName" name="DisplayName" value="<?php echo esc\_attr( WSAL\Helpers\Settings\_Helper::get\_option\_value( 'display-name' ) ); ?>" /> |
| [823](#L823) | </label> |
| [824](#L824) | </fieldset> |
| [825](#L825) | </td> |
| [826](#L826) | </tr> |
| [827](#L827) | <!-- / From Email & Name --> |
| [828](#L828) | </tbody> |
| [829](#L829) | </table> |
| [830](#L830) | <!-- From Email & Name --> |
| [831](#L831) |  |
| [832](#L832) | <?php |
| [833](#L833) | $is\_incognito = Settings\_Helper::get\_boolean\_option\_value( 'hide-plugin' ); |
| [834](#L834) | ?> |
| [835](#L835) | <h3><?php esc\_html\_e( 'Do you want to hide the plugin from the list of installed plugins?', 'wp-security-audit-log' ); ?></h3> |
| [836](#L836) | <p class="description"><?php esc\_html\_e( 'By default all installed plugins are listed in the plugins page. Set this option to Yes remove WP Activity Log from the list of installed plugins for users who are unable to access the WP Activity Log settings.', 'wp-security-audit-log' ); ?></p> |
| [837](#L837) | <table class="form-table wsal-tab"> |
| [838](#L838) | <tbody> |
| [839](#L839) | <tr> |
| [840](#L840) | <th><label for="incognito\_yes"><?php esc\_html\_e( 'Hide Plugin in Plugins Page', 'wp-security-audit-log' ); ?></label></th> |
| [841](#L841) | <td> |
| [842](#L842) | <fieldset <?php echo disabled( $incognito\_setting\_enforced\_by\_mainwp ); ?>> |
| [843](#L843) | <label for="incognito\_yes"> |
| [844](#L844) | <input type="radio" name="Incognito" value="yes" id="incognito\_yes" <?php checked( $is\_incognito ); ?> /> |
| [845](#L845) | <?php esc\_html\_e( 'Yes, hide the plugin from the list of installed plugins', 'wp-security-audit-log' ); ?> |
| [846](#L846) | </label> |
| [847](#L847) | <br/> |
| [848](#L848) | <label for="incognito\_no"> |
| [849](#L849) | <input type="radio" name="Incognito" value="no" id="incognito\_no" <?php checked( $is\_incognito, false ); ?> /> |
| [850](#L850) | <?php esc\_html\_e( 'No, do not hide the plugin', 'wp-security-audit-log' ); ?> |
| [851](#L851) | </label> |
| [852](#L852) | </fieldset> |
| [853](#L853) | </td> |
| [854](#L854) | </tr> |
| [855](#L855) | <!-- / Hide Plugin in Plugins Page --> |
| [856](#L856) | </tbody> |
| [857](#L857) | </table> |
| [858](#L858) | <!-- Hide Plugin --> |
| [859](#L859) | <?php |
| [860](#L860) | } |
| [861](#L861) |  |
| [862](#L862) | /\*\* |
| [863](#L863) | \* Save: `General` |
| [864](#L864) | \*/ |
| [865](#L865) | private function tab\_general\_save() { |
| [866](#L866) | // Get $\_POST global array. |
| [867](#L867) | $post\_array = filter\_input\_array( INPUT\_POST ); |
| [868](#L868) |  |
| [869](#L869) | // Settings\_Helper::set\_option\_value( 'disable-refresh', ! $post\_array['EnableAuditViewRefresh'] ); |
| [870](#L870) | Settings\_Helper::set\_option\_value( 'use-email', \sanitize\_text\_field( $post\_array['use-email'] ) ); |
| [871](#L871) | Settings\_Helper::set\_option\_value( 'from-email', trim( \sanitize\_email( $post\_array['FromEmail'] ) ) ); |
| [872](#L872) | Settings\_Helper::set\_option\_value( 'display-name', trim( \sanitize\_text\_field( $post\_array['DisplayName'] ) ) ); |
| [873](#L873) | Settings\_Helper::set\_boolean\_option\_value( 'disable-widgets', ! \sanitize\_text\_field( $post\_array['EnableDashboardWidgets'] ) ); |
| [874](#L874) |  |
| [875](#L875) | if ( ! wsal\_freemius()->is\_free\_plan() ) { |
| [876](#L876) | Settings\_Helper::set\_boolean\_option\_value( 'disable-admin-bar-notif', ! \sanitize\_text\_field( $post\_array['admin\_bar\_notif'] ), true ); |
| [877](#L877) | Settings\_Helper::set\_option\_value( 'admin-bar-notif-updates', \sanitize\_text\_field( $post\_array['admin\_bar\_notif\_updates'] ), true ); |
| [878](#L878) | } |
| [879](#L879) |  |
| [880](#L880) | // Handle log viewer settings in multisite context. |
| [881](#L881) | if ( WP\_Helper::is\_multisite() ) { |
| [882](#L882) | $log\_viewer\_restrictions = isset( $post\_array['restrict-log-viewer'] ) ? \sanitize\_text\_field( $post\_array['restrict-log-viewer'] ) : ''; |
| [883](#L883) | Plugin\_Settings\_Helper::set\_restrict\_log\_viewer( $log\_viewer\_restrictions ); |
| [884](#L884) | if ( 'only\_me' === $log\_viewer\_restrictions ) { |
| [885](#L885) | Plugin\_Settings\_Helper::set\_only\_me\_user\_id( \get\_current\_user\_id() ); |
| [886](#L886) | } |
| [887](#L887) | } |
| [888](#L888) |  |
| [889](#L889) | // Get plugin viewers. |
| [890](#L890) | $viewers = isset( $post\_array['Viewers'] ) ? array\_map( 'sanitize\_text\_field', $post\_array['Viewers'] ) : array(); |
| [891](#L891) | Plugin\_Settings\_Helper::set\_allowed\_plugin\_viewers( $viewers ); |
| [892](#L892) |  |
| [893](#L893) | // Handle plugin settings permissions. |
| [894](#L894) | $restrict\_settings = isset( $post\_array['restrict-plugin-settings'] ) ? \sanitize\_text\_field( $post\_array['restrict-plugin-settings'] ) : false; |
| [895](#L895) | Plugin\_Settings\_Helper::set\_restrict\_plugin\_setting( $restrict\_settings ); |
| [896](#L896) | if ( 'only\_me' === $restrict\_settings ) { |
| [897](#L897) | Plugin\_Settings\_Helper::set\_only\_me\_user\_id( get\_current\_user\_id() ); |
| [898](#L898) | } |
| [899](#L899) |  |
| [900](#L900) | Plugin\_Settings\_Helper::set\_login\_page\_notification( isset( $post\_array['login\_page\_notification'] ) ? \sanitize\_text\_field( $post\_array['login\_page\_notification'] ) : false ); |
| [901](#L901) | Plugin\_Settings\_Helper::set\_login\_page\_notification\_text( isset( $post\_array['login\_page\_notification\_text'] ) ? $post\_array['login\_page\_notification\_text'] : false ); |
| [902](#L902) | Plugin\_Settings\_Helper::set\_main\_ip\_from\_proxy( isset( $post\_array['EnableProxyIpCapture'] ) ? \sanitize\_text\_field( $post\_array['EnableProxyIpCapture'] ) : false ); |
| [903](#L903) | Plugin\_Settings\_Helper::set\_internal\_ips\_filtering( isset( $post\_array['EnableIpFiltering'] ) ? \sanitize\_text\_field( $post\_array['EnableIpFiltering'] ) : false ); |
| [904](#L904) |  |
| [905](#L905) | $is\_incognito = isset( $post\_array['Incognito'] ) ? Settings\_Helper::string\_to\_bool( \sanitize\_text\_field( $post\_array['Incognito'] ) ) : false; |
| [906](#L906) | Plugin\_Settings\_Helper::set\_incognito( $is\_incognito ); |
| [907](#L907) | } |
| [908](#L908) |  |
| [909](#L909) | /\*\* |
| [910](#L910) | \* Tab: `Audit Log` |
| [911](#L911) | \*/ |
| [912](#L912) | private function tab\_audit\_log() { |
| [913](#L913) | ?> |
| [914](#L914) | <h3><?php esc\_html\_e( 'For how long do you want to keep the activity log events (Retention settings)?', 'wp-security-audit-log' ); ?></h3> |
| [915](#L915) | <p class="description"> |
| [916](#L916) | <?php |
| [917](#L917) | esc\_html\_e( 'The plugin uses an efficient way to store the activity log data in the WordPress database, though the more data you keep the more disk space will be required. ', 'wp-security-audit-log' ); |
| [918](#L918) | $retention\_help\_text = \_\_( '<a href="https://melapress.com/wordpress-activity-log/pricing/?utm\_source=plugin&utm\_medium=link&utm\_campaign=wsal" target="\_blank">Upgrade to Premium</a> to store the activity log data in an external database.', 'wp-security-audit-log' ); |
| [919](#L919) |  |
| [920](#L920) | // phpcs:disable |
| [921](#L921) | // phpcs:enable |
| [922](#L922) | echo wp\_kses( $retention\_help\_text, Plugin\_Settings\_Helper::get\_allowed\_html\_tags() ); |
| [923](#L923) | ?> |
| [924](#L924) | </p> |
| [925](#L925) |  |
| [926](#L926) | <?php |
| [927](#L927) | // phpcs:disable |
| [928](#L928) | /\* @free:start \*/ |
| [929](#L929) | // phpcs:enable |
| [930](#L930) | // Ensure it doesn't load a 2nd time for premium users. |
| [931](#L931) | if ( ! wsal\_freemius()->can\_use\_premium\_code() ) { |
| [932](#L932) | $this->render\_retention\_settings\_table(); |
| [933](#L933) | } |
| [934](#L934) | // phpcs:disable |
| [935](#L935) | /\* @free:end \*/ |
| [936](#L936) | // phpcs:enable |
| [937](#L937) | ?> |
| [938](#L938) |  |
| [939](#L939) | <h3><?php esc\_html\_e( 'What timestamp you would like to see in the WordPress activity log?', 'wp-security-audit-log' ); ?></h3> |
| [940](#L940) | <p class="description"><?php esc\_html\_e( 'Note that the WordPress\' timezone might be different from that configured on the server so when you switch from UTC to WordPress timezone or vice versa you might notice a big difference.', 'wp-security-audit-log' ); ?></p> |
| [941](#L941) | <table class="form-table wsal-tab"> |
| [942](#L942) | <tbody> |
| [943](#L943) | <tr> |
| [944](#L944) | <th><label for="timezone-default"><?php esc\_html\_e( 'Events Timestamp', 'wp-security-audit-log' ); ?></label></th> |
| [945](#L945) | <td> |
| [946](#L946) | <fieldset> |
| [947](#L947) | <?php |
| [948](#L948) | $timezone = Settings\_Helper::get\_timezone(); |
| [949](#L949) |  |
| [950](#L950) | /\*\* |
| [951](#L951) | \* Transform timezone values. |
| [952](#L952) | \* |
| [953](#L953) | \* @since 3.2.3 |
| [954](#L954) | \*/ |
| [955](#L955) | if ( '0' === $timezone ) { |
| [956](#L956) | $timezone = 'utc'; |
| [957](#L957) | } elseif ( '1' === $timezone ) { |
| [958](#L958) | $timezone = 'wp'; |
| [959](#L959) | } |
| [960](#L960) | ?> |
| [961](#L961) | <label for="timezone-default"> |
| [962](#L962) | <input type="radio" name="Timezone" id="timezone-default" style="margin-top: -2px;" |
| [963](#L963) | <?php checked( $timezone, 'utc' ); ?> value="utc"> |
| [964](#L964) | <?php esc\_html\_e( 'UTC', 'wp-security-audit-log' ); ?> |
| [965](#L965) | </label> |
| [966](#L966) | <br/> |
| [967](#L967) | <label for="timezone"> |
| [968](#L968) | <input type="radio" name="Timezone" id="timezone" style="margin-top: -2px;" |
| [969](#L969) | <?php checked( $timezone, 'wp' ); ?> value="wp"> |
| [970](#L970) | <?php esc\_html\_e( 'Timezone configured on this WordPress website', 'wp-security-audit-log' ); ?> |
| [971](#L971) | </label> |
| [972](#L972) | </fieldset> |
| [973](#L973) | </td> |
| [974](#L974) | </tr> |
| [975](#L975) | <!-- Alerts Timestamp --> |
| [976](#L976) | <tr> |
| [977](#L977) | <th><?php esc\_html\_e( 'Show Milliseconds', 'wp-security-audit-log' ); ?></th> |
| [978](#L978) | <td> |
| [979](#L979) | <fieldset> |
| [980](#L980) | <?php $show\_milliseconds = Settings\_Helper::get\_show\_milliseconds(); ?> |
| [981](#L981) | <label for="show\_milliseconds"> |
| [982](#L982) | <input type="checkbox" name="show\_milliseconds" id="show\_milliseconds" style="margin-top: -2px;" |
| [983](#L983) | <?php checked( $show\_milliseconds ); ?> value="yes"> |
| [984](#L984) | <?php esc\_html\_e( 'Show Milliseconds in list view', 'wp-security-audit-log' ); ?> |
| [985](#L985) | </label> |
| [986](#L986) | </fieldset> |
| [987](#L987) | </td> |
| [988](#L988) | </tr> |
| [989](#L989) | <!-- Alerts Timestamp --> |
| [990](#L990) | </tbody> |
| [991](#L991) | </table> |
| [992](#L992) | <!-- Timestamp --> |
| [993](#L993) |  |
| [994](#L994) | <h3><?php esc\_html\_e( 'What user information should be displayed in the WordPress activity log?', 'wp-security-audit-log' ); ?></h3> |
| [995](#L995) | <p class="description"><?php esc\_html\_e( 'Usernames might not be the same as a user\'s first and last name so it can be difficult to recognize whose user was that did a change. When there is no first & last name or public display name configured the plugin will revert back to the WordPress username.', 'wp-security-audit-log' ); ?></p> |
| [996](#L996) | <table class="form-table wsal-tab"> |
| [997](#L997) | <tbody> |
| [998](#L998) | <tr> |
| [999](#L999) | <th><label for="timezone-default"><?php esc\_html\_e( 'User information in Activity log', 'wp-security-audit-log' ); ?></label></th> |
| [1000](#L1000) | <td> |
| [1001](#L1001) | <fieldset> |
| [1002](#L1002) | <?php $type\_username = Plugin\_Settings\_Helper::get\_type\_username(); ?> |
| [1003](#L1003) | <label for="column\_username"> |
| [1004](#L1004) | <input type="radio" name="type\_username" id="column\_username" style="margin-top: -2px;" <?php checked( $type\_username, 'username' ); ?> value="username"> |
| [1005](#L1005) | <span><?php esc\_html\_e( 'WordPress username', 'wp-security-audit-log' ); ?></span> |
| [1006](#L1006) | </label> |
| [1007](#L1007) | <br/> |
| [1008](#L1008) | <label for="columns\_first\_last\_name"> |
| [1009](#L1009) | <input type="radio" name="type\_username" id="columns\_first\_last\_name" style="margin-top: -2px;" <?php checked( $type\_username, 'first\_last\_name' ); ?> value="first\_last\_name"> |
| [1010](#L1010) | <span><?php esc\_html\_e( 'First name & last name', 'wp-security-audit-log' ); ?></span> |
| [1011](#L1011) | </label> |
| [1012](#L1012) | <br/> |
| [1013](#L1013) | <label for="columns\_display\_name"> |
| [1014](#L1014) | <input type="radio" name="type\_username" id="columns\_display\_name" style="margin-top: -2px;" <?php checked( $type\_username, 'display\_name' ); ?> value="display\_name"> |
| [1015](#L1015) | <span><?php esc\_html\_e( 'Configured public display name', 'wp-security-audit-log' ); ?></span> |
| [1016](#L1016) | </label> |
| [1017](#L1017) | </fieldset> |
| [1018](#L1018) | </td> |
| [1019](#L1019) | </tr> |
| [1020](#L1020) | <!-- Select type of name --> |
| [1021](#L1021) | </tbody> |
| [1022](#L1022) | </table> |
| [1023](#L1023) | <!-- User Information --> |
| [1024](#L1024) |  |
| [1025](#L1025) | <?php $is\_wp\_backend = Settings\_Helper::get\_boolean\_option\_value( 'wp-backend' ); ?> |
| [1026](#L1026) | <h3><?php esc\_html\_e( 'Do you want to keep a log of WordPress background activity?', 'wp-security-audit-log' ); ?></h3> |
| [1027](#L1027) | <p class="description"> |
| [1028](#L1028) | <?php esc\_html\_e( 'WordPress does a lot of things in the background that you do not necessarily need to know about, such as; deletion of post revisions, deletion of auto saved drafts etc. By default the plugin does not report them since there might be a lot and are irrelevant to the user.', 'wp-security-audit-log' ); ?> |
| [1029](#L1029) | </p> |
| [1030](#L1030) | <table class="form-table wsal-tab"> |
| [1031](#L1031) | <tbody> |
| [1032](#L1032) | <tr> |
| [1033](#L1033) | <th><label for="wp\_backend\_no"><?php esc\_html\_e( 'Enable Events for WordPress Background Activity', 'wp-security-audit-log' ); ?></label></th> |
| [1034](#L1034) | <td> |
| [1035](#L1035) | <fieldset> |
| [1036](#L1036) | <label for="wp\_backend\_yes"> |
| [1037](#L1037) | <input type="radio" name="WPBackend" value="1" id="wp\_backend\_yes" <?php checked( $is\_wp\_backend ); ?> /> |
| [1038](#L1038) | <?php esc\_html\_e( 'Yes', 'wp-security-audit-log' ); ?> |
| [1039](#L1039) | </label> |
| [1040](#L1040) | <br/> |
| [1041](#L1041) | <label for="wp\_backend\_no"> |
| [1042](#L1042) | <input type="radio" name="WPBackend" value="0" id="wp\_backend\_no" <?php checked( ! $is\_wp\_backend ); ?> /> |
| [1043](#L1043) | <?php esc\_html\_e( 'No', 'wp-security-audit-log' ); ?> |
| [1044](#L1044) | </label> |
| [1045](#L1045) | </fieldset> |
| [1046](#L1046) | </td> |
| [1047](#L1047) | </tr> |
| [1048](#L1048) | <!-- Disable Alerts for WordPress Background activity --> |
| [1049](#L1049) | </tbody> |
| [1050](#L1050) | </table> |
| [1051](#L1051) | <!-- Background Events --> |
| [1052](#L1052) | <?php |
| [1053](#L1053) | } |
| [1054](#L1054) |  |
| [1055](#L1055) | /\*\* |
| [1056](#L1056) | \* Save: `Audit Log` |
| [1057](#L1057) | \*/ |
| [1058](#L1058) | private function tab\_audit\_log\_save() { |
| [1059](#L1059) | // Get $\_POST global array. |
| [1060](#L1060) | $post\_array = filter\_input\_array( INPUT\_POST ); |
| [1061](#L1061) |  |
| [1062](#L1062) | // Get pruning date. |
| [1063](#L1063) | $pruning\_date = isset( $post\_array['PruningDate'] ) ? (int) \sanitize\_text\_field( $post\_array['PruningDate'] ) : false; |
| [1064](#L1064) | $pruning\_unit = isset( $post\_array['pruning-unit'] ) ? \sanitize\_text\_field( $post\_array['pruning-unit'] ) : false; |
| [1065](#L1065) | $pruning\_date = ( ! empty( $pruning\_date ) && ! empty( $pruning\_unit ) ) ? $pruning\_date . ' ' . $pruning\_unit : false; |
| [1066](#L1066) |  |
| [1067](#L1067) | $pruning\_enabled = isset( $post\_array['PruneBy'] ) ? 'date' === $post\_array['PruneBy'] : ''; |
| [1068](#L1068) | Settings\_Helper::set\_pruning\_date\_settings( $pruning\_enabled, $pruning\_date, $pruning\_unit ); |
| [1069](#L1069) | Plugin\_Settings\_Helper::set\_timezone( $post\_array['Timezone'] ); |
| [1070](#L1070) | Plugin\_Settings\_Helper::set\_type\_username( $post\_array['type\_username'] ); |
| [1071](#L1071) | Settings\_Helper::set\_boolean\_option\_value( 'wp-backend', isset( $post\_array['WPBackend'] ) ? \sanitize\_text\_field( $post\_array['WPBackend'] ) : false ); |
| [1072](#L1072) |  |
| [1073](#L1073) | $show\_milliseconds = isset( $post\_array['show\_milliseconds'] ) && 'yes' === $post\_array['show\_milliseconds']; |
| [1074](#L1074) | Plugin\_Settings\_Helper::set\_show\_milliseconds( $show\_milliseconds ); |
| [1075](#L1075) | } |
| [1076](#L1076) |  |
| [1077](#L1077) | /\*\* |
| [1078](#L1078) | \* Tab: `File Changes` |
| [1079](#L1079) | \*/ |
| [1080](#L1080) | private function tab\_file\_changes() { |
| [1081](#L1081) | ?> |
| [1082](#L1082) |  |
| [1083](#L1083) | <table class="form-table wsal-tab"> |
| [1084](#L1084) | <tbody> |
| [1085](#L1085) | <tr> |
| [1086](#L1086) | <?php if ( ! defined( 'WFCM\_PLUGIN\_FILE' ) && ! defined( 'MFM\_BASE\_URL' ) ) : ?> |
| [1087](#L1087) | <div class="addon-wrapper" style="max-width: 380px; text-align: center; border: 1px solid #ccc; padding: 25px;"> |
| [1088](#L1088) | <img src="<?php echo esc\_html( trailingslashit( WSAL\_BASE\_URL ) . 'img/help/website-file-changes-monitor.jpg' ); ?>"> |
| [1089](#L1089) | <h4><?php echo esc\_html\_\_( 'Melapress File Monitor', 'wp-security-audit-log' ); ?></h4> |
| [1090](#L1090) | <p><?php echo esc\_html\_\_( 'To keep a log of file changes please install Melapress File Monitor, a plugin which is also developed by us.', 'wp-security-audit-log' ); ?></p><br> |
| [1091](#L1091) | <p><button class="install-addon button button-primary" data-nonce="<?php echo esc\_attr( wp\_create\_nonce( 'wsal-install-addon' ) ); ?>" data-plugin-slug="website-file-changes-monitor/website-file-changes-monitor.php" data-plugin-download-url="https://downloads.wordpress.org/plugin/website-file-changes-monitor.latest-stable.zip"><?php esc\_html\_e( 'Install plugin now', 'wp-security-audit-log' ); ?></button><span class="spinner" style="display: none; visibility: visible; float: none; margin: 0 0 0 8px;"></span> <a href="https://melapress.com/support/kb/wp-activity-log-wordpress-files-changes-warning-activity-logs/?utm\_source=plugin&utm\_medium=link&utm\_campaign=wsal" rel="noopener noreferrer" target="\_blank" style="margin-left: 15px;"><?php esc\_html\_e( 'Learn More', 'wp-security-audit-log' ); ?></a></p> |
| [1092](#L1092) | </div> |
| [1093](#L1093) | <?php else : ?> |
| [1094](#L1094) | <?php |
| [1095](#L1095) | $redirect\_args = array( |
| [1096](#L1096) | 'page' => 'file-monitor-settings', |
| [1097](#L1097) | ); |
| [1098](#L1098) |  |
| [1099](#L1099) | $wcfm\_settings\_page = add\_query\_arg( $redirect\_args, \network\_admin\_url( 'admin.php' ) ); |
| [1100](#L1100) | ?> |
| [1101](#L1101) | <p><?php echo esc\_html\_\_( 'Configure how often file changes scan run and other settings from the', 'wp-security-audit-log' ); ?> <a class="button button-primary" href="<?php echo esc\_url( $wcfm\_settings\_page ); ?>"><?php echo esc\_html\_\_( 'Melapress File Monitor plugin settings', 'wp-security-audit-log' ); ?></a></p> |
| [1102](#L1102) | <?php endif; ?> |
| [1103](#L1103) | </tr> |
| [1104](#L1104) | </tbody> |
| [1105](#L1105) | </table> |
| [1106](#L1106) | <style> |
| [1107](#L1107) | #submit { |
| [1108](#L1108) | display: none !important; |
| [1109](#L1109) | } |
| [1110](#L1110) | </style> |
| [1111](#L1111) | <!-- / File Changes Logging Tab --> |
| [1112](#L1112) | <?php |
| [1113](#L1113) | } |
| [1114](#L1114) |  |
| [1115](#L1115) | /\*\* |
| [1116](#L1116) | \* Tab: `Exclude Objects` |
| [1117](#L1117) | \*/ |
| [1118](#L1118) | private function tab\_exclude\_objects() { |
| [1119](#L1119) | ?> |
| [1120](#L1120) | <p class="description"><?php esc\_html\_e( 'By default the plugin keeps a log of all user changes done on your WordPress website. Use the setting below to exclude any objects from the activity log. When an object is excluded from the activity log, any event in which that object is referred will not be logged in the activity log.', 'wp-security-audit-log' ); ?></p> |
| [1121](#L1121) | <table class="form-table wsal-tab"> |
| [1122](#L1122) | <tbody> |
| [1123](#L1123) | <tr> |
| [1124](#L1124) | <th><label for="ExUserQueryBox"><?php esc\_html\_e( 'Exclude Users:', 'wp-security-audit-log' ); ?></label></th> |
| [1125](#L1125) | <td> |
| [1126](#L1126) | <fieldset> |
| [1127](#L1127) | <input type="text" id="ExUserQueryBox" style="width: 250px;"> |
| [1128](#L1128) | <input type="button" id="ExUserQueryAdd" class="button-primary" value="<?php esc\_attr\_e( 'Add', 'wp-security-audit-log' ); ?>"> |
| [1129](#L1129) | <br style="clear: both;"/> |
| [1130](#L1130) | <div id="ExUserList"> |
| [1131](#L1131) | <?php foreach ( Settings\_Helper::get\_excluded\_monitoring\_users() as $item ) : ?> |
| [1132](#L1132) | <span class="sectoken-<?php echo esc\_attr( Plugin\_Settings\_Helper::get\_token\_type( $item ) ); ?>"> |
| [1133](#L1133) | <input type="hidden" name="ExUsers[]" value="<?php echo esc\_attr( $item ); ?>"/> |
| [1134](#L1134) | <?php echo esc\_html( $item ); ?> |
| [1135](#L1135) | <a href="javascript:;" title="<?php esc\_attr\_e( 'Remove', 'wp-security-audit-log' ); ?>">&times;</a> |
| [1136](#L1136) | </span> |
| [1137](#L1137) | <?php endforeach; ?> |
| [1138](#L1138) | </div> |
| [1139](#L1139) | </fieldset> |
| [1140](#L1140) | </td> |
| [1141](#L1141) | </tr> |
| [1142](#L1142) | <!-- Exclude Users --> |
| [1143](#L1143) |  |
| [1144](#L1144) | <tr> |
| [1145](#L1145) | <th><label for="ExRoleQueryBox"><?php esc\_html\_e( 'Exclude Roles:', 'wp-security-audit-log' ); ?></label></th> |
| [1146](#L1146) | <td> |
| [1147](#L1147) | <fieldset> |
| [1148](#L1148) | <input type="text" id="ExRoleQueryBox" style="width: 250px;"> |
| [1149](#L1149) | <input type="button" id="ExRoleQueryAdd" class="button-primary" value="<?php esc\_attr\_e( 'Add', 'wp-security-audit-log' ); ?>"> |
| [1150](#L1150) | <br style="clear: both;"/> |
| [1151](#L1151) | <div id="ExRoleList"> |
| [1152](#L1152) | <?php foreach ( Settings\_Helper::get\_excluded\_monitoring\_roles() as $item ) : ?> |
| [1153](#L1153) | <span class="sectoken-<?php echo esc\_attr( Plugin\_Settings\_Helper::get\_token\_type( $item ) ); ?>"> |
| [1154](#L1154) | <input type="hidden" name="ExRoles[]" value="<?php echo esc\_attr( $item ); ?>"/> |
| [1155](#L1155) | <?php echo esc\_html( $item ); ?> |
| [1156](#L1156) | <a href="javascript:;" title="<?php esc\_attr\_e( 'Remove', 'wp-security-audit-log' ); ?>">&times;</a> |
| [1157](#L1157) | </span> |
| [1158](#L1158) | <?php endforeach; ?> |
| [1159](#L1159) | </div> |
| [1160](#L1160) | </fieldset> |
| [1161](#L1161) | </td> |
| [1162](#L1162) | </tr> |
| [1163](#L1163) | <!-- Exclude Roles --> |
| [1164](#L1164) |  |
| [1165](#L1165) | <tr> |
| [1166](#L1166) | <th><label for="IpAddrQueryBox"><?php esc\_html\_e( 'Exclude IP Address(es):', 'wp-security-audit-log' ); ?></label></th> |
| [1167](#L1167) | <td> |
| [1168](#L1168) | <fieldset> |
| [1169](#L1169) | <input type="text" id="IpAddrQueryBox" style="width: 250px;"> |
| [1170](#L1170) | <input type="button" id="IpAddrQueryAdd" class="button-primary" value="<?php esc\_attr\_e( 'Add', 'wp-security-audit-log' ); ?>"> |
| [1171](#L1171) | <br style="clear: both;"/> |
| [1172](#L1172) | <div id="IpAddrList"> |
| [1173](#L1173) | <?php foreach ( Settings\_Helper::get\_excluded\_monitoring\_ips() as $item ) : ?> |
| [1174](#L1174) | <span class="sectoken-<?php echo esc\_attr( Plugin\_Settings\_Helper::get\_token\_type( $item ) ); ?>"> |
| [1175](#L1175) | <input type="hidden" name="IpAddrs[]" value="<?php echo esc\_attr( $item ); ?>"/> |
| [1176](#L1176) | <?php echo esc\_html( $item ); ?> |
| [1177](#L1177) | <a href="javascript:;" title="<?php esc\_attr\_e( 'Remove', 'wp-security-audit-log' ); ?>">&times;</a> |
| [1178](#L1178) | </span> |
| [1179](#L1179) | <?php endforeach; ?> |
| [1180](#L1180) | </div> |
| [1181](#L1181) | </fieldset> |
| [1182](#L1182) | <p class="description"><?php esc\_html\_e( 'You can exclude an individual IP address or a range of IP addresses. To exclude a range use the following format: [first IP]-[last octet of the last IP]. Example: 172.16.180.6-127.', 'wp-security-audit-log' ); ?></p> |
| [1183](#L1183) | </td> |
| [1184](#L1184) | </tr> |
| [1185](#L1185) | <!-- Exclude IP Addresses --> |
| [1186](#L1186) |  |
| [1187](#L1187) | <tr> |
| [1188](#L1188) | <th><label for="ExCPTsQueryBox"><?php esc\_html\_e( 'Exclude Post Type:', 'wp-security-audit-log' ); ?></label></th> |
| [1189](#L1189) | <td> |
| [1190](#L1190) | <fieldset> |
| [1191](#L1191) | <input type="text" id="ExCPTsQueryBox" style="width: 250px;"> |
| [1192](#L1192) | <input type="button" id="ExCPTsQueryAdd" class="button-primary" value="<?php esc\_attr\_e( 'Add', 'wp-security-audit-log' ); ?>"> |
| [1193](#L1193) | <br style="clear: both;"/> |
| [1194](#L1194) | <div id="ExCPTsList"> |
| [1195](#L1195) | <?php foreach ( Settings\_Helper::get\_excluded\_post\_types() as $item ) : ?> |
| [1196](#L1196) | <span class="sectoken-<?php echo esc\_attr( Plugin\_Settings\_Helper::get\_token\_type( $item ) ); ?>"> |
| [1197](#L1197) | <input type="hidden" name="ExCPTss[]" value="<?php echo esc\_attr( $item ); ?>"/> |
| [1198](#L1198) | <?php echo esc\_html( $item ); ?> |
| [1199](#L1199) | <a href="javascript:;" title="<?php esc\_attr\_e( 'Remove', 'wp-security-audit-log' ); ?>">&times;</a> |
| [1200](#L1200) | </span> |
| [1201](#L1201) | <?php endforeach; ?> |
| [1202](#L1202) | </div> |
| [1203](#L1203) | </fieldset> |
| [1204](#L1204) | <p class="description"><?php esc\_html\_e( 'WordPress has the post and page post types by default though your website might use more post types (custom post types). You can exclude all post types, including the default WordPress ones.', 'wp-security-audit-log' ); ?></p> |
| [1205](#L1205) | </td> |
| [1206](#L1206) | </tr> |
| [1207](#L1207) | <!-- Exclude Custom Post Types --> |
| [1208](#L1208) |  |
| [1209](#L1209) | <tr> |
| [1210](#L1210) | <th><label for="StatusQueryBox"><?php esc\_html\_e( 'Exclude Post Status:', 'wp-security-audit-log' ); ?></label></th> |
| [1211](#L1211) | <td> |
| [1212](#L1212) | <fieldset> |
| [1213](#L1213) | <input type="text" id="StatusQueryBox" style="width: 250px;"> |
| [1214](#L1214) | <input type="button" id="StatusQueryAdd" class="button-primary" value="<?php esc\_attr\_e( 'Add', 'wp-security-audit-log' ); ?>"> |
| [1215](#L1215) | <br style="clear: both;"/> |
| [1216](#L1216) | <div id="StatusList"> |
| [1217](#L1217) | <?php foreach ( Settings\_Helper::get\_excluded\_post\_statuses() as $item ) : ?> |
| [1218](#L1218) | <span class="sectoken-<?php echo esc\_attr( Plugin\_Settings\_Helper::get\_token\_type( $item ) ); ?>"> |
| [1219](#L1219) | <input type="hidden" name="Statuss[]" value="<?php echo esc\_attr( $item ); ?>"/> |
| [1220](#L1220) | <?php echo esc\_html( $item ); ?> |
| [1221](#L1221) | <a href="javascript:;" title="<?php esc\_attr\_e( 'Remove', 'wp-security-audit-log' ); ?>">&times;</a> |
| [1222](#L1222) | </span> |
| [1223](#L1223) | <?php endforeach; ?> |
| [1224](#L1224) | </div> |
| [1225](#L1225) | </fieldset> |
| [1226](#L1226) | <p class="description"><?php esc\_html\_e( 'You can exclude posts which have a specific Post Status from the activity logs by specifying the Post Status in this setting.', 'wp-security-audit-log' ); ?></p> |
| [1227](#L1227) | </td> |
| [1228](#L1228) | </tr> |
| [1229](#L1229) | <!-- Exclude Custom Post Status --> |
| [1230](#L1230) |  |
| [1231](#L1231) | <?php |
| [1232](#L1232) | $this->renderMetaExclusionSection( |
| [1233](#L1233) | esc\_html\_\_( 'Exclude custom post fields:', 'wp-security-audit-log' ), |
| [1234](#L1234) | Settings\_Helper::get\_excluded\_post\_meta\_fields(), |
| [1235](#L1235) | 'PostMeta' |
| [1236](#L1236) | ); |
| [1237](#L1237) | ?> |
| [1238](#L1238) | <!-- Exclude Custom Post Fields --> |
| [1239](#L1239) |  |
| [1240](#L1240) | <?php |
| [1241](#L1241) | $this->renderMetaExclusionSection( |
| [1242](#L1242) | esc\_html\_\_( 'Exclude custom user fields:', 'wp-security-audit-log' ), |
| [1243](#L1243) | Settings\_Helper::get\_excluded\_user\_meta\_fields(), |
| [1244](#L1244) | 'UserMeta' |
| [1245](#L1245) | ); |
| [1246](#L1246) | ?> |
| [1247](#L1247) | <!-- Exclude Custom User Fields --> |
| [1248](#L1248) |  |
| [1249](#L1249) | </tbody> |
| [1250](#L1250) | </table> |
| [1251](#L1251) | <!-- / Exclude Objects Tab --> |
| [1252](#L1252) | <?php |
| [1253](#L1253) | } |
| [1254](#L1254) |  |
| [1255](#L1255) | /\*\* |
| [1256](#L1256) | \* Renders form section for excluding metadata of certain object type. |
| [1257](#L1257) | \* |
| [1258](#L1258) | \* @param string $title  Section title. |
| [1259](#L1259) | \* @param array  $values Values. |
| [1260](#L1260) | \* @param string $type   Object type. |
| [1261](#L1261) | \*/ |
| [1262](#L1262) | private function renderMetaExclusionSection( $title, $values, $type ) { |
| [1263](#L1263) | ?> |
| [1264](#L1264) | <tr> |
| [1265](#L1265) | <th><label for="Custom<?php echo \esc\_attr( $type ); ?>QueryBox"><?php echo $title; ?></label></th> |
| [1266](#L1266) | <td> |
| [1267](#L1267) | <fieldset data-type="<?php echo \esc\_attr( $type ); ?>"> |
| [1268](#L1268) | <input type="text" id="<?php echo \esc\_attr( $type ); ?>QueryBox" class="js-query-box" style="width: 250px;"> |
| [1269](#L1269) | <input type="button" id="<?php echo \esc\_attr( $type ); ?>QueryAdd" class="js-query-add button-primary" |
| [1270](#L1270) | value="<?php esc\_attr\_e( 'Add', 'wp-security-audit-log' ); ?>"> |
| [1271](#L1271) | <br style="clear: both;"/> |
| [1272](#L1272) | <div id="<?php echo \esc\_attr( $type ); ?>List" class="js-list"> |
| [1273](#L1273) | <?php foreach ( $values as $item ) : ?> |
| [1274](#L1274) | <span class="sectoken-<?php echo esc\_attr( Plugin\_Settings\_Helper::get\_token\_type( $item ) ); ?>"> |
| [1275](#L1275) | <input type="hidden" name="<?php echo \esc\_attr( $type ); ?>s[]" |
| [1276](#L1276) | value="<?php echo esc\_attr( $item ); ?>"/> |
| [1277](#L1277) | <?php echo esc\_html( $item ); ?> |
| [1278](#L1278) | <a href="javascript:;" title="<?php esc\_attr\_e( 'Remove', 'wp-security-audit-log' ); ?>">&times;</a> |
| [1279](#L1279) | </span> |
| [1280](#L1280) | <?php endforeach; ?> |
| [1281](#L1281) | </div> |
| [1282](#L1282) | </fieldset> |
| [1283](#L1283) | <p class="description"><?php esc\_html\_e( 'You can use the \* wildcard to exclude multiple matching custom fields. For example to exclude all custom fields starting with wp123 enter wp123\*', 'wp-security-audit-log' ); ?></p> |
| [1284](#L1284) | </td> |
| [1285](#L1285) | </tr> |
| [1286](#L1286) | <?php |
| [1287](#L1287) | } |
| [1288](#L1288) |  |
| [1289](#L1289) | /\*\* |
| [1290](#L1290) | \* Save: `Exclude Objects` |
| [1291](#L1291) | \*/ |
| [1292](#L1292) | private function tab\_exclude\_objects\_save() { |
| [1293](#L1293) | // Get $\_POST global array. |
| [1294](#L1294) | $post\_array = filter\_input\_array( INPUT\_POST ); |
| [1295](#L1295) |  |
| [1296](#L1296) | Settings\_Helper::set\_excluded\_monitoring\_users( isset( $post\_array['ExUsers'] ) ? $post\_array['ExUsers'] : array() ); |
| [1297](#L1297) | Settings\_Helper::set\_excluded\_monitoring\_roles( isset( $post\_array['ExRoles'] ) ? $post\_array['ExRoles'] : array() ); |
| [1298](#L1298) | Settings\_Helper::set\_excluded\_post\_meta\_fields( isset( $post\_array['PostMetas'] ) ? $post\_array['PostMetas'] : array() ); |
| [1299](#L1299) | Settings\_Helper::set\_excluded\_user\_meta\_fields( isset( $post\_array['UserMetas'] ) ? $post\_array['UserMetas'] : array() ); |
| [1300](#L1300) | Plugin\_Settings\_Helper::set\_excluded\_monitoring\_ip( isset( $post\_array['IpAddrs'] ) ? $post\_array['IpAddrs'] : array() ); |
| [1301](#L1301) | Plugin\_Settings\_Helper::set\_excluded\_post\_types( isset( $post\_array['ExCPTss'] ) ? $post\_array['ExCPTss'] : array() ); |
| [1302](#L1302) | Plugin\_Settings\_Helper::set\_excluded\_post\_statuses( isset( $post\_array['Statuss'] ) ? $post\_array['Statuss'] : array() ); |
| [1303](#L1303) | } |
| [1304](#L1304) |  |
| [1305](#L1305) | /\*\* |
| [1306](#L1306) | \* Tab: `Advanced Settings` |
| [1307](#L1307) | \*/ |
| [1308](#L1308) | private function tab\_advanced\_settings() { |
| [1309](#L1309) | ?> |
| [1310](#L1310) | <p class="description"> |
| [1311](#L1311) | <?php esc\_html\_e( 'These settings are for advanced users.', 'wp-security-audit-log' ); ?> |
| [1312](#L1312) | <?php echo sprintf( \_\_( 'If you have any questions <a href="https://melapress.com/contact/?utm\_source=plugin&utm\_medium=referral&utm\_source=plugin&utm\_medium=link&utm\_campaign=wsal" target="\_blank">contact us</a>.', 'wp-security-audit-log' ), Plugin\_Settings\_Helper::get\_allowed\_html\_tags() ); // phpcs:ignore ?> |
| [1313](#L1313) | </p> |
| [1314](#L1314) |  |
| [1315](#L1315) | <h3><?php esc\_html\_e( 'Reset plugin settings to default', 'wp-security-audit-log' ); ?></h3> |
| [1316](#L1316) | <p class="description"><?php \_e( 'Use this button to <em>factory reset</em> the plugin. This means that all the configured settings will be reset to default and all email notifications, scheduled reports, external database / third party services connections, archiving and mirroring rule will be deleted. NOTE: the activity log data will not be purged. Use the setting below to purge the activity log.', 'wp-security-audit-log' ); // phpcs:ignore ?></p> |
| [1317](#L1317) | <table class="form-table wsal-tab"> |
| [1318](#L1318) | <tbody> |
| [1319](#L1319) | <tr> |
| [1320](#L1320) | <th><?php esc\_html\_e( 'Reset Settings', 'wp-security-audit-log' ); ?></th> |
| [1321](#L1321) | <td> |
| [1322](#L1322) | <a href="#wsal\_reset\_settings" class="button-primary js-settings-reset"><?php esc\_html\_e( 'RESET', 'wp-security-audit-log' ); ?></a> |
| [1323](#L1323) | </td> |
| [1324](#L1324) | </tr> |
| [1325](#L1325) | </tbody> |
| [1326](#L1326) | </table> |
| [1327](#L1327) |  |
| [1328](#L1328) | <h3><?php esc\_html\_e( 'Purge the WordPress activity log', 'wp-security-audit-log' ); ?></h3> |
| [1329](#L1329) | <p class="description"><?php esc\_html\_e( 'Click the Purge button below to delete all the data from the WordPress activity log and start afresh.', 'wp-security-audit-log' ); ?></p> |
| [1330](#L1330) | <table class="form-table wsal-tab"> |
| [1331](#L1331) | <tbody> |
| [1332](#L1332) | <tr> |
| [1333](#L1333) | <th><?php esc\_html\_e( 'Purge Activity Log', 'wp-security-audit-log' ); ?></th> |
| [1334](#L1334) | <td> |
| [1335](#L1335) | <a href="#wsal\_purge\_activity" class="button-primary js-purge-reset"><?php esc\_html\_e( 'PURGE', 'wp-security-audit-log' ); ?></a> |
| [1336](#L1336) | <!-- <span class="notice purge-notice notice-success" style="display: none; margin-left: 10px; padding: 6px 10px;"><?php esc\_html\_e( 'Activity log successfully purged', 'wp-security-audit-log' ); ?></span> --> |
| [1337](#L1337) | </td> |
| [1338](#L1338) | </tr> |
| [1339](#L1339) | </tbody> |
| [1340](#L1340) | </table> |
| [1341](#L1341) |  |
| [1342](#L1342) | <?php $stealth\_mode = Settings\_Helper::get\_boolean\_option\_value( 'mwp-child-stealth-mode', false ); ?> |
| [1343](#L1343) | <h3><?php esc\_html\_e( 'MainWP Child Site Stealth Mode', 'wp-security-audit-log' ); ?></h3> |
| [1344](#L1344) | <p class="description"><?php esc\_html\_e( 'This option is enabled automatically when the plugin detects the MainWP Child plugin on the site. When this setting is enabled plugin access is restricted to the administrator who installs the plugin, the plugin is not shown in the list of installed plugins and no admin notifications are shown. Disable this option to change the plugin to the default setup.', 'wp-security-audit-log' ); ?></p> |
| [1345](#L1345) | <table class="form-table wsal-tab"> |
| [1346](#L1346) | <tbody> |
| [1347](#L1347) | <tr> |
| [1348](#L1348) | <th><label for="mwp\_stealth\_mode"><?php esc\_html\_e( 'Enable MainWP Child Site Stealth Mode', 'wp-security-audit-log' ); ?></label></th> |
| [1349](#L1349) | <td> |
| [1350](#L1350) | <fieldset <?php echo ! WpSecurityAuditLog::is\_mainwp\_active() ? 'disabled' : false; ?>> |
| [1351](#L1351) | <label for="mwp\_stealth\_yes"> |
| [1352](#L1352) | <input type="radio" name="mwp\_stealth\_mode" value="yes" id="mwp\_stealth\_yes" <?php checked( $stealth\_mode ); ?> /> |
| [1353](#L1353) | <?php esc\_html\_e( 'Yes', 'wp-security-audit-log' ); ?> |
| [1354](#L1354) | </label> |
| [1355](#L1355) | <br> |
| [1356](#L1356) | <label for="mwp\_stealth\_no"> |
| [1357](#L1357) | <input type="radio" name="mwp\_stealth\_mode" value="no" id="mwp\_stealth\_no" |
| [1358](#L1358) | <?php checked( $stealth\_mode, false ); ?> |
| [1359](#L1359) | /> |
| [1360](#L1360) | <?php esc\_html\_e( 'No', 'wp-security-audit-log' ); ?> |
| [1361](#L1361) | </label> |
| [1362](#L1362) | </fieldset> |
| [1363](#L1363) | </td> |
| [1364](#L1364) | </tr> |
| [1365](#L1365) | </tbody> |
| [1366](#L1366) | </table> |
| [1367](#L1367) |  |
| [1368](#L1368) | <?php |
| [1369](#L1369) | $data\_deletion\_enabled = Settings\_Helper::get\_boolean\_option\_value( 'delete-data' ); |
| [1370](#L1370) | ?> |
| [1371](#L1371) | <h3><?php esc\_html\_e( 'Do you want to delete the plugin data from the database upon uninstall?', 'wp-security-audit-log' ); ?></h3> |
| [1372](#L1372) | <p class="description"><?php esc\_html\_e( 'The plugin saves the activity log data and settings in the WordPress database. By default upon uninstalling the plugin the data is kept in the database so if it is installed again, you can still access the data. If the data is deleted it is not possible to recover it so you won\'t be able to access it again even when you reinstall the plugin.', 'wp-security-audit-log' ); ?></p> |
| [1373](#L1373) | <table class="form-table wsal-tab"> |
| [1374](#L1374) | <tbody> |
| [1375](#L1375) | <tr> |
| [1376](#L1376) | <th><label for="DeleteData"><?php esc\_html\_e( 'Remove Data on Uninstall', 'wp-security-audit-log' ); ?></label></th> |
| [1377](#L1377) | <td> |
| [1378](#L1378) | <fieldset> |
| [1379](#L1379) | <label for="delete\_data\_yes"> |
| [1380](#L1380) | <input type="radio" name="DeleteData" value="1" id="delete\_data\_yes" onclick="return delete\_confirm(this);" |
| [1381](#L1381) | <?php checked( $data\_deletion\_enabled ); ?> |
| [1382](#L1382) | /> |
| [1383](#L1383) | <?php esc\_html\_e( 'Yes', 'wp-security-audit-log' ); ?> |
| [1384](#L1384) | </label> |
| [1385](#L1385) | <br> |
| [1386](#L1386) | <label for="delete\_data\_no"> |
| [1387](#L1387) | <input type="radio" name="DeleteData" value="0" id="delete\_data\_no" |
| [1388](#L1388) | <?php checked( $data\_deletion\_enabled, false ); ?> |
| [1389](#L1389) | /> |
| [1390](#L1390) | <?php esc\_html\_e( 'No', 'wp-security-audit-log' ); ?> |
| [1391](#L1391) | </label> |
| [1392](#L1392) | </fieldset> |
| [1393](#L1393) | </td> |
| [1394](#L1394) | </tr> |
| [1395](#L1395) | <!-- / Remove Data on Uninstall --> |
| [1396](#L1396) | </tbody> |
| [1397](#L1397) | </table> |
| [1398](#L1398) |  |
| [1399](#L1399) | <div class="remodal" data-remodal-id="wsal\_reset\_settings"> |
| [1400](#L1400) | <button data-remodal-action="close" class="remodal-close"></button> |
| [1401](#L1401) | <h3><?php esc\_html\_e( 'Are you sure you want to reset all the plugin settings to default? This action cannot be undone.', 'wp-security-audit-log' ); ?></h3> |
| [1402](#L1402) | <br> |
| [1403](#L1403) | <input type="hidden" id="wsal-reset-settings-nonce" value="<?php echo esc\_attr( wp\_create\_nonce( 'wsal-reset-settings' ) ); ?>"> |
| [1404](#L1404) | <button data-remodal-action="confirm" class="remodal-confirm"><?php esc\_html\_e( 'Yes' ); ?></button> |
| [1405](#L1405) | <button data-remodal-action="cancel" class="remodal-cancel"><?php esc\_html\_e( 'No' ); ?></button> |
| [1406](#L1406) | </div> |
| [1407](#L1407) | <!-- Reset Settings Modal --> |
| [1408](#L1408) |  |
| [1409](#L1409) | <div class="remodal" data-remodal-id="wsal\_purge\_activity"> |
| [1410](#L1410) | <button data-remodal-action="close" class="remodal-close"></button> |
| [1411](#L1411) | <h3><?php esc\_html\_e( 'Are you sure you want to purge all the activity log data?', 'wp-security-audit-log' ); ?></h3> |
| [1412](#L1412) | <br> |
| [1413](#L1413) | <input type="hidden" id="wsal-purge-activity-nonce" value="<?php echo esc\_attr( wp\_create\_nonce( 'wsal-purge-activity' ) ); ?>"> |
| [1414](#L1414) | <button data-remodal-action="confirm" class="remodal-confirm"><?php esc\_html\_e( 'Yes', 'wp-security-audit-log' ); ?></button> |
| [1415](#L1415) | <button data-remodal-action="cancel" class="remodal-cancel"><?php esc\_html\_e( 'No', 'wp-security-audit-log' ); ?></button> |
| [1416](#L1416) | </div> |
| [1417](#L1417) | <!-- Purge Activity Log Modal --> |
| [1418](#L1418) | <?php |
| [1419](#L1419) | } |
| [1420](#L1420) |  |
| [1421](#L1421) | /\*\* |
| [1422](#L1422) | \* Save: `Advanced Settings` |
| [1423](#L1423) | \* |
| [1424](#L1424) | \* @throws Exception - MainWP Child plugin not active exception. |
| [1425](#L1425) | \*/ |
| [1426](#L1426) | private function tab\_advanced\_settings\_save() { |
| [1427](#L1427) | // Get $\_POST global array. |
| [1428](#L1428) | $post\_array = filter\_input\_array( INPUT\_POST ); |
| [1429](#L1429) |  |
| [1430](#L1430) | Plugin\_Settings\_Helper::set\_delete\_data( isset( $post\_array['DeleteData'] ) ? \sanitize\_text\_field( $post\_array['DeleteData'] ) : false ); |
| [1431](#L1431) |  |
| [1432](#L1432) | $stealth\_mode = isset( $post\_array['mwp\_stealth\_mode'] ) ? $post\_array['mwp\_stealth\_mode'] : false; |
| [1433](#L1433) | if ( 'yes' === $stealth\_mode ) { |
| [1434](#L1434) | if ( ! WpSecurityAuditLog::is\_mainwp\_active() ) { |
| [1435](#L1435) | throw new Exception( \_\_( 'MainWP Child plugin is not active on this website.', 'wp-security-audit-log' ) ); |
| [1436](#L1436) | } |
| [1437](#L1437) | Plugin\_Settings\_Helper::set\_mainwp\_child\_stealth\_mode(); |
| [1438](#L1438) |  |
| [1439](#L1439) | } else { |
| [1440](#L1440) | Plugin\_Settings\_Helper::deactivate\_mainwp\_child\_stealth\_mode(); |
| [1441](#L1441) | } |
| [1442](#L1442) | } |
| [1443](#L1443) |  |
| [1444](#L1444) | /\*\* |
| [1445](#L1445) | \* {@inheritDoc} |
| [1446](#L1446) | \*/ |
| [1447](#L1447) | public function header() { |
| [1448](#L1448) | wp\_enqueue\_style( |
| [1449](#L1449) | 'settings', |
| [1450](#L1450) | WSAL\_BASE\_URL . '/css/settings.css', |
| [1451](#L1451) | array(), |
| [1452](#L1452) | WSAL\_VERSION |
| [1453](#L1453) | ); |
| [1454](#L1454) |  |
| [1455](#L1455) | // Check current tab. |
| [1456](#L1456) | if ( ! empty( $this->current\_tab ) && 'advanced-settings' === $this->current\_tab ) { |
| [1457](#L1457) | // Remodal styles. |
| [1458](#L1458) | wp\_enqueue\_style( 'wsal-remodal', WSAL\_BASE\_URL . 'css/remodal.css', array(), WSAL\_VERSION ); |
| [1459](#L1459) | wp\_enqueue\_style( 'wsal-remodal-theme', WSAL\_BASE\_URL . 'css/remodal-default-theme.css', array(), WSAL\_VERSION ); |
| [1460](#L1460) | } |
| [1461](#L1461) | ?> |
| [1462](#L1462) | <style type="text/css"> |
| [1463](#L1463) | .wsal-tab { |
| [1464](#L1464) | /\* display: none; \*/ |
| [1465](#L1465) | } |
| [1466](#L1466) | .wsal-tab tr.alert-incomplete td { |
| [1467](#L1467) | color: #9BE; |
| [1468](#L1468) | } |
| [1469](#L1469) | .wsal-tab tr.alert-unavailable td { |
| [1470](#L1470) | color: #CCC; |
| [1471](#L1471) | } |
| [1472](#L1472) | </style> |
| [1473](#L1473) | <?php |
| [1474](#L1474) | } |
| [1475](#L1475) |  |
| [1476](#L1476) | /\*\* |
| [1477](#L1477) | \* {@inheritDoc} |
| [1478](#L1478) | \*/ |
| [1479](#L1479) | public function footer() { |
| [1480](#L1480) | wp\_enqueue\_script( 'jquery-ui-autocomplete' ); |
| [1481](#L1481) |  |
| [1482](#L1482) | // Check current tab. |
| [1483](#L1483) | if ( ! empty( $this->current\_tab ) && 'advanced-settings' === $this->current\_tab ) { |
| [1484](#L1484) | // Remodal script. |
| [1485](#L1485) | wp\_enqueue\_script( |
| [1486](#L1486) | 'wsal-remodal-js', |
| [1487](#L1487) | WSAL\_BASE\_URL . 'js/remodal.min.js', |
| [1488](#L1488) | array(), |
| [1489](#L1489) | WSAL\_VERSION, |
| [1490](#L1490) | true |
| [1491](#L1491) | ); |
| [1492](#L1492) | } |
| [1493](#L1493) |  |
| [1494](#L1494) | // Register settings script. |
| [1495](#L1495) | wp\_register\_script( |
| [1496](#L1496) | 'settings', |
| [1497](#L1497) | WSAL\_BASE\_URL . '/js/settings.js', |
| [1498](#L1498) | array(), |
| [1499](#L1499) | WSAL\_VERSION, |
| [1500](#L1500) | true |
| [1501](#L1501) | ); |
| [1502](#L1502) | // Passing nonce for security to JS file. |
| [1503](#L1503) | $wsal\_data = array( |
| [1504](#L1504) | 'wp\_nonce'            => wp\_create\_nonce( 'wsal-exclude-nonce' ), |
| [1505](#L1505) | 'invalidURL'          => esc\_html\_\_( 'The specified value is not a valid URL!', 'wp-security-audit-log' ), |
| [1506](#L1506) | 'invalidCPT'          => esc\_html\_\_( 'The specified value is not a valid post type!', 'wp-security-audit-log' ), |
| [1507](#L1507) | 'invalidStatus'       => esc\_html\_\_( 'The specified value is not a valid post status!', 'wp-security-audit-log' ), |
| [1508](#L1508) | 'invalidIP'           => esc\_html\_\_( 'The specified value is not a valid IP address!', 'wp-security-audit-log' ), |
| [1509](#L1509) | 'invalidUser'         => esc\_html\_\_( 'The specified value is not a user nor a role!', 'wp-security-audit-log' ), |
| [1510](#L1510) | 'invalidFile'         => esc\_html\_\_( 'Filename cannot be added because it contains invalid characters.', 'wp-security-audit-log' ), |
| [1511](#L1511) | 'invalidFileExt'      => esc\_html\_\_( 'File extension cannot be added because it contains invalid characters.', 'wp-security-audit-log' ), |
| [1512](#L1512) | 'invalidDir'          => esc\_html\_\_( 'Directory cannot be added because it contains invalid characters.', 'wp-security-audit-log' ), |
| [1513](#L1513) | 'remove'              => esc\_html\_\_( 'Remove', 'wp-security-audit-log' ), |
| [1514](#L1514) | 'saveSettingsChanges' => esc\_html\_\_( 'Please save any changes before switching tabs.', 'wp-security-audit-log' ), |
| [1515](#L1515) | ); |
| [1516](#L1516) | wp\_localize\_script( 'settings', 'wsal\_data', $wsal\_data ); |
| [1517](#L1517) | wp\_enqueue\_script( 'settings' ); |
| [1518](#L1518) | ?> |
| [1519](#L1519) | <script type="text/javascript"> |
| [1520](#L1520) | jQuery( document ).ready( function() { |
| [1521](#L1521) | jQuery( '.sel-columns' ).change( function() { |
| [1522](#L1522) | var notChecked = 1; |
| [1523](#L1523) | jQuery( '.sel-columns' ).each( function() { |
| [1524](#L1524) | if ( this.checked ) notChecked = 0; |
| [1525](#L1525) | }) |
| [1526](#L1526) | if ( notChecked == 1 ) { |
| [1527](#L1527) | alert( "<?php esc\_html\_e( 'You have to select at least one column!', 'wp-security-audit-log' ); ?>" ); |
| [1528](#L1528) | } |
| [1529](#L1529) | }); |
| [1530](#L1530) | // jQuery( 'body' ).on( 'click', '.remodal-confirm', function ( e ) { |
| [1531](#L1531) | //      jQuery( '.purge-notice' ).fadeIn(500); |
| [1532](#L1532) | //      setTimeout(function() { |
| [1533](#L1533) | //              jQuery( '.purge-notice' ).fadeOut(500); |
| [1534](#L1534) | //      }, 4000); |
| [1535](#L1535) | // }); |
| [1536](#L1536) | });</script> |
| [1537](#L1537) | <?php |
| [1538](#L1538) | } |
| [1539](#L1539) |  |
| [1540](#L1540) | /\*\* |
| [1541](#L1541) | \* Method: Ajax Request handler for AjaxGetAllUsers. |
| [1542](#L1542) | \*/ |
| [1543](#L1543) | public function ajax\_get\_all\_users() { |
| [1544](#L1544) | // Filter $\_GET array for security. |
| [1545](#L1545) | $get\_array = filter\_input\_array( INPUT\_GET ); |
| [1546](#L1546) | $this->check\_ajax\_request\_is\_valid( $get\_array ); |
| [1547](#L1547) |  |
| [1548](#L1548) | // Fetch users. |
| [1549](#L1549) | $users = array(); |
| [1550](#L1550) | foreach ( get\_users() as $user ) { |
| [1551](#L1551) | if ( strpos( $user->user\_login, $get\_array['term'] ) !== false ) { |
| [1552](#L1552) | array\_push( $users, $user->user\_login ); |
| [1553](#L1553) | } |
| [1554](#L1554) | } |
| [1555](#L1555) | echo wp\_json\_encode( $users ); |
| [1556](#L1556) | exit; |
| [1557](#L1557) | } |
| [1558](#L1558) |  |
| [1559](#L1559) | /\*\* |
| [1560](#L1560) | \* Method: Ajax Request handler for AjaxGetAllRoles. |
| [1561](#L1561) | \*/ |
| [1562](#L1562) | public function ajax\_get\_all\_roles() { |
| [1563](#L1563) | // Filter $\_GET array for security. |
| [1564](#L1564) | $get\_array = filter\_input\_array( INPUT\_GET ); |
| [1565](#L1565) | $this->check\_ajax\_request\_is\_valid( $get\_array ); |
| [1566](#L1566) |  |
| [1567](#L1567) | // Get roles. |
| [1568](#L1568) | $roles = array(); |
| [1569](#L1569) | foreach ( get\_editable\_roles() as $role\_name => $role\_info ) { |
| [1570](#L1570) | if ( strpos( $role\_name, $get\_array['term'] ) !== false ) { |
| [1571](#L1571) | array\_push( $roles, $role\_name ); |
| [1572](#L1572) | } |
| [1573](#L1573) | } |
| [1574](#L1574) | echo wp\_json\_encode( $roles ); |
| [1575](#L1575) | exit; |
| [1576](#L1576) | } |
| [1577](#L1577) |  |
| [1578](#L1578) | /\*\* |
| [1579](#L1579) | \* Create json array of all possible severities. |
| [1580](#L1580) | \* |
| [1581](#L1581) | \* @return void |
| [1582](#L1582) | \* @since  4.3.3 |
| [1583](#L1583) | \*/ |
| [1584](#L1584) | public function ajax\_get\_all\_severities() { |
| [1585](#L1585) | // Filter $\_GET array for security. |
| [1586](#L1586) | $get\_array = filter\_input\_array( INPUT\_GET ); |
| [1587](#L1587) | $this->check\_ajax\_request\_is\_valid( $get\_array ); |
| [1588](#L1588) |  |
| [1589](#L1589) | $result = array\_map( |
| [1590](#L1590) | function ( $item ) { |
| [1591](#L1591) | return ucfirst( strtolower( str\_replace( 'WSAL\_', '', $item ) ) ); |
| [1592](#L1592) | }, |
| [1593](#L1593) | array\_keys( Constants::get\_severities() ) |
| [1594](#L1594) | ); |
| [1595](#L1595) |  |
| [1596](#L1596) | echo $this->filter\_values\_for\_searched\_term( // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
| [1597](#L1597) | $result, |
| [1598](#L1598) | \sanitize\_text\_field( \wp\_unslash( $get\_array['term'] ) ) |
| [1599](#L1599) | ); |
| [1600](#L1600) | exit; |
| [1601](#L1601) | } |
| [1602](#L1602) |  |
| [1603](#L1603) | /\*\* |
| [1604](#L1604) | \* Filters values to return ones matching the desired term. |
| [1605](#L1605) | \* |
| [1606](#L1606) | \* @param array  $items\_to\_filter List of items to filter. |
| [1607](#L1607) | \* @param string $term            Search term. |
| [1608](#L1608) | \* |
| [1609](#L1609) | \* @return string JSON encoded filtered list. |
| [1610](#L1610) | \*/ |
| [1611](#L1611) | public function filter\_values\_for\_searched\_term( $items\_to\_filter, $term ) { |
| [1612](#L1612) |  |
| [1613](#L1613) | $result = array\_filter( |
| [1614](#L1614) | $items\_to\_filter, |
| [1615](#L1615) | function( $value ) use ( $term ) { |
| [1616](#L1616) | return strpos( strtolower( $value ), strtolower( $term ) ) !== false; |
| [1617](#L1617) | } |
| [1618](#L1618) | ); |
| [1619](#L1619) |  |
| [1620](#L1620) | $result = array\_map( 'strval', $result ); |
| [1621](#L1621) |  |
| [1622](#L1622) | return wp\_json\_encode( $result ); |
| [1623](#L1623) | } |
| [1624](#L1624) |  |
| [1625](#L1625) | /\*\* |
| [1626](#L1626) | \* Create json array of all possible event types. |
| [1627](#L1627) | \* |
| [1628](#L1628) | \* @return void |
| [1629](#L1629) | \* @since  4.3.3 |
| [1630](#L1630) | \*/ |
| [1631](#L1631) | public function ajax\_get\_all\_event\_types() { |
| [1632](#L1632) | // Filter $\_GET array for security. |
| [1633](#L1633) | $get\_array = filter\_input\_array( INPUT\_GET ); |
| [1634](#L1634) | $this->check\_ajax\_request\_is\_valid( $get\_array ); |
| [1635](#L1635) |  |
| [1636](#L1636) | $event\_types = Alert\_Manager::get\_event\_type\_data(); |
| [1637](#L1637) |  |
| [1638](#L1638) | echo $this->filter\_values\_for\_searched\_term( array\_values( $event\_types ), $get\_array['term'] ); |
| [1639](#L1639) | exit; |
| [1640](#L1640) | } |
| [1641](#L1641) |  |
| [1642](#L1642) | /\*\* |
| [1643](#L1643) | \* Create json array of all possible object types. |
| [1644](#L1644) | \* |
| [1645](#L1645) | \* @return void |
| [1646](#L1646) | \* @since  4.3.3 |
| [1647](#L1647) | \*/ |
| [1648](#L1648) | public function ajax\_get\_all\_object\_types() { |
| [1649](#L1649) | // Filter $\_GET array for security. |
| [1650](#L1650) | $get\_array = filter\_input\_array( INPUT\_GET ); |
| [1651](#L1651) | $this->check\_ajax\_request\_is\_valid( $get\_array ); |
| [1652](#L1652) |  |
| [1653](#L1653) | $event\_objects = Alert\_Manager::get\_event\_objects\_data(); |
| [1654](#L1654) |  |
| [1655](#L1655) | echo $this->filter\_values\_for\_searched\_term( array\_values( $event\_objects ), $get\_array['term'] ); // phpcs:ignore |
| [1656](#L1656) | exit; |
| [1657](#L1657) | } |
| [1658](#L1658) |  |
| [1659](#L1659) | /\*\* |
| [1660](#L1660) | \* Create json array of all possible event IDs. |
| [1661](#L1661) | \* |
| [1662](#L1662) | \* @return void |
| [1663](#L1663) | \* @since  4.3.3 |
| [1664](#L1664) | \*/ |
| [1665](#L1665) | public function ajax\_get\_all\_event\_ids() { |
| [1666](#L1666) |  |
| [1667](#L1667) | $get\_array = filter\_input\_array( INPUT\_GET ); |
| [1668](#L1668) | $this->check\_ajax\_request\_is\_valid( $get\_array ); |
| [1669](#L1669) |  |
| [1670](#L1670) | $registered\_alerts = Alert\_Manager::get\_alerts(); |
| [1671](#L1671) |  |
| [1672](#L1672) | // $alerts = array(); |
| [1673](#L1673) | // foreach ( $registered\_alerts as $alert => $details ) { |
| [1674](#L1674) | // $alerts[] = (string) $details->code; |
| [1675](#L1675) | // } |
| [1676](#L1676) |  |
| [1677](#L1677) | echo $this->filter\_values\_for\_searched\_term( array\_keys( $registered\_alerts ), \sanitize\_text\_field( \wp\_unslash( $get\_array['term'] ) ) ); |
| [1678](#L1678) | exit; |
| [1679](#L1679) | } |
| [1680](#L1680) |  |
| [1681](#L1681) | /\*\* |
| [1682](#L1682) | \* Method: Get CPTs ajax handle. |
| [1683](#L1683) | \* |
| [1684](#L1684) | \* @since 2.6.7 |
| [1685](#L1685) | \*/ |
| [1686](#L1686) | public function ajax\_get\_all\_cpts() { |
| [1687](#L1687) | // Filter $\_GET array for security. |
| [1688](#L1688) | $get\_array = filter\_input\_array( INPUT\_GET ); |
| [1689](#L1689) | $this->check\_ajax\_request\_is\_valid( $get\_array ); |
| [1690](#L1690) |  |
| [1691](#L1691) | // Get custom post types. |
| [1692](#L1692) | $custom\_post\_types = array(); |
| [1693](#L1693) | $post\_types        = get\_post\_types( |
| [1694](#L1694) | array( |
| [1695](#L1695) | 'public' => false, |
| [1696](#L1696) | ), |
| [1697](#L1697) | 'names' |
| [1698](#L1698) | ); |
| [1699](#L1699) | // if we are running multisite and have networkwide cpt tracker get the |
| [1700](#L1700) | // list from and merge to the post\_types array. |
| [1701](#L1701) | if ( WP\_Helper::is\_multisite() && class\_exists( '\WSAL\Multisite\NetworkWide\CPTsTracker' ) ) { |
| [1702](#L1702) | $network\_cpts = \WSAL\Multisite\NetworkWide\CPTsTracker::get\_network\_data\_list(); |
| [1703](#L1703) | foreach ( $network\_cpts as $cpt ) { |
| [1704](#L1704) | $post\_types[ $cpt ] = $cpt; |
| [1705](#L1705) | } |
| [1706](#L1706) | } |
| [1707](#L1707) |  |
| [1708](#L1708) | $post\_types = array\_diff( $post\_types, array( 'attachment', 'revision', 'nav\_menu\_item', 'customize\_changeset', 'custom\_css' ) ); |
| [1709](#L1709) | foreach ( $post\_types as $post\_type ) { |
| [1710](#L1710) | if ( strpos( $post\_type, $get\_array['term'] ) !== false ) { |
| [1711](#L1711) | array\_push( $custom\_post\_types, $post\_type ); |
| [1712](#L1712) | } |
| [1713](#L1713) | } |
| [1714](#L1714) | echo wp\_json\_encode( $custom\_post\_types ); |
| [1715](#L1715) | exit; |
| [1716](#L1716) | } |
| [1717](#L1717) |  |
| [1718](#L1718) | /\*\* |
| [1719](#L1719) | \* Method: Get statuses ajax handle. |
| [1720](#L1720) | \* |
| [1721](#L1721) | \* @since 5.0.0 |
| [1722](#L1722) | \*/ |
| [1723](#L1723) | public function ajax\_get\_all\_stati() { |
| [1724](#L1724) | // Filter $\_GET array for security. |
| [1725](#L1725) | $get\_array = filter\_input\_array( INPUT\_GET ); |
| [1726](#L1726) | $this->check\_ajax\_request\_is\_valid( $get\_array ); |
| [1727](#L1727) | $post\_stati = get\_post\_stati(); |
| [1728](#L1728) |  |
| [1729](#L1729) | echo wp\_json\_encode( $post\_stati ); |
| [1730](#L1730) | exit; |
| [1731](#L1731) | } |
| [1732](#L1732) |  |
| [1733](#L1733) | /\*\* |
| [1734](#L1734) | \* Checks if provided GET array is valid and bails if not. |
| [1735](#L1735) | \* |
| [1736](#L1736) | \* @param array $get\_array Get data. |
| [1737](#L1737) | \*/ |
| [1738](#L1738) | public function check\_ajax\_request\_is\_valid( $get\_array ) { |
| [1739](#L1739) | // Die if user does not have permission to edit. |
| [1740](#L1740) | if ( ! Settings\_Helper::current\_user\_can( 'edit' ) ) { |
| [1741](#L1741) | die( 'Access Denied.' ); |
| [1742](#L1742) | } |
| [1743](#L1743) |  |
| [1744](#L1744) | // Die if nonce verification failed. |
| [1745](#L1745) | if ( ! wp\_verify\_nonce( $get\_array['wsal\_nonce'], 'wsal-exclude-nonce' ) ) { |
| [1746](#L1746) | die( esc\_html\_\_( 'Nonce verification failed.', 'wp-security-audit-log' ) ); |
| [1747](#L1747) | } |
| [1748](#L1748) | } |
| [1749](#L1749) |  |
| [1750](#L1750) | /\*\* |
| [1751](#L1751) | \* Method: Reset plugin settings table. |
| [1752](#L1752) | \*/ |
| [1753](#L1753) | public function reset\_settings() { |
| [1754](#L1754) | // Die if user does not have permission to change settings. |
| [1755](#L1755) | if ( ! Settings\_Helper::current\_user\_can( 'edit' ) ) { |
| [1756](#L1756) | wp\_send\_json\_error( esc\_html\_\_( 'Access Denied.', 'wp-security-audit-log' ) ); |
| [1757](#L1757) | } |
| [1758](#L1758) |  |
| [1759](#L1759) | // Verify nonce. |
| [1760](#L1760) | if ( empty( $\_POST['nonce'] ) || ! wp\_verify\_nonce( \sanitize\_text\_field( \wp\_unslash( $\_POST['nonce'] ) ), 'wsal-reset-settings' ) ) { |
| [1761](#L1761) | wp\_send\_json\_error( esc\_html\_\_( 'Nonce Verification Failed.', 'wp-security-audit-log' ) ); |
| [1762](#L1762) | } |
| [1763](#L1763) |  |
| [1764](#L1764) | // Delete all settings. |
| [1765](#L1765) | Settings\_Helper::delete\_all\_settings(); |
| [1766](#L1766) |  |
| [1767](#L1767) | // Log settings reset event. |
| [1768](#L1768) | Alert\_Manager::trigger\_event( 6006 ); |
| [1769](#L1769) | wp\_send\_json\_success( esc\_html\_\_( 'Plugin settings have been reset.', 'wp-security-audit-log' ) ); |
| [1770](#L1770) | } |
| [1771](#L1771) |  |
| [1772](#L1772) | /\*\* |
| [1773](#L1773) | \* Method: Purge plugin occurrence & meta tables. |
| [1774](#L1774) | \*/ |
| [1775](#L1775) | public function purge\_activity() { |
| [1776](#L1776) | // Die if user does not have permission to change settings. |
| [1777](#L1777) | if ( ! Settings\_Helper::current\_user\_can( 'edit' ) ) { |
| [1778](#L1778) | wp\_send\_json\_error( esc\_html\_\_( 'Access Denied.', 'wp-security-audit-log' ) ); |
| [1779](#L1779) | } |
| [1780](#L1780) |  |
| [1781](#L1781) | // Verify nonce. |
| [1782](#L1782) | if ( empty( $\_POST['nonce'] ) || ! wp\_verify\_nonce( \sanitize\_text\_field( \wp\_unslash( $\_POST['nonce'] ) ), 'wsal-purge-activity' ) ) { |
| [1783](#L1783) | wp\_send\_json\_error( esc\_html\_\_( 'Nonce Verification Failed.', 'wp-security-audit-log' ) ); |
| [1784](#L1784) | } |
| [1785](#L1785) |  |
| [1786](#L1786) | $result = Database\_Manager::purge\_activity(); |
| [1787](#L1787) |  |
| [1788](#L1788) | if ( $result ) { |
| [1789](#L1789) | // Log purge activity event. |
| [1790](#L1790) | Alert\_Manager::trigger\_event( 6034 ); |
| [1791](#L1791) | wp\_send\_json\_success( esc\_html\_\_( 'Tables has been reset.', 'wp-security-audit-log' ) ); |
| [1792](#L1792) | } else { |
| [1793](#L1793) | wp\_send\_json\_error( esc\_html\_\_( 'Reset query failed.', 'wp-security-audit-log' ) ); |
| [1794](#L1794) | } |
| [1795](#L1795) | } |
| [1796](#L1796) |  |
| [1797](#L1797) | /\*\* |
| [1798](#L1798) | \* Renders table with retention related settings. |
| [1799](#L1799) | \*/ |
| [1800](#L1800) | public function render\_retention\_settings\_table() { |
| [1801](#L1801) | // Check if the retention settings are enforced from the MainWP master site. |
| [1802](#L1802) | $enforced\_settings                     = Plugin\_Settings\_Helper::get\_mainwp\_enforced\_settings(); |
| [1803](#L1803) | $retention\_settings\_enforced\_by\_mainwp = array\_key\_exists( 'pruning\_enabled', $enforced\_settings ); |
| [1804](#L1804) | ?> |
| [1805](#L1805) | <table class="form-table wsal-tab"> |
| [1806](#L1806) | <tbody> |
| [1807](#L1807) | <tr> |
| [1808](#L1808) | <th><label for="delete1"><?php esc\_html\_e( 'Activity log retention', 'wp-security-audit-log' ); ?></label></th> |
| [1809](#L1809) | <td> |
| [1810](#L1810) | <fieldset> |
| [1811](#L1811) | <?php $nbld = ! Settings\_Helper::get\_boolean\_option\_value( 'pruning-date-e' ); ?> |
| [1812](#L1812) | <label for="delete0"> |
| [1813](#L1813) | <input type="radio" id="delete0" name="PruneBy" value="" <?php checked( $nbld ); ?> |
| [1814](#L1814) | <?php disabled( $retention\_settings\_enforced\_by\_mainwp ); ?> /> |
| [1815](#L1815) | <?php esc\_html\_e( 'Keep all data', 'wp-security-audit-log' ); ?> |
| [1816](#L1816) | </label> |
| [1817](#L1817) | </fieldset> |
| [1818](#L1818) |  |
| [1819](#L1819) | <fieldset> |
| [1820](#L1820) | <?php |
| [1821](#L1821) | // Check pruning date option. |
| [1822](#L1822) | $nbld = Settings\_Helper::get\_boolean\_option\_value( 'pruning-date-e' ); |
| [1823](#L1823) |  |
| [1824](#L1824) | // Find and replace ` months` in the string. |
| [1825](#L1825) | $pruning\_date = Plugin\_Settings\_Helper::get\_pruning\_date(); |
| [1826](#L1826) | $pruning\_date = preg\_replace( '/[^0-9]/', '', $pruning\_date ); |
| [1827](#L1827) |  |
| [1828](#L1828) | $pruning\_unit = Plugin\_Settings\_Helper::get\_pruning\_unit(); |
| [1829](#L1829) |  |
| [1830](#L1830) | $pruning\_unit\_options = array( |
| [1831](#L1831) | 'days'   => esc\_html\_\_( 'Days', 'wp-security-audit-log' ), |
| [1832](#L1832) | 'months' => esc\_html\_\_( 'Months', 'wp-security-audit-log' ), |
| [1833](#L1833) | 'years'  => esc\_html\_\_( 'Years', 'wp-security-audit-log' ), |
| [1834](#L1834) | ); |
| [1835](#L1835) |  |
| [1836](#L1836) | // Check if pruning limit was enabled for backwards compatibility. |
| [1837](#L1837) | if ( Settings\_Helper::get\_boolean\_option\_value( 'pruning-limit-e' ) ) { |
| [1838](#L1838) | $nbld         = true; |
| [1839](#L1839) | $pruning\_date = '6'; |
| [1840](#L1840) | $pruning\_unit = 'months'; |
| [1841](#L1841) | Settings\_Helper::set\_pruning\_date\_settings( true, $pruning\_date . ' ' . $pruning\_unit, $pruning\_unit ); |
| [1842](#L1842) | Plugin\_Settings\_Helper::set\_pruning\_limit\_enabled( false ); |
| [1843](#L1843) | } |
| [1844](#L1844) | ?> |
| [1845](#L1845) | <label for="delete1"> |
| [1846](#L1846) | <input type="radio" id="delete1" name="PruneBy" value="date" <?php checked( $nbld ); ?> |
| [1847](#L1847) | <?php disabled( $retention\_settings\_enforced\_by\_mainwp ); ?> /> |
| [1848](#L1848) | <?php esc\_html\_e( 'Delete events older than', 'wp-security-audit-log' ); ?> |
| [1849](#L1849) | </label> |
| [1850](#L1850) | <input type="number" id="PruningDate" name="PruningDate" |
| [1851](#L1851) | value="<?php echo esc\_attr( $pruning\_date ); ?>" |
| [1852](#L1852) | onfocus="jQuery('#delete1').attr('checked', true);" |
| [1853](#L1853) | <?php disabled( $retention\_settings\_enforced\_by\_mainwp ); ?> |
| [1854](#L1854) | min="1" |
| [1855](#L1855) | /> |
| [1856](#L1856) | <select name="pruning-unit" id="pruning-unit" <?php disabled( $retention\_settings\_enforced\_by\_mainwp ); ?>> |
| [1857](#L1857) | <?php |
| [1858](#L1858) | foreach ( $pruning\_unit\_options as $option => $label ) { |
| [1859](#L1859) | echo '<option value="' . esc\_attr( $option ) . '" ' . selected( $pruning\_unit, $option, true ) . '>' . ucwords( $label ) . '</option>'; // phpcs:ignore |
| [1860](#L1860) | } |
| [1861](#L1861) | ?> |
| [1862](#L1862) | </select> |
| [1863](#L1863) | </fieldset> |
| [1864](#L1864) |  |
| [1865](#L1865) | <?php if ( Settings\_Helper::get\_boolean\_option\_value( 'pruning-date-e' ) ) : ?> |
| [1866](#L1866) | <p class="description"> |
| [1867](#L1867) | <?php |
| [1868](#L1868) | $next = (int) wp\_next\_scheduled( 'wsal\_cleanup\_hook' ); |
| [1869](#L1869) | echo esc\_html\_\_( 'The next scheduled purging of activity log data that is older than ', 'wp-security-audit-log' ); |
| [1870](#L1870) | echo esc\_html( $pruning\_date . ' ' . $pruning\_unit ); |
| [1871](#L1871) | echo sprintf( |
| [1872](#L1872) | ' is in %s.', |
| [1873](#L1873) | esc\_html( human\_time\_diff( time(), $next ) ) |
| [1874](#L1874) | ); |
| [1875](#L1875) | echo '<!-- ' . esc\_html( gmdate( 'dMy H:i:s', $next ) ) . ' --> '; |
| [1876](#L1876) | echo esc\_html\_\_( 'You can run the purging process now by clicking the button below.', 'wp-security-audit-log' ); |
| [1877](#L1877) | ?> |
| [1878](#L1878) | </p> |
| [1879](#L1879) | <p> |
| [1880](#L1880) | <a class="button-primary" href=" |
| [1881](#L1881) | <?php |
| [1882](#L1882) | echo esc\_url( |
| [1883](#L1883) | add\_query\_arg( |
| [1884](#L1884) | array( |
| [1885](#L1885) | 'action' => 'AjaxRunCleanup', |
| [1886](#L1886) | 'nonce'  => wp\_create\_nonce( 'wsal-run-cleanup' ), |
| [1887](#L1887) | ), |
| [1888](#L1888) | admin\_url( 'admin-ajax.php' ) |
| [1889](#L1889) | ) |
| [1890](#L1890) | ); |
| [1891](#L1891) | ?> |
| [1892](#L1892) | " data-nonce="<?php echo esc\_attr( wp\_create\_nonce( 'wsal-run-cleanup' ) ); ?>" ><?php esc\_html\_e( 'Purge Old Data', 'wp-security-audit-log' ); ?></a> |
| [1893](#L1893) | </p> |
| [1894](#L1894) | <?php endif; ?> |
| [1895](#L1895) | </td> |
| [1896](#L1896) | </tr> |
| [1897](#L1897) | <!-- Activity log retention --> |
| [1898](#L1898) | </tbody> |
| [1899](#L1899) | </table> |
| [1900](#L1900) | <?php |
| [1901](#L1901) | } |
| [1902](#L1902) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/wp-security-audit-log/trunk/classes/Views/Settings.php?format=txt)
* [Original Format](/export/3222445/wp-security-audit-log/trunk/classes/Views/Settings.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


