=== Content from www.wordfence.com_76d85ba9_20250114_185445.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Abandoned Cart Lite for WooCommerce <= 5.15.1 - Authentication Bypass

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Abandoned Cart Lite for WooCommerce <= 5.15.1 - Authentication Bypass

9.8

**Authentication Bypass Using an Alternate Path or Channel**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

| CVE | [CVE-2023-2986](https://www.cve.org/CVERecord?id=CVE-2023-2986) |
| --- | --- |
| CVSS | 9.8 (Critical) |
| Publicly Published | June 6, 2023 |
| Last Updated | June 23, 2023 |
| Researchers | [István Márton - Wordfence](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/lana-codes)  [Ayan Saha](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/ayan-saha) |

### Description

The Abandoned Cart Lite for WooCommerce plugin for WordPress is vulnerable to authentication bypass in versions up to, and including, 5.14.2. This is due to insufficient encryption on the user being supplied during the abandoned cart link decode through the plugin. This allows unauthenticated attackers to log in as users who have abandoned the cart, who are typically customers. Further security hardening was introduced in version 5.15.1 that ensures sites are no longer vulnerable through historical check-out links, and additional hardening was introduced in version 5.15.2 that ensured null key values wouldn't permit the authentication bypass.

Wordfence blocked **9 attacks** targeting this vulnerability in the past 24 hours.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php#L1815)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/2922242/)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2916178#L1800)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&old=2925274%40woocommerce-abandoned-cart&new=2925274%40woocommerce-abandoned-cart&sfp_email=&sfph_mail=)
* [www.wordfence.com](https://www.wordfence.com/blog/2023/06/tyche-softwares-addresses-authentication-bypass-vulnerability-in-abandoned-cart-lite-for-woocommerce-wordpress-plugin/)
* [github.com](https://github.com/TycheSoftwares/woocommerce-abandoned-cart/pull/885#issuecomment-1601813615)
* [github.com](https://github.com/Ayantaker/CVE-2023-2986)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwoocommerce-abandoned-cart%2Fabandoned-cart-lite-for-woocommerce-5142-authentication-bypass&t=Abandoned%20Cart%20Lite%20for%20WooCommerce%20%3C%3D%205.15.1%20-%20Authentication%20Bypass "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwoocommerce-abandoned-cart%2Fabandoned-cart-lite-for-woocommerce-5142-authentication-bypass&text=Abandoned%20Cart%20Lite%20for%20WooCommerce%20%3C%3D%205.15.1%20-%20Authentication%20Bypass "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwoocommerce-abandoned-cart%2Fabandoned-cart-lite-for-woocommerce-5142-authentication-bypass "LinkedIn")
Email

## Vulnerability Details for Abandoned Cart Lite for WooCommerce

#### [Abandoned Cart Lite for WooCommerce](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/woocommerce-abandoned-cart)

| Software Type | Plugin |
| --- | --- |
| Software Slug | woocommerce-abandoned-cart [(view on wordpress.org)](https://wordpress.org/plugins/woocommerce-abandoned-cart) |
| Patched? | Yes |
| Remediation | Update to version 5.15.2, or a newer patched version |
| Affected Version | * <= 5.15.1 |
| Patched Version | * 5.15.2 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from github.com_0ea69315_20250115_113315.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAyantaker%2FCVE-2023-2986)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAyantaker%2FCVE-2023-2986)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=Ayantaker%2FCVE-2023-2986)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[Ayantaker](/Ayantaker)
/
**[CVE-2023-2986](/Ayantaker/CVE-2023-2986)**
Public

* [Notifications](/login?return_to=%2FAyantaker%2FCVE-2023-2986) You must be signed in to change notification settings
* [Fork
  3](/login?return_to=%2FAyantaker%2FCVE-2023-2986)
* [Star
   6](/login?return_to=%2FAyantaker%2FCVE-2023-2986)

Proof of Concept for vulnerability CVE-2023-2986 in 'Abandoned Cart Lite for WooCommerce' Plugin in WordPress

### License

[GPL-2.0 license](/Ayantaker/CVE-2023-2986/blob/main/LICENSE)

[6
stars](/Ayantaker/CVE-2023-2986/stargazers) [3
forks](/Ayantaker/CVE-2023-2986/forks) [Branches](/Ayantaker/CVE-2023-2986/branches) [Tags](/Ayantaker/CVE-2023-2986/tags) [Activity](/Ayantaker/CVE-2023-2986/activity)
 [Star](/login?return_to=%2FAyantaker%2FCVE-2023-2986)

 [Notifications](/login?return_to=%2FAyantaker%2FCVE-2023-2986) You must be signed in to change notification settings

* [Code](/Ayantaker/CVE-2023-2986)
* [Issues
  0](/Ayantaker/CVE-2023-2986/issues)
* [Pull requests
  0](/Ayantaker/CVE-2023-2986/pulls)
* [Actions](/Ayantaker/CVE-2023-2986/actions)
* [Projects
  0](/Ayantaker/CVE-2023-2986/projects)
* [Security](/Ayantaker/CVE-2023-2986/security)
* [Insights](/Ayantaker/CVE-2023-2986/pulse)

Additional navigation options

* [Code](/Ayantaker/CVE-2023-2986)
* [Issues](/Ayantaker/CVE-2023-2986/issues)
* [Pull requests](/Ayantaker/CVE-2023-2986/pulls)
* [Actions](/Ayantaker/CVE-2023-2986/actions)
* [Projects](/Ayantaker/CVE-2023-2986/projects)
* [Security](/Ayantaker/CVE-2023-2986/security)
* [Insights](/Ayantaker/CVE-2023-2986/pulse)

# Ayantaker/CVE-2023-2986

    main[Branches](/Ayantaker/CVE-2023-2986/branches)[Tags](/Ayantaker/CVE-2023-2986/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[9 Commits](/Ayantaker/CVE-2023-2986/commits/main/) | | |
| [libs](/Ayantaker/CVE-2023-2986/tree/main/libs "libs") | | [libs](/Ayantaker/CVE-2023-2986/tree/main/libs "libs") |  |  |
| [LICENSE](/Ayantaker/CVE-2023-2986/blob/main/LICENSE "LICENSE") | | [LICENSE](/Ayantaker/CVE-2023-2986/blob/main/LICENSE "LICENSE") |  |  |
| [README.md](/Ayantaker/CVE-2023-2986/blob/main/README.md "README.md") | | [README.md](/Ayantaker/CVE-2023-2986/blob/main/README.md "README.md") |  |  |
| [poc.php](/Ayantaker/CVE-2023-2986/blob/main/poc.php "poc.php") | | [poc.php](/Ayantaker/CVE-2023-2986/blob/main/poc.php "poc.php") |  |  |
| View all files | | |

## Repository files navigation

* README
* GPL-2.0 license
# Original Proof of Concept for CVE-2023-2986

Proof of Concept for vulnerability CVE-2023-2986 in 'Abandoned Cart Lite for WooCommerce' Plugin in WordPress

## Related Details

* NVD Link : <https://nvd.nist.gov/vuln/detail/CVE-2023-2986>
* Plugin Source : <https://github.com/TycheSoftwares/woocommerce-abandoned-cart/>
* Vulnerable versions : ~~`version <= 5.14.2`~~ `version <= 5.15.1`
* Patched version : ~~`5.15.0`~~ `5.15.2`

### Update

* It was thought that version 5.15.0 fixes the issue but I found out that it wasn't completely fixed and same has been updated. So the actual patched version is `5.15.2`

## Vulnerability Analysis

* Keysight Blogs : <https://www.keysight.com/blogs/tech/nwvs/2023/08/23/cve-2023-2986>
* Medium : <https://medium.com/keysight-ati/cve-2023-2986-wordpress-plugin-vulnerability-and-the-importance-of-poc-7c9c5122438b>

## Usage

```
sudo apt-get install php-curl
php poc.php http://target_host target_port max_cart_id_to_enumerate
```

```
[*] Enumerating cart ID : 1
[+] Authentication Bypass URL for user 'victim' : https://10.39.44.149:443/?wcal_action=checkout_link&validate=pwDHtAFjg2StEr4S2bP9YXkwVdKLqnsLjpkFGythB5ztEF8twVbXFdEP6u7kYwrc
[*] Enumerating cart ID : 2
[*] Enumerating cart ID : 3
[+] Authentication Bypass URL for user 'victim2' : https://10.39.44.149:443/?wcal_action=checkout_link&validate=aQH9pwVjg2TWqKcFmNoipUeBKbYNb5UaEYMYP8DlCz3DqykRdzP3lQgEqID6QsoD
[*] Enumerating cart ID : 4
[+] Authentication Bypass URL for user 'user' : https://10.39.44.149:443/?wcal_action=checkout_link&validate=XQOexwdjg2TzUjbZJgcYAeUE1p7YdPytSYL3Vkkjb+gISKD02Cpk+3Dx6SUnbe5d
[*] Enumerating cart ID : 5

```
> Entering the URL in browser will give you access to the respective users account. If the wordpress admin user himself has an entry, this will give access to the admin console leading to full compromise of the wordpress server.

## Disclaimer

This Proof of Concept (POC) has been created purely for the purposes of academic research and for the development of effective defensive techniques, and is not intended to be used to attack systems except where explicitly authorized. Author is not responsible or liable for any misuse of the POC. Use responsibly.

## About

Proof of Concept for vulnerability CVE-2023-2986 in 'Abandoned Cart Lite for WooCommerce' Plugin in WordPress

### Topics

[php](/topics/php "Topic: php")
[wordpress-plugin](/topics/wordpress-plugin "Topic: wordpress-plugin")
[proof-of-concept](/topics/proof-of-concept "Topic: proof-of-concept")
[exploit](/topics/exploit "Topic: exploit")
[woocommerce](/topics/woocommerce "Topic: woocommerce")
[vulnerability](/topics/vulnerability "Topic: vulnerability")
[cve-2023-2986](/topics/cve-2023-2986 "Topic: cve-2023-2986")
[abandoned-cart-lite](/topics/abandoned-cart-lite "Topic: abandoned-cart-lite")

### Resources

[Readme](#readme-ov-file)
### License

[GPL-2.0 license](#GPL-2.0-1-ov-file)

[Activity](/Ayantaker/CVE-2023-2986/activity)
### Stars

[**6**
stars](/Ayantaker/CVE-2023-2986/stargazers)
### Watchers

[**1**
watching](/Ayantaker/CVE-2023-2986/watchers)
### Forks

[**3**
forks](/Ayantaker/CVE-2023-2986/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2FAyantaker%2FCVE-2023-2986&report=Ayantaker+%28user%29)

## [Releases](/Ayantaker/CVE-2023-2986/releases)

No releases published

## [Packages 0](/users/Ayantaker/packages?repo_name=CVE-2023-2986)

No packages published

## Languages

* [PHP
  100.0%](/Ayantaker/CVE-2023-2986/search?l=php)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from plugins.trac.wordpress.org_9aa2d49f_20250114_185443.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D2925274%2540woocommerce-abandoned-cart%26old%3D2925274%2540woocommerce-abandoned-cart)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/2922242/woocommerce-abandoned-cart "Changeset 2922242 for woocommerce-abandoned-cart")
* [Next Change](/changeset/2929196/woocommerce-abandoned-cart "Changeset 2929196 for woocommerce-abandoned-cart") →

---

# Changeset [2925274](/changeset/2925274 "Show full changeset") for [woocommerce-abandoned-cart](/browser/woocommerce-abandoned-cart?rev=2925274 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
06/13/2023 12:09:16 PM
([19 months](/timeline?from=2023-06-13T12%3A09%3A16Z&precision=second "See timeline at 06/13/2023 12:09:16 PM") ago)

Author:
tychesoftwares
Message:

Update to version 5.15.1 from GitHub

Location:
[woocommerce-abandoned-cart](/browser/woocommerce-abandoned-cart?rev=2925274)
Files:

4 edited
1 copied

* [tags/5.15.1](/browser/woocommerce-abandoned-cart/tags/5.15.1?rev=2925274 "Show entry in browser")
  (copied)
  *(copied from [woocommerce-abandoned-cart/trunk](/browser/woocommerce-abandoned-cart/trunk?rev=2922242 "Show original file (revision 2925273)"))*
* [tags/5.15.1/readme.txt](/browser/woocommerce-abandoned-cart/tags/5.15.1/readme.txt?rev=2925274 "Show entry in browser")
  (modified)
  ([1 diff](#file1 "Show differences"))
* [tags/5.15.1/woocommerce-ac.php](/browser/woocommerce-abandoned-cart/tags/5.15.1/woocommerce-ac.php?rev=2925274 "Show entry in browser")
  (modified)
  ([6 diffs](#file2 "Show differences"))
* [trunk/readme.txt](/browser/woocommerce-abandoned-cart/trunk/readme.txt?rev=2925274 "Show entry in browser")
  (modified)
  ([1 diff](#file3 "Show differences"))
* [trunk/woocommerce-ac.php](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2925274 "Show entry in browser")
  (modified)
  ([6 diffs](#file4 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [woocommerce-abandoned-cart/tags/5.15.1/readme.txt](/changeset/2925274/woocommerce-abandoned-cart/tags/5.15.1/readme.txt "Show the changeset 2925274 restricted to woocommerce-abandoned-cart/tags/5.15.1/readme.txt")

  | [r2922242](/browser/woocommerce-abandoned-cart/trunk/readme.txt?rev=2922242#L156 "Show revision 2922242 of this file in browser") | [r2925274](/browser/woocommerce-abandoned-cart/tags/5.15.1/readme.txt?rev=2925274#L156 "Show revision 2925274 of this file in browser") |  |
  | --- | --- | --- |
  | 156 | 156 |  |
  | 157 | 157 | == Changelog == |
  |  | 158 |  |
  |  | 159 | = 5.15.1 ( 13.06.2023 ) = |
  |  | 160 | \* Fix - Removed backward compatibility for old reminder email links. |
  | 158 | 161 |  |
  | 159 | 162 | = 5.15.0 ( 06.06.2023 ) = |
* ## [woocommerce-abandoned-cart/tags/5.15.1/woocommerce-ac.php](/changeset/2925274/woocommerce-abandoned-cart/tags/5.15.1/woocommerce-ac.php "Show the changeset 2925274 restricted to woocommerce-abandoned-cart/tags/5.15.1/woocommerce-ac.php")

  | [r2922242](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2922242#L4 "Show revision 2922242 of this file in browser") | [r2925274](/browser/woocommerce-abandoned-cart/tags/5.15.1/woocommerce-ac.php?rev=2925274#L4 "Show revision 2925274 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* Plugin URI: http://www.tychesoftwares.com/store/premium-plugins/woocommerce-abandoned-cart-pro |
  | 5 | 5 | \* Description: This plugin captures abandoned carts by logged-in users & emails them about it. <strong><a href="http://www.tychesoftwares.com/store/premium-plugins/woocommerce-abandoned-cart-pro">Click here to get the PRO Version.</a></strong> |
  | 6 |  | \* Version: 5.15.~~0~~ |
  |  | 6 | \* Version: 5.15.1 |
  | 7 | 7 | \* Author: Tyche Softwares |
  | 8 | 8 | \* Author URI: http://www.tychesoftwares.com/ |
  | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2922242#L127) | […](/browser/woocommerce-abandoned-cart/tags/5.15.1/woocommerce-ac.php?rev=2925274#L127) |  |
  | 127 | 127 |  |
  | 128 | 128 | if ( ! defined( 'WCAL\_PLUGIN\_VERSION' ) ) { |
  | 129 |  | define( 'WCAL\_PLUGIN\_VERSION', '5.15.~~0~~' ); |
  |  | 129 | define( 'WCAL\_PLUGIN\_VERSION', '5.15.1' ); |
  | 130 | 130 | } |
  | 131 | 131 |  |
  | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2922242#L1744) | […](/browser/woocommerce-abandoned-cart/tags/5.15.1/woocommerce-ac.php?rev=2925274#L1744) |  |
  | 1744 | 1744 | $validate\_email\_address\_string = ''; |
  | 1745 | 1745 | $validate\_email\_id\_decode      = 0; |
  |  | 1746 | $crypt\_key                     = ''; |
  | 1746 | 1747 | if ( isset( $\_GET['user\_email'] ) && '' !== $\_GET['user\_email'] ) { // phpcs:ignore |
  | 1747 | 1748 | $sent\_email = sanitize\_text\_field( wp\_unslash( $\_GET['user\_email'] ) ); // phpcs:ignore |
  | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2922242#L1752) | […](/browser/woocommerce-abandoned-cart/tags/5.15.1/woocommerce-ac.php?rev=2925274#L1753) |  |
  | 1752 | 1753 | ) |
  | 1753 | 1754 | ); |
  | 1754 |  | } else { |
  | 1755 |  | $crypt\_key = get\_option( 'wcal\_security\_key' ); |
  | 1756 |  | } |
  | 1757 |  | $validate\_email\_id\_decode = Wcal\_Aes\_Ctr::decrypt( $validate\_email\_id\_string, $crypt\_key, 256 ); |
  | 1758 |  | if ( isset( $\_GET['track\_email\_id'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  | 1759 |  | $encoded\_email\_address         = rawurldecode( sanitize\_text\_field( wp\_unslash( $\_GET['track\_email\_id'] ) ) ); // phpcs:ignore WordPress.Security.NonceVerification |
  | 1760 |  | $validate\_email\_address\_string = str\_replace( ' ', '+', $encoded\_email\_address ); |
  | 1761 |  | } |
  | 1762 |  |  |
  | 1763 |  | $results\_sent  = $wpdb->get\_results( //phpcs:ignore |
  | 1764 |  | $wpdb->prepare( |
  | 1765 |  | 'SELECT \* FROM `' . $wpdb->prefix . 'ac\_sent\_history\_lite` WHERE id = %d ', |
  | 1766 |  | $validate\_email\_id\_decode |
  | 1767 |  | ) |
  | 1768 |  | ); |
  | 1769 |  | $email\_address = ''; |
  | 1770 |  | if ( isset( $results\_sent[0] ) ) { |
  | 1771 |  | $email\_address = $results\_sent[0]->sent\_email\_id; |
  | 1772 |  | } |
  | 1773 |  | if ( hash( 'sha256', $email\_address ) === $validate\_email\_address\_string && '' !== $email\_address ) { |
  | 1774 |  | $email\_sent\_id     = $validate\_email\_id\_decode; |
  | 1775 |  | $get\_ac\_id\_results = $wpdb->get\_results( //phpcs:ignore |
  |  | 1755 | } |
  |  | 1756 | if ( '' !== $crypt\_key ) { |
  |  | 1757 | $validate\_email\_id\_decode = Wcal\_Aes\_Ctr::decrypt( $validate\_email\_id\_string, $crypt\_key, 256 ); |
  |  | 1758 | if ( isset( $\_GET['track\_email\_id'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1759 | $encoded\_email\_address         = rawurldecode( sanitize\_text\_field( wp\_unslash( $\_GET['track\_email\_id'] ) ) ); // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1760 | $validate\_email\_address\_string = str\_replace( ' ', '+', $encoded\_email\_address ); |
  |  | 1761 | } |
  |  | 1762 |  |
  |  | 1763 | $results\_sent  = $wpdb->get\_results( //phpcs:ignore |
  | 1776 | 1764 | $wpdb->prepare( |
  | 1777 |  | 'SELECT ~~abandoned\_order\_id FROM `' . $wpdb->prefix . 'ac\_sent\_history\_lite` WHERE id = %d~~', |
  | 1778 |  | $~~email\_sent\_id~~ |
  |  | 1765 | 'SELECT \* FROM `' . $wpdb->prefix . 'ac\_sent\_history\_lite` WHERE id = %d ', |
  |  | 1766 | $validate\_email\_id\_decode |
  | 1779 | 1767 | ) |
  | 1780 | 1768 | ); |
  | 1781 |  | $user\_id           = 0; |
  | 1782 |  | if ( isset( $get\_ac\_id\_results[0] ) ) { |
  | 1783 |  | $get\_user\_results  = $wpdb->get\_results( //phpcs:ignore |
  |  | 1769 | $email\_address = ''; |
  |  | 1770 | if ( isset( $results\_sent[0] ) ) { |
  |  | 1771 | $email\_address = $results\_sent[0]->sent\_email\_id; |
  |  | 1772 | } |
  |  | 1773 | if ( hash( 'sha256', $email\_address ) === $validate\_email\_address\_string && '' !== $email\_address ) { |
  |  | 1774 | $email\_sent\_id     = $validate\_email\_id\_decode; |
  |  | 1775 | $get\_ac\_id\_results = $wpdb->get\_results( //phpcs:ignore |
  | 1784 | 1776 | $wpdb->prepare( |
  | 1785 |  | 'SELECT ~~user\_id FROM `' . $wpdb->prefix . 'ac\_abandoned\_car~~t\_history\_lite` WHERE id = %d', |
  | 1786 |  | $~~get\_ac\_id\_results[0]->abandoned\_order~~\_id |
  |  | 1777 | 'SELECT abandoned\_order\_id FROM `' . $wpdb->prefix . 'ac\_sent\_history\_lite` WHERE id = %d', |
  |  | 1778 | $email\_sent\_id |
  | 1787 | 1779 | ) |
  | 1788 | 1780 | ); |
  |  | 1781 | $user\_id           = 0; |
  |  | 1782 | if ( isset( $get\_ac\_id\_results[0] ) ) { |
  |  | 1783 | $get\_user\_results  = $wpdb->get\_results( //phpcs:ignore |
  |  | 1784 | $wpdb->prepare( |
  |  | 1785 | 'SELECT user\_id FROM `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` WHERE id = %d', |
  |  | 1786 | $get\_ac\_id\_results[0]->abandoned\_order\_id |
  |  | 1787 | ) |
  |  | 1788 | ); |
  |  | 1789 | } |
  |  | 1790 | if ( isset( $get\_user\_results[0] ) ) { |
  |  | 1791 | $user\_id = $get\_user\_results[0]->user\_id; |
  |  | 1792 | } |
  |  | 1793 |  |
  |  | 1794 | $wpdb->query( //phpcs:ignore |
  |  | 1795 | $wpdb->prepare( |
  |  | 1796 | 'UPDATE `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` SET unsubscribe\_link = %s WHERE user\_id= %d AND cart\_ignored = %s', |
  |  | 1797 | 1, |
  |  | 1798 | $user\_id, |
  |  | 1799 | 0 |
  |  | 1800 | ) |
  |  | 1801 | ); |
  |  | 1802 | echo esc\_html( 'Unsubscribed Successfully' ); |
  |  | 1803 | sleep( 2 ); |
  |  | 1804 | $url = apply\_filters( 'wcal\_unsubscribe\_redirect', get\_option( 'home' ) ); |
  |  | 1805 | ?> |
  |  | 1806 | <script> |
  |  | 1807 | location.href = "<?php echo esc\_url( $url ); ?>"; |
  |  | 1808 | </script> |
  |  | 1809 | <?php |
  | 1789 | 1810 | } |
  | 1790 |  | ~~if ( isset( $get\_user\_results[0] ) ) {~~ |
  | 1791 |  | ~~$user\_id = $get\_user\_results[0]->user\_id;~~ |
  | 1792 |  | ~~}~~ |
  | 1793 |  |  |
  | 1794 |  | ~~$wpdb->query( //phpcs:ignore~~ |
  | 1795 |  | ~~$wpdb->prepare(~~ |
  | 1796 |  | ~~'UPDATE `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` SET unsubscribe\_link = %s WHERE user\_id= %d AND cart\_ignored = %s',~~ |
  | 1797 |  | ~~1,~~ |
  | 1798 |  | ~~$user\_id,~~ |
  | 1799 |  | ~~0~~ |
  | 1800 |  | ~~)~~ |
  | 1801 |  | ~~);~~ |
  | 1802 |  | ~~echo esc\_html( 'Unsubscribed Successfully' );~~ |
  | 1803 |  | ~~sleep( 2 );~~ |
  | 1804 |  | ~~$url = apply\_filters( 'wcal\_unsubscribe\_redirect', get\_option( 'home' ) );~~ |
  | 1805 |  | ~~?>~~ |
  | 1806 |  | ~~<script>~~ |
  | 1807 |  | ~~location.href = "<?php echo esc\_url( $url ); ?>";~~ |
  | 1808 |  | ~~</script>~~ |
  | 1809 |  | ~~<?php~~ |
  | 1810 | 1811 | } |
  | 1811 | 1812 | } else { |
  | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2922242#L1838) | […](/browser/woocommerce-abandoned-cart/tags/5.15.1/woocommerce-ac.php?rev=2925274#L1839) |  |
  | 1838 | 1839 | $validate\_server\_string  = str\_replace( ' ', '+', $validate\_server\_string ); |
  | 1839 | 1840 | $validate\_encoded\_string = $validate\_server\_string; |
  |  | 1841 | $crypt\_key               = ''; |
  |  | 1842 | $user\_id                 = 0; |
  |  | 1843 | $abandoned\_id            = 0; |
  | 1840 | 1844 | if ( isset( $\_GET['user\_email'] ) && '' !== $\_GET['user\_email'] ) { // phpcs:ignore |
  | 1841 | 1845 | $sent\_email = sanitize\_text\_field( wp\_unslash( $\_GET['user\_email'] ) ); // phpcs:ignore |
  | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2922242#L1846) | […](/browser/woocommerce-abandoned-cart/tags/5.15.1/woocommerce-ac.php?rev=2925274#L1850) |  |
  | 1846 | 1850 | ) |
  | 1847 | 1851 | ); |
  | 1848 |  | } else { |
  | 1849 |  | $crypt\_key = get\_option( 'wcal\_security\_key' ); |
  | 1850 |  | } |
  | 1851 |  | $link\_decode       = Wcal\_Aes\_Ctr::decrypt( $validate\_encoded\_string, $crypt\_key, 256 ); |
  | 1852 |  | $sent\_email\_id\_pos = strpos( $link\_decode, '&' ); |
  | 1853 |  | $email\_sent\_id     = substr( $link\_decode, 0, $sent\_email\_id\_pos ); |
  | 1854 |  |  |
  | 1855 |  | if ( isset( $\_GET['c'] ) ) { // phpcs:ignore |
  | 1856 |  | $decrypt\_coupon\_code = rawurldecode( sanitize\_text\_field( wp\_unslash( $\_GET['c'] ) ) ); //phpcs:ignore |
  | 1857 |  | $decrypt\_coupon\_code = str\_replace( ' ', '+', $decrypt\_coupon\_code ); |
  | 1858 |  | $decode\_coupon\_code  = Wcal\_Aes\_Ctr::decrypt( $decrypt\_coupon\_code, $crypt\_key, 256 ); |
  | 1859 |  |  |
  | 1860 |  | wcal\_common::wcal\_set\_cart\_session( 'wcal\_c', $decode\_coupon\_code ); // we need to set in session coz we directly apply coupon. |
  | 1861 |  | set\_transient( 'wcal\_c', $decode\_coupon\_code, 5 ); |
  | 1862 |  | } else { |
  | 1863 |  | $decode\_coupon\_code = ''; |
  | 1864 |  | } |
  | 1865 |  |  |
  | 1866 |  | if ( 'track\_links' === $track\_link ) { |
  | 1867 |  | $email\_sent\_id     = 0; |
  |  | 1852 | } |
  |  | 1853 | if ( '' !== $crypt\_key ) { |
  |  | 1854 | $link\_decode       = Wcal\_Aes\_Ctr::decrypt( $validate\_encoded\_string, $crypt\_key, 256 ); |
  | 1868 | 1855 | $sent\_email\_id\_pos = strpos( $link\_decode, '&' ); |
  | 1869 | 1856 | $email\_sent\_id     = substr( $link\_decode, 0, $sent\_email\_id\_pos ); |
  | 1870 | 1857 |  |
  | 1871 |  | wcal\_common::wcal\_set\_cart\_session( 'email\_sent\_id', $email\_sent\_id ); |
  | 1872 |  | set\_transient( 'wcal\_email\_sent\_id', $email\_sent\_id, 5 ); |
  | 1873 |  |  |
  | 1874 |  | $get\_ac\_id\_results = $wpdb->get\_results( // phpcs:ignore |
  | 1875 |  | $wpdb->prepare( |
  | 1876 |  | 'SELECT abandoned\_order\_id FROM `' . $wpdb->prefix . 'ac\_sent\_history\_lite` WHERE id = %d', |
  | 1877 |  | $email\_sent\_id |
  | 1878 |  | ) |
  | 1879 |  | ); |
  | 1880 |  | $abandoned\_id      = $get\_ac\_id\_results[0]->abandoned\_order\_id; |
  | 1881 |  | } elseif ( 'checkout\_link' === $track\_link ) { |
  | 1882 |  | $abandoned\_id     = 0; |
  | 1883 |  | $abandoned\_id\_pos = strpos( $link\_decode, '&' ); |
  | 1884 |  | $abandoned\_id     = substr( $link\_decode, 0, $abandoned\_id\_pos ); |
  | 1885 |  | wcal\_common::wcal\_set\_cart\_session( 'wcal\_recovered\_cart', true ); |
  | 1886 |  | } |
  | 1887 |  |  |
  | 1888 |  | $url\_pos = strpos( $link\_decode, '=' ); |
  | 1889 |  | ++$url\_pos; |
  | 1890 |  | $url = substr( $link\_decode, $url\_pos ); |
  | 1891 |  |  |
  | 1892 |  | wcal\_common::wcal\_set\_cart\_session( 'abandoned\_cart\_id\_lite', $abandoned\_id ); |
  | 1893 |  | set\_transient( 'wcal\_abandoned\_id', $abandoned\_id, 5 ); |
  | 1894 |  |  |
  | 1895 |  | $get\_user\_results = array(); |
  | 1896 |  | if ( $abandoned\_id > 0 ) { |
  | 1897 |  | $get\_user\_results  = $wpdb->get\_results( //phpcs:ignore |
  | 1898 |  | $wpdb->prepare( |
  | 1899 |  | 'SELECT user\_id FROM `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` WHERE id = %d', |
  | 1900 |  | $abandoned\_id |
  | 1901 |  | ) |
  | 1902 |  | ); |
  | 1903 |  | } |
  | 1904 |  | $user\_id = isset( $get\_user\_results ) && count( $get\_user\_results ) > 0 ? (int) $get\_user\_results[0]->user\_id : 0; |
  |  | 1858 | if ( isset( $\_GET['c'] ) ) { // phpcs:ignore |
  |  | 1859 | $decrypt\_coupon\_code = rawurldecode( sanitize\_text\_field( wp\_unslash( $\_GET['c'] ) ) ); //phpcs:ignore |
  |  | 1860 | $decrypt\_coupon\_code = str\_replace( ' ', '+', $decrypt\_coupon\_code ); |
  |  | 1861 | $decode\_coupon\_code  = Wcal\_Aes\_Ctr::decrypt( $decrypt\_coupon\_code, $crypt\_key, 256 ); |
  |  | 1862 |  |
  |  | 1863 | wcal\_common::wcal\_set\_cart\_session( 'wcal\_c', $decode\_coupon\_code ); // we need to set in session coz we directly apply coupon. |
  |  | 1864 | set\_transient( 'wcal\_c', $decode\_coupon\_code, 5 ); |
  |  | 1865 | } else { |
  |  | 1866 | $decode\_coupon\_code = ''; |
  |  | 1867 | } |
  |  | 1868 |  |
  |  | 1869 | if ( 'track\_links' === $track\_link ) { |
  |  | 1870 | $email\_sent\_id     = 0; |
  |  | 1871 | $sent\_email\_id\_pos = strpos( $link\_decode, '&' ); |
  |  | 1872 | $email\_sent\_id     = substr( $link\_decode, 0, $sent\_email\_id\_pos ); |
  |  | 1873 |  |
  |  | 1874 | wcal\_common::wcal\_set\_cart\_session( 'email\_sent\_id', $email\_sent\_id ); |
  |  | 1875 | set\_transient( 'wcal\_email\_sent\_id', $email\_sent\_id, 5 ); |
  |  | 1876 |  |
  |  | 1877 | $get\_ac\_id\_results = $wpdb->get\_results( // phpcs:ignore |
  |  | 1878 | $wpdb->prepare( |
  |  | 1879 | 'SELECT abandoned\_order\_id FROM `' . $wpdb->prefix . 'ac\_sent\_history\_lite` WHERE id = %d', |
  |  | 1880 | $email\_sent\_id |
  |  | 1881 | ) |
  |  | 1882 | ); |
  |  | 1883 | $abandoned\_id      = $get\_ac\_id\_results[0]->abandoned\_order\_id; |
  |  | 1884 | } elseif ( 'checkout\_link' === $track\_link ) { |
  |  | 1885 | $abandoned\_id     = 0; |
  |  | 1886 | $abandoned\_id\_pos = strpos( $link\_decode, '&' ); |
  |  | 1887 | $abandoned\_id     = substr( $link\_decode, 0, $abandoned\_id\_pos ); |
  |  | 1888 | wcal\_common::wcal\_set\_cart\_session( 'wcal\_recovered\_cart', true ); |
  |  | 1889 | } |
  |  | 1890 |  |
  |  | 1891 | $url\_pos = strpos( $link\_decode, '=' ); |
  |  | 1892 | ++$url\_pos; |
  |  | 1893 | $url = substr( $link\_decode, $url\_pos ); |
  |  | 1894 |  |
  |  | 1895 | wcal\_common::wcal\_set\_cart\_session( 'abandoned\_cart\_id\_lite', $abandoned\_id ); |
  |  | 1896 | set\_transient( 'wcal\_abandoned\_id', $abandoned\_id, 5 ); |
  |  | 1897 |  |
  |  | 1898 | $get\_user\_results = array(); |
  |  | 1899 | if ( $abandoned\_id > 0 ) { |
  |  | 1900 | $get\_user\_results  = $wpdb->get\_results( //phpcs:ignore |
  |  | 1901 | $wpdb->prepare( |
  |  | 1902 | 'SELECT user\_id FROM `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` WHERE id = %d', |
  |  | 1903 | $abandoned\_id |
  |  | 1904 | ) |
  |  | 1905 | ); |
  |  | 1906 | } |
  |  | 1907 | $user\_id = isset( $get\_user\_results ) && count( $get\_user\_results ) > 0 ? (int) $get\_user\_results[0]->user\_id : 0; |
  |  | 1908 | } |
  | 1905 | 1909 |  |
  | 1906 | 1910 | if ( 0 === $user\_id ) { |
  | 1907 | 1911 | echo esc\_html( 'Link expired' ); |
  | 1908 |  | exit; |
  |  | 1912 | if ( version\_compare( $woocommerce->version, '3.0.0', '>=' ) ) { |
  |  | 1913 | wp\_safe\_redirect( get\_permalink( wc\_get\_page\_id( 'shop' ) ) ); |
  |  | 1914 | exit; |
  |  | 1915 | } else { |
  |  | 1916 | wp\_safe\_redirect( get\_permalink( woocommerce\_get\_page\_id( 'shop' ) ) ); |
  |  | 1917 | exit; |
  |  | 1918 | } |
  | 1909 | 1919 | } |
  | 1910 | 1920 | $user = wp\_set\_current\_user( $user\_id ); |
* ## [woocommerce-abandoned-cart/trunk/readme.txt](/changeset/2925274/woocommerce-abandoned-cart/trunk/readme.txt "Show the changeset 2925274 restricted to woocommerce-abandoned-cart/trunk/readme.txt")

  | [r2922242](/browser/woocommerce-abandoned-cart/trunk/readme.txt?rev=2922242#L156 "Show revision 2922242 of this file in browser") | [r2925274](/browser/woocommerce-abandoned-cart/trunk/readme.txt?rev=2925274#L156 "Show revision 2925274 of this file in browser") |  |
  | --- | --- | --- |
  | 156 | 156 |  |
  | 157 | 157 | == Changelog == |
  |  | 158 |  |
  |  | 159 | = 5.15.1 ( 13.06.2023 ) = |
  |  | 160 | \* Fix - Removed backward compatibility for old reminder email links. |
  | 158 | 161 |  |
  | 159 | 162 | = 5.15.0 ( 06.06.2023 ) = |
* ## [woocommerce-abandoned-cart/trunk/woocommerce-ac.php](/changeset/2925274/woocommerce-abandoned-cart/trunk/woocommerce-ac.php "Show the changeset 2925274 restricted to woocommerce-abandoned-cart/trunk/woocommerce-ac.php")

  | [r2922242](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2922242#L4 "Show revision 2922242 of this file in browser") | [r2925274](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2925274#L4 "Show revision 2925274 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* Plugin URI: http://www.tychesoftwares.com/store/premium-plugins/woocommerce-abandoned-cart-pro |
  | 5 | 5 | \* Description: This plugin captures abandoned carts by logged-in users & emails them about it. <strong><a href="http://www.tychesoftwares.com/store/premium-plugins/woocommerce-abandoned-cart-pro">Click here to get the PRO Version.</a></strong> |
  | 6 |  | \* Version: 5.15.~~0~~ |
  |  | 6 | \* Version: 5.15.1 |
  | 7 | 7 | \* Author: Tyche Softwares |
  | 8 | 8 | \* Author URI: http://www.tychesoftwares.com/ |
  | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2922242#L127) | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2925274#L127) |  |
  | 127 | 127 |  |
  | 128 | 128 | if ( ! defined( 'WCAL\_PLUGIN\_VERSION' ) ) { |
  | 129 |  | define( 'WCAL\_PLUGIN\_VERSION', '5.15.~~0~~' ); |
  |  | 129 | define( 'WCAL\_PLUGIN\_VERSION', '5.15.1' ); |
  | 130 | 130 | } |
  | 131 | 131 |  |
  | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2922242#L1744) | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2925274#L1744) |  |
  | 1744 | 1744 | $validate\_email\_address\_string = ''; |
  | 1745 | 1745 | $validate\_email\_id\_decode      = 0; |
  |  | 1746 | $crypt\_key                     = ''; |
  | 1746 | 1747 | if ( isset( $\_GET['user\_email'] ) && '' !== $\_GET['user\_email'] ) { // phpcs:ignore |
  | 1747 | 1748 | $sent\_email = sanitize\_text\_field( wp\_unslash( $\_GET['user\_email'] ) ); // phpcs:ignore |
  | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2922242#L1752) | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2925274#L1753) |  |
  | 1752 | 1753 | ) |
  | 1753 | 1754 | ); |
  | 1754 |  | } else { |
  | 1755 |  | $crypt\_key = get\_option( 'wcal\_security\_key' ); |
  | 1756 |  | } |
  | 1757 |  | $validate\_email\_id\_decode = Wcal\_Aes\_Ctr::decrypt( $validate\_email\_id\_string, $crypt\_key, 256 ); |
  | 1758 |  | if ( isset( $\_GET['track\_email\_id'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  | 1759 |  | $encoded\_email\_address         = rawurldecode( sanitize\_text\_field( wp\_unslash( $\_GET['track\_email\_id'] ) ) ); // phpcs:ignore WordPress.Security.NonceVerification |
  | 1760 |  | $validate\_email\_address\_string = str\_replace( ' ', '+', $encoded\_email\_address ); |
  | 1761 |  | } |
  | 1762 |  |  |
  | 1763 |  | $results\_sent  = $wpdb->get\_results( //phpcs:ignore |
  | 1764 |  | $wpdb->prepare( |
  | 1765 |  | 'SELECT \* FROM `' . $wpdb->prefix . 'ac\_sent\_history\_lite` WHERE id = %d ', |
  | 1766 |  | $validate\_email\_id\_decode |
  | 1767 |  | ) |
  | 1768 |  | ); |
  | 1769 |  | $email\_address = ''; |
  | 1770 |  | if ( isset( $results\_sent[0] ) ) { |
  | 1771 |  | $email\_address = $results\_sent[0]->sent\_email\_id; |
  | 1772 |  | } |
  | 1773 |  | if ( hash( 'sha256', $email\_address ) === $validate\_email\_address\_string && '' !== $email\_address ) { |
  | 1774 |  | $email\_sent\_id     = $validate\_email\_id\_decode; |
  | 1775 |  | $get\_ac\_id\_results = $wpdb->get\_results( //phpcs:ignore |
  |  | 1755 | } |
  |  | 1756 | if ( '' !== $crypt\_key ) { |
  |  | 1757 | $validate\_email\_id\_decode = Wcal\_Aes\_Ctr::decrypt( $validate\_email\_id\_string, $crypt\_key, 256 ); |
  |  | 1758 | if ( isset( $\_GET['track\_email\_id'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1759 | $encoded\_email\_address         = rawurldecode( sanitize\_text\_field( wp\_unslash( $\_GET['track\_email\_id'] ) ) ); // phpcs:ignore WordPress.Security.NonceVerification |
  |  | 1760 | $validate\_email\_address\_string = str\_replace( ' ', '+', $encoded\_email\_address ); |
  |  | 1761 | } |
  |  | 1762 |  |
  |  | 1763 | $results\_sent  = $wpdb->get\_results( //phpcs:ignore |
  | 1776 | 1764 | $wpdb->prepare( |
  | 1777 |  | 'SELECT ~~abandoned\_order\_id FROM `' . $wpdb->prefix . 'ac\_sent\_history\_lite` WHERE id = %d~~', |
  | 1778 |  | $~~email\_sent\_id~~ |
  |  | 1765 | 'SELECT \* FROM `' . $wpdb->prefix . 'ac\_sent\_history\_lite` WHERE id = %d ', |
  |  | 1766 | $validate\_email\_id\_decode |
  | 1779 | 1767 | ) |
  | 1780 | 1768 | ); |
  | 1781 |  | $user\_id           = 0; |
  | 1782 |  | if ( isset( $get\_ac\_id\_results[0] ) ) { |
  | 1783 |  | $get\_user\_results  = $wpdb->get\_results( //phpcs:ignore |
  |  | 1769 | $email\_address = ''; |
  |  | 1770 | if ( isset( $results\_sent[0] ) ) { |
  |  | 1771 | $email\_address = $results\_sent[0]->sent\_email\_id; |
  |  | 1772 | } |
  |  | 1773 | if ( hash( 'sha256', $email\_address ) === $validate\_email\_address\_string && '' !== $email\_address ) { |
  |  | 1774 | $email\_sent\_id     = $validate\_email\_id\_decode; |
  |  | 1775 | $get\_ac\_id\_results = $wpdb->get\_results( //phpcs:ignore |
  | 1784 | 1776 | $wpdb->prepare( |
  | 1785 |  | 'SELECT ~~user\_id FROM `' . $wpdb->prefix . 'ac\_abandoned\_car~~t\_history\_lite` WHERE id = %d', |
  | 1786 |  | $~~get\_ac\_id\_results[0]->abandoned\_order~~\_id |
  |  | 1777 | 'SELECT abandoned\_order\_id FROM `' . $wpdb->prefix . 'ac\_sent\_history\_lite` WHERE id = %d', |
  |  | 1778 | $email\_sent\_id |
  | 1787 | 1779 | ) |
  | 1788 | 1780 | ); |
  |  | 1781 | $user\_id           = 0; |
  |  | 1782 | if ( isset( $get\_ac\_id\_results[0] ) ) { |
  |  | 1783 | $get\_user\_results  = $wpdb->get\_results( //phpcs:ignore |
  |  | 1784 | $wpdb->prepare( |
  |  | 1785 | 'SELECT user\_id FROM `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` WHERE id = %d', |
  |  | 1786 | $get\_ac\_id\_results[0]->abandoned\_order\_id |
  |  | 1787 | ) |
  |  | 1788 | ); |
  |  | 1789 | } |
  |  | 1790 | if ( isset( $get\_user\_results[0] ) ) { |
  |  | 1791 | $user\_id = $get\_user\_results[0]->user\_id; |
  |  | 1792 | } |
  |  | 1793 |  |
  |  | 1794 | $wpdb->query( //phpcs:ignore |
  |  | 1795 | $wpdb->prepare( |
  |  | 1796 | 'UPDATE `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` SET unsubscribe\_link = %s WHERE user\_id= %d AND cart\_ignored = %s', |
  |  | 1797 | 1, |
  |  | 1798 | $user\_id, |
  |  | 1799 | 0 |
  |  | 1800 | ) |
  |  | 1801 | ); |
  |  | 1802 | echo esc\_html( 'Unsubscribed Successfully' ); |
  |  | 1803 | sleep( 2 ); |
  |  | 1804 | $url = apply\_filters( 'wcal\_unsubscribe\_redirect', get\_option( 'home' ) ); |
  |  | 1805 | ?> |
  |  | 1806 | <script> |
  |  | 1807 | location.href = "<?php echo esc\_url( $url ); ?>"; |
  |  | 1808 | </script> |
  |  | 1809 | <?php |
  | 1789 | 1810 | } |
  | 1790 |  | ~~if ( isset( $get\_user\_results[0] ) ) {~~ |
  | 1791 |  | ~~$user\_id = $get\_user\_results[0]->user\_id;~~ |
  | 1792 |  | ~~}~~ |
  | 1793 |  |  |
  | 1794 |  | ~~$wpdb->query( //phpcs:ignore~~ |
  | 1795 |  | ~~$wpdb->prepare(~~ |
  | 1796 |  | ~~'UPDATE `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` SET unsubscribe\_link = %s WHERE user\_id= %d AND cart\_ignored = %s',~~ |
  | 1797 |  | ~~1,~~ |
  | 1798 |  | ~~$user\_id,~~ |
  | 1799 |  | ~~0~~ |
  | 1800 |  | ~~)~~ |
  | 1801 |  | ~~);~~ |
  | 1802 |  | ~~echo esc\_html( 'Unsubscribed Successfully' );~~ |
  | 1803 |  | ~~sleep( 2 );~~ |
  | 1804 |  | ~~$url = apply\_filters( 'wcal\_unsubscribe\_redirect', get\_option( 'home' ) );~~ |
  | 1805 |  | ~~?>~~ |
  | 1806 |  | ~~<script>~~ |
  | 1807 |  | ~~location.href = "<?php echo esc\_url( $url ); ?>";~~ |
  | 1808 |  | ~~</script>~~ |
  | 1809 |  | ~~<?php~~ |
  | 1810 | 1811 | } |
  | 1811 | 1812 | } else { |
  | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2922242#L1838) | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2925274#L1839) |  |
  | 1838 | 1839 | $validate\_server\_string  = str\_replace( ' ', '+', $validate\_server\_string ); |
  | 1839 | 1840 | $validate\_encoded\_string = $validate\_server\_string; |
  |  | 1841 | $crypt\_key               = ''; |
  |  | 1842 | $user\_id                 = 0; |
  |  | 1843 | $abandoned\_id            = 0; |
  | 1840 | 1844 | if ( isset( $\_GET['user\_email'] ) && '' !== $\_GET['user\_email'] ) { // phpcs:ignore |
  | 1841 | 1845 | $sent\_email = sanitize\_text\_field( wp\_unslash( $\_GET['user\_email'] ) ); // phpcs:ignore |
  | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2922242#L1846) | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2925274#L1850) |  |
  | 1846 | 1850 | ) |
  | 1847 | 1851 | ); |
  | 1848 |  | } else { |
  | 1849 |  | $crypt\_key = get\_option( 'wcal\_security\_key' ); |
  | 1850 |  | } |
  | 1851 |  | $link\_decode       = Wcal\_Aes\_Ctr::decrypt( $validate\_encoded\_string, $crypt\_key, 256 ); |
  | 1852 |  | $sent\_email\_id\_pos = strpos( $link\_decode, '&' ); |
  | 1853 |  | $email\_sent\_id     = substr( $link\_decode, 0, $sent\_email\_id\_pos ); |
  | 1854 |  |  |
  | 1855 |  | if ( isset( $\_GET['c'] ) ) { // phpcs:ignore |
  | 1856 |  | $decrypt\_coupon\_code = rawurldecode( sanitize\_text\_field( wp\_unslash( $\_GET['c'] ) ) ); //phpcs:ignore |
  | 1857 |  | $decrypt\_coupon\_code = str\_replace( ' ', '+', $decrypt\_coupon\_code ); |
  | 1858 |  | $decode\_coupon\_code  = Wcal\_Aes\_Ctr::decrypt( $decrypt\_coupon\_code, $crypt\_key, 256 ); |
  | 1859 |  |  |
  | 1860 |  | wcal\_common::wcal\_set\_cart\_session( 'wcal\_c', $decode\_coupon\_code ); // we need to set in session coz we directly apply coupon. |
  | 1861 |  | set\_transient( 'wcal\_c', $decode\_coupon\_code, 5 ); |
  | 1862 |  | } else { |
  | 1863 |  | $decode\_coupon\_code = ''; |
  | 1864 |  | } |
  | 1865 |  |  |
  | 1866 |  | if ( 'track\_links' === $track\_link ) { |
  | 1867 |  | $email\_sent\_id     = 0; |
  |  | 1852 | } |
  |  | 1853 | if ( '' !== $crypt\_key ) { |
  |  | 1854 | $link\_decode       = Wcal\_Aes\_Ctr::decrypt( $validate\_encoded\_string, $crypt\_key, 256 ); |
  | 1868 | 1855 | $sent\_email\_id\_pos = strpos( $link\_decode, '&' ); |
  | 1869 | 1856 | $email\_sent\_id     = substr( $link\_decode, 0, $sent\_email\_id\_pos ); |
  | 1870 | 1857 |  |
  | 1871 |  | wcal\_common::wcal\_set\_cart\_session( 'email\_sent\_id', $email\_sent\_id ); |
  | 1872 |  | set\_transient( 'wcal\_email\_sent\_id', $email\_sent\_id, 5 ); |
  | 1873 |  |  |
  | 1874 |  | $get\_ac\_id\_results = $wpdb->get\_results( // phpcs:ignore |
  | 1875 |  | $wpdb->prepare( |
  | 1876 |  | 'SELECT abandoned\_order\_id FROM `' . $wpdb->prefix . 'ac\_sent\_history\_lite` WHERE id = %d', |
  | 1877 |  | $email\_sent\_id |
  | 1878 |  | ) |
  | 1879 |  | ); |
  | 1880 |  | $abandoned\_id      = $get\_ac\_id\_results[0]->abandoned\_order\_id; |
  | 1881 |  | } elseif ( 'checkout\_link' === $track\_link ) { |
  | 1882 |  | $abandoned\_id     = 0; |
  | 1883 |  | $abandoned\_id\_pos = strpos( $link\_decode, '&' ); |
  | 1884 |  | $abandoned\_id     = substr( $link\_decode, 0, $abandoned\_id\_pos ); |
  | 1885 |  | wcal\_common::wcal\_set\_cart\_session( 'wcal\_recovered\_cart', true ); |
  | 1886 |  | } |
  | 1887 |  |  |
  | 1888 |  | $url\_pos = strpos( $link\_decode, '=' ); |
  | 1889 |  | ++$url\_pos; |
  | 1890 |  | $url = substr( $link\_decode, $url\_pos ); |
  | 1891 |  |  |
  | 1892 |  | wcal\_common::wcal\_set\_cart\_session( 'abandoned\_cart\_id\_lite', $abandoned\_id ); |
  | 1893 |  | set\_transient( 'wcal\_abandoned\_id', $abandoned\_id, 5 ); |
  | 1894 |  |  |
  | 1895 |  | $get\_user\_results = array(); |
  | 1896 |  | if ( $abandoned\_id > 0 ) { |
  | 1897 |  | $get\_user\_results  = $wpdb->get\_results( //phpcs:ignore |
  | 1898 |  | $wpdb->prepare( |
  | 1899 |  | 'SELECT user\_id FROM `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` WHERE id = %d', |
  | 1900 |  | $abandoned\_id |
  | 1901 |  | ) |
  | 1902 |  | ); |
  | 1903 |  | } |
  | 1904 |  | $user\_id = isset( $get\_user\_results ) && count( $get\_user\_results ) > 0 ? (int) $get\_user\_results[0]->user\_id : 0; |
  |  | 1858 | if ( isset( $\_GET['c'] ) ) { // phpcs:ignore |
  |  | 1859 | $decrypt\_coupon\_code = rawurldecode( sanitize\_text\_field( wp\_unslash( $\_GET['c'] ) ) ); //phpcs:ignore |
  |  | 1860 | $decrypt\_coupon\_code = str\_replace( ' ', '+', $decrypt\_coupon\_code ); |
  |  | 1861 | $decode\_coupon\_code  = Wcal\_Aes\_Ctr::decrypt( $decrypt\_coupon\_code, $crypt\_key, 256 ); |
  |  | 1862 |  |
  |  | 1863 | wcal\_common::wcal\_set\_cart\_session( 'wcal\_c', $decode\_coupon\_code ); // we need to set in session coz we directly apply coupon. |
  |  | 1864 | set\_transient( 'wcal\_c', $decode\_coupon\_code, 5 ); |
  |  | 1865 | } else { |
  |  | 1866 | $decode\_coupon\_code = ''; |
  |  | 1867 | } |
  |  | 1868 |  |
  |  | 1869 | if ( 'track\_links' === $track\_link ) { |
  |  | 1870 | $email\_sent\_id     = 0; |
  |  | 1871 | $sent\_email\_id\_pos = strpos( $link\_decode, '&' ); |
  |  | 1872 | $email\_sent\_id     = substr( $link\_decode, 0, $sent\_email\_id\_pos ); |
  |  | 1873 |  |
  |  | 1874 | wcal\_common::wcal\_set\_cart\_session( 'email\_sent\_id', $email\_sent\_id ); |
  |  | 1875 | set\_transient( 'wcal\_email\_sent\_id', $email\_sent\_id, 5 ); |
  |  | 1876 |  |
  |  | 1877 | $get\_ac\_id\_results = $wpdb->get\_results( // phpcs:ignore |
  |  | 1878 | $wpdb->prepare( |
  |  | 1879 | 'SELECT abandoned\_order\_id FROM `' . $wpdb->prefix . 'ac\_sent\_history\_lite` WHERE id = %d', |
  |  | 1880 | $email\_sent\_id |
  |  | 1881 | ) |
  |  | 1882 | ); |
  |  | 1883 | $abandoned\_id      = $get\_ac\_id\_results[0]->abandoned\_order\_id; |
  |  | 1884 | } elseif ( 'checkout\_link' === $track\_link ) { |
  |  | 1885 | $abandoned\_id     = 0; |
  |  | 1886 | $abandoned\_id\_pos = strpos( $link\_decode, '&' ); |
  |  | 1887 | $abandoned\_id     = substr( $link\_decode, 0, $abandoned\_id\_pos ); |
  |  | 1888 | wcal\_common::wcal\_set\_cart\_session( 'wcal\_recovered\_cart', true ); |
  |  | 1889 | } |
  |  | 1890 |  |
  |  | 1891 | $url\_pos = strpos( $link\_decode, '=' ); |
  |  | 1892 | ++$url\_pos; |
  |  | 1893 | $url = substr( $link\_decode, $url\_pos ); |
  |  | 1894 |  |
  |  | 1895 | wcal\_common::wcal\_set\_cart\_session( 'abandoned\_cart\_id\_lite', $abandoned\_id ); |
  |  | 1896 | set\_transient( 'wcal\_abandoned\_id', $abandoned\_id, 5 ); |
  |  | 1897 |  |
  |  | 1898 | $get\_user\_results = array(); |
  |  | 1899 | if ( $abandoned\_id > 0 ) { |
  |  | 1900 | $get\_user\_results  = $wpdb->get\_results( //phpcs:ignore |
  |  | 1901 | $wpdb->prepare( |
  |  | 1902 | 'SELECT user\_id FROM `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` WHERE id = %d', |
  |  | 1903 | $abandoned\_id |
  |  | 1904 | ) |
  |  | 1905 | ); |
  |  | 1906 | } |
  |  | 1907 | $user\_id = isset( $get\_user\_results ) && count( $get\_user\_results ) > 0 ? (int) $get\_user\_results[0]->user\_id : 0; |
  |  | 1908 | } |
  | 1905 | 1909 |  |
  | 1906 | 1910 | if ( 0 === $user\_id ) { |
  | 1907 | 1911 | echo esc\_html( 'Link expired' ); |
  | 1908 |  | exit; |
  |  | 1912 | if ( version\_compare( $woocommerce->version, '3.0.0', '>=' ) ) { |
  |  | 1913 | wp\_safe\_redirect( get\_permalink( wc\_get\_page\_id( 'shop' ) ) ); |
  |  | 1914 | exit; |
  |  | 1915 | } else { |
  |  | 1916 | wp\_safe\_redirect( get\_permalink( woocommerce\_get\_page\_id( 'shop' ) ) ); |
  |  | 1917 | exit; |
  |  | 1918 | } |
  | 1909 | 1919 | } |
  | 1910 | 1920 | $user = wp\_set\_current\_user( $user\_id ); |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=2925274)
* [Zip Archive](?format=zip&new=2925274)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_ae396c0b_20250114_185444.html ===


![](https://www.wordfence.com/wp-content/uploads/2023/06/FeaturedImage_Wordfence_13.12.png)

[![](https://secure.gravatar.com/avatar/d6e64b55520015fd6d41f1f8e93ca086?s=80&d=mm&r=g)István Márton](https://www.wordfence.com/blog/author/istvanwf/)

June 19, 2023

# Tyche Softwares Addresses Authentication Bypass Vulnerability in Abandoned Cart Lite for WooCommerce WordPress Plugin

On May 29, 2023, our Wordfence Threat Intelligence team identified and began the responsible disclosure process for an Authentication Bypass vulnerability in [Tyche Softwares’s Abandoned Cart Lite for WooCommerce plugin](https://wordpress.org/plugins/woocommerce-abandoned-cart/), which is actively installed on more than 30,000 WordPress websites. This vulnerability makes it possible for an attacker to gain access to the accounts of users who have abandoned their carts, who are typically customers but can extend to other high-level users when the right conditions are met.

[Wordfence Premium](https://www.wordfence.com/products/wordfence-premium/), [Wordfence Care](https://www.wordfence.com/products/wordfence-care/), and [Wordfence Response](https://www.wordfence.com/products/wordfence-response/) users received a firewall rule to protect against any exploits targeting this vulnerability on June 7, 2023. Sites still using the free version of Wordfence will receive the same protection on July 7, 2023.

We contacted Tyche Softwares on May 30, 2023, and received a response the next day. After providing full disclosure details, the developer released a patch on June 6, 2023. We would like to commend the Tyche Softwares development team for their prompt response and timely patch.

We urge users to update their sites with the latest patched version of Abandoned Cart Lite for WooCommerce, version 5.15.1 at the time of this writing, as soon as possible.

## Vulnerability Summary from Wordfence Intelligence

**Description:** [Abandoned Cart Lite for WooCommerce <= 5.14.2 – Authentication Bypass](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/woocommerce-abandoned-cart/abandoned-cart-lite-for-woocommerce-5142-authentication-bypass)

**Affected Plugin:** Abandoned Cart Lite for WooCommerce

**Plugin Slug:** woocommerce-abandoned-cart

**Affected Versions:** <= 5.14.2

**CVE ID:** [CVE-2023-2986](https://www.cve.org/CVERecord?id=CVE-2023-2986)

**CVSS Score:** 9.8 (Critical)

**CVSS Vector:** [CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**Researcher/s:** [Lana Codes](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/lana-codes)

**Fully Patched Version:** 5.15.1

The Abandoned Cart Lite for WooCommerce plugin for WordPress is vulnerable to authentication bypass in versions up to, and including, 5.14.2. This is due to insufficient encryption on the user being supplied during the abandoned cart link decode through the plugin. This allows unauthenticated attackers to log in as users who have abandoned the cart, who are typically customers.

## Technical Analysis

The Abandoned Cart Lite for WooCommerce plugin, according to its settings, sends a notification to customers who have not completed the purchase process, who have, in other words, abandoned their cart. The notification contains a link that automatically logs in the customer to continue their purchase. Examining the code reveals that the link contains an encrypted value, which identifies the abandoned cart.

```
$validate_server_string = isset( $_GET ['validate'] ) ? rawurldecode( wp_unslash( $_GET ['validate'] ) ) : '';
$validate_server_string = str_replace( ' ', '+', $validate_server_string );
$validate_encoded_string = $validate_server_string;
$crypt_key = get_option( 'wcal_security_key' );
$link_decode = Wcal_Aes_Ctr::decrypt( $validate_encoded_string, $crypt_key, 256 );
$sent_email_id_pos = strpos( $link_decode, '&' );
$email_sent_id = substr( $link_decode, 0, $sent_email_id_pos );
```

The link only works if it contains the properly encrypted value, which requires the encryption key to create. However, we found that the encryption key is hardcoded in the plugin, which means that threat actors also have access to it. Due to this, it is possible to create a link using the key that includes the abandoned cart identifier of other users, since each cart identifier is a sequentially increasing number starting from one.

```
$get_ac_id_results = $wpdb->get_results(
	$wpdb->prepare(
		'SELECT abandoned_order_id FROM `' . $wpdb->prefix . 'ac_sent_history_lite` WHERE id = %d',
		$email_sent_id
	)
);
$abandoned_id      = $get_ac_id_results[0]->abandoned_order_id;
```
```
$get_user_results = array();
if ( $abandoned_id > 0 ) {
	$get_user_results  = $wpdb->get_results( //phpcs:ignore
		$wpdb->prepare(
			'SELECT user_id FROM `' . $wpdb->prefix . 'ac_abandoned_cart_history_lite` WHERE id = %d',
			$abandoned_id
		)
	);
}
$user_id = isset( $get_user_results ) && count( $get_user_results ) > 0 ? (int) $get_user_results[0]->user_id : 0;

```
```
wp_set_auth_cookie( $user_id );
```

An attacker is limited to what users they can log in as due to the fact that it is only possible to login as a user with an abandoned cart. Considering the requirement of an abandoned cart, in most cases an attacker will only be able to log in as a customer-level user. However, there is a chance that by exploiting the authentication bypass vulnerability, an attacker can gain access to an administrative user account, or another higher-level user account if they have been testing the abandoned cart functionality. Regardless, this is a severe vulnerability that can lead to customer sensitive information being exposed at its best and complete compromise of a site at its worst.

## Update Notice and Recommendation

We would like to make a note that the developers made the functionality backward compatible in version 5.15.0, which means that old abandoned carts can be exploited even if the plugin is updated to that version. Further security hardening was introduced in version 5.15.1 that ensures sites are no longer vulnerable through old abandoned cart links, therefore, we recommend making sure all sites are updated to that version.

## Disclosure Timeline

**May 29, 2023** – Discovery of the Authentication Bypass vulnerability in Abandoned Cart Lite for WooCommerce.

**May 30, 2023** – We initiate contact with the plugin vendor asking that they confirm the inbox for handling the discussion.

**May 31, 2023** – The vendor confirms the inbox for handling the discussion.

**May 31, 2023** – We send over the full disclosure details. The vendor acknowledges the report and begins working on a fix.

**June 6, 2023** – A fully patched version of the plugin, 5.15.0, is released.

**June 7, 2023** – Wordfence Premium, Care, and Response users receive a firewall rule to provide protection against any exploits that may target this vulnerability. Please note we delayed the firewall rule to prevent completely breaking the plugin’s core functionality.

**June 13, 2023** – A fully patched version of the plugin, 5.15.1, is released.

**July 7, 2023** – Wordfence Free users receive the same protection.

## Conclusion

In this blog post, we have detailed an Authentication Bypass vulnerability within the [Abandoned Cart Lite for WooCommerce plugin](https://wordpress.org/plugins/woocommerce-abandoned-cart/) affecting versions 5.14.2 and earlier. This vulnerability allows threat actors to bypass authentication and gain access to the accounts of users who have abandoned their carts. The vulnerability has been fully addressed in version 5.15.1 of the plugin.

We encourage WordPress users to verify that their sites are updated to the latest patched version of Abandoned Cart Lite for WooCommerce.

[Wordfence Premium](https://www.wordfence.com/products/wordfence-premium/), [Wordfence Care](https://www.wordfence.com/products/wordfence-care/), and [Wordfence Response](https://www.wordfence.com/products/wordfence-response/) users received a firewall rule to protect against any exploits targeting this vulnerability on June 7, 2023. Sites still using the free version of Wordfence will receive the same protection on July 7, 2023.

If you know someone who uses this plugin on their site, we recommend sharing this advisory with them to ensure their site remains secure, as this vulnerability poses a significant risk.

*For security researchers looking to disclose vulnerabilities responsibly and obtain a CVE ID, you can [submit your findings to Wordfence Intelligence](https://www.wordfence.com/request-cve/) and potentially earn a spot on our [leaderboard](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/).*

Search

### Trust Your Site to the Leader in WordPress Security

Wordfence includes an endpoint firewall, malware scanner, robust login security features, live traffic views, and more. Discover why over 5 million WordPress sites put their trust in Wordfence.

[Protect Your Site](/products/pricing/)

**Did you enjoy this post? Share it!**

[*Facebook*](http://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.wordfence.com%2Fblog%2F2023%2F06%2Ftyche-softwares-addresses-authentication-bypass-vulnerability-in-abandoned-cart-lite-for-woocommerce-wordpress-plugin%2F)
[*Twitter*](https://twitter.com/share?url=https%3A%2F%2Fwww.wordfence.com%2Fblog%2F2023%2F06%2Ftyche-softwares-addresses-authentication-bypass-vulnerability-in-abandoned-cart-lite-for-woocommerce-wordpress-plugin%2F&text=Tyche%20Softwares%20Addresses%20Authentication%20Bypass%20Vulnerability%20in%20Abandoned%20Cart%20Lite%20for%20WooCommerce%20WordPress%20Plugin&via=wordfence)
[*LinkedIn*](https://www.linkedin.com/shareArticle?url=https%3A%2F%2Fwww.wordfence.com%2Fblog%2F2023%2F06%2Ftyche-softwares-addresses-authentication-bypass-vulnerability-in-abandoned-cart-lite-for-woocommerce-wordpress-plugin%2F)

## Comments

No Comments

### Breaking WordPress Security Research in your inbox as it happens.

![Example of a news story](/img/footer-news-example.jpg)

This site uses cookies in accordance with our [Privacy Policy](/privacy-policy).

Cookie Settings
Accept All

## Cookie Options

For additional information on how this site uses cookies, please review our [Privacy Policy](/privacy-policy). The cookies used by this site are classified into the following categories and can be configured below.

### Strictly Necessary

These Cookies are necessary for the Sites and Services to work properly. They include any essential authentication and authorization cookies for the Services.

\* Cookies of this category are necessary for the site to function and cannot be disabled.

### Performance/Analytical

These Cookies allow us to collect certain information about how you navigate the Sites or utilize the Services running on your device. They help us understand which areas you use and what we can do to improve them.

### Targeting

These Cookies are used to deliver relevant information related to the Services to an identified machine or other device (not a named or otherwise identifiable person) which has previously been used to visit our Sites. Some of these types of Cookies on our Sites are operated by third parties with our permission and are used to identify advertising sources that are effectively driving customers to our Sites.

Cancel
Save



=== Content from github.com_de44f01e_20250115_113314.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-54x7-q6m6-mjqv)

**CVE-2023-2986**

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-54x7-q6m6-mjqv)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2Fadvisories%2F%3Cid%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

1. [GitHub Advisory Database](/advisories)
2. [Unreviewed](/advisories?query=type%3Aunreviewed)
3. [CVE-2023-2986](/advisories/GHSA-54x7-q6m6-mjqv)

## The Abandoned Cart Lite for WooCommerce plugin for...

Critical severity

Unreviewed

Published
Jun 8, 2023
to the GitHub Advisory Database
•
Updated Apr 4, 2024

## Package

No package listed—
[Suggest a package](/advisories/GHSA-54x7-q6m6-mjqv/improve)

## Affected versions

Unknown

## Patched versions

Unknown

## Description

The Abandoned Cart Lite for WooCommerce plugin for WordPress is vulnerable to authentication bypass in versions up to, and including, 5.14.2. This is due to insufficient encryption on the user being supplied during the abandoned cart link decode through the plugin. This allows unauthenticated attackers to log in as users who have abandoned the cart, which users are typically customers.

### References

* <https://nvd.nist.gov/vuln/detail/CVE-2023-2986>
* <https://plugins.trac.wordpress.org/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php#L1815>
* <https://plugins.trac.wordpress.org/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2916178#L1800>
* <https://www.wordfence.com/threat-intel/vulnerabilities/id/68052614-204f-4237-af0e-4b8210ebd59f?source=cve>
* <http://packetstormsecurity.com/files/172966/WordPress-Abandoned-Cart-Lite-For-WooCommerce-5.14.2-Authentication-Bypass.html>
* <http://packetstormsecurity.com/files/173018/WordPress-Abandoned-Cart-Lite-For-WooCommerce-5.14.2-Authentication-Bypass.html>
* [TycheSoftwares/woocommerce-abandoned-cart#885 (comment)](https://github.com/TycheSoftwares/woocommerce-abandoned-cart/pull/885#issuecomment-1601813615)
* <https://github.com/Ayantaker/CVE-2023-2986>
* <https://plugins.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&old=2925274%40woocommerce-abandoned-cart&new=2925274%40woocommerce-abandoned-cart&sfp_email=&sfph_mail=>
* <https://plugins.trac.wordpress.org/changeset/2922242>
* <https://www.wordfence.com/blog/2023/06/tyche-softwares-addresses-authentication-bypass-vulnerability-in-abandoned-cart-lite-for-woocommerce-wordpress-plugin>

Published by the [National Vulnerability Database](https://nvd.nist.gov/vuln/detail/CVE-2023-2986)
Jun 8, 2023

Published to the GitHub Advisory Database
Jun 8, 2023

Last updated
Apr 4, 2024

### Severity

Critical

9.8

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
High

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H

### [EPSS score](https://www.first.org/epss/user-guide)

0.048%
 (20th percentile)

### Weaknesses

[CWE-288](/advisories?query=cwe%3A288)

### CVE ID

CVE-2023-2986

### GHSA ID

GHSA-54x7-q6m6-mjqv

### Source code

No known source code

Dependabot alerts are not supported on this advisory because it does not have a package from a supported ecosystem with an affected and fixed version.

[Learn more about GitHub language support](https://docs.github.com/get-started/learning-about-github/github-language-support#about-supported-languages)

 Loading

Checking history

See something to contribute?
[Suggest improvements for this vulnerability](/advisories/GHSA-54x7-q6m6-mjqv/improve).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from plugins.trac.wordpress.org_aa033f12_20250114_185348.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fwoocommerce-abandoned-cart%2Ftrunk%2Fwoocommerce-ac.php%3Frev%3D2916178)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2888174 "Revision 2888174")
* [Latest Revision](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php)
* [Next Revision](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2922242 "Revision 2922242") →
* [Blame](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?annotate=blame&rev=2916178 "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2916178)

---

# [source:](/browser?rev=2916178&order=name "Go to repository root") [woocommerce-abandoned-cart](/browser/woocommerce-abandoned-cart?rev=2916178&order=name "View woocommerce-abandoned-cart")/[trunk](/browser/woocommerce-abandoned-cart/trunk?rev=2916178&order=name "View trunk")/[woocommerce-ac.php](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2916178&order=name "View woocommerce-ac.php") @ [2916178](/changeset/2916178/ "View changeset 2916178")

View diff against:

View revision:

| [Last change](/changeset/2916178/woocommerce-abandoned-cart/trunk/woocommerce-ac.php "View differences") on this file since 2916178 was [2916178](/changeset/2916178/ "View changeset 2916178"), checked in by tychesoftwares, [20 months ago](/timeline?from=2023-05-23T06%3A55%3A09Z&precision=second "See timeline at 05/23/2023 06:55:09 AM") |
| --- |
| Update to version 5.14.2 from GitHub |
| **File size:** 187.4 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* Plugin Name: Abandoned Cart Lite for WooCommerce |
| [4](#L4) | \* Plugin URI: http://www.tychesoftwares.com/store/premium-plugins/woocommerce-abandoned-cart-pro |
| [5](#L5) | \* Description: This plugin captures abandoned carts by logged-in users & emails them about it. <strong><a href="http://www.tychesoftwares.com/store/premium-plugins/woocommerce-abandoned-cart-pro">Click here to get the PRO Version.</a></strong> |
| [6](#L6) | \* Version: 5.14.2 |
| [7](#L7) | \* Author: Tyche Softwares |
| [8](#L8) | \* Author URI: http://www.tychesoftwares.com/ |
| [9](#L9) | \* Text Domain: woocommerce-abandoned-cart |
| [10](#L10) | \* Domain Path: /i18n/languages/ |
| [11](#L11) | \* Requires PHP: 5.6 |
| [12](#L12) | \* WC requires at least: 4.0.0 |
| [13](#L13) | \* WC tested up to: 7.7 |
| [14](#L14) | \* |
| [15](#L15) | \* @package Abandoned-Cart-Lite-for-WooCommerce |
| [16](#L16) | \*/ |
| [17](#L17) |  |
| [18](#L18) | require\_once 'class-wcal-update.php'; |
| [19](#L19) | require\_once 'includes/class-wcal-guest-ac.php'; |
| [20](#L20) | require\_once 'includes/class-wcal-default-template-settings.php'; |
| [21](#L21) | require\_once 'includes/class-wcal-delete-handler.php'; |
| [22](#L22) | require\_once 'includes/classes/class-wcal-aes.php'; |
| [23](#L23) | require\_once 'includes/classes/class-wcal-aes-counter.php'; |
| [24](#L24) | require\_once 'includes/class-wcal-common.php'; |
| [25](#L25) |  |
| [26](#L26) | require\_once 'includes/class-wcal-admin-notice.php'; |
| [27](#L27) | require\_once 'includes/class-wcal-tracking-msg.php'; |
| [28](#L28) | require\_once 'includes/admin/class-wcal-personal-data-eraser.php'; |
| [29](#L29) | require\_once 'includes/admin/class-wcal-personal-data-export.php'; |
| [30](#L30) | require\_once 'includes/admin/class-wcal-abandoned-cart-details.php'; |
| [31](#L31) |  |
| [32](#L32) | require\_once 'includes/admin/class-wcap-pro-settings.php'; |
| [33](#L33) | require\_once 'includes/admin/class-wcap-pro-settings-callbacks.php'; |
| [34](#L34) | require\_once 'includes/admin/class-wcap-add-cart-popup-modal.php'; |
| [35](#L35) | require\_once 'includes/connectors/class-wcap-connectors-common.php'; |
| [36](#L36) | require\_once 'includes/connectors/class-wcap-connector.php'; |
| [37](#L37) | require\_once 'includes/connectors/class-wcap-display-connectors.php'; |
| [38](#L38) | require\_once 'includes/class-wcap-integrations.php'; |
| [39](#L39) | require\_once 'includes/wcal-functions.php'; |
| [40](#L40) | require\_once 'includes/class-wcal-webhooks.php'; |
| [41](#L41) |  |
| [42](#L42) | load\_plugin\_textdomain( 'woocommerce-abandoned-cart', false, basename( dirname( \_\_FILE\_\_ ) ) . '/i18n/languages' ); |
| [43](#L43) |  |
| [44](#L44) | /\*\* |
| [45](#L45) | \* Schedule an action to delete old carts once a day |
| [46](#L46) | \* |
| [47](#L47) | \* @since 5.1 |
| [48](#L48) | \* @package Abandoned-Cart-Lite-for-WooCommerce/Cron |
| [49](#L49) | \*/ |
| [50](#L50) | if ( ! wp\_next\_scheduled( 'wcal\_clear\_carts' ) ) { |
| [51](#L51) | wp\_schedule\_event( time(), 'daily', 'wcal\_clear\_carts' ); |
| [52](#L52) | } |
| [53](#L53) |  |
| [54](#L54) | /\*\* |
| [55](#L55) | \* Main class |
| [56](#L56) | \*/ |
| [57](#L57) | if ( ! class\_exists( 'woocommerce\_abandon\_cart\_lite' ) ) { |
| [58](#L58) |  |
| [59](#L59) |  |
| [60](#L60) | /\*\* |
| [61](#L61) | \* It will add the hooks, filters, menu and the variables and all the necessary actions for the plguins which will be used |
| [62](#L62) | \* all over the plugin. |
| [63](#L63) | \* |
| [64](#L64) | \* @since 1.0 |
| [65](#L65) | \* @package Abandoned-Cart-Lite-for-WooCommerce/Core |
| [66](#L66) | \*/ |
| [67](#L67) | class woocommerce\_abandon\_cart\_lite { |
| [68](#L68) | /\*\* |
| [69](#L69) | \* Duration One hour. |
| [70](#L70) | \* |
| [71](#L71) | \* @var int |
| [72](#L72) | \*/ |
| [73](#L73) | public $one\_hour; |
| [74](#L74) | /\*\* |
| [75](#L75) | \* Duration three hours. |
| [76](#L76) | \* |
| [77](#L77) | \* @var int |
| [78](#L78) | \*/ |
| [79](#L79) | public $three\_hours; |
| [80](#L80) | /\*\* |
| [81](#L81) | \* Duration six hours. |
| [82](#L82) | \* |
| [83](#L83) | \* @var int |
| [84](#L84) | \*/ |
| [85](#L85) | public $six\_hours; |
| [86](#L86) | /\*\* |
| [87](#L87) | \* Duration 12 hours. |
| [88](#L88) | \* |
| [89](#L89) | \* @var int |
| [90](#L90) | \*/ |
| [91](#L91) | public $twelve\_hours; |
| [92](#L92) | /\*\* |
| [93](#L93) | \* Duration One day. |
| [94](#L94) | \* |
| [95](#L95) | \* @var int |
| [96](#L96) | \*/ |
| [97](#L97) | public $one\_day; |
| [98](#L98) | /\*\* |
| [99](#L99) | \* Duration One week. |
| [100](#L100) | \* |
| [101](#L101) | \* @var int |
| [102](#L102) | \*/ |
| [103](#L103) | public $one\_week; |
| [104](#L104) | /\*\* |
| [105](#L105) | \* Duration range select |
| [106](#L106) | \* |
| [107](#L107) | \* @var array |
| [108](#L108) | \*/ |
| [109](#L109) | public $duration\_range\_select; |
| [110](#L110) | /\*\* |
| [111](#L111) | \* Duration start & end dates |
| [112](#L112) | \* |
| [113](#L113) | \* @var array |
| [114](#L114) | \*/ |
| [115](#L115) | public $start\_end\_dates; |
| [116](#L116) | /\*\* |
| [117](#L117) | \* The constructor will add the hooks, filters and the variable which will be used all over the plugin. |
| [118](#L118) | \* |
| [119](#L119) | \* @since 1.0 |
| [120](#L120) | \*/ |
| [121](#L121) | public function \_\_construct() { |
| [122](#L122) | if ( ! defined( 'WCAL\_PLUGIN\_URL' ) ) { |
| [123](#L123) | define( 'WCAL\_PLUGIN\_URL', untrailingslashit( plugins\_url( '/', \_\_FILE\_\_ ) ) ); |
| [124](#L124) | } |
| [125](#L125) |  |
| [126](#L126) | if ( ! defined( 'WCAL\_PLUGIN\_VERSION' ) ) { |
| [127](#L127) | define( 'WCAL\_PLUGIN\_VERSION', '5.14.2' ); |
| [128](#L128) | } |
| [129](#L129) |  |
| [130](#L130) | if ( ! defined( 'WCAL\_PLUGIN\_PATH' ) ) { |
| [131](#L131) | define( 'WCAL\_PLUGIN\_PATH', untrailingslashit( plugin\_dir\_path( \_\_FILE\_\_ ) ) ); |
| [132](#L132) | } |
| [133](#L133) | $this->one\_hour              = 60 \* 60; |
| [134](#L134) | $this->three\_hours           = 3 \* $this->one\_hour; |
| [135](#L135) | $this->six\_hours             = 6 \* $this->one\_hour; |
| [136](#L136) | $this->twelve\_hours          = 12 \* $this->one\_hour; |
| [137](#L137) | $this->one\_day               = 24 \* $this->one\_hour; |
| [138](#L138) | $this->one\_week              = 7 \* $this->one\_day; |
| [139](#L139) | $this->duration\_range\_select = array( |
| [140](#L140) | 'yesterday'      => 'Yesterday', |
| [141](#L141) | 'today'          => 'Today', |
| [142](#L142) | 'last\_seven'     => 'Last 7 days', |
| [143](#L143) | 'last\_fifteen'   => 'Last 15 days', |
| [144](#L144) | 'last\_thirty'    => 'Last 30 days', |
| [145](#L145) | 'last\_ninety'    => 'Last 90 days', |
| [146](#L146) | 'last\_year\_days' => 'Last 365', |
| [147](#L147) | ); |
| [148](#L148) |  |
| [149](#L149) | $this->start\_end\_dates = array( |
| [150](#L150) | 'yesterday'      => array( |
| [151](#L151) | 'start\_date' => date( 'd M Y', ( current\_time( 'timestamp' ) - 24 \* 60 \* 60 ) ), // phpcs:ignore |
| [152](#L152) | 'end\_date'   => date( 'd M Y', ( current\_time( 'timestamp' ) - 7 \* 24 \* 60 \* 60 ) ), // phpcs:ignore |
| [153](#L153) | ), |
| [154](#L154) | 'today'          => array( |
| [155](#L155) | 'start\_date' => date( 'd M Y', ( current\_time( 'timestamp' ) ) ), // phpcs:ignore |
| [156](#L156) | 'end\_date'   => date( 'd M Y', ( current\_time( 'timestamp' ) ) ), // phpcs:ignore |
| [157](#L157) | ), |
| [158](#L158) | 'last\_seven'     => array( |
| [159](#L159) | 'start\_date' => date( 'd M Y', ( current\_time( 'timestamp' ) - 7 \* 24 \* 60 \* 60 ) ), // phpcs:ignore |
| [160](#L160) | 'end\_date'   => date( 'd M Y', ( current\_time( 'timestamp' ) ) ), // phpcs:ignore |
| [161](#L161) | ), |
| [162](#L162) | 'last\_fifteen'   => array( |
| [163](#L163) | 'start\_date' => date( 'd M Y', ( current\_time( 'timestamp' ) - 15 \* 24 \* 60 \* 60 ) ), // phpcs:ignore |
| [164](#L164) | 'end\_date'   => date( 'd M Y', ( current\_time( 'timestamp' ) ) ), // phpcs:ignore |
| [165](#L165) | ), |
| [166](#L166) | 'last\_thirty'    => array( |
| [167](#L167) | 'start\_date' => date( 'd M Y', ( current\_time( 'timestamp' ) - 30 \* 24 \* 60 \* 60 ) ), // phpcs:ignore |
| [168](#L168) | 'end\_date'   => date( 'd M Y', ( current\_time( 'timestamp' ) ) ), // phpcs:ignore |
| [169](#L169) | ), |
| [170](#L170) | 'last\_ninety'    => array( |
| [171](#L171) | 'start\_date' => date( 'd M Y', ( current\_time( 'timestamp' ) - 90 \* 24 \* 60 \* 60 ) ), // phpcs:ignore |
| [172](#L172) | 'end\_date'   => date( 'd M Y', ( current\_time( 'timestamp' ) ) ), // phpcs:ignore |
| [173](#L173) | ), |
| [174](#L174) | 'last\_year\_days' => array( |
| [175](#L175) | 'start\_date' => date( 'd M Y', ( current\_time( 'timestamp' ) - 365 \* 24 \* 60 \* 60 ) ), // phpcs:ignore |
| [176](#L176) | 'end\_date'   => date( 'd M Y', ( current\_time( 'timestamp' ) ) ), // phpcs:ignore |
| [177](#L177) | ), |
| [178](#L178) | ); |
| [179](#L179) |  |
| [180](#L180) | // Initialize settings. |
| [181](#L181) | register\_activation\_hook( \_\_FILE\_\_, array( &$this, 'wcal\_activate' ) ); |
| [182](#L182) | register\_deactivation\_hook( \_\_FILE\_\_, array( &$this, 'wcal\_deactivate' ) ); |
| [183](#L183) |  |
| [184](#L184) | // Action Scheduler for Cron. |
| [185](#L185) | if ( file\_exists( WP\_PLUGIN\_DIR . '/woocommerce/packages/action-scheduler/action-scheduler.php' ) ) { |
| [186](#L186) | require\_once WP\_PLUGIN\_DIR . '/woocommerce/packages/action-scheduler/action-scheduler.php'; |
| [187](#L187) | } else { |
| [188](#L188) | add\_action( 'admin\_notices', array( &$this, 'wcal\_as\_failed\_notice' ) ); |
| [189](#L189) | } |
| [190](#L190) | add\_action( 'init', array( &$this, 'wcal\_add\_scheduled\_action' ) ); |
| [191](#L191) | require\_once 'cron/class-wcal-cron.php'; |
| [192](#L192) | require\_once 'includes/class-wcal-process-base.php'; |
| [193](#L193) |  |
| [194](#L194) | // WordPress Administration Menu. |
| [195](#L195) | add\_action( 'admin\_menu', array( &$this, 'wcal\_admin\_menu' ) ); |
| [196](#L196) |  |
| [197](#L197) | // Actions to be done on cart update. |
| [198](#L198) | add\_action( 'woocommerce\_add\_to\_cart', array( &$this, 'wcal\_store\_cart\_timestamp' ), PHP\_INT\_MAX ); |
| [199](#L199) | add\_action( 'woocommerce\_cart\_item\_removed', array( &$this, 'wcal\_store\_cart\_timestamp' ), PHP\_INT\_MAX ); |
| [200](#L200) | add\_action( 'woocommerce\_cart\_item\_restored', array( &$this, 'wcal\_store\_cart\_timestamp' ), PHP\_INT\_MAX ); |
| [201](#L201) | add\_action( 'woocommerce\_after\_cart\_item\_quantity\_update', array( &$this, 'wcal\_store\_cart\_timestamp' ), PHP\_INT\_MAX ); |
| [202](#L202) | add\_action( 'woocommerce\_calculate\_totals', array( &$this, 'wcal\_store\_cart\_timestamp' ), PHP\_INT\_MAX ); |
| [203](#L203) |  |
| [204](#L204) | add\_filter( 'wcal\_block\_crawlers', array( &$this, 'wcal\_detect\_crawlers' ), 10, 1 ); |
| [205](#L205) |  |
| [206](#L206) | add\_action( 'admin\_init', array( &$this, 'wcal\_action\_admin\_init' ) ); |
| [207](#L207) |  |
| [208](#L208) | // Update the options as per settings API. |
| [209](#L209) | add\_action( 'admin\_init', array( 'Wcal\_Update', 'wcal\_schedule\_update\_action' ) ); |
| [210](#L210) | add\_action( 'wcal\_update\_db', array( 'Wcal\_Update', 'wcal\_update\_db\_check' ) ); |
| [211](#L211) |  |
| [212](#L212) | // WordPress settings API. |
| [213](#L213) | add\_action( 'admin\_init', array( &$this, 'wcal\_initialize\_plugin\_options' ) ); |
| [214](#L214) |  |
| [215](#L215) | // Language Translation. |
| [216](#L216) | add\_action( 'init', array( &$this, 'wcal\_update\_po\_file' ) ); |
| [217](#L217) |  |
| [218](#L218) | add\_action( 'init', array( &$this, 'wcal\_add\_component\_file' ) ); |
| [219](#L219) |  |
| [220](#L220) | // track links. |
| [221](#L221) | add\_filter( 'template\_include', array( &$this, 'wcal\_email\_track\_links' ), 99, 1 ); |
| [222](#L222) |  |
| [223](#L223) | // It will used to unsubcribe the emails. |
| [224](#L224) | add\_action( 'template\_include', array( &$this, 'wcal\_email\_unsubscribe' ), 99, 1 ); |
| [225](#L225) |  |
| [226](#L226) | add\_action( 'admin\_enqueue\_scripts', array( &$this, 'wcal\_enqueue\_scripts\_js' ) ); |
| [227](#L227) | add\_action( 'admin\_enqueue\_scripts', array( &$this, 'wcal\_enqueue\_scripts\_css' ) ); |
| [228](#L228) | // delete abandoned order after X number of days. |
| [229](#L229) | if ( class\_exists( 'Wcal\_Delete\_Handler' ) ) { |
| [230](#L230) | add\_action( 'wcal\_clear\_carts', array( 'Wcal\_Delete\_Handler', 'wcal\_delete\_abandoned\_carts\_after\_x\_days' ) ); |
| [231](#L231) | } |
| [232](#L232) |  |
| [233](#L233) | if ( is\_admin() ) { |
| [234](#L234) | // Load "admin-only" scripts here. |
| [235](#L235) | add\_action( 'admin\_head', array( &$this, 'wcal\_action\_send\_preview' ) ); |
| [236](#L236) | add\_action( 'wp\_ajax\_wcal\_preview\_email\_sent', array( &$this, 'wcal\_preview\_email\_sent' ) ); |
| [237](#L237) | add\_action( 'wp\_ajax\_wcal\_toggle\_template\_status', array( &$this, 'wcal\_toggle\_template\_status' ) ); |
| [238](#L238) | add\_action( 'wp\_ajax\_wcal\_abandoned\_cart\_info', array( &$this, 'wcal\_abandoned\_cart\_info' ) ); |
| [239](#L239) | add\_action( 'wp\_ajax\_wcal\_dismiss\_admin\_notice', array( &$this, 'wcal\_dismiss\_admin\_notice' ) ); |
| [240](#L240) |  |
| [241](#L241) | add\_filter( 'ts\_tracker\_data', array( 'wcal\_common', 'ts\_add\_plugin\_tracking\_data' ), 10, 1 ); |
| [242](#L242) | add\_filter( 'ts\_tracker\_opt\_out\_data', array( 'wcal\_common', 'ts\_get\_data\_for\_opt\_out' ), 10, 1 ); |
| [243](#L243) | add\_filter( 'ts\_deativate\_plugin\_questions', array( &$this, 'wcal\_deactivate\_add\_questions' ), 10, 1 ); |
| [244](#L244) |  |
| [245](#L245) | add\_action( 'wp\_ajax\_wcal\_json\_find\_coupons', array( &$this, 'wcal\_json\_find\_coupons' ) ); |
| [246](#L246) | } |
| [247](#L247) |  |
| [248](#L248) | // Plugin Settings link in WP->Plugins page. |
| [249](#L249) | $plugin = plugin\_basename( \_\_FILE\_\_ ); |
| [250](#L250) | add\_action( "plugin\_action\_links\_$plugin", array( &$this, 'wcal\_settings\_link' ) ); |
| [251](#L251) |  |
| [252](#L252) | add\_action( 'admin\_init', array( $this, 'wcal\_preview\_emails' ) ); |
| [253](#L253) | add\_action( 'init', array( $this, 'wcal\_app\_output\_buffer' ) ); |
| [254](#L254) |  |
| [255](#L255) | add\_filter( 'admin\_footer\_text', array( $this, 'wcal\_admin\_footer\_text' ), 1 ); |
| [256](#L256) |  |
| [257](#L257) | add\_action( 'admin\_notices', array( 'Wcal\_Admin\_Notice', 'wcal\_show\_db\_update\_notice' ) ); |
| [258](#L258) |  |
| [259](#L259) | include\_once 'includes/frontend/class-wcal-frontend.php'; |
| [260](#L260) |  |
| [261](#L261) | add\_filter( 'cron\_schedules', array( \_\_CLASS\_\_, 'wcal\_add\_cron\_schedule' ) ); //phpcs:ignore |
| [262](#L262) | add\_action( 'woocommerce\_ac\_delete\_coupon\_action', array( \_\_CLASS\_\_, 'wcal\_delete\_expired\_used\_coupon\_code' ) ); |
| [263](#L263) | add\_action( 'wp\_ajax\_wcal\_delete\_expired\_used\_coupon\_code', array( \_\_CLASS\_\_, 'wcal\_delete\_expired\_used\_coupon\_code' ) ); |
| [264](#L264) |  |
| [265](#L265) | add\_action( 'woocommerce\_coupon\_error', array( 'wcal\_common', 'wcal\_capture\_coupon\_error' ), 15, 2 ); |
| [266](#L266) | add\_action( 'woocommerce\_applied\_coupon', array( 'wcal\_common', 'wcal\_capture\_applied\_coupon' ), 15, 2 ); |
| [267](#L267) |  |
| [268](#L268) | add\_action( 'woocommerce\_before\_cart\_table', array( 'wcal\_common', 'wcal\_apply\_direct\_coupon\_code' ) ); |
| [269](#L269) | // Add coupon when user views checkout page (would not be added otherwise, unless user views cart first). |
| [270](#L270) | add\_action( 'woocommerce\_before\_checkout\_form', array( 'wcal\_common', 'wcal\_apply\_direct\_coupon\_code' ) ); |
| [271](#L271) | add\_filter( 'woocommerce\_email\_from\_address', array( \_\_CLASS\_\_, 'wcal\_from\_address\_for\_emails' ), 10, 3 ); |
| [272](#L272) | add\_filter( 'woocommerce\_email\_from\_name', array( \_\_CLASS\_\_, 'wcal\_from\_name\_for\_emails' ), 10, 3 ); |
| [273](#L273) | // 5.14.0 |
| [274](#L274) | if ( 'yes' === get\_option( 'wcal\_guest\_users\_manual\_reset\_needed', '' ) ) { |
| [275](#L275) | add\_action( 'admin\_notices', array( 'Wcal\_Update', 'wcal\_add\_notice' ) ); |
| [276](#L276) | } |
| [277](#L277) | } |
| [278](#L278) |  |
| [279](#L279) | /\*\* |
| [280](#L280) | \* Action Scheduler library load failed. So add an admin notice. |
| [281](#L281) | \* |
| [282](#L282) | \* @since 5.9.0 |
| [283](#L283) | \*/ |
| [284](#L284) | public static function wcal\_as\_failed\_notice() { |
| [285](#L285) | $as\_link = "<a href='https://www.tychesoftwares.com/moving-to-the-action-scheduler-library/' target='\_blank'>Action Scheduler library</a>"; |
| [286](#L286) | ?> |
| [287](#L287) | <div class="notice notice-error"> |
| [288](#L288) | <p> |
| [289](#L289) | <?php |
| [290](#L290) | echo wp\_kses\_post( \_\_( "Abandoned Cart Lite for WooCommerce was unable to load the $as\_link. Please ensure you are running WooCommerce 4.0.0 or higher to send automated reminder emails. Currrently no automated reminder emails are being sent for abandoned carts.", 'woocommerce-abandoned-cart' ) ); // phpcs:ignore |
| [291](#L291) | ?> |
| [292](#L292) | </p> |
| [293](#L293) | </div> |
| [294](#L294) | <?php |
| [295](#L295) | } |
| [296](#L296) |  |
| [297](#L297) | /\*\* |
| [298](#L298) | \* Add Recurring Scheduled Action. |
| [299](#L299) | \*/ |
| [300](#L300) | public static function wcal\_add\_scheduled\_action() { |
| [301](#L301) | if ( function\_exists( 'as\_next\_scheduled\_action' ) ) { |
| [302](#L302) | if ( false === as\_next\_scheduled\_action( 'woocommerce\_ac\_send\_email\_action' ) ) { |
| [303](#L303) | wp\_clear\_scheduled\_hook( 'woocommerce\_ac\_send\_email\_action' ); // Remove the cron job is present. |
| [304](#L304) | as\_schedule\_recurring\_action( time() + 60, 900, 'woocommerce\_ac\_send\_email\_action' ); // Schedule recurring action. |
| [305](#L305) | } |
| [306](#L306) | } |
| [307](#L307) | } |
| [308](#L308) |  |
| [309](#L309) | /\*\* |
| [310](#L310) | \* Add Settings link to WP->Plugins page. |
| [311](#L311) | \* |
| [312](#L312) | \* @param array $links - Links to be displayed. |
| [313](#L313) | \* @return array $links - Includes custom links. |
| [314](#L314) | \* @since 5.3.0 |
| [315](#L315) | \*/ |
| [316](#L316) | public static function wcal\_settings\_link( $links ) { |
| [317](#L317) | $settings\_link = '<a href="admin.php?page=woocommerce\_ac\_page&action=emailsettings">' . \_\_( 'Settings', 'woocommerce-abandoned-cart' ) . '</a>'; |
| [318](#L318) | array\_push( $links, $settings\_link ); |
| [319](#L319) | return $links; |
| [320](#L320) | } |
| [321](#L321) |  |
| [322](#L322) | /\*\* |
| [323](#L323) | \* It will load the boilerplate components file. In this file we have included all boilerplate files. |
| [324](#L324) | \* We need to inlcude this file after the init hook. |
| [325](#L325) | \* |
| [326](#L326) | \* @hook init |
| [327](#L327) | \*/ |
| [328](#L328) | public static function wcal\_add\_component\_file() { |
| [329](#L329) | if ( is\_admin() ) { |
| [330](#L330) | require\_once 'includes/class-wcal-all-component.php'; |
| [331](#L331) |  |
| [332](#L332) | } |
| [333](#L333) | } |
| [334](#L334) | /\*\* |
| [335](#L335) | \* It will add the Questions while admin deactivate the plugin. |
| [336](#L336) | \* |
| [337](#L337) | \* @hook ts\_deativate\_plugin\_questions. |
| [338](#L338) | \* @param array $wcal\_add\_questions Blank array. |
| [339](#L339) | \* @return array $wcal\_add\_questions List of all questions. |
| [340](#L340) | \*/ |
| [341](#L341) | public static function wcal\_deactivate\_add\_questions( $wcal\_add\_questions ) { |
| [342](#L342) |  |
| [343](#L343) | $wcal\_add\_questions = array( |
| [344](#L344) | 0 => array( |
| [345](#L345) | 'id'                => 4, |
| [346](#L346) | 'text'              => \_\_( 'Emails are not being sent to customers.', 'woocommerce-abandoned-cart' ), |
| [347](#L347) | 'input\_type'        => '', |
| [348](#L348) | 'input\_placeholder' => '', |
| [349](#L349) | ), |
| [350](#L350) | 1 => array( |
| [351](#L351) | 'id'                => 5, |
| [352](#L352) | 'text'              => \_\_( 'Capturing of cart and other information was not satisfactory.', 'woocommerce-abandoned-cart' ), |
| [353](#L353) | 'input\_type'        => '', |
| [354](#L354) | 'input\_placeholder' => '', |
| [355](#L355) | ), |
| [356](#L356) | 2 => array( |
| [357](#L357) | 'id'                => 6, |
| [358](#L358) | 'text'              => \_\_( 'I cannot see abandoned cart reminder emails records.', 'woocommerce-abandoned-cart' ), |
| [359](#L359) | 'input\_type'        => '', |
| [360](#L360) | 'input\_placeholder' => '', |
| [361](#L361) | ), |
| [362](#L362) | 3 => array( |
| [363](#L363) | 'id'                => 7, |
| [364](#L364) | 'text'              => \_\_( 'I want to upgrade the plugin to the PRO version.', 'woocommerce-abandoned-cart' ), |
| [365](#L365) | 'input\_type'        => '', |
| [366](#L366) | 'input\_placeholder' => '', |
| [367](#L367) | ), |
| [368](#L368) |  |
| [369](#L369) | ); |
| [370](#L370) | return $wcal\_add\_questions; |
| [371](#L371) | } |
| [372](#L372) |  |
| [373](#L373) | /\*\* |
| [374](#L374) | \* Replace Merge tags in email previews. |
| [375](#L375) | \* |
| [376](#L376) | \* @param string $content - Email content. |
| [377](#L377) | \* @return string $content - content with cart data. |
| [378](#L378) | \* @since 5.8 |
| [379](#L379) | \*/ |
| [380](#L380) | public function replace\_mergetags( $content ) { |
| [381](#L381) |  |
| [382](#L382) | $admin\_args = array( |
| [383](#L383) | 'role'   => 'administrator', |
| [384](#L384) | 'fields' => array( 'id' ), |
| [385](#L385) | ); |
| [386](#L386) |  |
| [387](#L387) | $admin\_usr   = get\_users( $admin\_args ); |
| [388](#L388) | $uid         = $admin\_usr[0]->id; |
| [389](#L389) | $admin\_phone = get\_user\_meta( $uid, 'billing\_phone', true ); |
| [390](#L390) |  |
| [391](#L391) | $wcal\_price       = wc\_price( '150' ); |
| [392](#L392) | $wcal\_total\_price = wc\_price( '300' ); |
| [393](#L393) |  |
| [394](#L394) | $allowed\_html                  = array( |
| [395](#L395) | 'span' => array( |
| [396](#L396) | 'class' => array(), |
| [397](#L397) | ), |
| [398](#L398) | ); |
| [399](#L399) | $spectre\_img\_src               = esc\_url( plugins\_url( '/assets/images/spectre.jpg', \_\_FILE\_\_ ) ); |
| [400](#L400) | $replace\_data['products\_cart'] = "<table border='0' width='100%' cellspacing='0' cellpadding='0'><b>Your Shopping Cart</b> |
| [401](#L401) | <tbody> |
| [402](#L402) | <tr> |
| [403](#L403) | <td style='background-color: #666666; color: #ffffff; text-align: center; font-size: 13px; text-transform: uppercase; padding: 5px;' align='center' bgcolor='#666666'></td> |
| [404](#L404) |  |
| [405](#L405) | <td style='background-color: #666666; color: #ffffff; text-align: center; font-size: 13px; text-transform: uppercase; padding: 5px;' align='center' bgcolor='#666666'>Product</td> |
| [406](#L406) |  |
| [407](#L407) | <td style='background-color: #666666; color: #ffffff; text-align: center; font-size: 13px; text-transform: uppercase; padding: 5px;' align='center' bgcolor='#666666'>Price</td> |
| [408](#L408) |  |
| [409](#L409) | <td style='background-color: #666666; color: #ffffff; text-align: center; font-size: 13px; text-transform: uppercase; padding: 5px;' align='center' bgcolor='#666666'>Quantity</td> |
| [410](#L410) |  |
| [411](#L411) | <td style='background-color: #666666; color: #ffffff; text-align: center; font-size: 13px; text-transform: uppercase; padding: 5px;' align='center' bgcolor='#666666'>Total</td> |
| [412](#L412) |  |
| [413](#L413) | </tr> |
| [414](#L414) | <tr style='background-color:#f4f5f4;'> |
| [415](#L415) | <td><img src = '$spectre\_img\_src' height='40px' width='40px'></td><td>Spectre</td><td>" . wp\_kses( $wcal\_price, $allowed\_html ) . '</td><td>2</td><td>' . wp\_kses( $wcal\_total\_price, $allowed\_html ) . '</td> |
| [416](#L416) | </tr> |
| [417](#L417) | <tr> |
| [418](#L418) | <td>&nbsp;</td> |
| [419](#L419) | <td>&nbsp;</td> |
| [420](#L420) | <td>&nbsp;</td> |
| [421](#L421) | <th>Cart Total:</th> |
| [422](#L422) | <td>' . wp\_kses( $wcal\_total\_price, $allowed\_html ) . '</td> |
| [423](#L423) | </tr> |
| [424](#L424) |  |
| [425](#L425) | </tbody> |
| [426](#L426) | </table>'; |
| [427](#L427) |  |
| [428](#L428) | $current\_time = current\_time( 'timestamp' ); // phpcs:ignore |
| [429](#L429) | $date\_format  = date\_i18n( get\_option( 'date\_format' ), $current\_time ); |
| [430](#L430) | $time\_format  = date\_i18n( get\_option( 'time\_format' ), $current\_time ); |
| [431](#L431) |  |
| [432](#L432) | $replace\_data['admin\_phone']    = $admin\_phone; |
| [433](#L433) | $replace\_data['site\_title']     = get\_bloginfo( 'name' ); |
| [434](#L434) | $replace\_data['site\_url']       = get\_option( 'siteurl' ); |
| [435](#L435) | $replace\_data['abandoned\_date'] = "$date\_format $time\_format"; |
| [436](#L436) | $replace\_data['cart\_url']       = wc\_get\_page\_permalink( 'cart' ); |
| [437](#L437) |  |
| [438](#L438) | $content = str\_ireplace( '{{products.cart}}', $replace\_data['products\_cart'], $content ); |
| [439](#L439) | $content = str\_ireplace( '{{admin.phone}}', $replace\_data['admin\_phone'], $content ); |
| [440](#L440) | $content = str\_ireplace( '{{customer.firstname}}', 'John', $content ); |
| [441](#L441) | $content = str\_ireplace( '{{customer.lastname}}', 'Doe', $content ); |
| [442](#L442) | $content = str\_ireplace( '{{customer.fullname}}', 'John Doe', $content ); |
| [443](#L443) | $content = str\_ireplace( '{{cart.abandoned\_date}}', $replace\_data['abandoned\_date'], $content ); |
| [444](#L444) | $content = str\_ireplace( '{{cart.link}}', $replace\_data['cart\_url'], $content ); |
| [445](#L445) | $content = str\_ireplace( '{{cart.unsubscribe}}', '#', $content ); |
| [446](#L446) | $content = str\_ireplace( 'site\_title', $replace\_data['site\_title'], $content ); |
| [447](#L447) | $content = str\_ireplace( 'site\_url', $replace\_data['site\_url'], $content ); |
| [448](#L448) |  |
| [449](#L449) | return $content; |
| [450](#L450) | } |
| [451](#L451) |  |
| [452](#L452) | /\*\* |
| [453](#L453) | \* It will ganerate the preview email template. |
| [454](#L454) | \* |
| [455](#L455) | \* @hook admin\_init |
| [456](#L456) | \* @globals mixed $woocommerce |
| [457](#L457) | \* @since 2.5 |
| [458](#L458) | \*/ |
| [459](#L459) | public function wcal\_preview\_emails() { |
| [460](#L460) | global $woocommerce; |
| [461](#L461) |  |
| [462](#L462) | if ( isset( $\_GET['id'] ) && 0 < sanitize\_text\_field( wp\_unslash( $\_GET['id'] ) ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [463](#L463) | global $wpdb; |
| [464](#L464) | $id      = sanitize\_text\_field( wp\_unslash( $\_GET['id'] ) ); // phpcs:ignore WordPress.Security.NonceVerification |
| [465](#L465) | $content = $wpdb->get\_var( // phpcs:ignore |
| [466](#L466) | $wpdb->prepare( |
| [467](#L467) | 'SELECT body FROM `' . $wpdb->prefix . 'ac\_email\_templates\_lite` WHERE id = %d', |
| [468](#L468) | absint( $id ) |
| [469](#L469) | ) |
| [470](#L470) | ); |
| [471](#L471) | $content = $this->replace\_mergetags( $content ); |
| [472](#L472) | } |
| [473](#L473) |  |
| [474](#L474) | if ( isset( $\_GET['wcal\_preview\_woocommerce\_mail'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [475](#L475) | if ( ! isset( $\_REQUEST['\_wpnonce'] ) || ! wp\_verify\_nonce( sanitize\_text\_field( wp\_unslash( $\_REQUEST['\_wpnonce'] ) ), 'woocommerce-abandoned-cart' ) ) { |
| [476](#L476) | die( 'Security check' ); |
| [477](#L477) | } |
| [478](#L478) | $message = ''; |
| [479](#L479) | // create a new email. |
| [480](#L480) | if ( $woocommerce->version < '2.3' ) { |
| [481](#L481) | global $email\_heading; |
| [482](#L482) | ob\_start(); |
| [483](#L483) |  |
| [484](#L484) | include 'views/wcal-wc-email-template-preview.php'; |
| [485](#L485) | $mailer        = WC()->mailer(); |
| [486](#L486) | $message       = ob\_get\_clean(); |
| [487](#L487) | $email\_heading = \_\_( 'HTML Email Template', 'woocommerce-abandoned-cart' ); |
| [488](#L488) | $message       = $mailer->wrap\_message( $email\_heading, $message ); |
| [489](#L489) | } else { |
| [490](#L490) | // load the mailer class. |
| [491](#L491) | $mailer = WC()->mailer(); |
| [492](#L492) | // get the preview email subject. |
| [493](#L493) | $email\_heading = \_\_( 'Abandoned cart Email Template', 'woocommerce-abandoned-cart' ); |
| [494](#L494) | // get the preview email content. |
| [495](#L495) | ob\_start(); |
| [496](#L496) | if ( isset( $\_GET['id'] ) && 0 < sanitize\_text\_field( wp\_unslash( $\_GET['id'] ) ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [497](#L497) | $message = stripslashes( $content ); |
| [498](#L498) | } else { |
| [499](#L499) | include 'views/wcal-wc-email-template-preview.php'; |
| [500](#L500) | $message = ob\_get\_clean(); |
| [501](#L501) | } |
| [502](#L502) | // create a new email. |
| [503](#L503) | $email = new WC\_Email(); |
| [504](#L504) | // wrap the content with the email template and then add styles. |
| [505](#L505) | $message = $email->style\_inline( $mailer->wrap\_message( $email\_heading, $message ) ); |
| [506](#L506) | } |
| [507](#L507) | echo $message; // phpcs:ignore |
| [508](#L508) | exit; |
| [509](#L509) | } |
| [510](#L510) |  |
| [511](#L511) | if ( isset( $\_GET['wcal\_preview\_mail'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [512](#L512) | if ( ! isset( $\_REQUEST['\_wpnonce'] ) || ! wp\_verify\_nonce( sanitize\_text\_field( wp\_unslash( $\_REQUEST['\_wpnonce'] ) ), 'woocommerce-abandoned-cart' ) ) { |
| [513](#L513) | die( 'Security check' ); |
| [514](#L514) | } |
| [515](#L515) | // get the preview email content. |
| [516](#L516) | ob\_start(); |
| [517](#L517) | if ( isset( $\_GET['id'] ) && 0 < sanitize\_text\_field( wp\_unslash( $\_GET['id'] ) ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [518](#L518) | $message = stripslashes( $content ); |
| [519](#L519) | } else { |
| [520](#L520) | include\_once 'views/wcal-email-template-preview.php'; |
| [521](#L521) | $message = ob\_get\_clean(); |
| [522](#L522) | } |
| [523](#L523) | // print the preview email. |
| [524](#L524) | echo $message; // phpcs:ignore |
| [525](#L525) | exit; |
| [526](#L526) | } |
| [527](#L527) | } |
| [528](#L528) |  |
| [529](#L529) | /\*\* |
| [530](#L530) | \* In this version we have allowed customer to transalte the plugin string using .po and .pot file. |
| [531](#L531) | \* |
| [532](#L532) | \* @hook init |
| [533](#L533) | \* @return $loaded |
| [534](#L534) | \* @since 1.6 |
| [535](#L535) | \*/ |
| [536](#L536) | public function wcal\_update\_po\_file() { |
| [537](#L537) | /\* |
| [538](#L538) | \* Due to the introduction of language packs through translate.wordpress.org, loading our textdomain is complex. |
| [539](#L539) | \* |
| [540](#L540) | \* In v4.7, our textdomain changed from "woocommerce-ac" to "woocommerce-abandoned-cart". |
| [541](#L541) | \*/ |
| [542](#L542) | $domain = 'woocommerce-abandoned-cart'; |
| [543](#L543) | $locale = apply\_filters( 'plugin\_locale', get\_locale(), $domain ); |
| [544](#L544) | $loaded = load\_textdomain( $domain, trailingslashit( WP\_LANG\_DIR ) . $domain . '-' . $locale . '.mo' ); |
| [545](#L545) | if ( $loaded ) { |
| [546](#L546) | return $loaded; |
| [547](#L547) | } else { |
| [548](#L548) | load\_plugin\_textdomain( $domain, false, basename( dirname( \_\_FILE\_\_ ) ) . '/i18n/languages/' ); |
| [549](#L549) | } |
| [550](#L550) | } |
| [551](#L551) |  |
| [552](#L552) | /\*\* |
| [553](#L553) | \* It will create the plugin tables & the options reqired for plugin. |
| [554](#L554) | \* |
| [555](#L555) | \* @hook register\_activation\_hook |
| [556](#L556) | \* @globals mixed $wpdb |
| [557](#L557) | \* @since 1.0 |
| [558](#L558) | \*/ |
| [559](#L559) | public static function wcal\_activate() { |
| [560](#L560) |  |
| [561](#L561) | // check whether its a multi site install or a single site install. |
| [562](#L562) | if ( is\_multisite() ) { |
| [563](#L563) |  |
| [564](#L564) | $blog\_list = get\_sites(); |
| [565](#L565) | foreach ( $blog\_list as $blog\_list\_key => $blog\_list\_value ) { |
| [566](#L566) | if ( $blog\_list\_value->blog\_id > 1 ) { // child sites. |
| [567](#L567) | $blog\_id = $blog\_list\_value->blog\_id; |
| [568](#L568) | self::wcal\_process\_activate( $blog\_id ); |
| [569](#L569) | add\_blog\_option( $blog\_id, 'wcal\_db\_version', WCAL\_PLUGIN\_VERSION ); |
| [570](#L570) | } else { // parent site. |
| [571](#L571) | self::wcal\_process\_activate(); |
| [572](#L572) | add\_blog\_option( 1, 'wcal\_db\_version', WCAL\_PLUGIN\_VERSION ); |
| [573](#L573) | } |
| [574](#L574) | } |
| [575](#L575) | } else { // single site. |
| [576](#L576) | self::wcal\_process\_activate(); |
| [577](#L577) | add\_option( 'wcal\_db\_version', WCAL\_PLUGIN\_VERSION ); |
| [578](#L578) | } |
| [579](#L579) | } |
| [580](#L580) |  |
| [581](#L581) | /\*\* |
| [582](#L582) | \* Things to do when the plugin is deactivated. |
| [583](#L583) | \* |
| [584](#L584) | \* @since 5.8.0 |
| [585](#L585) | \*/ |
| [586](#L586) | public static function wcal\_deactivate() { |
| [587](#L587) | if ( false !== as\_next\_scheduled\_action( 'woocommerce\_ac\_send\_email\_action' ) ) { |
| [588](#L588) | as\_unschedule\_action( 'woocommerce\_ac\_send\_email\_action' ); // Remove the scheduled action. |
| [589](#L589) | } |
| [590](#L590) | do\_action( 'wcal\_deactivate' ); |
| [591](#L591) | } |
| [592](#L592) |  |
| [593](#L593) | /\*\* |
| [594](#L594) | \* Activation code: Create tables, default settings etc. |
| [595](#L595) | \* |
| [596](#L596) | \* @param int $blog\_id - Greater than 0 for subsites in a multisite install, 0 for single sites. |
| [597](#L597) | \*/ |
| [598](#L598) | public static function wcal\_process\_activate( $blog\_id = 0 ) { |
| [599](#L599) | global $wpdb; |
| [600](#L600) |  |
| [601](#L601) | $db\_prefix = ( 0 === $blog\_id ) ? $wpdb->prefix : $wpdb->prefix . $blog\_id . '\_'; |
| [602](#L602) |  |
| [603](#L603) | $wcap\_collate = ''; |
| [604](#L604) | if ( $wpdb->has\_cap( 'collation' ) ) { |
| [605](#L605) | $wcap\_collate = $wpdb->get\_charset\_collate(); |
| [606](#L606) | } |
| [607](#L607) | $table\_name = $db\_prefix . 'ac\_email\_templates\_lite'; |
| [608](#L608) | $wpdb->query( // phpcs:ignore |
| [609](#L609) | "CREATE TABLE IF NOT EXISTS $table\_name ( |
| [610](#L610) | `id` int(11) NOT NULL AUTO\_INCREMENT, |
| [611](#L611) | `email\_type` varchar(50) NOT NULL, |
| [612](#L612) | `subject` text NOT NULL, |
| [613](#L613) | `body` mediumtext NOT NULL, |
| [614](#L614) | `is\_active` enum('0','1') NOT NULL, |
| [615](#L615) | `frequency` int(11) NOT NULL, |
| [616](#L616) | `day\_or\_hour` enum('Days','Hours','Minutes') NOT NULL, |
| [617](#L617) | `template\_name` text NOT NULL, |
| [618](#L618) | `is\_wc\_template` enum('0','1') NOT NULL, |
| [619](#L619) | `default\_template` int(11) NOT NULL, |
| [620](#L620) | `wc\_email\_header` varchar(50) NOT NULL, |
| [621](#L621) | `coupon\_code` varchar(50)  NOT NULL, |
| [622](#L622) | `discount` varchar(50)  NOT NULL, |
| [623](#L623) | `discount\_type` varchar(50)  NOT NULL, |
| [624](#L624) | `discount\_shipping` varchar(50)  NOT NULL, |
| [625](#L625) | `discount\_expiry` varchar(50) NOT NULL, |
| [626](#L626) | `individual\_use` enum('0','1') NOT NULL, |
| [627](#L627) | `generate\_unique\_coupon\_code` enum('0','1') NOT NULL, |
| [628](#L628) | PRIMARY KEY (`id`) |
| [629](#L629) | ) $wcap\_collate AUTO\_INCREMENT=1" // phpcs:ignore |
| [630](#L630) | ); |
| [631](#L631) |  |
| [632](#L632) | $sent\_table\_name = $db\_prefix . 'ac\_sent\_history\_lite'; |
| [633](#L633) | $wpdb->query( // phpcs:ignore |
| [634](#L634) | "CREATE TABLE IF NOT EXISTS $sent\_table\_name ( |
| [635](#L635) | `id` int(11) NOT NULL auto\_increment, |
| [636](#L636) | `template\_id` varchar(40) collate utf8\_unicode\_ci NOT NULL, |
| [637](#L637) | `abandoned\_order\_id` int(11) NOT NULL, |
| [638](#L638) | `sent\_time` datetime NOT NULL, |
| [639](#L639) | `sent\_email\_id` text COLLATE utf8\_unicode\_ci NOT NULL, |
| [640](#L640) | PRIMARY KEY  (`id`) |
| [641](#L641) | ) $wcap\_collate AUTO\_INCREMENT=1 " // phpcs:ignore |
| [642](#L642) | ); |
| [643](#L643) |  |
| [644](#L644) | $ac\_history\_table\_name = $db\_prefix . 'ac\_abandoned\_cart\_history\_lite'; |
| [645](#L645) | $wpdb->query( // phpcs:ignore |
| [646](#L646) | "CREATE TABLE IF NOT EXISTS $ac\_history\_table\_name ( |
| [647](#L647) | `id` int(11) NOT NULL AUTO\_INCREMENT, |
| [648](#L648) | `user\_id` int(11) NOT NULL, |
| [649](#L649) | `abandoned\_cart\_info` text COLLATE utf8\_unicode\_ci NOT NULL, |
| [650](#L650) | `abandoned\_cart\_time` int(11) NOT NULL, |
| [651](#L651) | `cart\_ignored` enum('0','1') COLLATE utf8\_unicode\_ci NOT NULL, |
| [652](#L652) | `recovered\_cart` int(11) NOT NULL, |
| [653](#L653) | `user\_type` text, |
| [654](#L654) | `unsubscribe\_link` enum('0','1') COLLATE utf8\_unicode\_ci NOT NULL, |
| [655](#L655) | `session\_id` varchar(50) COLLATE utf8\_unicode\_ci NOT NULL, |
| [656](#L656) | `email\_reminder\_status` varchar(50) COLLATE utf8\_unicode\_ci NOT NULL, |
| [657](#L657) | `checkout\_link` varchar(500) COLLATE utf8\_unicode\_ci NOT NULL, |
| [658](#L658) | PRIMARY KEY (`id`) |
| [659](#L659) | ) $wcap\_collate" // phpcs:ignore |
| [660](#L660) | ); |
| [661](#L661) |  |
| [662](#L662) | $guest\_table        = $db\_prefix . 'ac\_guest\_abandoned\_cart\_history\_lite'; |
| [663](#L663) | $result\_guest\_table = $wpdb->get\_results( // phpcs:ignore |
| [664](#L664) | "SHOW TABLES LIKE '$guest\_table'" // phpcs:ignore |
| [665](#L665) | ); |
| [666](#L666) |  |
| [667](#L667) | if ( 0 === count( $result\_guest\_table ) ) { |
| [668](#L668) | $ac\_guest\_history\_table\_name = $db\_prefix . 'ac\_guest\_abandoned\_cart\_history\_lite'; |
| [669](#L669) | $wpdb->query( // phpcs:ignore |
| [670](#L670) | "CREATE TABLE IF NOT EXISTS $ac\_guest\_history\_table\_name ( |
| [671](#L671) | `id` int(15) NOT NULL AUTO\_INCREMENT, |
| [672](#L672) | `billing\_first\_name` text, |
| [673](#L673) | `billing\_last\_name` text, |
| [674](#L674) | `billing\_company\_name` text, |
| [675](#L675) | `billing\_address\_1` text, |
| [676](#L676) | `billing\_address\_2` text, |
| [677](#L677) | `billing\_city` text, |
| [678](#L678) | `billing\_county` text, |
| [679](#L679) | `billing\_zipcode` text, |
| [680](#L680) | `email\_id` text, |
| [681](#L681) | `phone` text, |
| [682](#L682) | `ship\_to\_billing` text, |
| [683](#L683) | `order\_notes` text, |
| [684](#L684) | `shipping\_first\_name` text, |
| [685](#L685) | `shipping\_last\_name` text, |
| [686](#L686) | `shipping\_company\_name` text, |
| [687](#L687) | `shipping\_address\_1` text, |
| [688](#L688) | `shipping\_address\_2` text, |
| [689](#L689) | `shipping\_city` text, |
| [690](#L690) | `shipping\_county` text, |
| [691](#L691) | `shipping\_zipcode` double, |
| [692](#L692) | `shipping\_charges` double, |
| [693](#L693) | PRIMARY KEY (`id`) |
| [694](#L694) | ) $wcap\_collate AUTO\_INCREMENT=63000000" // phpcs:ignore |
| [695](#L695) | ); |
| [696](#L696) | } |
| [697](#L697) |  |
| [698](#L698) | $wcal\_guest\_user\_id\_altered = 0 === $blog\_id ? get\_option( 'wcal\_guest\_user\_id\_altered' ) : get\_blog\_option( $blog\_id, 'wcal\_guest\_user\_id\_altered' ); |
| [699](#L699) |  |
| [700](#L700) | // Alter Guest Table A\_I value if needed. |
| [701](#L701) | if ( 'yes' !== $wcal\_guest\_user\_id\_altered ) { |
| [702](#L702) | Wcal\_Update::wcal\_reset\_guest\_user\_id( $db\_prefix, $blog\_id, 1 ); |
| [703](#L703) | } |
| [704](#L704) | // Default templates - function call to create default templates. |
| [705](#L705) | $check\_table\_empty = $wpdb->get\_var( 'SELECT COUNT(\*) FROM `' . $db\_prefix . 'ac\_email\_templates\_lite`' ); // phpcs:ignore |
| [706](#L706) |  |
| [707](#L707) | /\*\* |
| [708](#L708) | \* This is add for thos user who Install the plguin first time. |
| [709](#L709) | \* So for them this option will be cheked. |
| [710](#L710) | \*/ |
| [711](#L711) | if ( 0 === $blog\_id ) { |
| [712](#L712) | if ( ! get\_option( 'wcal\_new\_default\_templates' ) ) { |
| [713](#L713) | if ( 0 === (int) $check\_table\_empty ) { |
| [714](#L714) | $default\_template = new Wcal\_Default\_Template\_Settings(); |
| [715](#L715) | $default\_template->wcal\_create\_default\_templates( $db\_prefix, $blog\_id ); |
| [716](#L716) | } |
| [717](#L717) | } |
| [718](#L718) | if ( ! get\_option( 'ac\_lite\_cart\_abandoned\_time' ) ) { |
| [719](#L719) | add\_option( 'ac\_lite\_cart\_abandoned\_time', 10 ); |
| [720](#L720) | } |
| [721](#L721) | if ( ! get\_option( 'ac\_lite\_track\_guest\_cart\_from\_cart\_page' ) ) { |
| [722](#L722) | add\_option( 'ac\_lite\_track\_guest\_cart\_from\_cart\_page', 'on' ); |
| [723](#L723) | } |
| [724](#L724) | if ( ! get\_option( 'wcal\_from\_name' ) ) { |
| [725](#L725) | add\_option( 'wcal\_from\_name', 'Admin' ); |
| [726](#L726) | } |
| [727](#L727) | $wcal\_get\_admin\_email = get\_option( 'admin\_email' ); |
| [728](#L728) | if ( ! get\_option( 'wcal\_from\_email' ) ) { |
| [729](#L729) | add\_option( 'wcal\_from\_email', $wcal\_get\_admin\_email ); |
| [730](#L730) | } |
| [731](#L731) |  |
| [732](#L732) | if ( ! get\_option( 'wcal\_reply\_email' ) ) { |
| [733](#L733) | add\_option( 'wcal\_reply\_email', $wcal\_get\_admin\_email ); |
| [734](#L734) | } |
| [735](#L735) | } else { |
| [736](#L736) | if ( ! get\_blog\_option( $blog\_id, 'wcal\_new\_default\_templates' ) ) { |
| [737](#L737) | if ( 0 === $check\_table\_empty ) { |
| [738](#L738) | $default\_template = new Wcal\_Default\_Template\_Settings(); |
| [739](#L739) | $default\_template->wcal\_create\_default\_templates( $db\_prefix, $blog\_id ); |
| [740](#L740) | } |
| [741](#L741) | } |
| [742](#L742) | if ( ! get\_blog\_option( $blog\_id, 'ac\_lite\_cart\_abandoned\_time' ) ) { |
| [743](#L743) | add\_blog\_option( $blog\_id, 'ac\_lite\_cart\_abandoned\_time', 10 ); |
| [744](#L744) | } |
| [745](#L745) | if ( ! get\_blog\_option( $blog\_id, 'ac\_lite\_track\_guest\_cart\_from\_cart\_page' ) ) { |
| [746](#L746) | add\_blog\_option( $blog\_id, 'ac\_lite\_track\_guest\_cart\_from\_cart\_page', 'on' ); |
| [747](#L747) | } |
| [748](#L748) | if ( ! get\_blog\_option( $blog\_id, 'wcal\_from\_name' ) ) { |
| [749](#L749) | add\_blog\_option( $blog\_id, 'wcal\_from\_name', 'Admin' ); |
| [750](#L750) | } |
| [751](#L751) | $wcal\_get\_admin\_email = get\_option( 'admin\_email' ); |
| [752](#L752) | if ( ! get\_blog\_option( $blog\_id, 'wcal\_from\_email' ) ) { |
| [753](#L753) | add\_blog\_option( $blog\_id, 'wcal\_from\_email', $wcal\_get\_admin\_email ); |
| [754](#L754) | } |
| [755](#L755) |  |
| [756](#L756) | if ( ! get\_blog\_option( $blog\_id, 'wcal\_reply\_email' ) ) { |
| [757](#L757) | add\_blog\_option( $blog\_id, 'wcal\_reply\_email', $wcal\_get\_admin\_email ); |
| [758](#L758) | } |
| [759](#L759) | } |
| [760](#L760) | do\_action( 'wcal\_activate' ); |
| [761](#L761) | } |
| [762](#L762) |  |
| [763](#L763) | /\*\* |
| [764](#L764) | \* It will add the section, field, & registres the plugin fields using Settings API. |
| [765](#L765) | \* |
| [766](#L766) | \* @hook admin\_init |
| [767](#L767) | \* @since 2.5 |
| [768](#L768) | \*/ |
| [769](#L769) | public function wcal\_initialize\_plugin\_options() { |
| [770](#L770) |  |
| [771](#L771) | // First, we register a section. This is necessary since all future options must belong to a section. |
| [772](#L772) | add\_settings\_section( |
| [773](#L773) | 'ac\_lite\_general\_settings\_section',                 // ID used to identify this section and with which to register options. |
| [774](#L774) | \_\_( 'Cart Abandonment Settings', 'woocommerce-abandoned-cart' ),     // Title to be displayed on the administration page. |
| [775](#L775) | array( $this, 'ac\_lite\_general\_options\_callback' ), // Callback used to render the description of the section. |
| [776](#L776) | 'woocommerce\_ac\_page'                               // Page on which to add this section of options. |
| [777](#L777) | ); |
| [778](#L778) |  |
| [779](#L779) | add\_settings\_field( |
| [780](#L780) | 'wcal\_enable\_cart\_emails', |
| [781](#L781) | \_\_( 'Enable abandoned cart emails', 'woocommerce-abandoned-cart' ), |
| [782](#L782) | array( $this, 'wcal\_enable\_cart\_emails\_callback' ), |
| [783](#L783) | 'woocommerce\_ac\_page', |
| [784](#L784) | 'ac\_lite\_general\_settings\_section', |
| [785](#L785) | array( \_\_( 'Yes, enable the abandoned cart emails.', 'woocommerce-abandoned-cart' ) ) |
| [786](#L786) | ); |
| [787](#L787) |  |
| [788](#L788) | add\_settings\_field( |
| [789](#L789) | 'ac\_lite\_cart\_abandoned\_time', |
| [790](#L790) | \_\_( 'Cart abandoned cut-off time', 'woocommerce-abandoned-cart' ), |
| [791](#L791) | array( $this, 'ac\_lite\_cart\_abandoned\_time\_callback' ), |
| [792](#L792) | 'woocommerce\_ac\_page', |
| [793](#L793) | 'ac\_lite\_general\_settings\_section', |
| [794](#L794) | array( \_\_( 'Consider cart abandoned after X minutes of item being added to cart & order not placed.', 'woocommerce-abandoned-cart' ) ) |
| [795](#L795) | ); |
| [796](#L796) |  |
| [797](#L797) | add\_settings\_field( |
| [798](#L798) | 'ac\_lite\_delete\_abandoned\_order\_days', |
| [799](#L799) | \_\_( 'Automatically Delete Abandoned Orders after X days', 'woocommerce-abandoned-cart' ), |
| [800](#L800) | array( $this, 'wcal\_delete\_abandoned\_orders\_days\_callback' ), |
| [801](#L801) | 'woocommerce\_ac\_page', |
| [802](#L802) | 'ac\_lite\_general\_settings\_section', |
| [803](#L803) | array( \_\_( 'Automatically delete abandoned cart orders after X days.', 'woocommerce-abandoned-cart' ) ) |
| [804](#L804) | ); |
| [805](#L805) |  |
| [806](#L806) | add\_settings\_field( |
| [807](#L807) | 'ac\_lite\_email\_admin\_on\_recovery', |
| [808](#L808) | \_\_( 'Email admin On Order Recovery', 'woocommerce-abandoned-cart' ), |
| [809](#L809) | array( $this, 'ac\_lite\_email\_admin\_on\_recovery' ), |
| [810](#L810) | 'woocommerce\_ac\_page', |
| [811](#L811) | 'ac\_lite\_general\_settings\_section', |
| [812](#L812) | array( \_\_( 'Sends email to Admin if an Abandoned Cart Order is recovered.', 'woocommerce-abandoned-cart' ) ) |
| [813](#L813) | ); |
| [814](#L814) |  |
| [815](#L815) | add\_settings\_field( |
| [816](#L816) | 'ac\_lite\_track\_guest\_cart\_from\_cart\_page', |
| [817](#L817) | \_\_( 'Start tracking from Cart Page', 'woocommerce-abandoned-cart' ), |
| [818](#L818) | array( $this, 'wcal\_track\_guest\_cart\_from\_cart\_page\_callback' ), |
| [819](#L819) | 'woocommerce\_ac\_page', |
| [820](#L820) | 'ac\_lite\_general\_settings\_section', |
| [821](#L821) | array( \_\_( 'Enable tracking of abandoned products & carts even if customer does not visit the checkout page or does not enter any details on the checkout page like Name or Email. Tracking will begin as soon as a visitor adds a product to their cart and visits the cart page.', 'woocommerce-abandoned-cart' ) ) |
| [822](#L822) | ); |
| [823](#L823) |  |
| [824](#L824) | add\_settings\_section( |
| [825](#L825) | 'ac\_lite\_gdpr\_settings',                 // ID used to identify this section and with which to register options. |
| [826](#L826) | \_\_( 'GDPR Settings', 'woocommerce-abandoned-cart' ),     // Title to be displayed on the administration page. |
| [827](#L827) | array( $this, 'ac\_lite\_gdpr\_callback' ), // Callback used to render the description of the section. |
| [828](#L828) | 'woocommerce\_ac\_page'                               // Page on which to add this section of options. |
| [829](#L829) | ); |
| [830](#L830) |  |
| [831](#L831) | add\_settings\_field( |
| [832](#L832) | 'wcal\_enable\_gdpr\_consent', |
| [833](#L833) | \_\_( 'Enable GDPR Notice', 'woocommerce-abandoned-cart' ), |
| [834](#L834) | array( $this, 'wcal\_enable\_gdpr\_callback' ), |
| [835](#L835) | 'woocommerce\_ac\_page', |
| [836](#L836) | 'ac\_lite\_gdpr\_settings', |
| [837](#L837) | array( \_\_( 'Enable this setting to display a notice informing customers that their email and cart data are saved to send abandonment reminders.', 'woocommerce-abandoned-cart' ) ) |
| [838](#L838) | ); |
| [839](#L839) |  |
| [840](#L840) | add\_settings\_field( |
| [841](#L841) | 'wcal\_guest\_cart\_capture\_msg', |
| [842](#L842) | \_\_( 'Message to be displayed for Guest users when tracking their carts', 'woocommerce-abandoned-cart' ), |
| [843](#L843) | array( $this, 'wcal\_guest\_cart\_capture\_msg\_callback' ), |
| [844](#L844) | 'woocommerce\_ac\_page', |
| [845](#L845) | 'ac\_lite\_gdpr\_settings', |
| [846](#L846) | array( \_\_( '<br>In compliance with GDPR, add a message on the Checkout page to inform Guest users of how their data is being used.<br><i>For example: Your email address will help us support your shopping experience throughout the site. Please check our Privacy Policy to see how we use your personal data.</i>', 'woocommerce-abandoned-cart' ) ) |
| [847](#L847) | ); |
| [848](#L848) |  |
| [849](#L849) | add\_settings\_field( |
| [850](#L850) | 'wcal\_logged\_cart\_capture\_msg', |
| [851](#L851) | \_\_( 'Message to be displayed for registered users when tracking their carts.', 'woocommerce-abandoned-cart' ), |
| [852](#L852) | array( $this, 'wcal\_logged\_cart\_capture\_msg\_callback' ), |
| [853](#L853) | 'woocommerce\_ac\_page', |
| [854](#L854) | 'ac\_lite\_gdpr\_settings', |
| [855](#L855) | array( \_\_( '<br>In compliance with GDPR, add a message on the Shop & Product pages to inform Registered users of how their data is being used.<br><i>For example: Please check our Privacy Policy to see how we use your personal data.</i>', 'woocommerce-abandoned-cart' ) ) |
| [856](#L856) | ); |
| [857](#L857) |  |
| [858](#L858) | add\_settings\_field( |
| [859](#L859) | 'wcal\_gdpr\_allow\_opt\_out', |
| [860](#L860) | \_\_( 'Allow the visitor to opt out of cart tracking.', 'woocommerce-abandoned-cart' ), |
| [861](#L861) | array( $this, 'wcal\_gdpr\_allow\_opt\_out\_callback' ), |
| [862](#L862) | 'woocommerce\_ac\_page', |
| [863](#L863) | 'ac\_lite\_gdpr\_settings', |
| [864](#L864) | array( \_\_( '<br>In compliance with GDPR, allow the site visitor (guests & registered users) to opt out from cart tracking. This message will be displayed in conjunction with the GDPR message above.</i>', 'woocommerce-abandoned-cart' ) ) |
| [865](#L865) | ); |
| [866](#L866) |  |
| [867](#L867) | add\_settings\_field( |
| [868](#L868) | 'wcal\_gdpr\_opt\_out\_message', |
| [869](#L869) | \_\_( 'Message to be displayed when the user chooses to opt out of cart tracking.', 'woocommerce-abandoned-cart' ), |
| [870](#L870) | array( $this, 'wcal\_gdpr\_opt\_out\_msg\_callback' ), |
| [871](#L871) | 'woocommerce\_ac\_page', |
| [872](#L872) | 'ac\_lite\_gdpr\_settings', |
| [873](#L873) | array( \_\_( '<br>Message to be displayed when the user chooses to opt out of cart tracking.</i>', 'woocommerce-abandoned-cart' ) ) |
| [874](#L874) | ); |
| [875](#L875) | add\_settings\_section( |
| [876](#L876) | 'ac\_lite\_coupon\_settings',                 // ID used to identify this section and with which to register options. |
| [877](#L877) | \_\_( 'Coupon Settings', 'woocommerce-abandoned-cart' ),     // Title to be displayed on the administration page. |
| [878](#L878) | array( $this, 'ac\_lite\_coupon\_callback' ), // Callback used to render the description of the section. |
| [879](#L879) | 'woocommerce\_ac\_page'                               // Page on which to add this section of options. |
| [880](#L880) | ); |
| [881](#L881) | add\_settings\_field( |
| [882](#L882) | 'wcal\_delete\_coupon\_data', |
| [883](#L883) | \_\_( 'Delete Coupons Automatically', 'woocommerce-abandoned-cart' ), |
| [884](#L884) | array( $this, 'wcal\_deleting\_coupon\_data' ), |
| [885](#L885) | 'woocommerce\_ac\_page', |
| [886](#L886) | 'ac\_lite\_coupon\_settings', |
| [887](#L887) | array( \_\_( 'Enable this setting if you want to completely remove the expired and used coupon code automatically every 15 days.', 'woocommerce-abandoned-cart' ) ) |
| [888](#L888) | ); |
| [889](#L889) | add\_settings\_field( |
| [890](#L890) | 'wcal\_delete\_coupon\_data\_manually', |
| [891](#L891) | \_\_( 'Delete Coupons Manually', 'woocommerce-abandoned-cart' ), |
| [892](#L892) | array( $this, 'wcal\_deleting\_coupon\_data\_manually' ), |
| [893](#L893) | 'woocommerce\_ac\_page', |
| [894](#L894) | 'ac\_lite\_coupon\_settings', |
| [895](#L895) | array( \_\_( 'If you want to completely remove the expired and used coupon code now then click on "Delete" button.', 'woocommerce-abandoned-cart' ) ) |
| [896](#L896) | ); |
| [897](#L897) | /\*\* |
| [898](#L898) | \* New section for the Adding the abandoned cart setting. |
| [899](#L899) | \* |
| [900](#L900) | \* @since  4.7 |
| [901](#L901) | \*/ |
| [902](#L902) | add\_settings\_section( |
| [903](#L903) | 'ac\_email\_settings\_section',                                                       // ID used to identify this section and with which to register options. |
| [904](#L904) | \_\_( 'Settings for abandoned cart recovery emails', 'woocommerce-abandoned-cart' ), // Title to be displayed on the administration page. |
| [905](#L905) | array( $this, 'wcal\_email\_callback' ),                                             // Callback used to render the description of the section. |
| [906](#L906) | 'woocommerce\_ac\_email\_page'                                                        // Page on which to add this section of options. |
| [907](#L907) | ); |
| [908](#L908) |  |
| [909](#L909) | add\_settings\_field( |
| [910](#L910) | 'wcal\_from\_name', |
| [911](#L911) | \_\_( '"From" Name', 'woocommerce-abandoned-cart' ), |
| [912](#L912) | array( $this, 'wcal\_from\_name\_callback' ), |
| [913](#L913) | 'woocommerce\_ac\_email\_page', |
| [914](#L914) | 'ac\_email\_settings\_section', |
| [915](#L915) | array( 'Enter the name that should appear in the email sent.', 'woocommerce-abandoned-cart' ) |
| [916](#L916) | ); |
| [917](#L917) |  |
| [918](#L918) | add\_settings\_field( |
| [919](#L919) | 'wcal\_from\_email', |
| [920](#L920) | \_\_( '"From" Address', 'woocommerce-abandoned-cart' ), |
| [921](#L921) | array( $this, 'wcal\_from\_email\_callback' ), |
| [922](#L922) | 'woocommerce\_ac\_email\_page', |
| [923](#L923) | 'ac\_email\_settings\_section', |
| [924](#L924) | array( 'Email address from which the reminder emails should be sent.', 'woocommerce-abandoned-cart' ) |
| [925](#L925) | ); |
| [926](#L926) |  |
| [927](#L927) | add\_settings\_field( |
| [928](#L928) | 'wcal\_reply\_email', |
| [929](#L929) | \_\_( 'Send Reply Emails to', 'woocommerce-abandoned-cart' ), |
| [930](#L930) | array( $this, 'wcal\_reply\_email\_callback' ), |
| [931](#L931) | 'woocommerce\_ac\_email\_page', |
| [932](#L932) | 'ac\_email\_settings\_section', |
| [933](#L933) | array( 'When a contact receives your email and clicks reply, which email address should that reply be sent to?', 'woocommerce-abandoned-cart' ) |
| [934](#L934) | ); |
| [935](#L935) |  |
| [936](#L936) | add\_settings\_field( |
| [937](#L937) | 'wcal\_add\_utm\_to\_links', |
| [938](#L938) | \_\_( 'UTM parameters to be added to all the links in reminder emails', 'woocommerce-abandoned-cart' ), |
| [939](#L939) | array( &$this, 'wcal\_add\_utm\_to\_links\_callback' ), |
| [940](#L940) | 'woocommerce\_ac\_email\_page', |
| [941](#L941) | 'ac\_email\_settings\_section', |
| [942](#L942) | array( \_\_( 'UTM parameters that should be added to all the links in reminder emails.', 'woocommerce-abandoned-cart' ) ) |
| [943](#L943) | ); |
| [944](#L944) |  |
| [945](#L945) | // Finally, we register the fields with WordPress. |
| [946](#L946) | register\_setting( |
| [947](#L947) | 'woocommerce\_ac\_settings', |
| [948](#L948) | 'wcal\_enable\_cart\_emails' |
| [949](#L949) | ); |
| [950](#L950) |  |
| [951](#L951) | register\_setting( |
| [952](#L952) | 'woocommerce\_ac\_settings', |
| [953](#L953) | 'ac\_lite\_cart\_abandoned\_time', |
| [954](#L954) | array( $this, 'ac\_lite\_cart\_time\_validation' ) |
| [955](#L955) | ); |
| [956](#L956) |  |
| [957](#L957) | register\_setting( |
| [958](#L958) | 'woocommerce\_ac\_settings', |
| [959](#L959) | 'ac\_lite\_delete\_abandoned\_order\_days', |
| [960](#L960) | array( $this, 'wcal\_delete\_days\_validation' ) |
| [961](#L961) | ); |
| [962](#L962) |  |
| [963](#L963) | register\_setting( |
| [964](#L964) | 'woocommerce\_ac\_settings', |
| [965](#L965) | 'ac\_lite\_email\_admin\_on\_recovery' |
| [966](#L966) | ); |
| [967](#L967) |  |
| [968](#L968) | register\_setting( |
| [969](#L969) | 'woocommerce\_ac\_settings', |
| [970](#L970) | 'ac\_lite\_track\_guest\_cart\_from\_cart\_page' |
| [971](#L971) | ); |
| [972](#L972) |  |
| [973](#L973) | register\_setting( |
| [974](#L974) | 'woocommerce\_ac\_settings', |
| [975](#L975) | 'wcal\_enable\_gdpr\_consent' |
| [976](#L976) | ); |
| [977](#L977) |  |
| [978](#L978) | register\_setting( |
| [979](#L979) | 'woocommerce\_ac\_settings', |
| [980](#L980) | 'wcal\_guest\_cart\_capture\_msg' |
| [981](#L981) | ); |
| [982](#L982) |  |
| [983](#L983) | register\_setting( |
| [984](#L984) | 'woocommerce\_ac\_settings', |
| [985](#L985) | 'wcal\_logged\_cart\_capture\_msg' |
| [986](#L986) | ); |
| [987](#L987) |  |
| [988](#L988) | register\_setting( |
| [989](#L989) | 'woocommerce\_ac\_settings', |
| [990](#L990) | 'wcal\_gdpr\_allow\_opt\_out' |
| [991](#L991) | ); |
| [992](#L992) |  |
| [993](#L993) | register\_setting( |
| [994](#L994) | 'woocommerce\_ac\_settings', |
| [995](#L995) | 'wcal\_gdpr\_opt\_out\_message' |
| [996](#L996) | ); |
| [997](#L997) |  |
| [998](#L998) | register\_setting( |
| [999](#L999) | 'woocommerce\_ac\_email\_settings', |
| [1000](#L1000) | 'wcal\_from\_name' |
| [1001](#L1001) | ); |
| [1002](#L1002) | register\_setting( |
| [1003](#L1003) | 'woocommerce\_ac\_email\_settings', |
| [1004](#L1004) | 'wcal\_from\_email' |
| [1005](#L1005) | ); |
| [1006](#L1006) | register\_setting( |
| [1007](#L1007) | 'woocommerce\_ac\_email\_settings', |
| [1008](#L1008) | 'wcal\_reply\_email' |
| [1009](#L1009) | ); |
| [1010](#L1010) |  |
| [1011](#L1011) | register\_setting( |
| [1012](#L1012) | 'woocommerce\_ac\_email\_settings', |
| [1013](#L1013) | 'wcal\_add\_utm\_to\_links' |
| [1014](#L1014) | ); |
| [1015](#L1015) |  |
| [1016](#L1016) | register\_setting( |
| [1017](#L1017) | 'woocommerce\_ac\_settings', |
| [1018](#L1018) | 'wcal\_delete\_coupon\_data' |
| [1019](#L1019) | ); |
| [1020](#L1020) |  |
| [1021](#L1021) | do\_action( 'wcal\_add\_new\_settings' ); |
| [1022](#L1022) | } |
| [1023](#L1023) |  |
| [1024](#L1024) | /\*\* |
| [1025](#L1025) | \* Settings API callback for section "ac\_lite\_general\_settings\_section". |
| [1026](#L1026) | \* |
| [1027](#L1027) | \* @since 2.5 |
| [1028](#L1028) | \*/ |
| [1029](#L1029) | public function ac\_lite\_general\_options\_callback() { |
| [1030](#L1030) | } |
| [1031](#L1031) |  |
| [1032](#L1032) | /\*\* |
| [1033](#L1033) | \* Settings API callback for the enable cart reminder emails. |
| [1034](#L1034) | \* |
| [1035](#L1035) | \* @param array $args - Arguments. |
| [1036](#L1036) | \* @since 5.5 |
| [1037](#L1037) | \*/ |
| [1038](#L1038) | public static function wcal\_enable\_cart\_emails\_callback( $args ) { |
| [1039](#L1039) |  |
| [1040](#L1040) | $enable\_cart\_emails = get\_option( 'wcal\_enable\_cart\_emails', '' ); |
| [1041](#L1041) |  |
| [1042](#L1042) | if ( isset( $enable\_cart\_emails ) && '' === $enable\_cart\_emails ) { |
| [1043](#L1043) | $enable\_cart\_emails = 'off'; |
| [1044](#L1044) | } |
| [1045](#L1045) | printf( |
| [1046](#L1046) | '<input type="checkbox" id="wcal\_enable\_cart\_emails" name="wcal\_enable\_cart\_emails" value="on" ' . checked( 'on', $enable\_cart\_emails, false ) . ' />' |
| [1047](#L1047) | ); |
| [1048](#L1048) | $html = '<label for="wcal\_enable\_cart\_emails"> ' . $args[0] . '</label>'; |
| [1049](#L1049) | echo wp\_kses\_post( $html ); |
| [1050](#L1050) | } |
| [1051](#L1051) |  |
| [1052](#L1052) | /\*\* |
| [1053](#L1053) | \* Settings API callback for cart time field. |
| [1054](#L1054) | \* |
| [1055](#L1055) | \* @param array $args Arguments. |
| [1056](#L1056) | \* @since 2.5 |
| [1057](#L1057) | \*/ |
| [1058](#L1058) | public function ac\_lite\_cart\_abandoned\_time\_callback( $args ) { |
| [1059](#L1059) | // First, we read the option. |
| [1060](#L1060) | $cart\_abandoned\_time = get\_option( 'ac\_lite\_cart\_abandoned\_time' ); |
| [1061](#L1061) | // Next, we update the name attribute to access this element's ID in the context of the display options array. |
| [1062](#L1062) | // We also access the show\_header element of the options collection in the call to the checked() helper function. |
| [1063](#L1063) | printf( |
| [1064](#L1064) | '<input type="text" id="ac\_lite\_cart\_abandoned\_time" name="ac\_lite\_cart\_abandoned\_time" value="%s" />', |
| [1065](#L1065) | isset( $cart\_abandoned\_time ) ? esc\_attr( $cart\_abandoned\_time ) : '' |
| [1066](#L1066) | ); |
| [1067](#L1067) | // Here, we'll take the first argument of the array and add it to a label next to the checkbox. |
| [1068](#L1068) | $html = '<label for="ac\_lite\_cart\_abandoned\_time"> ' . $args[0] . '</label>'; |
| [1069](#L1069) | echo wp\_kses\_post( $html ); |
| [1070](#L1070) | } |
| [1071](#L1071) |  |
| [1072](#L1072) | /\*\* |
| [1073](#L1073) | \* Settings API cart time field validation. |
| [1074](#L1074) | \* |
| [1075](#L1075) | \* @param int|string $input - Input to be validated. |
| [1076](#L1076) | \* @return int|string $output - Validated output. |
| [1077](#L1077) | \* @since 2.5 |
| [1078](#L1078) | \*/ |
| [1079](#L1079) | public function ac\_lite\_cart\_time\_validation( $input ) { |
| [1080](#L1080) | $output = ''; |
| [1081](#L1081) | if ( '' != $input && ( is\_numeric( $input ) && $input > 0 ) ) { // phpcs:ignore |
| [1082](#L1082) | $output = stripslashes( $input ); |
| [1083](#L1083) | } else { |
| [1084](#L1084) | add\_settings\_error( 'ac\_lite\_cart\_abandoned\_time', 'error found', \_\_( 'Abandoned cart cut off time should be numeric and has to be greater than 0.', 'woocommerce-abandoned-cart' ) ); |
| [1085](#L1085) | } |
| [1086](#L1086) | return $output; |
| [1087](#L1087) | } |
| [1088](#L1088) |  |
| [1089](#L1089) | /\*\* |
| [1090](#L1090) | \* Validation for automatically delete abandoned carts after X days. |
| [1091](#L1091) | \* |
| [1092](#L1092) | \* @param int | string $input input of the field Abandoned cart cut off time. |
| [1093](#L1093) | \* @return int | string $output Error message or the input value. |
| [1094](#L1094) | \* @since  5.0 |
| [1095](#L1095) | \*/ |
| [1096](#L1096) | public static function wcal\_delete\_days\_validation( $input ) { |
| [1097](#L1097) | $output = ''; |
| [1098](#L1098) | if ( is\_numeric( $input ) && $input > 0 ) { |
| [1099](#L1099) | $output = stripslashes( $input ); |
| [1100](#L1100) | } else { |
| [1101](#L1101) | $output = '365'; |
| [1102](#L1102) | add\_settings\_error( 'ac\_lite\_delete\_abandoned\_order\_days', 'error found', \_\_( 'Automatically Delete Abandoned Orders after X days has to be greater than 0.', 'woocommerce-abandoned-cart' ) ); |
| [1103](#L1103) | } |
| [1104](#L1104) | return $output; |
| [1105](#L1105) | } |
| [1106](#L1106) |  |
| [1107](#L1107) | /\*\* |
| [1108](#L1108) | \* Callback for deleting abandoned order after X days field. |
| [1109](#L1109) | \* |
| [1110](#L1110) | \* @param array $args Argument given while adding the field. |
| [1111](#L1111) | \* @since 5.0 |
| [1112](#L1112) | \*/ |
| [1113](#L1113) | public static function wcal\_delete\_abandoned\_orders\_days\_callback( $args ) { |
| [1114](#L1114) | // First, we read the option. |
| [1115](#L1115) | $delete\_abandoned\_order\_days = get\_option( 'ac\_lite\_delete\_abandoned\_order\_days', '365' ); |
| [1116](#L1116) | if ( '' === $delete\_abandoned\_order\_days ) { |
| [1117](#L1117) | $delete\_abandoned\_order\_days = '365'; |
| [1118](#L1118) | } |
| [1119](#L1119) | // Next, we update the name attribute to access this element's ID in the context of the display options array. |
| [1120](#L1120) | // We also access the show\_header element of the options collection in the call to the checked() helper function. |
| [1121](#L1121) | printf( |
| [1122](#L1122) | '<input type="text" id="ac\_lite\_delete\_abandoned\_order\_days" name="ac\_lite\_delete\_abandoned\_order\_days" value="%s" />', |
| [1123](#L1123) | isset( $delete\_abandoned\_order\_days ) ? esc\_attr( $delete\_abandoned\_order\_days ) : '' |
| [1124](#L1124) | ); |
| [1125](#L1125) | // Here, we'll take the first argument of the array and add it to a label next to the checkbox. |
| [1126](#L1126) | $html = '<label for="ac\_lite\_delete\_abandoned\_order\_days"> ' . $args[0] . '</label>'; |
| [1127](#L1127) | echo wp\_kses\_post( $html ); |
| [1128](#L1128) | } |
| [1129](#L1129) |  |
| [1130](#L1130) | /\*\* |
| [1131](#L1131) | \* Settings API callback for email admin on cart recovery field. |
| [1132](#L1132) | \* |
| [1133](#L1133) | \* @param array $args Arguments. |
| [1134](#L1134) | \* @since 2.5 |
| [1135](#L1135) | \*/ |
| [1136](#L1136) | public function ac\_lite\_email\_admin\_on\_recovery( $args ) { |
| [1137](#L1137) | // First, we read the option. |
| [1138](#L1138) | $email\_admin\_on\_recovery = get\_option( 'ac\_lite\_email\_admin\_on\_recovery', '' ); |
| [1139](#L1139) |  |
| [1140](#L1140) | // This condition added to avoid the notie displyed while Check box is unchecked. |
| [1141](#L1141) | if ( isset( $email\_admin\_on\_recovery ) && '' === $email\_admin\_on\_recovery ) { |
| [1142](#L1142) | $email\_admin\_on\_recovery = 'off'; |
| [1143](#L1143) | } |
| [1144](#L1144) | // Next, we update the name attribute to access this element's ID in the context of the display options array. |
| [1145](#L1145) | // We also access the show\_header element of the options collection in the call to the checked() helper function. |
| [1146](#L1146) | $html = ''; |
| [1147](#L1147) | printf( |
| [1148](#L1148) | '<input type="checkbox" id="ac\_lite\_email\_admin\_on\_recovery" name="ac\_lite\_email\_admin\_on\_recovery" value="on" |
| [1149](#L1149) | ' . checked( 'on', $email\_admin\_on\_recovery, false ) . ' />' |
| [1150](#L1150) | ); |
| [1151](#L1151) |  |
| [1152](#L1152) | // Here, we'll take the first argument of the array and add it to a label next to the checkbox. |
| [1153](#L1153) | $html .= '<label for="ac\_lite\_email\_admin\_on\_recovery"> ' . $args[0] . '</label>'; |
| [1154](#L1154) | echo wp\_kses\_post( $html ); |
| [1155](#L1155) | } |
| [1156](#L1156) |  |
| [1157](#L1157) | /\*\* |
| [1158](#L1158) | \* Settings API callback for capturing guest cart which do not reach the checkout page. |
| [1159](#L1159) | \* |
| [1160](#L1160) | \* @param array $args Arguments. |
| [1161](#L1161) | \* @since 2.7 |
| [1162](#L1162) | \*/ |
| [1163](#L1163) | public function wcal\_track\_guest\_cart\_from\_cart\_page\_callback( $args ) { |
| [1164](#L1164) | // First, we read the option. |
| [1165](#L1165) | $disable\_guest\_cart\_from\_cart\_page = get\_option( 'ac\_lite\_track\_guest\_cart\_from\_cart\_page', '' ); |
| [1166](#L1166) |  |
| [1167](#L1167) | // This condition added to avoid the notice displyed while Check box is unchecked. |
| [1168](#L1168) | if ( isset( $disable\_guest\_cart\_from\_cart\_page ) && '' === $disable\_guest\_cart\_from\_cart\_page ) { |
| [1169](#L1169) | $disable\_guest\_cart\_from\_cart\_page = 'off'; |
| [1170](#L1170) | } |
| [1171](#L1171) | // Next, we update the name attribute to access this element's ID in the context of the display options array. |
| [1172](#L1172) | // We also access the show\_header element of the options collection in the call to the checked() helper function. |
| [1173](#L1173) | $html = ''; |
| [1174](#L1174) |  |
| [1175](#L1175) | printf( |
| [1176](#L1176) | '<input type="checkbox" id="ac\_lite\_track\_guest\_cart\_from\_cart\_page" name="ac\_lite\_track\_guest\_cart\_from\_cart\_page" value="on" |
| [1177](#L1177) | ' . checked( 'on', $disable\_guest\_cart\_from\_cart\_page, false ) . ' />' |
| [1178](#L1178) | ); |
| [1179](#L1179) | // Here, we'll take the first argument of the array and add it to a label next to the checkbox. |
| [1180](#L1180) | $html .= '<label for="ac\_lite\_track\_guest\_cart\_from\_cart\_page"> ' . $args[0] . '</label>'; |
| [1181](#L1181) | echo wp\_kses\_post( $html ); |
| [1182](#L1182) | } |
| [1183](#L1183) |  |
| [1184](#L1184) | /\*\* |
| [1185](#L1185) | \* Callback - Enable GDPR consent. |
| [1186](#L1186) | \* |
| [1187](#L1187) | \* @param array $args - Arguments. |
| [1188](#L1188) | \* @since 5.12.0 |
| [1189](#L1189) | \*/ |
| [1190](#L1190) | public static function wcal\_enable\_gdpr\_callback( $args ) { |
| [1191](#L1191) | $wcal\_enable\_gdpr = get\_option( 'wcal\_enable\_gdpr\_consent', '' ); |
| [1192](#L1192) | $wcal\_gdpr\_status = isset( $wcal\_enable\_gdpr ) && '' === $wcal\_enable\_gdpr ? 'off' : 'on'; |
| [1193](#L1193) | ?> |
| [1194](#L1194) | <input type="checkbox" id="wcal\_enable\_gdpr\_consent" name="wcal\_enable\_gdpr\_consent" value="on" <?php echo checked( 'on', $wcal\_gdpr\_status, false ); ?> /> |
| [1195](#L1195) | <label for="wcal\_enable\_gdpr\_consent"> <?php echo esc\_attr( $args[0] ); ?></label> |
| [1196](#L1196) | <a > |
| [1197](#L1197) | <?php |
| [1198](#L1198) | } |
| [1199](#L1199) | /\*\* |
| [1200](#L1200) | \* Call back function for guest user cart capture message |
| [1201](#L1201) | \* |
| [1202](#L1202) | \* @param array $args Argument for adding field details. |
| [1203](#L1203) | \* @since 7.8 |
| [1204](#L1204) | \*/ |
| [1205](#L1205) | public static function wcal\_guest\_cart\_capture\_msg\_callback( $args ) { |
| [1206](#L1206) |  |
| [1207](#L1207) | $guest\_msg = get\_option( 'wcal\_guest\_cart\_capture\_msg' ); |
| [1208](#L1208) |  |
| [1209](#L1209) | printf( |
| [1210](#L1210) | "<textarea rows='4' cols='80' id='wcal\_guest\_cart\_capture\_msg' name='wcal\_guest\_cart\_capture\_msg'>" . htmlspecialchars( $guest\_msg, ENT\_QUOTES ) . '</textarea>' // phpcs:ignore |
| [1211](#L1211) | ); |
| [1212](#L1212) |  |
| [1213](#L1213) | $html = '<label for="wcal\_guest\_cart\_capture\_msg"> ' . $args[0] . '</label>'; |
| [1214](#L1214) | echo wp\_kses\_post( $html ); |
| [1215](#L1215) | } |
| [1216](#L1216) |  |
| [1217](#L1217) | /\*\* |
| [1218](#L1218) | \* Call back function for registered user cart capture message |
| [1219](#L1219) | \* |
| [1220](#L1220) | \* @param array $args Argument for adding field details. |
| [1221](#L1221) | \* @since 7.8 |
| [1222](#L1222) | \*/ |
| [1223](#L1223) | public static function wcal\_logged\_cart\_capture\_msg\_callback( $args ) { |
| [1224](#L1224) |  |
| [1225](#L1225) | $logged\_msg = get\_option( 'wcal\_logged\_cart\_capture\_msg' ); |
| [1226](#L1226) |  |
| [1227](#L1227) | printf( |
| [1228](#L1228) | "<input type='text' class='regular-text' id='wcal\_logged\_cart\_capture\_msg' name='wcal\_logged\_cart\_capture\_msg' value='" . htmlspecialchars( $logged\_msg, ENT\_QUOTES ) . "' />" // phpcs:ignore |
| [1229](#L1229) | ); |
| [1230](#L1230) |  |
| [1231](#L1231) | $html = '<label for="wcal\_logged\_cart\_capture\_msg"> ' . $args[0] . '</label>'; |
| [1232](#L1232) | echo wp\_kses\_post( $html ); |
| [1233](#L1233) | } |
| [1234](#L1234) |  |
| [1235](#L1235) |  |
| [1236](#L1236) | /\*\* |
| [1237](#L1237) | \* Text to allow the user the choice to opt out of cart tracking. |
| [1238](#L1238) | \* |
| [1239](#L1239) | \* @param array $args - Arguments. |
| [1240](#L1240) | \* @since 5.5 |
| [1241](#L1241) | \*/ |
| [1242](#L1242) | public static function wcal\_gdpr\_allow\_opt\_out\_callback( $args ) { |
| [1243](#L1243) |  |
| [1244](#L1244) | $wcal\_gdpr\_allow\_opt\_out = get\_option( 'wcal\_gdpr\_allow\_opt\_out' ); |
| [1245](#L1245) |  |
| [1246](#L1246) | printf( |
| [1247](#L1247) | "<input type='text' class='regular-text' id='wcal\_gdpr\_allow\_opt\_out' name='wcal\_gdpr\_allow\_opt\_out' value='" . htmlspecialchars( $wcal\_gdpr\_allow\_opt\_out, ENT\_QUOTES ) . "' />" // phpcs:ignore |
| [1248](#L1248) | ); |
| [1249](#L1249) |  |
| [1250](#L1250) | $html = '<label for="wcal\_gdpr\_allow\_opt\_out"> ' . $args[0] . '</label>'; |
| [1251](#L1251) | echo wp\_kses\_post( $html ); |
| [1252](#L1252) | } |
| [1253](#L1253) |  |
| [1254](#L1254) | /\*\* |
| [1255](#L1255) | \* Message to display when the user chooses to opt out of cart tracking. |
| [1256](#L1256) | \* |
| [1257](#L1257) | \* @param array $args - Arguments. |
| [1258](#L1258) | \* @since 5.5 |
| [1259](#L1259) | \*/ |
| [1260](#L1260) | public static function wcal\_gdpr\_opt\_out\_msg\_callback( $args ) { |
| [1261](#L1261) |  |
| [1262](#L1262) | $wcal\_gdpr\_opt\_out\_message = get\_option( 'wcal\_gdpr\_opt\_out\_message' ); |
| [1263](#L1263) |  |
| [1264](#L1264) | printf( |
| [1265](#L1265) | "<input type='text' class='regular-text' id='wcal\_gdpr\_opt\_out\_message' name='wcal\_gdpr\_opt\_out\_message' value='" . htmlspecialchars( $wcal\_gdpr\_opt\_out\_message, ENT\_QUOTES ) . "' />" // phpcs:ignore |
| [1266](#L1266) | ); |
| [1267](#L1267) |  |
| [1268](#L1268) | $html = '<label for="wcal\_gdpr\_opt\_out\_message"> ' . $args[0] . '</label>'; |
| [1269](#L1269) | echo wp\_kses\_post( $html ); |
| [1270](#L1270) | } |
| [1271](#L1271) |  |
| [1272](#L1272) | /\*\* |
| [1273](#L1273) | \* Settings API callback for Abandoned cart email settings of the plugin. |
| [1274](#L1274) | \* |
| [1275](#L1275) | \* @since 3.5 |
| [1276](#L1276) | \*/ |
| [1277](#L1277) | public function wcal\_email\_callback() { |
| [1278](#L1278) | } |
| [1279](#L1279) |  |
| [1280](#L1280) | /\*\* |
| [1281](#L1281) | \* Settings API callback for from name used in Abandoned cart email. |
| [1282](#L1282) | \* |
| [1283](#L1283) | \* @param array $args Arguments. |
| [1284](#L1284) | \* @since 3.5 |
| [1285](#L1285) | \*/ |
| [1286](#L1286) | public static function wcal\_from\_name\_callback( $args ) { |
| [1287](#L1287) | // First, we read the option. |
| [1288](#L1288) | $wcal\_from\_name = get\_option( 'wcal\_from\_name' ); |
| [1289](#L1289) | // Next, we update the name attribute to access this element's ID in the context of the display options array. |
| [1290](#L1290) | // We also access the show\_header element of the options collection in the call to the checked() helper function. |
| [1291](#L1291) | printf( |
| [1292](#L1292) | '<input type="text" id="wcal\_from\_name" name="wcal\_from\_name" value="%s" />', |
| [1293](#L1293) | isset( $wcal\_from\_name ) ? esc\_attr( $wcal\_from\_name ) : '' |
| [1294](#L1294) | ); |
| [1295](#L1295) | // Here, we'll take the first argument of the array and add it to a label next to the checkbox. |
| [1296](#L1296) | $html = '<label for="wcal\_from\_name\_label"> ' . $args[0] . '</label>'; |
| [1297](#L1297) | echo wp\_kses\_post( $html ); |
| [1298](#L1298) | } |
| [1299](#L1299) |  |
| [1300](#L1300) | /\*\* |
| [1301](#L1301) | \* Settings API callback for from email used in Abandoned cart email. |
| [1302](#L1302) | \* |
| [1303](#L1303) | \* @param array $args Arguments. |
| [1304](#L1304) | \* @since 3.5 |
| [1305](#L1305) | \*/ |
| [1306](#L1306) | public static function wcal\_from\_email\_callback( $args ) { |
| [1307](#L1307) | // First, we read the option. |
| [1308](#L1308) | $wcal\_from\_email = get\_option( 'wcal\_from\_email' ); |
| [1309](#L1309) | // Next, we update the name attribute to access this element's ID in the context of the display options array. |
| [1310](#L1310) | // We also access the show\_header element of the options collection in the call to the checked() helper function. |
| [1311](#L1311) | printf( |
| [1312](#L1312) | '<input type="text" id="wcal\_from\_email" name="wcal\_from\_email" value="%s" />', |
| [1313](#L1313) | isset( $wcal\_from\_email ) ? esc\_attr( $wcal\_from\_email ) : '' |
| [1314](#L1314) | ); |
| [1315](#L1315) | // Here, we'll take the first argument of the array and add it to a label next to the checkbox. |
| [1316](#L1316) | $html = '<label for="wcal\_from\_email\_label"> ' . $args[0] . '</label>'; |
| [1317](#L1317) | echo wp\_kses\_post( $html ); |
| [1318](#L1318) | } |
| [1319](#L1319) |  |
| [1320](#L1320) | /\*\* |
| [1321](#L1321) | \* Settings API callback for reply email used in Abandoned cart email. |
| [1322](#L1322) | \* |
| [1323](#L1323) | \* @param array $args Arguments. |
| [1324](#L1324) | \* @since 3.5 |
| [1325](#L1325) | \*/ |
| [1326](#L1326) | public static function wcal\_reply\_email\_callback( $args ) { |
| [1327](#L1327) | // First, we read the option. |
| [1328](#L1328) | $wcal\_reply\_email = get\_option( 'wcal\_reply\_email' ); |
| [1329](#L1329) | // Next, we update the name attribute to access this element's ID in the context of the display options array. |
| [1330](#L1330) | // We also access the show\_header element of the options collection in the call to the checked() helper function. |
| [1331](#L1331) | printf( |
| [1332](#L1332) | '<input type="text" id="wcal\_reply\_email" name="wcal\_reply\_email" value="%s" />', |
| [1333](#L1333) | isset( $wcal\_reply\_email ) ? esc\_attr( $wcal\_reply\_email ) : '' |
| [1334](#L1334) | ); |
| [1335](#L1335) | // Here, we'll take the first argument of the array and add it to a label next to the checkbox. |
| [1336](#L1336) | $html = '<label for="wcal\_reply\_email\_label"> ' . $args[0] . '</label>'; |
| [1337](#L1337) | echo wp\_kses\_post( $html ); |
| [1338](#L1338) | } |
| [1339](#L1339) |  |
| [1340](#L1340) | /\*\* |
| [1341](#L1341) | \* Callback for UTM parameters. |
| [1342](#L1342) | \* |
| [1343](#L1343) | \* @param array $args - Arguments for the setting. |
| [1344](#L1344) | \* @since 5.9.0 |
| [1345](#L1345) | \*/ |
| [1346](#L1346) | public static function wcal\_add\_utm\_to\_links\_callback( $args ) { |
| [1347](#L1347) |  |
| [1348](#L1348) | $wcal\_add\_utm\_to\_links = get\_option( 'wcal\_add\_utm\_to\_links', '' ); |
| [1349](#L1349) |  |
| [1350](#L1350) | ?> |
| [1351](#L1351) | <textarea id='wcal\_add\_utm\_to\_links' rows='4' cols='50' name='wcal\_add\_utm\_to\_links' ><?php echo esc\_html( $wcal\_add\_utm\_to\_links ); ?></textarea> |
| [1352](#L1352) | <?php |
| [1353](#L1353) | $html = '<label for="wcal\_add\_utm\_to\_links">' . $args[0] . '</label>'; |
| [1354](#L1354) | echo wp\_kses\_post( $html ); |
| [1355](#L1355) | } |
| [1356](#L1356) |  |
| [1357](#L1357) | /\*\* |
| [1358](#L1358) | \* Add a submenu page under the WooCommerce. |
| [1359](#L1359) | \* |
| [1360](#L1360) | \* @hook admin\_menu |
| [1361](#L1361) | \* @since 1.0 |
| [1362](#L1362) | \*/ |
| [1363](#L1363) | public function wcal\_admin\_menu() { |
| [1364](#L1364) | $page = add\_submenu\_page( 'woocommerce', \_\_( 'Abandoned Carts', 'woocommerce-abandoned-cart' ), \_\_( 'Abandoned Carts', 'woocommerce-abandoned-cart' ), 'manage\_woocommerce', 'woocommerce\_ac\_page', array( &$this, 'wcal\_menu\_page' ) ); |
| [1365](#L1365) | } |
| [1366](#L1366) |  |
| [1367](#L1367) | /\*\* |
| [1368](#L1368) | \* Capture the cart and insert the information of the cart into DataBase. |
| [1369](#L1369) | \* |
| [1370](#L1370) | \* @hook woocommerce\_cart\_updated |
| [1371](#L1371) | \* @globals mixed $wpdb |
| [1372](#L1372) | \* @globals mixed $woocommerce |
| [1373](#L1373) | \* @since 1.0 |
| [1374](#L1374) | \*/ |
| [1375](#L1375) | public function wcal\_store\_cart\_timestamp() { |
| [1376](#L1376) |  |
| [1377](#L1377) | $block\_crawlers = apply\_filters( 'wcal\_block\_crawlers', false ); |
| [1378](#L1378) |  |
| [1379](#L1379) | if ( $block\_crawlers ) { |
| [1380](#L1380) | return; |
| [1381](#L1381) | } |
| [1382](#L1382) |  |
| [1383](#L1383) | if ( get\_transient( 'wcal\_email\_sent\_id' ) !== false ) { |
| [1384](#L1384) | wcal\_common::wcal\_set\_cart\_session( 'email\_sent\_id', get\_transient( 'wcal\_email\_sent\_id' ) ); |
| [1385](#L1385) | delete\_transient( 'wcal\_email\_sent\_id' ); |
| [1386](#L1386) | } |
| [1387](#L1387) | if ( get\_transient( 'wcal\_abandoned\_id' ) !== false ) { |
| [1388](#L1388) | wcal\_common::wcal\_set\_cart\_session( 'abandoned\_cart\_id\_lite', get\_transient( 'wcal\_abandoned\_id' ) ); |
| [1389](#L1389) | delete\_transient( 'wcal\_abandoned\_id' ); |
| [1390](#L1390) | } |
| [1391](#L1391) |  |
| [1392](#L1392) | global $wpdb,$woocommerce; |
| [1393](#L1393) | $current\_time                    = current\_time( 'timestamp' ); // phpcs:ignore |
| [1394](#L1394) | $cut\_off\_time                    = get\_option( 'ac\_lite\_cart\_abandoned\_time' ); |
| [1395](#L1395) | $track\_guest\_cart\_from\_cart\_page = get\_option( 'ac\_lite\_track\_guest\_cart\_from\_cart\_page' ); |
| [1396](#L1396) | $cart\_ignored                    = 0; |
| [1397](#L1397) | $recovered\_cart                  = 0; |
| [1398](#L1398) |  |
| [1399](#L1399) | $track\_guest\_user\_cart\_from\_cart = ''; |
| [1400](#L1400) | if ( isset( $track\_guest\_cart\_from\_cart\_page ) ) { |
| [1401](#L1401) | $track\_guest\_user\_cart\_from\_cart = $track\_guest\_cart\_from\_cart\_page; |
| [1402](#L1402) | } |
| [1403](#L1403) |  |
| [1404](#L1404) | if ( isset( $cut\_off\_time ) ) { |
| [1405](#L1405) | $cart\_cut\_off\_time = intval( $cut\_off\_time ) \* 60; |
| [1406](#L1406) | } else { |
| [1407](#L1407) | $cart\_cut\_off\_time = 60 \* 60; |
| [1408](#L1408) | } |
| [1409](#L1409) | $compare\_time = $current\_time - $cart\_cut\_off\_time; |
| [1410](#L1410) |  |
| [1411](#L1411) | if ( is\_user\_logged\_in() ) { |
| [1412](#L1412) |  |
| [1413](#L1413) | $user\_id      = get\_current\_user\_id(); |
| [1414](#L1414) | $gdpr\_consent = get\_user\_meta( $user\_id, 'wcal\_gdpr\_tracking\_choice', true ); |
| [1415](#L1415) |  |
| [1416](#L1416) | if ( '' === $gdpr\_consent ) { |
| [1417](#L1417) | $gdpr\_consent = true; |
| [1418](#L1418) | } |
| [1419](#L1419) |  |
| [1420](#L1420) | $wcal\_user\_restricted = false; |
| [1421](#L1421) | $wcal\_user\_restricted = apply\_filters( 'wcal\_restrict\_user', $wcal\_user\_restricted, $user\_id ); |
| [1422](#L1422) |  |
| [1423](#L1423) | if ( $gdpr\_consent && ! $wcal\_user\_restricted ) { |
| [1424](#L1424) |  |
| [1425](#L1425) | $results = $wpdb->get\_results( // phpcs:ignore |
| [1426](#L1426) | $wpdb->prepare( |
| [1427](#L1427) | 'SELECT \* FROM `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` WHERE user\_id = %d AND cart\_ignored = %s AND recovered\_cart = %s', |
| [1428](#L1428) | $user\_id, |
| [1429](#L1429) | $cart\_ignored, |
| [1430](#L1430) | $recovered\_cart |
| [1431](#L1431) | ) |
| [1432](#L1432) | ); |
| [1433](#L1433) | if ( 0 === count( $results ) ) { |
| [1434](#L1434) | $cart\_info\_meta         = array(); |
| [1435](#L1435) | $cart\_info\_meta['cart'] = WC()->session->cart; |
| [1436](#L1436) | $cart\_info\_meta         = wp\_json\_encode( $cart\_info\_meta ); |
| [1437](#L1437) |  |
| [1438](#L1438) | if ( '' !== $cart\_info\_meta && '{"cart":[]}' !== $cart\_info\_meta && '""' !== $cart\_info\_meta ) { |
| [1439](#L1439) | $cart\_info = $cart\_info\_meta; |
| [1440](#L1440) | $user\_type = 'REGISTERED'; |
| [1441](#L1441) | $wpdb->query( //phpcs:ignore |
| [1442](#L1442) | $wpdb->prepare( |
| [1443](#L1443) | 'INSERT INTO `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` ( user\_id, abandoned\_cart\_info, abandoned\_cart\_time, cart\_ignored, user\_type ) VALUES ( %d, %s, %d, %s, %s )', |
| [1444](#L1444) | $user\_id, |
| [1445](#L1445) | $cart\_info, |
| [1446](#L1446) | $current\_time, |
| [1447](#L1447) | $cart\_ignored, |
| [1448](#L1448) | $user\_type |
| [1449](#L1449) | ) |
| [1450](#L1450) | ); |
| [1451](#L1451) | $abandoned\_cart\_id = $wpdb->insert\_id; |
| [1452](#L1452) | wcal\_common::wcal\_set\_cart\_session( 'abandoned\_cart\_id\_lite', $abandoned\_cart\_id ); |
| [1453](#L1453) | wcal\_common::wcal\_add\_checkout\_link( $abandoned\_cart\_id ); |
| [1454](#L1454) | wcal\_common::wcal\_run\_webhook\_after\_cutoff( $abandoned\_cart\_id ); |
| [1455](#L1455) | } |
| [1456](#L1456) | } elseif ( isset( $results[0]->abandoned\_cart\_time ) && $compare\_time > $results[0]->abandoned\_cart\_time ) { |
| [1457](#L1457) | $updated\_cart\_info         = array(); |
| [1458](#L1458) | $updated\_cart\_info['cart'] = WC()->session->cart; |
| [1459](#L1459) | $updated\_cart\_info         = wp\_json\_encode( $updated\_cart\_info ); |
| [1460](#L1460) |  |
| [1461](#L1461) | if ( ! $this->wcal\_compare\_carts( $user\_id, $results[0]->abandoned\_cart\_info ) ) { |
| [1462](#L1462) | $updated\_cart\_ignored = 1; |
| [1463](#L1463) | $wpdb->query( //phpcs:ignore |
| [1464](#L1464) | $wpdb->prepare( |
| [1465](#L1465) | 'UPDATE `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` SET cart\_ignored = %s WHERE user\_id = %d', |
| [1466](#L1466) | $updated\_cart\_ignored, |
| [1467](#L1467) | $user\_id |
| [1468](#L1468) | ) |
| [1469](#L1469) | ); |
| [1470](#L1470) | $user\_type = 'REGISTERED'; |
| [1471](#L1471) | $wpdb->query( //phpcs:ignore |
| [1472](#L1472) | $wpdb->prepare( |
| [1473](#L1473) | 'INSERT INTO `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` (user\_id, abandoned\_cart\_info, abandoned\_cart\_time, cart\_ignored, user\_type) VALUES (%d, %s, %d, %s, %s)', |
| [1474](#L1474) | $user\_id, |
| [1475](#L1475) | $updated\_cart\_info, |
| [1476](#L1476) | $current\_time, |
| [1477](#L1477) | $cart\_ignored, |
| [1478](#L1478) | $user\_type |
| [1479](#L1479) | ) |
| [1480](#L1480) | ); |
| [1481](#L1481) | update\_user\_meta( $user\_id, '\_woocommerce\_ac\_modified\_cart', md5( 'yes' ) ); |
| [1482](#L1482) |  |
| [1483](#L1483) | $abandoned\_cart\_id = $wpdb->insert\_id; |
| [1484](#L1484) | wcal\_common::wcal\_set\_cart\_session( 'abandoned\_cart\_id\_lite', $abandoned\_cart\_id ); |
| [1485](#L1485) | wcal\_common::wcal\_add\_checkout\_link( $abandoned\_cart\_id ); |
| [1486](#L1486) | wcal\_common::wcal\_run\_webhook\_after\_cutoff( $abandoned\_cart\_id ); |
| [1487](#L1487) | } else { |
| [1488](#L1488) | update\_user\_meta( $user\_id, '\_woocommerce\_ac\_modified\_cart', md5( 'no' ) ); |
| [1489](#L1489) | } |
| [1490](#L1490) | } else { |
| [1491](#L1491) | $updated\_cart\_info         = array(); |
| [1492](#L1492) | $updated\_cart\_info['cart'] = WC()->session->cart; |
| [1493](#L1493) | $updated\_cart\_info         = wp\_json\_encode( $updated\_cart\_info ); |
| [1494](#L1494) |  |
| [1495](#L1495) | $wpdb->query( //phpcs:ignore |
| [1496](#L1496) | $wpdb->prepare( |
| [1497](#L1497) | 'UPDATE `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` SET abandoned\_cart\_info = %s, abandoned\_cart\_time = %d WHERE user\_id      = %d AND   cart\_ignored = %s', |
| [1498](#L1498) | $updated\_cart\_info, |
| [1499](#L1499) | $current\_time, |
| [1500](#L1500) | $user\_id, |
| [1501](#L1501) | $cart\_ignored |
| [1502](#L1502) | ) |
| [1503](#L1503) | ); |
| [1504](#L1504) |  |
| [1505](#L1505) | $get\_abandoned\_record = $wpdb->get\_results( //phpcs:ignore |
| [1506](#L1506) | $wpdb->prepare( |
| [1507](#L1507) | 'SELECT \* FROM `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` WHERE user\_id = %d AND cart\_ignored = %s', |
| [1508](#L1508) | $user\_id, |
| [1509](#L1509) | 0 |
| [1510](#L1510) | ) |
| [1511](#L1511) | ); |
| [1512](#L1512) |  |
| [1513](#L1513) | if ( count( $get\_abandoned\_record ) > 0 ) { |
| [1514](#L1514) | $abandoned\_cart\_id = $get\_abandoned\_record[0]->id; |
| [1515](#L1515) | wcal\_common::wcal\_set\_cart\_session( 'abandoned\_cart\_id\_lite', $abandoned\_cart\_id ); |
| [1516](#L1516) | wcal\_common::wcal\_add\_checkout\_link( $abandoned\_cart\_id ); |
| [1517](#L1517) | wcal\_common::wcal\_run\_webhook\_after\_cutoff( $abandoned\_cart\_id ); |
| [1518](#L1518) | } |
| [1519](#L1519) | } |
| [1520](#L1520) | } |
| [1521](#L1521) | } else { |
| [1522](#L1522) | // start here guest user. |
| [1523](#L1523) | $user\_id = wcal\_common::wcal\_get\_cart\_session( 'user\_id' ); |
| [1524](#L1524) |  |
| [1525](#L1525) | // GDPR consent. |
| [1526](#L1526) | $gdpr\_consent  = true; |
| [1527](#L1527) | $show\_gdpr\_msg = wcal\_common::wcal\_get\_cart\_session( 'wcal\_cart\_tracking\_refused' ); |
| [1528](#L1528) | if ( isset( $show\_gdpr\_msg ) && 'yes' == $show\_gdpr\_msg ) { // phpcs:ignore |
| [1529](#L1529) | $gdpr\_consent = false; |
| [1530](#L1530) | } |
| [1531](#L1531) |  |
| [1532](#L1532) | if ( $gdpr\_consent ) { |
| [1533](#L1533) | $results = $wpdb->get\_results( //phpcs:ignore |
| [1534](#L1534) | $wpdb->prepare( |
| [1535](#L1535) | 'SELECT \* FROM `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` WHERE user\_id = %d AND cart\_ignored = %s AND recovered\_cart = %s AND user\_id != %s', |
| [1536](#L1536) | $user\_id, |
| [1537](#L1537) | 0, |
| [1538](#L1538) | 0, |
| [1539](#L1539) | 0 |
| [1540](#L1540) | ) |
| [1541](#L1541) | ); |
| [1542](#L1542) | $cart    = array(); |
| [1543](#L1543) |  |
| [1544](#L1544) | $get\_cookie = WC()->session->get\_customer\_id(); |
| [1545](#L1545) |  |
| [1546](#L1546) | if ( function\_exists( 'WC' ) ) { |
| [1547](#L1547) | $cart['cart'] = WC()->session->cart; |
| [1548](#L1548) | } else { |
| [1549](#L1549) | $cart['cart'] = $woocommerce->session->cart; |
| [1550](#L1550) | } |
| [1551](#L1551) |  |
| [1552](#L1552) | $updated\_cart\_info = wp\_json\_encode( $cart ); |
| [1553](#L1553) |  |
| [1554](#L1554) | if ( count( $results ) > 0 && '{"cart":[]}' !== $updated\_cart\_info ) { |
| [1555](#L1555) | if ( $compare\_time > $results[0]->abandoned\_cart\_time ) { |
| [1556](#L1556) | if ( ! $this->wcal\_compare\_only\_guest\_carts( $updated\_cart\_info, $results[0]->abandoned\_cart\_info ) ) { |
| [1557](#L1557) |  |
| [1558](#L1558) | $wpdb->query( //phpcs:ignore |
| [1559](#L1559) | $wpdb->prepare( |
| [1560](#L1560) | 'UPDATE `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` SET cart\_ignored = %s WHERE user\_id = %s', |
| [1561](#L1561) | 1, |
| [1562](#L1562) | $user\_id |
| [1563](#L1563) | ) |
| [1564](#L1564) | ); |
| [1565](#L1565) | $user\_type = 'GUEST'; |
| [1566](#L1566) | $wpdb->query( //phpcs:ignore |
| [1567](#L1567) | $wpdb->prepare( |
| [1568](#L1568) | 'INSERT INTO `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` (user\_id, abandoned\_cart\_info, abandoned\_cart\_time, cart\_ignored, user\_type, session\_id, checkout\_link) VALUES (%d, %s, %d, %s, %s, %s, %s)', |
| [1569](#L1569) | $user\_id, |
| [1570](#L1570) | $updated\_cart\_info, |
| [1571](#L1571) | $current\_time, |
| [1572](#L1572) | $cart\_ignored, |
| [1573](#L1573) | $user\_type, |
| [1574](#L1574) | $get\_cookie, |
| [1575](#L1575) | $results[0]->checkout\_link |
| [1576](#L1576) | ) |
| [1577](#L1577) | ); |
| [1578](#L1578) | update\_user\_meta( $user\_id, '\_woocommerce\_ac\_modified\_cart', md5( 'yes' ) ); |
| [1579](#L1579) | } else { |
| [1580](#L1580) | update\_user\_meta( $user\_id, '\_woocommerce\_ac\_modified\_cart', md5( 'no' ) ); |
| [1581](#L1581) | } |
| [1582](#L1582) | } else { |
| [1583](#L1583) | $wpdb->query( //phpcs:ignore |
| [1584](#L1584) | $wpdb->prepare( |
| [1585](#L1585) | 'UPDATE `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` SET abandoned\_cart\_info = %s, abandoned\_cart\_time = %s WHERE user\_id = %d AND cart\_ignored = %s', |
| [1586](#L1586) | $updated\_cart\_info, |
| [1587](#L1587) | $current\_time, |
| [1588](#L1588) | $user\_id, |
| [1589](#L1589) | 0 |
| [1590](#L1590) | ) |
| [1591](#L1591) | ); |
| [1592](#L1592) | } |
| [1593](#L1593) | } else { |
| [1594](#L1594) | // Here we capture the guest cart from the cart page @since 3.5. |
| [1595](#L1595) | if ( 'on' === $track\_guest\_user\_cart\_from\_cart && isset( $get\_cookie ) && '' !== $get\_cookie ) { |
| [1596](#L1596) | $results = $wpdb->get\_results( //phpcs:ignore |
| [1597](#L1597) | $wpdb->prepare( |
| [1598](#L1598) | 'SELECT \* FROM `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` WHERE session\_id LIKE %s AND cart\_ignored = %s AND recovered\_cart = %s', |
| [1599](#L1599) | $get\_cookie, |
| [1600](#L1600) | 0, |
| [1601](#L1601) | 0 |
| [1602](#L1602) | ) |
| [1603](#L1603) | ); |
| [1604](#L1604) | if ( 0 === count( $results ) ) { |
| [1605](#L1605) | $cart\_info       = $updated\_cart\_info; |
| [1606](#L1606) | $blank\_cart\_info = '[]'; |
| [1607](#L1607) | if ( $blank\_cart\_info !== $cart\_info && '{"cart":[]}' !== $cart\_info ) { |
| [1608](#L1608) | $wpdb->query( //phpcs:ignore |
| [1609](#L1609) | $wpdb->prepare( |
| [1610](#L1610) | 'INSERT INTO `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` ( abandoned\_cart\_info , abandoned\_cart\_time , cart\_ignored , recovered\_cart, user\_type, session\_id  ) VALUES ( %s, %s, %s, %s, %s, %s )', |
| [1611](#L1611) | $cart\_info, |
| [1612](#L1612) | $current\_time, |
| [1613](#L1613) | 0, |
| [1614](#L1614) | 0, |
| [1615](#L1615) | 'GUEST', |
| [1616](#L1616) | $get\_cookie |
| [1617](#L1617) | ) |
| [1618](#L1618) | ); |
| [1619](#L1619) | $abandoned\_cart\_id = $wpdb->insert\_id; |
| [1620](#L1620) | } |
| [1621](#L1621) | } elseif ( $compare\_time > $results[0]->abandoned\_cart\_time ) { |
| [1622](#L1622) | $blank\_cart\_info = '[]'; |
| [1623](#L1623) | if ( $blank\_cart\_info !== $updated\_cart\_info && '{"cart":[]}' !== $updated\_cart\_info ) { |
| [1624](#L1624) | if ( ! $this->wcal\_compare\_only\_guest\_carts( $updated\_cart\_info, $results[0]->abandoned\_cart\_info ) ) { |
| [1625](#L1625) | $wpdb->query( // phpcs:ignore |
| [1626](#L1626) | $wpdb->prepare( |
| [1627](#L1627) | 'UPDATE `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` SET cart\_ignored = %s WHERE session\_id = %s', |
| [1628](#L1628) | 1, |
| [1629](#L1629) | $get\_cookie |
| [1630](#L1630) | ) |
| [1631](#L1631) | ); |
| [1632](#L1632) | $wpdb->query( //phpcs:ignore |
| [1633](#L1633) | $wpdb->prepare( |
| [1634](#L1634) | 'INSERT INTO `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` ( abandoned\_cart\_info, abandoned\_cart\_time, cart\_ignored, recovered\_cart, user\_type, session\_id ) VALUES ( %s, %s, %s, %s, %s, %s )', |
| [1635](#L1635) | $updated\_cart\_info, |
| [1636](#L1636) | $current\_time, |
| [1637](#L1637) | 0, |
| [1638](#L1638) | 0, |
| [1639](#L1639) | 'GUEST', |
| [1640](#L1640) | $get\_cookie |
| [1641](#L1641) | ) |
| [1642](#L1642) | ); |
| [1643](#L1643) | $abandoned\_cart\_id = $wpdb->insert\_id; |
| [1644](#L1644) | } |
| [1645](#L1645) | } |
| [1646](#L1646) | } else { |
| [1647](#L1647) | $blank\_cart\_info = '[]'; |
| [1648](#L1648) | if ( $blank\_cart\_info !== $updated\_cart\_info && '{"cart":[]}' !== $updated\_cart\_info ) { |
| [1649](#L1649) | if ( ! $this->wcal\_compare\_only\_guest\_carts( $updated\_cart\_info, $results[0]->abandoned\_cart\_info ) ) { |
| [1650](#L1650) | $wpdb->query( //phpcs:ignore |
| [1651](#L1651) | $wpdb->prepare( |
| [1652](#L1652) | 'UPDATE `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` SET abandoned\_cart\_info = %s, abandoned\_cart\_time  = %s WHERE session\_id = %s AND cart\_ignored = %s', |
| [1653](#L1653) | $updated\_cart\_info, |
| [1654](#L1654) | $current\_time, |
| [1655](#L1655) | $get\_cookie, |
| [1656](#L1656) | 0 |
| [1657](#L1657) | ) |
| [1658](#L1658) | ); |
| [1659](#L1659) | } |
| [1660](#L1660) | } |
| [1661](#L1661) | } |
| [1662](#L1662) | if ( isset( $abandoned\_cart\_id ) ) { |
| [1663](#L1663) | // add the abandoned id in the session. |
| [1664](#L1664) | wcal\_common::wcal\_set\_cart\_session( 'abandoned\_cart\_id\_lite', $abandoned\_cart\_id ); |
| [1665](#L1665) | } |
| [1666](#L1666) | } |
| [1667](#L1667) | } |
| [1668](#L1668) | } |
| [1669](#L1669) | } |
| [1670](#L1670) | } |
| [1671](#L1671) |  |
| [1672](#L1672) | /\*\* |
| [1673](#L1673) | \* Detect Crawlers |
| [1674](#L1674) | \* |
| [1675](#L1675) | \* @param boolean $ignore - Ignore. |
| [1676](#L1676) | \* @return boolean $ignore - Ignore. |
| [1677](#L1677) | \*/ |
| [1678](#L1678) | public function wcal\_detect\_crawlers( $ignore ) { |
| [1679](#L1679) | $user\_agent = isset( $\_SERVER['HTTP\_USER\_AGENT'] ) ? sanitize\_text\_field( wp\_unslash( $\_SERVER['HTTP\_USER\_AGENT'] ) ) : ''; |
| [1680](#L1680) |  |
| [1681](#L1681) | if ( '' === $user\_agent ) { |
| [1682](#L1682) | return $ignore; |
| [1683](#L1683) | } |
| [1684](#L1684) |  |
| [1685](#L1685) | // Current list of bots being blocked: |
| [1686](#L1686) | // 1. Googlebot, BingBot, DuckDuckBot, YandexBot, Exabot. |
| [1687](#L1687) | // 2. cURL. |
| [1688](#L1688) | // 3. wget. |
| [1689](#L1689) | // 4. Yahoo/Slurp. |
| [1690](#L1690) | // 5. Baiduspider. |
| [1691](#L1691) | // 6. Sogou. |
| [1692](#L1692) | // 7. Alexa. |
| [1693](#L1693) | $bot\_agents = array( |
| [1694](#L1694) | 'curl', |
| [1695](#L1695) | 'wget', |
| [1696](#L1696) | 'bot', |
| [1697](#L1697) | 'bots', |
| [1698](#L1698) | 'slurp', |
| [1699](#L1699) | 'baiduspider', |
| [1700](#L1700) | 'sogou', |
| [1701](#L1701) | 'ia\_archiver', |
| [1702](#L1702) | ); |
| [1703](#L1703) |  |
| [1704](#L1704) | foreach ( $bot\_agents as $url ) { |
| [1705](#L1705) | if ( false !== stripos( $user\_agent, $url ) ) { |
| [1706](#L1706) | return true; |
| [1707](#L1707) | } |
| [1708](#L1708) | } |
| [1709](#L1709) |  |
| [1710](#L1710) | return $ignore; |
| [1711](#L1711) | } |
| [1712](#L1712) |  |
| [1713](#L1713) | /\*\* |
| [1714](#L1714) | \* It will unsubscribe the abandoned cart, so user will not recieve further abandoned cart emails. |
| [1715](#L1715) | \* |
| [1716](#L1716) | \* @hook template\_include |
| [1717](#L1717) | \* @param string $args Arguments. |
| [1718](#L1718) | \* @return string $args Arguments. |
| [1719](#L1719) | \* @globals mixed $wpdb |
| [1720](#L1720) | \* @since 2.9 |
| [1721](#L1721) | \*/ |
| [1722](#L1722) | public function wcal\_email\_unsubscribe( $args ) { |
| [1723](#L1723) | global $wpdb; |
| [1724](#L1724) |  |
| [1725](#L1725) | if ( isset( $\_GET['wcal\_track\_unsubscribe'] ) && 'wcal\_unsubscribe' === sanitize\_text\_field( wp\_unslash( $\_GET['wcal\_track\_unsubscribe'] ) ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [1726](#L1726) | $encoded\_email\_id              = isset( $\_GET['validate'] ) ? rawurldecode( sanitize\_text\_field( wp\_unslash( $\_GET['validate'] ) ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [1727](#L1727) | $validate\_email\_id\_string      = str\_replace( ' ', '+', $encoded\_email\_id ); |
| [1728](#L1728) | $validate\_email\_address\_string = ''; |
| [1729](#L1729) | $validate\_email\_id\_decode      = 0; |
| [1730](#L1730) | $crypt\_key                     = get\_option( 'wcal\_security\_key' ); |
| [1731](#L1731) | $validate\_email\_id\_decode      = Wcal\_Aes\_Ctr::decrypt( $validate\_email\_id\_string, $crypt\_key, 256 ); |
| [1732](#L1732) | if ( isset( $\_GET['track\_email\_id'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [1733](#L1733) | $encoded\_email\_address         = rawurldecode( sanitize\_text\_field( wp\_unslash( $\_GET['track\_email\_id'] ) ) ); // phpcs:ignore WordPress.Security.NonceVerification |
| [1734](#L1734) | $validate\_email\_address\_string = str\_replace( ' ', '+', $encoded\_email\_address ); |
| [1735](#L1735) | } |
| [1736](#L1736) |  |
| [1737](#L1737) | $results\_sent  = $wpdb->get\_results( //phpcs:ignore |
| [1738](#L1738) | $wpdb->prepare( |
| [1739](#L1739) | 'SELECT \* FROM `' . $wpdb->prefix . 'ac\_sent\_history\_lite` WHERE id = %d ', |
| [1740](#L1740) | $validate\_email\_id\_decode |
| [1741](#L1741) | ) |
| [1742](#L1742) | ); |
| [1743](#L1743) | $email\_address = ''; |
| [1744](#L1744) | if ( isset( $results\_sent[0] ) ) { |
| [1745](#L1745) | $email\_address = $results\_sent[0]->sent\_email\_id; |
| [1746](#L1746) | } |
| [1747](#L1747) | if ( hash( 'sha256', $email\_address ) === $validate\_email\_address\_string && '' !== $email\_address ) { |
| [1748](#L1748) | $email\_sent\_id     = $validate\_email\_id\_decode; |
| [1749](#L1749) | $get\_ac\_id\_results = $wpdb->get\_results( //phpcs:ignore |
| [1750](#L1750) | $wpdb->prepare( |
| [1751](#L1751) | 'SELECT abandoned\_order\_id FROM `' . $wpdb->prefix . 'ac\_sent\_history\_lite` WHERE id = %d', |
| [1752](#L1752) | $email\_sent\_id |
| [1753](#L1753) | ) |
| [1754](#L1754) | ); |
| [1755](#L1755) | $user\_id           = 0; |
| [1756](#L1756) | if ( isset( $get\_ac\_id\_results[0] ) ) { |
| [1757](#L1757) | $get\_user\_results  = $wpdb->get\_results( //phpcs:ignore |
| [1758](#L1758) | $wpdb->prepare( |
| [1759](#L1759) | 'SELECT user\_id FROM `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` WHERE id = %d', |
| [1760](#L1760) | $get\_ac\_id\_results[0]->abandoned\_order\_id |
| [1761](#L1761) | ) |
| [1762](#L1762) | ); |
| [1763](#L1763) | } |
| [1764](#L1764) | if ( isset( $get\_user\_results[0] ) ) { |
| [1765](#L1765) | $user\_id = $get\_user\_results[0]->user\_id; |
| [1766](#L1766) | } |
| [1767](#L1767) |  |
| [1768](#L1768) | $wpdb->query( //phpcs:ignore |
| [1769](#L1769) | $wpdb->prepare( |
| [1770](#L1770) | 'UPDATE `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` SET unsubscribe\_link = %s WHERE user\_id= %d AND cart\_ignored = %s', |
| [1771](#L1771) | 1, |
| [1772](#L1772) | $user\_id, |
| [1773](#L1773) | 0 |
| [1774](#L1774) | ) |
| [1775](#L1775) | ); |
| [1776](#L1776) | echo esc\_html( 'Unsubscribed Successfully' ); |
| [1777](#L1777) | sleep( 2 ); |
| [1778](#L1778) | $url = apply\_filters( 'wcal\_unsubscribe\_redirect', get\_option( 'home' ) ); |
| [1779](#L1779) | ?> |
| [1780](#L1780) | <script> |
| [1781](#L1781) | location.href = "<?php echo esc\_url( $url ); ?>"; |
| [1782](#L1782) | </script> |
| [1783](#L1783) | <?php |
| [1784](#L1784) | } |
| [1785](#L1785) | } else { |
| [1786](#L1786) | return $args; |
| [1787](#L1787) | } |
| [1788](#L1788) | } |
| [1789](#L1789) |  |
| [1790](#L1790) | /\*\* |
| [1791](#L1791) | \* It will track the URL of cart link from email, and it will populate the logged-in and guest users cart. |
| [1792](#L1792) | \* |
| [1793](#L1793) | \* @hook template\_include |
| [1794](#L1794) | \* @param string $template - Template name. |
| [1795](#L1795) | \* @return string $template - Template name. |
| [1796](#L1796) | \* @globals mixed $wpdb |
| [1797](#L1797) | \* @globals mixed $woocommerce |
| [1798](#L1798) | \* @since 1.0 |
| [1799](#L1799) | \*/ |
| [1800](#L1800) | public function wcal\_email\_track\_links( $template ) { |
| [1801](#L1801) | global $woocommerce; |
| [1802](#L1802) |  |
| [1803](#L1803) | $track\_link = isset( $\_GET['wcal\_action'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['wcal\_action'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [1804](#L1804) |  |
| [1805](#L1805) | if ( 'track\_links' === $track\_link || 'checkout\_link' === $track\_link ) { |
| [1806](#L1806) | if ( '' === session\_id() ) { |
| [1807](#L1807) | // session has not started. |
| [1808](#L1808) | session\_start(); |
| [1809](#L1809) | } |
| [1810](#L1810) | global $wpdb; |
| [1811](#L1811) | $validate\_server\_string  = isset( $\_GET ['validate'] ) ? rawurldecode( wp\_unslash( $\_GET ['validate'] ) ) : ''; // phpcs:ignore |
| [1812](#L1812) | $validate\_server\_string  = str\_replace( ' ', '+', $validate\_server\_string ); |
| [1813](#L1813) | $validate\_encoded\_string = $validate\_server\_string; |
| [1814](#L1814) | $crypt\_key               = get\_option( 'wcal\_security\_key' ); |
| [1815](#L1815) | $link\_decode             = Wcal\_Aes\_Ctr::decrypt( $validate\_encoded\_string, $crypt\_key, 256 ); |
| [1816](#L1816) | $sent\_email\_id\_pos       = strpos( $link\_decode, '&' ); |
| [1817](#L1817) | $email\_sent\_id           = substr( $link\_decode, 0, $sent\_email\_id\_pos ); |
| [1818](#L1818) |  |
| [1819](#L1819) | if ( isset( $\_GET['c'] ) ) { // phpcs:ignore |
| [1820](#L1820) | $decrypt\_coupon\_code = rawurldecode( sanitize\_text\_field( wp\_unslash( $\_GET['c'] ) ) ); //phpcs:ignore |
| [1821](#L1821) | $decrypt\_coupon\_code = str\_replace( ' ', '+', $decrypt\_coupon\_code ); |
| [1822](#L1822) | $decode\_coupon\_code  = Wcal\_Aes\_Ctr::decrypt( $decrypt\_coupon\_code, $crypt\_key, 256 ); |
| [1823](#L1823) |  |
| [1824](#L1824) | wcal\_common::wcal\_set\_cart\_session( 'wcal\_c', $decode\_coupon\_code ); // we need to set in session coz we directly apply coupon. |
| [1825](#L1825) | set\_transient( 'wcal\_c', $decode\_coupon\_code, 5 ); |
| [1826](#L1826) | } else { |
| [1827](#L1827) | $decode\_coupon\_code = ''; |
| [1828](#L1828) | } |
| [1829](#L1829) |  |
| [1830](#L1830) | if ( 'track\_links' === $track\_link ) { |
| [1831](#L1831) | $email\_sent\_id     = 0; |
| [1832](#L1832) | $sent\_email\_id\_pos = strpos( $link\_decode, '&' ); |
| [1833](#L1833) | $email\_sent\_id     = substr( $link\_decode, 0, $sent\_email\_id\_pos ); |
| [1834](#L1834) |  |
| [1835](#L1835) | wcal\_common::wcal\_set\_cart\_session( 'email\_sent\_id', $email\_sent\_id ); |
| [1836](#L1836) | set\_transient( 'wcal\_email\_sent\_id', $email\_sent\_id, 5 ); |
| [1837](#L1837) |  |
| [1838](#L1838) | $get\_ac\_id\_results = $wpdb->get\_results( // phpcs:ignore |
| [1839](#L1839) | $wpdb->prepare( |
| [1840](#L1840) | 'SELECT abandoned\_order\_id FROM `' . $wpdb->prefix . 'ac\_sent\_history\_lite` WHERE id = %d', |
| [1841](#L1841) | $email\_sent\_id |
| [1842](#L1842) | ) |
| [1843](#L1843) | ); |
| [1844](#L1844) | $abandoned\_id      = $get\_ac\_id\_results[0]->abandoned\_order\_id; |
| [1845](#L1845) | } elseif ( 'checkout\_link' === $track\_link ) { |
| [1846](#L1846) | $abandoned\_id     = 0; |
| [1847](#L1847) | $abandoned\_id\_pos = strpos( $link\_decode, '&' ); |
| [1848](#L1848) | $abandoned\_id     = substr( $link\_decode, 0, $abandoned\_id\_pos ); |
| [1849](#L1849) | wcal\_common::wcal\_set\_cart\_session( 'wcal\_recovered\_cart', true ); |
| [1850](#L1850) | } |
| [1851](#L1851) |  |
| [1852](#L1852) | $url\_pos = strpos( $link\_decode, '=' ); |
| [1853](#L1853) | ++$url\_pos; |
| [1854](#L1854) | $url = substr( $link\_decode, $url\_pos ); |
| [1855](#L1855) |  |
| [1856](#L1856) | wcal\_common::wcal\_set\_cart\_session( 'abandoned\_cart\_id\_lite', $abandoned\_id ); |
| [1857](#L1857) | set\_transient( 'wcal\_abandoned\_id', $abandoned\_id, 5 ); |
| [1858](#L1858) |  |
| [1859](#L1859) | $get\_user\_results = array(); |
| [1860](#L1860) | if ( $abandoned\_id > 0 ) { |
| [1861](#L1861) | $get\_user\_results  = $wpdb->get\_results( //phpcs:ignore |
| [1862](#L1862) | $wpdb->prepare( |
| [1863](#L1863) | 'SELECT user\_id FROM `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` WHERE id = %d', |
| [1864](#L1864) | $abandoned\_id |
| [1865](#L1865) | ) |
| [1866](#L1866) | ); |
| [1867](#L1867) | } |
| [1868](#L1868) | $user\_id = isset( $get\_user\_results ) && count( $get\_user\_results ) > 0 ? (int) $get\_user\_results[0]->user\_id : 0; |
| [1869](#L1869) |  |
| [1870](#L1870) | if ( 0 === $user\_id ) { |
| [1871](#L1871) | echo esc\_html( 'Link expired' ); |
| [1872](#L1872) | exit; |
| [1873](#L1873) | } |
| [1874](#L1874) | $user = wp\_set\_current\_user( $user\_id ); |
| [1875](#L1875) | if ( $user\_id >= '63000000' ) { |
| [1876](#L1876) | $results\_guest = $wpdb->get\_results( //phpcs:ignore |
| [1877](#L1877) | $wpdb->prepare( |
| [1878](#L1878) | 'SELECT \* from `' . $wpdb->prefix . 'ac\_guest\_abandoned\_cart\_history\_lite` WHERE id = %d', |
| [1879](#L1879) | $user\_id |
| [1880](#L1880) | ) |
| [1881](#L1881) | ); |
| [1882](#L1882) |  |
| [1883](#L1883) | $results = $wpdb->get\_results( //phpcs:ignore |
| [1884](#L1884) | $wpdb->prepare( |
| [1885](#L1885) | 'SELECT recovered\_cart FROM `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` WHERE user\_id = %d', |
| [1886](#L1886) | $user\_id |
| [1887](#L1887) | ) |
| [1888](#L1888) | ); |
| [1889](#L1889) | if ( $results\_guest && '0' == $results[0]->recovered\_cart ) { // phpcs:ignore |
| [1890](#L1890) | wcal\_common::wcal\_set\_cart\_session( 'guest\_first\_name', $results\_guest[0]->billing\_first\_name ); |
| [1891](#L1891) | wcal\_common::wcal\_set\_cart\_session( 'guest\_last\_name', $results\_guest[0]->billing\_last\_name ); |
| [1892](#L1892) | wcal\_common::wcal\_set\_cart\_session( 'guest\_email', $results\_guest[0]->email\_id ); |
| [1893](#L1893) | wcal\_common::wcal\_set\_cart\_session( 'user\_id', $user\_id ); |
| [1894](#L1894) | } else { |
| [1895](#L1895) | if ( version\_compare( $woocommerce->version, '3.0.0', '>=' ) ) { |
| [1896](#L1896) | wp\_safe\_redirect( get\_permalink( wc\_get\_page\_id( 'shop' ) ) ); |
| [1897](#L1897) | exit; |
| [1898](#L1898) | } else { |
| [1899](#L1899) | wp\_safe\_redirect( get\_permalink( woocommerce\_get\_page\_id( 'shop' ) ) ); |
| [1900](#L1900) | exit; |
| [1901](#L1901) | } |
| [1902](#L1902) | } |
| [1903](#L1903) | } |
| [1904](#L1904) |  |
| [1905](#L1905) | if ( $user\_id < '63000000' ) { |
| [1906](#L1906) | $user\_login = $user->data->user\_login; |
| [1907](#L1907) | wp\_set\_auth\_cookie( $user\_id ); |
| [1908](#L1908) | $my\_temp = wc\_load\_persistent\_cart( $user\_login, $user ); |
| [1909](#L1909) | do\_action( 'wp\_login', $user\_login, $user ); |
| [1910](#L1910) | if ( isset( $sign\_in ) && is\_wp\_error( $sign\_in ) ) { |
| [1911](#L1911) | echo esc\_html( $sign\_in->get\_error\_message() ); |
| [1912](#L1912) | exit; |
| [1913](#L1913) | } |
| [1914](#L1914) | } else { |
| [1915](#L1915) | $my\_temp = $this->wcal\_load\_guest\_persistent\_cart( $user\_id ); |
| [1916](#L1916) | } |
| [1917](#L1917) |  |
| [1918](#L1918) | if ( $email\_sent\_id > 0 && is\_numeric( $email\_sent\_id ) ) { |
| [1919](#L1919) | wp\_safe\_redirect( $url ); |
| [1920](#L1920) | exit; |
| [1921](#L1921) | } |
| [1922](#L1922) | } else { |
| [1923](#L1923) | return $template; |
| [1924](#L1924) | } |
| [1925](#L1925) | } |
| [1926](#L1926) |  |
| [1927](#L1927) | /\*\* |
| [1928](#L1928) | \* When customer clicks on the abandoned cart link and that cart is for the the guest users the it will load the guest |
| [1929](#L1929) | \* user's cart detail. |
| [1930](#L1930) | \* |
| [1931](#L1931) | \* @globals mixed $woocommerce |
| [1932](#L1932) | \* @since 1.0 |
| [1933](#L1933) | \*/ |
| [1934](#L1934) | public function wcal\_load\_guest\_persistent\_cart() { |
| [1935](#L1935) | if ( wcal\_common::wcal\_get\_cart\_session( 'user\_id' ) != '' ) { // phpcs:ignore |
| [1936](#L1936) | global $woocommerce; |
| [1937](#L1937) | $saved\_cart = json\_decode( get\_user\_meta( wcal\_common::wcal\_get\_cart\_session( 'user\_id' ), '\_woocommerce\_persistent\_cart', true ), true ); |
| [1938](#L1938) | $c          = array(); |
| [1939](#L1939) |  |
| [1940](#L1940) | $cart\_contents\_total  = 0; |
| [1941](#L1941) | $cart\_contents\_weight = 0; |
| [1942](#L1942) | $cart\_contents\_count  = 0; |
| [1943](#L1943) | $cart\_contents\_tax    = 0; |
| [1944](#L1944) | $total                = 0; |
| [1945](#L1945) | $subtotal             = 0; |
| [1946](#L1946) | $subtotal\_ex\_tax      = 0; |
| [1947](#L1947) | $tax\_total            = 0; |
| [1948](#L1948) | if ( count( $saved\_cart ) > 0 ) { |
| [1949](#L1949) | foreach ( $saved\_cart as $key => $value ) { |
| [1950](#L1950) | if ( count( $value ) > 0 ) { |
| [1951](#L1951) | foreach ( $value as $a => $b ) { |
| [1952](#L1952) | $c['product\_id']        = $b['product\_id']; |
| [1953](#L1953) | $c['variation\_id']      = $b['variation\_id']; |
| [1954](#L1954) | $c['variation']         = $b['variation']; |
| [1955](#L1955) | $c['quantity']          = $b['quantity']; |
| [1956](#L1956) | $product\_id             = $b['product\_id']; |
| [1957](#L1957) | $c['data']              = wc\_get\_product( $product\_id ); |
| [1958](#L1958) | $c['line\_total']        = $b['line\_total']; |
| [1959](#L1959) | $c['line\_tax']          = $cart\_contents\_tax; |
| [1960](#L1960) | $c['line\_subtotal']     = $b['line\_subtotal']; |
| [1961](#L1961) | $c['line\_subtotal\_tax'] = $cart\_contents\_tax; |
| [1962](#L1962) | $value\_new[ $a ]        = $c; |
| [1963](#L1963) | $cart\_contents\_total    = $b['line\_subtotal'] + $cart\_contents\_total; |
| [1964](#L1964) | $cart\_contents\_count    = $cart\_contents\_count + $b['quantity']; |
| [1965](#L1965) | $total                  = $total + $b['line\_total']; |
| [1966](#L1966) | $subtotal               = $subtotal + $b['line\_subtotal']; |
| [1967](#L1967) | $subtotal\_ex\_tax        = $subtotal\_ex\_tax + $b['line\_subtotal']; |
| [1968](#L1968) | } |
| [1969](#L1969) | $saved\_cart\_data[ $key ] = $value\_new; |
| [1970](#L1970) | $woocommerce\_cart\_hash   = $a; |
| [1971](#L1971) | } |
| [1972](#L1972) | } |
| [1973](#L1973) | } |
| [1974](#L1974) |  |
| [1975](#L1975) | if ( $saved\_cart ) { |
| [1976](#L1976) | if ( empty( $woocommerce->session->cart ) || ! is\_array( $woocommerce->session->cart ) || 0 === count( $woocommerce->session->cart ) ) { |
| [1977](#L1977) | $woocommerce->session->cart                 = $saved\_cart['cart']; |
| [1978](#L1978) | $woocommerce->session->cart\_contents\_total  = $cart\_contents\_total; |
| [1979](#L1979) | $woocommerce->session->cart\_contents\_weight = $cart\_contents\_weight; |
| [1980](#L1980) | $woocommerce->session->cart\_contents\_count  = $cart\_contents\_count; |
| [1981](#L1981) | $woocommerce->session->cart\_contents\_tax    = $cart\_contents\_tax; |
| [1982](#L1982) | $woocommerce->session->total                = $total; |
| [1983](#L1983) | $woocommerce->session->subtotal             = $subtotal; |
| [1984](#L1984) | $woocommerce->session->subtotal\_ex\_tax      = $subtotal\_ex\_tax; |
| [1985](#L1985) | $woocommerce->session->tax\_total            = $tax\_total; |
| [1986](#L1986) | $woocommerce->session->shipping\_taxes       = array(); |
| [1987](#L1987) | $woocommerce->session->taxes                = array(); |
| [1988](#L1988) | $woocommerce->session->ac\_customer          = array(); |
| [1989](#L1989) | $woocommerce->cart->cart\_contents           = $saved\_cart\_data['cart']; |
| [1990](#L1990) | $woocommerce->cart->cart\_contents\_total     = $cart\_contents\_total; |
| [1991](#L1991) | $woocommerce->cart->cart\_contents\_weight    = $cart\_contents\_weight; |
| [1992](#L1992) | $woocommerce->cart->cart\_contents\_count     = $cart\_contents\_count; |
| [1993](#L1993) | $woocommerce->cart->cart\_contents\_tax       = $cart\_contents\_tax; |
| [1994](#L1994) | $woocommerce->cart->total                   = $total; |
| [1995](#L1995) | $woocommerce->cart->subtotal                = $subtotal; |
| [1996](#L1996) | $woocommerce->cart->subtotal\_ex\_tax         = $subtotal\_ex\_tax; |
| [1997](#L1997) | $woocommerce->cart->tax\_total               = $tax\_total; |
| [1998](#L1998) | } |
| [1999](#L1999) | } |
| [2000](#L2000) | } |
| [2001](#L2001) | } |
| [2002](#L2002) |  |
| [2003](#L2003) | /\*\* |
| [2004](#L2004) | \* It will compare only guest users cart while capturing the cart. |
| [2005](#L2005) | \* |
| [2006](#L2006) | \* @param json\_encode $new\_cart New abandoned cart details. |
| [2007](#L2007) | \* @param json\_encode $last\_abandoned\_cart Old abandoned cart details. |
| [2008](#L2008) | \* @return boolean true | false. |
| [2009](#L2009) | \* @since 1.0 |
| [2010](#L2010) | \*/ |
| [2011](#L2011) | public function wcal\_compare\_only\_guest\_carts( $new\_cart, $last\_abandoned\_cart ) { |
| [2012](#L2012) | $current\_woo\_cart   = array(); |
| [2013](#L2013) | $current\_woo\_cart   = json\_decode( stripslashes( $new\_cart ), true ); |
| [2014](#L2014) | $abandoned\_cart\_arr = array(); |
| [2015](#L2015) | $abandoned\_cart\_arr = json\_decode( $last\_abandoned\_cart, true ); |
| [2016](#L2016) | $temp\_variable      = ''; |
| [2017](#L2017) | if ( isset( $current\_woo\_cart['cart'] ) && isset( $abandoned\_cart\_arr['cart'] ) ) { |
| [2018](#L2018) | if ( count( $current\_woo\_cart['cart'] ) >= count( $abandoned\_cart\_arr['cart'] ) ) { // phpcs:ignore |
| [2019](#L2019) | // do nothing. |
| [2020](#L2020) | } else { |
| [2021](#L2021) | $temp\_variable      = $current\_woo\_cart; |
| [2022](#L2022) | $current\_woo\_cart   = $abandoned\_cart\_arr; |
| [2023](#L2023) | $abandoned\_cart\_arr = $temp\_variable; |
| [2024](#L2024) | } |
| [2025](#L2025) | if ( is\_array( $current\_woo\_cart ) || is\_object( $current\_woo\_cart ) ) { |
| [2026](#L2026) | foreach ( $current\_woo\_cart as $key => $value ) { |
| [2027](#L2027) | foreach ( $value as $item\_key => $item\_value ) { |
| [2028](#L2028) | $current\_cart\_product\_id   = $item\_value['product\_id']; |
| [2029](#L2029) | $current\_cart\_variation\_id = $item\_value['variation\_id']; |
| [2030](#L2030) | $current\_cart\_quantity     = $item\_value['quantity']; |
| [2031](#L2031) |  |
| [2032](#L2032) | if ( isset( $abandoned\_cart\_arr[ $key ][ $item\_key ]['product\_id'] ) ) { |
| [2033](#L2033) | $abandoned\_cart\_product\_id = $abandoned\_cart\_arr[ $key ][ $item\_key ]['product\_id']; |
| [2034](#L2034) | } else { |
| [2035](#L2035) | $abandoned\_cart\_product\_id = ''; |
| [2036](#L2036) | } |
| [2037](#L2037) | if ( isset( $abandoned\_cart\_arr[ $key ][ $item\_key ]['variation\_id'] ) ) { |
| [2038](#L2038) | $abandoned\_cart\_variation\_id = $abandoned\_cart\_arr[ $key ][ $item\_key ]['variation\_id']; |
| [2039](#L2039) | } else { |
| [2040](#L2040) | $abandoned\_cart\_variation\_id = ''; |
| [2041](#L2041) | } |
| [2042](#L2042) | if ( isset( $abandoned\_cart\_arr[ $key ][ $item\_key ]['quantity'] ) ) { |
| [2043](#L2043) | $abandoned\_cart\_quantity = $abandoned\_cart\_arr[ $key ][ $item\_key ]['quantity']; |
| [2044](#L2044) | } else { |
| [2045](#L2045) | $abandoned\_cart\_quantity = ''; |
| [2046](#L2046) | } |
| [2047](#L2047) | if ( ( $current\_cart\_product\_id != $abandoned\_cart\_product\_id ) || ( $current\_cart\_variation\_id != $abandoned\_cart\_variation\_id ) || ( $current\_cart\_quantity != $abandoned\_cart\_quantity ) ) { // phpcs:ignore |
| [2048](#L2048) | return false; |
| [2049](#L2049) | } |
| [2050](#L2050) | } |
| [2051](#L2051) | } |
| [2052](#L2052) | } |
| [2053](#L2053) | } |
| [2054](#L2054) | return true; |
| [2055](#L2055) | } |
| [2056](#L2056) |  |
| [2057](#L2057) | /\*\* |
| [2058](#L2058) | \* It will compare only loggedin users cart while capturing the cart. |
| [2059](#L2059) | \* |
| [2060](#L2060) | \* @param int | string $user\_id User id. |
| [2061](#L2061) | \* @param json\_encode  $last\_abandoned\_cart Old abandoned cart details. |
| [2062](#L2062) | \* @return boolean true | false. |
| [2063](#L2063) | \* @since 1.0 |
| [2064](#L2064) | \*/ |
| [2065](#L2065) | public function wcal\_compare\_carts( $user\_id, $last\_abandoned\_cart ) { |
| [2066](#L2066) | global $woocommerce; |
| [2067](#L2067) | $current\_woo\_cart                 = array(); |
| [2068](#L2068) | $abandoned\_cart\_arr               = array(); |
| [2069](#L2069) | $wcal\_woocommerce\_persistent\_cart = version\_compare( $woocommerce->version, '3.1.0', '>=' ) ? '\_woocommerce\_persistent\_cart\_' . get\_current\_blog\_id() : '\_woocommerce\_persistent\_cart'; |
| [2070](#L2070) | $current\_woo\_cart                 = get\_user\_meta( $user\_id, $wcal\_woocommerce\_persistent\_cart, true ); |
| [2071](#L2071) | $abandoned\_cart\_arr               = json\_decode( $last\_abandoned\_cart, true ); |
| [2072](#L2072) | $temp\_variable                    = ''; |
| [2073](#L2073) | if ( isset( $current\_woo\_cart['cart'] ) && isset( $abandoned\_cart\_arr['cart'] ) ) { |
| [2074](#L2074) | if ( count( $current\_woo\_cart['cart'] ) >= count( $abandoned\_cart\_arr['cart'] ) ) { // phpcs:ignore |
| [2075](#L2075) | // do nothing. |
| [2076](#L2076) | } else { |
| [2077](#L2077) | $temp\_variable      = $current\_woo\_cart; |
| [2078](#L2078) | $current\_woo\_cart   = $abandoned\_cart\_arr; |
| [2079](#L2079) | $abandoned\_cart\_arr = $temp\_variable; |
| [2080](#L2080) | } |
| [2081](#L2081) | if ( is\_array( $current\_woo\_cart ) && is\_array( $abandoned\_cart\_arr ) ) { |
| [2082](#L2082) | foreach ( $current\_woo\_cart as $key => $value ) { |
| [2083](#L2083) |  |
| [2084](#L2084) | foreach ( $value as $item\_key => $item\_value ) { |
| [2085](#L2085) | $current\_cart\_product\_id   = $item\_value['product\_id']; |
| [2086](#L2086) | $current\_cart\_variation\_id = $item\_value['variation\_id']; |
| [2087](#L2087) | $current\_cart\_quantity     = $item\_value['quantity']; |
| [2088](#L2088) |  |
| [2089](#L2089) | if ( isset( $abandoned\_cart\_arr[ $key ][ $item\_key ]['product\_id'] ) ) { |
| [2090](#L2090) | $abandoned\_cart\_product\_id = $abandoned\_cart\_arr[ $key ][ $item\_key ]['product\_id']; |
| [2091](#L2091) | } else { |
| [2092](#L2092) | $abandoned\_cart\_product\_id = ''; |
| [2093](#L2093) | } |
| [2094](#L2094) | if ( isset( $abandoned\_cart\_arr[ $key ][ $item\_key ]['variation\_id'] ) ) { |
| [2095](#L2095) | $abandoned\_cart\_variation\_id = $abandoned\_cart\_arr[ $key ][ $item\_key ]['variation\_id']; |
| [2096](#L2096) | } else { |
| [2097](#L2097) | $abandoned\_cart\_variation\_id = ''; |
| [2098](#L2098) | } |
| [2099](#L2099) | if ( isset( $abandoned\_cart\_arr[ $key ][ $item\_key ]['quantity'] ) ) { |
| [2100](#L2100) | $abandoned\_cart\_quantity = $abandoned\_cart\_arr[ $key ][ $item\_key ]['quantity']; |
| [2101](#L2101) | } else { |
| [2102](#L2102) | $abandoned\_cart\_quantity = ''; |
| [2103](#L2103) | } |
| [2104](#L2104) | if ( ( $current\_cart\_product\_id != $abandoned\_cart\_product\_id ) || ( $current\_cart\_variation\_id != $abandoned\_cart\_variation\_id ) || ( $current\_cart\_quantity != $abandoned\_cart\_quantity ) ) { // phpcs:ignore |
| [2105](#L2105) | return false; |
| [2106](#L2106) | } |
| [2107](#L2107) | } |
| [2108](#L2108) | } |
| [2109](#L2109) | } |
| [2110](#L2110) | } |
| [2111](#L2111) | return true; |
| [2112](#L2112) | } |
| [2113](#L2113) |  |
| [2114](#L2114) | /\*\* |
| [2115](#L2115) | \* It will add the wp editor for email body on the email edit page. |
| [2116](#L2116) | \* |
| [2117](#L2117) | \* @hook admin\_init |
| [2118](#L2118) | \* @since 2.6 |
| [2119](#L2119) | \*/ |
| [2120](#L2120) | public function wcal\_action\_admin\_init() { |
| [2121](#L2121) |  |
| [2122](#L2122) | // only hook up these filters if we're in the admin panel and the current user has permission. |
| [2123](#L2123) | // to edit posts and pages. |
| [2124](#L2124) | if ( ! isset( $\_GET['page'] ) || 'woocommerce\_ac\_page' !== sanitize\_text\_field( wp\_unslash( $\_GET['page'] ) ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [2125](#L2125) | return; |
| [2126](#L2126) | } |
| [2127](#L2127) | if ( ! current\_user\_can( 'edit\_posts' ) && ! current\_user\_can( 'edit\_pages' ) ) { |
| [2128](#L2128) | return; |
| [2129](#L2129) | } |
| [2130](#L2130) | if ( 'true' === get\_user\_option( 'rich\_editing' ) ) { |
| [2131](#L2131) | remove\_filter( 'the\_excerpt', 'wpautop' ); |
| [2132](#L2132) | add\_filter( 'tiny\_mce\_before\_init', array( &$this, 'wcal\_format\_tiny\_mce' ) ); |
| [2133](#L2133) | add\_filter( 'mce\_buttons', array( &$this, 'wcal\_filter\_mce\_button' ) ); |
| [2134](#L2134) | add\_filter( 'mce\_external\_plugins', array( &$this, 'wcal\_filter\_mce\_plugin' ) ); |
| [2135](#L2135) | } |
| [2136](#L2136) | } |
| [2137](#L2137) |  |
| [2138](#L2138) | /\*\* |
| [2139](#L2139) | \* It will create a button on the WordPress editor. |
| [2140](#L2140) | \* |
| [2141](#L2141) | \* @hook mce\_buttons |
| [2142](#L2142) | \* @param array $buttons - List of buttons. |
| [2143](#L2143) | \* @return array $buttons - List of buttons. |
| [2144](#L2144) | \* @since 2.6 |
| [2145](#L2145) | \*/ |
| [2146](#L2146) | public function wcal\_filter\_mce\_button( $buttons ) { |
| [2147](#L2147) | // add a separation before our button, here our button's id is abandoncart. |
| [2148](#L2148) | array\_push( $buttons, 'abandoncart', '|' ); |
| [2149](#L2149) | return $buttons; |
| [2150](#L2150) | } |
| [2151](#L2151) |  |
| [2152](#L2152) | /\*\* |
| [2153](#L2153) | \* It will add the list for the added extra button. |
| [2154](#L2154) | \* |
| [2155](#L2155) | \* @hook mce\_external\_plugins |
| [2156](#L2156) | \* @param array $plugins - Plugins. |
| [2157](#L2157) | \* @return array $plugins - Plugins. |
| [2158](#L2158) | \* @since 2.6 |
| [2159](#L2159) | \*/ |
| [2160](#L2160) | public function wcal\_filter\_mce\_plugin( $plugins ) { |
| [2161](#L2161) | // this plugin file will work the magic of our button. |
| [2162](#L2162) | $plugins['abandoncart'] = plugin\_dir\_url( \_\_FILE\_\_ ) . 'assets/js/abandoncart\_plugin\_button.js'; |
| [2163](#L2163) | return $plugins; |
| [2164](#L2164) | } |
| [2165](#L2165) |  |
| [2166](#L2166) | /\*\* |
| [2167](#L2167) | \* It will add the tabs on the Abandoned cart page. |
| [2168](#L2168) | \* |
| [2169](#L2169) | \* @since 1.0 |
| [2170](#L2170) | \*/ |
| [2171](#L2171) | public function wcal\_display\_tabs() { |
| [2172](#L2172) |  |
| [2173](#L2173) | $action                = ''; |
| [2174](#L2174) | $active\_listcart       = ''; |
| [2175](#L2175) | $active\_emailtemplates = ''; |
| [2176](#L2176) | $active\_settings       = ''; |
| [2177](#L2177) | $active\_stats          = ''; |
| [2178](#L2178) | $active\_dash           = ''; |
| [2179](#L2179) |  |
| [2180](#L2180) | if ( isset( $\_GET['action'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [2181](#L2181) | $action = sanitize\_text\_field( wp\_unslash( $\_GET['action'] ) ); // phpcs:ignore WordPress.Security.NonceVerification |
| [2182](#L2182) | } else { |
| [2183](#L2183) | $action = ''; |
| [2184](#L2184) | $action = apply\_filters( 'wcal\_default\_tab', $action ); |
| [2185](#L2185) | } |
| [2186](#L2186) |  |
| [2187](#L2187) | switch ( $action ) { |
| [2188](#L2188) | case '': |
| [2189](#L2189) | case 'dashboard': |
| [2190](#L2190) | $active\_dash = 'nav-tab-active'; |
| [2191](#L2191) | break; |
| [2192](#L2192) | case 'listcart': |
| [2193](#L2193) | case 'orderdetails': |
| [2194](#L2194) | $active\_listcart = 'nav-tab-active'; |
| [2195](#L2195) | break; |
| [2196](#L2196) | case 'emailtemplates': |
| [2197](#L2197) | $active\_emailtemplates = 'nav-tab-active'; |
| [2198](#L2198) | break; |
| [2199](#L2199) | case 'emailsettings': |
| [2200](#L2200) | $active\_settings = 'nav-tab-active'; |
| [2201](#L2201) | break; |
| [2202](#L2202) | case 'stats': |
| [2203](#L2203) | $active\_stats = 'nav-tab-active'; |
| [2204](#L2204) | break; |
| [2205](#L2205) | case 'report': |
| [2206](#L2206) | $active\_report = 'nav-tab-active'; |
| [2207](#L2207) | break; |
| [2208](#L2208) | } |
| [2209](#L2209) |  |
| [2210](#L2210) | ?> |
| [2211](#L2211) | <div style="background-image: url('<?php echo esc\_url( plugins\_url( '/assets/images/ac\_tab\_icon.png', \_\_FILE\_\_ ) ); ?>') !important;" class="icon32"><br> |
| [2212](#L2212) | </div> |
| [2213](#L2213) | <h2 class="nav-tab-wrapper woo-nav-tab-wrapper"> |
| [2214](#L2214) | <a href="admin.php?page=woocommerce\_ac\_page&action=dashboard" class="nav-tab |
| [2215](#L2215) | <?php |
| [2216](#L2216) | if ( isset( $active\_dash ) ) { |
| [2217](#L2217) | echo esc\_attr( $active\_dash ); |
| [2218](#L2218) | } |
| [2219](#L2219) | ?> |
| [2220](#L2220) | "> <?php esc\_html\_e( 'Dashboard', 'woocommerce-abandoned-cart' ); ?> </a> |
| [2221](#L2221) | <a href="admin.php?page=woocommerce\_ac\_page&action=listcart" class="nav-tab |
| [2222](#L2222) | <?php |
| [2223](#L2223) | if ( isset( $active\_listcart ) ) { |
| [2224](#L2224) | echo esc\_attr( $active\_listcart ); |
| [2225](#L2225) | } |
| [2226](#L2226) | ?> |
| [2227](#L2227) | "> <?php esc\_html\_e( 'Abandoned Orders', 'woocommerce-abandoned-cart' ); ?> </a> |
| [2228](#L2228) | <a href="admin.php?page=woocommerce\_ac\_page&action=emailtemplates" class="nav-tab |
| [2229](#L2229) | <?php |
| [2230](#L2230) | if ( isset( $active\_emailtemplates ) ) { |
| [2231](#L2231) | echo esc\_attr( $active\_emailtemplates ); |
| [2232](#L2232) | } |
| [2233](#L2233) | ?> |
| [2234](#L2234) | "> <?php esc\_html\_e( 'Email Templates', 'woocommerce-abandoned-cart' ); ?> </a> |
| [2235](#L2235) | <a href="admin.php?page=woocommerce\_ac\_page&action=emailsettings" class="nav-tab |
| [2236](#L2236) | <?php |
| [2237](#L2237) | if ( isset( $active\_settings ) ) { |
| [2238](#L2238) | echo esc\_attr( $active\_settings ); |
| [2239](#L2239) | } |
| [2240](#L2240) | ?> |
| [2241](#L2241) | "> <?php esc\_html\_e( 'Settings', 'woocommerce-abandoned-cart' ); ?> </a> |
| [2242](#L2242) | <a href="admin.php?page=woocommerce\_ac\_page&action=stats" class="nav-tab |
| [2243](#L2243) | <?php |
| [2244](#L2244) | if ( isset( $active\_stats ) ) { |
| [2245](#L2245) | echo esc\_attr( $active\_stats ); |
| [2246](#L2246) | } |
| [2247](#L2247) | ?> |
| [2248](#L2248) | "> <?php esc\_html\_e( 'Recovered Orders', 'woocommerce-abandoned-cart' ); ?> </a> |
| [2249](#L2249) | <a href="admin.php?page=woocommerce\_ac\_page&action=report" class="nav-tab |
| [2250](#L2250) | <?php |
| [2251](#L2251) | if ( isset( $active\_report ) ) { |
| [2252](#L2252) | echo esc\_attr( $active\_report ); |
| [2253](#L2253) | } |
| [2254](#L2254) | ?> |
| [2255](#L2255) | "> <?php esc\_html\_e( 'Product Report', 'woocommerce-abandoned-cart' ); ?> </a> |
| [2256](#L2256) |  |
| [2257](#L2257) | <?php do\_action( 'wcal\_add\_settings\_tab' ); ?> |
| [2258](#L2258) | </h2> |
| [2259](#L2259) | <?php |
| [2260](#L2260) | } |
| [2261](#L2261) |  |
| [2262](#L2262) | /\*\* |
| [2263](#L2263) | \* It will add the scripts needed for the plugin. |
| [2264](#L2264) | \* |
| [2265](#L2265) | \* @hook admin\_enqueue\_scripts |
| [2266](#L2266) | \* @param string $hook Name of hook. |
| [2267](#L2267) | \* @since 1.0 |
| [2268](#L2268) | \*/ |
| [2269](#L2269) | public function wcal\_enqueue\_scripts\_js( $hook ) { |
| [2270](#L2270) | global $pagenow, $woocommerce; |
| [2271](#L2271) | $page   = isset( $\_GET['page'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['page'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [2272](#L2272) | $action = isset( $\_GET['action'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['action'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [2273](#L2273) |  |
| [2274](#L2274) | if ( '' === $page || 'woocommerce\_ac\_page' !== $page ) { |
| [2275](#L2275) | return; |
| [2276](#L2276) | } else { |
| [2277](#L2277) | wp\_enqueue\_script( 'jquery' ); |
| [2278](#L2278) | wp\_enqueue\_script( 'jquery-ui-core' ); |
| [2279](#L2279) |  |
| [2280](#L2280) | wp\_enqueue\_script( 'jquery-ui-datepicker' ); |
| [2281](#L2281) | wp\_enqueue\_script( |
| [2282](#L2282) | 'jquery-tip', |
| [2283](#L2283) | plugins\_url( '/assets/js/jquery.tipTip.minified.js', \_\_FILE\_\_ ), |
| [2284](#L2284) | '', |
| [2285](#L2285) | WCAL\_PLUGIN\_VERSION, |
| [2286](#L2286) | false |
| [2287](#L2287) | ); |
| [2288](#L2288) | $mode         = isset( $\_GET['mode'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['mode'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [2289](#L2289) | $wcal\_section = isset( $\_GET['wcal\_section'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['wcal\_section'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [2290](#L2290) | if ( ( 'emailtemplates' === $action && ( 'addnewtemplate' === $mode || 'edittemplate' === $mode ) ) || ( 'emailsettings' === $action && 'wcap\_atc\_settings' === $wcal\_section ) ) { |
| [2291](#L2291) | wp\_register\_script( 'woocommerce\_admin', WC()->plugin\_url() . '/assets/js/admin/woocommerce\_admin.min.js', array( 'jquery', 'jquery-tiptip' ), WCAL\_PLUGIN\_VERSION, false ); |
| [2292](#L2292) | wp\_enqueue\_script( 'woocommerce\_admin' ); |
| [2293](#L2293) | $locale  = localeconv(); |
| [2294](#L2294) | $decimal = isset( $locale['decimal\_point'] ) ? $locale['decimal\_point'] : '.'; |
| [2295](#L2295) | $params  = array( |
| [2296](#L2296) | // translators: %s: decimal. |
| [2297](#L2297) | 'i18n\_decimal\_error'               => sprintf( \_\_( 'Please enter in decimal (%s) format without thousand separators.', 'woocommerce' ), $decimal ), |
| [2298](#L2298) | // translators: %s: price decimal separator. |
| [2299](#L2299) | 'i18n\_mon\_decimal\_error'           => sprintf( \_\_( 'Please enter in monetary decimal (%s) format without thousand separators and currency symbols.', 'woocommerce' ), wc\_get\_price\_decimal\_separator() ), |
| [2300](#L2300) | 'i18n\_country\_iso\_error'           => \_\_( 'Please enter in country code with two capital letters.', 'woocommerce' ), |
| [2301](#L2301) | 'i18\_sale\_less\_than\_regular\_error' => \_\_( 'Please enter in a value less than the regular price.', 'woocommerce' ), |
| [2302](#L2302) | 'decimal\_point'                    => $decimal, |
| [2303](#L2303) | 'mon\_decimal\_point'                => wc\_get\_price\_decimal\_separator(), |
| [2304](#L2304) | 'strings'                          => array( |
| [2305](#L2305) | 'import\_products' => \_\_( 'Import', 'woocommerce' ), |
| [2306](#L2306) | 'export\_products' => \_\_( 'Export', 'woocommerce' ), |
| [2307](#L2307) | ), |
| [2308](#L2308) | 'urls'                             => array( |
| [2309](#L2309) | 'import\_products' => esc\_url\_raw( admin\_url( 'edit.php?post\_type=product&page=product\_importer' ) ), |
| [2310](#L2310) | 'export\_products' => esc\_url\_raw( admin\_url( 'edit.php?post\_type=product&page=product\_exporter' ) ), |
| [2311](#L2311) | ), |
| [2312](#L2312) | ); |
| [2313](#L2313) |  |
| [2314](#L2314) | // If we dont localize this script then from the WooCommerce check it will not run the javascript further and tooltip wont show any data. |
| [2315](#L2315) | // Also, we need above all parameters for the WooCoomerce js file. So we have taken it from the WooCommerce. @since: 5.1.2. |
| [2316](#L2316) | wp\_localize\_script( 'woocommerce\_admin', 'woocommerce\_admin', $params ); |
| [2317](#L2317) | } |
| [2318](#L2318) | ?> |
| [2319](#L2319) | <script type="text/javascript" > |
| [2320](#L2320) | function wcal\_activate\_email\_template( template\_id, active\_state ) { |
| [2321](#L2321) | location.href = 'admin.php?page=woocommerce\_ac\_page&action=emailtemplates&mode=activate\_template&id='+template\_id+'&active\_state='+active\_state ; |
| [2322](#L2322) | } |
| [2323](#L2323) | </script> |
| [2324](#L2324) | <?php |
| [2325](#L2325) | $js\_src = includes\_url( 'js/tinymce/' ) . 'tinymce.min.js'; |
| [2326](#L2326) | wp\_enqueue\_script( 'tinyMce\_ac', $js\_src, '', WCAL\_PLUGIN\_VERSION, false ); |
| [2327](#L2327) | wp\_enqueue\_script( |
| [2328](#L2328) | 'ac\_email\_variables', |
| [2329](#L2329) | plugins\_url( '/assets/js/abandoncart\_plugin\_button.js', \_\_FILE\_\_ ), |
| [2330](#L2330) | '', |
| [2331](#L2331) | WCAL\_PLUGIN\_VERSION, |
| [2332](#L2332) | false |
| [2333](#L2333) | ); |
| [2334](#L2334) | wp\_enqueue\_script( |
| [2335](#L2335) | 'wcal\_activate\_template', |
| [2336](#L2336) | plugins\_url( '/assets/js/wcal\_template\_activate.js', \_\_FILE\_\_ ), |
| [2337](#L2337) | '', |
| [2338](#L2338) | WCAL\_PLUGIN\_VERSION, |
| [2339](#L2339) | false |
| [2340](#L2340) | ); |
| [2341](#L2341) |  |
| [2342](#L2342) | // Needed only on the dashboard page. |
| [2343](#L2343) | if ( 'woocommerce\_ac\_page' === $page && ( '' === $action || 'dashboard' === $action ) ) { |
| [2344](#L2344) | wp\_register\_script( 'jquery-ui-datepicker', WC()->plugin\_url() . '/assets/js/admin/ui-datepicker.js', '', WCAL\_PLUGIN\_VERSION, false ); |
| [2345](#L2345) | wp\_enqueue\_script( 'jquery-ui-datepicker' ); |
| [2346](#L2346) |  |
| [2347](#L2347) | wp\_enqueue\_script( |
| [2348](#L2348) | 'bootstrap\_js', |
| [2349](#L2349) | plugins\_url( '/assets/js/admin/bootstrap.min.js', \_\_FILE\_\_ ), |
| [2350](#L2350) | '', |
| [2351](#L2351) | WCAL\_PLUGIN\_VERSION, |
| [2352](#L2352) | false |
| [2353](#L2353) | ); |
| [2354](#L2354) |  |
| [2355](#L2355) | wp\_enqueue\_script( |
| [2356](#L2356) | 'd3\_js', |
| [2357](#L2357) | WCAL\_PLUGIN\_URL . '/assets/js/admin/d3.v3.min.js', |
| [2358](#L2358) | '', |
| [2359](#L2359) | WCAL\_PLUGIN\_VERSION, |
| [2360](#L2360) | false |
| [2361](#L2361) | ); |
| [2362](#L2362) |  |
| [2363](#L2363) | wp\_register\_script( |
| [2364](#L2364) | 'reports\_js', |
| [2365](#L2365) | plugins\_url( '/assets/js/admin/wcal\_adv\_dashboard.min.js', \_\_FILE\_\_ ), |
| [2366](#L2366) | '', |
| [2367](#L2367) | WCAL\_PLUGIN\_VERSION, |
| [2368](#L2368) | false |
| [2369](#L2369) | ); |
| [2370](#L2370) | } |
| [2371](#L2371) | // Needed only on the abandoned orders page. |
| [2372](#L2372) | wp\_enqueue\_script( |
| [2373](#L2373) | 'wcal\_abandoned\_cart\_details', |
| [2374](#L2374) | plugins\_url( '/assets/js/admin/wcal\_abandoned\_cart\_detail\_modal.min.js', \_\_FILE\_\_ ), |
| [2375](#L2375) | '', |
| [2376](#L2376) | WCAL\_PLUGIN\_VERSION, |
| [2377](#L2377) | false |
| [2378](#L2378) | ); |
| [2379](#L2379) |  |
| [2380](#L2380) | wp\_enqueue\_script( |
| [2381](#L2381) | 'wcal\_admin\_notices', |
| [2382](#L2382) | plugins\_url( '/assets/js/admin/wcal\_ts\_dismiss\_notice.js', \_\_FILE\_\_ ), |
| [2383](#L2383) | '', |
| [2384](#L2384) | WCAL\_PLUGIN\_VERSION, |
| [2385](#L2385) | false |
| [2386](#L2386) | ); |
| [2387](#L2387) | wp\_localize\_script( |
| [2388](#L2388) | 'wcal\_admin\_notices', |
| [2389](#L2389) | 'wcal\_dismiss\_params', |
| [2390](#L2390) | array( |
| [2391](#L2391) | 'ajax\_url'   => admin\_url( 'admin-ajax.php' ), |
| [2392](#L2392) | 'ajax\_nonce' => wp\_create\_nonce( 'delete\_expired\_used\_coupon\_code' ), |
| [2393](#L2393) | ) |
| [2394](#L2394) | ); |
| [2395](#L2395) | wp\_register\_script( 'enhanced', plugins\_url() . '/woocommerce/assets/js/admin/wc-enhanced-select.js', array( 'jquery', 'select2' ), WCAL\_PLUGIN\_VERSION, false ); |
| [2396](#L2396) |  |
| [2397](#L2397) | wp\_localize\_script( |
| [2398](#L2398) | 'enhanced', |
| [2399](#L2399) | 'wc\_enhanced\_select\_params', |
| [2400](#L2400) | array( |
| [2401](#L2401) | 'i18n\_matches\_1'            => \_x( 'One result is available, press enter to select it.', 'enhanced select', 'woocommerce' ), |
| [2402](#L2402) | 'i18n\_matches\_n'            => \_x( '%qty% results are available, use up and down arrow keys to navigate.', 'enhanced select', 'woocommerce' ), |
| [2403](#L2403) | 'i18n\_no\_matches'           => \_x( 'No matches found', 'enhanced select', 'woocommerce' ), |
| [2404](#L2404) | 'i18n\_ajax\_error'           => \_x( 'Loading failed', 'enhanced select', 'woocommerce' ), |
| [2405](#L2405) | 'i18n\_input\_too\_short\_1'    => \_x( 'Please enter 1 or more characters', 'enhanced select', 'woocommerce' ), |
| [2406](#L2406) | 'i18n\_input\_too\_short\_n'    => \_x( 'Please enter %qty% or more characters', 'enhanced select', 'woocommerce' ), |
| [2407](#L2407) | 'i18n\_input\_too\_long\_1'     => \_x( 'Please delete 1 character', 'enhanced select', 'woocommerce' ), |
| [2408](#L2408) | 'i18n\_input\_too\_long\_n'     => \_x( 'Please delete %qty% characters', 'enhanced select', 'woocommerce' ), |
| [2409](#L2409) | 'i18n\_selection\_too\_long\_1' => \_x( 'You can only select 1 item', 'enhanced select', 'woocommerce' ), |
| [2410](#L2410) | 'i18n\_selection\_too\_long\_n' => \_x( 'You can only select %qty% items', 'enhanced select', 'woocommerce' ), |
| [2411](#L2411) | 'i18n\_load\_more'            => \_x( 'Loading more results&hellip;', 'enhanced select', 'woocommerce' ), |
| [2412](#L2412) | 'i18n\_searching'            => \_x( 'Searching&hellip;', 'enhanced select', 'woocommerce' ), |
| [2413](#L2413) | 'ajax\_url'                  => admin\_url( 'admin-ajax.php' ), |
| [2414](#L2414) | 'search\_products\_nonce'     => wp\_create\_nonce( 'search-products' ), |
| [2415](#L2415) | 'search\_customers\_nonce'    => wp\_create\_nonce( 'search-customers' ), |
| [2416](#L2416) | ) |
| [2417](#L2417) | ); |
| [2418](#L2418) |  |
| [2419](#L2419) | wp\_enqueue\_script( 'enhanced' ); |
| [2420](#L2420) |  |
| [2421](#L2421) | wp\_register\_script( 'selectWoo', plugins\_url() . '/woocommerce/assets/js/selectWoo/selectWoo.full.js', array( 'jquery' ), WCAL\_PLUGIN\_VERSION, false ); |
| [2422](#L2422) | wp\_enqueue\_script( 'selectWoo' ); |
| [2423](#L2423) |  |
| [2424](#L2424) | wp\_register\_script( 'select2', plugins\_url() . '/woocommerce/assets/js/select2/select2.js', array( 'jquery', 'jquery-ui-widget', 'jquery-ui-core' ), WCAL\_PLUGIN\_VERSION, false ); |
| [2425](#L2425) | wp\_enqueue\_script( 'select2' ); |
| [2426](#L2426) |  |
| [2427](#L2427) | wp\_dequeue\_script( 'wc-enhanced-select' ); |
| [2428](#L2428) | } |
| [2429](#L2429) | } |
| [2430](#L2430) |  |
| [2431](#L2431) | /\*\* |
| [2432](#L2432) | \* It will add the parameter to the editor. |
| [2433](#L2433) | \* |
| [2434](#L2434) | \* @hook tiny\_mce\_before\_init |
| [2435](#L2435) | \* @param array $in - Editor params. |
| [2436](#L2436) | \* @return array $in - Editor params. |
| [2437](#L2437) | \* @since 2.6 |
| [2438](#L2438) | \*/ |
| [2439](#L2439) | public function wcal\_format\_tiny\_mce( $in ) { |
| [2440](#L2440) | $in['force\_root\_block']             = false; |
| [2441](#L2441) | $in['valid\_children']               = '+body[style]'; |
| [2442](#L2442) | $in['remove\_linebreaks']            = false; |
| [2443](#L2443) | $in['gecko\_spellcheck']             = false; |
| [2444](#L2444) | $in['keep\_styles']                  = true; |
| [2445](#L2445) | $in['accessibility\_focus']          = true; |
| [2446](#L2446) | $in['tabfocus\_elements']            = 'major-publishing-actions'; |
| [2447](#L2447) | $in['media\_strict']                 = false; |
| [2448](#L2448) | $in['paste\_remove\_styles']          = false; |
| [2449](#L2449) | $in['paste\_remove\_spans']           = false; |
| [2450](#L2450) | $in['paste\_strip\_class\_attributes'] = 'none'; |
| [2451](#L2451) | $in['paste\_text\_use\_dialog']        = true; |
| [2452](#L2452) | $in['wpeditimage\_disable\_captions'] = true; |
| [2453](#L2453) | $in['wpautop']                      = false; |
| [2454](#L2454) | $in['apply\_source\_formatting']      = true; |
| [2455](#L2455) | $in['cleanup']                      = true; |
| [2456](#L2456) | $in['convert\_newlines\_to\_brs']      = false; |
| [2457](#L2457) | $in['fullpage\_default\_xml\_pi']      = false; |
| [2458](#L2458) | $in['convert\_urls']                 = false; |
| [2459](#L2459) | // Do not remove redundant BR tags. |
| [2460](#L2460) | $in['remove\_redundant\_brs'] = false; |
| [2461](#L2461) | return $in; |
| [2462](#L2462) | } |
| [2463](#L2463) |  |
| [2464](#L2464) | /\*\* |
| [2465](#L2465) | \* It will add the necesaary css for the plugin. |
| [2466](#L2466) | \* |
| [2467](#L2467) | \* @hook admin\_enqueue\_scripts |
| [2468](#L2468) | \* @param string $hook Name of page. |
| [2469](#L2469) | \* @since 1.0 |
| [2470](#L2470) | \*/ |
| [2471](#L2471) | public function wcal\_enqueue\_scripts\_css( $hook ) { |
| [2472](#L2472) |  |
| [2473](#L2473) | global $pagenow; |
| [2474](#L2474) |  |
| [2475](#L2475) | $page    = isset( $\_GET['page'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['page'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [2476](#L2476) | $action  = isset( $\_GET['action'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['action'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [2477](#L2477) | $section = isset( $\_GET['wcal\_section'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['wcal\_section'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [2478](#L2478) | if ( 'woocommerce\_ac\_page' !== $page ) { |
| [2479](#L2479) | return; |
| [2480](#L2480) | } elseif ( 'woocommerce\_ac\_page' === $page && ( 'dashboard' === $action || '' === $action ) ) { |
| [2481](#L2481) | wp\_enqueue\_style( 'wcal-dashboard-adv', plugins\_url( '/assets/css/admin/wcal\_reports\_adv.css', \_\_FILE\_\_ ), '', WCAL\_PLUGIN\_VERSION ); |
| [2482](#L2482) |  |
| [2483](#L2483) | wp\_register\_style( 'bootstrap\_css', plugins\_url( '/assets/css/admin/bootstrap.min.css', \_\_FILE\_\_ ), '', WCAL\_PLUGIN\_VERSION, 'all' ); |
| [2484](#L2484) | wp\_enqueue\_style( 'bootstrap\_css' ); |
| [2485](#L2485) |  |
| [2486](#L2486) | wp\_enqueue\_style( 'wcal-font-awesome', plugins\_url( '/assets/css/admin/font-awesome.css', \_\_FILE\_\_ ), '', WCAL\_PLUGIN\_VERSION ); |
| [2487](#L2487) |  |
| [2488](#L2488) | wp\_enqueue\_style( 'wcal-font-awesome-min', plugins\_url( '/assets/css/admin/font-awesome.min.css', \_\_FILE\_\_ ), '', WCAL\_PLUGIN\_VERSION ); |
| [2489](#L2489) |  |
| [2490](#L2490) | wp\_enqueue\_style( 'jquery-ui', plugins\_url( '/assets/css/admin/jquery-ui.css', \_\_FILE\_\_ ), '', WCAL\_PLUGIN\_VERSION, false ); |
| [2491](#L2491) | wp\_enqueue\_style( 'woocommerce\_admin\_styles', WC()->plugin\_url() . '/assets/css/admin.css', '', WCAL\_PLUGIN\_VERSION ); |
| [2492](#L2492) | wp\_enqueue\_style( 'jquery-ui-style', plugins\_url( '/assets/css/admin/jquery-ui-smoothness.css', \_\_FILE\_\_ ), '', WCAL\_PLUGIN\_VERSION ); |
| [2493](#L2493) | wp\_enqueue\_style( 'wcal-reports', plugins\_url( '/assets/css/admin/wcal\_reports.min.css', \_\_FILE\_\_ ), '', WCAL\_PLUGIN\_VERSION ); |
| [2494](#L2494) |  |
| [2495](#L2495) | } elseif ( 'woocommerce\_ac\_page' === $page && 'emailsettings' === $action && 'wcap\_connectors' === $section ) { |
| [2496](#L2496) | wp\_enqueue\_style( 'wcap-connectors', plugins\_url( 'assets/css/admin/wcap\_integrations\_main.min.css', \_\_FILE\_\_ ), '', WCAL\_PLUGIN\_VERSION ); |
| [2497](#L2497) | } elseif ( 'woocommerce\_ac\_page' === $page ) { |
| [2498](#L2498) |  |
| [2499](#L2499) | wp\_enqueue\_style( 'jquery-ui', plugins\_url( '/assets/css/admin/jquery-ui.css', \_\_FILE\_\_ ), '', WCAL\_PLUGIN\_VERSION, false ); |
| [2500](#L2500) | wp\_enqueue\_style( 'woocommerce\_admin\_styles', WC()->plugin\_url() . '/assets/css/admin.css', '', WCAL\_PLUGIN\_VERSION ); |
| [2501](#L2501) |  |
| [2502](#L2502) | wp\_enqueue\_style( 'jquery-ui-style', plugins\_url( '/assets/css/admin/jquery-ui-smoothness.css', \_\_FILE\_\_ ), '', WCAL\_PLUGIN\_VERSION ); |
| [2503](#L2503) | wp\_enqueue\_style( 'abandoned-orders-list', plugins\_url( '/assets/css/view.abandoned.orders.style.css', \_\_FILE\_\_ ), '', WCAL\_PLUGIN\_VERSION ); |
| [2504](#L2504) | wp\_enqueue\_style( 'wcal\_email\_template', plugins\_url( '/assets/css/wcal\_template\_activate.css', \_\_FILE\_\_ ), '', WCAL\_PLUGIN\_VERSION ); |
| [2505](#L2505) | wp\_enqueue\_style( 'wcal\_cart\_details', plugins\_url( '/assets/css/admin/wcal\_abandoned\_cart\_detail\_modal.min.css', \_\_FILE\_\_ ), '', WCAL\_PLUGIN\_VERSION ); |
| [2506](#L2506) | } |
| [2507](#L2507) | } |
| [2508](#L2508) |  |
| [2509](#L2509) | /\*\* |
| [2510](#L2510) | \* When we have added the wp list table for the listing then while deleting the record with the bulk action it was showing |
| [2511](#L2511) | \* the notice. To overcome the wp redirect warning we need to start the ob\_start. |
| [2512](#L2512) | \* |
| [2513](#L2513) | \* @hook init |
| [2514](#L2514) | \* @since 2.5.2 |
| [2515](#L2515) | \*/ |
| [2516](#L2516) | public function wcal\_app\_output\_buffer() { |
| [2517](#L2517) | ob\_start(); |
| [2518](#L2518) | } |
| [2519](#L2519) |  |
| [2520](#L2520) | /\*\* |
| [2521](#L2521) | \* Abandon Cart Settings Page. It will show the tabs, notices for the plugin. |
| [2522](#L2522) | \* It will also update the template records and display the template fields. |
| [2523](#L2523) | \* It will also show the abandoned cart details page. |
| [2524](#L2524) | \* It will also show the details of all the tabs. |
| [2525](#L2525) | \* |
| [2526](#L2526) | \* @globals mixed $wpdb |
| [2527](#L2527) | \* @since 1.0 |
| [2528](#L2528) | \*/ |
| [2529](#L2529) | public function wcal\_menu\_page() { |
| [2530](#L2530) |  |
| [2531](#L2531) | if ( is\_user\_logged\_in() ) { |
| [2532](#L2532) | global $wpdb; |
| [2533](#L2533) | // Check the user capabilities. |
| [2534](#L2534) | if ( ! current\_user\_can( 'manage\_woocommerce' ) ) { |
| [2535](#L2535) | wp\_die( esc\_html\_\_( 'You do not have sufficient permissions to access this page.', 'woocommerce-abandoned-cart' ) ); |
| [2536](#L2536) | } |
| [2537](#L2537) | ?> |
| [2538](#L2538) | <div class="wrap"> |
| [2539](#L2539) | <h2><?php esc\_html\_e( 'WooCommerce - Abandon Cart Lite', 'woocommerce-abandoned-cart' ); ?></h2> |
| [2540](#L2540) | <?php |
| [2541](#L2541) |  |
| [2542](#L2542) | if ( isset( $\_GET['ac\_update'] ) && 'email\_templates' === sanitize\_text\_field( wp\_unslash( $\_GET['ac\_update'] ) ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [2543](#L2543) | $status = wcal\_common::update\_templates\_table(); |
| [2544](#L2544) |  |
| [2545](#L2545) | if ( false !== $status ) { |
| [2546](#L2546) | wcal\_common::show\_update\_success(); |
| [2547](#L2547) | } else { |
| [2548](#L2548) | wcal\_common::show\_update\_failure(); |
| [2549](#L2549) | } |
| [2550](#L2550) | } |
| [2551](#L2551) |  |
| [2552](#L2552) | if ( isset( $\_GET['action'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [2553](#L2553) | $action = sanitize\_text\_field( wp\_unslash( $\_GET['action'] ) ); // phpcs:ignore WordPress.Security.NonceVerification |
| [2554](#L2554) | } else { |
| [2555](#L2555) | $action = ''; |
| [2556](#L2556) | $action = apply\_filters( 'wcal\_default\_tab', $action ); |
| [2557](#L2557) | } |
| [2558](#L2558) | $mode = isset( $\_GET['mode'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['mode'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [2559](#L2559) | $this->wcal\_display\_tabs(); |
| [2560](#L2560) |  |
| [2561](#L2561) | do\_action( 'wcal\_add\_tab\_content' ); |
| [2562](#L2562) |  |
| [2563](#L2563) | // When we delete the item from the below drop down it is registred in action 2. |
| [2564](#L2564) | $action\_two = isset( $\_GET['action2'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['action2'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [2565](#L2565) |  |
| [2566](#L2566) | // Detect when a bulk action is being triggered on abandoned orders page. |
| [2567](#L2567) | if ( 'wcal\_delete' === $action || 'wcal\_delete' === $action\_two ) { |
| [2568](#L2568) | $ids = isset( $\_GET['abandoned\_order\_id'] ) && is\_array( $\_GET['abandoned\_order\_id'] ) ? array\_map( 'intval', wp\_unslash( $\_GET['abandoned\_order\_id'] ) ) : sanitize\_text\_field( wp\_unslash( $\_GET['abandoned\_order\_id'] ) ); // phpcs:ignore WordPress.Security.NonceVerification |
| [2569](#L2569) | if ( ! is\_array( $ids ) ) { |
| [2570](#L2570) | $ids = array( $ids ); |
| [2571](#L2571) | } |
| [2572](#L2572) | foreach ( $ids as $id ) { |
| [2573](#L2573) | $class = new Wcal\_Delete\_Handler(); |
| [2574](#L2574) | $class->wcal\_delete\_bulk\_action\_handler\_function( $id ); |
| [2575](#L2575) | } |
| [2576](#L2576) | } |
| [2577](#L2577) | // Abandoned Orders page - Bulk Action - Delete all registered user carts. |
| [2578](#L2578) | if ( 'wcal\_delete\_all\_registered' === $action || 'wcal\_delete\_all\_registered' === $action\_two ) { |
| [2579](#L2579) | $class = new Wcal\_Delete\_Handler(); |
| [2580](#L2580) | $class->wcal\_bulk\_action\_delete\_registered\_carts\_handler(); |
| [2581](#L2581) | } |
| [2582](#L2582) | // Abandoned Orders page - Bulk Action - Delete all guest carts. |
| [2583](#L2583) | if ( 'wcal\_delete\_all\_guest' === $action || 'wcal\_delete\_all\_guest' === $action\_two ) { |
| [2584](#L2584) | $class = new Wcal\_Delete\_Handler(); |
| [2585](#L2585) | $class->wcal\_bulk\_action\_delete\_guest\_carts\_handler(); |
| [2586](#L2586) | } |
| [2587](#L2587) | // Abandoned Orders page - Bulk Action - Delete all visitor carts. |
| [2588](#L2588) | if ( 'wcal\_delete\_all\_visitor' === $action || 'wcal\_delete\_all\_visitor' === $action\_two ) { |
| [2589](#L2589) | $class = new Wcal\_Delete\_Handler(); |
| [2590](#L2590) | $class->wcal\_bulk\_action\_delete\_visitor\_carts\_handler(); |
| [2591](#L2591) | } |
| [2592](#L2592) | // Abandoned Orders page - Bulk Action - Delete all carts. |
| [2593](#L2593) | if ( 'wcal\_delete\_all' === $action || 'wcal\_delete\_all' === $action\_two ) { |
| [2594](#L2594) | $class = new Wcal\_Delete\_Handler(); |
| [2595](#L2595) | $class->wcal\_bulk\_action\_delete\_all\_carts\_handler(); |
| [2596](#L2596) | } |
| [2597](#L2597) |  |
| [2598](#L2598) | // Detect when a bulk action is being triggered on templates page. |
| [2599](#L2599) | if ( 'wcal\_delete\_template' === $action || 'wcal\_delete\_template' === $action\_two ) { |
| [2600](#L2600) | $ids = isset( $\_GET['template\_id'] ) && is\_array( $\_GET['template\_id'] ) ? array\_map( 'intval', wp\_unslash( $\_GET['template\_id'] ) ) : sanitize\_text\_field( wp\_unslash( $\_GET['template\_id'] ) ); // phpcs:ignore WordPress.Security.NonceVerification |
| [2601](#L2601) | if ( ! is\_array( $ids ) ) { |
| [2602](#L2602) | $ids = array( $ids ); |
| [2603](#L2603) | } |
| [2604](#L2604) | foreach ( $ids as $id ) { |
| [2605](#L2605) | $class = new Wcal\_Delete\_Handler(); |
| [2606](#L2606) | $class->wcal\_delete\_template\_bulk\_action\_handler\_function( $id ); |
| [2607](#L2607) | } |
| [2608](#L2608) | } |
| [2609](#L2609) |  |
| [2610](#L2610) | if ( isset( $\_GET['wcal\_deleted'] ) && 'YES' === sanitize\_text\_field( wp\_unslash( $\_GET['wcal\_deleted'] ) ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [2611](#L2611) | $msg = \_\_( 'The Abandoned cart has been successfully deleted.', 'woocommerce-abandoned-cart' ); // Default Msg. |
| [2612](#L2612) | if ( isset( $\_GET['wcal\_deleted\_all'] ) && 'YES' === sanitize\_text\_field( wp\_unslash( $\_GET['wcal\_deleted\_all'] ) ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [2613](#L2613) | $msg = \_\_( 'All Abandoned Carts have been successfully deleted.', 'woocommerce-abandoned-cart' ); // Delete All Carts. |
| [2614](#L2614) | } elseif ( isset( $\_GET['wcal\_deleted\_all\_visitor'] ) && 'YES' === sanitize\_text\_field( wp\_unslash( $\_GET['wcal\_deleted\_all\_visitor'] ) ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [2615](#L2615) | $msg = \_\_( 'All Visitor carts have been successfully deleted.', 'woocommerce-abandoned-cart' ); // Delete all visitor carts. |
| [2616](#L2616) | } elseif ( isset( $\_GET['wcal\_deleted\_all\_guest'] ) && 'YES' === sanitize\_text\_field( wp\_unslash( $\_GET['wcal\_deleted\_all\_guest'] ) ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [2617](#L2617) | $msg = \_\_( 'All Guest carts have been successfully deleted.', 'woocommerce-abandoned-cart' ); // Delete all Guest carts. |
| [2618](#L2618) | } elseif ( isset( $\_GET['wcal\_deleted\_all\_registered'] ) && 'YES' === sanitize\_text\_field( wp\_unslash( $\_GET['wcal\_deleted\_all\_registered'] ) ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [2619](#L2619) | $msg = \_\_( 'All Registered carts have been deleted.', 'woocommerce-abandoned-cart' ); // Delete all registered carts. |
| [2620](#L2620) | } |
| [2621](#L2621) | ?> |
| [2622](#L2622) | <div id="message" class="updated fade"> |
| [2623](#L2623) | <p><strong><?php echo esc\_html( $msg ); ?></strong></p> |
| [2624](#L2624) | </div> |
| [2625](#L2625) | <?php |
| [2626](#L2626) | } |
| [2627](#L2627) | if ( isset( $\_GET ['wcal\_template\_deleted'] ) && 'YES' === sanitize\_text\_field( wp\_unslash( $\_GET['wcal\_template\_deleted'] ) ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [2628](#L2628) | ?> |
| [2629](#L2629) | <div id="message" class="updated fade"> |
| [2630](#L2630) | <p><strong><?php esc\_html\_e( 'The Template has been successfully deleted.', 'woocommerce-abandoned-cart' ); ?></strong></p> |
| [2631](#L2631) | </div> |
| [2632](#L2632) | <?php |
| [2633](#L2633) | } |
| [2634](#L2634) | if ( 'emailsettings' === $action ) { |
| [2635](#L2635) | // Save the field values. |
| [2636](#L2636) | ?> |
| [2637](#L2637) | <div id="content"> |
| [2638](#L2638) | <?php |
| [2639](#L2639) | $wcal\_general\_settings\_class = ''; |
| [2640](#L2640) | $wcal\_email\_setting          = ''; |
| [2641](#L2641) | $wcap\_sms\_settings           = ''; |
| [2642](#L2642) | $wcap\_atc\_settings           = ''; |
| [2643](#L2643) | $wcap\_fb\_settings            = ''; |
| [2644](#L2644) | $wcap\_connectors             = ''; |
| [2645](#L2645) |  |
| [2646](#L2646) | $section = isset( $\_GET['wcal\_section'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['wcal\_section'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [2647](#L2647) | switch ( $section ) { |
| [2648](#L2648) | case 'wcal\_general\_settings': |
| [2649](#L2649) | case '': |
| [2650](#L2650) | $wcal\_general\_settings\_class = 'current'; |
| [2651](#L2651) | break; |
| [2652](#L2652) | case 'wcal\_email\_settings': |
| [2653](#L2653) | $wcal\_email\_setting = 'current'; |
| [2654](#L2654) | break; |
| [2655](#L2655) | case 'wcap\_sms\_settings': |
| [2656](#L2656) | $wcap\_sms\_settings = 'current'; |
| [2657](#L2657) | break; |
| [2658](#L2658) | case 'wcap\_atc\_settings': |
| [2659](#L2659) | $wcap\_atc\_settings = 'current'; |
| [2660](#L2660) | break; |
| [2661](#L2661) | case 'wcap\_fb\_settings': |
| [2662](#L2662) | $wcap\_fb\_settings = 'current'; |
| [2663](#L2663) | break; |
| [2664](#L2664) | case 'wcap\_connectors': |
| [2665](#L2665) | $wcap\_connectors = 'current'; |
| [2666](#L2666) | break; |
| [2667](#L2667) | default: |
| [2668](#L2668) | $wcal\_general\_settings\_class = 'current'; |
| [2669](#L2669) | break; |
| [2670](#L2670) | } |
| [2671](#L2671) | ?> |
| [2672](#L2672) | <ul class="subsubsub" id="wcal\_general\_settings\_list"> |
| [2673](#L2673) | <li> |
| [2674](#L2674) | <a href="admin.php?page=woocommerce\_ac\_page&action=emailsettings&wcal\_section=wcal\_general\_settings" class="<?php echo esc\_attr( $wcal\_general\_settings\_class ); ?>"><?php esc\_html\_e( 'General Settings', 'woocommerce-abandoned-cart' ); ?> </a> | |
| [2675](#L2675) | </li> |
| [2676](#L2676) | <li> |
| [2677](#L2677) | <a href="admin.php?page=woocommerce\_ac\_page&action=emailsettings&wcal\_section=wcal\_email\_settings" class="<?php echo esc\_attr( $wcal\_email\_setting ); ?>"><?php esc\_html\_e( 'Email Sending Settings', 'woocommerce-abandoned-cart' ); ?> </a> | |
| [2678](#L2678) | </li> |
| [2679](#L2679) | <li> |
| [2680](#L2680) | <a href="admin.php?page=woocommerce\_ac\_page&action=emailsettings&wcal\_section=wcap\_atc\_settings" class="<?php echo esc\_attr( $wcap\_atc\_settings ); ?>"><?php esc\_html\_e( 'Add To Cart Popup Editor', 'woocommerce-ac' ); ?> </a> | |
| [2681](#L2681) | </li> |
| [2682](#L2682) | <li> |
| [2683](#L2683) | <a href="admin.php?page=woocommerce\_ac\_page&action=emailsettings&wcal\_section=wcap\_fb\_settings" class="<?php echo esc\_attr( $wcap\_fb\_settings ); ?>"><?php esc\_html\_e( 'Facebook Messenger', 'woocommerce-ac' ); ?> </a> | |
| [2684](#L2684) | </li> |
| [2685](#L2685) | <li> |
| [2686](#L2686) | <a href="admin.php?page=woocommerce\_ac\_page&action=emailsettings&wcal\_section=wcap\_sms\_settings" class="<?php echo esc\_attr( $wcap\_sms\_settings ); ?>"><?php esc\_html\_e( 'SMS', 'woocommerce-ac' ); ?> </a> | |
| [2687](#L2687) | </li> |
| [2688](#L2688) | <li> |
| [2689](#L2689) | <a href="admin.php?page=woocommerce\_ac\_page&action=emailsettings&wcal\_section=wcap\_connectors" class="<?php echo esc\_attr( $wcap\_connectors ); ?>"><?php esc\_html\_e( 'Connectors', 'woocommerce-ac' ); ?> </a> |
| [2690](#L2690) | </li> |
| [2691](#L2691) | <?php do\_action( 'wcal\_add\_custom\_settings\_tab', $section ); ?> |
| [2692](#L2692) | </ul> |
| [2693](#L2693) | <br class="clear"> |
| [2694](#L2694) | <?php |
| [2695](#L2695) | if ( 'wcal\_general\_settings' === $section || '' === $section ) { |
| [2696](#L2696) | ?> |
| [2697](#L2697) | <p><?php esc\_html\_e( 'Change settings for sending email notifications to Customers, to Admin etc.', 'woocommerce-abandoned-cart' ); ?></p> |
| [2698](#L2698) | <form method="post" action="options.php"> |
| [2699](#L2699) | <?php settings\_fields( 'woocommerce\_ac\_settings' ); ?> |
| [2700](#L2700) | <?php do\_settings\_sections( 'woocommerce\_ac\_page' ); ?> |
| [2701](#L2701) | <?php settings\_errors(); ?> |
| [2702](#L2702) | <?php submit\_button(); ?> |
| [2703](#L2703) | </form> |
| [2704](#L2704) | <?php |
| [2705](#L2705) | } elseif ( 'wcal\_email\_settings' === $section ) { |
| [2706](#L2706) | ?> |
| [2707](#L2707) | <p><?php esc\_html\_e( 'Change settings for sending email notifications to Customers, to Admin etc.', 'woocommerce-abandoned-cart' ); ?></p> |
| [2708](#L2708) | <form method="post" action="options.php"> |
| [2709](#L2709) | <?php settings\_fields( 'woocommerce\_ac\_email\_settings' ); ?> |
| [2710](#L2710) | <?php do\_settings\_sections( 'woocommerce\_ac\_email\_page' ); ?> |
| [2711](#L2711) | <?php settings\_errors(); ?> |
| [2712](#L2712) | <?php submit\_button(); ?> |
| [2713](#L2713) | </form> |
| [2714](#L2714) | <?php |
| [2715](#L2715) | } elseif ( 'wcap\_atc\_settings' === $section ) { |
| [2716](#L2716) | WCAP\_Pro\_Settings::wcap\_atc\_settings(); |
| [2717](#L2717) | } elseif ( 'wcap\_fb\_settings' === $section ) { |
| [2718](#L2718) | WCAP\_Pro\_Settings::wcap\_fb\_settings(); |
| [2719](#L2719) | } elseif ( 'wcap\_sms\_settings' === $section ) { |
| [2720](#L2720) | WCAP\_Pro\_Settings::wcap\_sms\_settings(); |
| [2721](#L2721) | } elseif ( 'wcap\_connectors' === $section ) { |
| [2722](#L2722) | WCAP\_Pro\_Settings::wcap\_connectors(); |
| [2723](#L2723) | } |
| [2724](#L2724) | do\_action( 'wcal\_add\_custom\_settings\_tab\_content', $section ); |
| [2725](#L2725) | ?> |
| [2726](#L2726) | </div> |
| [2727](#L2727) | <?php |
| [2728](#L2728) | } elseif ( 'dashboard' === $action || '' === $action || '-1' === $action || '1' === $action\_two ) { |
| [2729](#L2729) | include\_once 'includes/classes/class-wcal-dashboard-report.php'; |
| [2730](#L2730) | Wcal\_Dashboard\_Report::wcal\_dashboard\_display(); |
| [2731](#L2731) | } elseif ( 'listcart' === $action ) { |
| [2732](#L2732) |  |
| [2733](#L2733) | ?> |
| [2734](#L2734) | <p> <?php esc\_html\_e( 'The list below shows all Abandoned Carts which have remained in cart for a time higher than the "Cart abandoned cut-off time" setting.', 'woocommerce-abandoned-cart' ); ?> </p> |
| [2735](#L2735) | <?php |
| [2736](#L2736) | $get\_all\_abandoned\_count      = wcal\_common::wcal\_get\_abandoned\_order\_count( 'wcal\_all\_abandoned' ); |
| [2737](#L2737) | $get\_registered\_user\_ac\_count = wcal\_common::wcal\_get\_abandoned\_order\_count( 'wcal\_all\_registered' ); |
| [2738](#L2738) | $get\_guest\_user\_ac\_count      = wcal\_common::wcal\_get\_abandoned\_order\_count( 'wcal\_all\_guest' ); |
| [2739](#L2739) | $get\_visitor\_user\_ac\_count    = wcal\_common::wcal\_get\_abandoned\_order\_count( 'wcal\_all\_visitor' ); |
| [2740](#L2740) |  |
| [2741](#L2741) | $wcal\_user\_reg\_text = 'User'; |
| [2742](#L2742) | if ( $get\_registered\_user\_ac\_count > 1 ) { |
| [2743](#L2743) | $wcal\_user\_reg\_text = 'Users'; |
| [2744](#L2744) | } |
| [2745](#L2745) | $wcal\_user\_gus\_text = 'User'; |
| [2746](#L2746) | if ( $get\_guest\_user\_ac\_count > 1 ) { |
| [2747](#L2747) | $wcal\_user\_gus\_text = 'Users'; |
| [2748](#L2748) | } |
| [2749](#L2749) | $wcal\_all\_abandoned\_carts = ''; |
| [2750](#L2750) | $section                  = ''; |
| [2751](#L2751) | $wcal\_all\_registered      = ''; |
| [2752](#L2752) | $wcal\_all\_guest           = ''; |
| [2753](#L2753) | $wcal\_all\_visitor         = ''; |
| [2754](#L2754) |  |
| [2755](#L2755) | $section = isset( $\_GET['wcal\_section'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['wcal\_section'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [2756](#L2756) | if ( 'wcal\_all\_abandoned' === $section || '' === $section ) { |
| [2757](#L2757) | $wcal\_all\_abandoned\_carts = 'current'; |
| [2758](#L2758) | } |
| [2759](#L2759) |  |
| [2760](#L2760) | if ( 'wcal\_all\_registered' === $section ) { |
| [2761](#L2761) | $wcal\_all\_registered      = 'current'; |
| [2762](#L2762) | $wcal\_all\_abandoned\_carts = ''; |
| [2763](#L2763) | } |
| [2764](#L2764) | if ( 'wcal\_all\_guest' === $section ) { |
| [2765](#L2765) | $wcal\_all\_guest           = 'current'; |
| [2766](#L2766) | $wcal\_all\_abandoned\_carts = ''; |
| [2767](#L2767) | } |
| [2768](#L2768) |  |
| [2769](#L2769) | if ( 'wcal\_all\_visitor' === $section ) { |
| [2770](#L2770) | $wcal\_all\_visitor         = 'current'; |
| [2771](#L2771) | $wcal\_all\_abandoned\_carts = ''; |
| [2772](#L2772) | } |
| [2773](#L2773) | ?> |
| [2774](#L2774) | <ul class="subsubsub" id="wcal\_recovered\_orders\_list"> |
| [2775](#L2775) | <li> |
| [2776](#L2776) | <a href="admin.php?page=woocommerce\_ac\_page&action=listcart&wcal\_section=wcal\_all\_abandoned" class="<?php echo esc\_attr( $wcal\_all\_abandoned\_carts ); ?>"><?php esc\_html\_e( 'All ', 'woocommerce-abandoned-cart' ); ?> <span class = "count" > <?php echo esc\_html( "( $get\_all\_abandoned\_count )" ); ?> </span></a> |
| [2777](#L2777) | </li> |
| [2778](#L2778) |  |
| [2779](#L2779) | <?php if ( $get\_registered\_user\_ac\_count > 0 ) { ?> |
| [2780](#L2780) | <li><?php // translators: Users. ?> |
| [2781](#L2781) | | <a href="admin.php?page=woocommerce\_ac\_page&action=listcart&wcal\_section=wcal\_all\_registered" class="<?php echo esc\_attr( $wcal\_all\_registered ); ?>"><?php printf( esc\_html\_\_( 'Registered %s', 'woocommerce-abandoned-cart' ), esc\_html( $wcal\_user\_reg\_text ) ); ?> <span class = "count" > <?php echo esc\_html( "( $get\_registered\_user\_ac\_count )" ); ?> </span></a> |
| [2782](#L2782) | </li> |
| [2783](#L2783) | <?php } ?> |
| [2784](#L2784) |  |
| [2785](#L2785) | <?php if ( $get\_guest\_user\_ac\_count > 0 ) { ?> |
| [2786](#L2786) | <li><?php // translators: Users. ?> |
| [2787](#L2787) | | <a href="admin.php?page=woocommerce\_ac\_page&action=listcart&wcal\_section=wcal\_all\_guest" class="<?php echo esc\_attr( $wcal\_all\_guest ); ?>"><?php printf( esc\_html\_\_( 'Guest %s', 'woocommerce-abandoned-cart' ), esc\_html( $wcal\_user\_gus\_text ) ); ?> <span class = "count" > <?php echo esc\_html( "( $get\_guest\_user\_ac\_count )" ); ?> </span></a> |
| [2788](#L2788) | </li> |
| [2789](#L2789) | <?php } ?> |
| [2790](#L2790) |  |
| [2791](#L2791) | <?php if ( $get\_visitor\_user\_ac\_count > 0 ) { ?> |
| [2792](#L2792) | <li> |
| [2793](#L2793) | | <a href="admin.php?page=woocommerce\_ac\_page&action=listcart&wcal\_section=wcal\_all\_visitor" class="<?php echo esc\_attr( $wcal\_all\_visitor ); ?>"><?php esc\_html\_e( 'Carts without Customer Details', 'woocommerce-abandoned-cart' ); ?> <span class = "count" > <?php echo esc\_html( "( $get\_visitor\_user\_ac\_count )" ); ?> </span></a> |
| [2794](#L2794) | </li> |
| [2795](#L2795) | <?php } ?> |
| [2796](#L2796) | </ul> |
| [2797](#L2797) |  |
| [2798](#L2798) | <?php |
| [2799](#L2799) | global $wpdb; |
| [2800](#L2800) | include\_once 'includes/classes/class-wcal-abandoned-orders-table.php'; |
| [2801](#L2801) | $wcal\_abandoned\_order\_list = new WCAL\_Abandoned\_Orders\_Table(); |
| [2802](#L2802) | $wcal\_abandoned\_order\_list->wcal\_abandoned\_order\_prepare\_items(); |
| [2803](#L2803) | ?> |
| [2804](#L2804) | <div class="wrap"> |
| [2805](#L2805) | <form id="wcal-abandoned-orders" method="get" > |
| [2806](#L2806) | <input type="hidden" name="page" value="woocommerce\_ac\_page" /> |
| [2807](#L2807) | <input type="hidden" name="action" value="listcart" /> |
| [2808](#L2808) | <?php $wcal\_abandoned\_order\_list->display(); ?> |
| [2809](#L2809) | </form> |
| [2810](#L2810) | </div> |
| [2811](#L2811) | <?php |
| [2812](#L2812) | } elseif ( ( 'emailtemplates' === $action && ( 'edittemplate' !== $mode && 'addnewtemplate' !== $mode ) || '' === $action || '-1' === $action || '-1' === $action\_two ) ) { |
| [2813](#L2813) | ?> |
| [2814](#L2814) | <p> <?php esc\_html\_e( 'Add email templates at different intervals to maximize the possibility of recovering your abandoned carts.', 'woocommerce-abandoned-cart' ); ?> </p> |
| [2815](#L2815) | <?php |
| [2816](#L2816) | // Save the field values. |
| [2817](#L2817) | $insert\_template\_successfuly  = ''; |
| [2818](#L2818) | $update\_template\_successfuly  = ''; |
| [2819](#L2819) | $woocommerce\_ac\_email\_subject = isset( $\_POST['woocommerce\_ac\_email\_subject'] ) ? trim( htmlspecialchars( sanitize\_text\_field( wp\_unslash( $\_POST['woocommerce\_ac\_email\_subject'] ) ) ), ENT\_QUOTES ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [2820](#L2820) | $woocommerce\_ac\_email\_body    = isset( $\_POST['woocommerce\_ac\_email\_body'] ) ? trim( wp\_unslash( $\_POST['woocommerce\_ac\_email\_body'] ) ) : ''; // phpcs:ignore |
| [2821](#L2821) | $woocommerce\_ac\_template\_name = isset( $\_POST['woocommerce\_ac\_template\_name'] ) ? trim( sanitize\_text\_field( wp\_unslash( $\_POST['woocommerce\_ac\_template\_name'] ) ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [2822](#L2822) | $woocommerce\_ac\_email\_header  = isset( $\_POST['wcal\_wc\_email\_header'] ) ? stripslashes( trim( htmlspecialchars( sanitize\_text\_field( wp\_unslash( $\_POST['wcal\_wc\_email\_header'] ) ) ), ENT\_QUOTES ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [2823](#L2823) |  |
| [2824](#L2824) | $email\_frequency = isset( $\_POST['email\_frequency'] ) ? trim( sanitize\_text\_field( wp\_unslash( $\_POST['email\_frequency'] ) ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [2825](#L2825) | $day\_or\_hour     = isset( $\_POST['day\_or\_hour'] ) ? trim( sanitize\_text\_field( wp\_unslash( $\_POST['day\_or\_hour'] ) ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [2826](#L2826) | $is\_wc\_template  = empty( $\_POST['is\_wc\_template'] ) ? '0' : '1'; // phpcs:ignore WordPress.Security.NonceVerification |
| [2827](#L2827) |  |
| [2828](#L2828) | // If the link merge tags are prefixed with http://|https:// please remove it. |
| [2829](#L2829) | $rectify\_links = array( |
| [2830](#L2830) | 'http://{{cart.link}}', |
| [2831](#L2831) | 'https://{{cart.link}}', |
| [2832](#L2832) | 'http://{{cart.unsubscribe}}', |
| [2833](#L2833) | 'https://{{cart.unsubscribe}}', |
| [2834](#L2834) | 'http://{{shop.url}}', |
| [2835](#L2835) | 'https://{{shop.url}}', |
| [2836](#L2836) | ); |
| [2837](#L2837) | foreach ( $rectify\_links as $merge\_tag ) { |
| [2838](#L2838) | $start\_tag                 = stripos( $merge\_tag, '{{' ); |
| [2839](#L2839) | $new\_tag                   = substr( $merge\_tag, $start\_tag ); |
| [2840](#L2840) | $woocommerce\_ac\_email\_body = str\_ireplace( $merge\_tag, $new\_tag, $woocommerce\_ac\_email\_body ); |
| [2841](#L2841) | } |
| [2842](#L2842) | if ( isset( $\_POST['ac\_settings\_frm'] ) && 'save' === sanitize\_text\_field( wp\_unslash( $\_POST['ac\_settings\_frm'] ) ) ) { // phpcs:ignore |
| [2843](#L2843) | $default\_value       = 0; |
| [2844](#L2844) | $coupon\_code\_id      = isset( $\_POST['coupon\_ids'][0] ) ? sanitize\_text\_field( wp\_unslash( implode( ',', $\_POST['coupon\_ids'] ) ) ) : ''; // phpcs:ignore |
| [2845](#L2845) | $unique\_coupon       = ( empty( $\_POST['unique\_coupon'] ) ) ? '0' : '1'; // phpcs:ignore WordPress.Security.NonceVerification |
| [2846](#L2846) | $coupon\_code\_options = self::wcal\_coupon\_options(); |
| [2847](#L2847) | $email\_type          = 'abandoned\_cart\_email'; |
| [2848](#L2848) |  |
| [2849](#L2849) | $insert\_template\_successfuly = $wpdb->query( //phpcs:ignore |
| [2850](#L2850) | $wpdb->prepare( |
| [2851](#L2851) | 'INSERT INTO `' . $wpdb->prefix . 'ac\_email\_templates\_lite` (email\_type, subject, body, frequency, day\_or\_hour, template\_name, is\_wc\_template, default\_template, wc\_email\_header, coupon\_code, individual\_use, generate\_unique\_coupon\_code, discount, discount\_type, discount\_shipping, discount\_expiry ) VALUES ( %s, %s, %s, %d, %s, %s, %s, %d, %s, %s, %s, %s, %s, %s, %s, %s )', |
| [2852](#L2852) | $email\_type, |
| [2853](#L2853) | $woocommerce\_ac\_email\_subject, |
| [2854](#L2854) | $woocommerce\_ac\_email\_body, |
| [2855](#L2855) | $email\_frequency, |
| [2856](#L2856) | $day\_or\_hour, |
| [2857](#L2857) | $woocommerce\_ac\_template\_name, |
| [2858](#L2858) | $is\_wc\_template, |
| [2859](#L2859) | $default\_value, |
| [2860](#L2860) | $woocommerce\_ac\_email\_header, |
| [2861](#L2861) | $coupon\_code\_id, |
| [2862](#L2862) | $coupon\_code\_options['individual\_use'], |
| [2863](#L2863) | $unique\_coupon, |
| [2864](#L2864) | $coupon\_code\_options['coupon\_amount'], |
| [2865](#L2865) | $coupon\_code\_options['discount\_type'], |
| [2866](#L2866) | $coupon\_code\_options['discount\_shipping'], |
| [2867](#L2867) | $coupon\_code\_options['coupon\_expiry'] |
| [2868](#L2868) | ) |
| [2869](#L2869) | ); |
| [2870](#L2870) | } |
| [2871](#L2871) |  |
| [2872](#L2872) | if ( isset( $\_POST['ac\_settings\_frm'] ) && 'update' === sanitize\_text\_field( wp\_unslash( $\_POST['ac\_settings\_frm'] ) ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [2873](#L2873) |  |
| [2874](#L2874) | $updated\_is\_active = '0'; |
| [2875](#L2875) | $id                = isset( $\_POST['id'] ) ? trim( sanitize\_text\_field( wp\_unslash( $\_POST['id'] ) ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [2876](#L2876) |  |
| [2877](#L2877) | $check\_results = $wpdb->get\_results( //phpcs:ignore |
| [2878](#L2878) | $wpdb->prepare( |
| [2879](#L2879) | 'SELECT \* FROM `' . $wpdb->prefix . 'ac\_email\_templates\_lite` WHERE id = %d', |
| [2880](#L2880) | $id |
| [2881](#L2881) | ) |
| [2882](#L2882) | ); |
| [2883](#L2883) | $default\_value = ''; |
| [2884](#L2884) |  |
| [2885](#L2885) | if ( count( $check\_results ) > 0 ) { |
| [2886](#L2886) | if ( isset( $check\_results[0]->default\_template ) && '1' === $check\_results[0]->default\_template ) { |
| [2887](#L2887) | $default\_value = '1'; |
| [2888](#L2888) | } |
| [2889](#L2889) | } |
| [2890](#L2890) | $coupon\_code\_id      = isset( $\_POST['coupon\_ids'][0] ) ? sanitize\_text\_field( wp\_unslash( implode( ',', $\_POST['coupon\_ids'] ) ) ) : ''; // phpcs:ignore |
| [2891](#L2891) | $unique\_coupon       = ( empty( $\_POST['unique\_coupon'] ) ) ? '0' : '1'; // phpcs:ignore |
| [2892](#L2892) | $coupon\_code\_options = self::wcal\_coupon\_options(); |
| [2893](#L2893) |  |
| [2894](#L2894) | $update\_template\_successfuly = $wpdb->query( //phpcs:ignore |
| [2895](#L2895) | $wpdb->prepare( |
| [2896](#L2896) | 'UPDATE `' . $wpdb->prefix . 'ac\_email\_templates\_lite` SET subject = %s, body = %s, frequency = %d, day\_or\_hour = %s, template\_name = %s, is\_wc\_template = %s, default\_template = %d, wc\_email\_header = %s,coupon\_code = %s, individual\_use =%s, generate\_unique\_coupon\_code = %s, discount = %s, discount\_type = %s, discount\_shipping =%s, discount\_expiry = %s  WHERE id = %d', |
| [2897](#L2897) | $woocommerce\_ac\_email\_subject, |
| [2898](#L2898) | $woocommerce\_ac\_email\_body, |
| [2899](#L2899) | $email\_frequency, |
| [2900](#L2900) | $day\_or\_hour, |
| [2901](#L2901) | $woocommerce\_ac\_template\_name, |
| [2902](#L2902) | $is\_wc\_template, |
| [2903](#L2903) | $default\_value, |
| [2904](#L2904) | $woocommerce\_ac\_email\_header, |
| [2905](#L2905) | $coupon\_code\_id, |
| [2906](#L2906) | $coupon\_code\_options['individual\_use'], |
| [2907](#L2907) | $unique\_coupon, |
| [2908](#L2908) | $coupon\_code\_options['coupon\_amount'], |
| [2909](#L2909) | $coupon\_code\_options['discount\_type'], |
| [2910](#L2910) | $coupon\_code\_options['discount\_shipping'], |
| [2911](#L2911) | $coupon\_code\_options['coupon\_expiry'], |
| [2912](#L2912) | $id |
| [2913](#L2913) | ) |
| [2914](#L2914) | ); |
| [2915](#L2915) | } |
| [2916](#L2916) |  |
| [2917](#L2917) | if ( 'emailtemplates' === $action && 'removetemplate' === $mode ) { |
| [2918](#L2918) | $id\_remove = isset( $\_GET['id'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['id'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [2919](#L2919) | $wpdb->query( //phpcs:ignore |
| [2920](#L2920) | $wpdb->prepare( |
| [2921](#L2921) | 'DELETE FROM `' . $wpdb->prefix . 'ac\_email\_templates\_lite` WHERE id= %d ', |
| [2922](#L2922) | $id\_remove |
| [2923](#L2923) | ) |
| [2924](#L2924) | ); |
| [2925](#L2925) | } |
| [2926](#L2926) |  |
| [2927](#L2927) | if ( 'emailtemplates' === $action && 'activate\_template' === $mode ) { |
| [2928](#L2928) | $template\_id             = isset( $\_GET['id'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['id'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [2929](#L2929) | $current\_template\_status = isset( $\_GET['active\_state'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['active\_state'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [2930](#L2930) |  |
| [2931](#L2931) | if ( '1' === $current\_template\_status ) { |
| [2932](#L2932) | $active = '0'; |
| [2933](#L2933) | } else { |
| [2934](#L2934) | $active                       = '1'; |
| [2935](#L2935) | $get\_selected\_template\_result = $wpdb->get\_results( // phpcs:ignore |
| [2936](#L2936) | $wpdb->prepare( |
| [2937](#L2937) | 'SELECT \* FROM `' . $wpdb->prefix . 'ac\_email\_templates\_lite` WHERE id = %d', |
| [2938](#L2938) | $template\_id |
| [2939](#L2939) | ) |
| [2940](#L2940) | ); |
| [2941](#L2941) |  |
| [2942](#L2942) | $email\_frequncy    = $get\_selected\_template\_result[0]->frequency; |
| [2943](#L2943) | $email\_day\_or\_hour = $get\_selected\_template\_result[0]->day\_or\_hour; |
| [2944](#L2944) | $wcap\_updated      = $wpdb->query( // phpcs:ignore |
| [2945](#L2945) | $wpdb->prepare( |
| [2946](#L2946) | 'UPDATE `' . $wpdb->prefix . 'ac\_email\_templates\_lite` SET is\_active = %s WHERE frequency = %s AND day\_or\_hour = %s', |
| [2947](#L2947) | 0, |
| [2948](#L2948) | $email\_frequncy, |
| [2949](#L2949) | $email\_day\_or\_hour |
| [2950](#L2950) | ) |
| [2951](#L2951) | ); |
| [2952](#L2952) | } |
| [2953](#L2953) |  |
| [2954](#L2954) | $wpdb->query( // phpcs:ignore |
| [2955](#L2955) | $wpdb->prepare( |
| [2956](#L2956) | 'UPDATE `' . $wpdb->prefix . 'ac\_email\_templates\_lite` SET is\_active = %s WHERE id = %s', |
| [2957](#L2957) | $active, |
| [2958](#L2958) | $template\_id |
| [2959](#L2959) | ) |
| [2960](#L2960) | ); |
| [2961](#L2961) |  |
| [2962](#L2962) | wp\_safe\_redirect( admin\_url( '/admin.php?page=woocommerce\_ac\_page&action=emailtemplates' ) ); |
| [2963](#L2963) | } |
| [2964](#L2964) |  |
| [2965](#L2965) | if ( isset( $\_POST['ac\_settings\_frm'] ) && 'save' === $\_POST['ac\_settings\_frm'] && ( isset( $insert\_template\_successfuly ) && '' !== $insert\_template\_successfuly ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [2966](#L2966) | ?> |
| [2967](#L2967) | <div id="message" class="updated fade"> |
| [2968](#L2968) | <p> |
| [2969](#L2969) | <strong> |
| [2970](#L2970) | <?php esc\_html\_e( 'The Email Template has been successfully added. In order to start sending this email to your customers, please activate it.', 'woocommerce-abandoned-cart' ); ?> |
| [2971](#L2971) | </strong> |
| [2972](#L2972) | </p> |
| [2973](#L2973) | </div> |
| [2974](#L2974) | <?php |
| [2975](#L2975) | } elseif ( isset( $\_POST['ac\_settings\_frm'] ) && 'save' === $\_POST['ac\_settings\_frm'] && ( isset( $insert\_template\_successfuly ) && '' === $insert\_template\_successfuly ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [2976](#L2976) | ?> |
| [2977](#L2977) | <div id="message" class="error fade"> |
| [2978](#L2978) | <p> |
| [2979](#L2979) | <strong> |
| [2980](#L2980) | <?php esc\_html\_e( 'There was a problem adding the email template. Please contact the plugin author via <a href= "https://wordpress.org/support/plugin/woocommerce-abandoned-cart">support forum</a>.', 'woocommerce-abandoned-cart' ); ?> |
| [2981](#L2981) | </strong> |
| [2982](#L2982) | </p> |
| [2983](#L2983) | </div> |
| [2984](#L2984) | <?php |
| [2985](#L2985) | } |
| [2986](#L2986) |  |
| [2987](#L2987) | if ( isset( $\_POST['ac\_settings\_frm'] ) && 'update' === $\_POST['ac\_settings\_frm'] && isset( $update\_template\_successfuly ) && false !== $update\_template\_successfuly ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [2988](#L2988) | ?> |
| [2989](#L2989) | <div id="message" class="updated fade"> |
| [2990](#L2990) | <p> |
| [2991](#L2991) | <strong> |
| [2992](#L2992) | <?php esc\_html\_e( 'The Email Template has been successfully updated.', 'woocommerce-abandoned-cart' ); ?> |
| [2993](#L2993) | </strong> |
| [2994](#L2994) | </p> |
| [2995](#L2995) | </div> |
| [2996](#L2996) | <?php |
| [2997](#L2997) | } elseif ( isset( $\_POST['ac\_settings\_frm'] ) && 'update' === $\_POST['ac\_settings\_frm'] && isset( $update\_template\_successfuly ) && false === $update\_template\_successfuly ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [2998](#L2998) | ?> |
| [2999](#L2999) | <div id="message" class="error fade"> |
| [3000](#L3000) | <p> |
| [3001](#L3001) | <strong> |
| [3002](#L3002) | <?php esc\_html\_e( 'There was a problem updating the email template. Please contact the plugin author via <a href= "https://wordpress.org/support/plugin/woocommerce-abandoned-cart">support forum</a>.', 'woocommerce-abandoned-cart' ); ?> |
| [3003](#L3003) | </strong> |
| [3004](#L3004) | </p> |
| [3005](#L3005) | </div> |
| [3006](#L3006) | <?php |
| [3007](#L3007) | } |
| [3008](#L3008) | ?> |
| [3009](#L3009) | <div class="tablenav"> |
| [3010](#L3010) | <p style="float:left;"> |
| [3011](#L3011) | <a cursor: pointer; href="<?php echo esc\_url( 'admin.php?page=woocommerce\_ac\_page&action=emailtemplates&mode=addnewtemplate' ); ?>" class="button-secondary"><?php esc\_html\_e( 'Add New Template', 'woocommerce-abandoned-cart' ); ?></a> |
| [3012](#L3012) | </p> |
| [3013](#L3013) |  |
| [3014](#L3014) | <?php |
| [3015](#L3015) | // From here you can do whatever you want with the data from the $result link. |
| [3016](#L3016) | include\_once 'includes/classes/class-wcal-templates-table.php'; |
| [3017](#L3017) | $wcal\_template\_list = new WCAL\_Templates\_Table(); |
| [3018](#L3018) | $wcal\_template\_list->wcal\_templates\_prepare\_items(); |
| [3019](#L3019) | ?> |
| [3020](#L3020) | <div class="wrap"> |
| [3021](#L3021) | <form id="wcal-abandoned-templates" method="get" > |
| [3022](#L3022) | <input type="hidden" name="page" value="woocommerce\_ac\_page" /> |
| [3023](#L3023) | <input type="hidden" name="action" value="emailtemplates" /> |
| [3024](#L3024) | <?php $wcal\_template\_list->display(); ?> |
| [3025](#L3025) | </form> |
| [3026](#L3026) | </div> |
| [3027](#L3027) | </div> |
| [3028](#L3028) | <?php |
| [3029](#L3029) | } elseif ( 'stats' === $action || '' === $action ) { |
| [3030](#L3030) | ?> |
| [3031](#L3031) | <p> |
| [3032](#L3032) | <script language='javascript'> |
| [3033](#L3033) | jQuery( document ).ready( function() { |
| [3034](#L3034) | jQuery( '#duration\_select' ).change( function() { |
| [3035](#L3035) | var group\_name = jQuery( '#duration\_select' ).val(); |
| [3036](#L3036) | var today      = new Date(); |
| [3037](#L3037) | var start\_date = ""; |
| [3038](#L3038) | var end\_date   = ""; |
| [3039](#L3039) | if ( group\_name == "yesterday" ) { |
| [3040](#L3040) | start\_date = new Date( today.getFullYear(), today.getMonth(), today.getDate() - 1 ); |
| [3041](#L3041) | end\_date   = new Date( today.getFullYear(), today.getMonth(), today.getDate() - 1 ); |
| [3042](#L3042) | } else if ( group\_name == "today") { |
| [3043](#L3043) | start\_date = new Date( today.getFullYear(), today.getMonth(), today.getDate() ); |
| [3044](#L3044) | end\_date   = new Date( today.getFullYear(), today.getMonth(), today.getDate() ); |
| [3045](#L3045) | } else if ( group\_name == "last\_seven" ) { |
| [3046](#L3046) | start\_date = new Date( today.getFullYear(), today.getMonth(), today.getDate() - 7 ); |
| [3047](#L3047) | end\_date   = new Date( today.getFullYear(), today.getMonth(), today.getDate() ); |
| [3048](#L3048) | } else if ( group\_name == "last\_fifteen" ) { |
| [3049](#L3049) | start\_date = new Date( today.getFullYear(), today.getMonth(), today.getDate() - 15 ); |
| [3050](#L3050) | end\_date   = new Date( today.getFullYear(), today.getMonth(), today.getDate() ); |
| [3051](#L3051) | } else if ( group\_name == "last\_thirty" ) { |
| [3052](#L3052) | start\_date = new Date( today.getFullYear(), today.getMonth(), today.getDate() - 30 ); |
| [3053](#L3053) | end\_date   = new Date( today.getFullYear(), today.getMonth(), today.getDate() ); |
| [3054](#L3054) | } else if ( group\_name == "last\_ninety" ) { |
| [3055](#L3055) | start\_date = new Date( today.getFullYear(), today.getMonth(), today.getDate() - 90 ); |
| [3056](#L3056) | end\_date   = new Date( today.getFullYear(), today.getMonth(), today.getDate() ); |
| [3057](#L3057) | } else if ( group\_name == "last\_year\_days" ) { |
| [3058](#L3058) | start\_date = new Date( today.getFullYear(), today.getMonth(), today.getDate() - 365 ); |
| [3059](#L3059) | end\_date   = new Date( today.getFullYear(), today.getMonth(), today.getDate() ); |
| [3060](#L3060) | } |
| [3061](#L3061) |  |
| [3062](#L3062) | var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"]; |
| [3063](#L3063) |  |
| [3064](#L3064) | var start\_date\_value = start\_date.getDate() + " " + monthNames[start\_date.getMonth()] + " " + start\_date.getFullYear(); |
| [3065](#L3065) | var end\_date\_value   = end\_date.getDate() + " " + monthNames[end\_date.getMonth()] + " " + end\_date.getFullYear(); |
| [3066](#L3066) |  |
| [3067](#L3067) | jQuery( '#start\_date' ).val( start\_date\_value ); |
| [3068](#L3068) | jQuery( '#end\_date' ).val( end\_date\_value ); |
| [3069](#L3069) | } ); |
| [3070](#L3070) | }); |
| [3071](#L3071) | </script> |
| [3072](#L3072) | <?php |
| [3073](#L3073) | $duration\_range = isset( $\_POST['duration\_select'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['duration\_select'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [3074](#L3074) | if ( '' === $duration\_range ) { |
| [3075](#L3075) | if ( isset( $\_GET['duration\_select'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [3076](#L3076) | $duration\_range = sanitize\_text\_field( wp\_unslash( $\_GET['duration\_select'] ) ); // phpcs:ignore WordPress.Security.NonceVerification |
| [3077](#L3077) | } |
| [3078](#L3078) | } |
| [3079](#L3079) | if ( '' === $duration\_range ) { |
| [3080](#L3080) | $duration\_range = 'last\_seven'; |
| [3081](#L3081) | } |
| [3082](#L3082) |  |
| [3083](#L3083) | echo esc\_html\_e( 'The Report below shows how many Abandoned Carts we were able to recover for you by sending automatic emails to encourage shoppers.', 'woocommerce-abandoned-cart' ); |
| [3084](#L3084) | ?> |
| [3085](#L3085) | <div id="recovered\_stats" class="postbox" style="display:block"> |
| [3086](#L3086) | <div class="inside"> |
| [3087](#L3087) | <form method="post" action="admin.php?page=woocommerce\_ac\_page&action=stats" id="ac\_stats"> |
| [3088](#L3088) | <select id="duration\_select" name="duration\_select" > |
| [3089](#L3089) | <?php |
| [3090](#L3090) | foreach ( $this->duration\_range\_select as $key => $value ) { |
| [3091](#L3091) | $sel = ''; |
| [3092](#L3092) | if ( $key == $duration\_range ) { // phpcs:ignore |
| [3093](#L3093) | $sel = ' selected '; |
| [3094](#L3094) | } |
| [3095](#L3095) | printf( |
| [3096](#L3096) | '<option value="%s" %s> %s </option>', |
| [3097](#L3097) | esc\_attr( $key ), |
| [3098](#L3098) | esc\_attr( $sel ), |
| [3099](#L3099) | esc\_attr( $value ) |
| [3100](#L3100) | ); |
| [3101](#L3101) | } |
| [3102](#L3102) | $date\_sett = $this->start\_end\_dates[ $duration\_range ]; |
| [3103](#L3103) | ?> |
| [3104](#L3104) | </select> |
| [3105](#L3105) | <script type="text/javascript"> |
| [3106](#L3106) | jQuery( document ).ready( function() { |
| [3107](#L3107) | var formats = ["d.m.y", "d M yy","MM d, yy"]; |
| [3108](#L3108) | jQuery( "#start\_date" ).datepicker( { dateFormat: formats[1] } ); |
| [3109](#L3109) | }); |
| [3110](#L3110) |  |
| [3111](#L3111) | jQuery( document ).ready( function() |
| [3112](#L3112) | { |
| [3113](#L3113) | var formats = ["d.m.y", "d M yy","MM d, yy"]; |
| [3114](#L3114) | jQuery( "#end\_date" ).datepicker( { dateFormat: formats[1] } ); |
| [3115](#L3115) | }); |
| [3116](#L3116) | </script> |
| [3117](#L3117) | <?php |
| [3118](#L3118) | include\_once 'includes/classes/class-wcal-recover-orders-table.php'; |
| [3119](#L3119) | $wcal\_recover\_orders\_list = new Wcal\_Recover\_Orders\_Table(); |
| [3120](#L3120) | $wcal\_recover\_orders\_list->wcal\_recovered\_orders\_prepare\_items(); |
| [3121](#L3121) |  |
| [3122](#L3122) | $start\_date\_range = isset( $\_POST['start\_date'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['start\_date'] ) ) : '';// phpcs:ignore WordPress.Security.NonceVerification |
| [3123](#L3123) |  |
| [3124](#L3124) | if ( '' === $start\_date\_range ) { |
| [3125](#L3125) | $start\_date\_range = $date\_sett['start\_date']; |
| [3126](#L3126) | } |
| [3127](#L3127) |  |
| [3128](#L3128) | $end\_date\_range = isset( $\_POST['end\_date'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['end\_date'] ) ) : '';// phpcs:ignore WordPress.Security.NonceVerification |
| [3129](#L3129) |  |
| [3130](#L3130) | if ( '' === $end\_date\_range ) { |
| [3131](#L3131) | $end\_date\_range = $date\_sett['end\_date']; |
| [3132](#L3132) | } |
| [3133](#L3133) | ?> |
| [3134](#L3134) | <label class="start\_label" for="start\_day"> <?php esc\_html\_e( 'Start Date:', 'woocommerce-abandoned-cart' ); ?> </label> |
| [3135](#L3135) | <input type="text" id="start\_date" name="start\_date" readonly="readonly" value="<?php echo esc\_attr( $start\_date\_range ); ?>"/> |
| [3136](#L3136) | <label class="end\_label" for="end\_day"> <?php esc\_html\_e( 'End Date:', 'woocommerce-abandoned-cart' ); ?> </label> |
| [3137](#L3137) | <input type="text" id="end\_date" name="end\_date" readonly="readonly" value="<?php echo esc\_attr( $end\_date\_range ); ?>"/> |
| [3138](#L3138) | <input type="submit" name="Submit" class="button-primary" value="<?php esc\_attr\_e( 'Go', 'woocommerce-abandoned-cart' ); ?>"  /> |
| [3139](#L3139) | </form> |
| [3140](#L3140) | </div> |
| [3141](#L3141) | </div> |
| [3142](#L3142) | <div id="recovered\_stats" class="postbox" style="display:block"> |
| [3143](#L3143) | <div class="inside" > |
| [3144](#L3144) | <?php |
| [3145](#L3145) | $count              = $wcal\_recover\_orders\_list->total\_abandoned\_cart\_count; |
| [3146](#L3146) | $total\_of\_all\_order = $wcal\_recover\_orders\_list->total\_order\_amount; |
| [3147](#L3147) | $recovered\_item     = $wcal\_recover\_orders\_list->recovered\_item; |
| [3148](#L3148) | $recovered\_total    = wc\_price( $wcal\_recover\_orders\_list->total\_recover\_amount ); |
| [3149](#L3149) | ?> |
| [3150](#L3150) | <p style="font-size: 15px;"> |
| [3151](#L3151) | <?php |
| [3152](#L3152) | printf( |
| [3153](#L3153) | // translators: All counts of items & amounts. |
| [3154](#L3154) | wp\_kses\_post( |
| [3155](#L3155) | // translators: Abandoned & recovered numbers and order totals. |
| [3156](#L3156) | \_\_( 'During the selected range <strong>%1$d</strong> carts totaling <strong>%2$s</strong> were abandoned. We were able to recover <strong>%3$d</strong> of them, which led to an extra <strong>%4$s</strong>', 'woocommerce-abandoned-cart' ) |
| [3157](#L3157) | ), |
| [3158](#L3158) | esc\_attr( $count ), |
| [3159](#L3159) | wp\_kses\_post( $total\_of\_all\_order ), |
| [3160](#L3160) | esc\_attr( $recovered\_item ), |
| [3161](#L3161) | wp\_kses\_post( $recovered\_total ) |
| [3162](#L3162) | ); |
| [3163](#L3163) | ?> |
| [3164](#L3164) | </p> |
| [3165](#L3165) | </div> |
| [3166](#L3166) | </div> |
| [3167](#L3167) | <div class="wrap"> |
| [3168](#L3168) | <form id="wcal-recover-orders" method="get" > |
| [3169](#L3169) | <input type="hidden" name="page" value="woocommerce\_ac\_page" /> |
| [3170](#L3170) | <input type="hidden" name="action" value="stats" /> |
| [3171](#L3171) | <?php $wcal\_recover\_orders\_list->display(); ?> |
| [3172](#L3172) | </form> |
| [3173](#L3173) | </div> |
| [3174](#L3174) | <?php |
| [3175](#L3175) | } elseif ( 'orderdetails' === $action ) { |
| [3176](#L3176) | global $woocommerce; |
| [3177](#L3177) | $ac\_order\_id = isset( $\_GET['id'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['id'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [3178](#L3178) | ?> |
| [3179](#L3179) | <div id="ac\_order\_details" class="postbox" style="display:block"> |
| [3180](#L3180) | <?php // translators: Abandoned Order ID. ?> |
| [3181](#L3181) | <h3 class="details-title"> <p> <?php printf( esc\_html\_\_( 'Abandoned Order #%s Details', 'woocommerce-abandoned-cart' ), esc\_attr( $ac\_order\_id ) ); ?> </p> </h3> |
| [3182](#L3182) | <div class="inside"> |
| [3183](#L3183) | <table cellpadding="0" cellspacing="0" class="wp-list-table widefat fixed posts"> |
| [3184](#L3184) | <tr> |
| [3185](#L3185) | <th> <?php esc\_html\_e( 'Item', 'woocommerce-abandoned-cart' ); ?> </th> |
| [3186](#L3186) | <th> <?php esc\_html\_e( 'Name', 'woocommerce-abandoned-cart' ); ?> </th> |
| [3187](#L3187) | <th> <?php esc\_html\_e( 'Quantity', 'woocommerce-abandoned-cart' ); ?> </th> |
| [3188](#L3188) | <th> <?php esc\_html\_e( 'Line Subtotal', 'woocommerce-abandoned-cart' ); ?> </th> |
| [3189](#L3189) | <th> <?php esc\_html\_e( 'Line Total', 'woocommerce-abandoned-cart' ); ?> </th> |
| [3190](#L3190) | </tr> |
| [3191](#L3191) | <?php |
| [3192](#L3192) | $results = $wpdb->get\_results( // phpcs:ignore |
| [3193](#L3193) | $wpdb->prepare( |
| [3194](#L3194) | 'SELECT \* FROM `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` WHERE id = %d', |
| [3195](#L3195) | sanitize\_text\_field( wp\_unslash( $\_GET['id'] ) ) // phpcs:ignore WordPress.Security.NonceVerification |
| [3196](#L3196) | ) |
| [3197](#L3197) | ); |
| [3198](#L3198) |  |
| [3199](#L3199) | $shipping\_charges = 0; |
| [3200](#L3200) | $currency\_symbol  = get\_woocommerce\_currency\_symbol(); |
| [3201](#L3201) | $number\_decimal   = wc\_get\_price\_decimals(); |
| [3202](#L3202) | if ( 'GUEST' === $results[0]->user\_type && $results[0]->user\_id > 0 ) { |
| [3203](#L3203) | $results\_guest = $wpdb->get\_results( // phpcs:ignore |
| [3204](#L3204) | $wpdb->prepare( |
| [3205](#L3205) | 'SELECT \* FROM `' . $wpdb->prefix . 'ac\_guest\_abandoned\_cart\_history\_lite` WHERE id = %d', |
| [3206](#L3206) | $results[0]->user\_id |
| [3207](#L3207) | ) |
| [3208](#L3208) | ); |
| [3209](#L3209) |  |
| [3210](#L3210) | $user\_email             = ''; |
| [3211](#L3211) | $user\_first\_name        = ''; |
| [3212](#L3212) | $user\_last\_name         = ''; |
| [3213](#L3213) | $user\_billing\_postcode  = ''; |
| [3214](#L3214) | $user\_shipping\_postcode = ''; |
| [3215](#L3215) | $shipping\_charges       = ''; |
| [3216](#L3216) | if ( count( $results\_guest ) > 0 ) { |
| [3217](#L3217) | $user\_email             = $results\_guest[0]->email\_id; |
| [3218](#L3218) | $user\_first\_name        = $results\_guest[0]->billing\_first\_name; |
| [3219](#L3219) | $user\_last\_name         = $results\_guest[0]->billing\_last\_name; |
| [3220](#L3220) | $user\_billing\_postcode  = $results\_guest[0]->billing\_zipcode; |
| [3221](#L3221) | $user\_shipping\_postcode = $results\_guest[0]->shipping\_zipcode; |
| [3222](#L3222) | $shipping\_charges       = $results\_guest[0]->shipping\_charges; |
| [3223](#L3223) | } |
| [3224](#L3224) | $user\_billing\_company   = ''; |
| [3225](#L3225) | $user\_billing\_address\_1 = ''; |
| [3226](#L3226) | $user\_billing\_address\_2 = ''; |
| [3227](#L3227) | $user\_billing\_city      = ''; |
| [3228](#L3228) | $user\_billing\_state     = ''; |
| [3229](#L3229) | $user\_billing\_country   = ''; |
| [3230](#L3230) | $user\_billing\_phone     = ''; |
| [3231](#L3231) |  |
| [3232](#L3232) | $user\_shipping\_company   = ''; |
| [3233](#L3233) | $user\_shipping\_address\_1 = ''; |
| [3234](#L3234) | $user\_shipping\_address\_2 = ''; |
| [3235](#L3235) | $user\_shipping\_city      = ''; |
| [3236](#L3236) | $user\_shipping\_state     = ''; |
| [3237](#L3237) | $user\_shipping\_country   = ''; |
| [3238](#L3238) | } elseif ( 'GUEST' === $results[0]->user\_type && $results[0]->user\_id > 0 ) { |
| [3239](#L3239) | $user\_email              = ''; |
| [3240](#L3240) | $user\_first\_name         = 'Visitor'; |
| [3241](#L3241) | $user\_last\_name          = ''; |
| [3242](#L3242) | $user\_billing\_postcode   = ''; |
| [3243](#L3243) | $user\_shipping\_postcode  = ''; |
| [3244](#L3244) | $shipping\_charges        = ''; |
| [3245](#L3245) | $user\_billing\_phone      = ''; |
| [3246](#L3246) | $user\_billing\_company    = ''; |
| [3247](#L3247) | $user\_billing\_address\_1  = ''; |
| [3248](#L3248) | $user\_billing\_address\_2  = ''; |
| [3249](#L3249) | $user\_billing\_city       = ''; |
| [3250](#L3250) | $user\_billing\_state      = ''; |
| [3251](#L3251) | $user\_billing\_country    = ''; |
| [3252](#L3252) | $user\_shipping\_company   = ''; |
| [3253](#L3253) | $user\_shipping\_address\_1 = ''; |
| [3254](#L3254) | $user\_shipping\_address\_2 = ''; |
| [3255](#L3255) | $user\_shipping\_city      = ''; |
| [3256](#L3256) | $user\_shipping\_state     = ''; |
| [3257](#L3257) | $user\_shipping\_country   = ''; |
| [3258](#L3258) | } else { |
| [3259](#L3259) | $user\_id = $results[0]->user\_id; |
| [3260](#L3260) | if ( isset( $results[0]->user\_login ) ) { |
| [3261](#L3261) | $user\_login = $results[0]->user\_login; |
| [3262](#L3262) | } |
| [3263](#L3263) | $user\_email = get\_user\_meta( $results[0]->user\_id, 'billing\_email', true ); |
| [3264](#L3264) | if ( '' == $user\_email ) { // phpcs:ignore |
| [3265](#L3265) | $user\_data = get\_userdata( $results[0]->user\_id ); |
| [3266](#L3266) | if ( isset( $user\_data->user\_email ) ) { |
| [3267](#L3267) | $user\_email = $user\_data->user\_email; |
| [3268](#L3268) | } else { |
| [3269](#L3269) | $user\_email = ''; |
| [3270](#L3270) | } |
| [3271](#L3271) | } |
| [3272](#L3272) |  |
| [3273](#L3273) | $user\_first\_name      = ''; |
| [3274](#L3274) | $user\_first\_name\_temp = get\_user\_meta( $user\_id, 'billing\_first\_name', true ); |
| [3275](#L3275) | if ( isset( $user\_first\_name\_temp ) && '' == $user\_first\_name\_temp ) { // phpcs:ignore |
| [3276](#L3276) | $user\_data = get\_userdata( $user\_id ); |
| [3277](#L3277) | if ( isset( $user\_data->first\_name ) ) { |
| [3278](#L3278) | $user\_first\_name = $user\_data->first\_name; |
| [3279](#L3279) | } else { |
| [3280](#L3280) | $user\_first\_name = ''; |
| [3281](#L3281) | } |
| [3282](#L3282) | } else { |
| [3283](#L3283) | $user\_first\_name = $user\_first\_name\_temp; |
| [3284](#L3284) | } |
| [3285](#L3285) | $user\_last\_name      = ''; |
| [3286](#L3286) | $user\_last\_name\_temp = get\_user\_meta( $user\_id, 'billing\_last\_name', true ); |
| [3287](#L3287) | if ( isset( $user\_last\_name\_temp ) && '' == $user\_last\_name\_temp ) { // phpcs:ignore |
| [3288](#L3288) | $user\_data = get\_userdata( $user\_id ); |
| [3289](#L3289) | if ( isset( $user\_data->last\_name ) ) { |
| [3290](#L3290) | $user\_last\_name = $user\_data->last\_name; |
| [3291](#L3291) | } else { |
| [3292](#L3292) | $user\_last\_name = ''; |
| [3293](#L3293) | } |
| [3294](#L3294) | } else { |
| [3295](#L3295) | $user\_last\_name = $user\_last\_name\_temp; |
| [3296](#L3296) | } |
| [3297](#L3297) | $user\_billing\_first\_name = get\_user\_meta( $results[0]->user\_id, 'billing\_first\_name' ); |
| [3298](#L3298) | $user\_billing\_last\_name  = get\_user\_meta( $results[0]->user\_id, 'billing\_last\_name' ); |
| [3299](#L3299) |  |
| [3300](#L3300) | $user\_billing\_details = wcal\_common::wcal\_get\_billing\_details( $results[0]->user\_id ); |
| [3301](#L3301) |  |
| [3302](#L3302) | $user\_billing\_company   = $user\_billing\_details['billing\_company']; |
| [3303](#L3303) | $user\_billing\_address\_1 = $user\_billing\_details['billing\_address\_1']; |
| [3304](#L3304) | $user\_billing\_address\_2 = $user\_billing\_details['billing\_address\_2']; |
| [3305](#L3305) | $user\_billing\_city      = $user\_billing\_details['billing\_city']; |
| [3306](#L3306) | $user\_billing\_postcode  = $user\_billing\_details['billing\_postcode']; |
| [3307](#L3307) | $user\_billing\_country   = $user\_billing\_details['billing\_country']; |
| [3308](#L3308) | $user\_billing\_state     = $user\_billing\_details['billing\_state']; |
| [3309](#L3309) |  |
| [3310](#L3310) | $user\_billing\_phone\_temp = get\_user\_meta( $results[0]->user\_id, 'billing\_phone' ); |
| [3311](#L3311) | if ( isset( $user\_billing\_phone\_temp[0] ) ) { |
| [3312](#L3312) | $user\_billing\_phone = $user\_billing\_phone\_temp[0]; |
| [3313](#L3313) | } else { |
| [3314](#L3314) | $user\_billing\_phone = ''; |
| [3315](#L3315) | } |
| [3316](#L3316) | $user\_shipping\_first\_name   = get\_user\_meta( $results[0]->user\_id, 'shipping\_first\_name' ); |
| [3317](#L3317) | $user\_shipping\_last\_name    = get\_user\_meta( $results[0]->user\_id, 'shipping\_last\_name' ); |
| [3318](#L3318) | $user\_shipping\_company\_temp = get\_user\_meta( $results[0]->user\_id, 'shipping\_company' ); |
| [3319](#L3319) | if ( isset( $user\_shipping\_company\_temp[0] ) ) { |
| [3320](#L3320) | $user\_shipping\_company = $user\_shipping\_company\_temp[0]; |
| [3321](#L3321) | } else { |
| [3322](#L3322) | $user\_shipping\_company = ''; |
| [3323](#L3323) | } |
| [3324](#L3324) | $user\_shipping\_address\_1\_temp = get\_user\_meta( $results[0]->user\_id, 'shipping\_address\_1' ); |
| [3325](#L3325) | if ( isset( $user\_shipping\_address\_1\_temp[0] ) ) { |
| [3326](#L3326) | $user\_shipping\_address\_1 = $user\_shipping\_address\_1\_temp[0]; |
| [3327](#L3327) | } else { |
| [3328](#L3328) | $user\_shipping\_address\_1 = ''; |
| [3329](#L3329) | } |
| [3330](#L3330) | $user\_shipping\_address\_2\_temp = get\_user\_meta( $results[0]->user\_id, 'shipping\_address\_2' ); |
| [3331](#L3331) | if ( isset( $user\_shipping\_address\_2\_temp[0] ) ) { |
| [3332](#L3332) | $user\_shipping\_address\_2 = $user\_shipping\_address\_2\_temp[0]; |
| [3333](#L3333) | } else { |
| [3334](#L3334) | $user\_shipping\_address\_2 = ''; |
| [3335](#L3335) | } |
| [3336](#L3336) | $user\_shipping\_city\_temp = get\_user\_meta( $results[0]->user\_id, 'shipping\_city' ); |
| [3337](#L3337) | if ( isset( $user\_shipping\_city\_temp[0] ) ) { |
| [3338](#L3338) | $user\_shipping\_city = $user\_shipping\_city\_temp[0]; |
| [3339](#L3339) | } else { |
| [3340](#L3340) | $user\_shipping\_city = ''; |
| [3341](#L3341) | } |
| [3342](#L3342) | $user\_shipping\_postcode\_temp = get\_user\_meta( $results[0]->user\_id, 'shipping\_postcode' ); |
| [3343](#L3343) | if ( isset( $user\_shipping\_postcode\_temp[0] ) ) { |
| [3344](#L3344) | $user\_shipping\_postcode = $user\_shipping\_postcode\_temp[0]; |
| [3345](#L3345) | } else { |
| [3346](#L3346) | $user\_shipping\_postcode = ''; |
| [3347](#L3347) | } |
| [3348](#L3348) | $user\_shipping\_country\_temp = get\_user\_meta( $results[0]->user\_id, 'shipping\_country' ); |
| [3349](#L3349) | $user\_shipping\_country      = ''; |
| [3350](#L3350) | if ( isset( $user\_shipping\_country\_temp[0] ) ) { |
| [3351](#L3351) | $user\_shipping\_country = $user\_shipping\_country\_temp[0]; |
| [3352](#L3352) | if ( isset( $woocommerce->countries->countries[ $user\_shipping\_country ] ) ) { |
| [3353](#L3353) | $user\_shipping\_country = $woocommerce->countries->countries[ $user\_shipping\_country ]; |
| [3354](#L3354) | } else { |
| [3355](#L3355) | $user\_shipping\_country = ''; |
| [3356](#L3356) | } |
| [3357](#L3357) | } |
| [3358](#L3358) | $user\_shipping\_state\_temp = get\_user\_meta( $results[0]->user\_id, 'shipping\_state' ); |
| [3359](#L3359) | $user\_shipping\_state      = ''; |
| [3360](#L3360) | if ( isset( $user\_shipping\_state\_temp[0] ) ) { |
| [3361](#L3361) | $user\_shipping\_state = $user\_shipping\_state\_temp[0]; |
| [3362](#L3362) | if ( isset( $woocommerce->countries->states[ $user\_shipping\_country\_temp[0] ][ $user\_shipping\_state ] ) ) { |
| [3363](#L3363) | // code... |
| [3364](#L3364) | $user\_shipping\_state = $woocommerce->countries->states[ $user\_shipping\_country\_temp[0] ][ $user\_shipping\_state ]; |
| [3365](#L3365) | } |
| [3366](#L3366) | } |
| [3367](#L3367) | } |
| [3368](#L3368) |  |
| [3369](#L3369) | $cart\_details  = array(); |
| [3370](#L3370) | $cart\_info     = json\_decode( $results[0]->abandoned\_cart\_info ); |
| [3371](#L3371) | $cart\_details  = (array) $cart\_info->cart; |
| [3372](#L3372) | $item\_subtotal = 0; |
| [3373](#L3373) | $item\_total    = 0; |
| [3374](#L3374) |  |
| [3375](#L3375) | if ( is\_array( $cart\_details ) && count( $cart\_details ) > 0 ) { |
| [3376](#L3376) | foreach ( $cart\_details as $k => $v ) { |
| [3377](#L3377) |  |
| [3378](#L3378) | $item\_details = wcal\_common::wcal\_get\_cart\_details( $v ); |
| [3379](#L3379) |  |
| [3380](#L3380) | $product\_id = $v->product\_id; |
| [3381](#L3381) | $product    = wc\_get\_product( $product\_id ); |
| [3382](#L3382) | if ( ! $product ) { // product not found, exclude it from the cart display. |
| [3383](#L3383) | continue; |
| [3384](#L3384) | } |
| [3385](#L3385) | $prod\_image       = $product->get\_image( array( 200, 200 ) ); |
| [3386](#L3386) | $product\_page\_url = get\_permalink( $product\_id ); |
| [3387](#L3387) | $product\_name     = $item\_details['product\_name']; |
| [3388](#L3388) | $item\_subtotal    = $item\_details['item\_total\_formatted']; |
| [3389](#L3389) | $item\_total       = $item\_details['item\_total']; |
| [3390](#L3390) | $quantity\_total   = $item\_details['qty']; |
| [3391](#L3391) |  |
| [3392](#L3392) | $qty\_item\_text = 'item'; |
| [3393](#L3393) | if ( $quantity\_total > 1 ) { |
| [3394](#L3394) | $qty\_item\_text = 'items'; |
| [3395](#L3395) | } |
| [3396](#L3396) | ?> |
| [3397](#L3397) | <tr> |
| [3398](#L3398) | <td> <?php echo $prod\_image; // phpcs:ignore ?></td> |
| [3399](#L3399) | <td> <?php echo '<a href="' . esc\_url( $product\_page\_url ) . '"> ' . esc\_html( $product\_name ) . ' </a>'; ?> </td> |
| [3400](#L3400) | <td> <?php echo esc\_html( $quantity\_total ); ?></td> |
| [3401](#L3401) | <td> <?php echo esc\_html( $item\_subtotal ); ?></td> |
| [3402](#L3402) | <td> <?php echo esc\_html( $item\_total ); ?></td> |
| [3403](#L3403) | </tr> |
| [3404](#L3404) | <?php |
| [3405](#L3405) | $item\_subtotal = 0; |
| [3406](#L3406) | $item\_total    = 0; |
| [3407](#L3407) | } |
| [3408](#L3408) | } |
| [3409](#L3409) | ?> |
| [3410](#L3410) | </table> |
| [3411](#L3411) | </div> |
| [3412](#L3412) | </div> |
| [3413](#L3413) | <div id="ac\_order\_customer\_details" class="postbox" style="display:block"> |
| [3414](#L3414) | <h3 class="details-title"> <p> <?php esc\_html\_e( 'Customer Details', 'woocommerce-abandoned-cart' ); ?> </p> </h3> |
| [3415](#L3415) | <div class="inside" style="height: 300px;" > |
| [3416](#L3416) | <div id="order\_data" class="panel"> |
| [3417](#L3417) | <div style="width:50%;float:left"> |
| [3418](#L3418) | <h3> <p> <?php esc\_html\_e( 'Billing Details', 'woocommerce-abandoned-cart' ); ?> </p> </h3> |
| [3419](#L3419) | <p> <strong> <?php esc\_html\_e( 'Name:', 'woocommerce-abandoned-cart' ); ?> </strong> |
| [3420](#L3420) | <?php echo esc\_html( "$user\_first\_name $user\_last\_name" ); ?> |
| [3421](#L3421) | </p> |
| [3422](#L3422) | <p> <strong> <?php esc\_html\_e( 'Address:', 'woocommerce-abandoned-cart' ); ?> </strong> |
| [3423](#L3423) | <?php |
| [3424](#L3424) | echo esc\_html( $user\_billing\_company ) . '</br>' . |
| [3425](#L3425) | esc\_html( $user\_billing\_address\_1 ) . '</br>' . |
| [3426](#L3426) | esc\_html( $user\_billing\_address\_2 ) . '</br>' . |
| [3427](#L3427) | esc\_html( $user\_billing\_city ) . '</br>' . |
| [3428](#L3428) | esc\_html( $user\_billing\_postcode ) . '</br>' . |
| [3429](#L3429) | esc\_html( $user\_billing\_state ) . '</br>' . |
| [3430](#L3430) | esc\_html( $user\_billing\_country ) . '</br>'; |
| [3431](#L3431) | ?> |
| [3432](#L3432) | </p> |
| [3433](#L3433) | <p> <strong> <?php esc\_html\_e( 'Email:', 'woocommerce-abandoned-cart' ); ?> </strong> |
| [3434](#L3434) | <?php $user\_mail\_to = 'mailto:' . $user\_email; ?> |
| [3435](#L3435) | <a href=<?php echo esc\_url( $user\_mail\_to ); ?>><?php echo esc\_html( $user\_email ); ?> </a> |
| [3436](#L3436) | </p> |
| [3437](#L3437) | <p> <strong> <?php esc\_html\_e( 'Phone:', 'woocommerce-abandoned-cart' ); ?> </strong> |
| [3438](#L3438) | <?php echo esc\_html( $user\_billing\_phone ); ?> |
| [3439](#L3439) | </p> |
| [3440](#L3440) | </div> |
| [3441](#L3441) | <div style="width:50%;float:right"> |
| [3442](#L3442) | <h3> <p> <?php esc\_html\_e( 'Shipping Details', 'woocommerce-abandoned-cart' ); ?> </p> </h3> |
| [3443](#L3443) | <p> <strong> <?php esc\_html\_e( 'Address:', 'woocommerce-abandoned-cart' ); ?> </strong> |
| [3444](#L3444) | <?php |
| [3445](#L3445) | if ( '' === $user\_shipping\_company && |
| [3446](#L3446) | '' === $user\_shipping\_address\_1 && |
| [3447](#L3447) | '' === $user\_shipping\_address\_2 && |
| [3448](#L3448) | '' === $user\_shipping\_city && |
| [3449](#L3449) | '' === $user\_shipping\_postcode && |
| [3450](#L3450) | '' === $user\_shipping\_state && |
| [3451](#L3451) | '' === $user\_shipping\_country ) { |
| [3452](#L3452) | echo esc\_html\_e( 'Shipping Address same as Billing Address', 'woocommerce-abandoned-cart' ); |
| [3453](#L3453) | } else { |
| [3454](#L3454) | ?> |
| [3455](#L3455) | <?php |
| [3456](#L3456) | echo esc\_html( $user\_shipping\_company ) . '</br>' . |
| [3457](#L3457) | esc\_html( $user\_shipping\_address\_1 ) . '</br>' . |
| [3458](#L3458) | esc\_html( $user\_shipping\_address\_2 ) . '</br>' . |
| [3459](#L3459) | esc\_html( $user\_shipping\_city ) . '</br>' . |
| [3460](#L3460) | esc\_html( $user\_shipping\_postcode ) . '</br>' . |
| [3461](#L3461) | esc\_html( $user\_shipping\_state ) . '</br>' . |
| [3462](#L3462) | esc\_html( $user\_shipping\_country ) . '</br>'; |
| [3463](#L3463) | ?> |
| [3464](#L3464) | <br><br> |
| [3465](#L3465) | <strong><?php esc\_html\_e( 'Shipping Charges', 'woocommerce-abandoned-cart' ); ?>: </strong> |
| [3466](#L3466) | <?php |
| [3467](#L3467) | if ( $shipping\_charges > 0 ) { |
| [3468](#L3468) | echo wp\_kses\_post( $currency\_symbol . $shipping\_charges ); |
| [3469](#L3469) | } |
| [3470](#L3470) | ?> |
| [3471](#L3471) | </p> |
| [3472](#L3472) | <?php } ?> |
| [3473](#L3473) | </div> |
| [3474](#L3474) | </div> |
| [3475](#L3475) | </div> |
| [3476](#L3476) | </div> |
| [3477](#L3477) | <?php |
| [3478](#L3478) | } elseif ( 'report' === $action ) { |
| [3479](#L3479) |  |
| [3480](#L3480) | include\_once 'includes/classes/class-wcal-product-report-table.php'; |
| [3481](#L3481) | $wcal\_product\_report\_list = new WCAL\_Product\_Report\_Table(); |
| [3482](#L3482) | $wcal\_product\_report\_list->wcal\_product\_report\_prepare\_items(); |
| [3483](#L3483) | ?> |
| [3484](#L3484) | <div class="wrap"> |
| [3485](#L3485) | <form id="wcal-sent-emails" method="get" > |
| [3486](#L3486) | <input type="hidden" name="page" value="woocommerce\_ac\_page" /> |
| [3487](#L3487) | <input type="hidden" name="action" value="report" /> |
| [3488](#L3488) | <?php $wcal\_product\_report\_list->display(); ?> |
| [3489](#L3489) | </form> |
| [3490](#L3490) | </div> |
| [3491](#L3491) | <?php |
| [3492](#L3492) | } |
| [3493](#L3493) | } |
| [3494](#L3494) | echo( '</table>' ); |
| [3495](#L3495) |  |
| [3496](#L3496) | $action = isset( $\_GET['action'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['action'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [3497](#L3497) | $mode   = isset( $\_GET['mode'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['mode'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [3498](#L3498) |  |
| [3499](#L3499) | $edit\_id = 0; |
| [3500](#L3500) | if ( 'emailtemplates' === $action && ( 'addnewtemplate' === $mode || 'edittemplate' === $mode ) ) { |
| [3501](#L3501) | if ( 'edittemplate' === $mode ) { |
| [3502](#L3502) | $results = array(); |
| [3503](#L3503) | if ( isset( $\_GET['id'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [3504](#L3504) | $edit\_id = sanitize\_text\_field( wp\_unslash( $\_GET['id'] ) ); // phpcs:ignore WordPress.Security.NonceVerification |
| [3505](#L3505) | $results = $wpdb->get\_results( // phpcs:ignore |
| [3506](#L3506) | $wpdb->prepare( |
| [3507](#L3507) | 'SELECT wpet . \*  FROM `' . $wpdb->prefix . 'ac\_email\_templates\_lite` AS wpet WHERE id = %d', |
| [3508](#L3508) | $edit\_id |
| [3509](#L3509) | ) |
| [3510](#L3510) | ); |
| [3511](#L3511) | } |
| [3512](#L3512) | } |
| [3513](#L3513) | $active\_post = ( empty( $\_POST['is\_active'] ) ) ? '0' : '1'; // phpcs:ignore WordPress.Security.NonceVerification |
| [3514](#L3514) | ?> |
| [3515](#L3515) | <div id="content"> |
| [3516](#L3516) | <form method="post" action="admin.php?page=woocommerce\_ac\_page&action=emailtemplates" id="ac\_settings"> |
| [3517](#L3517) | <input type="hidden" name="mode" value="<?php echo esc\_html( $mode ); ?>" /> |
| [3518](#L3518) | <?php |
| [3519](#L3519) | $id\_by = isset( $\_GET['id'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['id'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [3520](#L3520) | ?> |
| [3521](#L3521) | <input type="hidden" name="id" value="<?php echo esc\_html( $id\_by ); ?>" /> |
| [3522](#L3522) | <?php |
| [3523](#L3523) | if ( 'edittemplate' === $mode ) { |
| [3524](#L3524) | print '<input type="hidden" name="ac\_settings\_frm" value="update">'; |
| [3525](#L3525) | $display\_message = 'Edit Email Template'; |
| [3526](#L3526) | } else { |
| [3527](#L3527) | print '<input type="hidden" name="ac\_settings\_frm" value="save">'; |
| [3528](#L3528) | $display\_message = 'Add Email Template'; |
| [3529](#L3529) | } |
| [3530](#L3530) | ?> |
| [3531](#L3531) | <div id="poststuff"> |
| [3532](#L3532) | <div> <!-- <div class="postbox" > --> |
| [3533](#L3533) | <h3 class="hndle"><?php esc\_html\_e( $display\_message, 'woocommerce-abandoned-cart' ); // phpcs:ignore?></h3> |
| [3534](#L3534) | <div> |
| [3535](#L3535) | <?php |
| [3536](#L3536) | wc\_get\_template( |
| [3537](#L3537) | 'html-rules-engine.php', |
| [3538](#L3538) | array( |
| [3539](#L3539) | 'rules' => array(), |
| [3540](#L3540) | 'match' => 'all', |
| [3541](#L3541) | ), |
| [3542](#L3542) | 'woocommerce-abandoned-cart/', |
| [3543](#L3543) | WCAL\_PLUGIN\_PATH . '/includes/templates/rules/' |
| [3544](#L3544) | ); |
| [3545](#L3545) | ?> |
| [3546](#L3546) | <table class="form-table" id="addedit\_template"> |
| [3547](#L3547) | <tr> |
| [3548](#L3548) | <th> |
| [3549](#L3549) | <label for="woocommerce\_ac\_template\_name"><b><?php esc\_html\_e( 'Template Name:', 'woocommerce-abandoned-cart' ); ?></b></label> |
| [3550](#L3550) | </th> |
| [3551](#L3551) | <td> |
| [3552](#L3552) | <?php |
| [3553](#L3553) | $template\_name = ''; |
| [3554](#L3554) | if ( 'edittemplate' === $mode && count( $results ) > 0 && isset( $results[0]->template\_name ) ) { |
| [3555](#L3555) | $template\_name = $results[0]->template\_name; |
| [3556](#L3556) | } |
| [3557](#L3557) | print '<input type="text" name="woocommerce\_ac\_template\_name" id="woocommerce\_ac\_template\_name" class="regular-text" value="' . esc\_html( $template\_name ) . '">'; |
| [3558](#L3558) | ?> |
| [3559](#L3559) | <img class="help\_tip" width="16" height="16" data-tip='<?php esc\_html\_e( 'Enter a template name for reference', 'woocommerce-abandoned-cart' ); ?>' src="<?php echo esc\_url( WC()->plugin\_url() ); ?>/assets/images/help.png" /> |
| [3560](#L3560) | </td> |
| [3561](#L3561) | </tr> |
| [3562](#L3562) |  |
| [3563](#L3563) | <tr> |
| [3564](#L3564) | <th> |
| [3565](#L3565) | <label for="woocommerce\_ac\_email\_subject"><b><?php esc\_html\_e( 'Subject:', 'woocommerce-abandoned-cart' ); ?></b></label> |
| [3566](#L3566) | </th> |
| [3567](#L3567) | <td> |
| [3568](#L3568) | <?php |
| [3569](#L3569) | $subject\_edit = ''; |
| [3570](#L3570) | if ( 'edittemplate' === $mode && count( $results ) > 0 && isset( $results[0]->subject ) ) { |
| [3571](#L3571) | $subject\_edit = stripslashes( $results[0]->subject ); |
| [3572](#L3572) | } |
| [3573](#L3573) | print '<input type="text" name="woocommerce\_ac\_email\_subject" id="woocommerce\_ac\_email\_subject" class="regular-text" value="' . esc\_html( $subject\_edit ) . '">'; |
| [3574](#L3574) | ?> |
| [3575](#L3575) | <img class="help\_tip" width="16" height="16" data-tip='<?php esc\_html\_e( 'Enter the subject that should appear in the email sent', 'woocommerce-abandoned-cart' ); ?>' src="<?php echo esc\_url( WC()->plugin\_url() ); ?>/assets/images/help.png" /> |
| [3576](#L3576) | </td> |
| [3577](#L3577) | </tr> |
| [3578](#L3578) |  |
| [3579](#L3579) | <tr> |
| [3580](#L3580) | <th> |
| [3581](#L3581) | <label for="woocommerce\_ac\_email\_body"><b><?php esc\_html\_e( 'Email Body:', 'woocommerce-abandoned-cart' ); ?></b></label> |
| [3582](#L3582) | </th> |
| [3583](#L3583) | <td> |
| [3584](#L3584) | <?php |
| [3585](#L3585) | $initial\_data = ''; |
| [3586](#L3586) | if ( 'edittemplate' === $mode && count( $results ) > 0 && isset( $results[0]->body ) ) { |
| [3587](#L3587) | $initial\_data = stripslashes( $results[0]->body ); |
| [3588](#L3588) | } |
| [3589](#L3589) |  |
| [3590](#L3590) | $initial\_data = str\_replace( 'My document title', '', $initial\_data ); |
| [3591](#L3591) | wp\_editor( |
| [3592](#L3592) | $initial\_data, |
| [3593](#L3593) | 'woocommerce\_ac\_email\_body', |
| [3594](#L3594) | array( |
| [3595](#L3595) | 'media\_buttons' => true, |
| [3596](#L3596) | 'textarea\_rows' => 15, |
| [3597](#L3597) | 'tabindex'      => 4, |
| [3598](#L3598) | 'tinymce'       => array( |
| [3599](#L3599) | 'theme\_advanced\_buttons1' => 'bold,italic,underline,|,bullist,numlist,blockquote,|,link,unlink,|,spellchecker,fullscreen,|,formatselect,styleselect', |
| [3600](#L3600) | ), |
| [3601](#L3601) | ) |
| [3602](#L3602) | ); |
| [3603](#L3603) |  |
| [3604](#L3604) | ?> |
| [3605](#L3605) | <?php echo wp\_kses\_post( stripslashes( get\_option( 'woocommerce\_ac\_email\_body' ) ) ); ?> |
| [3606](#L3606) | <span class="description"> |
| [3607](#L3607) | <?php |
| [3608](#L3608) | esc\_html\_e( 'Message to be sent in the reminder email.', 'woocommerce-abandoned-cart' ); |
| [3609](#L3609) | ?> |
| [3610](#L3610) | <img width="16" height="16" src="<?php echo esc\_url( plugins\_url() ); ?>/woocommerce-abandoned-cart/assets/images/information.png" onClick="wcal\_show\_help\_tips()"/> |
| [3611](#L3611) | </span> |
| [3612](#L3612) | <span id="help\_message" style="display:none"> |
| [3613](#L3613) | 1. You can add customer & cart information in the template using this icon <img width="20" height="20" src="<?php echo esc\_url( plugins\_url( '/assets/images/ac\_editor\_icon.png', \_\_FILE\_\_ ) ); ?>" /> in top left of the editor.<br> |
| [3614](#L3614) | 2. The product information/cart contents table will be added in emails using the {{products.cart}} merge field.<br> |
| [3615](#L3615) | 3. Insert/Remove any of the new shortcodes that have been included for the default template.<br> |
| [3616](#L3616) | 4. Change the look and feel of the table by modifying the table style properties using CSS in "Text" mode. <br> |
| [3617](#L3617) | 5. Change the text color of the table rows by using the Toolbar of the editor. <br> |
| [3618](#L3618) |  |
| [3619](#L3619) | </span> |
| [3620](#L3620) | </td> |
| [3621](#L3621) | </tr> |
| [3622](#L3622) | <script type="text/javascript"> |
| [3623](#L3623) | function wcal\_show\_help\_tips() { |
| [3624](#L3624) | if ( jQuery( '#help\_message' ) . css( 'display' ) == 'none') { |
| [3625](#L3625) | document.getElementById( "help\_message" ).style.display = "block"; |
| [3626](#L3626) | } |
| [3627](#L3627) | else { |
| [3628](#L3628) | document.getElementById( "help\_message" ) . style.display = "none"; |
| [3629](#L3629) | } |
| [3630](#L3630) | } |
| [3631](#L3631) | </script> |
| [3632](#L3632) |  |
| [3633](#L3633) | <tr> |
| [3634](#L3634) | <th> |
| [3635](#L3635) | <label for="is\_wc\_template"><b><?php esc\_html\_e( 'Use WooCommerce Template Style:', 'woocommerce-abandoned-cart' ); ?></b></label> |
| [3636](#L3636) | </th> |
| [3637](#L3637) | <td> |
| [3638](#L3638) | <?php |
| [3639](#L3639) | $is\_wc\_template = ''; |
| [3640](#L3640) | if ( 'edittemplate' === $mode && count( $results ) > 0 && isset( $results[0]->is\_wc\_template ) ) { |
| [3641](#L3641) | $use\_wc\_template = $results[0]->is\_wc\_template; |
| [3642](#L3642) |  |
| [3643](#L3643) | if ( '1' === $use\_wc\_template ) { |
| [3644](#L3644) | $is\_wc\_template = 'checked'; |
| [3645](#L3645) | } else { |
| [3646](#L3646) | $is\_wc\_template = ''; |
| [3647](#L3647) | } |
| [3648](#L3648) | } |
| [3649](#L3649) | print '<input type="checkbox" name="is\_wc\_template" id="is\_wc\_template" ' . esc\_attr( $is\_wc\_template ) . '>  </input>'; |
| [3650](#L3650) | ?> |
| [3651](#L3651) | <img class="help\_tip" width="16" height="16" data-tip='<?php esc\_html\_e( 'Use WooCommerce default style template for abandoned cart reminder emails.', 'woocommerce' ); ?>' src="<?php echo esc\_url( WC()->plugin\_url() ); ?>/assets/images/help.png" /><a target = '\_blank' href= <?php echo esc\_url( wp\_nonce\_url( admin\_url( "?wcal\_preview\_woocommerce\_mail=true&id=$edit\_id" ), 'woocommerce-abandoned-cart' ) ); ?> > |
| [3652](#L3652) | Click here to preview </a>how the email template will look with WooCommerce Template Style enabled. Alternatively, if this is unchecked, the template will appear as <a target = '\_blank' href=<?php echo esc\_url( wp\_nonce\_url( admin\_url( "?wcal\_preview\_mail=true&id=$edit\_id" ), 'woocommerce-abandoned-cart' ) ); ?>>shown here</a>. <br> <strong>Note: </strong>When this setting is enabled, then "Send From This Name:" & "Send From This Email Address:" will be overwritten with WooCommerce -> Settings -> Email -> Email Sender Options. |
| [3653](#L3653) | </td> |
| [3654](#L3654) | </tr> |
| [3655](#L3655) |  |
| [3656](#L3656) | <tr> |
| [3657](#L3657) | <th> |
| [3658](#L3658) | <label for="wcal\_wc\_email\_header"><b><?php esc\_html\_e( 'Email Template Header Text: ', 'woocommerce-abandoned-cart' ); ?></b></label> |
| [3659](#L3659) | </th> |
| [3660](#L3660) | <td> |
| [3661](#L3661) |  |
| [3662](#L3662) | <?php |
| [3663](#L3663) |  |
| [3664](#L3664) | $wcal\_wc\_email\_header = ''; |
| [3665](#L3665) | if ( 'edittemplate' === $mode && count( $results ) > 0 && isset( $results[0]->wc\_email\_header ) ) { |
| [3666](#L3666) | $wcal\_wc\_email\_header = $results[0]->wc\_email\_header; |
| [3667](#L3667) | } |
| [3668](#L3668) | if ( '' === $wcal\_wc\_email\_header ) { |
| [3669](#L3669) | $wcal\_wc\_email\_header = 'Abandoned cart reminder'; |
| [3670](#L3670) | } |
| [3671](#L3671) | print '<input type="text" name="wcal\_wc\_email\_header" id="wcal\_wc\_email\_header" class="regular-text" value="' . esc\_html( $wcal\_wc\_email\_header ) . '">'; |
| [3672](#L3672) | ?> |
| [3673](#L3673) | <img class="help\_tip" width="16" height="16" data-tip='<?php esc\_html\_e( 'Enter the header which will appear in the abandoned WooCommerce email sent. This is only applicable when only used when "Use WooCommerce Template Style:" is checked.', 'woocommerce-abandoned-cart' ); ?>' src="<?php echo esc\_url( WC()->plugin\_url() ); ?>/assets/images/help.png" /> |
| [3674](#L3674) | </td> |
| [3675](#L3675) | </tr> |
| [3676](#L3676) |  |
| [3677](#L3677) | <tr> |
| [3678](#L3678) | <th> |
| [3679](#L3679) | <label for="woocommerce\_ac\_email\_frequency"><b><?php esc\_html\_e( 'Send this email:', 'woocommerce-abandoned-cart' ); ?></b></label> |
| [3680](#L3680) | </th> |
| [3681](#L3681) | <td> |
| [3682](#L3682) | <select name="email\_frequency" id="email\_frequency"> |
| [3683](#L3683) | <?php |
| [3684](#L3684) | $frequency\_edit = ''; |
| [3685](#L3685) | if ( 'edittemplate' === $mode && count( $results ) > 0 && isset( $results[0]->frequency ) ) { |
| [3686](#L3686) | $frequency\_edit = $results[0]->frequency; |
| [3687](#L3687) | } |
| [3688](#L3688) | for ( $i = 1; $i < 60; $i++ ) { |
| [3689](#L3689) | printf( |
| [3690](#L3690) | "<option %s value='%s'>%s</option>\n", |
| [3691](#L3691) | selected( $i, $frequency\_edit, false ), |
| [3692](#L3692) | esc\_attr( $i ), |
| [3693](#L3693) | esc\_html( $i ) |
| [3694](#L3694) | ); |
| [3695](#L3695) | } |
| [3696](#L3696) | ?> |
| [3697](#L3697) | </select> |
| [3698](#L3698) |  |
| [3699](#L3699) | <select name="day\_or\_hour" id="day\_or\_hour"> |
| [3700](#L3700) | <?php |
| [3701](#L3701) | $days\_or\_hours\_edit = ''; |
| [3702](#L3702) | if ( 'edittemplate' === $mode && count( $results ) > 0 && isset( $results[0]->day\_or\_hour ) ) { |
| [3703](#L3703) | $days\_or\_hours\_edit = $results[0]->day\_or\_hour; |
| [3704](#L3704) | } |
| [3705](#L3705) | $days\_or\_hours = array( |
| [3706](#L3706) | 'Minutes' => 'Minute(s)', |
| [3707](#L3707) | 'Days' => 'Day(s)', |
| [3708](#L3708) | 'Hours' => 'Hour(s)', |
| [3709](#L3709) | ); |
| [3710](#L3710) | foreach ( $days\_or\_hours as $k => $v ) { |
| [3711](#L3711) | printf( |
| [3712](#L3712) | "<option %s value='%s'>%s</option>\n", |
| [3713](#L3713) | selected( $k, $days\_or\_hours\_edit, false ), |
| [3714](#L3714) | esc\_attr( $k ), |
| [3715](#L3715) | esc\_html( $v ) |
| [3716](#L3716) | ); |
| [3717](#L3717) | } |
| [3718](#L3718) | ?> |
| [3719](#L3719) | </select> |
| [3720](#L3720) | <span class="description"> |
| [3721](#L3721) | <?php esc\_html\_e( 'after cart is abandoned.', 'woocommerce-abandoned-cart' ); ?> |
| [3722](#L3722) | </span> |
| [3723](#L3723) | </td> |
| [3724](#L3724) | </tr> |
| [3725](#L3725) | <?php include\_once 'views/wcal-email-coupon.php'; ?> |
| [3726](#L3726) | <tr> |
| [3727](#L3727) | <th> |
| [3728](#L3728) | <label for="woocommerce\_ac\_email\_preview"><b><?php esc\_html\_e( 'Send a test email to:', 'woocommerce-abandoned-cart' ); ?></b></label> |
| [3729](#L3729) | </th> |
| [3730](#L3730) | <td> |
| [3731](#L3731) | <?php |
| [3732](#L3732) | $user        = wp\_get\_current\_user(); |
| [3733](#L3733) | $admin\_email = isset( $user->user\_email ) ? $user->user\_email : ''; |
| [3734](#L3734) | ?> |
| [3735](#L3735) | <input type="text" id="send\_test\_email" name="send\_test\_email" class="regular-text" value="<?php echo esc\_attr( $admin\_email ); ?>" > |
| [3736](#L3736) | <input type="button" value="Send a test email" id="preview\_email" onclick="javascript:void(0);"> |
| [3737](#L3737) | <img class="help\_tip" width="16" height="16" data-tip='<?php esc\_html\_e( 'Enter the email id to which the test email needs to be sent.', 'woocommerce-abandoned-cart' ); ?>' src="<?php echo esc\_url( WC()->plugin\_url() ); ?>/assets/images/help.png" /> |
| [3738](#L3738) | <br> |
| [3739](#L3739) | <img class="ajax\_img" src="<?php echo esc\_url( plugins\_url( '/assets/images/ajax-loader.gif', \_\_FILE\_\_ ) ); ?>" style="display:none;" /> |
| [3740](#L3740) | <div id="preview\_email\_sent\_msg" style="display:none;"></div> |
| [3741](#L3741) | </td> |
| [3742](#L3742) | </tr> |
| [3743](#L3743) | </table> |
| [3744](#L3744) | </div> |
| [3745](#L3745) | </div> |
| [3746](#L3746) | </div> |
| [3747](#L3747) | <p class="submit"> |
| [3748](#L3748) | <?php |
| [3749](#L3749) | if ( 'edittemplate' === $mode ) { |
| [3750](#L3750) | ?> |
| [3751](#L3751) | <input type="submit" name="Submit" class="button-primary" value="<?php esc\_attr\_e( 'Update Changes', 'woocommerce-abandoned-cart' ); ?>"  /> |
| [3752](#L3752) | <?php |
| [3753](#L3753) | } else { |
| [3754](#L3754) | ?> |
| [3755](#L3755) | <input type="submit" name="Submit" class="button-primary" value="<?php esc\_attr\_e( 'Save Changes', 'woocommerce-abandoned-cart' ); ?>"  /> |
| [3756](#L3756) | <?php |
| [3757](#L3757) | } |
| [3758](#L3758) | ?> |
| [3759](#L3759) | </p> |
| [3760](#L3760) | </form> |
| [3761](#L3761) | </div> |
| [3762](#L3762) | <?php |
| [3763](#L3763) | } |
| [3764](#L3764) | } |
| [3765](#L3765) |  |
| [3766](#L3766) | /\*\* |
| [3767](#L3767) | \* It will add the footer text for the plugin. |
| [3768](#L3768) | \* |
| [3769](#L3769) | \* @hook admin\_footer\_text |
| [3770](#L3770) | \* @param string $footer\_text Text. |
| [3771](#L3771) | \* @return string $footer\_text |
| [3772](#L3772) | \* @since 1.0 |
| [3773](#L3773) | \*/ |
| [3774](#L3774) | public function wcal\_admin\_footer\_text( $footer\_text ) { |
| [3775](#L3775) |  |
| [3776](#L3776) | if ( isset( $\_GET['page'] ) && 'woocommerce\_ac\_page' === $\_GET['page'] ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [3777](#L3777) | $footer\_text = \_\_( 'If you love <strong>Abandoned Cart Lite for WooCommerce</strong>, then please leave us a <a href="https://wordpress.org/support/plugin/woocommerce-abandoned-cart/reviews/?rate=5#new-post" target="\_blank" class="ac-rating-link" data-rated="Thanks :)">★★★★★</a> rating. Thank you in advance. :)', 'woocommerce-abandoned-cart' ); |
| [3778](#L3778) | wc\_enqueue\_js( |
| [3779](#L3779) | " |
| [3780](#L3780) | jQuery( 'a.ac-rating-link' ).click( function() { |
| [3781](#L3781) | jQuery( this ).parent().text( jQuery( this ).data( 'rated' ) ); |
| [3782](#L3782) | }); |
| [3783](#L3783) | " |
| [3784](#L3784) | ); |
| [3785](#L3785) | } |
| [3786](#L3786) | return $footer\_text; |
| [3787](#L3787) | } |
| [3788](#L3788) |  |
| [3789](#L3789) | /\*\* |
| [3790](#L3790) | \* It will sort the record for the product reports tab. |
| [3791](#L3791) | \* |
| [3792](#L3792) | \* @param array  $unsort\_array Unsorted array. |
| [3793](#L3793) | \* @param string $order Order details. |
| [3794](#L3794) | \* @return array $array |
| [3795](#L3795) | \* @since 2.6 |
| [3796](#L3796) | \*/ |
| [3797](#L3797) | public function bubble\_sort\_function( $unsort\_array, $order ) { |
| [3798](#L3798) | $temp = array(); |
| [3799](#L3799) | foreach ( $unsort\_array as $key => $value ) { |
| [3800](#L3800) | $temp[ $key ] = $value; // concatenate something unique to make sure two equal weights don't overwrite each other. |
| [3801](#L3801) | } |
| [3802](#L3802) | asort( $temp, SORT\_NUMERIC ); // or ksort( $temp, SORT\_NATURAL ); see paragraph above to understand why. |
| [3803](#L3803) |  |
| [3804](#L3804) | if ( 'desc' === $order ) { |
| [3805](#L3805) | $array = array\_reverse( $temp, true ); |
| [3806](#L3806) | } elseif ( 'asc' === $order ) { |
| [3807](#L3807) | $array = $temp; |
| [3808](#L3808) | } |
| [3809](#L3809) | unset( $temp ); |
| [3810](#L3810) | return $array; |
| [3811](#L3811) | } |
| [3812](#L3812) |  |
| [3813](#L3813) | /\*\* |
| [3814](#L3814) | \* It will be called when we send the test email from the email edit page. |
| [3815](#L3815) | \* |
| [3816](#L3816) | \* @hook wp\_ajax\_wcal\_preview\_email\_sent |
| [3817](#L3817) | \* @since 1.0 |
| [3818](#L3818) | \*/ |
| [3819](#L3819) | public function wcal\_action\_send\_preview() { |
| [3820](#L3820) | ?> |
| [3821](#L3821) | <script type="text/javascript" > |
| [3822](#L3822) | jQuery( document ).ready( function( $ ) |
| [3823](#L3823) | { |
| [3824](#L3824) | $( "table#addedit\_template input#preview\_email" ).click( function() |
| [3825](#L3825) | { |
| [3826](#L3826) | emailVal = jQuery( '#send\_test\_email' ).val(); |
| [3827](#L3827) | const re = /^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)\*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i; |
| [3828](#L3828) | if ( !re.test( emailVal ) ) { |
| [3829](#L3829) | jQuery( '#preview\_email\_sent\_msg' ).html( '<?php echo esc\_html\_\_( 'Please enter a valid email.', 'woocommerce-abandoned-cart' ); ?>' ); |
| [3830](#L3830) | jQuery( '#preview\_email\_sent\_msg' ).show(); |
| [3831](#L3831) | return false; |
| [3832](#L3832) | } |
| [3833](#L3833) |  |
| [3834](#L3834) | jQuery( '#preview\_email\_sent\_msg' ).hide(); |
| [3835](#L3835) |  |
| [3836](#L3836) | $( '.ajax\_img' ).show(); |
| [3837](#L3837) | var email\_body = ''; |
| [3838](#L3838) | if ( jQuery("#wp-woocommerce\_ac\_email\_body-wrap").hasClass( "tmce-active" ) ) { |
| [3839](#L3839) | email\_body = tinyMCE.get('woocommerce\_ac\_email\_body').getContent(); |
| [3840](#L3840) | } else { |
| [3841](#L3841) | email\_body = jQuery('#woocommerce\_ac\_email\_body').val(); |
| [3842](#L3842) | } |
| [3843](#L3843) | var subject\_email\_preview = $( '#woocommerce\_ac\_email\_subject' ).val(); |
| [3844](#L3844) | var body\_email\_preview    = email\_body; |
| [3845](#L3845) | var send\_email\_id         = $( '#send\_test\_email' ).val(); |
| [3846](#L3846) | var is\_wc\_template        = document.getElementById( "is\_wc\_template" ).checked; |
| [3847](#L3847) | var wc\_template\_header    = $( '#wcal\_wc\_email\_header' ).val() != '' ? $( '#wcal\_wc\_email\_header' ).val() : 'Abandoned cart reminder'; |
| [3848](#L3848) | var data                  = { |
| [3849](#L3849) | subject\_email\_preview: subject\_email\_preview, |
| [3850](#L3850) | body\_email\_preview   : body\_email\_preview, |
| [3851](#L3851) | send\_email\_id        : send\_email\_id, |
| [3852](#L3852) | is\_wc\_template       : is\_wc\_template, |
| [3853](#L3853) | wc\_template\_header   : wc\_template\_header, |
| [3854](#L3854) | action               : 'wcal\_preview\_email\_sent' |
| [3855](#L3855) | }; |
| [3856](#L3856) |  |
| [3857](#L3857) | // since 2.8 ajaxurl is always defined in the admin header and points to admin-ajax.php |
| [3858](#L3858) | $.post( ajaxurl, data, function( response ) { |
| [3859](#L3859) | $( '.ajax\_img' ).hide(); |
| [3860](#L3860) | if ( 'not sent' == response ) { |
| [3861](#L3861) | $( "#preview\_email\_sent\_msg" ).html( "Test email is not sent as the Email body is empty." ); |
| [3862](#L3862) | $( "#preview\_email\_sent\_msg" ).fadeIn(); |
| [3863](#L3863) | setTimeout( function(){$( "#preview\_email\_sent\_msg" ).fadeOut();}, 4000 ); |
| [3864](#L3864) | } else { |
| [3865](#L3865) | $( "#preview\_email\_sent\_msg" ).html( "<img src='<?php echo esc\_url( plugins\_url( '/assets/images/check.jpg', \_\_FILE\_\_ ) ); ?>'>&nbsp;Email has been sent successfully." ); |
| [3866](#L3866) | $( "#preview\_email\_sent\_msg" ).fadeIn(); |
| [3867](#L3867) | setTimeout( function(){$( "#preview\_email\_sent\_msg" ).fadeOut();}, 3000 ); |
| [3868](#L3868) | } |
| [3869](#L3869) | }); |
| [3870](#L3870) | }); |
| [3871](#L3871) | }); |
| [3872](#L3872) | </script> |
| [3873](#L3873) | <?php |
| [3874](#L3874) | } |
| [3875](#L3875) |  |
| [3876](#L3876) | /\*\* |
| [3877](#L3877) | \* Ajax function used to add the details in the abandoned order |
| [3878](#L3878) | \* popup view. |
| [3879](#L3879) | \* |
| [3880](#L3880) | \* @since 5.6 |
| [3881](#L3881) | \*/ |
| [3882](#L3882) | public static function wcal\_abandoned\_cart\_info() { |
| [3883](#L3883) | Wcal\_Abandoned\_Cart\_Details::wcal\_get\_cart\_detail\_view( $\_POST ); // phpcs:ignore WordPress.Security.NonceVerification |
| [3884](#L3884) | die(); |
| [3885](#L3885) | } |
| [3886](#L3886) |  |
| [3887](#L3887) | /\*\* |
| [3888](#L3888) | \* Ajax function which will save the notice state as dismissed. |
| [3889](#L3889) | \* |
| [3890](#L3890) | \* @since 5.7 |
| [3891](#L3891) | \*/ |
| [3892](#L3892) | public static function wcal\_dismiss\_admin\_notice() { |
| [3893](#L3893) |  |
| [3894](#L3894) | $notice\_key = isset( $\_POST['notice'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['notice'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [3895](#L3895) | if ( '' !== $notice\_key ) { |
| [3896](#L3896) | update\_option( $notice\_key, true ); |
| [3897](#L3897) | } |
| [3898](#L3898) | die(); |
| [3899](#L3899) | } |
| [3900](#L3900) |  |
| [3901](#L3901) | /\*\* |
| [3902](#L3902) | \* It will update the template satus when we change the template active status from the email template list page. |
| [3903](#L3903) | \* |
| [3904](#L3904) | \* @hook wp\_ajax\_wcal\_toggle\_template\_status |
| [3905](#L3905) | \* @globals mixed $wpdb |
| [3906](#L3906) | \* @since 4.4 |
| [3907](#L3907) | \*/ |
| [3908](#L3908) | public static function wcal\_toggle\_template\_status() { |
| [3909](#L3909) | global $wpdb; |
| [3910](#L3910) | $template\_id             = isset( $\_POST['wcal\_template\_id'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['wcal\_template\_id'] ) ) : 0; // phpcs:ignore WordPress.Security.NonceVerification |
| [3911](#L3911) | $current\_template\_status = isset( $\_POST['current\_state'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['current\_state'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [3912](#L3912) |  |
| [3913](#L3913) | if ( $template\_id > 0 ) { |
| [3914](#L3914) | if ( 'on' === $current\_template\_status ) { |
| [3915](#L3915) | $get\_selected\_template\_result = $wpdb->get\_results( // phpcs:ignore |
| [3916](#L3916) | $wpdb->prepare( |
| [3917](#L3917) | 'SELECT \* FROM `' . $wpdb->prefix . 'ac\_email\_templates\_lite` WHERE id = %d', |
| [3918](#L3918) | $template\_id |
| [3919](#L3919) | ) |
| [3920](#L3920) | ); |
| [3921](#L3921) | $email\_frequncy               = $get\_selected\_template\_result[0]->frequency; |
| [3922](#L3922) | $email\_day\_or\_hour            = $get\_selected\_template\_result[0]->day\_or\_hour; |
| [3923](#L3923) |  |
| [3924](#L3924) | $wcal\_updated = $wpdb->query( // phpcs:ignore |
| [3925](#L3925) | $wpdb->prepare( |
| [3926](#L3926) | 'UPDATE `' . $wpdb->prefix . 'ac\_email\_templates\_lite` SET is\_active = %d WHERE frequency = %s AND day\_or\_hour = %s', |
| [3927](#L3927) | 0, |
| [3928](#L3928) | $email\_frequncy, |
| [3929](#L3929) | $email\_day\_or\_hour |
| [3930](#L3930) | ) |
| [3931](#L3931) | ); |
| [3932](#L3932) |  |
| [3933](#L3933) | if ( 1 === $wcal\_updated ) { |
| [3934](#L3934) | $wcal\_updated\_get\_id = $wpdb->get\_results( // phpcs:ignore |
| [3935](#L3935) | $wpdb->prepare( |
| [3936](#L3936) | 'SELECT id FROM  `' . $wpdb->prefix . 'ac\_email\_templates\_lite` WHERE id != %d AND frequency = %s AND day\_or\_hour = %s', |
| [3937](#L3937) | $template\_id, |
| [3938](#L3938) | $email\_frequncy, |
| [3939](#L3939) | $email\_day\_or\_hour |
| [3940](#L3940) | ) |
| [3941](#L3941) | ); |
| [3942](#L3942) | $wcal\_all\_ids        = ''; |
| [3943](#L3943) | foreach ( $wcal\_updated\_get\_id as $wcal\_updated\_get\_id\_key => $wcal\_updated\_get\_id\_value ) { |
| [3944](#L3944) | // code... |
| [3945](#L3945) | if ( '' === $wcal\_all\_ids ) { |
| [3946](#L3946) | $wcal\_all\_ids = $wcal\_updated\_get\_id\_value->id; |
| [3947](#L3947) | } else { |
| [3948](#L3948) | $wcal\_all\_ids = $wcal\_all\_ids . ',' . $wcal\_updated\_get\_id\_value->id; |
| [3949](#L3949) | } |
| [3950](#L3950) | } |
| [3951](#L3951) | echo esc\_html( 'wcal-template-updated:' . $wcal\_all\_ids ); |
| [3952](#L3952) | } |
| [3953](#L3953) |  |
| [3954](#L3954) | $active = '1'; |
| [3955](#L3955) | update\_option( 'wcal\_template\_' . $template\_id . '\_time', current\_time( 'timestamp' ) ); // phpcs:ignore |
| [3956](#L3956) | } else { |
| [3957](#L3957) | $active = '0'; |
| [3958](#L3958) | } |
| [3959](#L3959) | $wpdb->query( // phpcs:ignore |
| [3960](#L3960) | $wpdb->prepare( |
| [3961](#L3961) | 'UPDATE `' . $wpdb->prefix . 'ac\_email\_templates\_lite` SET is\_active = %s WHERE id  = %d', |
| [3962](#L3962) | $active, |
| [3963](#L3963) | $template\_id |
| [3964](#L3964) | ) |
| [3965](#L3965) | ); |
| [3966](#L3966) | } |
| [3967](#L3967) | wp\_die(); |
| [3968](#L3968) | } |
| [3969](#L3969) |  |
| [3970](#L3970) | /\*\* |
| [3971](#L3971) | \* Set up from email address in emails sent by our plugin when WC template style is ON. |
| [3972](#L3972) | \* |
| [3973](#L3973) | \* @param str    $wp\_admin\_address - From email address set up in WP. |
| [3974](#L3974) | \* @param object $email - Email object. |
| [3975](#L3975) | \* @param str    $from\_email - Email Address passed in. |
| [3976](#L3976) | \* |
| [3977](#L3977) | \* @since 5.13.0 |
| [3978](#L3978) | \*/ |
| [3979](#L3979) | public static function wcal\_from\_address\_for\_emails( $wp\_admin\_address, $email, $from\_email ) { |
| [3980](#L3980) | $from\_address = '' == $email->title ? get\_option( 'wcal\_from\_email' ) : $wp\_admin\_address; // phpcs:ignore |
| [3981](#L3981) | return $from\_address; |
| [3982](#L3982) | } |
| [3983](#L3983) |  |
| [3984](#L3984) | /\*\* |
| [3985](#L3985) | \* Set up from name in emails sent by our plugin when WC template style is ON. |
| [3986](#L3986) | \* |
| [3987](#L3987) | \* @param str    $wp\_admin\_name - From name set up in WP. |
| [3988](#L3988) | \* @param object $email - Email object. |
| [3989](#L3989) | \* @param str    $from\_name\_default - Name passed in. |
| [3990](#L3990) | \* |
| [3991](#L3991) | \* @since 5.13.0 |
| [3992](#L3992) | \*/ |
| [3993](#L3993) | public static function wcal\_from\_name\_for\_emails( $wp\_admin\_name, $email, $from\_name\_default ) { |
| [3994](#L3994) | $from\_name = '' == $email->title ? get\_option( 'wcal\_from\_name' ) : $wp\_admin\_name; // phpcs:ignore |
| [3995](#L3995) | return $from\_name; |
| [3996](#L3996) | } |
| [3997](#L3997) | /\*\* |
| [3998](#L3998) | \* It will replace the test email data with the static content. |
| [3999](#L3999) | \* |
| [4000](#L4000) | \* @since 1.0 |
| [4001](#L4001) | \*/ |
| [4002](#L4002) | public function wcal\_preview\_email\_sent() { |
| [4003](#L4003) | if ( isset( $\_POST['body\_email\_preview'] ) && '' !== $\_POST['body\_email\_preview'] ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [4004](#L4004) | $from\_email\_name       = get\_option( 'wcal\_from\_name' ); |
| [4005](#L4005) | $reply\_name\_preview    = get\_option( 'wcal\_from\_email' ); |
| [4006](#L4006) | $from\_email\_preview    = get\_option( 'wcal\_reply\_email' ); |
| [4007](#L4007) | $subject\_email\_preview = isset( $\_POST['subject\_email\_preview'] ) ? stripslashes( sanitize\_text\_field( wp\_unslash( $\_POST['subject\_email\_preview'] ) ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [4008](#L4008) | $subject\_email\_preview = convert\_smilies( $subject\_email\_preview ); |
| [4009](#L4009) | $subject\_email\_preview = str\_ireplace( '{{customer.firstname}}', 'John', $subject\_email\_preview ); |
| [4010](#L4010) | $body\_email\_preview    = isset( $\_POST['body\_email\_preview'] ) ? convert\_smilies( wp\_unslash( $\_POST['body\_email\_preview'] ) ) : ''; // phpcs:ignore |
| [4011](#L4011) | $is\_wc\_template        = isset( $\_POST['is\_wc\_template'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['is\_wc\_template'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [4012](#L4012) | $wc\_template\_header    = isset( $\_POST['wc\_template\_header'] ) ? stripslashes( sanitize\_text\_field( wp\_unslash( $\_POST['wc\_template\_header'] ) ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [4013](#L4013) |  |
| [4014](#L4014) | $body\_email\_preview = str\_ireplace( '{{customer.firstname}}', 'John', $body\_email\_preview ); |
| [4015](#L4015) | $body\_email\_preview = str\_ireplace( '{{customer.firstname}}', 'John', $body\_email\_preview ); |
| [4016](#L4016) | $body\_email\_preview = str\_ireplace( '{{customer.lastname}}', 'Doe', $body\_email\_preview ); |
| [4017](#L4017) | $body\_email\_preview = str\_ireplace( '{{customer.fullname}}', 'John Doe', $body\_email\_preview ); |
| [4018](#L4018) | $current\_time\_stamp = current\_time( 'timestamp' ); // phpcs:ignore |
| [4019](#L4019) | $date\_format        = date\_i18n( get\_option( 'date\_format' ), $current\_time\_stamp ); |
| [4020](#L4020) | $time\_format        = date\_i18n( get\_option( 'time\_format' ), $current\_time\_stamp ); |
| [4021](#L4021) | $test\_date          = $date\_format . ' ' . $time\_format; |
| [4022](#L4022) | $body\_email\_preview = str\_ireplace( '{{cart.abandoned\_date}}', $test\_date, $body\_email\_preview ); |
| [4023](#L4023) | $cart\_url           = wc\_get\_page\_permalink( 'cart' ); |
| [4024](#L4024) | $body\_email\_preview = str\_ireplace( '{{cart.link}}', $cart\_url, $body\_email\_preview ); |
| [4025](#L4025) | $body\_email\_preview = str\_ireplace( '{{cart.unsubscribe}}', '#', $body\_email\_preview ); |
| [4026](#L4026) | $wcal\_price         = wc\_price( '100' ); |
| [4027](#L4027) | $wcal\_total\_price   = wc\_price( '200' ); |
| [4028](#L4028) | if ( class\_exists( 'WP\_Better\_Emails' ) ) { |
| [4029](#L4029) | $headers  = 'From: ' . $from\_email\_name . ' <' . $from\_email\_preview . '>' . "\r\n"; |
| [4030](#L4030) | $headers .= 'Content-Type: text/html' . "\r\n"; |
| [4031](#L4031) | $headers .= 'Reply-To:  ' . $reply\_name\_preview . ' ' . "\r\n"; |
| [4032](#L4032) | $var      = '<table width = 100%> |
| [4033](#L4033) | <tr> <td colspan="5"> <h3 style="text-align:center">' . \_\_( 'Your Shopping Cart', 'woocommerce-abandoned-cart' ) . '</h3> </td></tr> |
| [4034](#L4034) | <tr align="center"> |
| [4035](#L4035) | <th>' . \_\_( 'Item', 'woocommerce-abandoned-cart' ) . '</th> |
| [4036](#L4036) | <th>' . \_\_( 'Name', 'woocommerce-abandoned-cart' ) . '</th> |
| [4037](#L4037) | <th>' . \_\_( 'Quantity', 'woocommerce-abandoned-cart' ) . '</th> |
| [4038](#L4038) | <th>' . \_\_( 'Price', 'woocommerce-abandoned-cart' ) . '</th> |
| [4039](#L4039) | <th>' . \_\_( 'Line Subtotal', 'woocommerce-abandoned-cart' ) . '</th> |
| [4040](#L4040) | </tr> |
| [4041](#L4041) | <tr align="center"> |
| [4042](#L4042) | <td><img class="demo\_img" width="42" height="42" src="' . plugins\_url( '/assets/images/shoes.jpg', \_\_FILE\_\_ ) . '"/></td> |
| [4043](#L4043) | <td>' . \_\_( "Men's Formal Shoes", 'woocommerce-abandoned-cart' ) . '</td> |
| [4044](#L4044) | <td>1</td> |
| [4045](#L4045) | <td>' . $wcal\_price . '</td> |
| [4046](#L4046) | <td>' . $wcal\_price . '</td> |
| [4047](#L4047) | </tr> |
| [4048](#L4048) | <tr align="center"> |
| [4049](#L4049) | <td><img class="demo\_img" width="42" height="42" src="' . plugins\_url( '/assets/images/handbag.jpg', \_\_FILE\_\_ ) . '"/></td> |
| [4050](#L4050) | <td>' . \_\_( "Woman's Hand Bags", 'woocommerce-abandoned-cart' ) . '</td> |
| [4051](#L4051) | <td>1</td> |
| [4052](#L4052) | <td>' . $wcal\_price . '</td> |
| [4053](#L4053) | <td>' . $wcal\_price . '</td> |
| [4054](#L4054) | </tr> |
| [4055](#L4055) | <tr align="center"> |
| [4056](#L4056) | <td></td> |
| [4057](#L4057) | <td></td> |
| [4058](#L4058) | <td></td> |
| [4059](#L4059) | <td>' . \_\_( 'Cart Total:', 'woocommerce-abandoned-cart' ) . '</td> |
| [4060](#L4060) | <td>' . $wcal\_total\_price . '</td> |
| [4061](#L4061) | </tr> |
| [4062](#L4062) | </table>'; |
| [4063](#L4063) | } else { |
| [4064](#L4064) | $headers  = 'From: ' . $from\_email\_name . ' <' . $from\_email\_preview . '>' . "\r\n"; |
| [4065](#L4065) | $headers .= 'Content-Type: text/html' . "\r\n"; |
| [4066](#L4066) | $headers .= 'Reply-To:  ' . $reply\_name\_preview . ' ' . "\r\n"; |
| [4067](#L4067) | $var      = '<h3 style="text-align:center">' . \_\_( 'Your Shopping Cart', 'woocommerce-abandoned-cart' ) . '</h3> |
| [4068](#L4068) | <table border="0" cellpadding="10" cellspacing="0" class="templateDataTable"> |
| [4069](#L4069) | <tr align="center"> |
| [4070](#L4070) | <th>' . \_\_( 'Item', 'woocommerce-abandoned-cart' ) . '</th> |
| [4071](#L4071) | <th>' . \_\_( 'Name', 'woocommerce-abandoned-cart' ) . '</th> |
| [4072](#L4072) | <th>' . \_\_( 'Quantity', 'woocommerce-abandoned-cart' ) . '</th> |
| [4073](#L4073) | <th>' . \_\_( 'Price', 'woocommerce-abandoned-cart' ) . '</th> |
| [4074](#L4074) | <th>' . \_\_( 'Line Subtotal', 'woocommerce-abandoned-cart' ) . '</th> |
| [4075](#L4075) | </tr> |
| [4076](#L4076) | <tr align="center"> |
| [4077](#L4077) | <td><img class="demo\_img" width="42" height="42" src="' . plugins\_url( '/assets/images/shoes.jpg', \_\_FILE\_\_ ) . '"/></td> |
| [4078](#L4078) | <td>' . \_\_( "Men's Formal Shoes", 'woocommerce-abandoned-cart' ) . '</td> |
| [4079](#L4079) | <td>1</td> |
| [4080](#L4080) | <td>' . $wcal\_price . '</td> |
| [4081](#L4081) | <td>' . $wcal\_price . '</td> |
| [4082](#L4082) | </tr> |
| [4083](#L4083) | <tr align="center"> |
| [4084](#L4084) | <td><img class="demo\_img" width="42" height="42" src="' . plugins\_url( '/assets/images/handbag.jpg', \_\_FILE\_\_ ) . '"/></td> |
| [4085](#L4085) | <td>' . \_\_( "Woman's Hand Bags", 'woocommerce-abandoned-cart' ) . '</td> |
| [4086](#L4086) | <td>1</td> |
| [4087](#L4087) | <td>' . $wcal\_price . '</td> |
| [4088](#L4088) | <td>' . $wcal\_price . '</td> |
| [4089](#L4089) | </tr> |
| [4090](#L4090) | <tr align="center"> |
| [4091](#L4091) | <td></td> |
| [4092](#L4092) | <td></td> |
| [4093](#L4093) | <td></td> |
| [4094](#L4094) | <td>' . \_\_( 'Cart Total:', 'woocommerce-abandoned-cart' ) . '</td> |
| [4095](#L4095) | <td>' . $wcal\_total\_price . '</td> |
| [4096](#L4096) | </tr> |
| [4097](#L4097) | </table>'; |
| [4098](#L4098) | } |
| [4099](#L4099) | $body\_email\_preview = str\_ireplace( '{{products.cart}}', $var, $body\_email\_preview ); |
| [4100](#L4100) | if ( isset( $\_POST['send\_email\_id'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [4101](#L4101) | $to\_email\_preview = sanitize\_text\_field( wp\_unslash( $\_POST['send\_email\_id'] ) ); // phpcs:ignore WordPress.Security.NonceVerification |
| [4102](#L4102) | } else { |
| [4103](#L4103) | $to\_email\_preview = ''; |
| [4104](#L4104) | } |
| [4105](#L4105) | $user\_email\_from          = get\_option( 'admin\_email' ); |
| [4106](#L4106) | $body\_email\_final\_preview = stripslashes( $body\_email\_preview ); |
| [4107](#L4107) |  |
| [4108](#L4108) | if ( isset( $is\_wc\_template ) && 'true' === $is\_wc\_template ) { |
| [4109](#L4109) | ob\_start(); |
| [4110](#L4110) | // Get email heading. |
| [4111](#L4111) | wc\_get\_template( 'emails/email-header.php', array( 'email\_heading' => $wc\_template\_header ) ); |
| [4112](#L4112) | $email\_body\_template\_header = ob\_get\_clean(); |
| [4113](#L4113) |  |
| [4114](#L4114) | ob\_start(); |
| [4115](#L4115) | wc\_get\_template( 'emails/email-footer.php' ); |
| [4116](#L4116) | $email\_body\_template\_footer = ob\_get\_clean(); |
| [4117](#L4117) |  |
| [4118](#L4118) | $final\_email\_body = $email\_body\_template\_header . $body\_email\_final\_preview . $email\_body\_template\_footer; |
| [4119](#L4119) |  |
| [4120](#L4120) | $site\_title                 = get\_bloginfo( 'name' ); |
| [4121](#L4121) | $email\_body\_template\_footer = str\_ireplace( '{site\_title}', $site\_title, $email\_body\_template\_footer ); |
| [4122](#L4122) |  |
| [4123](#L4123) | wc\_mail( $to\_email\_preview, $subject\_email\_preview, $final\_email\_body, $headers ); |
| [4124](#L4124) | } else { |
| [4125](#L4125) | wp\_mail( $to\_email\_preview, $subject\_email\_preview, stripslashes( $body\_email\_preview ), $headers ); |
| [4126](#L4126) | } |
| [4127](#L4127) | echo 'email sent'; |
| [4128](#L4128) | die(); |
| [4129](#L4129) | } else { |
| [4130](#L4130) | echo 'not sent'; |
| [4131](#L4131) | die(); |
| [4132](#L4132) | } |
| [4133](#L4133) | } |
| [4134](#L4134) |  |
| [4135](#L4135) | /\*\* |
| [4136](#L4136) | \* Return the coupon settings in the template. |
| [4137](#L4137) | \* |
| [4138](#L4138) | \* @return $coupon\_code\_options - Coupon code settings. |
| [4139](#L4139) | \*/ |
| [4140](#L4140) | public static function wcal\_coupon\_options() { |
| [4141](#L4141) |  |
| [4142](#L4142) | $coupon\_expiry = ''; |
| [4143](#L4143) | if ( isset( $\_POST['wcal\_coupon\_expiry'] ) && '' !== $\_POST['wcal\_coupon\_expiry'] ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [4144](#L4144) | $coupon\_expiry = sanitize\_text\_field( wp\_unslash( $\_POST['wcal\_coupon\_expiry'] ) ); // phpcs:ignore WordPress.Security.NonceVerification |
| [4145](#L4145) | } |
| [4146](#L4146) |  |
| [4147](#L4147) | if ( isset( $\_POST['expiry\_day\_or\_hour'] ) && '' !== $\_POST['expiry\_day\_or\_hour'] ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [4148](#L4148) | $expiry\_day\_or\_hour = sanitize\_text\_field( wp\_unslash( $\_POST['expiry\_day\_or\_hour'] ) ); // phpcs:ignore WordPress.Security.NonceVerification |
| [4149](#L4149) | } |
| [4150](#L4150) | $coupon\_expiry = $coupon\_expiry . '-' . $expiry\_day\_or\_hour; |
| [4151](#L4151) |  |
| [4152](#L4152) | $discount\_shipping = isset( $\_POST['wcal\_allow\_free\_shipping'] ) && '' !== $\_POST['wcal\_allow\_free\_shipping'] ? 'yes' : 'off'; // phpcs:ignore WordPress.Security.NonceVerification |
| [4153](#L4153) | $individual\_use    = empty( $\_POST['individual\_use'] ) ? '0' : '1'; // phpcs:ignore WordPress.Security.NonceVerification |
| [4154](#L4154) | $discount\_type     = isset( $\_POST['wcal\_discount\_type'] ) && '' !== $\_POST['wcal\_discount\_type'] ? sanitize\_text\_field( wp\_unslash( $\_POST['wcal\_discount\_type'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [4155](#L4155) | $coupon\_amount     = isset( $\_POST['wcal\_coupon\_amount'] ) && '' !== $\_POST['wcal\_coupon\_amount'] ? sanitize\_text\_field( wp\_unslash( $\_POST['wcal\_coupon\_amount'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [4156](#L4156) |  |
| [4157](#L4157) | $coupon\_code\_options = array( |
| [4158](#L4158) | 'discount\_type'     => $discount\_type, |
| [4159](#L4159) | 'coupon\_amount'     => $coupon\_amount, |
| [4160](#L4160) | 'coupon\_expiry'     => $coupon\_expiry, |
| [4161](#L4161) | 'discount\_shipping' => $discount\_shipping, |
| [4162](#L4162) | 'individual\_use'    => $individual\_use, |
| [4163](#L4163) | ); |
| [4164](#L4164) |  |
| [4165](#L4165) | return $coupon\_code\_options; |
| [4166](#L4166) | } |
| [4167](#L4167) | /\*\* |
| [4168](#L4168) | \* It will search for the coupon code. It is called on the add / edit template page. |
| [4169](#L4169) | \* |
| [4170](#L4170) | \* @hook wp\_ajax\_wcal\_json\_find\_coupons |
| [4171](#L4171) | \* @param string $x - coupon code string. |
| [4172](#L4172) | \* @param array  $post\_types Post type which we want to search. |
| [4173](#L4173) | \* @since 5.11.0. |
| [4174](#L4174) | \*/ |
| [4175](#L4175) | public function wcal\_json\_find\_coupons( $x = '', $post\_types = array( 'shop\_coupon' ) ) { |
| [4176](#L4176) | check\_ajax\_referer( 'search-products', 'security' ); |
| [4177](#L4177) | $term = (string) urldecode( stripslashes( wp\_strip\_all\_tags( wp\_unslash( $\_GET['term'] ) ) ) ); //phpcs:ignore |
| [4178](#L4178) | if ( empty( $term ) ) { |
| [4179](#L4179) | die(); |
| [4180](#L4180) | } |
| [4181](#L4181) | if ( is\_numeric( $term ) ) { |
| [4182](#L4182) | $args  = array( |
| [4183](#L4183) | 'post\_type'      => $post\_types, |
| [4184](#L4184) | 'post\_status'    => 'publish', |
| [4185](#L4185) | 'posts\_per\_page' => -1, |
| [4186](#L4186) | 'post\_\_in'       => array( 0, $term ), |
| [4187](#L4187) | 'fields'         => 'ids', |
| [4188](#L4188) | ); |
| [4189](#L4189) | $args2 = array( |
| [4190](#L4190) | 'post\_type'      => $post\_types, |
| [4191](#L4191) | 'post\_status'    => 'publish', |
| [4192](#L4192) | 'posts\_per\_page' => -1, |
| [4193](#L4193) | 'post\_parent'    => $term, |
| [4194](#L4194) | 'fields'         => 'ids', |
| [4195](#L4195) | ); |
| [4196](#L4196) | $args3 = array( |
| [4197](#L4197) | 'post\_type'      => $post\_types, |
| [4198](#L4198) | 'post\_status'    => 'publish', |
| [4199](#L4199) | 'posts\_per\_page' => -1, |
| [4200](#L4200) | 'meta\_query'     => array( // phpcs:ignore |
| [4201](#L4201) | array( |
| [4202](#L4202) | 'key'     => '\_sku', |
| [4203](#L4203) | 'value'   => $term, |
| [4204](#L4204) | 'compare' => 'LIKE', |
| [4205](#L4205) | ), |
| [4206](#L4206) | ), |
| [4207](#L4207) | 'fields'         => 'ids', |
| [4208](#L4208) | ); |
| [4209](#L4209) | $posts = array\_unique( array\_merge( get\_posts( $args ), get\_posts( $args2 ), get\_posts( $args3 ) ) ); |
| [4210](#L4210) | } else { |
| [4211](#L4211) | $args  = array( |
| [4212](#L4212) | 'post\_type'      => $post\_types, |
| [4213](#L4213) | 'post\_status'    => 'publish', |
| [4214](#L4214) | 'posts\_per\_page' => -1, |
| [4215](#L4215) | 's'              => $term, |
| [4216](#L4216) | 'fields'         => 'ids', |
| [4217](#L4217) | ); |
| [4218](#L4218) | $args2 = array( |
| [4219](#L4219) | 'post\_type'      => $post\_types, |
| [4220](#L4220) | 'post\_status'    => 'publish', |
| [4221](#L4221) | 'posts\_per\_page' => -1, |
| [4222](#L4222) | 'meta\_query'     => array( // phpcs:ignore |
| [4223](#L4223) | array( |
| [4224](#L4224) | 'key'     => '\_sku', |
| [4225](#L4225) | 'value'   => $term, |
| [4226](#L4226) | 'compare' => 'LIKE', |
| [4227](#L4227) | ), |
| [4228](#L4228) | ), |
| [4229](#L4229) | 'fields'         => 'ids', |
| [4230](#L4230) | ); |
| [4231](#L4231) | $posts = array\_unique( array\_merge( get\_posts( $args ), get\_posts( $args2 ) ) ); |
| [4232](#L4232) | } |
| [4233](#L4233) | $found\_products = array(); |
| [4234](#L4234) | if ( $posts ) { |
| [4235](#L4235) | foreach ( $posts as $post ) { |
| [4236](#L4236) | $sku              = get\_post\_meta( $post, '\_sku', true ); |
| [4237](#L4237) | $wcal\_product\_sku = apply\_filters( 'wcal\_product\_sku', $sku ); |
| [4238](#L4238) | if ( false !== $wcal\_product\_sku && '' !== $wcal\_product\_sku ) { |
| [4239](#L4239) | if ( isset( $sku ) && $sku ) { |
| [4240](#L4240) | $sku = ' ( SKU: ' . $sku . ' )'; |
| [4241](#L4241) | } |
| [4242](#L4242) | $found\_products[ $post ] = get\_the\_title( $post ) . ' &ndash; #' . $post . $sku; |
| [4243](#L4243) | } else { |
| [4244](#L4244) | $found\_products[ $post ] = get\_the\_title( $post ) . ' &ndash; #' . $post; |
| [4245](#L4245) | } |
| [4246](#L4246) | } |
| [4247](#L4247) | } |
| [4248](#L4248) | echo wp\_json\_encode( $found\_products ); |
| [4249](#L4249) | die(); |
| [4250](#L4250) | } |
| [4251](#L4251) |  |
| [4252](#L4252) | /\*\* |
| [4253](#L4253) | \* Callback for Coupon settings section. |
| [4254](#L4254) | \*/ |
| [4255](#L4255) | public static function ac\_lite\_coupon\_callback() {} |
| [4256](#L4256) |  |
| [4257](#L4257) | /\*\* |
| [4258](#L4258) | \* Option for deleting the plugin data upon uninstall. |
| [4259](#L4259) | \* |
| [4260](#L4260) | \* @param array $args Argument for adding field details. |
| [4261](#L4261) | \* @since 8.3 |
| [4262](#L4262) | \*/ |
| [4263](#L4263) | public static function wcal\_deleting\_coupon\_data( $args ) { |
| [4264](#L4264) | $wcal\_delete\_coupon\_data = get\_option( 'wcal\_delete\_coupon\_data', '' ); |
| [4265](#L4265) | if ( isset( $wcal\_delete\_coupon\_data ) && '' === $wcal\_delete\_coupon\_data ) { |
| [4266](#L4266) | $wcal\_delete\_coupon\_data = 'off'; |
| [4267](#L4267) | wp\_clear\_scheduled\_hook( 'woocommerce\_ac\_delete\_coupon\_action' ); |
| [4268](#L4268) | } else { |
| [4269](#L4269) | if ( ! wp\_next\_scheduled( 'woocommerce\_ac\_delete\_coupon\_action' ) ) { |
| [4270](#L4270) | wp\_schedule\_event( time(), 'wcal\_15\_days', 'woocommerce\_ac\_delete\_coupon\_action' ); |
| [4271](#L4271) | } |
| [4272](#L4272) | } |
| [4273](#L4273) |  |
| [4274](#L4274) | ?> |
| [4275](#L4275) | <input type="checkbox" id="wcal\_delete\_coupon\_data" name="wcal\_delete\_coupon\_data" value="on" <?php echo checked( 'on', $wcal\_delete\_coupon\_data, false ); ?> /> |
| [4276](#L4276) | <label for="wcal\_delete\_coupon\_data"> <?php echo esc\_attr( $args[0] ); ?></label> |
| [4277](#L4277) | <a > |
| [4278](#L4278) | <?php |
| [4279](#L4279) | } |
| [4280](#L4280) | /\*\* |
| [4281](#L4281) | \* It will delete the expired and used coupon codes. |
| [4282](#L4282) | \* |
| [4283](#L4283) | \* @hook wp\_ajax\_wcal\_change\_manual\_email\_data |
| [4284](#L4284) | \* @since: 5.11.0 |
| [4285](#L4285) | \*/ |
| [4286](#L4286) | public static function wcal\_delete\_expired\_used\_coupon\_code() { |
| [4287](#L4287) |  |
| [4288](#L4288) | global $wpdb; |
| [4289](#L4289) | if ( ! current\_user\_can( 'manage\_options' ) && ! wp\_verify\_nonce( sanitize\_key( $\_POST['ajax\_nonce'] ), 'delete\_expired\_used\_coupon\_code' ) ) { //phpcs:ignore |
| [4290](#L4290) | wp\_send\_json\_error(); |
| [4291](#L4291) | } |
| [4292](#L4292) |  |
| [4293](#L4293) | $expired\_coupons = self::wcal\_fetch\_expired\_coupons(); |
| [4294](#L4294) | $used\_coupons    = self::wcal\_fetch\_used\_coupons(); |
| [4295](#L4295) | $coupons         = array\_unique( array\_merge( $expired\_coupons, $used\_coupons ) ); |
| [4296](#L4296) | $coupon\_count    = count( $coupons ); |
| [4297](#L4297) |  |
| [4298](#L4298) | if ( $coupon\_count ) { |
| [4299](#L4299) | $coupons\_ids = implode( ',', $coupons ); |
| [4300](#L4300) | $wpdb->query( "DELETE FROM {$wpdb->postmeta} WHERE post\_id IN(" . $coupons\_ids . ')' );//phpcs:ignore |
| [4301](#L4301) | $wpdb->query( "DELETE FROM {$wpdb->posts} WHERE ID IN(" . $coupons\_ids . ')' );//phpcs:ignore |
| [4302](#L4302) | } |
| [4303](#L4303) |  |
| [4304](#L4304) | // translators: %1$s: Coupons Deleted, %2$s: Deleted coupons count'. |
| [4305](#L4305) | wp\_send\_json\_success( sprintf( \_\_( '%1$s: %2$d', 'woo-cart-abandonment-recovery' ), 'Coupons Deleted', $coupon\_count ) ); |
| [4306](#L4306) | } |
| [4307](#L4307) |  |
| [4308](#L4308) | /\*\* |
| [4309](#L4309) | \* Coupon deletion manual button. |
| [4310](#L4310) | \* |
| [4311](#L4311) | \* @param array $args - Arguments for the setting. |
| [4312](#L4312) | \*/ |
| [4313](#L4313) | public static function wcal\_deleting\_coupon\_data\_manually( $args ) { |
| [4314](#L4314) | ?> |
| [4315](#L4315) | <input type="button" class="button-secondary" id="wcal\_delete\_coupons" value="<?php esc\_html\_e( 'Delete', 'woocommerce-ac' ); ?>" > |
| [4316](#L4316) | <label> <?php echo esc\_attr( $args[0] ); ?></label> |
| [4317](#L4317) | <br> |
| [4318](#L4318) | <span class="wcal-spinner" style="display:none;"> |
| [4319](#L4319) | <img class="ajax\_img" src="<?php echo esc\_attr( WCAL\_PLUGIN\_URL . '/assets/images/ajax-loader.gif' ); ?>" /> |
| [4320](#L4320) | </span> |
| [4321](#L4321) | <span class="wcal-coupon-response-msg"></span> |
| [4322](#L4322) | <?php |
| [4323](#L4323) | } |
| [4324](#L4324) | /\*\* |
| [4325](#L4325) | \* It will fetch all expired coupons |
| [4326](#L4326) | \* |
| [4327](#L4327) | \* @hook wp\_ajax\_wcal\_change\_manual\_email\_data. |
| [4328](#L4328) | \* @since: 5.11 |
| [4329](#L4329) | \*/ |
| [4330](#L4330) | public static function wcal\_fetch\_expired\_coupons() { |
| [4331](#L4331) | $coupon\_ids = array(); |
| [4332](#L4332) |  |
| [4333](#L4333) | $args = array( |
| [4334](#L4334) | 'posts\_per\_page' => -1, |
| [4335](#L4335) | 'post\_type'      => 'shop\_coupon', |
| [4336](#L4336) | 'post\_status'    => 'publish', |
| [4337](#L4337) | 'meta\_query'     => array( //phpcs:ignore |
| [4338](#L4338) | 'relation' => 'AND', |
| [4339](#L4339) | array( |
| [4340](#L4340) | 'key'     => 'date\_expires', |
| [4341](#L4341) | 'value'   => strtotime( 'today' ), |
| [4342](#L4342) | 'compare' => '<=', |
| [4343](#L4343) | ), |
| [4344](#L4344) | array( |
| [4345](#L4345) | 'key'     => 'date\_expires', |
| [4346](#L4346) | 'value'   => '', |
| [4347](#L4347) | 'compare' => '!=', |
| [4348](#L4348) | ), |
| [4349](#L4349) | array( |
| [4350](#L4350) | 'key'     => 'wcal\_created\_by', |
| [4351](#L4351) | 'value'   => 'wcal', |
| [4352](#L4352) | 'compare' => '=', |
| [4353](#L4353) | ), |
| [4354](#L4354) | ), |
| [4355](#L4355) | ); |
| [4356](#L4356) |  |
| [4357](#L4357) | $args    = array( |
| [4358](#L4358) | 'posts\_per\_page' => -1, |
| [4359](#L4359) | 'post\_type'      => 'shop\_coupon', |
| [4360](#L4360) | 'post\_status'    => 'publish', |
| [4361](#L4361) | 'meta\_query'     => array( // phpcs:ignore |
| [4362](#L4362) | 'relation' => 'AND', |
| [4363](#L4363) | array( |
| [4364](#L4364) | 'key'     => 'date\_expires', |
| [4365](#L4365) | 'value'   => strtotime( 'today' ), |
| [4366](#L4366) | 'compare' => '<=', |
| [4367](#L4367) | ), |
| [4368](#L4368) | array( |
| [4369](#L4369) | 'key'     => 'date\_expires', |
| [4370](#L4370) | 'value'   => '', |
| [4371](#L4371) | 'compare' => '!=', |
| [4372](#L4372) | ), |
| [4373](#L4373) | array( |
| [4374](#L4374) | 'key'     => 'wcal\_created\_by', |
| [4375](#L4375) | 'value'   => 'wcal', |
| [4376](#L4376) | 'compare' => '=', |
| [4377](#L4377) | ), |
| [4378](#L4378) | ), |
| [4379](#L4379) | ); |
| [4380](#L4380) | $coupons = get\_posts( $args ); |
| [4381](#L4381) | if ( ! empty( $coupons ) ) { |
| [4382](#L4382) | $current\_time = current\_time( 'timestamp' ); // phpcs:ignore |
| [4383](#L4383) |  |
| [4384](#L4384) | foreach ( $coupons as $coupon ) { |
| [4385](#L4385) | array\_push( $coupon\_ids, $coupon->ID ); |
| [4386](#L4386) | } |
| [4387](#L4387) | } |
| [4388](#L4388) |  |
| [4389](#L4389) | return $coupon\_ids; |
| [4390](#L4390) | } |
| [4391](#L4391) |  |
| [4392](#L4392) | /\*\* |
| [4393](#L4393) | \* It will fetch all used coupons. |
| [4394](#L4394) | \* |
| [4395](#L4395) | \* @hook wp\_ajax\_wcal\_change\_manual\_email\_data |
| [4396](#L4396) | \* @since: 4.2 |
| [4397](#L4397) | \*/ |
| [4398](#L4398) | public static function wcal\_fetch\_used\_coupons() { |
| [4399](#L4399) |  |
| [4400](#L4400) | $coupon\_ids = array(); |
| [4401](#L4401) | $args       = array( |
| [4402](#L4402) | 'posts\_per\_page' => -1, |
| [4403](#L4403) | 'post\_type'      => 'shop\_coupon', |
| [4404](#L4404) | 'post\_status'    => 'publish', |
| [4405](#L4405) | 'meta\_query'     => array( // phpcs:ignore |
| [4406](#L4406) | 'relation' => 'AND', |
| [4407](#L4407) | array( |
| [4408](#L4408) | 'key'     => 'usage\_count', |
| [4409](#L4409) | 'value'   => 0, |
| [4410](#L4410) | 'compare' => '>', |
| [4411](#L4411) | ), |
| [4412](#L4412) | array( |
| [4413](#L4413) | 'key'     => 'wcal\_created\_by', |
| [4414](#L4414) | 'value'   => 'wcal', |
| [4415](#L4415) | 'compare' => '=', |
| [4416](#L4416) | ), |
| [4417](#L4417) | ), |
| [4418](#L4418) | ); |
| [4419](#L4419) |  |
| [4420](#L4420) | $coupons = get\_posts( $args ); |
| [4421](#L4421) | if ( ! empty( $coupons ) ) { |
| [4422](#L4422) | foreach ( $coupons as $coupon ) { |
| [4423](#L4423) | array\_push( $coupon\_ids, $coupon->ID ); |
| [4424](#L4424) | } |
| [4425](#L4425) | } |
| [4426](#L4426) | return $coupon\_ids; |
| [4427](#L4427) | } |
| [4428](#L4428) | /\*\* |
| [4429](#L4429) | \* It will create the cron job interval. |
| [4430](#L4430) | \* Default value will be 15 minutes. |
| [4431](#L4431) | \* If customer has changed the cron job interval time from the settings then it will be considered. |
| [4432](#L4432) | \* |
| [4433](#L4433) | \* @param array $schedules Array of all schedule events. |
| [4434](#L4434) | \* @return array $schedule Array of new added schedule event. |
| [4435](#L4435) | \* @since 5.0 |
| [4436](#L4436) | \*/ |
| [4437](#L4437) | public static function wcal\_add\_cron\_schedule( $schedules ) { |
| [4438](#L4438) | $duration = get\_option( 'wcal\_cron\_time\_duration' ); |
| [4439](#L4439) | if ( isset( $duration ) && $duration > 0 ) { |
| [4440](#L4440) | $duration\_in\_seconds = $duration \* 60; |
| [4441](#L4441) | } else { |
| [4442](#L4442) | $duration\_in\_seconds = 900; |
| [4443](#L4443) | } |
| [4444](#L4444) | $schedules['15\_minutes'] = array( |
| [4445](#L4445) | 'interval' => $duration\_in\_seconds,  // 15 minutes in seconds |
| [4446](#L4446) | 'display'  => \_\_( 'Once Every Fifteen Minutes' ), |
| [4447](#L4447) | ); |
| [4448](#L4448) |  |
| [4449](#L4449) | $schedules['wcal\_15\_days'] = array( |
| [4450](#L4450) | 'interval' => 1296000, // 15 days in seconds |
| [4451](#L4451) | 'display'  => \_\_( 'Once Every Fifteen Days' ), |
| [4452](#L4452) | ); |
| [4453](#L4453) | return $schedules; |
| [4454](#L4454) | } |
| [4455](#L4455) |  |
| [4456](#L4456) | /\*\* |
| [4457](#L4457) | \* Callback for Abandoned cart Coupon settings. |
| [4458](#L4458) | \*/ |
| [4459](#L4459) | public static function wcal\_coupon\_callback() { |
| [4460](#L4460) | } |
| [4461](#L4461) |  |
| [4462](#L4462) | /\*\* |
| [4463](#L4463) | \* Callback for GDPR settings section. |
| [4464](#L4464) | \*/ |
| [4465](#L4465) | public static function ac\_lite\_gdpr\_callback() {} |
| [4466](#L4466) | } |
| [4467](#L4467) | } |
| [4468](#L4468) | $woocommerce\_abandon\_cart = new woocommerce\_abandon\_cart\_lite(); |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2916178&format=txt)
* [Original Format](/export/2916178/woocommerce-abandoned-cart/trunk/woocommerce-ac.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_8bfb2efe_20250114_185316.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fwoocommerce-abandoned-cart%2Ftrunk%2Fwoocommerce-ac.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=3205464 "Revision 3205464")
* Next Revision →
* [Blame](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/woocommerce-abandoned-cart/trunk/woocommerce-ac.php)

---

# [source:](/browser?order=name "Go to repository root") [woocommerce-abandoned-cart](/browser/woocommerce-abandoned-cart?order=name "View woocommerce-abandoned-cart")/[trunk](/browser/woocommerce-abandoned-cart/trunk?order=name "View trunk")/[woocommerce-ac.php](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?order=name "View woocommerce-ac.php")

View diff against:

View revision:

| [Last change](/changeset/3221509/woocommerce-abandoned-cart/trunk/woocommerce-ac.php "View differences") on this file was [3221509](/changeset/3221509/ "View changeset 3221509"), checked in by tychesoftwares, [32 hours ago](/timeline?from=2025-01-13T10%3A52%3A41Z&precision=second "See timeline at 01/13/2025 10:52:41 AM") |
| --- |
| Updated version into 6.3.0 |
| **File size:** 195.9 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* Plugin Name: Abandoned Cart Lite for WooCommerce |
| [4](#L4) | \* Plugin URI: http://www.tychesoftwares.com/store/premium-plugins/woocommerce-abandoned-cart-pro |
| [5](#L5) | \* Description: This plugin captures abandoned carts by logged-in users & emails them about it. Enjoy all the premium features at no extra cost for 2 months. Click <strong><a href="https://www.tychesoftwares.com/products/woocommerce-abandoned-cart-pro-plugin-trial">here</a></strong> to Upgrade to PRO for FREE. |
| [6](#L6) | \* Version: 6.3.0 |
| [7](#L7) | \* Author: Tyche Softwares |
| [8](#L8) | \* Author URI: http://www.tychesoftwares.com/ |
| [9](#L9) | \* Text Domain: woocommerce-abandoned-cart |
| [10](#L10) | \* Domain Path: /i18n/languages/ |
| [11](#L11) | \* Requires PHP: 7.4 or higher |
| [12](#L12) | \* WC requires at least: 4.0.0 |
| [13](#L13) | \* WC tested up to: 9.5.2 |
| [14](#L14) | \* Requires Plugins: woocommerce |
| [15](#L15) | \* |
| [16](#L16) | \* @package Abandoned-Cart-Lite-for-WooCommerce |
| [17](#L17) | \*/ |
| [18](#L18) |  |
| [19](#L19) | use Automattic\WooCommerce\Utilities\OrderUtil; |
| [20](#L20) |  |
| [21](#L21) | require\_once 'class-wcal-update.php'; |
| [22](#L22) | require\_once 'includes/class-wcal-guest-ac.php'; |
| [23](#L23) | require\_once 'includes/class-wcal-default-template-settings.php'; |
| [24](#L24) | require\_once 'includes/class-wcal-delete-handler.php'; |
| [25](#L25) | require\_once 'includes/classes/class-wcal-aes.php'; |
| [26](#L26) | require\_once 'includes/classes/class-wcal-aes-counter.php'; |
| [27](#L27) | require\_once 'includes/class-wcal-common.php'; |
| [28](#L28) |  |
| [29](#L29) | require\_once 'includes/class-wcal-admin-notice.php'; |
| [30](#L30) | require\_once 'includes/class-wcal-tracking-msg.php'; |
| [31](#L31) | require\_once 'includes/admin/class-wcal-personal-data-eraser.php'; |
| [32](#L32) | require\_once 'includes/admin/class-wcal-personal-data-export.php'; |
| [33](#L33) | require\_once 'includes/admin/class-wcal-abandoned-cart-details.php'; |
| [34](#L34) |  |
| [35](#L35) | require\_once 'includes/admin/class-wcap-pro-settings.php'; |
| [36](#L36) | require\_once 'includes/wcal-functions.php'; |
| [37](#L37) | require\_once 'includes/class-wcal-webhooks.php'; |
| [38](#L38) |  |
| [39](#L39) | load\_plugin\_textdomain( 'woocommerce-abandoned-cart', false, basename( dirname( \_\_FILE\_\_ ) ) . '/i18n/languages' ); |
| [40](#L40) |  |
| [41](#L41) | /\*\* |
| [42](#L42) | \* Schedule an action to delete old carts once a day |
| [43](#L43) | \* |
| [44](#L44) | \* @since 5.1 |
| [45](#L45) | \* @package Abandoned-Cart-Lite-for-WooCommerce/Cron |
| [46](#L46) | \*/ |
| [47](#L47) | if ( ! wp\_next\_scheduled( 'wcal\_clear\_carts' ) ) { |
| [48](#L48) | wp\_schedule\_event( time(), 'daily', 'wcal\_clear\_carts' ); |
| [49](#L49) | } |
| [50](#L50) |  |
| [51](#L51) | /\*\* |
| [52](#L52) | \* Main class |
| [53](#L53) | \*/ |
| [54](#L54) | if ( ! class\_exists( 'woocommerce\_abandon\_cart\_lite' ) ) { |
| [55](#L55) |  |
| [56](#L56) |  |
| [57](#L57) | /\*\* |
| [58](#L58) | \* It will add the hooks, filters, menu and the variables and all the necessary actions for the plguins which will be used |
| [59](#L59) | \* all over the plugin. |
| [60](#L60) | \* |
| [61](#L61) | \* @since 1.0 |
| [62](#L62) | \* @package Abandoned-Cart-Lite-for-WooCommerce/Core |
| [63](#L63) | \*/ |
| [64](#L64) | class woocommerce\_abandon\_cart\_lite { |
| [65](#L65) | /\*\* |
| [66](#L66) | \* Duration One hour. |
| [67](#L67) | \* |
| [68](#L68) | \* @var int |
| [69](#L69) | \*/ |
| [70](#L70) | public $one\_hour; |
| [71](#L71) | /\*\* |
| [72](#L72) | \* Duration three hours. |
| [73](#L73) | \* |
| [74](#L74) | \* @var int |
| [75](#L75) | \*/ |
| [76](#L76) | public $three\_hours; |
| [77](#L77) | /\*\* |
| [78](#L78) | \* Duration six hours. |
| [79](#L79) | \* |
| [80](#L80) | \* @var int |
| [81](#L81) | \*/ |
| [82](#L82) | public $six\_hours; |
| [83](#L83) | /\*\* |
| [84](#L84) | \* Duration 12 hours. |
| [85](#L85) | \* |
| [86](#L86) | \* @var int |
| [87](#L87) | \*/ |
| [88](#L88) | public $twelve\_hours; |
| [89](#L89) | /\*\* |
| [90](#L90) | \* Duration One day. |
| [91](#L91) | \* |
| [92](#L92) | \* @var int |
| [93](#L93) | \*/ |
| [94](#L94) | public $one\_day; |
| [95](#L95) | /\*\* |
| [96](#L96) | \* Duration One week. |
| [97](#L97) | \* |
| [98](#L98) | \* @var int |
| [99](#L99) | \*/ |
| [100](#L100) | public $one\_week; |
| [101](#L101) | /\*\* |
| [102](#L102) | \* Duration range select |
| [103](#L103) | \* |
| [104](#L104) | \* @var array |
| [105](#L105) | \*/ |
| [106](#L106) | public $duration\_range\_select; |
| [107](#L107) | /\*\* |
| [108](#L108) | \* Duration start & end dates |
| [109](#L109) | \* |
| [110](#L110) | \* @var array |
| [111](#L111) | \*/ |
| [112](#L112) | public $start\_end\_dates; |
| [113](#L113) | /\*\* |
| [114](#L114) | \* The constructor will add the hooks, filters and the variable which will be used all over the plugin. |
| [115](#L115) | \* |
| [116](#L116) | \* @since 1.0 |
| [117](#L117) | \*/ |
| [118](#L118) | public function \_\_construct() { |
| [119](#L119) | if ( ! defined( 'WCAL\_PLUGIN\_URL' ) ) { |
| [120](#L120) | define( 'WCAL\_PLUGIN\_URL', untrailingslashit( plugins\_url( '/', \_\_FILE\_\_ ) ) ); |
| [121](#L121) | } |
| [122](#L122) |  |
| [123](#L123) | if ( ! defined( 'WCAL\_PLUGIN\_VERSION' ) ) { |
| [124](#L124) | define( 'WCAL\_PLUGIN\_VERSION', '6.3.0' ); |
| [125](#L125) | } |
| [126](#L126) |  |
| [127](#L127) | if ( ! defined( 'WCAL\_PLUGIN\_PATH' ) ) { |
| [128](#L128) | define( 'WCAL\_PLUGIN\_PATH', untrailingslashit( plugin\_dir\_path( \_\_FILE\_\_ ) ) ); |
| [129](#L129) | } |
| [130](#L130) |  |
| [131](#L131) | if ( ! defined( 'WCAL\_PLUGIN\_UPGRADE\_TO\_PRO\_TEMPLATE\_PATH' ) ) { |
| [132](#L132) | define( 'WCAL\_PLUGIN\_UPGRADE\_TO\_PRO\_TEMPLATE\_PATH', WCAL\_PLUGIN\_PATH . '/includes/component/upgrade-to-pro/templates/' ); |
| [133](#L133) | } |
| [134](#L134) |  |
| [135](#L135) | if ( ! defined( 'WCAL\_TRIAL\_NAME' ) ) { |
| [136](#L136) | define( 'WCAL\_TRIAL\_NAME', 'Abandoned Cart Pro for WooCommerce Trial' ); |
| [137](#L137) | } |
| [138](#L138) |  |
| [139](#L139) | if ( ! defined( 'WCAL\_TRIAL\_URL' ) ) { |
| [140](#L140) | define( 'WCAL\_TRIAL\_URL', 'https://www.tychesoftwares.com/products/woocommerce-abandoned-cart-pro-plugin-trial' ); |
| [141](#L141) | } |
| [142](#L142) |  |
| [143](#L143) | $this->one\_hour              = 60 \* 60; |
| [144](#L144) | $this->three\_hours           = 3 \* $this->one\_hour; |
| [145](#L145) | $this->six\_hours             = 6 \* $this->one\_hour; |
| [146](#L146) | $this->twelve\_hours          = 12 \* $this->one\_hour; |
| [147](#L147) | $this->one\_day               = 24 \* $this->one\_hour; |
| [148](#L148) | $this->one\_week              = 7 \* $this->one\_day; |
| [149](#L149) | $this->duration\_range\_select = array( |
| [150](#L150) | 'yesterday'      => 'Yesterday', |
| [151](#L151) | 'today'          => 'Today', |
| [152](#L152) | 'last\_seven'     => 'Last 7 days', |
| [153](#L153) | 'last\_fifteen'   => 'Last 15 days', |
| [154](#L154) | 'last\_thirty'    => 'Last 30 days', |
| [155](#L155) | 'last\_ninety'    => 'Last 90 days', |
| [156](#L156) | 'last\_year\_days' => 'Last 365', |
| [157](#L157) | ); |
| [158](#L158) |  |
| [159](#L159) | $this->start\_end\_dates = array( |
| [160](#L160) | 'yesterday'      => array( |
| [161](#L161) | 'start\_date' => date( 'd M Y', ( current\_time( 'timestamp' ) - 24 \* 60 \* 60 ) ), // phpcs:ignore |
| [162](#L162) | 'end\_date'   => date( 'd M Y', ( current\_time( 'timestamp' ) - 7 \* 24 \* 60 \* 60 ) ), // phpcs:ignore |
| [163](#L163) | ), |
| [164](#L164) | 'today'          => array( |
| [165](#L165) | 'start\_date' => date( 'd M Y', ( current\_time( 'timestamp' ) ) ), // phpcs:ignore |
| [166](#L166) | 'end\_date'   => date( 'd M Y', ( current\_time( 'timestamp' ) ) ), // phpcs:ignore |
| [167](#L167) | ), |
| [168](#L168) | 'last\_seven'     => array( |
| [169](#L169) | 'start\_date' => date( 'd M Y', ( current\_time( 'timestamp' ) - 7 \* 24 \* 60 \* 60 ) ), // phpcs:ignore |
| [170](#L170) | 'end\_date'   => date( 'd M Y', ( current\_time( 'timestamp' ) ) ), // phpcs:ignore |
| [171](#L171) | ), |
| [172](#L172) | 'last\_fifteen'   => array( |
| [173](#L173) | 'start\_date' => date( 'd M Y', ( current\_time( 'timestamp' ) - 15 \* 24 \* 60 \* 60 ) ), // phpcs:ignore |
| [174](#L174) | 'end\_date'   => date( 'd M Y', ( current\_time( 'timestamp' ) ) ), // phpcs:ignore |
| [175](#L175) | ), |
| [176](#L176) | 'last\_thirty'    => array( |
| [177](#L177) | 'start\_date' => date( 'd M Y', ( current\_time( 'timestamp' ) - 30 \* 24 \* 60 \* 60 ) ), // phpcs:ignore |
| [178](#L178) | 'end\_date'   => date( 'd M Y', ( current\_time( 'timestamp' ) ) ), // phpcs:ignore |
| [179](#L179) | ), |
| [180](#L180) | 'last\_ninety'    => array( |
| [181](#L181) | 'start\_date' => date( 'd M Y', ( current\_time( 'timestamp' ) - 90 \* 24 \* 60 \* 60 ) ), // phpcs:ignore |
| [182](#L182) | 'end\_date'   => date( 'd M Y', ( current\_time( 'timestamp' ) ) ), // phpcs:ignore |
| [183](#L183) | ), |
| [184](#L184) | 'last\_year\_days' => array( |
| [185](#L185) | 'start\_date' => date( 'd M Y', ( current\_time( 'timestamp' ) - 365 \* 24 \* 60 \* 60 ) ), // phpcs:ignore |
| [186](#L186) | 'end\_date'   => date( 'd M Y', ( current\_time( 'timestamp' ) ) ), // phpcs:ignore |
| [187](#L187) | ), |
| [188](#L188) | ); |
| [189](#L189) |  |
| [190](#L190) | // Initialize settings. |
| [191](#L191) | register\_activation\_hook( \_\_FILE\_\_, array( &$this, 'wcal\_activate' ) ); |
| [192](#L192) | register\_deactivation\_hook( \_\_FILE\_\_, array( &$this, 'wcal\_deactivate' ) ); |
| [193](#L193) |  |
| [194](#L194) | // Action Scheduler for Cron. |
| [195](#L195) | if ( file\_exists( WP\_PLUGIN\_DIR . '/woocommerce/packages/action-scheduler/action-scheduler.php' ) ) { |
| [196](#L196) | require\_once WP\_PLUGIN\_DIR . '/woocommerce/packages/action-scheduler/action-scheduler.php'; |
| [197](#L197) | } else { |
| [198](#L198) | add\_action( 'admin\_notices', array( &$this, 'wcal\_as\_failed\_notice' ) ); |
| [199](#L199) | } |
| [200](#L200) | add\_action( 'init', array( &$this, 'wcal\_add\_scheduled\_action' ) ); |
| [201](#L201) | require\_once 'cron/class-wcal-cron.php'; |
| [202](#L202) | require\_once 'includes/class-wcal-process-base.php'; |
| [203](#L203) |  |
| [204](#L204) | // WordPress Administration Menu. |
| [205](#L205) | add\_action( 'admin\_menu', array( &$this, 'wcal\_admin\_menu' ) ); |
| [206](#L206) | add\_action( 'before\_woocommerce\_init', array( &$this, 'wcal\_custom\_order\_tables\_compatibility' ), 999 ); |
| [207](#L207) |  |
| [208](#L208) | // Actions to be done on cart update. |
| [209](#L209) | add\_action( 'woocommerce\_add\_to\_cart', array( &$this, 'wcal\_store\_cart\_timestamp' ), PHP\_INT\_MAX ); |
| [210](#L210) | add\_action( 'woocommerce\_cart\_item\_removed', array( &$this, 'wcal\_store\_cart\_timestamp' ), PHP\_INT\_MAX ); |
| [211](#L211) | add\_action( 'woocommerce\_cart\_item\_restored', array( &$this, 'wcal\_store\_cart\_timestamp' ), PHP\_INT\_MAX ); |
| [212](#L212) | add\_action( 'woocommerce\_after\_cart\_item\_quantity\_update', array( &$this, 'wcal\_store\_cart\_timestamp' ), PHP\_INT\_MAX ); |
| [213](#L213) | add\_action( 'woocommerce\_calculate\_totals', array( &$this, 'wcal\_store\_cart\_timestamp' ), PHP\_INT\_MAX ); |
| [214](#L214) |  |
| [215](#L215) | add\_filter( 'wcal\_block\_crawlers', array( &$this, 'wcal\_detect\_crawlers' ), 10, 1 ); |
| [216](#L216) |  |
| [217](#L217) | add\_action( 'admin\_init', array( &$this, 'wcal\_action\_admin\_init' ) ); |
| [218](#L218) |  |
| [219](#L219) | // Update the options as per settings API. |
| [220](#L220) | add\_action( 'admin\_init', array( 'Wcal\_Update', 'wcal\_schedule\_update\_action' ) ); |
| [221](#L221) | add\_action( 'wcal\_update\_db', array( 'Wcal\_Update', 'wcal\_update\_db\_check' ) ); |
| [222](#L222) |  |
| [223](#L223) | // WordPress settings API. |
| [224](#L224) | add\_action( 'admin\_init', array( &$this, 'wcal\_initialize\_plugin\_options' ) ); |
| [225](#L225) |  |
| [226](#L226) | // Language Translation. |
| [227](#L227) | add\_action( 'init', array( &$this, 'wcal\_update\_po\_file' ) ); |
| [228](#L228) |  |
| [229](#L229) | add\_action( 'init', array( &$this, 'wcal\_add\_component\_file' ) ); |
| [230](#L230) |  |
| [231](#L231) | // track links. |
| [232](#L232) | add\_filter( 'template\_include', array( &$this, 'wcal\_email\_track\_links' ), 99, 1 ); |
| [233](#L233) |  |
| [234](#L234) | // It will used to unsubcribe the emails. |
| [235](#L235) | add\_action( 'template\_include', array( &$this, 'wcal\_email\_unsubscribe' ), 99, 1 ); |
| [236](#L236) |  |
| [237](#L237) | add\_action( 'admin\_enqueue\_scripts', array( &$this, 'wcal\_enqueue\_scripts\_js' ) ); |
| [238](#L238) | add\_action( 'admin\_enqueue\_scripts', array( &$this, 'wcal\_enqueue\_scripts\_css' ) ); |
| [239](#L239) | // delete abandoned order after X number of days. |
| [240](#L240) | if ( class\_exists( 'Wcal\_Delete\_Handler' ) ) { |
| [241](#L241) | add\_action( 'wcal\_clear\_carts', array( 'Wcal\_Delete\_Handler', 'wcal\_delete\_abandoned\_carts\_after\_x\_days' ) ); |
| [242](#L242) | } |
| [243](#L243) |  |
| [244](#L244) | if ( is\_admin() ) { |
| [245](#L245) | add\_action( 'wp\_ajax\_wcal\_preview\_email\_sent', array( &$this, 'wcal\_preview\_email\_sent' ) ); |
| [246](#L246) | add\_action( 'wp\_ajax\_wcal\_toggle\_template\_status', array( &$this, 'wcal\_toggle\_template\_status' ) ); |
| [247](#L247) | add\_action( 'wp\_ajax\_wcal\_abandoned\_cart\_info', array( &$this, 'wcal\_abandoned\_cart\_info' ) ); |
| [248](#L248) | add\_action( 'wp\_ajax\_wcal\_dismiss\_admin\_notice', array( &$this, 'wcal\_dismiss\_admin\_notice' ) ); |
| [249](#L249) | add\_filter( 'pre\_update\_option\_wcal\_auto\_login\_users', array( &$this, 'wcal\_update\_admin\_notice\_value' ), 10, 2 ); |
| [250](#L250) |  |
| [251](#L251) | add\_action( 'wp\_ajax\_wcal\_json\_find\_coupons', array( &$this, 'wcal\_json\_find\_coupons' ) ); |
| [252](#L252) | } |
| [253](#L253) |  |
| [254](#L254) | // Plugin Settings link in WP->Plugins page. |
| [255](#L255) | $plugin = plugin\_basename( \_\_FILE\_\_ ); |
| [256](#L256) | add\_action( "plugin\_action\_links\_$plugin", array( &$this, 'wcal\_settings\_link' ) ); |
| [257](#L257) |  |
| [258](#L258) | add\_action( 'admin\_init', array( $this, 'wcal\_preview\_emails' ) ); |
| [259](#L259) | add\_action( 'init', array( $this, 'wcal\_app\_output\_buffer' ) ); |
| [260](#L260) |  |
| [261](#L261) | add\_filter( 'admin\_footer\_text', array( $this, 'wcal\_admin\_footer\_text' ), 1 ); |
| [262](#L262) |  |
| [263](#L263) | add\_action( 'admin\_notices', array( 'Wcal\_Admin\_Notice', 'wcal\_show\_db\_update\_notice' ) ); |
| [264](#L264) | add\_action( 'admin\_notices', array( 'Wcal\_Admin\_Notice', 'wcal\_show\_auto\_loggin\_notice' ) ); |
| [265](#L265) |  |
| [266](#L266) | include\_once 'includes/frontend/class-wcal-frontend.php'; |
| [267](#L267) |  |
| [268](#L268) | add\_filter( 'cron\_schedules', array( \_\_CLASS\_\_, 'wcal\_add\_cron\_schedule' ) ); //phpcs:ignore |
| [269](#L269) | add\_action( 'woocommerce\_ac\_delete\_coupon\_action', array( \_\_CLASS\_\_, 'wcal\_delete\_expired\_used\_coupon\_code' ) ); |
| [270](#L270) | add\_action( 'wp\_ajax\_wcal\_delete\_expired\_used\_coupon\_code', array( \_\_CLASS\_\_, 'wcal\_delete\_expired\_used\_coupon\_code' ) ); |
| [271](#L271) |  |
| [272](#L272) | add\_action( 'woocommerce\_coupon\_error', array( 'wcal\_common', 'wcal\_capture\_coupon\_error' ), 15, 2 ); |
| [273](#L273) | add\_action( 'woocommerce\_applied\_coupon', array( 'wcal\_common', 'wcal\_capture\_applied\_coupon' ), 15, 2 ); |
| [274](#L274) |  |
| [275](#L275) | add\_action( 'woocommerce\_before\_cart\_table', array( 'wcal\_common', 'wcal\_apply\_direct\_coupon\_code' ) ); |
| [276](#L276) | // Add coupon when user views checkout page (would not be added otherwise, unless user views cart first). |
| [277](#L277) | add\_action( 'woocommerce\_before\_checkout\_form', array( 'wcal\_common', 'wcal\_apply\_direct\_coupon\_code' ) ); |
| [278](#L278) | add\_filter( 'woocommerce\_email\_from\_address', array( \_\_CLASS\_\_, 'wcal\_from\_address\_for\_emails' ), 10, 2 ); |
| [279](#L279) | add\_filter( 'woocommerce\_email\_from\_name', array( \_\_CLASS\_\_, 'wcal\_from\_name\_for\_emails' ), 10, 2 ); |
| [280](#L280) | // 5.14.0 |
| [281](#L281) | if ( 'yes' === get\_option( 'wcal\_guest\_users\_manual\_reset\_needed', '' ) ) { |
| [282](#L282) | add\_action( 'admin\_notices', array( 'Wcal\_Update', 'wcal\_add\_notice' ) ); |
| [283](#L283) | } |
| [284](#L284) | // 5.15.0 |
| [285](#L285) | add\_action( 'wp\_login', array( &$this, 'wcal\_populate\_wc\_session' ) ); |
| [286](#L286) | if ( '' === get\_option( 'wcal\_auto\_login\_users', '' ) ) { |
| [287](#L287) | add\_filter( 'woocommerce\_login\_redirect', array( &$this, 'ts\_redirect\_login' ), 10, 1 ); |
| [288](#L288) | } |
| [289](#L289) |  |
| [290](#L290) | // 5.20.0 - Deactivation and Tracking v2. |
| [291](#L291) | add\_action( 'admin\_init', array( &$this, 'wcal\_include\_files\_tracking' ) ); |
| [292](#L292) | } |
| [293](#L293) |  |
| [294](#L294) | /\*\* |
| [295](#L295) | \* Include tracking & deactivation survey files. |
| [296](#L296) | \*/ |
| [297](#L297) | public static function wcal\_include\_files\_tracking() { |
| [298](#L298) | if ( strpos( $\_SERVER['REQUEST\_URI'], 'plugins.php' ) !== false || strpos( $\_SERVER['REQUEST\_URI'], 'action=deactivate' ) !== false || ( strpos( $\_SERVER['REQUEST\_URI'], 'admin-ajax.php' ) !== false && isset( $\_POST['action'] ) && $\_POST['action'] === 'tyche\_plugin\_deactivation\_submit\_action' ) ) { //phpcs:ignore |
| [299](#L299) | require\_once WCAL\_PLUGIN\_PATH . '/includes/component/plugin-deactivation/class-tyche-plugin-deactivation.php'; |
| [300](#L300) |  |
| [301](#L301) | new Tyche\_Plugin\_Deactivation( |
| [302](#L302) | array( |
| [303](#L303) | 'plugin\_name'       => 'Abandoned Cart Lite for WooCommerce', |
| [304](#L304) | 'plugin\_base'       => 'woocommerce-abandoned-cart/woocommerce-ac.php', |
| [305](#L305) | 'script\_file'       => WCAL\_PLUGIN\_URL . '/assets/js/admin/plugin-deactivation.js', |
| [306](#L306) | 'plugin\_short\_name' => 'acp\_lite', |
| [307](#L307) | 'version'           => WCAL\_PLUGIN\_VERSION, |
| [308](#L308) | 'plugin\_locale'     => 'woocommerce-abandoned-cart', |
| [309](#L309) | ) |
| [310](#L310) | ); |
| [311](#L311) | } |
| [312](#L312) | // Tracking v2 files. |
| [313](#L313) | require\_once WCAL\_PLUGIN\_PATH . '/includes/component/plugin-tracking/class-tyche-plugin-tracking.php'; |
| [314](#L314) | new Tyche\_Plugin\_Tracking( |
| [315](#L315) | array( |
| [316](#L316) | 'plugin\_name'       => 'Abandoned Cart Lite for WooCommerce', |
| [317](#L317) | 'plugin\_locale'     => 'woocommerce-abandoned-cart', |
| [318](#L318) | 'plugin\_short\_name' => 'wcal', |
| [319](#L319) | 'version'           => WCAL\_PLUGIN\_VERSION, |
| [320](#L320) | 'blog\_link'         => 'https://www.tychesoftwares.com/abandoned-cart-lite-usage-tracking/', |
| [321](#L321) | ) |
| [322](#L322) | ); |
| [323](#L323) | require\_once WCAL\_PLUGIN\_PATH . '/includes/class-wcal-data-tracking.php'; |
| [324](#L324) | } |
| [325](#L325) | /\*\* |
| [326](#L326) | \* Action Scheduler library load failed. So add an admin notice. |
| [327](#L327) | \* |
| [328](#L328) | \* @since 5.9.0 |
| [329](#L329) | \*/ |
| [330](#L330) | public static function wcal\_as\_failed\_notice() { |
| [331](#L331) | $as\_link = "<a href='https://www.tychesoftwares.com/moving-to-the-action-scheduler-library/' target='\_blank'>Action Scheduler library</a>"; |
| [332](#L332) | ?> |
| [333](#L333) | <div class="notice notice-error"> |
| [334](#L334) | <p> |
| [335](#L335) | <?php |
| [336](#L336) | echo wp\_kses\_post( \_\_( "Abandoned Cart Lite for WooCommerce was unable to load the $as\_link. Please ensure you are running WooCommerce 4.0.0 or higher to send automated reminder emails. Currrently no automated reminder emails are being sent for abandoned carts.", 'woocommerce-abandoned-cart' ) ); // phpcs:ignore |
| [337](#L337) | ?> |
| [338](#L338) | </p> |
| [339](#L339) | </div> |
| [340](#L340) | <?php |
| [341](#L341) | } |
| [342](#L342) |  |
| [343](#L343) | /\*\* |
| [344](#L344) | \* Add Recurring Scheduled Action. |
| [345](#L345) | \*/ |
| [346](#L346) | public static function wcal\_add\_scheduled\_action() { |
| [347](#L347) | if ( function\_exists( 'as\_next\_scheduled\_action' ) ) { |
| [348](#L348) | if ( false === as\_next\_scheduled\_action( 'woocommerce\_ac\_send\_email\_action' ) ) { |
| [349](#L349) | wp\_clear\_scheduled\_hook( 'woocommerce\_ac\_send\_email\_action' ); // Remove the cron job is present. |
| [350](#L350) | as\_schedule\_recurring\_action( time() + 60, 900, 'woocommerce\_ac\_send\_email\_action' ); // Schedule recurring action. |
| [351](#L351) | } |
| [352](#L352) | } |
| [353](#L353) | } |
| [354](#L354) |  |
| [355](#L355) | /\*\* |
| [356](#L356) | \* Add Settings link to WP->Plugins page. |
| [357](#L357) | \* |
| [358](#L358) | \* @param array $links - Links to be displayed. |
| [359](#L359) | \* @return array $links - Includes custom links. |
| [360](#L360) | \* @since 5.3.0 |
| [361](#L361) | \*/ |
| [362](#L362) | public static function wcal\_settings\_link( $links ) { |
| [363](#L363) | $settings\_link = '<a href="admin.php?page=woocommerce\_ac\_page&action=emailsettings">' . \_\_( 'Settings', 'woocommerce-abandoned-cart' ) . '</a>'; |
| [364](#L364) | array\_push( $links, $settings\_link ); |
| [365](#L365) | return $links; |
| [366](#L366) | } |
| [367](#L367) |  |
| [368](#L368) | /\*\* |
| [369](#L369) | \* It will load the boilerplate components file. In this file we have included all boilerplate files. |
| [370](#L370) | \* We need to inlcude this file after the init hook. |
| [371](#L371) | \* |
| [372](#L372) | \* @hook init |
| [373](#L373) | \*/ |
| [374](#L374) | public static function wcal\_add\_component\_file() { |
| [375](#L375) | if ( is\_admin() ) { |
| [376](#L376) | if ( file\_exists( plugin\_dir\_path( \_\_FILE\_\_ ) . 'includes/class-wcal-all-component.php' ) ) { |
| [377](#L377) | require\_once 'includes/class-wcal-all-component.php'; |
| [378](#L378) | } |
| [379](#L379) | } |
| [380](#L380) | } |
| [381](#L381) |  |
| [382](#L382) | /\*\* |
| [383](#L383) | \* Replace Merge tags in email previews. |
| [384](#L384) | \* |
| [385](#L385) | \* @param string $content - Email content. |
| [386](#L386) | \* @return string $content - content with cart data. |
| [387](#L387) | \* @since 5.8 |
| [388](#L388) | \*/ |
| [389](#L389) | public function replace\_mergetags( $content ) { |
| [390](#L390) |  |
| [391](#L391) | $admin\_args = array( |
| [392](#L392) | 'role'   => 'administrator', |
| [393](#L393) | 'fields' => array( 'id' ), |
| [394](#L394) | ); |
| [395](#L395) |  |
| [396](#L396) | $admin\_usr   = get\_users( $admin\_args ); |
| [397](#L397) | $uid         = $admin\_usr[0]->id; |
| [398](#L398) | $admin\_phone = get\_user\_meta( $uid, 'billing\_phone', true ); |
| [399](#L399) |  |
| [400](#L400) | $wcal\_price       = wc\_price( '150' ); |
| [401](#L401) | $wcal\_total\_price = wc\_price( '300' ); |
| [402](#L402) |  |
| [403](#L403) | $allowed\_html                  = array( |
| [404](#L404) | 'span' => array( |
| [405](#L405) | 'class' => array(), |
| [406](#L406) | ), |
| [407](#L407) | ); |
| [408](#L408) | $spectre\_img\_src               = esc\_url( plugins\_url( '/assets/images/spectre.jpg', \_\_FILE\_\_ ) ); |
| [409](#L409) | $replace\_data['products\_cart'] = "<table border='0' width='100%' cellspacing='0' cellpadding='0'><b>Your Shopping Cart</b> |
| [410](#L410) | <tbody> |
| [411](#L411) | <tr> |
| [412](#L412) | <td style='background-color: #666666; color: #ffffff; text-align: center; font-size: 13px; text-transform: uppercase; padding: 5px;' align='center' bgcolor='#666666'></td> |
| [413](#L413) |  |
| [414](#L414) | <td style='background-color: #666666; color: #ffffff; text-align: center; font-size: 13px; text-transform: uppercase; padding: 5px;' align='center' bgcolor='#666666'>Product</td> |
| [415](#L415) |  |
| [416](#L416) | <td style='background-color: #666666; color: #ffffff; text-align: center; font-size: 13px; text-transform: uppercase; padding: 5px;' align='center' bgcolor='#666666'>Price</td> |
| [417](#L417) |  |
| [418](#L418) | <td style='background-color: #666666; color: #ffffff; text-align: center; font-size: 13px; text-transform: uppercase; padding: 5px;' align='center' bgcolor='#666666'>Quantity</td> |
| [419](#L419) |  |
| [420](#L420) | <td style='background-color: #666666; color: #ffffff; text-align: center; font-size: 13px; text-transform: uppercase; padding: 5px;' align='center' bgcolor='#666666'>Total</td> |
| [421](#L421) |  |
| [422](#L422) | </tr> |
| [423](#L423) | <tr style='background-color:#f4f5f4;'> |
| [424](#L424) | <td><img src = '$spectre\_img\_src' height='40px' width='40px'></td><td>Spectre</td><td>" . wp\_kses( $wcal\_price, $allowed\_html ) . '</td><td>2</td><td>' . wp\_kses( $wcal\_total\_price, $allowed\_html ) . '</td> |
| [425](#L425) | </tr> |
| [426](#L426) | <tr> |
| [427](#L427) | <td>&nbsp;</td> |
| [428](#L428) | <td>&nbsp;</td> |
| [429](#L429) | <td>&nbsp;</td> |
| [430](#L430) | <th>Cart Total:</th> |
| [431](#L431) | <td>' . wp\_kses( $wcal\_total\_price, $allowed\_html ) . '</td> |
| [432](#L432) | </tr> |
| [433](#L433) |  |
| [434](#L434) | </tbody> |
| [435](#L435) | </table>'; |
| [436](#L436) |  |
| [437](#L437) | $current\_time = current\_time( 'timestamp' ); // phpcs:ignore |
| [438](#L438) | $date\_format  = date\_i18n( get\_option( 'date\_format' ), $current\_time ); |
| [439](#L439) | $time\_format  = date\_i18n( get\_option( 'time\_format' ), $current\_time ); |
| [440](#L440) |  |
| [441](#L441) | $replace\_data['admin\_phone']    = $admin\_phone; |
| [442](#L442) | $replace\_data['site\_title']     = get\_bloginfo( 'name' ); |
| [443](#L443) | $replace\_data['site\_url']       = get\_option( 'siteurl' ); |
| [444](#L444) | $replace\_data['abandoned\_date'] = "$date\_format $time\_format"; |
| [445](#L445) | $replace\_data['cart\_url']       = wc\_get\_page\_permalink( 'cart' ); |
| [446](#L446) |  |
| [447](#L447) | $content = str\_ireplace( '{{products.cart}}', $replace\_data['products\_cart'], $content ); |
| [448](#L448) | $content = str\_ireplace( '{{admin.phone}}', $replace\_data['admin\_phone'], $content ); |
| [449](#L449) | $content = str\_ireplace( '{{customer.firstname}}', 'John', $content ); |
| [450](#L450) | $content = str\_ireplace( '{{customer.lastname}}', 'Doe', $content ); |
| [451](#L451) | $content = str\_ireplace( '{{customer.fullname}}', 'John Doe', $content ); |
| [452](#L452) | $content = str\_ireplace( '{{cart.abandoned\_date}}', $replace\_data['abandoned\_date'], $content ); |
| [453](#L453) | $content = str\_ireplace( '{{cart.link}}', $replace\_data['cart\_url'], $content ); |
| [454](#L454) | $content = str\_ireplace( '{{cart.unsubscribe}}', '#', $content ); |
| [455](#L455) | $content = str\_ireplace( 'site\_title', $replace\_data['site\_title'], $content ); |
| [456](#L456) | $content = str\_ireplace( 'site\_url', $replace\_data['site\_url'], $content ); |
| [457](#L457) |  |
| [458](#L458) | return $content; |
| [459](#L459) | } |
| [460](#L460) |  |
| [461](#L461) | /\*\* |
| [462](#L462) | \* It will ganerate the preview email template. |
| [463](#L463) | \* |
| [464](#L464) | \* @hook admin\_init |
| [465](#L465) | \* @globals mixed $woocommerce |
| [466](#L466) | \* @since 2.5 |
| [467](#L467) | \*/ |
| [468](#L468) | public function wcal\_preview\_emails() { |
| [469](#L469) | global $woocommerce; |
| [470](#L470) |  |
| [471](#L471) | if ( isset( $\_GET['wcal\_preview\_woocommerce\_mail'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [472](#L472) | if ( ! current\_user\_can( 'manage\_woocommerce' ) || ! isset( $\_REQUEST['\_wpnonce'] ) || ! wp\_verify\_nonce( sanitize\_text\_field( wp\_unslash( $\_REQUEST['\_wpnonce'] ) ), 'woocommerce-abandoned-cart' ) ) { |
| [473](#L473) | die( 'Security check' ); |
| [474](#L474) | } |
| [475](#L475) | if ( isset( $\_GET['id'] ) && 0 < sanitize\_text\_field( wp\_unslash( $\_GET['id'] ) ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [476](#L476) | global $wpdb; |
| [477](#L477) | $id      = sanitize\_text\_field( wp\_unslash( $\_GET['id'] ) ); // phpcs:ignore WordPress.Security.NonceVerification |
| [478](#L478) | $content = $wpdb->get\_var( // phpcs:ignore |
| [479](#L479) | $wpdb->prepare( |
| [480](#L480) | 'SELECT body FROM `' . $wpdb->prefix . 'ac\_email\_templates\_lite` WHERE id = %d', |
| [481](#L481) | absint( $id ) |
| [482](#L482) | ) |
| [483](#L483) | ); |
| [484](#L484) | $content = $this->replace\_mergetags( $content ); |
| [485](#L485) | } |
| [486](#L486) | $message = ''; |
| [487](#L487) | // create a new email. |
| [488](#L488) | if ( version\_compare( WC\_VERSION, '3.0', '>' ) ) { |
| [489](#L489) |  |
| [490](#L490) | ob\_start(); |
| [491](#L491) | // Get email heading. |
| [492](#L492) | $email\_heading = \_\_( 'Abandoned cart Email Template', 'woocommerce-abandoned-cart' ); |
| [493](#L493) | wc\_get\_template( 'emails/email-header.php', array( 'email\_heading' => $email\_heading ) ); |
| [494](#L494) | $email\_body\_template\_header = ob\_get\_clean(); |
| [495](#L495) |  |
| [496](#L496) | ob\_start(); |
| [497](#L497) | wc\_get\_template( 'emails/email-footer.php' ); |
| [498](#L498) | $email\_body\_template\_footer = ob\_get\_clean(); |
| [499](#L499) |  |
| [500](#L500) | $site\_title                 = get\_bloginfo( 'name' ); |
| [501](#L501) | $email\_body\_template\_footer = str\_ireplace( '{site\_title}', $site\_title, $email\_body\_template\_footer ); |
| [502](#L502) |  |
| [503](#L503) | ob\_start(); |
| [504](#L504) | if ( isset( $\_GET['id'] ) && 0 < sanitize\_text\_field( wp\_unslash( $\_GET['id'] ) ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [505](#L505) | $message = stripslashes( $content ); |
| [506](#L506) | } else { |
| [507](#L507) | include 'views/wcal-wc-email-template-preview.php'; |
| [508](#L508) | $message = ob\_get\_clean(); |
| [509](#L509) | } |
| [510](#L510) | $message = $email\_body\_template\_header . $message . $email\_body\_template\_footer; |
| [511](#L511) | } |
| [512](#L512) | echo $message; // phpcs:ignore |
| [513](#L513) | exit; |
| [514](#L514) | } |
| [515](#L515) |  |
| [516](#L516) | if ( isset( $\_GET['wcal\_preview\_mail'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [517](#L517) | if ( ! current\_user\_can( 'manage\_woocommerce' ) || ! isset( $\_REQUEST['\_wpnonce'] ) || ! wp\_verify\_nonce( sanitize\_text\_field( wp\_unslash( $\_REQUEST['\_wpnonce'] ) ), 'woocommerce-abandoned-cart' ) ) { |
| [518](#L518) | die( 'Security check' ); |
| [519](#L519) | } |
| [520](#L520) | if ( isset( $\_GET['id'] ) && 0 < sanitize\_text\_field( wp\_unslash( $\_GET['id'] ) ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [521](#L521) | global $wpdb; |
| [522](#L522) | $id      = sanitize\_text\_field( wp\_unslash( $\_GET['id'] ) ); // phpcs:ignore WordPress.Security.NonceVerification |
| [523](#L523) | $content = $wpdb->get\_var( // phpcs:ignore |
| [524](#L524) | $wpdb->prepare( |
| [525](#L525) | 'SELECT body FROM `' . $wpdb->prefix . 'ac\_email\_templates\_lite` WHERE id = %d', |
| [526](#L526) | absint( $id ) |
| [527](#L527) | ) |
| [528](#L528) | ); |
| [529](#L529) | $content = $this->replace\_mergetags( $content ); |
| [530](#L530) | } |
| [531](#L531) | // get the preview email content. |
| [532](#L532) | ob\_start(); |
| [533](#L533) | if ( isset( $\_GET['id'] ) && 0 < sanitize\_text\_field( wp\_unslash( $\_GET['id'] ) ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [534](#L534) | $message = stripslashes( $content ); |
| [535](#L535) | } else { |
| [536](#L536) | include\_once 'views/wcal-email-template-preview.php'; |
| [537](#L537) | $message = ob\_get\_clean(); |
| [538](#L538) | } |
| [539](#L539) | // print the preview email. |
| [540](#L540) | echo $message; // phpcs:ignore |
| [541](#L541) | exit; |
| [542](#L542) | } |
| [543](#L543) | } |
| [544](#L544) |  |
| [545](#L545) | /\*\* |
| [546](#L546) | \* In this version we have allowed customer to transalte the plugin string using .po and .pot file. |
| [547](#L547) | \* |
| [548](#L548) | \* @hook init |
| [549](#L549) | \* @return $loaded |
| [550](#L550) | \* @since 1.6 |
| [551](#L551) | \*/ |
| [552](#L552) | public function wcal\_update\_po\_file() { |
| [553](#L553) | /\* |
| [554](#L554) | \* Due to the introduction of language packs through translate.wordpress.org, loading our textdomain is complex. |
| [555](#L555) | \* |
| [556](#L556) | \* In v4.7, our textdomain changed from "woocommerce-ac" to "woocommerce-abandoned-cart". |
| [557](#L557) | \*/ |
| [558](#L558) | $domain = 'woocommerce-abandoned-cart'; |
| [559](#L559) | $locale = apply\_filters( 'plugin\_locale', get\_locale(), $domain ); |
| [560](#L560) | $loaded = load\_textdomain( $domain, trailingslashit( WP\_LANG\_DIR ) . $domain . '-' . $locale . '.mo' ); |
| [561](#L561) | if ( $loaded ) { |
| [562](#L562) | return $loaded; |
| [563](#L563) | } else { |
| [564](#L564) | load\_plugin\_textdomain( $domain, false, basename( dirname( \_\_FILE\_\_ ) ) . '/i18n/languages/' ); |
| [565](#L565) | } |
| [566](#L566) | } |
| [567](#L567) |  |
| [568](#L568) | /\*\* |
| [569](#L569) | \* It will create the plugin tables & the options reqired for plugin. |
| [570](#L570) | \* |
| [571](#L571) | \* @hook register\_activation\_hook |
| [572](#L572) | \* @globals mixed $wpdb |
| [573](#L573) | \* @since 1.0 |
| [574](#L574) | \*/ |
| [575](#L575) | public static function wcal\_activate() { |
| [576](#L576) |  |
| [577](#L577) | // check whether its a multi site install or a single site install. |
| [578](#L578) | if ( is\_multisite() ) { |
| [579](#L579) |  |
| [580](#L580) | $blog\_list = get\_sites(); |
| [581](#L581) | foreach ( $blog\_list as $blog\_list\_key => $blog\_list\_value ) { |
| [582](#L582) | if ( $blog\_list\_value->blog\_id > 1 ) { // child sites. |
| [583](#L583) | $blog\_id = $blog\_list\_value->blog\_id; |
| [584](#L584) | self::wcal\_process\_activate( $blog\_id ); |
| [585](#L585) | add\_blog\_option( $blog\_id, 'wcal\_db\_version', WCAL\_PLUGIN\_VERSION ); |
| [586](#L586) | } else { // parent site. |
| [587](#L587) | self::wcal\_process\_activate(); |
| [588](#L588) | add\_blog\_option( 1, 'wcal\_db\_version', WCAL\_PLUGIN\_VERSION ); |
| [589](#L589) | } |
| [590](#L590) | } |
| [591](#L591) | } else { // single site. |
| [592](#L592) | self::wcal\_process\_activate(); |
| [593](#L593) | add\_option( 'wcal\_db\_version', WCAL\_PLUGIN\_VERSION ); |
| [594](#L594) | } |
| [595](#L595) | } |
| [596](#L596) |  |
| [597](#L597) | /\*\* |
| [598](#L598) | \* Things to do when the plugin is deactivated. |
| [599](#L599) | \* |
| [600](#L600) | \* @since 5.8.0 |
| [601](#L601) | \*/ |
| [602](#L602) | public static function wcal\_deactivate() { |
| [603](#L603) | if ( false !== as\_next\_scheduled\_action( 'woocommerce\_ac\_send\_email\_action' ) ) { |
| [604](#L604) | as\_unschedule\_action( 'woocommerce\_ac\_send\_email\_action' ); // Remove the scheduled action. |
| [605](#L605) | } |
| [606](#L606) | $next\_scheduled = wp\_next\_scheduled( 'wcal\_ts\_tracker\_send\_event' ); |
| [607](#L607) | if ( $next\_scheduled ) { |
| [608](#L608) | wp\_unschedule\_event( $next\_scheduled, 'wcal\_ts\_tracker\_send\_event' ); |
| [609](#L609) | } |
| [610](#L610) | do\_action( 'wcal\_deactivate' ); |
| [611](#L611) | } |
| [612](#L612) | /\*\* |
| [613](#L613) | \* Sets the compatibility with Woocommerce HPOS. |
| [614](#L614) | \* |
| [615](#L615) | \* @since 5.14.2 |
| [616](#L616) | \*/ |
| [617](#L617) | public static function wcal\_custom\_order\_tables\_compatibility() { |
| [618](#L618) |  |
| [619](#L619) | if ( class\_exists( '\Automattic\WooCommerce\Utilities\FeaturesUtil' ) ) { |
| [620](#L620) | \Automattic\WooCommerce\Utilities\FeaturesUtil::declare\_compatibility( 'custom\_order\_tables', 'woocommerce-abandoned-cart/woocommerce-ac.php', true ); |
| [621](#L621) | \Automattic\WooCommerce\Utilities\FeaturesUtil::declare\_compatibility( 'orders\_cache', 'woocommerce-abandoned-cart/woocommerce-ac.php', true ); |
| [622](#L622) | } |
| [623](#L623) | } |
| [624](#L624) |  |
| [625](#L625) | /\*\* |
| [626](#L626) | \* Activation code: Create tables, default settings etc. |
| [627](#L627) | \* |
| [628](#L628) | \* @param int $blog\_id - Greater than 0 for subsites in a multisite install, 0 for single sites. |
| [629](#L629) | \*/ |
| [630](#L630) | public static function wcal\_process\_activate( $blog\_id = 0 ) { |
| [631](#L631) | global $wpdb; |
| [632](#L632) |  |
| [633](#L633) | $db\_prefix = ( 0 === $blog\_id ) ? $wpdb->prefix : $wpdb->prefix . $blog\_id . '\_'; |
| [634](#L634) |  |
| [635](#L635) | $wcap\_collate = ''; |
| [636](#L636) | if ( $wpdb->has\_cap( 'collation' ) ) { |
| [637](#L637) | $wcap\_collate = $wpdb->get\_charset\_collate(); |
| [638](#L638) | } |
| [639](#L639) | $table\_name = $db\_prefix . 'ac\_email\_templates\_lite'; |
| [640](#L640) | $wpdb->query( // phpcs:ignore |
| [641](#L641) | "CREATE TABLE IF NOT EXISTS $table\_name ( |
| [642](#L642) | `id` int(11) NOT NULL AUTO\_INCREMENT, |
| [643](#L643) | `email\_type` varchar(50) NOT NULL, |
| [644](#L644) | `subject` text NOT NULL, |
| [645](#L645) | `body` mediumtext NOT NULL, |
| [646](#L646) | `is\_active` enum('0','1') NOT NULL, |
| [647](#L647) | `frequency` int(11) NOT NULL, |
| [648](#L648) | `day\_or\_hour` enum('Days','Hours','Minutes') NOT NULL, |
| [649](#L649) | `template\_name` text NOT NULL, |
| [650](#L650) | `is\_wc\_template` enum('0','1') NOT NULL, |
| [651](#L651) | `default\_template` int(11) NOT NULL, |
| [652](#L652) | `wc\_email\_header` varchar(50) NOT NULL, |
| [653](#L653) | `coupon\_code` varchar(50)  NOT NULL, |
| [654](#L654) | `discount` varchar(50)  NOT NULL, |
| [655](#L655) | `discount\_type` varchar(50)  NOT NULL, |
| [656](#L656) | `discount\_shipping` varchar(50)  NOT NULL, |
| [657](#L657) | `discount\_expiry` varchar(50) NOT NULL, |
| [658](#L658) | `individual\_use` enum('0','1') NOT NULL, |
| [659](#L659) | `generate\_unique\_coupon\_code` enum('0','1') NOT NULL, |
| [660](#L660) | PRIMARY KEY (`id`) |
| [661](#L661) | ) $wcap\_collate AUTO\_INCREMENT=1" // phpcs:ignore |
| [662](#L662) | ); |
| [663](#L663) |  |
| [664](#L664) | $sent\_table\_name = $db\_prefix . 'ac\_sent\_history\_lite'; |
| [665](#L665) | $wpdb->query( // phpcs:ignore |
| [666](#L666) | "CREATE TABLE IF NOT EXISTS $sent\_table\_name ( |
| [667](#L667) | `id` int(11) NOT NULL auto\_increment, |
| [668](#L668) | `template\_id` varchar(40) collate utf8\_unicode\_ci NOT NULL, |
| [669](#L669) | `abandoned\_order\_id` int(11) NOT NULL, |
| [670](#L670) | `sent\_time` datetime NOT NULL, |
| [671](#L671) | `sent\_email\_id` text COLLATE utf8\_unicode\_ci NOT NULL, |
| [672](#L672) | `encrypt\_key` varchar(500) COLLATE utf8\_unicode\_ci NOT NULL, |
| [673](#L673) | PRIMARY KEY  (`id`) |
| [674](#L674) | ) $wcap\_collate AUTO\_INCREMENT=1 " // phpcs:ignore |
| [675](#L675) | ); |
| [676](#L676) |  |
| [677](#L677) | $ac\_history\_table\_name = $db\_prefix . 'ac\_abandoned\_cart\_history\_lite'; |
| [678](#L678) | $wpdb->query( // phpcs:ignore |
| [679](#L679) | "CREATE TABLE IF NOT EXISTS $ac\_history\_table\_name ( |
| [680](#L680) | `id` int(11) NOT NULL AUTO\_INCREMENT, |
| [681](#L681) | `user\_id` int(11) NOT NULL, |
| [682](#L682) | `abandoned\_cart\_info` text COLLATE utf8\_unicode\_ci NOT NULL, |
| [683](#L683) | `abandoned\_cart\_time` int(11) NOT NULL, |
| [684](#L684) | `cart\_ignored` enum('0','1') COLLATE utf8\_unicode\_ci NOT NULL, |
| [685](#L685) | `recovered\_cart` int(11) NOT NULL, |
| [686](#L686) | `user\_type` text, |
| [687](#L687) | `unsubscribe\_link` enum('0','1') COLLATE utf8\_unicode\_ci NOT NULL, |
| [688](#L688) | `session\_id` varchar(50) COLLATE utf8\_unicode\_ci NOT NULL, |
| [689](#L689) | `email\_reminder\_status` varchar(50) COLLATE utf8\_unicode\_ci NOT NULL, |
| [690](#L690) | `checkout\_link` varchar(500) COLLATE utf8\_unicode\_ci NOT NULL, |
| [691](#L691) | PRIMARY KEY (`id`) |
| [692](#L692) | ) $wcap\_collate" // phpcs:ignore |
| [693](#L693) | ); |
| [694](#L694) |  |
| [695](#L695) | $guest\_table        = $db\_prefix . 'ac\_guest\_abandoned\_cart\_history\_lite'; |
| [696](#L696) | $result\_guest\_table = $wpdb->get\_results( // phpcs:ignore |
| [697](#L697) | "SHOW TABLES LIKE '$guest\_table'" // phpcs:ignore |
| [698](#L698) | ); |
| [699](#L699) |  |
| [700](#L700) | if ( 0 === count( $result\_guest\_table ) ) { |
| [701](#L701) | $ac\_guest\_history\_table\_name = $db\_prefix . 'ac\_guest\_abandoned\_cart\_history\_lite'; |
| [702](#L702) | $wpdb->query( // phpcs:ignore |
| [703](#L703) | "CREATE TABLE IF NOT EXISTS $ac\_guest\_history\_table\_name ( |
| [704](#L704) | `id` int(15) NOT NULL AUTO\_INCREMENT, |
| [705](#L705) | `billing\_first\_name` text, |
| [706](#L706) | `billing\_last\_name` text, |
| [707](#L707) | `billing\_company\_name` text, |
| [708](#L708) | `billing\_address\_1` text, |
| [709](#L709) | `billing\_address\_2` text, |
| [710](#L710) | `billing\_city` text, |
| [711](#L711) | `billing\_county` text, |
| [712](#L712) | `billing\_zipcode` text, |
| [713](#L713) | `email\_id` text, |
| [714](#L714) | `phone` text, |
| [715](#L715) | `ship\_to\_billing` text, |
| [716](#L716) | `order\_notes` text, |
| [717](#L717) | `shipping\_first\_name` text, |
| [718](#L718) | `shipping\_last\_name` text, |
| [719](#L719) | `shipping\_company\_name` text, |
| [720](#L720) | `shipping\_address\_1` text, |
| [721](#L721) | `shipping\_address\_2` text, |
| [722](#L722) | `shipping\_city` text, |
| [723](#L723) | `shipping\_county` text, |
| [724](#L724) | `shipping\_zipcode` double, |
| [725](#L725) | `shipping\_charges` double, |
| [726](#L726) | PRIMARY KEY (`id`) |
| [727](#L727) | ) $wcap\_collate AUTO\_INCREMENT=63000000" // phpcs:ignore |
| [728](#L728) | ); |
| [729](#L729) | } |
| [730](#L730) |  |
| [731](#L731) | $wcal\_guest\_user\_id\_altered = 0 === $blog\_id ? get\_option( 'wcal\_guest\_user\_id\_altered' ) : get\_blog\_option( $blog\_id, 'wcal\_guest\_user\_id\_altered' ); |
| [732](#L732) |  |
| [733](#L733) | // Alter Guest Table A\_I value if needed. |
| [734](#L734) | if ( 'yes' !== $wcal\_guest\_user\_id\_altered ) { |
| [735](#L735) | Wcal\_Update::wcal\_reset\_guest\_user\_id( $db\_prefix, $blog\_id, 1 ); |
| [736](#L736) | } |
| [737](#L737) | // Default templates - function call to create default templates. |
| [738](#L738) | $check\_table\_empty = $wpdb->get\_var( 'SELECT COUNT(\*) FROM `' . $db\_prefix . 'ac\_email\_templates\_lite`' ); // phpcs:ignore |
| [739](#L739) |  |
| [740](#L740) | /\*\* |
| [741](#L741) | \* This is add for thos user who Install the plguin first time. |
| [742](#L742) | \* So for them this option will be cheked. |
| [743](#L743) | \*/ |
| [744](#L744) | if ( 0 === $blog\_id ) { |
| [745](#L745) | if ( ! get\_option( 'wcal\_new\_default\_templates' ) ) { |
| [746](#L746) | if ( 0 === (int) $check\_table\_empty ) { |
| [747](#L747) | $default\_template = new Wcal\_Default\_Template\_Settings(); |
| [748](#L748) | $default\_template->wcal\_create\_default\_templates( $db\_prefix, $blog\_id ); |
| [749](#L749) | } |
| [750](#L750) | } |
| [751](#L751) | if ( ! get\_option( 'ac\_lite\_cart\_abandoned\_time' ) ) { |
| [752](#L752) | add\_option( 'ac\_lite\_cart\_abandoned\_time', 10 ); |
| [753](#L753) | } |
| [754](#L754) | if ( ! get\_option( 'ac\_lite\_track\_guest\_cart\_from\_cart\_page' ) ) { |
| [755](#L755) | add\_option( 'ac\_lite\_track\_guest\_cart\_from\_cart\_page', 'on' ); |
| [756](#L756) | } |
| [757](#L757) | if ( ! get\_option( 'wcal\_from\_name' ) ) { |
| [758](#L758) | add\_option( 'wcal\_from\_name', 'Admin' ); |
| [759](#L759) | } |
| [760](#L760) | $wcal\_get\_admin\_email = get\_option( 'admin\_email' ); |
| [761](#L761) | if ( ! get\_option( 'wcal\_from\_email' ) ) { |
| [762](#L762) | add\_option( 'wcal\_from\_email', $wcal\_get\_admin\_email ); |
| [763](#L763) | } |
| [764](#L764) |  |
| [765](#L765) | if ( ! get\_option( 'wcal\_reply\_email' ) ) { |
| [766](#L766) | add\_option( 'wcal\_reply\_email', $wcal\_get\_admin\_email ); |
| [767](#L767) | } |
| [768](#L768) | if ( ! get\_option( 'wcal\_auto\_login\_users' ) ) { |
| [769](#L769) | add\_option( 'wcal\_auto\_login\_users', '' ); |
| [770](#L770) | } |
| [771](#L771) | } else { |
| [772](#L772) | if ( ! get\_blog\_option( $blog\_id, 'wcal\_new\_default\_templates' ) ) { |
| [773](#L773) | if ( 0 === $check\_table\_empty ) { |
| [774](#L774) | $default\_template = new Wcal\_Default\_Template\_Settings(); |
| [775](#L775) | $default\_template->wcal\_create\_default\_templates( $db\_prefix, $blog\_id ); |
| [776](#L776) | } |
| [777](#L777) | } |
| [778](#L778) | if ( ! get\_blog\_option( $blog\_id, 'ac\_lite\_cart\_abandoned\_time' ) ) { |
| [779](#L779) | add\_blog\_option( $blog\_id, 'ac\_lite\_cart\_abandoned\_time', 10 ); |
| [780](#L780) | } |
| [781](#L781) | if ( ! get\_blog\_option( $blog\_id, 'ac\_lite\_track\_guest\_cart\_from\_cart\_page' ) ) { |
| [782](#L782) | add\_blog\_option( $blog\_id, 'ac\_lite\_track\_guest\_cart\_from\_cart\_page', 'on' ); |
| [783](#L783) | } |
| [784](#L784) | if ( ! get\_blog\_option( $blog\_id, 'wcal\_from\_name' ) ) { |
| [785](#L785) | add\_blog\_option( $blog\_id, 'wcal\_from\_name', 'Admin' ); |
| [786](#L786) | } |
| [787](#L787) | $wcal\_get\_admin\_email = get\_option( 'admin\_email' ); |
| [788](#L788) | if ( ! get\_blog\_option( $blog\_id, 'wcal\_from\_email' ) ) { |
| [789](#L789) | add\_blog\_option( $blog\_id, 'wcal\_from\_email', $wcal\_get\_admin\_email ); |
| [790](#L790) | } |
| [791](#L791) |  |
| [792](#L792) | if ( ! get\_blog\_option( $blog\_id, 'wcal\_reply\_email' ) ) { |
| [793](#L793) | add\_blog\_option( $blog\_id, 'wcal\_reply\_email', $wcal\_get\_admin\_email ); |
| [794](#L794) | } |
| [795](#L795) | if ( ! get\_blog\_option( $blog\_id, 'wcal\_auto\_login\_users' ) ) { |
| [796](#L796) | add\_blog\_option( $blog\_id, 'wcal\_auto\_login\_users', '' ); |
| [797](#L797) | } |
| [798](#L798) | } |
| [799](#L799) | do\_action( 'wcal\_activate' ); |
| [800](#L800) | } |
| [801](#L801) |  |
| [802](#L802) | /\*\* |
| [803](#L803) | \* It will add the section, field, & registres the plugin fields using Settings API. |
| [804](#L804) | \* |
| [805](#L805) | \* @hook admin\_init |
| [806](#L806) | \* @since 2.5 |
| [807](#L807) | \*/ |
| [808](#L808) | public function wcal\_initialize\_plugin\_options() { |
| [809](#L809) |  |
| [810](#L810) | // First, we register a section. This is necessary since all future options must belong to a section. |
| [811](#L811) | add\_settings\_section( |
| [812](#L812) | 'ac\_lite\_general\_settings\_section',                 // ID used to identify this section and with which to register options. |
| [813](#L813) | \_\_( 'Cart Abandonment Settings', 'woocommerce-abandoned-cart' ),     // Title to be displayed on the administration page. |
| [814](#L814) | array( $this, 'ac\_lite\_general\_options\_callback' ), // Callback used to render the description of the section. |
| [815](#L815) | 'woocommerce\_ac\_page'                               // Page on which to add this section of options. |
| [816](#L816) | ); |
| [817](#L817) |  |
| [818](#L818) | add\_settings\_field( |
| [819](#L819) | 'wcal\_enable\_cart\_emails', |
| [820](#L820) | \_\_( 'Enable abandoned cart emails', 'woocommerce-abandoned-cart' ), |
| [821](#L821) | array( $this, 'wcal\_enable\_cart\_emails\_callback' ), |
| [822](#L822) | 'woocommerce\_ac\_page', |
| [823](#L823) | 'ac\_lite\_general\_settings\_section', |
| [824](#L824) | array( \_\_( 'Yes, enable the abandoned cart emails.', 'woocommerce-abandoned-cart' ) ) |
| [825](#L825) | ); |
| [826](#L826) |  |
| [827](#L827) | add\_settings\_field( |
| [828](#L828) | 'ac\_lite\_cart\_abandoned\_time', |
| [829](#L829) | \_\_( 'Cart abandoned cut-off time', 'woocommerce-abandoned-cart' ), |
| [830](#L830) | array( $this, 'ac\_lite\_cart\_abandoned\_time\_callback' ), |
| [831](#L831) | 'woocommerce\_ac\_page', |
| [832](#L832) | 'ac\_lite\_general\_settings\_section', |
| [833](#L833) | array( \_\_( 'Consider cart abandoned after X minutes of item being added to cart & order not placed.', 'woocommerce-abandoned-cart' ) ) |
| [834](#L834) | ); |
| [835](#L835) |  |
| [836](#L836) | add\_settings\_field( |
| [837](#L837) | 'ac\_lite\_delete\_abandoned\_order\_days', |
| [838](#L838) | \_\_( 'Automatically Delete Abandoned Orders after X days', 'woocommerce-abandoned-cart' ), |
| [839](#L839) | array( $this, 'wcal\_delete\_abandoned\_orders\_days\_callback' ), |
| [840](#L840) | 'woocommerce\_ac\_page', |
| [841](#L841) | 'ac\_lite\_general\_settings\_section', |
| [842](#L842) | array( \_\_( 'Automatically delete abandoned cart orders after X days.', 'woocommerce-abandoned-cart' ) ) |
| [843](#L843) | ); |
| [844](#L844) |  |
| [845](#L845) | add\_settings\_field( |
| [846](#L846) | 'ac\_lite\_email\_admin\_on\_recovery', |
| [847](#L847) | \_\_( 'Email admin On Order Recovery', 'woocommerce-abandoned-cart' ), |
| [848](#L848) | array( $this, 'ac\_lite\_email\_admin\_on\_recovery' ), |
| [849](#L849) | 'woocommerce\_ac\_page', |
| [850](#L850) | 'ac\_lite\_general\_settings\_section', |
| [851](#L851) | array( \_\_( 'Sends email to Admin if an Abandoned Cart Order is recovered.', 'woocommerce-abandoned-cart' ) ) |
| [852](#L852) | ); |
| [853](#L853) |  |
| [854](#L854) | add\_settings\_field( |
| [855](#L855) | 'ac\_lite\_track\_guest\_cart\_from\_cart\_page', |
| [856](#L856) | \_\_( 'Start tracking from Cart Page', 'woocommerce-abandoned-cart' ), |
| [857](#L857) | array( $this, 'wcal\_track\_guest\_cart\_from\_cart\_page\_callback' ), |
| [858](#L858) | 'woocommerce\_ac\_page', |
| [859](#L859) | 'ac\_lite\_general\_settings\_section', |
| [860](#L860) | array( \_\_( 'Enable tracking of abandoned products & carts even if customer does not visit the checkout page or does not enter any details on the checkout page like Name or Email. Tracking will begin as soon as a visitor adds a product to their cart and visits the cart page.', 'woocommerce-abandoned-cart' ) ) |
| [861](#L861) | ); |
| [862](#L862) |  |
| [863](#L863) | add\_settings\_section( |
| [864](#L864) | 'ac\_lite\_gdpr\_settings',                 // ID used to identify this section and with which to register options. |
| [865](#L865) | \_\_( 'GDPR Settings', 'woocommerce-abandoned-cart' ),     // Title to be displayed on the administration page. |
| [866](#L866) | array( $this, 'ac\_lite\_gdpr\_callback' ), // Callback used to render the description of the section. |
| [867](#L867) | 'woocommerce\_ac\_page'                               // Page on which to add this section of options. |
| [868](#L868) | ); |
| [869](#L869) |  |
| [870](#L870) | add\_settings\_field( |
| [871](#L871) | 'wcal\_enable\_gdpr\_consent', |
| [872](#L872) | \_\_( 'Enable GDPR Notice', 'woocommerce-abandoned-cart' ), |
| [873](#L873) | array( $this, 'wcal\_enable\_gdpr\_callback' ), |
| [874](#L874) | 'woocommerce\_ac\_page', |
| [875](#L875) | 'ac\_lite\_gdpr\_settings', |
| [876](#L876) | array( \_\_( 'Enable this setting to display a notice informing customers that their email and cart data are saved to send abandonment reminders.', 'woocommerce-abandoned-cart' ) ) |
| [877](#L877) | ); |
| [878](#L878) |  |
| [879](#L879) | add\_settings\_field( |
| [880](#L880) | 'wcal\_guest\_cart\_capture\_msg', |
| [881](#L881) | \_\_( 'Message to be displayed for Guest users when tracking their carts', 'woocommerce-abandoned-cart' ), |
| [882](#L882) | array( $this, 'wcal\_guest\_cart\_capture\_msg\_callback' ), |
| [883](#L883) | 'woocommerce\_ac\_page', |
| [884](#L884) | 'ac\_lite\_gdpr\_settings', |
| [885](#L885) | array( \_\_( '<br>In compliance with GDPR, add a message on the Checkout page to inform Guest users of how their data is being used.<br><i>For example: Your email address will help us support your shopping experience throughout the site. Please check our Privacy Policy to see how we use your personal data.</i>', 'woocommerce-abandoned-cart' ) ) |
| [886](#L886) | ); |
| [887](#L887) |  |
| [888](#L888) | add\_settings\_field( |
| [889](#L889) | 'wcal\_logged\_cart\_capture\_msg', |
| [890](#L890) | \_\_( 'Message to be displayed for registered users when tracking their carts.', 'woocommerce-abandoned-cart' ), |
| [891](#L891) | array( $this, 'wcal\_logged\_cart\_capture\_msg\_callback' ), |
| [892](#L892) | 'woocommerce\_ac\_page', |
| [893](#L893) | 'ac\_lite\_gdpr\_settings', |
| [894](#L894) | array( \_\_( '<br>In compliance with GDPR, add a message on the Shop & Product pages to inform Registered users of how their data is being used.<br><i>For example: Please check our Privacy Policy to see how we use your personal data.</i>', 'woocommerce-abandoned-cart' ) ) |
| [895](#L895) | ); |
| [896](#L896) |  |
| [897](#L897) | add\_settings\_field( |
| [898](#L898) | 'wcal\_gdpr\_allow\_opt\_out', |
| [899](#L899) | \_\_( 'Allow the visitor to opt out of cart tracking.', 'woocommerce-abandoned-cart' ), |
| [900](#L900) | array( $this, 'wcal\_gdpr\_allow\_opt\_out\_callback' ), |
| [901](#L901) | 'woocommerce\_ac\_page', |
| [902](#L902) | 'ac\_lite\_gdpr\_settings', |
| [903](#L903) | array( \_\_( '<br>In compliance with GDPR, allow the site visitor (guests & registered users) to opt out from cart tracking. This message will be displayed in conjunction with the GDPR message above.</i>', 'woocommerce-abandoned-cart' ) ) |
| [904](#L904) | ); |
| [905](#L905) |  |
| [906](#L906) | add\_settings\_field( |
| [907](#L907) | 'wcal\_gdpr\_opt\_out\_message', |
| [908](#L908) | \_\_( 'Message to be displayed when the user chooses to opt out of cart tracking.', 'woocommerce-abandoned-cart' ), |
| [909](#L909) | array( $this, 'wcal\_gdpr\_opt\_out\_msg\_callback' ), |
| [910](#L910) | 'woocommerce\_ac\_page', |
| [911](#L911) | 'ac\_lite\_gdpr\_settings', |
| [912](#L912) | array( \_\_( '<br>Message to be displayed when the user chooses to opt out of cart tracking.</i>', 'woocommerce-abandoned-cart' ) ) |
| [913](#L913) | ); |
| [914](#L914) | add\_settings\_section( |
| [915](#L915) | 'ac\_lite\_coupon\_settings',                 // ID used to identify this section and with which to register options. |
| [916](#L916) | \_\_( 'Coupon Settings', 'woocommerce-abandoned-cart' ),     // Title to be displayed on the administration page. |
| [917](#L917) | array( $this, 'ac\_lite\_coupon\_callback' ), // Callback used to render the description of the section. |
| [918](#L918) | 'woocommerce\_ac\_page'                               // Page on which to add this section of options. |
| [919](#L919) | ); |
| [920](#L920) | add\_settings\_field( |
| [921](#L921) | 'wcal\_delete\_coupon\_data', |
| [922](#L922) | \_\_( 'Delete Coupons Automatically', 'woocommerce-abandoned-cart' ), |
| [923](#L923) | array( $this, 'wcal\_deleting\_coupon\_data' ), |
| [924](#L924) | 'woocommerce\_ac\_page', |
| [925](#L925) | 'ac\_lite\_coupon\_settings', |
| [926](#L926) | array( \_\_( 'Enable this setting if you want to completely remove the expired and used coupon code automatically every 15 days.', 'woocommerce-abandoned-cart' ) ) |
| [927](#L927) | ); |
| [928](#L928) | add\_settings\_field( |
| [929](#L929) | 'wcal\_delete\_coupon\_data\_manually', |
| [930](#L930) | \_\_( 'Delete Coupons Manually', 'woocommerce-abandoned-cart' ), |
| [931](#L931) | array( $this, 'wcal\_deleting\_coupon\_data\_manually' ), |
| [932](#L932) | 'woocommerce\_ac\_page', |
| [933](#L933) | 'ac\_lite\_coupon\_settings', |
| [934](#L934) | array( \_\_( 'If you want to completely remove the expired and used coupon code now then click on "Delete" button.', 'woocommerce-abandoned-cart' ) ) |
| [935](#L935) | ); |
| [936](#L936) | /\*\* |
| [937](#L937) | \* New section for the Adding the abandoned cart setting. |
| [938](#L938) | \* |
| [939](#L939) | \* @since  4.7 |
| [940](#L940) | \*/ |
| [941](#L941) | add\_settings\_section( |
| [942](#L942) | 'ac\_email\_settings\_section',                                                       // ID used to identify this section and with which to register options. |
| [943](#L943) | \_\_( 'Settings for abandoned cart recovery emails', 'woocommerce-abandoned-cart' ), // Title to be displayed on the administration page. |
| [944](#L944) | array( $this, 'wcal\_email\_callback' ),                                             // Callback used to render the description of the section. |
| [945](#L945) | 'woocommerce\_ac\_email\_page'                                                        // Page on which to add this section of options. |
| [946](#L946) | ); |
| [947](#L947) |  |
| [948](#L948) | add\_settings\_field( |
| [949](#L949) | 'wcal\_from\_name', |
| [950](#L950) | \_\_( '"From" Name', 'woocommerce-abandoned-cart' ), |
| [951](#L951) | array( $this, 'wcal\_from\_name\_callback' ), |
| [952](#L952) | 'woocommerce\_ac\_email\_page', |
| [953](#L953) | 'ac\_email\_settings\_section', |
| [954](#L954) | array( 'Enter the name that should appear in the email sent.', 'woocommerce-abandoned-cart' ) |
| [955](#L955) | ); |
| [956](#L956) |  |
| [957](#L957) | add\_settings\_field( |
| [958](#L958) | 'wcal\_from\_email', |
| [959](#L959) | \_\_( '"From" Address', 'woocommerce-abandoned-cart' ), |
| [960](#L960) | array( $this, 'wcal\_from\_email\_callback' ), |
| [961](#L961) | 'woocommerce\_ac\_email\_page', |
| [962](#L962) | 'ac\_email\_settings\_section', |
| [963](#L963) | array( 'Email address from which the reminder emails should be sent.', 'woocommerce-abandoned-cart' ) |
| [964](#L964) | ); |
| [965](#L965) |  |
| [966](#L966) | add\_settings\_field( |
| [967](#L967) | 'wcal\_reply\_email', |
| [968](#L968) | \_\_( 'Send Reply Emails to', 'woocommerce-abandoned-cart' ), |
| [969](#L969) | array( $this, 'wcal\_reply\_email\_callback' ), |
| [970](#L970) | 'woocommerce\_ac\_email\_page', |
| [971](#L971) | 'ac\_email\_settings\_section', |
| [972](#L972) | array( 'When a contact receives your email and clicks reply, which email address should that reply be sent to?', 'woocommerce-abandoned-cart' ) |
| [973](#L973) | ); |
| [974](#L974) |  |
| [975](#L975) | add\_settings\_field( |
| [976](#L976) | 'wcal\_add\_utm\_to\_links', |
| [977](#L977) | \_\_( 'UTM parameters to be added to all the links in reminder emails', 'woocommerce-abandoned-cart' ), |
| [978](#L978) | array( &$this, 'wcal\_add\_utm\_to\_links\_callback' ), |
| [979](#L979) | 'woocommerce\_ac\_email\_page', |
| [980](#L980) | 'ac\_email\_settings\_section', |
| [981](#L981) | array( \_\_( 'UTM parameters that should be added to all the links in reminder emails.', 'woocommerce-abandoned-cart' ) ) |
| [982](#L982) | ); |
| [983](#L983) |  |
| [984](#L984) | add\_settings\_field( |
| [985](#L985) | 'wcal\_auto\_login\_users', |
| [986](#L986) | \_\_( 'Auto login WordPress users coming to the site using reminder email links', 'woocommerce-abandoned-cart' ), |
| [987](#L987) | array( &$this, 'wcal\_auto\_login\_users\_callback' ), |
| [988](#L988) | 'woocommerce\_ac\_email\_page', |
| [989](#L989) | 'ac\_email\_settings\_section', |
| [990](#L990) | array( \_\_( 'Should users registered on the site be auto logged in when they click a link in the reminder emails?', 'woocommerce-abandoned-cart' ) ) |
| [991](#L991) | ); |
| [992](#L992) |  |
| [993](#L993) | // Finally, we register the fields with WordPress. |
| [994](#L994) | register\_setting( |
| [995](#L995) | 'woocommerce\_ac\_settings', |
| [996](#L996) | 'wcal\_enable\_cart\_emails' |
| [997](#L997) | ); |
| [998](#L998) |  |
| [999](#L999) | register\_setting( |
| [1000](#L1000) | 'woocommerce\_ac\_settings', |
| [1001](#L1001) | 'ac\_lite\_cart\_abandoned\_time', |
| [1002](#L1002) | array( $this, 'ac\_lite\_cart\_time\_validation' ) |
| [1003](#L1003) | ); |
| [1004](#L1004) |  |
| [1005](#L1005) | register\_setting( |
| [1006](#L1006) | 'woocommerce\_ac\_settings', |
| [1007](#L1007) | 'ac\_lite\_delete\_abandoned\_order\_days', |
| [1008](#L1008) | array( $this, 'wcal\_delete\_days\_validation' ) |
| [1009](#L1009) | ); |
| [1010](#L1010) |  |
| [1011](#L1011) | register\_setting( |
| [1012](#L1012) | 'woocommerce\_ac\_settings', |
| [1013](#L1013) | 'ac\_lite\_email\_admin\_on\_recovery' |
| [1014](#L1014) | ); |
| [1015](#L1015) |  |
| [1016](#L1016) | register\_setting( |
| [1017](#L1017) | 'woocommerce\_ac\_settings', |
| [1018](#L1018) | 'ac\_lite\_track\_guest\_cart\_from\_cart\_page' |
| [1019](#L1019) | ); |
| [1020](#L1020) |  |
| [1021](#L1021) | register\_setting( |
| [1022](#L1022) | 'woocommerce\_ac\_settings', |
| [1023](#L1023) | 'wcal\_enable\_gdpr\_consent' |
| [1024](#L1024) | ); |
| [1025](#L1025) |  |
| [1026](#L1026) | register\_setting( |
| [1027](#L1027) | 'woocommerce\_ac\_settings', |
| [1028](#L1028) | 'wcal\_guest\_cart\_capture\_msg' |
| [1029](#L1029) | ); |
| [1030](#L1030) |  |
| [1031](#L1031) | register\_setting( |
| [1032](#L1032) | 'woocommerce\_ac\_settings', |
| [1033](#L1033) | 'wcal\_logged\_cart\_capture\_msg' |
| [1034](#L1034) | ); |
| [1035](#L1035) |  |
| [1036](#L1036) | register\_setting( |
| [1037](#L1037) | 'woocommerce\_ac\_settings', |
| [1038](#L1038) | 'wcal\_gdpr\_allow\_opt\_out' |
| [1039](#L1039) | ); |
| [1040](#L1040) |  |
| [1041](#L1041) | register\_setting( |
| [1042](#L1042) | 'woocommerce\_ac\_settings', |
| [1043](#L1043) | 'wcal\_gdpr\_opt\_out\_message' |
| [1044](#L1044) | ); |
| [1045](#L1045) |  |
| [1046](#L1046) | register\_setting( |
| [1047](#L1047) | 'woocommerce\_ac\_email\_settings', |
| [1048](#L1048) | 'wcal\_from\_name' |
| [1049](#L1049) | ); |
| [1050](#L1050) | register\_setting( |
| [1051](#L1051) | 'woocommerce\_ac\_email\_settings', |
| [1052](#L1052) | 'wcal\_from\_email' |
| [1053](#L1053) | ); |
| [1054](#L1054) | register\_setting( |
| [1055](#L1055) | 'woocommerce\_ac\_email\_settings', |
| [1056](#L1056) | 'wcal\_reply\_email' |
| [1057](#L1057) | ); |
| [1058](#L1058) |  |
| [1059](#L1059) | register\_setting( |
| [1060](#L1060) | 'woocommerce\_ac\_email\_settings', |
| [1061](#L1061) | 'wcal\_add\_utm\_to\_links' |
| [1062](#L1062) | ); |
| [1063](#L1063) |  |
| [1064](#L1064) | register\_setting( |
| [1065](#L1065) | 'woocommerce\_ac\_email\_settings', |
| [1066](#L1066) | 'wcal\_auto\_login\_users' |
| [1067](#L1067) | ); |
| [1068](#L1068) |  |
| [1069](#L1069) | register\_setting( |
| [1070](#L1070) | 'woocommerce\_ac\_settings', |
| [1071](#L1071) | 'wcal\_delete\_coupon\_data' |
| [1072](#L1072) | ); |
| [1073](#L1073) |  |
| [1074](#L1074) | do\_action( 'wcal\_add\_new\_settings' ); |
| [1075](#L1075) | } |
| [1076](#L1076) |  |
| [1077](#L1077) | /\*\* |
| [1078](#L1078) | \* Settings API callback for section "ac\_lite\_general\_settings\_section". |
| [1079](#L1079) | \* |
| [1080](#L1080) | \* @since 2.5 |
| [1081](#L1081) | \*/ |
| [1082](#L1082) | public function ac\_lite\_general\_options\_callback() { |
| [1083](#L1083) | } |
| [1084](#L1084) |  |
| [1085](#L1085) | /\*\* |
| [1086](#L1086) | \* Settings API callback for the enable cart reminder emails. |
| [1087](#L1087) | \* |
| [1088](#L1088) | \* @param array $args - Arguments. |
| [1089](#L1089) | \* @since 5.5 |
| [1090](#L1090) | \*/ |
| [1091](#L1091) | public static function wcal\_enable\_cart\_emails\_callback( $args ) { |
| [1092](#L1092) |  |
| [1093](#L1093) | $enable\_cart\_emails = get\_option( 'wcal\_enable\_cart\_emails', '' ); |
| [1094](#L1094) |  |
| [1095](#L1095) | if ( isset( $enable\_cart\_emails ) && '' === $enable\_cart\_emails ) { |
| [1096](#L1096) | $enable\_cart\_emails = 'off'; |
| [1097](#L1097) | } |
| [1098](#L1098) | printf( |
| [1099](#L1099) | '<input type="checkbox" id="wcal\_enable\_cart\_emails" name="wcal\_enable\_cart\_emails" value="on" ' . checked( 'on', $enable\_cart\_emails, false ) . ' />' |
| [1100](#L1100) | ); |
| [1101](#L1101) | $html = '<label for="wcal\_enable\_cart\_emails"> ' . $args[0] . '</label>'; |
| [1102](#L1102) | echo wp\_kses\_post( $html ); |
| [1103](#L1103) | } |
| [1104](#L1104) |  |
| [1105](#L1105) | /\*\* |
| [1106](#L1106) | \* Settings API callback for cart time field. |
| [1107](#L1107) | \* |
| [1108](#L1108) | \* @param array $args Arguments. |
| [1109](#L1109) | \* @since 2.5 |
| [1110](#L1110) | \*/ |
| [1111](#L1111) | public function ac\_lite\_cart\_abandoned\_time\_callback( $args ) { |
| [1112](#L1112) | // First, we read the option. |
| [1113](#L1113) | $cart\_abandoned\_time = get\_option( 'ac\_lite\_cart\_abandoned\_time' ); |
| [1114](#L1114) | // Next, we update the name attribute to access this element's ID in the context of the display options array. |
| [1115](#L1115) | // We also access the show\_header element of the options collection in the call to the checked() helper function. |
| [1116](#L1116) | printf( |
| [1117](#L1117) | '<input type="text" id="ac\_lite\_cart\_abandoned\_time" name="ac\_lite\_cart\_abandoned\_time" value="%s" />', |
| [1118](#L1118) | isset( $cart\_abandoned\_time ) ? esc\_attr( $cart\_abandoned\_time ) : '' |
| [1119](#L1119) | ); |
| [1120](#L1120) | // Here, we'll take the first argument of the array and add it to a label next to the checkbox. |
| [1121](#L1121) | $html = '<label for="ac\_lite\_cart\_abandoned\_time"> ' . $args[0] . '</label>'; |
| [1122](#L1122) | echo wp\_kses\_post( $html ); |
| [1123](#L1123) | } |
| [1124](#L1124) |  |
| [1125](#L1125) | /\*\* |
| [1126](#L1126) | \* Settings API cart time field validation. |
| [1127](#L1127) | \* |
| [1128](#L1128) | \* @param int|string $input - Input to be validated. |
| [1129](#L1129) | \* @return int|string $output - Validated output. |
| [1130](#L1130) | \* @since 2.5 |
| [1131](#L1131) | \*/ |
| [1132](#L1132) | public function ac\_lite\_cart\_time\_validation( $input ) { |
| [1133](#L1133) | $output = ''; |
| [1134](#L1134) | if ( '' != $input && ( is\_numeric( $input ) && $input > 0 ) ) { // phpcs:ignore |
| [1135](#L1135) | $output = stripslashes( $input ); |
| [1136](#L1136) | } else { |
| [1137](#L1137) | add\_settings\_error( 'ac\_lite\_cart\_abandoned\_time', 'error found', \_\_( 'Abandoned cart cut off time should be numeric and has to be greater than 0.', 'woocommerce-abandoned-cart' ) ); |
| [1138](#L1138) | } |
| [1139](#L1139) | return $output; |
| [1140](#L1140) | } |
| [1141](#L1141) |  |
| [1142](#L1142) | /\*\* |
| [1143](#L1143) | \* Validation for automatically delete abandoned carts after X days. |
| [1144](#L1144) | \* |
| [1145](#L1145) | \* @param int | string $input input of the field Abandoned cart cut off time. |
| [1146](#L1146) | \* @return int | string $output Error message or the input value. |
| [1147](#L1147) | \* @since  5.0 |
| [1148](#L1148) | \*/ |
| [1149](#L1149) | public static function wcal\_delete\_days\_validation( $input ) { |
| [1150](#L1150) | $output = ''; |
| [1151](#L1151) | if ( is\_numeric( $input ) && $input > 0 ) { |
| [1152](#L1152) | $output = stripslashes( $input ); |
| [1153](#L1153) | } else { |
| [1154](#L1154) | $output = '365'; |
| [1155](#L1155) | add\_settings\_error( 'ac\_lite\_delete\_abandoned\_order\_days', 'error found', \_\_( 'Automatically Delete Abandoned Orders after X days has to be greater than 0.', 'woocommerce-abandoned-cart' ) ); |
| [1156](#L1156) | } |
| [1157](#L1157) | return $output; |
| [1158](#L1158) | } |
| [1159](#L1159) |  |
| [1160](#L1160) | /\*\* |
| [1161](#L1161) | \* Callback for deleting abandoned order after X days field. |
| [1162](#L1162) | \* |
| [1163](#L1163) | \* @param array $args Argument given while adding the field. |
| [1164](#L1164) | \* @since 5.0 |
| [1165](#L1165) | \*/ |
| [1166](#L1166) | public static function wcal\_delete\_abandoned\_orders\_days\_callback( $args ) { |
| [1167](#L1167) | // First, we read the option. |
| [1168](#L1168) | $delete\_abandoned\_order\_days = get\_option( 'ac\_lite\_delete\_abandoned\_order\_days', '365' ); |
| [1169](#L1169) | if ( '' === $delete\_abandoned\_order\_days ) { |
| [1170](#L1170) | $delete\_abandoned\_order\_days = '365'; |
| [1171](#L1171) | } |
| [1172](#L1172) | // Next, we update the name attribute to access this element's ID in the context of the display options array. |
| [1173](#L1173) | // We also access the show\_header element of the options collection in the call to the checked() helper function. |
| [1174](#L1174) | printf( |
| [1175](#L1175) | '<input type="text" id="ac\_lite\_delete\_abandoned\_order\_days" name="ac\_lite\_delete\_abandoned\_order\_days" value="%s" />', |
| [1176](#L1176) | isset( $delete\_abandoned\_order\_days ) ? esc\_attr( $delete\_abandoned\_order\_days ) : '' |
| [1177](#L1177) | ); |
| [1178](#L1178) | // Here, we'll take the first argument of the array and add it to a label next to the checkbox. |
| [1179](#L1179) | $html = '<label for="ac\_lite\_delete\_abandoned\_order\_days"> ' . $args[0] . '</label>'; |
| [1180](#L1180) | echo wp\_kses\_post( $html ); |
| [1181](#L1181) | } |
| [1182](#L1182) |  |
| [1183](#L1183) | /\*\* |
| [1184](#L1184) | \* Settings API callback for email admin on cart recovery field. |
| [1185](#L1185) | \* |
| [1186](#L1186) | \* @param array $args Arguments. |
| [1187](#L1187) | \* @since 2.5 |
| [1188](#L1188) | \*/ |
| [1189](#L1189) | public function ac\_lite\_email\_admin\_on\_recovery( $args ) { |
| [1190](#L1190) | // First, we read the option. |
| [1191](#L1191) | $email\_admin\_on\_recovery = get\_option( 'ac\_lite\_email\_admin\_on\_recovery', '' ); |
| [1192](#L1192) |  |
| [1193](#L1193) | // This condition added to avoid the notie displyed while Check box is unchecked. |
| [1194](#L1194) | if ( isset( $email\_admin\_on\_recovery ) && '' === $email\_admin\_on\_recovery ) { |
| [1195](#L1195) | $email\_admin\_on\_recovery = 'off'; |
| [1196](#L1196) | } |
| [1197](#L1197) | // Next, we update the name attribute to access this element's ID in the context of the display options array. |
| [1198](#L1198) | // We also access the show\_header element of the options collection in the call to the checked() helper function. |
| [1199](#L1199) | $html = ''; |
| [1200](#L1200) | printf( |
| [1201](#L1201) | '<input type="checkbox" id="ac\_lite\_email\_admin\_on\_recovery" name="ac\_lite\_email\_admin\_on\_recovery" value="on" |
| [1202](#L1202) | ' . checked( 'on', $email\_admin\_on\_recovery, false ) . ' />' |
| [1203](#L1203) | ); |
| [1204](#L1204) |  |
| [1205](#L1205) | // Here, we'll take the first argument of the array and add it to a label next to the checkbox. |
| [1206](#L1206) | $html .= '<label for="ac\_lite\_email\_admin\_on\_recovery"> ' . $args[0] . '</label>'; |
| [1207](#L1207) | echo wp\_kses\_post( $html ); |
| [1208](#L1208) | } |
| [1209](#L1209) |  |
| [1210](#L1210) | /\*\* |
| [1211](#L1211) | \* Settings API callback for capturing guest cart which do not reach the checkout page. |
| [1212](#L1212) | \* |
| [1213](#L1213) | \* @param array $args Arguments. |
| [1214](#L1214) | \* @since 2.7 |
| [1215](#L1215) | \*/ |
| [1216](#L1216) | public function wcal\_track\_guest\_cart\_from\_cart\_page\_callback( $args ) { |
| [1217](#L1217) | // First, we read the option. |
| [1218](#L1218) | $disable\_guest\_cart\_from\_cart\_page = get\_option( 'ac\_lite\_track\_guest\_cart\_from\_cart\_page', '' ); |
| [1219](#L1219) |  |
| [1220](#L1220) | // This condition added to avoid the notice displyed while Check box is unchecked. |
| [1221](#L1221) | if ( isset( $disable\_guest\_cart\_from\_cart\_page ) && '' === $disable\_guest\_cart\_from\_cart\_page ) { |
| [1222](#L1222) | $disable\_guest\_cart\_from\_cart\_page = 'off'; |
| [1223](#L1223) | } |
| [1224](#L1224) | // Next, we update the name attribute to access this element's ID in the context of the display options array. |
| [1225](#L1225) | // We also access the show\_header element of the options collection in the call to the checked() helper function. |
| [1226](#L1226) | $html = ''; |
| [1227](#L1227) |  |
| [1228](#L1228) | printf( |
| [1229](#L1229) | '<input type="checkbox" id="ac\_lite\_track\_guest\_cart\_from\_cart\_page" name="ac\_lite\_track\_guest\_cart\_from\_cart\_page" value="on" |
| [1230](#L1230) | ' . checked( 'on', $disable\_guest\_cart\_from\_cart\_page, false ) . ' />' |
| [1231](#L1231) | ); |
| [1232](#L1232) | // Here, we'll take the first argument of the array and add it to a label next to the checkbox. |
| [1233](#L1233) | $html .= '<label for="ac\_lite\_track\_guest\_cart\_from\_cart\_page"> ' . $args[0] . '</label>'; |
| [1234](#L1234) | echo wp\_kses\_post( $html ); |
| [1235](#L1235) | } |
| [1236](#L1236) |  |
| [1237](#L1237) | /\*\* |
| [1238](#L1238) | \* Callback - Enable GDPR consent. |
| [1239](#L1239) | \* |
| [1240](#L1240) | \* @param array $args - Arguments. |
| [1241](#L1241) | \* @since 5.12.0 |
| [1242](#L1242) | \*/ |
| [1243](#L1243) | public static function wcal\_enable\_gdpr\_callback( $args ) { |
| [1244](#L1244) | $wcal\_enable\_gdpr = get\_option( 'wcal\_enable\_gdpr\_consent', '' ); |
| [1245](#L1245) | $wcal\_gdpr\_status = isset( $wcal\_enable\_gdpr ) && '' === $wcal\_enable\_gdpr ? 'off' : 'on'; |
| [1246](#L1246) | ?> |
| [1247](#L1247) | <input type="checkbox" id="wcal\_enable\_gdpr\_consent" name="wcal\_enable\_gdpr\_consent" value="on" <?php echo checked( 'on', $wcal\_gdpr\_status, false ); ?> /> |
| [1248](#L1248) | <label for="wcal\_enable\_gdpr\_consent"> <?php echo esc\_attr( $args[0] ); ?></label> |
| [1249](#L1249) | <a > |
| [1250](#L1250) | <?php |
| [1251](#L1251) | } |
| [1252](#L1252) | /\*\* |
| [1253](#L1253) | \* Call back function for guest user cart capture message |
| [1254](#L1254) | \* |
| [1255](#L1255) | \* @param array $args Argument for adding field details. |
| [1256](#L1256) | \* @since 7.8 |
| [1257](#L1257) | \*/ |
| [1258](#L1258) | public static function wcal\_guest\_cart\_capture\_msg\_callback( $args ) { |
| [1259](#L1259) |  |
| [1260](#L1260) | $guest\_msg = get\_option( 'wcal\_guest\_cart\_capture\_msg' ); |
| [1261](#L1261) |  |
| [1262](#L1262) | printf( |
| [1263](#L1263) | "<textarea rows='4' cols='80' id='wcal\_guest\_cart\_capture\_msg' name='wcal\_guest\_cart\_capture\_msg'>" . htmlspecialchars( $guest\_msg, ENT\_QUOTES ) . '</textarea>' // phpcs:ignore |
| [1264](#L1264) | ); |
| [1265](#L1265) |  |
| [1266](#L1266) | $html = '<label for="wcal\_guest\_cart\_capture\_msg"> ' . $args[0] . '</label>'; |
| [1267](#L1267) | echo wp\_kses\_post( $html ); |
| [1268](#L1268) | } |
| [1269](#L1269) |  |
| [1270](#L1270) | /\*\* |
| [1271](#L1271) | \* Call back function for registered user cart capture message |
| [1272](#L1272) | \* |
| [1273](#L1273) | \* @param array $args Argument for adding field details. |
| [1274](#L1274) | \* @since 7.8 |
| [1275](#L1275) | \*/ |
| [1276](#L1276) | public static function wcal\_logged\_cart\_capture\_msg\_callback( $args ) { |
| [1277](#L1277) |  |
| [1278](#L1278) | $logged\_msg = get\_option( 'wcal\_logged\_cart\_capture\_msg' ); |
| [1279](#L1279) |  |
| [1280](#L1280) | printf( |
| [1281](#L1281) | "<input type='text' class='regular-text' id='wcal\_logged\_cart\_capture\_msg' name='wcal\_logged\_cart\_capture\_msg' value='" . htmlspecialchars( $logged\_msg, ENT\_QUOTES ) . "' />" // phpcs:ignore |
| [1282](#L1282) | ); |
| [1283](#L1283) |  |
| [1284](#L1284) | $html = '<label for="wcal\_logged\_cart\_capture\_msg"> ' . $args[0] . '</label>'; |
| [1285](#L1285) | echo wp\_kses\_post( $html ); |
| [1286](#L1286) | } |
| [1287](#L1287) |  |
| [1288](#L1288) |  |
| [1289](#L1289) | /\*\* |
| [1290](#L1290) | \* Text to allow the user the choice to opt out of cart tracking. |
| [1291](#L1291) | \* |
| [1292](#L1292) | \* @param array $args - Arguments. |
| [1293](#L1293) | \* @since 5.5 |
| [1294](#L1294) | \*/ |
| [1295](#L1295) | public static function wcal\_gdpr\_allow\_opt\_out\_callback( $args ) { |
| [1296](#L1296) |  |
| [1297](#L1297) | $wcal\_gdpr\_allow\_opt\_out = get\_option( 'wcal\_gdpr\_allow\_opt\_out' ); |
| [1298](#L1298) |  |
| [1299](#L1299) | printf( |
| [1300](#L1300) | "<input type='text' class='regular-text' id='wcal\_gdpr\_allow\_opt\_out' name='wcal\_gdpr\_allow\_opt\_out' value='" . htmlspecialchars( $wcal\_gdpr\_allow\_opt\_out, ENT\_QUOTES ) . "' />" // phpcs:ignore |
| [1301](#L1301) | ); |
| [1302](#L1302) |  |
| [1303](#L1303) | $html = '<label for="wcal\_gdpr\_allow\_opt\_out"> ' . $args[0] . '</label>'; |
| [1304](#L1304) | echo wp\_kses\_post( $html ); |
| [1305](#L1305) | } |
| [1306](#L1306) |  |
| [1307](#L1307) | /\*\* |
| [1308](#L1308) | \* Message to display when the user chooses to opt out of cart tracking. |
| [1309](#L1309) | \* |
| [1310](#L1310) | \* @param array $args - Arguments. |
| [1311](#L1311) | \* @since 5.5 |
| [1312](#L1312) | \*/ |
| [1313](#L1313) | public static function wcal\_gdpr\_opt\_out\_msg\_callback( $args ) { |
| [1314](#L1314) |  |
| [1315](#L1315) | $wcal\_gdpr\_opt\_out\_message = get\_option( 'wcal\_gdpr\_opt\_out\_message' ); |
| [1316](#L1316) |  |
| [1317](#L1317) | printf( |
| [1318](#L1318) | "<input type='text' class='regular-text' id='wcal\_gdpr\_opt\_out\_message' name='wcal\_gdpr\_opt\_out\_message' value='" . htmlspecialchars( $wcal\_gdpr\_opt\_out\_message, ENT\_QUOTES ) . "' />" // phpcs:ignore |
| [1319](#L1319) | ); |
| [1320](#L1320) |  |
| [1321](#L1321) | $html = '<label for="wcal\_gdpr\_opt\_out\_message"> ' . $args[0] . '</label>'; |
| [1322](#L1322) | echo wp\_kses\_post( $html ); |
| [1323](#L1323) | } |
| [1324](#L1324) |  |
| [1325](#L1325) | /\*\* |
| [1326](#L1326) | \* Settings API callback for Abandoned cart email settings of the plugin. |
| [1327](#L1327) | \* |
| [1328](#L1328) | \* @since 3.5 |
| [1329](#L1329) | \*/ |
| [1330](#L1330) | public function wcal\_email\_callback() { |
| [1331](#L1331) | } |
| [1332](#L1332) |  |
| [1333](#L1333) | /\*\* |
| [1334](#L1334) | \* Settings API callback for from name used in Abandoned cart email. |
| [1335](#L1335) | \* |
| [1336](#L1336) | \* @param array $args Arguments. |
| [1337](#L1337) | \* @since 3.5 |
| [1338](#L1338) | \*/ |
| [1339](#L1339) | public static function wcal\_from\_name\_callback( $args ) { |
| [1340](#L1340) | // First, we read the option. |
| [1341](#L1341) | $wcal\_from\_name = get\_option( 'wcal\_from\_name' ); |
| [1342](#L1342) | // Next, we update the name attribute to access this element's ID in the context of the display options array. |
| [1343](#L1343) | // We also access the show\_header element of the options collection in the call to the checked() helper function. |
| [1344](#L1344) | printf( |
| [1345](#L1345) | '<input type="text" id="wcal\_from\_name" name="wcal\_from\_name" value="%s" />', |
| [1346](#L1346) | isset( $wcal\_from\_name ) ? esc\_attr( $wcal\_from\_name ) : '' |
| [1347](#L1347) | ); |
| [1348](#L1348) | // Here, we'll take the first argument of the array and add it to a label next to the checkbox. |
| [1349](#L1349) | $html = '<label for="wcal\_from\_name\_label"> ' . $args[0] . '</label>'; |
| [1350](#L1350) | echo wp\_kses\_post( $html ); |
| [1351](#L1351) | } |
| [1352](#L1352) |  |
| [1353](#L1353) | /\*\* |
| [1354](#L1354) | \* Settings API callback for from email used in Abandoned cart email. |
| [1355](#L1355) | \* |
| [1356](#L1356) | \* @param array $args Arguments. |
| [1357](#L1357) | \* @since 3.5 |
| [1358](#L1358) | \*/ |
| [1359](#L1359) | public static function wcal\_from\_email\_callback( $args ) { |
| [1360](#L1360) | // First, we read the option. |
| [1361](#L1361) | $wcal\_from\_email = get\_option( 'wcal\_from\_email' ); |
| [1362](#L1362) | // Next, we update the name attribute to access this element's ID in the context of the display options array. |
| [1363](#L1363) | // We also access the show\_header element of the options collection in the call to the checked() helper function. |
| [1364](#L1364) | printf( |
| [1365](#L1365) | '<input type="text" id="wcal\_from\_email" name="wcal\_from\_email" value="%s" />', |
| [1366](#L1366) | isset( $wcal\_from\_email ) ? esc\_attr( $wcal\_from\_email ) : '' |
| [1367](#L1367) | ); |
| [1368](#L1368) | // Here, we'll take the first argument of the array and add it to a label next to the checkbox. |
| [1369](#L1369) | $html = '<label for="wcal\_from\_email\_label"> ' . $args[0] . '</label>'; |
| [1370](#L1370) | echo wp\_kses\_post( $html ); |
| [1371](#L1371) | } |
| [1372](#L1372) |  |
| [1373](#L1373) | /\*\* |
| [1374](#L1374) | \* Settings API callback for reply email used in Abandoned cart email. |
| [1375](#L1375) | \* |
| [1376](#L1376) | \* @param array $args Arguments. |
| [1377](#L1377) | \* @since 3.5 |
| [1378](#L1378) | \*/ |
| [1379](#L1379) | public static function wcal\_reply\_email\_callback( $args ) { |
| [1380](#L1380) | // First, we read the option. |
| [1381](#L1381) | $wcal\_reply\_email = get\_option( 'wcal\_reply\_email' ); |
| [1382](#L1382) | // Next, we update the name attribute to access this element's ID in the context of the display options array. |
| [1383](#L1383) | // We also access the show\_header element of the options collection in the call to the checked() helper function. |
| [1384](#L1384) | printf( |
| [1385](#L1385) | '<input type="text" id="wcal\_reply\_email" name="wcal\_reply\_email" value="%s" />', |
| [1386](#L1386) | isset( $wcal\_reply\_email ) ? esc\_attr( $wcal\_reply\_email ) : '' |
| [1387](#L1387) | ); |
| [1388](#L1388) | // Here, we'll take the first argument of the array and add it to a label next to the checkbox. |
| [1389](#L1389) | $html = '<label for="wcal\_reply\_email\_label"> ' . $args[0] . '</label>'; |
| [1390](#L1390) | echo wp\_kses\_post( $html ); |
| [1391](#L1391) | } |
| [1392](#L1392) |  |
| [1393](#L1393) | /\*\* |
| [1394](#L1394) | \* Callback for UTM parameters. |
| [1395](#L1395) | \* |
| [1396](#L1396) | \* @param array $args - Arguments for the setting. |
| [1397](#L1397) | \* @since 5.9.0 |
| [1398](#L1398) | \*/ |
| [1399](#L1399) | public static function wcal\_add\_utm\_to\_links\_callback( $args ) { |
| [1400](#L1400) |  |
| [1401](#L1401) | $wcal\_add\_utm\_to\_links = get\_option( 'wcal\_add\_utm\_to\_links', '' ); |
| [1402](#L1402) |  |
| [1403](#L1403) | ?> |
| [1404](#L1404) | <textarea id='wcal\_add\_utm\_to\_links' rows='4' cols='50' name='wcal\_add\_utm\_to\_links' ><?php echo esc\_html( $wcal\_add\_utm\_to\_links ); ?></textarea> |
| [1405](#L1405) | <?php |
| [1406](#L1406) | $html = '<label for="wcal\_add\_utm\_to\_links">' . $args[0] . '</label>'; |
| [1407](#L1407) | echo wp\_kses\_post( $html ); |
| [1408](#L1408) | } |
| [1409](#L1409) |  |
| [1410](#L1410) | /\*\* |
| [1411](#L1411) | \* Callback for Auto login Users. |
| [1412](#L1412) | \* |
| [1413](#L1413) | \* @param array $args - Arguments for the setting. |
| [1414](#L1414) | \* @since 5.9.0 |
| [1415](#L1415) | \*/ |
| [1416](#L1416) | public static function wcal\_auto\_login\_users\_callback( $args ) { |
| [1417](#L1417) |  |
| [1418](#L1418) | $wcal\_auto\_login\_users = get\_option( 'wcal\_auto\_login\_users', '' ); |
| [1419](#L1419) | if ( isset( $wcal\_auto\_login\_users ) && '' === $wcal\_auto\_login\_users ) { |
| [1420](#L1420) | $wcal\_auto\_login\_users = 'off'; |
| [1421](#L1421) | } |
| [1422](#L1422) | printf( |
| [1423](#L1423) | '<input type="checkbox" id="wcal\_auto\_login\_users" name="wcal\_auto\_login\_users" value="on" ' . checked( 'on', $wcal\_auto\_login\_users, false ) . ' />' |
| [1424](#L1424) | ); |
| [1425](#L1425) | $html = '<label for="wcal\_auto\_login\_users"> ' . $args[0] . '</label>'; |
| [1426](#L1426) | echo wp\_kses\_post( $html ); |
| [1427](#L1427) | } |
| [1428](#L1428) |  |
| [1429](#L1429) | /\*\* |
| [1430](#L1430) | \* Add a submenu page under the WooCommerce. |
| [1431](#L1431) | \* |
| [1432](#L1432) | \* @hook admin\_menu |
| [1433](#L1433) | \* @since 1.0 |
| [1434](#L1434) | \*/ |
| [1435](#L1435) | public function wcal\_admin\_menu() { |
| [1436](#L1436) |  |
| [1437](#L1437) | $menu\_title = sprintf( |
| [1438](#L1438) | '%s<span class="upgrade-to-pro-admin-menu">&nbsp;%s</span>', |
| [1439](#L1439) | \_\_( 'Abandoned Carts', 'woocommerce-abandoned-cart' ), |
| [1440](#L1440) | \_\_( 'Upgrade to Pro!', 'woocommerce-abandoned-cart' ) |
| [1441](#L1441) | ); |
| [1442](#L1442) |  |
| [1443](#L1443) | $page = add\_submenu\_page( |
| [1444](#L1444) | 'woocommerce', |
| [1445](#L1445) | \_\_( 'Abandoned Carts', 'woocommerce-abandoned-cart' ), |
| [1446](#L1446) | $menu\_title, |
| [1447](#L1447) | 'manage\_woocommerce', |
| [1448](#L1448) | 'woocommerce\_ac\_page', |
| [1449](#L1449) | array( &$this, 'wcal\_menu\_page' ) |
| [1450](#L1450) | ); |
| [1451](#L1451) | } |
| [1452](#L1452) |  |
| [1453](#L1453) | /\*\* |
| [1454](#L1454) | \* Capture the cart and insert the information of the cart into DataBase. |
| [1455](#L1455) | \* |
| [1456](#L1456) | \* @hook woocommerce\_cart\_updated |
| [1457](#L1457) | \* @globals mixed $wpdb |
| [1458](#L1458) | \* @globals mixed $woocommerce |
| [1459](#L1459) | \* @since 1.0 |
| [1460](#L1460) | \*/ |
| [1461](#L1461) | public function wcal\_store\_cart\_timestamp() { |
| [1462](#L1462) |  |
| [1463](#L1463) | $block\_crawlers = apply\_filters( 'wcal\_block\_crawlers', false ); |
| [1464](#L1464) |  |
| [1465](#L1465) | if ( $block\_crawlers ) { |
| [1466](#L1466) | return; |
| [1467](#L1467) | } |
| [1468](#L1468) |  |
| [1469](#L1469) | if ( get\_transient( 'wcal\_email\_sent\_id' ) !== false ) { |
| [1470](#L1470) | wcal\_common::wcal\_set\_cart\_session( 'email\_sent\_id', get\_transient( 'wcal\_email\_sent\_id' ) ); |
| [1471](#L1471) | delete\_transient( 'wcal\_email\_sent\_id' ); |
| [1472](#L1472) | } |
| [1473](#L1473) | if ( get\_transient( 'wcal\_abandoned\_id' ) !== false ) { |
| [1474](#L1474) | wcal\_common::wcal\_set\_cart\_session( 'abandoned\_cart\_id\_lite', get\_transient( 'wcal\_abandoned\_id' ) ); |
| [1475](#L1475) | delete\_transient( 'wcal\_abandoned\_id' ); |
| [1476](#L1476) | } |
| [1477](#L1477) |  |
| [1478](#L1478) | global $wpdb,$woocommerce; |
| [1479](#L1479) | $current\_time                    = current\_time( 'timestamp' ); // phpcs:ignore |
| [1480](#L1480) | $cut\_off\_time                    = get\_option( 'ac\_lite\_cart\_abandoned\_time' ); |
| [1481](#L1481) | $track\_guest\_cart\_from\_cart\_page = get\_option( 'ac\_lite\_track\_guest\_cart\_from\_cart\_page' ); |
| [1482](#L1482) | $cart\_ignored                    = 0; |
| [1483](#L1483) | $recovered\_cart                  = 0; |
| [1484](#L1484) |  |
| [1485](#L1485) | $track\_guest\_user\_cart\_from\_cart = ''; |
| [1486](#L1486) | if ( isset( $track\_guest\_cart\_from\_cart\_page ) ) { |
| [1487](#L1487) | $track\_guest\_user\_cart\_from\_cart = $track\_guest\_cart\_from\_cart\_page; |
| [1488](#L1488) | } |
| [1489](#L1489) |  |
| [1490](#L1490) | if ( isset( $cut\_off\_time ) ) { |
| [1491](#L1491) | $cart\_cut\_off\_time = intval( $cut\_off\_time ) \* 60; |
| [1492](#L1492) | } else { |
| [1493](#L1493) | $cart\_cut\_off\_time = 60 \* 60; |
| [1494](#L1494) | } |
| [1495](#L1495) | $compare\_time = $current\_time - $cart\_cut\_off\_time; |
| [1496](#L1496) |  |
| [1497](#L1497) | if ( is\_user\_logged\_in() ) { |
| [1498](#L1498) |  |
| [1499](#L1499) | $user\_id      = get\_current\_user\_id(); |
| [1500](#L1500) | $gdpr\_consent = get\_user\_meta( $user\_id, 'wcal\_gdpr\_tracking\_choice', true ); |
| [1501](#L1501) |  |
| [1502](#L1502) | if ( '' === $gdpr\_consent ) { |
| [1503](#L1503) | $gdpr\_consent = true; |
| [1504](#L1504) | } |
| [1505](#L1505) |  |
| [1506](#L1506) | $wcal\_user\_restricted = false; |
| [1507](#L1507) | $wcal\_user\_restricted = apply\_filters( 'wcal\_restrict\_user', $wcal\_user\_restricted, $user\_id ); |
| [1508](#L1508) |  |
| [1509](#L1509) | if ( $gdpr\_consent && ! $wcal\_user\_restricted ) { |
| [1510](#L1510) |  |
| [1511](#L1511) | $results = $wpdb->get\_results( // phpcs:ignore |
| [1512](#L1512) | $wpdb->prepare( |
| [1513](#L1513) | 'SELECT \* FROM `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` WHERE user\_id = %d AND cart\_ignored = %s AND recovered\_cart = %s', |
| [1514](#L1514) | $user\_id, |
| [1515](#L1515) | $cart\_ignored, |
| [1516](#L1516) | $recovered\_cart |
| [1517](#L1517) | ) |
| [1518](#L1518) | ); |
| [1519](#L1519) | if ( 0 === count( $results ) ) { |
| [1520](#L1520) | $cart\_info\_meta         = array(); |
| [1521](#L1521) | $cart\_info\_meta['cart'] = WC()->session->cart; |
| [1522](#L1522) | $cart\_info\_meta         = wp\_json\_encode( $cart\_info\_meta ); |
| [1523](#L1523) |  |
| [1524](#L1524) | if ( '' !== $cart\_info\_meta && '{"cart":[]}' !== $cart\_info\_meta && '""' !== $cart\_info\_meta ) { |
| [1525](#L1525) | $cart\_info = $cart\_info\_meta; |
| [1526](#L1526) | $user\_type = 'REGISTERED'; |
| [1527](#L1527) | $wpdb->query( //phpcs:ignore |
| [1528](#L1528) | $wpdb->prepare( |
| [1529](#L1529) | 'INSERT INTO `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` ( user\_id, abandoned\_cart\_info, abandoned\_cart\_time, cart\_ignored, user\_type ) VALUES ( %d, %s, %d, %s, %s )', |
| [1530](#L1530) | $user\_id, |
| [1531](#L1531) | $cart\_info, |
| [1532](#L1532) | $current\_time, |
| [1533](#L1533) | $cart\_ignored, |
| [1534](#L1534) | $user\_type |
| [1535](#L1535) | ) |
| [1536](#L1536) | ); |
| [1537](#L1537) | $abandoned\_cart\_id = $wpdb->insert\_id; |
| [1538](#L1538) | wcal\_common::wcal\_set\_cart\_session( 'abandoned\_cart\_id\_lite', $abandoned\_cart\_id ); |
| [1539](#L1539) | wcal\_common::wcal\_add\_checkout\_link( $abandoned\_cart\_id ); |
| [1540](#L1540) | wcal\_common::wcal\_run\_webhook\_after\_cutoff( $abandoned\_cart\_id ); |
| [1541](#L1541) | } |
| [1542](#L1542) | } elseif ( isset( $results[0]->abandoned\_cart\_time ) && $compare\_time > $results[0]->abandoned\_cart\_time ) { |
| [1543](#L1543) | $updated\_cart\_info         = array(); |
| [1544](#L1544) | $updated\_cart\_info['cart'] = WC()->session->cart; |
| [1545](#L1545) | $updated\_cart\_info         = wp\_json\_encode( $updated\_cart\_info ); |
| [1546](#L1546) |  |
| [1547](#L1547) | if ( ! $this->wcal\_compare\_carts( $user\_id, $results[0]->abandoned\_cart\_info ) ) { |
| [1548](#L1548) | $updated\_cart\_ignored = 1; |
| [1549](#L1549) | $wpdb->query( //phpcs:ignore |
| [1550](#L1550) | $wpdb->prepare( |
| [1551](#L1551) | 'UPDATE `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` SET cart\_ignored = %s WHERE user\_id = %d', |
| [1552](#L1552) | $updated\_cart\_ignored, |
| [1553](#L1553) | $user\_id |
| [1554](#L1554) | ) |
| [1555](#L1555) | ); |
| [1556](#L1556) | $user\_type = 'REGISTERED'; |
| [1557](#L1557) | $wpdb->query( //phpcs:ignore |
| [1558](#L1558) | $wpdb->prepare( |
| [1559](#L1559) | 'INSERT INTO `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` (user\_id, abandoned\_cart\_info, abandoned\_cart\_time, cart\_ignored, user\_type) VALUES (%d, %s, %d, %s, %s)', |
| [1560](#L1560) | $user\_id, |
| [1561](#L1561) | $updated\_cart\_info, |
| [1562](#L1562) | $current\_time, |
| [1563](#L1563) | $cart\_ignored, |
| [1564](#L1564) | $user\_type |
| [1565](#L1565) | ) |
| [1566](#L1566) | ); |
| [1567](#L1567) | update\_user\_meta( $user\_id, '\_woocommerce\_ac\_modified\_cart', md5( 'yes' ) ); |
| [1568](#L1568) |  |
| [1569](#L1569) | $abandoned\_cart\_id = $wpdb->insert\_id; |
| [1570](#L1570) | wcal\_common::wcal\_set\_cart\_session( 'abandoned\_cart\_id\_lite', $abandoned\_cart\_id ); |
| [1571](#L1571) | wcal\_common::wcal\_add\_checkout\_link( $abandoned\_cart\_id ); |
| [1572](#L1572) | wcal\_common::wcal\_run\_webhook\_after\_cutoff( $abandoned\_cart\_id ); |
| [1573](#L1573) | } else { |
| [1574](#L1574) | update\_user\_meta( $user\_id, '\_woocommerce\_ac\_modified\_cart', md5( 'no' ) ); |
| [1575](#L1575) | } |
| [1576](#L1576) | } else { |
| [1577](#L1577) | $updated\_cart\_info         = array(); |
| [1578](#L1578) | $updated\_cart\_info['cart'] = WC()->session->cart; |
| [1579](#L1579) | $updated\_cart\_info         = wp\_json\_encode( $updated\_cart\_info ); |
| [1580](#L1580) |  |
| [1581](#L1581) | $wpdb->query( //phpcs:ignore |
| [1582](#L1582) | $wpdb->prepare( |
| [1583](#L1583) | 'UPDATE `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` SET abandoned\_cart\_info = %s, abandoned\_cart\_time = %d WHERE user\_id      = %d AND   cart\_ignored = %s', |
| [1584](#L1584) | $updated\_cart\_info, |
| [1585](#L1585) | $current\_time, |
| [1586](#L1586) | $user\_id, |
| [1587](#L1587) | $cart\_ignored |
| [1588](#L1588) | ) |
| [1589](#L1589) | ); |
| [1590](#L1590) |  |
| [1591](#L1591) | $get\_abandoned\_record = $wpdb->get\_results( //phpcs:ignore |
| [1592](#L1592) | $wpdb->prepare( |
| [1593](#L1593) | 'SELECT \* FROM `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` WHERE user\_id = %d AND cart\_ignored = %s', |
| [1594](#L1594) | $user\_id, |
| [1595](#L1595) | 0 |
| [1596](#L1596) | ) |
| [1597](#L1597) | ); |
| [1598](#L1598) |  |
| [1599](#L1599) | if ( count( $get\_abandoned\_record ) > 0 ) { |
| [1600](#L1600) | $abandoned\_cart\_id = $get\_abandoned\_record[0]->id; |
| [1601](#L1601) | wcal\_common::wcal\_set\_cart\_session( 'abandoned\_cart\_id\_lite', $abandoned\_cart\_id ); |
| [1602](#L1602) | wcal\_common::wcal\_add\_checkout\_link( $abandoned\_cart\_id ); |
| [1603](#L1603) | wcal\_common::wcal\_run\_webhook\_after\_cutoff( $abandoned\_cart\_id ); |
| [1604](#L1604) | } |
| [1605](#L1605) | } |
| [1606](#L1606) | } |
| [1607](#L1607) | } else { |
| [1608](#L1608) | // start here guest user. |
| [1609](#L1609) | $user\_id = wcal\_common::wcal\_get\_cart\_session( 'user\_id' ); |
| [1610](#L1610) |  |
| [1611](#L1611) | // GDPR consent. |
| [1612](#L1612) | $gdpr\_consent  = true; |
| [1613](#L1613) | $show\_gdpr\_msg = wcal\_common::wcal\_get\_cart\_session( 'wcal\_cart\_tracking\_refused' ); |
| [1614](#L1614) | if ( isset( $show\_gdpr\_msg ) && 'yes' == $show\_gdpr\_msg ) { // phpcs:ignore |
| [1615](#L1615) | $gdpr\_consent = false; |
| [1616](#L1616) | } |
| [1617](#L1617) |  |
| [1618](#L1618) | if ( $gdpr\_consent ) { |
| [1619](#L1619) | $results = $wpdb->get\_results( //phpcs:ignore |
| [1620](#L1620) | $wpdb->prepare( |
| [1621](#L1621) | 'SELECT \* FROM `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` WHERE user\_id = %d AND cart\_ignored = %s AND recovered\_cart = %s AND user\_id != %s', |
| [1622](#L1622) | $user\_id, |
| [1623](#L1623) | 0, |
| [1624](#L1624) | 0, |
| [1625](#L1625) | 0 |
| [1626](#L1626) | ) |
| [1627](#L1627) | ); |
| [1628](#L1628) | $cart    = array(); |
| [1629](#L1629) |  |
| [1630](#L1630) | $get\_cookie = WC()->session->get\_customer\_id(); |
| [1631](#L1631) |  |
| [1632](#L1632) | if ( function\_exists( 'WC' ) ) { |
| [1633](#L1633) | $cart['cart'] = WC()->session->cart; |
| [1634](#L1634) | } else { |
| [1635](#L1635) | $cart['cart'] = $woocommerce->session->cart; |
| [1636](#L1636) | } |
| [1637](#L1637) |  |
| [1638](#L1638) | $updated\_cart\_info = wp\_json\_encode( $cart ); |
| [1639](#L1639) |  |
| [1640](#L1640) | if ( count( $results ) > 0 && '{"cart":[]}' !== $updated\_cart\_info ) { |
| [1641](#L1641) | if ( $compare\_time > $results[0]->abandoned\_cart\_time ) { |
| [1642](#L1642) | if ( ! $this->wcal\_compare\_only\_guest\_carts( $updated\_cart\_info, $results[0]->abandoned\_cart\_info ) ) { |
| [1643](#L1643) |  |
| [1644](#L1644) | $wpdb->query( //phpcs:ignore |
| [1645](#L1645) | $wpdb->prepare( |
| [1646](#L1646) | 'UPDATE `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` SET cart\_ignored = %s WHERE user\_id = %s', |
| [1647](#L1647) | 1, |
| [1648](#L1648) | $user\_id |
| [1649](#L1649) | ) |
| [1650](#L1650) | ); |
| [1651](#L1651) | $user\_type = 'GUEST'; |
| [1652](#L1652) | $wpdb->query( //phpcs:ignore |
| [1653](#L1653) | $wpdb->prepare( |
| [1654](#L1654) | 'INSERT INTO `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` (user\_id, abandoned\_cart\_info, abandoned\_cart\_time, cart\_ignored, user\_type, session\_id, checkout\_link) VALUES (%d, %s, %d, %s, %s, %s, %s)', |
| [1655](#L1655) | $user\_id, |
| [1656](#L1656) | $updated\_cart\_info, |
| [1657](#L1657) | $current\_time, |
| [1658](#L1658) | $cart\_ignored, |
| [1659](#L1659) | $user\_type, |
| [1660](#L1660) | $get\_cookie, |
| [1661](#L1661) | $results[0]->checkout\_link |
| [1662](#L1662) | ) |
| [1663](#L1663) | ); |
| [1664](#L1664) | update\_user\_meta( $user\_id, '\_woocommerce\_ac\_modified\_cart', md5( 'yes' ) ); |
| [1665](#L1665) | } else { |
| [1666](#L1666) | update\_user\_meta( $user\_id, '\_woocommerce\_ac\_modified\_cart', md5( 'no' ) ); |
| [1667](#L1667) | } |
| [1668](#L1668) | } else { |
| [1669](#L1669) | $wpdb->query( //phpcs:ignore |
| [1670](#L1670) | $wpdb->prepare( |
| [1671](#L1671) | 'UPDATE `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` SET abandoned\_cart\_info = %s, abandoned\_cart\_time = %s WHERE user\_id = %d AND cart\_ignored = %s', |
| [1672](#L1672) | $updated\_cart\_info, |
| [1673](#L1673) | $current\_time, |
| [1674](#L1674) | $user\_id, |
| [1675](#L1675) | 0 |
| [1676](#L1676) | ) |
| [1677](#L1677) | ); |
| [1678](#L1678) | } |
| [1679](#L1679) | } else { |
| [1680](#L1680) | // Here we capture the guest cart from the cart page @since 3.5. |
| [1681](#L1681) | if ( 'on' === $track\_guest\_user\_cart\_from\_cart && isset( $get\_cookie ) && '' !== $get\_cookie ) { |
| [1682](#L1682) | $results = $wpdb->get\_results( //phpcs:ignore |
| [1683](#L1683) | $wpdb->prepare( |
| [1684](#L1684) | 'SELECT \* FROM `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` WHERE session\_id LIKE %s AND cart\_ignored = %s AND recovered\_cart = %s', |
| [1685](#L1685) | $get\_cookie, |
| [1686](#L1686) | 0, |
| [1687](#L1687) | 0 |
| [1688](#L1688) | ) |
| [1689](#L1689) | ); |
| [1690](#L1690) | if ( 0 === count( $results ) ) { |
| [1691](#L1691) | $cart\_info       = $updated\_cart\_info; |
| [1692](#L1692) | $blank\_cart\_info = '[]'; |
| [1693](#L1693) | if ( $blank\_cart\_info !== $cart\_info && '{"cart":[]}' !== $cart\_info ) { |
| [1694](#L1694) | $wpdb->query( //phpcs:ignore |
| [1695](#L1695) | $wpdb->prepare( |
| [1696](#L1696) | 'INSERT INTO `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` ( abandoned\_cart\_info , abandoned\_cart\_time , cart\_ignored , recovered\_cart, user\_type, session\_id  ) VALUES ( %s, %s, %s, %s, %s, %s )', |
| [1697](#L1697) | $cart\_info, |
| [1698](#L1698) | $current\_time, |
| [1699](#L1699) | 0, |
| [1700](#L1700) | 0, |
| [1701](#L1701) | 'GUEST', |
| [1702](#L1702) | $get\_cookie |
| [1703](#L1703) | ) |
| [1704](#L1704) | ); |
| [1705](#L1705) | $abandoned\_cart\_id = $wpdb->insert\_id; |
| [1706](#L1706) | } |
| [1707](#L1707) | } elseif ( $compare\_time > $results[0]->abandoned\_cart\_time ) { |
| [1708](#L1708) | $blank\_cart\_info = '[]'; |
| [1709](#L1709) | if ( $blank\_cart\_info !== $updated\_cart\_info && '{"cart":[]}' !== $updated\_cart\_info ) { |
| [1710](#L1710) | if ( ! $this->wcal\_compare\_only\_guest\_carts( $updated\_cart\_info, $results[0]->abandoned\_cart\_info ) ) { |
| [1711](#L1711) | $wpdb->query( // phpcs:ignore |
| [1712](#L1712) | $wpdb->prepare( |
| [1713](#L1713) | 'UPDATE `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` SET cart\_ignored = %s WHERE session\_id = %s', |
| [1714](#L1714) | 1, |
| [1715](#L1715) | $get\_cookie |
| [1716](#L1716) | ) |
| [1717](#L1717) | ); |
| [1718](#L1718) | $wpdb->query( //phpcs:ignore |
| [1719](#L1719) | $wpdb->prepare( |
| [1720](#L1720) | 'INSERT INTO `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` ( abandoned\_cart\_info, abandoned\_cart\_time, cart\_ignored, recovered\_cart, user\_type, session\_id ) VALUES ( %s, %s, %s, %s, %s, %s )', |
| [1721](#L1721) | $updated\_cart\_info, |
| [1722](#L1722) | $current\_time, |
| [1723](#L1723) | 0, |
| [1724](#L1724) | 0, |
| [1725](#L1725) | 'GUEST', |
| [1726](#L1726) | $get\_cookie |
| [1727](#L1727) | ) |
| [1728](#L1728) | ); |
| [1729](#L1729) | $abandoned\_cart\_id = $wpdb->insert\_id; |
| [1730](#L1730) | } |
| [1731](#L1731) | } |
| [1732](#L1732) | } else { |
| [1733](#L1733) | $blank\_cart\_info = '[]'; |
| [1734](#L1734) | if ( $blank\_cart\_info !== $updated\_cart\_info && '{"cart":[]}' !== $updated\_cart\_info ) { |
| [1735](#L1735) | if ( ! $this->wcal\_compare\_only\_guest\_carts( $updated\_cart\_info, $results[0]->abandoned\_cart\_info ) ) { |
| [1736](#L1736) | $wpdb->query( //phpcs:ignore |
| [1737](#L1737) | $wpdb->prepare( |
| [1738](#L1738) | 'UPDATE `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` SET abandoned\_cart\_info = %s, abandoned\_cart\_time  = %s WHERE session\_id = %s AND cart\_ignored = %s', |
| [1739](#L1739) | $updated\_cart\_info, |
| [1740](#L1740) | $current\_time, |
| [1741](#L1741) | $get\_cookie, |
| [1742](#L1742) | 0 |
| [1743](#L1743) | ) |
| [1744](#L1744) | ); |
| [1745](#L1745) | } |
| [1746](#L1746) | } |
| [1747](#L1747) | } |
| [1748](#L1748) | if ( isset( $abandoned\_cart\_id ) ) { |
| [1749](#L1749) | // add the abandoned id in the session. |
| [1750](#L1750) | wcal\_common::wcal\_set\_cart\_session( 'abandoned\_cart\_id\_lite', $abandoned\_cart\_id ); |
| [1751](#L1751) | } |
| [1752](#L1752) | } |
| [1753](#L1753) | } |
| [1754](#L1754) | } |
| [1755](#L1755) | } |
| [1756](#L1756) | } |
| [1757](#L1757) |  |
| [1758](#L1758) | /\*\* |
| [1759](#L1759) | \* Detect Crawlers |
| [1760](#L1760) | \* |
| [1761](#L1761) | \* @param boolean $ignore - Ignore. |
| [1762](#L1762) | \* @return boolean $ignore - Ignore. |
| [1763](#L1763) | \*/ |
| [1764](#L1764) | public function wcal\_detect\_crawlers( $ignore ) { |
| [1765](#L1765) | $user\_agent = isset( $\_SERVER['HTTP\_USER\_AGENT'] ) ? sanitize\_text\_field( wp\_unslash( $\_SERVER['HTTP\_USER\_AGENT'] ) ) : ''; |
| [1766](#L1766) |  |
| [1767](#L1767) | if ( '' === $user\_agent ) { |
| [1768](#L1768) | return $ignore; |
| [1769](#L1769) | } |
| [1770](#L1770) |  |
| [1771](#L1771) | // Current list of bots being blocked: |
| [1772](#L1772) | // 1. Googlebot, BingBot, DuckDuckBot, YandexBot, Exabot. |
| [1773](#L1773) | // 2. cURL. |
| [1774](#L1774) | // 3. wget. |
| [1775](#L1775) | // 4. Yahoo/Slurp. |
| [1776](#L1776) | // 5. Baiduspider. |
| [1777](#L1777) | // 6. Sogou. |
| [1778](#L1778) | // 7. Alexa. |
| [1779](#L1779) | $bot\_agents = array( |
| [1780](#L1780) | 'curl', |
| [1781](#L1781) | 'wget', |
| [1782](#L1782) | 'bot', |
| [1783](#L1783) | 'bots', |
| [1784](#L1784) | 'slurp', |
| [1785](#L1785) | 'baiduspider', |
| [1786](#L1786) | 'sogou', |
| [1787](#L1787) | 'ia\_archiver', |
| [1788](#L1788) | ); |
| [1789](#L1789) |  |
| [1790](#L1790) | foreach ( $bot\_agents as $url ) { |
| [1791](#L1791) | if ( false !== stripos( $user\_agent, $url ) ) { |
| [1792](#L1792) | return true; |
| [1793](#L1793) | } |
| [1794](#L1794) | } |
| [1795](#L1795) |  |
| [1796](#L1796) | return $ignore; |
| [1797](#L1797) | } |
| [1798](#L1798) |  |
| [1799](#L1799) | /\*\* |
| [1800](#L1800) | \* It will unsubscribe the abandoned cart, so user will not recieve further abandoned cart emails. |
| [1801](#L1801) | \* |
| [1802](#L1802) | \* @hook template\_include |
| [1803](#L1803) | \* @param string $args Arguments. |
| [1804](#L1804) | \* @return string $args Arguments. |
| [1805](#L1805) | \* @globals mixed $wpdb |
| [1806](#L1806) | \* @since 2.9 |
| [1807](#L1807) | \*/ |
| [1808](#L1808) | public function wcal\_email\_unsubscribe( $args ) { |
| [1809](#L1809) | global $wpdb; |
| [1810](#L1810) |  |
| [1811](#L1811) | if ( isset( $\_GET['wcal\_track\_unsubscribe'] ) && 'wcal\_unsubscribe' === sanitize\_text\_field( wp\_unslash( $\_GET['wcal\_track\_unsubscribe'] ) ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [1812](#L1812) | $encoded\_email\_id              = isset( $\_GET['validate'] ) ? rawurldecode( sanitize\_text\_field( wp\_unslash( $\_GET['validate'] ) ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [1813](#L1813) | $validate\_email\_id\_string      = str\_replace( ' ', '+', $encoded\_email\_id ); |
| [1814](#L1814) | $validate\_email\_address\_string = ''; |
| [1815](#L1815) | $validate\_email\_id\_decode      = 0; |
| [1816](#L1816) | $crypt\_key                     = ''; |
| [1817](#L1817) | if ( isset( $\_GET['user\_email'] ) && '' !== $\_GET['user\_email'] ) { // phpcs:ignore |
| [1818](#L1818) | $sent\_email = str\_replace( ' ', '+', sanitize\_text\_field( wp\_unslash( $\_GET['user\_email'] ) ) ); // phpcs:ignore |
| [1819](#L1819) | $key\_data   = $wpdb->get\_results( // phpcs:ignore |
| [1820](#L1820) | $wpdb->prepare( |
| [1821](#L1821) | 'SELECT encrypt\_key FROM `' . $wpdb->prefix . 'ac\_sent\_history\_lite` WHERE sent\_email\_id = %s ORDER BY id DESC', |
| [1822](#L1822) | $sent\_email |
| [1823](#L1823) | ) |
| [1824](#L1824) | ); |
| [1825](#L1825) | if ( $wpdb->num\_rows > 0 && isset( $key\_data[0]->encrypt\_key ) ) { |
| [1826](#L1826) | $crypt\_key = $key\_data[0]->encrypt\_key; |
| [1827](#L1827) | } |
| [1828](#L1828) | } |
| [1829](#L1829) | if ( ! empty( $crypt\_key ) && null !== $crypt\_key && '' !== $crypt\_key ) { |
| [1830](#L1830) | $validate\_email\_id\_decode = Wcal\_Aes\_Ctr::decrypt( $validate\_email\_id\_string, $crypt\_key, 256 ); |
| [1831](#L1831) | if ( isset( $\_GET['track\_email\_id'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [1832](#L1832) | $encoded\_email\_address         = rawurldecode( sanitize\_text\_field( wp\_unslash( $\_GET['track\_email\_id'] ) ) ); // phpcs:ignore WordPress.Security.NonceVerification |
| [1833](#L1833) | $validate\_email\_address\_string = str\_replace( ' ', '+', $encoded\_email\_address ); |
| [1834](#L1834) | } |
| [1835](#L1835) |  |
| [1836](#L1836) | $results\_sent  = $wpdb->get\_results( //phpcs:ignore |
| [1837](#L1837) | $wpdb->prepare( |
| [1838](#L1838) | 'SELECT \* FROM `' . $wpdb->prefix . 'ac\_sent\_history\_lite` WHERE id = %d ', |
| [1839](#L1839) | $validate\_email\_id\_decode |
| [1840](#L1840) | ) |
| [1841](#L1841) | ); |
| [1842](#L1842) | $email\_address = ''; |
| [1843](#L1843) | if ( isset( $results\_sent[0] ) ) { |
| [1844](#L1844) | $email\_address = $results\_sent[0]->sent\_email\_id; |
| [1845](#L1845) | } |
| [1846](#L1846) | if ( hash( 'sha256', $email\_address ) === $validate\_email\_address\_string && '' !== $email\_address ) { |
| [1847](#L1847) | $email\_sent\_id     = $validate\_email\_id\_decode; |
| [1848](#L1848) | $get\_ac\_id\_results = $wpdb->get\_results( //phpcs:ignore |
| [1849](#L1849) | $wpdb->prepare( |
| [1850](#L1850) | 'SELECT abandoned\_order\_id FROM `' . $wpdb->prefix . 'ac\_sent\_history\_lite` WHERE id = %d', |
| [1851](#L1851) | $email\_sent\_id |
| [1852](#L1852) | ) |
| [1853](#L1853) | ); |
| [1854](#L1854) | $user\_id           = 0; |
| [1855](#L1855) | if ( isset( $get\_ac\_id\_results[0] ) ) { |
| [1856](#L1856) | $get\_user\_results  = $wpdb->get\_results( //phpcs:ignore |
| [1857](#L1857) | $wpdb->prepare( |
| [1858](#L1858) | 'SELECT user\_id FROM `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` WHERE id = %d', |
| [1859](#L1859) | $get\_ac\_id\_results[0]->abandoned\_order\_id |
| [1860](#L1860) | ) |
| [1861](#L1861) | ); |
| [1862](#L1862) | } |
| [1863](#L1863) | if ( isset( $get\_user\_results[0] ) ) { |
| [1864](#L1864) | $user\_id = $get\_user\_results[0]->user\_id; |
| [1865](#L1865) | } |
| [1866](#L1866) |  |
| [1867](#L1867) | $wpdb->query( //phpcs:ignore |
| [1868](#L1868) | $wpdb->prepare( |
| [1869](#L1869) | 'UPDATE `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` SET unsubscribe\_link = %s WHERE user\_id= %d AND cart\_ignored = %s', |
| [1870](#L1870) | 1, |
| [1871](#L1871) | $user\_id, |
| [1872](#L1872) | 0 |
| [1873](#L1873) | ) |
| [1874](#L1874) | ); |
| [1875](#L1875) | echo esc\_html( 'Unsubscribed Successfully' ); |
| [1876](#L1876) | sleep( 2 ); |
| [1877](#L1877) | $url = apply\_filters( 'wcal\_unsubscribe\_redirect', get\_option( 'home' ) ); |
| [1878](#L1878) | ?> |
| [1879](#L1879) | <script> |
| [1880](#L1880) | location.href = "<?php echo esc\_url( $url ); ?>"; |
| [1881](#L1881) | </script> |
| [1882](#L1882) | <?php |
| [1883](#L1883) | } |
| [1884](#L1884) | } |
| [1885](#L1885) | } else { |
| [1886](#L1886) | return $args; |
| [1887](#L1887) | } |
| [1888](#L1888) | } |
| [1889](#L1889) |  |
| [1890](#L1890) | /\*\* |
| [1891](#L1891) | \* It will track the URL of cart link from email, and it will populate the logged-in and guest users cart. |
| [1892](#L1892) | \* |
| [1893](#L1893) | \* @hook template\_include |
| [1894](#L1894) | \* @param string $template - Template name. |
| [1895](#L1895) | \* @return string $template - Template name. |
| [1896](#L1896) | \* @globals mixed $wpdb |
| [1897](#L1897) | \* @globals mixed $woocommerce |
| [1898](#L1898) | \* @since 1.0 |
| [1899](#L1899) | \*/ |
| [1900](#L1900) | public function wcal\_email\_track\_links( $template ) { |
| [1901](#L1901) | global $woocommerce; |
| [1902](#L1902) |  |
| [1903](#L1903) | $track\_link = isset( $\_GET['wcal\_action'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['wcal\_action'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [1904](#L1904) |  |
| [1905](#L1905) | if ( 'track\_links' === $track\_link || 'checkout\_link' === $track\_link ) { |
| [1906](#L1906) | if ( '' === session\_id() ) { |
| [1907](#L1907) | // session has not started. |
| [1908](#L1908) | session\_start(); |
| [1909](#L1909) | } |
| [1910](#L1910) | global $wpdb; |
| [1911](#L1911) | $validate\_server\_string  = isset( $\_GET ['validate'] ) ? rawurldecode( wp\_unslash( $\_GET ['validate'] ) ) : ''; // phpcs:ignore |
| [1912](#L1912) | $validate\_server\_string  = str\_replace( ' ', '+', $validate\_server\_string ); |
| [1913](#L1913) | $validate\_encoded\_string = $validate\_server\_string; |
| [1914](#L1914) | $crypt\_key               = ''; |
| [1915](#L1915) | $user\_id                 = 0; |
| [1916](#L1916) | $abandoned\_id            = 0; |
| [1917](#L1917) | if ( isset( $\_GET['user\_email'] ) && '' !== $\_GET['user\_email'] ) { // phpcs:ignore |
| [1918](#L1918) | $sent\_email = str\_replace( ' ', '+', sanitize\_text\_field( wp\_unslash( $\_GET['user\_email'] ) ) ); // phpcs:ignore |
| [1919](#L1919) | $key\_data   = $wpdb->get\_results( // phpcs:ignore |
| [1920](#L1920) | $wpdb->prepare( |
| [1921](#L1921) | 'SELECT encrypt\_key FROM `' . $wpdb->prefix . 'ac\_sent\_history\_lite` WHERE sent\_email\_id = %s ORDER BY id DESC', |
| [1922](#L1922) | $sent\_email |
| [1923](#L1923) | ) |
| [1924](#L1924) | ); |
| [1925](#L1925) | if ( $wpdb->num\_rows > 0 && isset( $key\_data[0]->encrypt\_key ) ) { |
| [1926](#L1926) | $crypt\_key = $key\_data[0]->encrypt\_key; |
| [1927](#L1927) | } |
| [1928](#L1928) | } |
| [1929](#L1929) | if ( ! empty( $crypt\_key ) && null !== $crypt\_key && '' !== $crypt\_key ) { |
| [1930](#L1930) | $link\_decode       = Wcal\_Aes\_Ctr::decrypt( $validate\_encoded\_string, $crypt\_key, 256 ); |
| [1931](#L1931) | $sent\_email\_id\_pos = strpos( $link\_decode, '&' ); |
| [1932](#L1932) | $email\_sent\_id     = substr( $link\_decode, 0, $sent\_email\_id\_pos ); |
| [1933](#L1933) |  |
| [1934](#L1934) | if ( isset( $\_GET['c'] ) ) { // phpcs:ignore |
| [1935](#L1935) | $decrypt\_coupon\_code = rawurldecode( sanitize\_text\_field( wp\_unslash( $\_GET['c'] ) ) ); //phpcs:ignore |
| [1936](#L1936) | $decrypt\_coupon\_code = str\_replace( ' ', '+', $decrypt\_coupon\_code ); |
| [1937](#L1937) | $decode\_coupon\_code  = Wcal\_Aes\_Ctr::decrypt( $decrypt\_coupon\_code, $crypt\_key, 256 ); |
| [1938](#L1938) |  |
| [1939](#L1939) | wcal\_common::wcal\_set\_cart\_session( 'wcal\_c', $decode\_coupon\_code ); // we need to set in session coz we directly apply coupon. |
| [1940](#L1940) | set\_transient( 'wcal\_c', $decode\_coupon\_code, 5 ); |
| [1941](#L1941) | } else { |
| [1942](#L1942) | $decode\_coupon\_code = ''; |
| [1943](#L1943) | } |
| [1944](#L1944) |  |
| [1945](#L1945) | if ( 'track\_links' === $track\_link ) { |
| [1946](#L1946) | $email\_sent\_id     = 0; |
| [1947](#L1947) | $sent\_email\_id\_pos = strpos( $link\_decode, '&' ); |
| [1948](#L1948) | $email\_sent\_id     = substr( $link\_decode, 0, $sent\_email\_id\_pos ); |
| [1949](#L1949) |  |
| [1950](#L1950) | wcal\_common::wcal\_set\_cart\_session( 'email\_sent\_id', $email\_sent\_id ); |
| [1951](#L1951) | set\_transient( 'wcal\_email\_sent\_id', $email\_sent\_id, 5 ); |
| [1952](#L1952) |  |
| [1953](#L1953) | $get\_ac\_id\_results = $wpdb->get\_results( // phpcs:ignore |
| [1954](#L1954) | $wpdb->prepare( |
| [1955](#L1955) | 'SELECT abandoned\_order\_id FROM `' . $wpdb->prefix . 'ac\_sent\_history\_lite` WHERE id = %d', |
| [1956](#L1956) | $email\_sent\_id |
| [1957](#L1957) | ) |
| [1958](#L1958) | ); |
| [1959](#L1959) | $abandoned\_id      = $get\_ac\_id\_results[0]->abandoned\_order\_id; |
| [1960](#L1960) | } elseif ( 'checkout\_link' === $track\_link ) { |
| [1961](#L1961) | $abandoned\_id     = 0; |
| [1962](#L1962) | $abandoned\_id\_pos = strpos( $link\_decode, '&' ); |
| [1963](#L1963) | $abandoned\_id     = substr( $link\_decode, 0, $abandoned\_id\_pos ); |
| [1964](#L1964) | wcal\_common::wcal\_set\_cart\_session( 'wcal\_recovered\_cart', true ); |
| [1965](#L1965) | } |
| [1966](#L1966) |  |
| [1967](#L1967) | $url\_pos = strpos( $link\_decode, '=' ); |
| [1968](#L1968) | ++$url\_pos; |
| [1969](#L1969) | $url = substr( $link\_decode, $url\_pos ); |
| [1970](#L1970) |  |
| [1971](#L1971) | wcal\_common::wcal\_set\_cart\_session( 'abandoned\_cart\_id\_lite', $abandoned\_id ); |
| [1972](#L1972) | set\_transient( 'wcal\_abandoned\_id', $abandoned\_id, 5 ); |
| [1973](#L1973) |  |
| [1974](#L1974) | $get\_user\_results = array(); |
| [1975](#L1975) | if ( $abandoned\_id > 0 ) { |
| [1976](#L1976) | $get\_user\_results  = $wpdb->get\_results( //phpcs:ignore |
| [1977](#L1977) | $wpdb->prepare( |
| [1978](#L1978) | 'SELECT user\_id FROM `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` WHERE id = %d', |
| [1979](#L1979) | $abandoned\_id |
| [1980](#L1980) | ) |
| [1981](#L1981) | ); |
| [1982](#L1982) | } |
| [1983](#L1983) | $user\_id = isset( $get\_user\_results ) && count( $get\_user\_results ) > 0 ? (int) $get\_user\_results[0]->user\_id : 0; |
| [1984](#L1984) | } |
| [1985](#L1985) |  |
| [1986](#L1986) | if ( 0 === $user\_id ) { |
| [1987](#L1987) | echo esc\_html( 'Link expired' ); |
| [1988](#L1988) | if ( version\_compare( $woocommerce->version, '3.0.0', '>=' ) ) { |
| [1989](#L1989) | wp\_safe\_redirect( get\_permalink( wc\_get\_page\_id( 'shop' ) ) ); |
| [1990](#L1990) | exit; |
| [1991](#L1991) | } else { |
| [1992](#L1992) | wp\_safe\_redirect( get\_permalink( woocommerce\_get\_page\_id( 'shop' ) ) ); |
| [1993](#L1993) | exit; |
| [1994](#L1994) | } |
| [1995](#L1995) | } |
| [1996](#L1996) | $user = wp\_set\_current\_user( $user\_id ); |
| [1997](#L1997) | if ( $user\_id >= '63000000' ) { |
| [1998](#L1998) | $results\_guest = $wpdb->get\_results( //phpcs:ignore |
| [1999](#L1999) | $wpdb->prepare( |
| [2000](#L2000) | 'SELECT \* from `' . $wpdb->prefix . 'ac\_guest\_abandoned\_cart\_history\_lite` WHERE id = %d', |
| [2001](#L2001) | $user\_id |
| [2002](#L2002) | ) |
| [2003](#L2003) | ); |
| [2004](#L2004) |  |
| [2005](#L2005) | $results = $wpdb->get\_results( //phpcs:ignore |
| [2006](#L2006) | $wpdb->prepare( |
| [2007](#L2007) | 'SELECT recovered\_cart FROM `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` WHERE user\_id = %d', |
| [2008](#L2008) | $user\_id |
| [2009](#L2009) | ) |
| [2010](#L2010) | ); |
| [2011](#L2011) | if ( $results\_guest && '0' == $results[0]->recovered\_cart ) { // phpcs:ignore |
| [2012](#L2012) | wcal\_common::wcal\_set\_cart\_session( 'guest\_first\_name', $results\_guest[0]->billing\_first\_name ); |
| [2013](#L2013) | wcal\_common::wcal\_set\_cart\_session( 'guest\_last\_name', $results\_guest[0]->billing\_last\_name ); |
| [2014](#L2014) | wcal\_common::wcal\_set\_cart\_session( 'guest\_email', $results\_guest[0]->email\_id ); |
| [2015](#L2015) | wcal\_common::wcal\_set\_cart\_session( 'user\_id', $user\_id ); |
| [2016](#L2016) | } else { |
| [2017](#L2017) | if ( version\_compare( $woocommerce->version, '3.0.0', '>=' ) ) { |
| [2018](#L2018) | wp\_safe\_redirect( get\_permalink( wc\_get\_page\_id( 'shop' ) ) ); |
| [2019](#L2019) | exit; |
| [2020](#L2020) | } else { |
| [2021](#L2021) | wp\_safe\_redirect( get\_permalink( woocommerce\_get\_page\_id( 'shop' ) ) ); |
| [2022](#L2022) | exit; |
| [2023](#L2023) | } |
| [2024](#L2024) | } |
| [2025](#L2025) | } |
| [2026](#L2026) |  |
| [2027](#L2027) | if ( $user\_id < '63000000' ) { |
| [2028](#L2028) | $user\_login = $user->data->user\_login; |
| [2029](#L2029) | if ( 'on' === get\_option( 'wcal\_auto\_login\_users', '' ) ) { |
| [2030](#L2030) | wp\_set\_auth\_cookie( $user\_id ); |
| [2031](#L2031) | $my\_temp = wc\_load\_persistent\_cart( $user\_login, $user ); |
| [2032](#L2032) | do\_action( 'wp\_login', $user\_login, $user ); |
| [2033](#L2033) | if ( isset( $sign\_in ) && is\_wp\_error( $sign\_in ) ) { |
| [2034](#L2034) | echo esc\_html( $sign\_in->get\_error\_message() ); |
| [2035](#L2035) | exit; |
| [2036](#L2036) | } |
| [2037](#L2037) | } else { |
| [2038](#L2038) | wp\_set\_auth\_cookie( $user\_id, false, '', 'loggedout' ); |
| [2039](#L2039) | $my\_temp = wc\_load\_persistent\_cart( $user\_login, $user ); |
| [2040](#L2040) | set\_transient( 'wcal\_email\_sent\_id', $email\_sent\_id, 1800 ); |
| [2041](#L2041) | set\_transient( 'wcal\_user\_id', $user\_id, 1800 ); |
| [2042](#L2042) | $url = apply\_filters( 'wcal\_change\_redirect\_link', get\_permalink( wc\_get\_page\_id( 'myaccount' ) ) ); |
| [2043](#L2043) | } |
| [2044](#L2044) | } else { |
| [2045](#L2045) | $my\_temp = $this->wcal\_load\_guest\_persistent\_cart( $user\_id ); |
| [2046](#L2046) | } |
| [2047](#L2047) |  |
| [2048](#L2048) | if ( $email\_sent\_id > 0 && is\_numeric( $email\_sent\_id ) ) { |
| [2049](#L2049) | wp\_safe\_redirect( $url ); |
| [2050](#L2050) | exit; |
| [2051](#L2051) | } |
| [2052](#L2052) | } else { |
| [2053](#L2053) | return $template; |
| [2054](#L2054) | } |
| [2055](#L2055) | } |
| [2056](#L2056) | /\*\* |
| [2057](#L2057) | \* Populate WC Session with values on user login. |
| [2058](#L2058) | \* |
| [2059](#L2059) | \* @since 5.14.0 |
| [2060](#L2060) | \*/ |
| [2061](#L2061) | public static function wcal\_populate\_wc\_session() { |
| [2062](#L2062) | $email\_sent\_id = get\_transient( 'wcal\_email\_sent\_id' ); |
| [2063](#L2063) | $user\_id       = get\_transient( 'wcal\_user\_id' ); |
| [2064](#L2064) | if ( $email\_sent\_id && $user\_id && (int) $email\_sent\_id > 0 && (int) $user\_id > 0 ) { |
| [2065](#L2065) | wcal\_common::wcal\_set\_cart\_session( 'wcal\_email\_sent\_id', $email\_sent\_id ); |
| [2066](#L2066) | wcal\_common::wcal\_set\_cart\_session( 'wcal\_user\_id', $user\_id ); |
| [2067](#L2067) | } |
| [2068](#L2068) | } |
| [2069](#L2069) |  |
| [2070](#L2070) | /\*\* |
| [2071](#L2071) | \* Redirect on cart page after user logged in. |
| [2072](#L2072) | \* |
| [2073](#L2073) | \* @param string $url - URL user is currently on. |
| [2074](#L2074) | \* |
| [2075](#L2075) | \* @since 5.16.0 |
| [2076](#L2076) | \*/ |
| [2077](#L2077) | public static function ts\_redirect\_login( $url ) { |
| [2078](#L2078) |  |
| [2079](#L2079) | if ( get\_transient( 'wcal\_email\_sent\_id' ) ) { |
| [2080](#L2080) | $redirect\_url = wc\_get\_cart\_url(); |
| [2081](#L2081) | return $redirect\_url; |
| [2082](#L2082) | } |
| [2083](#L2083) | return $url; |
| [2084](#L2084) | } |
| [2085](#L2085) |  |
| [2086](#L2086) | /\*\* |
| [2087](#L2087) | \* When customer clicks on the abandoned cart link and that cart is for the the guest users the it will load the guest |
| [2088](#L2088) | \* user's cart detail. |
| [2089](#L2089) | \* |
| [2090](#L2090) | \* @globals mixed $woocommerce |
| [2091](#L2091) | \* @since 1.0 |
| [2092](#L2092) | \*/ |
| [2093](#L2093) | public function wcal\_load\_guest\_persistent\_cart() { |
| [2094](#L2094) | if ( wcal\_common::wcal\_get\_cart\_session( 'user\_id' ) != '' ) { // phpcs:ignore |
| [2095](#L2095) | global $woocommerce; |
| [2096](#L2096) | $saved\_cart = json\_decode( get\_user\_meta( wcal\_common::wcal\_get\_cart\_session( 'user\_id' ), '\_woocommerce\_persistent\_cart', true ), true ); |
| [2097](#L2097) | $c          = array(); |
| [2098](#L2098) |  |
| [2099](#L2099) | $cart\_contents\_total  = 0; |
| [2100](#L2100) | $cart\_contents\_weight = 0; |
| [2101](#L2101) | $cart\_contents\_count  = 0; |
| [2102](#L2102) | $cart\_contents\_tax    = 0; |
| [2103](#L2103) | $total                = 0; |
| [2104](#L2104) | $subtotal             = 0; |
| [2105](#L2105) | $subtotal\_ex\_tax      = 0; |
| [2106](#L2106) | $tax\_total            = 0; |
| [2107](#L2107) | if ( ! is\_null( $saved\_cart ) && isset( $saved\_cart ) && is\_array( $saved\_cart ) && count( $saved\_cart ) > 0 ) { |
| [2108](#L2108) | foreach ( $saved\_cart as $key => $value ) { |
| [2109](#L2109) | if ( is\_array( $value ) && count( $value ) > 0 ) { |
| [2110](#L2110) | foreach ( $value as $a => $b ) { |
| [2111](#L2111) | $c['product\_id']        = $b['product\_id']; |
| [2112](#L2112) | $c['variation\_id']      = $b['variation\_id']; |
| [2113](#L2113) | $c['variation']         = $b['variation']; |
| [2114](#L2114) | $c['quantity']          = $b['quantity']; |
| [2115](#L2115) | $product\_id             = $b['product\_id']; |
| [2116](#L2116) | $c['data']              = wc\_get\_product( $product\_id ); |
| [2117](#L2117) | $c['line\_total']        = $b['line\_total']; |
| [2118](#L2118) | $c['line\_tax']          = $cart\_contents\_tax; |
| [2119](#L2119) | $c['line\_subtotal']     = $b['line\_subtotal']; |
| [2120](#L2120) | $c['line\_subtotal\_tax'] = $cart\_contents\_tax; |
| [2121](#L2121) | $value\_new[ $a ]        = $c; |
| [2122](#L2122) | $cart\_contents\_total    = $b['line\_subtotal'] + $cart\_contents\_total; |
| [2123](#L2123) | $cart\_contents\_count    = $cart\_contents\_count + $b['quantity']; |
| [2124](#L2124) | $total                  = $total + $b['line\_total']; |
| [2125](#L2125) | $subtotal               = $subtotal + $b['line\_subtotal']; |
| [2126](#L2126) | $subtotal\_ex\_tax        = $subtotal\_ex\_tax + $b['line\_subtotal']; |
| [2127](#L2127) | } |
| [2128](#L2128) | $saved\_cart\_data[ $key ] = $value\_new; |
| [2129](#L2129) | $woocommerce\_cart\_hash   = $a; |
| [2130](#L2130) | } |
| [2131](#L2131) | } |
| [2132](#L2132) | } |
| [2133](#L2133) |  |
| [2134](#L2134) | if ( $saved\_cart ) { |
| [2135](#L2135) | if ( empty( $woocommerce->session->cart ) || ! is\_array( $woocommerce->session->cart ) || 0 === count( $woocommerce->session->cart ) ) { |
| [2136](#L2136) | $woocommerce->session->cart                 = $saved\_cart['cart']; |
| [2137](#L2137) | $woocommerce->session->cart\_contents\_total  = $cart\_contents\_total; |
| [2138](#L2138) | $woocommerce->session->cart\_contents\_weight = $cart\_contents\_weight; |
| [2139](#L2139) | $woocommerce->session->cart\_contents\_count  = $cart\_contents\_count; |
| [2140](#L2140) | $woocommerce->session->cart\_contents\_tax    = $cart\_contents\_tax; |
| [2141](#L2141) | $woocommerce->session->total                = $total; |
| [2142](#L2142) | $woocommerce->session->subtotal             = $subtotal; |
| [2143](#L2143) | $woocommerce->session->subtotal\_ex\_tax      = $subtotal\_ex\_tax; |
| [2144](#L2144) | $woocommerce->session->tax\_total            = $tax\_total; |
| [2145](#L2145) | $woocommerce->session->shipping\_taxes       = array(); |
| [2146](#L2146) | $woocommerce->session->taxes                = array(); |
| [2147](#L2147) | $woocommerce->session->ac\_customer          = array(); |
| [2148](#L2148) | $woocommerce->cart->cart\_contents           = $saved\_cart\_data['cart']; |
| [2149](#L2149) | $woocommerce->cart->cart\_contents\_total     = $cart\_contents\_total; |
| [2150](#L2150) | $woocommerce->cart->cart\_contents\_weight    = $cart\_contents\_weight; |
| [2151](#L2151) | $woocommerce->cart->cart\_contents\_count     = $cart\_contents\_count; |
| [2152](#L2152) | $woocommerce->cart->cart\_contents\_tax       = $cart\_contents\_tax; |
| [2153](#L2153) | $woocommerce->cart->total                   = $total; |
| [2154](#L2154) | $woocommerce->cart->subtotal                = $subtotal; |
| [2155](#L2155) | $woocommerce->cart->subtotal\_ex\_tax         = $subtotal\_ex\_tax; |
| [2156](#L2156) | $woocommerce->cart->tax\_total               = $tax\_total; |
| [2157](#L2157) | } |
| [2158](#L2158) | } |
| [2159](#L2159) | } |
| [2160](#L2160) | } |
| [2161](#L2161) |  |
| [2162](#L2162) | /\*\* |
| [2163](#L2163) | \* It will compare only guest users cart while capturing the cart. |
| [2164](#L2164) | \* |
| [2165](#L2165) | \* @param json\_encode $new\_cart New abandoned cart details. |
| [2166](#L2166) | \* @param json\_encode $last\_abandoned\_cart Old abandoned cart details. |
| [2167](#L2167) | \* @return boolean true | false. |
| [2168](#L2168) | \* @since 1.0 |
| [2169](#L2169) | \*/ |
| [2170](#L2170) | public function wcal\_compare\_only\_guest\_carts( $new\_cart, $last\_abandoned\_cart ) { |
| [2171](#L2171) | $current\_woo\_cart   = array(); |
| [2172](#L2172) | $current\_woo\_cart   = json\_decode( stripslashes( $new\_cart ), true ); |
| [2173](#L2173) | $abandoned\_cart\_arr = array(); |
| [2174](#L2174) | $abandoned\_cart\_arr = json\_decode( $last\_abandoned\_cart, true ); |
| [2175](#L2175) | $temp\_variable      = ''; |
| [2176](#L2176) | if ( isset( $current\_woo\_cart['cart'] ) && isset( $abandoned\_cart\_arr['cart'] ) ) { |
| [2177](#L2177) | if ( count( $current\_woo\_cart['cart'] ) >= count( $abandoned\_cart\_arr['cart'] ) ) { // phpcs:ignore |
| [2178](#L2178) | // do nothing. |
| [2179](#L2179) | } else { |
| [2180](#L2180) | $temp\_variable      = $current\_woo\_cart; |
| [2181](#L2181) | $current\_woo\_cart   = $abandoned\_cart\_arr; |
| [2182](#L2182) | $abandoned\_cart\_arr = $temp\_variable; |
| [2183](#L2183) | } |
| [2184](#L2184) | if ( is\_array( $current\_woo\_cart ) || is\_object( $current\_woo\_cart ) ) { |
| [2185](#L2185) | foreach ( $current\_woo\_cart as $key => $value ) { |
| [2186](#L2186) | foreach ( $value as $item\_key => $item\_value ) { |
| [2187](#L2187) | $current\_cart\_product\_id   = $item\_value['product\_id']; |
| [2188](#L2188) | $current\_cart\_variation\_id = $item\_value['variation\_id']; |
| [2189](#L2189) | $current\_cart\_quantity     = $item\_value['quantity']; |
| [2190](#L2190) |  |
| [2191](#L2191) | if ( isset( $abandoned\_cart\_arr[ $key ][ $item\_key ]['product\_id'] ) ) { |
| [2192](#L2192) | $abandoned\_cart\_product\_id = $abandoned\_cart\_arr[ $key ][ $item\_key ]['product\_id']; |
| [2193](#L2193) | } else { |
| [2194](#L2194) | $abandoned\_cart\_product\_id = ''; |
| [2195](#L2195) | } |
| [2196](#L2196) | if ( isset( $abandoned\_cart\_arr[ $key ][ $item\_key ]['variation\_id'] ) ) { |
| [2197](#L2197) | $abandoned\_cart\_variation\_id = $abandoned\_cart\_arr[ $key ][ $item\_key ]['variation\_id']; |
| [2198](#L2198) | } else { |
| [2199](#L2199) | $abandoned\_cart\_variation\_id = ''; |
| [2200](#L2200) | } |
| [2201](#L2201) | if ( isset( $abandoned\_cart\_arr[ $key ][ $item\_key ]['quantity'] ) ) { |
| [2202](#L2202) | $abandoned\_cart\_quantity = $abandoned\_cart\_arr[ $key ][ $item\_key ]['quantity']; |
| [2203](#L2203) | } else { |
| [2204](#L2204) | $abandoned\_cart\_quantity = ''; |
| [2205](#L2205) | } |
| [2206](#L2206) | if ( ( $current\_cart\_product\_id != $abandoned\_cart\_product\_id ) || ( $current\_cart\_variation\_id != $abandoned\_cart\_variation\_id ) || ( $current\_cart\_quantity != $abandoned\_cart\_quantity ) ) { // phpcs:ignore |
| [2207](#L2207) | return false; |
| [2208](#L2208) | } |
| [2209](#L2209) | } |
| [2210](#L2210) | } |
| [2211](#L2211) | } |
| [2212](#L2212) | } |
| [2213](#L2213) | return true; |
| [2214](#L2214) | } |
| [2215](#L2215) |  |
| [2216](#L2216) | /\*\* |
| [2217](#L2217) | \* It will compare only loggedin users cart while capturing the cart. |
| [2218](#L2218) | \* |
| [2219](#L2219) | \* @param int | string $user\_id User id. |
| [2220](#L2220) | \* @param json\_encode  $last\_abandoned\_cart Old abandoned cart details. |
| [2221](#L2221) | \* @return boolean true | false. |
| [2222](#L2222) | \* @since 1.0 |
| [2223](#L2223) | \*/ |
| [2224](#L2224) | public function wcal\_compare\_carts( $user\_id, $last\_abandoned\_cart ) { |
| [2225](#L2225) | global $woocommerce; |
| [2226](#L2226) | $current\_woo\_cart                 = array(); |
| [2227](#L2227) | $abandoned\_cart\_arr               = array(); |
| [2228](#L2228) | $wcal\_woocommerce\_persistent\_cart = version\_compare( $woocommerce->version, '3.1.0', '>=' ) ? '\_woocommerce\_persistent\_cart\_' . get\_current\_blog\_id() : '\_woocommerce\_persistent\_cart'; |
| [2229](#L2229) | $current\_woo\_cart                 = get\_user\_meta( $user\_id, $wcal\_woocommerce\_persistent\_cart, true ); |
| [2230](#L2230) | $abandoned\_cart\_arr               = json\_decode( $last\_abandoned\_cart, true ); |
| [2231](#L2231) | $temp\_variable                    = ''; |
| [2232](#L2232) | if ( isset( $current\_woo\_cart['cart'] ) && isset( $abandoned\_cart\_arr['cart'] ) ) { |
| [2233](#L2233) | if ( count( $current\_woo\_cart['cart'] ) >= count( $abandoned\_cart\_arr['cart'] ) ) { // phpcs:ignore |
| [2234](#L2234) | // do nothing. |
| [2235](#L2235) | } else { |
| [2236](#L2236) | $temp\_variable      = $current\_woo\_cart; |
| [2237](#L2237) | $current\_woo\_cart   = $abandoned\_cart\_arr; |
| [2238](#L2238) | $abandoned\_cart\_arr = $temp\_variable; |
| [2239](#L2239) | } |
| [2240](#L2240) | if ( is\_array( $current\_woo\_cart ) && is\_array( $abandoned\_cart\_arr ) ) { |
| [2241](#L2241) | foreach ( $current\_woo\_cart as $key => $value ) { |
| [2242](#L2242) |  |
| [2243](#L2243) | foreach ( $value as $item\_key => $item\_value ) { |
| [2244](#L2244) | $current\_cart\_product\_id   = $item\_value['product\_id']; |
| [2245](#L2245) | $current\_cart\_variation\_id = $item\_value['variation\_id']; |
| [2246](#L2246) | $current\_cart\_quantity     = $item\_value['quantity']; |
| [2247](#L2247) |  |
| [2248](#L2248) | if ( isset( $abandoned\_cart\_arr[ $key ][ $item\_key ]['product\_id'] ) ) { |
| [2249](#L2249) | $abandoned\_cart\_product\_id = $abandoned\_cart\_arr[ $key ][ $item\_key ]['product\_id']; |
| [2250](#L2250) | } else { |
| [2251](#L2251) | $abandoned\_cart\_product\_id = ''; |
| [2252](#L2252) | } |
| [2253](#L2253) | if ( isset( $abandoned\_cart\_arr[ $key ][ $item\_key ]['variation\_id'] ) ) { |
| [2254](#L2254) | $abandoned\_cart\_variation\_id = $abandoned\_cart\_arr[ $key ][ $item\_key ]['variation\_id']; |
| [2255](#L2255) | } else { |
| [2256](#L2256) | $abandoned\_cart\_variation\_id = ''; |
| [2257](#L2257) | } |
| [2258](#L2258) | if ( isset( $abandoned\_cart\_arr[ $key ][ $item\_key ]['quantity'] ) ) { |
| [2259](#L2259) | $abandoned\_cart\_quantity = $abandoned\_cart\_arr[ $key ][ $item\_key ]['quantity']; |
| [2260](#L2260) | } else { |
| [2261](#L2261) | $abandoned\_cart\_quantity = ''; |
| [2262](#L2262) | } |
| [2263](#L2263) | if ( ( $current\_cart\_product\_id != $abandoned\_cart\_product\_id ) || ( $current\_cart\_variation\_id != $abandoned\_cart\_variation\_id ) || ( $current\_cart\_quantity != $abandoned\_cart\_quantity ) ) { // phpcs:ignore |
| [2264](#L2264) | return false; |
| [2265](#L2265) | } |
| [2266](#L2266) | } |
| [2267](#L2267) | } |
| [2268](#L2268) | } |
| [2269](#L2269) | } |
| [2270](#L2270) | return true; |
| [2271](#L2271) | } |
| [2272](#L2272) |  |
| [2273](#L2273) | /\*\* |
| [2274](#L2274) | \* It will add the wp editor for email body on the email edit page. |
| [2275](#L2275) | \* |
| [2276](#L2276) | \* @hook admin\_init |
| [2277](#L2277) | \* @since 2.6 |
| [2278](#L2278) | \*/ |
| [2279](#L2279) | public function wcal\_action\_admin\_init() { |
| [2280](#L2280) |  |
| [2281](#L2281) | // only hook up these filters if we're in the admin panel and the current user has permission. |
| [2282](#L2282) | // to edit posts and pages. |
| [2283](#L2283) | if ( ! isset( $\_GET['page'] ) || 'woocommerce\_ac\_page' !== sanitize\_text\_field( wp\_unslash( $\_GET['page'] ) ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [2284](#L2284) | return; |
| [2285](#L2285) | } |
| [2286](#L2286) | if ( ! current\_user\_can( 'edit\_posts' ) && ! current\_user\_can( 'edit\_pages' ) ) { |
| [2287](#L2287) | return; |
| [2288](#L2288) | } |
| [2289](#L2289) | if ( 'true' === get\_user\_option( 'rich\_editing' ) ) { |
| [2290](#L2290) | remove\_filter( 'the\_excerpt', 'wpautop' ); |
| [2291](#L2291) | add\_filter( 'tiny\_mce\_before\_init', array( &$this, 'wcal\_format\_tiny\_mce' ) ); |
| [2292](#L2292) | add\_filter( 'mce\_buttons', array( &$this, 'wcal\_filter\_mce\_button' ) ); |
| [2293](#L2293) | add\_filter( 'mce\_external\_plugins', array( &$this, 'wcal\_filter\_mce\_plugin' ) ); |
| [2294](#L2294) | } |
| [2295](#L2295) | } |
| [2296](#L2296) |  |
| [2297](#L2297) | /\*\* |
| [2298](#L2298) | \* It will create a button on the WordPress editor. |
| [2299](#L2299) | \* |
| [2300](#L2300) | \* @hook mce\_buttons |
| [2301](#L2301) | \* @param array $buttons - List of buttons. |
| [2302](#L2302) | \* @return array $buttons - List of buttons. |
| [2303](#L2303) | \* @since 2.6 |
| [2304](#L2304) | \*/ |
| [2305](#L2305) | public function wcal\_filter\_mce\_button( $buttons ) { |
| [2306](#L2306) | // add a separation before our button, here our button's id is abandoncart. |
| [2307](#L2307) | array\_push( $buttons, 'abandoncart', '|' ); |
| [2308](#L2308) | return $buttons; |
| [2309](#L2309) | } |
| [2310](#L2310) |  |
| [2311](#L2311) | /\*\* |
| [2312](#L2312) | \* It will add the list for the added extra button. |
| [2313](#L2313) | \* |
| [2314](#L2314) | \* @hook mce\_external\_plugins |
| [2315](#L2315) | \* @param array $plugins - Plugins. |
| [2316](#L2316) | \* @return array $plugins - Plugins. |
| [2317](#L2317) | \* @since 2.6 |
| [2318](#L2318) | \*/ |
| [2319](#L2319) | public function wcal\_filter\_mce\_plugin( $plugins ) { |
| [2320](#L2320) | // this plugin file will work the magic of our button. |
| [2321](#L2321) | $plugins['abandoncart'] = plugin\_dir\_url( \_\_FILE\_\_ ) . 'assets/js/abandoncart\_plugin\_button.js'; |
| [2322](#L2322) | return $plugins; |
| [2323](#L2323) | } |
| [2324](#L2324) |  |
| [2325](#L2325) | /\*\* |
| [2326](#L2326) | \* It will add the tabs on the Abandoned cart page. |
| [2327](#L2327) | \* |
| [2328](#L2328) | \* @since 1.0 |
| [2329](#L2329) | \*/ |
| [2330](#L2330) | public function wcal\_display\_tabs() { |
| [2331](#L2331) |  |
| [2332](#L2332) | $action                = ''; |
| [2333](#L2333) | $active\_listcart       = ''; |
| [2334](#L2334) | $active\_emailtemplates = ''; |
| [2335](#L2335) | $active\_settings       = ''; |
| [2336](#L2336) | $active\_stats          = ''; |
| [2337](#L2337) | $active\_dash           = ''; |
| [2338](#L2338) |  |
| [2339](#L2339) | if ( isset( $\_GET['action'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [2340](#L2340) | $action = sanitize\_text\_field( wp\_unslash( $\_GET['action'] ) ); // phpcs:ignore WordPress.Security.NonceVerification |
| [2341](#L2341) | } else { |
| [2342](#L2342) | $action = ''; |
| [2343](#L2343) | $action = apply\_filters( 'wcal\_default\_tab', $action ); |
| [2344](#L2344) | } |
| [2345](#L2345) |  |
| [2346](#L2346) | switch ( $action ) { |
| [2347](#L2347) | case '': |
| [2348](#L2348) | case 'dashboard': |
| [2349](#L2349) | $active\_dash = 'nav-tab-active'; |
| [2350](#L2350) | break; |
| [2351](#L2351) | case 'listcart': |
| [2352](#L2352) | case 'orderdetails': |
| [2353](#L2353) | $active\_listcart = 'nav-tab-active'; |
| [2354](#L2354) | break; |
| [2355](#L2355) | case 'emailtemplates': |
| [2356](#L2356) | $active\_emailtemplates = 'nav-tab-active'; |
| [2357](#L2357) | break; |
| [2358](#L2358) | case 'emailsettings': |
| [2359](#L2359) | $active\_settings = 'nav-tab-active'; |
| [2360](#L2360) | break; |
| [2361](#L2361) | case 'stats': |
| [2362](#L2362) | $active\_stats = 'nav-tab-active'; |
| [2363](#L2363) | break; |
| [2364](#L2364) | case 'report': |
| [2365](#L2365) | $active\_report = 'nav-tab-active'; |
| [2366](#L2366) | break; |
| [2367](#L2367) | } |
| [2368](#L2368) |  |
| [2369](#L2369) | ?> |
| [2370](#L2370) | <div style="background-image: url('<?php echo esc\_url( plugins\_url( '/assets/images/ac\_tab\_icon.png', \_\_FILE\_\_ ) ); ?>') !important;" class="icon32"><br> |
| [2371](#L2371) | </div> |
| [2372](#L2372) | <h2 class="nav-tab-wrapper woo-nav-tab-wrapper"> |
| [2373](#L2373) | <a href="admin.php?page=woocommerce\_ac\_page&action=dashboard" class="nav-tab |
| [2374](#L2374) | <?php |
| [2375](#L2375) | if ( isset( $active\_dash ) ) { |
| [2376](#L2376) | echo esc\_attr( $active\_dash ); |
| [2377](#L2377) | } |
| [2378](#L2378) | ?> |
| [2379](#L2379) | "> <?php esc\_html\_e( 'Dashboard', 'woocommerce-abandoned-cart' ); ?> </a> |
| [2380](#L2380) | <a href="admin.php?page=woocommerce\_ac\_page&action=listcart" class="nav-tab |
| [2381](#L2381) | <?php |
| [2382](#L2382) | if ( isset( $active\_listcart ) ) { |
| [2383](#L2383) | echo esc\_attr( $active\_listcart ); |
| [2384](#L2384) | } |
| [2385](#L2385) | ?> |
| [2386](#L2386) | "> <?php esc\_html\_e( 'Abandoned Orders', 'woocommerce-abandoned-cart' ); ?> </a> |
| [2387](#L2387) | <a href="admin.php?page=woocommerce\_ac\_page&action=emailtemplates" class="nav-tab |
| [2388](#L2388) | <?php |
| [2389](#L2389) | if ( isset( $active\_emailtemplates ) ) { |
| [2390](#L2390) | echo esc\_attr( $active\_emailtemplates ); |
| [2391](#L2391) | } |
| [2392](#L2392) | ?> |
| [2393](#L2393) | "> <?php esc\_html\_e( 'Email Templates', 'woocommerce-abandoned-cart' ); ?> </a> |
| [2394](#L2394) | <a href="admin.php?page=woocommerce\_ac\_page&action=emailsettings" class="nav-tab |
| [2395](#L2395) | <?php |
| [2396](#L2396) | if ( isset( $active\_settings ) ) { |
| [2397](#L2397) | echo esc\_attr( $active\_settings ); |
| [2398](#L2398) | } |
| [2399](#L2399) | ?> |
| [2400](#L2400) | "> <?php esc\_html\_e( 'Settings', 'woocommerce-abandoned-cart' ); ?> </a> |
| [2401](#L2401) | <a href="admin.php?page=woocommerce\_ac\_page&action=stats" class="nav-tab |
| [2402](#L2402) | <?php |
| [2403](#L2403) | if ( isset( $active\_stats ) ) { |
| [2404](#L2404) | echo esc\_attr( $active\_stats ); |
| [2405](#L2405) | } |
| [2406](#L2406) | ?> |
| [2407](#L2407) | "> <?php esc\_html\_e( 'Recovered Orders', 'woocommerce-abandoned-cart' ); ?> </a> |
| [2408](#L2408) | <a href="admin.php?page=woocommerce\_ac\_page&action=report" class="nav-tab |
| [2409](#L2409) | <?php |
| [2410](#L2410) | if ( isset( $active\_report ) ) { |
| [2411](#L2411) | echo esc\_attr( $active\_report ); |
| [2412](#L2412) | } |
| [2413](#L2413) | ?> |
| [2414](#L2414) | "> <?php esc\_html\_e( 'Product Report', 'woocommerce-abandoned-cart' ); ?> </a> |
| [2415](#L2415) |  |
| [2416](#L2416) | <?php do\_action( 'wcal\_add\_settings\_tab' ); ?> |
| [2417](#L2417) | </h2> |
| [2418](#L2418) | <?php |
| [2419](#L2419) | } |
| [2420](#L2420) |  |
| [2421](#L2421) | /\*\* |
| [2422](#L2422) | \* It will add the scripts needed for the plugin. |
| [2423](#L2423) | \* |
| [2424](#L2424) | \* @hook admin\_enqueue\_scripts |
| [2425](#L2425) | \* @param string $hook Name of hook. |
| [2426](#L2426) | \* @since 1.0 |
| [2427](#L2427) | \*/ |
| [2428](#L2428) | public function wcal\_enqueue\_scripts\_js( $hook ) { |
| [2429](#L2429) | global $pagenow, $woocommerce; |
| [2430](#L2430) | $page   = isset( $\_GET['page'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['page'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [2431](#L2431) | $action = isset( $\_GET['action'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['action'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [2432](#L2432) |  |
| [2433](#L2433) | // Tyche JS constructor - needed for deactivation survey. |
| [2434](#L2434) | wp\_register\_script( |
| [2435](#L2435) | 'wcal\_tyche', |
| [2436](#L2436) | WCAL\_PLUGIN\_URL . '/assets/js/tyche.js', |
| [2437](#L2437) | array( 'jquery' ), |
| [2438](#L2438) | 1.1, |
| [2439](#L2439) | true |
| [2440](#L2440) | ); |
| [2441](#L2441) | wp\_enqueue\_script( 'wcal\_tyche' ); |
| [2442](#L2442) | if ( '' === $page || 'woocommerce\_ac\_page' !== $page ) { |
| [2443](#L2443) | return; |
| [2444](#L2444) | } else { |
| [2445](#L2445) | wp\_enqueue\_script( 'jquery' ); |
| [2446](#L2446) | wp\_enqueue\_script( 'jquery-ui-core' ); |
| [2447](#L2447) |  |
| [2448](#L2448) | wp\_enqueue\_script( 'jquery-ui-datepicker' ); |
| [2449](#L2449) | wp\_enqueue\_script( |
| [2450](#L2450) | 'jquery-tip', |
| [2451](#L2451) | plugins\_url( '/assets/js/jquery.tipTip.minified.js', \_\_FILE\_\_ ), |
| [2452](#L2452) | '', |
| [2453](#L2453) | WCAL\_PLUGIN\_VERSION, |
| [2454](#L2454) | false |
| [2455](#L2455) | ); |
| [2456](#L2456) | $mode         = isset( $\_GET['mode'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['mode'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [2457](#L2457) | $wcal\_section = isset( $\_GET['wcal\_section'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['wcal\_section'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [2458](#L2458) | if ( ( 'emailtemplates' === $action && ( 'addnewtemplate' === $mode || 'edittemplate' === $mode ) ) ) { |
| [2459](#L2459) | wp\_register\_script( 'woocommerce\_admin', WC()->plugin\_url() . '/assets/js/admin/woocommerce\_admin.min.js', array( 'jquery', 'jquery-tiptip' ), WCAL\_PLUGIN\_VERSION, false ); |
| [2460](#L2460) | wp\_enqueue\_script( 'woocommerce\_admin' ); |
| [2461](#L2461) | $locale  = localeconv(); |
| [2462](#L2462) | $decimal = isset( $locale['decimal\_point'] ) ? $locale['decimal\_point'] : '.'; |
| [2463](#L2463) | $params  = array( |
| [2464](#L2464) | // translators: %s: decimal. |
| [2465](#L2465) | 'i18n\_decimal\_error'               => sprintf( \_\_( 'Please enter in decimal (%s) format without thousand separators.', 'woocommerce' ), $decimal ), |
| [2466](#L2466) | // translators: %s: price decimal separator. |
| [2467](#L2467) | 'i18n\_mon\_decimal\_error'           => sprintf( \_\_( 'Please enter in monetary decimal (%s) format without thousand separators and currency symbols.', 'woocommerce' ), wc\_get\_price\_decimal\_separator() ), |
| [2468](#L2468) | 'i18n\_country\_iso\_error'           => \_\_( 'Please enter in country code with two capital letters.', 'woocommerce' ), |
| [2469](#L2469) | 'i18\_sale\_less\_than\_regular\_error' => \_\_( 'Please enter in a value less than the regular price.', 'woocommerce' ), |
| [2470](#L2470) | 'decimal\_point'                    => $decimal, |
| [2471](#L2471) | 'mon\_decimal\_point'                => wc\_get\_price\_decimal\_separator(), |
| [2472](#L2472) | 'strings'                          => array( |
| [2473](#L2473) | 'import\_products' => \_\_( 'Import', 'woocommerce' ), |
| [2474](#L2474) | 'export\_products' => \_\_( 'Export', 'woocommerce' ), |
| [2475](#L2475) | ), |
| [2476](#L2476) | 'urls'                             => array( |
| [2477](#L2477) | 'import\_products' => esc\_url\_raw( admin\_url( 'edit.php?post\_type=product&page=product\_importer' ) ), |
| [2478](#L2478) | 'export\_products' => esc\_url\_raw( admin\_url( 'edit.php?post\_type=product&page=product\_exporter' ) ), |
| [2479](#L2479) | ), |
| [2480](#L2480) | ); |
| [2481](#L2481) |  |
| [2482](#L2482) | // If we dont localize this script then from the WooCommerce check it will not run the javascript further and tooltip wont show any data. |
| [2483](#L2483) | // Also, we need above all parameters for the WooCoomerce js file. So we have taken it from the WooCommerce. @since: 5.1.2. |
| [2484](#L2484) | wp\_localize\_script( 'woocommerce\_admin', 'woocommerce\_admin', $params ); |
| [2485](#L2485) | } |
| [2486](#L2486) |  |
| [2487](#L2487) | $js\_src = includes\_url( 'js/tinymce/' ) . 'tinymce.min.js'; |
| [2488](#L2488) | wp\_enqueue\_script( 'tinyMce\_ac', $js\_src, '', WCAL\_PLUGIN\_VERSION, false ); |
| [2489](#L2489) | wp\_enqueue\_script( |
| [2490](#L2490) | 'ac\_email\_variables', |
| [2491](#L2491) | plugins\_url( '/assets/js/abandoncart\_plugin\_button.js', \_\_FILE\_\_ ), |
| [2492](#L2492) | '', |
| [2493](#L2493) | WCAL\_PLUGIN\_VERSION, |
| [2494](#L2494) | false |
| [2495](#L2495) | ); |
| [2496](#L2496) | wp\_enqueue\_script( |
| [2497](#L2497) | 'wcal\_email\_template', |
| [2498](#L2498) | plugins\_url( '/assets/js/admin/wcal\_email\_templates.js', \_\_FILE\_\_ ), |
| [2499](#L2499) | '', |
| [2500](#L2500) | WCAL\_PLUGIN\_VERSION, |
| [2501](#L2501) | false |
| [2502](#L2502) | ); |
| [2503](#L2503) |  |
| [2504](#L2504) | wp\_localize\_script( |
| [2505](#L2505) | 'wcal\_email\_template', |
| [2506](#L2506) | 'wcal\_templates\_params', |
| [2507](#L2507) | array( |
| [2508](#L2508) | 'wcal\_status\_nonce'              => wp\_create\_nonce( 'wcal\_update\_template\_status' ), |
| [2509](#L2509) | 'wcal\_test\_email\_incorrect\_input\_msg' => \_\_( 'Please enter a valid email.', 'woocommerce-abandoned-cart' ), |
| [2510](#L2510) | 'wcal\_test\_email\_default\_header' => \_\_( 'Abandoned Cart Reminder', 'woocommerce-abandoned-cart' ), |
| [2511](#L2511) | 'wcal\_test\_email\_empty\_body\_msg' => \_\_( 'Test email is not sent as the email body is empty.', 'woocommerce-abandoned-cart' ), |
| [2512](#L2512) | 'wcal\_email\_sent\_image\_path'     => WCAL\_PLUGIN\_URL . '/assets/images/check.jpg', |
| [2513](#L2513) | 'wcal\_test\_email\_success\_msg'    => \_\_( 'Email has been sent successfully.', 'woocommerce-abandoned-cart' ), |
| [2514](#L2514) | 'wcal\_test\_email\_nonce'          => wp\_create\_nonce( 'wcal\_send\_test\_email' ), |
| [2515](#L2515) | ) |
| [2516](#L2516) | ); |
| [2517](#L2517) | // Needed only on the dashboard page. |
| [2518](#L2518) | if ( 'woocommerce\_ac\_page' === $page && ( '' === $action || 'dashboard' === $action ) ) { |
| [2519](#L2519) | wp\_register\_script( 'jquery-ui-datepicker', WC()->plugin\_url() . '/assets/js/admin/ui-datepicker.js', '', WCAL\_PLUGIN\_VERSION, false ); |
| [2520](#L2520) | wp\_enqueue\_script( 'jquery-ui-datepicker' ); |
| [2521](#L2521) |  |
| [2522](#L2522) | wp\_enqueue\_script( |
| [2523](#L2523) | 'bootstrap\_js', |
| [2524](#L2524) | plugins\_url( '/assets/js/admin/bootstrap.min.js', \_\_FILE\_\_ ), |
| [2525](#L2525) | '', |
| [2526](#L2526) | WCAL\_PLUGIN\_VERSION, |
| [2527](#L2527) | false |
| [2528](#L2528) | ); |
| [2529](#L2529) |  |
| [2530](#L2530) | wp\_enqueue\_script( |
| [2531](#L2531) | 'd3\_js', |
| [2532](#L2532) | WCAL\_PLUGIN\_URL . '/assets/js/admin/d3.v3.min.js', |
| [2533](#L2533) | '', |
| [2534](#L2534) | WCAL\_PLUGIN\_VERSION, |
| [2535](#L2535) | false |
| [2536](#L2536) | ); |
| [2537](#L2537) |  |
| [2538](#L2538) | wp\_register\_script( |
| [2539](#L2539) | 'reports\_js', |
| [2540](#L2540) | plugins\_url( '/assets/js/admin/wcal\_adv\_dashboard.min.js', \_\_FILE\_\_ ), |
| [2541](#L2541) | '', |
| [2542](#L2542) | WCAL\_PLUGIN\_VERSION, |
| [2543](#L2543) | false |
| [2544](#L2544) | ); |
| [2545](#L2545) | } |
| [2546](#L2546) | // Needed only on the abandoned orders page. |
| [2547](#L2547) | wp\_enqueue\_script( |
| [2548](#L2548) | 'wcal\_abandoned\_cart\_details', |
| [2549](#L2549) | plugins\_url( '/assets/js/admin/wcal\_abandoned\_cart\_detail\_modal.min.js', \_\_FILE\_\_ ), |
| [2550](#L2550) | '', |
| [2551](#L2551) | WCAL\_PLUGIN\_VERSION, |
| [2552](#L2552) | false |
| [2553](#L2553) | ); |
| [2554](#L2554) |  |
| [2555](#L2555) | wp\_localize\_script( |
| [2556](#L2556) | 'wcal\_abandoned\_cart\_details', |
| [2557](#L2557) | 'wcal\_details\_modal\_params', |
| [2558](#L2558) | array( |
| [2559](#L2559) | 'wcal\_details\_modal\_nonce' => wp\_create\_nonce( 'wcal\_cart\_details\_nonce' ), |
| [2560](#L2560) | ) |
| [2561](#L2561) | ); |
| [2562](#L2562) |  |
| [2563](#L2563) | wp\_enqueue\_script( |
| [2564](#L2564) | 'wcal\_admin\_notices', |
| [2565](#L2565) | plugins\_url( '/assets/js/admin/wcal\_ts\_dismiss\_notice.js', \_\_FILE\_\_ ), |
| [2566](#L2566) | '', |
| [2567](#L2567) | WCAL\_PLUGIN\_VERSION, |
| [2568](#L2568) | false |
| [2569](#L2569) | ); |
| [2570](#L2570) | wp\_localize\_script( |
| [2571](#L2571) | 'wcal\_admin\_notices', |
| [2572](#L2572) | 'wcal\_dismiss\_params', |
| [2573](#L2573) | array( |
| [2574](#L2574) | 'ajax\_url'                       => admin\_url( 'admin-ajax.php' ), |
| [2575](#L2575) | 'ajax\_nonce'                     => wp\_create\_nonce( 'delete\_expired\_used\_coupon\_code' ), |
| [2576](#L2576) | 'delete\_coupon\_confirmation\_msg' => \_\_( 'Are you sure you want delete the expired and used coupons created by Abandonment Cart Lite for WooCommerce Plugin?', 'woocommerce-abandoned-cart' ), |
| [2577](#L2577) | 'dismiss\_notice\_nonce'           => wp\_create\_nonce( 'wcal\_dismiss\_notice' ), |
| [2578](#L2578) | ) |
| [2579](#L2579) | ); |
| [2580](#L2580) | wp\_register\_script( 'enhanced', plugins\_url() . '/woocommerce/assets/js/admin/wc-enhanced-select.js', array( 'jquery', 'select2' ), WCAL\_PLUGIN\_VERSION, false ); |
| [2581](#L2581) |  |
| [2582](#L2582) | wp\_localize\_script( |
| [2583](#L2583) | 'enhanced', |
| [2584](#L2584) | 'wc\_enhanced\_select\_params', |
| [2585](#L2585) | array( |
| [2586](#L2586) | 'i18n\_matches\_1'            => \_x( 'One result is available, press enter to select it.', 'enhanced select', 'woocommerce' ), |
| [2587](#L2587) | 'i18n\_matches\_n'            => \_x( '%qty% results are available, use up and down arrow keys to navigate.', 'enhanced select', 'woocommerce' ), |
| [2588](#L2588) | 'i18n\_no\_matches'           => \_x( 'No matches found', 'enhanced select', 'woocommerce' ), |
| [2589](#L2589) | 'i18n\_ajax\_error'           => \_x( 'Loading failed', 'enhanced select', 'woocommerce' ), |
| [2590](#L2590) | 'i18n\_input\_too\_short\_1'    => \_x( 'Please enter 1 or more characters', 'enhanced select', 'woocommerce' ), |
| [2591](#L2591) | 'i18n\_input\_too\_short\_n'    => \_x( 'Please enter %qty% or more characters', 'enhanced select', 'woocommerce' ), |
| [2592](#L2592) | 'i18n\_input\_too\_long\_1'     => \_x( 'Please delete 1 character', 'enhanced select', 'woocommerce' ), |
| [2593](#L2593) | 'i18n\_input\_too\_long\_n'     => \_x( 'Please delete %qty% characters', 'enhanced select', 'woocommerce' ), |
| [2594](#L2594) | 'i18n\_selection\_too\_long\_1' => \_x( 'You can only select 1 item', 'enhanced select', 'woocommerce' ), |
| [2595](#L2595) | 'i18n\_selection\_too\_long\_n' => \_x( 'You can only select %qty% items', 'enhanced select', 'woocommerce' ), |
| [2596](#L2596) | 'i18n\_load\_more'            => \_x( 'Loading more results&hellip;', 'enhanced select', 'woocommerce' ), |
| [2597](#L2597) | 'i18n\_searching'            => \_x( 'Searching&hellip;', 'enhanced select', 'woocommerce' ), |
| [2598](#L2598) | 'ajax\_url'                  => admin\_url( 'admin-ajax.php' ), |
| [2599](#L2599) | 'search\_products\_nonce'     => wp\_create\_nonce( 'search-products' ), |
| [2600](#L2600) | 'search\_customers\_nonce'    => wp\_create\_nonce( 'search-customers' ), |
| [2601](#L2601) | ) |
| [2602](#L2602) | ); |
| [2603](#L2603) |  |
| [2604](#L2604) | wp\_enqueue\_script( 'enhanced' ); |
| [2605](#L2605) |  |
| [2606](#L2606) | wp\_register\_script( 'selectWoo', plugins\_url() . '/woocommerce/assets/js/selectWoo/selectWoo.full.js', array( 'jquery' ), WCAL\_PLUGIN\_VERSION, false ); |
| [2607](#L2607) | wp\_enqueue\_script( 'selectWoo' ); |
| [2608](#L2608) |  |
| [2609](#L2609) | wp\_register\_script( 'select2', plugins\_url() . '/woocommerce/assets/js/select2/select2.js', array( 'jquery', 'jquery-ui-widget', 'jquery-ui-core' ), WCAL\_PLUGIN\_VERSION, false ); |
| [2610](#L2610) | wp\_enqueue\_script( 'select2' ); |
| [2611](#L2611) |  |
| [2612](#L2612) | wp\_dequeue\_script( 'wc-enhanced-select' ); |
| [2613](#L2613) | } |
| [2614](#L2614) | } |
| [2615](#L2615) |  |
| [2616](#L2616) | /\*\* |
| [2617](#L2617) | \* It will add the parameter to the editor. |
| [2618](#L2618) | \* |
| [2619](#L2619) | \* @hook tiny\_mce\_before\_init |
| [2620](#L2620) | \* @param array $in - Editor params. |
| [2621](#L2621) | \* @return array $in - Editor params. |
| [2622](#L2622) | \* @since 2.6 |
| [2623](#L2623) | \*/ |
| [2624](#L2624) | public function wcal\_format\_tiny\_mce( $in ) { |
| [2625](#L2625) | $in['force\_root\_block']             = false; |
| [2626](#L2626) | $in['valid\_children']               = '+body[style]'; |
| [2627](#L2627) | $in['remove\_linebreaks']            = false; |
| [2628](#L2628) | $in['gecko\_spellcheck']             = false; |
| [2629](#L2629) | $in['keep\_styles']                  = true; |
| [2630](#L2630) | $in['accessibility\_focus']          = true; |
| [2631](#L2631) | $in['tabfocus\_elements']            = 'major-publishing-actions'; |
| [2632](#L2632) | $in['media\_strict']                 = false; |
| [2633](#L2633) | $in['paste\_remove\_styles']          = false; |
| [2634](#L2634) | $in['paste\_remove\_spans']           = false; |
| [2635](#L2635) | $in['paste\_strip\_class\_attributes'] = 'none'; |
| [2636](#L2636) | $in['paste\_text\_use\_dialog']        = true; |
| [2637](#L2637) | $in['wpeditimage\_disable\_captions'] = true; |
| [2638](#L2638) | $in['wpautop']                      = false; |
| [2639](#L2639) | $in['apply\_source\_formatting']      = true; |
| [2640](#L2640) | $in['cleanup']                      = true; |
| [2641](#L2641) | $in['convert\_newlines\_to\_brs']      = false; |
| [2642](#L2642) | $in['fullpage\_default\_xml\_pi']      = false; |
| [2643](#L2643) | $in['convert\_urls']                 = false; |
| [2644](#L2644) | // Do not remove redundant BR tags. |
| [2645](#L2645) | $in['remove\_redundant\_brs'] = false; |
| [2646](#L2646) | return $in; |
| [2647](#L2647) | } |
| [2648](#L2648) |  |
| [2649](#L2649) | /\*\* |
| [2650](#L2650) | \* It will add the necesaary css for the plugin. |
| [2651](#L2651) | \* |
| [2652](#L2652) | \* @hook admin\_enqueue\_scripts |
| [2653](#L2653) | \* @param string $hook Name of page. |
| [2654](#L2654) | \* @since 1.0 |
| [2655](#L2655) | \*/ |
| [2656](#L2656) | public function wcal\_enqueue\_scripts\_css( $hook ) { |
| [2657](#L2657) |  |
| [2658](#L2658) | global $pagenow; |
| [2659](#L2659) |  |
| [2660](#L2660) | $page    = isset( $\_GET['page'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['page'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [2661](#L2661) | $action  = isset( $\_GET['action'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['action'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [2662](#L2662) | $section = isset( $\_GET['wcal\_section'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['wcal\_section'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [2663](#L2663) | if ( 'woocommerce\_ac\_page' !== $page ) { |
| [2664](#L2664) | return; |
| [2665](#L2665) | } elseif ( 'woocommerce\_ac\_page' === $page && ( 'dashboard' === $action || '' === $action ) ) { |
| [2666](#L2666) | wp\_enqueue\_style( 'wcal-dashboard-adv', plugins\_url( '/assets/css/admin/wcal\_reports\_adv.css', \_\_FILE\_\_ ), '', WCAL\_PLUGIN\_VERSION ); |
| [2667](#L2667) |  |
| [2668](#L2668) | wp\_register\_style( 'bootstrap\_css', plugins\_url( '/assets/css/admin/bootstrap.min.css', \_\_FILE\_\_ ), '', WCAL\_PLUGIN\_VERSION, 'all' ); |
| [2669](#L2669) | wp\_enqueue\_style( 'bootstrap\_css' ); |
| [2670](#L2670) |  |
| [2671](#L2671) | wp\_enqueue\_style( 'wcal-font-awesome', plugins\_url( '/assets/css/admin/font-awesome.css', \_\_FILE\_\_ ), '', WCAL\_PLUGIN\_VERSION ); |
| [2672](#L2672) |  |
| [2673](#L2673) | wp\_enqueue\_style( 'wcal-font-awesome-min', plugins\_url( '/assets/css/admin/font-awesome.min.css', \_\_FILE\_\_ ), '', WCAL\_PLUGIN\_VERSION ); |
| [2674](#L2674) |  |
| [2675](#L2675) | wp\_enqueue\_style( 'jquery-ui', plugins\_url( '/assets/css/admin/jquery-ui.css', \_\_FILE\_\_ ), '', WCAL\_PLUGIN\_VERSION, false ); |
| [2676](#L2676) | wp\_enqueue\_style( 'woocommerce\_admin\_styles', WC()->plugin\_url() . '/assets/css/admin.css', '', WCAL\_PLUGIN\_VERSION ); |
| [2677](#L2677) | wp\_enqueue\_style( 'jquery-ui-style', plugins\_url( '/assets/css/admin/jquery-ui-smoothness.css', \_\_FILE\_\_ ), '', WCAL\_PLUGIN\_VERSION ); |
| [2678](#L2678) | wp\_enqueue\_style( 'wcal-reports', plugins\_url( '/assets/css/admin/wcal\_reports.min.css', \_\_FILE\_\_ ), '', WCAL\_PLUGIN\_VERSION ); |
| [2679](#L2679) |  |
| [2680](#L2680) | } elseif ( 'woocommerce\_ac\_page' === $page ) { |
| [2681](#L2681) |  |
| [2682](#L2682) | wp\_enqueue\_style( 'jquery-ui', plugins\_url( '/assets/css/admin/jquery-ui.css', \_\_FILE\_\_ ), '', WCAL\_PLUGIN\_VERSION, false ); |
| [2683](#L2683) | wp\_enqueue\_style( 'woocommerce\_admin\_styles', WC()->plugin\_url() . '/assets/css/admin.css', '', WCAL\_PLUGIN\_VERSION ); |
| [2684](#L2684) |  |
| [2685](#L2685) | wp\_enqueue\_style( 'jquery-ui-style', plugins\_url( '/assets/css/admin/jquery-ui-smoothness.css', \_\_FILE\_\_ ), '', WCAL\_PLUGIN\_VERSION ); |
| [2686](#L2686) | wp\_enqueue\_style( 'abandoned-orders-list', plugins\_url( '/assets/css/view.abandoned.orders.style.css', \_\_FILE\_\_ ), '', WCAL\_PLUGIN\_VERSION ); |
| [2687](#L2687) | wp\_enqueue\_style( 'wcal\_email\_template', plugins\_url( '/assets/css/wcal\_template\_activate.css', \_\_FILE\_\_ ), '', WCAL\_PLUGIN\_VERSION ); |
| [2688](#L2688) | wp\_enqueue\_style( 'wcal\_cart\_details', plugins\_url( '/assets/css/admin/wcal\_abandoned\_cart\_detail\_modal.min.css', \_\_FILE\_\_ ), '', WCAL\_PLUGIN\_VERSION ); |
| [2689](#L2689) | } |
| [2690](#L2690) | } |
| [2691](#L2691) |  |
| [2692](#L2692) | /\*\* |
| [2693](#L2693) | \* When we have added the wp list table for the listing then while deleting the record with the bulk action it was showing |
| [2694](#L2694) | \* the notice. To overcome the wp redirect warning we need to start the ob\_start. |
| [2695](#L2695) | \* |
| [2696](#L2696) | \* @hook init |
| [2697](#L2697) | \* @since 2.5.2 |
| [2698](#L2698) | \*/ |
| [2699](#L2699) | public function wcal\_app\_output\_buffer() { |
| [2700](#L2700) | ob\_start(); |
| [2701](#L2701) | } |
| [2702](#L2702) |  |
| [2703](#L2703) | /\*\* |
| [2704](#L2704) | \* Abandon Cart Settings Page. It will show the tabs, notices for the plugin. |
| [2705](#L2705) | \* It will also update the template records and display the template fields. |
| [2706](#L2706) | \* It will also show the abandoned cart details page. |
| [2707](#L2707) | \* It will also show the details of all the tabs. |
| [2708](#L2708) | \* |
| [2709](#L2709) | \* @globals mixed $wpdb |
| [2710](#L2710) | \* @since 1.0 |
| [2711](#L2711) | \*/ |
| [2712](#L2712) | public function wcal\_menu\_page() { |
| [2713](#L2713) |  |
| [2714](#L2714) | if ( is\_user\_logged\_in() ) { |
| [2715](#L2715) | global $wpdb; |
| [2716](#L2716) | // Check the user capabilities. |
| [2717](#L2717) | if ( ! current\_user\_can( 'manage\_woocommerce' ) ) { |
| [2718](#L2718) | wp\_die( esc\_html\_\_( 'You do not have sufficient permissions to access this page.', 'woocommerce-abandoned-cart' ) ); |
| [2719](#L2719) | } |
| [2720](#L2720) | ?> |
| [2721](#L2721) | <div class="wrap"> |
| [2722](#L2722) | <h2><?php esc\_html\_e( 'WooCommerce - Abandon Cart Lite', 'woocommerce-abandoned-cart' ); ?></h2> |
| [2723](#L2723) | <?php |
| [2724](#L2724) |  |
| [2725](#L2725) | if ( isset( $\_GET['ac\_update'] ) && 'email\_templates' === sanitize\_text\_field( wp\_unslash( $\_GET['ac\_update'] ) ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [2726](#L2726) | $status = wcal\_common::update\_templates\_table(); |
| [2727](#L2727) |  |
| [2728](#L2728) | if ( false !== $status ) { |
| [2729](#L2729) | wcal\_common::show\_update\_success(); |
| [2730](#L2730) | } else { |
| [2731](#L2731) | wcal\_common::show\_update\_failure(); |
| [2732](#L2732) | } |
| [2733](#L2733) | } |
| [2734](#L2734) |  |
| [2735](#L2735) | if ( isset( $\_GET['action'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [2736](#L2736) | $action = sanitize\_text\_field( wp\_unslash( $\_GET['action'] ) ); // phpcs:ignore WordPress.Security.NonceVerification |
| [2737](#L2737) | } else { |
| [2738](#L2738) | $action = ''; |
| [2739](#L2739) | $action = apply\_filters( 'wcal\_default\_tab', $action ); |
| [2740](#L2740) | } |
| [2741](#L2741) | $mode = isset( $\_GET['mode'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['mode'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [2742](#L2742) | $this->wcal\_display\_tabs(); |
| [2743](#L2743) |  |
| [2744](#L2744) | do\_action( 'wcal\_add\_tab\_content' ); |
| [2745](#L2745) |  |
| [2746](#L2746) | // When we delete the item from the below drop down it is registred in action 2. |
| [2747](#L2747) | $action\_two = isset( $\_GET['action2'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['action2'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [2748](#L2748) |  |
| [2749](#L2749) | // Detect when a bulk action is being triggered on abandoned orders page. |
| [2750](#L2750) | if ( 'wcal\_delete' === $action || 'wcal\_delete' === $action\_two ) { |
| [2751](#L2751) | $ids = isset( $\_GET['abandoned\_order\_id'] ) && is\_array( $\_GET['abandoned\_order\_id'] ) ? array\_map( 'intval', wp\_unslash( $\_GET['abandoned\_order\_id'] ) ) : sanitize\_text\_field( wp\_unslash( $\_GET['abandoned\_order\_id'] ) ); // phpcs:ignore WordPress.Security.NonceVerification |
| [2752](#L2752) | if ( ! is\_array( $ids ) ) { |
| [2753](#L2753) | $ids = array( $ids ); |
| [2754](#L2754) | } |
| [2755](#L2755) | foreach ( $ids as $id ) { |
| [2756](#L2756) | $class = new Wcal\_Delete\_Handler(); |
| [2757](#L2757) | $class->wcal\_delete\_bulk\_action\_handler\_function( $id ); |
| [2758](#L2758) | } |
| [2759](#L2759) | } |
| [2760](#L2760) | // Abandoned Orders page - Bulk Action - Delete all registered user carts. |
| [2761](#L2761) | if ( 'wcal\_delete\_all\_registered' === $action || 'wcal\_delete\_all\_registered' === $action\_two ) { |
| [2762](#L2762) | $class = new Wcal\_Delete\_Handler(); |
| [2763](#L2763) | $class->wcal\_bulk\_action\_delete\_registered\_carts\_handler(); |
| [2764](#L2764) | } |
| [2765](#L2765) | // Abandoned Orders page - Bulk Action - Delete all guest carts. |
| [2766](#L2766) | if ( 'wcal\_delete\_all\_guest' === $action || 'wcal\_delete\_all\_guest' === $action\_two ) { |
| [2767](#L2767) | $class = new Wcal\_Delete\_Handler(); |
| [2768](#L2768) | $class->wcal\_bulk\_action\_delete\_guest\_carts\_handler(); |
| [2769](#L2769) | } |
| [2770](#L2770) | // Abandoned Orders page - Bulk Action - Delete all visitor carts. |
| [2771](#L2771) | if ( 'wcal\_delete\_all\_visitor' === $action || 'wcal\_delete\_all\_visitor' === $action\_two ) { |
| [2772](#L2772) | $class = new Wcal\_Delete\_Handler(); |
| [2773](#L2773) | $class->wcal\_bulk\_action\_delete\_visitor\_carts\_handler(); |
| [2774](#L2774) | } |
| [2775](#L2775) | // Abandoned Orders page - Bulk Action - Delete all carts. |
| [2776](#L2776) | if ( 'wcal\_delete\_all' === $action || 'wcal\_delete\_all' === $action\_two ) { |
| [2777](#L2777) | $class = new Wcal\_Delete\_Handler(); |
| [2778](#L2778) | $class->wcal\_bulk\_action\_delete\_all\_carts\_handler(); |
| [2779](#L2779) | } |
| [2780](#L2780) |  |
| [2781](#L2781) | // Detect when a bulk action is being triggered on templates page. |
| [2782](#L2782) | if ( 'wcal\_delete\_template' === $action || 'wcal\_delete\_template' === $action\_two ) { |
| [2783](#L2783) | $ids = isset( $\_GET['template\_id'] ) && is\_array( $\_GET['template\_id'] ) ? array\_map( 'intval', wp\_unslash( $\_GET['template\_id'] ) ) : sanitize\_text\_field( wp\_unslash( $\_GET['template\_id'] ) ); // phpcs:ignore WordPress.Security.NonceVerification |
| [2784](#L2784) | if ( ! is\_array( $ids ) ) { |
| [2785](#L2785) | $ids = array( $ids ); |
| [2786](#L2786) | } |
| [2787](#L2787) | foreach ( $ids as $id ) { |
| [2788](#L2788) | $class = new Wcal\_Delete\_Handler(); |
| [2789](#L2789) | $class->wcal\_delete\_template\_bulk\_action\_handler\_function( $id ); |
| [2790](#L2790) | } |
| [2791](#L2791) | } |
| [2792](#L2792) |  |
| [2793](#L2793) | if ( isset( $\_GET['wcal\_deleted'] ) && 'YES' === sanitize\_text\_field( wp\_unslash( $\_GET['wcal\_deleted'] ) ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [2794](#L2794) | $msg = \_\_( 'The Abandoned cart has been successfully deleted.', 'woocommerce-abandoned-cart' ); // Default Msg. |
| [2795](#L2795) | if ( isset( $\_GET['wcal\_deleted\_all'] ) && 'YES' === sanitize\_text\_field( wp\_unslash( $\_GET['wcal\_deleted\_all'] ) ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [2796](#L2796) | $msg = \_\_( 'All Abandoned Carts have been successfully deleted.', 'woocommerce-abandoned-cart' ); // Delete All Carts. |
| [2797](#L2797) | } elseif ( isset( $\_GET['wcal\_deleted\_all\_visitor'] ) && 'YES' === sanitize\_text\_field( wp\_unslash( $\_GET['wcal\_deleted\_all\_visitor'] ) ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [2798](#L2798) | $msg = \_\_( 'All Visitor carts have been successfully deleted.', 'woocommerce-abandoned-cart' ); // Delete all visitor carts. |
| [2799](#L2799) | } elseif ( isset( $\_GET['wcal\_deleted\_all\_guest'] ) && 'YES' === sanitize\_text\_field( wp\_unslash( $\_GET['wcal\_deleted\_all\_guest'] ) ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [2800](#L2800) | $msg = \_\_( 'All Guest carts have been successfully deleted.', 'woocommerce-abandoned-cart' ); // Delete all Guest carts. |
| [2801](#L2801) | } elseif ( isset( $\_GET['wcal\_deleted\_all\_registered'] ) && 'YES' === sanitize\_text\_field( wp\_unslash( $\_GET['wcal\_deleted\_all\_registered'] ) ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [2802](#L2802) | $msg = \_\_( 'All Registered carts have been deleted.', 'woocommerce-abandoned-cart' ); // Delete all registered carts. |
| [2803](#L2803) | } |
| [2804](#L2804) | ?> |
| [2805](#L2805) | <div id="message" class="updated fade"> |
| [2806](#L2806) | <p><strong><?php echo esc\_html( $msg ); ?></strong></p> |
| [2807](#L2807) | </div> |
| [2808](#L2808) | <?php |
| [2809](#L2809) | } |
| [2810](#L2810) | if ( isset( $\_GET ['wcal\_template\_deleted'] ) && 'YES' === sanitize\_text\_field( wp\_unslash( $\_GET['wcal\_template\_deleted'] ) ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [2811](#L2811) | ?> |
| [2812](#L2812) | <div id="message" class="updated fade"> |
| [2813](#L2813) | <p><strong><?php esc\_html\_e( 'The Template has been successfully deleted.', 'woocommerce-abandoned-cart' ); ?></strong></p> |
| [2814](#L2814) | </div> |
| [2815](#L2815) | <?php |
| [2816](#L2816) | } |
| [2817](#L2817) | if ( 'emailsettings' === $action ) { |
| [2818](#L2818) | // Save the field values. |
| [2819](#L2819) | ?> |
| [2820](#L2820) | <div id="content"> |
| [2821](#L2821) | <?php |
| [2822](#L2822) | $wcal\_general\_settings\_class = ''; |
| [2823](#L2823) | $wcal\_email\_setting          = ''; |
| [2824](#L2824) | $wcap\_sms\_settings           = ''; |
| [2825](#L2825) | $wcap\_atc\_settings           = ''; |
| [2826](#L2826) | $wcap\_fb\_settings            = ''; |
| [2827](#L2827) | $wcap\_connectors             = ''; |
| [2828](#L2828) |  |
| [2829](#L2829) | $section = isset( $\_GET['wcal\_section'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['wcal\_section'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [2830](#L2830) | switch ( $section ) { |
| [2831](#L2831) | case 'wcal\_general\_settings': |
| [2832](#L2832) | case '': |
| [2833](#L2833) | $wcal\_general\_settings\_class = 'current'; |
| [2834](#L2834) | break; |
| [2835](#L2835) | case 'wcal\_email\_settings': |
| [2836](#L2836) | $wcal\_email\_setting = 'current'; |
| [2837](#L2837) | break; |
| [2838](#L2838) | case 'wcap\_sms\_settings': |
| [2839](#L2839) | $wcap\_sms\_settings = 'current'; |
| [2840](#L2840) | break; |
| [2841](#L2841) | case 'wcap\_atc\_settings': |
| [2842](#L2842) | $wcap\_atc\_settings = 'current'; |
| [2843](#L2843) | break; |
| [2844](#L2844) | case 'wcap\_fb\_settings': |
| [2845](#L2845) | $wcap\_fb\_settings = 'current'; |
| [2846](#L2846) | break; |
| [2847](#L2847) | case 'wcap\_connectors': |
| [2848](#L2848) | $wcap\_connectors = 'current'; |
| [2849](#L2849) | break; |
| [2850](#L2850) | default: |
| [2851](#L2851) | $wcal\_general\_settings\_class = 'current'; |
| [2852](#L2852) | break; |
| [2853](#L2853) | } |
| [2854](#L2854) | ?> |
| [2855](#L2855) | <ul class="subsubsub" id="wcal\_general\_settings\_list"> |
| [2856](#L2856) | <li> |
| [2857](#L2857) | <a href="admin.php?page=woocommerce\_ac\_page&action=emailsettings&wcal\_section=wcal\_general\_settings" class="<?php echo esc\_attr( $wcal\_general\_settings\_class ); ?>"><?php esc\_html\_e( 'General Settings', 'woocommerce-abandoned-cart' ); ?> </a> | |
| [2858](#L2858) | </li> |
| [2859](#L2859) | <li> |
| [2860](#L2860) | <a href="admin.php?page=woocommerce\_ac\_page&action=emailsettings&wcal\_section=wcal\_email\_settings" class="<?php echo esc\_attr( $wcal\_email\_setting ); ?>"><?php esc\_html\_e( 'Email Sending Settings', 'woocommerce-abandoned-cart' ); ?> </a> | |
| [2861](#L2861) | </li> |
| [2862](#L2862) | <li> |
| [2863](#L2863) | <a href="admin.php?page=woocommerce\_ac\_page&action=emailsettings&wcal\_section=wcap\_atc\_settings" class="<?php echo esc\_attr( $wcap\_atc\_settings ); ?>"><?php esc\_html\_e( 'Add To Cart Popup Editor', 'woocommerce-ac' ); ?> </a> | |
| [2864](#L2864) | </li> |
| [2865](#L2865) | <li> |
| [2866](#L2866) | <a href="admin.php?page=woocommerce\_ac\_page&action=emailsettings&wcal\_section=wcap\_fb\_settings" class="<?php echo esc\_attr( $wcap\_fb\_settings ); ?>"><?php esc\_html\_e( 'Facebook Messenger', 'woocommerce-ac' ); ?> </a> | |
| [2867](#L2867) | </li> |
| [2868](#L2868) | <li> |
| [2869](#L2869) | <a href="admin.php?page=woocommerce\_ac\_page&action=emailsettings&wcal\_section=wcap\_sms\_settings" class="<?php echo esc\_attr( $wcap\_sms\_settings ); ?>"><?php esc\_html\_e( 'SMS', 'woocommerce-ac' ); ?> </a> | |
| [2870](#L2870) | </li> |
| [2871](#L2871) | <li> |
| [2872](#L2872) | <a href="admin.php?page=woocommerce\_ac\_page&action=emailsettings&wcal\_section=wcap\_connectors" class="<?php echo esc\_attr( $wcap\_connectors ); ?>"><?php esc\_html\_e( 'Connectors', 'woocommerce-ac' ); ?> </a> |
| [2873](#L2873) | </li> |
| [2874](#L2874) | <?php do\_action( 'wcal\_add\_custom\_settings\_tab', $section ); ?> |
| [2875](#L2875) | </ul> |
| [2876](#L2876) | <br class="clear"> |
| [2877](#L2877) | <?php |
| [2878](#L2878) | if ( 'wcal\_general\_settings' === $section || '' === $section ) { |
| [2879](#L2879) | ?> |
| [2880](#L2880) | <p><?php esc\_html\_e( 'Change settings for sending email notifications to Customers, to Admin etc.', 'woocommerce-abandoned-cart' ); ?></p> |
| [2881](#L2881) | <form method="post" action="options.php"> |
| [2882](#L2882) | <?php settings\_fields( 'woocommerce\_ac\_settings' ); ?> |
| [2883](#L2883) | <?php do\_settings\_sections( 'woocommerce\_ac\_page' ); ?> |
| [2884](#L2884) | <?php settings\_errors(); ?> |
| [2885](#L2885) | <?php submit\_button(); ?> |
| [2886](#L2886) | </form> |
| [2887](#L2887) | <?php |
| [2888](#L2888) | } elseif ( 'wcal\_email\_settings' === $section ) { |
| [2889](#L2889) | ?> |
| [2890](#L2890) | <p><?php esc\_html\_e( 'Change settings for sending email notifications to Customers, to Admin etc.', 'woocommerce-abandoned-cart' ); ?></p> |
| [2891](#L2891) | <form method="post" action="options.php"> |
| [2892](#L2892) | <?php settings\_fields( 'woocommerce\_ac\_email\_settings' ); ?> |
| [2893](#L2893) | <?php do\_settings\_sections( 'woocommerce\_ac\_email\_page' ); ?> |
| [2894](#L2894) | <?php settings\_errors(); ?> |
| [2895](#L2895) | <?php submit\_button(); ?> |
| [2896](#L2896) | </form> |
| [2897](#L2897) | <?php |
| [2898](#L2898) | } elseif ( 'wcap\_atc\_settings' === $section ) { |
| [2899](#L2899) | WCAP\_Pro\_Settings::wcap\_atc\_settings(); |
| [2900](#L2900) | } elseif ( 'wcap\_fb\_settings' === $section ) { |
| [2901](#L2901) | WCAP\_Pro\_Settings::wcap\_fb\_settings(); |
| [2902](#L2902) | } elseif ( 'wcap\_sms\_settings' === $section ) { |
| [2903](#L2903) | WCAP\_Pro\_Settings::wcap\_sms\_settings(); |
| [2904](#L2904) | } elseif ( 'wcap\_connectors' === $section ) { |
| [2905](#L2905) | WCAP\_Pro\_Settings::wcap\_connectors(); |
| [2906](#L2906) | } |
| [2907](#L2907) | do\_action( 'wcal\_add\_custom\_settings\_tab\_content', $section ); |
| [2908](#L2908) | ?> |
| [2909](#L2909) | </div> |
| [2910](#L2910) | <?php |
| [2911](#L2911) | } elseif ( 'dashboard' === $action || '' === $action || '-1' === $action || '1' === $action\_two ) { |
| [2912](#L2912) | include\_once 'includes/classes/class-wcal-dashboard-report.php'; |
| [2913](#L2913) | Wcal\_Dashboard\_Report::wcal\_dashboard\_display(); |
| [2914](#L2914) | } elseif ( 'listcart' === $action ) { |
| [2915](#L2915) |  |
| [2916](#L2916) | ?> |
| [2917](#L2917) | <p> <?php esc\_html\_e( 'The list below shows all Abandoned Carts which have remained in cart for a time higher than the "Cart abandoned cut-off time" setting.', 'woocommerce-abandoned-cart' ); ?> </p> |
| [2918](#L2918) | <?php |
| [2919](#L2919) | $get\_all\_abandoned\_count      = wcal\_common::wcal\_get\_abandoned\_order\_count( 'wcal\_all\_abandoned' ); |
| [2920](#L2920) | $get\_registered\_user\_ac\_count = wcal\_common::wcal\_get\_abandoned\_order\_count( 'wcal\_all\_registered' ); |
| [2921](#L2921) | $get\_guest\_user\_ac\_count      = wcal\_common::wcal\_get\_abandoned\_order\_count( 'wcal\_all\_guest' ); |
| [2922](#L2922) | $get\_visitor\_user\_ac\_count    = wcal\_common::wcal\_get\_abandoned\_order\_count( 'wcal\_all\_visitor' ); |
| [2923](#L2923) |  |
| [2924](#L2924) | $wcal\_user\_reg\_text = 'User'; |
| [2925](#L2925) | if ( $get\_registered\_user\_ac\_count > 1 ) { |
| [2926](#L2926) | $wcal\_user\_reg\_text = 'Users'; |
| [2927](#L2927) | } |
| [2928](#L2928) | $wcal\_user\_gus\_text = 'User'; |
| [2929](#L2929) | if ( $get\_guest\_user\_ac\_count > 1 ) { |
| [2930](#L2930) | $wcal\_user\_gus\_text = 'Users'; |
| [2931](#L2931) | } |
| [2932](#L2932) | $wcal\_all\_abandoned\_carts = ''; |
| [2933](#L2933) | $section                  = ''; |
| [2934](#L2934) | $wcal\_all\_registered      = ''; |
| [2935](#L2935) | $wcal\_all\_guest           = ''; |
| [2936](#L2936) | $wcal\_all\_visitor         = ''; |
| [2937](#L2937) |  |
| [2938](#L2938) | $section = isset( $\_GET['wcal\_section'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['wcal\_section'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [2939](#L2939) | if ( 'wcal\_all\_abandoned' === $section || '' === $section ) { |
| [2940](#L2940) | $wcal\_all\_abandoned\_carts = 'current'; |
| [2941](#L2941) | } |
| [2942](#L2942) |  |
| [2943](#L2943) | if ( 'wcal\_all\_registered' === $section ) { |
| [2944](#L2944) | $wcal\_all\_registered      = 'current'; |
| [2945](#L2945) | $wcal\_all\_abandoned\_carts = ''; |
| [2946](#L2946) | } |
| [2947](#L2947) | if ( 'wcal\_all\_guest' === $section ) { |
| [2948](#L2948) | $wcal\_all\_guest           = 'current'; |
| [2949](#L2949) | $wcal\_all\_abandoned\_carts = ''; |
| [2950](#L2950) | } |
| [2951](#L2951) |  |
| [2952](#L2952) | if ( 'wcal\_all\_visitor' === $section ) { |
| [2953](#L2953) | $wcal\_all\_visitor         = 'current'; |
| [2954](#L2954) | $wcal\_all\_abandoned\_carts = ''; |
| [2955](#L2955) | } |
| [2956](#L2956) | ?> |
| [2957](#L2957) | <ul class="subsubsub" id="wcal\_recovered\_orders\_list"> |
| [2958](#L2958) | <li> |
| [2959](#L2959) | <a href="admin.php?page=woocommerce\_ac\_page&action=listcart&wcal\_section=wcal\_all\_abandoned" class="<?php echo esc\_attr( $wcal\_all\_abandoned\_carts ); ?>"><?php esc\_html\_e( 'All ', 'woocommerce-abandoned-cart' ); ?> <span class = "count" > <?php echo esc\_html( "( $get\_all\_abandoned\_count )" ); ?> </span></a> |
| [2960](#L2960) | </li> |
| [2961](#L2961) |  |
| [2962](#L2962) | <?php if ( $get\_registered\_user\_ac\_count > 0 ) { ?> |
| [2963](#L2963) | <li><?php // translators: Users. ?> |
| [2964](#L2964) | | <a href="admin.php?page=woocommerce\_ac\_page&action=listcart&wcal\_section=wcal\_all\_registered" class="<?php echo esc\_attr( $wcal\_all\_registered ); ?>"><?php printf( esc\_html\_\_( 'Registered %s', 'woocommerce-abandoned-cart' ), esc\_html( $wcal\_user\_reg\_text ) ); ?> <span class = "count" > <?php echo esc\_html( "( $get\_registered\_user\_ac\_count )" ); ?> </span></a> |
| [2965](#L2965) | </li> |
| [2966](#L2966) | <?php } ?> |
| [2967](#L2967) |  |
| [2968](#L2968) | <?php if ( $get\_guest\_user\_ac\_count > 0 ) { ?> |
| [2969](#L2969) | <li><?php // translators: Users. ?> |
| [2970](#L2970) | | <a href="admin.php?page=woocommerce\_ac\_page&action=listcart&wcal\_section=wcal\_all\_guest" class="<?php echo esc\_attr( $wcal\_all\_guest ); ?>"><?php printf( esc\_html\_\_( 'Guest %s', 'woocommerce-abandoned-cart' ), esc\_html( $wcal\_user\_gus\_text ) ); ?> <span class = "count" > <?php echo esc\_html( "( $get\_guest\_user\_ac\_count )" ); ?> </span></a> |
| [2971](#L2971) | </li> |
| [2972](#L2972) | <?php } ?> |
| [2973](#L2973) |  |
| [2974](#L2974) | <?php if ( $get\_visitor\_user\_ac\_count > 0 ) { ?> |
| [2975](#L2975) | <li> |
| [2976](#L2976) | | <a href="admin.php?page=woocommerce\_ac\_page&action=listcart&wcal\_section=wcal\_all\_visitor" class="<?php echo esc\_attr( $wcal\_all\_visitor ); ?>"><?php esc\_html\_e( 'Carts without Customer Details', 'woocommerce-abandoned-cart' ); ?> <span class = "count" > <?php echo esc\_html( "( $get\_visitor\_user\_ac\_count )" ); ?> </span></a> |
| [2977](#L2977) | </li> |
| [2978](#L2978) | <?php } ?> |
| [2979](#L2979) | </ul> |
| [2980](#L2980) |  |
| [2981](#L2981) | <?php |
| [2982](#L2982) | global $wpdb; |
| [2983](#L2983) | include\_once 'includes/classes/class-wcal-abandoned-orders-table.php'; |
| [2984](#L2984) | $wcal\_abandoned\_order\_list = new WCAL\_Abandoned\_Orders\_Table(); |
| [2985](#L2985) | $wcal\_abandoned\_order\_list->wcal\_abandoned\_order\_prepare\_items(); |
| [2986](#L2986) | ?> |
| [2987](#L2987) | <div class="wrap"> |
| [2988](#L2988) | <form id="wcal-abandoned-orders" method="get" > |
| [2989](#L2989) | <input type="hidden" name="page" value="woocommerce\_ac\_page" /> |
| [2990](#L2990) | <input type="hidden" name="action" value="listcart" /> |
| [2991](#L2991) | <?php $wcal\_abandoned\_order\_list->display(); ?> |
| [2992](#L2992) | </form> |
| [2993](#L2993) | </div> |
| [2994](#L2994) | <?php |
| [2995](#L2995) | } elseif ( ( 'emailtemplates' === $action && ( 'edittemplate' !== $mode && 'addnewtemplate' !== $mode ) || '' === $action || '-1' === $action || '-1' === $action\_two ) ) { |
| [2996](#L2996) | ?> |
| [2997](#L2997) | <p> <?php esc\_html\_e( 'Add email templates at different intervals to maximize the possibility of recovering your abandoned carts.', 'woocommerce-abandoned-cart' ); ?> </p> |
| [2998](#L2998) | <?php |
| [2999](#L2999) | // Save the field values. |
| [3000](#L3000) | $insert\_template\_successfuly  = ''; |
| [3001](#L3001) | $update\_template\_successfuly  = ''; |
| [3002](#L3002) | $woocommerce\_ac\_email\_subject = isset( $\_POST['woocommerce\_ac\_email\_subject'] ) ? trim( htmlspecialchars( sanitize\_text\_field( wp\_unslash( $\_POST['woocommerce\_ac\_email\_subject'] ) ) ), ENT\_QUOTES ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [3003](#L3003) | $woocommerce\_ac\_email\_body    = isset( $\_POST['woocommerce\_ac\_email\_body'] ) ? trim( wp\_unslash( $\_POST['woocommerce\_ac\_email\_body'] ) ) : ''; // phpcs:ignore |
| [3004](#L3004) | $woocommerce\_ac\_template\_name = isset( $\_POST['woocommerce\_ac\_template\_name'] ) ? trim( sanitize\_text\_field( wp\_unslash( $\_POST['woocommerce\_ac\_template\_name'] ) ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [3005](#L3005) | $woocommerce\_ac\_email\_header  = isset( $\_POST['wcal\_wc\_email\_header'] ) ? stripslashes( trim( htmlspecialchars( sanitize\_text\_field( wp\_unslash( $\_POST['wcal\_wc\_email\_header'] ) ) ), ENT\_QUOTES ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [3006](#L3006) |  |
| [3007](#L3007) | $email\_frequency = isset( $\_POST['email\_frequency'] ) ? trim( sanitize\_text\_field( wp\_unslash( $\_POST['email\_frequency'] ) ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [3008](#L3008) | $day\_or\_hour     = isset( $\_POST['day\_or\_hour'] ) ? trim( sanitize\_text\_field( wp\_unslash( $\_POST['day\_or\_hour'] ) ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [3009](#L3009) | $is\_wc\_template  = empty( $\_POST['is\_wc\_template'] ) ? '0' : '1'; // phpcs:ignore WordPress.Security.NonceVerification |
| [3010](#L3010) |  |
| [3011](#L3011) | // If the link merge tags are prefixed with http://|https:// please remove it. |
| [3012](#L3012) | $rectify\_links = array( |
| [3013](#L3013) | 'http://{{cart.link}}', |
| [3014](#L3014) | 'https://{{cart.link}}', |
| [3015](#L3015) | 'http://{{cart.unsubscribe}}', |
| [3016](#L3016) | 'https://{{cart.unsubscribe}}', |
| [3017](#L3017) | 'http://{{shop.url}}', |
| [3018](#L3018) | 'https://{{shop.url}}', |
| [3019](#L3019) | ); |
| [3020](#L3020) | foreach ( $rectify\_links as $merge\_tag ) { |
| [3021](#L3021) | $start\_tag                 = stripos( $merge\_tag, '{{' ); |
| [3022](#L3022) | $new\_tag                   = substr( $merge\_tag, $start\_tag ); |
| [3023](#L3023) | $woocommerce\_ac\_email\_body = str\_ireplace( $merge\_tag, $new\_tag, $woocommerce\_ac\_email\_body ); |
| [3024](#L3024) | } |
| [3025](#L3025) | if ( isset( $\_POST['ac\_settings\_frm'] ) && 'save' === sanitize\_text\_field( wp\_unslash( $\_POST['ac\_settings\_frm'] ) ) ) { // phpcs:ignore |
| [3026](#L3026) | $default\_value       = 0; |
| [3027](#L3027) | $coupon\_code\_id      = isset( $\_POST['coupon\_ids'][0] ) ? sanitize\_text\_field( wp\_unslash( implode( ',', $\_POST['coupon\_ids'] ) ) ) : ''; // phpcs:ignore |
| [3028](#L3028) | $unique\_coupon       = ( empty( $\_POST['unique\_coupon'] ) ) ? '0' : '1'; // phpcs:ignore WordPress.Security.NonceVerification |
| [3029](#L3029) | $coupon\_code\_options = self::wcal\_coupon\_options(); |
| [3030](#L3030) | $email\_type          = 'abandoned\_cart\_email'; |
| [3031](#L3031) |  |
| [3032](#L3032) | $insert\_template\_successfuly = $wpdb->query( //phpcs:ignore |
| [3033](#L3033) | $wpdb->prepare( |
| [3034](#L3034) | 'INSERT INTO `' . $wpdb->prefix . 'ac\_email\_templates\_lite` (email\_type, subject, body, frequency, day\_or\_hour, template\_name, is\_wc\_template, default\_template, wc\_email\_header, coupon\_code, individual\_use, generate\_unique\_coupon\_code, discount, discount\_type, discount\_shipping, discount\_expiry ) VALUES ( %s, %s, %s, %d, %s, %s, %s, %d, %s, %s, %s, %s, %s, %s, %s, %s )', |
| [3035](#L3035) | $email\_type, |
| [3036](#L3036) | $woocommerce\_ac\_email\_subject, |
| [3037](#L3037) | $woocommerce\_ac\_email\_body, |
| [3038](#L3038) | $email\_frequency, |
| [3039](#L3039) | $day\_or\_hour, |
| [3040](#L3040) | $woocommerce\_ac\_template\_name, |
| [3041](#L3041) | $is\_wc\_template, |
| [3042](#L3042) | $default\_value, |
| [3043](#L3043) | $woocommerce\_ac\_email\_header, |
| [3044](#L3044) | $coupon\_code\_id, |
| [3045](#L3045) | $coupon\_code\_options['individual\_use'], |
| [3046](#L3046) | $unique\_coupon, |
| [3047](#L3047) | $coupon\_code\_options['coupon\_amount'], |
| [3048](#L3048) | $coupon\_code\_options['discount\_type'], |
| [3049](#L3049) | $coupon\_code\_options['discount\_shipping'], |
| [3050](#L3050) | $coupon\_code\_options['coupon\_expiry'] |
| [3051](#L3051) | ) |
| [3052](#L3052) | ); |
| [3053](#L3053) | } |
| [3054](#L3054) |  |
| [3055](#L3055) | if ( isset( $\_POST['ac\_settings\_frm'] ) && 'update' === sanitize\_text\_field( wp\_unslash( $\_POST['ac\_settings\_frm'] ) ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [3056](#L3056) |  |
| [3057](#L3057) | $updated\_is\_active = '0'; |
| [3058](#L3058) | $id                = isset( $\_POST['id'] ) ? trim( sanitize\_text\_field( wp\_unslash( $\_POST['id'] ) ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [3059](#L3059) |  |
| [3060](#L3060) | $check\_results = $wpdb->get\_results( //phpcs:ignore |
| [3061](#L3061) | $wpdb->prepare( |
| [3062](#L3062) | 'SELECT \* FROM `' . $wpdb->prefix . 'ac\_email\_templates\_lite` WHERE id = %d', |
| [3063](#L3063) | $id |
| [3064](#L3064) | ) |
| [3065](#L3065) | ); |
| [3066](#L3066) | $default\_value = ''; |
| [3067](#L3067) |  |
| [3068](#L3068) | if ( count( $check\_results ) > 0 ) { |
| [3069](#L3069) | if ( isset( $check\_results[0]->default\_template ) && '1' === $check\_results[0]->default\_template ) { |
| [3070](#L3070) | $default\_value = '1'; |
| [3071](#L3071) | } |
| [3072](#L3072) | } |
| [3073](#L3073) | $coupon\_code\_id      = isset( $\_POST['coupon\_ids'][0] ) ? sanitize\_text\_field( wp\_unslash( implode( ',', $\_POST['coupon\_ids'] ) ) ) : ''; // phpcs:ignore |
| [3074](#L3074) | $unique\_coupon       = ( empty( $\_POST['unique\_coupon'] ) ) ? '0' : '1'; // phpcs:ignore |
| [3075](#L3075) | $coupon\_code\_options = self::wcal\_coupon\_options(); |
| [3076](#L3076) |  |
| [3077](#L3077) | $update\_template\_successfuly = $wpdb->query( //phpcs:ignore |
| [3078](#L3078) | $wpdb->prepare( |
| [3079](#L3079) | 'UPDATE `' . $wpdb->prefix . 'ac\_email\_templates\_lite` SET subject = %s, body = %s, frequency = %d, day\_or\_hour = %s, template\_name = %s, is\_wc\_template = %s, default\_template = %d, wc\_email\_header = %s,coupon\_code = %s, individual\_use =%s, generate\_unique\_coupon\_code = %s, discount = %s, discount\_type = %s, discount\_shipping =%s, discount\_expiry = %s  WHERE id = %d', |
| [3080](#L3080) | $woocommerce\_ac\_email\_subject, |
| [3081](#L3081) | $woocommerce\_ac\_email\_body, |
| [3082](#L3082) | $email\_frequency, |
| [3083](#L3083) | $day\_or\_hour, |
| [3084](#L3084) | $woocommerce\_ac\_template\_name, |
| [3085](#L3085) | $is\_wc\_template, |
| [3086](#L3086) | $default\_value, |
| [3087](#L3087) | $woocommerce\_ac\_email\_header, |
| [3088](#L3088) | $coupon\_code\_id, |
| [3089](#L3089) | $coupon\_code\_options['individual\_use'], |
| [3090](#L3090) | $unique\_coupon, |
| [3091](#L3091) | $coupon\_code\_options['coupon\_amount'], |
| [3092](#L3092) | $coupon\_code\_options['discount\_type'], |
| [3093](#L3093) | $coupon\_code\_options['discount\_shipping'], |
| [3094](#L3094) | $coupon\_code\_options['coupon\_expiry'], |
| [3095](#L3095) | $id |
| [3096](#L3096) | ) |
| [3097](#L3097) | ); |
| [3098](#L3098) | } |
| [3099](#L3099) |  |
| [3100](#L3100) | if ( 'emailtemplates' === $action && 'removetemplate' === $mode ) { |
| [3101](#L3101) | $id\_remove = isset( $\_GET['id'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['id'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [3102](#L3102) | $wpdb->query( //phpcs:ignore |
| [3103](#L3103) | $wpdb->prepare( |
| [3104](#L3104) | 'DELETE FROM `' . $wpdb->prefix . 'ac\_email\_templates\_lite` WHERE id= %d ', |
| [3105](#L3105) | $id\_remove |
| [3106](#L3106) | ) |
| [3107](#L3107) | ); |
| [3108](#L3108) | } |
| [3109](#L3109) |  |
| [3110](#L3110) | if ( 'emailtemplates' === $action && 'activate\_template' === $mode ) { |
| [3111](#L3111) | $template\_id             = isset( $\_GET['id'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['id'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [3112](#L3112) | $current\_template\_status = isset( $\_GET['active\_state'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['active\_state'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [3113](#L3113) |  |
| [3114](#L3114) | if ( '1' === $current\_template\_status ) { |
| [3115](#L3115) | $active = '0'; |
| [3116](#L3116) | } else { |
| [3117](#L3117) | $active                       = '1'; |
| [3118](#L3118) | $get\_selected\_template\_result = $wpdb->get\_results( // phpcs:ignore |
| [3119](#L3119) | $wpdb->prepare( |
| [3120](#L3120) | 'SELECT \* FROM `' . $wpdb->prefix . 'ac\_email\_templates\_lite` WHERE id = %d', |
| [3121](#L3121) | $template\_id |
| [3122](#L3122) | ) |
| [3123](#L3123) | ); |
| [3124](#L3124) |  |
| [3125](#L3125) | $email\_frequncy    = $get\_selected\_template\_result[0]->frequency; |
| [3126](#L3126) | $email\_day\_or\_hour = $get\_selected\_template\_result[0]->day\_or\_hour; |
| [3127](#L3127) | $wcap\_updated      = $wpdb->query( // phpcs:ignore |
| [3128](#L3128) | $wpdb->prepare( |
| [3129](#L3129) | 'UPDATE `' . $wpdb->prefix . 'ac\_email\_templates\_lite` SET is\_active = %s WHERE frequency = %s AND day\_or\_hour = %s', |
| [3130](#L3130) | 0, |
| [3131](#L3131) | $email\_frequncy, |
| [3132](#L3132) | $email\_day\_or\_hour |
| [3133](#L3133) | ) |
| [3134](#L3134) | ); |
| [3135](#L3135) | } |
| [3136](#L3136) |  |
| [3137](#L3137) | $wpdb->query( // phpcs:ignore |
| [3138](#L3138) | $wpdb->prepare( |
| [3139](#L3139) | 'UPDATE `' . $wpdb->prefix . 'ac\_email\_templates\_lite` SET is\_active = %s WHERE id = %s', |
| [3140](#L3140) | $active, |
| [3141](#L3141) | $template\_id |
| [3142](#L3142) | ) |
| [3143](#L3143) | ); |
| [3144](#L3144) |  |
| [3145](#L3145) | wp\_safe\_redirect( admin\_url( '/admin.php?page=woocommerce\_ac\_page&action=emailtemplates' ) ); |
| [3146](#L3146) | } |
| [3147](#L3147) |  |
| [3148](#L3148) | if ( isset( $\_POST['ac\_settings\_frm'] ) && 'save' === $\_POST['ac\_settings\_frm'] && ( isset( $insert\_template\_successfuly ) && '' !== $insert\_template\_successfuly ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [3149](#L3149) | ?> |
| [3150](#L3150) | <div id="message" class="updated fade"> |
| [3151](#L3151) | <p> |
| [3152](#L3152) | <strong> |
| [3153](#L3153) | <?php esc\_html\_e( 'The Email Template has been successfully added. In order to start sending this email to your customers, please activate it.', 'woocommerce-abandoned-cart' ); ?> |
| [3154](#L3154) | </strong> |
| [3155](#L3155) | </p> |
| [3156](#L3156) | </div> |
| [3157](#L3157) | <?php |
| [3158](#L3158) | } elseif ( isset( $\_POST['ac\_settings\_frm'] ) && 'save' === $\_POST['ac\_settings\_frm'] && ( isset( $insert\_template\_successfuly ) && '' === $insert\_template\_successfuly ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [3159](#L3159) | ?> |
| [3160](#L3160) | <div id="message" class="error fade"> |
| [3161](#L3161) | <p> |
| [3162](#L3162) | <strong> |
| [3163](#L3163) | <?php esc\_html\_e( 'There was a problem adding the email template. Please contact the plugin author via <a href= "https://wordpress.org/support/plugin/woocommerce-abandoned-cart">support forum</a>.', 'woocommerce-abandoned-cart' ); ?> |
| [3164](#L3164) | </strong> |
| [3165](#L3165) | </p> |
| [3166](#L3166) | </div> |
| [3167](#L3167) | <?php |
| [3168](#L3168) | } |
| [3169](#L3169) |  |
| [3170](#L3170) | if ( isset( $\_POST['ac\_settings\_frm'] ) && 'update' === $\_POST['ac\_settings\_frm'] && isset( $update\_template\_successfuly ) && false !== $update\_template\_successfuly ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [3171](#L3171) | ?> |
| [3172](#L3172) | <div id="message" class="updated fade"> |
| [3173](#L3173) | <p> |
| [3174](#L3174) | <strong> |
| [3175](#L3175) | <?php esc\_html\_e( 'The Email Template has been successfully updated.', 'woocommerce-abandoned-cart' ); ?> |
| [3176](#L3176) | </strong> |
| [3177](#L3177) | </p> |
| [3178](#L3178) | </div> |
| [3179](#L3179) | <?php |
| [3180](#L3180) | } elseif ( isset( $\_POST['ac\_settings\_frm'] ) && 'update' === $\_POST['ac\_settings\_frm'] && isset( $update\_template\_successfuly ) && false === $update\_template\_successfuly ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [3181](#L3181) | ?> |
| [3182](#L3182) | <div id="message" class="error fade"> |
| [3183](#L3183) | <p> |
| [3184](#L3184) | <strong> |
| [3185](#L3185) | <?php esc\_html\_e( 'There was a problem updating the email template. Please contact the plugin author via <a href= "https://wordpress.org/support/plugin/woocommerce-abandoned-cart">support forum</a>.', 'woocommerce-abandoned-cart' ); ?> |
| [3186](#L3186) | </strong> |
| [3187](#L3187) | </p> |
| [3188](#L3188) | </div> |
| [3189](#L3189) | <?php |
| [3190](#L3190) | } |
| [3191](#L3191) | ?> |
| [3192](#L3192) | <div class="tablenav"> |
| [3193](#L3193) | <p style="float:left;"> |
| [3194](#L3194) | <a cursor: pointer; href="<?php echo esc\_url( 'admin.php?page=woocommerce\_ac\_page&action=emailtemplates&mode=addnewtemplate' ); ?>" class="button-secondary"><?php esc\_html\_e( 'Add New Template', 'woocommerce-abandoned-cart' ); ?></a> |
| [3195](#L3195) | </p> |
| [3196](#L3196) |  |
| [3197](#L3197) | <?php |
| [3198](#L3198) | // From here you can do whatever you want with the data from the $result link. |
| [3199](#L3199) | include\_once 'includes/classes/class-wcal-templates-table.php'; |
| [3200](#L3200) | $wcal\_template\_list = new WCAL\_Templates\_Table(); |
| [3201](#L3201) | $wcal\_template\_list->wcal\_templates\_prepare\_items(); |
| [3202](#L3202) | ?> |
| [3203](#L3203) | <div class="wrap"> |
| [3204](#L3204) | <form id="wcal-abandoned-templates" method="get" > |
| [3205](#L3205) | <input type="hidden" name="page" value="woocommerce\_ac\_page" /> |
| [3206](#L3206) | <input type="hidden" name="action" value="emailtemplates" /> |
| [3207](#L3207) | <?php $wcal\_template\_list->display(); ?> |
| [3208](#L3208) | </form> |
| [3209](#L3209) | </div> |
| [3210](#L3210) | </div> |
| [3211](#L3211) | <?php |
| [3212](#L3212) | } elseif ( 'stats' === $action || '' === $action ) { |
| [3213](#L3213) | ?> |
| [3214](#L3214) | <p> |
| [3215](#L3215) | <script language='javascript'> |
| [3216](#L3216) | jQuery( document ).ready( function() { |
| [3217](#L3217) | jQuery( '#duration\_select' ).change( function() { |
| [3218](#L3218) | var group\_name = jQuery( '#duration\_select' ).val(); |
| [3219](#L3219) | var today      = new Date(); |
| [3220](#L3220) | var start\_date = ""; |
| [3221](#L3221) | var end\_date   = ""; |
| [3222](#L3222) | if ( group\_name == "yesterday" ) { |
| [3223](#L3223) | start\_date = new Date( today.getFullYear(), today.getMonth(), today.getDate() - 1 ); |
| [3224](#L3224) | end\_date   = new Date( today.getFullYear(), today.getMonth(), today.getDate() - 1 ); |
| [3225](#L3225) | } else if ( group\_name == "today") { |
| [3226](#L3226) | start\_date = new Date( today.getFullYear(), today.getMonth(), today.getDate() ); |
| [3227](#L3227) | end\_date   = new Date( today.getFullYear(), today.getMonth(), today.getDate() ); |
| [3228](#L3228) | } else if ( group\_name == "last\_seven" ) { |
| [3229](#L3229) | start\_date = new Date( today.getFullYear(), today.getMonth(), today.getDate() - 7 ); |
| [3230](#L3230) | end\_date   = new Date( today.getFullYear(), today.getMonth(), today.getDate() ); |
| [3231](#L3231) | } else if ( group\_name == "last\_fifteen" ) { |
| [3232](#L3232) | start\_date = new Date( today.getFullYear(), today.getMonth(), today.getDate() - 15 ); |
| [3233](#L3233) | end\_date   = new Date( today.getFullYear(), today.getMonth(), today.getDate() ); |
| [3234](#L3234) | } else if ( group\_name == "last\_thirty" ) { |
| [3235](#L3235) | start\_date = new Date( today.getFullYear(), today.getMonth(), today.getDate() - 30 ); |
| [3236](#L3236) | end\_date   = new Date( today.getFullYear(), today.getMonth(), today.getDate() ); |
| [3237](#L3237) | } else if ( group\_name == "last\_ninety" ) { |
| [3238](#L3238) | start\_date = new Date( today.getFullYear(), today.getMonth(), today.getDate() - 90 ); |
| [3239](#L3239) | end\_date   = new Date( today.getFullYear(), today.getMonth(), today.getDate() ); |
| [3240](#L3240) | } else if ( group\_name == "last\_year\_days" ) { |
| [3241](#L3241) | start\_date = new Date( today.getFullYear(), today.getMonth(), today.getDate() - 365 ); |
| [3242](#L3242) | end\_date   = new Date( today.getFullYear(), today.getMonth(), today.getDate() ); |
| [3243](#L3243) | } |
| [3244](#L3244) |  |
| [3245](#L3245) | var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"]; |
| [3246](#L3246) |  |
| [3247](#L3247) | var start\_date\_value = start\_date.getDate() + " " + monthNames[start\_date.getMonth()] + " " + start\_date.getFullYear(); |
| [3248](#L3248) | var end\_date\_value   = end\_date.getDate() + " " + monthNames[end\_date.getMonth()] + " " + end\_date.getFullYear(); |
| [3249](#L3249) |  |
| [3250](#L3250) | jQuery( '#start\_date' ).val( start\_date\_value ); |
| [3251](#L3251) | jQuery( '#end\_date' ).val( end\_date\_value ); |
| [3252](#L3252) | } ); |
| [3253](#L3253) | }); |
| [3254](#L3254) | </script> |
| [3255](#L3255) | <?php |
| [3256](#L3256) | $duration\_range = isset( $\_POST['duration\_select'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['duration\_select'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [3257](#L3257) | if ( '' === $duration\_range ) { |
| [3258](#L3258) | if ( isset( $\_GET['duration\_select'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [3259](#L3259) | $duration\_range = sanitize\_text\_field( wp\_unslash( $\_GET['duration\_select'] ) ); // phpcs:ignore WordPress.Security.NonceVerification |
| [3260](#L3260) | } |
| [3261](#L3261) | } |
| [3262](#L3262) | if ( '' === $duration\_range ) { |
| [3263](#L3263) | $duration\_range = 'last\_seven'; |
| [3264](#L3264) | } |
| [3265](#L3265) |  |
| [3266](#L3266) | echo esc\_html\_e( 'The Report below shows how many Abandoned Carts we were able to recover for you by sending automatic emails to encourage shoppers.', 'woocommerce-abandoned-cart' ); |
| [3267](#L3267) | ?> |
| [3268](#L3268) | <div id="recovered\_stats" class="postbox" style="display:block"> |
| [3269](#L3269) | <div class="inside"> |
| [3270](#L3270) | <form method="post" action="admin.php?page=woocommerce\_ac\_page&action=stats" id="ac\_stats"> |
| [3271](#L3271) | <select id="duration\_select" name="duration\_select" > |
| [3272](#L3272) | <?php |
| [3273](#L3273) | foreach ( $this->duration\_range\_select as $key => $value ) { |
| [3274](#L3274) | $sel = ''; |
| [3275](#L3275) | if ( $key == $duration\_range ) { // phpcs:ignore |
| [3276](#L3276) | $sel = ' selected '; |
| [3277](#L3277) | } |
| [3278](#L3278) | printf( |
| [3279](#L3279) | '<option value="%s" %s> %s </option>', |
| [3280](#L3280) | esc\_attr( $key ), |
| [3281](#L3281) | esc\_attr( $sel ), |
| [3282](#L3282) | esc\_attr( $value ) |
| [3283](#L3283) | ); |
| [3284](#L3284) | } |
| [3285](#L3285) | $date\_sett = $this->start\_end\_dates[ $duration\_range ]; |
| [3286](#L3286) | ?> |
| [3287](#L3287) | </select> |
| [3288](#L3288) | <script type="text/javascript"> |
| [3289](#L3289) | jQuery( document ).ready( function() { |
| [3290](#L3290) | var formats = ["d.m.y", "d M yy","MM d, yy"]; |
| [3291](#L3291) | jQuery( "#start\_date" ).datepicker( { dateFormat: formats[1] } ); |
| [3292](#L3292) | }); |
| [3293](#L3293) |  |
| [3294](#L3294) | jQuery( document ).ready( function() |
| [3295](#L3295) | { |
| [3296](#L3296) | var formats = ["d.m.y", "d M yy","MM d, yy"]; |
| [3297](#L3297) | jQuery( "#end\_date" ).datepicker( { dateFormat: formats[1] } ); |
| [3298](#L3298) | }); |
| [3299](#L3299) | </script> |
| [3300](#L3300) | <?php |
| [3301](#L3301) | include\_once 'includes/classes/class-wcal-recover-orders-table.php'; |
| [3302](#L3302) | $wcal\_recover\_orders\_list = new Wcal\_Recover\_Orders\_Table(); |
| [3303](#L3303) | $wcal\_recover\_orders\_list->wcal\_recovered\_orders\_prepare\_items(); |
| [3304](#L3304) |  |
| [3305](#L3305) | $start\_date\_range = isset( $\_POST['start\_date'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['start\_date'] ) ) : '';// phpcs:ignore WordPress.Security.NonceVerification |
| [3306](#L3306) |  |
| [3307](#L3307) | if ( '' === $start\_date\_range ) { |
| [3308](#L3308) | $start\_date\_range = $date\_sett['start\_date']; |
| [3309](#L3309) | } |
| [3310](#L3310) |  |
| [3311](#L3311) | $end\_date\_range = isset( $\_POST['end\_date'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['end\_date'] ) ) : '';// phpcs:ignore WordPress.Security.NonceVerification |
| [3312](#L3312) |  |
| [3313](#L3313) | if ( '' === $end\_date\_range ) { |
| [3314](#L3314) | $end\_date\_range = $date\_sett['end\_date']; |
| [3315](#L3315) | } |
| [3316](#L3316) | ?> |
| [3317](#L3317) | <label class="start\_label" for="start\_day"> <?php esc\_html\_e( 'Start Date:', 'woocommerce-abandoned-cart' ); ?> </label> |
| [3318](#L3318) | <input type="text" id="start\_date" name="start\_date" readonly="readonly" value="<?php echo esc\_attr( $start\_date\_range ); ?>"/> |
| [3319](#L3319) | <label class="end\_label" for="end\_day"> <?php esc\_html\_e( 'End Date:', 'woocommerce-abandoned-cart' ); ?> </label> |
| [3320](#L3320) | <input type="text" id="end\_date" name="end\_date" readonly="readonly" value="<?php echo esc\_attr( $end\_date\_range ); ?>"/> |
| [3321](#L3321) | <input type="submit" name="Submit" class="button-primary" value="<?php esc\_attr\_e( 'Go', 'woocommerce-abandoned-cart' ); ?>"  /> |
| [3322](#L3322) | </form> |
| [3323](#L3323) | </div> |
| [3324](#L3324) | </div> |
| [3325](#L3325) | <div id="recovered\_stats" class="postbox" style="display:block"> |
| [3326](#L3326) | <div class="inside" > |
| [3327](#L3327) | <?php |
| [3328](#L3328) | $count              = $wcal\_recover\_orders\_list->total\_abandoned\_cart\_count; |
| [3329](#L3329) | $total\_of\_all\_order = $wcal\_recover\_orders\_list->total\_order\_amount; |
| [3330](#L3330) | $recovered\_item     = $wcal\_recover\_orders\_list->recovered\_item; |
| [3331](#L3331) | $recovered\_total    = wc\_price( $wcal\_recover\_orders\_list->total\_recover\_amount ); |
| [3332](#L3332) | ?> |
| [3333](#L3333) | <p style="font-size: 15px;"> |
| [3334](#L3334) | <?php |
| [3335](#L3335) | printf( |
| [3336](#L3336) | // translators: All counts of items & amounts. |
| [3337](#L3337) | wp\_kses\_post( |
| [3338](#L3338) | // translators: Abandoned & recovered numbers and order totals. |
| [3339](#L3339) | \_\_( 'During the selected range <strong>%1$d</strong> carts totaling <strong>%2$s</strong> were abandoned. We were able to recover <strong>%3$d</strong> of them, which led to an extra <strong>%4$s</strong>', 'woocommerce-abandoned-cart' ) |
| [3340](#L3340) | ), |
| [3341](#L3341) | esc\_attr( $count ), |
| [3342](#L3342) | wp\_kses\_post( $total\_of\_all\_order ), |
| [3343](#L3343) | esc\_attr( $recovered\_item ), |
| [3344](#L3344) | wp\_kses\_post( $recovered\_total ) |
| [3345](#L3345) | ); |
| [3346](#L3346) | ?> |
| [3347](#L3347) | </p> |
| [3348](#L3348) | </div> |
| [3349](#L3349) | </div> |
| [3350](#L3350) | <div class="wrap"> |
| [3351](#L3351) | <form id="wcal-recover-orders" method="get" > |
| [3352](#L3352) | <input type="hidden" name="page" value="woocommerce\_ac\_page" /> |
| [3353](#L3353) | <input type="hidden" name="action" value="stats" /> |
| [3354](#L3354) | <?php $wcal\_recover\_orders\_list->display(); ?> |
| [3355](#L3355) | </form> |
| [3356](#L3356) | </div> |
| [3357](#L3357) | <?php |
| [3358](#L3358) | } elseif ( 'orderdetails' === $action ) { |
| [3359](#L3359) | global $woocommerce; |
| [3360](#L3360) | $ac\_order\_id = isset( $\_GET['id'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['id'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [3361](#L3361) | ?> |
| [3362](#L3362) | <div id="ac\_order\_details" class="postbox" style="display:block"> |
| [3363](#L3363) | <?php // translators: Abandoned Order ID. ?> |
| [3364](#L3364) | <h3 class="details-title"> <p> <?php printf( esc\_html\_\_( 'Abandoned Order #%s Details', 'woocommerce-abandoned-cart' ), esc\_attr( $ac\_order\_id ) ); ?> </p> </h3> |
| [3365](#L3365) | <div class="inside"> |
| [3366](#L3366) | <table cellpadding="0" cellspacing="0" class="wp-list-table widefat fixed posts"> |
| [3367](#L3367) | <tr> |
| [3368](#L3368) | <th> <?php esc\_html\_e( 'Item', 'woocommerce-abandoned-cart' ); ?> </th> |
| [3369](#L3369) | <th> <?php esc\_html\_e( 'Name', 'woocommerce-abandoned-cart' ); ?> </th> |
| [3370](#L3370) | <th> <?php esc\_html\_e( 'Quantity', 'woocommerce-abandoned-cart' ); ?> </th> |
| [3371](#L3371) | <th> <?php esc\_html\_e( 'Line Subtotal', 'woocommerce-abandoned-cart' ); ?> </th> |
| [3372](#L3372) | <th> <?php esc\_html\_e( 'Line Total', 'woocommerce-abandoned-cart' ); ?> </th> |
| [3373](#L3373) | </tr> |
| [3374](#L3374) | <?php |
| [3375](#L3375) | $results = $wpdb->get\_results( // phpcs:ignore |
| [3376](#L3376) | $wpdb->prepare( |
| [3377](#L3377) | 'SELECT \* FROM `' . $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite` WHERE id = %d', |
| [3378](#L3378) | sanitize\_text\_field( wp\_unslash( $\_GET['id'] ) ) // phpcs:ignore WordPress.Security.NonceVerification |
| [3379](#L3379) | ) |
| [3380](#L3380) | ); |
| [3381](#L3381) |  |
| [3382](#L3382) | $shipping\_charges = 0; |
| [3383](#L3383) | $currency\_symbol  = get\_woocommerce\_currency\_symbol(); |
| [3384](#L3384) | $number\_decimal   = wc\_get\_price\_decimals(); |
| [3385](#L3385) | if ( 'GUEST' === $results[0]->user\_type && $results[0]->user\_id > 0 ) { |
| [3386](#L3386) | $results\_guest = $wpdb->get\_results( // phpcs:ignore |
| [3387](#L3387) | $wpdb->prepare( |
| [3388](#L3388) | 'SELECT \* FROM `' . $wpdb->prefix . 'ac\_guest\_abandoned\_cart\_history\_lite` WHERE id = %d', |
| [3389](#L3389) | $results[0]->user\_id |
| [3390](#L3390) | ) |
| [3391](#L3391) | ); |
| [3392](#L3392) |  |
| [3393](#L3393) | $user\_email             = ''; |
| [3394](#L3394) | $user\_first\_name        = ''; |
| [3395](#L3395) | $user\_last\_name         = ''; |
| [3396](#L3396) | $user\_billing\_postcode  = ''; |
| [3397](#L3397) | $user\_shipping\_postcode = ''; |
| [3398](#L3398) | $shipping\_charges       = ''; |
| [3399](#L3399) | if ( count( $results\_guest ) > 0 ) { |
| [3400](#L3400) | $user\_email             = $results\_guest[0]->email\_id; |
| [3401](#L3401) | $user\_first\_name        = $results\_guest[0]->billing\_first\_name; |
| [3402](#L3402) | $user\_last\_name         = $results\_guest[0]->billing\_last\_name; |
| [3403](#L3403) | $user\_billing\_postcode  = $results\_guest[0]->billing\_zipcode; |
| [3404](#L3404) | $user\_shipping\_postcode = $results\_guest[0]->shipping\_zipcode; |
| [3405](#L3405) | $shipping\_charges       = $results\_guest[0]->shipping\_charges; |
| [3406](#L3406) | } |
| [3407](#L3407) | $user\_billing\_company   = ''; |
| [3408](#L3408) | $user\_billing\_address\_1 = ''; |
| [3409](#L3409) | $user\_billing\_address\_2 = ''; |
| [3410](#L3410) | $user\_billing\_city      = ''; |
| [3411](#L3411) | $user\_billing\_state     = ''; |
| [3412](#L3412) | $user\_billing\_country   = ''; |
| [3413](#L3413) | $user\_billing\_phone     = ''; |
| [3414](#L3414) |  |
| [3415](#L3415) | $user\_shipping\_company   = ''; |
| [3416](#L3416) | $user\_shipping\_address\_1 = ''; |
| [3417](#L3417) | $user\_shipping\_address\_2 = ''; |
| [3418](#L3418) | $user\_shipping\_city      = ''; |
| [3419](#L3419) | $user\_shipping\_state     = ''; |
| [3420](#L3420) | $user\_shipping\_country   = ''; |
| [3421](#L3421) | } elseif ( 'GUEST' === $results[0]->user\_type && $results[0]->user\_id > 0 ) { |
| [3422](#L3422) | $user\_email              = ''; |
| [3423](#L3423) | $user\_first\_name         = 'Visitor'; |
| [3424](#L3424) | $user\_last\_name          = ''; |
| [3425](#L3425) | $user\_billing\_postcode   = ''; |
| [3426](#L3426) | $user\_shipping\_postcode  = ''; |
| [3427](#L3427) | $shipping\_charges        = ''; |
| [3428](#L3428) | $user\_billing\_phone      = ''; |
| [3429](#L3429) | $user\_billing\_company    = ''; |
| [3430](#L3430) | $user\_billing\_address\_1  = ''; |
| [3431](#L3431) | $user\_billing\_address\_2  = ''; |
| [3432](#L3432) | $user\_billing\_city       = ''; |
| [3433](#L3433) | $user\_billing\_state      = ''; |
| [3434](#L3434) | $user\_billing\_country    = ''; |
| [3435](#L3435) | $user\_shipping\_company   = ''; |
| [3436](#L3436) | $user\_shipping\_address\_1 = ''; |
| [3437](#L3437) | $user\_shipping\_address\_2 = ''; |
| [3438](#L3438) | $user\_shipping\_city      = ''; |
| [3439](#L3439) | $user\_shipping\_state     = ''; |
| [3440](#L3440) | $user\_shipping\_country   = ''; |
| [3441](#L3441) | } else { |
| [3442](#L3442) | $user\_id = $results[0]->user\_id; |
| [3443](#L3443) | if ( isset( $results[0]->user\_login ) ) { |
| [3444](#L3444) | $user\_login = $results[0]->user\_login; |
| [3445](#L3445) | } |
| [3446](#L3446) | $user\_email = get\_user\_meta( $results[0]->user\_id, 'billing\_email', true ); |
| [3447](#L3447) | if ( '' == $user\_email ) { // phpcs:ignore |
| [3448](#L3448) | $user\_data = get\_userdata( $results[0]->user\_id ); |
| [3449](#L3449) | if ( isset( $user\_data->user\_email ) ) { |
| [3450](#L3450) | $user\_email = $user\_data->user\_email; |
| [3451](#L3451) | } else { |
| [3452](#L3452) | $user\_email = ''; |
| [3453](#L3453) | } |
| [3454](#L3454) | } |
| [3455](#L3455) |  |
| [3456](#L3456) | $user\_first\_name      = ''; |
| [3457](#L3457) | $user\_first\_name\_temp = get\_user\_meta( $user\_id, 'billing\_first\_name', true ); |
| [3458](#L3458) | if ( isset( $user\_first\_name\_temp ) && '' == $user\_first\_name\_temp ) { // phpcs:ignore |
| [3459](#L3459) | $user\_data = get\_userdata( $user\_id ); |
| [3460](#L3460) | if ( isset( $user\_data->first\_name ) ) { |
| [3461](#L3461) | $user\_first\_name = $user\_data->first\_name; |
| [3462](#L3462) | } else { |
| [3463](#L3463) | $user\_first\_name = ''; |
| [3464](#L3464) | } |
| [3465](#L3465) | } else { |
| [3466](#L3466) | $user\_first\_name = $user\_first\_name\_temp; |
| [3467](#L3467) | } |
| [3468](#L3468) | $user\_last\_name      = ''; |
| [3469](#L3469) | $user\_last\_name\_temp = get\_user\_meta( $user\_id, 'billing\_last\_name', true ); |
| [3470](#L3470) | if ( isset( $user\_last\_name\_temp ) && '' == $user\_last\_name\_temp ) { // phpcs:ignore |
| [3471](#L3471) | $user\_data = get\_userdata( $user\_id ); |
| [3472](#L3472) | if ( isset( $user\_data->last\_name ) ) { |
| [3473](#L3473) | $user\_last\_name = $user\_data->last\_name; |
| [3474](#L3474) | } else { |
| [3475](#L3475) | $user\_last\_name = ''; |
| [3476](#L3476) | } |
| [3477](#L3477) | } else { |
| [3478](#L3478) | $user\_last\_name = $user\_last\_name\_temp; |
| [3479](#L3479) | } |
| [3480](#L3480) | $user\_billing\_first\_name = get\_user\_meta( $results[0]->user\_id, 'billing\_first\_name' ); |
| [3481](#L3481) | $user\_billing\_last\_name  = get\_user\_meta( $results[0]->user\_id, 'billing\_last\_name' ); |
| [3482](#L3482) |  |
| [3483](#L3483) | $user\_billing\_details = wcal\_common::wcal\_get\_billing\_details( $results[0]->user\_id ); |
| [3484](#L3484) |  |
| [3485](#L3485) | $user\_billing\_company   = $user\_billing\_details['billing\_company']; |
| [3486](#L3486) | $user\_billing\_address\_1 = $user\_billing\_details['billing\_address\_1']; |
| [3487](#L3487) | $user\_billing\_address\_2 = $user\_billing\_details['billing\_address\_2']; |
| [3488](#L3488) | $user\_billing\_city      = $user\_billing\_details['billing\_city']; |
| [3489](#L3489) | $user\_billing\_postcode  = $user\_billing\_details['billing\_postcode']; |
| [3490](#L3490) | $user\_billing\_country   = $user\_billing\_details['billing\_country']; |
| [3491](#L3491) | $user\_billing\_state     = $user\_billing\_details['billing\_state']; |
| [3492](#L3492) |  |
| [3493](#L3493) | $user\_billing\_phone\_temp = get\_user\_meta( $results[0]->user\_id, 'billing\_phone' ); |
| [3494](#L3494) | if ( isset( $user\_billing\_phone\_temp[0] ) ) { |
| [3495](#L3495) | $user\_billing\_phone = $user\_billing\_phone\_temp[0]; |
| [3496](#L3496) | } else { |
| [3497](#L3497) | $user\_billing\_phone = ''; |
| [3498](#L3498) | } |
| [3499](#L3499) | $user\_shipping\_first\_name   = get\_user\_meta( $results[0]->user\_id, 'shipping\_first\_name' ); |
| [3500](#L3500) | $user\_shipping\_last\_name    = get\_user\_meta( $results[0]->user\_id, 'shipping\_last\_name' ); |
| [3501](#L3501) | $user\_shipping\_company\_temp = get\_user\_meta( $results[0]->user\_id, 'shipping\_company' ); |
| [3502](#L3502) | if ( isset( $user\_shipping\_company\_temp[0] ) ) { |
| [3503](#L3503) | $user\_shipping\_company = $user\_shipping\_company\_temp[0]; |
| [3504](#L3504) | } else { |
| [3505](#L3505) | $user\_shipping\_company = ''; |
| [3506](#L3506) | } |
| [3507](#L3507) | $user\_shipping\_address\_1\_temp = get\_user\_meta( $results[0]->user\_id, 'shipping\_address\_1' ); |
| [3508](#L3508) | if ( isset( $user\_shipping\_address\_1\_temp[0] ) ) { |
| [3509](#L3509) | $user\_shipping\_address\_1 = $user\_shipping\_address\_1\_temp[0]; |
| [3510](#L3510) | } else { |
| [3511](#L3511) | $user\_shipping\_address\_1 = ''; |
| [3512](#L3512) | } |
| [3513](#L3513) | $user\_shipping\_address\_2\_temp = get\_user\_meta( $results[0]->user\_id, 'shipping\_address\_2' ); |
| [3514](#L3514) | if ( isset( $user\_shipping\_address\_2\_temp[0] ) ) { |
| [3515](#L3515) | $user\_shipping\_address\_2 = $user\_shipping\_address\_2\_temp[0]; |
| [3516](#L3516) | } else { |
| [3517](#L3517) | $user\_shipping\_address\_2 = ''; |
| [3518](#L3518) | } |
| [3519](#L3519) | $user\_shipping\_city\_temp = get\_user\_meta( $results[0]->user\_id, 'shipping\_city' ); |
| [3520](#L3520) | if ( isset( $user\_shipping\_city\_temp[0] ) ) { |
| [3521](#L3521) | $user\_shipping\_city = $user\_shipping\_city\_temp[0]; |
| [3522](#L3522) | } else { |
| [3523](#L3523) | $user\_shipping\_city = ''; |
| [3524](#L3524) | } |
| [3525](#L3525) | $user\_shipping\_postcode\_temp = get\_user\_meta( $results[0]->user\_id, 'shipping\_postcode' ); |
| [3526](#L3526) | if ( isset( $user\_shipping\_postcode\_temp[0] ) ) { |
| [3527](#L3527) | $user\_shipping\_postcode = $user\_shipping\_postcode\_temp[0]; |
| [3528](#L3528) | } else { |
| [3529](#L3529) | $user\_shipping\_postcode = ''; |
| [3530](#L3530) | } |
| [3531](#L3531) | $user\_shipping\_country\_temp = get\_user\_meta( $results[0]->user\_id, 'shipping\_country' ); |
| [3532](#L3532) | $user\_shipping\_country      = ''; |
| [3533](#L3533) | if ( isset( $user\_shipping\_country\_temp[0] ) ) { |
| [3534](#L3534) | $user\_shipping\_country = $user\_shipping\_country\_temp[0]; |
| [3535](#L3535) | if ( isset( $woocommerce->countries->countries[ $user\_shipping\_country ] ) ) { |
| [3536](#L3536) | $user\_shipping\_country = $woocommerce->countries->countries[ $user\_shipping\_country ]; |
| [3537](#L3537) | } else { |
| [3538](#L3538) | $user\_shipping\_country = ''; |
| [3539](#L3539) | } |
| [3540](#L3540) | } |
| [3541](#L3541) | $user\_shipping\_state\_temp = get\_user\_meta( $results[0]->user\_id, 'shipping\_state' ); |
| [3542](#L3542) | $user\_shipping\_state      = ''; |
| [3543](#L3543) | if ( isset( $user\_shipping\_state\_temp[0] ) ) { |
| [3544](#L3544) | $user\_shipping\_state = $user\_shipping\_state\_temp[0]; |
| [3545](#L3545) | if ( isset( $woocommerce->countries->states[ $user\_shipping\_country\_temp[0] ][ $user\_shipping\_state ] ) ) { |
| [3546](#L3546) | // code... |
| [3547](#L3547) | $user\_shipping\_state = $woocommerce->countries->states[ $user\_shipping\_country\_temp[0] ][ $user\_shipping\_state ]; |
| [3548](#L3548) | } |
| [3549](#L3549) | } |
| [3550](#L3550) | } |
| [3551](#L3551) |  |
| [3552](#L3552) | $cart\_details  = array(); |
| [3553](#L3553) | $cart\_info     = json\_decode( $results[0]->abandoned\_cart\_info ); |
| [3554](#L3554) | $cart\_details  = (array) $cart\_info->cart; |
| [3555](#L3555) | $item\_subtotal = 0; |
| [3556](#L3556) | $item\_total    = 0; |
| [3557](#L3557) |  |
| [3558](#L3558) | if ( is\_array( $cart\_details ) && count( $cart\_details ) > 0 ) { |
| [3559](#L3559) | foreach ( $cart\_details as $k => $v ) { |
| [3560](#L3560) |  |
| [3561](#L3561) | $item\_details = wcal\_common::wcal\_get\_cart\_details( $v ); |
| [3562](#L3562) |  |
| [3563](#L3563) | $product\_id = $v->product\_id; |
| [3564](#L3564) | $product    = wc\_get\_product( $product\_id ); |
| [3565](#L3565) | if ( ! $product ) { // product not found, exclude it from the cart display. |
| [3566](#L3566) | continue; |
| [3567](#L3567) | } |
| [3568](#L3568) | $prod\_image       = $product->get\_image( array( 200, 200 ) ); |
| [3569](#L3569) | $product\_page\_url = get\_permalink( $product\_id ); |
| [3570](#L3570) | $product\_name     = $item\_details['product\_name']; |
| [3571](#L3571) | $item\_subtotal    = $item\_details['item\_total\_formatted']; |
| [3572](#L3572) | $item\_total       = $item\_details['item\_total']; |
| [3573](#L3573) | $quantity\_total   = $item\_details['qty']; |
| [3574](#L3574) |  |
| [3575](#L3575) | $qty\_item\_text = 'item'; |
| [3576](#L3576) | if ( $quantity\_total > 1 ) { |
| [3577](#L3577) | $qty\_item\_text = 'items'; |
| [3578](#L3578) | } |
| [3579](#L3579) | ?> |
| [3580](#L3580) | <tr> |
| [3581](#L3581) | <td> <?php echo $prod\_image; // phpcs:ignore ?></td> |
| [3582](#L3582) | <td> <?php echo '<a href="' . esc\_url( $product\_page\_url ) . '"> ' . esc\_html( $product\_name ) . ' </a>'; ?> </td> |
| [3583](#L3583) | <td> <?php echo esc\_html( $quantity\_total ); ?></td> |
| [3584](#L3584) | <td> <?php echo esc\_html( $item\_subtotal ); ?></td> |
| [3585](#L3585) | <td> <?php echo esc\_html( $item\_total ); ?></td> |
| [3586](#L3586) | </tr> |
| [3587](#L3587) | <?php |
| [3588](#L3588) | $item\_subtotal = 0; |
| [3589](#L3589) | $item\_total    = 0; |
| [3590](#L3590) | } |
| [3591](#L3591) | } |
| [3592](#L3592) | ?> |
| [3593](#L3593) | </table> |
| [3594](#L3594) | </div> |
| [3595](#L3595) | </div> |
| [3596](#L3596) | <div id="ac\_order\_customer\_details" class="postbox" style="display:block"> |
| [3597](#L3597) | <h3 class="details-title"> <p> <?php esc\_html\_e( 'Customer Details', 'woocommerce-abandoned-cart' ); ?> </p> </h3> |
| [3598](#L3598) | <div class="inside" style="height: 300px;" > |
| [3599](#L3599) | <div id="order\_data" class="panel"> |
| [3600](#L3600) | <div style="width:50%;float:left"> |
| [3601](#L3601) | <h3> <p> <?php esc\_html\_e( 'Billing Details', 'woocommerce-abandoned-cart' ); ?> </p> </h3> |
| [3602](#L3602) | <p> <strong> <?php esc\_html\_e( 'Name:', 'woocommerce-abandoned-cart' ); ?> </strong> |
| [3603](#L3603) | <?php echo esc\_html( "$user\_first\_name $user\_last\_name" ); ?> |
| [3604](#L3604) | </p> |
| [3605](#L3605) | <p> <strong> <?php esc\_html\_e( 'Address:', 'woocommerce-abandoned-cart' ); ?> </strong> |
| [3606](#L3606) | <?php |
| [3607](#L3607) | echo esc\_html( $user\_billing\_company ) . '</br>' . |
| [3608](#L3608) | esc\_html( $user\_billing\_address\_1 ) . '</br>' . |
| [3609](#L3609) | esc\_html( $user\_billing\_address\_2 ) . '</br>' . |
| [3610](#L3610) | esc\_html( $user\_billing\_city ) . '</br>' . |
| [3611](#L3611) | esc\_html( $user\_billing\_postcode ) . '</br>' . |
| [3612](#L3612) | esc\_html( $user\_billing\_state ) . '</br>' . |
| [3613](#L3613) | esc\_html( $user\_billing\_country ) . '</br>'; |
| [3614](#L3614) | ?> |
| [3615](#L3615) | </p> |
| [3616](#L3616) | <p> <strong> <?php esc\_html\_e( 'Email:', 'woocommerce-abandoned-cart' ); ?> </strong> |
| [3617](#L3617) | <?php $user\_mail\_to = 'mailto:' . $user\_email; ?> |
| [3618](#L3618) | <a href=<?php echo esc\_url( $user\_mail\_to ); ?>><?php echo esc\_html( $user\_email ); ?> </a> |
| [3619](#L3619) | </p> |
| [3620](#L3620) | <p> <strong> <?php esc\_html\_e( 'Phone:', 'woocommerce-abandoned-cart' ); ?> </strong> |
| [3621](#L3621) | <?php echo esc\_html( $user\_billing\_phone ); ?> |
| [3622](#L3622) | </p> |
| [3623](#L3623) | </div> |
| [3624](#L3624) | <div style="width:50%;float:right"> |
| [3625](#L3625) | <h3> <p> <?php esc\_html\_e( 'Shipping Details', 'woocommerce-abandoned-cart' ); ?> </p> </h3> |
| [3626](#L3626) | <p> <strong> <?php esc\_html\_e( 'Address:', 'woocommerce-abandoned-cart' ); ?> </strong> |
| [3627](#L3627) | <?php |
| [3628](#L3628) | if ( '' === $user\_shipping\_company && |
| [3629](#L3629) | '' === $user\_shipping\_address\_1 && |
| [3630](#L3630) | '' === $user\_shipping\_address\_2 && |
| [3631](#L3631) | '' === $user\_shipping\_city && |
| [3632](#L3632) | '' === $user\_shipping\_postcode && |
| [3633](#L3633) | '' === $user\_shipping\_state && |
| [3634](#L3634) | '' === $user\_shipping\_country ) { |
| [3635](#L3635) | echo esc\_html\_e( 'Shipping Address same as Billing Address', 'woocommerce-abandoned-cart' ); |
| [3636](#L3636) | } else { |
| [3637](#L3637) | ?> |
| [3638](#L3638) | <?php |
| [3639](#L3639) | echo esc\_html( $user\_shipping\_company ) . '</br>' . |
| [3640](#L3640) | esc\_html( $user\_shipping\_address\_1 ) . '</br>' . |
| [3641](#L3641) | esc\_html( $user\_shipping\_address\_2 ) . '</br>' . |
| [3642](#L3642) | esc\_html( $user\_shipping\_city ) . '</br>' . |
| [3643](#L3643) | esc\_html( $user\_shipping\_postcode ) . '</br>' . |
| [3644](#L3644) | esc\_html( $user\_shipping\_state ) . '</br>' . |
| [3645](#L3645) | esc\_html( $user\_shipping\_country ) . '</br>'; |
| [3646](#L3646) | ?> |
| [3647](#L3647) | <br><br> |
| [3648](#L3648) | <strong><?php esc\_html\_e( 'Shipping Charges', 'woocommerce-abandoned-cart' ); ?>: </strong> |
| [3649](#L3649) | <?php |
| [3650](#L3650) | if ( $shipping\_charges > 0 ) { |
| [3651](#L3651) | echo wp\_kses\_post( $currency\_symbol . $shipping\_charges ); |
| [3652](#L3652) | } |
| [3653](#L3653) | ?> |
| [3654](#L3654) | </p> |
| [3655](#L3655) | <?php } ?> |
| [3656](#L3656) | </div> |
| [3657](#L3657) | </div> |
| [3658](#L3658) | </div> |
| [3659](#L3659) | </div> |
| [3660](#L3660) | <?php |
| [3661](#L3661) | } elseif ( 'report' === $action ) { |
| [3662](#L3662) |  |
| [3663](#L3663) | include\_once 'includes/classes/class-wcal-product-report-table.php'; |
| [3664](#L3664) | $wcal\_product\_report\_list = new WCAL\_Product\_Report\_Table(); |
| [3665](#L3665) | $wcal\_product\_report\_list->wcal\_product\_report\_prepare\_items(); |
| [3666](#L3666) | ?> |
| [3667](#L3667) | <div class="wrap"> |
| [3668](#L3668) | <form id="wcal-sent-emails" method="get" > |
| [3669](#L3669) | <input type="hidden" name="page" value="woocommerce\_ac\_page" /> |
| [3670](#L3670) | <input type="hidden" name="action" value="report" /> |
| [3671](#L3671) | <?php $wcal\_product\_report\_list->display(); ?> |
| [3672](#L3672) | </form> |
| [3673](#L3673) | </div> |
| [3674](#L3674) | <?php |
| [3675](#L3675) | } |
| [3676](#L3676) | } |
| [3677](#L3677) | echo( '</table>' ); |
| [3678](#L3678) |  |
| [3679](#L3679) | $action = isset( $\_GET['action'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['action'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [3680](#L3680) | $mode   = isset( $\_GET['mode'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['mode'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [3681](#L3681) |  |
| [3682](#L3682) | $edit\_id = 0; |
| [3683](#L3683) | if ( 'emailtemplates' === $action && ( 'addnewtemplate' === $mode || 'edittemplate' === $mode ) ) { |
| [3684](#L3684) | if ( 'edittemplate' === $mode ) { |
| [3685](#L3685) | $results = array(); |
| [3686](#L3686) | if ( isset( $\_GET['id'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [3687](#L3687) | $edit\_id = sanitize\_text\_field( wp\_unslash( $\_GET['id'] ) ); // phpcs:ignore WordPress.Security.NonceVerification |
| [3688](#L3688) | $results = $wpdb->get\_results( // phpcs:ignore |
| [3689](#L3689) | $wpdb->prepare( |
| [3690](#L3690) | 'SELECT wpet . \*  FROM `' . $wpdb->prefix . 'ac\_email\_templates\_lite` AS wpet WHERE id = %d', |
| [3691](#L3691) | $edit\_id |
| [3692](#L3692) | ) |
| [3693](#L3693) | ); |
| [3694](#L3694) | } |
| [3695](#L3695) | } |
| [3696](#L3696) | $active\_post = ( empty( $\_POST['is\_active'] ) ) ? '0' : '1'; // phpcs:ignore WordPress.Security.NonceVerification |
| [3697](#L3697) | ?> |
| [3698](#L3698) | <div id="content"> |
| [3699](#L3699) | <form method="post" action="admin.php?page=woocommerce\_ac\_page&action=emailtemplates" id="ac\_settings"> |
| [3700](#L3700) | <input type="hidden" name="mode" value="<?php echo esc\_html( $mode ); ?>" /> |
| [3701](#L3701) | <?php |
| [3702](#L3702) | $id\_by = isset( $\_GET['id'] ) ? sanitize\_text\_field( wp\_unslash( $\_GET['id'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [3703](#L3703) | ?> |
| [3704](#L3704) | <input type="hidden" name="id" value="<?php echo esc\_html( $id\_by ); ?>" /> |
| [3705](#L3705) | <?php |
| [3706](#L3706) | if ( 'edittemplate' === $mode ) { |
| [3707](#L3707) | print '<input type="hidden" name="ac\_settings\_frm" value="update">'; |
| [3708](#L3708) | $display\_message = 'Edit Email Template'; |
| [3709](#L3709) | } else { |
| [3710](#L3710) | print '<input type="hidden" name="ac\_settings\_frm" value="save">'; |
| [3711](#L3711) | $display\_message = 'Add Email Template'; |
| [3712](#L3712) | } |
| [3713](#L3713) | ?> |
| [3714](#L3714) | <div id="poststuff"> |
| [3715](#L3715) | <div> <!-- <div class="postbox" > --> |
| [3716](#L3716) | <h3 class="hndle"><?php esc\_html\_e( $display\_message, 'woocommerce-abandoned-cart' ); // phpcs:ignore?></h3> |
| [3717](#L3717) | <div> |
| [3718](#L3718) | <table class="form-table" id="addedit\_template"> |
| [3719](#L3719) | <tr> |
| [3720](#L3720) | <th> |
| [3721](#L3721) | <label for="woocommerce\_ac\_template\_name"><b><?php esc\_html\_e( 'Template Name:', 'woocommerce-abandoned-cart' ); ?></b></label> |
| [3722](#L3722) | </th> |
| [3723](#L3723) | <td> |
| [3724](#L3724) | <?php |
| [3725](#L3725) | $template\_name = ''; |
| [3726](#L3726) | if ( 'edittemplate' === $mode && count( $results ) > 0 && isset( $results[0]->template\_name ) ) { |
| [3727](#L3727) | $template\_name = $results[0]->template\_name; |
| [3728](#L3728) | } |
| [3729](#L3729) | print '<input type="text" name="woocommerce\_ac\_template\_name" id="woocommerce\_ac\_template\_name" class="regular-text" value="' . esc\_html( $template\_name ) . '">'; |
| [3730](#L3730) | ?> |
| [3731](#L3731) | <img class="help\_tip" width="16" height="16" data-tip='<?php esc\_html\_e( 'Enter a template name for reference', 'woocommerce-abandoned-cart' ); ?>' src="<?php echo esc\_url( WC()->plugin\_url() ); ?>/assets/images/help.png" /> |
| [3732](#L3732) | </td> |
| [3733](#L3733) | </tr> |
| [3734](#L3734) |  |
| [3735](#L3735) | <tr> |
| [3736](#L3736) | <th> |
| [3737](#L3737) | <label for="woocommerce\_ac\_email\_subject"><b><?php esc\_html\_e( 'Subject:', 'woocommerce-abandoned-cart' ); ?></b></label> |
| [3738](#L3738) | </th> |
| [3739](#L3739) | <td> |
| [3740](#L3740) | <?php |
| [3741](#L3741) | $subject\_edit = ''; |
| [3742](#L3742) | if ( 'edittemplate' === $mode && count( $results ) > 0 && isset( $results[0]->subject ) ) { |
| [3743](#L3743) | $subject\_edit = stripslashes( $results[0]->subject ); |
| [3744](#L3744) | } |
| [3745](#L3745) | print '<input type="text" name="woocommerce\_ac\_email\_subject" id="woocommerce\_ac\_email\_subject" class="regular-text" value="' . esc\_html( $subject\_edit ) . '">'; |
| [3746](#L3746) | ?> |
| [3747](#L3747) | <img class="help\_tip" width="16" height="16" data-tip='<?php esc\_html\_e( 'Enter the subject that should appear in the email sent', 'woocommerce-abandoned-cart' ); ?>' src="<?php echo esc\_url( WC()->plugin\_url() ); ?>/assets/images/help.png" /> |
| [3748](#L3748) | </td> |
| [3749](#L3749) | </tr> |
| [3750](#L3750) |  |
| [3751](#L3751) | <tr> |
| [3752](#L3752) | <th> |
| [3753](#L3753) | <label for="woocommerce\_ac\_email\_body"><b><?php esc\_html\_e( 'Email Body:', 'woocommerce-abandoned-cart' ); ?></b></label> |
| [3754](#L3754) | </th> |
| [3755](#L3755) | <td> |
| [3756](#L3756) | <?php |
| [3757](#L3757) | $initial\_data = ''; |
| [3758](#L3758) | if ( 'edittemplate' === $mode && count( $results ) > 0 && isset( $results[0]->body ) ) { |
| [3759](#L3759) | $initial\_data = stripslashes( $results[0]->body ); |
| [3760](#L3760) | } |
| [3761](#L3761) |  |
| [3762](#L3762) | $initial\_data = str\_replace( 'My document title', '', $initial\_data ); |
| [3763](#L3763) | wp\_editor( |
| [3764](#L3764) | $initial\_data, |
| [3765](#L3765) | 'woocommerce\_ac\_email\_body', |
| [3766](#L3766) | array( |
| [3767](#L3767) | 'media\_buttons' => true, |
| [3768](#L3768) | 'textarea\_rows' => 15, |
| [3769](#L3769) | 'tabindex'      => 4, |
| [3770](#L3770) | 'tinymce'       => array( |
| [3771](#L3771) | 'theme\_advanced\_buttons1' => 'bold,italic,underline,|,bullist,numlist,blockquote,|,link,unlink,|,spellchecker,fullscreen,|,formatselect,styleselect', |
| [3772](#L3772) | ), |
| [3773](#L3773) | ) |
| [3774](#L3774) | ); |
| [3775](#L3775) |  |
| [3776](#L3776) | ?> |
| [3777](#L3777) | <?php echo wp\_kses\_post( stripslashes( get\_option( 'woocommerce\_ac\_email\_body' ) ) ); ?> |
| [3778](#L3778) | <span class="description"> |
| [3779](#L3779) | <?php |
| [3780](#L3780) | esc\_html\_e( 'Message to be sent in the reminder email.', 'woocommerce-abandoned-cart' ); |
| [3781](#L3781) | ?> |
| [3782](#L3782) | <img width="16" height="16" src="<?php echo esc\_url( plugins\_url() ); ?>/woocommerce-abandoned-cart/assets/images/information.png" onClick="wcal\_show\_help\_tips()"/> |
| [3783](#L3783) | </span> |
| [3784](#L3784) | <span id="help\_message" style="display:none"> |
| [3785](#L3785) | 1. You can add customer & cart information in the template using this icon <img width="20" height="20" src="<?php echo esc\_url( plugins\_url( '/assets/images/ac\_editor\_icon.png', \_\_FILE\_\_ ) ); ?>" /> in top left of the editor.<br> |
| [3786](#L3786) | 2. The product information/cart contents table will be added in emails using the {{products.cart}} merge field.<br> |
| [3787](#L3787) | 3. Insert/Remove any of the new shortcodes that have been included for the default template.<br> |
| [3788](#L3788) | 4. Change the look and feel of the table by modifying the table style properties using CSS in "Text" mode. <br> |
| [3789](#L3789) | 5. Change the text color of the table rows by using the Toolbar of the editor. <br> |
| [3790](#L3790) |  |
| [3791](#L3791) | </span> |
| [3792](#L3792) | </td> |
| [3793](#L3793) | </tr> |
| [3794](#L3794) | <script type="text/javascript"> |
| [3795](#L3795) | function wcal\_show\_help\_tips() { |
| [3796](#L3796) | if ( jQuery( '#help\_message' ) . css( 'display' ) == 'none') { |
| [3797](#L3797) | document.getElementById( "help\_message" ).style.display = "block"; |
| [3798](#L3798) | } |
| [3799](#L3799) | else { |
| [3800](#L3800) | document.getElementById( "help\_message" ) . style.display = "none"; |
| [3801](#L3801) | } |
| [3802](#L3802) | } |
| [3803](#L3803) | </script> |
| [3804](#L3804) |  |
| [3805](#L3805) | <tr> |
| [3806](#L3806) | <th> |
| [3807](#L3807) | <label for="is\_wc\_template"><b><?php esc\_html\_e( 'Use WooCommerce Template Style:', 'woocommerce-abandoned-cart' ); ?></b></label> |
| [3808](#L3808) | </th> |
| [3809](#L3809) | <td> |
| [3810](#L3810) | <?php |
| [3811](#L3811) | $is\_wc\_template = ''; |
| [3812](#L3812) | if ( 'edittemplate' === $mode && count( $results ) > 0 && isset( $results[0]->is\_wc\_template ) ) { |
| [3813](#L3813) | $use\_wc\_template = $results[0]->is\_wc\_template; |
| [3814](#L3814) |  |
| [3815](#L3815) | if ( '1' === $use\_wc\_template ) { |
| [3816](#L3816) | $is\_wc\_template = 'checked'; |
| [3817](#L3817) | } else { |
| [3818](#L3818) | $is\_wc\_template = ''; |
| [3819](#L3819) | } |
| [3820](#L3820) | } |
| [3821](#L3821) | print '<input type="checkbox" name="is\_wc\_template" id="is\_wc\_template" ' . esc\_attr( $is\_wc\_template ) . '>  </input>'; |
| [3822](#L3822) | ?> |
| [3823](#L3823) | <img class="help\_tip" width="16" height="16" data-tip='<?php esc\_html\_e( 'Use WooCommerce default style template for abandoned cart reminder emails.', 'woocommerce' ); ?>' src="<?php echo esc\_url( WC()->plugin\_url() ); ?>/assets/images/help.png" /><a target = '\_blank' href= <?php echo esc\_url( wp\_nonce\_url( admin\_url( "?wcal\_preview\_woocommerce\_mail=true&id=$edit\_id" ), 'woocommerce-abandoned-cart' ) ); ?> > |
| [3824](#L3824) | Click here to preview </a>how the email template will look with WooCommerce Template Style enabled. Alternatively, if this is unchecked, the template will appear as <a target = '\_blank' href=<?php echo esc\_url( wp\_nonce\_url( admin\_url( "?wcal\_preview\_mail=true&id=$edit\_id" ), 'woocommerce-abandoned-cart' ) ); ?>>shown here</a>. <br> <strong>Note: </strong>When this setting is enabled, then "Send From This Name:" & "Send From This Email Address:" will be overwritten with WooCommerce -> Settings -> Email -> Email Sender Options. |
| [3825](#L3825) | </td> |
| [3826](#L3826) | </tr> |
| [3827](#L3827) |  |
| [3828](#L3828) | <tr> |
| [3829](#L3829) | <th> |
| [3830](#L3830) | <label for="wcal\_wc\_email\_header"><b><?php esc\_html\_e( 'Email Template Header Text: ', 'woocommerce-abandoned-cart' ); ?></b></label> |
| [3831](#L3831) | </th> |
| [3832](#L3832) | <td> |
| [3833](#L3833) |  |
| [3834](#L3834) | <?php |
| [3835](#L3835) |  |
| [3836](#L3836) | $wcal\_wc\_email\_header = ''; |
| [3837](#L3837) | if ( 'edittemplate' === $mode && count( $results ) > 0 && isset( $results[0]->wc\_email\_header ) ) { |
| [3838](#L3838) | $wcal\_wc\_email\_header = $results[0]->wc\_email\_header; |
| [3839](#L3839) | } |
| [3840](#L3840) | if ( '' === $wcal\_wc\_email\_header ) { |
| [3841](#L3841) | $wcal\_wc\_email\_header = 'Abandoned cart reminder'; |
| [3842](#L3842) | } |
| [3843](#L3843) | print '<input type="text" name="wcal\_wc\_email\_header" id="wcal\_wc\_email\_header" class="regular-text" value="' . esc\_html( $wcal\_wc\_email\_header ) . '">'; |
| [3844](#L3844) | ?> |
| [3845](#L3845) | <img class="help\_tip" width="16" height="16" data-tip='<?php esc\_html\_e( 'Enter the header which will appear in the abandoned WooCommerce email sent. This is only applicable when only used when "Use WooCommerce Template Style:" is checked.', 'woocommerce-abandoned-cart' ); ?>' src="<?php echo esc\_url( WC()->plugin\_url() ); ?>/assets/images/help.png" /> |
| [3846](#L3846) | </td> |
| [3847](#L3847) | </tr> |
| [3848](#L3848) |  |
| [3849](#L3849) | <tr> |
| [3850](#L3850) | <th> |
| [3851](#L3851) | <label for="woocommerce\_ac\_email\_frequency"><b><?php esc\_html\_e( 'Send this email:', 'woocommerce-abandoned-cart' ); ?></b></label> |
| [3852](#L3852) | </th> |
| [3853](#L3853) | <td> |
| [3854](#L3854) | <select name="email\_frequency" id="email\_frequency"> |
| [3855](#L3855) | <?php |
| [3856](#L3856) | $frequency\_edit = ''; |
| [3857](#L3857) | if ( 'edittemplate' === $mode && count( $results ) > 0 && isset( $results[0]->frequency ) ) { |
| [3858](#L3858) | $frequency\_edit = $results[0]->frequency; |
| [3859](#L3859) | } |
| [3860](#L3860) | for ( $i = 1; $i < 60; $i++ ) { |
| [3861](#L3861) | printf( |
| [3862](#L3862) | "<option %s value='%s'>%s</option>\n", |
| [3863](#L3863) | selected( $i, $frequency\_edit, false ), |
| [3864](#L3864) | esc\_attr( $i ), |
| [3865](#L3865) | esc\_html( $i ) |
| [3866](#L3866) | ); |
| [3867](#L3867) | } |
| [3868](#L3868) | ?> |
| [3869](#L3869) | </select> |
| [3870](#L3870) |  |
| [3871](#L3871) | <select name="day\_or\_hour" id="day\_or\_hour"> |
| [3872](#L3872) | <?php |
| [3873](#L3873) | $days\_or\_hours\_edit = ''; |
| [3874](#L3874) | if ( 'edittemplate' === $mode && count( $results ) > 0 && isset( $results[0]->day\_or\_hour ) ) { |
| [3875](#L3875) | $days\_or\_hours\_edit = $results[0]->day\_or\_hour; |
| [3876](#L3876) | } |
| [3877](#L3877) | $days\_or\_hours = array( |
| [3878](#L3878) | 'Minutes' => 'Minute(s)', |
| [3879](#L3879) | 'Days' => 'Day(s)', |
| [3880](#L3880) | 'Hours' => 'Hour(s)', |
| [3881](#L3881) | ); |
| [3882](#L3882) | foreach ( $days\_or\_hours as $k => $v ) { |
| [3883](#L3883) | printf( |
| [3884](#L3884) | "<option %s value='%s'>%s</option>\n", |
| [3885](#L3885) | selected( $k, $days\_or\_hours\_edit, false ), |
| [3886](#L3886) | esc\_attr( $k ), |
| [3887](#L3887) | esc\_html( $v ) |
| [3888](#L3888) | ); |
| [3889](#L3889) | } |
| [3890](#L3890) | ?> |
| [3891](#L3891) | </select> |
| [3892](#L3892) | <span class="description"> |
| [3893](#L3893) | <?php esc\_html\_e( 'after cart is abandoned.', 'woocommerce-abandoned-cart' ); ?> |
| [3894](#L3894) | </span> |
| [3895](#L3895) | </td> |
| [3896](#L3896) | </tr> |
| [3897](#L3897) | <?php include\_once 'views/wcal-email-coupon.php'; ?> |
| [3898](#L3898) | <tr> |
| [3899](#L3899) | <th> |
| [3900](#L3900) | <label for="woocommerce\_ac\_email\_preview"><b><?php esc\_html\_e( 'Send a test email to:', 'woocommerce-abandoned-cart' ); ?></b></label> |
| [3901](#L3901) | </th> |
| [3902](#L3902) | <td> |
| [3903](#L3903) | <?php |
| [3904](#L3904) | $user        = wp\_get\_current\_user(); |
| [3905](#L3905) | $admin\_email = isset( $user->user\_email ) ? $user->user\_email : ''; |
| [3906](#L3906) | ?> |
| [3907](#L3907) | <input type="text" id="send\_test\_email" name="send\_test\_email" class="regular-text" value="<?php echo esc\_attr( $admin\_email ); ?>" > |
| [3908](#L3908) | <input type="button" value="Send a test email" id="preview\_email" onclick="javascript:void(0);"> |
| [3909](#L3909) | <img class="help\_tip" width="16" height="16" data-tip='<?php esc\_html\_e( 'Enter the email id to which the test email needs to be sent.', 'woocommerce-abandoned-cart' ); ?>' src="<?php echo esc\_url( WC()->plugin\_url() ); ?>/assets/images/help.png" /> |
| [3910](#L3910) | <br> |
| [3911](#L3911) | <img class="ajax\_img" src="<?php echo esc\_url( plugins\_url( '/assets/images/ajax-loader.gif', \_\_FILE\_\_ ) ); ?>" style="display:none;" /> |
| [3912](#L3912) | <div id="preview\_email\_sent\_msg" style="display:none;"></div> |
| [3913](#L3913) | </td> |
| [3914](#L3914) | </tr> |
| [3915](#L3915) | </table> |
| [3916](#L3916) | </div> |
| [3917](#L3917) | </div> |
| [3918](#L3918) | </div> |
| [3919](#L3919) | <p class="submit"> |
| [3920](#L3920) | <?php |
| [3921](#L3921) | if ( 'edittemplate' === $mode ) { |
| [3922](#L3922) | ?> |
| [3923](#L3923) | <input type="submit" name="Submit" class="button-primary" value="<?php esc\_attr\_e( 'Update Changes', 'woocommerce-abandoned-cart' ); ?>"  /> |
| [3924](#L3924) | <?php |
| [3925](#L3925) | } else { |
| [3926](#L3926) | ?> |
| [3927](#L3927) | <input type="submit" name="Submit" class="button-primary" value="<?php esc\_attr\_e( 'Save Changes', 'woocommerce-abandoned-cart' ); ?>"  /> |
| [3928](#L3928) | <?php |
| [3929](#L3929) | } |
| [3930](#L3930) | ?> |
| [3931](#L3931) | </p> |
| [3932](#L3932) | </form> |
| [3933](#L3933) | </div> |
| [3934](#L3934) | <?php |
| [3935](#L3935) | } |
| [3936](#L3936) | } |
| [3937](#L3937) |  |
| [3938](#L3938) | /\*\* |
| [3939](#L3939) | \* It will add the footer text for the plugin. |
| [3940](#L3940) | \* |
| [3941](#L3941) | \* @hook admin\_footer\_text |
| [3942](#L3942) | \* @param string $footer\_text Text. |
| [3943](#L3943) | \* @return string $footer\_text |
| [3944](#L3944) | \* @since 1.0 |
| [3945](#L3945) | \*/ |
| [3946](#L3946) | public function wcal\_admin\_footer\_text( $footer\_text ) { |
| [3947](#L3947) |  |
| [3948](#L3948) | if ( isset( $\_GET['page'] ) && 'woocommerce\_ac\_page' === $\_GET['page'] ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [3949](#L3949) | $footer\_text = \_\_( 'If you love <strong>Abandoned Cart Lite for WooCommerce</strong>, then please leave us a <a href="https://wordpress.org/support/plugin/woocommerce-abandoned-cart/reviews/?rate=5#new-post" target="\_blank" class="ac-rating-link" data-rated="Thanks :)">★★★★★</a> rating. Thank you in advance. :)', 'woocommerce-abandoned-cart' ); |
| [3950](#L3950) | wc\_enqueue\_js( |
| [3951](#L3951) | " |
| [3952](#L3952) | jQuery( 'a.ac-rating-link' ).click( function() { |
| [3953](#L3953) | jQuery( this ).parent().text( jQuery( this ).data( 'rated' ) ); |
| [3954](#L3954) | }); |
| [3955](#L3955) | " |
| [3956](#L3956) | ); |
| [3957](#L3957) | } |
| [3958](#L3958) | return $footer\_text; |
| [3959](#L3959) | } |
| [3960](#L3960) |  |
| [3961](#L3961) | /\*\* |
| [3962](#L3962) | \* It will sort the record for the product reports tab. |
| [3963](#L3963) | \* |
| [3964](#L3964) | \* @param array  $unsort\_array Unsorted array. |
| [3965](#L3965) | \* @param string $order Order details. |
| [3966](#L3966) | \* @return array $array |
| [3967](#L3967) | \* @since 2.6 |
| [3968](#L3968) | \*/ |
| [3969](#L3969) | public function bubble\_sort\_function( $unsort\_array, $order ) { |
| [3970](#L3970) | $temp = array(); |
| [3971](#L3971) | foreach ( $unsort\_array as $key => $value ) { |
| [3972](#L3972) | $temp[ $key ] = $value; // concatenate something unique to make sure two equal weights don't overwrite each other. |
| [3973](#L3973) | } |
| [3974](#L3974) | asort( $temp, SORT\_NUMERIC ); // or ksort( $temp, SORT\_NATURAL ); see paragraph above to understand why. |
| [3975](#L3975) |  |
| [3976](#L3976) | if ( 'desc' === $order ) { |
| [3977](#L3977) | $array = array\_reverse( $temp, true ); |
| [3978](#L3978) | } elseif ( 'asc' === $order ) { |
| [3979](#L3979) | $array = $temp; |
| [3980](#L3980) | } |
| [3981](#L3981) | unset( $temp ); |
| [3982](#L3982) | return $array; |
| [3983](#L3983) | } |
| [3984](#L3984) |  |
| [3985](#L3985) | /\*\* |
| [3986](#L3986) | \* Ajax function used to add the details in the abandoned order |
| [3987](#L3987) | \* popup view. |
| [3988](#L3988) | \* |
| [3989](#L3989) | \* @since 5.6 |
| [3990](#L3990) | \*/ |
| [3991](#L3991) | public static function wcal\_abandoned\_cart\_info() { |
| [3992](#L3992) | if ( ! current\_user\_can( 'manage\_woocommerce' ) || ! isset( $\_POST['ajax\_nonce'] ) || ( isset( $\_POST['ajax\_nonce'] ) && ! wp\_verify\_nonce( sanitize\_key( $\_POST['ajax\_nonce'] ), 'wcal\_cart\_details\_nonce' ) ) ) { |
| [3993](#L3993) | wp\_send\_json( 'Security check failed' ); |
| [3994](#L3994) | } |
| [3995](#L3995) | Wcal\_Abandoned\_Cart\_Details::wcal\_get\_cart\_detail\_view( $\_POST ); // phpcs:ignore WordPress.Security.NonceVerification |
| [3996](#L3996) | die(); |
| [3997](#L3997) | } |
| [3998](#L3998) |  |
| [3999](#L3999) | /\*\* |
| [4000](#L4000) | \* Ajax function which will save the notice state as dismissed. |
| [4001](#L4001) | \* |
| [4002](#L4002) | \* @since 5.7 |
| [4003](#L4003) | \*/ |
| [4004](#L4004) | public static function wcal\_dismiss\_admin\_notice() { |
| [4005](#L4005) |  |
| [4006](#L4006) | if ( ! current\_user\_can( 'manage\_woocommerce' ) || ! isset( $\_POST['ajax\_nonce'] ) || ( isset( $\_POST['ajax\_nonce'] ) && ! wp\_verify\_nonce( sanitize\_key( $\_POST['ajax\_nonce'] ), 'wcal\_dismiss\_notice' ) ) ) { |
| [4007](#L4007) | wp\_send\_json( 'Security check failed' ); |
| [4008](#L4008) | } |
| [4009](#L4009) | $notice\_key = isset( $\_POST['notice'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['notice'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [4010](#L4010) | if ( '' !== $notice\_key ) { |
| [4011](#L4011) | update\_option( $notice\_key, true ); |
| [4012](#L4012) | } |
| [4013](#L4013) | $notice\_keys = isset( $\_POST['notices'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['notices'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [4014](#L4014) | if ( '' !== $notice\_keys ) { |
| [4015](#L4015) | update\_option( $notice\_keys, true ); |
| [4016](#L4016) | } |
| [4017](#L4017) | die(); |
| [4018](#L4018) | } |
| [4019](#L4019) | /\*\* |
| [4020](#L4020) | \* Ajax function which will save the notice state in database. |
| [4021](#L4021) | \* |
| [4022](#L4022) | \* @param str $new\_value - new value. |
| [4023](#L4023) | \* @param str $old\_value - old value. |
| [4024](#L4024) | \* @since 5.16.0 |
| [4025](#L4025) | \*/ |
| [4026](#L4026) | public static function wcal\_update\_admin\_notice\_value( $new\_value, $old\_value ) { |
| [4027](#L4027) | // Check test mode. |
| [4028](#L4028) | if ( $new\_value !== $old\_value && ! empty( $new\_value ) && 'on' === $new\_value ) { |
| [4029](#L4029) | update\_option( 'wcal\_auto\_login\_notice\_dismiss', false ); |
| [4030](#L4030) | } |
| [4031](#L4031) | return $new\_value; |
| [4032](#L4032) | } |
| [4033](#L4033) |  |
| [4034](#L4034) | /\*\* |
| [4035](#L4035) | \* It will update the template satus when we change the template active status from the email template list page. |
| [4036](#L4036) | \* |
| [4037](#L4037) | \* @hook wp\_ajax\_wcal\_toggle\_template\_status |
| [4038](#L4038) | \* @globals mixed $wpdb |
| [4039](#L4039) | \* @since 4.4 |
| [4040](#L4040) | \*/ |
| [4041](#L4041) | public static function wcal\_toggle\_template\_status() { |
| [4042](#L4042) |  |
| [4043](#L4043) | if ( ! current\_user\_can( 'manage\_woocommerce' ) || ! isset( $\_POST['ajax\_nonce'] ) || ( isset( $\_POST['ajax\_nonce'] ) && ! wp\_verify\_nonce( sanitize\_key( $\_POST['ajax\_nonce'] ), 'wcal\_update\_template\_status' ) ) ) { |
| [4044](#L4044) | wp\_send\_json( 'Security check failed' ); |
| [4045](#L4045) | } |
| [4046](#L4046) | global $wpdb; |
| [4047](#L4047) | $template\_id             = isset( $\_POST['wcal\_template\_id'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['wcal\_template\_id'] ) ) : 0; // phpcs:ignore WordPress.Security.NonceVerification |
| [4048](#L4048) | $current\_template\_status = isset( $\_POST['current\_state'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['current\_state'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [4049](#L4049) |  |
| [4050](#L4050) | if ( $template\_id > 0 ) { |
| [4051](#L4051) | if ( 'on' === $current\_template\_status ) { |
| [4052](#L4052) | $get\_selected\_template\_result = $wpdb->get\_results( // phpcs:ignore |
| [4053](#L4053) | $wpdb->prepare( |
| [4054](#L4054) | 'SELECT \* FROM `' . $wpdb->prefix . 'ac\_email\_templates\_lite` WHERE id = %d', |
| [4055](#L4055) | $template\_id |
| [4056](#L4056) | ) |
| [4057](#L4057) | ); |
| [4058](#L4058) | $email\_frequncy               = $get\_selected\_template\_result[0]->frequency; |
| [4059](#L4059) | $email\_day\_or\_hour            = $get\_selected\_template\_result[0]->day\_or\_hour; |
| [4060](#L4060) |  |
| [4061](#L4061) | $wcal\_updated = $wpdb->query( // phpcs:ignore |
| [4062](#L4062) | $wpdb->prepare( |
| [4063](#L4063) | 'UPDATE `' . $wpdb->prefix . 'ac\_email\_templates\_lite` SET is\_active = %d WHERE frequency = %s AND day\_or\_hour = %s', |
| [4064](#L4064) | 0, |
| [4065](#L4065) | $email\_frequncy, |
| [4066](#L4066) | $email\_day\_or\_hour |
| [4067](#L4067) | ) |
| [4068](#L4068) | ); |
| [4069](#L4069) |  |
| [4070](#L4070) | if ( 1 === $wcal\_updated ) { |
| [4071](#L4071) | $wcal\_updated\_get\_id = $wpdb->get\_results( // phpcs:ignore |
| [4072](#L4072) | $wpdb->prepare( |
| [4073](#L4073) | 'SELECT id FROM  `' . $wpdb->prefix . 'ac\_email\_templates\_lite` WHERE id != %d AND frequency = %s AND day\_or\_hour = %s', |
| [4074](#L4074) | $template\_id, |
| [4075](#L4075) | $email\_frequncy, |
| [4076](#L4076) | $email\_day\_or\_hour |
| [4077](#L4077) | ) |
| [4078](#L4078) | ); |
| [4079](#L4079) | $wcal\_all\_ids        = ''; |
| [4080](#L4080) | foreach ( $wcal\_updated\_get\_id as $wcal\_updated\_get\_id\_key => $wcal\_updated\_get\_id\_value ) { |
| [4081](#L4081) | // code... |
| [4082](#L4082) | if ( '' === $wcal\_all\_ids ) { |
| [4083](#L4083) | $wcal\_all\_ids = $wcal\_updated\_get\_id\_value->id; |
| [4084](#L4084) | } else { |
| [4085](#L4085) | $wcal\_all\_ids = $wcal\_all\_ids . ',' . $wcal\_updated\_get\_id\_value->id; |
| [4086](#L4086) | } |
| [4087](#L4087) | } |
| [4088](#L4088) | echo esc\_html( 'wcal-template-updated:' . $wcal\_all\_ids ); |
| [4089](#L4089) | } |
| [4090](#L4090) |  |
| [4091](#L4091) | $active = '1'; |
| [4092](#L4092) | update\_option( 'wcal\_template\_' . $template\_id . '\_time', current\_time( 'timestamp' ) ); // phpcs:ignore |
| [4093](#L4093) | } else { |
| [4094](#L4094) | $active = '0'; |
| [4095](#L4095) | } |
| [4096](#L4096) | $wpdb->query( // phpcs:ignore |
| [4097](#L4097) | $wpdb->prepare( |
| [4098](#L4098) | 'UPDATE `' . $wpdb->prefix . 'ac\_email\_templates\_lite` SET is\_active = %s WHERE id  = %d', |
| [4099](#L4099) | $active, |
| [4100](#L4100) | $template\_id |
| [4101](#L4101) | ) |
| [4102](#L4102) | ); |
| [4103](#L4103) | } |
| [4104](#L4104) | wp\_die(); |
| [4105](#L4105) | } |
| [4106](#L4106) |  |
| [4107](#L4107) | /\*\* |
| [4108](#L4108) | \* Set up from email address in emails sent by our plugin when WC template style is ON. |
| [4109](#L4109) | \* |
| [4110](#L4110) | \* @param str    $wp\_admin\_address - From email address set up in WP. |
| [4111](#L4111) | \* @param object $email - Email object. |
| [4112](#L4112) | \* @param str    $from\_email - Email Address passed in. |
| [4113](#L4113) | \* |
| [4114](#L4114) | \* @since 5.13.0 |
| [4115](#L4115) | \*/ |
| [4116](#L4116) | public static function wcal\_from\_address\_for\_emails( $wp\_admin\_address, $email ) { |
| [4117](#L4117) | $from\_address = '' == $email->title ? get\_option( 'wcal\_from\_email' ) : $wp\_admin\_address; // phpcs:ignore |
| [4118](#L4118) | return $from\_address; |
| [4119](#L4119) | } |
| [4120](#L4120) |  |
| [4121](#L4121) | /\*\* |
| [4122](#L4122) | \* Set up from name in emails sent by our plugin when WC template style is ON. |
| [4123](#L4123) | \* |
| [4124](#L4124) | \* @param str    $wp\_admin\_name - From name set up in WP. |
| [4125](#L4125) | \* @param object $email - Email object. |
| [4126](#L4126) | \* @param str    $from\_name\_default - Name passed in. |
| [4127](#L4127) | \* |
| [4128](#L4128) | \* @since 5.13.0 |
| [4129](#L4129) | \*/ |
| [4130](#L4130) | public static function wcal\_from\_name\_for\_emails( $wp\_admin\_name, $email ) { |
| [4131](#L4131) | $from\_name = '' == $email->title ? get\_option( 'wcal\_from\_name' ) : $wp\_admin\_name; // phpcs:ignore |
| [4132](#L4132) | return $from\_name; |
| [4133](#L4133) | } |
| [4134](#L4134) | /\*\* |
| [4135](#L4135) | \* It will replace the test email data with the static content. |
| [4136](#L4136) | \* |
| [4137](#L4137) | \* @since 1.0 |
| [4138](#L4138) | \*/ |
| [4139](#L4139) | public function wcal\_preview\_email\_sent() { |
| [4140](#L4140) |  |
| [4141](#L4141) | if ( ! current\_user\_can( 'manage\_woocommerce' ) || ! isset( $\_POST['ajax\_nonce'] ) || ( isset( $\_POST['ajax\_nonce'] ) && ! wp\_verify\_nonce( sanitize\_key( $\_POST['ajax\_nonce'] ), 'wcal\_send\_test\_email' ) ) ) { |
| [4142](#L4142) | wp\_send\_json\_error( 'Security check failed' ); |
| [4143](#L4143) | } |
| [4144](#L4144) | if ( isset( $\_POST['body\_email\_preview'] ) && '' !== $\_POST['body\_email\_preview'] ) { |
| [4145](#L4145) | $from\_email\_name       = get\_option( 'wcal\_from\_name' ); |
| [4146](#L4146) | $reply\_name\_preview    = get\_option( 'wcal\_from\_email' ); |
| [4147](#L4147) | $from\_email\_preview    = get\_option( 'wcal\_reply\_email' ); |
| [4148](#L4148) | $subject\_email\_preview = isset( $\_POST['subject\_email\_preview'] ) ? stripslashes( sanitize\_text\_field( wp\_unslash( $\_POST['subject\_email\_preview'] ) ) ) : ''; |
| [4149](#L4149) | $subject\_email\_preview = convert\_smilies( $subject\_email\_preview ); |
| [4150](#L4150) | $subject\_email\_preview = str\_ireplace( '{{customer.firstname}}', apply\_filters( 'wcal\_abandoned\_cart\_email\_content\_customer\_firstname', 'John', true, null ), $subject\_email\_preview ); |
| [4151](#L4151) | $body\_email\_preview    = isset( $\_POST['body\_email\_preview'] ) ? convert\_smilies( wp\_unslash( $\_POST['body\_email\_preview'] ) ) : ''; // phpcs:ignore |
| [4152](#L4152) | $is\_wc\_template        = isset( $\_POST['is\_wc\_template'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['is\_wc\_template'] ) ) : ''; |
| [4153](#L4153) | $wc\_template\_header    = isset( $\_POST['wc\_template\_header'] ) ? stripslashes( sanitize\_text\_field( wp\_unslash( $\_POST['wc\_template\_header'] ) ) ) : ''; |
| [4154](#L4154) | $discount\_expiry       = isset( $\_POST['discount\_expiry'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['discount\_expiry'] ) ) : ''; |
| [4155](#L4155) | $discount\_type         = isset( $\_POST['discount\_type'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['discount\_type'] ) ) : ''; |
| [4156](#L4156) | $discount\_shipping     = isset( $\_POST['discount\_shipping'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['discount\_shipping'] ) ) : ''; |
| [4157](#L4157) | $individual\_use        = isset( $\_POST['individual\_use'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['individual\_use'] ) ) : ''; |
| [4158](#L4158) | $discount\_amount       = isset( $\_POST['discount\_amount'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['discount\_amount'] ) ) : ''; |
| [4159](#L4159) | $generate\_unique\_code  = isset( $\_POST['generate\_unique\_code'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['generate\_unique\_code'] ) ) : ''; |
| [4160](#L4160) | $coupon\_code           = isset( $\_POST['coupon\_code'][0] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['coupon\_code'][0] ) ) : ''; |
| [4161](#L4161) | $discount\_details      = array(); |
| [4162](#L4162) | $coupon\_code\_to\_apply  = ''; |
| [4163](#L4163) | if ( stripos( $body\_email\_preview, '{{coupon.code}}' ) ) { |
| [4164](#L4164) | $discount\_details['discount\_expiry']      = $discount\_expiry; |
| [4165](#L4165) | $discount\_details['discount\_type']        = $discount\_type; |
| [4166](#L4166) | $discount\_details['discount\_shipping']    = $discount\_shipping; |
| [4167](#L4167) | $discount\_details['individual\_use']       = $individual\_use; |
| [4168](#L4168) | $discount\_details['discount\_amount']      = $discount\_amount; |
| [4169](#L4169) | $discount\_details['generate\_unique\_code'] = $generate\_unique\_code; |
| [4170](#L4170) | $default\_template                         = ''; |
| [4171](#L4171) |  |
| [4172](#L4172) | $coupon\_id   = isset( $coupon\_code ) ? $coupon\_code : ''; |
| [4173](#L4173) | $coupon\_code = ''; |
| [4174](#L4174) | if ( '' !== $coupon\_id ) { |
| [4175](#L4175) | $coupon\_to\_apply = get\_post( $coupon\_id, ARRAY\_A ); |
| [4176](#L4176) | $coupon\_code     = $coupon\_to\_apply['post\_title']; |
| [4177](#L4177) | } |
| [4178](#L4178) |  |
| [4179](#L4179) | $coupon\_code\_to\_apply = wcal\_common::wcal\_get\_coupon\_email( $discount\_details, $coupon\_code, $default\_template ); |
| [4180](#L4180) | $body\_email\_preview   = str\_ireplace( '{{coupon.code}}', $coupon\_code\_to\_apply, $body\_email\_preview ); |
| [4181](#L4181) | } |
| [4182](#L4182) |  |
| [4183](#L4183) | $body\_email\_preview = str\_ireplace( '{{customer.firstname}}', apply\_filters( 'wcal\_abandoned\_cart\_email\_content\_customer\_firstname', 'John', true, null ), $body\_email\_preview ); |
| [4184](#L4184) | $body\_email\_preview = str\_ireplace( '{{customer.lastname}}', apply\_filters( 'wcal\_abandoned\_cart\_email\_content\_customer\_lastname', 'Doe', true, null ), $body\_email\_preview ); |
| [4185](#L4185) | $body\_email\_preview = str\_ireplace( '{{customer.fullname}}', apply\_filters( 'wcal\_abandoned\_cart\_email\_content\_customer\_fullname', 'John Doe', true, null ), $body\_email\_preview ); |
| [4186](#L4186) | $current\_time\_stamp = current\_time( 'timestamp' ); // phpcs:ignore |
| [4187](#L4187) | $date\_format        = date\_i18n( get\_option( 'date\_format' ), $current\_time\_stamp ); |
| [4188](#L4188) | $time\_format        = date\_i18n( get\_option( 'time\_format' ), $current\_time\_stamp ); |
| [4189](#L4189) | $test\_date          = $date\_format . ' ' . $time\_format; |
| [4190](#L4190) | $body\_email\_preview = str\_ireplace( '{{cart.abandoned\_date}}', apply\_filters( 'wcal\_abandoned\_cart\_email\_content\_cart\_abandoned\_date', $test\_date, true, null ), $body\_email\_preview ); |
| [4191](#L4191) | $cart\_url           = wc\_get\_page\_permalink( 'cart' ); |
| [4192](#L4192) | $body\_email\_preview = str\_ireplace( '{{cart.link}}', apply\_filters( 'wcal\_abandoned\_cart\_email\_content\_cart\_link', $cart\_url, true, null ), $body\_email\_preview ); |
| [4193](#L4193) | $body\_email\_preview = str\_ireplace( '{{cart.unsubscribe}}', apply\_filters( 'wcal\_abandoned\_cart\_email\_content\_cart\_unsubscribe', '#', true, null ), $body\_email\_preview ); |
| [4194](#L4194) | $wcal\_price         = wc\_price( '100' ); |
| [4195](#L4195) | $wcal\_total\_price   = wc\_price( '200' ); |
| [4196](#L4196) | if ( class\_exists( 'WP\_Better\_Emails' ) ) { |
| [4197](#L4197) | $headers  = 'From: ' . $from\_email\_name . ' <' . $from\_email\_preview . '>' . "\r\n"; |
| [4198](#L4198) | $headers .= 'Content-Type: text/html' . "\r\n"; |
| [4199](#L4199) | $headers .= 'Reply-To:  ' . $reply\_name\_preview . ' ' . "\r\n"; |
| [4200](#L4200) | $var      = '<table width = 100%> |
| [4201](#L4201) | <tr> <td colspan="5"> <h3 style="text-align:center">' . \_\_( 'Your Shopping Cart', 'woocommerce-abandoned-cart' ) . '</h3> </td></tr> |
| [4202](#L4202) | <tr align="center"> |
| [4203](#L4203) | <th>' . \_\_( 'Item', 'woocommerce-abandoned-cart' ) . '</th> |
| [4204](#L4204) | <th>' . \_\_( 'Name', 'woocommerce-abandoned-cart' ) . '</th> |
| [4205](#L4205) | <th>' . \_\_( 'Quantity', 'woocommerce-abandoned-cart' ) . '</th> |
| [4206](#L4206) | <th>' . \_\_( 'Price', 'woocommerce-abandoned-cart' ) . '</th> |
| [4207](#L4207) | <th>' . \_\_( 'Line Subtotal', 'woocommerce-abandoned-cart' ) . '</th> |
| [4208](#L4208) | </tr> |
| [4209](#L4209) | <tr align="center"> |
| [4210](#L4210) | <td><img class="demo\_img" width="42" height="42" src="' . plugins\_url( '/assets/images/shoes.jpg', \_\_FILE\_\_ ) . '"/></td> |
| [4211](#L4211) | <td>' . \_\_( "Men's Formal Shoes", 'woocommerce-abandoned-cart' ) . '</td> |
| [4212](#L4212) | <td>1</td> |
| [4213](#L4213) | <td>' . $wcal\_price . '</td> |
| [4214](#L4214) | <td>' . $wcal\_price . '</td> |
| [4215](#L4215) | </tr> |
| [4216](#L4216) | <tr align="center"> |
| [4217](#L4217) | <td><img class="demo\_img" width="42" height="42" src="' . plugins\_url( '/assets/images/handbag.jpg', \_\_FILE\_\_ ) . '"/></td> |
| [4218](#L4218) | <td>' . \_\_( "Woman's Hand Bags", 'woocommerce-abandoned-cart' ) . '</td> |
| [4219](#L4219) | <td>1</td> |
| [4220](#L4220) | <td>' . $wcal\_price . '</td> |
| [4221](#L4221) | <td>' . $wcal\_price . '</td> |
| [4222](#L4222) | </tr> |
| [4223](#L4223) | <tr align="center"> |
| [4224](#L4224) | <td></td> |
| [4225](#L4225) | <td></td> |
| [4226](#L4226) | <td></td> |
| [4227](#L4227) | <td>' . \_\_( 'Cart Total:', 'woocommerce-abandoned-cart' ) . '</td> |
| [4228](#L4228) | <td>' . $wcal\_total\_price . '</td> |
| [4229](#L4229) | </tr> |
| [4230](#L4230) | </table>'; |
| [4231](#L4231) | } else { |
| [4232](#L4232) | $headers  = 'From: ' . $from\_email\_name . ' <' . $from\_email\_preview . '>' . "\r\n"; |
| [4233](#L4233) | $headers .= 'Content-Type: text/html' . "\r\n"; |
| [4234](#L4234) | $headers .= 'Reply-To:  ' . $reply\_name\_preview . ' ' . "\r\n"; |
| [4235](#L4235) | $var      = '<h3 style="text-align:center">' . \_\_( 'Your Shopping Cart', 'woocommerce-abandoned-cart' ) . '</h3> |
| [4236](#L4236) | <table border="0" cellpadding="10" cellspacing="0" class="templateDataTable"> |
| [4237](#L4237) | <tr align="center"> |
| [4238](#L4238) | <th>' . \_\_( 'Item', 'woocommerce-abandoned-cart' ) . '</th> |
| [4239](#L4239) | <th>' . \_\_( 'Name', 'woocommerce-abandoned-cart' ) . '</th> |
| [4240](#L4240) | <th>' . \_\_( 'Quantity', 'woocommerce-abandoned-cart' ) . '</th> |
| [4241](#L4241) | <th>' . \_\_( 'Price', 'woocommerce-abandoned-cart' ) . '</th> |
| [4242](#L4242) | <th>' . \_\_( 'Line Subtotal', 'woocommerce-abandoned-cart' ) . '</th> |
| [4243](#L4243) | </tr> |
| [4244](#L4244) | <tr align="center"> |
| [4245](#L4245) | <td><img class="demo\_img" width="42" height="42" src="' . plugins\_url( '/assets/images/shoes.jpg', \_\_FILE\_\_ ) . '"/></td> |
| [4246](#L4246) | <td>' . \_\_( "Men's Formal Shoes", 'woocommerce-abandoned-cart' ) . '</td> |
| [4247](#L4247) | <td>1</td> |
| [4248](#L4248) | <td>' . $wcal\_price . '</td> |
| [4249](#L4249) | <td>' . $wcal\_price . '</td> |
| [4250](#L4250) | </tr> |
| [4251](#L4251) | <tr align="center"> |
| [4252](#L4252) | <td><img class="demo\_img" width="42" height="42" src="' . plugins\_url( '/assets/images/handbag.jpg', \_\_FILE\_\_ ) . '"/></td> |
| [4253](#L4253) | <td>' . \_\_( "Woman's Hand Bags", 'woocommerce-abandoned-cart' ) . '</td> |
| [4254](#L4254) | <td>1</td> |
| [4255](#L4255) | <td>' . $wcal\_price . '</td> |
| [4256](#L4256) | <td>' . $wcal\_price . '</td> |
| [4257](#L4257) | </tr> |
| [4258](#L4258) | <tr align="center"> |
| [4259](#L4259) | <td></td> |
| [4260](#L4260) | <td></td> |
| [4261](#L4261) | <td></td> |
| [4262](#L4262) | <td>' . \_\_( 'Cart Total:', 'woocommerce-abandoned-cart' ) . '</td> |
| [4263](#L4263) | <td>' . $wcal\_total\_price . '</td> |
| [4264](#L4264) | </tr> |
| [4265](#L4265) | </table>'; |
| [4266](#L4266) | } |
| [4267](#L4267) | $body\_email\_preview = str\_ireplace( '{{products.cart}}', apply\_filters( 'wcal\_abandoned\_cart\_email\_content\_products.cart', $var, true, null ), $body\_email\_preview ); |
| [4268](#L4268) | if ( isset( $\_POST['send\_email\_id'] ) ) { |
| [4269](#L4269) | $to\_email\_preview = sanitize\_text\_field( wp\_unslash( $\_POST['send\_email\_id'] ) ); |
| [4270](#L4270) | } else { |
| [4271](#L4271) | $to\_email\_preview = ''; |
| [4272](#L4272) | } |
| [4273](#L4273) | $user\_email\_from          = get\_option( 'admin\_email' ); |
| [4274](#L4274) | $body\_email\_final\_preview = stripslashes( $body\_email\_preview ); |
| [4275](#L4275) |  |
| [4276](#L4276) | if ( isset( $is\_wc\_template ) && 'true' === $is\_wc\_template ) { |
| [4277](#L4277) | ob\_start(); |
| [4278](#L4278) | // Get email heading. |
| [4279](#L4279) | wc\_get\_template( 'emails/email-header.php', array( 'email\_heading' => $wc\_template\_header ) ); |
| [4280](#L4280) | $email\_body\_template\_header = ob\_get\_clean(); |
| [4281](#L4281) |  |
| [4282](#L4282) | ob\_start(); |
| [4283](#L4283) | wc\_get\_template( 'emails/email-footer.php' ); |
| [4284](#L4284) | $email\_body\_template\_footer = ob\_get\_clean(); |
| [4285](#L4285) |  |
| [4286](#L4286) | $site\_title                 = get\_bloginfo( 'name' ); |
| [4287](#L4287) | $email\_body\_template\_footer = str\_ireplace( '{site\_title}', $site\_title, $email\_body\_template\_footer ); |
| [4288](#L4288) |  |
| [4289](#L4289) | $final\_email\_body = $email\_body\_template\_header . $body\_email\_final\_preview . $email\_body\_template\_footer; |
| [4290](#L4290) |  |
| [4291](#L4291) | wc\_mail( $to\_email\_preview, $subject\_email\_preview, $final\_email\_body, $headers ); |
| [4292](#L4292) | } else { |
| [4293](#L4293) | wp\_mail( $to\_email\_preview, $subject\_email\_preview, stripslashes( $body\_email\_preview ), $headers ); |
| [4294](#L4294) | } |
| [4295](#L4295) | echo 'email sent'; |
| [4296](#L4296) | die(); |
| [4297](#L4297) | } else { |
| [4298](#L4298) | echo 'not sent'; |
| [4299](#L4299) | die(); |
| [4300](#L4300) | } |
| [4301](#L4301) | } |
| [4302](#L4302) |  |
| [4303](#L4303) | /\*\* |
| [4304](#L4304) | \* Return the coupon settings in the template. |
| [4305](#L4305) | \* |
| [4306](#L4306) | \* @return $coupon\_code\_options - Coupon code settings. |
| [4307](#L4307) | \*/ |
| [4308](#L4308) | public static function wcal\_coupon\_options() { |
| [4309](#L4309) |  |
| [4310](#L4310) | $coupon\_expiry = ''; |
| [4311](#L4311) | if ( isset( $\_POST['wcal\_coupon\_expiry'] ) && '' !== $\_POST['wcal\_coupon\_expiry'] ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [4312](#L4312) | $coupon\_expiry = sanitize\_text\_field( wp\_unslash( $\_POST['wcal\_coupon\_expiry'] ) ); // phpcs:ignore WordPress.Security.NonceVerification |
| [4313](#L4313) | } |
| [4314](#L4314) |  |
| [4315](#L4315) | if ( isset( $\_POST['expiry\_day\_or\_hour'] ) && '' !== $\_POST['expiry\_day\_or\_hour'] ) { // phpcs:ignore WordPress.Security.NonceVerification |
| [4316](#L4316) | $expiry\_day\_or\_hour = sanitize\_text\_field( wp\_unslash( $\_POST['expiry\_day\_or\_hour'] ) ); // phpcs:ignore WordPress.Security.NonceVerification |
| [4317](#L4317) | } |
| [4318](#L4318) | $coupon\_expiry = $coupon\_expiry . '-' . $expiry\_day\_or\_hour; |
| [4319](#L4319) |  |
| [4320](#L4320) | $discount\_shipping = isset( $\_POST['wcal\_allow\_free\_shipping'] ) && '' !== $\_POST['wcal\_allow\_free\_shipping'] ? 'yes' : 'off'; // phpcs:ignore WordPress.Security.NonceVerification |
| [4321](#L4321) | $individual\_use    = empty( $\_POST['individual\_use'] ) ? '0' : '1'; // phpcs:ignore WordPress.Security.NonceVerification |
| [4322](#L4322) | $discount\_type     = isset( $\_POST['wcal\_discount\_type'] ) && '' !== $\_POST['wcal\_discount\_type'] ? sanitize\_text\_field( wp\_unslash( $\_POST['wcal\_discount\_type'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [4323](#L4323) | $coupon\_amount     = isset( $\_POST['wcal\_coupon\_amount'] ) && '' !== $\_POST['wcal\_coupon\_amount'] ? sanitize\_text\_field( wp\_unslash( $\_POST['wcal\_coupon\_amount'] ) ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [4324](#L4324) |  |
| [4325](#L4325) | $coupon\_code\_options = array( |
| [4326](#L4326) | 'discount\_type'     => $discount\_type, |
| [4327](#L4327) | 'coupon\_amount'     => $coupon\_amount, |
| [4328](#L4328) | 'coupon\_expiry'     => $coupon\_expiry, |
| [4329](#L4329) | 'discount\_shipping' => $discount\_shipping, |
| [4330](#L4330) | 'individual\_use'    => $individual\_use, |
| [4331](#L4331) | ); |
| [4332](#L4332) |  |
| [4333](#L4333) | return $coupon\_code\_options; |
| [4334](#L4334) | } |
| [4335](#L4335) | /\*\* |
| [4336](#L4336) | \* It will search for the coupon code. It is called on the add / edit template page. |
| [4337](#L4337) | \* |
| [4338](#L4338) | \* @hook wp\_ajax\_wcal\_json\_find\_coupons |
| [4339](#L4339) | \* @param string $x - coupon code string. |
| [4340](#L4340) | \* @param array  $post\_types Post type which we want to search. |
| [4341](#L4341) | \* @since 5.11.0. |
| [4342](#L4342) | \*/ |
| [4343](#L4343) | public function wcal\_json\_find\_coupons( $x = '', $post\_types = array( 'shop\_coupon' ) ) { |
| [4344](#L4344) | check\_ajax\_referer( 'search-products', 'security' ); |
| [4345](#L4345) | $term = (string) urldecode( stripslashes( wp\_strip\_all\_tags( wp\_unslash( $\_GET['term'] ) ) ) ); //phpcs:ignore |
| [4346](#L4346) | if ( empty( $term ) ) { |
| [4347](#L4347) | die(); |
| [4348](#L4348) | } |
| [4349](#L4349) | if ( is\_numeric( $term ) ) { |
| [4350](#L4350) | $args  = array( |
| [4351](#L4351) | 'post\_type'      => $post\_types, |
| [4352](#L4352) | 'post\_status'    => 'publish', |
| [4353](#L4353) | 'posts\_per\_page' => -1, |
| [4354](#L4354) | 'post\_\_in'       => array( 0, $term ), |
| [4355](#L4355) | 'fields'         => 'ids', |
| [4356](#L4356) | ); |
| [4357](#L4357) | $args2 = array( |
| [4358](#L4358) | 'post\_type'      => $post\_types, |
| [4359](#L4359) | 'post\_status'    => 'publish', |
| [4360](#L4360) | 'posts\_per\_page' => -1, |
| [4361](#L4361) | 'post\_parent'    => $term, |
| [4362](#L4362) | 'fields'         => 'ids', |
| [4363](#L4363) | ); |
| [4364](#L4364) | $args3 = array( |
| [4365](#L4365) | 'post\_type'      => $post\_types, |
| [4366](#L4366) | 'post\_status'    => 'publish', |
| [4367](#L4367) | 'posts\_per\_page' => -1, |
| [4368](#L4368) | 'meta\_query'     => array( // phpcs:ignore |
| [4369](#L4369) | array( |
| [4370](#L4370) | 'key'     => '\_sku', |
| [4371](#L4371) | 'value'   => $term, |
| [4372](#L4372) | 'compare' => 'LIKE', |
| [4373](#L4373) | ), |
| [4374](#L4374) | ), |
| [4375](#L4375) | 'fields'         => 'ids', |
| [4376](#L4376) | ); |
| [4377](#L4377) | $posts = array\_unique( array\_merge( get\_posts( $args ), get\_posts( $args2 ), get\_posts( $args3 ) ) ); |
| [4378](#L4378) | } else { |
| [4379](#L4379) | $args  = array( |
| [4380](#L4380) | 'post\_type'      => $post\_types, |
| [4381](#L4381) | 'post\_status'    => 'publish', |
| [4382](#L4382) | 'posts\_per\_page' => -1, |
| [4383](#L4383) | 's'              => $term, |
| [4384](#L4384) | 'fields'         => 'ids', |
| [4385](#L4385) | ); |
| [4386](#L4386) | $args2 = array( |
| [4387](#L4387) | 'post\_type'      => $post\_types, |
| [4388](#L4388) | 'post\_status'    => 'publish', |
| [4389](#L4389) | 'posts\_per\_page' => -1, |
| [4390](#L4390) | 'meta\_query'     => array( // phpcs:ignore |
| [4391](#L4391) | array( |
| [4392](#L4392) | 'key'     => '\_sku', |
| [4393](#L4393) | 'value'   => $term, |
| [4394](#L4394) | 'compare' => 'LIKE', |
| [4395](#L4395) | ), |
| [4396](#L4396) | ), |
| [4397](#L4397) | 'fields'         => 'ids', |
| [4398](#L4398) | ); |
| [4399](#L4399) | $posts = array\_unique( array\_merge( get\_posts( $args ), get\_posts( $args2 ) ) ); |
| [4400](#L4400) | } |
| [4401](#L4401) | $found\_products = array(); |
| [4402](#L4402) | if ( $posts ) { |
| [4403](#L4403) | foreach ( $posts as $post ) { |
| [4404](#L4404) | $sku              = get\_post\_meta( $post, '\_sku', true ); |
| [4405](#L4405) | $wcal\_product\_sku = apply\_filters( 'wcal\_product\_sku', $sku ); |
| [4406](#L4406) | if ( false !== $wcal\_product\_sku && '' !== $wcal\_product\_sku ) { |
| [4407](#L4407) | if ( isset( $sku ) && $sku ) { |
| [4408](#L4408) | $sku = ' ( SKU: ' . $sku . ' )'; |
| [4409](#L4409) | } |
| [4410](#L4410) | $found\_products[ $post ] = get\_the\_title( $post ) . ' &ndash; #' . $post . $sku; |
| [4411](#L4411) | } else { |
| [4412](#L4412) | $found\_products[ $post ] = get\_the\_title( $post ) . ' &ndash; #' . $post; |
| [4413](#L4413) | } |
| [4414](#L4414) | } |
| [4415](#L4415) | } |
| [4416](#L4416) | echo wp\_json\_encode( $found\_products ); |
| [4417](#L4417) | die(); |
| [4418](#L4418) | } |
| [4419](#L4419) |  |
| [4420](#L4420) | /\*\* |
| [4421](#L4421) | \* Callback for Coupon settings section. |
| [4422](#L4422) | \*/ |
| [4423](#L4423) | public static function ac\_lite\_coupon\_callback() {} |
| [4424](#L4424) |  |
| [4425](#L4425) | /\*\* |
| [4426](#L4426) | \* Option for deleting the plugin data upon uninstall. |
| [4427](#L4427) | \* |
| [4428](#L4428) | \* @param array $args Argument for adding field details. |
| [4429](#L4429) | \* @since 8.3 |
| [4430](#L4430) | \*/ |
| [4431](#L4431) | public static function wcal\_deleting\_coupon\_data( $args ) { |
| [4432](#L4432) | $wcal\_delete\_coupon\_data = get\_option( 'wcal\_delete\_coupon\_data', '' ); |
| [4433](#L4433) | if ( isset( $wcal\_delete\_coupon\_data ) && '' === $wcal\_delete\_coupon\_data ) { |
| [4434](#L4434) | $wcal\_delete\_coupon\_data = 'off'; |
| [4435](#L4435) | wp\_clear\_scheduled\_hook( 'woocommerce\_ac\_delete\_coupon\_action' ); |
| [4436](#L4436) | } else { |
| [4437](#L4437) | if ( ! wp\_next\_scheduled( 'woocommerce\_ac\_delete\_coupon\_action' ) ) { |
| [4438](#L4438) | wp\_schedule\_event( time(), 'wcal\_15\_days', 'woocommerce\_ac\_delete\_coupon\_action' ); |
| [4439](#L4439) | } |
| [4440](#L4440) | } |
| [4441](#L4441) |  |
| [4442](#L4442) | ?> |
| [4443](#L4443) | <input type="checkbox" id="wcal\_delete\_coupon\_data" name="wcal\_delete\_coupon\_data" value="on" <?php echo checked( 'on', $wcal\_delete\_coupon\_data, false ); ?> /> |
| [4444](#L4444) | <label for="wcal\_delete\_coupon\_data"> <?php echo esc\_attr( $args[0] ); ?></label> |
| [4445](#L4445) | <a > |
| [4446](#L4446) | <?php |
| [4447](#L4447) | } |
| [4448](#L4448) | /\*\* |
| [4449](#L4449) | \* It will delete the expired and used coupon codes. |
| [4450](#L4450) | \* |
| [4451](#L4451) | \* @hook wp\_ajax\_wcal\_change\_manual\_email\_data |
| [4452](#L4452) | \* @since: 5.11.0 |
| [4453](#L4453) | \*/ |
| [4454](#L4454) | public static function wcal\_delete\_expired\_used\_coupon\_code() { |
| [4455](#L4455) |  |
| [4456](#L4456) | global $wpdb; |
| [4457](#L4457) | if ( ! current\_user\_can( 'manage\_woocommerce' ) || ! isset( $\_POST['ajax\_nonce'] ) || ( isset( $\_POST['ajax\_nonce'] ) && ! wp\_verify\_nonce( sanitize\_key( $\_POST['ajax\_nonce'] ), 'delete\_expired\_used\_coupon\_code' ) ) ) { |
| [4458](#L4458) | wp\_send\_json\_error( 'Security check failed' ); |
| [4459](#L4459) | } |
| [4460](#L4460) |  |
| [4461](#L4461) | $expired\_coupons = self::wcal\_fetch\_expired\_coupons(); |
| [4462](#L4462) | $used\_coupons    = self::wcal\_fetch\_used\_coupons(); |
| [4463](#L4463) | $coupons         = array\_unique( array\_merge( $expired\_coupons, $used\_coupons ) ); |
| [4464](#L4464) | $coupon\_count    = count( $coupons ); |
| [4465](#L4465) |  |
| [4466](#L4466) | if ( $coupon\_count ) { |
| [4467](#L4467) | $coupons\_ids = implode( ',', $coupons ); |
| [4468](#L4468) | $wpdb->query( "DELETE FROM {$wpdb->postmeta} WHERE post\_id IN(" . $coupons\_ids . ')' );//phpcs:ignore |
| [4469](#L4469) | $wpdb->query( "DELETE FROM {$wpdb->posts} WHERE ID IN(" . $coupons\_ids . ')' );//phpcs:ignore |
| [4470](#L4470) | } |
| [4471](#L4471) |  |
| [4472](#L4472) | // translators: %1$s: Coupons Deleted, %2$s: Deleted coupons count'. |
| [4473](#L4473) | wp\_send\_json\_success( sprintf( \_\_( '%1$s: %2$d', 'woo-cart-abandonment-recovery' ), 'Coupons Deleted', $coupon\_count ) ); |
| [4474](#L4474) | } |
| [4475](#L4475) |  |
| [4476](#L4476) | /\*\* |
| [4477](#L4477) | \* Coupon deletion manual button. |
| [4478](#L4478) | \* |
| [4479](#L4479) | \* @param array $args - Arguments for the setting. |
| [4480](#L4480) | \*/ |
| [4481](#L4481) | public static function wcal\_deleting\_coupon\_data\_manually( $args ) { |
| [4482](#L4482) | ?> |
| [4483](#L4483) | <input type="button" class="button-secondary" id="wcal\_delete\_coupons" value="<?php esc\_html\_e( 'Delete', 'woocommerce-ac' ); ?>" > |
| [4484](#L4484) | <label> <?php echo esc\_attr( $args[0] ); ?></label> |
| [4485](#L4485) | <br> |
| [4486](#L4486) | <span class="wcal-spinner" style="display:none;"> |
| [4487](#L4487) | <img class="ajax\_img" src="<?php echo esc\_attr( WCAL\_PLUGIN\_URL . '/assets/images/ajax-loader.gif' ); ?>" /> |
| [4488](#L4488) | </span> |
| [4489](#L4489) | <span class="wcal-coupon-response-msg"></span> |
| [4490](#L4490) | <?php |
| [4491](#L4491) | } |
| [4492](#L4492) | /\*\* |
| [4493](#L4493) | \* It will fetch all expired coupons |
| [4494](#L4494) | \* |
| [4495](#L4495) | \* @hook wp\_ajax\_wcal\_change\_manual\_email\_data. |
| [4496](#L4496) | \* @since: 5.11 |
| [4497](#L4497) | \*/ |
| [4498](#L4498) | public static function wcal\_fetch\_expired\_coupons() { |
| [4499](#L4499) | $coupon\_ids = array(); |
| [4500](#L4500) |  |
| [4501](#L4501) | $args = array( |
| [4502](#L4502) | 'posts\_per\_page' => -1, |
| [4503](#L4503) | 'post\_type'      => 'shop\_coupon', |
| [4504](#L4504) | 'post\_status'    => 'publish', |
| [4505](#L4505) | 'meta\_query'     => array( //phpcs:ignore |
| [4506](#L4506) | 'relation' => 'AND', |
| [4507](#L4507) | array( |
| [4508](#L4508) | 'key'     => 'date\_expires', |
| [4509](#L4509) | 'value'   => strtotime( 'today' ), |
| [4510](#L4510) | 'compare' => '<=', |
| [4511](#L4511) | ), |
| [4512](#L4512) | array( |
| [4513](#L4513) | 'key'     => 'date\_expires', |
| [4514](#L4514) | 'value'   => '', |
| [4515](#L4515) | 'compare' => '!=', |
| [4516](#L4516) | ), |
| [4517](#L4517) | array( |
| [4518](#L4518) | 'key'     => 'wcal\_created\_by', |
| [4519](#L4519) | 'value'   => 'wcal', |
| [4520](#L4520) | 'compare' => '=', |
| [4521](#L4521) | ), |
| [4522](#L4522) | ), |
| [4523](#L4523) | ); |
| [4524](#L4524) |  |
| [4525](#L4525) | $args    = array( |
| [4526](#L4526) | 'posts\_per\_page' => -1, |
| [4527](#L4527) | 'post\_type'      => 'shop\_coupon', |
| [4528](#L4528) | 'post\_status'    => 'publish', |
| [4529](#L4529) | 'meta\_query'     => array( // phpcs:ignore |
| [4530](#L4530) | 'relation' => 'AND', |
| [4531](#L4531) | array( |
| [4532](#L4532) | 'key'     => 'date\_expires', |
| [4533](#L4533) | 'value'   => strtotime( 'today' ), |
| [4534](#L4534) | 'compare' => '<=', |
| [4535](#L4535) | ), |
| [4536](#L4536) | array( |
| [4537](#L4537) | 'key'     => 'date\_expires', |
| [4538](#L4538) | 'value'   => '', |
| [4539](#L4539) | 'compare' => '!=', |
| [4540](#L4540) | ), |
| [4541](#L4541) | array( |
| [4542](#L4542) | 'key'     => 'wcal\_created\_by', |
| [4543](#L4543) | 'value'   => 'wcal', |
| [4544](#L4544) | 'compare' => '=', |
| [4545](#L4545) | ), |
| [4546](#L4546) | ), |
| [4547](#L4547) | ); |
| [4548](#L4548) | $coupons = get\_posts( $args ); |
| [4549](#L4549) | if ( ! empty( $coupons ) ) { |
| [4550](#L4550) | $current\_time = current\_time( 'timestamp' ); // phpcs:ignore |
| [4551](#L4551) |  |
| [4552](#L4552) | foreach ( $coupons as $coupon ) { |
| [4553](#L4553) | array\_push( $coupon\_ids, $coupon->ID ); |
| [4554](#L4554) | } |
| [4555](#L4555) | } |
| [4556](#L4556) |  |
| [4557](#L4557) | return $coupon\_ids; |
| [4558](#L4558) | } |
| [4559](#L4559) |  |
| [4560](#L4560) | /\*\* |
| [4561](#L4561) | \* It will fetch all used coupons. |
| [4562](#L4562) | \* |
| [4563](#L4563) | \* @hook wp\_ajax\_wcal\_change\_manual\_email\_data |
| [4564](#L4564) | \* @since: 4.2 |
| [4565](#L4565) | \*/ |
| [4566](#L4566) | public static function wcal\_fetch\_used\_coupons() { |
| [4567](#L4567) |  |
| [4568](#L4568) | $coupon\_ids = array(); |
| [4569](#L4569) | $args       = array( |
| [4570](#L4570) | 'posts\_per\_page' => -1, |
| [4571](#L4571) | 'post\_type'      => 'shop\_coupon', |
| [4572](#L4572) | 'post\_status'    => 'publish', |
| [4573](#L4573) | 'meta\_query'     => array( // phpcs:ignore |
| [4574](#L4574) | 'relation' => 'AND', |
| [4575](#L4575) | array( |
| [4576](#L4576) | 'key'     => 'usage\_count', |
| [4577](#L4577) | 'value'   => 0, |
| [4578](#L4578) | 'compare' => '>', |
| [4579](#L4579) | ), |
| [4580](#L4580) | array( |
| [4581](#L4581) | 'key'     => 'wcal\_created\_by', |
| [4582](#L4582) | 'value'   => 'wcal', |
| [4583](#L4583) | 'compare' => '=', |
| [4584](#L4584) | ), |
| [4585](#L4585) | ), |
| [4586](#L4586) | ); |
| [4587](#L4587) |  |
| [4588](#L4588) | $coupons = get\_posts( $args ); |
| [4589](#L4589) | if ( ! empty( $coupons ) ) { |
| [4590](#L4590) | foreach ( $coupons as $coupon ) { |
| [4591](#L4591) | array\_push( $coupon\_ids, $coupon->ID ); |
| [4592](#L4592) | } |
| [4593](#L4593) | } |
| [4594](#L4594) | return $coupon\_ids; |
| [4595](#L4595) | } |
| [4596](#L4596) | /\*\* |
| [4597](#L4597) | \* It will create the cron job interval. |
| [4598](#L4598) | \* Default value will be 15 minutes. |
| [4599](#L4599) | \* If customer has changed the cron job interval time from the settings then it will be considered. |
| [4600](#L4600) | \* |
| [4601](#L4601) | \* @param array $schedules Array of all schedule events. |
| [4602](#L4602) | \* @return array $schedule Array of new added schedule event. |
| [4603](#L4603) | \* @since 5.0 |
| [4604](#L4604) | \*/ |
| [4605](#L4605) | public static function wcal\_add\_cron\_schedule( $schedules ) { |
| [4606](#L4606) | $duration = get\_option( 'wcal\_cron\_time\_duration' ); |
| [4607](#L4607) | if ( isset( $duration ) && $duration > 0 ) { |
| [4608](#L4608) | $duration\_in\_seconds = $duration \* 60; |
| [4609](#L4609) | } else { |
| [4610](#L4610) | $duration\_in\_seconds = 900; |
| [4611](#L4611) | } |
| [4612](#L4612) | $schedules['15\_minutes'] = array( |
| [4613](#L4613) | 'interval' => $duration\_in\_seconds,  // 15 minutes in seconds |
| [4614](#L4614) | 'display'  => \_\_( 'Once Every Fifteen Minutes' ), |
| [4615](#L4615) | ); |
| [4616](#L4616) |  |
| [4617](#L4617) | $schedules['wcal\_15\_days'] = array( |
| [4618](#L4618) | 'interval' => 1296000, // 15 days in seconds |
| [4619](#L4619) | 'display'  => \_\_( 'Once Every Fifteen Days' ), |
| [4620](#L4620) | ); |
| [4621](#L4621) | return $schedules; |
| [4622](#L4622) | } |
| [4623](#L4623) |  |
| [4624](#L4624) | /\*\* |
| [4625](#L4625) | \* Callback for Abandoned cart Coupon settings. |
| [4626](#L4626) | \*/ |
| [4627](#L4627) | public static function wcal\_coupon\_callback() { |
| [4628](#L4628) | } |
| [4629](#L4629) |  |
| [4630](#L4630) | /\*\* |
| [4631](#L4631) | \* Callback for GDPR settings section. |
| [4632](#L4632) | \*/ |
| [4633](#L4633) | public static function ac\_lite\_gdpr\_callback() {} |
| [4634](#L4634) | } |
| [4635](#L4635) | } |
| [4636](#L4636) | $woocommerce\_abandon\_cart = new woocommerce\_abandon\_cart\_lite(); |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?format=txt)
* [Original Format](/export/3222443/woocommerce-abandoned-cart/trunk/woocommerce-ac.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from github.com_8e9bb894_20250114_185301.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTycheSoftwares%2Fwoocommerce-abandoned-cart%2Fpull%2F885)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTycheSoftwares%2Fwoocommerce-abandoned-cart%2Fpull%2F885)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=TycheSoftwares%2Fwoocommerce-abandoned-cart)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[TycheSoftwares](/TycheSoftwares)
/
**[woocommerce-abandoned-cart](/TycheSoftwares/woocommerce-abandoned-cart)**
Public

* [Notifications](/login?return_to=%2FTycheSoftwares%2Fwoocommerce-abandoned-cart) You must be signed in to change notification settings
* [Fork
  10](/login?return_to=%2FTycheSoftwares%2Fwoocommerce-abandoned-cart)
* [Star
   13](/login?return_to=%2FTycheSoftwares%2Fwoocommerce-abandoned-cart)

* [Code](/TycheSoftwares/woocommerce-abandoned-cart)
* [Issues
  12](/TycheSoftwares/woocommerce-abandoned-cart/issues)
* [Pull requests
  0](/TycheSoftwares/woocommerce-abandoned-cart/pulls)
* [Actions](/TycheSoftwares/woocommerce-abandoned-cart/actions)
* [Projects
  0](/TycheSoftwares/woocommerce-abandoned-cart/projects)
* [Wiki](/TycheSoftwares/woocommerce-abandoned-cart/wiki)
* [Security](/TycheSoftwares/woocommerce-abandoned-cart/security)
* [Insights](/TycheSoftwares/woocommerce-abandoned-cart/pulse)

Additional navigation options

* [Code](/TycheSoftwares/woocommerce-abandoned-cart)
* [Issues](/TycheSoftwares/woocommerce-abandoned-cart/issues)
* [Pull requests](/TycheSoftwares/woocommerce-abandoned-cart/pulls)
* [Actions](/TycheSoftwares/woocommerce-abandoned-cart/actions)
* [Projects](/TycheSoftwares/woocommerce-abandoned-cart/projects)
* [Wiki](/TycheSoftwares/woocommerce-abandoned-cart/wiki)
* [Security](/TycheSoftwares/woocommerce-abandoned-cart/security)
* [Insights](/TycheSoftwares/woocommerce-abandoned-cart/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FTycheSoftwares%2Fwoocommerce-abandoned-cart%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FTycheSoftwares%2Fwoocommerce-abandoned-cart%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Vulnerability fix for hardcoded encryption key. #885

 Merged

[pinalj](/pinalj)
merged 2 commits into
[master](/TycheSoftwares/woocommerce-abandoned-cart/tree/master "TycheSoftwares/woocommerce-abandoned-cart:master")
from
[fixes-crypt-key](/TycheSoftwares/woocommerce-abandoned-cart/tree/fixes-crypt-key "TycheSoftwares/woocommerce-abandoned-cart:fixes-crypt-key")

Jun 5, 2023

 Merged

# [Vulnerability fix for hardcoded encryption key.](#top) #885

[pinalj](/pinalj)
merged 2 commits into
[master](/TycheSoftwares/woocommerce-abandoned-cart/tree/master "TycheSoftwares/woocommerce-abandoned-cart:master")
from
[fixes-crypt-key](/TycheSoftwares/woocommerce-abandoned-cart/tree/fixes-crypt-key "TycheSoftwares/woocommerce-abandoned-cart:fixes-crypt-key")

Jun 5, 2023

[Conversation
12](/TycheSoftwares/woocommerce-abandoned-cart/pull/885)
[Commits
2](/TycheSoftwares/woocommerce-abandoned-cart/pull/885/commits)
[Checks
0](/TycheSoftwares/woocommerce-abandoned-cart/pull/885/checks)
[Files changed](/TycheSoftwares/woocommerce-abandoned-cart/pull/885/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![pinalj](https://avatars.githubusercontent.com/u/6985712?s=60&v=4)](/pinalj)

Copy link

Contributor

### @pinalj **[pinalj](/pinalj)** commented [Jun 5, 2023](#issue-1740978000)

Made the encryption key variable and unique based on user email address to fix the vulneravility reported.

Sorry, something went wrong.

All reactions

[![@pinalj](https://avatars.githubusercontent.com/u/6985712?s=40&v=4)](/pinalj)

`[Vulnerability fix for hardcoded encryption key.](/TycheSoftwares/woocommerce-abandoned-cart/pull/885/commits/be68b6e8b4bf65e329778bff615ca8b8a895da93 "Vulnerability fix for hardcoded encryption key.

Made the encryption key variable and unique based on user email address to fix the vulneravility reported.")`
 …

`[be68b6e](/TycheSoftwares/woocommerce-abandoned-cart/pull/885/commits/be68b6e8b4bf65e329778bff615ca8b8a895da93)`

```
Made the encryption key variable and unique based on user email address to fix the vulneravility reported.
```

[![@pinalj](https://avatars.githubusercontent.com/u/6985712?s=40&u=73baae8321a7526eed0ddbcab3bed6f0351cdf03&v=4)](/pinalj)
[pinalj](/pinalj)
added this to the [5.15.0](/TycheSoftwares/woocommerce-abandoned-cart/milestone/49) milestone
[Jun 5, 2023](#event-9427797881)

 [![@pinalj](https://avatars.githubusercontent.com/u/6985712?s=40&u=73baae8321a7526eed0ddbcab3bed6f0351cdf03&v=4)](/pinalj)
[pinalj](/pinalj)
requested a review
from [handelce](/handelce)
[June 5, 2023 05:11](#event-9427797893)

[![@pinalj](https://avatars.githubusercontent.com/u/6985712?s=40&u=73baae8321a7526eed0ddbcab3bed6f0351cdf03&v=4)](/pinalj)
[pinalj](/pinalj)
self-assigned this
[Jun 5, 2023](#event-9427797955)

[![handelce](https://avatars.githubusercontent.com/u/39032836?s=60&v=4)](/handelce)

**[handelce](/handelce)**
approved these changes
[Jun 5, 2023](#pullrequestreview-1461941586)

 [View reviewed changes](/TycheSoftwares/woocommerce-abandoned-cart/pull/885/files/be68b6e8b4bf65e329778bff615ca8b8a895da93)

Copy link

Contributor

### @handelce **[handelce](/handelce)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

[@pinalj](https://github.com/pinalj) It all looks good. Big thumbs up for this one.

Sorry, something went wrong.

All reactions

[![@pinalj](https://avatars.githubusercontent.com/u/6985712?s=40&v=4)](/pinalj)

`[Merge branch 'master' into fixes-crypt-key](/TycheSoftwares/woocommerce-abandoned-cart/pull/885/commits/96843b74865b24ab59cd8a67b3b4c8681111dd32 "Merge branch 'master' into fixes-crypt-key")`

`[96843b7](/TycheSoftwares/woocommerce-abandoned-cart/pull/885/commits/96843b74865b24ab59cd8a67b3b4c8681111dd32)`

[![@pinalj](https://avatars.githubusercontent.com/u/6985712?s=40&u=73baae8321a7526eed0ddbcab3bed6f0351cdf03&v=4)](/pinalj)
[pinalj](/pinalj)
merged commit [`2084f77`](/TycheSoftwares/woocommerce-abandoned-cart/commit/2084f77003e60ccc060ad671a281bbede50ba41a)
into
master

[Jun 5, 2023](https://github.com/TycheSoftwares/woocommerce-abandoned-cart/pull/885#event-9429876050)

[![@Ayantaker](https://avatars.githubusercontent.com/u/38920001?s=80&v=4)](/Ayantaker)

Copy link

### **[Ayantaker](/Ayantaker)** commented [Jun 10, 2023](#issuecomment-1585601171) • edited Loading

| I was trying to look into [CVE-2023-2986](https://github.com/advisories/GHSA-54x7-q6m6-mjqv "CVE-2023-2986") (I created a POC script here : <https://github.com/Ayantaker/CVE-2023-2986>) which I guess this fix is for.  I tried out the latest plugin version and the vulnerable version 5.14.2 in a wordpress docker instance and the encryption key is set to be empty for both the instance, which makes it still vulnerable (Not sure if I configured something wrong or not )? |
| --- |

All reactions

Sorry, something went wrong.

[![@ashokrane](https://avatars.githubusercontent.com/u/2211861?s=80&v=4)](/ashokrane)

Copy link

Contributor

### **[ashokrane](/ashokrane)** commented [Jun 12, 2023](#issuecomment-1586573987)

| [@Ayantaker](https://github.com/Ayantaker) Thank you for testing this out. We are floating this back to our team to look into & will get back to you. |
| --- |

All reactions

Sorry, something went wrong.

[![@Ayantaker](https://avatars.githubusercontent.com/u/38920001?s=80&v=4)](/Ayantaker)

Copy link

### **[Ayantaker](/Ayantaker)** commented [Jun 13, 2023](#issuecomment-1589795143)

| Hi, any update on this ? I see a new version has released. |
| --- |

All reactions

Sorry, something went wrong.

[![@pinalj](https://avatars.githubusercontent.com/u/6985712?s=80&u=73baae8321a7526eed0ddbcab3bed6f0351cdf03&v=4)](/pinalj)

Copy link

Contributor

Author

### **[pinalj](/pinalj)** commented [Jun 14, 2023](#issuecomment-1590684725)

| Hi [@Ayantaker](https://github.com/Ayantaker) ,  We had allowed backward compatibility for older links to ensure cart recovery is not affected. In yesterday's release the same has been now removed to ensure the patch is completely secure. |
| --- |

All reactions

Sorry, something went wrong.

[![@Ayantaker](https://avatars.githubusercontent.com/u/38920001?s=80&v=4)](/Ayantaker)

Copy link

### **[Ayantaker](/Ayantaker)** commented [Jun 14, 2023](#issuecomment-1590841651) • edited Loading

| Hi [@pinalj](https://github.com/pinalj) , Not sure I fully grasped that, but have a few questions :   * Since the encryption is empty even in 5.15.0, that is still a vulnerability right ? Since it's in a different version than [CVE-2023-2986](https://github.com/advisories/GHSA-54x7-q6m6-mjqv "CVE-2023-2986"), I think it makes sense to have a separate CVE for it registered. What do you think ? * I tried out the 5.15.1 version as well, with my POC script it still gets exploited. |
| --- |

All reactions

Sorry, something went wrong.

[![@handelce](https://avatars.githubusercontent.com/u/39032836?s=80&u=643122fa102797c7fae152df9cb715643bf758c0&v=4)](/handelce)

Copy link

Contributor

### **[handelce](/handelce)** commented [Jun 14, 2023](#issuecomment-1590961331)

| [@Ayantaker](https://github.com/Ayantaker)  We have tested the vulnerability on 5.15.1 with your POC script and it looks good. For your reference, we have set up two staging sites. Please find their details below:  **Unpatched: 5.14.2** *URL : <http://wcal-unpatched.instawp.xyz/> Username : yujasateni7589 Password : Mws09oCTLG2ezcKEpFA4*  **Patched: 5.15.1** *URL : <http://wcal-5-15-1.instawp.xyz/> Username : pefocaluji9285 Password : OTMIH6v0BwE459mKnoLa*  Carts have been abandoned on both sites. The unpatched version reveals the vulnerability: `php poc.php http://wcal-unpatched.instawp.xyz 80 10` while the patched version does not: `php poc.php http://wcal-5-15-1.instawp.xyz 80 1`0  Please let me know if you have any questions. |
| --- |

All reactions

Sorry, something went wrong.

[![@Ayantaker](https://avatars.githubusercontent.com/u/38920001?s=80&v=4)](/Ayantaker)

Copy link

### **[Ayantaker](/Ayantaker)** commented [Jun 14, 2023](#issuecomment-1590990639)

| Hi [@handelce](https://github.com/handelce) , I have actually updated my POC script, not sure if you ran it against the updated one or not, but as you can see it's still able to exploit the version 5.15.1 instance of yours  ``` php poc.php http://wcal-5-15-1.instawp.xyz/ 80 5 [*] Enumerating cart ID : 1 [*] Enumerating cart ID : 2 [+] Authentication Bypass URL for user 'pefocaluji9285' : http://wcal-5-15-1.instawp.xyz/:80/?wcal_action=checkout_link&user_email=test&validate=HAGYYG2fiWSJpGhKcwuX4ncOQFMwqB75JF9FTTxvmIREvHWhZoxhY7Yciv/2dJnOZSAVby42Ev1oig== [*] Enumerating cart ID : 3 [*] Enumerating cart ID : 4 [*] Enumerating cart ID : 5  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@handelce](https://avatars.githubusercontent.com/u/39032836?s=80&u=643122fa102797c7fae152df9cb715643bf758c0&v=4)](/handelce)

Copy link

Contributor

### **[handelce](/handelce)** commented [Jun 14, 2023](#issuecomment-1591072139)

| [@Ayantaker](https://github.com/Ayantaker) Got that. I'll check the updated script and let you know. |
| --- |

All reactions

Sorry, something went wrong.

[![@handelce](https://avatars.githubusercontent.com/u/39032836?s=80&u=643122fa102797c7fae152df9cb715643bf758c0&v=4)](/handelce)

Copy link

Contributor

### **[handelce](/handelce)** commented [Jun 20, 2023](#issuecomment-1598381205)

| [@Ayantaker](https://github.com/Ayantaker) Thank you for your dedicated effort in seeing that this vulnerability is properly handled. We've taken a look at your POC script and based on the exploit, we've patched the plugin. We'll be releasing 5.15.2 today and we'd like for you to confirm from your end that things are working fine. Thanking you once more! |
| --- |

All reactions

Sorry, something went wrong.

[![@Ayantaker](https://avatars.githubusercontent.com/u/38920001?s=80&v=4)](/Ayantaker)

Copy link

### **[Ayantaker](/Ayantaker)** commented [Jun 20, 2023](#issuecomment-1598504056)

| Hey [@handelce](https://github.com/handelce) , if you have tested with the updated POC, should be good to go. Thanks for fixing it!  I would recommend filing for a new CVE ID for versions 5.15.0 and 5.15.1 since the previous CVE doesn't cover these versions or let me know I can request for one as well. |
| --- |

All reactions

Sorry, something went wrong.

[![@handelce](https://avatars.githubusercontent.com/u/39032836?s=80&u=643122fa102797c7fae152df9cb715643bf758c0&v=4)](/handelce)

Copy link

Contributor

### **[handelce](/handelce)** commented [Jun 21, 2023](#issuecomment-1601813615)

| [@Ayantaker](https://github.com/Ayantaker) Yes, please go ahead. Thank you once more! |
| --- |

All reactions

Sorry, something went wrong.

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FTycheSoftwares%2Fwoocommerce-abandoned-cart%2Fpull%2F885)

Reviewers

[![@handelce](https://avatars.githubusercontent.com/u/39032836?s=40&v=4)](/handelce) [handelce](/handelce)

handelce approved these changes

Assignees

[![@pinalj](https://avatars.githubusercontent.com/u/6985712?s=40&v=4)](/pinalj) [pinalj](/pinalj)

Labels

None yet

Projects

None yet

Milestone

 [**5.15.0**](/TycheSoftwares/woocommerce-abandoned-cart/milestone/49 "5.15.0")

Development

Successfully merging this pull request may close these issues.

4 participants

[![@pinalj](https://avatars.githubusercontent.com/u/6985712?s=52&v=4)](/pinalj) [![@Ayantaker](https://avatars.githubusercontent.com/u/38920001?s=52&v=4)](/Ayantaker) [![@ashokrane](https://avatars.githubusercontent.com/u/2211861?s=52&v=4)](/ashokrane) [![@handelce](https://avatars.githubusercontent.com/u/39032836?s=52&v=4)](/handelce)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_b40d05dd_20250115_113315.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpinalj)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpinalj)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

![@pinalj](https://avatars.githubusercontent.com/u/6985712?s=64&v=4)

**pinalj**
[Follow](/login?return_to=https%3A%2F%2Fgithub.com%2Fpinalj)

[Overview](/pinalj)
[Repositories
3](/pinalj?tab=repositories)
[Projects
0](/pinalj?tab=projects)
[Packages
0](/pinalj?tab=packages)
[Stars
0](/pinalj?tab=stars)

More

* [Overview](/pinalj)
* [Repositories](/pinalj?tab=repositories)
* [Projects](/pinalj?tab=projects)
* [Packages](/pinalj?tab=packages)
* [Stars](/pinalj?tab=stars)

![@pinalj](https://avatars.githubusercontent.com/u/6985712?s=64&v=4)

**pinalj**

[Follow](/login?return_to=https%3A%2F%2Fgithub.com%2Fpinalj)

[![View pinalj's full-sized avatar](https://avatars.githubusercontent.com/u/6985712?v=4)](https://avatars.githubusercontent.com/u/6985712?v=4)

# Pinal pinalj

[Follow](/login?return_to=https%3A%2F%2Fgithub.com%2Fpinalj)

WordPress/WooCommerce developer
[4
followers](https://github.com/pinalj?tab=followers) · [0
following](https://github.com/pinalj?tab=following)

* Tyche Softwares
* Mumbai

## [Achievements](/pinalj?tab=achievements)

[![Achievement: Pull Shark](https://github.githubassets.com/assets/pull-shark-default-498c279a747d.png)x4](/pinalj?achievement=pull-shark&tab=achievements)[![Achievement: YOLO](https://github.githubassets.com/assets/yolo-default-be0bbff04951.png)](/pinalj?achievement=yolo&tab=achievements)[![Achievement: Quickdraw](https://github.githubassets.com/assets/quickdraw-default-39c6aec8ff89.png)](/pinalj?achievement=quickdraw&tab=achievements)[![Achievement: Arctic Code Vault Contributor](https://github.githubassets.com/assets/arctic-code-vault-contributor-default-df8d74122a06.png)](/pinalj?achievement=arctic-code-vault-contributor&tab=achievements)
## [Achievements](/pinalj?tab=achievements)

[![Achievement: Pull Shark](https://github.githubassets.com/assets/pull-shark-default-498c279a747d.png)x4](/pinalj?achievement=pull-shark&tab=achievements)[![Achievement: YOLO](https://github.githubassets.com/assets/yolo-default-be0bbff04951.png)](/pinalj?achievement=yolo&tab=achievements)[![Achievement: Quickdraw](https://github.githubassets.com/assets/quickdraw-default-39c6aec8ff89.png)](/pinalj?achievement=quickdraw&tab=achievements)[![Achievement: Arctic Code Vault Contributor](https://github.githubassets.com/assets/arctic-code-vault-contributor-default-df8d74122a06.png)](/pinalj?achievement=arctic-code-vault-contributor&tab=achievements)

Block or Report

# Block or report pinalj

**Block user**

Prevent this user from interacting with your repositories and sending you notifications.
Learn more about [blocking users](https://docs.github.com/articles/blocking-a-user-from-your-personal-account).

You must be logged in to block users.

Add an optional note:

Please don't include any personal information such as legal names or email addresses. Maximum 100 characters, markdown supported. This note will be visible to only you.

Block user

**Report abuse**

Contact GitHub support about this user’s behavior.
Learn more about [reporting abuse](https://docs.github.com/articles/reporting-abuse-or-spam).

[Report abuse](/contact/report-abuse?report=pinalj+%28user%29)

[Overview](/pinalj)
[Repositories
3](/pinalj?tab=repositories)
[Projects
0](/pinalj?tab=projects)
[Packages
0](/pinalj?tab=packages)
[Stars
0](/pinalj?tab=stars)

More

* [Overview](/pinalj)
* [Repositories](/pinalj?tab=repositories)
* [Projects](/pinalj?tab=projects)
* [Packages](/pinalj?tab=packages)
* [Stars](/pinalj?tab=stars)

## Popular repositories Loading

1. [quotes-for-woocommerce](/pinalj/quotes-for-woocommerce) quotes-for-woocommerce
   Public

   Quotes for WooCommerce

   PHP

   [8](/pinalj/quotes-for-woocommerce/stargazers)
   [7](/pinalj/quotes-for-woocommerce/forks)
2. [woocommerce](/pinalj/woocommerce) woocommerce
   Public

   Forked from [woocommerce/woocommerce](/woocommerce/woocommerce)

   An open source eCommerce plugin for WordPress.

   PHP
3. [test-repo](/pinalj/test-repo) test-repo
   Public

   This is a test repository

   PHP

Something went wrong, please refresh the page to try again.

If the problem persists, check the [GitHub status page](https://www.githubstatus.com/)
or [contact support](/contact).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from plugins.trac.wordpress.org_e173aa6b_20250114_185441.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F2922242)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Changeset](/changeset/2922241 "Changeset 2922241")
* [Next Changeset](/changeset/2922243 "Changeset 2922243") →

---

# Changeset 2922242

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
06/06/2023 10:31:30 AM
([20 months](/timeline?from=2023-06-06T10%3A31%3A30Z&precision=second "See timeline at 06/06/2023 10:31:30 AM") ago)

Author:
tychesoftwares
Message:

Update to version 5.15.0 from GitHub

Location:
[woocommerce-abandoned-cart](/browser/woocommerce-abandoned-cart?rev=2922242)
Files:

24 edited
1 copied

* [tags/5.15.0](/browser/woocommerce-abandoned-cart/tags/5.15.0?rev=2922242 "Show entry in browser")
  (copied)
  *(copied from [woocommerce-abandoned-cart/trunk](/browser/woocommerce-abandoned-cart/trunk?rev=2916178 "Show original file (revision 2922241)"))*
* [tags/5.15.0/class-wcal-update.php](/browser/woocommerce-abandoned-cart/tags/5.15.0/class-wcal-update.php?rev=2922242 "Show entry in browser")
  (modified)
  ([2 diffs](#file1 "Show differences"))
* [tags/5.15.0/cron/class-wcal-cron.php](/browser/woocommerce-abandoned-cart/tags/5.15.0/cron/class-wcal-cron.php?rev=2922242 "Show entry in browser")
  (modified)
  ([4 diffs](#file2 "Show differences"))
* [tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242 "Show entry in browser")
  (modified)
  ([32 diffs](#file3 "Show differences"))
* [tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242 "Show entry in browser")
  (modified)
  ([32 diffs](#file4 "Show differences"))
* [tags/5.15.0/includes/admin/class-wcal-abandoned-cart-details.php](/browser/woocommerce-abandoned-cart/tags/5.15.0/includes/admin/class-wcal-abandoned-cart-details.php?rev=2922242 "Show entry in browser")
  (modified)
  ([2 diffs](#file5 "Show differences"))
* [tags/5.15.0/includes/class-wcal-common.php](/browser/woocommerce-abandoned-cart/tags/5.15.0/includes/class-wcal-common.php?rev=2922242 "Show entry in browser")
  (modified)
  ([3 diffs](#file6 "Show differences"))
* [tags/5.15.0/includes/classes/class-wcal-dashboard-report.php](/browser/woocommerce-abandoned-cart/tags/5.15.0/includes/classes/class-wcal-dashboard-report.php?rev=2922242 "Show entry in browser")
  (modified)
  ([3 diffs](#file7 "Show differences"))
* [tags/5.15.0/includes/classes/class-wcal-recover-orders-table.php](/browser/woocommerce-abandoned-cart/tags/5.15.0/includes/classes/class-wcal-recover-orders-table.php?rev=2922242 "Show entry in browser")
  (modified)
  ([1 diff](#file8 "Show differences"))
* [tags/5.15.0/includes/frontend/class-wcal-checkout-process.php](/browser/woocommerce-abandoned-cart/tags/5.15.0/includes/frontend/class-wcal-checkout-process.php?rev=2922242 "Show entry in browser")
  (modified)
  ([16 diffs](#file9 "Show differences"))
* [tags/5.15.0/includes/wcal-functions.php](/browser/woocommerce-abandoned-cart/tags/5.15.0/includes/wcal-functions.php?rev=2922242 "Show entry in browser")
  (modified)
  ([2 diffs](#file10 "Show differences"))
* [tags/5.15.0/readme.txt](/browser/woocommerce-abandoned-cart/tags/5.15.0/readme.txt?rev=2922242 "Show entry in browser")
  (modified)
  ([1 diff](#file11 "Show differences"))
* [tags/5.15.0/woocommerce-ac.php](/browser/woocommerce-abandoned-cart/tags/5.15.0/woocommerce-ac.php?rev=2922242 "Show entry in browser")
  (modified)
  ([9 diffs](#file12 "Show differences"))
* [trunk/class-wcal-update.php](/browser/woocommerce-abandoned-cart/trunk/class-wcal-update.php?rev=2922242 "Show entry in browser")
  (modified)
  ([2 diffs](#file13 "Show differences"))
* [trunk/cron/class-wcal-cron.php](/browser/woocommerce-abandoned-cart/trunk/cron/class-wcal-cron.php?rev=2922242 "Show entry in browser")
  (modified)
  ([4 diffs](#file14 "Show differences"))
* [trunk/i18n/languages/woocommerce-abandoned-cart.po](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242 "Show entry in browser")
  (modified)
  ([32 diffs](#file15 "Show differences"))
* [trunk/i18n/languages/woocommerce-abandoned-cart.pot](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242 "Show entry in browser")
  (modified)
  ([32 diffs](#file16 "Show differences"))
* [trunk/includes/admin/class-wcal-abandoned-cart-details.php](/browser/woocommerce-abandoned-cart/trunk/includes/admin/class-wcal-abandoned-cart-details.php?rev=2922242 "Show entry in browser")
  (modified)
  ([2 diffs](#file17 "Show differences"))
* [trunk/includes/class-wcal-common.php](/browser/woocommerce-abandoned-cart/trunk/includes/class-wcal-common.php?rev=2922242 "Show entry in browser")
  (modified)
  ([3 diffs](#file18 "Show differences"))
* [trunk/includes/classes/class-wcal-dashboard-report.php](/browser/woocommerce-abandoned-cart/trunk/includes/classes/class-wcal-dashboard-report.php?rev=2922242 "Show entry in browser")
  (modified)
  ([3 diffs](#file19 "Show differences"))
* [trunk/includes/classes/class-wcal-recover-orders-table.php](/browser/woocommerce-abandoned-cart/trunk/includes/classes/class-wcal-recover-orders-table.php?rev=2922242 "Show entry in browser")
  (modified)
  ([1 diff](#file20 "Show differences"))
* [trunk/includes/frontend/class-wcal-checkout-process.php](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2922242 "Show entry in browser")
  (modified)
  ([16 diffs](#file21 "Show differences"))
* [trunk/includes/wcal-functions.php](/browser/woocommerce-abandoned-cart/trunk/includes/wcal-functions.php?rev=2922242 "Show entry in browser")
  (modified)
  ([2 diffs](#file22 "Show differences"))
* [trunk/readme.txt](/browser/woocommerce-abandoned-cart/trunk/readme.txt?rev=2922242 "Show entry in browser")
  (modified)
  ([1 diff](#file23 "Show differences"))
* [trunk/woocommerce-ac.php](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2922242 "Show entry in browser")
  (modified)
  ([9 diffs](#file24 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [woocommerce-abandoned-cart/tags/5.15.0/class-wcal-update.php](/changeset/2922242/woocommerce-abandoned-cart/tags/5.15.0/class-wcal-update.php "Show the changeset 2922242 restricted to woocommerce-abandoned-cart/tags/5.15.0/class-wcal-update.php")

  | [r2888174](/browser/woocommerce-abandoned-cart/trunk/class-wcal-update.php?rev=2888174#L242 "Show revision 2888174 of this file in browser") | [r2922242](/browser/woocommerce-abandoned-cart/tags/5.15.0/class-wcal-update.php?rev=2922242#L242 "Show revision 2922242 of this file in browser") |  |
  | --- | --- | --- |
  | 242 | 242 |  |
  | 243 | 243 | if ( 0 === $blog\_id ) { |
  | 244 |  | ~~if ( ! get\_option( 'wcal\_security\_key' ) ) {~~ |
  | 245 |  | ~~update\_option( 'wcal\_security\_key', 'qJB0rGtIn5UB1xG03efyCp' );~~ |
  | 246 |  | ~~}~~ |
  | 247 |  |  |
  | 248 | 244 | update\_option( 'ac\_lite\_alter\_table\_queries', 'yes' ); |
  | 249 | 245 | } else { |
  | 250 |  | ~~if ( ! get\_blog\_option( $blog\_id, 'wcal\_security\_key' ) ) {~~ |
  | 251 |  | ~~update\_blog\_option( $blog\_id, 'wcal\_security\_key', 'qJB0rGtIn5UB1xG03efyCp' );~~ |
  | 252 |  | ~~}~~ |
  | 253 |  |  |
  | 254 | 246 | update\_blog\_option( $blog\_id, 'ac\_lite\_alter\_table\_queries', 'yes' ); |
  | 255 | 247 | } |
  | […](/browser/woocommerce-abandoned-cart/trunk/class-wcal-update.php?rev=2888174#L293) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/class-wcal-update.php?rev=2922242#L285) |  |
  | 293 | 285 | if ( ! $wpdb->get\_var( 'SHOW COLUMNS FROM `' . $db\_prefix . "ac\_abandoned\_cart\_history\_lite` LIKE 'checkout\_link'" ) ) { // phpcs:ignore |
  | 294 | 286 | $wpdb->query( 'ALTER TABLE ' . $db\_prefix . 'ac\_abandoned\_cart\_history\_lite ADD `checkout\_link` varchar(500) NOT NULL AFTER `email\_reminder\_status`' ); // phpcs:ignore |
  |  | 287 | } |
  |  | 288 | // 5.14.3 |
  |  | 289 | if ( ! $wpdb->get\_var( 'SHOW COLUMNS FROM `' . $db\_prefix . "ac\_sent\_history\_lite` LIKE 'encrypt\_key';" ) ) { //phpcs:ignore |
  |  | 290 | $wpdb->query( 'ALTER TABLE ' . $db\_prefix . 'ac\_sent\_history\_lite ADD `encrypt\_key` VARCHAR(500) NOT NULL AFTER `sent\_email\_id`;' ); //phpcs:ignore |
  | 295 | 291 | } |
  | 296 | 292 | } |
* ## [woocommerce-abandoned-cart/tags/5.15.0/cron/class-wcal-cron.php](/changeset/2922242/woocommerce-abandoned-cart/tags/5.15.0/cron/class-wcal-cron.php "Show the changeset 2922242 restricted to woocommerce-abandoned-cart/tags/5.15.0/cron/class-wcal-cron.php")

  | [r2916178](/browser/woocommerce-abandoned-cart/trunk/cron/class-wcal-cron.php?rev=2916178#L231 "Show revision 2916178 of this file in browser") | [r2922242](/browser/woocommerce-abandoned-cart/tags/5.15.0/cron/class-wcal-cron.php?rev=2922242#L231 "Show revision 2922242 of this file in browser") |  |
  | --- | --- | --- |
  | 231 | 231 | $email\_body = str\_ireplace( '{{cart.abandoned\_date}}', $order\_date, $email\_body ); |
  | 232 | 232 |  |
  |  | 233 | $crypt\_key = wcal\_get\_crypt\_key( $value->user\_email ); |
  | 233 | 234 | $wpdb->query( // phpcs:ignore |
  | 234 | 235 | $wpdb->prepare( |
  | 235 |  | "INSERT INTO `" . $wpdb->prefix . "ac\_sent\_history\_lite` ( template\_id, abandoned\_order\_id, sent\_time, sent\_email\_id~~) VALUES ( %s, %s, '" . current\_time( 'mysql' ) . "'~~, %s )", // phpcs:ignore |
  |  | 236 | "INSERT INTO `" . $wpdb->prefix . "ac\_sent\_history\_lite` ( template\_id, abandoned\_order\_id, sent\_time, sent\_email\_id, encrypt\_key ) VALUES ( %s, %s, '" . current\_time( 'mysql' ) . "', %s, %s )", // phpcs:ignore |
  | 236 | 237 | $template\_id, |
  | 237 | 238 | $value->id, |
  | 238 |  | $value->user\_email |
  |  | 239 | $value->user\_email, |
  |  | 240 | $crypt\_key |
  | 239 | 241 | ) |
  | 240 | 242 | ); |
  | […](/browser/woocommerce-abandoned-cart/trunk/cron/class-wcal-cron.php?rev=2916178#L263) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/cron/class-wcal-cron.php?rev=2922242#L265) |  |
  | 263 | 265 | $cart\_page\_link  = apply\_filters( 'wcal\_cart\_link\_email\_before\_encoding', $cart\_page\_link, $value->id ); |
  | 264 | 266 | $encoding\_cart   = $email\_sent\_id . '&url=' . $cart\_page\_link . $utm; |
  | 265 |  | $validate\_cart   = wcal\_common::wcal\_encrypt\_validate( $encoding\_cart ); |
  | 266 |  | $cart\_link\_track = get\_option( 'siteurl' ) . '/?wcal\_action=track\_links&validate=' . $validate\_cart; |
  |  | 267 | $validate\_cart   = wcal\_common::wcal\_encrypt\_validate( $encoding\_cart, $crypt\_key ); |
  |  | 268 | $cart\_link\_track = get\_option( 'siteurl' ) . '/?wcal\_action=track\_links&user\_email=' . $value->user\_email . '&validate=' . $validate\_cart; |
  | 267 | 269 |  |
  | 268 | 270 | list( $email\_body , $coupon\_code\_to\_apply ) = wcal\_common::wcal\_check\_and\_replace\_email\_tag( $email\_body, $wc\_email\_template ); |
  | 269 | 271 | if ( '' !== $coupon\_code\_to\_apply ) { |
  | 270 |  | $encypted\_coupon\_code = wcal\_common::wcal\_encrypt\_validate( $coupon\_code\_to\_apply ); |
  |  | 272 | $encypted\_coupon\_code = wcal\_common::wcal\_encrypt\_validate( $coupon\_code\_to\_apply, $crypt\_key ); |
  | 271 | 273 | $cart\_link\_track     .= '&c=' . $encypted\_coupon\_code; |
  | 272 | 274 | } |
  | 273 | 275 |  |
  | 274 | 276 | $email\_body           = str\_ireplace( '{{cart.link}}', $cart\_link\_track, $email\_body ); |
  | 275 |  | $validate\_unsubscribe = wcal\_common::wcal\_encrypt\_validate( $email\_sent\_id ); |
  |  | 277 | $validate\_unsubscribe = wcal\_common::wcal\_encrypt\_validate( $email\_sent\_id, $crypt\_key ); |
  | 276 | 278 | if ( count( $results\_sent ) > 0 && isset( $results\_sent[0]->sent\_email\_id ) ) { |
  | 277 | 279 | $email\_sent\_id\_address = $results\_sent[0]->sent\_email\_id; |
  | 278 | 280 | } |
  | 279 | 281 | $encrypt\_email\_sent\_id\_address = hash( 'sha256', $email\_sent\_id\_address ); |
  | 280 |  | $plugins\_url                   = get\_option( 'siteurl' ) . '/?wcal\_track\_unsubscribe=wcal\_unsubscribe&validate=' . $validate\_unsubscribe . '&track\_email\_id=' . $encrypt\_email\_sent\_id\_address; |
  |  | 282 | $plugins\_url                   = get\_option( 'siteurl' ) . '/?wcal\_track\_unsubscribe=wcal\_unsubscribe&user\_email=' . $value->user\_email . '&validate=' . $validate\_unsubscribe . '&track\_email\_id=' . $encrypt\_email\_sent\_id\_address; |
  | 281 | 283 | $unsubscribe\_link\_track        = $plugins\_url; |
  | 282 | 284 | $email\_body                    = str\_ireplace( '{{cart.unsubscribe}}', $unsubscribe\_link\_track, $email\_body ); |
  | […](/browser/woocommerce-abandoned-cart/trunk/cron/class-wcal-cron.php?rev=2916178#L566) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/cron/class-wcal-cron.php?rev=2922242#L568) |  |
  | 566 | 568 | $order\_id         = 0; |
  | 567 | 569 | $wcal\_cart\_status = false; |
  | 568 |  |  |
  | 569 |  | $results\_wcal\_check\_if\_cart\_is\_present\_in\_post\_meta = $wpdb->get\_var( // phpcS:ignore |
  | 570 |  | $wpdb->prepare( |
  | 571 |  | "SELECT post\_id FROM `" . $wpdb->prefix . "postmeta` WHERE meta\_key = 'wcal\_abandoned\_cart\_id' AND meta\_value = %d LIMIT 1", // phpcs:ignore |
  | 572 |  | $wcal\_cart\_id |
  | 573 |  | ) |
  | 574 |  | ); |
  | 575 |  |  |
  | 576 |  | if ( is\_array( $results\_wcal\_check\_if\_cart\_is\_present\_in\_post\_meta ) && $results\_wcal\_check\_if\_cart\_is\_present\_in\_post\_meta > 0 ) { |
  | 577 |  | $order\_id = $results\_wcal\_check\_if\_cart\_is\_present\_in\_post\_meta; |
  | 578 |  | $order    = wc\_get\_order( $order\_id ); |
  | 579 |  | } else { // check for an order for the same date & email address. |
  |  | 570 | if ( wcal\_is\_hpos\_enabled() ) { // HPOS usage is enabled. |
  |  | 571 | $get\_order = wc\_get\_orders( |
  |  | 572 | array( |
  |  | 573 | 'limit'      => 1, |
  |  | 574 | 'meta\_query' => array( // phpcs:ignore |
  |  | 575 | array( |
  |  | 576 | 'key'     => 'wcal\_abandoned\_cart\_id', |
  |  | 577 | 'value'   => $wcal\_cart\_id, |
  |  | 578 | 'compare' => 'EQUAL', |
  |  | 579 | ), |
  |  | 580 | ), |
  |  | 581 | ) |
  |  | 582 | ); |
  |  | 583 | if ( ! empty( $get\_order ) ) { |
  |  | 584 | $order = $get\_order[0]; |
  |  | 585 | } |
  |  | 586 | } else { // Traditional CPT-based orders are in use. |
  |  | 587 |  |
  |  | 588 | $results\_wcal\_check\_if\_cart\_is\_present\_in\_post\_meta = $wpdb->get\_var( // phpcS:ignore |
  |  | 589 | $wpdb->prepare( |
  |  | 590 | "SELECT post\_id FROM `" . $wpdb->prefix . "postmeta` WHERE meta\_key = 'wcal\_abandoned\_cart\_id' AND meta\_value = %d LIMIT 1", // phpcs:ignore |
  |  | 591 | $wcal\_cart\_id |
  |  | 592 | ) |
  |  | 593 | ); |
  |  | 594 |  |
  |  | 595 | if ( is\_array( $results\_wcal\_check\_if\_cart\_is\_present\_in\_post\_meta ) && $results\_wcal\_check\_if\_cart\_is\_present\_in\_post\_meta > 0 ) { |
  |  | 596 | $order\_id = $results\_wcal\_check\_if\_cart\_is\_present\_in\_post\_meta; |
  |  | 597 | $order    = wc\_get\_order( $order\_id ); |
  |  | 598 | } |
  |  | 599 | } |
  |  | 600 | if ( ! isset( $order ) ) { // check for an order for the same date & email address. |
  | 580 | 601 | $args      = array( |
  | 581 | 602 | 'customer' => $wcal\_user\_email, |
  | […](/browser/woocommerce-abandoned-cart/trunk/cron/class-wcal-cron.php?rev=2916178#L587) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/cron/class-wcal-cron.php?rev=2922242#L608) |  |
  | 587 | 608 | } |
  | 588 | 609 | } |
  |  | 610 |  |
  | 589 | 611 | if ( isset( $order ) && is\_object( $order ) ) { |
  | 590 | 612 |  |
* ## [woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po](/changeset/2922242/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po "Show the changeset 2922242 restricted to woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po")

  | [r2916178](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L8 "Show revision 2916178 of this file in browser") | [r2922242](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L8 "Show revision 2922242 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 | "Project-Id-Version: \n" |
  | 9 | 9 | "Report-Msgid-Bugs-To: \n" |
  | 10 |  | "POT-Creation-Date: 2023-0~~5-22 17:07~~+0530\n" |
  | 11 |  | "PO-Revision-Date: 2023-0~~5-22 17:07~~+0500\n" |
  |  | 10 | "POT-Creation-Date: 2023-06-06 15:53+0530\n" |
  |  | 11 | "PO-Revision-Date: 2023-06-06 15:54+0500\n" |
  | 12 | 12 | "Last-Translator: FULL NAME <EMAIL@ADDRESS>\n" |
  | 13 | 13 | "Language-Team: LANGUAGE <LL@li.org>\n" |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L19) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L19) |  |
  | 19 | 19 | "X-Generator: Eazy Po 1.0.0.0\n" |
  | 20 | 20 |  |
  | 21 |  | #: class-wcal-update.php:~~502~~ |
  |  | 21 | #: class-wcal-update.php:498 |
  | 22 | 22 | msgid "" |
  | 23 | 23 | "There was an error creating the guest cart table for Abandoned Cart Lite for " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L26) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L26) |  |
  | 26 | 26 | msgstr "" |
  | 27 | 27 |  |
  | 28 |  | #: woocommerce-ac.php:3~~17 woocommerce-ac.php:2241~~ |
  |  | 28 | #: woocommerce-ac.php:320 woocommerce-ac.php:2277 |
  | 29 | 29 | #: includes/connectors/class-wcap-display-connectors.php:69 |
  | 30 | 30 | msgid "Settings" |
  | 31 | 31 | msgstr "" |
  | 32 | 32 |  |
  | 33 |  | #: woocommerce-ac.php:34~~6~~ |
  |  | 33 | #: woocommerce-ac.php:349 |
  | 34 | 34 | msgid "Emails are not being sent to customers." |
  | 35 | 35 | msgstr "" |
  | 36 | 36 |  |
  | 37 |  | #: woocommerce-ac.php:35~~2~~ |
  |  | 37 | #: woocommerce-ac.php:355 |
  | 38 | 38 | msgid "Capturing of cart and other information was not satisfactory." |
  | 39 | 39 | msgstr "" |
  | 40 | 40 |  |
  | 41 |  | #: woocommerce-ac.php:3~~58~~ |
  |  | 41 | #: woocommerce-ac.php:361 |
  | 42 | 42 | msgid "I cannot see abandoned cart reminder emails records." |
  | 43 | 43 | msgstr "" |
  | 44 | 44 |  |
  | 45 |  | #: woocommerce-ac.php:36~~4~~ |
  |  | 45 | #: woocommerce-ac.php:367 |
  | 46 | 46 | msgid "I want to upgrade the plugin to the PRO version." |
  | 47 | 47 | msgstr "" |
  | 48 | 48 |  |
  | 49 |  | #: woocommerce-ac.php:4~~87~~ |
  |  | 49 | #: woocommerce-ac.php:490 |
  | 50 | 50 | msgid "HTML Email Template" |
  | 51 | 51 | msgstr "" |
  | 52 | 52 |  |
  | 53 |  | #: woocommerce-ac.php:49~~3~~ |
  |  | 53 | #: woocommerce-ac.php:496 |
  | 54 | 54 | msgid "Abandoned cart Email Template" |
  | 55 | 55 | msgstr "" |
  | 56 | 56 |  |
  | 57 |  | #: woocommerce-ac.php:7~~74~~ |
  |  | 57 | #: woocommerce-ac.php:790 |
  | 58 | 58 | msgid "Cart Abandonment Settings" |
  | 59 | 59 | msgstr "" |
  | 60 | 60 |  |
  | 61 |  | #: woocommerce-ac.php:7~~81~~ |
  |  | 61 | #: woocommerce-ac.php:797 |
  | 62 | 62 | msgid "Enable abandoned cart emails" |
  | 63 | 63 | msgstr "" |
  | 64 | 64 |  |
  | 65 |  | #: woocommerce-ac.php:~~785~~ |
  |  | 65 | #: woocommerce-ac.php:801 |
  | 66 | 66 | msgid "Yes, enable the abandoned cart emails." |
  | 67 | 67 | msgstr "" |
  | 68 | 68 |  |
  | 69 |  | #: woocommerce-ac.php:~~790~~ |
  |  | 69 | #: woocommerce-ac.php:806 |
  | 70 | 70 | msgid "Cart abandoned cut-off time" |
  | 71 | 71 | msgstr "" |
  | 72 | 72 |  |
  | 73 |  | #: woocommerce-ac.php:~~794~~ |
  |  | 73 | #: woocommerce-ac.php:810 |
  | 74 | 74 | msgid "" |
  | 75 | 75 | "Consider cart abandoned after X minutes of item being added to cart & order " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L77) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L77) |  |
  | 77 | 77 | msgstr "" |
  | 78 | 78 |  |
  | 79 |  | #: woocommerce-ac.php:~~799~~ |
  |  | 79 | #: woocommerce-ac.php:815 |
  | 80 | 80 | msgid "Automatically Delete Abandoned Orders after X days" |
  | 81 | 81 | msgstr "" |
  | 82 | 82 |  |
  | 83 |  | #: woocommerce-ac.php:8~~03~~ |
  |  | 83 | #: woocommerce-ac.php:819 |
  | 84 | 84 | msgid "Automatically delete abandoned cart orders after X days." |
  | 85 | 85 | msgstr "" |
  | 86 | 86 |  |
  | 87 |  | #: woocommerce-ac.php:8~~08~~ |
  |  | 87 | #: woocommerce-ac.php:824 |
  | 88 | 88 | msgid "Email admin On Order Recovery" |
  | 89 | 89 | msgstr "" |
  | 90 | 90 |  |
  | 91 |  | #: woocommerce-ac.php:8~~12~~ |
  |  | 91 | #: woocommerce-ac.php:828 |
  | 92 | 92 | msgid "Sends email to Admin if an Abandoned Cart Order is recovered." |
  | 93 | 93 | msgstr "" |
  | 94 | 94 |  |
  | 95 |  | #: woocommerce-ac.php:8~~17~~ |
  |  | 95 | #: woocommerce-ac.php:833 |
  | 96 | 96 | msgid "Start tracking from Cart Page" |
  | 97 | 97 | msgstr "" |
  | 98 | 98 |  |
  | 99 |  | #: woocommerce-ac.php:8~~21~~ |
  |  | 99 | #: woocommerce-ac.php:837 |
  | 100 | 100 | msgid "" |
  | 101 | 101 | "Enable tracking of abandoned products & carts even if customer does not " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L105) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L105) |  |
  | 105 | 105 | msgstr "" |
  | 106 | 106 |  |
  | 107 |  | #: woocommerce-ac.php:8~~26~~ |
  |  | 107 | #: woocommerce-ac.php:842 |
  | 108 | 108 | msgid "GDPR Settings" |
  | 109 | 109 | msgstr "" |
  | 110 | 110 |  |
  | 111 |  | #: woocommerce-ac.php:8~~33~~ |
  |  | 111 | #: woocommerce-ac.php:849 |
  | 112 | 112 | msgid "Enable GDPR Notice" |
  | 113 | 113 | msgstr "" |
  | 114 | 114 |  |
  | 115 |  | #: woocommerce-ac.php:8~~37~~ |
  |  | 115 | #: woocommerce-ac.php:853 |
  | 116 | 116 | msgid "" |
  | 117 | 117 | "Enable this setting to display a notice informing customers that their email " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L119) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L119) |  |
  | 119 | 119 | msgstr "" |
  | 120 | 120 |  |
  | 121 |  | #: woocommerce-ac.php:8~~42~~ |
  |  | 121 | #: woocommerce-ac.php:858 |
  | 122 | 122 | msgid "Message to be displayed for Guest users when tracking their carts" |
  | 123 | 123 | msgstr "" |
  | 124 | 124 |  |
  | 125 |  | #: woocommerce-ac.php:8~~46~~ |
  |  | 125 | #: woocommerce-ac.php:862 |
  | 126 | 126 | msgid "" |
  | 127 | 127 | "<br>In compliance with GDPR, add a message on the Checkout page to inform " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L131) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L131) |  |
  | 131 | 131 | msgstr "" |
  | 132 | 132 |  |
  | 133 |  | #: woocommerce-ac.php:8~~51~~ |
  |  | 133 | #: woocommerce-ac.php:867 |
  | 134 | 134 | msgid "Message to be displayed for registered users when tracking their carts." |
  | 135 | 135 | msgstr "" |
  | 136 | 136 |  |
  | 137 |  | #: woocommerce-ac.php:8~~55~~ |
  |  | 137 | #: woocommerce-ac.php:871 |
  | 138 | 138 | msgid "" |
  | 139 | 139 | "<br>In compliance with GDPR, add a message on the Shop & Product pages to " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L142) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L142) |  |
  | 142 | 142 | msgstr "" |
  | 143 | 143 |  |
  | 144 |  | #: woocommerce-ac.php:8~~60~~ |
  |  | 144 | #: woocommerce-ac.php:876 |
  | 145 | 145 | msgid "Allow the visitor to opt out of cart tracking." |
  | 146 | 146 | msgstr "" |
  | 147 | 147 |  |
  | 148 |  | #: woocommerce-ac.php:8~~64~~ |
  |  | 148 | #: woocommerce-ac.php:880 |
  | 149 | 149 | msgid "" |
  | 150 | 150 | "<br>In compliance with GDPR, allow the site visitor (guests & registered " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L153) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L153) |  |
  | 153 | 153 | msgstr "" |
  | 154 | 154 |  |
  | 155 |  | #: woocommerce-ac.php:8~~69~~ |
  |  | 155 | #: woocommerce-ac.php:885 |
  | 156 | 156 | msgid "" |
  | 157 | 157 | "Message to be displayed when the user chooses to opt out of cart tracking." |
  | 158 | 158 | msgstr "" |
  | 159 | 159 |  |
  | 160 |  | #: woocommerce-ac.php:8~~73~~ |
  |  | 160 | #: woocommerce-ac.php:889 |
  | 161 | 161 | msgid "" |
  | 162 | 162 | "<br>Message to be displayed when the user chooses to opt out of cart " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L164) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L164) |  |
  | 164 | 164 | msgstr "" |
  | 165 | 165 |  |
  | 166 |  | #: woocommerce-ac.php:8~~77~~ |
  |  | 166 | #: woocommerce-ac.php:893 |
  | 167 | 167 | msgid "Coupon Settings" |
  | 168 | 168 | msgstr "" |
  | 169 | 169 |  |
  | 170 |  | #: woocommerce-ac.php:8~~83~~ |
  |  | 170 | #: woocommerce-ac.php:899 |
  | 171 | 171 | msgid "Delete Coupons Automatically" |
  | 172 | 172 | msgstr "" |
  | 173 | 173 |  |
  | 174 |  | #: woocommerce-ac.php:~~887~~ |
  |  | 174 | #: woocommerce-ac.php:903 |
  | 175 | 175 | msgid "" |
  | 176 | 176 | "Enable this setting if you want to completely remove the expired and used " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L178) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L178) |  |
  | 178 | 178 | msgstr "" |
  | 179 | 179 |  |
  | 180 |  | #: woocommerce-ac.php:~~891~~ |
  |  | 180 | #: woocommerce-ac.php:907 |
  | 181 | 181 | msgid "Delete Coupons Manually" |
  | 182 | 182 | msgstr "" |
  | 183 | 183 |  |
  | 184 |  | #: woocommerce-ac.php:~~895~~ |
  |  | 184 | #: woocommerce-ac.php:911 |
  | 185 | 185 | msgid "" |
  | 186 | 186 | "If you want to completely remove the expired and used coupon code now then " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L188) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L188) |  |
  | 188 | 188 | msgstr "" |
  | 189 | 189 |  |
  | 190 |  | #: woocommerce-ac.php:9~~04~~ |
  |  | 190 | #: woocommerce-ac.php:920 |
  | 191 | 191 | msgid "Settings for abandoned cart recovery emails" |
  | 192 | 192 | msgstr "" |
  | 193 | 193 |  |
  | 194 |  | #: woocommerce-ac.php:9~~11~~ |
  |  | 194 | #: woocommerce-ac.php:927 |
  | 195 | 195 | msgid "\"From\" Name" |
  | 196 | 196 | msgstr "" |
  | 197 | 197 |  |
  | 198 |  | #: woocommerce-ac.php:9~~20~~ |
  |  | 198 | #: woocommerce-ac.php:936 |
  | 199 | 199 | msgid "\"From\" Address" |
  | 200 | 200 | msgstr "" |
  | 201 | 201 |  |
  | 202 |  | #: woocommerce-ac.php:9~~29~~ |
  |  | 202 | #: woocommerce-ac.php:945 |
  | 203 | 203 | msgid "Send Reply Emails to" |
  | 204 | 204 | msgstr "" |
  | 205 | 205 |  |
  | 206 |  | #: woocommerce-ac.php:9~~38~~ |
  |  | 206 | #: woocommerce-ac.php:954 |
  | 207 | 207 | msgid "UTM parameters to be added to all the links in reminder emails" |
  | 208 | 208 | msgstr "" |
  | 209 | 209 |  |
  | 210 |  | #: woocommerce-ac.php:9~~42~~ |
  |  | 210 | #: woocommerce-ac.php:958 |
  | 211 | 211 | msgid "" |
  | 212 | 212 | "UTM parameters that should be added to all the links in reminder emails." |
  | 213 | 213 | msgstr "" |
  | 214 | 214 |  |
  | 215 |  | #: woocommerce-ac.php:1~~084~~ |
  |  | 215 | #: woocommerce-ac.php:1100 |
  | 216 | 216 | msgid "" |
  | 217 | 217 | "Abandoned cart cut off time should be numeric and has to be greater than 0." |
  | 218 | 218 | msgstr "" |
  | 219 | 219 |  |
  | 220 |  | #: woocommerce-ac.php:11~~02~~ |
  |  | 220 | #: woocommerce-ac.php:1118 |
  | 221 | 221 | msgid "" |
  | 222 | 222 | "Automatically Delete Abandoned Orders after X days has to be greater than 0." |
  | 223 | 223 | msgstr "" |
  | 224 | 224 |  |
  | 225 |  | #: woocommerce-ac.php:13~~64~~ |
  |  | 225 | #: woocommerce-ac.php:1380 |
  | 226 | 226 | #: includes/admin/class-wcal-personal-data-export.php:137 |
  | 227 | 227 | msgid "Abandoned Carts" |
  | 228 | 228 | msgstr "" |
  | 229 | 229 |  |
  | 230 |  | #: woocommerce-ac.php:22~~20~~ |
  |  | 230 | #: woocommerce-ac.php:2256 |
  | 231 | 231 | msgid "Dashboard" |
  | 232 | 232 | msgstr "" |
  | 233 | 233 |  |
  | 234 |  | #: woocommerce-ac.php:22~~27~~ |
  |  | 234 | #: woocommerce-ac.php:2263 |
  | 235 | 235 | #: includes/classes/class-wcal-dashboard-report.php:161 |
  | 236 | 236 | msgid "Abandoned Orders" |
  | 237 | 237 | msgstr "" |
  | 238 | 238 |  |
  | 239 |  | #: woocommerce-ac.php:22~~34~~ |
  |  | 239 | #: woocommerce-ac.php:2270 |
  | 240 | 240 | msgid "Email Templates" |
  | 241 | 241 | msgstr "" |
  | 242 | 242 |  |
  | 243 |  | #: woocommerce-ac.php:22~~48~~ |
  |  | 243 | #: woocommerce-ac.php:2284 |
  | 244 | 244 | msgid "Recovered Orders" |
  | 245 | 245 | msgstr "" |
  | 246 | 246 |  |
  | 247 |  | #: woocommerce-ac.php:22~~55~~ |
  |  | 247 | #: woocommerce-ac.php:2291 |
  | 248 | 248 | msgid "Product Report" |
  | 249 | 249 | msgstr "" |
  | 250 | 250 |  |
  | 251 |  | #: woocommerce-ac.php:2~~297~~ |
  |  | 251 | #: woocommerce-ac.php:2333 |
  | 252 | 252 | #, php-format |
  | 253 | 253 | msgid "Please enter in decimal (%s) format without thousand separators." |
  | 254 | 254 | msgstr "" |
  | 255 | 255 |  |
  | 256 |  | #: woocommerce-ac.php:2~~299~~ |
  |  | 256 | #: woocommerce-ac.php:2335 |
  | 257 | 257 | #, php-format |
  | 258 | 258 | msgid "" |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L261) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L261) |  |
  | 261 | 261 | msgstr "" |
  | 262 | 262 |  |
  | 263 |  | #: woocommerce-ac.php:23~~00~~ |
  |  | 263 | #: woocommerce-ac.php:2336 |
  | 264 | 264 | msgid "Please enter in country code with two capital letters." |
  | 265 | 265 | msgstr "" |
  | 266 | 266 |  |
  | 267 |  | #: woocommerce-ac.php:23~~01~~ |
  |  | 267 | #: woocommerce-ac.php:2337 |
  | 268 | 268 | msgid "Please enter in a value less than the regular price." |
  | 269 | 269 | msgstr "" |
  | 270 | 270 |  |
  | 271 |  | #: woocommerce-ac.php:23~~05~~ |
  |  | 271 | #: woocommerce-ac.php:2341 |
  | 272 | 272 | msgid "Import" |
  | 273 | 273 | msgstr "" |
  | 274 | 274 |  |
  | 275 |  | #: woocommerce-ac.php:23~~06~~ |
  |  | 275 | #: woocommerce-ac.php:2342 |
  | 276 | 276 | msgid "Export" |
  | 277 | 277 | msgstr "" |
  | 278 | 278 |  |
  | 279 |  | #: woocommerce-ac.php:24~~01~~ |
  |  | 279 | #: woocommerce-ac.php:2437 |
  | 280 | 280 | msgctxt "enhanced select" |
  | 281 | 281 | msgid "One result is available, press enter to select it." |
  | 282 | 282 | msgstr "" |
  | 283 | 283 |  |
  | 284 |  | #: woocommerce-ac.php:24~~02~~ |
  |  | 284 | #: woocommerce-ac.php:2438 |
  | 285 | 285 | msgctxt "enhanced select" |
  | 286 | 286 | msgid "%qty% results are available, use up and down arrow keys to navigate." |
  | 287 | 287 | msgstr "" |
  | 288 | 288 |  |
  | 289 |  | #: woocommerce-ac.php:24~~03~~ |
  |  | 289 | #: woocommerce-ac.php:2439 |
  | 290 | 290 | msgctxt "enhanced select" |
  | 291 | 291 | msgid "No matches found" |
  | 292 | 292 | msgstr "" |
  | 293 | 293 |  |
  | 294 |  | #: woocommerce-ac.php:24~~04~~ |
  |  | 294 | #: woocommerce-ac.php:2440 |
  | 295 | 295 | msgctxt "enhanced select" |
  | 296 | 296 | msgid "Loading failed" |
  | 297 | 297 | msgstr "" |
  | 298 | 298 |  |
  | 299 |  | #: woocommerce-ac.php:24~~05~~ |
  |  | 299 | #: woocommerce-ac.php:2441 |
  | 300 | 300 | msgctxt "enhanced select" |
  | 301 | 301 | msgid "Please enter 1 or more characters" |
  | 302 | 302 | msgstr "" |
  | 303 | 303 |  |
  | 304 |  | #: woocommerce-ac.php:24~~06~~ |
  |  | 304 | #: woocommerce-ac.php:2442 |
  | 305 | 305 | msgctxt "enhanced select" |
  | 306 | 306 | msgid "Please enter %qty% or more characters" |
  | 307 | 307 | msgstr "" |
  | 308 | 308 |  |
  | 309 |  | #: woocommerce-ac.php:24~~07~~ |
  |  | 309 | #: woocommerce-ac.php:2443 |
  | 310 | 310 | msgctxt "enhanced select" |
  | 311 | 311 | msgid "Please delete 1 character" |
  | 312 | 312 | msgstr "" |
  | 313 | 313 |  |
  | 314 |  | #: woocommerce-ac.php:24~~08~~ |
  |  | 314 | #: woocommerce-ac.php:2444 |
  | 315 | 315 | msgctxt "enhanced select" |
  | 316 | 316 | msgid "Please delete %qty% characters" |
  | 317 | 317 | msgstr "" |
  | 318 | 318 |  |
  | 319 |  | #: woocommerce-ac.php:24~~09~~ |
  |  | 319 | #: woocommerce-ac.php:2445 |
  | 320 | 320 | msgctxt "enhanced select" |
  | 321 | 321 | msgid "You can only select 1 item" |
  | 322 | 322 | msgstr "" |
  | 323 | 323 |  |
  | 324 |  | #: woocommerce-ac.php:24~~10~~ |
  |  | 324 | #: woocommerce-ac.php:2446 |
  | 325 | 325 | msgctxt "enhanced select" |
  | 326 | 326 | msgid "You can only select %qty% items" |
  | 327 | 327 | msgstr "" |
  | 328 | 328 |  |
  | 329 |  | #: woocommerce-ac.php:24~~11~~ |
  |  | 329 | #: woocommerce-ac.php:2447 |
  | 330 | 330 | msgctxt "enhanced select" |
  | 331 | 331 | msgid "Loading more results&hellip;" |
  | 332 | 332 | msgstr "" |
  | 333 | 333 |  |
  | 334 |  | #: woocommerce-ac.php:24~~12~~ |
  |  | 334 | #: woocommerce-ac.php:2448 |
  | 335 | 335 | msgctxt "enhanced select" |
  | 336 | 336 | msgid "Searching&hellip;" |
  | 337 | 337 | msgstr "" |
  | 338 | 338 |  |
  | 339 |  | #: woocommerce-ac.php:25~~35~~ |
  |  | 339 | #: woocommerce-ac.php:2571 |
  | 340 | 340 | msgid "You do not have sufficient permissions to access this page." |
  | 341 | 341 | msgstr "" |
  | 342 | 342 |  |
  | 343 |  | #: woocommerce-ac.php:25~~39~~ |
  |  | 343 | #: woocommerce-ac.php:2575 |
  | 344 | 344 | msgid "WooCommerce - Abandon Cart Lite" |
  | 345 | 345 | msgstr "" |
  | 346 | 346 |  |
  | 347 |  | #: woocommerce-ac.php:26~~11~~ |
  |  | 347 | #: woocommerce-ac.php:2647 |
  | 348 | 348 | msgid "The Abandoned cart has been successfully deleted." |
  | 349 | 349 | msgstr "" |
  | 350 | 350 |  |
  | 351 |  | #: woocommerce-ac.php:26~~13~~ |
  |  | 351 | #: woocommerce-ac.php:2649 |
  | 352 | 352 | msgid "All Abandoned Carts have been successfully deleted." |
  | 353 | 353 | msgstr "" |
  | 354 | 354 |  |
  | 355 |  | #: woocommerce-ac.php:26~~15~~ |
  |  | 355 | #: woocommerce-ac.php:2651 |
  | 356 | 356 | msgid "All Visitor carts have been successfully deleted." |
  | 357 | 357 | msgstr "" |
  | 358 | 358 |  |
  | 359 |  | #: woocommerce-ac.php:26~~17~~ |
  |  | 359 | #: woocommerce-ac.php:2653 |
  | 360 | 360 | msgid "All Guest carts have been successfully deleted." |
  | 361 | 361 | msgstr "" |
  | 362 | 362 |  |
  | 363 |  | #: woocommerce-ac.php:26~~19~~ |
  |  | 363 | #: woocommerce-ac.php:2655 |
  | 364 | 364 | msgid "All Registered carts have been deleted." |
  | 365 | 365 | msgstr "" |
  | 366 | 366 |  |
  | 367 |  | #: woocommerce-ac.php:26~~30~~ |
  |  | 367 | #: woocommerce-ac.php:2666 |
  | 368 | 368 | msgid "The Template has been successfully deleted." |
  | 369 | 369 | msgstr "" |
  | 370 | 370 |  |
  | 371 |  | #: woocommerce-ac.php:2~~674~~ |
  |  | 371 | #: woocommerce-ac.php:2710 |
  | 372 | 372 | msgid "General Settings" |
  | 373 | 373 | msgstr "" |
  | 374 | 374 |  |
  | 375 |  | #: woocommerce-ac.php:2~~677~~ |
  |  | 375 | #: woocommerce-ac.php:2713 |
  | 376 | 376 | msgid "Email Sending Settings" |
  | 377 | 377 | msgstr "" |
  | 378 | 378 |  |
  | 379 |  | #: woocommerce-ac.php:2~~680~~ |
  |  | 379 | #: woocommerce-ac.php:2716 |
  | 380 | 380 | msgid "Add To Cart Popup Editor" |
  | 381 | 381 | msgstr "" |
  | 382 | 382 |  |
  | 383 |  | #: woocommerce-ac.php:2~~683~~ |
  |  | 383 | #: woocommerce-ac.php:2719 |
  | 384 | 384 | msgid "Facebook Messenger" |
  | 385 | 385 | msgstr "" |
  | 386 | 386 |  |
  | 387 |  | #: woocommerce-ac.php:2~~686~~ |
  |  | 387 | #: woocommerce-ac.php:2722 |
  | 388 | 388 | msgid "SMS" |
  | 389 | 389 | msgstr "" |
  | 390 | 390 |  |
  | 391 |  | #: woocommerce-ac.php:2~~689~~ includes/class-wcap-integrations.php:65 |
  |  | 391 | #: woocommerce-ac.php:2725 includes/class-wcap-integrations.php:65 |
  | 392 | 392 | msgid "Connectors" |
  | 393 | 393 | msgstr "" |
  | 394 | 394 |  |
  | 395 |  | #: woocommerce-ac.php:2~~697 woocommerce-ac.php:2707~~ |
  |  | 395 | #: woocommerce-ac.php:2733 woocommerce-ac.php:2743 |
  | 396 | 396 | msgid "" |
  | 397 | 397 | "Change settings for sending email notifications to Customers, to Admin etc." |
  | 398 | 398 | msgstr "" |
  | 399 | 399 |  |
  | 400 |  | #: woocommerce-ac.php:27~~34~~ |
  |  | 400 | #: woocommerce-ac.php:2770 |
  | 401 | 401 | msgid "" |
  | 402 | 402 | "The list below shows all Abandoned Carts which have remained in cart for a " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L404) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L404) |  |
  | 404 | 404 | msgstr "" |
  | 405 | 405 |  |
  | 406 |  | #: woocommerce-ac.php:2~~776~~ |
  |  | 406 | #: woocommerce-ac.php:2812 |
  | 407 | 407 | msgid "All " |
  | 408 | 408 | msgstr "" |
  | 409 | 409 |  |
  | 410 |  | #: woocommerce-ac.php:2~~781~~ |
  |  | 410 | #: woocommerce-ac.php:2817 |
  | 411 | 411 | #, php-format |
  | 412 | 412 | msgid "Registered %s" |
  | 413 | 413 | msgstr "" |
  | 414 | 414 |  |
  | 415 |  | #: woocommerce-ac.php:2~~787~~ |
  |  | 415 | #: woocommerce-ac.php:2823 |
  | 416 | 416 | #, php-format |
  | 417 | 417 | msgid "Guest %s" |
  | 418 | 418 | msgstr "" |
  | 419 | 419 |  |
  | 420 |  | #: woocommerce-ac.php:2~~793~~ |
  |  | 420 | #: woocommerce-ac.php:2829 |
  | 421 | 421 | msgid "Carts without Customer Details" |
  | 422 | 422 | msgstr "" |
  | 423 | 423 |  |
  | 424 |  | #: woocommerce-ac.php:28~~14~~ |
  |  | 424 | #: woocommerce-ac.php:2850 |
  | 425 | 425 | msgid "" |
  | 426 | 426 | "Add email templates at different intervals to maximize the possibility of " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L428) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L428) |  |
  | 428 | 428 | msgstr "" |
  | 429 | 429 |  |
  | 430 |  | #: woocommerce-ac.php:~~2970~~ |
  |  | 430 | #: woocommerce-ac.php:3006 |
  | 431 | 431 | msgid "" |
  | 432 | 432 | "The Email Template has been successfully added. In order to start sending " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L434) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L434) |  |
  | 434 | 434 | msgstr "" |
  | 435 | 435 |  |
  | 436 |  | #: woocommerce-ac.php:~~2980~~ |
  |  | 436 | #: woocommerce-ac.php:3016 |
  | 437 | 437 | msgid "" |
  | 438 | 438 | "There was a problem adding the email template. Please contact the plugin " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L441) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L441) |  |
  | 441 | 441 | msgstr "" |
  | 442 | 442 |  |
  | 443 |  | #: woocommerce-ac.php:~~2992~~ |
  |  | 443 | #: woocommerce-ac.php:3028 |
  | 444 | 444 | msgid "The Email Template has been successfully updated." |
  | 445 | 445 | msgstr "" |
  | 446 | 446 |  |
  | 447 |  | #: woocommerce-ac.php:30~~02~~ |
  |  | 447 | #: woocommerce-ac.php:3038 |
  | 448 | 448 | msgid "" |
  | 449 | 449 | "There was a problem updating the email template. Please contact the plugin " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L452) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L452) |  |
  | 452 | 452 | msgstr "" |
  | 453 | 453 |  |
  | 454 |  | #: woocommerce-ac.php:30~~11~~ |
  |  | 454 | #: woocommerce-ac.php:3047 |
  | 455 | 455 | msgid "Add New Template" |
  | 456 | 456 | msgstr "" |
  | 457 | 457 |  |
  | 458 |  | #: woocommerce-ac.php:3~~083~~ |
  |  | 458 | #: woocommerce-ac.php:3119 |
  | 459 | 459 | msgid "" |
  | 460 | 460 | "The Report below shows how many Abandoned Carts we were able to recover for " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L462) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L462) |  |
  | 462 | 462 | msgstr "" |
  | 463 | 463 |  |
  | 464 |  | #: woocommerce-ac.php:31~~34~~ |
  |  | 464 | #: woocommerce-ac.php:3170 |
  | 465 | 465 | msgid "Start Date:" |
  | 466 | 466 | msgstr "" |
  | 467 | 467 |  |
  | 468 |  | #: woocommerce-ac.php:31~~36~~ |
  |  | 468 | #: woocommerce-ac.php:3172 |
  | 469 | 469 | msgid "End Date:" |
  | 470 | 470 | msgstr "" |
  | 471 | 471 |  |
  | 472 |  | #: woocommerce-ac.php:31~~38~~ |
  |  | 472 | #: woocommerce-ac.php:3174 |
  | 473 | 473 | #: includes/classes/class-wcal-dashboard-report.php:319 |
  | 474 | 474 | msgid "Go" |
  | 475 | 475 | msgstr "" |
  | 476 | 476 |  |
  | 477 |  | #: woocommerce-ac.php:31~~56~~ |
  |  | 477 | #: woocommerce-ac.php:3192 |
  | 478 | 478 | #, php-format |
  | 479 | 479 | msgid "" |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L483) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L483) |  |
  | 483 | 483 | msgstr "" |
  | 484 | 484 |  |
  | 485 |  | #: woocommerce-ac.php:3~~181~~ |
  |  | 485 | #: woocommerce-ac.php:3217 |
  | 486 | 486 | #, php-format |
  | 487 | 487 | msgid "Abandoned Order #%s Details" |
  | 488 | 488 | msgstr "" |
  | 489 | 489 |  |
  | 490 |  | #: woocommerce-ac.php:3~~185 woocommerce-ac.php:4035 woocommerce-ac.php:4070~~ |
  | 491 |  | #: cron/class-wcal-cron.php:28~~5~~ |
  |  | 490 | #: woocommerce-ac.php:3221 woocommerce-ac.php:4071 woocommerce-ac.php:4106 |
  |  | 491 | #: cron/class-wcal-cron.php:287 |
  | 492 | 492 | msgid "Item" |
  | 493 | 493 | msgstr "" |
  | 494 | 494 |  |
  | 495 |  | #: woocommerce-ac.php:3~~186 woocommerce-ac.php:4036 woocommerce-ac.php:4071~~ |
  | 496 |  | #: cron/class-wcal-cron.php:28~~6~~ |
  |  | 495 | #: woocommerce-ac.php:3222 woocommerce-ac.php:4072 woocommerce-ac.php:4107 |
  |  | 496 | #: cron/class-wcal-cron.php:288 |
  | 497 | 497 | msgid "Name" |
  | 498 | 498 | msgstr "" |
  | 499 | 499 |  |
  | 500 |  | #: woocommerce-ac.php:3~~187 woocommerce-ac.php:4037 woocommerce-ac.php:4072~~ |
  | 501 |  | #: cron/class-wcal-cron.php:28~~7~~ |
  |  | 500 | #: woocommerce-ac.php:3223 woocommerce-ac.php:4073 woocommerce-ac.php:4108 |
  |  | 501 | #: cron/class-wcal-cron.php:289 |
  | 502 | 502 | msgid "Quantity" |
  | 503 | 503 | msgstr "" |
  | 504 | 504 |  |
  | 505 |  | #: woocommerce-ac.php:3~~188 woocommerce-ac.php:4039 woocommerce-ac.php:4074~~ |
  | 506 |  | #: cron/class-wcal-cron.php:2~~89~~ |
  |  | 505 | #: woocommerce-ac.php:3224 woocommerce-ac.php:4075 woocommerce-ac.php:4110 |
  |  | 506 | #: cron/class-wcal-cron.php:291 |
  | 507 | 507 | msgid "Line Subtotal" |
  | 508 | 508 | msgstr "" |
  | 509 | 509 |  |
  | 510 |  | #: woocommerce-ac.php:3~~189~~ |
  |  | 510 | #: woocommerce-ac.php:3225 |
  | 511 | 511 | msgid "Line Total" |
  | 512 | 512 | msgstr "" |
  | 513 | 513 |  |
  | 514 |  | #: woocommerce-ac.php:34~~14~~ |
  | 515 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:47~~1~~ |
  |  | 514 | #: woocommerce-ac.php:3450 |
  |  | 515 | #: includes/admin/class-wcal-abandoned-cart-details.php:475 |
  | 516 | 516 | msgid "Customer Details" |
  | 517 | 517 | msgstr "" |
  | 518 | 518 |  |
  | 519 |  | #: woocommerce-ac.php:34~~18~~ |
  |  | 519 | #: woocommerce-ac.php:3454 |
  | 520 | 520 | msgid "Billing Details" |
  | 521 | 521 | msgstr "" |
  | 522 | 522 |  |
  | 523 |  | #: woocommerce-ac.php:34~~19~~ |
  |  | 523 | #: woocommerce-ac.php:3455 |
  | 524 | 524 | msgid "Name:" |
  | 525 | 525 | msgstr "" |
  | 526 | 526 |  |
  | 527 |  | #: woocommerce-ac.php:34~~22 woocommerce-ac.php:3443~~ |
  |  | 527 | #: woocommerce-ac.php:3458 woocommerce-ac.php:3479 |
  | 528 | 528 | msgid "Address:" |
  | 529 | 529 | msgstr "" |
  | 530 | 530 |  |
  | 531 |  | #: woocommerce-ac.php:34~~33~~ |
  |  | 531 | #: woocommerce-ac.php:3469 |
  | 532 | 532 | msgid "Email:" |
  | 533 | 533 | msgstr "" |
  | 534 | 534 |  |
  | 535 |  | #: woocommerce-ac.php:34~~37~~ |
  |  | 535 | #: woocommerce-ac.php:3473 |
  | 536 | 536 | msgid "Phone:" |
  | 537 | 537 | msgstr "" |
  | 538 | 538 |  |
  | 539 |  | #: woocommerce-ac.php:34~~42~~ |
  |  | 539 | #: woocommerce-ac.php:3478 |
  | 540 | 540 | msgid "Shipping Details" |
  | 541 | 541 | msgstr "" |
  | 542 | 542 |  |
  | 543 |  | #: woocommerce-ac.php:34~~52~~ |
  |  | 543 | #: woocommerce-ac.php:3488 |
  | 544 | 544 | msgid "Shipping Address same as Billing Address" |
  | 545 | 545 | msgstr "" |
  | 546 | 546 |  |
  | 547 |  | #: woocommerce-ac.php:3~~465~~ |
  |  | 547 | #: woocommerce-ac.php:3501 |
  | 548 | 548 | msgid "Shipping Charges" |
  | 549 | 549 | msgstr "" |
  | 550 | 550 |  |
  | 551 |  | #: woocommerce-ac.php:35~~49~~ |
  |  | 551 | #: woocommerce-ac.php:3585 |
  | 552 | 552 | msgid "Template Name:" |
  | 553 | 553 | msgstr "" |
  | 554 | 554 |  |
  | 555 |  | #: woocommerce-ac.php:35~~59~~ |
  |  | 555 | #: woocommerce-ac.php:3595 |
  | 556 | 556 | msgid "Enter a template name for reference" |
  | 557 | 557 | msgstr "" |
  | 558 | 558 |  |
  | 559 |  | #: woocommerce-ac.php:3~~565~~ |
  |  | 559 | #: woocommerce-ac.php:3601 |
  | 560 | 560 | msgid "Subject:" |
  | 561 | 561 | msgstr "" |
  | 562 | 562 |  |
  | 563 |  | #: woocommerce-ac.php:3~~575~~ |
  |  | 563 | #: woocommerce-ac.php:3611 |
  | 564 | 564 | msgid "Enter the subject that should appear in the email sent" |
  | 565 | 565 | msgstr "" |
  | 566 | 566 |  |
  | 567 |  | #: woocommerce-ac.php:3~~581~~ |
  |  | 567 | #: woocommerce-ac.php:3617 |
  | 568 | 568 | msgid "Email Body:" |
  | 569 | 569 | msgstr "" |
  | 570 | 570 |  |
  | 571 |  | #: woocommerce-ac.php:36~~08~~ |
  |  | 571 | #: woocommerce-ac.php:3644 |
  | 572 | 572 | msgid "Message to be sent in the reminder email." |
  | 573 | 573 | msgstr "" |
  | 574 | 574 |  |
  | 575 |  | #: woocommerce-ac.php:36~~35~~ |
  |  | 575 | #: woocommerce-ac.php:3671 |
  | 576 | 576 | msgid "Use WooCommerce Template Style:" |
  | 577 | 577 | msgstr "" |
  | 578 | 578 |  |
  | 579 |  | #: woocommerce-ac.php:36~~51~~ |
  |  | 579 | #: woocommerce-ac.php:3687 |
  | 580 | 580 | msgid "" |
  | 581 | 581 | "Use WooCommerce default style template for abandoned cart reminder emails." |
  | 582 | 582 | msgstr "" |
  | 583 | 583 |  |
  | 584 |  | #: woocommerce-ac.php:36~~58~~ |
  |  | 584 | #: woocommerce-ac.php:3694 |
  | 585 | 585 | msgid "Email Template Header Text: " |
  | 586 | 586 | msgstr "" |
  | 587 | 587 |  |
  | 588 |  | #: woocommerce-ac.php:3~~673~~ |
  |  | 588 | #: woocommerce-ac.php:3709 |
  | 589 | 589 | msgid "" |
  | 590 | 590 | "Enter the header which will appear in the abandoned WooCommerce email sent. " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L593) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L593) |  |
  | 593 | 593 | msgstr "" |
  | 594 | 594 |  |
  | 595 |  | #: woocommerce-ac.php:3~~679~~ |
  |  | 595 | #: woocommerce-ac.php:3715 |
  | 596 | 596 | msgid "Send this email:" |
  | 597 | 597 | msgstr "" |
  | 598 | 598 |  |
  | 599 |  | #: woocommerce-ac.php:37~~21~~ |
  |  | 599 | #: woocommerce-ac.php:3757 |
  | 600 | 600 | msgid "after cart is abandoned." |
  | 601 | 601 | msgstr "" |
  | 602 | 602 |  |
  | 603 |  | #: woocommerce-ac.php:37~~28~~ |
  |  | 603 | #: woocommerce-ac.php:3764 |
  | 604 | 604 | msgid "Send a test email to:" |
  | 605 | 605 | msgstr "" |
  | 606 | 606 |  |
  | 607 |  | #: woocommerce-ac.php:37~~37~~ |
  |  | 607 | #: woocommerce-ac.php:3773 |
  | 608 | 608 | msgid "Enter the email id to which the test email needs to be sent." |
  | 609 | 609 | msgstr "" |
  | 610 | 610 |  |
  | 611 |  | #: woocommerce-ac.php:37~~51~~ |
  |  | 611 | #: woocommerce-ac.php:3787 |
  | 612 | 612 | msgid "Update Changes" |
  | 613 | 613 | msgstr "" |
  | 614 | 614 |  |
  | 615 |  | #: woocommerce-ac.php:37~~55~~ |
  |  | 615 | #: woocommerce-ac.php:3791 |
  | 616 | 616 | #: includes/admin/class-wcap-add-cart-popup-modal.php:84 |
  | 617 | 617 | #: includes/admin/class-wcap-pro-settings.php:66 |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L620) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L620) |  |
  | 620 | 620 | msgstr "" |
  | 621 | 621 |  |
  | 622 |  | #: woocommerce-ac.php:3~~777~~ |
  |  | 622 | #: woocommerce-ac.php:3813 |
  | 623 | 623 | msgid "" |
  | 624 | 624 | "If you love <strong>Abandoned Cart Lite for WooCommerce</strong>, then " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L629) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L629) |  |
  | 629 | 629 | msgstr "" |
  | 630 | 630 |  |
  | 631 |  | #: woocommerce-ac.php:38~~29~~ |
  |  | 631 | #: woocommerce-ac.php:3865 |
  | 632 | 632 | msgid "Please enter a valid email." |
  | 633 | 633 | msgstr "" |
  | 634 | 634 |  |
  | 635 |  | #: woocommerce-ac.php:40~~33 woocommerce-ac.php:4067~~ |
  | 636 |  | #: cron/class-wcal-cron.php:29~~6 cron/class-wcal-cron.php:307~~ |
  |  | 635 | #: woocommerce-ac.php:4069 woocommerce-ac.php:4103 |
  |  | 636 | #: cron/class-wcal-cron.php:298 cron/class-wcal-cron.php:309 |
  | 637 | 637 | msgid "Your Shopping Cart" |
  | 638 | 638 | msgstr "" |
  | 639 | 639 |  |
  | 640 |  | #: woocommerce-ac.php:40~~38 woocommerce-ac.php:4073~~ |
  | 641 |  | #: cron/class-wcal-cron.php:2~~88~~ |
  |  | 640 | #: woocommerce-ac.php:4074 woocommerce-ac.php:4109 |
  |  | 641 | #: cron/class-wcal-cron.php:290 |
  | 642 | 642 | msgid "Price" |
  | 643 | 643 | msgstr "" |
  | 644 | 644 |  |
  | 645 |  | #: woocommerce-ac.php:40~~43 woocommerce-ac.php:4078~~ |
  |  | 645 | #: woocommerce-ac.php:4079 woocommerce-ac.php:4114 |
  | 646 | 646 | msgid "Men's Formal Shoes" |
  | 647 | 647 | msgstr "" |
  | 648 | 648 |  |
  | 649 |  | #: woocommerce-ac.php:40~~50 woocommerce-ac.php:4085~~ |
  |  | 649 | #: woocommerce-ac.php:4086 woocommerce-ac.php:4121 |
  | 650 | 650 | msgid "Woman's Hand Bags" |
  | 651 | 651 | msgstr "" |
  | 652 | 652 |  |
  | 653 |  | #: woocommerce-ac.php:40~~59 woocommerce-ac.php:4094~~ |
  | 654 |  | #: cron/class-wcal-cron.php:41~~7~~ |
  |  | 653 | #: woocommerce-ac.php:4095 woocommerce-ac.php:4130 |
  |  | 654 | #: cron/class-wcal-cron.php:419 |
  | 655 | 655 | msgid "Cart Total:" |
  | 656 | 656 | msgstr "" |
  | 657 | 657 |  |
  | 658 |  | #: woocommerce-ac.php:43~~05~~ |
  |  | 658 | #: woocommerce-ac.php:4341 |
  | 659 | 659 | #, php-format |
  | 660 | 660 | msgid "%1$s: %2$d" |
  | 661 | 661 | msgstr "" |
  | 662 | 662 |  |
  | 663 |  | #: woocommerce-ac.php:43~~15~~ |
  |  | 663 | #: woocommerce-ac.php:4351 |
  | 664 | 664 | #: includes/classes/class-wcal-abandoned-orders-table.php:183 |
  | 665 | 665 | #: includes/classes/class-wcal-abandoned-orders-table.php:785 |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L669) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L669) |  |
  | 669 | 669 | msgstr "" |
  | 670 | 670 |  |
  | 671 |  | #: woocommerce-ac.php:44~~46~~ |
  |  | 671 | #: woocommerce-ac.php:4482 |
  | 672 | 672 | msgid "Once Every Fifteen Minutes" |
  | 673 | 673 | msgstr "" |
  | 674 | 674 |  |
  | 675 |  | #: woocommerce-ac.php:44~~51~~ |
  |  | 675 | #: woocommerce-ac.php:4487 |
  | 676 | 676 | msgid "Once Every Fifteen Days" |
  | 677 | 677 | msgstr "" |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L681) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L681) |  |
  | 681 | 681 | msgstr "" |
  | 682 | 682 |  |
  | 683 |  | #: cron/class-wcal-cron.php:33~~3 cron/class-wcal-cron.php:365~~ |
  |  | 683 | #: cron/class-wcal-cron.php:335 cron/class-wcal-cron.php:367 |
  | 684 | 684 | msgid "SKU: " |
  | 685 | 685 | msgstr "" |
  | 686 | 686 |  |
  | 687 |  | #: cron/class-wcal-cron.php:4~~29~~ |
  |  | 687 | #: cron/class-wcal-cron.php:431 |
  | 688 | 688 | msgid "Product no longer exists" |
  | 689 | 689 | msgstr "" |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L796) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L796) |  |
  | 796 | 796 | msgstr "" |
  | 797 | 797 |  |
  | 798 |  | #: includes/class-wcal-common.php:6~~79~~ |
  |  | 798 | #: includes/class-wcal-common.php:680 |
  | 799 | 799 | msgid "Database Updated Successfully" |
  | 800 | 800 | msgstr "" |
  | 801 | 801 |  |
  | 802 |  | #: includes/class-wcal-common.php:69~~4~~ |
  |  | 802 | #: includes/class-wcal-common.php:695 |
  | 803 | 803 | msgid "Database Update Failed. Please try again after sometime" |
  | 804 | 804 | msgstr "" |
  | 805 | 805 |  |
  | 806 |  | #: includes/class-wcal-common.php:85~~4~~ |
  |  | 806 | #: includes/class-wcal-common.php:855 |
  | 807 | 807 | msgid "This product no longer exists" |
  | 808 | 808 | msgstr "" |
  | 809 | 809 |  |
  | 810 |  | #: includes/class-wcal-common.php:127~~3 includes/class-wcal-common.php:1289~~ |
  | 811 |  | #: includes/class-wcal-common.php:131~~2~~ |
  |  | 810 | #: includes/class-wcal-common.php:1274 includes/class-wcal-common.php:1290 |
  |  | 811 | #: includes/class-wcal-common.php:1313 |
  | 812 | 812 | msgid "Discount code applied successfully." |
  | 813 | 813 | msgstr "" |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L873) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L873) |  |
  | 873 | 873 | msgstr "" |
  | 874 | 874 |  |
  | 875 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:45~~4~~ |
  |  | 875 | #: includes/admin/class-wcal-abandoned-cart-details.php:458 |
  | 876 | 876 | #: includes/templates/rules/html-rules-add-row.php:21 |
  | 877 | 877 | #: includes/templates/rules/html-rules-edit-row.php:25 |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L879) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L879) |  |
  | 879 | 879 | msgstr "" |
  | 880 | 880 |  |
  | 881 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:45~~4~~ |
  |  | 881 | #: includes/admin/class-wcal-abandoned-cart-details.php:458 |
  | 882 | 882 | #, php-format |
  | 883 | 883 | msgid "Recovered on %s" |
  | 884 | 884 | msgstr "" |
  | 885 | 885 |  |
  | 886 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:47~~0~~ |
  |  | 886 | #: includes/admin/class-wcal-abandoned-cart-details.php:474 |
  | 887 | 887 | #: includes/admin/class-wcal-personal-data-export.php:193 |
  | 888 | 888 | #: includes/admin/class-wcal-personal-data-export.php:208 |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L892) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L892) |  |
  | 892 | 892 | msgstr "" |
  | 893 | 893 |  |
  | 894 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:47~~2~~ |
  |  | 894 | #: includes/admin/class-wcal-abandoned-cart-details.php:476 |
  | 895 | 895 | #: includes/classes/class-wcal-abandoned-orders-table.php:109 |
  | 896 | 896 | #: includes/classes/class-wcal-recover-orders-table.php:136 |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L898) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L898) |  |
  | 898 | 898 | msgstr "" |
  | 899 | 899 |  |
  | 900 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:47~~3~~ |
  |  | 900 | #: includes/admin/class-wcal-abandoned-cart-details.php:477 |
  | 901 | 901 | #: includes/admin/class-wcal-personal-data-export.php:187 |
  | 902 | 902 | #: includes/admin/class-wcal-personal-data-export.php:203 |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L905) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L905) |  |
  | 905 | 905 | msgstr "" |
  | 906 | 906 |  |
  | 907 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:4~~88~~ |
  |  | 907 | #: includes/admin/class-wcal-abandoned-cart-details.php:492 |
  | 908 | 908 | msgid "Item Name" |
  | 909 | 909 | msgstr "" |
  | 910 | 910 |  |
  | 911 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:4~~89~~ |
  |  | 911 | #: includes/admin/class-wcal-abandoned-cart-details.php:493 |
  | 912 | 912 | msgid "Item Cost" |
  | 913 | 913 | msgstr "" |
  | 914 | 914 |  |
  | 915 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:49~~0~~ |
  |  | 915 | #: includes/admin/class-wcal-abandoned-cart-details.php:494 |
  | 916 | 916 | msgid "Item Quantity" |
  | 917 | 917 | msgstr "" |
  | 918 | 918 |  |
  | 919 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:5~~09~~ |
  |  | 919 | #: includes/admin/class-wcal-abandoned-cart-details.php:513 |
  | 920 | 920 | msgid "Close" |
  | 921 | 921 | msgstr "" |
  | 922 | 922 |  |
  | 923 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:74~~2~~ |
  |  | 923 | #: includes/admin/class-wcal-abandoned-cart-details.php:746 |
  | 924 | 924 | msgid "Tax: " |
  | 925 | 925 | msgstr "" |
  | 926 | 926 |  |
  | 927 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:7~~48~~ |
  |  | 927 | #: includes/admin/class-wcal-abandoned-cart-details.php:752 |
  | 928 | 928 | msgid "includes Tax: " |
  | 929 | 929 | msgstr "" |
  | 930 | 930 |  |
  | 931 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:7~~69~~ |
  |  | 931 | #: includes/admin/class-wcal-abandoned-cart-details.php:773 |
  | 932 | 932 | msgid "Product has been deleted" |
  | 933 | 933 | msgstr "" |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L1875) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L1875) |  |
  | 1875 | 1875 | msgstr "" |
  | 1876 | 1876 |  |
  | 1877 |  | #: includes/frontend/class-wcal-checkout-process.php:21~~6~~ |
  |  | 1877 | #: includes/frontend/class-wcal-checkout-process.php:218 |
  | 1878 | 1878 | msgid "This order was abandoned & subsequently recovered." |
  | 1879 | 1879 | msgstr "" |
  | 1880 | 1880 |  |
  | 1881 |  | #: includes/frontend/class-wcal-checkout-process.php:32~~4~~ |
  | 1882 |  | #: includes/frontend/class-wcal-checkout-process.php:3~~26~~ |
  |  | 1881 | #: includes/frontend/class-wcal-checkout-process.php:329 |
  |  | 1882 | #: includes/frontend/class-wcal-checkout-process.php:331 |
  | 1883 | 1883 | msgid "New Customer Order - Recovered" |
  | 1884 | 1884 | msgstr "" |
* ## [woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot](/changeset/2922242/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot "Show the changeset 2922242 restricted to woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot")

  | [r2916178](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L9 "Show revision 2916178 of this file in browser") | [r2922242](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L9 "Show revision 2922242 of this file in browser") |  |
  | --- | --- | --- |
  | 9 | 9 | "Project-Id-Version: PACKAGE VERSION\n" |
  | 10 | 10 | "Report-Msgid-Bugs-To: \n" |
  | 11 |  | "POT-Creation-Date: 2023-0~~5-22 17:07~~+0530\n" |
  |  | 11 | "POT-Creation-Date: 2023-06-06 15:53+0530\n" |
  | 12 | 12 | "PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n" |
  | 13 | 13 | "Last-Translator: FULL NAME <EMAIL@ADDRESS>\n" |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L18) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L18) |  |
  | 18 | 18 | "Content-Transfer-Encoding: 8bit\n" |
  | 19 | 19 |  |
  | 20 |  | #: class-wcal-update.php:~~502~~ |
  |  | 20 | #: class-wcal-update.php:498 |
  | 21 | 21 | msgid "" |
  | 22 | 22 | "There was an error creating the guest cart table for Abandoned Cart Lite for " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L25) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L25) |  |
  | 25 | 25 | msgstr "" |
  | 26 | 26 |  |
  | 27 |  | #: woocommerce-ac.php:3~~17 woocommerce-ac.php:2241~~ |
  |  | 27 | #: woocommerce-ac.php:320 woocommerce-ac.php:2277 |
  | 28 | 28 | #: includes/connectors/class-wcap-display-connectors.php:69 |
  | 29 | 29 | msgid "Settings" |
  | 30 | 30 | msgstr "" |
  | 31 | 31 |  |
  | 32 |  | #: woocommerce-ac.php:34~~6~~ |
  |  | 32 | #: woocommerce-ac.php:349 |
  | 33 | 33 | msgid "Emails are not being sent to customers." |
  | 34 | 34 | msgstr "" |
  | 35 | 35 |  |
  | 36 |  | #: woocommerce-ac.php:35~~2~~ |
  |  | 36 | #: woocommerce-ac.php:355 |
  | 37 | 37 | msgid "Capturing of cart and other information was not satisfactory." |
  | 38 | 38 | msgstr "" |
  | 39 | 39 |  |
  | 40 |  | #: woocommerce-ac.php:3~~58~~ |
  |  | 40 | #: woocommerce-ac.php:361 |
  | 41 | 41 | msgid "I cannot see abandoned cart reminder emails records." |
  | 42 | 42 | msgstr "" |
  | 43 | 43 |  |
  | 44 |  | #: woocommerce-ac.php:36~~4~~ |
  |  | 44 | #: woocommerce-ac.php:367 |
  | 45 | 45 | msgid "I want to upgrade the plugin to the PRO version." |
  | 46 | 46 | msgstr "" |
  | 47 | 47 |  |
  | 48 |  | #: woocommerce-ac.php:4~~87~~ |
  |  | 48 | #: woocommerce-ac.php:490 |
  | 49 | 49 | msgid "HTML Email Template" |
  | 50 | 50 | msgstr "" |
  | 51 | 51 |  |
  | 52 |  | #: woocommerce-ac.php:49~~3~~ |
  |  | 52 | #: woocommerce-ac.php:496 |
  | 53 | 53 | msgid "Abandoned cart Email Template" |
  | 54 | 54 | msgstr "" |
  | 55 | 55 |  |
  | 56 |  | #: woocommerce-ac.php:7~~74~~ |
  |  | 56 | #: woocommerce-ac.php:790 |
  | 57 | 57 | msgid "Cart Abandonment Settings" |
  | 58 | 58 | msgstr "" |
  | 59 | 59 |  |
  | 60 |  | #: woocommerce-ac.php:7~~81~~ |
  |  | 60 | #: woocommerce-ac.php:797 |
  | 61 | 61 | msgid "Enable abandoned cart emails" |
  | 62 | 62 | msgstr "" |
  | 63 | 63 |  |
  | 64 |  | #: woocommerce-ac.php:~~785~~ |
  |  | 64 | #: woocommerce-ac.php:801 |
  | 65 | 65 | msgid "Yes, enable the abandoned cart emails." |
  | 66 | 66 | msgstr "" |
  | 67 | 67 |  |
  | 68 |  | #: woocommerce-ac.php:~~790~~ |
  |  | 68 | #: woocommerce-ac.php:806 |
  | 69 | 69 | msgid "Cart abandoned cut-off time" |
  | 70 | 70 | msgstr "" |
  | 71 | 71 |  |
  | 72 |  | #: woocommerce-ac.php:~~794~~ |
  |  | 72 | #: woocommerce-ac.php:810 |
  | 73 | 73 | msgid "" |
  | 74 | 74 | "Consider cart abandoned after X minutes of item being added to cart & order " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L76) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L76) |  |
  | 76 | 76 | msgstr "" |
  | 77 | 77 |  |
  | 78 |  | #: woocommerce-ac.php:~~799~~ |
  |  | 78 | #: woocommerce-ac.php:815 |
  | 79 | 79 | msgid "Automatically Delete Abandoned Orders after X days" |
  | 80 | 80 | msgstr "" |
  | 81 | 81 |  |
  | 82 |  | #: woocommerce-ac.php:8~~03~~ |
  |  | 82 | #: woocommerce-ac.php:819 |
  | 83 | 83 | msgid "Automatically delete abandoned cart orders after X days." |
  | 84 | 84 | msgstr "" |
  | 85 | 85 |  |
  | 86 |  | #: woocommerce-ac.php:8~~08~~ |
  |  | 86 | #: woocommerce-ac.php:824 |
  | 87 | 87 | msgid "Email admin On Order Recovery" |
  | 88 | 88 | msgstr "" |
  | 89 | 89 |  |
  | 90 |  | #: woocommerce-ac.php:8~~12~~ |
  |  | 90 | #: woocommerce-ac.php:828 |
  | 91 | 91 | msgid "Sends email to Admin if an Abandoned Cart Order is recovered." |
  | 92 | 92 | msgstr "" |
  | 93 | 93 |  |
  | 94 |  | #: woocommerce-ac.php:8~~17~~ |
  |  | 94 | #: woocommerce-ac.php:833 |
  | 95 | 95 | msgid "Start tracking from Cart Page" |
  | 96 | 96 | msgstr "" |
  | 97 | 97 |  |
  | 98 |  | #: woocommerce-ac.php:8~~21~~ |
  |  | 98 | #: woocommerce-ac.php:837 |
  | 99 | 99 | msgid "" |
  | 100 | 100 | "Enable tracking of abandoned products & carts even if customer does not " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L104) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L104) |  |
  | 104 | 104 | msgstr "" |
  | 105 | 105 |  |
  | 106 |  | #: woocommerce-ac.php:8~~26~~ |
  |  | 106 | #: woocommerce-ac.php:842 |
  | 107 | 107 | msgid "GDPR Settings" |
  | 108 | 108 | msgstr "" |
  | 109 | 109 |  |
  | 110 |  | #: woocommerce-ac.php:8~~33~~ |
  |  | 110 | #: woocommerce-ac.php:849 |
  | 111 | 111 | msgid "Enable GDPR Notice" |
  | 112 | 112 | msgstr "" |
  | 113 | 113 |  |
  | 114 |  | #: woocommerce-ac.php:8~~37~~ |
  |  | 114 | #: woocommerce-ac.php:853 |
  | 115 | 115 | msgid "" |
  | 116 | 116 | "Enable this setting to display a notice informing customers that their email " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L118) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L118) |  |
  | 118 | 118 | msgstr "" |
  | 119 | 119 |  |
  | 120 |  | #: woocommerce-ac.php:8~~42~~ |
  |  | 120 | #: woocommerce-ac.php:858 |
  | 121 | 121 | msgid "Message to be displayed for Guest users when tracking their carts" |
  | 122 | 122 | msgstr "" |
  | 123 | 123 |  |
  | 124 |  | #: woocommerce-ac.php:8~~46~~ |
  |  | 124 | #: woocommerce-ac.php:862 |
  | 125 | 125 | msgid "" |
  | 126 | 126 | "<br>In compliance with GDPR, add a message on the Checkout page to inform " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L130) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L130) |  |
  | 130 | 130 | msgstr "" |
  | 131 | 131 |  |
  | 132 |  | #: woocommerce-ac.php:8~~51~~ |
  |  | 132 | #: woocommerce-ac.php:867 |
  | 133 | 133 | msgid "Message to be displayed for registered users when tracking their carts." |
  | 134 | 134 | msgstr "" |
  | 135 | 135 |  |
  | 136 |  | #: woocommerce-ac.php:8~~55~~ |
  |  | 136 | #: woocommerce-ac.php:871 |
  | 137 | 137 | msgid "" |
  | 138 | 138 | "<br>In compliance with GDPR, add a message on the Shop & Product pages to " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L141) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L141) |  |
  | 141 | 141 | msgstr "" |
  | 142 | 142 |  |
  | 143 |  | #: woocommerce-ac.php:8~~60~~ |
  |  | 143 | #: woocommerce-ac.php:876 |
  | 144 | 144 | msgid "Allow the visitor to opt out of cart tracking." |
  | 145 | 145 | msgstr "" |
  | 146 | 146 |  |
  | 147 |  | #: woocommerce-ac.php:8~~64~~ |
  |  | 147 | #: woocommerce-ac.php:880 |
  | 148 | 148 | msgid "" |
  | 149 | 149 | "<br>In compliance with GDPR, allow the site visitor (guests & registered " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L152) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L152) |  |
  | 152 | 152 | msgstr "" |
  | 153 | 153 |  |
  | 154 |  | #: woocommerce-ac.php:8~~69~~ |
  |  | 154 | #: woocommerce-ac.php:885 |
  | 155 | 155 | msgid "" |
  | 156 | 156 | "Message to be displayed when the user chooses to opt out of cart tracking." |
  | 157 | 157 | msgstr "" |
  | 158 | 158 |  |
  | 159 |  | #: woocommerce-ac.php:8~~73~~ |
  |  | 159 | #: woocommerce-ac.php:889 |
  | 160 | 160 | msgid "" |
  | 161 | 161 | "<br>Message to be displayed when the user chooses to opt out of cart " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L163) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L163) |  |
  | 163 | 163 | msgstr "" |
  | 164 | 164 |  |
  | 165 |  | #: woocommerce-ac.php:8~~77~~ |
  |  | 165 | #: woocommerce-ac.php:893 |
  | 166 | 166 | msgid "Coupon Settings" |
  | 167 | 167 | msgstr "" |
  | 168 | 168 |  |
  | 169 |  | #: woocommerce-ac.php:8~~83~~ |
  |  | 169 | #: woocommerce-ac.php:899 |
  | 170 | 170 | msgid "Delete Coupons Automatically" |
  | 171 | 171 | msgstr "" |
  | 172 | 172 |  |
  | 173 |  | #: woocommerce-ac.php:~~887~~ |
  |  | 173 | #: woocommerce-ac.php:903 |
  | 174 | 174 | msgid "" |
  | 175 | 175 | "Enable this setting if you want to completely remove the expired and used " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L177) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L177) |  |
  | 177 | 177 | msgstr "" |
  | 178 | 178 |  |
  | 179 |  | #: woocommerce-ac.php:~~891~~ |
  |  | 179 | #: woocommerce-ac.php:907 |
  | 180 | 180 | msgid "Delete Coupons Manually" |
  | 181 | 181 | msgstr "" |
  | 182 | 182 |  |
  | 183 |  | #: woocommerce-ac.php:~~895~~ |
  |  | 183 | #: woocommerce-ac.php:911 |
  | 184 | 184 | msgid "" |
  | 185 | 185 | "If you want to completely remove the expired and used coupon code now then " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L187) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L187) |  |
  | 187 | 187 | msgstr "" |
  | 188 | 188 |  |
  | 189 |  | #: woocommerce-ac.php:9~~04~~ |
  |  | 189 | #: woocommerce-ac.php:920 |
  | 190 | 190 | msgid "Settings for abandoned cart recovery emails" |
  | 191 | 191 | msgstr "" |
  | 192 | 192 |  |
  | 193 |  | #: woocommerce-ac.php:9~~11~~ |
  |  | 193 | #: woocommerce-ac.php:927 |
  | 194 | 194 | msgid "\"From\" Name" |
  | 195 | 195 | msgstr "" |
  | 196 | 196 |  |
  | 197 |  | #: woocommerce-ac.php:9~~20~~ |
  |  | 197 | #: woocommerce-ac.php:936 |
  | 198 | 198 | msgid "\"From\" Address" |
  | 199 | 199 | msgstr "" |
  | 200 | 200 |  |
  | 201 |  | #: woocommerce-ac.php:9~~29~~ |
  |  | 201 | #: woocommerce-ac.php:945 |
  | 202 | 202 | msgid "Send Reply Emails to" |
  | 203 | 203 | msgstr "" |
  | 204 | 204 |  |
  | 205 |  | #: woocommerce-ac.php:9~~38~~ |
  |  | 205 | #: woocommerce-ac.php:954 |
  | 206 | 206 | msgid "UTM parameters to be added to all the links in reminder emails" |
  | 207 | 207 | msgstr "" |
  | 208 | 208 |  |
  | 209 |  | #: woocommerce-ac.php:9~~42~~ |
  |  | 209 | #: woocommerce-ac.php:958 |
  | 210 | 210 | msgid "" |
  | 211 | 211 | "UTM parameters that should be added to all the links in reminder emails." |
  | 212 | 212 | msgstr "" |
  | 213 | 213 |  |
  | 214 |  | #: woocommerce-ac.php:1~~084~~ |
  |  | 214 | #: woocommerce-ac.php:1100 |
  | 215 | 215 | msgid "" |
  | 216 | 216 | "Abandoned cart cut off time should be numeric and has to be greater than 0." |
  | 217 | 217 | msgstr "" |
  | 218 | 218 |  |
  | 219 |  | #: woocommerce-ac.php:11~~02~~ |
  |  | 219 | #: woocommerce-ac.php:1118 |
  | 220 | 220 | msgid "" |
  | 221 | 221 | "Automatically Delete Abandoned Orders after X days has to be greater than 0." |
  | 222 | 222 | msgstr "" |
  | 223 | 223 |  |
  | 224 |  | #: woocommerce-ac.php:13~~64~~ |
  |  | 224 | #: woocommerce-ac.php:1380 |
  | 225 | 225 | #: includes/admin/class-wcal-personal-data-export.php:137 |
  | 226 | 226 | msgid "Abandoned Carts" |
  | 227 | 227 | msgstr "" |
  | 228 | 228 |  |
  | 229 |  | #: woocommerce-ac.php:22~~20~~ |
  |  | 229 | #: woocommerce-ac.php:2256 |
  | 230 | 230 | msgid "Dashboard" |
  | 231 | 231 | msgstr "" |
  | 232 | 232 |  |
  | 233 |  | #: woocommerce-ac.php:22~~27~~ |
  |  | 233 | #: woocommerce-ac.php:2263 |
  | 234 | 234 | #: includes/classes/class-wcal-dashboard-report.php:161 |
  | 235 | 235 | msgid "Abandoned Orders" |
  | 236 | 236 | msgstr "" |
  | 237 | 237 |  |
  | 238 |  | #: woocommerce-ac.php:22~~34~~ |
  |  | 238 | #: woocommerce-ac.php:2270 |
  | 239 | 239 | msgid "Email Templates" |
  | 240 | 240 | msgstr "" |
  | 241 | 241 |  |
  | 242 |  | #: woocommerce-ac.php:22~~48~~ |
  |  | 242 | #: woocommerce-ac.php:2284 |
  | 243 | 243 | msgid "Recovered Orders" |
  | 244 | 244 | msgstr "" |
  | 245 | 245 |  |
  | 246 |  | #: woocommerce-ac.php:22~~55~~ |
  |  | 246 | #: woocommerce-ac.php:2291 |
  | 247 | 247 | msgid "Product Report" |
  | 248 | 248 | msgstr "" |
  | 249 | 249 |  |
  | 250 |  | #: woocommerce-ac.php:2~~297~~ |
  |  | 250 | #: woocommerce-ac.php:2333 |
  | 251 | 251 | #, php-format |
  | 252 | 252 | msgid "Please enter in decimal (%s) format without thousand separators." |
  | 253 | 253 | msgstr "" |
  | 254 | 254 |  |
  | 255 |  | #: woocommerce-ac.php:2~~299~~ |
  |  | 255 | #: woocommerce-ac.php:2335 |
  | 256 | 256 | #, php-format |
  | 257 | 257 | msgid "" |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L260) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L260) |  |
  | 260 | 260 | msgstr "" |
  | 261 | 261 |  |
  | 262 |  | #: woocommerce-ac.php:23~~00~~ |
  |  | 262 | #: woocommerce-ac.php:2336 |
  | 263 | 263 | msgid "Please enter in country code with two capital letters." |
  | 264 | 264 | msgstr "" |
  | 265 | 265 |  |
  | 266 |  | #: woocommerce-ac.php:23~~01~~ |
  |  | 266 | #: woocommerce-ac.php:2337 |
  | 267 | 267 | msgid "Please enter in a value less than the regular price." |
  | 268 | 268 | msgstr "" |
  | 269 | 269 |  |
  | 270 |  | #: woocommerce-ac.php:23~~05~~ |
  |  | 270 | #: woocommerce-ac.php:2341 |
  | 271 | 271 | msgid "Import" |
  | 272 | 272 | msgstr "" |
  | 273 | 273 |  |
  | 274 |  | #: woocommerce-ac.php:23~~06~~ |
  |  | 274 | #: woocommerce-ac.php:2342 |
  | 275 | 275 | msgid "Export" |
  | 276 | 276 | msgstr "" |
  | 277 | 277 |  |
  | 278 |  | #: woocommerce-ac.php:24~~01~~ |
  |  | 278 | #: woocommerce-ac.php:2437 |
  | 279 | 279 | msgctxt "enhanced select" |
  | 280 | 280 | msgid "One result is available, press enter to select it." |
  | 281 | 281 | msgstr "" |
  | 282 | 282 |  |
  | 283 |  | #: woocommerce-ac.php:24~~02~~ |
  |  | 283 | #: woocommerce-ac.php:2438 |
  | 284 | 284 | msgctxt "enhanced select" |
  | 285 | 285 | msgid "%qty% results are available, use up and down arrow keys to navigate." |
  | 286 | 286 | msgstr "" |
  | 287 | 287 |  |
  | 288 |  | #: woocommerce-ac.php:24~~03~~ |
  |  | 288 | #: woocommerce-ac.php:2439 |
  | 289 | 289 | msgctxt "enhanced select" |
  | 290 | 290 | msgid "No matches found" |
  | 291 | 291 | msgstr "" |
  | 292 | 292 |  |
  | 293 |  | #: woocommerce-ac.php:24~~04~~ |
  |  | 293 | #: woocommerce-ac.php:2440 |
  | 294 | 294 | msgctxt "enhanced select" |
  | 295 | 295 | msgid "Loading failed" |
  | 296 | 296 | msgstr "" |
  | 297 | 297 |  |
  | 298 |  | #: woocommerce-ac.php:24~~05~~ |
  |  | 298 | #: woocommerce-ac.php:2441 |
  | 299 | 299 | msgctxt "enhanced select" |
  | 300 | 300 | msgid "Please enter 1 or more characters" |
  | 301 | 301 | msgstr "" |
  | 302 | 302 |  |
  | 303 |  | #: woocommerce-ac.php:24~~06~~ |
  |  | 303 | #: woocommerce-ac.php:2442 |
  | 304 | 304 | msgctxt "enhanced select" |
  | 305 | 305 | msgid "Please enter %qty% or more characters" |
  | 306 | 306 | msgstr "" |
  | 307 | 307 |  |
  | 308 |  | #: woocommerce-ac.php:24~~07~~ |
  |  | 308 | #: woocommerce-ac.php:2443 |
  | 309 | 309 | msgctxt "enhanced select" |
  | 310 | 310 | msgid "Please delete 1 character" |
  | 311 | 311 | msgstr "" |
  | 312 | 312 |  |
  | 313 |  | #: woocommerce-ac.php:24~~08~~ |
  |  | 313 | #: woocommerce-ac.php:2444 |
  | 314 | 314 | msgctxt "enhanced select" |
  | 315 | 315 | msgid "Please delete %qty% characters" |
  | 316 | 316 | msgstr "" |
  | 317 | 317 |  |
  | 318 |  | #: woocommerce-ac.php:24~~09~~ |
  |  | 318 | #: woocommerce-ac.php:2445 |
  | 319 | 319 | msgctxt "enhanced select" |
  | 320 | 320 | msgid "You can only select 1 item" |
  | 321 | 321 | msgstr "" |
  | 322 | 322 |  |
  | 323 |  | #: woocommerce-ac.php:24~~10~~ |
  |  | 323 | #: woocommerce-ac.php:2446 |
  | 324 | 324 | msgctxt "enhanced select" |
  | 325 | 325 | msgid "You can only select %qty% items" |
  | 326 | 326 | msgstr "" |
  | 327 | 327 |  |
  | 328 |  | #: woocommerce-ac.php:24~~11~~ |
  |  | 328 | #: woocommerce-ac.php:2447 |
  | 329 | 329 | msgctxt "enhanced select" |
  | 330 | 330 | msgid "Loading more results&hellip;" |
  | 331 | 331 | msgstr "" |
  | 332 | 332 |  |
  | 333 |  | #: woocommerce-ac.php:24~~12~~ |
  |  | 333 | #: woocommerce-ac.php:2448 |
  | 334 | 334 | msgctxt "enhanced select" |
  | 335 | 335 | msgid "Searching&hellip;" |
  | 336 | 336 | msgstr "" |
  | 337 | 337 |  |
  | 338 |  | #: woocommerce-ac.php:25~~35~~ |
  |  | 338 | #: woocommerce-ac.php:2571 |
  | 339 | 339 | msgid "You do not have sufficient permissions to access this page." |
  | 340 | 340 | msgstr "" |
  | 341 | 341 |  |
  | 342 |  | #: woocommerce-ac.php:25~~39~~ |
  |  | 342 | #: woocommerce-ac.php:2575 |
  | 343 | 343 | msgid "WooCommerce - Abandon Cart Lite" |
  | 344 | 344 | msgstr "" |
  | 345 | 345 |  |
  | 346 |  | #: woocommerce-ac.php:26~~11~~ |
  |  | 346 | #: woocommerce-ac.php:2647 |
  | 347 | 347 | msgid "The Abandoned cart has been successfully deleted." |
  | 348 | 348 | msgstr "" |
  | 349 | 349 |  |
  | 350 |  | #: woocommerce-ac.php:26~~13~~ |
  |  | 350 | #: woocommerce-ac.php:2649 |
  | 351 | 351 | msgid "All Abandoned Carts have been successfully deleted." |
  | 352 | 352 | msgstr "" |
  | 353 | 353 |  |
  | 354 |  | #: woocommerce-ac.php:26~~15~~ |
  |  | 354 | #: woocommerce-ac.php:2651 |
  | 355 | 355 | msgid "All Visitor carts have been successfully deleted." |
  | 356 | 356 | msgstr "" |
  | 357 | 357 |  |
  | 358 |  | #: woocommerce-ac.php:26~~17~~ |
  |  | 358 | #: woocommerce-ac.php:2653 |
  | 359 | 359 | msgid "All Guest carts have been successfully deleted." |
  | 360 | 360 | msgstr "" |
  | 361 | 361 |  |
  | 362 |  | #: woocommerce-ac.php:26~~19~~ |
  |  | 362 | #: woocommerce-ac.php:2655 |
  | 363 | 363 | msgid "All Registered carts have been deleted." |
  | 364 | 364 | msgstr "" |
  | 365 | 365 |  |
  | 366 |  | #: woocommerce-ac.php:26~~30~~ |
  |  | 366 | #: woocommerce-ac.php:2666 |
  | 367 | 367 | msgid "The Template has been successfully deleted." |
  | 368 | 368 | msgstr "" |
  | 369 | 369 |  |
  | 370 |  | #: woocommerce-ac.php:2~~674~~ |
  |  | 370 | #: woocommerce-ac.php:2710 |
  | 371 | 371 | msgid "General Settings" |
  | 372 | 372 | msgstr "" |
  | 373 | 373 |  |
  | 374 |  | #: woocommerce-ac.php:2~~677~~ |
  |  | 374 | #: woocommerce-ac.php:2713 |
  | 375 | 375 | msgid "Email Sending Settings" |
  | 376 | 376 | msgstr "" |
  | 377 | 377 |  |
  | 378 |  | #: woocommerce-ac.php:2~~680~~ |
  |  | 378 | #: woocommerce-ac.php:2716 |
  | 379 | 379 | msgid "Add To Cart Popup Editor" |
  | 380 | 380 | msgstr "" |
  | 381 | 381 |  |
  | 382 |  | #: woocommerce-ac.php:2~~683~~ |
  |  | 382 | #: woocommerce-ac.php:2719 |
  | 383 | 383 | msgid "Facebook Messenger" |
  | 384 | 384 | msgstr "" |
  | 385 | 385 |  |
  | 386 |  | #: woocommerce-ac.php:2~~686~~ |
  |  | 386 | #: woocommerce-ac.php:2722 |
  | 387 | 387 | msgid "SMS" |
  | 388 | 388 | msgstr "" |
  | 389 | 389 |  |
  | 390 |  | #: woocommerce-ac.php:2~~689~~ includes/class-wcap-integrations.php:65 |
  |  | 390 | #: woocommerce-ac.php:2725 includes/class-wcap-integrations.php:65 |
  | 391 | 391 | msgid "Connectors" |
  | 392 | 392 | msgstr "" |
  | 393 | 393 |  |
  | 394 |  | #: woocommerce-ac.php:2~~697 woocommerce-ac.php:2707~~ |
  |  | 394 | #: woocommerce-ac.php:2733 woocommerce-ac.php:2743 |
  | 395 | 395 | msgid "" |
  | 396 | 396 | "Change settings for sending email notifications to Customers, to Admin etc." |
  | 397 | 397 | msgstr "" |
  | 398 | 398 |  |
  | 399 |  | #: woocommerce-ac.php:27~~34~~ |
  |  | 399 | #: woocommerce-ac.php:2770 |
  | 400 | 400 | msgid "" |
  | 401 | 401 | "The list below shows all Abandoned Carts which have remained in cart for a " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L403) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L403) |  |
  | 403 | 403 | msgstr "" |
  | 404 | 404 |  |
  | 405 |  | #: woocommerce-ac.php:2~~776~~ |
  |  | 405 | #: woocommerce-ac.php:2812 |
  | 406 | 406 | msgid "All " |
  | 407 | 407 | msgstr "" |
  | 408 | 408 |  |
  | 409 |  | #: woocommerce-ac.php:2~~781~~ |
  |  | 409 | #: woocommerce-ac.php:2817 |
  | 410 | 410 | #, php-format |
  | 411 | 411 | msgid "Registered %s" |
  | 412 | 412 | msgstr "" |
  | 413 | 413 |  |
  | 414 |  | #: woocommerce-ac.php:2~~787~~ |
  |  | 414 | #: woocommerce-ac.php:2823 |
  | 415 | 415 | #, php-format |
  | 416 | 416 | msgid "Guest %s" |
  | 417 | 417 | msgstr "" |
  | 418 | 418 |  |
  | 419 |  | #: woocommerce-ac.php:2~~793~~ |
  |  | 419 | #: woocommerce-ac.php:2829 |
  | 420 | 420 | msgid "Carts without Customer Details" |
  | 421 | 421 | msgstr "" |
  | 422 | 422 |  |
  | 423 |  | #: woocommerce-ac.php:28~~14~~ |
  |  | 423 | #: woocommerce-ac.php:2850 |
  | 424 | 424 | msgid "" |
  | 425 | 425 | "Add email templates at different intervals to maximize the possibility of " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L427) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L427) |  |
  | 427 | 427 | msgstr "" |
  | 428 | 428 |  |
  | 429 |  | #: woocommerce-ac.php:~~2970~~ |
  |  | 429 | #: woocommerce-ac.php:3006 |
  | 430 | 430 | msgid "" |
  | 431 | 431 | "The Email Template has been successfully added. In order to start sending " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L433) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L433) |  |
  | 433 | 433 | msgstr "" |
  | 434 | 434 |  |
  | 435 |  | #: woocommerce-ac.php:~~2980~~ |
  |  | 435 | #: woocommerce-ac.php:3016 |
  | 436 | 436 | msgid "" |
  | 437 | 437 | "There was a problem adding the email template. Please contact the plugin " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L440) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L440) |  |
  | 440 | 440 | msgstr "" |
  | 441 | 441 |  |
  | 442 |  | #: woocommerce-ac.php:~~2992~~ |
  |  | 442 | #: woocommerce-ac.php:3028 |
  | 443 | 443 | msgid "The Email Template has been successfully updated." |
  | 444 | 444 | msgstr "" |
  | 445 | 445 |  |
  | 446 |  | #: woocommerce-ac.php:30~~02~~ |
  |  | 446 | #: woocommerce-ac.php:3038 |
  | 447 | 447 | msgid "" |
  | 448 | 448 | "There was a problem updating the email template. Please contact the plugin " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L451) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L451) |  |
  | 451 | 451 | msgstr "" |
  | 452 | 452 |  |
  | 453 |  | #: woocommerce-ac.php:30~~11~~ |
  |  | 453 | #: woocommerce-ac.php:3047 |
  | 454 | 454 | msgid "Add New Template" |
  | 455 | 455 | msgstr "" |
  | 456 | 456 |  |
  | 457 |  | #: woocommerce-ac.php:3~~083~~ |
  |  | 457 | #: woocommerce-ac.php:3119 |
  | 458 | 458 | msgid "" |
  | 459 | 459 | "The Report below shows how many Abandoned Carts we were able to recover for " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L461) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L461) |  |
  | 461 | 461 | msgstr "" |
  | 462 | 462 |  |
  | 463 |  | #: woocommerce-ac.php:31~~34~~ |
  |  | 463 | #: woocommerce-ac.php:3170 |
  | 464 | 464 | msgid "Start Date:" |
  | 465 | 465 | msgstr "" |
  | 466 | 466 |  |
  | 467 |  | #: woocommerce-ac.php:31~~36~~ |
  |  | 467 | #: woocommerce-ac.php:3172 |
  | 468 | 468 | msgid "End Date:" |
  | 469 | 469 | msgstr "" |
  | 470 | 470 |  |
  | 471 |  | #: woocommerce-ac.php:31~~38~~ |
  |  | 471 | #: woocommerce-ac.php:3174 |
  | 472 | 472 | #: includes/classes/class-wcal-dashboard-report.php:319 |
  | 473 | 473 | msgid "Go" |
  | 474 | 474 | msgstr "" |
  | 475 | 475 |  |
  | 476 |  | #: woocommerce-ac.php:31~~56~~ |
  |  | 476 | #: woocommerce-ac.php:3192 |
  | 477 | 477 | #, php-format |
  | 478 | 478 | msgid "" |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L482) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L482) |  |
  | 482 | 482 | msgstr "" |
  | 483 | 483 |  |
  | 484 |  | #: woocommerce-ac.php:3~~181~~ |
  |  | 484 | #: woocommerce-ac.php:3217 |
  | 485 | 485 | #, php-format |
  | 486 | 486 | msgid "Abandoned Order #%s Details" |
  | 487 | 487 | msgstr "" |
  | 488 | 488 |  |
  | 489 |  | #: woocommerce-ac.php:3~~185 woocommerce-ac.php:4035 woocommerce-ac.php:4070~~ |
  | 490 |  | #: cron/class-wcal-cron.php:28~~5~~ |
  |  | 489 | #: woocommerce-ac.php:3221 woocommerce-ac.php:4071 woocommerce-ac.php:4106 |
  |  | 490 | #: cron/class-wcal-cron.php:287 |
  | 491 | 491 | msgid "Item" |
  | 492 | 492 | msgstr "" |
  | 493 | 493 |  |
  | 494 |  | #: woocommerce-ac.php:3~~186 woocommerce-ac.php:4036 woocommerce-ac.php:4071~~ |
  | 495 |  | #: cron/class-wcal-cron.php:28~~6~~ |
  |  | 494 | #: woocommerce-ac.php:3222 woocommerce-ac.php:4072 woocommerce-ac.php:4107 |
  |  | 495 | #: cron/class-wcal-cron.php:288 |
  | 496 | 496 | msgid "Name" |
  | 497 | 497 | msgstr "" |
  | 498 | 498 |  |
  | 499 |  | #: woocommerce-ac.php:3~~187 woocommerce-ac.php:4037 woocommerce-ac.php:4072~~ |
  | 500 |  | #: cron/class-wcal-cron.php:28~~7~~ |
  |  | 499 | #: woocommerce-ac.php:3223 woocommerce-ac.php:4073 woocommerce-ac.php:4108 |
  |  | 500 | #: cron/class-wcal-cron.php:289 |
  | 501 | 501 | msgid "Quantity" |
  | 502 | 502 | msgstr "" |
  | 503 | 503 |  |
  | 504 |  | #: woocommerce-ac.php:3~~188 woocommerce-ac.php:4039 woocommerce-ac.php:4074~~ |
  | 505 |  | #: cron/class-wcal-cron.php:2~~89~~ |
  |  | 504 | #: woocommerce-ac.php:3224 woocommerce-ac.php:4075 woocommerce-ac.php:4110 |
  |  | 505 | #: cron/class-wcal-cron.php:291 |
  | 506 | 506 | msgid "Line Subtotal" |
  | 507 | 507 | msgstr "" |
  | 508 | 508 |  |
  | 509 |  | #: woocommerce-ac.php:3~~189~~ |
  |  | 509 | #: woocommerce-ac.php:3225 |
  | 510 | 510 | msgid "Line Total" |
  | 511 | 511 | msgstr "" |
  | 512 | 512 |  |
  | 513 |  | #: woocommerce-ac.php:34~~14~~ |
  | 514 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:47~~1~~ |
  |  | 513 | #: woocommerce-ac.php:3450 |
  |  | 514 | #: includes/admin/class-wcal-abandoned-cart-details.php:475 |
  | 515 | 515 | msgid "Customer Details" |
  | 516 | 516 | msgstr "" |
  | 517 | 517 |  |
  | 518 |  | #: woocommerce-ac.php:34~~18~~ |
  |  | 518 | #: woocommerce-ac.php:3454 |
  | 519 | 519 | msgid "Billing Details" |
  | 520 | 520 | msgstr "" |
  | 521 | 521 |  |
  | 522 |  | #: woocommerce-ac.php:34~~19~~ |
  |  | 522 | #: woocommerce-ac.php:3455 |
  | 523 | 523 | msgid "Name:" |
  | 524 | 524 | msgstr "" |
  | 525 | 525 |  |
  | 526 |  | #: woocommerce-ac.php:34~~22 woocommerce-ac.php:3443~~ |
  |  | 526 | #: woocommerce-ac.php:3458 woocommerce-ac.php:3479 |
  | 527 | 527 | msgid "Address:" |
  | 528 | 528 | msgstr "" |
  | 529 | 529 |  |
  | 530 |  | #: woocommerce-ac.php:34~~33~~ |
  |  | 530 | #: woocommerce-ac.php:3469 |
  | 531 | 531 | msgid "Email:" |
  | 532 | 532 | msgstr "" |
  | 533 | 533 |  |
  | 534 |  | #: woocommerce-ac.php:34~~37~~ |
  |  | 534 | #: woocommerce-ac.php:3473 |
  | 535 | 535 | msgid "Phone:" |
  | 536 | 536 | msgstr "" |
  | 537 | 537 |  |
  | 538 |  | #: woocommerce-ac.php:34~~42~~ |
  |  | 538 | #: woocommerce-ac.php:3478 |
  | 539 | 539 | msgid "Shipping Details" |
  | 540 | 540 | msgstr "" |
  | 541 | 541 |  |
  | 542 |  | #: woocommerce-ac.php:34~~52~~ |
  |  | 542 | #: woocommerce-ac.php:3488 |
  | 543 | 543 | msgid "Shipping Address same as Billing Address" |
  | 544 | 544 | msgstr "" |
  | 545 | 545 |  |
  | 546 |  | #: woocommerce-ac.php:3~~465~~ |
  |  | 546 | #: woocommerce-ac.php:3501 |
  | 547 | 547 | msgid "Shipping Charges" |
  | 548 | 548 | msgstr "" |
  | 549 | 549 |  |
  | 550 |  | #: woocommerce-ac.php:35~~49~~ |
  |  | 550 | #: woocommerce-ac.php:3585 |
  | 551 | 551 | msgid "Template Name:" |
  | 552 | 552 | msgstr "" |
  | 553 | 553 |  |
  | 554 |  | #: woocommerce-ac.php:35~~59~~ |
  |  | 554 | #: woocommerce-ac.php:3595 |
  | 555 | 555 | msgid "Enter a template name for reference" |
  | 556 | 556 | msgstr "" |
  | 557 | 557 |  |
  | 558 |  | #: woocommerce-ac.php:3~~565~~ |
  |  | 558 | #: woocommerce-ac.php:3601 |
  | 559 | 559 | msgid "Subject:" |
  | 560 | 560 | msgstr "" |
  | 561 | 561 |  |
  | 562 |  | #: woocommerce-ac.php:3~~575~~ |
  |  | 562 | #: woocommerce-ac.php:3611 |
  | 563 | 563 | msgid "Enter the subject that should appear in the email sent" |
  | 564 | 564 | msgstr "" |
  | 565 | 565 |  |
  | 566 |  | #: woocommerce-ac.php:3~~581~~ |
  |  | 566 | #: woocommerce-ac.php:3617 |
  | 567 | 567 | msgid "Email Body:" |
  | 568 | 568 | msgstr "" |
  | 569 | 569 |  |
  | 570 |  | #: woocommerce-ac.php:36~~08~~ |
  |  | 570 | #: woocommerce-ac.php:3644 |
  | 571 | 571 | msgid "Message to be sent in the reminder email." |
  | 572 | 572 | msgstr "" |
  | 573 | 573 |  |
  | 574 |  | #: woocommerce-ac.php:36~~35~~ |
  |  | 574 | #: woocommerce-ac.php:3671 |
  | 575 | 575 | msgid "Use WooCommerce Template Style:" |
  | 576 | 576 | msgstr "" |
  | 577 | 577 |  |
  | 578 |  | #: woocommerce-ac.php:36~~51~~ |
  |  | 578 | #: woocommerce-ac.php:3687 |
  | 579 | 579 | msgid "" |
  | 580 | 580 | "Use WooCommerce default style template for abandoned cart reminder emails." |
  | 581 | 581 | msgstr "" |
  | 582 | 582 |  |
  | 583 |  | #: woocommerce-ac.php:36~~58~~ |
  |  | 583 | #: woocommerce-ac.php:3694 |
  | 584 | 584 | msgid "Email Template Header Text: " |
  | 585 | 585 | msgstr "" |
  | 586 | 586 |  |
  | 587 |  | #: woocommerce-ac.php:3~~673~~ |
  |  | 587 | #: woocommerce-ac.php:3709 |
  | 588 | 588 | msgid "" |
  | 589 | 589 | "Enter the header which will appear in the abandoned WooCommerce email sent. " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L592) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L592) |  |
  | 592 | 592 | msgstr "" |
  | 593 | 593 |  |
  | 594 |  | #: woocommerce-ac.php:3~~679~~ |
  |  | 594 | #: woocommerce-ac.php:3715 |
  | 595 | 595 | msgid "Send this email:" |
  | 596 | 596 | msgstr "" |
  | 597 | 597 |  |
  | 598 |  | #: woocommerce-ac.php:37~~21~~ |
  |  | 598 | #: woocommerce-ac.php:3757 |
  | 599 | 599 | msgid "after cart is abandoned." |
  | 600 | 600 | msgstr "" |
  | 601 | 601 |  |
  | 602 |  | #: woocommerce-ac.php:37~~28~~ |
  |  | 602 | #: woocommerce-ac.php:3764 |
  | 603 | 603 | msgid "Send a test email to:" |
  | 604 | 604 | msgstr "" |
  | 605 | 605 |  |
  | 606 |  | #: woocommerce-ac.php:37~~37~~ |
  |  | 606 | #: woocommerce-ac.php:3773 |
  | 607 | 607 | msgid "Enter the email id to which the test email needs to be sent." |
  | 608 | 608 | msgstr "" |
  | 609 | 609 |  |
  | 610 |  | #: woocommerce-ac.php:37~~51~~ |
  |  | 610 | #: woocommerce-ac.php:3787 |
  | 611 | 611 | msgid "Update Changes" |
  | 612 | 612 | msgstr "" |
  | 613 | 613 |  |
  | 614 |  | #: woocommerce-ac.php:37~~55~~ |
  |  | 614 | #: woocommerce-ac.php:3791 |
  | 615 | 615 | #: includes/admin/class-wcap-add-cart-popup-modal.php:84 |
  | 616 | 616 | #: includes/admin/class-wcap-pro-settings.php:66 |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L619) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L619) |  |
  | 619 | 619 | msgstr "" |
  | 620 | 620 |  |
  | 621 |  | #: woocommerce-ac.php:3~~777~~ |
  |  | 621 | #: woocommerce-ac.php:3813 |
  | 622 | 622 | msgid "" |
  | 623 | 623 | "If you love <strong>Abandoned Cart Lite for WooCommerce</strong>, then " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L628) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L628) |  |
  | 628 | 628 | msgstr "" |
  | 629 | 629 |  |
  | 630 |  | #: woocommerce-ac.php:38~~29~~ |
  |  | 630 | #: woocommerce-ac.php:3865 |
  | 631 | 631 | msgid "Please enter a valid email." |
  | 632 | 632 | msgstr "" |
  | 633 | 633 |  |
  | 634 |  | #: woocommerce-ac.php:40~~33 woocommerce-ac.php:4067~~ |
  | 635 |  | #: cron/class-wcal-cron.php:29~~6 cron/class-wcal-cron.php:307~~ |
  |  | 634 | #: woocommerce-ac.php:4069 woocommerce-ac.php:4103 |
  |  | 635 | #: cron/class-wcal-cron.php:298 cron/class-wcal-cron.php:309 |
  | 636 | 636 | msgid "Your Shopping Cart" |
  | 637 | 637 | msgstr "" |
  | 638 | 638 |  |
  | 639 |  | #: woocommerce-ac.php:40~~38 woocommerce-ac.php:4073~~ |
  | 640 |  | #: cron/class-wcal-cron.php:2~~88~~ |
  |  | 639 | #: woocommerce-ac.php:4074 woocommerce-ac.php:4109 |
  |  | 640 | #: cron/class-wcal-cron.php:290 |
  | 641 | 641 | msgid "Price" |
  | 642 | 642 | msgstr "" |
  | 643 | 643 |  |
  | 644 |  | #: woocommerce-ac.php:40~~43 woocommerce-ac.php:4078~~ |
  |  | 644 | #: woocommerce-ac.php:4079 woocommerce-ac.php:4114 |
  | 645 | 645 | msgid "Men's Formal Shoes" |
  | 646 | 646 | msgstr "" |
  | 647 | 647 |  |
  | 648 |  | #: woocommerce-ac.php:40~~50 woocommerce-ac.php:4085~~ |
  |  | 648 | #: woocommerce-ac.php:4086 woocommerce-ac.php:4121 |
  | 649 | 649 | msgid "Woman's Hand Bags" |
  | 650 | 650 | msgstr "" |
  | 651 | 651 |  |
  | 652 |  | #: woocommerce-ac.php:40~~59 woocommerce-ac.php:4094~~ |
  | 653 |  | #: cron/class-wcal-cron.php:41~~7~~ |
  |  | 652 | #: woocommerce-ac.php:4095 woocommerce-ac.php:4130 |
  |  | 653 | #: cron/class-wcal-cron.php:419 |
  | 654 | 654 | msgid "Cart Total:" |
  | 655 | 655 | msgstr "" |
  | 656 | 656 |  |
  | 657 |  | #: woocommerce-ac.php:43~~05~~ |
  |  | 657 | #: woocommerce-ac.php:4341 |
  | 658 | 658 | #, php-format |
  | 659 | 659 | msgid "%1$s: %2$d" |
  | 660 | 660 | msgstr "" |
  | 661 | 661 |  |
  | 662 |  | #: woocommerce-ac.php:43~~15~~ |
  |  | 662 | #: woocommerce-ac.php:4351 |
  | 663 | 663 | #: includes/classes/class-wcal-abandoned-orders-table.php:183 |
  | 664 | 664 | #: includes/classes/class-wcal-abandoned-orders-table.php:785 |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L668) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L668) |  |
  | 668 | 668 | msgstr "" |
  | 669 | 669 |  |
  | 670 |  | #: woocommerce-ac.php:44~~46~~ |
  |  | 670 | #: woocommerce-ac.php:4482 |
  | 671 | 671 | msgid "Once Every Fifteen Minutes" |
  | 672 | 672 | msgstr "" |
  | 673 | 673 |  |
  | 674 |  | #: woocommerce-ac.php:44~~51~~ |
  |  | 674 | #: woocommerce-ac.php:4487 |
  | 675 | 675 | msgid "Once Every Fifteen Days" |
  | 676 | 676 | msgstr "" |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L680) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L680) |  |
  | 680 | 680 | msgstr "" |
  | 681 | 681 |  |
  | 682 |  | #: cron/class-wcal-cron.php:33~~3 cron/class-wcal-cron.php:365~~ |
  |  | 682 | #: cron/class-wcal-cron.php:335 cron/class-wcal-cron.php:367 |
  | 683 | 683 | msgid "SKU: " |
  | 684 | 684 | msgstr "" |
  | 685 | 685 |  |
  | 686 |  | #: cron/class-wcal-cron.php:4~~29~~ |
  |  | 686 | #: cron/class-wcal-cron.php:431 |
  | 687 | 687 | msgid "Product no longer exists" |
  | 688 | 688 | msgstr "" |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L795) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L795) |  |
  | 795 | 795 | msgstr "" |
  | 796 | 796 |  |
  | 797 |  | #: includes/class-wcal-common.php:6~~79~~ |
  |  | 797 | #: includes/class-wcal-common.php:680 |
  | 798 | 798 | msgid "Database Updated Successfully" |
  | 799 | 799 | msgstr "" |
  | 800 | 800 |  |
  | 801 |  | #: includes/class-wcal-common.php:69~~4~~ |
  |  | 801 | #: includes/class-wcal-common.php:695 |
  | 802 | 802 | msgid "Database Update Failed. Please try again after sometime" |
  | 803 | 803 | msgstr "" |
  | 804 | 804 |  |
  | 805 |  | #: includes/class-wcal-common.php:85~~4~~ |
  |  | 805 | #: includes/class-wcal-common.php:855 |
  | 806 | 806 | msgid "This product no longer exists" |
  | 807 | 807 | msgstr "" |
  | 808 | 808 |  |
  | 809 |  | #: includes/class-wcal-common.php:127~~3 includes/class-wcal-common.php:1289~~ |
  | 810 |  | #: includes/class-wcal-common.php:131~~2~~ |
  |  | 809 | #: includes/class-wcal-common.php:1274 includes/class-wcal-common.php:1290 |
  |  | 810 | #: includes/class-wcal-common.php:1313 |
  | 811 | 811 | msgid "Discount code applied successfully." |
  | 812 | 812 | msgstr "" |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L872) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L872) |  |
  | 872 | 872 | msgstr "" |
  | 873 | 873 |  |
  | 874 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:45~~4~~ |
  |  | 874 | #: includes/admin/class-wcal-abandoned-cart-details.php:458 |
  | 875 | 875 | #: includes/templates/rules/html-rules-add-row.php:21 |
  | 876 | 876 | #: includes/templates/rules/html-rules-edit-row.php:25 |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L878) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L878) |  |
  | 878 | 878 | msgstr "" |
  | 879 | 879 |  |
  | 880 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:45~~4~~ |
  |  | 880 | #: includes/admin/class-wcal-abandoned-cart-details.php:458 |
  | 881 | 881 | #, php-format |
  | 882 | 882 | msgid "Recovered on %s" |
  | 883 | 883 | msgstr "" |
  | 884 | 884 |  |
  | 885 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:47~~0~~ |
  |  | 885 | #: includes/admin/class-wcal-abandoned-cart-details.php:474 |
  | 886 | 886 | #: includes/admin/class-wcal-personal-data-export.php:193 |
  | 887 | 887 | #: includes/admin/class-wcal-personal-data-export.php:208 |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L891) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L891) |  |
  | 891 | 891 | msgstr "" |
  | 892 | 892 |  |
  | 893 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:47~~2~~ |
  |  | 893 | #: includes/admin/class-wcal-abandoned-cart-details.php:476 |
  | 894 | 894 | #: includes/classes/class-wcal-abandoned-orders-table.php:109 |
  | 895 | 895 | #: includes/classes/class-wcal-recover-orders-table.php:136 |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L897) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L897) |  |
  | 897 | 897 | msgstr "" |
  | 898 | 898 |  |
  | 899 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:47~~3~~ |
  |  | 899 | #: includes/admin/class-wcal-abandoned-cart-details.php:477 |
  | 900 | 900 | #: includes/admin/class-wcal-personal-data-export.php:187 |
  | 901 | 901 | #: includes/admin/class-wcal-personal-data-export.php:203 |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L904) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L904) |  |
  | 904 | 904 | msgstr "" |
  | 905 | 905 |  |
  | 906 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:4~~88~~ |
  |  | 906 | #: includes/admin/class-wcal-abandoned-cart-details.php:492 |
  | 907 | 907 | msgid "Item Name" |
  | 908 | 908 | msgstr "" |
  | 909 | 909 |  |
  | 910 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:4~~89~~ |
  |  | 910 | #: includes/admin/class-wcal-abandoned-cart-details.php:493 |
  | 911 | 911 | msgid "Item Cost" |
  | 912 | 912 | msgstr "" |
  | 913 | 913 |  |
  | 914 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:49~~0~~ |
  |  | 914 | #: includes/admin/class-wcal-abandoned-cart-details.php:494 |
  | 915 | 915 | msgid "Item Quantity" |
  | 916 | 916 | msgstr "" |
  | 917 | 917 |  |
  | 918 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:5~~09~~ |
  |  | 918 | #: includes/admin/class-wcal-abandoned-cart-details.php:513 |
  | 919 | 919 | msgid "Close" |
  | 920 | 920 | msgstr "" |
  | 921 | 921 |  |
  | 922 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:74~~2~~ |
  |  | 922 | #: includes/admin/class-wcal-abandoned-cart-details.php:746 |
  | 923 | 923 | msgid "Tax: " |
  | 924 | 924 | msgstr "" |
  | 925 | 925 |  |
  | 926 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:7~~48~~ |
  |  | 926 | #: includes/admin/class-wcal-abandoned-cart-details.php:752 |
  | 927 | 927 | msgid "includes Tax: " |
  | 928 | 928 | msgstr "" |
  | 929 | 929 |  |
  | 930 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:7~~69~~ |
  |  | 930 | #: includes/admin/class-wcal-abandoned-cart-details.php:773 |
  | 931 | 931 | msgid "Product has been deleted" |
  | 932 | 932 | msgstr "" |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L1874) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L1874) |  |
  | 1874 | 1874 | msgstr "" |
  | 1875 | 1875 |  |
  | 1876 |  | #: includes/frontend/class-wcal-checkout-process.php:21~~6~~ |
  |  | 1876 | #: includes/frontend/class-wcal-checkout-process.php:218 |
  | 1877 | 1877 | msgid "This order was abandoned & subsequently recovered." |
  | 1878 | 1878 | msgstr "" |
  | 1879 | 1879 |  |
  | 1880 |  | #: includes/frontend/class-wcal-checkout-process.php:32~~4~~ |
  | 1881 |  | #: includes/frontend/class-wcal-checkout-process.php:3~~26~~ |
  |  | 1880 | #: includes/frontend/class-wcal-checkout-process.php:329 |
  |  | 1881 | #: includes/frontend/class-wcal-checkout-process.php:331 |
  | 1882 | 1882 | msgid "New Customer Order - Recovered" |
  | 1883 | 1883 | msgstr "" |
* ## [woocommerce-abandoned-cart/tags/5.15.0/includes/admin/class-wcal-abandoned-cart-details.php](/changeset/2922242/woocommerce-abandoned-cart/tags/5.15.0/includes/admin/class-wcal-abandoned-cart-details.php "Show the changeset 2922242 restricted to woocommerce-abandoned-cart/tags/5.15.0/includes/admin/class-wcal-abandoned-cart-details.php")

  | [r2327412](/browser/woocommerce-abandoned-cart/trunk/includes/admin/class-wcal-abandoned-cart-details.php?rev=2327412#L441 "Show revision 2327412 of this file in browser") | [r2922242](/browser/woocommerce-abandoned-cart/tags/5.15.0/includes/admin/class-wcal-abandoned-cart-details.php?rev=2922242#L441 "Show revision 2922242 of this file in browser") |  |
  | --- | --- | --- |
  | 441 | 441 | echo wp\_kses\_post( stripslashes( $wcal\_abandoned\_status ) ); |
  | 442 | 442 | if ( $recovered\_order > 0 ) { |
  | 443 |  | $order\_post      = ~~get\_post~~( $recovered\_order ); |
  |  | 443 | $order\_post      = wc\_get\_order( $recovered\_order ); |
  | 444 | 444 | $recovered\_stamp = strtotime( $order\_post->post\_date ); |
  | 445 | 445 |  |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/admin/class-wcal-abandoned-cart-details.php?rev=2327412#L448) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/includes/admin/class-wcal-abandoned-cart-details.php?rev=2922242#L448) |  |
  | 448 | 448 | $recovered\_date    = "$order\_date\_format $order\_time\_format"; |
  | 449 | 449 |  |
  | 450 |  | $order\_url = admin\_url( "post.php?post=$recovered\_order&action=edit" ); |
  |  | 450 | if ( wcal\_is\_hpos\_enabled() ) { // HPOS usage is enabled. |
  |  | 451 | $order\_url = admin\_url( "admin.php?page=wc-orders&id=$recovered\_order&action=edit" ); |
  |  | 452 | } else { // Traditional CPT-based orders are in use. |
  |  | 453 | $order\_url = admin\_url( "post.php?post=$recovered\_order&action=edit" ); |
  |  | 454 | } |
  | 451 | 455 | echo wp\_kses\_post( |
  | 452 | 456 | sprintf( |
* ## [woocommerce-abandoned-cart/tags/5.15.0/includes/class-wcal-common.php](/changeset/2922242/woocommerce-abandoned-cart/tags/5.15.0/includes/class-wcal-common.php "Show the changeset 2922242 restricted to woocommerce-abandoned-cart/tags/5.15.0/includes/class-wcal-common.php")

  | [r2773841](/browser/woocommerce-abandoned-cart/trunk/includes/class-wcal-common.php?rev=2773841#L185 "Show revision 2773841 of this file in browser") | [r2922242](/browser/woocommerce-abandoned-cart/tags/5.15.0/includes/class-wcal-common.php?rev=2922242#L185 "Show revision 2922242 of this file in browser") |  |
  | --- | --- | --- |
  | 185 | 185 | foreach ( $wcal\_data as $wcal\_data\_key => $wcal\_data\_value ) { |
  | 186 | 186 |  |
  | 187 |  | $wcal\_order\_total             = get\_post\_meta( $wcal\_data\_value->recovered\_cart, '\_order\_total', true ); |
  |  | 187 | $order                        = wc\_get\_order( $wcal\_data\_value->recovered\_cart ); |
  |  | 188 | $wcal\_order\_total             = $order ? $order->get\_total() : 0; |
  | 188 | 189 | $wcal\_recovered\_orders\_amount = $wcal\_recovered\_orders\_amount + $wcal\_order\_total; |
  | 189 | 190 | } |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/class-wcal-common.php?rev=2773841#L1539) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/includes/class-wcal-common.php?rev=2922242#L1540) |  |
  | 1539 | 1540 | } |
  | 1540 | 1541 |  |
  | 1541 |  | $encoding\_checkout = $cart\_id . '&url=' . $checkout\_page\_link; |
  | 1542 |  | $validate\_checkout = Wcal\_Common::wcal\_encrypt\_validate( $encoding\_checkout ); |
  | 1543 |  |  |
  | 1544 |  | $checkout\_link = get\_option( 'siteurl' ) . '/?wcal\_action=checkout\_link&validate=' . $validate\_checkout; |
  | 1545 |  |  |
  | 1546 |  | $wpdb->update( // phpcs:ignore |
  | 1547 |  | $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite', |
  | 1548 |  | array( |
  | 1549 |  | 'checkout\_link' => $checkout\_link, |
  | 1550 |  | ), |
  | 1551 |  | array( |
  | 1552 |  | 'id' => $cart\_id, |
  | 1553 |  | ) |
  | 1554 |  | ); |
  |  | 1542 | $user\_details = wcal\_get\_contact\_data( $cart\_id ); |
  |  | 1543 | $user\_email   = is\_array( $user\_details ) && count( $user\_details ) > 0 && isset( $user\_details['email'] ) ? $user\_details['email'] : ''; |
  |  | 1544 | if ( '' !== $user\_email ) { |
  |  | 1545 | $crypt\_key         = wcal\_get\_crypt\_key( $user\_email, true, $cart\_id ); |
  |  | 1546 | $encoding\_checkout = $cart\_id . '&url=' . $checkout\_page\_link; |
  |  | 1547 | $validate\_checkout = Wcal\_Common::wcal\_encrypt\_validate( $encoding\_checkout, $crypt\_key ); |
  |  | 1548 |  |
  |  | 1549 | $checkout\_link = get\_option( 'siteurl' ) . '/?wcal\_action=checkout\_link&user\_email=' . $user\_email . '&validate=' . $validate\_checkout; |
  |  | 1550 | $wpdb->update( // phpcs:ignore |
  |  | 1551 | $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite', |
  |  | 1552 | array( |
  |  | 1553 | 'checkout\_link' => $checkout\_link, |
  |  | 1554 | ), |
  |  | 1555 | array( |
  |  | 1556 | 'id' => $cart\_id, |
  |  | 1557 | ) |
  |  | 1558 | ); |
  |  | 1559 | } |
  | 1555 | 1560 | } |
  | 1556 | 1561 |  |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/class-wcal-common.php?rev=2773841#L1558) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/includes/class-wcal-common.php?rev=2922242#L1563) |  |
  | 1558 | 1563 | \* This function is used to encode the string. |
  | 1559 | 1564 | \* |
  | 1560 |  | \* @param string $validate String need to encrypt. |
  | 1561 |  | \* @return string $validate\_encoded Encrypted string. |
  |  | 1565 | \* @param string $validate - String need to encrypt. |
  |  | 1566 | \* @param string $crypt\_key - Key to use for encryption. |
  |  | 1567 | \* |
  |  | 1568 | \* @return string $validate\_encoded -  Encrypted string. |
  | 1562 | 1569 | \* @since 1.3 |
  | 1563 | 1570 | \*/ |
  | 1564 |  | public static function wcal\_encrypt\_validate( $validate ) { |
  | 1565 |  | $crypt\_key        = get\_option( 'wcal\_security\_key' ); |
  | 1566 |  | $validate\_encoded = Wcal\_Aes\_Ctr::encrypt( $validate, $crypt\_key, 256 ); |
  | 1567 |  | return( $validate\_encoded ); |
  |  | 1571 | public static function wcal\_encrypt\_validate( $validate, $crypt\_key ) { |
  |  | 1572 | // Fetch the encrypt key. |
  |  | 1573 | if ( '' !== $crypt\_key ) { |
  |  | 1574 | $validate\_encoded = Wcal\_Aes\_Ctr::encrypt( $validate, $crypt\_key, 256 ); |
  |  | 1575 | return( $validate\_encoded ); |
  |  | 1576 | } |
  |  | 1577 | return false; |
  | 1568 | 1578 | } |
  | 1569 | 1579 | } |
* ## [woocommerce-abandoned-cart/tags/5.15.0/includes/classes/class-wcal-dashboard-report.php](/changeset/2922242/woocommerce-abandoned-cart/tags/5.15.0/includes/classes/class-wcal-dashboard-report.php "Show the changeset 2922242 restricted to woocommerce-abandoned-cart/tags/5.15.0/includes/classes/class-wcal-dashboard-report.php")

  | [r2773841](/browser/woocommerce-abandoned-cart/trunk/includes/classes/class-wcal-dashboard-report.php?rev=2773841#L453 "Show revision 2773841 of this file in browser") | [r2922242](/browser/woocommerce-abandoned-cart/tags/5.15.0/includes/classes/class-wcal-dashboard-report.php?rev=2922242#L453 "Show revision 2922242 of this file in browser") |  |
  | --- | --- | --- |
  | 453 | 453 |  |
  | 454 | 454 | foreach ( $ids as $order\_id ) { |
  | 455 |  | $order\_total = (float) get\_post\_meta( $order\_id, '\_order\_total', true ); |
  |  | 455 | $order       = wc\_get\_order( $order\_id ); |
  |  | 456 | $order\_total = $order ? (float) $order->get\_total() : 0; |
  | 456 | 457 | $amount     += round( $order\_total, 2 ); |
  | 457 | 458 | } |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/classes/class-wcal-dashboard-report.php?rev=2773841#L514) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/includes/classes/class-wcal-dashboard-report.php?rev=2922242#L515) |  |
  | 514 | 515 |  |
  | 515 | 516 | if ( $cart\_value->recovered\_cart > 0 ) { |
  | 516 |  | $abandoned\_amount += get\_post\_meta( $cart\_value->recovered\_cart, '\_order\_total', true ); |
  |  | 517 | $order             = wc\_get\_order( $cart\_value->recovered\_cart ); |
  |  | 518 | $abandoned\_amount += $order ? $order->get\_total() : 0; |
  | 517 | 519 | $abandoned\_count++; |
  | 518 | 520 | } else { |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/classes/class-wcal-dashboard-report.php?rev=2773841#L632) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/includes/classes/class-wcal-dashboard-report.php?rev=2922242#L634) |  |
  | 632 | 634 | $recovered\_id      = $cart\_value->recovered\_cart; |
  | 633 | 635 | if ( (int) $recovered\_id > 0 ) { |
  | 634 |  | $rec\_order\_total   = get\_post\_meta( $recovered\_id, '\_order\_total', true ); |
  |  | 636 | $order             = wc\_get\_order( $recovered\_id ); |
  |  | 637 | $rec\_order\_total   = $order ? $order->get\_total() : 0; |
  | 635 | 638 | $recovered\_amount += isset( $rec\_order\_total ) && $rec\_order\_total > 0 ? $rec\_order\_total : 0; |
  | 636 | 639 | } |
* ## [woocommerce-abandoned-cart/tags/5.15.0/includes/classes/class-wcal-recover-orders-table.php](/changeset/2922242/woocommerce-abandoned-cart/tags/5.15.0/includes/classes/class-wcal-recover-orders-table.php "Show the changeset 2922242 restricted to woocommerce-abandoned-cart/tags/5.15.0/includes/classes/class-wcal-recover-orders-table.php")

  | [r2451828](/browser/woocommerce-abandoned-cart/trunk/includes/classes/class-wcal-recover-orders-table.php?rev=2451828#L286 "Show revision 2451828 of this file in browser") | [r2922242](/browser/woocommerce-abandoned-cart/tags/5.15.0/includes/classes/class-wcal-recover-orders-table.php?rev=2922242#L286 "Show revision 2922242 of this file in browser") |  |
  | --- | --- | --- |
  | 286 | 286 | $woo\_order = wc\_get\_order( $recovered\_id ); |
  | 287 | 287 | if ( version\_compare( $woocommerce->version, '3.0.0', '>=' ) ) { |
  | 288 |  | $order                 = ~~get\_post~~( $recovered\_id ); |
  | 289 |  | $recovered\_date        = strtotime( $order->~~post\_date~~ ); |
  |  | 288 | $order                 = wc\_get\_order( $recovered\_id ); |
  |  | 289 | $recovered\_date        = strtotime( $order->get\_date\_created()->date( 'Y-m-d H:i:s' ) ); |
  | 290 | 290 | $recovered\_date\_format = date\_i18n( get\_option( 'date\_format' ), $recovered\_date ); |
  | 291 | 291 | $recovered\_time\_format = date\_i18n( get\_option( 'time\_format' ), $recovered\_date ); |
* ## [woocommerce-abandoned-cart/tags/5.15.0/includes/frontend/class-wcal-checkout-process.php](/changeset/2922242/woocommerce-abandoned-cart/tags/5.15.0/includes/frontend/class-wcal-checkout-process.php "Show the changeset 2922242 restricted to woocommerce-abandoned-cart/tags/5.15.0/includes/frontend/class-wcal-checkout-process.php")

  | [r2868556](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2868556#L50 "Show revision 2868556 of this file in browser") | [r2922242](/browser/woocommerce-abandoned-cart/tags/5.15.0/includes/frontend/class-wcal-checkout-process.php?rev=2922242#L50 "Show revision 2922242 of this file in browser") |  |
  | --- | --- | --- |
  | 50 | 50 | $wcal\_get\_order\_status = $order->get\_status(); |
  | 51 | 51 |  |
  | 52 |  | $get\_abandoned\_id\_of\_order  = ~~get\_post\_meta( $order\_id, 'wcal\_recover\_order\_placed', true~~ ); |
  | 53 |  | $get\_sent\_email\_id\_of\_order = ~~get\_post\_meta( $order\_id, 'wcal\_recover\_order\_placed\_sent\_id', true~~ ); |
  |  | 52 | $get\_abandoned\_id\_of\_order  = $order->get\_meta( 'wcal\_recover\_order\_placed' ); |
  |  | 53 | $get\_sent\_email\_id\_of\_order = $order->get\_meta( 'wcal\_recover\_order\_placed\_sent\_id' ); |
  | 54 | 54 | $recovered                  = wcal\_common::wcal\_get\_cart\_session( 'wcal\_recovered\_cart' ); |
  | 55 | 55 | if ( ( isset( $get\_sent\_email\_id\_of\_order ) && '' !== $get\_sent\_email\_id\_of\_order ) || $recovered ) { |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2868556#L110) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/includes/frontend/class-wcal-checkout-process.php?rev=2922242#L110) |  |
  | 110 | 110 | array( 'id' => $get\_abandoned\_id\_of\_order ) |
  | 111 | 111 | ); |
  | 112 |  | delete\_post\_meta( $order\_id, 'wcal\_recover\_order\_placed', $get\_abandoned\_id\_of\_order ); |
  |  | 112 | $order = wc\_get\_order( $order\_id ); |
  |  | 113 | $order->delete\_meta\_data( 'wcal\_recover\_order\_placed', $get\_abandoned\_id\_of\_order ); |
  |  | 114 | $order->save(); |
  | 113 | 115 | } |
  | 114 | 116 | } |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2868556#L182) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/includes/frontend/class-wcal-checkout-process.php?rev=2922242#L184) |  |
  | 182 | 184 | $update\_sent\_history = array(); |
  | 183 | 185 |  |
  | 184 |  | if ( '' !== ~~get\_post\_meta( $order\_id, 'wcal\_abandoned\_timestamp', true~~ ) ) { |
  | 185 |  | $update\_details['abandoned\_cart\_time']     = ~~get\_post\_meta( $order\_id, 'wcal\_abandoned\_timestamp', true~~ ); |
  |  | 186 | if ( '' !== $order->get\_meta( 'wcal\_abandoned\_timestamp' ) ) { |
  |  | 187 | $update\_details['abandoned\_cart\_time']     = $order->get\_meta( 'wcal\_abandoned\_timestamp' ); |
  | 186 | 188 | $update\_sent\_history['abandoned\_order\_id'] = $cart\_id; |
  | 187 | 189 |  |
  | 188 |  | ~~delete\_post\_meta( $order\_id,~~ 'wcal\_abandoned\_timestamp', $update\_details['abandoned\_cart\_time'] ); |
  |  | 190 | $order->delete\_meta\_data( 'wcal\_abandoned\_timestamp', $update\_details['abandoned\_cart\_time'] ); |
  | 189 | 191 | // update the email sent history table. |
  | 190 | 192 | if ( is\_array( $get\_ids ) && count( $get\_ids ) > 1 ) { |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2868556#L215) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/includes/frontend/class-wcal-checkout-process.php?rev=2922242#L217) |  |
  | 215 | 217 | // Add Order Note. |
  | 216 | 218 | $order->add\_order\_note( \_\_( 'This order was abandoned & subsequently recovered.', 'woocommerce-abandoned-cart' ) ); |
  | 217 |  | delete\_post\_meta( $order\_id, 'wcal\_abandoned\_cart\_id' ); |
  | 218 |  | delete\_post\_meta( $order\_id, 'wcal\_recover\_order\_placed' ); |
  | 219 |  | delete\_post\_meta( $order\_id, 'wcal\_recover\_order\_placed\_sent\_id' ); |
  | 220 |  | delete\_post\_meta( $order\_id, 'wcal\_recovered\_email\_sent' ); |
  |  | 219 | $order->delete\_meta\_data( 'wcal\_abandoned\_cart\_id' ); |
  |  | 220 | $order->delete\_meta\_data( 'wcal\_recover\_order\_placed' ); |
  |  | 221 | $order->delete\_meta\_data( 'wcal\_recover\_order\_placed\_sent\_id' ); |
  |  | 222 | $order->delete\_meta\_data( 'wcal\_recovered\_email\_sent' ); |
  |  | 223 | $order->save(); |
  | 221 | 224 | do\_action( 'wcal\_cart\_recovered', $cart\_id, $order\_id ); |
  | 222 | 225 | } |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2868556#L243) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/includes/frontend/class-wcal-checkout-process.php?rev=2922242#L246) |  |
  | 243 | 246 | $wcal\_guest\_table\_name      = $wpdb->prefix . 'ac\_guest\_abandoned\_cart\_history\_lite'; |
  | 244 | 247 | $wcal\_sent\_email\_table\_name = $wpdb->prefix . 'ac\_sent\_history\_lite'; |
  |  | 248 | $order                      = wc\_get\_order( $order\_id ); |
  | 245 | 249 |  |
  | 246 | 250 | if ( $order\_id > 0 ) { |
  | 247 |  | $get\_abandoned\_id\_of\_order = ~~get\_post\_meta( $order\_id, 'wcal\_recover\_order\_placed', true~~ ); |
  |  | 251 | $get\_abandoned\_id\_of\_order = $order->get\_meta( 'wcal\_recover\_order\_placed' ); |
  | 248 | 252 |  |
  | 249 | 253 | if ( $get\_abandoned\_id\_of\_order > 0 || '' != wcal\_common::wcal\_get\_cart\_session( 'email\_sent\_id' ) ) { // phpcs:ignore |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2868556#L251) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/includes/frontend/class-wcal-checkout-process.php?rev=2922242#L255) |  |
  | 251 | 255 | } else { |
  | 252 | 256 |  |
  | 253 |  | $wcal\_abandoned\_id = ~~get\_post\_meta( $order\_id, 'wcal\_abandoned\_cart\_id', true~~ ); |
  |  | 257 | $wcal\_abandoned\_id = $order->get\_meta( 'wcal\_abandoned\_cart\_id' ); |
  | 254 | 258 | // check if it's a guest cart. |
  | 255 | 259 | // phpcs:ignore WordPress.DB.DirectDatabaseQuery |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2868556#L279) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/includes/frontend/class-wcal-checkout-process.php?rev=2922242#L283) |  |
  | 279 | 283 |  |
  | 280 | 284 | $wcal\_history\_table\_name = $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite'; |
  | 281 |  | $wcal\_abandoned\_id       = get\_post\_meta( $order\_id, 'wcal\_abandoned\_cart\_id', true ); |
  |  | 285 | $order                   = wc\_get\_order( $order\_id ); |
  |  | 286 | $wcal\_abandoned\_id       = $order->get\_meta( 'wcal\_abandoned\_cart\_id' ); |
  | 282 | 287 |  |
  | 283 | 288 | $wpdb->update(  // phpcs:ignore |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2868556#L317) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/includes/frontend/class-wcal-checkout-process.php?rev=2922242#L322) |  |
  | 317 | 322 | } |
  | 318 | 323 | if ( 'on' === $ac\_email\_admin\_recovery ) { |
  | 319 |  | $recovered\_email\_sent          = ~~get\_post\_meta( $order\_id, 'wcal\_recovered\_email\_sent', true~~ ); |
  |  | 324 | $recovered\_email\_sent          = $order->get\_meta( 'wcal\_recovered\_email\_sent' ); |
  | 320 | 325 | $wcal\_check\_order\_is\_recovered = $this->wcal\_check\_order\_is\_recovered( $order\_id ); |
  | 321 | 326 |  |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2868556#L347) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/includes/frontend/class-wcal-checkout-process.php?rev=2922242#L352) |  |
  | 347 | 352 | $email\_body = ob\_get\_clean(); |
  | 348 | 353 | wc\_mail( $user\_email, $email\_subject, $email\_body, $headers ); |
  | 349 |  |  |
  | 350 |  | ~~update\_post\_meta( $order\_id, 'wcal\_recovered\_email\_sent', 'yes'~~ ); |
  |  | 354 | $order->update\_meta\_data( 'wcal\_recovered\_email\_sent', 'yes' ); |
  |  | 355 | $order->save(); |
  | 351 | 356 | } |
  | 352 | 357 | } |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2868556#L396) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/includes/frontend/class-wcal-checkout-process.php?rev=2922242#L401) |  |
  | 396 | 401 | $order = wc\_get\_order( $order\_id ); |
  | 397 | 402 |  |
  | 398 |  | $get\_abandoned\_id\_of\_order  = ~~get\_post\_meta( $order\_id, 'wcal\_recover\_order\_placed', true~~ ); |
  | 399 |  | $get\_sent\_email\_id\_of\_order = ~~get\_post\_meta( $order\_id, 'wcal\_recover\_order\_placed\_sent\_id', true~~ ); |
  |  | 403 | $get\_abandoned\_id\_of\_order  = $order->get\_meta( 'wcal\_recover\_order\_placed' ); |
  |  | 404 | $get\_sent\_email\_id\_of\_order = $order->get\_meta( 'wcal\_recover\_order\_placed\_sent\_id' ); |
  | 400 | 405 |  |
  | 401 | 406 | // Order Status passed in the function is either 'processing' or 'complete' and may or may not reflect the actual order status. |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2868556#L423) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/includes/frontend/class-wcal-checkout-process.php?rev=2922242#L428) |  |
  | 423 | 428 |  |
  | 424 | 429 | if ( $wcal\_user\_id >= 63000000 ) { |
  | 425 |  | ~~add\_post\_meta( $order\_id,~~ 'wcal\_abandoned\_timestamp', $ac\_user\_id\_result[0]->abandoned\_cart\_time ); |
  |  | 430 | $order->add\_meta\_data( 'wcal\_abandoned\_timestamp', $ac\_user\_id\_result[0]->abandoned\_cart\_time ); |
  | 426 | 431 |  |
  | 427 | 432 | $wpdb->delete( // phpcs:ignore |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2868556#L435) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/includes/frontend/class-wcal-checkout-process.php?rev=2922242#L440) |  |
  | 435 | 440 | array( 'id' => $get\_abandoned\_id\_of\_order ) |
  | 436 | 441 | ); |
  | 437 |  | delete\_post\_meta( $order\_id, 'wcal\_recover\_order\_placed', $get\_abandoned\_id\_of\_order ); |
  |  | 442 | $order->delete\_meta\_data( 'wcal\_recover\_order\_placed', $get\_abandoned\_id\_of\_order ); |
  |  | 443 | $order->save(); |
  | 438 | 444 | } |
  | 439 | 445 | } |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2868556#L476) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/includes/frontend/class-wcal-checkout-process.php?rev=2922242#L482) |  |
  | 476 | 482 | $wcal\_user\_id\_of\_guest = wcal\_common::wcal\_get\_cart\_session( 'user\_id' ); |
  | 477 | 483 | $recovered             = wcal\_common::wcal\_get\_cart\_session( 'wcal\_recovered\_cart' ); |
  |  | 484 | $order                 = wc\_get\_order( $order\_id ); |
  | 478 | 485 |  |
  | 479 | 486 | $wcal\_history\_table\_name    = $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite'; |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2868556#L515) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/includes/frontend/class-wcal-checkout-process.php?rev=2922242#L522) |  |
  | 515 | 522 | $abandoned\_order\_id\_of\_guest = $get\_ac\_id\_guest\_results[0]->id; |
  | 516 | 523 |  |
  | 517 |  | ~~add\_post\_meta( $order\_id,~~ 'wcal\_abandoned\_timestamp', $get\_ac\_id\_guest\_results[0]->abandoned\_cart\_time ); |
  |  | 524 | $order->add\_meta\_data( 'wcal\_abandoned\_timestamp', $get\_ac\_id\_guest\_results[0]->abandoned\_cart\_time ); |
  | 518 | 525 |  |
  | 519 | 526 | $wpdb->delete( // phpcs:ignore |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2868556#L531) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/includes/frontend/class-wcal-checkout-process.php?rev=2922242#L538) |  |
  | 531 | 538 | } |
  | 532 | 539 |  |
  | 533 |  | ~~add\_post\_meta( $order\_id,~~ 'wcal\_recover\_order\_placed\_sent\_id', $email\_sent\_id ); |
  | 534 |  | ~~add\_post\_meta( $order\_id,~~ 'wcal\_recover\_order\_placed', $abandoned\_order\_id ); |
  |  | 540 | $order->add\_meta\_data( 'wcal\_recover\_order\_placed\_sent\_id', $email\_sent\_id ); |
  |  | 541 | $order->add\_meta\_data( 'wcal\_recover\_order\_placed', $abandoned\_order\_id ); |
  | 535 | 542 | } elseif ( '' !== $abandoned\_order\_id ) { |
  | 536 | 543 |  |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2868556#L552) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/includes/frontend/class-wcal-checkout-process.php?rev=2922242#L559) |  |
  | 552 | 559 | } |
  | 553 | 560 |  |
  | 554 |  | add\_post\_meta( $order\_id, 'wcal\_abandoned\_cart\_id', $abandoned\_order\_id\_to\_save ); |
  |  | 561 | $order->add\_meta\_data( 'wcal\_abandoned\_cart\_id', $abandoned\_order\_id\_to\_save ); |
  |  | 562 | $order->save(); |
  | 555 | 563 | } |
  | 556 | 564 | } |
* ## [woocommerce-abandoned-cart/tags/5.15.0/includes/wcal-functions.php](/changeset/2922242/woocommerce-abandoned-cart/tags/5.15.0/includes/wcal-functions.php "Show the changeset 2922242 restricted to woocommerce-abandoned-cart/tags/5.15.0/includes/wcal-functions.php")

  | [r2674975](/browser/woocommerce-abandoned-cart/trunk/includes/wcal-functions.php?rev=2674975#L9 "Show revision 2674975 of this file in browser") | [r2922242](/browser/woocommerce-abandoned-cart/tags/5.15.0/includes/wcal-functions.php?rev=2922242#L9 "Show revision 2922242 of this file in browser") |  |
  | --- | --- | --- |
  | 9 | 9 | \* @since 5.12.0 |
  | 10 | 10 | \*/ |
  |  | 11 |  |
  |  | 12 | use Automattic\WooCommerce\Utilities\OrderUtil; |
  | 11 | 13 |  |
  | 12 | 14 | /\*\* |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/wcal-functions.php?rev=2674975#L86) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/includes/wcal-functions.php?rev=2922242#L88) |  |
  | 86 | 88 | return $product\_details; |
  | 87 | 89 | } |
  |  | 90 |  |
  |  | 91 | /\*\* |
  |  | 92 | \* Return a Random key which can be used for encryption. |
  |  | 93 | \* |
  |  | 94 | \* @param string $user\_email - User EMail Address. |
  |  | 95 | \* @param bool   $insert - Insert and save the crypt key in the sent history table. |
  |  | 96 | \* @param int    $cart\_id - Abandoned Cart ID. |
  |  | 97 | \* @return string $crypt\_key - Key to be used for encryption. |
  |  | 98 | \* |
  |  | 99 | \* @since 5.14.0 |
  |  | 100 | \*/ |
  |  | 101 | function wcal\_get\_crypt\_key( $user\_email, $insert = false, $cart\_id = 0 ) { |
  |  | 102 | global $wpdb; |
  |  | 103 |  |
  |  | 104 | $crypt\_key = $wpdb->get\_var( // phpcs:ignore |
  |  | 105 | $wpdb->prepare( |
  |  | 106 | 'SELECT encrypt\_key FROM `' . $wpdb->prefix . 'ac\_sent\_history\_lite` WHERE sent\_email\_id = %s ORDER BY id DESC', |
  |  | 107 | $user\_email |
  |  | 108 | ) |
  |  | 109 | ); |
  |  | 110 |  |
  |  | 111 | if ( '' === $crypt\_key ) { |
  |  | 112 | $crypt\_key = wcal\_generate\_random\_key(); |
  |  | 113 | if ( $insert ) { // This is true when the checkout link is generated and simply saved in the cart history table. |
  |  | 114 | $wpdb->insert( // phpcs:ignore |
  |  | 115 | $wpdb->prefix . 'ac\_sent\_history\_lite', |
  |  | 116 | array( |
  |  | 117 | 'template\_id'        => 0, |
  |  | 118 | 'abandoned\_order\_id' => $cart\_id, |
  |  | 119 | 'sent\_time'          => current\_time( 'mysql' ), |
  |  | 120 | 'sent\_email\_id'      => $user\_email, |
  |  | 121 | 'encrypt\_key'        => $crypt\_key, |
  |  | 122 | ) |
  |  | 123 | ); |
  |  | 124 |  |
  |  | 125 | } |
  |  | 126 | } |
  |  | 127 | return $crypt\_key; |
  |  | 128 | } |
  |  | 129 |  |
  |  | 130 | /\*\* |
  |  | 131 | \* Generate a 16 digit random key. |
  |  | 132 | \* |
  |  | 133 | \* @return string $random\_string - Random String. |
  |  | 134 | \* @since 5.14.0 |
  |  | 135 | \*/ |
  |  | 136 | function wcal\_generate\_random\_key() { |
  |  | 137 | $characters    = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'; |
  |  | 138 | $random\_string = ''; |
  |  | 139 | $n             = 16; |
  |  | 140 | for ( $i = 0; $i < $n; $i++ ) { |
  |  | 141 | $index          = wp\_rand( 0, strlen( $characters ) - 1 ); |
  |  | 142 | $random\_string .= $characters[ $index ]; |
  |  | 143 | } |
  |  | 144 |  |
  |  | 145 | return $random\_string; |
  |  | 146 | } |
  |  | 147 |  |
  |  | 148 | /\*\* |
  |  | 149 | \* Return personal details for user. |
  |  | 150 | \* |
  |  | 151 | \* @param int $abandoned\_id - Cart ID. |
  |  | 152 | \* @return array $customer\_data - Customer Details. |
  |  | 153 | \* |
  |  | 154 | \* @since 5.14.0 |
  |  | 155 | \*/ |
  |  | 156 | function wcal\_get\_contact\_data( $abandoned\_id ) { |
  |  | 157 | // Fetch the contact data. |
  |  | 158 | $cart\_history  = wcal\_get\_data\_cart\_history( $abandoned\_id ); |
  |  | 159 | $customer\_data = array(); |
  |  | 160 | if ( $cart\_history ) { |
  |  | 161 | // Defaults. |
  |  | 162 | $email     = ''; |
  |  | 163 | $firstname = ''; |
  |  | 164 | $lastname  = ''; |
  |  | 165 | $user\_id   = $cart\_history->user\_id; |
  |  | 166 | $user\_type = $cart\_history->user\_type; |
  |  | 167 |  |
  |  | 168 | if ( $user\_id >= 63000000 && 'GUEST' === $user\_type ) { |
  |  | 169 | $guest\_data = wcal\_get\_data\_guest\_history( $user\_id ); |
  |  | 170 | if ( isset( $cart\_history ) && isset( $guest\_data ) ) { |
  |  | 171 | $email     = $guest\_data->email\_id; |
  |  | 172 | $firstname = $guest\_data->billing\_first\_name; |
  |  | 173 | $lastname  = $guest\_data->billing\_last\_name; |
  |  | 174 | } |
  |  | 175 | } elseif ( $user\_id > 0 ) { |
  |  | 176 | // Get the first & last name from the user data. |
  |  | 177 | $user\_info = new WP\_User( $user\_id ); |
  |  | 178 | $firstname = $user\_info->first\_name; |
  |  | 179 | $lastname  = $user\_info->last\_name; |
  |  | 180 | $email     = $user\_info->user\_email; |
  |  | 181 | } |
  |  | 182 | $customer\_data['firstname'] = $firstname; |
  |  | 183 | $customer\_data['lastname']  = $lastname; |
  |  | 184 | $customer\_data['email']     = $email; |
  |  | 185 | $customer\_data['user\_id']   = $user\_id; |
  |  | 186 | } |
  |  | 187 | return $customer\_data; |
  |  | 188 | } |
  |  | 189 |  |
  |  | 190 | /\*\* |
  |  | 191 | \* Returns if HPOS is enabled |
  |  | 192 | \* |
  |  | 193 | \* @return bool |
  |  | 194 | \* @since  5.14.2 |
  |  | 195 | \*/ |
  |  | 196 | function wcal\_is\_hpos\_enabled() { |
  |  | 197 | if ( version\_compare( WOOCOMMERCE\_VERSION, '7.1.0' ) < 0 ) { |
  |  | 198 | return false; |
  |  | 199 | } |
  |  | 200 | if ( OrderUtil::custom\_orders\_table\_usage\_is\_enabled() ) { |
  |  | 201 | return true; |
  |  | 202 | } |
  |  | 203 | return false; |
  |  | 204 | } |
* ## [woocommerce-abandoned-cart/tags/5.15.0/readme.txt](/changeset/2922242/woocommerce-abandoned-cart/tags/5.15.0/readme.txt "Show the changeset 2922242 restricted to woocommerce-abandoned-cart/tags/5.15.0/readme.txt")

  | [r2916178](/browser/woocommerce-abandoned-cart/trunk/readme.txt?rev=2916178#L156 "Show revision 2916178 of this file in browser") | [r2922242](/browser/woocommerce-abandoned-cart/tags/5.15.0/readme.txt?rev=2922242#L156 "Show revision 2922242 of this file in browser") |  |
  | --- | --- | --- |
  | 156 | 156 |  |
  | 157 | 157 | == Changelog == |
  |  | 158 |  |
  |  | 159 | = 5.15.0 ( 06.06.2023 ) = |
  |  | 160 | \* Fix - A fatal error received when clicked on checkout link from webhook. |
  |  | 161 | \* Fix - Vulnerability fix for hardcoded encryption key. |
  |  | 162 | \* Enhancement - Introduced compatibility with WooCommerce High Performance Order Storage. |
  | 158 | 163 |  |
  | 159 | 164 | = 5.14.2 ( 23.05.2023 ) = |
* ## [woocommerce-abandoned-cart/tags/5.15.0/woocommerce-ac.php](/changeset/2922242/woocommerce-abandoned-cart/tags/5.15.0/woocommerce-ac.php "Show the changeset 2922242 restricted to woocommerce-abandoned-cart/tags/5.15.0/woocommerce-ac.php")

  | [r2916178](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2916178#L4 "Show revision 2916178 of this file in browser") | [r2922242](/browser/woocommerce-abandoned-cart/tags/5.15.0/woocommerce-ac.php?rev=2922242#L4 "Show revision 2922242 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* Plugin URI: http://www.tychesoftwares.com/store/premium-plugins/woocommerce-abandoned-cart-pro |
  | 5 | 5 | \* Description: This plugin captures abandoned carts by logged-in users & emails them about it. <strong><a href="http://www.tychesoftwares.com/store/premium-plugins/woocommerce-abandoned-cart-pro">Click here to get the PRO Version.</a></strong> |
  | 6 |  | \* Version: 5.1~~4.2~~ |
  |  | 6 | \* Version: 5.15.0 |
  | 7 | 7 | \* Author: Tyche Softwares |
  | 8 | 8 | \* Author URI: http://www.tychesoftwares.com/ |
  | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2916178#L11) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/woocommerce-ac.php?rev=2922242#L11) |  |
  | 11 | 11 | \* Requires PHP: 5.6 |
  | 12 | 12 | \* WC requires at least: 4.0.0 |
  | 13 |  | \* WC tested up to: 7.7 |
  |  | 13 | \* WC tested up to: 7.7.2 |
  | 14 | 14 | \* |
  | 15 | 15 | \* @package Abandoned-Cart-Lite-for-WooCommerce |
  | 16 | 16 | \*/ |
  |  | 17 |  |
  |  | 18 | use Automattic\WooCommerce\Utilities\OrderUtil; |
  | 17 | 19 |  |
  | 18 | 20 | require\_once 'class-wcal-update.php'; |
  | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2916178#L125) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/woocommerce-ac.php?rev=2922242#L127) |  |
  | 125 | 127 |  |
  | 126 | 128 | if ( ! defined( 'WCAL\_PLUGIN\_VERSION' ) ) { |
  | 127 |  | define( 'WCAL\_PLUGIN\_VERSION', '5.1~~4.2~~' ); |
  |  | 129 | define( 'WCAL\_PLUGIN\_VERSION', '5.15.0' ); |
  | 128 | 130 | } |
  | 129 | 131 |  |
  | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2916178#L194) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/woocommerce-ac.php?rev=2922242#L196) |  |
  | 194 | 196 | // WordPress Administration Menu. |
  | 195 | 197 | add\_action( 'admin\_menu', array( &$this, 'wcal\_admin\_menu' ) ); |
  |  | 198 | add\_action( 'before\_woocommerce\_init', array( &$this, 'wcal\_custom\_order\_tables\_compatibility' ), 999 ); |
  | 196 | 199 |  |
  | 197 | 200 | // Actions to be done on cart update. |
  | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2916178#L590) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/woocommerce-ac.php?rev=2922242#L593) |  |
  | 590 | 593 | do\_action( 'wcal\_deactivate' ); |
  | 591 | 594 | } |
  |  | 595 | /\*\* |
  |  | 596 | \* Sets the compatibility with Woocommerce HPOS. |
  |  | 597 | \* |
  |  | 598 | \* @since 5.14.2 |
  |  | 599 | \*/ |
  |  | 600 | public static function wcal\_custom\_order\_tables\_compatibility() { |
  |  | 601 |  |
  |  | 602 | if ( class\_exists( '\Automattic\WooCommerce\Utilities\FeaturesUtil' ) ) { |
  |  | 603 | \Automattic\WooCommerce\Utilities\FeaturesUtil::declare\_compatibility( 'custom\_order\_tables', 'woocommerce-abandoned-cart/woocommerce-ac.php', true ); |
  |  | 604 | \Automattic\WooCommerce\Utilities\FeaturesUtil::declare\_compatibility( 'orders\_cache', 'woocommerce-abandoned-cart/woocommerce-ac.php', true ); |
  |  | 605 | } |
  |  | 606 | } |
  | 592 | 607 |  |
  | 593 | 608 | /\*\* |
  | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2916178#L638) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/woocommerce-ac.php?rev=2922242#L653) |  |
  | 638 | 653 | `sent\_time` datetime NOT NULL, |
  | 639 | 654 | `sent\_email\_id` text COLLATE utf8\_unicode\_ci NOT NULL, |
  |  | 655 | `encrypt\_key` varchar(500) COLLATE utf8\_unicode\_ci NOT NULL, |
  | 640 | 656 | PRIMARY KEY  (`id`) |
  | 641 | 657 | ) $wcap\_collate AUTO\_INCREMENT=1 " // phpcs:ignore |
  | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2916178#L1728) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/woocommerce-ac.php?rev=2922242#L1744) |  |
  | 1728 | 1744 | $validate\_email\_address\_string = ''; |
  | 1729 | 1745 | $validate\_email\_id\_decode      = 0; |
  | 1730 |  | $crypt\_key                     = get\_option( 'wcal\_security\_key' ); |
  | 1731 |  | $validate\_email\_id\_decode      = Wcal\_Aes\_Ctr::decrypt( $validate\_email\_id\_string, $crypt\_key, 256 ); |
  |  | 1746 | if ( isset( $\_GET['user\_email'] ) && '' !== $\_GET['user\_email'] ) { // phpcs:ignore |
  |  | 1747 | $sent\_email = sanitize\_text\_field( wp\_unslash( $\_GET['user\_email'] ) ); // phpcs:ignore |
  |  | 1748 | $crypt\_key  = $wpdb->get\_var( // phpcs:ignore |
  |  | 1749 | $wpdb->prepare( |
  |  | 1750 | 'SELECT encrypt\_key FROM `' . $wpdb->prefix . 'ac\_sent\_history\_lite` WHERE sent\_email\_id = %s ORDER BY id DESC', |
  |  | 1751 | $sent\_email |
  |  | 1752 | ) |
  |  | 1753 | ); |
  |  | 1754 | } else { |
  |  | 1755 | $crypt\_key = get\_option( 'wcal\_security\_key' ); |
  |  | 1756 | } |
  |  | 1757 | $validate\_email\_id\_decode = Wcal\_Aes\_Ctr::decrypt( $validate\_email\_id\_string, $crypt\_key, 256 ); |
  | 1732 | 1758 | if ( isset( $\_GET['track\_email\_id'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  | 1733 | 1759 | $encoded\_email\_address         = rawurldecode( sanitize\_text\_field( wp\_unslash( $\_GET['track\_email\_id'] ) ) ); // phpcs:ignore WordPress.Security.NonceVerification |
  | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2916178#L1812) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/woocommerce-ac.php?rev=2922242#L1838) |  |
  | 1812 | 1838 | $validate\_server\_string  = str\_replace( ' ', '+', $validate\_server\_string ); |
  | 1813 | 1839 | $validate\_encoded\_string = $validate\_server\_string; |
  | 1814 |  | $crypt\_key               = get\_option( 'wcal\_security\_key' ); |
  | 1815 |  | $link\_decode             = Wcal\_Aes\_Ctr::decrypt( $validate\_encoded\_string, $crypt\_key, 256 ); |
  | 1816 |  | $sent\_email\_id\_pos       = strpos( $link\_decode, '&' ); |
  | 1817 |  | $email\_sent\_id           = substr( $link\_decode, 0, $sent\_email\_id\_pos ); |
  |  | 1840 | if ( isset( $\_GET['user\_email'] ) && '' !== $\_GET['user\_email'] ) { // phpcs:ignore |
  |  | 1841 | $sent\_email = sanitize\_text\_field( wp\_unslash( $\_GET['user\_email'] ) ); // phpcs:ignore |
  |  | 1842 | $crypt\_key  = $wpdb->get\_var( // phpcs:ignore |
  |  | 1843 | $wpdb->prepare( |
  |  | 1844 | 'SELECT encrypt\_key FROM `' . $wpdb->prefix . 'ac\_sent\_history\_lite` WHERE sent\_email\_id = %s ORDER BY id DESC', |
  |  | 1845 | $sent\_email |
  |  | 1846 | ) |
  |  | 1847 | ); |
  |  | 1848 | } else { |
  |  | 1849 | $crypt\_key = get\_option( 'wcal\_security\_key' ); |
  |  | 1850 | } |
  |  | 1851 | $link\_decode       = Wcal\_Aes\_Ctr::decrypt( $validate\_encoded\_string, $crypt\_key, 256 ); |
  |  | 1852 | $sent\_email\_id\_pos = strpos( $link\_decode, '&' ); |
  |  | 1853 | $email\_sent\_id     = substr( $link\_decode, 0, $sent\_email\_id\_pos ); |
  | 1818 | 1854 |  |
  | 1819 | 1855 | if ( isset( $\_GET['c'] ) ) { // phpcs:ignore |
  | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2916178#L1948) | […](/browser/woocommerce-abandoned-cart/tags/5.15.0/woocommerce-ac.php?rev=2922242#L1984) |  |
  | 1948 | 1984 | if ( count( $saved\_cart ) > 0 ) { |
  | 1949 | 1985 | foreach ( $saved\_cart as $key => $value ) { |
  | 1950 |  | if ( count( $value ) > 0 ) { |
  |  | 1986 | if ( is\_array( $value ) && count( $value ) > 0 ) { |
  | 1951 | 1987 | foreach ( $value as $a => $b ) { |
  | 1952 | 1988 | $c['product\_id']        = $b['product\_id']; |
* ## [woocommerce-abandoned-cart/trunk/class-wcal-update.php](/changeset/2922242/woocommerce-abandoned-cart/trunk/class-wcal-update.php "Show the changeset 2922242 restricted to woocommerce-abandoned-cart/trunk/class-wcal-update.php")

  | [r2888174](/browser/woocommerce-abandoned-cart/trunk/class-wcal-update.php?rev=2888174#L242 "Show revision 2888174 of this file in browser") | [r2922242](/browser/woocommerce-abandoned-cart/trunk/class-wcal-update.php?rev=2922242#L242 "Show revision 2922242 of this file in browser") |  |
  | --- | --- | --- |
  | 242 | 242 |  |
  | 243 | 243 | if ( 0 === $blog\_id ) { |
  | 244 |  | ~~if ( ! get\_option( 'wcal\_security\_key' ) ) {~~ |
  | 245 |  | ~~update\_option( 'wcal\_security\_key', 'qJB0rGtIn5UB1xG03efyCp' );~~ |
  | 246 |  | ~~}~~ |
  | 247 |  |  |
  | 248 | 244 | update\_option( 'ac\_lite\_alter\_table\_queries', 'yes' ); |
  | 249 | 245 | } else { |
  | 250 |  | ~~if ( ! get\_blog\_option( $blog\_id, 'wcal\_security\_key' ) ) {~~ |
  | 251 |  | ~~update\_blog\_option( $blog\_id, 'wcal\_security\_key', 'qJB0rGtIn5UB1xG03efyCp' );~~ |
  | 252 |  | ~~}~~ |
  | 253 |  |  |
  | 254 | 246 | update\_blog\_option( $blog\_id, 'ac\_lite\_alter\_table\_queries', 'yes' ); |
  | 255 | 247 | } |
  | […](/browser/woocommerce-abandoned-cart/trunk/class-wcal-update.php?rev=2888174#L293) | […](/browser/woocommerce-abandoned-cart/trunk/class-wcal-update.php?rev=2922242#L285) |  |
  | 293 | 285 | if ( ! $wpdb->get\_var( 'SHOW COLUMNS FROM `' . $db\_prefix . "ac\_abandoned\_cart\_history\_lite` LIKE 'checkout\_link'" ) ) { // phpcs:ignore |
  | 294 | 286 | $wpdb->query( 'ALTER TABLE ' . $db\_prefix . 'ac\_abandoned\_cart\_history\_lite ADD `checkout\_link` varchar(500) NOT NULL AFTER `email\_reminder\_status`' ); // phpcs:ignore |
  |  | 287 | } |
  |  | 288 | // 5.14.3 |
  |  | 289 | if ( ! $wpdb->get\_var( 'SHOW COLUMNS FROM `' . $db\_prefix . "ac\_sent\_history\_lite` LIKE 'encrypt\_key';" ) ) { //phpcs:ignore |
  |  | 290 | $wpdb->query( 'ALTER TABLE ' . $db\_prefix . 'ac\_sent\_history\_lite ADD `encrypt\_key` VARCHAR(500) NOT NULL AFTER `sent\_email\_id`;' ); //phpcs:ignore |
  | 295 | 291 | } |
  | 296 | 292 | } |
* ## [woocommerce-abandoned-cart/trunk/cron/class-wcal-cron.php](/changeset/2922242/woocommerce-abandoned-cart/trunk/cron/class-wcal-cron.php "Show the changeset 2922242 restricted to woocommerce-abandoned-cart/trunk/cron/class-wcal-cron.php")

  | [r2916178](/browser/woocommerce-abandoned-cart/trunk/cron/class-wcal-cron.php?rev=2916178#L231 "Show revision 2916178 of this file in browser") | [r2922242](/browser/woocommerce-abandoned-cart/trunk/cron/class-wcal-cron.php?rev=2922242#L231 "Show revision 2922242 of this file in browser") |  |
  | --- | --- | --- |
  | 231 | 231 | $email\_body = str\_ireplace( '{{cart.abandoned\_date}}', $order\_date, $email\_body ); |
  | 232 | 232 |  |
  |  | 233 | $crypt\_key = wcal\_get\_crypt\_key( $value->user\_email ); |
  | 233 | 234 | $wpdb->query( // phpcs:ignore |
  | 234 | 235 | $wpdb->prepare( |
  | 235 |  | "INSERT INTO `" . $wpdb->prefix . "ac\_sent\_history\_lite` ( template\_id, abandoned\_order\_id, sent\_time, sent\_email\_id~~) VALUES ( %s, %s, '" . current\_time( 'mysql' ) . "'~~, %s )", // phpcs:ignore |
  |  | 236 | "INSERT INTO `" . $wpdb->prefix . "ac\_sent\_history\_lite` ( template\_id, abandoned\_order\_id, sent\_time, sent\_email\_id, encrypt\_key ) VALUES ( %s, %s, '" . current\_time( 'mysql' ) . "', %s, %s )", // phpcs:ignore |
  | 236 | 237 | $template\_id, |
  | 237 | 238 | $value->id, |
  | 238 |  | $value->user\_email |
  |  | 239 | $value->user\_email, |
  |  | 240 | $crypt\_key |
  | 239 | 241 | ) |
  | 240 | 242 | ); |
  | […](/browser/woocommerce-abandoned-cart/trunk/cron/class-wcal-cron.php?rev=2916178#L263) | […](/browser/woocommerce-abandoned-cart/trunk/cron/class-wcal-cron.php?rev=2922242#L265) |  |
  | 263 | 265 | $cart\_page\_link  = apply\_filters( 'wcal\_cart\_link\_email\_before\_encoding', $cart\_page\_link, $value->id ); |
  | 264 | 266 | $encoding\_cart   = $email\_sent\_id . '&url=' . $cart\_page\_link . $utm; |
  | 265 |  | $validate\_cart   = wcal\_common::wcal\_encrypt\_validate( $encoding\_cart ); |
  | 266 |  | $cart\_link\_track = get\_option( 'siteurl' ) . '/?wcal\_action=track\_links&validate=' . $validate\_cart; |
  |  | 267 | $validate\_cart   = wcal\_common::wcal\_encrypt\_validate( $encoding\_cart, $crypt\_key ); |
  |  | 268 | $cart\_link\_track = get\_option( 'siteurl' ) . '/?wcal\_action=track\_links&user\_email=' . $value->user\_email . '&validate=' . $validate\_cart; |
  | 267 | 269 |  |
  | 268 | 270 | list( $email\_body , $coupon\_code\_to\_apply ) = wcal\_common::wcal\_check\_and\_replace\_email\_tag( $email\_body, $wc\_email\_template ); |
  | 269 | 271 | if ( '' !== $coupon\_code\_to\_apply ) { |
  | 270 |  | $encypted\_coupon\_code = wcal\_common::wcal\_encrypt\_validate( $coupon\_code\_to\_apply ); |
  |  | 272 | $encypted\_coupon\_code = wcal\_common::wcal\_encrypt\_validate( $coupon\_code\_to\_apply, $crypt\_key ); |
  | 271 | 273 | $cart\_link\_track     .= '&c=' . $encypted\_coupon\_code; |
  | 272 | 274 | } |
  | 273 | 275 |  |
  | 274 | 276 | $email\_body           = str\_ireplace( '{{cart.link}}', $cart\_link\_track, $email\_body ); |
  | 275 |  | $validate\_unsubscribe = wcal\_common::wcal\_encrypt\_validate( $email\_sent\_id ); |
  |  | 277 | $validate\_unsubscribe = wcal\_common::wcal\_encrypt\_validate( $email\_sent\_id, $crypt\_key ); |
  | 276 | 278 | if ( count( $results\_sent ) > 0 && isset( $results\_sent[0]->sent\_email\_id ) ) { |
  | 277 | 279 | $email\_sent\_id\_address = $results\_sent[0]->sent\_email\_id; |
  | 278 | 280 | } |
  | 279 | 281 | $encrypt\_email\_sent\_id\_address = hash( 'sha256', $email\_sent\_id\_address ); |
  | 280 |  | $plugins\_url                   = get\_option( 'siteurl' ) . '/?wcal\_track\_unsubscribe=wcal\_unsubscribe&validate=' . $validate\_unsubscribe . '&track\_email\_id=' . $encrypt\_email\_sent\_id\_address; |
  |  | 282 | $plugins\_url                   = get\_option( 'siteurl' ) . '/?wcal\_track\_unsubscribe=wcal\_unsubscribe&user\_email=' . $value->user\_email . '&validate=' . $validate\_unsubscribe . '&track\_email\_id=' . $encrypt\_email\_sent\_id\_address; |
  | 281 | 283 | $unsubscribe\_link\_track        = $plugins\_url; |
  | 282 | 284 | $email\_body                    = str\_ireplace( '{{cart.unsubscribe}}', $unsubscribe\_link\_track, $email\_body ); |
  | […](/browser/woocommerce-abandoned-cart/trunk/cron/class-wcal-cron.php?rev=2916178#L566) | […](/browser/woocommerce-abandoned-cart/trunk/cron/class-wcal-cron.php?rev=2922242#L568) |  |
  | 566 | 568 | $order\_id         = 0; |
  | 567 | 569 | $wcal\_cart\_status = false; |
  | 568 |  |  |
  | 569 |  | $results\_wcal\_check\_if\_cart\_is\_present\_in\_post\_meta = $wpdb->get\_var( // phpcS:ignore |
  | 570 |  | $wpdb->prepare( |
  | 571 |  | "SELECT post\_id FROM `" . $wpdb->prefix . "postmeta` WHERE meta\_key = 'wcal\_abandoned\_cart\_id' AND meta\_value = %d LIMIT 1", // phpcs:ignore |
  | 572 |  | $wcal\_cart\_id |
  | 573 |  | ) |
  | 574 |  | ); |
  | 575 |  |  |
  | 576 |  | if ( is\_array( $results\_wcal\_check\_if\_cart\_is\_present\_in\_post\_meta ) && $results\_wcal\_check\_if\_cart\_is\_present\_in\_post\_meta > 0 ) { |
  | 577 |  | $order\_id = $results\_wcal\_check\_if\_cart\_is\_present\_in\_post\_meta; |
  | 578 |  | $order    = wc\_get\_order( $order\_id ); |
  | 579 |  | } else { // check for an order for the same date & email address. |
  |  | 570 | if ( wcal\_is\_hpos\_enabled() ) { // HPOS usage is enabled. |
  |  | 571 | $get\_order = wc\_get\_orders( |
  |  | 572 | array( |
  |  | 573 | 'limit'      => 1, |
  |  | 574 | 'meta\_query' => array( // phpcs:ignore |
  |  | 575 | array( |
  |  | 576 | 'key'     => 'wcal\_abandoned\_cart\_id', |
  |  | 577 | 'value'   => $wcal\_cart\_id, |
  |  | 578 | 'compare' => 'EQUAL', |
  |  | 579 | ), |
  |  | 580 | ), |
  |  | 581 | ) |
  |  | 582 | ); |
  |  | 583 | if ( ! empty( $get\_order ) ) { |
  |  | 584 | $order = $get\_order[0]; |
  |  | 585 | } |
  |  | 586 | } else { // Traditional CPT-based orders are in use. |
  |  | 587 |  |
  |  | 588 | $results\_wcal\_check\_if\_cart\_is\_present\_in\_post\_meta = $wpdb->get\_var( // phpcS:ignore |
  |  | 589 | $wpdb->prepare( |
  |  | 590 | "SELECT post\_id FROM `" . $wpdb->prefix . "postmeta` WHERE meta\_key = 'wcal\_abandoned\_cart\_id' AND meta\_value = %d LIMIT 1", // phpcs:ignore |
  |  | 591 | $wcal\_cart\_id |
  |  | 592 | ) |
  |  | 593 | ); |
  |  | 594 |  |
  |  | 595 | if ( is\_array( $results\_wcal\_check\_if\_cart\_is\_present\_in\_post\_meta ) && $results\_wcal\_check\_if\_cart\_is\_present\_in\_post\_meta > 0 ) { |
  |  | 596 | $order\_id = $results\_wcal\_check\_if\_cart\_is\_present\_in\_post\_meta; |
  |  | 597 | $order    = wc\_get\_order( $order\_id ); |
  |  | 598 | } |
  |  | 599 | } |
  |  | 600 | if ( ! isset( $order ) ) { // check for an order for the same date & email address. |
  | 580 | 601 | $args      = array( |
  | 581 | 602 | 'customer' => $wcal\_user\_email, |
  | […](/browser/woocommerce-abandoned-cart/trunk/cron/class-wcal-cron.php?rev=2916178#L587) | […](/browser/woocommerce-abandoned-cart/trunk/cron/class-wcal-cron.php?rev=2922242#L608) |  |
  | 587 | 608 | } |
  | 588 | 609 | } |
  |  | 610 |  |
  | 589 | 611 | if ( isset( $order ) && is\_object( $order ) ) { |
  | 590 | 612 |  |
* ## [woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po](/changeset/2922242/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po "Show the changeset 2922242 restricted to woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po")

  | [r2916178](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L8 "Show revision 2916178 of this file in browser") | [r2922242](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L8 "Show revision 2922242 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 | "Project-Id-Version: \n" |
  | 9 | 9 | "Report-Msgid-Bugs-To: \n" |
  | 10 |  | "POT-Creation-Date: 2023-0~~5-22 17:07~~+0530\n" |
  | 11 |  | "PO-Revision-Date: 2023-0~~5-22 17:07~~+0500\n" |
  |  | 10 | "POT-Creation-Date: 2023-06-06 15:53+0530\n" |
  |  | 11 | "PO-Revision-Date: 2023-06-06 15:54+0500\n" |
  | 12 | 12 | "Last-Translator: FULL NAME <EMAIL@ADDRESS>\n" |
  | 13 | 13 | "Language-Team: LANGUAGE <LL@li.org>\n" |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L19) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L19) |  |
  | 19 | 19 | "X-Generator: Eazy Po 1.0.0.0\n" |
  | 20 | 20 |  |
  | 21 |  | #: class-wcal-update.php:~~502~~ |
  |  | 21 | #: class-wcal-update.php:498 |
  | 22 | 22 | msgid "" |
  | 23 | 23 | "There was an error creating the guest cart table for Abandoned Cart Lite for " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L26) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L26) |  |
  | 26 | 26 | msgstr "" |
  | 27 | 27 |  |
  | 28 |  | #: woocommerce-ac.php:3~~17 woocommerce-ac.php:2241~~ |
  |  | 28 | #: woocommerce-ac.php:320 woocommerce-ac.php:2277 |
  | 29 | 29 | #: includes/connectors/class-wcap-display-connectors.php:69 |
  | 30 | 30 | msgid "Settings" |
  | 31 | 31 | msgstr "" |
  | 32 | 32 |  |
  | 33 |  | #: woocommerce-ac.php:34~~6~~ |
  |  | 33 | #: woocommerce-ac.php:349 |
  | 34 | 34 | msgid "Emails are not being sent to customers." |
  | 35 | 35 | msgstr "" |
  | 36 | 36 |  |
  | 37 |  | #: woocommerce-ac.php:35~~2~~ |
  |  | 37 | #: woocommerce-ac.php:355 |
  | 38 | 38 | msgid "Capturing of cart and other information was not satisfactory." |
  | 39 | 39 | msgstr "" |
  | 40 | 40 |  |
  | 41 |  | #: woocommerce-ac.php:3~~58~~ |
  |  | 41 | #: woocommerce-ac.php:361 |
  | 42 | 42 | msgid "I cannot see abandoned cart reminder emails records." |
  | 43 | 43 | msgstr "" |
  | 44 | 44 |  |
  | 45 |  | #: woocommerce-ac.php:36~~4~~ |
  |  | 45 | #: woocommerce-ac.php:367 |
  | 46 | 46 | msgid "I want to upgrade the plugin to the PRO version." |
  | 47 | 47 | msgstr "" |
  | 48 | 48 |  |
  | 49 |  | #: woocommerce-ac.php:4~~87~~ |
  |  | 49 | #: woocommerce-ac.php:490 |
  | 50 | 50 | msgid "HTML Email Template" |
  | 51 | 51 | msgstr "" |
  | 52 | 52 |  |
  | 53 |  | #: woocommerce-ac.php:49~~3~~ |
  |  | 53 | #: woocommerce-ac.php:496 |
  | 54 | 54 | msgid "Abandoned cart Email Template" |
  | 55 | 55 | msgstr "" |
  | 56 | 56 |  |
  | 57 |  | #: woocommerce-ac.php:7~~74~~ |
  |  | 57 | #: woocommerce-ac.php:790 |
  | 58 | 58 | msgid "Cart Abandonment Settings" |
  | 59 | 59 | msgstr "" |
  | 60 | 60 |  |
  | 61 |  | #: woocommerce-ac.php:7~~81~~ |
  |  | 61 | #: woocommerce-ac.php:797 |
  | 62 | 62 | msgid "Enable abandoned cart emails" |
  | 63 | 63 | msgstr "" |
  | 64 | 64 |  |
  | 65 |  | #: woocommerce-ac.php:~~785~~ |
  |  | 65 | #: woocommerce-ac.php:801 |
  | 66 | 66 | msgid "Yes, enable the abandoned cart emails." |
  | 67 | 67 | msgstr "" |
  | 68 | 68 |  |
  | 69 |  | #: woocommerce-ac.php:~~790~~ |
  |  | 69 | #: woocommerce-ac.php:806 |
  | 70 | 70 | msgid "Cart abandoned cut-off time" |
  | 71 | 71 | msgstr "" |
  | 72 | 72 |  |
  | 73 |  | #: woocommerce-ac.php:~~794~~ |
  |  | 73 | #: woocommerce-ac.php:810 |
  | 74 | 74 | msgid "" |
  | 75 | 75 | "Consider cart abandoned after X minutes of item being added to cart & order " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L77) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L77) |  |
  | 77 | 77 | msgstr "" |
  | 78 | 78 |  |
  | 79 |  | #: woocommerce-ac.php:~~799~~ |
  |  | 79 | #: woocommerce-ac.php:815 |
  | 80 | 80 | msgid "Automatically Delete Abandoned Orders after X days" |
  | 81 | 81 | msgstr "" |
  | 82 | 82 |  |
  | 83 |  | #: woocommerce-ac.php:8~~03~~ |
  |  | 83 | #: woocommerce-ac.php:819 |
  | 84 | 84 | msgid "Automatically delete abandoned cart orders after X days." |
  | 85 | 85 | msgstr "" |
  | 86 | 86 |  |
  | 87 |  | #: woocommerce-ac.php:8~~08~~ |
  |  | 87 | #: woocommerce-ac.php:824 |
  | 88 | 88 | msgid "Email admin On Order Recovery" |
  | 89 | 89 | msgstr "" |
  | 90 | 90 |  |
  | 91 |  | #: woocommerce-ac.php:8~~12~~ |
  |  | 91 | #: woocommerce-ac.php:828 |
  | 92 | 92 | msgid "Sends email to Admin if an Abandoned Cart Order is recovered." |
  | 93 | 93 | msgstr "" |
  | 94 | 94 |  |
  | 95 |  | #: woocommerce-ac.php:8~~17~~ |
  |  | 95 | #: woocommerce-ac.php:833 |
  | 96 | 96 | msgid "Start tracking from Cart Page" |
  | 97 | 97 | msgstr "" |
  | 98 | 98 |  |
  | 99 |  | #: woocommerce-ac.php:8~~21~~ |
  |  | 99 | #: woocommerce-ac.php:837 |
  | 100 | 100 | msgid "" |
  | 101 | 101 | "Enable tracking of abandoned products & carts even if customer does not " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L105) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L105) |  |
  | 105 | 105 | msgstr "" |
  | 106 | 106 |  |
  | 107 |  | #: woocommerce-ac.php:8~~26~~ |
  |  | 107 | #: woocommerce-ac.php:842 |
  | 108 | 108 | msgid "GDPR Settings" |
  | 109 | 109 | msgstr "" |
  | 110 | 110 |  |
  | 111 |  | #: woocommerce-ac.php:8~~33~~ |
  |  | 111 | #: woocommerce-ac.php:849 |
  | 112 | 112 | msgid "Enable GDPR Notice" |
  | 113 | 113 | msgstr "" |
  | 114 | 114 |  |
  | 115 |  | #: woocommerce-ac.php:8~~37~~ |
  |  | 115 | #: woocommerce-ac.php:853 |
  | 116 | 116 | msgid "" |
  | 117 | 117 | "Enable this setting to display a notice informing customers that their email " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L119) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L119) |  |
  | 119 | 119 | msgstr "" |
  | 120 | 120 |  |
  | 121 |  | #: woocommerce-ac.php:8~~42~~ |
  |  | 121 | #: woocommerce-ac.php:858 |
  | 122 | 122 | msgid "Message to be displayed for Guest users when tracking their carts" |
  | 123 | 123 | msgstr "" |
  | 124 | 124 |  |
  | 125 |  | #: woocommerce-ac.php:8~~46~~ |
  |  | 125 | #: woocommerce-ac.php:862 |
  | 126 | 126 | msgid "" |
  | 127 | 127 | "<br>In compliance with GDPR, add a message on the Checkout page to inform " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L131) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L131) |  |
  | 131 | 131 | msgstr "" |
  | 132 | 132 |  |
  | 133 |  | #: woocommerce-ac.php:8~~51~~ |
  |  | 133 | #: woocommerce-ac.php:867 |
  | 134 | 134 | msgid "Message to be displayed for registered users when tracking their carts." |
  | 135 | 135 | msgstr "" |
  | 136 | 136 |  |
  | 137 |  | #: woocommerce-ac.php:8~~55~~ |
  |  | 137 | #: woocommerce-ac.php:871 |
  | 138 | 138 | msgid "" |
  | 139 | 139 | "<br>In compliance with GDPR, add a message on the Shop & Product pages to " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L142) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L142) |  |
  | 142 | 142 | msgstr "" |
  | 143 | 143 |  |
  | 144 |  | #: woocommerce-ac.php:8~~60~~ |
  |  | 144 | #: woocommerce-ac.php:876 |
  | 145 | 145 | msgid "Allow the visitor to opt out of cart tracking." |
  | 146 | 146 | msgstr "" |
  | 147 | 147 |  |
  | 148 |  | #: woocommerce-ac.php:8~~64~~ |
  |  | 148 | #: woocommerce-ac.php:880 |
  | 149 | 149 | msgid "" |
  | 150 | 150 | "<br>In compliance with GDPR, allow the site visitor (guests & registered " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L153) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L153) |  |
  | 153 | 153 | msgstr "" |
  | 154 | 154 |  |
  | 155 |  | #: woocommerce-ac.php:8~~69~~ |
  |  | 155 | #: woocommerce-ac.php:885 |
  | 156 | 156 | msgid "" |
  | 157 | 157 | "Message to be displayed when the user chooses to opt out of cart tracking." |
  | 158 | 158 | msgstr "" |
  | 159 | 159 |  |
  | 160 |  | #: woocommerce-ac.php:8~~73~~ |
  |  | 160 | #: woocommerce-ac.php:889 |
  | 161 | 161 | msgid "" |
  | 162 | 162 | "<br>Message to be displayed when the user chooses to opt out of cart " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L164) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L164) |  |
  | 164 | 164 | msgstr "" |
  | 165 | 165 |  |
  | 166 |  | #: woocommerce-ac.php:8~~77~~ |
  |  | 166 | #: woocommerce-ac.php:893 |
  | 167 | 167 | msgid "Coupon Settings" |
  | 168 | 168 | msgstr "" |
  | 169 | 169 |  |
  | 170 |  | #: woocommerce-ac.php:8~~83~~ |
  |  | 170 | #: woocommerce-ac.php:899 |
  | 171 | 171 | msgid "Delete Coupons Automatically" |
  | 172 | 172 | msgstr "" |
  | 173 | 173 |  |
  | 174 |  | #: woocommerce-ac.php:~~887~~ |
  |  | 174 | #: woocommerce-ac.php:903 |
  | 175 | 175 | msgid "" |
  | 176 | 176 | "Enable this setting if you want to completely remove the expired and used " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L178) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L178) |  |
  | 178 | 178 | msgstr "" |
  | 179 | 179 |  |
  | 180 |  | #: woocommerce-ac.php:~~891~~ |
  |  | 180 | #: woocommerce-ac.php:907 |
  | 181 | 181 | msgid "Delete Coupons Manually" |
  | 182 | 182 | msgstr "" |
  | 183 | 183 |  |
  | 184 |  | #: woocommerce-ac.php:~~895~~ |
  |  | 184 | #: woocommerce-ac.php:911 |
  | 185 | 185 | msgid "" |
  | 186 | 186 | "If you want to completely remove the expired and used coupon code now then " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L188) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L188) |  |
  | 188 | 188 | msgstr "" |
  | 189 | 189 |  |
  | 190 |  | #: woocommerce-ac.php:9~~04~~ |
  |  | 190 | #: woocommerce-ac.php:920 |
  | 191 | 191 | msgid "Settings for abandoned cart recovery emails" |
  | 192 | 192 | msgstr "" |
  | 193 | 193 |  |
  | 194 |  | #: woocommerce-ac.php:9~~11~~ |
  |  | 194 | #: woocommerce-ac.php:927 |
  | 195 | 195 | msgid "\"From\" Name" |
  | 196 | 196 | msgstr "" |
  | 197 | 197 |  |
  | 198 |  | #: woocommerce-ac.php:9~~20~~ |
  |  | 198 | #: woocommerce-ac.php:936 |
  | 199 | 199 | msgid "\"From\" Address" |
  | 200 | 200 | msgstr "" |
  | 201 | 201 |  |
  | 202 |  | #: woocommerce-ac.php:9~~29~~ |
  |  | 202 | #: woocommerce-ac.php:945 |
  | 203 | 203 | msgid "Send Reply Emails to" |
  | 204 | 204 | msgstr "" |
  | 205 | 205 |  |
  | 206 |  | #: woocommerce-ac.php:9~~38~~ |
  |  | 206 | #: woocommerce-ac.php:954 |
  | 207 | 207 | msgid "UTM parameters to be added to all the links in reminder emails" |
  | 208 | 208 | msgstr "" |
  | 209 | 209 |  |
  | 210 |  | #: woocommerce-ac.php:9~~42~~ |
  |  | 210 | #: woocommerce-ac.php:958 |
  | 211 | 211 | msgid "" |
  | 212 | 212 | "UTM parameters that should be added to all the links in reminder emails." |
  | 213 | 213 | msgstr "" |
  | 214 | 214 |  |
  | 215 |  | #: woocommerce-ac.php:1~~084~~ |
  |  | 215 | #: woocommerce-ac.php:1100 |
  | 216 | 216 | msgid "" |
  | 217 | 217 | "Abandoned cart cut off time should be numeric and has to be greater than 0." |
  | 218 | 218 | msgstr "" |
  | 219 | 219 |  |
  | 220 |  | #: woocommerce-ac.php:11~~02~~ |
  |  | 220 | #: woocommerce-ac.php:1118 |
  | 221 | 221 | msgid "" |
  | 222 | 222 | "Automatically Delete Abandoned Orders after X days has to be greater than 0." |
  | 223 | 223 | msgstr "" |
  | 224 | 224 |  |
  | 225 |  | #: woocommerce-ac.php:13~~64~~ |
  |  | 225 | #: woocommerce-ac.php:1380 |
  | 226 | 226 | #: includes/admin/class-wcal-personal-data-export.php:137 |
  | 227 | 227 | msgid "Abandoned Carts" |
  | 228 | 228 | msgstr "" |
  | 229 | 229 |  |
  | 230 |  | #: woocommerce-ac.php:22~~20~~ |
  |  | 230 | #: woocommerce-ac.php:2256 |
  | 231 | 231 | msgid "Dashboard" |
  | 232 | 232 | msgstr "" |
  | 233 | 233 |  |
  | 234 |  | #: woocommerce-ac.php:22~~27~~ |
  |  | 234 | #: woocommerce-ac.php:2263 |
  | 235 | 235 | #: includes/classes/class-wcal-dashboard-report.php:161 |
  | 236 | 236 | msgid "Abandoned Orders" |
  | 237 | 237 | msgstr "" |
  | 238 | 238 |  |
  | 239 |  | #: woocommerce-ac.php:22~~34~~ |
  |  | 239 | #: woocommerce-ac.php:2270 |
  | 240 | 240 | msgid "Email Templates" |
  | 241 | 241 | msgstr "" |
  | 242 | 242 |  |
  | 243 |  | #: woocommerce-ac.php:22~~48~~ |
  |  | 243 | #: woocommerce-ac.php:2284 |
  | 244 | 244 | msgid "Recovered Orders" |
  | 245 | 245 | msgstr "" |
  | 246 | 246 |  |
  | 247 |  | #: woocommerce-ac.php:22~~55~~ |
  |  | 247 | #: woocommerce-ac.php:2291 |
  | 248 | 248 | msgid "Product Report" |
  | 249 | 249 | msgstr "" |
  | 250 | 250 |  |
  | 251 |  | #: woocommerce-ac.php:2~~297~~ |
  |  | 251 | #: woocommerce-ac.php:2333 |
  | 252 | 252 | #, php-format |
  | 253 | 253 | msgid "Please enter in decimal (%s) format without thousand separators." |
  | 254 | 254 | msgstr "" |
  | 255 | 255 |  |
  | 256 |  | #: woocommerce-ac.php:2~~299~~ |
  |  | 256 | #: woocommerce-ac.php:2335 |
  | 257 | 257 | #, php-format |
  | 258 | 258 | msgid "" |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L261) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L261) |  |
  | 261 | 261 | msgstr "" |
  | 262 | 262 |  |
  | 263 |  | #: woocommerce-ac.php:23~~00~~ |
  |  | 263 | #: woocommerce-ac.php:2336 |
  | 264 | 264 | msgid "Please enter in country code with two capital letters." |
  | 265 | 265 | msgstr "" |
  | 266 | 266 |  |
  | 267 |  | #: woocommerce-ac.php:23~~01~~ |
  |  | 267 | #: woocommerce-ac.php:2337 |
  | 268 | 268 | msgid "Please enter in a value less than the regular price." |
  | 269 | 269 | msgstr "" |
  | 270 | 270 |  |
  | 271 |  | #: woocommerce-ac.php:23~~05~~ |
  |  | 271 | #: woocommerce-ac.php:2341 |
  | 272 | 272 | msgid "Import" |
  | 273 | 273 | msgstr "" |
  | 274 | 274 |  |
  | 275 |  | #: woocommerce-ac.php:23~~06~~ |
  |  | 275 | #: woocommerce-ac.php:2342 |
  | 276 | 276 | msgid "Export" |
  | 277 | 277 | msgstr "" |
  | 278 | 278 |  |
  | 279 |  | #: woocommerce-ac.php:24~~01~~ |
  |  | 279 | #: woocommerce-ac.php:2437 |
  | 280 | 280 | msgctxt "enhanced select" |
  | 281 | 281 | msgid "One result is available, press enter to select it." |
  | 282 | 282 | msgstr "" |
  | 283 | 283 |  |
  | 284 |  | #: woocommerce-ac.php:24~~02~~ |
  |  | 284 | #: woocommerce-ac.php:2438 |
  | 285 | 285 | msgctxt "enhanced select" |
  | 286 | 286 | msgid "%qty% results are available, use up and down arrow keys to navigate." |
  | 287 | 287 | msgstr "" |
  | 288 | 288 |  |
  | 289 |  | #: woocommerce-ac.php:24~~03~~ |
  |  | 289 | #: woocommerce-ac.php:2439 |
  | 290 | 290 | msgctxt "enhanced select" |
  | 291 | 291 | msgid "No matches found" |
  | 292 | 292 | msgstr "" |
  | 293 | 293 |  |
  | 294 |  | #: woocommerce-ac.php:24~~04~~ |
  |  | 294 | #: woocommerce-ac.php:2440 |
  | 295 | 295 | msgctxt "enhanced select" |
  | 296 | 296 | msgid "Loading failed" |
  | 297 | 297 | msgstr "" |
  | 298 | 298 |  |
  | 299 |  | #: woocommerce-ac.php:24~~05~~ |
  |  | 299 | #: woocommerce-ac.php:2441 |
  | 300 | 300 | msgctxt "enhanced select" |
  | 301 | 301 | msgid "Please enter 1 or more characters" |
  | 302 | 302 | msgstr "" |
  | 303 | 303 |  |
  | 304 |  | #: woocommerce-ac.php:24~~06~~ |
  |  | 304 | #: woocommerce-ac.php:2442 |
  | 305 | 305 | msgctxt "enhanced select" |
  | 306 | 306 | msgid "Please enter %qty% or more characters" |
  | 307 | 307 | msgstr "" |
  | 308 | 308 |  |
  | 309 |  | #: woocommerce-ac.php:24~~07~~ |
  |  | 309 | #: woocommerce-ac.php:2443 |
  | 310 | 310 | msgctxt "enhanced select" |
  | 311 | 311 | msgid "Please delete 1 character" |
  | 312 | 312 | msgstr "" |
  | 313 | 313 |  |
  | 314 |  | #: woocommerce-ac.php:24~~08~~ |
  |  | 314 | #: woocommerce-ac.php:2444 |
  | 315 | 315 | msgctxt "enhanced select" |
  | 316 | 316 | msgid "Please delete %qty% characters" |
  | 317 | 317 | msgstr "" |
  | 318 | 318 |  |
  | 319 |  | #: woocommerce-ac.php:24~~09~~ |
  |  | 319 | #: woocommerce-ac.php:2445 |
  | 320 | 320 | msgctxt "enhanced select" |
  | 321 | 321 | msgid "You can only select 1 item" |
  | 322 | 322 | msgstr "" |
  | 323 | 323 |  |
  | 324 |  | #: woocommerce-ac.php:24~~10~~ |
  |  | 324 | #: woocommerce-ac.php:2446 |
  | 325 | 325 | msgctxt "enhanced select" |
  | 326 | 326 | msgid "You can only select %qty% items" |
  | 327 | 327 | msgstr "" |
  | 328 | 328 |  |
  | 329 |  | #: woocommerce-ac.php:24~~11~~ |
  |  | 329 | #: woocommerce-ac.php:2447 |
  | 330 | 330 | msgctxt "enhanced select" |
  | 331 | 331 | msgid "Loading more results&hellip;" |
  | 332 | 332 | msgstr "" |
  | 333 | 333 |  |
  | 334 |  | #: woocommerce-ac.php:24~~12~~ |
  |  | 334 | #: woocommerce-ac.php:2448 |
  | 335 | 335 | msgctxt "enhanced select" |
  | 336 | 336 | msgid "Searching&hellip;" |
  | 337 | 337 | msgstr "" |
  | 338 | 338 |  |
  | 339 |  | #: woocommerce-ac.php:25~~35~~ |
  |  | 339 | #: woocommerce-ac.php:2571 |
  | 340 | 340 | msgid "You do not have sufficient permissions to access this page." |
  | 341 | 341 | msgstr "" |
  | 342 | 342 |  |
  | 343 |  | #: woocommerce-ac.php:25~~39~~ |
  |  | 343 | #: woocommerce-ac.php:2575 |
  | 344 | 344 | msgid "WooCommerce - Abandon Cart Lite" |
  | 345 | 345 | msgstr "" |
  | 346 | 346 |  |
  | 347 |  | #: woocommerce-ac.php:26~~11~~ |
  |  | 347 | #: woocommerce-ac.php:2647 |
  | 348 | 348 | msgid "The Abandoned cart has been successfully deleted." |
  | 349 | 349 | msgstr "" |
  | 350 | 350 |  |
  | 351 |  | #: woocommerce-ac.php:26~~13~~ |
  |  | 351 | #: woocommerce-ac.php:2649 |
  | 352 | 352 | msgid "All Abandoned Carts have been successfully deleted." |
  | 353 | 353 | msgstr "" |
  | 354 | 354 |  |
  | 355 |  | #: woocommerce-ac.php:26~~15~~ |
  |  | 355 | #: woocommerce-ac.php:2651 |
  | 356 | 356 | msgid "All Visitor carts have been successfully deleted." |
  | 357 | 357 | msgstr "" |
  | 358 | 358 |  |
  | 359 |  | #: woocommerce-ac.php:26~~17~~ |
  |  | 359 | #: woocommerce-ac.php:2653 |
  | 360 | 360 | msgid "All Guest carts have been successfully deleted." |
  | 361 | 361 | msgstr "" |
  | 362 | 362 |  |
  | 363 |  | #: woocommerce-ac.php:26~~19~~ |
  |  | 363 | #: woocommerce-ac.php:2655 |
  | 364 | 364 | msgid "All Registered carts have been deleted." |
  | 365 | 365 | msgstr "" |
  | 366 | 366 |  |
  | 367 |  | #: woocommerce-ac.php:26~~30~~ |
  |  | 367 | #: woocommerce-ac.php:2666 |
  | 368 | 368 | msgid "The Template has been successfully deleted." |
  | 369 | 369 | msgstr "" |
  | 370 | 370 |  |
  | 371 |  | #: woocommerce-ac.php:2~~674~~ |
  |  | 371 | #: woocommerce-ac.php:2710 |
  | 372 | 372 | msgid "General Settings" |
  | 373 | 373 | msgstr "" |
  | 374 | 374 |  |
  | 375 |  | #: woocommerce-ac.php:2~~677~~ |
  |  | 375 | #: woocommerce-ac.php:2713 |
  | 376 | 376 | msgid "Email Sending Settings" |
  | 377 | 377 | msgstr "" |
  | 378 | 378 |  |
  | 379 |  | #: woocommerce-ac.php:2~~680~~ |
  |  | 379 | #: woocommerce-ac.php:2716 |
  | 380 | 380 | msgid "Add To Cart Popup Editor" |
  | 381 | 381 | msgstr "" |
  | 382 | 382 |  |
  | 383 |  | #: woocommerce-ac.php:2~~683~~ |
  |  | 383 | #: woocommerce-ac.php:2719 |
  | 384 | 384 | msgid "Facebook Messenger" |
  | 385 | 385 | msgstr "" |
  | 386 | 386 |  |
  | 387 |  | #: woocommerce-ac.php:2~~686~~ |
  |  | 387 | #: woocommerce-ac.php:2722 |
  | 388 | 388 | msgid "SMS" |
  | 389 | 389 | msgstr "" |
  | 390 | 390 |  |
  | 391 |  | #: woocommerce-ac.php:2~~689~~ includes/class-wcap-integrations.php:65 |
  |  | 391 | #: woocommerce-ac.php:2725 includes/class-wcap-integrations.php:65 |
  | 392 | 392 | msgid "Connectors" |
  | 393 | 393 | msgstr "" |
  | 394 | 394 |  |
  | 395 |  | #: woocommerce-ac.php:2~~697 woocommerce-ac.php:2707~~ |
  |  | 395 | #: woocommerce-ac.php:2733 woocommerce-ac.php:2743 |
  | 396 | 396 | msgid "" |
  | 397 | 397 | "Change settings for sending email notifications to Customers, to Admin etc." |
  | 398 | 398 | msgstr "" |
  | 399 | 399 |  |
  | 400 |  | #: woocommerce-ac.php:27~~34~~ |
  |  | 400 | #: woocommerce-ac.php:2770 |
  | 401 | 401 | msgid "" |
  | 402 | 402 | "The list below shows all Abandoned Carts which have remained in cart for a " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L404) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L404) |  |
  | 404 | 404 | msgstr "" |
  | 405 | 405 |  |
  | 406 |  | #: woocommerce-ac.php:2~~776~~ |
  |  | 406 | #: woocommerce-ac.php:2812 |
  | 407 | 407 | msgid "All " |
  | 408 | 408 | msgstr "" |
  | 409 | 409 |  |
  | 410 |  | #: woocommerce-ac.php:2~~781~~ |
  |  | 410 | #: woocommerce-ac.php:2817 |
  | 411 | 411 | #, php-format |
  | 412 | 412 | msgid "Registered %s" |
  | 413 | 413 | msgstr "" |
  | 414 | 414 |  |
  | 415 |  | #: woocommerce-ac.php:2~~787~~ |
  |  | 415 | #: woocommerce-ac.php:2823 |
  | 416 | 416 | #, php-format |
  | 417 | 417 | msgid "Guest %s" |
  | 418 | 418 | msgstr "" |
  | 419 | 419 |  |
  | 420 |  | #: woocommerce-ac.php:2~~793~~ |
  |  | 420 | #: woocommerce-ac.php:2829 |
  | 421 | 421 | msgid "Carts without Customer Details" |
  | 422 | 422 | msgstr "" |
  | 423 | 423 |  |
  | 424 |  | #: woocommerce-ac.php:28~~14~~ |
  |  | 424 | #: woocommerce-ac.php:2850 |
  | 425 | 425 | msgid "" |
  | 426 | 426 | "Add email templates at different intervals to maximize the possibility of " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L428) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L428) |  |
  | 428 | 428 | msgstr "" |
  | 429 | 429 |  |
  | 430 |  | #: woocommerce-ac.php:~~2970~~ |
  |  | 430 | #: woocommerce-ac.php:3006 |
  | 431 | 431 | msgid "" |
  | 432 | 432 | "The Email Template has been successfully added. In order to start sending " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L434) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L434) |  |
  | 434 | 434 | msgstr "" |
  | 435 | 435 |  |
  | 436 |  | #: woocommerce-ac.php:~~2980~~ |
  |  | 436 | #: woocommerce-ac.php:3016 |
  | 437 | 437 | msgid "" |
  | 438 | 438 | "There was a problem adding the email template. Please contact the plugin " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L441) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L441) |  |
  | 441 | 441 | msgstr "" |
  | 442 | 442 |  |
  | 443 |  | #: woocommerce-ac.php:~~2992~~ |
  |  | 443 | #: woocommerce-ac.php:3028 |
  | 444 | 444 | msgid "The Email Template has been successfully updated." |
  | 445 | 445 | msgstr "" |
  | 446 | 446 |  |
  | 447 |  | #: woocommerce-ac.php:30~~02~~ |
  |  | 447 | #: woocommerce-ac.php:3038 |
  | 448 | 448 | msgid "" |
  | 449 | 449 | "There was a problem updating the email template. Please contact the plugin " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L452) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L452) |  |
  | 452 | 452 | msgstr "" |
  | 453 | 453 |  |
  | 454 |  | #: woocommerce-ac.php:30~~11~~ |
  |  | 454 | #: woocommerce-ac.php:3047 |
  | 455 | 455 | msgid "Add New Template" |
  | 456 | 456 | msgstr "" |
  | 457 | 457 |  |
  | 458 |  | #: woocommerce-ac.php:3~~083~~ |
  |  | 458 | #: woocommerce-ac.php:3119 |
  | 459 | 459 | msgid "" |
  | 460 | 460 | "The Report below shows how many Abandoned Carts we were able to recover for " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L462) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L462) |  |
  | 462 | 462 | msgstr "" |
  | 463 | 463 |  |
  | 464 |  | #: woocommerce-ac.php:31~~34~~ |
  |  | 464 | #: woocommerce-ac.php:3170 |
  | 465 | 465 | msgid "Start Date:" |
  | 466 | 466 | msgstr "" |
  | 467 | 467 |  |
  | 468 |  | #: woocommerce-ac.php:31~~36~~ |
  |  | 468 | #: woocommerce-ac.php:3172 |
  | 469 | 469 | msgid "End Date:" |
  | 470 | 470 | msgstr "" |
  | 471 | 471 |  |
  | 472 |  | #: woocommerce-ac.php:31~~38~~ |
  |  | 472 | #: woocommerce-ac.php:3174 |
  | 473 | 473 | #: includes/classes/class-wcal-dashboard-report.php:319 |
  | 474 | 474 | msgid "Go" |
  | 475 | 475 | msgstr "" |
  | 476 | 476 |  |
  | 477 |  | #: woocommerce-ac.php:31~~56~~ |
  |  | 477 | #: woocommerce-ac.php:3192 |
  | 478 | 478 | #, php-format |
  | 479 | 479 | msgid "" |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L483) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L483) |  |
  | 483 | 483 | msgstr "" |
  | 484 | 484 |  |
  | 485 |  | #: woocommerce-ac.php:3~~181~~ |
  |  | 485 | #: woocommerce-ac.php:3217 |
  | 486 | 486 | #, php-format |
  | 487 | 487 | msgid "Abandoned Order #%s Details" |
  | 488 | 488 | msgstr "" |
  | 489 | 489 |  |
  | 490 |  | #: woocommerce-ac.php:3~~185 woocommerce-ac.php:4035 woocommerce-ac.php:4070~~ |
  | 491 |  | #: cron/class-wcal-cron.php:28~~5~~ |
  |  | 490 | #: woocommerce-ac.php:3221 woocommerce-ac.php:4071 woocommerce-ac.php:4106 |
  |  | 491 | #: cron/class-wcal-cron.php:287 |
  | 492 | 492 | msgid "Item" |
  | 493 | 493 | msgstr "" |
  | 494 | 494 |  |
  | 495 |  | #: woocommerce-ac.php:3~~186 woocommerce-ac.php:4036 woocommerce-ac.php:4071~~ |
  | 496 |  | #: cron/class-wcal-cron.php:28~~6~~ |
  |  | 495 | #: woocommerce-ac.php:3222 woocommerce-ac.php:4072 woocommerce-ac.php:4107 |
  |  | 496 | #: cron/class-wcal-cron.php:288 |
  | 497 | 497 | msgid "Name" |
  | 498 | 498 | msgstr "" |
  | 499 | 499 |  |
  | 500 |  | #: woocommerce-ac.php:3~~187 woocommerce-ac.php:4037 woocommerce-ac.php:4072~~ |
  | 501 |  | #: cron/class-wcal-cron.php:28~~7~~ |
  |  | 500 | #: woocommerce-ac.php:3223 woocommerce-ac.php:4073 woocommerce-ac.php:4108 |
  |  | 501 | #: cron/class-wcal-cron.php:289 |
  | 502 | 502 | msgid "Quantity" |
  | 503 | 503 | msgstr "" |
  | 504 | 504 |  |
  | 505 |  | #: woocommerce-ac.php:3~~188 woocommerce-ac.php:4039 woocommerce-ac.php:4074~~ |
  | 506 |  | #: cron/class-wcal-cron.php:2~~89~~ |
  |  | 505 | #: woocommerce-ac.php:3224 woocommerce-ac.php:4075 woocommerce-ac.php:4110 |
  |  | 506 | #: cron/class-wcal-cron.php:291 |
  | 507 | 507 | msgid "Line Subtotal" |
  | 508 | 508 | msgstr "" |
  | 509 | 509 |  |
  | 510 |  | #: woocommerce-ac.php:3~~189~~ |
  |  | 510 | #: woocommerce-ac.php:3225 |
  | 511 | 511 | msgid "Line Total" |
  | 512 | 512 | msgstr "" |
  | 513 | 513 |  |
  | 514 |  | #: woocommerce-ac.php:34~~14~~ |
  | 515 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:47~~1~~ |
  |  | 514 | #: woocommerce-ac.php:3450 |
  |  | 515 | #: includes/admin/class-wcal-abandoned-cart-details.php:475 |
  | 516 | 516 | msgid "Customer Details" |
  | 517 | 517 | msgstr "" |
  | 518 | 518 |  |
  | 519 |  | #: woocommerce-ac.php:34~~18~~ |
  |  | 519 | #: woocommerce-ac.php:3454 |
  | 520 | 520 | msgid "Billing Details" |
  | 521 | 521 | msgstr "" |
  | 522 | 522 |  |
  | 523 |  | #: woocommerce-ac.php:34~~19~~ |
  |  | 523 | #: woocommerce-ac.php:3455 |
  | 524 | 524 | msgid "Name:" |
  | 525 | 525 | msgstr "" |
  | 526 | 526 |  |
  | 527 |  | #: woocommerce-ac.php:34~~22 woocommerce-ac.php:3443~~ |
  |  | 527 | #: woocommerce-ac.php:3458 woocommerce-ac.php:3479 |
  | 528 | 528 | msgid "Address:" |
  | 529 | 529 | msgstr "" |
  | 530 | 530 |  |
  | 531 |  | #: woocommerce-ac.php:34~~33~~ |
  |  | 531 | #: woocommerce-ac.php:3469 |
  | 532 | 532 | msgid "Email:" |
  | 533 | 533 | msgstr "" |
  | 534 | 534 |  |
  | 535 |  | #: woocommerce-ac.php:34~~37~~ |
  |  | 535 | #: woocommerce-ac.php:3473 |
  | 536 | 536 | msgid "Phone:" |
  | 537 | 537 | msgstr "" |
  | 538 | 538 |  |
  | 539 |  | #: woocommerce-ac.php:34~~42~~ |
  |  | 539 | #: woocommerce-ac.php:3478 |
  | 540 | 540 | msgid "Shipping Details" |
  | 541 | 541 | msgstr "" |
  | 542 | 542 |  |
  | 543 |  | #: woocommerce-ac.php:34~~52~~ |
  |  | 543 | #: woocommerce-ac.php:3488 |
  | 544 | 544 | msgid "Shipping Address same as Billing Address" |
  | 545 | 545 | msgstr "" |
  | 546 | 546 |  |
  | 547 |  | #: woocommerce-ac.php:3~~465~~ |
  |  | 547 | #: woocommerce-ac.php:3501 |
  | 548 | 548 | msgid "Shipping Charges" |
  | 549 | 549 | msgstr "" |
  | 550 | 550 |  |
  | 551 |  | #: woocommerce-ac.php:35~~49~~ |
  |  | 551 | #: woocommerce-ac.php:3585 |
  | 552 | 552 | msgid "Template Name:" |
  | 553 | 553 | msgstr "" |
  | 554 | 554 |  |
  | 555 |  | #: woocommerce-ac.php:35~~59~~ |
  |  | 555 | #: woocommerce-ac.php:3595 |
  | 556 | 556 | msgid "Enter a template name for reference" |
  | 557 | 557 | msgstr "" |
  | 558 | 558 |  |
  | 559 |  | #: woocommerce-ac.php:3~~565~~ |
  |  | 559 | #: woocommerce-ac.php:3601 |
  | 560 | 560 | msgid "Subject:" |
  | 561 | 561 | msgstr "" |
  | 562 | 562 |  |
  | 563 |  | #: woocommerce-ac.php:3~~575~~ |
  |  | 563 | #: woocommerce-ac.php:3611 |
  | 564 | 564 | msgid "Enter the subject that should appear in the email sent" |
  | 565 | 565 | msgstr "" |
  | 566 | 566 |  |
  | 567 |  | #: woocommerce-ac.php:3~~581~~ |
  |  | 567 | #: woocommerce-ac.php:3617 |
  | 568 | 568 | msgid "Email Body:" |
  | 569 | 569 | msgstr "" |
  | 570 | 570 |  |
  | 571 |  | #: woocommerce-ac.php:36~~08~~ |
  |  | 571 | #: woocommerce-ac.php:3644 |
  | 572 | 572 | msgid "Message to be sent in the reminder email." |
  | 573 | 573 | msgstr "" |
  | 574 | 574 |  |
  | 575 |  | #: woocommerce-ac.php:36~~35~~ |
  |  | 575 | #: woocommerce-ac.php:3671 |
  | 576 | 576 | msgid "Use WooCommerce Template Style:" |
  | 577 | 577 | msgstr "" |
  | 578 | 578 |  |
  | 579 |  | #: woocommerce-ac.php:36~~51~~ |
  |  | 579 | #: woocommerce-ac.php:3687 |
  | 580 | 580 | msgid "" |
  | 581 | 581 | "Use WooCommerce default style template for abandoned cart reminder emails." |
  | 582 | 582 | msgstr "" |
  | 583 | 583 |  |
  | 584 |  | #: woocommerce-ac.php:36~~58~~ |
  |  | 584 | #: woocommerce-ac.php:3694 |
  | 585 | 585 | msgid "Email Template Header Text: " |
  | 586 | 586 | msgstr "" |
  | 587 | 587 |  |
  | 588 |  | #: woocommerce-ac.php:3~~673~~ |
  |  | 588 | #: woocommerce-ac.php:3709 |
  | 589 | 589 | msgid "" |
  | 590 | 590 | "Enter the header which will appear in the abandoned WooCommerce email sent. " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L593) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L593) |  |
  | 593 | 593 | msgstr "" |
  | 594 | 594 |  |
  | 595 |  | #: woocommerce-ac.php:3~~679~~ |
  |  | 595 | #: woocommerce-ac.php:3715 |
  | 596 | 596 | msgid "Send this email:" |
  | 597 | 597 | msgstr "" |
  | 598 | 598 |  |
  | 599 |  | #: woocommerce-ac.php:37~~21~~ |
  |  | 599 | #: woocommerce-ac.php:3757 |
  | 600 | 600 | msgid "after cart is abandoned." |
  | 601 | 601 | msgstr "" |
  | 602 | 602 |  |
  | 603 |  | #: woocommerce-ac.php:37~~28~~ |
  |  | 603 | #: woocommerce-ac.php:3764 |
  | 604 | 604 | msgid "Send a test email to:" |
  | 605 | 605 | msgstr "" |
  | 606 | 606 |  |
  | 607 |  | #: woocommerce-ac.php:37~~37~~ |
  |  | 607 | #: woocommerce-ac.php:3773 |
  | 608 | 608 | msgid "Enter the email id to which the test email needs to be sent." |
  | 609 | 609 | msgstr "" |
  | 610 | 610 |  |
  | 611 |  | #: woocommerce-ac.php:37~~51~~ |
  |  | 611 | #: woocommerce-ac.php:3787 |
  | 612 | 612 | msgid "Update Changes" |
  | 613 | 613 | msgstr "" |
  | 614 | 614 |  |
  | 615 |  | #: woocommerce-ac.php:37~~55~~ |
  |  | 615 | #: woocommerce-ac.php:3791 |
  | 616 | 616 | #: includes/admin/class-wcap-add-cart-popup-modal.php:84 |
  | 617 | 617 | #: includes/admin/class-wcap-pro-settings.php:66 |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L620) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L620) |  |
  | 620 | 620 | msgstr "" |
  | 621 | 621 |  |
  | 622 |  | #: woocommerce-ac.php:3~~777~~ |
  |  | 622 | #: woocommerce-ac.php:3813 |
  | 623 | 623 | msgid "" |
  | 624 | 624 | "If you love <strong>Abandoned Cart Lite for WooCommerce</strong>, then " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L629) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L629) |  |
  | 629 | 629 | msgstr "" |
  | 630 | 630 |  |
  | 631 |  | #: woocommerce-ac.php:38~~29~~ |
  |  | 631 | #: woocommerce-ac.php:3865 |
  | 632 | 632 | msgid "Please enter a valid email." |
  | 633 | 633 | msgstr "" |
  | 634 | 634 |  |
  | 635 |  | #: woocommerce-ac.php:40~~33 woocommerce-ac.php:4067~~ |
  | 636 |  | #: cron/class-wcal-cron.php:29~~6 cron/class-wcal-cron.php:307~~ |
  |  | 635 | #: woocommerce-ac.php:4069 woocommerce-ac.php:4103 |
  |  | 636 | #: cron/class-wcal-cron.php:298 cron/class-wcal-cron.php:309 |
  | 637 | 637 | msgid "Your Shopping Cart" |
  | 638 | 638 | msgstr "" |
  | 639 | 639 |  |
  | 640 |  | #: woocommerce-ac.php:40~~38 woocommerce-ac.php:4073~~ |
  | 641 |  | #: cron/class-wcal-cron.php:2~~88~~ |
  |  | 640 | #: woocommerce-ac.php:4074 woocommerce-ac.php:4109 |
  |  | 641 | #: cron/class-wcal-cron.php:290 |
  | 642 | 642 | msgid "Price" |
  | 643 | 643 | msgstr "" |
  | 644 | 644 |  |
  | 645 |  | #: woocommerce-ac.php:40~~43 woocommerce-ac.php:4078~~ |
  |  | 645 | #: woocommerce-ac.php:4079 woocommerce-ac.php:4114 |
  | 646 | 646 | msgid "Men's Formal Shoes" |
  | 647 | 647 | msgstr "" |
  | 648 | 648 |  |
  | 649 |  | #: woocommerce-ac.php:40~~50 woocommerce-ac.php:4085~~ |
  |  | 649 | #: woocommerce-ac.php:4086 woocommerce-ac.php:4121 |
  | 650 | 650 | msgid "Woman's Hand Bags" |
  | 651 | 651 | msgstr "" |
  | 652 | 652 |  |
  | 653 |  | #: woocommerce-ac.php:40~~59 woocommerce-ac.php:4094~~ |
  | 654 |  | #: cron/class-wcal-cron.php:41~~7~~ |
  |  | 653 | #: woocommerce-ac.php:4095 woocommerce-ac.php:4130 |
  |  | 654 | #: cron/class-wcal-cron.php:419 |
  | 655 | 655 | msgid "Cart Total:" |
  | 656 | 656 | msgstr "" |
  | 657 | 657 |  |
  | 658 |  | #: woocommerce-ac.php:43~~05~~ |
  |  | 658 | #: woocommerce-ac.php:4341 |
  | 659 | 659 | #, php-format |
  | 660 | 660 | msgid "%1$s: %2$d" |
  | 661 | 661 | msgstr "" |
  | 662 | 662 |  |
  | 663 |  | #: woocommerce-ac.php:43~~15~~ |
  |  | 663 | #: woocommerce-ac.php:4351 |
  | 664 | 664 | #: includes/classes/class-wcal-abandoned-orders-table.php:183 |
  | 665 | 665 | #: includes/classes/class-wcal-abandoned-orders-table.php:785 |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L669) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L669) |  |
  | 669 | 669 | msgstr "" |
  | 670 | 670 |  |
  | 671 |  | #: woocommerce-ac.php:44~~46~~ |
  |  | 671 | #: woocommerce-ac.php:4482 |
  | 672 | 672 | msgid "Once Every Fifteen Minutes" |
  | 673 | 673 | msgstr "" |
  | 674 | 674 |  |
  | 675 |  | #: woocommerce-ac.php:44~~51~~ |
  |  | 675 | #: woocommerce-ac.php:4487 |
  | 676 | 676 | msgid "Once Every Fifteen Days" |
  | 677 | 677 | msgstr "" |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L681) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L681) |  |
  | 681 | 681 | msgstr "" |
  | 682 | 682 |  |
  | 683 |  | #: cron/class-wcal-cron.php:33~~3 cron/class-wcal-cron.php:365~~ |
  |  | 683 | #: cron/class-wcal-cron.php:335 cron/class-wcal-cron.php:367 |
  | 684 | 684 | msgid "SKU: " |
  | 685 | 685 | msgstr "" |
  | 686 | 686 |  |
  | 687 |  | #: cron/class-wcal-cron.php:4~~29~~ |
  |  | 687 | #: cron/class-wcal-cron.php:431 |
  | 688 | 688 | msgid "Product no longer exists" |
  | 689 | 689 | msgstr "" |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L796) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L796) |  |
  | 796 | 796 | msgstr "" |
  | 797 | 797 |  |
  | 798 |  | #: includes/class-wcal-common.php:6~~79~~ |
  |  | 798 | #: includes/class-wcal-common.php:680 |
  | 799 | 799 | msgid "Database Updated Successfully" |
  | 800 | 800 | msgstr "" |
  | 801 | 801 |  |
  | 802 |  | #: includes/class-wcal-common.php:69~~4~~ |
  |  | 802 | #: includes/class-wcal-common.php:695 |
  | 803 | 803 | msgid "Database Update Failed. Please try again after sometime" |
  | 804 | 804 | msgstr "" |
  | 805 | 805 |  |
  | 806 |  | #: includes/class-wcal-common.php:85~~4~~ |
  |  | 806 | #: includes/class-wcal-common.php:855 |
  | 807 | 807 | msgid "This product no longer exists" |
  | 808 | 808 | msgstr "" |
  | 809 | 809 |  |
  | 810 |  | #: includes/class-wcal-common.php:127~~3 includes/class-wcal-common.php:1289~~ |
  | 811 |  | #: includes/class-wcal-common.php:131~~2~~ |
  |  | 810 | #: includes/class-wcal-common.php:1274 includes/class-wcal-common.php:1290 |
  |  | 811 | #: includes/class-wcal-common.php:1313 |
  | 812 | 812 | msgid "Discount code applied successfully." |
  | 813 | 813 | msgstr "" |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L873) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L873) |  |
  | 873 | 873 | msgstr "" |
  | 874 | 874 |  |
  | 875 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:45~~4~~ |
  |  | 875 | #: includes/admin/class-wcal-abandoned-cart-details.php:458 |
  | 876 | 876 | #: includes/templates/rules/html-rules-add-row.php:21 |
  | 877 | 877 | #: includes/templates/rules/html-rules-edit-row.php:25 |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L879) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L879) |  |
  | 879 | 879 | msgstr "" |
  | 880 | 880 |  |
  | 881 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:45~~4~~ |
  |  | 881 | #: includes/admin/class-wcal-abandoned-cart-details.php:458 |
  | 882 | 882 | #, php-format |
  | 883 | 883 | msgid "Recovered on %s" |
  | 884 | 884 | msgstr "" |
  | 885 | 885 |  |
  | 886 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:47~~0~~ |
  |  | 886 | #: includes/admin/class-wcal-abandoned-cart-details.php:474 |
  | 887 | 887 | #: includes/admin/class-wcal-personal-data-export.php:193 |
  | 888 | 888 | #: includes/admin/class-wcal-personal-data-export.php:208 |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L892) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L892) |  |
  | 892 | 892 | msgstr "" |
  | 893 | 893 |  |
  | 894 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:47~~2~~ |
  |  | 894 | #: includes/admin/class-wcal-abandoned-cart-details.php:476 |
  | 895 | 895 | #: includes/classes/class-wcal-abandoned-orders-table.php:109 |
  | 896 | 896 | #: includes/classes/class-wcal-recover-orders-table.php:136 |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L898) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L898) |  |
  | 898 | 898 | msgstr "" |
  | 899 | 899 |  |
  | 900 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:47~~3~~ |
  |  | 900 | #: includes/admin/class-wcal-abandoned-cart-details.php:477 |
  | 901 | 901 | #: includes/admin/class-wcal-personal-data-export.php:187 |
  | 902 | 902 | #: includes/admin/class-wcal-personal-data-export.php:203 |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L905) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L905) |  |
  | 905 | 905 | msgstr "" |
  | 906 | 906 |  |
  | 907 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:4~~88~~ |
  |  | 907 | #: includes/admin/class-wcal-abandoned-cart-details.php:492 |
  | 908 | 908 | msgid "Item Name" |
  | 909 | 909 | msgstr "" |
  | 910 | 910 |  |
  | 911 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:4~~89~~ |
  |  | 911 | #: includes/admin/class-wcal-abandoned-cart-details.php:493 |
  | 912 | 912 | msgid "Item Cost" |
  | 913 | 913 | msgstr "" |
  | 914 | 914 |  |
  | 915 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:49~~0~~ |
  |  | 915 | #: includes/admin/class-wcal-abandoned-cart-details.php:494 |
  | 916 | 916 | msgid "Item Quantity" |
  | 917 | 917 | msgstr "" |
  | 918 | 918 |  |
  | 919 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:5~~09~~ |
  |  | 919 | #: includes/admin/class-wcal-abandoned-cart-details.php:513 |
  | 920 | 920 | msgid "Close" |
  | 921 | 921 | msgstr "" |
  | 922 | 922 |  |
  | 923 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:74~~2~~ |
  |  | 923 | #: includes/admin/class-wcal-abandoned-cart-details.php:746 |
  | 924 | 924 | msgid "Tax: " |
  | 925 | 925 | msgstr "" |
  | 926 | 926 |  |
  | 927 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:7~~48~~ |
  |  | 927 | #: includes/admin/class-wcal-abandoned-cart-details.php:752 |
  | 928 | 928 | msgid "includes Tax: " |
  | 929 | 929 | msgstr "" |
  | 930 | 930 |  |
  | 931 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:7~~69~~ |
  |  | 931 | #: includes/admin/class-wcal-abandoned-cart-details.php:773 |
  | 932 | 932 | msgid "Product has been deleted" |
  | 933 | 933 | msgstr "" |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2916178#L1875) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.po?rev=2922242#L1875) |  |
  | 1875 | 1875 | msgstr "" |
  | 1876 | 1876 |  |
  | 1877 |  | #: includes/frontend/class-wcal-checkout-process.php:21~~6~~ |
  |  | 1877 | #: includes/frontend/class-wcal-checkout-process.php:218 |
  | 1878 | 1878 | msgid "This order was abandoned & subsequently recovered." |
  | 1879 | 1879 | msgstr "" |
  | 1880 | 1880 |  |
  | 1881 |  | #: includes/frontend/class-wcal-checkout-process.php:32~~4~~ |
  | 1882 |  | #: includes/frontend/class-wcal-checkout-process.php:3~~26~~ |
  |  | 1881 | #: includes/frontend/class-wcal-checkout-process.php:329 |
  |  | 1882 | #: includes/frontend/class-wcal-checkout-process.php:331 |
  | 1883 | 1883 | msgid "New Customer Order - Recovered" |
  | 1884 | 1884 | msgstr "" |
* ## [woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot](/changeset/2922242/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot "Show the changeset 2922242 restricted to woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot")

  | [r2916178](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L9 "Show revision 2916178 of this file in browser") | [r2922242](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L9 "Show revision 2922242 of this file in browser") |  |
  | --- | --- | --- |
  | 9 | 9 | "Project-Id-Version: PACKAGE VERSION\n" |
  | 10 | 10 | "Report-Msgid-Bugs-To: \n" |
  | 11 |  | "POT-Creation-Date: 2023-0~~5-22 17:07~~+0530\n" |
  |  | 11 | "POT-Creation-Date: 2023-06-06 15:53+0530\n" |
  | 12 | 12 | "PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n" |
  | 13 | 13 | "Last-Translator: FULL NAME <EMAIL@ADDRESS>\n" |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L18) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L18) |  |
  | 18 | 18 | "Content-Transfer-Encoding: 8bit\n" |
  | 19 | 19 |  |
  | 20 |  | #: class-wcal-update.php:~~502~~ |
  |  | 20 | #: class-wcal-update.php:498 |
  | 21 | 21 | msgid "" |
  | 22 | 22 | "There was an error creating the guest cart table for Abandoned Cart Lite for " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L25) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L25) |  |
  | 25 | 25 | msgstr "" |
  | 26 | 26 |  |
  | 27 |  | #: woocommerce-ac.php:3~~17 woocommerce-ac.php:2241~~ |
  |  | 27 | #: woocommerce-ac.php:320 woocommerce-ac.php:2277 |
  | 28 | 28 | #: includes/connectors/class-wcap-display-connectors.php:69 |
  | 29 | 29 | msgid "Settings" |
  | 30 | 30 | msgstr "" |
  | 31 | 31 |  |
  | 32 |  | #: woocommerce-ac.php:34~~6~~ |
  |  | 32 | #: woocommerce-ac.php:349 |
  | 33 | 33 | msgid "Emails are not being sent to customers." |
  | 34 | 34 | msgstr "" |
  | 35 | 35 |  |
  | 36 |  | #: woocommerce-ac.php:35~~2~~ |
  |  | 36 | #: woocommerce-ac.php:355 |
  | 37 | 37 | msgid "Capturing of cart and other information was not satisfactory." |
  | 38 | 38 | msgstr "" |
  | 39 | 39 |  |
  | 40 |  | #: woocommerce-ac.php:3~~58~~ |
  |  | 40 | #: woocommerce-ac.php:361 |
  | 41 | 41 | msgid "I cannot see abandoned cart reminder emails records." |
  | 42 | 42 | msgstr "" |
  | 43 | 43 |  |
  | 44 |  | #: woocommerce-ac.php:36~~4~~ |
  |  | 44 | #: woocommerce-ac.php:367 |
  | 45 | 45 | msgid "I want to upgrade the plugin to the PRO version." |
  | 46 | 46 | msgstr "" |
  | 47 | 47 |  |
  | 48 |  | #: woocommerce-ac.php:4~~87~~ |
  |  | 48 | #: woocommerce-ac.php:490 |
  | 49 | 49 | msgid "HTML Email Template" |
  | 50 | 50 | msgstr "" |
  | 51 | 51 |  |
  | 52 |  | #: woocommerce-ac.php:49~~3~~ |
  |  | 52 | #: woocommerce-ac.php:496 |
  | 53 | 53 | msgid "Abandoned cart Email Template" |
  | 54 | 54 | msgstr "" |
  | 55 | 55 |  |
  | 56 |  | #: woocommerce-ac.php:7~~74~~ |
  |  | 56 | #: woocommerce-ac.php:790 |
  | 57 | 57 | msgid "Cart Abandonment Settings" |
  | 58 | 58 | msgstr "" |
  | 59 | 59 |  |
  | 60 |  | #: woocommerce-ac.php:7~~81~~ |
  |  | 60 | #: woocommerce-ac.php:797 |
  | 61 | 61 | msgid "Enable abandoned cart emails" |
  | 62 | 62 | msgstr "" |
  | 63 | 63 |  |
  | 64 |  | #: woocommerce-ac.php:~~785~~ |
  |  | 64 | #: woocommerce-ac.php:801 |
  | 65 | 65 | msgid "Yes, enable the abandoned cart emails." |
  | 66 | 66 | msgstr "" |
  | 67 | 67 |  |
  | 68 |  | #: woocommerce-ac.php:~~790~~ |
  |  | 68 | #: woocommerce-ac.php:806 |
  | 69 | 69 | msgid "Cart abandoned cut-off time" |
  | 70 | 70 | msgstr "" |
  | 71 | 71 |  |
  | 72 |  | #: woocommerce-ac.php:~~794~~ |
  |  | 72 | #: woocommerce-ac.php:810 |
  | 73 | 73 | msgid "" |
  | 74 | 74 | "Consider cart abandoned after X minutes of item being added to cart & order " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L76) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L76) |  |
  | 76 | 76 | msgstr "" |
  | 77 | 77 |  |
  | 78 |  | #: woocommerce-ac.php:~~799~~ |
  |  | 78 | #: woocommerce-ac.php:815 |
  | 79 | 79 | msgid "Automatically Delete Abandoned Orders after X days" |
  | 80 | 80 | msgstr "" |
  | 81 | 81 |  |
  | 82 |  | #: woocommerce-ac.php:8~~03~~ |
  |  | 82 | #: woocommerce-ac.php:819 |
  | 83 | 83 | msgid "Automatically delete abandoned cart orders after X days." |
  | 84 | 84 | msgstr "" |
  | 85 | 85 |  |
  | 86 |  | #: woocommerce-ac.php:8~~08~~ |
  |  | 86 | #: woocommerce-ac.php:824 |
  | 87 | 87 | msgid "Email admin On Order Recovery" |
  | 88 | 88 | msgstr "" |
  | 89 | 89 |  |
  | 90 |  | #: woocommerce-ac.php:8~~12~~ |
  |  | 90 | #: woocommerce-ac.php:828 |
  | 91 | 91 | msgid "Sends email to Admin if an Abandoned Cart Order is recovered." |
  | 92 | 92 | msgstr "" |
  | 93 | 93 |  |
  | 94 |  | #: woocommerce-ac.php:8~~17~~ |
  |  | 94 | #: woocommerce-ac.php:833 |
  | 95 | 95 | msgid "Start tracking from Cart Page" |
  | 96 | 96 | msgstr "" |
  | 97 | 97 |  |
  | 98 |  | #: woocommerce-ac.php:8~~21~~ |
  |  | 98 | #: woocommerce-ac.php:837 |
  | 99 | 99 | msgid "" |
  | 100 | 100 | "Enable tracking of abandoned products & carts even if customer does not " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L104) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L104) |  |
  | 104 | 104 | msgstr "" |
  | 105 | 105 |  |
  | 106 |  | #: woocommerce-ac.php:8~~26~~ |
  |  | 106 | #: woocommerce-ac.php:842 |
  | 107 | 107 | msgid "GDPR Settings" |
  | 108 | 108 | msgstr "" |
  | 109 | 109 |  |
  | 110 |  | #: woocommerce-ac.php:8~~33~~ |
  |  | 110 | #: woocommerce-ac.php:849 |
  | 111 | 111 | msgid "Enable GDPR Notice" |
  | 112 | 112 | msgstr "" |
  | 113 | 113 |  |
  | 114 |  | #: woocommerce-ac.php:8~~37~~ |
  |  | 114 | #: woocommerce-ac.php:853 |
  | 115 | 115 | msgid "" |
  | 116 | 116 | "Enable this setting to display a notice informing customers that their email " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L118) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L118) |  |
  | 118 | 118 | msgstr "" |
  | 119 | 119 |  |
  | 120 |  | #: woocommerce-ac.php:8~~42~~ |
  |  | 120 | #: woocommerce-ac.php:858 |
  | 121 | 121 | msgid "Message to be displayed for Guest users when tracking their carts" |
  | 122 | 122 | msgstr "" |
  | 123 | 123 |  |
  | 124 |  | #: woocommerce-ac.php:8~~46~~ |
  |  | 124 | #: woocommerce-ac.php:862 |
  | 125 | 125 | msgid "" |
  | 126 | 126 | "<br>In compliance with GDPR, add a message on the Checkout page to inform " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L130) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L130) |  |
  | 130 | 130 | msgstr "" |
  | 131 | 131 |  |
  | 132 |  | #: woocommerce-ac.php:8~~51~~ |
  |  | 132 | #: woocommerce-ac.php:867 |
  | 133 | 133 | msgid "Message to be displayed for registered users when tracking their carts." |
  | 134 | 134 | msgstr "" |
  | 135 | 135 |  |
  | 136 |  | #: woocommerce-ac.php:8~~55~~ |
  |  | 136 | #: woocommerce-ac.php:871 |
  | 137 | 137 | msgid "" |
  | 138 | 138 | "<br>In compliance with GDPR, add a message on the Shop & Product pages to " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L141) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L141) |  |
  | 141 | 141 | msgstr "" |
  | 142 | 142 |  |
  | 143 |  | #: woocommerce-ac.php:8~~60~~ |
  |  | 143 | #: woocommerce-ac.php:876 |
  | 144 | 144 | msgid "Allow the visitor to opt out of cart tracking." |
  | 145 | 145 | msgstr "" |
  | 146 | 146 |  |
  | 147 |  | #: woocommerce-ac.php:8~~64~~ |
  |  | 147 | #: woocommerce-ac.php:880 |
  | 148 | 148 | msgid "" |
  | 149 | 149 | "<br>In compliance with GDPR, allow the site visitor (guests & registered " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L152) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L152) |  |
  | 152 | 152 | msgstr "" |
  | 153 | 153 |  |
  | 154 |  | #: woocommerce-ac.php:8~~69~~ |
  |  | 154 | #: woocommerce-ac.php:885 |
  | 155 | 155 | msgid "" |
  | 156 | 156 | "Message to be displayed when the user chooses to opt out of cart tracking." |
  | 157 | 157 | msgstr "" |
  | 158 | 158 |  |
  | 159 |  | #: woocommerce-ac.php:8~~73~~ |
  |  | 159 | #: woocommerce-ac.php:889 |
  | 160 | 160 | msgid "" |
  | 161 | 161 | "<br>Message to be displayed when the user chooses to opt out of cart " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L163) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L163) |  |
  | 163 | 163 | msgstr "" |
  | 164 | 164 |  |
  | 165 |  | #: woocommerce-ac.php:8~~77~~ |
  |  | 165 | #: woocommerce-ac.php:893 |
  | 166 | 166 | msgid "Coupon Settings" |
  | 167 | 167 | msgstr "" |
  | 168 | 168 |  |
  | 169 |  | #: woocommerce-ac.php:8~~83~~ |
  |  | 169 | #: woocommerce-ac.php:899 |
  | 170 | 170 | msgid "Delete Coupons Automatically" |
  | 171 | 171 | msgstr "" |
  | 172 | 172 |  |
  | 173 |  | #: woocommerce-ac.php:~~887~~ |
  |  | 173 | #: woocommerce-ac.php:903 |
  | 174 | 174 | msgid "" |
  | 175 | 175 | "Enable this setting if you want to completely remove the expired and used " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L177) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L177) |  |
  | 177 | 177 | msgstr "" |
  | 178 | 178 |  |
  | 179 |  | #: woocommerce-ac.php:~~891~~ |
  |  | 179 | #: woocommerce-ac.php:907 |
  | 180 | 180 | msgid "Delete Coupons Manually" |
  | 181 | 181 | msgstr "" |
  | 182 | 182 |  |
  | 183 |  | #: woocommerce-ac.php:~~895~~ |
  |  | 183 | #: woocommerce-ac.php:911 |
  | 184 | 184 | msgid "" |
  | 185 | 185 | "If you want to completely remove the expired and used coupon code now then " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L187) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L187) |  |
  | 187 | 187 | msgstr "" |
  | 188 | 188 |  |
  | 189 |  | #: woocommerce-ac.php:9~~04~~ |
  |  | 189 | #: woocommerce-ac.php:920 |
  | 190 | 190 | msgid "Settings for abandoned cart recovery emails" |
  | 191 | 191 | msgstr "" |
  | 192 | 192 |  |
  | 193 |  | #: woocommerce-ac.php:9~~11~~ |
  |  | 193 | #: woocommerce-ac.php:927 |
  | 194 | 194 | msgid "\"From\" Name" |
  | 195 | 195 | msgstr "" |
  | 196 | 196 |  |
  | 197 |  | #: woocommerce-ac.php:9~~20~~ |
  |  | 197 | #: woocommerce-ac.php:936 |
  | 198 | 198 | msgid "\"From\" Address" |
  | 199 | 199 | msgstr "" |
  | 200 | 200 |  |
  | 201 |  | #: woocommerce-ac.php:9~~29~~ |
  |  | 201 | #: woocommerce-ac.php:945 |
  | 202 | 202 | msgid "Send Reply Emails to" |
  | 203 | 203 | msgstr "" |
  | 204 | 204 |  |
  | 205 |  | #: woocommerce-ac.php:9~~38~~ |
  |  | 205 | #: woocommerce-ac.php:954 |
  | 206 | 206 | msgid "UTM parameters to be added to all the links in reminder emails" |
  | 207 | 207 | msgstr "" |
  | 208 | 208 |  |
  | 209 |  | #: woocommerce-ac.php:9~~42~~ |
  |  | 209 | #: woocommerce-ac.php:958 |
  | 210 | 210 | msgid "" |
  | 211 | 211 | "UTM parameters that should be added to all the links in reminder emails." |
  | 212 | 212 | msgstr "" |
  | 213 | 213 |  |
  | 214 |  | #: woocommerce-ac.php:1~~084~~ |
  |  | 214 | #: woocommerce-ac.php:1100 |
  | 215 | 215 | msgid "" |
  | 216 | 216 | "Abandoned cart cut off time should be numeric and has to be greater than 0." |
  | 217 | 217 | msgstr "" |
  | 218 | 218 |  |
  | 219 |  | #: woocommerce-ac.php:11~~02~~ |
  |  | 219 | #: woocommerce-ac.php:1118 |
  | 220 | 220 | msgid "" |
  | 221 | 221 | "Automatically Delete Abandoned Orders after X days has to be greater than 0." |
  | 222 | 222 | msgstr "" |
  | 223 | 223 |  |
  | 224 |  | #: woocommerce-ac.php:13~~64~~ |
  |  | 224 | #: woocommerce-ac.php:1380 |
  | 225 | 225 | #: includes/admin/class-wcal-personal-data-export.php:137 |
  | 226 | 226 | msgid "Abandoned Carts" |
  | 227 | 227 | msgstr "" |
  | 228 | 228 |  |
  | 229 |  | #: woocommerce-ac.php:22~~20~~ |
  |  | 229 | #: woocommerce-ac.php:2256 |
  | 230 | 230 | msgid "Dashboard" |
  | 231 | 231 | msgstr "" |
  | 232 | 232 |  |
  | 233 |  | #: woocommerce-ac.php:22~~27~~ |
  |  | 233 | #: woocommerce-ac.php:2263 |
  | 234 | 234 | #: includes/classes/class-wcal-dashboard-report.php:161 |
  | 235 | 235 | msgid "Abandoned Orders" |
  | 236 | 236 | msgstr "" |
  | 237 | 237 |  |
  | 238 |  | #: woocommerce-ac.php:22~~34~~ |
  |  | 238 | #: woocommerce-ac.php:2270 |
  | 239 | 239 | msgid "Email Templates" |
  | 240 | 240 | msgstr "" |
  | 241 | 241 |  |
  | 242 |  | #: woocommerce-ac.php:22~~48~~ |
  |  | 242 | #: woocommerce-ac.php:2284 |
  | 243 | 243 | msgid "Recovered Orders" |
  | 244 | 244 | msgstr "" |
  | 245 | 245 |  |
  | 246 |  | #: woocommerce-ac.php:22~~55~~ |
  |  | 246 | #: woocommerce-ac.php:2291 |
  | 247 | 247 | msgid "Product Report" |
  | 248 | 248 | msgstr "" |
  | 249 | 249 |  |
  | 250 |  | #: woocommerce-ac.php:2~~297~~ |
  |  | 250 | #: woocommerce-ac.php:2333 |
  | 251 | 251 | #, php-format |
  | 252 | 252 | msgid "Please enter in decimal (%s) format without thousand separators." |
  | 253 | 253 | msgstr "" |
  | 254 | 254 |  |
  | 255 |  | #: woocommerce-ac.php:2~~299~~ |
  |  | 255 | #: woocommerce-ac.php:2335 |
  | 256 | 256 | #, php-format |
  | 257 | 257 | msgid "" |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L260) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L260) |  |
  | 260 | 260 | msgstr "" |
  | 261 | 261 |  |
  | 262 |  | #: woocommerce-ac.php:23~~00~~ |
  |  | 262 | #: woocommerce-ac.php:2336 |
  | 263 | 263 | msgid "Please enter in country code with two capital letters." |
  | 264 | 264 | msgstr "" |
  | 265 | 265 |  |
  | 266 |  | #: woocommerce-ac.php:23~~01~~ |
  |  | 266 | #: woocommerce-ac.php:2337 |
  | 267 | 267 | msgid "Please enter in a value less than the regular price." |
  | 268 | 268 | msgstr "" |
  | 269 | 269 |  |
  | 270 |  | #: woocommerce-ac.php:23~~05~~ |
  |  | 270 | #: woocommerce-ac.php:2341 |
  | 271 | 271 | msgid "Import" |
  | 272 | 272 | msgstr "" |
  | 273 | 273 |  |
  | 274 |  | #: woocommerce-ac.php:23~~06~~ |
  |  | 274 | #: woocommerce-ac.php:2342 |
  | 275 | 275 | msgid "Export" |
  | 276 | 276 | msgstr "" |
  | 277 | 277 |  |
  | 278 |  | #: woocommerce-ac.php:24~~01~~ |
  |  | 278 | #: woocommerce-ac.php:2437 |
  | 279 | 279 | msgctxt "enhanced select" |
  | 280 | 280 | msgid "One result is available, press enter to select it." |
  | 281 | 281 | msgstr "" |
  | 282 | 282 |  |
  | 283 |  | #: woocommerce-ac.php:24~~02~~ |
  |  | 283 | #: woocommerce-ac.php:2438 |
  | 284 | 284 | msgctxt "enhanced select" |
  | 285 | 285 | msgid "%qty% results are available, use up and down arrow keys to navigate." |
  | 286 | 286 | msgstr "" |
  | 287 | 287 |  |
  | 288 |  | #: woocommerce-ac.php:24~~03~~ |
  |  | 288 | #: woocommerce-ac.php:2439 |
  | 289 | 289 | msgctxt "enhanced select" |
  | 290 | 290 | msgid "No matches found" |
  | 291 | 291 | msgstr "" |
  | 292 | 292 |  |
  | 293 |  | #: woocommerce-ac.php:24~~04~~ |
  |  | 293 | #: woocommerce-ac.php:2440 |
  | 294 | 294 | msgctxt "enhanced select" |
  | 295 | 295 | msgid "Loading failed" |
  | 296 | 296 | msgstr "" |
  | 297 | 297 |  |
  | 298 |  | #: woocommerce-ac.php:24~~05~~ |
  |  | 298 | #: woocommerce-ac.php:2441 |
  | 299 | 299 | msgctxt "enhanced select" |
  | 300 | 300 | msgid "Please enter 1 or more characters" |
  | 301 | 301 | msgstr "" |
  | 302 | 302 |  |
  | 303 |  | #: woocommerce-ac.php:24~~06~~ |
  |  | 303 | #: woocommerce-ac.php:2442 |
  | 304 | 304 | msgctxt "enhanced select" |
  | 305 | 305 | msgid "Please enter %qty% or more characters" |
  | 306 | 306 | msgstr "" |
  | 307 | 307 |  |
  | 308 |  | #: woocommerce-ac.php:24~~07~~ |
  |  | 308 | #: woocommerce-ac.php:2443 |
  | 309 | 309 | msgctxt "enhanced select" |
  | 310 | 310 | msgid "Please delete 1 character" |
  | 311 | 311 | msgstr "" |
  | 312 | 312 |  |
  | 313 |  | #: woocommerce-ac.php:24~~08~~ |
  |  | 313 | #: woocommerce-ac.php:2444 |
  | 314 | 314 | msgctxt "enhanced select" |
  | 315 | 315 | msgid "Please delete %qty% characters" |
  | 316 | 316 | msgstr "" |
  | 317 | 317 |  |
  | 318 |  | #: woocommerce-ac.php:24~~09~~ |
  |  | 318 | #: woocommerce-ac.php:2445 |
  | 319 | 319 | msgctxt "enhanced select" |
  | 320 | 320 | msgid "You can only select 1 item" |
  | 321 | 321 | msgstr "" |
  | 322 | 322 |  |
  | 323 |  | #: woocommerce-ac.php:24~~10~~ |
  |  | 323 | #: woocommerce-ac.php:2446 |
  | 324 | 324 | msgctxt "enhanced select" |
  | 325 | 325 | msgid "You can only select %qty% items" |
  | 326 | 326 | msgstr "" |
  | 327 | 327 |  |
  | 328 |  | #: woocommerce-ac.php:24~~11~~ |
  |  | 328 | #: woocommerce-ac.php:2447 |
  | 329 | 329 | msgctxt "enhanced select" |
  | 330 | 330 | msgid "Loading more results&hellip;" |
  | 331 | 331 | msgstr "" |
  | 332 | 332 |  |
  | 333 |  | #: woocommerce-ac.php:24~~12~~ |
  |  | 333 | #: woocommerce-ac.php:2448 |
  | 334 | 334 | msgctxt "enhanced select" |
  | 335 | 335 | msgid "Searching&hellip;" |
  | 336 | 336 | msgstr "" |
  | 337 | 337 |  |
  | 338 |  | #: woocommerce-ac.php:25~~35~~ |
  |  | 338 | #: woocommerce-ac.php:2571 |
  | 339 | 339 | msgid "You do not have sufficient permissions to access this page." |
  | 340 | 340 | msgstr "" |
  | 341 | 341 |  |
  | 342 |  | #: woocommerce-ac.php:25~~39~~ |
  |  | 342 | #: woocommerce-ac.php:2575 |
  | 343 | 343 | msgid "WooCommerce - Abandon Cart Lite" |
  | 344 | 344 | msgstr "" |
  | 345 | 345 |  |
  | 346 |  | #: woocommerce-ac.php:26~~11~~ |
  |  | 346 | #: woocommerce-ac.php:2647 |
  | 347 | 347 | msgid "The Abandoned cart has been successfully deleted." |
  | 348 | 348 | msgstr "" |
  | 349 | 349 |  |
  | 350 |  | #: woocommerce-ac.php:26~~13~~ |
  |  | 350 | #: woocommerce-ac.php:2649 |
  | 351 | 351 | msgid "All Abandoned Carts have been successfully deleted." |
  | 352 | 352 | msgstr "" |
  | 353 | 353 |  |
  | 354 |  | #: woocommerce-ac.php:26~~15~~ |
  |  | 354 | #: woocommerce-ac.php:2651 |
  | 355 | 355 | msgid "All Visitor carts have been successfully deleted." |
  | 356 | 356 | msgstr "" |
  | 357 | 357 |  |
  | 358 |  | #: woocommerce-ac.php:26~~17~~ |
  |  | 358 | #: woocommerce-ac.php:2653 |
  | 359 | 359 | msgid "All Guest carts have been successfully deleted." |
  | 360 | 360 | msgstr "" |
  | 361 | 361 |  |
  | 362 |  | #: woocommerce-ac.php:26~~19~~ |
  |  | 362 | #: woocommerce-ac.php:2655 |
  | 363 | 363 | msgid "All Registered carts have been deleted." |
  | 364 | 364 | msgstr "" |
  | 365 | 365 |  |
  | 366 |  | #: woocommerce-ac.php:26~~30~~ |
  |  | 366 | #: woocommerce-ac.php:2666 |
  | 367 | 367 | msgid "The Template has been successfully deleted." |
  | 368 | 368 | msgstr "" |
  | 369 | 369 |  |
  | 370 |  | #: woocommerce-ac.php:2~~674~~ |
  |  | 370 | #: woocommerce-ac.php:2710 |
  | 371 | 371 | msgid "General Settings" |
  | 372 | 372 | msgstr "" |
  | 373 | 373 |  |
  | 374 |  | #: woocommerce-ac.php:2~~677~~ |
  |  | 374 | #: woocommerce-ac.php:2713 |
  | 375 | 375 | msgid "Email Sending Settings" |
  | 376 | 376 | msgstr "" |
  | 377 | 377 |  |
  | 378 |  | #: woocommerce-ac.php:2~~680~~ |
  |  | 378 | #: woocommerce-ac.php:2716 |
  | 379 | 379 | msgid "Add To Cart Popup Editor" |
  | 380 | 380 | msgstr "" |
  | 381 | 381 |  |
  | 382 |  | #: woocommerce-ac.php:2~~683~~ |
  |  | 382 | #: woocommerce-ac.php:2719 |
  | 383 | 383 | msgid "Facebook Messenger" |
  | 384 | 384 | msgstr "" |
  | 385 | 385 |  |
  | 386 |  | #: woocommerce-ac.php:2~~686~~ |
  |  | 386 | #: woocommerce-ac.php:2722 |
  | 387 | 387 | msgid "SMS" |
  | 388 | 388 | msgstr "" |
  | 389 | 389 |  |
  | 390 |  | #: woocommerce-ac.php:2~~689~~ includes/class-wcap-integrations.php:65 |
  |  | 390 | #: woocommerce-ac.php:2725 includes/class-wcap-integrations.php:65 |
  | 391 | 391 | msgid "Connectors" |
  | 392 | 392 | msgstr "" |
  | 393 | 393 |  |
  | 394 |  | #: woocommerce-ac.php:2~~697 woocommerce-ac.php:2707~~ |
  |  | 394 | #: woocommerce-ac.php:2733 woocommerce-ac.php:2743 |
  | 395 | 395 | msgid "" |
  | 396 | 396 | "Change settings for sending email notifications to Customers, to Admin etc." |
  | 397 | 397 | msgstr "" |
  | 398 | 398 |  |
  | 399 |  | #: woocommerce-ac.php:27~~34~~ |
  |  | 399 | #: woocommerce-ac.php:2770 |
  | 400 | 400 | msgid "" |
  | 401 | 401 | "The list below shows all Abandoned Carts which have remained in cart for a " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L403) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L403) |  |
  | 403 | 403 | msgstr "" |
  | 404 | 404 |  |
  | 405 |  | #: woocommerce-ac.php:2~~776~~ |
  |  | 405 | #: woocommerce-ac.php:2812 |
  | 406 | 406 | msgid "All " |
  | 407 | 407 | msgstr "" |
  | 408 | 408 |  |
  | 409 |  | #: woocommerce-ac.php:2~~781~~ |
  |  | 409 | #: woocommerce-ac.php:2817 |
  | 410 | 410 | #, php-format |
  | 411 | 411 | msgid "Registered %s" |
  | 412 | 412 | msgstr "" |
  | 413 | 413 |  |
  | 414 |  | #: woocommerce-ac.php:2~~787~~ |
  |  | 414 | #: woocommerce-ac.php:2823 |
  | 415 | 415 | #, php-format |
  | 416 | 416 | msgid "Guest %s" |
  | 417 | 417 | msgstr "" |
  | 418 | 418 |  |
  | 419 |  | #: woocommerce-ac.php:2~~793~~ |
  |  | 419 | #: woocommerce-ac.php:2829 |
  | 420 | 420 | msgid "Carts without Customer Details" |
  | 421 | 421 | msgstr "" |
  | 422 | 422 |  |
  | 423 |  | #: woocommerce-ac.php:28~~14~~ |
  |  | 423 | #: woocommerce-ac.php:2850 |
  | 424 | 424 | msgid "" |
  | 425 | 425 | "Add email templates at different intervals to maximize the possibility of " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L427) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L427) |  |
  | 427 | 427 | msgstr "" |
  | 428 | 428 |  |
  | 429 |  | #: woocommerce-ac.php:~~2970~~ |
  |  | 429 | #: woocommerce-ac.php:3006 |
  | 430 | 430 | msgid "" |
  | 431 | 431 | "The Email Template has been successfully added. In order to start sending " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L433) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L433) |  |
  | 433 | 433 | msgstr "" |
  | 434 | 434 |  |
  | 435 |  | #: woocommerce-ac.php:~~2980~~ |
  |  | 435 | #: woocommerce-ac.php:3016 |
  | 436 | 436 | msgid "" |
  | 437 | 437 | "There was a problem adding the email template. Please contact the plugin " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L440) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L440) |  |
  | 440 | 440 | msgstr "" |
  | 441 | 441 |  |
  | 442 |  | #: woocommerce-ac.php:~~2992~~ |
  |  | 442 | #: woocommerce-ac.php:3028 |
  | 443 | 443 | msgid "The Email Template has been successfully updated." |
  | 444 | 444 | msgstr "" |
  | 445 | 445 |  |
  | 446 |  | #: woocommerce-ac.php:30~~02~~ |
  |  | 446 | #: woocommerce-ac.php:3038 |
  | 447 | 447 | msgid "" |
  | 448 | 448 | "There was a problem updating the email template. Please contact the plugin " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L451) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L451) |  |
  | 451 | 451 | msgstr "" |
  | 452 | 452 |  |
  | 453 |  | #: woocommerce-ac.php:30~~11~~ |
  |  | 453 | #: woocommerce-ac.php:3047 |
  | 454 | 454 | msgid "Add New Template" |
  | 455 | 455 | msgstr "" |
  | 456 | 456 |  |
  | 457 |  | #: woocommerce-ac.php:3~~083~~ |
  |  | 457 | #: woocommerce-ac.php:3119 |
  | 458 | 458 | msgid "" |
  | 459 | 459 | "The Report below shows how many Abandoned Carts we were able to recover for " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L461) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L461) |  |
  | 461 | 461 | msgstr "" |
  | 462 | 462 |  |
  | 463 |  | #: woocommerce-ac.php:31~~34~~ |
  |  | 463 | #: woocommerce-ac.php:3170 |
  | 464 | 464 | msgid "Start Date:" |
  | 465 | 465 | msgstr "" |
  | 466 | 466 |  |
  | 467 |  | #: woocommerce-ac.php:31~~36~~ |
  |  | 467 | #: woocommerce-ac.php:3172 |
  | 468 | 468 | msgid "End Date:" |
  | 469 | 469 | msgstr "" |
  | 470 | 470 |  |
  | 471 |  | #: woocommerce-ac.php:31~~38~~ |
  |  | 471 | #: woocommerce-ac.php:3174 |
  | 472 | 472 | #: includes/classes/class-wcal-dashboard-report.php:319 |
  | 473 | 473 | msgid "Go" |
  | 474 | 474 | msgstr "" |
  | 475 | 475 |  |
  | 476 |  | #: woocommerce-ac.php:31~~56~~ |
  |  | 476 | #: woocommerce-ac.php:3192 |
  | 477 | 477 | #, php-format |
  | 478 | 478 | msgid "" |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L482) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L482) |  |
  | 482 | 482 | msgstr "" |
  | 483 | 483 |  |
  | 484 |  | #: woocommerce-ac.php:3~~181~~ |
  |  | 484 | #: woocommerce-ac.php:3217 |
  | 485 | 485 | #, php-format |
  | 486 | 486 | msgid "Abandoned Order #%s Details" |
  | 487 | 487 | msgstr "" |
  | 488 | 488 |  |
  | 489 |  | #: woocommerce-ac.php:3~~185 woocommerce-ac.php:4035 woocommerce-ac.php:4070~~ |
  | 490 |  | #: cron/class-wcal-cron.php:28~~5~~ |
  |  | 489 | #: woocommerce-ac.php:3221 woocommerce-ac.php:4071 woocommerce-ac.php:4106 |
  |  | 490 | #: cron/class-wcal-cron.php:287 |
  | 491 | 491 | msgid "Item" |
  | 492 | 492 | msgstr "" |
  | 493 | 493 |  |
  | 494 |  | #: woocommerce-ac.php:3~~186 woocommerce-ac.php:4036 woocommerce-ac.php:4071~~ |
  | 495 |  | #: cron/class-wcal-cron.php:28~~6~~ |
  |  | 494 | #: woocommerce-ac.php:3222 woocommerce-ac.php:4072 woocommerce-ac.php:4107 |
  |  | 495 | #: cron/class-wcal-cron.php:288 |
  | 496 | 496 | msgid "Name" |
  | 497 | 497 | msgstr "" |
  | 498 | 498 |  |
  | 499 |  | #: woocommerce-ac.php:3~~187 woocommerce-ac.php:4037 woocommerce-ac.php:4072~~ |
  | 500 |  | #: cron/class-wcal-cron.php:28~~7~~ |
  |  | 499 | #: woocommerce-ac.php:3223 woocommerce-ac.php:4073 woocommerce-ac.php:4108 |
  |  | 500 | #: cron/class-wcal-cron.php:289 |
  | 501 | 501 | msgid "Quantity" |
  | 502 | 502 | msgstr "" |
  | 503 | 503 |  |
  | 504 |  | #: woocommerce-ac.php:3~~188 woocommerce-ac.php:4039 woocommerce-ac.php:4074~~ |
  | 505 |  | #: cron/class-wcal-cron.php:2~~89~~ |
  |  | 504 | #: woocommerce-ac.php:3224 woocommerce-ac.php:4075 woocommerce-ac.php:4110 |
  |  | 505 | #: cron/class-wcal-cron.php:291 |
  | 506 | 506 | msgid "Line Subtotal" |
  | 507 | 507 | msgstr "" |
  | 508 | 508 |  |
  | 509 |  | #: woocommerce-ac.php:3~~189~~ |
  |  | 509 | #: woocommerce-ac.php:3225 |
  | 510 | 510 | msgid "Line Total" |
  | 511 | 511 | msgstr "" |
  | 512 | 512 |  |
  | 513 |  | #: woocommerce-ac.php:34~~14~~ |
  | 514 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:47~~1~~ |
  |  | 513 | #: woocommerce-ac.php:3450 |
  |  | 514 | #: includes/admin/class-wcal-abandoned-cart-details.php:475 |
  | 515 | 515 | msgid "Customer Details" |
  | 516 | 516 | msgstr "" |
  | 517 | 517 |  |
  | 518 |  | #: woocommerce-ac.php:34~~18~~ |
  |  | 518 | #: woocommerce-ac.php:3454 |
  | 519 | 519 | msgid "Billing Details" |
  | 520 | 520 | msgstr "" |
  | 521 | 521 |  |
  | 522 |  | #: woocommerce-ac.php:34~~19~~ |
  |  | 522 | #: woocommerce-ac.php:3455 |
  | 523 | 523 | msgid "Name:" |
  | 524 | 524 | msgstr "" |
  | 525 | 525 |  |
  | 526 |  | #: woocommerce-ac.php:34~~22 woocommerce-ac.php:3443~~ |
  |  | 526 | #: woocommerce-ac.php:3458 woocommerce-ac.php:3479 |
  | 527 | 527 | msgid "Address:" |
  | 528 | 528 | msgstr "" |
  | 529 | 529 |  |
  | 530 |  | #: woocommerce-ac.php:34~~33~~ |
  |  | 530 | #: woocommerce-ac.php:3469 |
  | 531 | 531 | msgid "Email:" |
  | 532 | 532 | msgstr "" |
  | 533 | 533 |  |
  | 534 |  | #: woocommerce-ac.php:34~~37~~ |
  |  | 534 | #: woocommerce-ac.php:3473 |
  | 535 | 535 | msgid "Phone:" |
  | 536 | 536 | msgstr "" |
  | 537 | 537 |  |
  | 538 |  | #: woocommerce-ac.php:34~~42~~ |
  |  | 538 | #: woocommerce-ac.php:3478 |
  | 539 | 539 | msgid "Shipping Details" |
  | 540 | 540 | msgstr "" |
  | 541 | 541 |  |
  | 542 |  | #: woocommerce-ac.php:34~~52~~ |
  |  | 542 | #: woocommerce-ac.php:3488 |
  | 543 | 543 | msgid "Shipping Address same as Billing Address" |
  | 544 | 544 | msgstr "" |
  | 545 | 545 |  |
  | 546 |  | #: woocommerce-ac.php:3~~465~~ |
  |  | 546 | #: woocommerce-ac.php:3501 |
  | 547 | 547 | msgid "Shipping Charges" |
  | 548 | 548 | msgstr "" |
  | 549 | 549 |  |
  | 550 |  | #: woocommerce-ac.php:35~~49~~ |
  |  | 550 | #: woocommerce-ac.php:3585 |
  | 551 | 551 | msgid "Template Name:" |
  | 552 | 552 | msgstr "" |
  | 553 | 553 |  |
  | 554 |  | #: woocommerce-ac.php:35~~59~~ |
  |  | 554 | #: woocommerce-ac.php:3595 |
  | 555 | 555 | msgid "Enter a template name for reference" |
  | 556 | 556 | msgstr "" |
  | 557 | 557 |  |
  | 558 |  | #: woocommerce-ac.php:3~~565~~ |
  |  | 558 | #: woocommerce-ac.php:3601 |
  | 559 | 559 | msgid "Subject:" |
  | 560 | 560 | msgstr "" |
  | 561 | 561 |  |
  | 562 |  | #: woocommerce-ac.php:3~~575~~ |
  |  | 562 | #: woocommerce-ac.php:3611 |
  | 563 | 563 | msgid "Enter the subject that should appear in the email sent" |
  | 564 | 564 | msgstr "" |
  | 565 | 565 |  |
  | 566 |  | #: woocommerce-ac.php:3~~581~~ |
  |  | 566 | #: woocommerce-ac.php:3617 |
  | 567 | 567 | msgid "Email Body:" |
  | 568 | 568 | msgstr "" |
  | 569 | 569 |  |
  | 570 |  | #: woocommerce-ac.php:36~~08~~ |
  |  | 570 | #: woocommerce-ac.php:3644 |
  | 571 | 571 | msgid "Message to be sent in the reminder email." |
  | 572 | 572 | msgstr "" |
  | 573 | 573 |  |
  | 574 |  | #: woocommerce-ac.php:36~~35~~ |
  |  | 574 | #: woocommerce-ac.php:3671 |
  | 575 | 575 | msgid "Use WooCommerce Template Style:" |
  | 576 | 576 | msgstr "" |
  | 577 | 577 |  |
  | 578 |  | #: woocommerce-ac.php:36~~51~~ |
  |  | 578 | #: woocommerce-ac.php:3687 |
  | 579 | 579 | msgid "" |
  | 580 | 580 | "Use WooCommerce default style template for abandoned cart reminder emails." |
  | 581 | 581 | msgstr "" |
  | 582 | 582 |  |
  | 583 |  | #: woocommerce-ac.php:36~~58~~ |
  |  | 583 | #: woocommerce-ac.php:3694 |
  | 584 | 584 | msgid "Email Template Header Text: " |
  | 585 | 585 | msgstr "" |
  | 586 | 586 |  |
  | 587 |  | #: woocommerce-ac.php:3~~673~~ |
  |  | 587 | #: woocommerce-ac.php:3709 |
  | 588 | 588 | msgid "" |
  | 589 | 589 | "Enter the header which will appear in the abandoned WooCommerce email sent. " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L592) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L592) |  |
  | 592 | 592 | msgstr "" |
  | 593 | 593 |  |
  | 594 |  | #: woocommerce-ac.php:3~~679~~ |
  |  | 594 | #: woocommerce-ac.php:3715 |
  | 595 | 595 | msgid "Send this email:" |
  | 596 | 596 | msgstr "" |
  | 597 | 597 |  |
  | 598 |  | #: woocommerce-ac.php:37~~21~~ |
  |  | 598 | #: woocommerce-ac.php:3757 |
  | 599 | 599 | msgid "after cart is abandoned." |
  | 600 | 600 | msgstr "" |
  | 601 | 601 |  |
  | 602 |  | #: woocommerce-ac.php:37~~28~~ |
  |  | 602 | #: woocommerce-ac.php:3764 |
  | 603 | 603 | msgid "Send a test email to:" |
  | 604 | 604 | msgstr "" |
  | 605 | 605 |  |
  | 606 |  | #: woocommerce-ac.php:37~~37~~ |
  |  | 606 | #: woocommerce-ac.php:3773 |
  | 607 | 607 | msgid "Enter the email id to which the test email needs to be sent." |
  | 608 | 608 | msgstr "" |
  | 609 | 609 |  |
  | 610 |  | #: woocommerce-ac.php:37~~51~~ |
  |  | 610 | #: woocommerce-ac.php:3787 |
  | 611 | 611 | msgid "Update Changes" |
  | 612 | 612 | msgstr "" |
  | 613 | 613 |  |
  | 614 |  | #: woocommerce-ac.php:37~~55~~ |
  |  | 614 | #: woocommerce-ac.php:3791 |
  | 615 | 615 | #: includes/admin/class-wcap-add-cart-popup-modal.php:84 |
  | 616 | 616 | #: includes/admin/class-wcap-pro-settings.php:66 |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L619) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L619) |  |
  | 619 | 619 | msgstr "" |
  | 620 | 620 |  |
  | 621 |  | #: woocommerce-ac.php:3~~777~~ |
  |  | 621 | #: woocommerce-ac.php:3813 |
  | 622 | 622 | msgid "" |
  | 623 | 623 | "If you love <strong>Abandoned Cart Lite for WooCommerce</strong>, then " |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L628) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L628) |  |
  | 628 | 628 | msgstr "" |
  | 629 | 629 |  |
  | 630 |  | #: woocommerce-ac.php:38~~29~~ |
  |  | 630 | #: woocommerce-ac.php:3865 |
  | 631 | 631 | msgid "Please enter a valid email." |
  | 632 | 632 | msgstr "" |
  | 633 | 633 |  |
  | 634 |  | #: woocommerce-ac.php:40~~33 woocommerce-ac.php:4067~~ |
  | 635 |  | #: cron/class-wcal-cron.php:29~~6 cron/class-wcal-cron.php:307~~ |
  |  | 634 | #: woocommerce-ac.php:4069 woocommerce-ac.php:4103 |
  |  | 635 | #: cron/class-wcal-cron.php:298 cron/class-wcal-cron.php:309 |
  | 636 | 636 | msgid "Your Shopping Cart" |
  | 637 | 637 | msgstr "" |
  | 638 | 638 |  |
  | 639 |  | #: woocommerce-ac.php:40~~38 woocommerce-ac.php:4073~~ |
  | 640 |  | #: cron/class-wcal-cron.php:2~~88~~ |
  |  | 639 | #: woocommerce-ac.php:4074 woocommerce-ac.php:4109 |
  |  | 640 | #: cron/class-wcal-cron.php:290 |
  | 641 | 641 | msgid "Price" |
  | 642 | 642 | msgstr "" |
  | 643 | 643 |  |
  | 644 |  | #: woocommerce-ac.php:40~~43 woocommerce-ac.php:4078~~ |
  |  | 644 | #: woocommerce-ac.php:4079 woocommerce-ac.php:4114 |
  | 645 | 645 | msgid "Men's Formal Shoes" |
  | 646 | 646 | msgstr "" |
  | 647 | 647 |  |
  | 648 |  | #: woocommerce-ac.php:40~~50 woocommerce-ac.php:4085~~ |
  |  | 648 | #: woocommerce-ac.php:4086 woocommerce-ac.php:4121 |
  | 649 | 649 | msgid "Woman's Hand Bags" |
  | 650 | 650 | msgstr "" |
  | 651 | 651 |  |
  | 652 |  | #: woocommerce-ac.php:40~~59 woocommerce-ac.php:4094~~ |
  | 653 |  | #: cron/class-wcal-cron.php:41~~7~~ |
  |  | 652 | #: woocommerce-ac.php:4095 woocommerce-ac.php:4130 |
  |  | 653 | #: cron/class-wcal-cron.php:419 |
  | 654 | 654 | msgid "Cart Total:" |
  | 655 | 655 | msgstr "" |
  | 656 | 656 |  |
  | 657 |  | #: woocommerce-ac.php:43~~05~~ |
  |  | 657 | #: woocommerce-ac.php:4341 |
  | 658 | 658 | #, php-format |
  | 659 | 659 | msgid "%1$s: %2$d" |
  | 660 | 660 | msgstr "" |
  | 661 | 661 |  |
  | 662 |  | #: woocommerce-ac.php:43~~15~~ |
  |  | 662 | #: woocommerce-ac.php:4351 |
  | 663 | 663 | #: includes/classes/class-wcal-abandoned-orders-table.php:183 |
  | 664 | 664 | #: includes/classes/class-wcal-abandoned-orders-table.php:785 |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L668) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L668) |  |
  | 668 | 668 | msgstr "" |
  | 669 | 669 |  |
  | 670 |  | #: woocommerce-ac.php:44~~46~~ |
  |  | 670 | #: woocommerce-ac.php:4482 |
  | 671 | 671 | msgid "Once Every Fifteen Minutes" |
  | 672 | 672 | msgstr "" |
  | 673 | 673 |  |
  | 674 |  | #: woocommerce-ac.php:44~~51~~ |
  |  | 674 | #: woocommerce-ac.php:4487 |
  | 675 | 675 | msgid "Once Every Fifteen Days" |
  | 676 | 676 | msgstr "" |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L680) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L680) |  |
  | 680 | 680 | msgstr "" |
  | 681 | 681 |  |
  | 682 |  | #: cron/class-wcal-cron.php:33~~3 cron/class-wcal-cron.php:365~~ |
  |  | 682 | #: cron/class-wcal-cron.php:335 cron/class-wcal-cron.php:367 |
  | 683 | 683 | msgid "SKU: " |
  | 684 | 684 | msgstr "" |
  | 685 | 685 |  |
  | 686 |  | #: cron/class-wcal-cron.php:4~~29~~ |
  |  | 686 | #: cron/class-wcal-cron.php:431 |
  | 687 | 687 | msgid "Product no longer exists" |
  | 688 | 688 | msgstr "" |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L795) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L795) |  |
  | 795 | 795 | msgstr "" |
  | 796 | 796 |  |
  | 797 |  | #: includes/class-wcal-common.php:6~~79~~ |
  |  | 797 | #: includes/class-wcal-common.php:680 |
  | 798 | 798 | msgid "Database Updated Successfully" |
  | 799 | 799 | msgstr "" |
  | 800 | 800 |  |
  | 801 |  | #: includes/class-wcal-common.php:69~~4~~ |
  |  | 801 | #: includes/class-wcal-common.php:695 |
  | 802 | 802 | msgid "Database Update Failed. Please try again after sometime" |
  | 803 | 803 | msgstr "" |
  | 804 | 804 |  |
  | 805 |  | #: includes/class-wcal-common.php:85~~4~~ |
  |  | 805 | #: includes/class-wcal-common.php:855 |
  | 806 | 806 | msgid "This product no longer exists" |
  | 807 | 807 | msgstr "" |
  | 808 | 808 |  |
  | 809 |  | #: includes/class-wcal-common.php:127~~3 includes/class-wcal-common.php:1289~~ |
  | 810 |  | #: includes/class-wcal-common.php:131~~2~~ |
  |  | 809 | #: includes/class-wcal-common.php:1274 includes/class-wcal-common.php:1290 |
  |  | 810 | #: includes/class-wcal-common.php:1313 |
  | 811 | 811 | msgid "Discount code applied successfully." |
  | 812 | 812 | msgstr "" |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L872) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L872) |  |
  | 872 | 872 | msgstr "" |
  | 873 | 873 |  |
  | 874 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:45~~4~~ |
  |  | 874 | #: includes/admin/class-wcal-abandoned-cart-details.php:458 |
  | 875 | 875 | #: includes/templates/rules/html-rules-add-row.php:21 |
  | 876 | 876 | #: includes/templates/rules/html-rules-edit-row.php:25 |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L878) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L878) |  |
  | 878 | 878 | msgstr "" |
  | 879 | 879 |  |
  | 880 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:45~~4~~ |
  |  | 880 | #: includes/admin/class-wcal-abandoned-cart-details.php:458 |
  | 881 | 881 | #, php-format |
  | 882 | 882 | msgid "Recovered on %s" |
  | 883 | 883 | msgstr "" |
  | 884 | 884 |  |
  | 885 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:47~~0~~ |
  |  | 885 | #: includes/admin/class-wcal-abandoned-cart-details.php:474 |
  | 886 | 886 | #: includes/admin/class-wcal-personal-data-export.php:193 |
  | 887 | 887 | #: includes/admin/class-wcal-personal-data-export.php:208 |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L891) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L891) |  |
  | 891 | 891 | msgstr "" |
  | 892 | 892 |  |
  | 893 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:47~~2~~ |
  |  | 893 | #: includes/admin/class-wcal-abandoned-cart-details.php:476 |
  | 894 | 894 | #: includes/classes/class-wcal-abandoned-orders-table.php:109 |
  | 895 | 895 | #: includes/classes/class-wcal-recover-orders-table.php:136 |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L897) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L897) |  |
  | 897 | 897 | msgstr "" |
  | 898 | 898 |  |
  | 899 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:47~~3~~ |
  |  | 899 | #: includes/admin/class-wcal-abandoned-cart-details.php:477 |
  | 900 | 900 | #: includes/admin/class-wcal-personal-data-export.php:187 |
  | 901 | 901 | #: includes/admin/class-wcal-personal-data-export.php:203 |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L904) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L904) |  |
  | 904 | 904 | msgstr "" |
  | 905 | 905 |  |
  | 906 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:4~~88~~ |
  |  | 906 | #: includes/admin/class-wcal-abandoned-cart-details.php:492 |
  | 907 | 907 | msgid "Item Name" |
  | 908 | 908 | msgstr "" |
  | 909 | 909 |  |
  | 910 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:4~~89~~ |
  |  | 910 | #: includes/admin/class-wcal-abandoned-cart-details.php:493 |
  | 911 | 911 | msgid "Item Cost" |
  | 912 | 912 | msgstr "" |
  | 913 | 913 |  |
  | 914 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:49~~0~~ |
  |  | 914 | #: includes/admin/class-wcal-abandoned-cart-details.php:494 |
  | 915 | 915 | msgid "Item Quantity" |
  | 916 | 916 | msgstr "" |
  | 917 | 917 |  |
  | 918 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:5~~09~~ |
  |  | 918 | #: includes/admin/class-wcal-abandoned-cart-details.php:513 |
  | 919 | 919 | msgid "Close" |
  | 920 | 920 | msgstr "" |
  | 921 | 921 |  |
  | 922 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:74~~2~~ |
  |  | 922 | #: includes/admin/class-wcal-abandoned-cart-details.php:746 |
  | 923 | 923 | msgid "Tax: " |
  | 924 | 924 | msgstr "" |
  | 925 | 925 |  |
  | 926 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:7~~48~~ |
  |  | 926 | #: includes/admin/class-wcal-abandoned-cart-details.php:752 |
  | 927 | 927 | msgid "includes Tax: " |
  | 928 | 928 | msgstr "" |
  | 929 | 929 |  |
  | 930 |  | #: includes/admin/class-wcal-abandoned-cart-details.php:7~~69~~ |
  |  | 930 | #: includes/admin/class-wcal-abandoned-cart-details.php:773 |
  | 931 | 931 | msgid "Product has been deleted" |
  | 932 | 932 | msgstr "" |
  | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2916178#L1874) | […](/browser/woocommerce-abandoned-cart/trunk/i18n/languages/woocommerce-abandoned-cart.pot?rev=2922242#L1874) |  |
  | 1874 | 1874 | msgstr "" |
  | 1875 | 1875 |  |
  | 1876 |  | #: includes/frontend/class-wcal-checkout-process.php:21~~6~~ |
  |  | 1876 | #: includes/frontend/class-wcal-checkout-process.php:218 |
  | 1877 | 1877 | msgid "This order was abandoned & subsequently recovered." |
  | 1878 | 1878 | msgstr "" |
  | 1879 | 1879 |  |
  | 1880 |  | #: includes/frontend/class-wcal-checkout-process.php:32~~4~~ |
  | 1881 |  | #: includes/frontend/class-wcal-checkout-process.php:3~~26~~ |
  |  | 1880 | #: includes/frontend/class-wcal-checkout-process.php:329 |
  |  | 1881 | #: includes/frontend/class-wcal-checkout-process.php:331 |
  | 1882 | 1882 | msgid "New Customer Order - Recovered" |
  | 1883 | 1883 | msgstr "" |
* ## [woocommerce-abandoned-cart/trunk/includes/admin/class-wcal-abandoned-cart-details.php](/changeset/2922242/woocommerce-abandoned-cart/trunk/includes/admin/class-wcal-abandoned-cart-details.php "Show the changeset 2922242 restricted to woocommerce-abandoned-cart/trunk/includes/admin/class-wcal-abandoned-cart-details.php")

  | [r2327412](/browser/woocommerce-abandoned-cart/trunk/includes/admin/class-wcal-abandoned-cart-details.php?rev=2327412#L441 "Show revision 2327412 of this file in browser") | [r2922242](/browser/woocommerce-abandoned-cart/trunk/includes/admin/class-wcal-abandoned-cart-details.php?rev=2922242#L441 "Show revision 2922242 of this file in browser") |  |
  | --- | --- | --- |
  | 441 | 441 | echo wp\_kses\_post( stripslashes( $wcal\_abandoned\_status ) ); |
  | 442 | 442 | if ( $recovered\_order > 0 ) { |
  | 443 |  | $order\_post      = ~~get\_post~~( $recovered\_order ); |
  |  | 443 | $order\_post      = wc\_get\_order( $recovered\_order ); |
  | 444 | 444 | $recovered\_stamp = strtotime( $order\_post->post\_date ); |
  | 445 | 445 |  |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/admin/class-wcal-abandoned-cart-details.php?rev=2327412#L448) | […](/browser/woocommerce-abandoned-cart/trunk/includes/admin/class-wcal-abandoned-cart-details.php?rev=2922242#L448) |  |
  | 448 | 448 | $recovered\_date    = "$order\_date\_format $order\_time\_format"; |
  | 449 | 449 |  |
  | 450 |  | $order\_url = admin\_url( "post.php?post=$recovered\_order&action=edit" ); |
  |  | 450 | if ( wcal\_is\_hpos\_enabled() ) { // HPOS usage is enabled. |
  |  | 451 | $order\_url = admin\_url( "admin.php?page=wc-orders&id=$recovered\_order&action=edit" ); |
  |  | 452 | } else { // Traditional CPT-based orders are in use. |
  |  | 453 | $order\_url = admin\_url( "post.php?post=$recovered\_order&action=edit" ); |
  |  | 454 | } |
  | 451 | 455 | echo wp\_kses\_post( |
  | 452 | 456 | sprintf( |
* ## [woocommerce-abandoned-cart/trunk/includes/class-wcal-common.php](/changeset/2922242/woocommerce-abandoned-cart/trunk/includes/class-wcal-common.php "Show the changeset 2922242 restricted to woocommerce-abandoned-cart/trunk/includes/class-wcal-common.php")

  | [r2773841](/browser/woocommerce-abandoned-cart/trunk/includes/class-wcal-common.php?rev=2773841#L185 "Show revision 2773841 of this file in browser") | [r2922242](/browser/woocommerce-abandoned-cart/trunk/includes/class-wcal-common.php?rev=2922242#L185 "Show revision 2922242 of this file in browser") |  |
  | --- | --- | --- |
  | 185 | 185 | foreach ( $wcal\_data as $wcal\_data\_key => $wcal\_data\_value ) { |
  | 186 | 186 |  |
  | 187 |  | $wcal\_order\_total             = get\_post\_meta( $wcal\_data\_value->recovered\_cart, '\_order\_total', true ); |
  |  | 187 | $order                        = wc\_get\_order( $wcal\_data\_value->recovered\_cart ); |
  |  | 188 | $wcal\_order\_total             = $order ? $order->get\_total() : 0; |
  | 188 | 189 | $wcal\_recovered\_orders\_amount = $wcal\_recovered\_orders\_amount + $wcal\_order\_total; |
  | 189 | 190 | } |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/class-wcal-common.php?rev=2773841#L1539) | […](/browser/woocommerce-abandoned-cart/trunk/includes/class-wcal-common.php?rev=2922242#L1540) |  |
  | 1539 | 1540 | } |
  | 1540 | 1541 |  |
  | 1541 |  | $encoding\_checkout = $cart\_id . '&url=' . $checkout\_page\_link; |
  | 1542 |  | $validate\_checkout = Wcal\_Common::wcal\_encrypt\_validate( $encoding\_checkout ); |
  | 1543 |  |  |
  | 1544 |  | $checkout\_link = get\_option( 'siteurl' ) . '/?wcal\_action=checkout\_link&validate=' . $validate\_checkout; |
  | 1545 |  |  |
  | 1546 |  | $wpdb->update( // phpcs:ignore |
  | 1547 |  | $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite', |
  | 1548 |  | array( |
  | 1549 |  | 'checkout\_link' => $checkout\_link, |
  | 1550 |  | ), |
  | 1551 |  | array( |
  | 1552 |  | 'id' => $cart\_id, |
  | 1553 |  | ) |
  | 1554 |  | ); |
  |  | 1542 | $user\_details = wcal\_get\_contact\_data( $cart\_id ); |
  |  | 1543 | $user\_email   = is\_array( $user\_details ) && count( $user\_details ) > 0 && isset( $user\_details['email'] ) ? $user\_details['email'] : ''; |
  |  | 1544 | if ( '' !== $user\_email ) { |
  |  | 1545 | $crypt\_key         = wcal\_get\_crypt\_key( $user\_email, true, $cart\_id ); |
  |  | 1546 | $encoding\_checkout = $cart\_id . '&url=' . $checkout\_page\_link; |
  |  | 1547 | $validate\_checkout = Wcal\_Common::wcal\_encrypt\_validate( $encoding\_checkout, $crypt\_key ); |
  |  | 1548 |  |
  |  | 1549 | $checkout\_link = get\_option( 'siteurl' ) . '/?wcal\_action=checkout\_link&user\_email=' . $user\_email . '&validate=' . $validate\_checkout; |
  |  | 1550 | $wpdb->update( // phpcs:ignore |
  |  | 1551 | $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite', |
  |  | 1552 | array( |
  |  | 1553 | 'checkout\_link' => $checkout\_link, |
  |  | 1554 | ), |
  |  | 1555 | array( |
  |  | 1556 | 'id' => $cart\_id, |
  |  | 1557 | ) |
  |  | 1558 | ); |
  |  | 1559 | } |
  | 1555 | 1560 | } |
  | 1556 | 1561 |  |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/class-wcal-common.php?rev=2773841#L1558) | […](/browser/woocommerce-abandoned-cart/trunk/includes/class-wcal-common.php?rev=2922242#L1563) |  |
  | 1558 | 1563 | \* This function is used to encode the string. |
  | 1559 | 1564 | \* |
  | 1560 |  | \* @param string $validate String need to encrypt. |
  | 1561 |  | \* @return string $validate\_encoded Encrypted string. |
  |  | 1565 | \* @param string $validate - String need to encrypt. |
  |  | 1566 | \* @param string $crypt\_key - Key to use for encryption. |
  |  | 1567 | \* |
  |  | 1568 | \* @return string $validate\_encoded -  Encrypted string. |
  | 1562 | 1569 | \* @since 1.3 |
  | 1563 | 1570 | \*/ |
  | 1564 |  | public static function wcal\_encrypt\_validate( $validate ) { |
  | 1565 |  | $crypt\_key        = get\_option( 'wcal\_security\_key' ); |
  | 1566 |  | $validate\_encoded = Wcal\_Aes\_Ctr::encrypt( $validate, $crypt\_key, 256 ); |
  | 1567 |  | return( $validate\_encoded ); |
  |  | 1571 | public static function wcal\_encrypt\_validate( $validate, $crypt\_key ) { |
  |  | 1572 | // Fetch the encrypt key. |
  |  | 1573 | if ( '' !== $crypt\_key ) { |
  |  | 1574 | $validate\_encoded = Wcal\_Aes\_Ctr::encrypt( $validate, $crypt\_key, 256 ); |
  |  | 1575 | return( $validate\_encoded ); |
  |  | 1576 | } |
  |  | 1577 | return false; |
  | 1568 | 1578 | } |
  | 1569 | 1579 | } |
* ## [woocommerce-abandoned-cart/trunk/includes/classes/class-wcal-dashboard-report.php](/changeset/2922242/woocommerce-abandoned-cart/trunk/includes/classes/class-wcal-dashboard-report.php "Show the changeset 2922242 restricted to woocommerce-abandoned-cart/trunk/includes/classes/class-wcal-dashboard-report.php")

  | [r2773841](/browser/woocommerce-abandoned-cart/trunk/includes/classes/class-wcal-dashboard-report.php?rev=2773841#L453 "Show revision 2773841 of this file in browser") | [r2922242](/browser/woocommerce-abandoned-cart/trunk/includes/classes/class-wcal-dashboard-report.php?rev=2922242#L453 "Show revision 2922242 of this file in browser") |  |
  | --- | --- | --- |
  | 453 | 453 |  |
  | 454 | 454 | foreach ( $ids as $order\_id ) { |
  | 455 |  | $order\_total = (float) get\_post\_meta( $order\_id, '\_order\_total', true ); |
  |  | 455 | $order       = wc\_get\_order( $order\_id ); |
  |  | 456 | $order\_total = $order ? (float) $order->get\_total() : 0; |
  | 456 | 457 | $amount     += round( $order\_total, 2 ); |
  | 457 | 458 | } |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/classes/class-wcal-dashboard-report.php?rev=2773841#L514) | […](/browser/woocommerce-abandoned-cart/trunk/includes/classes/class-wcal-dashboard-report.php?rev=2922242#L515) |  |
  | 514 | 515 |  |
  | 515 | 516 | if ( $cart\_value->recovered\_cart > 0 ) { |
  | 516 |  | $abandoned\_amount += get\_post\_meta( $cart\_value->recovered\_cart, '\_order\_total', true ); |
  |  | 517 | $order             = wc\_get\_order( $cart\_value->recovered\_cart ); |
  |  | 518 | $abandoned\_amount += $order ? $order->get\_total() : 0; |
  | 517 | 519 | $abandoned\_count++; |
  | 518 | 520 | } else { |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/classes/class-wcal-dashboard-report.php?rev=2773841#L632) | […](/browser/woocommerce-abandoned-cart/trunk/includes/classes/class-wcal-dashboard-report.php?rev=2922242#L634) |  |
  | 632 | 634 | $recovered\_id      = $cart\_value->recovered\_cart; |
  | 633 | 635 | if ( (int) $recovered\_id > 0 ) { |
  | 634 |  | $rec\_order\_total   = get\_post\_meta( $recovered\_id, '\_order\_total', true ); |
  |  | 636 | $order             = wc\_get\_order( $recovered\_id ); |
  |  | 637 | $rec\_order\_total   = $order ? $order->get\_total() : 0; |
  | 635 | 638 | $recovered\_amount += isset( $rec\_order\_total ) && $rec\_order\_total > 0 ? $rec\_order\_total : 0; |
  | 636 | 639 | } |
* ## [woocommerce-abandoned-cart/trunk/includes/classes/class-wcal-recover-orders-table.php](/changeset/2922242/woocommerce-abandoned-cart/trunk/includes/classes/class-wcal-recover-orders-table.php "Show the changeset 2922242 restricted to woocommerce-abandoned-cart/trunk/includes/classes/class-wcal-recover-orders-table.php")

  | [r2451828](/browser/woocommerce-abandoned-cart/trunk/includes/classes/class-wcal-recover-orders-table.php?rev=2451828#L286 "Show revision 2451828 of this file in browser") | [r2922242](/browser/woocommerce-abandoned-cart/trunk/includes/classes/class-wcal-recover-orders-table.php?rev=2922242#L286 "Show revision 2922242 of this file in browser") |  |
  | --- | --- | --- |
  | 286 | 286 | $woo\_order = wc\_get\_order( $recovered\_id ); |
  | 287 | 287 | if ( version\_compare( $woocommerce->version, '3.0.0', '>=' ) ) { |
  | 288 |  | $order                 = ~~get\_post~~( $recovered\_id ); |
  | 289 |  | $recovered\_date        = strtotime( $order->~~post\_date~~ ); |
  |  | 288 | $order                 = wc\_get\_order( $recovered\_id ); |
  |  | 289 | $recovered\_date        = strtotime( $order->get\_date\_created()->date( 'Y-m-d H:i:s' ) ); |
  | 290 | 290 | $recovered\_date\_format = date\_i18n( get\_option( 'date\_format' ), $recovered\_date ); |
  | 291 | 291 | $recovered\_time\_format = date\_i18n( get\_option( 'time\_format' ), $recovered\_date ); |
* ## [woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php](/changeset/2922242/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php "Show the changeset 2922242 restricted to woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php")

  | [r2868556](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2868556#L50 "Show revision 2868556 of this file in browser") | [r2922242](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2922242#L50 "Show revision 2922242 of this file in browser") |  |
  | --- | --- | --- |
  | 50 | 50 | $wcal\_get\_order\_status = $order->get\_status(); |
  | 51 | 51 |  |
  | 52 |  | $get\_abandoned\_id\_of\_order  = ~~get\_post\_meta( $order\_id, 'wcal\_recover\_order\_placed', true~~ ); |
  | 53 |  | $get\_sent\_email\_id\_of\_order = ~~get\_post\_meta( $order\_id, 'wcal\_recover\_order\_placed\_sent\_id', true~~ ); |
  |  | 52 | $get\_abandoned\_id\_of\_order  = $order->get\_meta( 'wcal\_recover\_order\_placed' ); |
  |  | 53 | $get\_sent\_email\_id\_of\_order = $order->get\_meta( 'wcal\_recover\_order\_placed\_sent\_id' ); |
  | 54 | 54 | $recovered                  = wcal\_common::wcal\_get\_cart\_session( 'wcal\_recovered\_cart' ); |
  | 55 | 55 | if ( ( isset( $get\_sent\_email\_id\_of\_order ) && '' !== $get\_sent\_email\_id\_of\_order ) || $recovered ) { |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2868556#L110) | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2922242#L110) |  |
  | 110 | 110 | array( 'id' => $get\_abandoned\_id\_of\_order ) |
  | 111 | 111 | ); |
  | 112 |  | delete\_post\_meta( $order\_id, 'wcal\_recover\_order\_placed', $get\_abandoned\_id\_of\_order ); |
  |  | 112 | $order = wc\_get\_order( $order\_id ); |
  |  | 113 | $order->delete\_meta\_data( 'wcal\_recover\_order\_placed', $get\_abandoned\_id\_of\_order ); |
  |  | 114 | $order->save(); |
  | 113 | 115 | } |
  | 114 | 116 | } |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2868556#L182) | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2922242#L184) |  |
  | 182 | 184 | $update\_sent\_history = array(); |
  | 183 | 185 |  |
  | 184 |  | if ( '' !== ~~get\_post\_meta( $order\_id, 'wcal\_abandoned\_timestamp', true~~ ) ) { |
  | 185 |  | $update\_details['abandoned\_cart\_time']     = ~~get\_post\_meta( $order\_id, 'wcal\_abandoned\_timestamp', true~~ ); |
  |  | 186 | if ( '' !== $order->get\_meta( 'wcal\_abandoned\_timestamp' ) ) { |
  |  | 187 | $update\_details['abandoned\_cart\_time']     = $order->get\_meta( 'wcal\_abandoned\_timestamp' ); |
  | 186 | 188 | $update\_sent\_history['abandoned\_order\_id'] = $cart\_id; |
  | 187 | 189 |  |
  | 188 |  | ~~delete\_post\_meta( $order\_id,~~ 'wcal\_abandoned\_timestamp', $update\_details['abandoned\_cart\_time'] ); |
  |  | 190 | $order->delete\_meta\_data( 'wcal\_abandoned\_timestamp', $update\_details['abandoned\_cart\_time'] ); |
  | 189 | 191 | // update the email sent history table. |
  | 190 | 192 | if ( is\_array( $get\_ids ) && count( $get\_ids ) > 1 ) { |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2868556#L215) | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2922242#L217) |  |
  | 215 | 217 | // Add Order Note. |
  | 216 | 218 | $order->add\_order\_note( \_\_( 'This order was abandoned & subsequently recovered.', 'woocommerce-abandoned-cart' ) ); |
  | 217 |  | delete\_post\_meta( $order\_id, 'wcal\_abandoned\_cart\_id' ); |
  | 218 |  | delete\_post\_meta( $order\_id, 'wcal\_recover\_order\_placed' ); |
  | 219 |  | delete\_post\_meta( $order\_id, 'wcal\_recover\_order\_placed\_sent\_id' ); |
  | 220 |  | delete\_post\_meta( $order\_id, 'wcal\_recovered\_email\_sent' ); |
  |  | 219 | $order->delete\_meta\_data( 'wcal\_abandoned\_cart\_id' ); |
  |  | 220 | $order->delete\_meta\_data( 'wcal\_recover\_order\_placed' ); |
  |  | 221 | $order->delete\_meta\_data( 'wcal\_recover\_order\_placed\_sent\_id' ); |
  |  | 222 | $order->delete\_meta\_data( 'wcal\_recovered\_email\_sent' ); |
  |  | 223 | $order->save(); |
  | 221 | 224 | do\_action( 'wcal\_cart\_recovered', $cart\_id, $order\_id ); |
  | 222 | 225 | } |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2868556#L243) | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2922242#L246) |  |
  | 243 | 246 | $wcal\_guest\_table\_name      = $wpdb->prefix . 'ac\_guest\_abandoned\_cart\_history\_lite'; |
  | 244 | 247 | $wcal\_sent\_email\_table\_name = $wpdb->prefix . 'ac\_sent\_history\_lite'; |
  |  | 248 | $order                      = wc\_get\_order( $order\_id ); |
  | 245 | 249 |  |
  | 246 | 250 | if ( $order\_id > 0 ) { |
  | 247 |  | $get\_abandoned\_id\_of\_order = ~~get\_post\_meta( $order\_id, 'wcal\_recover\_order\_placed', true~~ ); |
  |  | 251 | $get\_abandoned\_id\_of\_order = $order->get\_meta( 'wcal\_recover\_order\_placed' ); |
  | 248 | 252 |  |
  | 249 | 253 | if ( $get\_abandoned\_id\_of\_order > 0 || '' != wcal\_common::wcal\_get\_cart\_session( 'email\_sent\_id' ) ) { // phpcs:ignore |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2868556#L251) | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2922242#L255) |  |
  | 251 | 255 | } else { |
  | 252 | 256 |  |
  | 253 |  | $wcal\_abandoned\_id = ~~get\_post\_meta( $order\_id, 'wcal\_abandoned\_cart\_id', true~~ ); |
  |  | 257 | $wcal\_abandoned\_id = $order->get\_meta( 'wcal\_abandoned\_cart\_id' ); |
  | 254 | 258 | // check if it's a guest cart. |
  | 255 | 259 | // phpcs:ignore WordPress.DB.DirectDatabaseQuery |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2868556#L279) | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2922242#L283) |  |
  | 279 | 283 |  |
  | 280 | 284 | $wcal\_history\_table\_name = $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite'; |
  | 281 |  | $wcal\_abandoned\_id       = get\_post\_meta( $order\_id, 'wcal\_abandoned\_cart\_id', true ); |
  |  | 285 | $order                   = wc\_get\_order( $order\_id ); |
  |  | 286 | $wcal\_abandoned\_id       = $order->get\_meta( 'wcal\_abandoned\_cart\_id' ); |
  | 282 | 287 |  |
  | 283 | 288 | $wpdb->update(  // phpcs:ignore |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2868556#L317) | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2922242#L322) |  |
  | 317 | 322 | } |
  | 318 | 323 | if ( 'on' === $ac\_email\_admin\_recovery ) { |
  | 319 |  | $recovered\_email\_sent          = ~~get\_post\_meta( $order\_id, 'wcal\_recovered\_email\_sent', true~~ ); |
  |  | 324 | $recovered\_email\_sent          = $order->get\_meta( 'wcal\_recovered\_email\_sent' ); |
  | 320 | 325 | $wcal\_check\_order\_is\_recovered = $this->wcal\_check\_order\_is\_recovered( $order\_id ); |
  | 321 | 326 |  |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2868556#L347) | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2922242#L352) |  |
  | 347 | 352 | $email\_body = ob\_get\_clean(); |
  | 348 | 353 | wc\_mail( $user\_email, $email\_subject, $email\_body, $headers ); |
  | 349 |  |  |
  | 350 |  | ~~update\_post\_meta( $order\_id, 'wcal\_recovered\_email\_sent', 'yes'~~ ); |
  |  | 354 | $order->update\_meta\_data( 'wcal\_recovered\_email\_sent', 'yes' ); |
  |  | 355 | $order->save(); |
  | 351 | 356 | } |
  | 352 | 357 | } |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2868556#L396) | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2922242#L401) |  |
  | 396 | 401 | $order = wc\_get\_order( $order\_id ); |
  | 397 | 402 |  |
  | 398 |  | $get\_abandoned\_id\_of\_order  = ~~get\_post\_meta( $order\_id, 'wcal\_recover\_order\_placed', true~~ ); |
  | 399 |  | $get\_sent\_email\_id\_of\_order = ~~get\_post\_meta( $order\_id, 'wcal\_recover\_order\_placed\_sent\_id', true~~ ); |
  |  | 403 | $get\_abandoned\_id\_of\_order  = $order->get\_meta( 'wcal\_recover\_order\_placed' ); |
  |  | 404 | $get\_sent\_email\_id\_of\_order = $order->get\_meta( 'wcal\_recover\_order\_placed\_sent\_id' ); |
  | 400 | 405 |  |
  | 401 | 406 | // Order Status passed in the function is either 'processing' or 'complete' and may or may not reflect the actual order status. |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2868556#L423) | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2922242#L428) |  |
  | 423 | 428 |  |
  | 424 | 429 | if ( $wcal\_user\_id >= 63000000 ) { |
  | 425 |  | ~~add\_post\_meta( $order\_id,~~ 'wcal\_abandoned\_timestamp', $ac\_user\_id\_result[0]->abandoned\_cart\_time ); |
  |  | 430 | $order->add\_meta\_data( 'wcal\_abandoned\_timestamp', $ac\_user\_id\_result[0]->abandoned\_cart\_time ); |
  | 426 | 431 |  |
  | 427 | 432 | $wpdb->delete( // phpcs:ignore |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2868556#L435) | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2922242#L440) |  |
  | 435 | 440 | array( 'id' => $get\_abandoned\_id\_of\_order ) |
  | 436 | 441 | ); |
  | 437 |  | delete\_post\_meta( $order\_id, 'wcal\_recover\_order\_placed', $get\_abandoned\_id\_of\_order ); |
  |  | 442 | $order->delete\_meta\_data( 'wcal\_recover\_order\_placed', $get\_abandoned\_id\_of\_order ); |
  |  | 443 | $order->save(); |
  | 438 | 444 | } |
  | 439 | 445 | } |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2868556#L476) | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2922242#L482) |  |
  | 476 | 482 | $wcal\_user\_id\_of\_guest = wcal\_common::wcal\_get\_cart\_session( 'user\_id' ); |
  | 477 | 483 | $recovered             = wcal\_common::wcal\_get\_cart\_session( 'wcal\_recovered\_cart' ); |
  |  | 484 | $order                 = wc\_get\_order( $order\_id ); |
  | 478 | 485 |  |
  | 479 | 486 | $wcal\_history\_table\_name    = $wpdb->prefix . 'ac\_abandoned\_cart\_history\_lite'; |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2868556#L515) | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2922242#L522) |  |
  | 515 | 522 | $abandoned\_order\_id\_of\_guest = $get\_ac\_id\_guest\_results[0]->id; |
  | 516 | 523 |  |
  | 517 |  | ~~add\_post\_meta( $order\_id,~~ 'wcal\_abandoned\_timestamp', $get\_ac\_id\_guest\_results[0]->abandoned\_cart\_time ); |
  |  | 524 | $order->add\_meta\_data( 'wcal\_abandoned\_timestamp', $get\_ac\_id\_guest\_results[0]->abandoned\_cart\_time ); |
  | 518 | 525 |  |
  | 519 | 526 | $wpdb->delete( // phpcs:ignore |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2868556#L531) | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2922242#L538) |  |
  | 531 | 538 | } |
  | 532 | 539 |  |
  | 533 |  | ~~add\_post\_meta( $order\_id,~~ 'wcal\_recover\_order\_placed\_sent\_id', $email\_sent\_id ); |
  | 534 |  | ~~add\_post\_meta( $order\_id,~~ 'wcal\_recover\_order\_placed', $abandoned\_order\_id ); |
  |  | 540 | $order->add\_meta\_data( 'wcal\_recover\_order\_placed\_sent\_id', $email\_sent\_id ); |
  |  | 541 | $order->add\_meta\_data( 'wcal\_recover\_order\_placed', $abandoned\_order\_id ); |
  | 535 | 542 | } elseif ( '' !== $abandoned\_order\_id ) { |
  | 536 | 543 |  |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2868556#L552) | […](/browser/woocommerce-abandoned-cart/trunk/includes/frontend/class-wcal-checkout-process.php?rev=2922242#L559) |  |
  | 552 | 559 | } |
  | 553 | 560 |  |
  | 554 |  | add\_post\_meta( $order\_id, 'wcal\_abandoned\_cart\_id', $abandoned\_order\_id\_to\_save ); |
  |  | 561 | $order->add\_meta\_data( 'wcal\_abandoned\_cart\_id', $abandoned\_order\_id\_to\_save ); |
  |  | 562 | $order->save(); |
  | 555 | 563 | } |
  | 556 | 564 | } |
* ## [woocommerce-abandoned-cart/trunk/includes/wcal-functions.php](/changeset/2922242/woocommerce-abandoned-cart/trunk/includes/wcal-functions.php "Show the changeset 2922242 restricted to woocommerce-abandoned-cart/trunk/includes/wcal-functions.php")

  | [r2674975](/browser/woocommerce-abandoned-cart/trunk/includes/wcal-functions.php?rev=2674975#L9 "Show revision 2674975 of this file in browser") | [r2922242](/browser/woocommerce-abandoned-cart/trunk/includes/wcal-functions.php?rev=2922242#L9 "Show revision 2922242 of this file in browser") |  |
  | --- | --- | --- |
  | 9 | 9 | \* @since 5.12.0 |
  | 10 | 10 | \*/ |
  |  | 11 |  |
  |  | 12 | use Automattic\WooCommerce\Utilities\OrderUtil; |
  | 11 | 13 |  |
  | 12 | 14 | /\*\* |
  | […](/browser/woocommerce-abandoned-cart/trunk/includes/wcal-functions.php?rev=2674975#L86) | […](/browser/woocommerce-abandoned-cart/trunk/includes/wcal-functions.php?rev=2922242#L88) |  |
  | 86 | 88 | return $product\_details; |
  | 87 | 89 | } |
  |  | 90 |  |
  |  | 91 | /\*\* |
  |  | 92 | \* Return a Random key which can be used for encryption. |
  |  | 93 | \* |
  |  | 94 | \* @param string $user\_email - User EMail Address. |
  |  | 95 | \* @param bool   $insert - Insert and save the crypt key in the sent history table. |
  |  | 96 | \* @param int    $cart\_id - Abandoned Cart ID. |
  |  | 97 | \* @return string $crypt\_key - Key to be used for encryption. |
  |  | 98 | \* |
  |  | 99 | \* @since 5.14.0 |
  |  | 100 | \*/ |
  |  | 101 | function wcal\_get\_crypt\_key( $user\_email, $insert = false, $cart\_id = 0 ) { |
  |  | 102 | global $wpdb; |
  |  | 103 |  |
  |  | 104 | $crypt\_key = $wpdb->get\_var( // phpcs:ignore |
  |  | 105 | $wpdb->prepare( |
  |  | 106 | 'SELECT encrypt\_key FROM `' . $wpdb->prefix . 'ac\_sent\_history\_lite` WHERE sent\_email\_id = %s ORDER BY id DESC', |
  |  | 107 | $user\_email |
  |  | 108 | ) |
  |  | 109 | ); |
  |  | 110 |  |
  |  | 111 | if ( '' === $crypt\_key ) { |
  |  | 112 | $crypt\_key = wcal\_generate\_random\_key(); |
  |  | 113 | if ( $insert ) { // This is true when the checkout link is generated and simply saved in the cart history table. |
  |  | 114 | $wpdb->insert( // phpcs:ignore |
  |  | 115 | $wpdb->prefix . 'ac\_sent\_history\_lite', |
  |  | 116 | array( |
  |  | 117 | 'template\_id'        => 0, |
  |  | 118 | 'abandoned\_order\_id' => $cart\_id, |
  |  | 119 | 'sent\_time'          => current\_time( 'mysql' ), |
  |  | 120 | 'sent\_email\_id'      => $user\_email, |
  |  | 121 | 'encrypt\_key'        => $crypt\_key, |
  |  | 122 | ) |
  |  | 123 | ); |
  |  | 124 |  |
  |  | 125 | } |
  |  | 126 | } |
  |  | 127 | return $crypt\_key; |
  |  | 128 | } |
  |  | 129 |  |
  |  | 130 | /\*\* |
  |  | 131 | \* Generate a 16 digit random key. |
  |  | 132 | \* |
  |  | 133 | \* @return string $random\_string - Random String. |
  |  | 134 | \* @since 5.14.0 |
  |  | 135 | \*/ |
  |  | 136 | function wcal\_generate\_random\_key() { |
  |  | 137 | $characters    = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'; |
  |  | 138 | $random\_string = ''; |
  |  | 139 | $n             = 16; |
  |  | 140 | for ( $i = 0; $i < $n; $i++ ) { |
  |  | 141 | $index          = wp\_rand( 0, strlen( $characters ) - 1 ); |
  |  | 142 | $random\_string .= $characters[ $index ]; |
  |  | 143 | } |
  |  | 144 |  |
  |  | 145 | return $random\_string; |
  |  | 146 | } |
  |  | 147 |  |
  |  | 148 | /\*\* |
  |  | 149 | \* Return personal details for user. |
  |  | 150 | \* |
  |  | 151 | \* @param int $abandoned\_id - Cart ID. |
  |  | 152 | \* @return array $customer\_data - Customer Details. |
  |  | 153 | \* |
  |  | 154 | \* @since 5.14.0 |
  |  | 155 | \*/ |
  |  | 156 | function wcal\_get\_contact\_data( $abandoned\_id ) { |
  |  | 157 | // Fetch the contact data. |
  |  | 158 | $cart\_history  = wcal\_get\_data\_cart\_history( $abandoned\_id ); |
  |  | 159 | $customer\_data = array(); |
  |  | 160 | if ( $cart\_history ) { |
  |  | 161 | // Defaults. |
  |  | 162 | $email     = ''; |
  |  | 163 | $firstname = ''; |
  |  | 164 | $lastname  = ''; |
  |  | 165 | $user\_id   = $cart\_history->user\_id; |
  |  | 166 | $user\_type = $cart\_history->user\_type; |
  |  | 167 |  |
  |  | 168 | if ( $user\_id >= 63000000 && 'GUEST' === $user\_type ) { |
  |  | 169 | $guest\_data = wcal\_get\_data\_guest\_history( $user\_id ); |
  |  | 170 | if ( isset( $cart\_history ) && isset( $guest\_data ) ) { |
  |  | 171 | $email     = $guest\_data->email\_id; |
  |  | 172 | $firstname = $guest\_data->billing\_first\_name; |
  |  | 173 | $lastname  = $guest\_data->billing\_last\_name; |
  |  | 174 | } |
  |  | 175 | } elseif ( $user\_id > 0 ) { |
  |  | 176 | // Get the first & last name from the user data. |
  |  | 177 | $user\_info = new WP\_User( $user\_id ); |
  |  | 178 | $firstname = $user\_info->first\_name; |
  |  | 179 | $lastname  = $user\_info->last\_name; |
  |  | 180 | $email     = $user\_info->user\_email; |
  |  | 181 | } |
  |  | 182 | $customer\_data['firstname'] = $firstname; |
  |  | 183 | $customer\_data['lastname']  = $lastname; |
  |  | 184 | $customer\_data['email']     = $email; |
  |  | 185 | $customer\_data['user\_id']   = $user\_id; |
  |  | 186 | } |
  |  | 187 | return $customer\_data; |
  |  | 188 | } |
  |  | 189 |  |
  |  | 190 | /\*\* |
  |  | 191 | \* Returns if HPOS is enabled |
  |  | 192 | \* |
  |  | 193 | \* @return bool |
  |  | 194 | \* @since  5.14.2 |
  |  | 195 | \*/ |
  |  | 196 | function wcal\_is\_hpos\_enabled() { |
  |  | 197 | if ( version\_compare( WOOCOMMERCE\_VERSION, '7.1.0' ) < 0 ) { |
  |  | 198 | return false; |
  |  | 199 | } |
  |  | 200 | if ( OrderUtil::custom\_orders\_table\_usage\_is\_enabled() ) { |
  |  | 201 | return true; |
  |  | 202 | } |
  |  | 203 | return false; |
  |  | 204 | } |
* ## [woocommerce-abandoned-cart/trunk/readme.txt](/changeset/2922242/woocommerce-abandoned-cart/trunk/readme.txt "Show the changeset 2922242 restricted to woocommerce-abandoned-cart/trunk/readme.txt")

  | [r2916178](/browser/woocommerce-abandoned-cart/trunk/readme.txt?rev=2916178#L156 "Show revision 2916178 of this file in browser") | [r2922242](/browser/woocommerce-abandoned-cart/trunk/readme.txt?rev=2922242#L156 "Show revision 2922242 of this file in browser") |  |
  | --- | --- | --- |
  | 156 | 156 |  |
  | 157 | 157 | == Changelog == |
  |  | 158 |  |
  |  | 159 | = 5.15.0 ( 06.06.2023 ) = |
  |  | 160 | \* Fix - A fatal error received when clicked on checkout link from webhook. |
  |  | 161 | \* Fix - Vulnerability fix for hardcoded encryption key. |
  |  | 162 | \* Enhancement - Introduced compatibility with WooCommerce High Performance Order Storage. |
  | 158 | 163 |  |
  | 159 | 164 | = 5.14.2 ( 23.05.2023 ) = |
* ## [woocommerce-abandoned-cart/trunk/woocommerce-ac.php](/changeset/2922242/woocommerce-abandoned-cart/trunk/woocommerce-ac.php "Show the changeset 2922242 restricted to woocommerce-abandoned-cart/trunk/woocommerce-ac.php")

  | [r2916178](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2916178#L4 "Show revision 2916178 of this file in browser") | [r2922242](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2922242#L4 "Show revision 2922242 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* Plugin URI: http://www.tychesoftwares.com/store/premium-plugins/woocommerce-abandoned-cart-pro |
  | 5 | 5 | \* Description: This plugin captures abandoned carts by logged-in users & emails them about it. <strong><a href="http://www.tychesoftwares.com/store/premium-plugins/woocommerce-abandoned-cart-pro">Click here to get the PRO Version.</a></strong> |
  | 6 |  | \* Version: 5.1~~4.2~~ |
  |  | 6 | \* Version: 5.15.0 |
  | 7 | 7 | \* Author: Tyche Softwares |
  | 8 | 8 | \* Author URI: http://www.tychesoftwares.com/ |
  | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2916178#L11) | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2922242#L11) |  |
  | 11 | 11 | \* Requires PHP: 5.6 |
  | 12 | 12 | \* WC requires at least: 4.0.0 |
  | 13 |  | \* WC tested up to: 7.7 |
  |  | 13 | \* WC tested up to: 7.7.2 |
  | 14 | 14 | \* |
  | 15 | 15 | \* @package Abandoned-Cart-Lite-for-WooCommerce |
  | 16 | 16 | \*/ |
  |  | 17 |  |
  |  | 18 | use Automattic\WooCommerce\Utilities\OrderUtil; |
  | 17 | 19 |  |
  | 18 | 20 | require\_once 'class-wcal-update.php'; |
  | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2916178#L125) | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2922242#L127) |  |
  | 125 | 127 |  |
  | 126 | 128 | if ( ! defined( 'WCAL\_PLUGIN\_VERSION' ) ) { |
  | 127 |  | define( 'WCAL\_PLUGIN\_VERSION', '5.1~~4.2~~' ); |
  |  | 129 | define( 'WCAL\_PLUGIN\_VERSION', '5.15.0' ); |
  | 128 | 130 | } |
  | 129 | 131 |  |
  | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2916178#L194) | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2922242#L196) |  |
  | 194 | 196 | // WordPress Administration Menu. |
  | 195 | 197 | add\_action( 'admin\_menu', array( &$this, 'wcal\_admin\_menu' ) ); |
  |  | 198 | add\_action( 'before\_woocommerce\_init', array( &$this, 'wcal\_custom\_order\_tables\_compatibility' ), 999 ); |
  | 196 | 199 |  |
  | 197 | 200 | // Actions to be done on cart update. |
  | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2916178#L590) | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2922242#L593) |  |
  | 590 | 593 | do\_action( 'wcal\_deactivate' ); |
  | 591 | 594 | } |
  |  | 595 | /\*\* |
  |  | 596 | \* Sets the compatibility with Woocommerce HPOS. |
  |  | 597 | \* |
  |  | 598 | \* @since 5.14.2 |
  |  | 599 | \*/ |
  |  | 600 | public static function wcal\_custom\_order\_tables\_compatibility() { |
  |  | 601 |  |
  |  | 602 | if ( class\_exists( '\Automattic\WooCommerce\Utilities\FeaturesUtil' ) ) { |
  |  | 603 | \Automattic\WooCommerce\Utilities\FeaturesUtil::declare\_compatibility( 'custom\_order\_tables', 'woocommerce-abandoned-cart/woocommerce-ac.php', true ); |
  |  | 604 | \Automattic\WooCommerce\Utilities\FeaturesUtil::declare\_compatibility( 'orders\_cache', 'woocommerce-abandoned-cart/woocommerce-ac.php', true ); |
  |  | 605 | } |
  |  | 606 | } |
  | 592 | 607 |  |
  | 593 | 608 | /\*\* |
  | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2916178#L638) | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2922242#L653) |  |
  | 638 | 653 | `sent\_time` datetime NOT NULL, |
  | 639 | 654 | `sent\_email\_id` text COLLATE utf8\_unicode\_ci NOT NULL, |
  |  | 655 | `encrypt\_key` varchar(500) COLLATE utf8\_unicode\_ci NOT NULL, |
  | 640 | 656 | PRIMARY KEY  (`id`) |
  | 641 | 657 | ) $wcap\_collate AUTO\_INCREMENT=1 " // phpcs:ignore |
  | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2916178#L1728) | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2922242#L1744) |  |
  | 1728 | 1744 | $validate\_email\_address\_string = ''; |
  | 1729 | 1745 | $validate\_email\_id\_decode      = 0; |
  | 1730 |  | $crypt\_key                     = get\_option( 'wcal\_security\_key' ); |
  | 1731 |  | $validate\_email\_id\_decode      = Wcal\_Aes\_Ctr::decrypt( $validate\_email\_id\_string, $crypt\_key, 256 ); |
  |  | 1746 | if ( isset( $\_GET['user\_email'] ) && '' !== $\_GET['user\_email'] ) { // phpcs:ignore |
  |  | 1747 | $sent\_email = sanitize\_text\_field( wp\_unslash( $\_GET['user\_email'] ) ); // phpcs:ignore |
  |  | 1748 | $crypt\_key  = $wpdb->get\_var( // phpcs:ignore |
  |  | 1749 | $wpdb->prepare( |
  |  | 1750 | 'SELECT encrypt\_key FROM `' . $wpdb->prefix . 'ac\_sent\_history\_lite` WHERE sent\_email\_id = %s ORDER BY id DESC', |
  |  | 1751 | $sent\_email |
  |  | 1752 | ) |
  |  | 1753 | ); |
  |  | 1754 | } else { |
  |  | 1755 | $crypt\_key = get\_option( 'wcal\_security\_key' ); |
  |  | 1756 | } |
  |  | 1757 | $validate\_email\_id\_decode = Wcal\_Aes\_Ctr::decrypt( $validate\_email\_id\_string, $crypt\_key, 256 ); |
  | 1732 | 1758 | if ( isset( $\_GET['track\_email\_id'] ) ) { // phpcs:ignore WordPress.Security.NonceVerification |
  | 1733 | 1759 | $encoded\_email\_address         = rawurldecode( sanitize\_text\_field( wp\_unslash( $\_GET['track\_email\_id'] ) ) ); // phpcs:ignore WordPress.Security.NonceVerification |
  | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2916178#L1812) | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2922242#L1838) |  |
  | 1812 | 1838 | $validate\_server\_string  = str\_replace( ' ', '+', $validate\_server\_string ); |
  | 1813 | 1839 | $validate\_encoded\_string = $validate\_server\_string; |
  | 1814 |  | $crypt\_key               = get\_option( 'wcal\_security\_key' ); |
  | 1815 |  | $link\_decode             = Wcal\_Aes\_Ctr::decrypt( $validate\_encoded\_string, $crypt\_key, 256 ); |
  | 1816 |  | $sent\_email\_id\_pos       = strpos( $link\_decode, '&' ); |
  | 1817 |  | $email\_sent\_id           = substr( $link\_decode, 0, $sent\_email\_id\_pos ); |
  |  | 1840 | if ( isset( $\_GET['user\_email'] ) && '' !== $\_GET['user\_email'] ) { // phpcs:ignore |
  |  | 1841 | $sent\_email = sanitize\_text\_field( wp\_unslash( $\_GET['user\_email'] ) ); // phpcs:ignore |
  |  | 1842 | $crypt\_key  = $wpdb->get\_var( // phpcs:ignore |
  |  | 1843 | $wpdb->prepare( |
  |  | 1844 | 'SELECT encrypt\_key FROM `' . $wpdb->prefix . 'ac\_sent\_history\_lite` WHERE sent\_email\_id = %s ORDER BY id DESC', |
  |  | 1845 | $sent\_email |
  |  | 1846 | ) |
  |  | 1847 | ); |
  |  | 1848 | } else { |
  |  | 1849 | $crypt\_key = get\_option( 'wcal\_security\_key' ); |
  |  | 1850 | } |
  |  | 1851 | $link\_decode       = Wcal\_Aes\_Ctr::decrypt( $validate\_encoded\_string, $crypt\_key, 256 ); |
  |  | 1852 | $sent\_email\_id\_pos = strpos( $link\_decode, '&' ); |
  |  | 1853 | $email\_sent\_id     = substr( $link\_decode, 0, $sent\_email\_id\_pos ); |
  | 1818 | 1854 |  |
  | 1819 | 1855 | if ( isset( $\_GET['c'] ) ) { // phpcs:ignore |
  | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2916178#L1948) | […](/browser/woocommerce-abandoned-cart/trunk/woocommerce-ac.php?rev=2922242#L1984) |  |
  | 1948 | 1984 | if ( count( $saved\_cart ) > 0 ) { |
  | 1949 | 1985 | foreach ( $saved\_cart as $key => $value ) { |
  | 1950 |  | if ( count( $value ) > 0 ) { |
  |  | 1986 | if ( is\_array( $value ) && count( $value ) > 0 ) { |
  | 1951 | 1987 | foreach ( $value as $a => $b ) { |
  | 1952 | 1988 | $c['product\_id']        = $b['product\_id']; |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=2922242)
* [Zip Archive](?format=zip&new=2922242)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


