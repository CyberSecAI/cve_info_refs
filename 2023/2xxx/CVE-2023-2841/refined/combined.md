=== Content from www.wordfence.com_d1ff8b9b_20250114_185441.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Advanced Local Pickup for WooCommerce <= 1.5.5 - Authenticated (Administrator+) SQL Injection

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Advanced Local Pickup for WooCommerce <= 1.5.5 - Authenticated (Administrator+) SQL Injection

7.2

**Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H)

| CVE | [CVE-2023-2841](https://www.cve.org/CVERecord?id=CVE-2023-2841) |
| --- | --- |
| CVSS | 7.2 (High) |
| Publicly Published | October 21, 2023 |
| Last Updated | January 22, 2024 |
| Researcher | [Marco Wotschka - Wordfence](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/marco-wotschka) |

### Description

The Advanced Local Pickup for WooCommerce plugin for WordPress is vulnerable to time-based SQL Injection via the id parameter in versions up to, and including, 1.5.5 due to insufficient escaping on the user supplied parameter and lack of sufficient preparation on the existing SQL query. This makes it possible for authenticated attackers with admin-level privileges to append additional SQL queries into already existing queries that can be used to extract sensitive information from the database.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/advanced-local-pickup-for-woocommerce/trunk/include/wc-local-pickup-admin.php?rev=2889033#L447)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&new=2986002%40advanced-local-pickup-for-woocommerce%2Ftrunk&old=2983681%40advanced-local-pickup-for-woocommerce%2Ftrunk&sfp_email=&sfph_mail=)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fadvanced-local-pickup-for-woocommerce%2Fadvanced-local-pickup-for-woocommerce-155-authenticated-administrator-sql-injection&t=Advanced%20Local%20Pickup%20for%20WooCommerce%20%3C%3D%201.5.5%20-%20Authenticated%20%28Administrator%2B%29%20SQL%20Injection "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fadvanced-local-pickup-for-woocommerce%2Fadvanced-local-pickup-for-woocommerce-155-authenticated-administrator-sql-injection&text=Advanced%20Local%20Pickup%20for%20WooCommerce%20%3C%3D%201.5.5%20-%20Authenticated%20%28Administrator%2B%29%20SQL%20Injection "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fadvanced-local-pickup-for-woocommerce%2Fadvanced-local-pickup-for-woocommerce-155-authenticated-administrator-sql-injection "LinkedIn")
Email

## Vulnerability Details for Advanced Local Pickup for WooCommerce

#### [Advanced Local Pickup for WooCommerce](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/advanced-local-pickup-for-woocommerce)

| Software Type | Plugin |
| --- | --- |
| Software Slug | advanced-local-pickup-for-woocommerce [(view on wordpress.org)](https://wordpress.org/plugins/advanced-local-pickup-for-woocommerce) |
| Patched? | Yes |
| Remediation | Update to version 1.6.0, or a newer patched version |
| Affected Version | * <= 1.5.5 |
| Patched Version | * 1.6.0 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_c9728729_20250114_185437.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fadvanced-local-pickup-for-woocommerce%2Ftrunk%2Finclude%2Fwc-local-pickup-admin.php%3Frev%3D2889033)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/advanced-local-pickup-for-woocommerce/trunk/include/wc-local-pickup-admin.php?rev=2868675 "Revision 2868675")
* [Latest Revision](/browser/advanced-local-pickup-for-woocommerce/trunk/include/wc-local-pickup-admin.php)
* [Next Revision](/browser/advanced-local-pickup-for-woocommerce/trunk/include/wc-local-pickup-admin.php?rev=2926295 "Revision 2926295") →
* [Blame](/browser/advanced-local-pickup-for-woocommerce/trunk/include/wc-local-pickup-admin.php?annotate=blame&rev=2889033 "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/advanced-local-pickup-for-woocommerce/trunk/include/wc-local-pickup-admin.php?rev=2889033)

---

# [source:](/browser?rev=2889033&order=name "Go to repository root") [advanced-local-pickup-for-woocommerce](/browser/advanced-local-pickup-for-woocommerce?rev=2889033&order=name "View advanced-local-pickup-for-woocommerce")/[trunk](/browser/advanced-local-pickup-for-woocommerce/trunk?rev=2889033&order=name "View trunk")/[include](/browser/advanced-local-pickup-for-woocommerce/trunk/include?rev=2889033&order=name "View include")/[wc-local-pickup-admin.php](/browser/advanced-local-pickup-for-woocommerce/trunk/include/wc-local-pickup-admin.php?rev=2889033&order=name "View wc-local-pickup-admin.php") @ [2889033](/changeset/2889033/ "View changeset 2889033")

View diff against:

View revision:

| [Last change](/changeset/2889033/advanced-local-pickup-for-woocommerce/trunk/include/wc-local-pickup-admin.php "View differences") on this file since 2889033 was [2889033](/changeset/2889033/ "View changeset 2889033"), checked in by zorem, [22 months ago](/timeline?from=2023-03-29T09%3A26%3A16Z&precision=second "See timeline at 03/29/2023 09:26:16 AM") |
| --- |
| updated version 1.5.3 |
| * Property **svn:eol-style** set to   *`native`* | |
| **File size:** 66.8 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | if ( ! defined( 'ABSPATH' ) ) { |
| [3](#L3) | exit; |
| [4](#L4) | } |
| [5](#L5) |  |
| [6](#L6) | class WC\_Local\_Pickup\_Admin { |
| [7](#L7) |  |
| [8](#L8) | /\*\* |
| [9](#L9) | \* Get the class instance |
| [10](#L10) | \* |
| [11](#L11) | \* @since  1.0 |
| [12](#L12) | \* @return WC\_Local\_pickup\_Admin |
| [13](#L13) | \*/ |
| [14](#L14) | public static function get\_instance() { |
| [15](#L15) |  |
| [16](#L16) | if ( null === self::$instance ) { |
| [17](#L17) | self::$instance = new self(); |
| [18](#L18) | } |
| [19](#L19) |  |
| [20](#L20) | return self::$instance; |
| [21](#L21) | } |
| [22](#L22) |  |
| [23](#L23) | /\*\* |
| [24](#L24) | \* Instance of this class. |
| [25](#L25) | \* |
| [26](#L26) | \* @var object Class Instance |
| [27](#L27) | \*/ |
| [28](#L28) | private static $instance; |
| [29](#L29) |  |
| [30](#L30) | /\*\* |
| [31](#L31) | \* Initialize the main plugin function |
| [32](#L32) | \* |
| [33](#L33) | \* @since  1.0 |
| [34](#L34) | \*/ |
| [35](#L35) | public function \_\_construct() { |
| [36](#L36) | $this->init(); |
| [37](#L37) | } |
| [38](#L38) |  |
| [39](#L39) | /\* |
| [40](#L40) | \* init function |
| [41](#L41) | \* |
| [42](#L42) | \* @since  1.0 |
| [43](#L43) | \*/ |
| [44](#L44) | public function init() { |
| [45](#L45) |  |
| [46](#L46) | //adding hooks |
| [47](#L47) |  |
| [48](#L48) | add\_action('admin\_menu', array( $this, 'register\_woocommerce\_menu' ), 99 ); |
| [49](#L49) |  |
| [50](#L50) | //ajax save admin api settings |
| [51](#L51) | add\_action( 'wp\_ajax\_wclp\_setting\_form\_update', array( $this, 'wclp\_setting\_form\_update\_callback' ) ); |
| [52](#L52) | add\_action( 'wp\_ajax\_wclp\_location\_edit\_form\_update', array( $this, 'wclp\_location\_edit\_form\_update\_callback' ) ); |
| [53](#L53) |  |
| [54](#L54) | // Register new status |
| [55](#L55) | add\_action( 'init', array( $this, 'register\_pickup\_order\_status' ) ); |
| [56](#L56) |  |
| [57](#L57) | // Add to list of WC Order statuses |
| [58](#L58) | add\_filter( 'wc\_order\_statuses', array( $this, 'add\_pickup\_to\_order\_statuses' ) ); |
| [59](#L59) | add\_filter( 'bulk\_actions-edit-shop\_order', array( $this, 'add\_bulk\_actions\_change\_order\_status' ), 50, 1 ); |
| [60](#L60) | add\_filter( 'bulk\_actions-woocommerce\_page\_wc-orders', array( $this, 'add\_bulk\_actions\_change\_order\_status'), 50, 1 ); |
| [61](#L61) |  |
| [62](#L62) | // Add to custom email for WC Order statuses |
| [63](#L63) | add\_filter( 'woocommerce\_email\_before\_order\_table', array( $this, 'add\_location\_address\_detail\_emails' ), 2, 4 ); |
| [64](#L64) |  |
| [65](#L65) | // Add Addition content for processing email |
| [66](#L66) | add\_filter( 'woocommerce\_email\_before\_order\_table', array( $this, 'add\_addional\_content\_on\_processing\_email' ), 1, 4 ); |
| [67](#L67) | add\_filter( 'woocommerce\_admin\_order\_actions', array( $this, 'add\_local\_pickup\_order\_status\_actions\_button' ), 100, 2 ); |
| [68](#L68) |  |
| [69](#L69) | add\_action( 'woocommerce\_view\_order', array( $this, 'add\_location\_address\_detail\_order' ), 10, 2 ); |
| [70](#L70) |  |
| [71](#L71) | add\_action( 'woocommerce\_order\_details\_before\_order\_table', array( $this, 'add\_location\_address\_detail\_order\_received' ), 10, 2 ); |
| [72](#L72) |  |
| [73](#L73) | add\_action( 'admin\_footer', array( $this, 'footer\_function' ), 1 ); |
| [74](#L74) |  |
| [75](#L75) | add\_action( 'wp\_ajax\_wclp\_update\_state\_dropdown', array( $this, 'wclp\_update\_state\_dropdown\_fun') ); |
| [76](#L76) | add\_action( 'wp\_ajax\_wclp\_update\_work\_hours\_list', array( $this, 'wclp\_update\_work\_hours\_list\_fun' ) ); |
| [77](#L77) | add\_action( 'wp\_ajax\_wclp\_update\_edit\_location\_form', array( $this, 'wclp\_update\_edit\_location\_form\_fun') ); |
| [78](#L78) | add\_action( 'wp\_ajax\_wclp\_apply\_work\_hours', array( $this, 'wclp\_apply\_work\_hours\_fun' ) ); |
| [79](#L79) |  |
| [80](#L80) | add\_filter( 'woocommerce\_valid\_order\_statuses\_for\_order\_again', array( $this, 'add\_reorder\_button\_pickup' ), 50, 1 ); |
| [81](#L81) | add\_filter( 'admin\_body\_class', array( $this, 'wp\_body\_classes' ) ); |
| [82](#L82) |  |
| [83](#L83) | } |
| [84](#L84) |  |
| [85](#L85) | public function wp\_body\_classes( $classes ) { |
| [86](#L86) | $page = isset($\_GET['page']) ? sanitize\_text\_field($\_GET['page']) : ''; |
| [87](#L87) | if ( isset($page) && 'local\_pickup' == sanitize\_text\_field($page)) { |
| [88](#L88) | $classes .= ' woocommerce\_page\_local\_pickup'; |
| [89](#L89) | } |
| [90](#L90) | return $classes; |
| [91](#L91) | } |
| [92](#L92) |  |
| [93](#L93) |  |
| [94](#L94) | /\* |
| [95](#L95) | \* Admin Menu add function |
| [96](#L96) | \* WC sub menu |
| [97](#L97) | \*/ |
| [98](#L98) | public function register\_woocommerce\_menu() { |
| [99](#L99) |  |
| [100](#L100) | if ( class\_exists( 'Advanced\_local\_pickup\_PRO' ) ) { |
| [101](#L101) | $menu\_label = 'Local Pickup <strong style="color:#009933;">Pro</strong>'; |
| [102](#L102) | } else { |
| [103](#L103) | $menu\_label = 'Local Pickup'; |
| [104](#L104) | } |
| [105](#L105) |  |
| [106](#L106) | add\_submenu\_page( 'woocommerce', 'Local Pickup', $menu\_label, 'manage\_options', 'local\_pickup', array( $this, 'woocommerce\_local\_pickup\_page\_callback' ) ); //woocommerce\_local\_pickup\_page\_callback |
| [107](#L107) | } |
| [108](#L108) |  |
| [109](#L109) | /\* |
| [110](#L110) | \* Callback for Advanced Local Pickup page |
| [111](#L111) | \*/ |
| [112](#L112) | public function woocommerce\_local\_pickup\_page\_callback() { |
| [113](#L113) | $tab = isset( $\_GET['tab'] ) ? sanitize\_text\_field($\_GET['tab']) : ''; |
| [114](#L114) | $section = isset( $\_GET['section'] ) ? sanitize\_text\_field($\_GET['section']) : ''; |
| [115](#L115) | $data = $this->get\_data(); |
| [116](#L116) | $location\_id = get\_option('location\_defualt', min($data)->id); |
| [117](#L117) | ?> |
| [118](#L118) | <div class="zorem-layout\_\_header"> |
| [119](#L119) | <?php if ( 'edit' !== $section && 'add' !== $section ) { ?> |
| [120](#L120) | <h1 class="page\_heading"> |
| [121](#L121) | <a href="javascript:void(0)"><?php esc\_html\_e( 'Local Pickup', 'advanced-local-pickup-for-woocommerce' ); ?></a> <span class="dashicons dashicons-arrow-right-alt2"></span> <span class="breadcums\_page\_heading"><?php 'go-pro' == $tab ? esc\_html\_e( 'Go Pro', 'advanced-local-pickup-for-woocommerce' ) : esc\_html\_e( 'Settings', 'advanced-local-pickup-for-woocommerce' ); ?></span> |
| [122](#L122) | </h1> |
| [123](#L123) | <img class="zorem-layout\_\_header-logo" src="<?php echo esc\_url(wc\_local\_pickup()->plugin\_dir\_url(\_\_FILE\_\_)) . 'assets/images/alp-icon.png'; ?>"> |
| [124](#L124) | <?php } else { ?> |
| [125](#L125) | <h1 class="tab\_section\_heading"> |
| [126](#L126) | <a href="<?php echo esc\_url(admin\_url() . 'admin.php?page=local\_pickup'); ?>" class="link decoration"><?php esc\_html\_e( 'Pickup Locations', 'advanced-local-pickup-for-woocommerce' ); ?></a> > |
| [127](#L127) | <?php esc\_html\_e( 'Edit Pickup Location', 'advanced-local-pickup-for-woocommerce' ); ?> |
| [128](#L128) | </h1> |
| [129](#L129) | <?php } ?> |
| [130](#L130) | </div> |
| [131](#L131) | <?php do\_action( 'alp\_settings\_admin\_notice' ); ?> |
| [132](#L132) | <div class="woocommerce wclp\_admin\_layout"> |
| [133](#L133) | <?php |
| [134](#L134) | $style = ''; |
| [135](#L135) | if ( 'edit' == $section ) { |
| [136](#L136) | $style = 'style="display:none;"'; |
| [137](#L137) | } |
| [138](#L138) | ?> |
| [139](#L139) | <div class="woocommerce-layout\_\_activity-panel" <?php echo esc\_html($style); ?>> |
| [140](#L140) | <div class="woocommerce-layout\_\_activity-panel-tabs"> |
| [141](#L141) | <button type="button" id="activity-panel-tab-help" class="components-button woocommerce-layout\_\_activity-panel-tab"> |
| [142](#L142) | <span class="dashicons dashicons-menu-alt"></span> |
| [143](#L143) | </button> |
| [144](#L144) | </div> |
| [145](#L145) | <div class="woocommerce-layout\_\_activity-panel-wrapper"> |
| [146](#L146) | <div class="woocommerce-layout\_\_activity-panel-content" id="activity-panel-true"> |
| [147](#L147) | <div class="woocommerce-layout\_\_activity-panel-header"> |
| [148](#L148) | <div class="woocommerce-layout\_\_inbox-title"> |
| [149](#L149) | <p class="css-activity-panel-Text">Documentation</p> |
| [150](#L150) | </div> |
| [151](#L151) | </div> |
| [152](#L152) | <div> |
| [153](#L153) | <ul class="woocommerce-list woocommerce-quick-links\_\_list"> |
| [154](#L154) | <li class="woocommerce-list\_\_item has-action"> |
| [155](#L155) | <?php |
| [156](#L156) | $support\_link = class\_exists( 'Advanced\_local\_pickup\_PRO' ) ? 'https://www.zorem.com/?support=1' : 'https://wordpress.org/support/plugin/advanced-local-pickup-for-woocommerce/#new-topic-0' ; |
| [157](#L157) | ?> |
| [158](#L158) | <a href="<?php echo esc\_url( $support\_link ); ?>" class="woocommerce-list\_\_item-inner" target="\_blank" > |
| [159](#L159) | <div class="woocommerce-list\_\_item-before"> |
| [160](#L160) | <img src="<?php echo esc\_url(wc\_local\_pickup()->plugin\_dir\_url(\_\_FILE\_\_)) . 'assets/images/get-support-icon.svg'; ?>"> |
| [161](#L161) | </div> |
| [162](#L162) | <div class="woocommerce-list\_\_item-text"> |
| [163](#L163) | <span class="woocommerce-list\_\_item-title"> |
| [164](#L164) | <div class="woocommerce-list-Text">Get Support</div> |
| [165](#L165) | </span> |
| [166](#L166) | </div> |
| [167](#L167) | <div class="woocommerce-list\_\_item-after"> |
| [168](#L168) | <span class="dashicons dashicons-arrow-right-alt2"></span> |
| [169](#L169) | </div> |
| [170](#L170) | </a> |
| [171](#L171) | </li> |
| [172](#L172) | <li class="woocommerce-list\_\_item has-action"> |
| [173](#L173) | <a href="https://www.zorem.com/docs/advanced-local-pickup-for-woocommerce/?utm\_source=wp-admin&utm\_medium=CBRDOCU&utm\_campaign=add-ons" class="woocommerce-list\_\_item-inner" target="\_blank"> |
| [174](#L174) | <div class="woocommerce-list\_\_item-before"> |
| [175](#L175) | <img src="<?php echo esc\_url(wc\_local\_pickup()->plugin\_dir\_url(\_\_FILE\_\_)) . 'assets/images/documentation-icon.svg'; ?>"> |
| [176](#L176) | </div> |
| [177](#L177) | <div class="woocommerce-list\_\_item-text"> |
| [178](#L178) | <span class="woocommerce-list\_\_item-title"> |
| [179](#L179) | <div class="woocommerce-list-Text">Documentation</div> |
| [180](#L180) | </span> |
| [181](#L181) | </div> |
| [182](#L182) | <div class="woocommerce-list\_\_item-after"> |
| [183](#L183) | <span class="dashicons dashicons-arrow-right-alt2"></span> |
| [184](#L184) | </div> |
| [185](#L185) | </a> |
| [186](#L186) | </li> |
| [187](#L187) | <?php if ( !class\_exists( 'Advanced\_local\_pickup\_PRO' ) ) { ?> |
| [188](#L188) | <li class="woocommerce-list\_\_item has-action"> |
| [189](#L189) | <a href="https://www.zorem.com/product/advanced-local-pickup-for-woocommerce/?utm\_source=wp-admin&utm\_medium=CBR&utm\_campaign=add-ons" class="woocommerce-list\_\_item-inner" target="\_blank"> |
| [190](#L190) | <div class="woocommerce-list\_\_item-before"> |
| [191](#L191) | <img src="<?php echo esc\_url(wc\_local\_pickup()->plugin\_dir\_url(\_\_FILE\_\_)) . 'assets/images/upgrade.svg'; ?>"> |
| [192](#L192) | </div> |
| [193](#L193) | <div class="woocommerce-list\_\_item-text"> |
| [194](#L194) | <span class="woocommerce-list\_\_item-title"> |
| [195](#L195) | <div class="woocommerce-list-Text">Upgrade To Pro</div> |
| [196](#L196) | </span> |
| [197](#L197) | </div> |
| [198](#L198) | <div class="woocommerce-list\_\_item-after"> |
| [199](#L199) | <span class="dashicons dashicons-arrow-right-alt2"></span> |
| [200](#L200) | </div> |
| [201](#L201) | </a> |
| [202](#L202) | </li> |
| [203](#L203) | <?php } ?> |
| [204](#L204) | </ul> |
| [205](#L205) | </div> |
| [206](#L206) | </div> |
| [207](#L207) | </div> |
| [208](#L208) | </div> |
| [209](#L209) | <div class="wclp\_admin\_content"> |
| [210](#L210) | <?php |
| [211](#L211) | $style = ''; |
| [212](#L212) | if ( 'edit' == $section ) { |
| [213](#L213) | $style = 'style="display:none;"'; |
| [214](#L214) | } |
| [215](#L215) | ?> |
| [216](#L216) | <input id="tab1" type="radio" name="tabs" class="wclp\_tab\_input" data-label="<?php esc\_html\_e('Settings', 'woocommerce'); ?>" data-tab="settings" checked> |
| [217](#L217) | <a for="tab1" href="admin.php?page=local\_pickup&tab=settings" class="wclp\_tab\_label first\_label <?php echo ( 'settings' === $tab ) ? 'nav-tab-active' : ''; ?>" <?php echo esc\_html($style); ?>><?php esc\_html\_e('Settings', 'woocommerce'); ?></a> |
| [218](#L218) | <input id="tab3" type="radio" name="tabs" class="wclp\_tab\_input" data-label="<?php esc\_html\_e('Pickup Location', 'advanced-local-pickup-for-woocommerce'); ?>" data-tab="locations" <?php echo ( 'locations' === $tab ) ? 'checked' : ''; ?>> |
| [219](#L219) | <a for="tab3" href="admin.php?page=local\_pickup&tab=locations<?php echo ( !class\_exists( 'Advanced\_local\_pickup\_PRO' ) ) ? '&section=edit&id=' . esc\_html($location\_id) : ''; ?>" class="wclp\_tab\_label <?php echo ( 'locations' === $tab ) ? 'nav-tab-active' : ''; ?>" <?php echo esc\_html($style); ?>><?php esc\_html\_e('Pickup Location', 'advanced-local-pickup-for-woocommerce'); ?></a> |
| [220](#L220) | <input id="tab5" type="radio" name="tabs" class="wclp\_tab\_input" data-label="<?php esc\_html\_e('Customize', 'advanced-local-pickup-for-woocommerce'); ?>" data-tab="customize" <?php echo ( 'customize' === $tab ) ? 'checked' : ''; ?>> |
| [221](#L221) | <a for="tab5" href="<?php echo esc\_url(admin\_url('admin.php?page=alp\_customizer&email\_type=ready\_pickup')); ?>" class="wclp\_tab\_label <?php echo ( 'customize' === $tab ) ? 'nav-tab-active' : ''; ?>" <?php echo esc\_html($style); ?>><?php esc\_html\_e('Customize', 'advanced-local-pickup-for-woocommerce'); ?></a> |
| [222](#L222) | <input id="tab4" type="radio" name="tabs" class="wclp\_tab\_input" data-label="<?php esc\_html\_e('Go Pro', 'advanced-local-pickup-for-woocommerce'); ?>" data-tab="go-pro" <?php echo ( 'go-pro' === $tab ) ? 'checked' : ''; ?>> |
| [223](#L223) | <a for="tab4" href="admin.php?page=local\_pickup&tab=go-pro" class="wclp\_tab\_label <?php echo ( 'go-pro' === $tab ) ? 'nav-tab-active' : ''; ?>" <?php echo esc\_html($style); ?>><?php esc\_html\_e('Go Pro', 'advanced-local-pickup-for-woocommerce'); ?></a> |
| [224](#L224) | <div class="menu\_devider" <?php echo esc\_html($style); ?>></div> |
| [225](#L225) | <?php require\_once( 'views/wclp\_setting\_tab.php' ); ?> |
| [226](#L226) | <?php require\_once( 'views/wclp\_locations\_tab.php' ); ?> |
| [227](#L227) | <?php require\_once( 'views/wclp\_addon\_tab.php' ); ?> |
| [228](#L228) | </div> |
| [229](#L229) | </div> |
| [230](#L230) | <?php |
| [231](#L231) | } |
| [232](#L232) |  |
| [233](#L233) |  |
| [234](#L234) | /\* |
| [235](#L235) | \* Settings form save for Setting tab |
| [236](#L236) | \*/ |
| [237](#L237) | public function wclp\_setting\_form\_update\_callback() { |
| [238](#L238) |  |
| [239](#L239) | if ( !current\_user\_can( 'manage\_options' ) ) { |
| [240](#L240) | echo json\_encode( array('permission' => 'false') ); |
| [241](#L241) | die(); |
| [242](#L242) | } |
| [243](#L243) |  |
| [244](#L244) | if ( ! empty( $\_POST ) && check\_admin\_referer( 'wclp\_setting\_form\_action', 'wclp\_setting\_form\_nonce\_field' ) ) { |
| [245](#L245) |  |
| [246](#L246) | $wclp\_processing\_additional\_content = isset($\_POST['wclp\_processing\_additional\_content']) ? sanitize\_text\_field($\_POST['wclp\_processing\_additional\_content']) : ''; |
| [247](#L247) | if (isset($wclp\_processing\_additional\_content)) { |
| [248](#L248) | update\_option( 'wclp\_processing\_additional\_content', $wclp\_processing\_additional\_content ); |
| [249](#L249) | } |
| [250](#L250) |  |
| [251](#L251) | $display\_in\_processing\_email = isset($\_POST['wclp\_show\_pickup\_instruction']['display\_in\_processing\_email']) ? sanitize\_text\_field($\_POST['wclp\_show\_pickup\_instruction']['display\_in\_processing\_email']) : ''; |
| [252](#L252) | $display\_in\_order\_received\_page = isset($\_POST['wclp\_show\_pickup\_instruction']['display\_in\_order\_received\_page']) ? sanitize\_text\_field($\_POST['wclp\_show\_pickup\_instruction']['display\_in\_order\_received\_page']) : ''; |
| [253](#L253) | $display\_in\_order\_details\_page = isset($\_POST['wclp\_show\_pickup\_instruction']['display\_in\_order\_details\_page']) ? sanitize\_text\_field($\_POST['wclp\_show\_pickup\_instruction']['display\_in\_order\_details\_page']) : ''; |
| [254](#L254) | $wclp\_show\_pickup\_instruction\_opt = array( |
| [255](#L255) | 'display\_in\_processing\_email' => $display\_in\_processing\_email, |
| [256](#L256) | 'display\_in\_order\_received\_page' => $display\_in\_order\_received\_page, |
| [257](#L257) | 'display\_in\_order\_details\_page' => $display\_in\_order\_details\_page, |
| [258](#L258) | ); |
| [259](#L259) | update\_option( 'wclp\_show\_pickup\_instruction', $wclp\_show\_pickup\_instruction\_opt); |
| [260](#L260) |  |
| [261](#L261) |  |
| [262](#L262) | // local pickup setting html hook |
| [263](#L263) | do\_action('wclp\_general\_setting\_save\_hook'); |
| [264](#L264) |  |
| [265](#L265) | $wclp\_status\_ready\_pickup = isset($\_POST['wclp\_status\_ready\_pickup']) ? sanitize\_text\_field($\_POST['wclp\_status\_ready\_pickup']) : ''; |
| [266](#L266) | update\_option( 'wclp\_status\_ready\_pickup', $wclp\_status\_ready\_pickup ); |
| [267](#L267) | $wclp\_ready\_pickup\_status\_label\_color = isset($\_POST['wclp\_ready\_pickup\_status\_label\_color']) ? sanitize\_text\_field($\_POST['wclp\_ready\_pickup\_status\_label\_color']) : ''; |
| [268](#L268) | update\_option( 'wclp\_ready\_pickup\_status\_label\_color', $wclp\_ready\_pickup\_status\_label\_color ); |
| [269](#L269) | $wclp\_ready\_pickup\_status\_label\_font\_color = isset($\_POST['wclp\_ready\_pickup\_status\_label\_font\_color']) ? sanitize\_text\_field($\_POST['wclp\_ready\_pickup\_status\_label\_font\_color']) : ''; |
| [270](#L270) | update\_option( 'wclp\_ready\_pickup\_status\_label\_font\_color', $wclp\_ready\_pickup\_status\_label\_font\_color ); |
| [271](#L271) | $wclp\_status\_picked\_up = isset($\_POST['wclp\_status\_picked\_up']) ? sanitize\_text\_field($\_POST['wclp\_status\_picked\_up']) : ''; |
| [272](#L272) | update\_option( 'wclp\_status\_picked\_up', $wclp\_status\_picked\_up ); |
| [273](#L273) | $wclp\_pickup\_status\_label\_color = isset($\_POST['wclp\_pickup\_status\_label\_color']) ? sanitize\_text\_field($\_POST['wclp\_pickup\_status\_label\_color']) : ''; |
| [274](#L274) | update\_option( 'wclp\_pickup\_status\_label\_color', $wclp\_pickup\_status\_label\_color ); |
| [275](#L275) | $wclp\_pickup\_status\_label\_font\_color = isset($\_POST['wclp\_pickup\_status\_label\_font\_color']) ? sanitize\_text\_field($\_POST['wclp\_pickup\_status\_label\_font\_color']) : ''; |
| [276](#L276) | update\_option( 'wclp\_pickup\_status\_label\_font\_color', $wclp\_pickup\_status\_label\_font\_color ); |
| [277](#L277) |  |
| [278](#L278) | $pickup\_email = get\_option('woocommerce\_customer\_pickup\_order\_settings', array()); |
| [279](#L279) | $wclp\_enable\_pickup\_email = isset($\_POST['wclp\_enable\_pickup\_email']) ? sanitize\_text\_field($\_POST['wclp\_enable\_pickup\_email']) : ''; |
| [280](#L280) | if (1 == $wclp\_enable\_pickup\_email) { |
| [281](#L281) | update\_option( 'customizer\_pickup\_order\_settings\_enabled', $wclp\_enable\_pickup\_email ); |
| [282](#L282) | $enabled = 'yes'; |
| [283](#L283) | } else { |
| [284](#L284) | update\_option( 'customizer\_pickup\_order\_settings\_enabled', sanitize\_text\_field( '' )); |
| [285](#L285) | $enabled = 'no'; |
| [286](#L286) | } |
| [287](#L287) |  |
| [288](#L288) | $opt = array( |
| [289](#L289) | 'enabled' => $enabled, |
| [290](#L290) | 'subject' => isset($pickup\_email['subject']) ? $pickup\_email['subject'] : '', |
| [291](#L291) | 'heading' => isset($pickup\_email['heading']) ? $pickup\_email['heading'] : '', |
| [292](#L292) | 'additional\_content' => isset($pickup\_email['additional\_content']) ? $pickup\_email['additional\_content'] : '', |
| [293](#L293) | 'recipient' => isset($pickup\_email['recipient']) ? $pickup\_email['recipient'] : '', |
| [294](#L294) | 'email\_type' => isset($pickup\_email['email\_type']) ? $pickup\_email['email\_type'] : 'html', |
| [295](#L295) | ); |
| [296](#L296) | update\_option( 'woocommerce\_customer\_pickup\_order\_settings', wc\_clean( $opt ) ); |
| [297](#L297) |  |
| [298](#L298) | $ready\_pickup\_email = get\_option('woocommerce\_customer\_ready\_pickup\_order\_settings'); |
| [299](#L299) | $wclp\_enable\_ready\_pickup\_email = isset($\_POST['wclp\_enable\_ready\_pickup\_email']) ? sanitize\_text\_field($\_POST['wclp\_enable\_ready\_pickup\_email']) : ''; |
| [300](#L300) | if (1 == $wclp\_enable\_ready\_pickup\_email) { |
| [301](#L301) | update\_option( 'customizer\_ready\_pickup\_order\_settings\_enabled', $wclp\_enable\_ready\_pickup\_email ); |
| [302](#L302) | $enabled = 'yes'; |
| [303](#L303) | } else { |
| [304](#L304) | update\_option( 'customizer\_ready\_pickup\_order\_settings\_enabled', sanitize\_text\_field( '' )); |
| [305](#L305) | $enabled = 'no'; |
| [306](#L306) | } |
| [307](#L307) |  |
| [308](#L308) | $opt = array( |
| [309](#L309) | 'enabled' => $enabled, |
| [310](#L310) | 'subject' => isset($ready\_pickup\_email['subject']) ? $ready\_pickup\_email['subject'] : '', |
| [311](#L311) | 'heading' => isset($ready\_pickup\_email['heading']) ? $ready\_pickup\_email['heading'] : '', |
| [312](#L312) | 'additional\_content' => isset($ready\_pickup\_email['additional\_content']) ? $ready\_pickup\_email['additional\_content'] : '', |
| [313](#L313) | 'recipient' => isset($ready\_pickup\_email['recipient']) ? $ready\_pickup\_email['recipient'] : '', |
| [314](#L314) | 'email\_type' => isset($ready\_pickup\_email['email\_type']) ? $ready\_pickup\_email['email\_type'] : 'html', |
| [315](#L315) | ); |
| [316](#L316) | update\_option( 'woocommerce\_customer\_ready\_pickup\_order\_settings', wc\_clean( $opt ) ); |
| [317](#L317) | echo json\_encode( array('success' => 'true') ); |
| [318](#L318) | die(); |
| [319](#L319) |  |
| [320](#L320) | } |
| [321](#L321) | } |
| [322](#L322) |  |
| [323](#L323) | /\* |
| [324](#L324) | \* Get all data |
| [325](#L325) | \*/ |
| [326](#L326) | public function get\_data() { |
| [327](#L327) | global $wpdb; |
| [328](#L328) | $this->table = $wpdb->prefix . 'alp\_pickup\_location'; |
| [329](#L329) | // Avoid database table not found errors when plugin is first installed |
| [330](#L330) | // by checking if the plugin option exists |
| [331](#L331) | if ( empty( $this->data ) ) { |
| [332](#L332) | $this->data = array(); |
| [333](#L333) |  |
| [334](#L334) | $wpdb->hide\_errors(); |
| [335](#L335) |  |
| [336](#L336) | $results = $wpdb->get\_results( $wpdb->prepare('SELECT \* FROM %1s ORDER BY position ASC', $this->table) ); //ORDER BY name ASC |
| [337](#L337) |  |
| [338](#L338) | $this->data = $results; |
| [339](#L339) | } |
| [340](#L340) | return $this->data; |
| [341](#L341) | } |
| [342](#L342) |  |
| [343](#L343) | /\* |
| [344](#L344) | \* Settings form save for Setting tab |
| [345](#L345) | \*/ |
| [346](#L346) | public function wclp\_location\_edit\_form\_update\_callback() { |
| [347](#L347) |  |
| [348](#L348) | if ( !current\_user\_can( 'manage\_options' ) ) { |
| [349](#L349) | echo json\_encode( array('permission' => 'false') ); |
| [350](#L350) | die(); |
| [351](#L351) | } |
| [352](#L352) |  |
| [353](#L353) | if ( ! empty( $\_POST ) && check\_admin\_referer( 'wclp\_location\_edit\_form\_action', 'wclp\_location\_edit\_form\_nonce\_field' ) ) { |
| [354](#L354) |  |
| [355](#L355) | global $wpdb; |
| [356](#L356) |  |
| [357](#L357) | $id = isset($\_POST['id']) ? sanitize\_text\_field($\_POST['id']) : ''; |
| [358](#L358) | $data = $this->get\_data(); |
| [359](#L359) |  |
| [360](#L360) | if ('0' == $id) { |
| [361](#L361) | if ( !class\_exists( 'Advanced\_local\_pickup\_PRO' ) && count($data) > 1 ) { |
| [362](#L362) | $array = array( |
| [363](#L363) | 'success' => 'fail', |
| [364](#L364) | 'msg' => 'you have not pro plguin', |
| [365](#L365) | ); |
| [366](#L366) | echo json\_encode($array); |
| [367](#L367) | die(); |
| [368](#L368) | } |
| [369](#L369) |  |
| [370](#L370) | $data = array( |
| [371](#L371) | 'store\_name' => isset( $\_POST['wclp\_store\_name'] ) ? sanitize\_text\_field( $\_POST['wclp\_store\_name'] ) : '', |
| [372](#L372) | ); |
| [373](#L373) | $wpdb->insert( $this->table, $data ); |
| [374](#L374) | $id = $wpdb->insert\_id; |
| [375](#L375) | } |
| [376](#L376) |  |
| [377](#L377) | $wclp\_store\_name = isset($\_POST['wclp\_store\_name']) ? sanitize\_text\_field($\_POST['wclp\_store\_name']) : ''; |
| [378](#L378) | $wclp\_store\_address = isset($\_POST['wclp\_store\_address']) ? sanitize\_text\_field($\_POST['wclp\_store\_address']) : ''; |
| [379](#L379) | $wclp\_store\_address\_2 = isset($\_POST['wclp\_store\_address\_2']) ? sanitize\_text\_field($\_POST['wclp\_store\_address\_2']) : ''; |
| [380](#L380) | $wclp\_store\_city = isset($\_POST['wclp\_store\_city']) ? sanitize\_text\_field($\_POST['wclp\_store\_city']) : ''; |
| [381](#L381) | $wclp\_default\_country = isset($\_POST['wclp\_default\_country']) ? sanitize\_text\_field($\_POST['wclp\_default\_country']) : ''; |
| [382](#L382) | $wclp\_store\_postcode = isset($\_POST['wclp\_store\_postcode']) ? sanitize\_text\_field($\_POST['wclp\_store\_postcode']) : ''; |
| [383](#L383) | $wclp\_store\_phone = isset($\_POST['wclp\_store\_phone']) ? sanitize\_text\_field($\_POST['wclp\_store\_phone']) : ''; |
| [384](#L384) | $wclp\_default\_time\_format = isset($\_POST['wclp\_default\_time\_format']) ? sanitize\_text\_field($\_POST['wclp\_default\_time\_format']) : ''; |
| [385](#L385) | $wclp\_store\_days = isset($\_POST['wclp\_store\_days']) ? serialize(wc\_clean($\_POST['wclp\_store\_days'])) : get\_option('wclp\_store\_days'); |
| [386](#L386) | $wclp\_store\_instruction = isset($\_POST['wclp\_store\_instruction']) ? sanitize\_text\_field($\_POST['wclp\_store\_instruction']) : ''; |
| [387](#L387) |  |
| [388](#L388) |  |
| [389](#L389) | //get form field |
| [390](#L390) | $data = array( |
| [391](#L391) | 'store\_name' => $wclp\_store\_name, |
| [392](#L392) | 'store\_address' => $wclp\_store\_address, |
| [393](#L393) | 'store\_address\_2' => $wclp\_store\_address\_2, |
| [394](#L394) | 'store\_city' => $wclp\_store\_city, |
| [395](#L395) | 'store\_country' => $wclp\_default\_country, |
| [396](#L396) | 'store\_postcode' => $wclp\_store\_postcode, |
| [397](#L397) | 'store\_phone' => $wclp\_store\_phone, |
| [398](#L398) | 'store\_time\_format' => $wclp\_default\_time\_format, |
| [399](#L399) | 'store\_days' => $wclp\_store\_days, |
| [400](#L400) | 'store\_instruction' => $wclp\_store\_instruction, |
| [401](#L401) | ); |
| [402](#L402) |  |
| [403](#L403) | // local pickup location edit form save hook |
| [404](#L404) | $data = apply\_filters('wclp\_location\_edit\_form\_save\_hook', $data); |
| [405](#L405) |  |
| [406](#L406) | //check column exist |
| [407](#L407) | $tabledata = $wpdb->get\_row( $wpdb->prepare('SELECT \* FROM %1s LIMIT 1', $this->table) ); |
| [408](#L408) | //print\_r($tabledata ); |
| [409](#L409) | foreach ( (array) $data as $key1 => $val1 ) { |
| [410](#L410) | if ( 'store\_name' == $key1 ) { |
| [411](#L411) | continue; |
| [412](#L412) | } |
| [413](#L413) | if (!isset($tabledata->$key1)) { |
| [414](#L414) | $wpdb->query( $wpdb->prepare( 'ALTER TABLE %1s ADD %2s text NOT NULL', $this->table, $key1) ); |
| [415](#L415) | } |
| [416](#L416) | } |
| [417](#L417) |  |
| [418](#L418) |  |
| [419](#L419) | $array = array('success' => 'true', 'id' => $id) ; |
| [420](#L420) |  |
| [421](#L421) | $where = array( |
| [422](#L422) | 'id' => $id, |
| [423](#L423) | ); |
| [424](#L424) |  |
| [425](#L425) | $result = $wpdb->update( $this->table, $data, $where ); |
| [426](#L426) |  |
| [427](#L427) | //WPML string registed |
| [428](#L428) | do\_action( 'wpml\_register\_single\_string', 'advanced-local-pickup-pro', $wclp\_store\_name, $wclp\_store\_name ); |
| [429](#L429) | do\_action( 'wpml\_register\_single\_string', 'advanced-local-pickup-pro', $wclp\_store\_instruction, $wclp\_store\_instruction ); |
| [430](#L430) | do\_action( 'wpml\_register\_single\_string', 'advanced-local-pickup-pro', $wclp\_store\_address, $wclp\_store\_address ); |
| [431](#L431) | do\_action( 'wpml\_register\_single\_string', 'advanced-local-pickup-pro', $wclp\_store\_address\_2, $wclp\_store\_address\_2 ); |
| [432](#L432) | do\_action( 'wpml\_register\_single\_string', 'advanced-local-pickup-pro', $wclp\_store\_city, $wclp\_store\_city ); |
| [433](#L433) |  |
| [434](#L434) | echo json\_encode( $array ); |
| [435](#L435) | die(); |
| [436](#L436) | } |
| [437](#L437) | } |
| [438](#L438) |  |
| [439](#L439) | /\* |
| [440](#L440) | \* Get data by id |
| [441](#L441) | \*/ |
| [442](#L442) | public function get\_data\_byid( $id ) { |
| [443](#L443) | global $wpdb; |
| [444](#L444) |  |
| [445](#L445) | $this->table = $wpdb->prefix . 'alp\_pickup\_location'; |
| [446](#L446) |  |
| [447](#L447) | $results = $wpdb->get\_row( $wpdb->prepare( 'SELECT \* FROM %1s WHERE id = %2s', $this->table, $id ) ); |
| [448](#L448) |  |
| [449](#L449) | $results = $this->get\_slaches\_data\_byid($results); |
| [450](#L450) |  |
| [451](#L451) | return $results; |
| [452](#L452) | } |
| [453](#L453) |  |
| [454](#L454) | /\*\* |
| [455](#L455) | \* Remove slashes from strings, arrays and objects |
| [456](#L456) | \* |
| [457](#L457) | \* @param    mixed   input data |
| [458](#L458) | \* @return   mixed   cleaned input data |
| [459](#L459) | \*/ |
| [460](#L460) | public function get\_slaches\_data\_byid( $results ) { |
| [461](#L461) | if (is\_array($results)) { |
| [462](#L462) | $results = array\_map('get\_slaches\_data\_byid', $results); |
| [463](#L463) | } elseif (is\_object($results)) { |
| [464](#L464) | $vars = get\_object\_vars($results); |
| [465](#L465) | foreach ($vars as $k=>$v) { |
| [466](#L466) | $results->$k = stripslashes($v); |
| [467](#L467) | } |
| [468](#L468) | } else { |
| [469](#L469) | $results = stripslashes($results); |
| [470](#L470) | } |
| [471](#L471) | return $results; |
| [472](#L472) | } |
| [473](#L473) |  |
| [474](#L474) | // Register new status |
| [475](#L475) | public function register\_pickup\_order\_status() { |
| [476](#L476) |  |
| [477](#L477) | $ready\_for\_pickup = get\_option( 'wclp\_status\_ready\_pickup', 0); |
| [478](#L478) | if (true == $ready\_for\_pickup) { |
| [479](#L479) | register\_post\_status( 'wc-ready-pickup', array( |
| [480](#L480) | 'label'                     => esc\_html\_\_( 'Ready for Pickup', 'advanced-local-pickup-for-woocommerce' ), |
| [481](#L481) | 'public'                    => true, |
| [482](#L482) | 'exclude\_from\_search'       => false, |
| [483](#L483) | 'show\_in\_admin\_all\_list'    => true, |
| [484](#L484) | 'show\_in\_admin\_status\_list' => true, |
| [485](#L485) | /\* translators: %s: search term \*/ |
| [486](#L486) | 'label\_count'               => \_n\_noop( 'Ready for Pickup (%s)', 'Ready for Pickup (%s)' ) |
| [487](#L487) | ) ); |
| [488](#L488) | } |
| [489](#L489) |  |
| [490](#L490) | $picked = get\_option( 'wclp\_status\_picked\_up', 0); |
| [491](#L491) | if (true == $picked) { |
| [492](#L492) | register\_post\_status( 'wc-pickup', array( |
| [493](#L493) | 'label'                     => esc\_html\_\_( 'Picked up', 'advanced-local-pickup-for-woocommerce' ), |
| [494](#L494) | 'public'                    => true, |
| [495](#L495) | 'exclude\_from\_search'       => false, |
| [496](#L496) | 'show\_in\_admin\_all\_list'    => true, |
| [497](#L497) | 'show\_in\_admin\_status\_list' => true, |
| [498](#L498) | /\* translators: %s: search term \*/ |
| [499](#L499) | 'label\_count'               => \_n\_noop( 'Picked up (%s)', 'Picked up (%s)' ) |
| [500](#L500) | ) ); |
| [501](#L501) | } |
| [502](#L502) |  |
| [503](#L503) | } |
| [504](#L504) |  |
| [505](#L505) | // Add to list of WC Order statuses |
| [506](#L506) | public function add\_pickup\_to\_order\_statuses( $order\_statuses ) { |
| [507](#L507) |  |
| [508](#L508) | $new\_order\_statuses = array(); |
| [509](#L509) |  |
| [510](#L510) | // add new order status after processing |
| [511](#L511) | foreach ( $order\_statuses as $key => $status ) { |
| [512](#L512) |  |
| [513](#L513) | $new\_order\_statuses[ $key ] = $status; |
| [514](#L514) |  |
| [515](#L515) | $ready\_for\_pickup = get\_option( 'wclp\_status\_ready\_pickup', 0); |
| [516](#L516) | if (true == $ready\_for\_pickup) { |
| [517](#L517) | if ( 'wc-processing' === $key ) { |
| [518](#L518) | $new\_order\_statuses['wc-ready-pickup'] = esc\_html\_\_( 'Ready for Pickup', 'advanced-local-pickup-for-woocommerce' ); |
| [519](#L519) | } |
| [520](#L520) | } |
| [521](#L521) |  |
| [522](#L522) | $picked = get\_option( 'wclp\_status\_picked\_up', 0); |
| [523](#L523) | if (true == $picked) { |
| [524](#L524) | if ( 'wc-processing' === $key ) { |
| [525](#L525) | $new\_order\_statuses['wc-pickup'] = esc\_html\_\_( 'Picked up', 'advanced-local-pickup-for-woocommerce' ); |
| [526](#L526) | } |
| [527](#L527) | } |
| [528](#L528) | } |
| [529](#L529) |  |
| [530](#L530) | return $new\_order\_statuses; |
| [531](#L531) | } |
| [532](#L532) |  |
| [533](#L533) | // Add bulk action change status to custom order status |
| [534](#L534) | public function add\_bulk\_actions\_change\_order\_status( $bulk\_actions ) { |
| [535](#L535) | $ready\_for\_pickup = get\_option( 'wclp\_status\_ready\_pickup', 0); |
| [536](#L536) | if (true == $ready\_for\_pickup) { |
| [537](#L537) | $bulk\_actions['mark\_ready-pickup'] = esc\_html\_\_( 'Change status to ready for pickup', 'advanced-local-pickup-for-woocommerce' ); |
| [538](#L538) | } |
| [539](#L539) | $picked = get\_option( 'wclp\_status\_picked\_up', 0); |
| [540](#L540) | if (true == $picked) { |
| [541](#L541) | $bulk\_actions['mark\_pickup'] = esc\_html\_\_( 'Change status to picked up', 'advanced-local-pickup-for-woocommerce' ); |
| [542](#L542) | } |
| [543](#L543) | return $bulk\_actions; |
| [544](#L544) | } |
| [545](#L545) |  |
| [546](#L546) | public function add\_location\_address\_detail\_order\_received( $order\_id ) { |
| [547](#L547) |  |
| [548](#L548) | $wclp\_show\_pickup\_instruction = get\_option('wclp\_show\_pickup\_instruction'); |
| [549](#L549) |  |
| [550](#L550) | ////IF display location details not enabel then @return; |
| [551](#L551) | if (!is\_order\_received\_page()) { |
| [552](#L552) | return; |
| [553](#L553) | } |
| [554](#L554) |  |
| [555](#L555) | if (!isset($wclp\_show\_pickup\_instruction['display\_in\_order\_received\_page'])) { |
| [556](#L556) | return; |
| [557](#L557) | } |
| [558](#L558) | if ( isset($wclp\_show\_pickup\_instruction['display\_in\_order\_received\_page']) && '1' != $wclp\_show\_pickup\_instruction['display\_in\_order\_received\_page'] ) { |
| [559](#L559) | return; |
| [560](#L560) | } |
| [561](#L561) |  |
| [562](#L562) | $order = wc\_get\_order($order\_id); |
| [563](#L563) |  |
| [564](#L564) | // Iterating through order shipping items |
| [565](#L565) | foreach ( $order->get\_items( 'shipping' ) as $item\_id => $shipping\_item\_obj ) { |
| [566](#L566) | $shipping\_method = $shipping\_item\_obj->get\_method\_id(); |
| [567](#L567) | } |
| [568](#L568) |  |
| [569](#L569) | //IF  dshipping method is not local pickup then @return; |
| [570](#L570) | if ( !isset($shipping\_method ) ) { |
| [571](#L571) | return; |
| [572](#L572) | } |
| [573](#L573) | if ( isset($shipping\_method ) && 'local\_pickup' != $shipping\_method ) { |
| [574](#L574) | return; |
| [575](#L575) | } |
| [576](#L576) |  |
| [577](#L577) | $local\_template = get\_stylesheet\_directory() . '/woocommerce/emails/pickup-instruction.php'; |
| [578](#L578) |  |
| [579](#L579) | $data = $this->get\_data(); |
| [580](#L580) | $location\_id = get\_option('location\_defualt', min($data)->id); |
| [581](#L581) |  |
| [582](#L582) | $location = $this->get\_data\_byid($location\_id); |
| [583](#L583) |  |
| [584](#L584) | $country\_code = isset($location) ? $location->store\_country : get\_option('woocommerce\_default\_country'); |
| [585](#L585) |  |
| [586](#L586) | $split\_country = explode( ':', $country\_code ); |
| [587](#L587) | $store\_country = isset($split\_country[0]) ? $split\_country[0] : ''; |
| [588](#L588) | $store\_state   = isset($split\_country[1]) ? $split\_country[1] : ''; |
| [589](#L589) |  |
| [590](#L590) | $store\_days = isset($location->store\_days) ? unserialize($location->store\_days) : array(); |
| [591](#L591) | $all\_days = array( |
| [592](#L592) | 'sunday' => esc\_html\_\_( 'Sunday', 'advanced-local-pickup-for-woocommerce' ), |
| [593](#L593) | 'monday' => esc\_html\_\_( 'Monday', 'advanced-local-pickup-for-woocommerce'), |
| [594](#L594) | 'tuesday' => esc\_html\_\_( 'Tuesday', 'advanced-local-pickup-for-woocommerce' ), |
| [595](#L595) | 'wednesday' => esc\_html\_\_( 'Wednesday', 'advanced-local-pickup-for-woocommerce' ), |
| [596](#L596) | 'thursday' => esc\_html\_\_( 'Thursday', 'advanced-local-pickup-for-woocommerce' ), |
| [597](#L597) | 'friday' => esc\_html\_\_( 'Friday', 'advanced-local-pickup-for-woocommerce' ), |
| [598](#L598) | 'saturday' => esc\_html\_\_( 'Saturday', 'advanced-local-pickup-for-woocommerce' ), |
| [599](#L599) | ); |
| [600](#L600) | $w\_day = array\_slice($all\_days, get\_option('start\_of\_week')); |
| [601](#L601) | foreach ($all\_days as $key=>$val) { |
| [602](#L602) | $w\_day[$key] = $val; |
| [603](#L603) | } |
| [604](#L604) | foreach ($store\_days as $key => $val) { |
| [605](#L605) | if ($w\_day[$key]) { |
| [606](#L606) | $w\_day[$key] = $val; |
| [607](#L607) | } |
| [608](#L608) | } |
| [609](#L609) |  |
| [610](#L610) | $wclp\_default\_time\_format = isset($location) ? $location->store\_time\_format : '24'; |
| [611](#L611) | if ('12' == $wclp\_default\_time\_format) { |
| [612](#L612) | foreach ($w\_day as $key=>$val) { |
| [613](#L613) | if (isset($val['wclp\_store\_hour'])) { |
| [614](#L614) | $last\_digit = explode(':', $val['wclp\_store\_hour']); |
| [615](#L615) | if ('00' == end($last\_digit)) { |
| [616](#L616) | $val['wclp\_store\_hour'] = gmdate('g:ia', strtotime($val['wclp\_store\_hour'])); |
| [617](#L617) | } else { |
| [618](#L618) | $val['wclp\_store\_hour'] = gmdate('g:ia', strtotime($val['wclp\_store\_hour'])); |
| [619](#L619) | } |
| [620](#L620) | } |
| [621](#L621) | if (isset($val['wclp\_store\_hour\_end'])) { |
| [622](#L622) | $last\_digit = explode(':', $val['wclp\_store\_hour\_end']); |
| [623](#L623) | if ('00' == end($last\_digit)) { |
| [624](#L624) | $val['wclp\_store\_hour\_end'] = gmdate('g:ia', strtotime($val['wclp\_store\_hour\_end'])); |
| [625](#L625) | } else { |
| [626](#L626) | $val['wclp\_store\_hour\_end'] = gmdate('g:ia', strtotime($val['wclp\_store\_hour\_end'])); |
| [627](#L627) | } |
| [628](#L628) | } |
| [629](#L629) | $w\_day[$key] = $val; |
| [630](#L630) | } |
| [631](#L631) | } |
| [632](#L632) |  |
| [633](#L633) | if ( file\_exists( $local\_template ) && is\_writable( $local\_template )) { |
| [634](#L634) | wc\_get\_template( 'myaccount/pickup-instruction.php', array( 'w\_day' => $w\_day, 'location' => $location, 'store\_country' => $store\_country, 'store\_state' => $store\_state ), 'advanced-local-pickup-for-woocommerce/', get\_stylesheet\_directory() . '/woocommerce/' ); |
| [635](#L635) | } else { |
| [636](#L636) | wc\_get\_template( 'myaccount/pickup-instruction.php', array( 'w\_day' => $w\_day, 'location' => $location, 'store\_country' => $store\_country, 'store\_state' => $store\_state ), 'advanced-local-pickup-for-woocommerce/', wc\_local\_pickup()->get\_plugin\_path() . '/templates/' ); |
| [637](#L637) | } |
| [638](#L638) |  |
| [639](#L639) | } |
| [640](#L640) |  |
| [641](#L641) | public function add\_location\_address\_detail\_order( $order\_id ) { |
| [642](#L642) |  |
| [643](#L643) | $wclp\_show\_pickup\_instruction = get\_option('wclp\_show\_pickup\_instruction'); |
| [644](#L644) | ////IF display location details not enabel then @return; |
| [645](#L645) |  |
| [646](#L646) | if (!is\_view\_order\_page()) { |
| [647](#L647) | return; |
| [648](#L648) | } |
| [649](#L649) |  |
| [650](#L650) | if (!isset($wclp\_show\_pickup\_instruction['display\_in\_order\_details\_page'])) { |
| [651](#L651) | return; |
| [652](#L652) | } |
| [653](#L653) | if ( isset($wclp\_show\_pickup\_instruction['display\_in\_order\_details\_page']) && '1' != $wclp\_show\_pickup\_instruction['display\_in\_order\_details\_page'] ) { |
| [654](#L654) | return; |
| [655](#L655) | } |
| [656](#L656) |  |
| [657](#L657) | $order = wc\_get\_order($order\_id); |
| [658](#L658) |  |
| [659](#L659) | // Iterating through order shipping items |
| [660](#L660) | foreach ( $order->get\_items( 'shipping' ) as $item\_id => $shipping\_item\_obj ) { |
| [661](#L661) | $shipping\_method = $shipping\_item\_obj->get\_method\_id(); |
| [662](#L662) | } |
| [663](#L663) |  |
| [664](#L664) | //IF  dshipping method is not local pickup then @return; |
| [665](#L665) | if ( !isset($shipping\_method ) ) { |
| [666](#L666) | return; |
| [667](#L667) | } |
| [668](#L668) | if ( isset($shipping\_method ) && 'local\_pickup' != $shipping\_method ) { |
| [669](#L669) | return; |
| [670](#L670) | } |
| [671](#L671) |  |
| [672](#L672) | $local\_template = get\_stylesheet\_directory() . '/woocommerce/emails/pickup-instruction.php'; |
| [673](#L673) |  |
| [674](#L674) | $data = $this->get\_data(); |
| [675](#L675) | $location\_id = get\_option('location\_defualt', min($data)->id); |
| [676](#L676) |  |
| [677](#L677) | $location = $this->get\_data\_byid($location\_id); |
| [678](#L678) |  |
| [679](#L679) | $country\_code = isset($location) ? $location->store\_country : get\_option('woocommerce\_default\_country'); |
| [680](#L680) |  |
| [681](#L681) | $split\_country = explode( ':', $country\_code ); |
| [682](#L682) | $store\_country = isset($split\_country[0]) ? $split\_country[0] : ''; |
| [683](#L683) | $store\_state   = isset($split\_country[1]) ? $split\_country[1] : ''; |
| [684](#L684) |  |
| [685](#L685) | $store\_days = isset($location->store\_days) ? unserialize($location->store\_days) : array(); |
| [686](#L686) | $all\_days = array( |
| [687](#L687) | 'sunday' => esc\_html\_\_( 'Sunday', 'advanced-local-pickup-for-woocommerce' ), |
| [688](#L688) | 'monday' => esc\_html\_\_( 'Monday', 'advanced-local-pickup-for-woocommerce'), |
| [689](#L689) | 'tuesday' => esc\_html\_\_( 'Tuesday', 'advanced-local-pickup-for-woocommerce' ), |
| [690](#L690) | 'wednesday' => esc\_html\_\_( 'Wednesday', 'advanced-local-pickup-for-woocommerce' ), |
| [691](#L691) | 'thursday' => esc\_html\_\_( 'Thursday', 'advanced-local-pickup-for-woocommerce' ), |
| [692](#L692) | 'friday' => esc\_html\_\_( 'Friday', 'advanced-local-pickup-for-woocommerce' ), |
| [693](#L693) | 'saturday' => esc\_html\_\_( 'Saturday', 'advanced-local-pickup-for-woocommerce' ), |
| [694](#L694) | ); |
| [695](#L695) | $w\_day = array\_slice($all\_days, get\_option('start\_of\_week')); |
| [696](#L696) | foreach ($all\_days as $key=>$val) { |
| [697](#L697) | $w\_day[$key] = $val; |
| [698](#L698) | } |
| [699](#L699) | foreach ($store\_days as $key => $val) { |
| [700](#L700) | if ($w\_day[$key]) { |
| [701](#L701) | $w\_day[$key] = $val; |
| [702](#L702) | } |
| [703](#L703) | } |
| [704](#L704) |  |
| [705](#L705) | $wclp\_default\_time\_format = isset($location) ? $location->store\_time\_format : '24'; |
| [706](#L706) | if ('12' == $wclp\_default\_time\_format) { |
| [707](#L707) | foreach ($w\_day as $key=>$val) { |
| [708](#L708) | if (isset($val['wclp\_store\_hour'])) { |
| [709](#L709) | $last\_digit = explode(':', $val['wclp\_store\_hour']); |
| [710](#L710) | if ('00' == end($last\_digit)) { |
| [711](#L711) | $val['wclp\_store\_hour'] = gmdate('g:ia', strtotime($val['wclp\_store\_hour'])); |
| [712](#L712) | } else { |
| [713](#L713) | $val['wclp\_store\_hour'] = gmdate('g:ia', strtotime($val['wclp\_store\_hour'])); |
| [714](#L714) | } |
| [715](#L715) | } |
| [716](#L716) | if (isset($val['wclp\_store\_hour\_end'])) { |
| [717](#L717) | $last\_digit = explode(':', $val['wclp\_store\_hour\_end']); |
| [718](#L718) | if ('00' == end($last\_digit)) { |
| [719](#L719) | $val['wclp\_store\_hour\_end'] = gmdate('g:ia', strtotime($val['wclp\_store\_hour\_end'])); |
| [720](#L720) | } else { |
| [721](#L721) | $val['wclp\_store\_hour\_end'] = gmdate('g:ia', strtotime($val['wclp\_store\_hour\_end'])); |
| [722](#L722) | } |
| [723](#L723) | } |
| [724](#L724) | $w\_day[$key] = $val; |
| [725](#L725) | } |
| [726](#L726) | } |
| [727](#L727) |  |
| [728](#L728) | if ( file\_exists( $local\_template ) && is\_writable( $local\_template )) { |
| [729](#L729) | wc\_get\_template( 'myaccount/pickup-instruction.php', array( 'w\_day' => $w\_day, 'location' => $location, 'store\_country' => $store\_country, 'store\_state' => $store\_state ), 'advanced-local-pickup-for-woocommerce/', get\_stylesheet\_directory() . '/woocommerce/' ); |
| [730](#L730) | } else { |
| [731](#L731) | wc\_get\_template( 'myaccount/pickup-instruction.php', array( 'w\_day' => $w\_day, 'location' => $location, 'store\_country' => $store\_country, 'store\_state' => $store\_state ), 'advanced-local-pickup-for-woocommerce/', wc\_local\_pickup()->get\_plugin\_path() . '/templates/' ); |
| [732](#L732) | } |
| [733](#L733) |  |
| [734](#L734) | } |
| [735](#L735) |  |
| [736](#L736) | public function add\_location\_address\_detail\_emails( $order, $sent\_to\_admin, $plain\_text, $email ) { |
| [737](#L737) |  |
| [738](#L738) | //IF display location details not enabel then @return; |
| [739](#L739) | $wclp\_show\_pickup\_instruction = get\_option('wclp\_show\_pickup\_instruction'); |
| [740](#L740) |  |
| [741](#L741) | // Iterating through order shipping items |
| [742](#L742) | foreach ( $order->get\_items( 'shipping' ) as $item\_id => $shipping\_item\_obj ) { |
| [743](#L743) | $shipping\_method = $shipping\_item\_obj->get\_method\_id(); |
| [744](#L744) | } |
| [745](#L745) |  |
| [746](#L746) | //IF  dshipping method is not local pickup then @return; |
| [747](#L747) | if ( !isset($shipping\_method ) ) { |
| [748](#L748) | return; |
| [749](#L749) | } |
| [750](#L750) | if ( isset($shipping\_method ) && 'local\_pickup' != $shipping\_method ) { |
| [751](#L751) | return; |
| [752](#L752) | } |
| [753](#L753) |  |
| [754](#L754) | $local\_template = get\_stylesheet\_directory() . '/woocommerce/emails/pickup-instruction.php'; |
| [755](#L755) |  |
| [756](#L756) | $data = $this->get\_data(); |
| [757](#L757) | $location\_id = get\_option('location\_defualt', min($data)->id); |
| [758](#L758) |  |
| [759](#L759) | $location = $this->get\_data\_byid($location\_id); |
| [760](#L760) |  |
| [761](#L761) | $country\_code = isset($location) ? $location->store\_country : get\_option('woocommerce\_default\_country'); |
| [762](#L762) |  |
| [763](#L763) | $split\_country = explode( ':', $country\_code ); |
| [764](#L764) | $store\_country = isset($split\_country[0]) ? $split\_country[0] : ''; |
| [765](#L765) | $store\_state   = isset($split\_country[1]) ? $split\_country[1] : ''; |
| [766](#L766) |  |
| [767](#L767) | $store\_days = isset($location->store\_days) ? unserialize($location->store\_days) : array(); |
| [768](#L768) | $all\_days = array( |
| [769](#L769) | 'sunday' => esc\_html\_\_( 'Sunday', 'advanced-local-pickup-for-woocommerce' ), |
| [770](#L770) | 'monday' => esc\_html\_\_( 'Monday', 'advanced-local-pickup-for-woocommerce'), |
| [771](#L771) | 'tuesday' => esc\_html\_\_( 'Tuesday', 'advanced-local-pickup-for-woocommerce' ), |
| [772](#L772) | 'wednesday' => esc\_html\_\_( 'Wednesday', 'advanced-local-pickup-for-woocommerce' ), |
| [773](#L773) | 'thursday' => esc\_html\_\_( 'Thursday', 'advanced-local-pickup-for-woocommerce' ), |
| [774](#L774) | 'friday' => esc\_html\_\_( 'Friday', 'advanced-local-pickup-for-woocommerce' ), |
| [775](#L775) | 'saturday' => esc\_html\_\_( 'Saturday', 'advanced-local-pickup-for-woocommerce' ), |
| [776](#L776) | ); |
| [777](#L777) | $w\_day = array\_slice($all\_days, get\_option('start\_of\_week')); |
| [778](#L778) | foreach ($all\_days as $key=>$val) { |
| [779](#L779) | $w\_day[$key] = $val; |
| [780](#L780) | } |
| [781](#L781) | if ( !empty($store\_days) ) { |
| [782](#L782) | foreach ($store\_days as $key => $val) { |
| [783](#L783) | if ($w\_day[$key]) { |
| [784](#L784) | $w\_day[$key] = $val; |
| [785](#L785) | } |
| [786](#L786) | } |
| [787](#L787) | } |
| [788](#L788) |  |
| [789](#L789) | $wclp\_default\_time\_format = isset($location) ? $location->store\_time\_format : '24'; |
| [790](#L790) | if ('12' == $wclp\_default\_time\_format) { |
| [791](#L791) | foreach ($w\_day as $key=>$val) { |
| [792](#L792) | if (isset($val['wclp\_store\_hour'])) { |
| [793](#L793) | $last\_digit = explode(':', $val['wclp\_store\_hour']); |
| [794](#L794) | if ('00' == end($last\_digit)) { |
| [795](#L795) | $val['wclp\_store\_hour'] = gmdate('g:ia', strtotime($val['wclp\_store\_hour'])); |
| [796](#L796) | } else { |
| [797](#L797) | $val['wclp\_store\_hour'] = gmdate('g:ia', strtotime($val['wclp\_store\_hour'])); |
| [798](#L798) | } |
| [799](#L799) | } |
| [800](#L800) | if (isset($val['wclp\_store\_hour\_end'])) { |
| [801](#L801) | $last\_digit = explode(':', $val['wclp\_store\_hour\_end']); |
| [802](#L802) | if ('00' == end($last\_digit)) { |
| [803](#L803) | $val['wclp\_store\_hour\_end'] = gmdate('g:ia', strtotime($val['wclp\_store\_hour\_end'])); |
| [804](#L804) | } else { |
| [805](#L805) | $val['wclp\_store\_hour\_end'] = gmdate('g:ia', strtotime($val['wclp\_store\_hour\_end'])); |
| [806](#L806) | } |
| [807](#L807) | } |
| [808](#L808) | $w\_day[$key] = $val; |
| [809](#L809) | } |
| [810](#L810) | } |
| [811](#L811) |  |
| [812](#L812) | if ( 'customer\_ready\_pickup\_order' == $email->id || ( isset($wclp\_show\_pickup\_instruction['display\_in\_processing\_email']) && '1' == $wclp\_show\_pickup\_instruction['display\_in\_processing\_email'] && 'customer\_processing\_order' == $email->id ) ) { |
| [813](#L813) |  |
| [814](#L814) | if ( file\_exists( $local\_template ) && is\_writable( $local\_template )) { |
| [815](#L815) | wc\_get\_template( 'emails/pickup-instruction.php', array( 'w\_day' => $w\_day, 'location' => $location, 'store\_country' => $store\_country, 'store\_state' => $store\_state ), 'advanced-local-pickup-for-woocommerce/', get\_stylesheet\_directory() . '/woocommerce/' ); |
| [816](#L816) | } else { |
| [817](#L817) | wc\_get\_template( 'emails/pickup-instruction.php', array( 'w\_day' => $w\_day, 'location' => $location, 'store\_country' => $store\_country, 'store\_state' => $store\_state ), 'advanced-local-pickup-for-woocommerce/', wc\_local\_pickup()->get\_plugin\_path() . '/templates/' ); |
| [818](#L818) | } |
| [819](#L819) |  |
| [820](#L820) | } |
| [821](#L821) |  |
| [822](#L822) | } |
| [823](#L823) |  |
| [824](#L824) | public function add\_addional\_content\_on\_processing\_email( $order, $sent\_to\_admin, $plain\_text, $email ) { |
| [825](#L825) |  |
| [826](#L826) | if ( 'customer\_processing\_order' != $email->id ) { |
| [827](#L827) | return; |
| [828](#L828) | } |
| [829](#L829) |  |
| [830](#L830) | // Iterating through order shipping items |
| [831](#L831) | foreach ( $order->get\_items( 'shipping' ) as $item\_id => $shipping\_item\_obj ) { |
| [832](#L832) | $shipping\_method = $shipping\_item\_obj->get\_method\_id(); |
| [833](#L833) | } |
| [834](#L834) |  |
| [835](#L835) | //IF  dshipping method is not local pickup then @return; |
| [836](#L836) | if ( !isset($shipping\_method ) ) { |
| [837](#L837) | return; |
| [838](#L838) | } |
| [839](#L839) | if ( isset($shipping\_method ) && 'local\_pickup' != $shipping\_method ) { |
| [840](#L840) | return; |
| [841](#L841) | } |
| [842](#L842) |  |
| [843](#L843) | $settings = $this->wclp\_general\_setting\_fields\_func(); |
| [844](#L844) | $addional\_content = get\_option('wclp\_processing\_additional\_content', $settings['wclp\_processing\_additional\_content']['default']); |
| [845](#L845) | echo '<p>' . esc\_html(stripslashes($addional\_content), 'advanced-local-pickup-for-woocommerce') . '</p>'; |
| [846](#L846) | } |
| [847](#L847) |  |
| [848](#L848) | /\*\* |
| [849](#L849) | \* |
| [850](#L850) | \* Get times as option-list. |
| [851](#L851) | \* |
| [852](#L852) | \* @return string List of times |
| [853](#L853) | \*/ |
| [854](#L854) | public function get\_times( $default = '19:00', $interval = '+30 minutes' ) { |
| [855](#L855) |  |
| [856](#L856) | $output[] = array(); |
| [857](#L857) | unset($output[0]); |
| [858](#L858) | $current = strtotime( '00:00' ); |
| [859](#L859) | $end = strtotime( '23:59' ); |
| [860](#L860) |  |
| [861](#L861) | while ( $current <= $end ) { |
| [862](#L862) | $time = gmdate( 'H:i', $current ); |
| [863](#L863) | $sel = ( $time == $default ) ? ' selected' : ''; |
| [864](#L864) |  |
| [865](#L865) | $output[gmdate( 'h:i A', $current )] .= gmdate( 'h:i A', $current ); |
| [866](#L866) | $current = strtotime( $interval, $current ); |
| [867](#L867) | } |
| [868](#L868) |  |
| [869](#L869) | return $output; |
| [870](#L870) | } |
| [871](#L871) |  |
| [872](#L872) | public function wclp\_update\_state\_dropdown\_fun() { |
| [873](#L873) |  |
| [874](#L874) | $nonce = isset( $\_POST['nonce'] ) ? sanitize\_text\_field($\_POST['nonce']) : ''; |
| [875](#L875) | if ( ! wp\_verify\_nonce( $nonce, 'alp-ajax-nonce' ) ) { |
| [876](#L876) | die(); |
| [877](#L877) | } |
| [878](#L878) |  |
| [879](#L879) | $country = isset($\_POST['country']) ? wc\_clean($\_POST['country']) : ''; |
| [880](#L880) | $countries\_obj   = new WC\_Countries(); |
| [881](#L881) | $default\_county\_states = $countries\_obj->get\_states( $country ); |
| [882](#L882) | if (empty($default\_county\_states)) { |
| [883](#L883) | echo json\_encode( array('state' => 'empty') ); |
| [884](#L884) | die(); |
| [885](#L885) | } else { |
| [886](#L886) | ob\_start(); |
| [887](#L887) | ?> |
| [888](#L888) | <option value="<?php echo esc\_html($key); ?>"><?php esc\_html\_e('Select', 'woocommerce'); ?></option> |
| [889](#L889) | <?php |
| [890](#L890) | foreach ( (array) $default\_county\_states as $key => $val ) { |
| [891](#L891) |  |
| [892](#L892) | ?> |
| [893](#L893) | <option value="<?php echo esc\_html($key); ?>"><?php echo esc\_html($val); ?></option> |
| [894](#L894) | <?php |
| [895](#L895) | } |
| [896](#L896) | $html = ob\_get\_clean(); |
| [897](#L897) | echo json\_encode( array('state' => $html) ); |
| [898](#L898) | die(); |
| [899](#L899) | } |
| [900](#L900) | echo json\_encode( array('state' => 'empty') ); |
| [901](#L901) | die(); |
| [902](#L902) | } |
| [903](#L903) |  |
| [904](#L904) | public function wclp\_update\_work\_hours\_list\_fun() { |
| [905](#L905) |  |
| [906](#L906) | $nonce = isset( $\_POST['nonce'] ) ? sanitize\_text\_field($\_POST['nonce']) : ''; |
| [907](#L907) | if ( ! wp\_verify\_nonce( $nonce, 'alp-ajax-nonce' ) ) { |
| [908](#L908) | die(); |
| [909](#L909) | } |
| [910](#L910) |  |
| [911](#L911) | $data = $this->get\_data(); |
| [912](#L912) | $location\_id = isset($\_POST['id']) ? sanitize\_text\_field($\_POST['id']) : ''; |
| [913](#L913) | $location = $this->get\_data\_byid($location\_id); |
| [914](#L914) |  |
| [915](#L915) | $wclp\_store\_time\_format = '24'; |
| [916](#L916) |  |
| [917](#L917) | $all\_days = array( |
| [918](#L918) | 'sunday' => esc\_html\_\_( 'Sunday', 'advanced-local-pickup-for-woocommerce' ), |
| [919](#L919) | 'monday' => esc\_html\_\_( 'Monday', 'advanced-local-pickup-for-woocommerce'), |
| [920](#L920) | 'tuesday' => esc\_html\_\_( 'Tuesday', 'advanced-local-pickup-for-woocommerce' ), |
| [921](#L921) | 'wednesday' => esc\_html\_\_( 'Wednesday', 'advanced-local-pickup-for-woocommerce' ), |
| [922](#L922) | 'thursday' => esc\_html\_\_( 'Thursday', 'advanced-local-pickup-for-woocommerce' ), |
| [923](#L923) | 'friday' => esc\_html\_\_( 'Friday', 'advanced-local-pickup-for-woocommerce' ), |
| [924](#L924) | 'saturday' => esc\_html\_\_( 'Saturday', 'advanced-local-pickup-for-woocommerce' ), |
| [925](#L925) | ); |
| [926](#L926) | $days = array\_slice($all\_days, get\_option('start\_of\_week')); |
| [927](#L927) | foreach ($all\_days as $key=>$val) { |
| [928](#L928) | $days[$key] = $val; |
| [929](#L929) | } |
| [930](#L930) |  |
| [931](#L931) | ob\_start(); |
| [932](#L932) | ?> |
| [933](#L933) | <div class="pickup\_hours\_div"> |
| [934](#L934) | <?php |
| [935](#L935) | foreach ( (array) $days as $key => $val ) { |
| [936](#L936) |  |
| [937](#L937) | $multi\_checkbox\_data = unserialize($location->store\_days); |
| [938](#L938) |  |
| [939](#L939) | if (isset($multi\_checkbox\_data[$key]['checked']) && 1 == $multi\_checkbox\_data[$key]['checked']) { |
| [940](#L940) | $checked = 'checked'; |
| [941](#L941) | $class = 'hours-time'; |
| [942](#L942) | } else { |
| [943](#L943) | $checked = ''; |
| [944](#L944) | $class = ''; |
| [945](#L945) | } |
| [946](#L946) |  |
| [947](#L947) | $send\_time\_array = array(); |
| [948](#L948) | for ( $hour = 0; $hour < 24; $hour++ ) { |
| [949](#L949) | for ( $min = 0; $min < 60; $min = $min + 30 ) { |
| [950](#L950) | $this\_time = gmdate( 'H:i', strtotime( "$hour:$min" ) ); |
| [951](#L951) | $send\_time\_array[ $this\_time ] = $this\_time; |
| [952](#L952) | } |
| [953](#L953) | } |
| [954](#L954) | ?> |
| [955](#L955) | <div class="wplp\_pickup\_duration" style=""> |
| [956](#L956) | <fieldset style=""><label class="" for="<?php echo esc\_html($key); ?>" style=""> |
| [957](#L957) | <input type="checkbox" id="<?php echo esc\_html($key); ?>" name="wclp\_store\_days[<?php echo esc\_html($key); ?>][checked]" class="pickup\_days\_checkbox"  <?php echo esc\_html($checked); ?> value="1"/> |
| [958](#L958) | <span class="pickup\_days\_lable" style="width: auto;"><?php esc\_html\_e($val, 'advanced-local-pickup-for-woocommerce'); ?></span> |
| [959](#L959) | </label></fieldset> |
| [960](#L960) | <fieldset class="wclp\_pickup\_time\_fieldset" style=""> |
| [961](#L961) | <span class="hours <?php echo esc\_html($class); ?>" style=""> |
| [962](#L962) | <?php |
| [963](#L963) | if (isset($multi\_checkbox\_data[$key]['wclp\_store\_hour'])) { |
| [964](#L964) | if ('12' == $wclp\_store\_time\_format) { |
| [965](#L965) | $last\_digit = explode(':', $multi\_checkbox\_data[$key]['wclp\_store\_hour']); |
| [966](#L966) | if ('00' == end($last\_digit)) { |
| [967](#L967) | $wclp\_store\_hour = gmdate('g:ia', strtotime($multi\_checkbox\_data[$key]['wclp\_store\_hour'])); |
| [968](#L968) | } else { |
| [969](#L969) | $wclp\_store\_hour = gmdate('g:ia', strtotime($multi\_checkbox\_data[$key]['wclp\_store\_hour'])); |
| [970](#L970) | } |
| [971](#L971) | } else { |
| [972](#L972) | $wclp\_store\_hour = $multi\_checkbox\_data[$key]['wclp\_store\_hour']; |
| [973](#L973) | } |
| [974](#L974) | echo esc\_html($wclp\_store\_hour); |
| [975](#L975) | } |
| [976](#L976) | ?> |
| [977](#L977) | - |
| [978](#L978) | <?php |
| [979](#L979) | if (isset($multi\_checkbox\_data[$key]['wclp\_store\_hour\_end'])) { |
| [980](#L980) | if ('12' == $wclp\_store\_time\_format) { |
| [981](#L981) | $last\_digit = explode(':', $multi\_checkbox\_data[$key]['wclp\_store\_hour\_end']); |
| [982](#L982) | if ('00' == end($last\_digit)) { |
| [983](#L983) | $wclp\_store\_hour\_end = gmdate('g:ia', strtotime($multi\_checkbox\_data[$key]['wclp\_store\_hour\_end'])); |
| [984](#L984) | } else { |
| [985](#L985) | $wclp\_store\_hour\_end = gmdate('g:ia', strtotime($multi\_checkbox\_data[$key]['wclp\_store\_hour\_end'])); |
| [986](#L986) | } |
| [987](#L987) | } else { |
| [988](#L988) | $wclp\_store\_hour\_end = $multi\_checkbox\_data[$key]['wclp\_store\_hour\_end']; |
| [989](#L989) | } |
| [990](#L990) | echo esc\_html($wclp\_store\_hour\_end); |
| [991](#L991) | } |
| [992](#L992) | ?> |
| [993](#L993) | </span> |
| [994](#L994) | <?php do\_action('wclp\_split\_hours\_hook', $key, $wclp\_store\_time\_format, $location, $class); ?> |
| [995](#L995) | <div id="" class="popupwrapper alp-hours-popup" style="display:none;"> |
| [996](#L996) | <div class="popuprow"> |
| [997](#L997) | <span class="dashicons dashicons-no-alt popup\_close\_icon"></span> |
| [998](#L998) | <div class="alp-hours-popup"> |
| [999](#L999) | <div id="header-text"> |
| [1000](#L1000) | <span style="width: 100px;display: inline-block;">From</span> |
| [1001](#L1001) | <span>To</span> |
| [1002](#L1002) | </div> |
| [1003](#L1003) | <span class="morning-time"><select class="select <?php echo esc\_html($key); ?> wclp\_pickup\_time\_select start" name="wclp\_store\_days[<?php echo esc\_html($key); ?>][wclp\_store\_hour]"> <option value="" ><?php esc\_html\_e( 'Select', 'woocommerce' ); ?></option> |
| [1004](#L1004) | <?php |
| [1005](#L1005) | foreach ( (array) $send\_time\_array as $key1 => $val1 ) { |
| [1006](#L1006) | if ('12' == $wclp\_store\_time\_format) { |
| [1007](#L1007) | $last\_digit = explode(':', $val1); |
| [1008](#L1008) | if ('00' == end($last\_digit)) { |
| [1009](#L1009) | $val1 = gmdate('g:ia', strtotime($val1)); |
| [1010](#L1010) | } else { |
| [1011](#L1011) | $val1 = gmdate('g:ia', strtotime($val1)); |
| [1012](#L1012) | } |
| [1013](#L1013) | } |
| [1014](#L1014) | ?> |
| [1015](#L1015) | <option value="<?php echo esc\_html($key1); ?>" <?php echo ( isset($multi\_checkbox\_data[$key]['wclp\_store\_hour']) && $multi\_checkbox\_data[$key]['wclp\_store\_hour'] == $key1 ) ? 'selected' : ''; ?>><?php echo esc\_html($val1); ?></option> |
| [1016](#L1016) | <?php } ?> |
| [1017](#L1017) | </select> |
| [1018](#L1018) | <select class="select <?php echo esc\_html($key); ?> wclp\_pickup\_time\_select end" name="wclp\_store\_days[<?php echo esc\_html($key); ?>][wclp\_store\_hour\_end]"><option value=""><?php esc\_html\_e( 'Select', 'woocommerce' ); ?></option> |
| [1019](#L1019) | <?php |
| [1020](#L1020) | foreach ( (array) $send\_time\_array as $key2 => $val2 ) { |
| [1021](#L1021) | if ('12' == $wclp\_store\_time\_format) { |
| [1022](#L1022) | $last\_digit = explode(':', $val2); |
| [1023](#L1023) | if ( '00' == end($last\_digit) ) { |
| [1024](#L1024) | $val2 = gmdate('g:ia', strtotime($val2)); |
| [1025](#L1025) | } else { |
| [1026](#L1026) | $val2 = gmdate('g:ia', strtotime($val2)); |
| [1027](#L1027) | } |
| [1028](#L1028) | } |
| [1029](#L1029) |  |
| [1030](#L1030) | ?> |
| [1031](#L1031) | <option value="<?php echo esc\_html($key2); ?>" <?php echo ( isset($multi\_checkbox\_data[$key]['wclp\_store\_hour\_end']) && $multi\_checkbox\_data[$key]['wclp\_store\_hour\_end'] == $key2 ) ? 'selected' : ''; ?>><?php echo esc\_html($val2); ?></option> |
| [1032](#L1032) | <?php } ?> |
| [1033](#L1033) | </select> |
| [1034](#L1034) | <span class="dashicons dashicons-trash" ></span> |
| [1035](#L1035) | </span> |
| [1036](#L1036) | <?php do\_action('wclp\_multi\_hours\_hook', $key, $wclp\_store\_time\_format, $location, $send\_time\_array); ?> |
| [1037](#L1037) | <p class="add-interval" <?php echo ( !class\_exists('Advanced\_local\_pickup\_PRO') || ( isset($multi\_checkbox\_data[$key]['wclp\_store\_hour\_end2']) && '' != $multi\_checkbox\_data[$key]['wclp\_store\_hour\_end2'] ) ) ? 'style="display:none"' : ''; ?>>+ Add Interval</p> |
| [1038](#L1038) | </div> |
| [1039](#L1039) | <?php do\_action('wclp\_apply\_mltiple\_popup\_hook', $days, $key); ?> |
| [1040](#L1040) | <button type="button" class="wclp-apply button-primary" value="<?php echo esc\_html($key); ?>"><?php esc\_html\_e('Apply & close', 'advanced-local-pickup-for-woocommerce'); ?></button> |
| [1041](#L1041) | <?php do\_action('wclp\_apply\_mltiple\_on\_days\_hook'); ?> |
| [1042](#L1042) | </div> |
| [1043](#L1043) | <div class="popupclose"></div> |
| [1044](#L1044) | </div> |
| [1045](#L1045) | </fieldset> |
| [1046](#L1046) | </div> |
| [1047](#L1047) | <?php } ?> |
| [1048](#L1048) | </div> |
| [1049](#L1049) | <?php |
| [1050](#L1050) | $html = ob\_get\_clean(); |
| [1051](#L1051) | echo json\_encode( array('pickup\_hours\_div' => $html) ); |
| [1052](#L1052) | die(); |
| [1053](#L1053) | } |
| [1054](#L1054) |  |
| [1055](#L1055) | public function wclp\_update\_edit\_location\_form\_fun() { |
| [1056](#L1056) |  |
| [1057](#L1057) | $nonce = isset( $\_POST['nonce'] ) ? sanitize\_text\_field($\_POST['nonce']) : ''; |
| [1058](#L1058) | if ( ! wp\_verify\_nonce( $nonce, 'alp-ajax-nonce' ) ) { |
| [1059](#L1059) | die(); |
| [1060](#L1060) | } |
| [1061](#L1061) |  |
| [1062](#L1062) | $location\_id = isset($\_POST['id']) ? sanitize\_text\_field($\_POST['id']) : ''; |
| [1063](#L1063) | $location = $this->get\_data\_byid($location\_id); |
| [1064](#L1064) |  |
| [1065](#L1065) | ob\_start(); |
| [1066](#L1066) | include('views/wclp-edit-location-form.php'); |
| [1067](#L1067) | $html = ob\_get\_clean(); |
| [1068](#L1068) | echo json\_encode( array('edit\_location\_form' => $html) ); |
| [1069](#L1069) | die(); |
| [1070](#L1070) | } |
| [1071](#L1071) |  |
| [1072](#L1072) | public function wclp\_apply\_work\_hours\_fun() { |
| [1073](#L1073) |  |
| [1074](#L1074) | $nonce = isset( $\_POST['nonce'] ) ? sanitize\_text\_field($\_POST['nonce']) : ''; |
| [1075](#L1075) | if ( ! wp\_verify\_nonce( $nonce, 'alp-ajax-nonce' ) ) { |
| [1076](#L1076) | die(); |
| [1077](#L1077) | } |
| [1078](#L1078) |  |
| [1079](#L1079) | global $wpdb; |
| [1080](#L1080) | $location\_id = isset($\_POST['id']) ? sanitize\_text\_field($\_POST['id']) : ''; |
| [1081](#L1081) | $days = isset($\_POST['days']) ? wc\_clean($\_POST['days']) : ''; |
| [1082](#L1082) |  |
| [1083](#L1083) | $location = $this->get\_data\_byid($location\_id); |
| [1084](#L1084) | $store\_days = unserialize($location->store\_days); |
| [1085](#L1085) | foreach ($days as $key) { |
| [1086](#L1086) | $store\_days[$key]['checked'] = '1'; |
| [1087](#L1087) | $wclp\_store\_hour = isset($\_POST['wclp\_store\_hour']) ? sanitize\_text\_field($\_POST['wclp\_store\_hour']) : ''; |
| [1088](#L1088) | $wclp\_store\_hour\_end = isset($\_POST['wclp\_store\_hour\_end']) ? sanitize\_text\_field($\_POST['wclp\_store\_hour\_end']) : ''; |
| [1089](#L1089) | $wclp\_store\_hour2 = isset($\_POST['wclp\_store\_hour2']) ? sanitize\_text\_field($\_POST['wclp\_store\_hour2']) : ''; |
| [1090](#L1090) | $wclp\_store\_hour\_end2 = isset($\_POST['wclp\_store\_hour\_end2']) ? sanitize\_text\_field($\_POST['wclp\_store\_hour\_end2']) : ''; |
| [1091](#L1091) |  |
| [1092](#L1092) | if (isset($wclp\_store\_hour) && isset($wclp\_store\_hour\_end)) { |
| [1093](#L1093) | $store\_days[$key]['wclp\_store\_hour'] = sanitize\_text\_field($wclp\_store\_hour); |
| [1094](#L1094) | $store\_days[$key]['wclp\_store\_hour\_end'] = sanitize\_text\_field($wclp\_store\_hour\_end); |
| [1095](#L1095) | } |
| [1096](#L1096) | if (isset($wclp\_store\_hour2) && isset($wclp\_store\_hour\_end2)) { |
| [1097](#L1097) | $store\_days[$key]['wclp\_store\_hour2'] = sanitize\_text\_field($wclp\_store\_hour2); |
| [1098](#L1098) | $store\_days[$key]['wclp\_store\_hour\_end2'] = sanitize\_text\_field($wclp\_store\_hour\_end2); |
| [1099](#L1099) | } |
| [1100](#L1100) | } |
| [1101](#L1101) | $location = array( 'store\_days' => serialize($store\_days) ); |
| [1102](#L1102) | $wpdb->update( $this->table, $location, array('id' => wc\_clean($location\_id)) ); |
| [1103](#L1103) |  |
| [1104](#L1104) | $this->wclp\_update\_work\_hours\_list\_fun(); |
| [1105](#L1105) |  |
| [1106](#L1106) | } |
| [1107](#L1107) |  |
| [1108](#L1108) | public function wclp\_general\_setting\_fields\_func() { |
| [1109](#L1109) | $show\_pickup\_instraction\_option = array( |
| [1110](#L1110) | 'display\_in\_processing\_email' => esc\_html\_\_( 'Processing order email', 'advanced-local-pickup-for-woocommerce' ), |
| [1111](#L1111) | 'display\_in\_order\_received\_page' => esc\_html\_\_( 'Order received page', 'advanced-local-pickup-for-woocommerce' ), |
| [1112](#L1112) | 'display\_in\_order\_details\_page' => esc\_html\_\_( 'My Account (orders history)', 'advanced-local-pickup-for-woocommerce' ), |
| [1113](#L1113) | ); |
| [1114](#L1114) | $settings = array( |
| [1115](#L1115) | 'wclp\_show\_pickup\_instruction' => array( |
| [1116](#L1116) | 'id'       => 'wclp\_show\_pickup\_instruction', |
| [1117](#L1117) | 'css'      => 'min-width:50px;', |
| [1118](#L1118) | 'default'  => '', |
| [1119](#L1119) | 'show'     => true, |
| [1120](#L1120) | 'type'     => 'multiple\_checkbox', |
| [1121](#L1121) | 'options'  => $show\_pickup\_instraction\_option, |
| [1122](#L1122) | 'class'    => '', |
| [1123](#L1123) | 'desc\_tip' => '', |
| [1124](#L1124) | ), |
| [1125](#L1125) | 'wclp\_processing\_additional\_content' => array( |
| [1126](#L1126) | 'title'    => esc\_html\_\_( 'Additional content on processing email in case of local pickup orders', 'advanced-local-pickup-for-woocommerce' ), |
| [1127](#L1127) | 'tooltip'  => esc\_html\_\_( 'Additional content on processing email in case of local pickup orders', 'advanced-local-pickup-for-woocommerce' ), |
| [1128](#L1128) | 'id'       => 'wclp\_processing\_additional\_content', |
| [1129](#L1129) | 'css'      => 'min-width:50px;', |
| [1130](#L1130) | 'default'  => esc\_html\_\_( 'You will receive an email when your order is ready for pickup.', 'advanced-local-pickup-for-woocommerce' ), |
| [1131](#L1131) | 'placeholder' => esc\_html\_\_( 'Additional content on processing email in case of local pickup orders', 'advanced-local-pickup-for-woocommerce' ), |
| [1132](#L1132) | 'show'     => true, |
| [1133](#L1133) | 'type'     => 'textarea', |
| [1134](#L1134) | 'class'    => 'additional\_textarea', |
| [1135](#L1135) | 'desc\_tip' => '', |
| [1136](#L1136) | ), |
| [1137](#L1137) | ); |
| [1138](#L1138) | $settings = apply\_filters( 'alp\_display\_location\_option\_data\_array', $settings ); |
| [1139](#L1139) | return $settings; |
| [1140](#L1140) |  |
| [1141](#L1141) | } |
| [1142](#L1142) |  |
| [1143](#L1143) | /\* |
| [1144](#L1144) | \* Get html of fields |
| [1145](#L1145) | \*/ |
| [1146](#L1146) | public function get\_html2( $arrays ) { |
| [1147](#L1147) | $checked = ''; |
| [1148](#L1148) | foreach ( (array) $arrays as $id => $array ) { |
| [1149](#L1149) | if ($array['show']) { |
| [1150](#L1150) |  |
| [1151](#L1151) | ?> |
| [1152](#L1152) | <?php if ('dropdown' == $array['type']) { ?> |
| [1153](#L1153) | <tr valign="top" class="html2\_title\_row <?php echo esc\_html($array['class']); ?>"> |
| [1154](#L1154) | <?php if ( !empty($array['title']) && isset($array['title'])) { ?> |
| [1155](#L1155) | <th><span class="row-label"> |
| [1156](#L1156) | <label for=""><?php echo esc\_html($array['title']); ?><?php echo ( isset($array['title\_link']) ) ? esc\_html($array['title\_link']) : ''; ?> |
| [1157](#L1157) | <?php if ( isset($array['tooltip']) ) { ?> |
| [1158](#L1158) | <span class="woocommerce-help-tip tipTip" title="<?php echo esc\_html($array['tooltip']); ?>"></span> |
| [1159](#L1159) | <?php } ?> |
| [1160](#L1160) | </label> |
| [1161](#L1161) | <?php if ( isset($array['desc\_tip']) ) { ?> |
| [1162](#L1162) | <p class="description"><?php echo esc\_html($array['desc\_tip']); ?></p> |
| [1163](#L1163) | <?php } ?> |
| [1164](#L1164) | <?php if ( isset( $array['type'] ) && 'dropdown' == $array['type'] ) { ?> |
| [1165](#L1165) | <?php |
| [1166](#L1166) | if ( isset($array['multiple']) ) { |
| [1167](#L1167) | $multiple = 'multiple'; |
| [1168](#L1168) | $field\_id = $array['multiple']; |
| [1169](#L1169) | } else { |
| [1170](#L1170) | $multiple = ''; |
| [1171](#L1171) | $field\_id = $id; |
| [1172](#L1172) | } |
| [1173](#L1173) | ?> |
| [1174](#L1174) | <fieldset> |
| [1175](#L1175) | <select class="select select2" id="<?php echo esc\_html($field\_id); ?>" name="<?php echo esc\_html($id); ?>" <?php echo esc\_html($multiple); ?> style="width:150px;"> |
| [1176](#L1176) | <?php |
| [1177](#L1177) | foreach ( (array) $array['options'] as $key => $val ) { |
| [1178](#L1178) | $selected = ''; |
| [1179](#L1179) | if ( isset($array['multiple']) ) { |
| [1180](#L1180) | if (in\_array($key, (array) $this->data->$field\_id )) { |
| [1181](#L1181) | $selected = 'selected'; |
| [1182](#L1182) | } |
| [1183](#L1183) | } else { |
| [1184](#L1184) | if ( get\_option($array['id']) == (string) $key ) { |
| [1185](#L1185) | $selected = 'selected'; |
| [1186](#L1186) | } |
| [1187](#L1187) | } |
| [1188](#L1188) | ?> |
| [1189](#L1189) | <option value="<?php echo esc\_html($key); ?>" <?php echo esc\_html($selected); ?> ><?php echo esc\_html($val); ?></option> |
| [1190](#L1190) | <?php } ?><p class="description"><?php echo ( isset($array['desc']) ) ? esc\_html($array['desc']) : ''; ?></p> |
| [1191](#L1191) | </select> |
| [1192](#L1192) | </fieldset> |
| [1193](#L1193) | <?php } ?></span> |
| [1194](#L1194) | </th> |
| [1195](#L1195) | <?php } ?> |
| [1196](#L1196) | </tr> |
| [1197](#L1197) | <?php |
| [1198](#L1198) | } |
| [1199](#L1199) | if ( !empty($array['title']) && 'textarea' == $array['type'] ) { |
| [1200](#L1200) | ?> |
| [1201](#L1201) | <tr valign="top" class="html2\_title\_row <?php echo esc\_html($array['class']); ?>"> |
| [1202](#L1202) | <th><span class="row-label"> |
| [1203](#L1203) | <label for=""><?php echo esc\_html($array['title']); ?><?php echo ( isset($array['title\_link']) ) ? esc\_html($array['title\_link']) : ''; ?> |
| [1204](#L1204) | <?php if ( isset($array['tooltip']) ) { ?> |
| [1205](#L1205) | <span class="woocommerce-help-tip tipTip" title="<?php echo esc\_html($array['tooltip']); ?>"></span> |
| [1206](#L1206) | <?php } ?> |
| [1207](#L1207) | </label> |
| [1208](#L1208) | <?php if ( isset($array['desc\_tip']) ) { ?> |
| [1209](#L1209) | <p class="description"><?php echo esc\_html($array['desc\_tip']); ?></p> |
| [1210](#L1210) | <?php } ?> |
| [1211](#L1211) | </span> |
| [1212](#L1212) | </th> |
| [1213](#L1213) | </tr> |
| [1214](#L1214) | <tr valign="top" class="html2\_title\_row <?php echo esc\_html($array['class']); ?>"> |
| [1215](#L1215) | <td class="forminp"  <?php echo ( 'desc' == $array['type'] ) ? 'colspan=2' : ''; ?>> |
| [1216](#L1216) | <fieldset> |
| [1217](#L1217) | <textarea rows="4" cols="20" class="input-text regular-input" type="textarea" name="<?php echo esc\_html($id); ?>" id="<?php echo esc\_html($id); ?>" style="" placeholder="<?php echo ( !empty($array['placeholder']) ) ? esc\_html($array['placeholder']) : ''; ?>"><?php echo esc\_html(stripslashes(get\_option($array['id'], $array['default']))); ?></textarea> |
| [1218](#L1218) | </fieldset> |
| [1219](#L1219) | </td> |
| [1220](#L1220) | </tr> |
| [1221](#L1221) | <?php } ?> |
| [1222](#L1222) | <?php if ('dropdown' != $array['type'] && 'textarea' != $array['type']) { ?> |
| [1223](#L1223) | <tr class="<?php echo esc\_html($array['class']); ?>"> |
| [1224](#L1224) | <td class="forminp" <?php echo ( 'desc' == $array['type'] ) ? 'colspan=2' : ''; ?>> |
| [1225](#L1225) | <?php |
| [1226](#L1226) | if ( 'checkbox' == $array['type'] ) { |
| [1227](#L1227) | if (get\_option($array['id'])) { |
| [1228](#L1228) | $checked = 'checked'; |
| [1229](#L1229) | } else { |
| [1230](#L1230) | $checked = ''; |
| [1231](#L1231) | } |
| [1232](#L1232) | if (isset($array['disabled']) && true == $array['disabled']) { |
| [1233](#L1233) | $disabled = 'disabled'; |
| [1234](#L1234) | $checked = ''; |
| [1235](#L1235) | } else { |
| [1236](#L1236) | $disabled = ''; |
| [1237](#L1237) | } |
| [1238](#L1238) | ?> |
| [1239](#L1239) | <?php if ('toggle' == $array['class']) { ?> |
| [1240](#L1240) | <span class="mdl-list\_\_item-secondary-action"> |
| [1241](#L1241) | <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="<?php echo esc\_html($id); ?>"> |
| [1242](#L1242) | <input type="hidden" name="<?php echo esc\_html($id); ?>" value="0"/> |
| [1243](#L1243) | <input type="checkbox" id="<?php echo esc\_html($id); ?>" name="<?php echo esc\_html($id); ?>" class="mdl-switch\_\_input" <?php echo esc\_html($checked); ?> value="1" <?php echo esc\_html($disabled); ?>/> |
| [1244](#L1244) | </label><p class="description"><?php echo ( isset($array['desc']) )? esc\_html($array['desc']) : ''; ?></p> |
| [1245](#L1245) | </span> |
| [1246](#L1246) | <?php } else { ?> |
| [1247](#L1247) | <span class="checkbox"> |
| [1248](#L1248) | <label class="checkbx-label" for="<?php echo esc\_html($id); ?>"> |
| [1249](#L1249) | <input type="hidden" name="<?php echo esc\_html($id); ?>" value="0"/> |
| [1250](#L1250) | <input type="checkbox" id="<?php echo esc\_html($id); ?>" name="<?php echo esc\_html($id); ?>" class="checkbox-input" <?php echo esc\_html($checked); ?> value="1" <?php echo esc\_html($disabled); ?>/> |
| [1251](#L1251) | </label><p class="description"><?php echo ( isset($array['desc']) ) ? esc\_html($array['desc']) : ''; ?></p> |
| [1252](#L1252) | </span> |
| [1253](#L1253) | <?php } ?> |
| [1254](#L1254) | <?php } elseif ( 'textarea' == $array['type'] ) { ?> |
| [1255](#L1255) | <fieldset> |
| [1256](#L1256) | <textarea rows="4" cols="20" class="input-text regular-input" type="textarea" name="<?php echo esc\_html($id); ?>" id="<?php echo esc\_html($id); ?>" style="" placeholder="<?php echo ( !empty($array['placeholder']) ) ? esc\_html($array['placeholder']) : ''; ?>"><?php echo esc\_html(stripslashes(get\_option($array['id'], $array['default']))); ?></textarea> |
| [1257](#L1257) | </fieldset> |
| [1258](#L1258) | <?php } elseif ( 'multiple\_checkbox' == $array['type'] ) { ?> |
| [1259](#L1259) | <?php |
| [1260](#L1260) | $op = 1; |
| [1261](#L1261) | foreach ( (array) $array['options'] as $key => $val ) { |
| [1262](#L1262) | $multi\_checkbox\_data = get\_option($id); |
| [1263](#L1263) | if (isset($multi\_checkbox\_data[$key]) && 1 == $multi\_checkbox\_data[$key]) { |
| [1264](#L1264) | $checked = 'checked'; |
| [1265](#L1265) | } else { |
| [1266](#L1266) | $checked = ''; |
| [1267](#L1267) | } |
| [1268](#L1268) | ?> |
| [1269](#L1269) | <div class="wplp\_multiple <?php echo esc\_html($array['class']); ?>"> |
| [1270](#L1270) | <span class="wplp\_multiple\_checkbox"> |
| [1271](#L1271) | <label class="" for="<?php echo esc\_html($key); ?>"> |
| [1272](#L1272) | <input type="hidden" name="<?php echo esc\_html($id); ?>[<?php echo esc\_html($key); ?>]" value="0"/> |
| [1273](#L1273) | <input type="checkbox" id="<?php echo esc\_html($key); ?>" name="<?php echo esc\_html($id); ?>[<?php echo esc\_html($key); ?>]" class=""  <?php echo esc\_html($checked); ?> value="1"/> |
| [1274](#L1274) | <span class="multiple\_label"><?php echo esc\_html($val); ?></span> |
| [1275](#L1275) | </br> |
| [1276](#L1276) | </label> |
| [1277](#L1277) | </span> |
| [1278](#L1278) | </div> |
| [1279](#L1279) | <?php |
| [1280](#L1280) | } |
| [1281](#L1281) | } else if ('text' == $array['type']) { |
| [1282](#L1282) | ?> |
| [1283](#L1283) | <fieldset> |
| [1284](#L1284) | <input class="input-text regular-input " type="text" name="<?php echo esc\_html($id); ?>" id="<?php echo esc\_html($id); ?>" style="" value="<?php echo esc\_html(get\_option($array['id'], get\_option($array['default']))); ?>" placeholder="<?php echo ( !empty($array['placeholder']) ) ? esc\_html($array['placeholder']) : ''; ?>"> |
| [1285](#L1285) | </fieldset> |
| [1286](#L1286) | <?php } ?> |
| [1287](#L1287) |  |
| [1288](#L1288) | </td> |
| [1289](#L1289) | </tr> |
| [1290](#L1290) | <?php } ?> |
| [1291](#L1291) | <?php |
| [1292](#L1292) | } |
| [1293](#L1293) | } |
| [1294](#L1294) | } |
| [1295](#L1295) |  |
| [1296](#L1296) | /\* |
| [1297](#L1297) | \* Change style of available for pickup and picked up order label |
| [1298](#L1298) | \*/ |
| [1299](#L1299) | public function footer\_function() { |
| [1300](#L1300) | if ( !is\_plugin\_active( 'woocommerce-order-status-manager/woocommerce-order-status-manager.php' ) ) { |
| [1301](#L1301) | $rfp\_bg\_color = get\_option('wclp\_ready\_pickup\_status\_label\_color', '#365EA6'); |
| [1302](#L1302) | $rfp\_color = get\_option('wclp\_ready\_pickup\_status\_label\_font\_color', '#fff'); |
| [1303](#L1303) |  |
| [1304](#L1304) | $pu\_bg\_color = get\_option('wclp\_pickup\_status\_label\_color', '#f1a451'); |
| [1305](#L1305) | $pu\_color = get\_option('wclp\_pickup\_status\_label\_font\_color', '#fff'); |
| [1306](#L1306) | ?> |
| [1307](#L1307) | <style> |
| [1308](#L1308) | .order-status.status-ready-pickup,.order-status-table .order-label.wc-ready-pickup{ |
| [1309](#L1309) | background: <?php echo esc\_html($rfp\_bg\_color); ?>; |
| [1310](#L1310) | color: <?php echo esc\_html($rfp\_color); ?>; |
| [1311](#L1311) | } |
| [1312](#L1312) | .order-status.status-pickup,.order-status-table .order-label.wc-pickup{ |
| [1313](#L1313) | background: <?php echo esc\_html($pu\_bg\_color); ?>; |
| [1314](#L1314) | color: <?php echo esc\_html($pu\_color); ?>; |
| [1315](#L1315) | } |
| [1316](#L1316) | </style> |
| [1317](#L1317) | <?php |
| [1318](#L1318) | } |
| [1319](#L1319) | } |
| [1320](#L1320) |  |
| [1321](#L1321) | /\* |
| [1322](#L1322) | \* Add action button in order list to change order status from processing to ready for pickup and ready for pickup to Picked Up |
| [1323](#L1323) | \*/ |
| [1324](#L1324) | public function add\_local\_pickup\_order\_status\_actions\_button( $actions, $order ) { |
| [1325](#L1325) |  |
| [1326](#L1326) | // Iterating through order shipping items |
| [1327](#L1327) | foreach ( $order->get\_items( 'shipping' ) as $item\_id => $shipping\_item\_obj ) { |
| [1328](#L1328) | $shipping\_method = $shipping\_item\_obj->get\_method\_id(); |
| [1329](#L1329) | } |
| [1330](#L1330) |  |
| [1331](#L1331) | //IF  dshipping method is not local pickup then @return; |
| [1332](#L1332) | if ( !isset($shipping\_method ) ) { |
| [1333](#L1333) | return $actions; |
| [1334](#L1334) | } |
| [1335](#L1335) | if ( isset($shipping\_method ) && 'local\_pickup' != $shipping\_method ) { |
| [1336](#L1336) | return $actions; |
| [1337](#L1337) | } |
| [1338](#L1338) |  |
| [1339](#L1339) | wp\_enqueue\_style( 'alp-order', wc\_local\_pickup()->plugin\_dir\_url(\_\_FILE\_\_) . 'assets/css/order.css', array(), wc\_local\_pickup()->version ); |
| [1340](#L1340) |  |
| [1341](#L1341) | $ready\_for\_pickup = get\_option( 'wclp\_status\_ready\_pickup', 0); |
| [1342](#L1342) | if (true == $ready\_for\_pickup) { |
| [1343](#L1343) | if ( $order->has\_status( array( 'processing' ) ) ) { |
| [1344](#L1344) | // Get Order ID (compatibility all WC versions) |
| [1345](#L1345) | $order\_id = method\_exists( $order, 'get\_id' ) ? $order->get\_id() : $order->id; |
| [1346](#L1346) | // Set the action button |
| [1347](#L1347) | $actions['ready\_for\_pickup'] = array( |
| [1348](#L1348) | 'url'       => wp\_nonce\_url( admin\_url( 'admin-ajax.php?action=woocommerce\_mark\_order\_status&status=ready-pickup&order\_id=' . $order\_id ), 'woocommerce-mark-order-status' ), |
| [1349](#L1349) | 'name'      => esc\_html\_\_( 'Mark order as ready for pickup', 'advanced-local-pickup-for-woocommerce' ), |
| [1350](#L1350) | 'action'    => 'ready\_for\_pickup\_icon', // keep "view" class for a clean button CSS |
| [1351](#L1351) | ); |
| [1352](#L1352) | unset($actions['complete']); |
| [1353](#L1353) | } |
| [1354](#L1354) | } |
| [1355](#L1355) | $picked = get\_option( 'wclp\_status\_picked\_up', 0); |
| [1356](#L1356) | if (true == $picked) { |
| [1357](#L1357) | if ( $order->has\_status( array( 'ready-pickup' ) ) ) { |
| [1358](#L1358) | // Get Order ID (compatibility all WC versions) |
| [1359](#L1359) | $order\_id = method\_exists( $order, 'get\_id' ) ? $order->get\_id() : $order->id; |
| [1360](#L1360) | // Set the action button |
| [1361](#L1361) | $actions['pickup'] = array( |
| [1362](#L1362) | 'url'       => wp\_nonce\_url( admin\_url( 'admin-ajax.php?action=woocommerce\_mark\_order\_status&status=pickup&order\_id=' . $order\_id ), 'woocommerce-mark-order-status' ), |
| [1363](#L1363) | 'name'      => esc\_html\_\_( 'Mark order as picked up', 'advanced-local-pickup-for-woocommerce' ), |
| [1364](#L1364) | 'action'    => 'picked\_up\_icon', // keep "view" class for a clean button CSS |
| [1365](#L1365) | ); |
| [1366](#L1366) | } |
| [1367](#L1367) | } else { |
| [1368](#L1368) | if ( $order->has\_status( array( 'ready-pickup' ) ) ) { |
| [1369](#L1369) | $actions['complete'] = array( |
| [1370](#L1370) | 'url'    => wp\_nonce\_url( admin\_url( 'admin-ajax.php?action=woocommerce\_mark\_order\_status&status=completed&order\_id=' . $order->get\_id() ), 'woocommerce-mark-order-status' ), |
| [1371](#L1371) | 'name'   => esc\_html\_\_( 'Complete', 'woocommerce' ), |
| [1372](#L1372) | 'action' => 'complete', |
| [1373](#L1373) | ); |
| [1374](#L1374) | } |
| [1375](#L1375) | } |
| [1376](#L1376) |  |
| [1377](#L1377) | return $actions; |
| [1378](#L1378) | } |
| [1379](#L1379) |  |
| [1380](#L1380) | /\* |
| [1381](#L1381) | \* Add order again button for delivered order status |
| [1382](#L1382) | \*/ |
| [1383](#L1383) | public function add\_reorder\_button\_pickup( $statuses ) { |
| [1384](#L1384) | $picked = get\_option( 'wclp\_status\_picked\_up', 0); |
| [1385](#L1385) | if (true == $picked) { |
| [1386](#L1386) | $statuses[] = 'pickup'; |
| [1387](#L1387) | } |
| [1388](#L1388) | return $statuses; |
| [1389](#L1389) | } |
| [1390](#L1390) |  |
| [1391](#L1391) | public function get\_option\_value\_from\_array( $array, $key, $default\_value ) { |
| [1392](#L1392) | $array\_data = get\_option($array); |
| [1393](#L1393) | $value = ''; |
| [1394](#L1394) |  |
| [1395](#L1395) | if (isset($array\_data[$key])) { |
| [1396](#L1396) | $value = $array\_data[$key]; |
| [1397](#L1397) | } |
| [1398](#L1398) |  |
| [1399](#L1399) | if ('' == $value) { |
| [1400](#L1400) | $value = $default\_value; |
| [1401](#L1401) | } |
| [1402](#L1402) | return $value; |
| [1403](#L1403) | } |
| [1404](#L1404) |  |
| [1405](#L1405) | /\* |
| [1406](#L1406) | \* Return pickup data by order id. |
| [1407](#L1407) | \*/ |
| [1408](#L1408) | public function get\_pickup\_data( $order\_id ) { |
| [1409](#L1409) |  |
| [1410](#L1410) | if (empty($order\_id)) { |
| [1411](#L1411) | return array(); |
| [1412](#L1412) | } |
| [1413](#L1413) |  |
| [1414](#L1414) | $locations = $this->get\_data(); |
| [1415](#L1415) |  |
| [1416](#L1416) | $location\_id = get\_option('location\_defualt', min($locations)->id); |
| [1417](#L1417) |  |
| [1418](#L1418) | $location = $this->get\_data\_byid($location\_id); |
| [1419](#L1419) | $store\_address = $this->get\_store\_address\_by\_id($location\_id); |
| [1420](#L1420) | $store\_hours = $this->get\_store\_hours\_by\_id($location\_id); |
| [1421](#L1421) |  |
| [1422](#L1422) | $location\_data[$location\_id] = array( |
| [1423](#L1423) | 'pickup\_location\_name' => isset($location->store\_name) ? $location->store\_name : '', |
| [1424](#L1424) | 'pickup\_location\_address' => $store\_address, |
| [1425](#L1425) | 'pickup\_location\_hours' => $store\_hours, |
| [1426](#L1426) | ); |
| [1427](#L1427) |  |
| [1428](#L1428) | return $location\_data; |
| [1429](#L1429) | } |
| [1430](#L1430) |  |
| [1431](#L1431) | /\* |
| [1432](#L1432) | \* Return pickup store address by id. |
| [1433](#L1433) | \*/ |
| [1434](#L1434) | public function get\_store\_address\_by\_id( $location\_id ) { |
| [1435](#L1435) |  |
| [1436](#L1436) | if ( empty( $location\_id ) ) { |
| [1437](#L1437) | return ''; |
| [1438](#L1438) | } |
| [1439](#L1439) |  |
| [1440](#L1440) | $location = $this->get\_data\_byid($location\_id); |
| [1441](#L1441) | $country\_code = isset($location) ? $location->store\_country : get\_option('woocommerce\_default\_country'); |
| [1442](#L1442) | $split\_country = explode( ':', $country\_code ); |
| [1443](#L1443) | $store\_country = isset($split\_country[0]) ? $split\_country[0] : ''; |
| [1444](#L1444) | $store\_state   = isset($split\_country[1]) ? $split\_country[1] . ' ' : ''; |
| [1445](#L1445) |  |
| [1446](#L1446) | $store\_address = isset($location->store\_address) ? $location->store\_address . ' ' : ''; |
| [1447](#L1447) | $store\_address\_2 = isset($location->store\_address\_2) ? $location->store\_address\_2 . ' ' : ''; |
| [1448](#L1448) | $store\_city = isset($location->store\_city) ? $location->store\_city . ' ' : ''; |
| [1449](#L1449) | $store\_postcode = isset($location->store\_postcode) ? $location->store\_postcode . ' ' : ''; |
| [1450](#L1450) | $store\_country = isset( WC()->countries->countries[$store\_country] ) ? WC()->countries->countries[$store\_country] : ''; |
| [1451](#L1451) |  |
| [1452](#L1452) | $address = $store\_address . $store\_address\_2 . $store\_city . $store\_state . $store\_postcode . $store\_country ; |
| [1453](#L1453) |  |
| [1454](#L1454) | return $address; |
| [1455](#L1455) | } |
| [1456](#L1456) |  |
| [1457](#L1457) | /\* |
| [1458](#L1458) | \* Return pickup store hours by id. |
| [1459](#L1459) | \*/ |
| [1460](#L1460) | public function get\_store\_hours\_by\_id( $location\_id ) { |
| [1461](#L1461) |  |
| [1462](#L1462) | if ( empty( $location\_id ) ) { |
| [1463](#L1463) | return ''; |
| [1464](#L1464) | } |
| [1465](#L1465) |  |
| [1466](#L1466) | $location = $this->get\_data\_byid($location\_id); |
| [1467](#L1467) | $store\_days = isset($location->store\_days) ? unserialize($location->store\_days) : array(); |
| [1468](#L1468) | $all\_days = array( |
| [1469](#L1469) | 'sunday' => esc\_html\_\_( 'Sunday', 'advanced-local-pickup-for-woocommerce' ), |
| [1470](#L1470) | 'monday' => esc\_html\_\_( 'Monday', 'advanced-local-pickup-for-woocommerce'), |
| [1471](#L1471) | 'tuesday' => esc\_html\_\_( 'Tuesday', 'advanced-local-pickup-for-woocommerce' ), |
| [1472](#L1472) | 'wednesday' => esc\_html\_\_( 'Wednesday', 'advanced-local-pickup-for-woocommerce' ), |
| [1473](#L1473) | 'thursday' => esc\_html\_\_( 'Thursday', 'advanced-local-pickup-for-woocommerce' ), |
| [1474](#L1474) | 'friday' => esc\_html\_\_( 'Friday', 'advanced-local-pickup-for-woocommerce' ), |
| [1475](#L1475) | 'saturday' => esc\_html\_\_( 'Saturday', 'advanced-local-pickup-for-woocommerce' ), |
| [1476](#L1476) | ); |
| [1477](#L1477) | $w\_day = array\_slice($all\_days, get\_option('start\_of\_week')); |
| [1478](#L1478) | foreach ($all\_days as $key=>$val) { |
| [1479](#L1479) | $w\_day[$key] = $val; |
| [1480](#L1480) | } |
| [1481](#L1481) | foreach ($store\_days as $key => $val) { |
| [1482](#L1482) | if ($w\_day[$key]) { |
| [1483](#L1483) | $w\_day[$key] = $val; |
| [1484](#L1484) | } |
| [1485](#L1485) | } |
| [1486](#L1486) |  |
| [1487](#L1487) | $wclp\_default\_time\_format = isset($location) ? $location->store\_time\_format : '24'; |
| [1488](#L1488) | if ('12' == $wclp\_default\_time\_format) { |
| [1489](#L1489) | foreach ($w\_day as $key=>$val) { |
| [1490](#L1490) | if (isset($val['wclp\_store\_hour'])) { |
| [1491](#L1491) | $last\_digit = explode(':', $val['wclp\_store\_hour']); |
| [1492](#L1492) | if ('00' == end($last\_digit)) { |
| [1493](#L1493) | $val['wclp\_store\_hour'] = gmdate('g:ia', strtotime($val['wclp\_store\_hour'])); |
| [1494](#L1494) | } else { |
| [1495](#L1495) | $val['wclp\_store\_hour'] = gmdate('g:ia', strtotime($val['wclp\_store\_hour'])); |
| [1496](#L1496) | } |
| [1497](#L1497) | } |
| [1498](#L1498) | if (isset($val['wclp\_store\_hour\_end'])) { |
| [1499](#L1499) | $last\_digit = explode(':', $val['wclp\_store\_hour\_end']); |
| [1500](#L1500) | if ('00' == end($last\_digit)) { |
| [1501](#L1501) | $val['wclp\_store\_hour\_end'] = gmdate('g:ia', strtotime($val['wclp\_store\_hour\_end'])); |
| [1502](#L1502) | } else { |
| [1503](#L1503) | $val['wclp\_store\_hour\_end'] = gmdate('g:ia', strtotime($val['wclp\_store\_hour\_end'])); |
| [1504](#L1504) | } |
| [1505](#L1505) | } |
| [1506](#L1506) | $w\_day[$key] = $val; |
| [1507](#L1507) | } |
| [1508](#L1508) | } |
| [1509](#L1509) |  |
| [1510](#L1510) | if (!empty($w\_day)) { |
| [1511](#L1511) | $n = 0; |
| [1512](#L1512) | $new\_array = []; |
| [1513](#L1513) | $previousValue = []; |
| [1514](#L1514) |  |
| [1515](#L1515) | foreach ($w\_day as $day=>$value) { |
| [1516](#L1516) | if (isset($value['checked']) && 1 == $value['checked']) { |
| [1517](#L1517) | if ($value != $previousValue) { |
| [1518](#L1518) | $n++; |
| [1519](#L1519) | } |
| [1520](#L1520) | $new\_array[$n][$day] = $value; |
| [1521](#L1521) | $previousValue = $value; |
| [1522](#L1522) | } else { |
| [1523](#L1523) | $n++; |
| [1524](#L1524) | $new\_array[$n][$day] = ''; |
| [1525](#L1525) | $previousValue = ''; |
| [1526](#L1526) | } |
| [1527](#L1527) | } |
| [1528](#L1528) | } |
| [1529](#L1529) | $pickup\_hour = ''; |
| [1530](#L1530) | foreach ($new\_array as $key => $data) { |
| [1531](#L1531) |  |
| [1532](#L1532) | if (1 == count($data)) { |
| [1533](#L1533) |  |
| [1534](#L1534) | if ( isset(reset($data)['wclp\_store\_hour']) && '' != reset($data)['wclp\_store\_hour'] && isset(reset($data)['wclp\_store\_hour\_end']) && '' != reset($data)['wclp\_store\_hour\_end'] ) { |
| [1535](#L1535) | reset($data); |
| [1536](#L1536) | $pickup\_hour .= esc\_html(ucfirst(key($data)), 'advanced-local-pickup-for-woocommerce') . ' : ' . esc\_html(reset($data)['wclp\_store\_hour']) . ' - ' . esc\_html(reset($data)['wclp\_store\_hour\_end']); |
| [1537](#L1537) | } |
| [1538](#L1538) | } |
| [1539](#L1539) | if (2 == count($data)) { |
| [1540](#L1540) |  |
| [1541](#L1541) | if ( isset(reset($data)['wclp\_store\_hour']) && '' != reset($data)['wclp\_store\_hour'] && isset(reset($data)['wclp\_store\_hour\_end']) && '' != reset($data)['wclp\_store\_hour\_end'] ) { |
| [1542](#L1542) | reset($data); |
| [1543](#L1543) | $array\_key\_first = key($data); |
| [1544](#L1544) | end($data); |
| [1545](#L1545) | $array\_key\_last = key($data); |
| [1546](#L1546) | $pickup\_hour .= esc\_html(ucfirst($array\_key\_first), 'advanced-local-pickup-for-woocommerce') . ' - ' ; |
| [1547](#L1547) | $pickup\_hour .= esc\_html(ucfirst($array\_key\_last) . ' ', 'advanced-local-pickup-for-woocommerce') . ' : ' . esc\_html(reset($data)['wclp\_store\_hour']) . ' - ' . esc\_html(reset($data)['wclp\_store\_hour\_end']); |
| [1548](#L1548) | } |
| [1549](#L1549) |  |
| [1550](#L1550) | } |
| [1551](#L1551) | if (count($data) > 2) { |
| [1552](#L1552) | if ( isset(reset($data)['wclp\_store\_hour']) && '' != reset($data)['wclp\_store\_hour'] && isset(reset($data)['wclp\_store\_hour\_end']) && '' != reset($data)['wclp\_store\_hour\_end'] ) { |
| [1553](#L1553) | reset($data); |
| [1554](#L1554) | $array\_key\_first = key($data); |
| [1555](#L1555) | end($data); |
| [1556](#L1556) | $array\_key\_last = key($data); |
| [1557](#L1557) | $pickup\_hour .= esc\_html(ucfirst($array\_key\_first), 'advanced-local-pickup-for-woocommerce') . ' ' . esc\_html(' To', 'advanced-local-pickup-for-woocommerce') . ' ' . esc\_html(ucfirst($array\_key\_last), 'advanced-local-pickup-for-woocommerce') . ' : ' . esc\_html(reset($data)['wclp\_store\_hour']) . ' - ' . esc\_html(reset($data)['wclp\_store\_hour\_end']); |
| [1558](#L1558) |  |
| [1559](#L1559) | } |
| [1560](#L1560) |  |
| [1561](#L1561) | } |
| [1562](#L1562) | } |
| [1563](#L1563) |  |
| [1564](#L1564) | return $pickup\_hour; |
| [1565](#L1565) | } |
| [1566](#L1566) |  |
| [1567](#L1567) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/advanced-local-pickup-for-woocommerce/trunk/include/wc-local-pickup-admin.php?rev=2889033&format=txt)
* [Original Format](/export/2889033/advanced-local-pickup-for-woocommerce/trunk/include/wc-local-pickup-admin.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_21247d11_20250114_185439.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D2986002%2540advanced-local-pickup-for-woocommerce%252Ftrunk%26old%3D2983681%2540advanced-local-pickup-for-woocommerce%252Ftrunk)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Reverse Diff](/changeset/2983681/advanced-local-pickup-for-woocommerce/trunk?old=2986002&old_path=%2Fadvanced-local-pickup-for-woocommerce%2Ftrunk)

---

# Changes in [advanced-local-pickup-for-woocommerce/trunk](/browser/advanced-local-pickup-for-woocommerce/trunk?rev=2986002 "Show entry in browser") [[2983681:2986002]](/log/advanced-local-pickup-for-woocommerce/trunk?rev=2986002&stop_rev=2983681 "Show revision log")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Location:
[advanced-local-pickup-for-woocommerce/trunk](/browser/advanced-local-pickup-for-woocommerce/trunk?rev=2986002)
Files:

10 added
9 edited

* [assets/css/admin.css](/browser/advanced-local-pickup-for-woocommerce/trunk/assets/css/admin.css?rev=2986002 "Show entry in browser")
  (modified)
  ([12 diffs](#file0 "Show differences"))
* [assets/js/admin.js](/browser/advanced-local-pickup-for-woocommerce/trunk/assets/js/admin.js?rev=2986002 "Show entry in browser")
  (modified)
  ([1 diff](#file1 "Show differences"))
* [include/customizer/customizer-admin.php](/browser/advanced-local-pickup-for-woocommerce/trunk/include/customizer/customizer-admin.php?rev=2986002 "Show entry in browser")
  (modified)
  ([1 diff](#file2 "Show differences"))
* [include/views/wclp-edit-location-form.php](/browser/advanced-local-pickup-for-woocommerce/trunk/include/views/wclp-edit-location-form.php?rev=2986002 "Show entry in browser")
  (modified)
  ([1 diff](#file3 "Show differences"))
* [include/views/wclp\_addon\_tab.php](/browser/advanced-local-pickup-for-woocommerce/trunk/include/views/wclp_addon_tab.php?rev=2986002 "Show entry in browser")
  (modified)
  ([2 diffs](#file4 "Show differences"))
* [include/wc-local-pickup-admin.php](/browser/advanced-local-pickup-for-woocommerce/trunk/include/wc-local-pickup-admin.php?rev=2986002 "Show entry in browser")
  (modified)
  ([6 diffs](#file5 "Show differences"))
* [include/wc-local-pickup-installation.php](/browser/advanced-local-pickup-for-woocommerce/trunk/include/wc-local-pickup-installation.php?rev=2986002 "Show entry in browser")
  (modified)
  ([1 diff](#file6 "Show differences"))
* [readme.txt](/browser/advanced-local-pickup-for-woocommerce/trunk/readme.txt?rev=2986002 "Show entry in browser")
  (modified)
  ([3 diffs](#file7 "Show differences"))
* [woo-advanced-local-pickup.php](/browser/advanced-local-pickup-for-woocommerce/trunk/woo-advanced-local-pickup.php?rev=2986002 "Show entry in browser")
  (modified)
  ([4 diffs](#file8 "Show differences"))
* [zorem-tracking](/browser/advanced-local-pickup-for-woocommerce/trunk/zorem-tracking?rev=2986002 "Show entry in browser")
  (added)
* [zorem-tracking/README.md](/browser/advanced-local-pickup-for-woocommerce/trunk/zorem-tracking/README.md?rev=2986002 "Show entry in browser")
  (added)
* [zorem-tracking/assets](/browser/advanced-local-pickup-for-woocommerce/trunk/zorem-tracking/assets?rev=2986002 "Show entry in browser")
  (added)
* [zorem-tracking/assets/css](/browser/advanced-local-pickup-for-woocommerce/trunk/zorem-tracking/assets/css?rev=2986002 "Show entry in browser")
  (added)
* [zorem-tracking/assets/css/style.css](/browser/advanced-local-pickup-for-woocommerce/trunk/zorem-tracking/assets/css/style.css?rev=2986002 "Show entry in browser")
  (added)
* [zorem-tracking/assets/js](/browser/advanced-local-pickup-for-woocommerce/trunk/zorem-tracking/assets/js?rev=2986002 "Show entry in browser")
  (added)
* [zorem-tracking/assets/js/main.js](/browser/advanced-local-pickup-for-woocommerce/trunk/zorem-tracking/assets/js/main.js?rev=2986002 "Show entry in browser")
  (added)
* [zorem-tracking/views](/browser/advanced-local-pickup-for-woocommerce/trunk/zorem-tracking/views?rev=2986002 "Show entry in browser")
  (added)
* [zorem-tracking/views/usage\_data\_signup\_box.php](/browser/advanced-local-pickup-for-woocommerce/trunk/zorem-tracking/views/usage_data_signup_box.php?rev=2986002 "Show entry in browser")
  (added)
* [zorem-tracking/zorem-tracking.php](/browser/advanced-local-pickup-for-woocommerce/trunk/zorem-tracking/zorem-tracking.php?rev=2986002 "Show entry in browser")
  (added)

### Legend:

Unmodified
Added
Removed

* ## [advanced-local-pickup-for-woocommerce/trunk/assets/css/admin.css](/changeset/2986002/advanced-local-pickup-for-woocommerce/trunk/assets/css/admin.css?old=2948532&old_path=advanced-local-pickup-for-woocommerce%2Ftrunk%2Fassets%2Fcss%2Fadmin.css "Show the [2983681:2986002] differences restricted to advanced-local-pickup-for-woocommerce/trunk/assets/css/admin.css")

  | [r2983681](/browser/advanced-local-pickup-for-woocommerce/trunk/assets/css/admin.css?rev=2948532#L542 "Show revision 2983681 of this file in browser") | [r2986002](/browser/advanced-local-pickup-for-woocommerce/trunk/assets/css/admin.css?rev=2986002#L542 "Show revision 2986002 of this file in browser") |  |
  | --- | --- | --- |
  | 542 | 542 | .wclp\_admin\_content .form-table tr.html2\_title\_row th, |
  | 543 | 543 | .wclp\_admin\_content .form-table tr.html2\_title\_row td { |
  | 544 |  | padding: ~~10px 0px~~ 10px; |
  |  | 544 | padding: 0 0 10px; |
  | 545 | 545 | } |
  | 546 | 546 |  |
  | […](/browser/advanced-local-pickup-for-woocommerce/trunk/assets/css/admin.css?rev=2948532#L559) | […](/browser/advanced-local-pickup-for-woocommerce/trunk/assets/css/admin.css?rev=2986002#L559) |  |
  | 559 | 559 | .wclp\_outer\_form\_table table.form-table.order-status-table tr td:first-child { |
  | 560 | 560 | width: 37px; |
  | 561 |  | ~~padding: 10px 0 10px~~ !important; |
  |  | 561 | padding-left: 0!important; |
  | 562 | 562 | } |
  | 563 | 563 |  |
  | […](/browser/advanced-local-pickup-for-woocommerce/trunk/assets/css/admin.css?rev=2948532#L582) | […](/browser/advanced-local-pickup-for-woocommerce/trunk/assets/css/admin.css?rev=2986002#L582) |  |
  | 582 | 582 |  |
  | 583 | 583 | .wclp\_outer\_form\_table table.form-table.order-status-table tr td { |
  | 584 |  | padding: 10px 0 10px 15px !important; |
  |  | 584 | padding: 15px 0 15px 15px !important; |
  |  | 585 | } |
  |  | 586 |  |
  |  | 587 | .wclp\_outer\_form\_table table.form-table.order-status-table tr:first-child td { |
  |  | 588 | padding-top: 0 !important; |
  |  | 589 | border-bottom: 1px solid #f5f5f5; |
  |  | 590 | } |
  |  | 591 |  |
  |  | 592 | .wclp\_outer\_form\_table table.form-table.order-status-table tr:last-child td { |
  |  | 593 | padding-bottom: 0 !important; |
  | 585 | 594 | } |
  | 586 | 595 |  |
  | […](/browser/advanced-local-pickup-for-woocommerce/trunk/assets/css/admin.css?rev=2948532#L627) | […](/browser/advanced-local-pickup-for-woocommerce/trunk/assets/css/admin.css?rev=2986002#L636) |  |
  | 627 | 636 | } |
  | 628 | 637 |  |
  | 629 |  | ~~.wclp\_tab\_inner\_container #wclp\_location\_tab\_form .form-table th {~~ |
  | 630 |  | ~~width: 30%;~~ |
  | 631 |  | ~~padding: 10px 0;~~ |
  | 632 |  | ~~}~~ |
  | 633 |  |  |
  | 634 |  | ~~.location-setting .panel.price-adjust .form-table tr:first-child td fieldset:first-child {~~ |
  | 635 |  | ~~width: 30%;~~ |
  | 636 |  | ~~}~~ |
  | 637 |  |  |
  | 638 | 638 | .location-setting .panel.price-adjust .form-table:first-child td { |
  | 639 | 639 | padding: 10px 20px; |
  | […](/browser/advanced-local-pickup-for-woocommerce/trunk/assets/css/admin.css?rev=2948532#L644) | […](/browser/advanced-local-pickup-for-woocommerce/trunk/assets/css/admin.css?rev=2986002#L644) |  |
  | 644 | 644 | } |
  | 645 | 645 |  |
  | 646 |  | ~~.location-setting .panel.price-adjust .form-table:first-child tr:first-child td {~~ |
  | 647 |  | ~~padding-top: 0;~~ |
  | 648 |  | ~~}~~ |
  | 649 |  |  |
  | 650 |  | ~~.location-setting .panel.price-adjust .form-table:last-child tr:last-child td {~~ |
  | 651 |  | ~~padding-bottom: 0;~~ |
  | 652 |  | ~~}~~ |
  | 653 |  |  |
  | 654 | 646 | .wclp\_tab\_inner\_container #wclp\_location\_tab\_form table.form-table tr { |
  | 655 | 647 | border-bottom: 1px solid #e0e0e0; |
  | […](/browser/advanced-local-pickup-for-woocommerce/trunk/assets/css/admin.css?rev=2948532#L660) | […](/browser/advanced-local-pickup-for-woocommerce/trunk/assets/css/admin.css?rev=2986002#L652) |  |
  | 660 | 652 | } |
  | 661 | 653 |  |
  | 662 |  | #wclp\_location\_tab\_form .address-special table.form-table tr, |
  | 663 |  | #wclp\_location\_tab\_form .address table.form-table tr { |
  | 664 |  | border-bottom: 0; |
  | 665 |  | } |
  | 666 |  |  |
  | 667 |  | #wclp\_location\_tab\_form .address-special table.form-table tr td, |
  | 668 |  | #wclp\_location\_tab\_form .address table.form-table tr td { |
  | 669 |  | padding: 5px 0; |
  |  | 654 | .wclp\_tab\_inner\_container #wclp\_location\_tab\_form table.form-table tr:last-child td { |
  |  | 655 | padding: 0; |
  | 670 | 656 | } |
  | 671 | 657 |  |
  | 672 | 658 | .wclp\_tab\_inner\_container #wclp\_location\_tab\_form table.form-table tr:last-child { |
  | 673 | 659 | border: none; |
  |  | 660 | margin: 0; |
  | 674 | 661 | } |
  | 675 | 662 |  |
  | […](/browser/advanced-local-pickup-for-woocommerce/trunk/assets/css/admin.css?rev=2948532#L694) | […](/browser/advanced-local-pickup-for-woocommerce/trunk/assets/css/admin.css?rev=2986002#L681) |  |
  | 694 | 681 |  |
  | 695 | 682 | .wclp\_tab\_inner\_container #wclp\_setting\_tab\_form .form-table td .wplp\_multiple { |
  | 696 |  | padding: 5px 0; |
  | 697 |  | margin: 0; |
  |  | 683 | padding: 0 0 15px 0; |
  |  | 684 | margin: 0 0 15px; |
  |  | 685 | border-bottom: 1px solid #f5f5f5; |
  | 698 | 686 | } |
  | 699 | 687 |  |
  | 700 | 688 | #wclp\_setting\_tab\_form .html-layout-2 tr.message\_textarea td, |
  | 701 | 689 | #wclp\_setting\_tab\_form .html-layout-2 tr.additional\_textarea td { |
  | 702 |  | padding: 5px 0~~px 15px~~; |
  |  | 690 | padding: 5px 0 0; |
  | 703 | 691 | } |
  | 704 | 692 |  |
  | […](/browser/advanced-local-pickup-for-woocommerce/trunk/assets/css/admin.css?rev=2948532#L898) | […](/browser/advanced-local-pickup-for-woocommerce/trunk/assets/css/admin.css?rev=2986002#L886) |  |
  | 898 | 886 | .wplp\_pickup\_duration { |
  | 899 | 887 | margin-bottom: 10px; |
  |  | 888 | } |
  |  | 889 |  |
  |  | 890 | .wclp\_tab\_section #wclp\_location\_tab\_form .panel tr th, .wclp\_tab\_section #wclp\_location\_tab\_form .panel tr td, .wclp\_tab\_section #wclp\_location\_tab\_form .panel tr td fieldset:first-child { |
  |  | 891 | display: block; |
  |  | 892 | } |
  |  | 893 |  |
  |  | 894 | .wclp\_tab\_inner\_container #wclp\_location\_tab\_form table.form-table tr { |
  |  | 895 | border-bottom: 1px solid #f5f5f5; |
  |  | 896 | margin-bottom: 15px; |
  |  | 897 | display: block; |
  |  | 898 | } |
  |  | 899 |  |
  |  | 900 | .wclp\_tab\_section #wclp\_location\_tab\_form .panel tr th, .wclp\_tab\_section #wclp\_location\_tab\_form .panel tr td { |
  |  | 901 | padding: 0; |
  |  | 902 | margin: 0; |
  |  | 903 | padding-bottom: 15px; |
  | 900 | 904 | } |
  | 901 | 905 |  |
  | […](/browser/advanced-local-pickup-for-woocommerce/trunk/assets/css/admin.css?rev=2948532#L1038) | […](/browser/advanced-local-pickup-for-woocommerce/trunk/assets/css/admin.css?rev=2986002#L1042) |  |
  | 1038 | 1042 | } |
  | 1039 | 1043 |  |
  | 1040 |  | .location-setting .panel.business-hours .hours-block .time-format { |
  | 1041 |  | width: 30%; |
  | 1042 |  | line-height: 35px; |
  | 1043 |  | float: left; |
  |  | 1044 | .location-setting .panel.business-hours .hours-block .time-format, .location-setting .panel.business-hours .hours-block .work-hours { |
  |  | 1045 | padding-bottom: 15px; |
  |  | 1046 | display: block; |
  | 1044 | 1047 | } |
  | 1045 | 1048 |  |
  | […](/browser/advanced-local-pickup-for-woocommerce/trunk/assets/css/admin.css?rev=2948532#L1263) | […](/browser/advanced-local-pickup-for-woocommerce/trunk/assets/css/admin.css?rev=2986002#L1266) |  |
  | 1263 | 1266 | } |
  | 1264 | 1267 |  |
  | 1265 |  | ~~.location-setting .panel.business-hours .hours-block .work-hours {~~ |
  | 1266 |  | ~~padding-bottom: 20px;~~ |
  | 1267 |  | ~~display: block;~~ |
  | 1268 |  | ~~}~~ |
  | 1269 |  |  |
  | 1270 |  | ~~.location-setting .panel tr:last-child th,~~ |
  | 1271 |  | ~~.location-setting .panel.business-hours tr:last-child td,~~ |
  | 1272 |  | ~~.location-setting .panel.appointments tr:last-child td,~~ |
  | 1273 |  | ~~.location-setting .panel tr:last-child td {~~ |
  | 1274 |  | ~~padding-bottom: 0 !important;~~ |
  | 1275 |  | ~~}~~ |
  | 1276 |  |  |
  | 1277 | 1268 | .location-setting .panel tr:first-child th, |
  | 1278 | 1269 | .location-setting .panel.business-hours tr:first-child td, |
  | 1279 |  | ~~.location-setting .panel.appointments tr:first-child td,~~ |
  | 1280 | 1270 | .location-setting .panel tr:first-child td { |
  | 1281 | 1271 | padding-top: 0 !important; |
  | […](/browser/advanced-local-pickup-for-woocommerce/trunk/assets/css/admin.css?rev=2948532#L1538) | […](/browser/advanced-local-pickup-for-woocommerce/trunk/assets/css/admin.css?rev=2986002#L1528) |  |
  | 1538 | 1528 | } |
  | 1539 | 1529 |  |
  | 1540 |  | ~~.location-setting .panel tr:last-child th,~~ |
  | 1541 |  | ~~.location-setting .panel.business-hours tr:last-child td,~~ |
  | 1542 |  | ~~.location-setting .panel.appointments tr:last-child td,~~ |
  | 1543 |  | ~~.location-setting .panel tr:last-child td {~~ |
  | 1544 |  | ~~padding-bottom: 0 !important;~~ |
  | 1545 |  | ~~}~~ |
  | 1546 |  |  |
  | 1547 | 1530 | .location-setting .panel tr:first-child th, |
  | 1548 | 1531 | .location-setting .panel.business-hours tr:first-child td, |
  | 1549 |  | ~~.location-setting .panel.appointments tr:first-child td,~~ |
  | 1550 | 1532 | .location-setting .panel tr:first-child td { |
  | 1551 | 1533 | padding-top: 0 !important; |
  | 1552 |  | ~~}~~ |
  | 1553 |  |  |
  | 1554 |  | ~~.location-setting .panel.price-adjust .form-table tr:first-child td fieldset {~~ |
  | 1555 |  | ~~display: inline-block;~~ |
  | 1556 |  | ~~padding-right: 5px;~~ |
  | 1557 | 1534 | } |
  | 1558 | 1535 |  |
  | […](/browser/advanced-local-pickup-for-woocommerce/trunk/assets/css/admin.css?rev=2948532#L1796) | […](/browser/advanced-local-pickup-for-woocommerce/trunk/assets/css/admin.css?rev=2986002#L1773) |  |
  | 1796 | 1773 | } |
  | 1797 | 1774 |  |
  | 1798 |  | ~~.location-setting .panel.price-adjust .form-table tr:first-child td fieldset:first-child {~~ |
  | 1799 |  | ~~width: 210px;~~ |
  | 1800 |  | ~~padding-right: 10px;~~ |
  | 1801 |  | ~~}~~ |
  | 1802 | 1775 | } |
  | 1803 | 1776 |  |
* ## [advanced-local-pickup-for-woocommerce/trunk/assets/js/admin.js](/changeset/2986002/advanced-local-pickup-for-woocommerce/trunk/assets/js/admin.js?old=2948564&old_path=advanced-local-pickup-for-woocommerce%2Ftrunk%2Fassets%2Fjs%2Fadmin.js "Show the [2983681:2986002] differences restricted to advanced-local-pickup-for-woocommerce/trunk/assets/js/admin.js")

  | [r2983681](/browser/advanced-local-pickup-for-woocommerce/trunk/assets/js/admin.js?rev=2948564#L545 "Show revision 2983681 of this file in browser") | [r2986002](/browser/advanced-local-pickup-for-woocommerce/trunk/assets/js/admin.js?rev=2986002#L545 "Show revision 2986002 of this file in browser") |  |
  | --- | --- | --- |
  | 545 | 545 | wclp\_store\_hour2: wclp\_store\_hour2.val(), |
  | 546 | 546 | wclp\_store\_hour\_end2: wclp\_store\_hour\_end2.val(), |
  | 547 |  | security: jQuery("#wclp\_apply\_work\_hours\_nonce").val(), |
  | 548 |  | //nonce: alp\_object.nonce, |
  |  | 547 | nonce: alp\_object.nonce, |
  | 549 | 548 | }; |
  | 550 | 549 | if(wclp\_store\_hour.val() !== '' && wclp\_store\_hour\_end.val() !== '' && hasClassMorning === false ){ |
* ## [advanced-local-pickup-for-woocommerce/trunk/include/customizer/customizer-admin.php](/changeset/2986002/advanced-local-pickup-for-woocommerce/trunk/include/customizer/customizer-admin.php?old=2926295&old_path=advanced-local-pickup-for-woocommerce%2Ftrunk%2Finclude%2Fcustomizer%2Fcustomizer-admin.php "Show the [2983681:2986002] differences restricted to advanced-local-pickup-for-woocommerce/trunk/include/customizer/customizer-admin.php")

  | [r2983681](/browser/advanced-local-pickup-for-woocommerce/trunk/include/customizer/customizer-admin.php?rev=2926295#L193 "Show revision 2983681 of this file in browser") | [r2986002](/browser/advanced-local-pickup-for-woocommerce/trunk/include/customizer/customizer-admin.php?rev=2986002#L193 "Show revision 2986002 of this file in browser") |  |
  | --- | --- | --- |
  | 193 | 193 | public function get\_preview\_func() { |
  | 194 | 194 | $preview = isset($\_GET['preview']) ? sanitize\_text\_field($\_GET['preview']) : 'ready\_pickup'; |
  | 195 |  | echo ~~$this->get\_preview\_email($preview~~); |
  |  | 195 | echo wp\_kses\_post($this->get\_preview\_email($preview)); |
  | 196 | 196 | die(); |
  | 197 | 197 | } |
* ## [advanced-local-pickup-for-woocommerce/trunk/include/views/wclp-edit-location-form.php](/changeset/2986002/advanced-local-pickup-for-woocommerce/trunk/include/views/wclp-edit-location-form.php?old=2948564&old_path=advanced-local-pickup-for-woocommerce%2Ftrunk%2Finclude%2Fviews%2Fwclp-edit-location-form.php "Show the [2983681:2986002] differences restricted to advanced-local-pickup-for-woocommerce/trunk/include/views/wclp-edit-location-form.php")

  | [r2983681](/browser/advanced-local-pickup-for-woocommerce/trunk/include/views/wclp-edit-location-form.php?rev=2948564#L14 "Show revision 2983681 of this file in browser") | [r2986002](/browser/advanced-local-pickup-for-woocommerce/trunk/include/views/wclp-edit-location-form.php?rev=2986002#L14 "Show revision 2986002 of this file in browser") |  |
  | --- | --- | --- |
  | 14 | 14 | <span class="alp\_error\_msg"></span> |
  | 15 | 15 | <?php wp\_nonce\_field( 'wclp\_location\_edit\_form\_action', 'wclp\_location\_edit\_form\_nonce\_field' ); ?> |
  | 16 |  | ~~<input type="hidden" id="wclp\_apply\_work\_hours\_nonce" value="<?php esc\_html\_e( wp\_create\_nonce( 'wclp\_apply\_work\_hours\_nonce' ) ); ?>">~~ |
  | 17 | 16 | <input type="hidden" name="action" value="wclp\_location\_edit\_form\_update"> |
  | 18 | 17 | </span> |
* ## [advanced-local-pickup-for-woocommerce/trunk/include/views/wclp\_addon\_tab.php](/changeset/2986002/advanced-local-pickup-for-woocommerce/trunk/include/views/wclp_addon_tab.php?old=2948532&old_path=advanced-local-pickup-for-woocommerce%2Ftrunk%2Finclude%2Fviews%2Fwclp_addon_tab.php "Show the [2983681:2986002] differences restricted to advanced-local-pickup-for-woocommerce/trunk/include/views/wclp_addon_tab.php")

  | [r2983681](/browser/advanced-local-pickup-for-woocommerce/trunk/include/views/wclp_addon_tab.php?rev=2948532#L1 "Show revision 2983681 of this file in browser") | [r2986002](/browser/advanced-local-pickup-for-woocommerce/trunk/include/views/wclp_addon_tab.php?rev=2986002#L1 "Show revision 2986002 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 | $pro\_plugins = array( |
  |  | 3 | 5 => array( |
  |  | 4 | 'title' => 'Advanced Shipment Tracking', |
  |  | 5 | 'description' => 'AST PRO provides powerful features to easily add tracking info to WooCommerce orders, automate the fulfillment workflows and keep your customers happy and informed.', |
  |  | 6 | 'url' => 'https://www.zorem.com/product/woocommerce-advanced-shipment-tracking/?utm\_source=wp-admin&utm\_medium=CEV&utm\_campaign=add-ons', |
  |  | 7 | 'image' => 'ast-icon.png', |
  |  | 8 | 'height' => '45px', |
  |  | 9 | 'file' => 'ast-pro/ast-pro.php' |
  |  | 10 | ), |
  | 3 | 11 | 0 => array( |
  | 4 | 12 | 'title' => 'TrackShip for WooCommerce', |
  | […](/browser/advanced-local-pickup-for-woocommerce/trunk/include/views/wclp_addon_tab.php?rev=2948532#L34) | […](/browser/advanced-local-pickup-for-woocommerce/trunk/include/views/wclp_addon_tab.php?rev=2986002#L42) |  |
  | 34 | 42 | ), |
  | 35 | 43 | 4 => array( |
  | 36 |  | 'title' => '~~Order Status Manager~~', |
  | 37 |  | 'description' => 'The ~~Advanced Order Status Manager allows store owners to manage the WooCommerce orders statuses, create, edit, and delete custom Custom Order Statuses and integrate them into the WooCommerce orders flow~~.', |
  | 38 |  | 'url' => 'https://w~~ww.zorem.com/products/advanced-order-status-manager/?utm\_source=wp-admin&utm\_medium=OSM&utm\_campaign=add-ons~~', |
  | 39 |  | 'image' => '~~osm~~-icon.png', |
  |  | 44 | 'title' => 'Customer Email Verification', |
  |  | 45 | 'description' => 'The Customer Email Verification helps you to reduce registration spam and fake orders by requiring customers to verify their email address when they register an account or before they can place an order on your store.', |
  |  | 46 | 'url' => 'https://woocommerce.com/products/customer-email-verification/', |
  |  | 47 | 'image' => 'cev-icon.png', |
  | 40 | 48 | 'height' => '45px', |
  | 41 |  | 'file' => 'advanced-order-status-manager/advanced-order-status-manager.php' |
  | 42 |  | ), |
  | 43 |  | 5 => array( |
  | 44 |  | 'title' => 'Advanced Shipment Tracking', |
  | 45 |  | 'description' => 'AST PRO provides powerful features to easily add tracking info to WooCommerce orders, automate the fulfillment workflows and keep your customers happy and informed.', |
  | 46 |  | 'url' => 'https://www.zorem.com/product/woocommerce-advanced-shipment-tracking/?utm\_source=wp-admin&utm\_medium=CEV&utm\_campaign=add-ons', |
  | 47 |  | 'image' => 'ast-icon.png', |
  | 48 |  | 'height' => '45px', |
  | 49 |  | 'file' => 'ast-pro/ast-pro.php' |
  | 50 |  | ), |
  |  | 49 | 'file' => 'customer-email-verification-pro/customer-email-verification-pro.php' |
  |  | 50 | ), |
  | 51 | 51 | ); |
  | 52 | 52 | ?> |
* ## [advanced-local-pickup-for-woocommerce/trunk/include/wc-local-pickup-admin.php](/changeset/2986002/advanced-local-pickup-for-woocommerce/trunk/include/wc-local-pickup-admin.php?old=2948564&old_path=advanced-local-pickup-for-woocommerce%2Ftrunk%2Finclude%2Fwc-local-pickup-admin.php "Show the [2983681:2986002] differences restricted to advanced-local-pickup-for-woocommerce/trunk/include/wc-local-pickup-admin.php")

  | [r2983681](/browser/advanced-local-pickup-for-woocommerce/trunk/include/wc-local-pickup-admin.php?rev=2948564#L27 "Show revision 2983681 of this file in browser") | [r2986002](/browser/advanced-local-pickup-for-woocommerce/trunk/include/wc-local-pickup-admin.php?rev=2986002#L27 "Show revision 2986002 of this file in browser") |  |
  | --- | --- | --- |
  | 27 | 27 | \*/ |
  | 28 | 28 | private static $instance; |
  |  | 29 | public $table; |
  | 29 | 30 |  |
  | 30 | 31 | /\*\* |
  | […](/browser/advanced-local-pickup-for-woocommerce/trunk/include/wc-local-pickup-admin.php?rev=2948564#L120) | […](/browser/advanced-local-pickup-for-woocommerce/trunk/include/wc-local-pickup-admin.php?rev=2986002#L121) |  |
  | 120 | 121 | <img class="zorem-layout\_\_header-logo" src="<?php echo esc\_url(wc\_local\_pickup()->plugin\_dir\_url(\_\_FILE\_\_)) . 'assets/images/alp-logo.png'; ?>"> |
  | 121 | 122 | <div class="woocommerce-layout\_\_activity-panel" <?php echo esc\_html($style); ?>> |
  | 122 |  | <div class="woocommerce-layout\_\_activity-panel-tabs"> |
  | 123 |  | <button type="button" id="activity-panel-tab-help" class="components-button woocommerce-layout\_\_activity-panel-tab"> |
  | 124 |  | <span class="dashicons dashicons-editor-help"></span> |
  | 125 |  | Help |
  | 126 |  | </button> |
  | 127 |  | </div> |
  | 128 |  | <div class="woocommerce-layout\_\_activity-panel-wrapper"> |
  | 129 |  | <div class="woocommerce-layout\_\_activity-panel-content" id="activity-panel-true"> |
  | 130 |  | <div class="woocommerce-layout\_\_activity-panel-header"> |
  | 131 |  | <div class="woocommerce-layout\_\_inbox-title"> |
  | 132 |  | <p class="css-activity-panel-Text">Documentation</p> |
  | 133 |  | </div> |
  | 134 |  | </div> |
  | 135 |  | <div> |
  | 136 |  | <ul class="woocommerce-list woocommerce-quick-links\_\_list"> |
  | 137 |  | <li class="woocommerce-list\_\_item has-action"> |
  | 138 |  | <?php |
  | 139 |  | $support\_link = class\_exists( 'Advanced\_local\_pickup\_PRO' ) ? 'https://www.zorem.com/?support=1' : 'https://wordpress.org/support/plugin/advanced-local-pickup-for-woocommerce/#new-topic-0' ; |
  | 140 |  | ?> |
  | 141 |  | <a href="<?php echo esc\_url( $support\_link ); ?>" class="woocommerce-list\_\_item-inner" target="\_blank" > |
  | 142 |  | <div class="woocommerce-list\_\_item-before"> |
  | 143 |  | <img src="<?php echo esc\_url(wc\_local\_pickup()->plugin\_dir\_url(\_\_FILE\_\_)) . 'assets/images/get-support-icon.svg'; ?>"> |
  | 144 |  | </div> |
  | 145 |  | <div class="woocommerce-list\_\_item-text"> |
  | 146 |  | <span class="woocommerce-list\_\_item-title"> |
  | 147 |  | <div class="woocommerce-list-Text">Get Support</div> |
  | 148 |  | </span> |
  | 149 |  | </div> |
  | 150 |  | <div class="woocommerce-list\_\_item-after"> |
  | 151 |  | <span class="dashicons dashicons-arrow-right-alt2"></span> |
  | 152 |  | </div> |
  | 153 |  | </a> |
  | 154 |  | </li> |
  | 155 |  | <li class="woocommerce-list\_\_item has-action"> |
  | 156 |  | <a href="https://www.zorem.com/docs/advanced-local-pickup-for-woocommerce/?utm\_source=wp-admin&utm\_medium=CBRDOCU&utm\_campaign=add-ons" class="woocommerce-list\_\_item-inner" target="\_blank"> |
  | 157 |  | <div class="woocommerce-list\_\_item-before"> |
  | 158 |  | <img src="<?php echo esc\_url(wc\_local\_pickup()->plugin\_dir\_url(\_\_FILE\_\_)) . 'assets/images/documentation-icon.svg'; ?>"> |
  | 159 |  | </div> |
  | 160 |  | <div class="woocommerce-list\_\_item-text"> |
  | 161 |  | <span class="woocommerce-list\_\_item-title"> |
  | 162 |  | <div class="woocommerce-list-Text">Documentation</div> |
  | 163 |  | </span> |
  | 164 |  | </div> |
  | 165 |  | <div class="woocommerce-list\_\_item-after"> |
  | 166 |  | <span class="dashicons dashicons-arrow-right-alt2"></span> |
  | 167 |  | </div> |
  | 168 |  | </a> |
  | 169 |  | </li> |
  | 170 |  | <?php if ( !class\_exists( 'Advanced\_local\_pickup\_PRO' ) ) { ?> |
  |  | 123 | <div class="woocommerce-layout\_\_activity-panel-tabs"> |
  |  | 124 | <button type="button" id="activity-panel-tab-help" class="components-button woocommerce-layout\_\_activity-panel-tab"> |
  |  | 125 | <span class="dashicons dashicons-editor-help"></span> |
  |  | 126 | Help |
  |  | 127 | </button> |
  |  | 128 | </div> |
  |  | 129 | <div class="woocommerce-layout\_\_activity-panel-wrapper"> |
  |  | 130 | <div class="woocommerce-layout\_\_activity-panel-content" id="activity-panel-true"> |
  |  | 131 | <div class="woocommerce-layout\_\_activity-panel-header"> |
  |  | 132 | <div class="woocommerce-layout\_\_inbox-title"> |
  |  | 133 | <p class="css-activity-panel-Text">Documentation</p> |
  |  | 134 | </div> |
  |  | 135 | </div> |
  |  | 136 | <div> |
  |  | 137 | <ul class="woocommerce-list woocommerce-quick-links\_\_list"> |
  | 171 | 138 | <li class="woocommerce-list\_\_item has-action"> |
  | 172 |  | <a href="https://www.zorem.com/product/advanced-local-pickup-for-woocommerce/?utm\_source=wp-admin&utm\_medium=CBR&utm\_campaign=add-ons" class="woocommerce-list\_\_item-inner" target="\_blank"> |
  |  | 139 | <?php |
  |  | 140 | $support\_link = class\_exists( 'Advanced\_local\_pickup\_PRO' ) ? 'https://www.zorem.com/?support=1' : 'https://wordpress.org/support/plugin/advanced-local-pickup-for-woocommerce/#new-topic-0' ; |
  |  | 141 | ?> |
  |  | 142 | <a href="<?php echo esc\_url( $support\_link ); ?>" class="woocommerce-list\_\_item-inner" target="\_blank" > |
  | 173 | 143 | <div class="woocommerce-list\_\_item-before"> |
  | 174 |  | <img src="<?php echo esc\_url(wc\_local\_pickup()->plugin\_dir\_url(\_\_FILE\_\_)) . 'assets/images/~~upgrade.svg'; ?>">~~ |
  |  | 144 | <img src="<?php echo esc\_url(wc\_local\_pickup()->plugin\_dir\_url(\_\_FILE\_\_)) . 'assets/images/get-support-icon.svg'; ?>"> |
  | 175 | 145 | </div> |
  | 176 | 146 | <div class="woocommerce-list\_\_item-text"> |
  | 177 | 147 | <span class="woocommerce-list\_\_item-title"> |
  | 178 |  | <div class="woocommerce-list-Text">Upgrade To Pro</div> |
  |  | 148 | <div class="woocommerce-list-Text">Get Support</div> |
  |  | 149 | </span> |
  |  | 150 | </div> |
  |  | 151 | <div class="woocommerce-list\_\_item-after"> |
  |  | 152 | <span class="dashicons dashicons-arrow-right-alt2"></span> |
  |  | 153 | </div> |
  |  | 154 | </a> |
  |  | 155 | </li> |
  |  | 156 | <li class="woocommerce-list\_\_item has-action"> |
  |  | 157 | <a href="https://www.zorem.com/docs/advanced-local-pickup-for-woocommerce/?utm\_source=wp-admin&utm\_medium=CBRDOCU&utm\_campaign=add-ons" class="woocommerce-list\_\_item-inner" target="\_blank"> |
  |  | 158 | <div class="woocommerce-list\_\_item-before"> |
  |  | 159 | <img src="<?php echo esc\_url(wc\_local\_pickup()->plugin\_dir\_url(\_\_FILE\_\_)) . 'assets/images/documentation-icon.svg'; ?>"> |
  |  | 160 | </div> |
  |  | 161 | <div class="woocommerce-list\_\_item-text"> |
  |  | 162 | <span class="woocommerce-list\_\_item-title"> |
  |  | 163 | <div class="woocommerce-list-Text">Documentation</div> |
  | 179 | 164 | </span> |
  | 180 | 165 | </div> |
  | […](/browser/advanced-local-pickup-for-woocommerce/trunk/include/wc-local-pickup-admin.php?rev=2948564#L184) | […](/browser/advanced-local-pickup-for-woocommerce/trunk/include/wc-local-pickup-admin.php?rev=2986002#L169) |  |
  | 184 | 169 | </a> |
  | 185 | 170 | </li> |
  | 186 |  | <?php } ?> |
  | 187 |  | </ul> |
  |  | 171 | <?php if ( !class\_exists( 'Advanced\_local\_pickup\_PRO' ) ) { ?> |
  |  | 172 | <li class="woocommerce-list\_\_item has-action"> |
  |  | 173 | <a href="https://www.zorem.com/product/advanced-local-pickup-for-woocommerce/?utm\_source=wp-admin&utm\_medium=CBR&utm\_campaign=add-ons" class="woocommerce-list\_\_item-inner" target="\_blank"> |
  |  | 174 | <div class="woocommerce-list\_\_item-before"> |
  |  | 175 | <img src="<?php echo esc\_url(wc\_local\_pickup()->plugin\_dir\_url(\_\_FILE\_\_)) . 'assets/images/upgrade.svg'; ?>"> |
  |  | 176 | </div> |
  |  | 177 | <div class="woocommerce-list\_\_item-text"> |
  |  | 178 | <span class="woocommerce-list\_\_item-title"> |
  |  | 179 | <div class="woocommerce-list-Text">Upgrade To Pro</div> |
  |  | 180 | </span> |
  |  | 181 | </div> |
  |  | 182 | <div class="woocommerce-list\_\_item-after"> |
  |  | 183 | <span class="dashicons dashicons-arrow-right-alt2"></span> |
  |  | 184 | </div> |
  |  | 185 | </a> |
  |  | 186 | </li> |
  |  | 187 | <?php } ?> |
  |  | 188 | </ul> |
  |  | 189 | </div> |
  | 188 | 190 | </div> |
  | 189 | 191 | </div> |
  | 190 |  | </div> |
  | 191 |  | </div> |
  |  | 192 | </div> |
  | 192 | 193 | <?php } else { ?> |
  | 193 | 194 | <h1 class="tab\_section\_heading"> |
  | […](/browser/advanced-local-pickup-for-woocommerce/trunk/include/wc-local-pickup-admin.php?rev=2948564#L438) | […](/browser/advanced-local-pickup-for-woocommerce/trunk/include/wc-local-pickup-admin.php?rev=2986002#L439) |  |
  | 438 | 439 | $this->table = $wpdb->prefix . 'alp\_pickup\_location'; |
  | 439 | 440 |  |
  | 440 |  | $results = $wpdb->get\_row( $wpdb->prepare( 'SELECT \* FROM %1s WHERE id = %2~~s~~', $this->table, $id ) ); |
  |  | 441 | $results = $wpdb->get\_row( $wpdb->prepare( 'SELECT \* FROM %1s WHERE id = %2d', $this->table, $id ) ); |
  | 441 | 442 |  |
  | 442 | 443 | $results = $this->get\_slaches\_data\_byid($results); |
  | […](/browser/advanced-local-pickup-for-woocommerce/trunk/include/wc-local-pickup-admin.php?rev=2948564#L898) | […](/browser/advanced-local-pickup-for-woocommerce/trunk/include/wc-local-pickup-admin.php?rev=2986002#L899) |  |
  | 898 | 899 |  |
  | 899 | 900 | $nonce = isset( $\_POST['nonce'] ) ? sanitize\_text\_field($\_POST['nonce']) : ''; |
  | 900 |  | ~~/\*~~if ( ! wp\_verify\_nonce( $nonce, 'alp-ajax-nonce' ) ) { |
  |  | 901 | if ( ! wp\_verify\_nonce( $nonce, 'alp-ajax-nonce' ) ) { |
  | 901 | 902 | die(); |
  | 902 |  | }\*/ |
  | 903 |  | check\_ajax\_referer( 'wclp\_apply\_work\_hours\_nonce', 'security' ); |
  |  | 903 | } |
  | 904 | 904 |  |
  | 905 | 905 | $data = $this->get\_data(); |
  | […](/browser/advanced-local-pickup-for-woocommerce/trunk/include/wc-local-pickup-admin.php?rev=2948564#L1067) | […](/browser/advanced-local-pickup-for-woocommerce/trunk/include/wc-local-pickup-admin.php?rev=2986002#L1067) |  |
  | 1067 | 1067 |  |
  | 1068 | 1068 | $nonce = isset( $\_POST['nonce'] ) ? sanitize\_text\_field($\_POST['nonce']) : ''; |
  | 1069 |  | ~~/\*~~if ( ! wp\_verify\_nonce( $nonce, 'alp-ajax-nonce' ) ) { |
  |  | 1069 | if ( ! wp\_verify\_nonce( $nonce, 'alp-ajax-nonce' ) ) { |
  | 1070 | 1070 | die(); |
  | 1071 |  | }\*/ |
  | 1072 |  | check\_ajax\_referer( 'wclp\_apply\_work\_hours\_nonce', 'security' ); |
  |  | 1071 | } |
  | 1073 | 1072 |  |
  | 1074 | 1073 | global $wpdb; |
* ## [advanced-local-pickup-for-woocommerce/trunk/include/wc-local-pickup-installation.php](/changeset/2986002/advanced-local-pickup-for-woocommerce/trunk/include/wc-local-pickup-installation.php?old=2889033&old_path=advanced-local-pickup-for-woocommerce%2Ftrunk%2Finclude%2Fwc-local-pickup-installation.php "Show the [2983681:2986002] differences restricted to advanced-local-pickup-for-woocommerce/trunk/include/wc-local-pickup-installation.php")

  | [r2983681](/browser/advanced-local-pickup-for-woocommerce/trunk/include/wc-local-pickup-installation.php?rev=2889033#L20 "Show revision 2983681 of this file in browser") | [r2986002](/browser/advanced-local-pickup-for-woocommerce/trunk/include/wc-local-pickup-installation.php?rev=2986002#L20 "Show revision 2986002 of this file in browser") |  |
  | --- | --- | --- |
  | 20 | 20 | \*/ |
  | 21 | 21 | private static $instance; |
  |  | 22 | public $table; |
  | 22 | 23 |  |
  | 23 | 24 | /\*\* |
* ## [advanced-local-pickup-for-woocommerce/trunk/readme.txt](/changeset/2986002/advanced-local-pickup-for-woocommerce/trunk/readme.txt?old=2983681&old_path=advanced-local-pickup-for-woocommerce%2Ftrunk%2Freadme.txt "Show the [2983681:2986002] differences restricted to advanced-local-pickup-for-woocommerce/trunk/readme.txt")

  | [r2983681](/browser/advanced-local-pickup-for-woocommerce/trunk/readme.txt?rev=2983681#L4 "Show revision 2983681 of this file in browser") | [r2986002](/browser/advanced-local-pickup-for-woocommerce/trunk/readme.txt?rev=2986002#L4 "Show revision 2986002 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Tags: woocommerce, local pickup, in store pickup, shipping, shipping options |
  | 5 | 5 | Requires at least: 5.0 |
  | 6 |  | Tested up to: 6.~~3~~ |
  |  | 6 | Tested up to: 6.4 |
  | 7 | 7 | Requires PHP: 7.0 |
  | 8 | 8 | Stable tag: 4.0.1 |
  | […](/browser/advanced-local-pickup-for-woocommerce/trunk/readme.txt?rev=2983681#L42) | […](/browser/advanced-local-pickup-for-woocommerce/trunk/readme.txt?rev=2986002#L42) |  |
  | 42 | 42 | \* Custom email notification templates |
  | 43 | 43 |  |
  | 44 |  | [Get the  Advanced Local Pickup PRO](https://www.zorem.com/product/advanced-local-pickup-~~pro~~/) |
  |  | 44 | [Get the  Advanced Local Pickup PRO](https://www.zorem.com/product/advanced-local-pickup-for-woocommerce/) |
  | 45 | 45 |  |
  | 46 | 46 | == Translations == |
  | […](/browser/advanced-local-pickup-for-woocommerce/trunk/readme.txt?rev=2983681#L71) | […](/browser/advanced-local-pickup-for-woocommerce/trunk/readme.txt?rev=2986002#L71) |  |
  | 71 | 71 |  |
  | 72 | 72 | == Changelog == |
  |  | 73 |  |
  |  | 74 | = 1.6.0 = |
  |  | 75 | \* Improved - Improve the settings design |
  |  | 76 | \* Dev - Tested with Wordpress 6.4 |
  |  | 77 | \* Dev - Tested with WooCommerce 8.2.1 |
  |  | 78 | \* Dev - Compatibility with PHP 8.2 |
  |  | 79 | \* Fix - PHP message: PHP Deprecated warning |
  |  | 80 | \* Fix - the database error on plugin activation |
  |  | 81 | \* Fix - the vulnerability issue of security |
  | 73 | 82 |  |
  | 74 | 83 | = 1.5.5 = |
* ## [advanced-local-pickup-for-woocommerce/trunk/woo-advanced-local-pickup.php](/changeset/2986002/advanced-local-pickup-for-woocommerce/trunk/woo-advanced-local-pickup.php?old=2948532&old_path=advanced-local-pickup-for-woocommerce%2Ftrunk%2Fwoo-advanced-local-pickup.php "Show the [2983681:2986002] differences restricted to advanced-local-pickup-for-woocommerce/trunk/woo-advanced-local-pickup.php")

  | [r2983681](/browser/advanced-local-pickup-for-woocommerce/trunk/woo-advanced-local-pickup.php?rev=2948532#L6 "Show revision 2983681 of this file in browser") | [r2986002](/browser/advanced-local-pickup-for-woocommerce/trunk/woo-advanced-local-pickup.php?rev=2986002#L6 "Show revision 2986002 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 | \* Author: zorem |
  | 7 | 7 | \* Author URI: https://www.zorem.com/ |
  | 8 |  | \* Version: 1.~~5.5~~ |
  |  | 8 | \* Version: 1.6.0 |
  | 9 | 9 | \* Text Domain: advanced-local-pickup-for-woocommerce |
  | 10 | 10 | \* Domain Path: /lang/ |
  | 11 | 11 | \* WC requires at least: 4.0 |
  | 12 |  | \* WC tested up to: ~~7.9.0~~ |
  |  | 12 | \* WC tested up to: 8.2.1 |
  | 13 | 13 | \*/ |
  | 14 | 14 |  |
  | […](/browser/advanced-local-pickup-for-woocommerce/trunk/woo-advanced-local-pickup.php?rev=2948532#L24) | […](/browser/advanced-local-pickup-for-woocommerce/trunk/woo-advanced-local-pickup.php?rev=2986002#L24) |  |
  | 24 | 24 | \* @var string |
  | 25 | 25 | \*/ |
  | 26 |  | public $version = '1.5.5'; |
  |  | 26 | public $version = '1.6.0'; |
  |  | 27 | public $admin; |
  |  | 28 | public $install; |
  |  | 29 | public $table; |
  |  | 30 | public $plugin\_path; |
  |  | 31 | public $customizer; |
  | 27 | 32 |  |
  | 28 | 33 | /\*\* |
  | […](/browser/advanced-local-pickup-for-woocommerce/trunk/woo-advanced-local-pickup.php?rev=2948532#L145) | […](/browser/advanced-local-pickup-for-woocommerce/trunk/woo-advanced-local-pickup.php?rev=2986002#L150) |  |
  | 145 | 150 |  |
  | 146 | 151 | //callback on activate plugin |
  | 147 |  | register\_activation\_hook( \_\_FILE\_\_, array( $this, 'table\_create' ) ); |
  |  | 152 | //register\_activation\_hook( \_\_FILE\_\_, array( $this, 'table\_create' ) ); |
  | 148 | 153 |  |
  | 149 | 154 | // Load plugin textdomain |
  | […](/browser/advanced-local-pickup-for-woocommerce/trunk/woo-advanced-local-pickup.php?rev=2948532#L651) | […](/browser/advanced-local-pickup-for-woocommerce/trunk/woo-advanced-local-pickup.php?rev=2986002#L656) |  |
  | 651 | 656 | } |
  | 652 | 657 | } ); |
  |  | 658 |  |
  |  | 659 | if ( ! function\_exists( 'zorem\_tracking' ) ) { |
  |  | 660 | function zorem\_tracking() { |
  |  | 661 | require\_once dirname(\_\_FILE\_\_) . '/zorem-tracking/zorem-tracking.php'; |
  |  | 662 | $plugin\_name = 'Advanced Local Pickup for WooCommerce'; |
  |  | 663 | $plugin\_slug = 'advanced-local-pickup-for-woocommerce'; |
  |  | 664 | $user\_id = '1'; |
  |  | 665 | $setting\_page\_type = 'submenu'; |
  |  | 666 | $setting\_page\_location =  "A submenu under other plugin's top level menu"; |
  |  | 667 | $parent\_menu\_type = 'A custom top-level admin menu (admin.php)'; |
  |  | 668 | $menu\_slug = 'local\_pickup'; |
  |  | 669 | $plugin\_id = '14'; |
  |  | 670 | $zorem\_tracking = WC\_Trackers::get\_instance( $plugin\_name, $plugin\_slug, $user\_id, $setting\_page\_type, $setting\_page\_location, $parent\_menu\_type, $menu\_slug, $plugin\_id ); |
  |  | 671 | return $zorem\_tracking; |
  |  | 672 | } |
  |  | 673 |  |
  |  | 674 | 'zorem\_tracking'(); |
  |  | 675 | } |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=2986002&old=2983681&new_path=%2Fadvanced-local-pickup-for-woocommerce%2Ftrunk&old_path=%2Fadvanced-local-pickup-for-woocommerce%2Ftrunk)
* [Zip Archive](?format=zip&new=2986002&old=2983681&new_path=%2Fadvanced-local-pickup-for-woocommerce%2Ftrunk&old_path=%2Fadvanced-local-pickup-for-woocommerce%2Ftrunk)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


