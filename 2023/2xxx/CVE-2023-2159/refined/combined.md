=== Content from www.wordfence.com_c9c3dc35_20250114_191746.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# CMP – Coming Soon & Maintenance <= 4.1.7 - Maintenance Mode Bypass

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   CMP – Coming Soon & Maintenance <= 4.1.7 - Maintenance Mode Bypass

5.3

**Improper Access Control**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N)

| CVE | [CVE-2023-2159](https://www.cve.org/CVERecord?id=CVE-2023-2159) |
| --- | --- |
| CVSS | 5.3 (Medium) |
| Publicly Published | April 18, 2023 |
| Last Updated | June 9, 2023 |
| Researcher | [Marco Wotschka - Wordfence](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/marco-wotschka) |

### Description

The CMP – Coming Soon & Maintenance plugin for WordPress is vulnerable to Maintenance Mode Bypass in versions up to, and including, 4.1.7. A correct cmp\_bypass GET parameter in the URL (equal to the md5-hashed home\_url in the default setting) allows users to visit a site placed in maintenance mode thus bypassing the plugin's provided feature.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/cmp-coming-soon-maintenance/tags/4.1.6/niteo-cmp.php#L808)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/2900571/cmp-coming-soon-maintenance/tags/4.1.8/cmp-advanced.php?old=2873620&old_path=cmp-coming-soon-maintenance%2Ftags%2F4.1.7%2Fcmp-advanced.php)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fcmp-coming-soon-maintenance%2Fcmp-coming-soon-maintenance-417-maintenance-mode-bypass&t=CMP%20%E2%80%93%20Coming%20Soon%20%26%20Maintenance%20%3C%3D%204.1.7%20-%20Maintenance%20Mode%20Bypass "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fcmp-coming-soon-maintenance%2Fcmp-coming-soon-maintenance-417-maintenance-mode-bypass&text=CMP%20%E2%80%93%20Coming%20Soon%20%26%20Maintenance%20%3C%3D%204.1.7%20-%20Maintenance%20Mode%20Bypass "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fcmp-coming-soon-maintenance%2Fcmp-coming-soon-maintenance-417-maintenance-mode-bypass "LinkedIn")
Email

## Vulnerability Details for CMP – Coming Soon & Maintenance Plugin by NiteoThemes

#### [CMP – Coming Soon & Maintenance Plugin by NiteoThemes](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/cmp-coming-soon-maintenance)

| Software Type | Plugin |
| --- | --- |
| Software Slug | cmp-coming-soon-maintenance [(view on wordpress.org)](https://wordpress.org/plugins/cmp-coming-soon-maintenance) |
| Patched? | Yes |
| Remediation | Update to version 4.1.8, or a newer patched version |
| Affected Version | * <= 4.1.7 |
| Patched Version | * 4.1.8 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_3a8b8116_20250114_191745.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F2900571%2Fcmp-coming-soon-maintenance%2Ftags%2F4.1.8%2Fcmp-advanced.php%3Fold%3D2873620%26old_path%3Dcmp-coming-soon-maintenance%252Ftags%252F4.1.7%252Fcmp-advanced.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Reverse Diff](/changeset/2873620/cmp-coming-soon-maintenance/tags/4.1.7/cmp-advanced.php?old=2900571&old_path=%2Fcmp-coming-soon-maintenance%2Ftags%2F4.1.8%2Fcmp-advanced.php)

---

# Changes from [cmp-coming-soon-maintenance/tags/4.1.7/cmp-advanced.php](/browser/cmp-coming-soon-maintenance/tags/4.1.7/cmp-advanced.php?rev=2873620 "Show entry in browser") at [r2873620](/changeset/2873620 "Show full changeset") to [cmp-coming-soon-maintenance/tags/4.1.8/cmp-advanced.php](/browser/cmp-coming-soon-maintenance/tags/4.1.8/cmp-advanced.php?rev=2900571 "Show entry in browser") at [r2900571](/changeset/2900571 "Show full changeset")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

File:

1 edited

* [cmp-coming-soon-maintenance/tags/4.1.8/cmp-advanced.php](/browser/cmp-coming-soon-maintenance/tags/4.1.8/cmp-advanced.php?rev=2900571 "Show entry in browser")
  (modified)
  ([13 diffs](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [cmp-coming-soon-maintenance/tags/4.1.8/cmp-advanced.php](/changeset/2900571/cmp-coming-soon-maintenance/tags/4.1.8/cmp-advanced.php?old=2873620&old_path=cmp-coming-soon-maintenance%2Ftags%2F4.1.7%2Fcmp-advanced.php "Show the [2873620:2900571] differences restricted to cmp-coming-soon-maintenance/tags/4.1.8/cmp-advanced.php")

  | [r2873620](/browser/cmp-coming-soon-maintenance/tags/4.1.7/cmp-advanced.php?rev=2873620#L1 "Show revision 2873620 of this file in browser") | [r2900571](/browser/cmp-coming-soon-maintenance/tags/4.1.8/cmp-advanced.php?rev=2900571#L1 "Show revision 2900571 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 |  | defined(~~'ABSPATH' ) or die( 'No script kiddies please!'~~ ); |
  |  | 2 | defined('ABSPATH') or die('No script kiddies please!'); |
  | 3 | 3 |  |
  | 4 | 4 | // check onces and wordpress rights, else DIE |
  | 5 |  | if (~~$\_SERVER['REQUEST\_METHOD'] == 'POST'~~ ) { |
  | 6 |  | if~~( !wp\_verify\_nonce($\_POST['save\_options\_field'], 'save\_options') || !current\_user\_can('publish\_pages')~~ ) { |
  |  | 5 | if ($\_SERVER['REQUEST\_METHOD'] == 'POST') { |
  |  | 6 | if (!wp\_verify\_nonce($\_POST['save\_options\_field'], 'save\_options') || !current\_user\_can('publish\_pages')) { |
  | 7 | 7 | die('Sorry, but this request is invalid'); |
  | 8 | 8 | } |
  | 9 | 9 | } |
  | 10 | 10 |  |
  | 11 |  | $ajax\_nonce = wp\_create\_nonce(~~'cmp-coming-soon-ajax-secret'~~ ); |
  |  | 11 | $ajax\_nonce = wp\_create\_nonce('cmp-coming-soon-ajax-secret'); |
  | 12 | 12 | $this->cmp\_purge\_cache(); |
  | 13 | 13 | // get all wp pages to array(id->name); |
  | 14 | 14 | $pages = $this->cmp\_get\_pages('publish'); |
  | 15 | 15 |  |
  | 16 |  | if (~~isset( $\_POST['niteoCS\_bypass\_id'] )~~ ) { |
  | 17 |  | if (~~$\_POST['niteoCS\_bypass\_id'] == ''~~ ) { |
  | 18 |  | update\_option('niteoCS\_bypass\_id', md5(~~get\_home\_url()~~ )); |
  |  | 16 | if (isset($\_POST['niteoCS\_bypass\_id'])) { |
  |  | 17 | if ($\_POST['niteoCS\_bypass\_id'] == '') { |
  |  | 18 | update\_option('niteoCS\_bypass\_id', md5(wp\_rand())); |
  | 19 | 19 | } else { |
  | 20 |  | update\_option('niteoCS\_bypass\_id', sanitize\_text\_field( $\_POST['niteoCS\_bypass\_id'] )); |
  | 21 |  | } |
  | 22 |  |  |
  | 23 |  | } |
  | 24 |  |  |
  | 25 |  | if ( isset( $\_POST['niteoCS\_bypass'] ) && is\_numeric($\_POST['niteoCS\_bypass']) ) { |
  | 26 |  | update\_option('niteoCS\_bypass', sanitize\_text\_field( $\_POST['niteoCS\_bypass'] )); |
  | 27 |  | } |
  | 28 |  |  |
  | 29 |  | if ( isset( $\_POST['niteoCS\_bypass\_expire'] ) ) { |
  | 30 |  | if ( $\_POST['niteoCS\_bypass\_expire'] == '' ) { |
  |  | 20 | update\_option('niteoCS\_bypass\_id', sanitize\_text\_field($\_POST['niteoCS\_bypass\_id'])); |
  |  | 21 | } |
  |  | 22 | } |
  |  | 23 |  |
  |  | 24 | if (isset($\_POST['niteoCS\_bypass']) && is\_numeric($\_POST['niteoCS\_bypass'])) { |
  |  | 25 | update\_option('niteoCS\_bypass', sanitize\_text\_field($\_POST['niteoCS\_bypass'])); |
  |  | 26 | } |
  |  | 27 |  |
  |  | 28 | if (isset($\_POST['niteoCS\_bypass\_expire'])) { |
  |  | 29 | if ($\_POST['niteoCS\_bypass\_expire'] == '') { |
  | 31 | 30 | update\_option('niteoCS\_bypass\_expire', 172800); |
  | 32 | 31 | } else { |
  | 33 |  | update\_option('niteoCS\_bypass\_expire', filter\_var(~~$\_POST['niteoCS\_bypass\_expire'], FILTER\_SANITIZE\_NUMBER\_INT~~ ) \* 86400); |
  | 34 |  | } |
  | 35 |  | } |
  | 36 |  |  |
  | 37 |  | if (~~isset( $\_POST['niteoCS\_page\_filter'] )~~ ) { |
  | 38 |  | update\_option('niteoCS\_page\_filter', sanitize\_text\_field(~~$\_POST['niteoCS\_page\_filter']~~ )); |
  |  | 32 | update\_option('niteoCS\_bypass\_expire', filter\_var($\_POST['niteoCS\_bypass\_expire'], FILTER\_SANITIZE\_NUMBER\_INT) \* 86400); |
  |  | 33 | } |
  |  | 34 | } |
  |  | 35 |  |
  |  | 36 | if (isset($\_POST['niteoCS\_page\_filter'])) { |
  |  | 37 | update\_option('niteoCS\_page\_filter', sanitize\_text\_field($\_POST['niteoCS\_page\_filter'])); |
  | 39 | 38 | } |
  | 40 | 39 |  |
  | 41 | 40 | // update page whitelist if set |
  | 42 |  | if (~~isset( $\_POST['niteoCS\_page-whitelist'] )~~ ) { |
  |  | 41 | if (isset($\_POST['niteoCS\_page-whitelist'])) { |
  | 43 | 42 |  |
  | 44 | 43 | $whitelist = $\_POST['niteoCS\_page-whitelist']; |
  | 45 | 44 | $sane = false; |
  | 46 | 45 |  |
  | 47 |  | foreach (~~$whitelist as $id~~ ) { |
  | 48 |  | if (~~!is\_numeric( $id )~~ ) { |
  |  | 46 | foreach ($whitelist as $id) { |
  |  | 47 | if (!is\_numeric($id)) { |
  | 49 | 48 | break; |
  | 50 | 49 | } else { |
  | […](/browser/cmp-coming-soon-maintenance/tags/4.1.7/cmp-advanced.php?rev=2873620#L53) | […](/browser/cmp-coming-soon-maintenance/tags/4.1.8/cmp-advanced.php?rev=2900571#L52) |  |
  | 53 | 52 | } |
  | 54 | 53 |  |
  | 55 |  | if ( $sane ) { |
  | 56 |  | $whitelist\_json = json\_encode( $whitelist ); |
  | 57 |  | } |
  | 58 |  |  |
  | 59 |  | update\_option('niteoCS\_page\_whitelist', sanitize\_text\_field( $whitelist\_json )); |
  | 60 |  |  |
  | 61 |  | } else if ( $\_SERVER['REQUEST\_METHOD'] == 'POST' ){ |
  |  | 54 | if ($sane) { |
  |  | 55 | $whitelist\_json = json\_encode($whitelist); |
  |  | 56 | } |
  |  | 57 |  |
  |  | 58 | update\_option('niteoCS\_page\_whitelist', sanitize\_text\_field($whitelist\_json)); |
  |  | 59 | } else if ($\_SERVER['REQUEST\_METHOD'] == 'POST') { |
  | 62 | 60 | update\_option('niteoCS\_page\_whitelist', '[]'); |
  | 63 | 61 | } |
  | 64 | 62 |  |
  | 65 |  | if (~~isset( $\_POST['niteoCS-whitelist-custom'] )~~ ) { |
  |  | 63 | if (isset($\_POST['niteoCS-whitelist-custom'])) { |
  | 66 | 64 | $url\_list = explode("\r\n", $\_POST['niteoCS-whitelist-custom']); |
  | 67 | 65 |  |
  | 68 |  | if (~~!empty( $url\_list) && $url\_list[0] !== ''~~ ) { |
  | 69 |  | foreach (~~$url\_list as $url~~ ) { |
  | 70 |  | if (~~!empty($url)~~ ) { |
  | 71 |  | $sanitized\_whitelist[] = esc\_attr(~~$url~~ ); |
  |  | 66 | if (!empty($url\_list) && $url\_list[0] !== '') { |
  |  | 67 | foreach ($url\_list as $url) { |
  |  | 68 | if (!empty($url)) { |
  |  | 69 | $sanitized\_whitelist[] = esc\_attr($url); |
  | 72 | 70 | } |
  | 73 | 71 | } |
  | 74 | 72 |  |
  | 75 |  | update\_option('niteoCS\_page\_whitelist\_custom', json\_encode( array\_filter($sanitized\_whitelist) )); |
  | 76 |  |  |
  |  | 73 | update\_option('niteoCS\_page\_whitelist\_custom', json\_encode(array\_filter($sanitized\_whitelist))); |
  | 77 | 74 | } else { |
  | 78 | 75 | update\_option('niteoCS\_page\_whitelist\_custom', '[]'); |
  | […](/browser/cmp-coming-soon-maintenance/tags/4.1.7/cmp-advanced.php?rev=2873620#L81) | […](/browser/cmp-coming-soon-maintenance/tags/4.1.8/cmp-advanced.php?rev=2900571#L78) |  |
  | 81 | 78 |  |
  | 82 | 79 | // update page blacklist if set |
  | 83 |  | if (~~isset( $\_POST['niteoCS\_page-blacklist'] )~~ ) { |
  |  | 80 | if (isset($\_POST['niteoCS\_page-blacklist'])) { |
  | 84 | 81 |  |
  | 85 | 82 | $blacklist = $\_POST['niteoCS\_page-blacklist']; |
  | 86 | 83 | $sane = false; |
  | 87 | 84 |  |
  | 88 |  | foreach (~~$blacklist as $id~~ ) { |
  | 89 |  | if (~~!is\_numeric( $id )~~ ) { |
  |  | 85 | foreach ($blacklist as $id) { |
  |  | 86 | if (!is\_numeric($id)) { |
  | 90 | 87 | break; |
  | 91 | 88 | } else { |
  | […](/browser/cmp-coming-soon-maintenance/tags/4.1.7/cmp-advanced.php?rev=2873620#L94) | […](/browser/cmp-coming-soon-maintenance/tags/4.1.8/cmp-advanced.php?rev=2900571#L91) |  |
  | 94 | 91 | } |
  | 95 | 92 |  |
  | 96 |  | if ( $sane ) { |
  | 97 |  | $blacklist\_json = json\_encode( $blacklist ); |
  | 98 |  | } |
  | 99 |  |  |
  | 100 |  | update\_option('niteoCS\_page\_blacklist', sanitize\_text\_field( $blacklist\_json )); |
  | 101 |  |  |
  | 102 |  | } else if ($\_SERVER['REQUEST\_METHOD'] == 'POST' ){ |
  |  | 93 | if ($sane) { |
  |  | 94 | $blacklist\_json = json\_encode($blacklist); |
  |  | 95 | } |
  |  | 96 |  |
  |  | 97 | update\_option('niteoCS\_page\_blacklist', sanitize\_text\_field($blacklist\_json)); |
  |  | 98 | } else if ($\_SERVER['REQUEST\_METHOD'] == 'POST') { |
  | 103 | 99 | update\_option('niteoCS\_page\_blacklist', '[]'); |
  | 104 | 100 | } |
  | 105 | 101 |  |
  | 106 |  | if (~~isset( $\_POST['niteoCS-blacklist-custom'] )~~ ) { |
  |  | 102 | if (isset($\_POST['niteoCS-blacklist-custom'])) { |
  | 107 | 103 | $url\_blacklist = explode("\r\n", $\_POST['niteoCS-blacklist-custom']); |
  | 108 | 104 |  |
  | 109 |  | if (~~!empty( $url\_blacklist) && $url\_blacklist[0] !== ''~~ ) { |
  | 110 |  | foreach (~~$url\_blacklist as $bl\_url~~ ) { |
  | 111 |  | if (~~!empty($bl\_url)~~ ) { |
  | 112 |  | $sanitized\_blacklist[] = esc\_attr(~~$bl\_url~~ ); |
  |  | 105 | if (!empty($url\_blacklist) && $url\_blacklist[0] !== '') { |
  |  | 106 | foreach ($url\_blacklist as $bl\_url) { |
  |  | 107 | if (!empty($bl\_url)) { |
  |  | 108 | $sanitized\_blacklist[] = esc\_attr($bl\_url); |
  | 113 | 109 | } |
  | 114 | 110 | } |
  | 115 | 111 |  |
  | 116 |  | update\_option('niteoCS\_page\_blacklist\_custom', json\_encode( array\_filter($sanitized\_blacklist) )); |
  | 117 |  |  |
  |  | 112 | update\_option('niteoCS\_page\_blacklist\_custom', json\_encode(array\_filter($sanitized\_blacklist))); |
  | 118 | 113 | } else { |
  | 119 | 114 | update\_option('niteoCS\_page\_blacklist\_custom', '[]'); |
  | […](/browser/cmp-coming-soon-maintenance/tags/4.1.7/cmp-advanced.php?rev=2873620#L123) | […](/browser/cmp-coming-soon-maintenance/tags/4.1.8/cmp-advanced.php?rev=2900571#L118) |  |
  | 123 | 118 |  |
  | 124 | 119 | // update cmp bypass roles if set |
  | 125 |  | if (~~isset( $\_POST['niteoCS\_roles'] )~~ ) { |
  |  | 120 | if (isset($\_POST['niteoCS\_roles'])) { |
  | 126 | 121 |  |
  | 127 | 122 | $roles = $\_POST['niteoCS\_roles']; |
  | 128 | 123 | $sane = false; |
  | 129 | 124 |  |
  | 130 |  | foreach (~~$roles as $id => $role~~ ) { |
  |  | 125 | foreach ($roles as $id => $role) { |
  | 131 | 126 | $roles[$id] = sanitize\_text\_field($role); |
  | 132 | 127 | } |
  | 133 | 128 |  |
  | 134 |  | update\_option('niteoCS\_roles', json\_encode( $roles )); |
  | 135 |  |  |
  | 136 |  | } else if ($\_SERVER['REQUEST\_METHOD'] == 'POST' ){ |
  |  | 129 | update\_option('niteoCS\_roles', json\_encode($roles)); |
  |  | 130 | } else if ($\_SERVER['REQUEST\_METHOD'] == 'POST') { |
  | 137 | 131 | update\_option('niteoCS\_roles', '[]'); |
  | 138 | 132 | } |
  | […](/browser/cmp-coming-soon-maintenance/tags/4.1.7/cmp-advanced.php?rev=2873620#L140) | […](/browser/cmp-coming-soon-maintenance/tags/4.1.8/cmp-advanced.php?rev=2900571#L134) |  |
  | 140 | 134 |  |
  | 141 | 135 | // update cmp roles topbar access |
  | 142 |  | if (~~isset( $\_POST['niteoCS\_roles\_topbar'] )~~ ) { |
  |  | 136 | if (isset($\_POST['niteoCS\_roles\_topbar'])) { |
  | 143 | 137 |  |
  | 144 | 138 | $roles = $\_POST['niteoCS\_roles\_topbar']; |
  | 145 | 139 | $sane = false; |
  | 146 | 140 |  |
  | 147 |  | foreach (~~$roles as $id => $role~~ ) { |
  |  | 141 | foreach ($roles as $id => $role) { |
  | 148 | 142 | $roles[$id] = sanitize\_text\_field($role); |
  | 149 | 143 | } |
  | 150 | 144 |  |
  | 151 |  | update\_option('niteoCS\_roles\_topbar', json\_encode( $roles )); |
  | 152 |  |  |
  | 153 |  | } else if ($\_SERVER['REQUEST\_METHOD'] == 'POST' ){ |
  |  | 145 | update\_option('niteoCS\_roles\_topbar', json\_encode($roles)); |
  |  | 146 | } else if ($\_SERVER['REQUEST\_METHOD'] == 'POST') { |
  | 154 | 147 | update\_option('niteoCS\_roles\_topbar', '[]'); |
  | 155 | 148 | } |
  | […](/browser/cmp-coming-soon-maintenance/tags/4.1.7/cmp-advanced.php?rev=2873620#L157) | […](/browser/cmp-coming-soon-maintenance/tags/4.1.8/cmp-advanced.php?rev=2900571#L150) |  |
  | 157 | 150 |  |
  | 158 | 151 | // update header scripts |
  | 159 |  | if (~~isset( $\_POST['niteoCS\_head\_scripts'] )~~ ) { |
  |  | 152 | if (isset($\_POST['niteoCS\_head\_scripts'])) { |
  | 160 | 153 |  |
  | 161 | 154 | $head\_scripts = $\_POST['niteoCS\_head\_scripts']; |
  | 162 | 155 | $sane = false; |
  | 163 | 156 |  |
  | 164 |  | foreach (~~$head\_scripts as $id => $head\_script~~ ) { |
  |  | 157 | foreach ($head\_scripts as $id => $head\_script) { |
  | 165 | 158 | $h\_scripts[$id] = sanitize\_text\_field($head\_script); |
  | 166 | 159 | } |
  | 167 | 160 |  |
  | 168 |  | update\_option('niteoCS\_head\_scripts', json\_encode( $h\_scripts )); |
  | 169 |  |  |
  | 170 |  | } else if ($\_SERVER['REQUEST\_METHOD'] == 'POST' ){ |
  |  | 161 | update\_option('niteoCS\_head\_scripts', json\_encode($h\_scripts)); |
  |  | 162 | } else if ($\_SERVER['REQUEST\_METHOD'] == 'POST') { |
  | 171 | 163 | update\_option('niteoCS\_head\_scripts', '[]'); |
  | 172 | 164 | } |
  | 173 | 165 |  |
  | 174 | 166 | // update cmp footer scripts |
  | 175 |  | if (~~isset( $\_POST['niteoCS\_footer\_scripts'] )~~ ) { |
  |  | 167 | if (isset($\_POST['niteoCS\_footer\_scripts'])) { |
  | 176 | 168 |  |
  | 177 | 169 | $footer\_scripts = $\_POST['niteoCS\_footer\_scripts']; |
  | 178 | 170 | $sane = false; |
  | 179 | 171 |  |
  | 180 |  | foreach ( $footer\_scripts as $id => $footer\_script ) { |
  | 181 |  | $f\_scripts[$id] = sanitize\_text\_field( $footer\_script ); |
  | 182 |  | } |
  | 183 |  |  |
  | 184 |  | update\_option('niteoCS\_footer\_scripts', json\_encode( $f\_scripts )); |
  | 185 |  |  |
  | 186 |  | } else if ($\_SERVER['REQUEST\_METHOD'] == 'POST' ){ |
  |  | 172 | foreach ($footer\_scripts as $id => $footer\_script) { |
  |  | 173 | $f\_scripts[$id] = sanitize\_text\_field($footer\_script); |
  |  | 174 | } |
  |  | 175 |  |
  |  | 176 | update\_option('niteoCS\_footer\_scripts', json\_encode($f\_scripts)); |
  |  | 177 | } else if ($\_SERVER['REQUEST\_METHOD'] == 'POST') { |
  | 187 | 178 | update\_option('niteoCS\_footer\_scripts', '[]'); |
  | 188 | 179 | } |
  | […](/browser/cmp-coming-soon-maintenance/tags/4.1.7/cmp-advanced.php?rev=2873620#L191) | […](/browser/cmp-coming-soon-maintenance/tags/4.1.8/cmp-advanced.php?rev=2900571#L182) |  |
  | 191 | 182 | // Notifications save |
  | 192 | 183 |  |
  | 193 |  | if (~~isset( $\_POST['niteoCS-mode-change-email-address'] )~~ ) { |
  | 194 |  | update\_option('niteoCS\_mode\_change\_email\_address', sanitize\_text\_field(~~$\_POST['niteoCS-mode-change-email-address']~~ )); |
  | 195 |  | } |
  | 196 |  | if (~~isset( $\_POST['niteoCS-countdown-email-address'] )~~ ) { |
  | 197 |  | update\_option('niteoCS\_countdown\_email\_address', sanitize\_text\_field(~~$\_POST['niteoCS-countdown-email-address']~~ )); |
  | 198 |  | } |
  | 199 |  | if (~~isset( $\_POST['niteoCS-subscribe-email-address'] )~~ ) { |
  | 200 |  | update\_option('niteoCS\_subscribe\_email\_address', sanitize\_text\_field(~~$\_POST['niteoCS-subscribe-email-address']~~ )); |
  | 201 |  | } |
  | 202 |  |  |
  | 203 |  | if (~~$\_SERVER['REQUEST\_METHOD'] == 'POST'~~ ) { |
  | 204 |  | if (~~isset($\_POST['niteoCS-countdown-notification'])~~ ) { |
  | 205 |  | update\_option('niteoCS\_countdown\_notification', $this->sanitize\_checkbox($\_POST['niteoCS-countdown-notification'])); |
  |  | 184 | if (isset($\_POST['niteoCS-mode-change-email-address'])) { |
  |  | 185 | update\_option('niteoCS\_mode\_change\_email\_address', sanitize\_text\_field($\_POST['niteoCS-mode-change-email-address'])); |
  |  | 186 | } |
  |  | 187 | if (isset($\_POST['niteoCS-countdown-email-address'])) { |
  |  | 188 | update\_option('niteoCS\_countdown\_email\_address', sanitize\_text\_field($\_POST['niteoCS-countdown-email-address'])); |
  |  | 189 | } |
  |  | 190 | if (isset($\_POST['niteoCS-subscribe-email-address'])) { |
  |  | 191 | update\_option('niteoCS\_subscribe\_email\_address', sanitize\_text\_field($\_POST['niteoCS-subscribe-email-address'])); |
  |  | 192 | } |
  |  | 193 |  |
  |  | 194 | if ($\_SERVER['REQUEST\_METHOD'] == 'POST') { |
  |  | 195 | if (isset($\_POST['niteoCS-countdown-notification'])) { |
  |  | 196 | update\_option('niteoCS\_countdown\_notification', $this->sanitize\_checkbox($\_POST['niteoCS-countdown-notification'])); |
  | 206 | 197 | } else { |
  | 207 | 198 | update\_option('niteoCS\_countdown\_notification', '0'); |
  | 208 | 199 | } |
  | 209 | 200 |  |
  | 210 |  | if (~~isset($\_POST['niteoCS-mode-change-notification'])~~ ) { |
  | 211 |  | update\_option('niteoCS\_mode\_change\_notification', $this->sanitize\_checkbox($\_POST['niteoCS-mode-change-notification'])); |
  |  | 201 | if (isset($\_POST['niteoCS-mode-change-notification'])) { |
  |  | 202 | update\_option('niteoCS\_mode\_change\_notification', $this->sanitize\_checkbox($\_POST['niteoCS-mode-change-notification'])); |
  | 212 | 203 | } else { |
  | 213 | 204 | update\_option('niteoCS\_mode\_change\_notification', '0'); |
  | 214 | 205 | } |
  | 215 |  | if (~~isset($\_POST['niteoCS-subscribe-notification'])~~ ) { |
  | 216 |  | update\_option('niteoCS\_subscribe\_notification', $this->sanitize\_checkbox($\_POST['niteoCS-subscribe-notification'])); |
  |  | 206 | if (isset($\_POST['niteoCS-subscribe-notification'])) { |
  |  | 207 | update\_option('niteoCS\_subscribe\_notification', $this->sanitize\_checkbox($\_POST['niteoCS-subscribe-notification'])); |
  | 217 | 208 | } else { |
  | 218 | 209 | update\_option('niteoCS\_subscribe\_notification', '0'); |
  | 219 | 210 | } |
  | 220 | 211 |  |
  | 221 |  | if (~~isset($\_POST['niteoCS-rss-status'])~~ ) { |
  | 222 |  | update\_option('niteoCS\_rss\_status', $this->sanitize\_checkbox($\_POST['niteoCS-rss-status'])); |
  |  | 212 | if (isset($\_POST['niteoCS-rss-status'])) { |
  |  | 213 | update\_option('niteoCS\_rss\_status', $this->sanitize\_checkbox($\_POST['niteoCS-rss-status'])); |
  | 223 | 214 | } else { |
  | 224 | 215 | update\_option('niteoCS\_rss\_status', '0'); |
  | 225 | 216 | } |
  | 226 | 217 |  |
  | 227 |  | if (~~isset($\_POST['niteoCS-restapi-status'])~~ ) { |
  | 228 |  | update\_option('niteoCS\_rest\_api\_status', $this->sanitize\_checkbox($\_POST['niteoCS-restapi-status'])); |
  |  | 218 | if (isset($\_POST['niteoCS-restapi-status'])) { |
  |  | 219 | update\_option('niteoCS\_rest\_api\_status', $this->sanitize\_checkbox($\_POST['niteoCS-restapi-status'])); |
  | 229 | 220 | } else { |
  | 230 | 221 | update\_option('niteoCS\_rest\_api\_status', '0'); |
  | 231 | 222 | } |
  | 232 | 223 |  |
  | 233 |  | if (~~isset($\_POST['niteoCS-fa-local'])~~ ) { |
  | 234 |  | update\_option('niteoCS\_fa\_local', $this->sanitize\_checkbox($\_POST['niteoCS-fa-local'])); |
  |  | 224 | if (isset($\_POST['niteoCS-fa-local'])) { |
  |  | 225 | update\_option('niteoCS\_fa\_local', $this->sanitize\_checkbox($\_POST['niteoCS-fa-local'])); |
  | 235 | 226 | } else { |
  | 236 | 227 | update\_option('niteoCS\_fa\_local', '0'); |
  | […](/browser/cmp-coming-soon-maintenance/tags/4.1.7/cmp-advanced.php?rev=2873620#L238) | […](/browser/cmp-coming-soon-maintenance/tags/4.1.8/cmp-advanced.php?rev=2900571#L229) |  |
  | 238 | 229 | } |
  | 239 | 230 |  |
  | 240 |  | if (~~isset( $\_POST['niteoCS\_custom\_login\_url'] )~~ ) { |
  | 241 |  | update\_option('niteoCS\_custom\_login\_url', sanitize\_text\_field(~~$\_POST['niteoCS\_custom\_login\_url']~~ )); |
  | 242 |  | } |
  | 243 |  |  |
  | 244 |  | if (~~isset( $\_POST['niteoCS\_wpautop'] ) && is\_numeric($\_POST['niteoCS\_wpautop'])~~ ) { |
  | 245 |  | update\_option('niteoCS\_wpautop', sanitize\_text\_field(~~$\_POST['niteoCS\_wpautop']~~ )); |
  | 246 |  | } |
  | 247 |  |  |
  | 248 |  | if (~~isset( $\_POST['cmp\_cookie\_notice\_comp'] ) && is\_numeric($\_POST['cmp\_cookie\_notice\_comp'])~~ ) { |
  | 249 |  | update\_option('cmp\_cookie\_notice\_comp', sanitize\_text\_field(~~$\_POST['cmp\_cookie\_notice\_comp']~~ )); |
  |  | 231 | if (isset($\_POST['niteoCS\_custom\_login\_url'])) { |
  |  | 232 | update\_option('niteoCS\_custom\_login\_url', sanitize\_text\_field($\_POST['niteoCS\_custom\_login\_url'])); |
  |  | 233 | } |
  |  | 234 |  |
  |  | 235 | if (isset($\_POST['niteoCS\_wpautop']) && is\_numeric($\_POST['niteoCS\_wpautop'])) { |
  |  | 236 | update\_option('niteoCS\_wpautop', sanitize\_text\_field($\_POST['niteoCS\_wpautop'])); |
  |  | 237 | } |
  |  | 238 |  |
  |  | 239 | if (isset($\_POST['cmp\_cookie\_notice\_comp']) && is\_numeric($\_POST['cmp\_cookie\_notice\_comp'])) { |
  |  | 240 | update\_option('cmp\_cookie\_notice\_comp', sanitize\_text\_field($\_POST['cmp\_cookie\_notice\_comp'])); |
  | 250 | 241 | } |
  | 251 | 242 |  |
  | […](/browser/cmp-coming-soon-maintenance/tags/4.1.7/cmp-advanced.php?rev=2873620#L257) | […](/browser/cmp-coming-soon-maintenance/tags/4.1.8/cmp-advanced.php?rev=2900571#L248) |  |
  | 257 | 248 | $niteoCS\_page\_blacklist         = json\_decode(get\_option('niteoCS\_page\_blacklist', '[]'), true); |
  | 258 | 249 | $niteoCS\_page\_blacklist\_custom  = json\_decode(get\_option('niteoCS\_page\_blacklist\_custom', '[]'), true); |
  | 259 |  | $custom\_login\_url               = get\_option('niteoCS\_custom\_login\_url', get\_option(~~'whl\_page'~~ )); |
  |  | 250 | $custom\_login\_url               = get\_option('niteoCS\_custom\_login\_url', get\_option('whl\_page')); |
  | 260 | 251 | $niteoCS\_roles                  = json\_decode(get\_option('niteoCS\_roles', '[]'), true); |
  | 261 | 252 | $niteoCS\_roles\_topbar           = json\_decode(get\_option('niteoCS\_roles\_topbar', '[]'), true); |
  | […](/browser/cmp-coming-soon-maintenance/tags/4.1.7/cmp-advanced.php?rev=2873620#L263) | […](/browser/cmp-coming-soon-maintenance/tags/4.1.8/cmp-advanced.php?rev=2900571#L254) |  |
  | 263 | 254 | $footer\_scripts                 = json\_decode(get\_option('niteoCS\_footer\_scripts', '[]'), true); |
  | 264 | 255 | $bypass                         = get\_option('niteoCS\_bypass', '0'); |
  | 265 |  | $bypass\_id                      = get\_option('niteoCS\_bypass\_id', md5(~~get\_home\_url()~~ )); |
  |  | 256 | $bypass\_id                      = get\_option('niteoCS\_bypass\_id', md5(wp\_rand())); |
  | 266 | 257 | $bypass\_expire                  = get\_option('niteoCS\_bypass\_expire', 172800) / 86400; |
  | 267 | 258 | $topbar\_icon                    = get\_option('niteoCS\_topbar\_icon', '1'); |
  | […](/browser/cmp-coming-soon-maintenance/tags/4.1.7/cmp-advanced.php?rev=2873620#L272) | […](/browser/cmp-coming-soon-maintenance/tags/4.1.8/cmp-advanced.php?rev=2900571#L263) |  |
  | 272 | 263 | $cmp\_mode\_change\_notif          = get\_option('niteoCS\_mode\_change\_notification', '0'); |
  | 273 | 264 | $cmp\_subscribe\_notif            = get\_option('niteoCS\_subscribe\_notification', '0'); |
  | 274 |  | $countdown\_email                = get\_option('niteoCS\_countdown\_email\_address', get\_option(~~'admin\_email'~~ )); |
  | 275 |  | $mode\_change\_email              = get\_option('niteoCS\_mode\_change\_email\_address', get\_option(~~'admin\_email'~~ )); |
  | 276 |  | $subscribe\_email                = get\_option('niteoCS\_subscribe\_email\_address', get\_option(~~'admin\_email'~~ )); |
  |  | 265 | $countdown\_email                = get\_option('niteoCS\_countdown\_email\_address', get\_option('admin\_email')); |
  |  | 266 | $mode\_change\_email              = get\_option('niteoCS\_mode\_change\_email\_address', get\_option('admin\_email')); |
  |  | 267 | $subscribe\_email                = get\_option('niteoCS\_subscribe\_email\_address', get\_option('admin\_email')); |
  | 277 | 268 | $cmp\_cookie\_notice\_comp         = get\_option('cmp\_cookie\_notice\_comp', '1'); |
  | 278 | 269 | $cmp\_rss                        = get\_option('niteoCS\_rss\_status', '1'); |
  | […](/browser/cmp-coming-soon-maintenance/tags/4.1.7/cmp-advanced.php?rev=2873620#L288) | […](/browser/cmp-coming-soon-maintenance/tags/4.1.8/cmp-advanced.php?rev=2900571#L279) |  |
  | 288 | 279 | <div id="icon-users" class="icon32"></div> |
  | 289 | 280 | <div class="settings-wrap"> |
  | 290 |  | <form method="post" action="admin.php?page=cmp-advanced&status=settings-saved" id="csoptions"> |
  | 291 |  | <?php wp\_nonce\_field('save\_options','save\_options\_field'); ?> |
  | 292 |  |  |
  | 293 |  | <h2 class="nav-tab-wrapper"> |
  | 294 |  | <a class="nav-tab nav-tab-active" href="<?php echo admin\_url(); ?>admin.php?page=cmp-advanced#cmp-whitelist-blacklist" data-tab="cmp-whitelist-blacklist"><i class="fas fa-lock"></i><?php \_e('Whitelist/Blacklist', 'cmp-coming-soon-maintenance');?></a> |
  | 295 |  |  |
  | 296 |  | <a class="nav-tab" href="<?php echo admin\_url(); ?>admin.php?page=cmp-advanced#cmp-bypass" data-tab="cmp-bypass"><i class="fas fa-user-lock"></i><?php \_e('Bypass', 'cmp-coming-soon-maintenance');?></a> |
  | 297 |  |  |
  | 298 |  | <a class="nav-tab" href="<?php echo admin\_url(); ?>admin.php?page=cmp-advanced#cmp-notifications" data-tab="cmp-notifications"><i class="far fa-envelope"></i><?php \_e('Notifications', 'cmp-coming-soon-maintenance');?></a> |
  | 299 |  |  |
  | 300 |  | <a class="nav-tab" href="<?php echo admin\_url(); ?>admin.php?page=cmp-advanced#cmp-misc" data-tab="cmp-misc"><i class="fas fa-wrench"></i><?php \_e('Misc', 'cmp-coming-soon-maintenance');?></a> |
  | 301 |  |  |
  | 302 |  | <a class="nav-tab" href="<?php echo admin\_url(); ?>admin.php?page=cmp-advanced#cmp-export-import" data-tab="cmp-export-import"><i class="fas fa-download"></i><?php \_e('Import/Export', 'cmp-coming-soon-maintenance');?></a> |
  | 303 |  |  |
  | 304 |  | </h2> |
  | 305 |  |  |
  | 306 |  | <div class="cmp-advanced" style="margin-top:6px"> |
  | 307 |  |  |
  | 308 |  | <div class="cmp-inputs-wrapper"> |
  | 309 |  |  |
  | 310 |  | <div class="table-wrapper cmp-whitelist-blacklist"> |
  | 311 |  |  |
  | 312 |  | <h3 class="no-icon"><?php \_e('CMP Page Whitelist and Blacklist Settings', 'cmp-coming-soon-maintenance');?></h3> |
  | 313 |  | <table> |
  | 314 |  | <tbody> |
  | 315 |  | <tr> |
  | 316 |  |  |
  | 317 |  | <th> |
  | 318 |  | <fieldset> |
  | 319 |  | <legend class="screen-reader-text"> |
  | 320 |  | <span><?php \_e('Whitelist Settings', 'cmp-coming-soon-maintenance');?></span> |
  | 321 |  | </legend> |
  | 322 |  |  |
  | 323 |  | <p> |
  | 324 |  | <label title="Page Whitelist"> |
  | 325 |  | <input type="radio" class="page-whitelist" name="niteoCS\_page\_filter" value="1" <?php checked('1', $niteoCS\_page\_filter);?>><?php \_e('Page Whitelist', 'cmp-coming-soon-maintenance');?> |
  | 326 |  | </label> |
  | 327 |  | </p> |
  | 328 |  |  |
  | 329 |  | <p> |
  | 330 |  | <label title="Page Blacklist"> |
  | 331 |  | <input type="radio" class="page-whitelist" name="niteoCS\_page\_filter" value="2" <?php checked('2', $niteoCS\_page\_filter);?>><?php \_e('Page Blacklist', 'cmp-coming-soon-maintenance');?> |
  | 332 |  | </label> |
  | 333 |  | </p> |
  | 334 |  |  |
  | 335 |  | <p> |
  | 336 |  | <label title="Disabled"> |
  | 337 |  | <input type="radio" class="page-whitelist" name="niteoCS\_page\_filter" value="0" <?php checked('0', $niteoCS\_page\_filter);?>><?php \_e('Disabled', 'cmp-coming-soon-maintenance');?> |
  | 338 |  | </label> |
  | 339 |  | </p> |
  | 340 |  |  |
  | 341 |  | </fieldset> |
  | 342 |  | </th> |
  | 343 |  |  |
  | 344 |  | <td> |
  | 345 |  | <fieldset class="page-whitelist-switch x1"> |
  | 346 |  | <h4><?php \_e('CMP Whitelist - set CMP landing page to specific page(s) only', 'cmp-coming-soon-maintenance');?></h4> |
  | 347 |  | <select name="niteoCS\_page-whitelist[]" class="cmp-whitelist-select" multiple="multiple"> |
  | 348 |  | <option value="-1" <?php echo in\_array('-1', $niteoCS\_page\_whitelist) ? 'selected' : '';?>><?php \_e('Homepage', 'cmp-coming-soon-maintenance');?></option> |
  | 349 |  | <?php |
  | 350 |  | foreach ( $pages as $page ) { ?> |
  | 351 |  | <option value="<?php echo esc\_attr( $page['id'] );?>" <?php echo in\_array($page['id'], $niteoCS\_page\_whitelist) ? 'selected' : ''; ?>><?php echo esc\_attr( $page['name'] );?></option> |
  | 352 |  | <?php |
  | 353 |  | } ?> |
  | 354 |  | </select> |
  | 355 |  |  |
  | 356 |  | <p class="cmp-hint" style="margin-top:0"><?php \_e('By default CMP is enabled on all pages. Leave this field empty to use default settings.', 'cmp-coming-soon-maintenance');?></p> |
  | 357 |  |  |
  | 358 |  | <h4><?php \_e('You can also add the page URLs manually.', 'cmp-coming-soon-maintenance');?></h4> |
  | 359 |  | <textarea name="niteoCS-whitelist-custom" cols="40" rows="5"><?php |
  | 360 |  | if ( !empty($niteoCS\_page\_whitelist\_custom) ) { |
  | 361 |  | foreach ($niteoCS\_page\_whitelist\_custom as $wl\_url) { |
  | 362 |  | echo esc\_attr($wl\_url) . PHP\_EOL; |
  | 363 |  | } |
  | 364 |  | } ?></textarea> |
  | 365 |  | </fieldset> |
  | 366 |  |  |
  | 367 |  | <fieldset class="page-whitelist-switch x2"> |
  | 368 |  | <h4><?php \_e('CMP Blacklist - select the pages to NOT display CMP landing page', 'cmp-coming-soon-maintenance');?></h4> |
  | 369 |  | <select name="niteoCS\_page-blacklist[]" class="cmp-blacklist" multiple="multiple"> |
  | 370 |  | <option value="-1" <?php echo in\_array('-1', $niteoCS\_page\_blacklist) ? 'selected' : '';?>><?php \_e('Homepage', 'cmp-coming-soon-maintenance');?></option> |
  | 371 |  | <?php |
  | 372 |  | foreach ( $pages as $page ) { ?> |
  | 373 |  | <option value="<?php echo esc\_attr( $page['id'] );?>" <?php echo in\_array($page['id'], $niteoCS\_page\_blacklist) ? 'selected' : '';?>><?php echo esc\_attr( $page['name'] );?></option> |
  | 374 |  | <?php |
  | 375 |  | } ?> |
  | 376 |  | </select> |
  | 377 |  |  |
  | 378 |  | <p class="cmp-hint" style="margin-top:0"><?php \_e('If you want to exclude some pages from CMP you can select them here.', 'cmp-coming-soon-maintenance');?></p> |
  | 379 |  |  |
  | 380 |  | <h4><?php \_e('You can also add the page URLs manually.', 'cmp-coming-soon-maintenance');?></h4> |
  | 381 |  | <textarea name="niteoCS-blacklist-custom" cols="40" rows="5"><?php |
  | 382 |  | if ( !empty( $niteoCS\_page\_blacklist\_custom ) ) { |
  | 383 |  | foreach ( $niteoCS\_page\_blacklist\_custom as $bl\_url ) { |
  | 384 |  | echo esc\_attr($bl\_url) . PHP\_EOL; |
  | 385 |  | } |
  | 386 |  | } ?></textarea> |
  | 387 |  | </fieldset> |
  | 388 |  |  |
  | 389 |  | <p class="cmp-hint page-whitelist-switch x1 x2" style="margin-top:0"><?php \_e('Insert URL with http(s) separately at each line. Please make sure your Permalinks work correctly!<br> You can also use asterisk (\*) as a wildcard to match any part of the URL.', 'cmp-coming-soon-maintenance');?></p> |
  | 390 |  |  |
  | 391 |  | <p class="page-whitelist-switch x0"><?php \_e('CMP landing page is displayed on all pages by default. You can enable Page Whitelist to display CMP only on specific page(s) or Page Blacklist to exclude CMP landing page on specific page(s) by enabling Page Whitelist or Page Blacklist here.', 'cmp-coming-soon-maintenance');?></p> |
  | 392 |  |  |
  | 393 |  | </td> |
  | 394 |  | </tr> |
  | 395 |  |  |
  | 396 |  | <?php echo $this->render\_settings->submit(); ?> |
  | 397 |  |  |
  | 398 |  | </tbody> |
  | 399 |  | </table> |
  | 400 |  |  |
  | 401 |  | </div> |
  | 402 |  |  |
  | 403 |  | <div class="table-wrapper cmp-whitelist-blacklist"> |
  | 404 |  |  |
  | 405 |  | <h3 class="no-icon"><?php \_e('Custom Login URL', 'cmp-coming-soon-maintenance');?></h3> |
  | 406 |  | <table> |
  | 407 |  | <tbody> |
  | 408 |  | <tr> |
  | 409 |  |  |
  | 410 |  | <th><?php \_e('Login URL', 'cmp-coming-soon-maintenance');?></th> |
  | 411 |  |  |
  | 412 |  | <td> |
  | 413 |  | <fieldset> |
  | 414 |  | <h4><?php \_e('Login URL', 'cmp-coming-soon-maintenance');?></h4> |
  | 415 |  | <input type="text" name="niteoCS\_custom\_login\_url" value="<?php echo esc\_html( $custom\_login\_url ); ?>" class="regular-text"><br> |
  | 416 |  |  |
  | 417 |  | <p class="cmp-hint" style="margin-top:0"><?php \_e('Insert custom login URL if you are using plugins to change default WordPress login URL.', 'cmp-coming-soon-maintenance');?></p> |
  | 418 |  |  |
  | 419 |  |  |
  | 420 |  | </fieldset> |
  | 421 |  |  |
  | 422 |  | </td> |
  | 423 |  | </tr> |
  | 424 |  |  |
  | 425 |  | <?php echo $this->render\_settings->submit(); ?> |
  | 426 |  |  |
  | 427 |  | </tbody> |
  | 428 |  | </table> |
  | 429 |  |  |
  | 430 |  | </div> |
  | 431 |  |  |
  | 432 |  | <!-- BYPASS --> |
  | 433 |  |  |
  | 434 |  | <div class="table-wrapper general cmp-bypass"> |
  | 435 |  |  |
  | 436 |  | <h3 class="no-icon"><?php \_e('CMP Bypass by User Roles', 'cmp-coming-soon-maintenance');?></h3> |
  | 437 |  | <table class="general"> |
  | 438 |  | <tbody> |
  | 439 |  | <tr> |
  | 440 |  | <th><?php \_e('Bypass User Roles', 'cmp-coming-soon-maintenance');?></th> |
  | 441 |  |  |
  | 442 |  | <td> |
  | 443 |  | <fieldset> |
  | 444 |  | <h4><?php \_e('Select User Roles to bypass CMP landing page', 'cmp-coming-soon-maintenance');?></h4> |
  | 445 |  |  |
  | 446 |  | <select name="niteoCS\_roles[]" class="cmp-user\_roles" multiple="multiple"> |
  | 447 |  |  |
  | 448 |  | <?php |
  | 449 |  | $roles = get\_editable\_roles(); |
  | 450 |  |  |
  | 451 |  | foreach ( $roles as $role => $details ) { |
  | 452 |  |  |
  | 453 |  | if ( $role != 'administrator') { ?> |
  | 454 |  | <option value="<?php echo esc\_attr($role);?>" <?php echo in\_array($role, $niteoCS\_roles) ? 'selected' : '';?>><?php echo esc\_attr($details['name']);?></option> |
  | 455 |  | <?php |
  | 456 |  | } |
  | 457 |  | } ?> |
  | 458 |  |  |
  | 459 |  | </select> |
  | 460 |  |  |
  | 461 |  | <p class="cmp-hint" style="margin-top:0"><?php \_e('Administrator role always bypass CMP by default.', 'cmp-coming-soon-maintenance');?></p> |
  | 462 |  |  |
  | 463 |  | </fieldset> |
  | 464 |  |  |
  | 465 |  | </td> |
  | 466 |  | </tr> |
  | 467 |  |  |
  | 468 |  | <?php echo $this->render\_settings->submit(); ?> |
  | 469 |  |  |
  | 470 |  | </tbody> |
  | 471 |  | </table> |
  | 472 |  |  |
  | 473 |  | </div> |
  | 474 |  |  |
  | 475 |  | <div class="table-wrapper general cmp-bypass"> |
  | 476 |  | <h3 class="no-icon"><?php \_e('CMP Bypass URL', 'cmp-coming-soon-maintenance');?></h3> |
  | 477 |  | <table class="general"> |
  | 478 |  | <tbody> |
  | 479 |  | <tr> |
  | 480 |  |  |
  | 481 |  | <th> |
  | 482 |  | <fieldset> |
  | 483 |  | <legend class="screen-reader-text"> |
  | 484 |  | <span><?php \_e('Whitelist Settings', 'cmp-coming-soon-maintenance');?></span> |
  | 485 |  | </legend> |
  | 486 |  |  |
  | 487 |  | <p> |
  | 488 |  | <label title="Page Whitelist"> |
  | 489 |  | <input type="radio" class="cmp-bypass" name="niteoCS\_bypass" value="1" <?php checked('1', $bypass);?>><?php \_e('Enabled', 'cmp-coming-soon-maintenance');?> |
  | 490 |  | </label> |
  | 491 |  | </p> |
  | 492 |  |  |
  | 493 |  | <p> |
  | 494 |  | <label title="Disabled"> |
  | 495 |  | <input type="radio" class="cmp-bypass" name="niteoCS\_bypass" value="0" <?php checked('0', $bypass);?>><?php \_e('Disabled', 'cmp-coming-soon-maintenance');?> |
  | 496 |  | </label> |
  | 497 |  | </p> |
  | 498 |  |  |
  | 499 |  | </fieldset> |
  | 500 |  | </th> |
  | 501 |  |  |
  | 502 |  | <td> |
  | 503 |  |  |
  | 504 |  | <fieldset class="cmp-bypass-switch x1"> |
  | 505 |  |  |
  | 506 |  | <h4 style="margin-bottom:0.5em"><?php \_e('Bypass URL', 'cmp-coming-soon-maintenance');?></h4> |
  | 507 |  | <code id="bypass-code"><?php echo get\_home\_url().'/?cmp\_bypass=' . $bypass\_id;?></code><br><br> |
  | 508 |  | <a href="<?php echo admin\_url(); ?>admin.php?page=cmp-advanced#cmp-bypass" class="button" id="copy-bypass">Copy to clipboard</a> |
  | 509 |  |  |
  | 510 |  | <p><?php \_e('You can use this URL to bypass CMP maintenance page. Once you access your website with this URL, CMP Cookie will be set with default expiration of 2 days. If the cookie expires, you need to access your website again with this URL.', 'cmp-coming-soon-maintenance');?></p> |
  | 511 |  |  |
  | 512 |  | <h4><?php \_e('Set Bypass Passphrase', 'cmp-coming-soon-maintenance');?></h4> |
  | 513 |  | <input type="text" name="niteoCS\_bypass\_id" value="<?php echo esc\_attr( $bypass\_id ); ?>" class="regular-text code"><br> |
  | 514 |  |  |
  | 515 |  | <p class="cmp-hint" style="margin-top:0"><?php \_e('You can use passphrase which contains letters, numbers, underscores or dashes only.', 'cmp-coming-soon-maintenance');?></p> |
  | 516 |  |  |
  | 517 |  | <h4><?php \_e('Set bypass cookie Expiration Time in days', 'cmp-coming-soon-maintenance');?></h4> |
  | 518 |  | <input type="text" name="niteoCS\_bypass\_expire" value="<?php echo esc\_attr( $bypass\_expire ); ?>" class="regular-text code"><br> |
  | 519 |  |  |
  | 520 |  | <p class="cmp-hint" style="margin-top:0"><?php \_e('You can set custom Bypass CMP Cookie expiration time in days. Default expiration time is 2 days.', 'cmp-coming-soon-maintenance');?></p> |
  | 521 |  |  |
  | 522 |  | <p><?php \_e('Please note this solution is using browser cookies which might not work correctly if you are using caching plugins.', 'cmp-coming-soon-maintenance');?></p> |
  | 523 |  |  |
  | 524 |  | </fieldset> |
  | 525 |  |  |
  | 526 |  | <p class="cmp-bypass-switch x0"><?php \_e('You can Enable CMP Bypass where you can set custom URL parameter to bypass CMP page. You can send this URL to anyone who would like to sneak peak into your Website while it is under development or maintanence.', 'cmp-coming-soon-maintenance');?></p> |
  | 527 |  |  |
  | 528 |  | </td> |
  | 529 |  | </tr> |
  | 530 |  |  |
  | 531 |  | <?php echo $this->render\_settings->submit(); ?> |
  | 532 |  |  |
  | 533 |  | </tbody> |
  | 534 |  | </table> |
  | 535 |  |  |
  | 536 |  | </div> |
  | 537 |  | <div class="table-wrapper general cmp-bypass"> |
  | 538 |  | <h3 class="no-icon"><?php \_e('RSS & REST API', 'cmp-coming-soon-maintenance');?></h3> |
  | 539 |  | <table class="general"> |
  | 540 |  | <tbody> |
  | 541 |  | <tr> |
  | 542 |  | <th><?php \_e('RSS', 'cmp-coming-soon-maintenance');?></th> |
  | 543 |  | <td> |
  | 544 |  | <fieldset> |
  | 545 |  | <label for="cmp-rss-status"> |
  | 546 |  | <input type="checkbox" name="niteoCS-rss-status" id="cmp-rss-status" value="1" <?php checked('1', $cmp\_rss);?>><?php \_e('Allow RSS', 'cmp-coming-soon-maintenance');?> |
  | 547 |  | </label> |
  | 548 |  | </fieldset> |
  | 549 |  | </td> |
  | 550 |  | </tr> |
  | 551 |  | <tr> |
  | 552 |  | <th><?php \_e('REST API', 'cmp-coming-soon-maintenance');?></th> |
  | 553 |  | <td> |
  | 554 |  | <fieldset> |
  | 555 |  | <label for="cmp-restapi-status"> |
  | 556 |  | <input type="checkbox" name="niteoCS-restapi-status" id="cmp-restapi-status" value="1" <?php checked('1', $cmp\_rest\_api);?>><?php \_e('Allow REST API', 'cmp-coming-soon-maintenance');?> |
  | 557 |  | </label> |
  | 558 |  | </fieldset> |
  | 559 |  | </td> |
  | 560 |  | </tr> |
  | 561 |  |  |
  | 562 |  | <?php echo $this->render\_settings->submit(); ?> |
  | 563 |  |  |
  | 564 |  | </tbody> |
  | 565 |  | </table> |
  | 566 |  |  |
  | 567 |  | </div> |
  | 568 |  |  |
  | 569 |  | <!-- NOTIFICATIONS --> |
  | 570 |  |  |
  | 571 |  | <div class="table-wrapper cmp-notifications"> |
  | 572 |  | <h3 class="no-icon"><?php \_e('Email Notifications', 'cmp-coming-soon-maintenance');?></h3> |
  | 573 |  | <table class="general"> |
  | 574 |  | <tbody> |
  | 575 |  | <tr> |
  | 576 |  | <th><?php \_e('Timer Expiration', 'cmp-coming-soon-maintenance');?></th> |
  | 577 |  |  |
  | 578 |  | <td> |
  | 579 |  | <fieldset> |
  | 580 |  |  |
  | 581 |  | <label for="cmp-countdown-notification"> |
  | 582 |  | <input type="checkbox" class="countdown-toggle" name="niteoCS-countdown-notification" id="cmp-countdown-notification" value="1" <?php checked('1', $cmp\_countdown\_notif);?>><?php \_e('Enable Email notification when Countdown timer expires to 0.', 'cmp-coming-soon-maintenance');?> |
  | 583 |  | </label> |
  | 584 |  |  |
  | 585 |  |  |
  | 586 |  | <div class="countdown-toggle-switch x1" style="margin-top:1em"> |
  | 587 |  | <h4><?php \_e('Specify Email Address', 'cmp-coming-soon-maintenance');?></h4> |
  | 588 |  | <input type="text" name="niteoCS-countdown-email-address" value="<?php echo esc\_attr( $countdown\_email ); ?>" class="regular-text code"><br> |
  |  | 281 | <form method="post" action="admin.php?page=cmp-advanced&status=settings-saved" id="csoptions"> |
  |  | 282 | <?php wp\_nonce\_field('save\_options', 'save\_options\_field'); ?> |
  |  | 283 |  |
  |  | 284 | <h2 class="nav-tab-wrapper"> |
  |  | 285 | <a class="nav-tab nav-tab-active" href="<?php echo admin\_url(); ?>admin.php?page=cmp-advanced#cmp-whitelist-blacklist" data-tab="cmp-whitelist-blacklist"><i class="fas fa-lock"></i><?php \_e('Whitelist/Blacklist', 'cmp-coming-soon-maintenance'); ?></a> |
  |  | 286 |  |
  |  | 287 | <a class="nav-tab" href="<?php echo admin\_url(); ?>admin.php?page=cmp-advanced#cmp-bypass" data-tab="cmp-bypass"><i class="fas fa-user-lock"></i><?php \_e('Bypass', 'cmp-coming-soon-maintenance'); ?></a> |
  |  | 288 |  |
  |  | 289 | <a class="nav-tab" href="<?php echo admin\_url(); ?>admin.php?page=cmp-advanced#cmp-notifications" data-tab="cmp-notifications"><i class="far fa-envelope"></i><?php \_e('Notifications', 'cmp-coming-soon-maintenance'); ?></a> |
  |  | 290 |  |
  |  | 291 | <a class="nav-tab" href="<?php echo admin\_url(); ?>admin.php?page=cmp-advanced#cmp-misc" data-tab="cmp-misc"><i class="fas fa-wrench"></i><?php \_e('Misc', 'cmp-coming-soon-maintenance'); ?></a> |
  |  | 292 |  |
  |  | 293 | <a class="nav-tab" href="<?php echo admin\_url(); ?>admin.php?page=cmp-advanced#cmp-export-import" data-tab="cmp-export-import"><i class="fas fa-download"></i><?php \_e('Import/Export', 'cmp-coming-soon-maintenance'); ?></a> |
  |  | 294 |  |
  |  | 295 | </h2> |
  |  | 296 |  |
  |  | 297 | <div class="cmp-advanced" style="margin-top:6px"> |
  |  | 298 |  |
  |  | 299 | <div class="cmp-inputs-wrapper"> |
  |  | 300 |  |
  |  | 301 | <div class="table-wrapper cmp-whitelist-blacklist"> |
  |  | 302 |  |
  |  | 303 | <h3 class="no-icon"><?php \_e('CMP Page Whitelist and Blacklist Settings', 'cmp-coming-soon-maintenance'); ?></h3> |
  |  | 304 | <table> |
  |  | 305 | <tbody> |
  |  | 306 | <tr> |
  |  | 307 |  |
  |  | 308 | <th> |
  |  | 309 | <fieldset> |
  |  | 310 | <legend class="screen-reader-text"> |
  |  | 311 | <span><?php \_e('Whitelist Settings', 'cmp-coming-soon-maintenance'); ?></span> |
  |  | 312 | </legend> |
  |  | 313 |  |
  |  | 314 | <p> |
  |  | 315 | <label title="Page Whitelist"> |
  |  | 316 | <input type="radio" class="page-whitelist" name="niteoCS\_page\_filter" value="1" <?php checked('1', $niteoCS\_page\_filter); ?>><?php \_e('Page Whitelist', 'cmp-coming-soon-maintenance'); ?> |
  |  | 317 | </label> |
  |  | 318 | </p> |
  |  | 319 |  |
  |  | 320 | <p> |
  |  | 321 | <label title="Page Blacklist"> |
  |  | 322 | <input type="radio" class="page-whitelist" name="niteoCS\_page\_filter" value="2" <?php checked('2', $niteoCS\_page\_filter); ?>><?php \_e('Page Blacklist', 'cmp-coming-soon-maintenance'); ?> |
  |  | 323 | </label> |
  |  | 324 | </p> |
  |  | 325 |  |
  |  | 326 | <p> |
  |  | 327 | <label title="Disabled"> |
  |  | 328 | <input type="radio" class="page-whitelist" name="niteoCS\_page\_filter" value="0" <?php checked('0', $niteoCS\_page\_filter); ?>><?php \_e('Disabled', 'cmp-coming-soon-maintenance'); ?> |
  |  | 329 | </label> |
  |  | 330 | </p> |
  |  | 331 |  |
  |  | 332 | </fieldset> |
  |  | 333 | </th> |
  |  | 334 |  |
  |  | 335 | <td> |
  |  | 336 | <fieldset class="page-whitelist-switch x1"> |
  |  | 337 | <h4><?php \_e('CMP Whitelist - set CMP landing page to specific page(s) only', 'cmp-coming-soon-maintenance'); ?></h4> |
  |  | 338 | <select name="niteoCS\_page-whitelist[]" class="cmp-whitelist-select" multiple="multiple"> |
  |  | 339 | <option value="-1" <?php echo in\_array('-1', $niteoCS\_page\_whitelist) ? 'selected' : ''; ?>><?php \_e('Homepage', 'cmp-coming-soon-maintenance'); ?></option> |
  |  | 340 | <?php |
  |  | 341 | foreach ($pages as $page) { ?> |
  |  | 342 | <option value="<?php echo esc\_attr($page['id']); ?>" <?php echo in\_array($page['id'], $niteoCS\_page\_whitelist) ? 'selected' : ''; ?>><?php echo esc\_attr($page['name']); ?></option> |
  |  | 343 | <?php |
  |  | 344 | } ?> |
  |  | 345 | </select> |
  |  | 346 |  |
  |  | 347 | <p class="cmp-hint" style="margin-top:0"><?php \_e('By default CMP is enabled on all pages. Leave this field empty to use default settings.', 'cmp-coming-soon-maintenance'); ?></p> |
  |  | 348 |  |
  |  | 349 | <h4><?php \_e('You can also add the page URLs manually.', 'cmp-coming-soon-maintenance'); ?></h4> |
  |  | 350 | <textarea name="niteoCS-whitelist-custom" cols="40" rows="5"><?php |
  |  | 351 | if (!empty($niteoCS\_page\_whitelist\_custom)) { |
  |  | 352 | foreach ($niteoCS\_page\_whitelist\_custom as $wl\_url) { |
  |  | 353 | echo esc\_attr($wl\_url) . PHP\_EOL; |
  |  | 354 | } |
  |  | 355 | } ?></textarea> |
  |  | 356 | </fieldset> |
  |  | 357 |  |
  |  | 358 | <fieldset class="page-whitelist-switch x2"> |
  |  | 359 | <h4><?php \_e('CMP Blacklist - select the pages to NOT display CMP landing page', 'cmp-coming-soon-maintenance'); ?></h4> |
  |  | 360 | <select name="niteoCS\_page-blacklist[]" class="cmp-blacklist" multiple="multiple"> |
  |  | 361 | <option value="-1" <?php echo in\_array('-1', $niteoCS\_page\_blacklist) ? 'selected' : ''; ?>><?php \_e('Homepage', 'cmp-coming-soon-maintenance'); ?></option> |
  |  | 362 | <?php |
  |  | 363 | foreach ($pages as $page) { ?> |
  |  | 364 | <option value="<?php echo esc\_attr($page['id']); ?>" <?php echo in\_array($page['id'], $niteoCS\_page\_blacklist) ? 'selected' : ''; ?>><?php echo esc\_attr($page['name']); ?></option> |
  |  | 365 | <?php |
  |  | 366 | } ?> |
  |  | 367 | </select> |
  |  | 368 |  |
  |  | 369 | <p class="cmp-hint" style="margin-top:0"><?php \_e('If you want to exclude some pages from CMP you can select them here.', 'cmp-coming-soon-maintenance'); ?></p> |
  |  | 370 |  |
  |  | 371 | <h4><?php \_e('You can also add the page URLs manually.', 'cmp-coming-soon-maintenance'); ?></h4> |
  |  | 372 | <textarea name="niteoCS-blacklist-custom" cols="40" rows="5"><?php |
  |  | 373 | if (!empty($niteoCS\_page\_blacklist\_custom)) { |
  |  | 374 | foreach ($niteoCS\_page\_blacklist\_custom as $bl\_url) { |
  |  | 375 | echo esc\_attr($bl\_url) . PHP\_EOL; |
  |  | 376 | } |
  |  | 377 | } ?></textarea> |
  |  | 378 | </fieldset> |
  |  | 379 |  |
  |  | 380 | <p class="cmp-hint page-whitelist-switch x1 x2" style="margin-top:0"><?php \_e('Insert URL with http(s) separately at each line. Please make sure your Permalinks work correctly!<br> You can also use asterisk (\*) as a wildcard to match any part of the URL.', 'cmp-coming-soon-maintenance'); ?></p> |
  |  | 381 |  |
  |  | 382 | <p class="page-whitelist-switch x0"><?php \_e('CMP landing page is displayed on all pages by default. You can enable Page Whitelist to display CMP only on specific page(s) or Page Blacklist to exclude CMP landing page on specific page(s) by enabling Page Whitelist or Page Blacklist here.', 'cmp-coming-soon-maintenance'); ?></p> |
  |  | 383 |  |
  |  | 384 | </td> |
  |  | 385 | </tr> |
  |  | 386 |  |
  |  | 387 | <?php echo $this->render\_settings->submit(); ?> |
  |  | 388 |  |
  |  | 389 | </tbody> |
  |  | 390 | </table> |
  |  | 391 |  |
  |  | 392 | </div> |
  |  | 393 |  |
  |  | 394 | <div class="table-wrapper cmp-whitelist-blacklist"> |
  |  | 395 |  |
  |  | 396 | <h3 class="no-icon"><?php \_e('Custom Login URL', 'cmp-coming-soon-maintenance'); ?></h3> |
  |  | 397 | <table> |
  |  | 398 | <tbody> |
  |  | 399 | <tr> |
  |  | 400 |  |
  |  | 401 | <th><?php \_e('Login URL', 'cmp-coming-soon-maintenance'); ?></th> |
  |  | 402 |  |
  |  | 403 | <td> |
  |  | 404 | <fieldset> |
  |  | 405 | <h4><?php \_e('Login URL', 'cmp-coming-soon-maintenance'); ?></h4> |
  |  | 406 | <input type="text" name="niteoCS\_custom\_login\_url" value="<?php echo esc\_html($custom\_login\_url); ?>" class="regular-text"><br> |
  |  | 407 |  |
  |  | 408 | <p class="cmp-hint" style="margin-top:0"><?php \_e('Insert custom login URL if you are using plugins to change default WordPress login URL.', 'cmp-coming-soon-maintenance'); ?></p> |
  |  | 409 |  |
  |  | 410 |  |
  |  | 411 | </fieldset> |
  |  | 412 |  |
  |  | 413 | </td> |
  |  | 414 | </tr> |
  |  | 415 |  |
  |  | 416 | <?php echo $this->render\_settings->submit(); ?> |
  |  | 417 |  |
  |  | 418 | </tbody> |
  |  | 419 | </table> |
  |  | 420 |  |
  |  | 421 | </div> |
  |  | 422 |  |
  |  | 423 | <!-- BYPASS --> |
  |  | 424 |  |
  |  | 425 | <div class="table-wrapper general cmp-bypass"> |
  |  | 426 |  |
  |  | 427 | <h3 class="no-icon"><?php \_e('CMP Bypass by User Roles', 'cmp-coming-soon-maintenance'); ?></h3> |
  |  | 428 | <table class="general"> |
  |  | 429 | <tbody> |
  |  | 430 | <tr> |
  |  | 431 | <th><?php \_e('Bypass User Roles', 'cmp-coming-soon-maintenance'); ?></th> |
  |  | 432 |  |
  |  | 433 | <td> |
  |  | 434 | <fieldset> |
  |  | 435 | <h4><?php \_e('Select User Roles to bypass CMP landing page', 'cmp-coming-soon-maintenance'); ?></h4> |
  |  | 436 |  |
  |  | 437 | <select name="niteoCS\_roles[]" class="cmp-user\_roles" multiple="multiple"> |
  |  | 438 |  |
  |  | 439 | <?php |
  |  | 440 | $roles = get\_editable\_roles(); |
  |  | 441 |  |
  |  | 442 | foreach ($roles as $role => $details) { |
  |  | 443 |  |
  |  | 444 | if ($role != 'administrator') { ?> |
  |  | 445 | <option value="<?php echo esc\_attr($role); ?>" <?php echo in\_array($role, $niteoCS\_roles) ? 'selected' : ''; ?>><?php echo esc\_attr($details['name']); ?></option> |
  |  | 446 | <?php |
  |  | 447 | } |
  |  | 448 | } ?> |
  |  | 449 |  |
  |  | 450 | </select> |
  |  | 451 |  |
  |  | 452 | <p class="cmp-hint" style="margin-top:0"><?php \_e('Administrator role always bypass CMP by default.', 'cmp-coming-soon-maintenance'); ?></p> |
  |  | 453 |  |
  |  | 454 | </fieldset> |
  |  | 455 |  |
  |  | 456 | </td> |
  |  | 457 | </tr> |
  |  | 458 |  |
  |  | 459 | <?php echo $this->render\_settings->submit(); ?> |
  |  | 460 |  |
  |  | 461 | </tbody> |
  |  | 462 | </table> |
  |  | 463 |  |
  |  | 464 | </div> |
  |  | 465 |  |
  |  | 466 | <div class="table-wrapper general cmp-bypass"> |
  |  | 467 | <h3 class="no-icon"><?php \_e('CMP Bypass URL', 'cmp-coming-soon-maintenance'); ?></h3> |
  |  | 468 | <table class="general"> |
  |  | 469 | <tbody> |
  |  | 470 | <tr> |
  |  | 471 |  |
  |  | 472 | <th> |
  |  | 473 | <fieldset> |
  |  | 474 | <legend class="screen-reader-text"> |
  |  | 475 | <span><?php \_e('Whitelist Settings', 'cmp-coming-soon-maintenance'); ?></span> |
  |  | 476 | </legend> |
  |  | 477 |  |
  |  | 478 | <p> |
  |  | 479 | <label title="Page Whitelist"> |
  |  | 480 | <input type="radio" class="cmp-bypass" name="niteoCS\_bypass" value="1" <?php checked('1', $bypass); ?>><?php \_e('Enabled', 'cmp-coming-soon-maintenance'); ?> |
  |  | 481 | </label> |
  |  | 482 | </p> |
  |  | 483 |  |
  |  | 484 | <p> |
  |  | 485 | <label title="Disabled"> |
  |  | 486 | <input type="radio" class="cmp-bypass" name="niteoCS\_bypass" value="0" <?php checked('0', $bypass); ?>><?php \_e('Disabled', 'cmp-coming-soon-maintenance'); ?> |
  |  | 487 | </label> |
  |  | 488 | </p> |
  |  | 489 |  |
  |  | 490 | </fieldset> |
  |  | 491 | </th> |
  |  | 492 |  |
  |  | 493 | <td> |
  |  | 494 |  |
  |  | 495 | <fieldset class="cmp-bypass-switch x1"> |
  |  | 496 |  |
  |  | 497 | <h4 style="margin-bottom:0.5em"><?php \_e('Bypass URL', 'cmp-coming-soon-maintenance'); ?></h4> |
  |  | 498 | <code id="bypass-code"><?php echo get\_home\_url() . '/?cmp\_bypass=' . $bypass\_id; ?></code><br><br> |
  |  | 499 | <a href="<?php echo admin\_url(); ?>admin.php?page=cmp-advanced#cmp-bypass" class="button" id="copy-bypass">Copy to clipboard</a> |
  |  | 500 |  |
  |  | 501 | <p><?php \_e('You can use this URL to bypass CMP maintenance page. Once you access your website with this URL, CMP Cookie will be set with default expiration of 2 days. If the cookie expires, you need to access your website again with this URL.', 'cmp-coming-soon-maintenance'); ?></p> |
  |  | 502 |  |
  |  | 503 | <h4><?php \_e('Set Bypass Passphrase', 'cmp-coming-soon-maintenance'); ?></h4> |
  |  | 504 | <input type="text" name="niteoCS\_bypass\_id" value="<?php echo esc\_attr($bypass\_id); ?>" class="regular-text code"><br> |
  |  | 505 |  |
  |  | 506 | <p class="cmp-hint" style="margin-top:0"><?php \_e('You can use passphrase which contains letters, numbers, underscores or dashes only.', 'cmp-coming-soon-maintenance'); ?></p> |
  |  | 507 |  |
  |  | 508 | <h4><?php \_e('Set bypass cookie Expiration Time in days', 'cmp-coming-soon-maintenance'); ?></h4> |
  |  | 509 | <input type="text" name="niteoCS\_bypass\_expire" value="<?php echo esc\_attr($bypass\_expire); ?>" class="regular-text code"><br> |
  |  | 510 |  |
  |  | 511 | <p class="cmp-hint" style="margin-top:0"><?php \_e('You can set custom Bypass CMP Cookie expiration time in days. Default expiration time is 2 days.', 'cmp-coming-soon-maintenance'); ?></p> |
  |  | 512 |  |
  |  | 513 | <p><?php \_e('Please note this solution is using browser cookies which might not work correctly if you are using caching plugins.', 'cmp-coming-soon-maintenance'); ?></p> |
  |  | 514 |  |
  |  | 515 | </fieldset> |
  |  | 516 |  |
  |  | 517 | <p class="cmp-bypass-switch x0"><?php \_e('You can Enable CMP Bypass where you can set custom URL parameter to bypass CMP page. You can send this URL to anyone who would like to sneak peak into your Website while it is under development or maintanence.', 'cmp-coming-soon-maintenance'); ?></p> |
  |  | 518 |  |
  |  | 519 | </td> |
  |  | 520 | </tr> |
  |  | 521 |  |
  |  | 522 | <?php echo $this->render\_settings->submit(); ?> |
  |  | 523 |  |
  |  | 524 | </tbody> |
  |  | 525 | </table> |
  |  | 526 |  |
  |  | 527 | </div> |
  |  | 528 | <div class="table-wrapper general cmp-bypass"> |
  |  | 529 | <h3 class="no-icon"><?php \_e('RSS & REST API', 'cmp-coming-soon-maintenance'); ?></h3> |
  |  | 530 | <table class="general"> |
  |  | 531 | <tbody> |
  |  | 532 | <tr> |
  |  | 533 | <th><?php \_e('RSS', 'cmp-coming-soon-maintenance'); ?></th> |
  |  | 534 | <td> |
  |  | 535 | <fieldset> |
  |  | 536 | <label for="cmp-rss-status"> |
  |  | 537 | <input type="checkbox" name="niteoCS-rss-status" id="cmp-rss-status" value="1" <?php checked('1', $cmp\_rss); ?>><?php \_e('Allow RSS', 'cmp-coming-soon-maintenance'); ?> |
  |  | 538 | </label> |
  |  | 539 | </fieldset> |
  |  | 540 | </td> |
  |  | 541 | </tr> |
  |  | 542 | <tr> |
  |  | 543 | <th><?php \_e('REST API', 'cmp-coming-soon-maintenance'); ?></th> |
  |  | 544 | <td> |
  |  | 545 | <fieldset> |
  |  | 546 | <label for="cmp-restapi-status"> |
  |  | 547 | <input type="checkbox" name="niteoCS-restapi-status" id="cmp-restapi-status" value="1" <?php checked('1', $cmp\_rest\_api); ?>><?php \_e('Allow REST API', 'cmp-coming-soon-maintenance'); ?> |
  |  | 548 | </label> |
  |  | 549 | </fieldset> |
  |  | 550 | </td> |
  |  | 551 | </tr> |
  |  | 552 |  |
  |  | 553 | <?php echo $this->render\_settings->submit(); ?> |
  |  | 554 |  |
  |  | 555 | </tbody> |
  |  | 556 | </table> |
  |  | 557 |  |
  |  | 558 | </div> |
  |  | 559 |  |
  |  | 560 | <!-- NOTIFICATIONS --> |
  |  | 561 |  |
  |  | 562 | <div class="table-wrapper cmp-notifications"> |
  |  | 563 | <h3 class="no-icon"><?php \_e('Email Notifications', 'cmp-coming-soon-maintenance'); ?></h3> |
  |  | 564 | <table class="general"> |
  |  | 565 | <tbody> |
  |  | 566 | <tr> |
  |  | 567 | <th><?php \_e('Timer Expiration', 'cmp-coming-soon-maintenance'); ?></th> |
  |  | 568 |  |
  |  | 569 | <td> |
  |  | 570 | <fieldset> |
  |  | 571 |  |
  |  | 572 | <label for="cmp-countdown-notification"> |
  |  | 573 | <input type="checkbox" class="countdown-toggle" name="niteoCS-countdown-notification" id="cmp-countdown-notification" value="1" <?php checked('1', $cmp\_countdown\_notif); ?>><?php \_e('Enable Email notification when Countdown timer expires to 0.', 'cmp-coming-soon-maintenance'); ?> |
  |  | 574 | </label> |
  |  | 575 |  |
  |  | 576 |  |
  |  | 577 | <div class="countdown-toggle-switch x1" style="margin-top:1em"> |
  |  | 578 | <h4><?php \_e('Specify Email Address', 'cmp-coming-soon-maintenance'); ?></h4> |
  |  | 579 | <input type="text" name="niteoCS-countdown-email-address" value="<?php echo esc\_attr($countdown\_email); ?>" class="regular-text code"><br> |
  |  | 580 | </div> |
  |  | 581 | </fieldset> |
  |  | 582 | </td> |
  |  | 583 | </tr> |
  |  | 584 |  |
  |  | 585 | <tr> |
  |  | 586 | <th><?php \_e('CMP Status Change', 'cmp-coming-soon-maintenance'); ?></th> |
  |  | 587 |  |
  |  | 588 | <td> |
  |  | 589 | <fieldset> |
  |  | 590 |  |
  |  | 591 | <label for="cmp-mode-change-notification"> |
  |  | 592 | <input type="checkbox" name="niteoCS-mode-change-notification" class="mode-change-toggle" id="cmp-mode-change-notification" value="1" <?php checked('1', $cmp\_mode\_change\_notif); ?>><?php \_e('Enable Email notification if Coming Soon Mode is enabled or disabled by the user.', 'cmp-coming-soon-maintenance'); ?> |
  |  | 593 | </label> |
  |  | 594 |  |
  |  | 595 |  |
  |  | 596 | <div class="mode-change-toggle-switch x1" style="margin-top:1em"> |
  |  | 597 | <h4><?php \_e('Specify Email Address', 'cmp-coming-soon-maintenance'); ?></h4> |
  |  | 598 | <input type="text" name="niteoCS-mode-change-email-address" value="<?php echo esc\_attr($mode\_change\_email); ?>" class="regular-text code"><br> |
  |  | 599 | </div> |
  |  | 600 | </fieldset> |
  |  | 601 | </td> |
  |  | 602 | </tr> |
  |  | 603 |  |
  |  | 604 | <tr> |
  |  | 605 | <th><?php \_e('New CMP Subscriber', 'cmp-coming-soon-maintenance'); ?></th> |
  |  | 606 |  |
  |  | 607 | <td> |
  |  | 608 | <fieldset> |
  |  | 609 |  |
  |  | 610 | <label for="cmp-subscribe-notification"> |
  |  | 611 | <input type="checkbox" name="niteoCS-subscribe-notification" class="subscribe-toggle" id="cmp-subscribe-notification" value="1" <?php checked('1', $cmp\_subscribe\_notif); ?>><?php \_e('Enable Email notification if there is a new CMP Subscriber. Applies only for a default CMP Custom Subscribe list.', 'cmp-coming-soon-maintenance'); ?> |
  |  | 612 | </label> |
  |  | 613 |  |
  |  | 614 |  |
  |  | 615 | <div class="subscribe-toggle-switch x1" style="margin-top:1em"> |
  |  | 616 | <h4><?php \_e('Specify Email Address', 'cmp-coming-soon-maintenance'); ?></h4> |
  |  | 617 | <input type="text" name="niteoCS-subscribe-email-address" value="<?php echo esc\_attr($subscribe\_email); ?>" class="regular-text code"><br> |
  |  | 618 | </div> |
  |  | 619 | </fieldset> |
  |  | 620 | </td> |
  |  | 621 | </tr> |
  |  | 622 |  |
  |  | 623 | <?php echo $this->render\_settings->submit(); ?> |
  |  | 624 |  |
  |  | 625 | </tbody> |
  |  | 626 | </table> |
  |  | 627 |  |
  |  | 628 | </div> |
  |  | 629 |  |
  |  | 630 | <!-- MISC --> |
  |  | 631 | <div class="table-wrapper cmp-misc"> |
  |  | 632 |  |
  |  | 633 | <h3 class="no-icon"><?php \_e('CMP Top Bar', 'cmp-coming-soon-maintenance'); ?></h3> |
  |  | 634 | <table class="general"> |
  |  | 635 | <tbody> |
  |  | 636 |  |
  |  | 637 | <tr> |
  |  | 638 | <th> |
  |  | 639 | <fieldset> |
  |  | 640 | <legend class="screen-reader-text"> |
  |  | 641 | <span><?php \_e('CMP Top Bar', 'cmp-coming-soon-maintenance'); ?></span> |
  |  | 642 | </legend> |
  |  | 643 |  |
  |  | 644 | <p> |
  |  | 645 | <label title="Enabled"> |
  |  | 646 | <input type="radio" class="cmp-topbar-icon" name="niteoCS\_topbar\_icon" value="1" <?php checked('1', $topbar\_icon); ?>><?php \_e('Enabled', 'cmp-coming-soon-maintenance'); ?> |
  |  | 647 | </label> |
  |  | 648 | </p> |
  |  | 649 |  |
  |  | 650 | <p> |
  |  | 651 | <label title="Disabled"> |
  |  | 652 | <input type="radio" class="cmp-topbar-icon" name="niteoCS\_topbar\_icon" value="0" <?php checked('0', $topbar\_icon); ?>><?php \_e('Disabled', 'cmp-coming-soon-maintenance'); ?> |
  |  | 653 | </label> |
  |  | 654 | </p> |
  |  | 655 | </fieldset> |
  |  | 656 | </th> |
  |  | 657 |  |
  |  | 658 | <td> |
  |  | 659 | <fieldset class="cmp-topbar-icon-switch x1"> |
  |  | 660 | <h4><?php \_e('You can specify which roles have access to CMP Top Bar', 'cmp-coming-soon-maintenance'); ?></h4> |
  |  | 661 |  |
  |  | 662 | <select name="niteoCS\_roles\_topbar[]" class="cmp-user\_roles" multiple="multiple"> |
  |  | 663 | <?php |
  |  | 664 | $roles = get\_editable\_roles(); |
  |  | 665 | foreach ($roles as $role => $details) { |
  |  | 666 |  |
  |  | 667 | if ($role != 'administrator') { ?> |
  |  | 668 | <option value="<?php echo esc\_attr($role); ?>" <?php echo in\_array($role, $niteoCS\_roles\_topbar) ? 'selected' : ''; ?>><?php echo esc\_attr($details['name']); ?></option> |
  |  | 669 | <?php |
  |  | 670 | } |
  |  | 671 | } ?> |
  |  | 672 | </select> |
  |  | 673 | <p class="cmp-hint" style="margin-top:0"><?php \_e('Administrator role can always access Top Bar', 'cmp-coming-soon-maintenance'); ?></p> |
  |  | 674 |  |
  |  | 675 | <h4><?php \_e('CMP Top Bar layout', 'cmp-coming-soon-maintenance'); ?></h4> |
  |  | 676 | <select name="niteoCS\_topbar\_version"> |
  |  | 677 | <option value="cmp-topbar-full" <?php selected($topbar\_version, 'cmp-topbar-full'); ?>><?php \_e('Full - CMP Icon with description', 'cmp-coming-soon-maintenace'); ?></option> |
  |  | 678 | <option value="cmp-topbar-compact" <?php selected($topbar\_version, 'cmp-topbar-compact'); ?>><?php \_e('Compact - CMP Icon only ', 'cmp-coming-soon-maintenace'); ?></option> |
  |  | 679 | </select> |
  |  | 680 |  |
  |  | 681 | </fieldset> |
  |  | 682 |  |
  |  | 683 | <div class="cmp-topbar-icon-switch x0"> |
  |  | 684 | <p><?php \_e('CMP Top Bar is disabled.', 'cmp-coming-soon-maintenance'); ?></p> |
  |  | 685 | <img src="<?php echo plugins\_url('/img/topbar.png', \_\_FILE\_\_); ?>" alt="CMP Top Bar"> |
  |  | 686 | <p><?php \_e(' Once enabled, you can quickly enable or disable Coming Soon Mode or check out CMP Preview without visiting CMP Settings Plugin page.', 'cmp-coming-soon-maintenance'); ?></p> |
  | 589 | 687 | </div> |
  | 590 |  | </fieldset> |
  | 591 |  | </td> |
  | 592 |  | </tr> |
  | 593 |  |  |
  | 594 |  | <tr> |
  | 595 |  | <th><?php \_e('CMP Status Change', 'cmp-coming-soon-maintenance');?></th> |
  | 596 |  |  |
  | 597 |  | <td> |
  | 598 |  | <fieldset> |
  | 599 |  |  |
  | 600 |  | <label for="cmp-mode-change-notification"> |
  | 601 |  | <input type="checkbox" name="niteoCS-mode-change-notification" class="mode-change-toggle" id="cmp-mode-change-notification" value="1" <?php checked('1', $cmp\_mode\_change\_notif);?>><?php \_e('Enable Email notification if Coming Soon Mode is enabled or disabled by the user.', 'cmp-coming-soon-maintenance');?> |
  | 602 |  | </label> |
  | 603 |  |  |
  | 604 |  |  |
  | 605 |  | <div class="mode-change-toggle-switch x1" style="margin-top:1em"> |
  | 606 |  | <h4><?php \_e('Specify Email Address', 'cmp-coming-soon-maintenance');?></h4> |
  | 607 |  | <input type="text" name="niteoCS-mode-change-email-address" value="<?php echo esc\_attr( $mode\_change\_email ); ?>" class="regular-text code"><br> |
  |  | 688 |  |
  |  | 689 | </td> |
  |  | 690 | </tr> |
  |  | 691 | <?php echo $this->render\_settings->submit(); ?> |
  |  | 692 |  |
  |  | 693 | </tbody> |
  |  | 694 | </table> |
  |  | 695 |  |
  |  | 696 | </div> |
  |  | 697 |  |
  |  | 698 | <div class="table-wrapper cmp-misc"> |
  |  | 699 |  |
  |  | 700 | <h3 class="no-icon"><?php \_e('Automatic paragraphs', 'cmp-coming-soon-maintenance'); ?></h3> |
  |  | 701 | <table class="general"> |
  |  | 702 | <tbody> |
  |  | 703 |  |
  |  | 704 | <tr> |
  |  | 705 | <th> |
  |  | 706 | <fieldset> |
  |  | 707 | <legend class="screen-reader-text"> |
  |  | 708 | <span><?php \_e('Automatic paragraphs', 'cmp-coming-soon-maintenance'); ?></span> |
  |  | 709 | </legend> |
  |  | 710 |  |
  |  | 711 | <p> |
  |  | 712 | <label title="Enabled"> |
  |  | 713 | <input type="radio" class="cmp-wpautop" name="niteoCS\_wpautop" value="1" <?php checked('1', $wpautop); ?>><?php \_e('Enabled', 'cmp-coming-soon-maintenance'); ?> |
  |  | 714 | </label> |
  |  | 715 | </p> |
  |  | 716 |  |
  |  | 717 | <p> |
  |  | 718 | <label title="Disabled"> |
  |  | 719 | <input type="radio" class="cmp-wpautop" name="niteoCS\_wpautop" value="0" <?php checked('0', $wpautop); ?>><?php \_e('Disabled', 'cmp-coming-soon-maintenance'); ?> |
  |  | 720 | </label> |
  |  | 721 | </p> |
  |  | 722 | </fieldset> |
  |  | 723 | </th> |
  |  | 724 |  |
  |  | 725 | <td> |
  |  | 726 | <div class="cmp-wpautop-switch x1"> |
  |  | 727 | <p style="margin-top:0"><?php \_e('Paragraphs will be automatically created in the Content area. You can disable this if you have issues with rendering 3rd party shortcodes in the content.', 'cmp-coming-soon-maintenance'); ?></p> |
  | 608 | 728 | </div> |
  | 609 |  | </fieldset> |
  | 610 |  | </td> |
  | 611 |  | </tr> |
  | 612 |  |  |
  | 613 |  | <tr> |
  | 614 |  | <th><?php \_e('New CMP Subscriber', 'cmp-coming-soon-maintenance');?></th> |
  | 615 |  |  |
  | 616 |  | <td> |
  | 617 |  | <fieldset> |
  | 618 |  |  |
  | 619 |  | <label for="cmp-subscribe-notification"> |
  | 620 |  | <input type="checkbox" name="niteoCS-subscribe-notification" class="subscribe-toggle" id="cmp-subscribe-notification" value="1" <?php checked('1', $cmp\_subscribe\_notif);?>><?php \_e('Enable Email notification if there is a new CMP Subscriber. Applies only for a default CMP Custom Subscribe list.', 'cmp-coming-soon-maintenance');?> |
  | 621 |  | </label> |
  | 622 |  |  |
  | 623 |  |  |
  | 624 |  | <div class="subscribe-toggle-switch x1" style="margin-top:1em"> |
  | 625 |  | <h4><?php \_e('Specify Email Address', 'cmp-coming-soon-maintenance');?></h4> |
  | 626 |  | <input type="text" name="niteoCS-subscribe-email-address" value="<?php echo esc\_attr( $subscribe\_email ); ?>" class="regular-text code"><br> |
  |  | 729 |  |
  |  | 730 | <div class="cmp-wpautop-switch x0"> |
  |  | 731 | <p style="margin-top:0"><?php \_e('Automatic paragraphs are disabled.', 'cmp-coming-soon-maintenance'); ?></p> |
  | 627 | 732 | </div> |
  | 628 |  | </fieldset> |
  | 629 |  | </td> |
  | 630 |  | </tr> |
  | 631 |  |  |
  | 632 |  | <?php echo $this->render\_settings->submit(); ?> |
  | 633 |  |  |
  | 634 |  | </tbody> |
  | 635 |  | </table> |
  | 636 |  |  |
  | 637 |  | </div> |
  | 638 |  |  |
  | 639 |  | <!-- MISC --> |
  | 640 |  | <div class="table-wrapper cmp-misc"> |
  | 641 |  |  |
  | 642 |  | <h3 class="no-icon"><?php \_e('CMP Top Bar', 'cmp-coming-soon-maintenance');?></h3> |
  | 643 |  | <table class="general"> |
  | 644 |  | <tbody> |
  | 645 |  |  |
  | 646 |  | <tr> |
  | 647 |  | <th> |
  | 648 |  | <fieldset> |
  | 649 |  | <legend class="screen-reader-text"> |
  | 650 |  | <span><?php \_e('CMP Top Bar', 'cmp-coming-soon-maintenance');?></span> |
  | 651 |  | </legend> |
  | 652 |  |  |
  | 653 |  | <p> |
  | 654 |  | <label title="Enabled"> |
  | 655 |  | <input type="radio" class="cmp-topbar-icon" name="niteoCS\_topbar\_icon" value="1" <?php checked('1', $topbar\_icon);?>><?php \_e('Enabled', 'cmp-coming-soon-maintenance');?> |
  | 656 |  | </label> |
  | 657 |  | </p> |
  | 658 |  |  |
  | 659 |  | <p> |
  | 660 |  | <label title="Disabled"> |
  | 661 |  | <input type="radio" class="cmp-topbar-icon" name="niteoCS\_topbar\_icon" value="0" <?php checked('0', $topbar\_icon);?>><?php \_e('Disabled', 'cmp-coming-soon-maintenance');?> |
  | 662 |  | </label> |
  | 663 |  | </p> |
  | 664 |  | </fieldset> |
  | 665 |  | </th> |
  | 666 |  |  |
  | 667 |  | <td> |
  | 668 |  | <fieldset class="cmp-topbar-icon-switch x1"> |
  | 669 |  | <h4><?php \_e('You can specify which roles have access to CMP Top Bar', 'cmp-coming-soon-maintenance');?></h4> |
  | 670 |  |  |
  | 671 |  | <select name="niteoCS\_roles\_topbar[]" class="cmp-user\_roles" multiple="multiple"> |
  | 672 |  | <?php |
  | 673 |  | $roles = get\_editable\_roles(); |
  | 674 |  | foreach ( $roles as $role => $details ) { |
  | 675 |  |  |
  | 676 |  | if ( $role != 'administrator') { ?> |
  | 677 |  | <option value="<?php echo esc\_attr($role);?>" <?php echo in\_array( $role, $niteoCS\_roles\_topbar ) ? 'selected' : '';?>><?php echo esc\_attr( $details['name'] );?></option> |
  | 678 |  | <?php |
  | 679 |  | } |
  | 680 |  | } ?> |
  | 681 |  | </select> |
  | 682 |  | <p class="cmp-hint" style="margin-top:0"><?php \_e('Administrator role can always access Top Bar', 'cmp-coming-soon-maintenance');?></p> |
  | 683 |  |  |
  | 684 |  | <h4><?php \_e('CMP Top Bar layout', 'cmp-coming-soon-maintenance');?></h4> |
  | 685 |  | <select name="niteoCS\_topbar\_version"> |
  | 686 |  | <option value="cmp-topbar-full" <?php selected($topbar\_version, 'cmp-topbar-full');?>><?php \_e('Full - CMP Icon with description', 'cmp-coming-soon-maintenace');?></option> |
  | 687 |  | <option value="cmp-topbar-compact" <?php selected($topbar\_version, 'cmp-topbar-compact');?>><?php \_e('Compact - CMP Icon only ', 'cmp-coming-soon-maintenace');?></option> |
  | 688 |  | </select> |
  | 689 |  |  |
  | 690 |  | </fieldset> |
  | 691 |  |  |
  | 692 |  | <div class="cmp-topbar-icon-switch x0"> |
  | 693 |  | <p><?php \_e('CMP Top Bar is disabled.', 'cmp-coming-soon-maintenance');?></p> |
  | 694 |  | <img src="<?php echo plugins\_url('/img/topbar.png', \_\_FILE\_\_);?>" alt="CMP Top Bar"> |
  | 695 |  | <p><?php \_e(' Once enabled, you can quickly enable or disable Coming Soon Mode or check out CMP Preview without visiting CMP Settings Plugin page.', 'cmp-coming-soon-maintenance');?></p> |
  | 696 |  | </div> |
  | 697 |  |  |
  | 698 |  | </td> |
  | 699 |  | </tr> |
  | 700 |  | <?php echo $this->render\_settings->submit(); ?> |
  | 701 |  |  |
  | 702 |  | </tbody> |
  | 703 |  | </table> |
  | 704 |  |  |
  | 705 |  | </div> |
  | 706 |  |  |
  | 707 |  | <div class="table-wrapper cmp-misc"> |
  | 708 |  |  |
  | 709 |  | <h3 class="no-icon"><?php \_e('Automatic paragraphs', 'cmp-coming-soon-maintenance');?></h3> |
  | 710 |  | <table class="general"> |
  | 711 |  | <tbody> |
  | 712 |  |  |
  | 713 |  | <tr> |
  | 714 |  | <th> |
  | 715 |  | <fieldset> |
  | 716 |  | <legend class="screen-reader-text"> |
  | 717 |  | <span><?php \_e('Automatic paragraphs', 'cmp-coming-soon-maintenance');?></span> |
  | 718 |  | </legend> |
  | 719 |  |  |
  | 720 |  | <p> |
  | 721 |  | <label title="Enabled"> |
  | 722 |  | <input type="radio" class="cmp-wpautop" name="niteoCS\_wpautop" value="1" <?php checked('1', $wpautop);?>><?php \_e('Enabled', 'cmp-coming-soon-maintenance');?> |
  | 723 |  | </label> |
  | 724 |  | </p> |
  | 725 |  |  |
  | 726 |  | <p> |
  | 727 |  | <label title="Disabled"> |
  | 728 |  | <input type="radio" class="cmp-wpautop" name="niteoCS\_wpautop" value="0" <?php checked('0', $wpautop);?>><?php \_e('Disabled', 'cmp-coming-soon-maintenance');?> |
  | 729 |  | </label> |
  | 730 |  | </p> |
  | 731 |  | </fieldset> |
  | 732 |  | </th> |
  | 733 |  |  |
  | 734 |  | <td> |
  | 735 |  | <div class="cmp-wpautop-switch x1"> |
  | 736 |  | <p style="margin-top:0"><?php \_e('Paragraphs will be automatically created in the Content area. You can disable this if you have issues with rendering 3rd party shortcodes in the content.', 'cmp-coming-soon-maintenance');?></p> |
  | 737 |  | </div> |
  | 738 |  |  |
  | 739 |  | <div class="cmp-wpautop-switch x0"> |
  | 740 |  | <p style="margin-top:0"><?php \_e('Automatic paragraphs are disabled.', 'cmp-coming-soon-maintenance');?></p> |
  | 741 |  | </div> |
  | 742 |  |  |
  | 743 |  | </td> |
  | 744 |  | </tr> |
  | 745 |  | <?php echo $this->render\_settings->submit(); ?> |
  | 746 |  |  |
  | 747 |  | </tbody> |
  | 748 |  | </table> |
  | 749 |  |  |
  | 750 |  | </div> |
  | 751 |  |  |
  | 752 |  | <div class="table-wrapper cmp-misc"> |
  | 753 |  |  |
  | 754 |  | <h3 class="no-icon"><?php \_e('Custom External Scripts', 'cmp-coming-soon-maintenance');?></h3> |
  | 755 |  | <table class="general"> |
  | 756 |  | <tbody> |
  | 757 |  | <tr> |
  | 758 |  | <th><?php \_e('Head Scripts', 'cmp-coming-soon-maintenance');?></th> |
  | 759 |  |  |
  | 760 |  | <td> |
  | 761 |  | <fieldset> |
  | 762 |  | <h4><?php \_e('Insert Javascript or CSS external file URL', 'cmp-coming-soon-maintenance');?></h4> |
  | 763 |  | <div id="wrapper-head\_scripts"> |
  | 764 |  |  |
  | 765 |  | <div class="source-repeater-fields"> |
  | 766 |  | <input type="text" name="niteoCS\_head\_scripts[]" value="<?php echo (empty( $head\_scripts )) ? '' : esc\_attr( $head\_scripts[0] );?>" placeholder="Insert script full URL" class="regular-text code"><a href="#cmp-misc" class="delete-head\_scripts"><i class="far fa-trash-alt"></i></a> |
  |  | 733 |  |
  |  | 734 | </td> |
  |  | 735 | </tr> |
  |  | 736 | <?php echo $this->render\_settings->submit(); ?> |
  |  | 737 |  |
  |  | 738 | </tbody> |
  |  | 739 | </table> |
  |  | 740 |  |
  |  | 741 | </div> |
  |  | 742 |  |
  |  | 743 | <div class="table-wrapper cmp-misc"> |
  |  | 744 |  |
  |  | 745 | <h3 class="no-icon"><?php \_e('Custom External Scripts', 'cmp-coming-soon-maintenance'); ?></h3> |
  |  | 746 | <table class="general"> |
  |  | 747 | <tbody> |
  |  | 748 | <tr> |
  |  | 749 | <th><?php \_e('Head Scripts', 'cmp-coming-soon-maintenance'); ?></th> |
  |  | 750 |  |
  |  | 751 | <td> |
  |  | 752 | <fieldset> |
  |  | 753 | <h4><?php \_e('Insert Javascript or CSS external file URL', 'cmp-coming-soon-maintenance'); ?></h4> |
  |  | 754 | <div id="wrapper-head\_scripts"> |
  |  | 755 |  |
  |  | 756 | <div class="source-repeater-fields"> |
  |  | 757 | <input type="text" name="niteoCS\_head\_scripts[]" value="<?php echo (empty($head\_scripts)) ? '' : esc\_attr($head\_scripts[0]); ?>" placeholder="Insert script full URL" class="regular-text code"><a href="#cmp-misc" class="delete-head\_scripts"><i class="far fa-trash-alt"></i></a> |
  |  | 758 | </div> |
  |  | 759 |  |
  |  | 760 | <div class="target-repeater-fields"> |
  |  | 761 | <?php |
  |  | 762 | if (count($head\_scripts) > 1) { |
  |  | 763 | foreach ($head\_scripts as $id => $script) { |
  |  | 764 | if ($id != 0) { ?> |
  |  | 765 | <input type="text" name="niteoCS\_head\_scripts[]" value="<?php echo esc\_attr($script); ?>" placeholder="Insert full script full URL" class="regular-text code"><a href="#cmp-misc" class="delete-head\_scripts"><i class="far fa-trash-alt"></i></a> |
  |  | 766 | <?php |
  |  | 767 | } |
  |  | 768 | } |
  |  | 769 | } ?> |
  |  | 770 | </div> |
  |  | 771 |  |
  |  | 772 | </div> |
  |  | 773 |  |
  |  | 774 | <button id="add-head\_scripts" class="button"><?php \_e('Add More', 'cmp-coming-soon-maintenance'); ?></button> |
  |  | 775 | </fieldset> |
  |  | 776 |  |
  |  | 777 | </td> |
  |  | 778 | </tr> |
  |  | 779 |  |
  |  | 780 | <tr> |
  |  | 781 | <th><?php \_e('Footer Scripts', 'cmp-coming-soon-maintenance'); ?></th> |
  |  | 782 |  |
  |  | 783 | <td> |
  |  | 784 | <fieldset> |
  |  | 785 | <h4><?php \_e('Insert Javascript or CSS external file URL', 'cmp-coming-soon-maintenance'); ?></h4> |
  |  | 786 | <div id="wrapper-footer\_scripts"> |
  |  | 787 |  |
  |  | 788 | <div class="source-repeater-fields"> |
  |  | 789 | <input type="text" name="niteoCS\_footer\_scripts[]" value="<?php echo (empty($footer\_scripts)) ? '' : esc\_attr($footer\_scripts[0]); ?>" placeholder="Insert script full URL" class="regular-text code"><a href="#cmp-misc" class="delete-footer\_scripts"><i class="far fa-trash-alt"></i></a> |
  |  | 790 | </div> |
  |  | 791 |  |
  |  | 792 | <div class="target-repeater-fields"> |
  |  | 793 | <?php |
  |  | 794 | if (count($footer\_scripts) > 1) { |
  |  | 795 | foreach ($footer\_scripts as $id => $footer\_script) { |
  |  | 796 | if ($id != 0) { ?> |
  |  | 797 | <input type="text" name="niteoCS\_footer\_scripts[]" value="<?php echo esc\_attr($footer\_script); ?>" placeholder="Insert script full URL" class="regular-text code"><a href="#cmp-misc" class="delete-footer\_scripts"><i class="far fa-trash-alt"></i></a> |
  |  | 798 | <?php |
  |  | 799 | } |
  |  | 800 | } |
  |  | 801 | } ?> |
  |  | 802 | </div> |
  |  | 803 |  |
  |  | 804 | </div> |
  |  | 805 |  |
  |  | 806 | <button id="add-footer\_scripts" class="button"><?php \_e('Add More', 'cmp-coming-soon-maintenance'); ?></button> |
  |  | 807 | </fieldset> |
  |  | 808 |  |
  |  | 809 | </td> |
  |  | 810 | </tr> |
  |  | 811 |  |
  |  | 812 | <?php echo $this->render\_settings->submit(); ?> |
  |  | 813 |  |
  |  | 814 | </tbody> |
  |  | 815 | </table> |
  |  | 816 |  |
  |  | 817 | </div> |
  |  | 818 |  |
  |  | 819 | <div class="table-wrapper cmp-misc"> |
  |  | 820 |  |
  |  | 821 | <h3 class="no-icon"><?php \_e('Misc Settings', 'cmp-coming-soon-maintenance'); ?></h3> |
  |  | 822 | <table class="general"> |
  |  | 823 | <tbody> |
  |  | 824 |  |
  |  | 825 | <tr> |
  |  | 826 | <th><?php \_e('Font Awesome Icons', 'cmp-coming-soon-maintenance'); ?></th> |
  |  | 827 |  |
  |  | 828 | <td> |
  |  | 829 | <fieldset> |
  |  | 830 |  |
  |  | 831 | <label for="cmp-fa-local"> |
  |  | 832 | <input type="checkbox" name="niteoCS-fa-local" class="mode-change-toggle" id="cmp-fa-local" value="1" <?php checked('1', $cmp\_fa\_local); ?>><?php \_e('Load Font Awesome icons from a local server', 'cmp-coming-soon-maintenance'); ?> |
  |  | 833 | </label> |
  |  | 834 | </fieldset> |
  |  | 835 | </td> |
  |  | 836 | </tr> |
  |  | 837 | <?php echo $this->render\_settings->submit(); ?> |
  |  | 838 |  |
  |  | 839 | </tbody> |
  |  | 840 | </table> |
  |  | 841 |  |
  |  | 842 | </div> |
  |  | 843 |  |
  |  | 844 |  |
  |  | 845 | <div class="table-wrapper cmp-misc"> |
  |  | 846 |  |
  |  | 847 | <h3 class="no-icon"><?php \_e('Cookie Notice Compatibility', 'cmp-coming-soon-maintenance'); ?></h3> |
  |  | 848 | <table class="general"> |
  |  | 849 | <tbody> |
  |  | 850 |  |
  |  | 851 | <tr> |
  |  | 852 | <th> |
  |  | 853 | <fieldset> |
  |  | 854 | <legend class="screen-reader-text"> |
  |  | 855 | <span><?php \_e('Cookie Notice Compatibility', 'cmp-coming-soon-maintenance'); ?></span> |
  |  | 856 | </legend> |
  |  | 857 |  |
  |  | 858 | <p> |
  |  | 859 | <label title="Enabled"> |
  |  | 860 | <input type="radio" class="cmp-cookienotice" name="cmp\_cookie\_notice\_comp" value="1" <?php checked('1', $cmp\_cookie\_notice\_comp); ?>><?php \_e('Enabled', 'cmp-coming-soon-maintenance'); ?> |
  |  | 861 | </label> |
  |  | 862 | </p> |
  |  | 863 |  |
  |  | 864 | <p> |
  |  | 865 | <label title="Disabled"> |
  |  | 866 | <input type="radio" class="cmp-cookienotice" name="cmp\_cookie\_notice\_comp" value="0" <?php checked('0', $cmp\_cookie\_notice\_comp); ?>><?php \_e('Disabled', 'cmp-coming-soon-maintenance'); ?> |
  |  | 867 | </label> |
  |  | 868 | </p> |
  |  | 869 | </fieldset> |
  |  | 870 | </th> |
  |  | 871 |  |
  |  | 872 | <td> |
  |  | 873 | <div class="cmp-cookienotice-switch x1"> |
  |  | 874 | <p style="margin-top:0"><?php printf(\_\_('If %s plugin is installed and activated then Cookie notice will be automatically displayed also on Coming Soon page.', 'cmp-coming-soon-maintenance'), '<a href="https://wordpress.org/plugins/cookie-notice/" target="\_blank">Cookie Notice</a>'); ?></p> |
  | 767 | 875 | </div> |
  | 768 | 876 |  |
  | 769 |  | <div class="target-repeater-fields"> |
  | 770 |  | <?php |
  | 771 |  | if ( count( $head\_scripts )> 1 ) { |
  | 772 |  | foreach ( $head\_scripts as $id => $script ) { |
  | 773 |  | if ( $id != 0 ) {?> |
  | 774 |  | <input type="text" name="niteoCS\_head\_scripts[]" value="<?php echo esc\_attr( $script );?>" placeholder="Insert full script full URL" class="regular-text code"><a href="#cmp-misc" class="delete-head\_scripts"><i class="far fa-trash-alt"></i></a> |
  | 775 |  | <?php |
  | 776 |  | } |
  | 777 |  | } |
  | 778 |  | } ?> |
  |  | 877 | <div class="cmp-cookienotice-switch x0"> |
  |  | 878 | <p style="margin-top:0"><?php printf(\_\_('Compatibility with %s plugin is disabled.', 'cmp-coming-soon-maintenance'), '<a href="https://wordpress.org/plugins/cookie-notice/" target="\_blank">Cookie Notice</a>'); ?></p> |
  | 779 | 879 | </div> |
  | 780 | 880 |  |
  | 781 |  | </div> |
  | 782 |  |  |
  | 783 |  | <button id="add-head\_scripts" class="button"><?php \_e('Add More', 'cmp-coming-soon-maintenance');?></button> |
  | 784 |  | </fieldset> |
  | 785 |  |  |
  | 786 |  | </td> |
  | 787 |  | </tr> |
  | 788 |  |  |
  | 789 |  | <tr> |
  | 790 |  | <th><?php \_e('Footer Scripts', 'cmp-coming-soon-maintenance');?></th> |
  | 791 |  |  |
  | 792 |  | <td> |
  | 793 |  | <fieldset> |
  | 794 |  | <h4><?php \_e('Insert Javascript or CSS external file URL', 'cmp-coming-soon-maintenance');?></h4> |
  | 795 |  | <div id="wrapper-footer\_scripts"> |
  | 796 |  |  |
  | 797 |  | <div class="source-repeater-fields"> |
  | 798 |  | <input type="text" name="niteoCS\_footer\_scripts[]" value="<?php echo (empty( $footer\_scripts )) ? '' : esc\_attr( $footer\_scripts[0] );?>" placeholder="Insert script full URL" class="regular-text code"><a href="#cmp-misc" class="delete-footer\_scripts"><i class="far fa-trash-alt"></i></a> |
  | 799 |  | </div> |
  | 800 |  |  |
  | 801 |  | <div class="target-repeater-fields"> |
  | 802 |  | <?php |
  | 803 |  | if ( count( $footer\_scripts )> 1 ) { |
  | 804 |  | foreach ( $footer\_scripts as $id => $footer\_script ) { |
  | 805 |  | if ( $id != 0 ) {?> |
  | 806 |  | <input type="text" name="niteoCS\_footer\_scripts[]" value="<?php echo esc\_attr( $footer\_script );?>" placeholder="Insert script full URL" class="regular-text code"><a href="#cmp-misc" class="delete-footer\_scripts"><i class="far fa-trash-alt"></i></a> |
  | 807 |  | <?php |
  | 808 |  | } |
  | 809 |  | } |
  | 810 |  | } ?> |
  | 811 |  | </div> |
  | 812 |  |  |
  | 813 |  | </div> |
  | 814 |  |  |
  | 815 |  | <button id="add-footer\_scripts" class="button"><?php \_e('Add More', 'cmp-coming-soon-maintenance');?></button> |
  | 816 |  | </fieldset> |
  | 817 |  |  |
  | 818 |  | </td> |
  | 819 |  | </tr> |
  | 820 |  |  |
  | 821 |  | <?php echo $this->render\_settings->submit(); ?> |
  | 822 |  |  |
  | 823 |  | </tbody> |
  | 824 |  | </table> |
  | 825 |  |  |
  | 826 |  | </div> |
  | 827 |  |  |
  | 828 |  | <div class="table-wrapper cmp-misc"> |
  | 829 |  |  |
  | 830 |  | <h3 class="no-icon"><?php \_e('Misc Settings', 'cmp-coming-soon-maintenance');?></h3> |
  | 831 |  | <table class="general"> |
  | 832 |  | <tbody> |
  | 833 |  |  |
  | 834 |  | <tr> |
  | 835 |  | <th><?php \_e('Font Awesome Icons', 'cmp-coming-soon-maintenance');?></th> |
  | 836 |  |  |
  | 837 |  | <td> |
  | 838 |  | <fieldset> |
  | 839 |  |  |
  | 840 |  | <label for="cmp-fa-local"> |
  | 841 |  | <input type="checkbox" name="niteoCS-fa-local" class="mode-change-toggle" id="cmp-fa-local" value="1" <?php checked('1', $cmp\_fa\_local);?>><?php \_e('Load Font Awesome icons from a local server', 'cmp-coming-soon-maintenance');?> |
  | 842 |  | </label> |
  | 843 |  | </fieldset> |
  | 844 |  | </td> |
  | 845 |  | </tr> |
  | 846 |  | <?php echo $this->render\_settings->submit(); ?> |
  | 847 |  |  |
  | 848 |  | </tbody> |
  | 849 |  | </table> |
  | 850 |  |  |
  | 851 |  | </div> |
  | 852 |  |  |
  | 853 |  |  |
  | 854 |  | <div class="table-wrapper cmp-misc"> |
  | 855 |  |  |
  | 856 |  | <h3 class="no-icon"><?php \_e('Cookie Notice Compatibility', 'cmp-coming-soon-maintenance');?></h3> |
  | 857 |  | <table class="general"> |
  | 858 |  | <tbody> |
  | 859 |  |  |
  | 860 |  | <tr> |
  | 861 |  | <th> |
  | 862 |  | <fieldset> |
  | 863 |  | <legend class="screen-reader-text"> |
  | 864 |  | <span><?php \_e('Cookie Notice Compatibility', 'cmp-coming-soon-maintenance');?></span> |
  | 865 |  | </legend> |
  | 866 |  |  |
  | 867 |  | <p> |
  | 868 |  | <label title="Enabled"> |
  | 869 |  | <input type="radio" class="cmp-cookienotice" name="cmp\_cookie\_notice\_comp" value="1" <?php checked('1', $cmp\_cookie\_notice\_comp);?>><?php \_e('Enabled', 'cmp-coming-soon-maintenance');?> |
  | 870 |  | </label> |
  | 871 |  | </p> |
  | 872 |  |  |
  | 873 |  | <p> |
  | 874 |  | <label title="Disabled"> |
  | 875 |  | <input type="radio" class="cmp-cookienotice" name="cmp\_cookie\_notice\_comp" value="0" <?php checked('0', $cmp\_cookie\_notice\_comp);?>><?php \_e('Disabled', 'cmp-coming-soon-maintenance');?> |
  | 876 |  | </label> |
  | 877 |  | </p> |
  | 878 |  | </fieldset> |
  | 879 |  | </th> |
  | 880 |  |  |
  | 881 |  | <td> |
  | 882 |  | <div class="cmp-cookienotice-switch x1"> |
  | 883 |  | <p style="margin-top:0"><?php printf(\_\_('If %s plugin is installed and activated then Cookie notice will be automatically displayed also on Coming Soon page.', 'cmp-coming-soon-maintenance'), '<a href="https://wordpress.org/plugins/cookie-notice/" target="\_blank">Cookie Notice</a>');?></p> |
  | 884 |  | </div> |
  | 885 |  |  |
  | 886 |  | <div class="cmp-cookienotice-switch x0"> |
  | 887 |  | <p style="margin-top:0"><?php printf(\_\_('Compatibility with %s plugin is disabled.', 'cmp-coming-soon-maintenance'), '<a href="https://wordpress.org/plugins/cookie-notice/" target="\_blank">Cookie Notice</a>');?></p> |
  | 888 |  | </div> |
  | 889 |  |  |
  | 890 |  | </td> |
  | 891 |  | </tr> |
  | 892 |  | <?php echo $this->render\_settings->submit(); ?> |
  | 893 |  |  |
  | 894 |  | </tbody> |
  | 895 |  | </table> |
  | 896 |  |  |
  | 897 |  | </div> |
  | 898 |  |  |
  | 899 |  | <!-- IMPORT AND EXPORT --> |
  | 900 |  |  |
  | 901 |  | <div class="table-wrapper cmp-export-import"> |
  | 902 |  | <h3 class="no-icon"><?php \_e('Export or Import CMP Settings', 'cmp-coming-soon-maintenance');?></h3> |
  | 903 |  | <table class="general"> |
  | 904 |  | <tbody> |
  | 905 |  |  |
  | 906 |  | <tr> |
  | 907 |  | <th><?php \_e('Export CMP Settings', 'cmp-coming-soon-maintenance');?></th> |
  | 908 |  |  |
  | 909 |  | <td> |
  | 910 |  | <fieldset> |
  | 911 |  | <button id="cmp-export-json" class="cmp-button import-export-button" data-security="<?php echo esc\_attr( $ajax\_nonce );?>"><?php \_e('Export to JSON file', 'cmp-coming-soon-maintenance');?></button> |
  | 912 |  | <p class="cmp-hint"><?php \_e('You can export complete CMP Settings to external JSON file. Which can be used to backup or transfer CMP Settings to another website.', 'cmp-coming-soon-maintenance');?></p> |
  | 913 |  | </fieldset> |
  | 914 |  | </td> |
  | 915 |  | </tr> |
  | 916 |  |  |
  | 917 |  | <tr> |
  | 918 |  | <th><?php \_e('Import CMP Settings', 'cmp-coming-soon-maintenance');?></th> |
  | 919 |  |  |
  | 920 |  | <td> |
  | 921 |  | <fieldset> |
  | 922 |  | <input type="text" hidden name="cmp-import-input" id="cmp-import-input" /> |
  | 923 |  |  |
  | 924 |  | <label class='cmp-input-file'> |
  | 925 |  | <span class="cmp-button import-export-button import-json-label" data-default="<?php \_e('Select JSON file', 'cmp-coming-soon-maintenance');?>" style="display:inline-block"></span> |
  | 926 |  | <input type="file" name="cmp-import-json" id="cmp-import-json" accept=".json"> |
  | 927 |  | </label> |
  | 928 |  |  |
  | 929 |  | <p> |
  | 930 |  | <label for="cmp-import-media"><input type="checkbox" name="cmp-import-media" id="cmp-import-media" value="1"><?php \_e('Import with media images', 'cmp-coming-soon-maintenance');?></label> |
  | 931 |  | </p> |
  | 932 |  |  |
  | 933 |  | <p class="cmp-hint"><?php \_e('Insert valid JSON file with CMP Settings to import complete CMP Settings. All current settings will be overwritten.', 'cmp-coming-soon-maintenance');?></p> |
  | 934 |  |  |
  | 935 |  | </fieldset> |
  | 936 |  | </td> |
  | 937 |  | </tr> |
  | 938 |  |  |
  | 939 |  | <tr><th> |
  | 940 |  | <p class="cmp-submit"> |
  | 941 |  | <input disabled type="submit" name="submit" class="button cmp-button submit" id="cmp-import-settings" value="<?php \_e('Import Settings', 'cmp-coming-soon-maintenance');?>" form="csoptions" data-security="<?php echo esc\_attr($ajax\_nonce);?>"/> |
  | 942 |  | </p> |
  | 943 |  | </th></tr> |
  | 944 |  | </tbody> |
  | 945 |  | </table> |
  | 946 |  |  |
  | 947 |  | </div> |
  | 948 |  |  |
  | 949 |  | </div> <!-- <div class="cmp-inputs-wrapper"> --> |
  | 950 |  |  |
  | 951 |  | </div> <!-- <div class="cmp-settings-wrapper"> --> |
  | 952 |  |  |
  | 953 |  | </form> |
  | 954 |  | <?php |
  | 955 |  | // get sidebar with "widgets" |
  | 956 |  | if ( file\_exists(dirname(\_\_FILE\_\_) . '/cmp-sidebar.php') ) { |
  | 957 |  | require (dirname(\_\_FILE\_\_) . '/cmp-sidebar.php'); |
  | 958 |  | } |
  | 959 |  |  |
  | 960 |  | ?> |
  |  | 881 | </td> |
  |  | 882 | </tr> |
  |  | 883 | <?php echo $this->render\_settings->submit(); ?> |
  |  | 884 |  |
  |  | 885 | </tbody> |
  |  | 886 | </table> |
  |  | 887 |  |
  |  | 888 | </div> |
  |  | 889 |  |
  |  | 890 | <!-- IMPORT AND EXPORT --> |
  |  | 891 |  |
  |  | 892 | <div class="table-wrapper cmp-export-import"> |
  |  | 893 | <h3 class="no-icon"><?php \_e('Export or Import CMP Settings', 'cmp-coming-soon-maintenance'); ?></h3> |
  |  | 894 | <table class="general"> |
  |  | 895 | <tbody> |
  |  | 896 |  |
  |  | 897 | <tr> |
  |  | 898 | <th><?php \_e('Export CMP Settings', 'cmp-coming-soon-maintenance'); ?></th> |
  |  | 899 |  |
  |  | 900 | <td> |
  |  | 901 | <fieldset> |
  |  | 902 | <button id="cmp-export-json" class="cmp-button import-export-button" data-security="<?php echo esc\_attr($ajax\_nonce); ?>"><?php \_e('Export to JSON file', 'cmp-coming-soon-maintenance'); ?></button> |
  |  | 903 | <p class="cmp-hint"><?php \_e('You can export complete CMP Settings to external JSON file. Which can be used to backup or transfer CMP Settings to another website.', 'cmp-coming-soon-maintenance'); ?></p> |
  |  | 904 | </fieldset> |
  |  | 905 | </td> |
  |  | 906 | </tr> |
  |  | 907 |  |
  |  | 908 | <tr> |
  |  | 909 | <th><?php \_e('Import CMP Settings', 'cmp-coming-soon-maintenance'); ?></th> |
  |  | 910 |  |
  |  | 911 | <td> |
  |  | 912 | <fieldset> |
  |  | 913 | <input type="text" hidden name="cmp-import-input" id="cmp-import-input" /> |
  |  | 914 |  |
  |  | 915 | <label class='cmp-input-file'> |
  |  | 916 | <span class="cmp-button import-export-button import-json-label" data-default="<?php \_e('Select JSON file', 'cmp-coming-soon-maintenance'); ?>" style="display:inline-block"></span> |
  |  | 917 | <input type="file" name="cmp-import-json" id="cmp-import-json" accept=".json"> |
  |  | 918 | </label> |
  |  | 919 |  |
  |  | 920 | <p> |
  |  | 921 | <label for="cmp-import-media"><input type="checkbox" name="cmp-import-media" id="cmp-import-media" value="1"><?php \_e('Import with media images', 'cmp-coming-soon-maintenance'); ?></label> |
  |  | 922 | </p> |
  |  | 923 |  |
  |  | 924 | <p class="cmp-hint"><?php \_e('Insert valid JSON file with CMP Settings to import complete CMP Settings. All current settings will be overwritten.', 'cmp-coming-soon-maintenance'); ?></p> |
  |  | 925 |  |
  |  | 926 | </fieldset> |
  |  | 927 | </td> |
  |  | 928 | </tr> |
  |  | 929 |  |
  |  | 930 | <tr> |
  |  | 931 | <th> |
  |  | 932 | <p class="cmp-submit"> |
  |  | 933 | <input disabled type="submit" name="submit" class="button cmp-button submit" id="cmp-import-settings" value="<?php \_e('Import Settings', 'cmp-coming-soon-maintenance'); ?>" form="csoptions" data-security="<?php echo esc\_attr($ajax\_nonce); ?>" /> |
  |  | 934 | </p> |
  |  | 935 | </th> |
  |  | 936 | </tr> |
  |  | 937 | </tbody> |
  |  | 938 | </table> |
  |  | 939 |  |
  |  | 940 | </div> |
  |  | 941 |  |
  |  | 942 | </div> <!-- <div class="cmp-inputs-wrapper"> --> |
  |  | 943 |  |
  |  | 944 | </div> <!-- <div class="cmp-settings-wrapper"> --> |
  |  | 945 |  |
  |  | 946 | </form> |
  |  | 947 | <?php |
  |  | 948 | // get sidebar with "widgets" |
  |  | 949 | if (file\_exists(dirname(\_\_FILE\_\_) . '/cmp-sidebar.php')) { |
  |  | 950 | require(dirname(\_\_FILE\_\_) . '/cmp-sidebar.php'); |
  |  | 951 | } |
  |  | 952 |  |
  |  | 953 | ?> |
  | 961 | 954 | </div> |
  | 962 | 955 | </div> <!-- <div id="wrap"> --> |
  | 963 |  |  |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=2900571&old=2873620&new_path=%2Fcmp-coming-soon-maintenance%2Ftags%2F4.1.8%2Fcmp-advanced.php&old_path=%2Fcmp-coming-soon-maintenance%2Ftags%2F4.1.7%2Fcmp-advanced.php)
* [Zip Archive](?format=zip&new=2900571&old=2873620&new_path=%2Fcmp-coming-soon-maintenance%2Ftags%2F4.1.8%2Fcmp-advanced.php&old_path=%2Fcmp-coming-soon-maintenance%2Ftags%2F4.1.7%2Fcmp-advanced.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_e91e71a6_20250114_191723.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fcmp-coming-soon-maintenance%2Ftags%2F4.1.6%2Fniteo-cmp.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Blame](/browser/cmp-coming-soon-maintenance/tags/4.1.6/niteo-cmp.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/cmp-coming-soon-maintenance/tags/4.1.6/niteo-cmp.php)

---

# [source:](/browser?order=name "Go to repository root") [cmp-coming-soon-maintenance](/browser/cmp-coming-soon-maintenance?order=name "View cmp-coming-soon-maintenance")/[tags](/browser/cmp-coming-soon-maintenance/tags?order=name "View tags")/[4.1.6](/browser/cmp-coming-soon-maintenance/tags/4.1.6?order=name "View 4.1.6")/[niteo-cmp.php](/browser/cmp-coming-soon-maintenance/tags/4.1.6/niteo-cmp.php?order=name "View niteo-cmp.php")

View diff against:

View revision:

| [Last change](/changeset/2832889/cmp-coming-soon-maintenance/tags/4.1.6/niteo-cmp.php "View differences") on this file was [2832889](/changeset/2832889/ "View changeset 2832889"), checked in by niteo, [2 years ago](/timeline?from=2022-12-13T10%3A59%3A51Z&precision=second "See timeline at 12/13/2022 10:59:51 AM") |
| --- |
| 4.1.6 release |
| **File size:** 107.5 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\* |
| [3](#L3) | Plugin Name:           CMP - Coming Soon & Maintenance Plugin |
| [4](#L4) | Plugin URI:            https://wordpress.org/plugins/cmp-coming-soon-maintenance/ |
| [5](#L5) | Description:       Display customizable landing page for Coming Soon, Maintenance & Under Construction page. |
| [6](#L6) | Version:           4.1.6 |
| [7](#L7) | Author:            NiteoThemes |
| [8](#L8) | Author URI:        https://www.niteothemes.com |
| [9](#L9) | Text Domain:       cmp-coming-soon-maintenance |
| [10](#L10) | Domain Path:           /languages |
| [11](#L11) | License:           GPL-2.0+ |
| [12](#L12) | License URI:       http://www.gnu.org/licenses/gpl-2.0.txt |
| [13](#L13) | \*/ |
| [14](#L14) |  |
| [15](#L15) |  |
| [16](#L16) | // Exit if accessed directly. |
| [17](#L17) | if ( ! defined( 'ABSPATH' ) ) { |
| [18](#L18) | exit; |
| [19](#L19) | } |
| [20](#L20) |  |
| [21](#L21) | if ( ! class\_exists( 'CMP\_Coming\_Soon\_and\_Maintenance' ) ) : |
| [22](#L22) |  |
| [23](#L23) | /\*\* |
| [24](#L24) | \* Main CMP Coming Soon and Maintenance class. |
| [25](#L25) | \* |
| [26](#L26) | \* @since 2.8 |
| [27](#L27) | \*/ |
| [28](#L28) | class CMP\_Coming\_Soon\_and\_Maintenance { |
| [29](#L29) |  |
| [30](#L30) | /\*\* |
| [31](#L31) | \* CMP\_Coming\_Soon\_and\_Maintenance The one true CMP\_Coming\_Soon\_and\_Maintenance |
| [32](#L32) | \* |
| [33](#L33) | \* @var string $instance |
| [34](#L34) | \*/ |
| [35](#L35) | private static $instance; |
| [36](#L36) |  |
| [37](#L37) | /\*\* |
| [38](#L38) | \* Main CMP\_Coming\_Soon\_and\_Maintenance Instance. |
| [39](#L39) | \* |
| [40](#L40) | \* Insures that only one instance of CMP\_Coming\_Soon\_and\_Maintenance exists in memory at any one |
| [41](#L41) | \* time. Also prevents needing to define globals all over the place. |
| [42](#L42) | \* |
| [43](#L43) | \* Thanks Rich Tabor for teaching things about Singleton |
| [44](#L44) | \* @since 2.8 |
| [45](#L45) | \* @static |
| [46](#L46) | \* @static var array $instance |
| [47](#L47) | \* @uses CMP\_Coming\_Soon\_and\_Maintenance::init() Initiate actions and filters. |
| [48](#L48) | \* @uses CMP\_Coming\_Soon\_and\_Maintenance::cmp\_assets\_suffix() Include .min version based on CMP\_DEBUG |
| [49](#L49) | \* @uses CMP\_Coming\_Soon\_and\_Maintenance::load\_textdomain() load the language files. |
| [50](#L50) | \* @return object|CMP\_Coming\_Soon\_and\_Maintenance |
| [51](#L51) | \*/ |
| [52](#L52) | public static function instance() { |
| [53](#L53) | if ( ! isset( self::$instance ) && ! ( self::$instance instanceof CMP\_Coming\_Soon\_and\_Maintenance ) ) { |
| [54](#L54) | self::$instance = new CMP\_Coming\_Soon\_and\_Maintenance(); |
| [55](#L55) | self::$instance->constants(); |
| [56](#L56) | self::$instance->init(); |
| [57](#L57) | self::$instance->cmp\_assets\_suffix(); |
| [58](#L58) | } |
| [59](#L59) |  |
| [60](#L60) | return self::$instance; |
| [61](#L61) | } |
| [62](#L62) |  |
| [63](#L63) | // define constants |
| [64](#L64) | private function constants() { |
| [65](#L65) | $this->define( 'CMP\_VERSION', '4.1.6' ); |
| [66](#L66) | $this->define( 'CMP\_DEBUG', FALSE ); |
| [67](#L67) | $this->define( 'CMP\_AUTHOR', 'NiteoThemes' ); |
| [68](#L68) | $this->define( 'CMP\_AUTHOR\_HOMEPAGE', 'https://niteothemes.com' ); |
| [69](#L69) | $this->define( 'CMP\_PLUGIN\_DIR', plugin\_dir\_path( \_\_FILE\_\_ ) ); |
| [70](#L70) | $this->define( 'CMP\_PREMIUM\_THEMES\_DIR', plugin\_dir\_path( \_\_DIR\_\_ ) . 'cmp-premium-themes/' ); |
| [71](#L71) | $this->define( 'CMP\_PLUGIN\_URL', plugin\_dir\_url( \_\_FILE\_\_ ) ); |
| [72](#L72) | $this->define( 'CMP\_UPDATE\_URL', 'https://niteothemes.com/updates/' ); |
| [73](#L73) | CMP\_DEBUG === TRUE |
| [74](#L74) | ? $this->define( 'CMP\_LICENSE\_SERVER\_URL', 'https://niteothemes.com/dev2/' ) |
| [75](#L75) | : $this->define( 'CMP\_LICENSE\_SERVER\_URL', 'https://niteothemes.com/' ); |
| [76](#L76) | } |
| [77](#L77) |  |
| [78](#L78) | /\*\* |
| [79](#L79) | \* Inits and hooks |
| [80](#L80) | \*/ |
| [81](#L81) | public function init() { |
| [82](#L82) | do\_action( 'cmp\_plugin\_loaded'); |
| [83](#L83) | add\_action( 'init', array( $this, 'load\_textdomain' )); |
| [84](#L84) | add\_action( 'plugins\_loaded', array( $this, 'cmp\_update\_process' ), 0 ); |
| [85](#L85) | add\_action( 'template\_redirect', array( $this, 'cmp\_displayPage' ), 1 ); |
| [86](#L86) | add\_action( 'admin\_init', array( $this, 'cmp\_adminInit' ) ) ; |
| [87](#L87) | add\_action( 'admin\_menu', array( $this, 'cmp\_adminMenu' ) ); |
| [88](#L88) | add\_action( 'admin\_notices', array( $this, 'cmp\_admin\_notice' ) ); |
| [89](#L89) | add\_action( 'wp\_before\_admin\_bar\_render', array( $this, 'cmp\_admin\_bar' ) ); |
| [90](#L90) | add\_action( 'admin\_enqueue\_scripts', array( $this,'cmp\_add\_topbar\_scripts' ) ); |
| [91](#L91) | add\_action( 'admin\_enqueue\_scripts', array( $this,'cmp\_add\_admin\_style' ) ); |
| [92](#L92) | add\_action( 'wp\_enqueue\_scripts', array( $this,'cmp\_add\_topbar\_scripts' ) ); |
| [93](#L93) | add\_action( 'wp\_ajax\_cmp\_get\_post\_detail', array( $this, 'cmp\_get\_post\_detail' ) ); |
| [94](#L94) | add\_action( 'wp\_ajax\_nopriv\_cmp\_get\_post\_detail', array( $this, 'cmp\_get\_post\_detail' ) ); |
| [95](#L95) | add\_action( 'wp\_ajax\_cmp\_check\_update', array( $this, 'cmp\_check\_update' ) ); |
| [96](#L96) | add\_action( 'wp\_ajax\_cmp\_ajax\_dismiss\_activation\_notice', array( $this, 'cmp\_ajax\_dismiss\_activation\_notice' ) ); |
| [97](#L97) | add\_action( 'wp\_ajax\_niteo\_themeinfo', array( $this, 'niteo\_themeinfo' ) ); |
| [98](#L98) | add\_action( 'wp\_ajax\_niteo\_unsplash', array( $this, 'niteo\_unsplash' ) ); |
| [99](#L99) | add\_action( 'wp\_ajax\_niteo\_export\_csv', array( $this, 'niteo\_export\_csv' ) ); |
| [100](#L100) | add\_action( 'wp\_ajax\_cmp\_theme\_update\_install', array( $this, 'cmp\_theme\_update\_install' ) ); |
| [101](#L101) | add\_action( 'wp\_ajax\_cmp\_toggle\_activation', array( $this, 'cmp\_ajax\_toggle\_activation') ); |
| [102](#L102) | add\_action( 'wp\_ajax\_nopriv\_niteo\_subscribe', array( $this, 'niteo\_subscribe' ) ); |
| [103](#L103) | add\_action( 'wp\_ajax\_niteo\_subscribe', array( $this, 'niteo\_subscribe' ) ); |
| [104](#L104) | add\_action( 'wp\_ajax\_cmp\_mailchimp\_list\_ajax', array( $this, 'cmp\_mailchimp\_list\_ajax' ) ); |
| [105](#L105) | add\_action( 'wp\_ajax\_cmp\_ajax\_upload\_font', array( $this, 'cmp\_ajax\_upload\_font' ) ); |
| [106](#L106) | add\_action( 'wp\_ajax\_cmp\_ajax\_export\_settings', array( $this, 'cmp\_ajax\_export\_settings' ) ); |
| [107](#L107) | add\_action( 'wp\_ajax\_cmp\_ajax\_import\_settings', array( $this, 'cmp\_ajax\_import\_settings' ) ); |
| [108](#L108) | add\_action( 'wp\_ajax\_nopriv\_cmp\_disable\_comingsoon\_ajax', array( $this, 'cmp\_disable\_comingsoon\_ajax' ) ); |
| [109](#L109) | add\_action( 'admin\_head', array( $this, 'cmp\_admin\_css') ); |
| [110](#L110) | add\_action( 'after\_setup\_theme', array( $this, 'cmp\_create\_translation'), 10 ); |
| [111](#L111) | add\_action( 'after\_setup\_theme', array( $this, 'cmp\_register\_wpml\_strings'), 20 ); |
| [112](#L112) | add\_filter( 'upload\_mimes', array( $this, 'cmp\_allow\_font\_mimes' )); |
| [113](#L113) | add\_filter( 'plugin\_action\_links\_' . plugin\_basename(\_\_FILE\_\_), array( $this,'add\_action\_links' ) ); |
| [114](#L114) |  |
| [115](#L115) | register\_activation\_hook( \_\_FILE\_\_, array( $this, 'cmp\_activate' ) ); |
| [116](#L116) | register\_deactivation\_hook( \_\_FILE\_\_, array( $this, 'cmp\_deactivate' ) ); |
| [117](#L117) |  |
| [118](#L118) | require\_once( dirname( \_\_FILE\_\_) . '/inc/class-cmp-render\_html.php' ); |
| [119](#L119) |  |
| [120](#L120) | if ( $this->cmp\_active() === '1' && get\_option('niteoCS\_rest\_api\_status', '1') !== '1' ) { |
| [121](#L121) | add\_filter( 'rest\_authentication\_errors', array( $this, 'restrict\_rest\_api'), 0, 1 ); |
| [122](#L122) | } |
| [123](#L123) |  |
| [124](#L124) | add\_action( 'init', array( $this, 'jetpack\_stats\_compatibility' ) ); |
| [125](#L125) | } |
| [126](#L126) |  |
| [127](#L127) |  |
| [128](#L128) | /\*\* |
| [129](#L129) | \* Define constant if not already set. |
| [130](#L130) | \* |
| [131](#L131) | \* @param  string|string $name Name of the definition. |
| [132](#L132) | \* @param  string|bool   $value Default value. |
| [133](#L133) | \*/ |
| [134](#L134) | private function define( $name, $value ) { |
| [135](#L135) | if ( ! defined( $name ) ) { |
| [136](#L136) | define( $name, $value ); |
| [137](#L137) | } |
| [138](#L138) | } |
| [139](#L139) |  |
| [140](#L140) | /\*\* |
| [141](#L141) | \* Admin Init - register and enqueue scripts nad styles |
| [142](#L142) | \*/ |
| [143](#L143) | public function cmp\_adminInit() { |
| [144](#L144) | // include feedback class |
| [145](#L145) | require\_once( 'inc/class-cmp-feedback.php' ); |
| [146](#L146) |  |
| [147](#L147) | // ini render-settings class |
| [148](#L148) | require\_once('inc/class-cmp-render\_settings.php'); |
| [149](#L149) |  |
| [150](#L150) | $this->render\_settings = new cmp\_render\_settings(); |
| [151](#L151) |  |
| [152](#L152) | if ( current\_user\_can('administrator') ) { |
| [153](#L153) |  |
| [154](#L154) | wp\_register\_style( 'cmp-style',  plugins\_url('/css/cmp-settings-style'.CMP\_ASSET\_SUFFIX.'.css', \_\_FILE\_\_),'', CMP\_VERSION ); |
| [155](#L155) | wp\_register\_style( 'cmp-font-awesome',  plugins\_url('/css/font-awesome.min.css', \_\_FILE\_\_) ); |
| [156](#L156) | wp\_register\_style( 'countdown\_flatpicker\_css',  plugins\_url('/css/flatpickr.min.css', \_\_FILE\_\_) ); |
| [157](#L157) | wp\_register\_style( 'animate-css',  plugins\_url('/css/animate'.CMP\_ASSET\_SUFFIX.'.css', \_\_FILE\_\_) ); |
| [158](#L158) | wp\_register\_script( 'webfont', 'https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js', array(), '1.6.26', true ); |
| [159](#L159) | wp\_register\_script( 'cmp-select2-js',  plugins\_url('/js/external/select2.min.js', \_\_FILE\_\_) ); |
| [160](#L160) | wp\_register\_script( 'cmp-typography', plugins\_url('/js/typography'.CMP\_ASSET\_SUFFIX.'.js', \_\_FILE\_\_), array('cmp-select2-js' ), CMP\_VERSION ); |
| [161](#L161) | wp\_register\_script( 'cmp\_settings\_js',  plugins\_url('/js/settings'.CMP\_ASSET\_SUFFIX.'.js', \_\_FILE\_\_), array('webfont', 'cmp-select2-js'), CMP\_VERSION ); |
| [162](#L162) | wp\_register\_script( 'cmp\_advanced\_js',  plugins\_url('/js/cmp-advanced'.CMP\_ASSET\_SUFFIX.'.js', \_\_FILE\_\_), array(), CMP\_VERSION ); |
| [163](#L163) | wp\_register\_script( 'cmp-editor-translation',  plugins\_url('/js/cmp-editor-translation'.CMP\_ASSET\_SUFFIX.'.js', \_\_FILE\_\_), array(), CMP\_VERSION, true ); |
| [164](#L164) | wp\_register\_script( 'countdown\_flatpicker\_js',  plugins\_url('/js/external/flatpickr.min.js', \_\_FILE\_\_) ); |
| [165](#L165) |  |
| [166](#L166) | } |
| [167](#L167) |  |
| [168](#L168) | } |
| [169](#L169) |  |
| [170](#L170) | /\*\* |
| [171](#L171) | \* Add CMP updater proceess |
| [172](#L172) | \* |
| [173](#L173) | \* @since 2.8.7 |
| [174](#L174) | \*/ |
| [175](#L175) | public function cmp\_update\_process() { |
| [176](#L176) | require\_once('inc/cmp-update-process.php'); |
| [177](#L177) | } |
| [178](#L178) |  |
| [179](#L179) | /\*\* |
| [180](#L180) | \* create translation if it's has not been created |
| [181](#L181) | \* |
| [182](#L182) | \* @since 3.7.5 |
| [183](#L183) | \*/ |
| [184](#L184) |  |
| [185](#L185) | public function cmp\_create\_translation() { |
| [186](#L186) | // Populate translation list, if not yet created |
| [187](#L187) | if ( !get\_option('niteoCS\_translation') ) { |
| [188](#L188) | $translation = array( |
| [189](#L189) | 0 => array('id' => 0, 'name' => 'Counter Seconds Label', 'string' => \_\_('Seconds', 'cmp-coming-soon-maintenance'), 'translation' => \_\_('Seconds', 'cmp-coming-soon-maintenance') ), |
| [190](#L190) | 1 => array('id' => 1, 'name' => 'Counter Minutes Label', 'string' => \_\_('Minutes', 'cmp-coming-soon-maintenance'), 'translation' => \_\_('Minutes', 'cmp-coming-soon-maintenance') ), |
| [191](#L191) | 2 => array('id' => 2, 'name' => 'Counter Hours Label', 'string' => \_\_('Hours', 'cmp-coming-soon-maintenance'), 'translation' => \_\_('Hours', 'cmp-coming-soon-maintenance') ), |
| [192](#L192) | 3 => array('id' => 3, 'name' => 'Counter Days Label', 'string' => \_\_('Days', 'cmp-coming-soon-maintenance'), 'translation' => \_\_('Days', 'cmp-coming-soon-maintenance') ), |
| [193](#L193) | 4 => array('id' => 4, 'name' => 'Subscribe Form Placeholder', 'string' => \_\_('Insert your email address.', 'cmp-coming-soon-maintenance'), 'translation' => \_\_('Insert your email address.', 'cmp-coming-soon-maintenance') ), |
| [194](#L194) | 5 => array('id' => 5, 'name' => 'Subscribe Response Duplicate', 'string' => \_\_('Oops! This email address is already on our list.', 'cmp-coming-soon-maintenance'), 'translation' => \_\_('Oops! This email address is already on our list.', 'cmp-coming-soon-maintenance') ), |
| [195](#L195) | 6 => array('id' => 6, 'name' => 'Subscribe Response Not Valid', 'string' => \_\_('Oops! We need a valid email address. Please try again.', 'cmp-coming-soon-maintenance'), 'translation' => \_\_('Oops! We need a valid email address. Please try again.', 'cmp-coming-soon-maintenance') ), |
| [196](#L196) | 7 => array('id' => 7, 'name' => 'Subscribe Response Thanks', 'string' => \_\_('Thank you! Your sign up request was successful.', 'cmp-coming-soon-maintenance'), 'translation' => \_\_('Thank you! Your sign up request was successful.', 'cmp-coming-soon-maintenance') ), |
| [197](#L197) | 8 => array('id' => 8, 'name' => 'Subscribe Submit Button Label', 'string' => \_\_('Submit', 'cmp-coming-soon-maintenance'), 'translation' => \_\_('Submit', 'cmp-coming-soon-maintenance') ), |
| [198](#L198) | 9 => array('id' => 9, 'name' => 'CMP Eclipse Theme: Scroll Text', 'string' => \_\_('Scroll', 'cmp-coming-soon-maintenance'), 'translation' => \_\_('Scroll', 'cmp-coming-soon-maintenance') ), |
| [199](#L199) | 10 => array('id' => 10, 'name' => 'Subscribe Form First Name Placeholder', 'string' => \_\_('First Name', 'cmp-coming-soon-maintenance'), 'translation' => \_\_('First Name', 'cmp-coming-soon-maintenance') ), |
| [200](#L200) | 11 => array('id' => 11, 'name' => 'Subscribe Form Last Name Placeholder', 'string' => \_\_('Last Name', 'cmp-coming-soon-maintenance'), 'translation' => \_\_('Last Name', 'cmp-coming-soon-maintenance') ), |
| [201](#L201) | 12 => array('id' => 12, 'name' => 'Subscribe', 'string' => \_\_('Subscribe', 'cmp-coming-soon-maintenance'), 'translation' => \_\_('Subscribe', 'cmp-coming-soon-maintenance') ), |
| [202](#L202) | 13 => array('id' => 13, 'name' => 'Subscribe GDPR Checkbox', 'string' => \_\_('You must agree with our Terms and Conditions.', 'cmp-coming-soon-maintenance'), 'translation' =>  \_\_('You must agree with our Terms and Conditions.', 'cmp-coming-soon-maintenance') ), |
| [203](#L203) | 14 => array('id' => 14, 'name' => 'Subscribe Missing Email', 'string' => \_\_('Oops! Email is empty.', 'cmp-coming-soon-maintenance'), 'translation' =>  \_\_('Oops! Email is empty.', 'cmp-coming-soon-maintenance') ), |
| [204](#L204) | ); |
| [205](#L205) |  |
| [206](#L206) | update\_option('niteoCS\_translation', wp\_json\_encode( $translation )); |
| [207](#L207) | } |
| [208](#L208) | } |
| [209](#L209) |  |
| [210](#L210) | /\*\* |
| [211](#L211) | \* Register CMP strings to Polylang / WPML |
| [212](#L212) | \* |
| [213](#L213) | \* @since 3.7.5 |
| [214](#L214) | \*/ |
| [215](#L215) | public function cmp\_register\_wpml\_strings() { |
| [216](#L216) |  |
| [217](#L217) | if ( $this->translation\_active() ) { |
| [218](#L218) |  |
| [219](#L219) | $themeslug = $this->cmp\_selectedTheme(); |
| [220](#L220) | $translation = json\_decode( get\_option('niteoCS\_translation'), true ); |
| [221](#L221) | $overlay\_status = get\_option('niteoCS\_overlay\_text[status]', '0'); |
| [222](#L222) |  |
| [223](#L223) | $this->cmp\_register\_string( 'CMP - Coming Soon & Maintenance', 'Title', stripslashes( get\_option('niteoCS\_body\_title', 'SOMETHING IS HAPPENING!') ) ); |
| [224](#L224) | $this->cmp\_register\_string( 'CMP - Coming Soon & Maintenance', 'Copyright', stripslashes( get\_option('niteoCS\_copyright', 'Made by <a href="https://niteothemes.com">NiteoThemes</a> with love.') ) ); |
| [225](#L225) | $this->cmp\_register\_string( 'CMP - Coming Soon & Maintenance', 'Subscribe GDPR Message', stripslashes( get\_option('niteoCS\_subscribe\_label', '') ) ); |
| [226](#L226) | $this->cmp\_register\_string( 'CMP - Coming Soon & Maintenance', 'Social Icons Title', stripslashes( get\_option('niteoCS\_soc\_title', 'GET SOCIAL WITH US') ) ); |
| [227](#L227) | $this->cmp\_register\_string( 'CMP - Coming Soon & Maintenance', 'Counter Title', stripslashes( get\_option('niteoCS\_counter\_heading', 'STAY TUNED, WE ARE LAUNCHING SOON...') ) ); |
| [228](#L228) | $this->cmp\_register\_string( 'CMP - Coming Soon & Maintenance', 'Extended Footer Title', stripslashes( get\_option('niteoCS\_contact\_title', 'Quick Contacts') ) ); |
| [229](#L229) | $this->cmp\_register\_string( 'CMP - Coming Soon & Maintenance', 'Extended Footer Content', stripslashes( get\_option('niteoCS\_contact\_content', 'Lorem Ipsum is simply dummy text of the printing and typesetting industry.') ) ); |
| [230](#L230) | $this->cmp\_register\_string( 'CMP - Coming Soon & Maintenance', 'Contact Form Title', stripslashes( get\_option('niteoCS\_contact\_form\_label', 'Get in Touch') ) ); |
| [231](#L231) | $this->cmp\_register\_string( 'CMP - Coming Soon & Maintenance', 'SEO Title', stripslashes( get\_option('niteoCS\_title', get\_bloginfo('name').' Coming soon!') ) ); |
| [232](#L232) | $this->cmp\_register\_string( 'CMP - Coming Soon & Maintenance', 'SEO Description', stripslashes( get\_option('niteoCS\_descr', 'Just Another Coming Soon Page') ) ); |
| [233](#L233) | $this->cmp\_register\_string( 'CMP - Coming Soon & Maintenance', 'Subscribe Popup Form Title', stripslashes( get\_option('niteoCS\_subscribe\_popup\_title', get\_option('niteoCS\_subscribe\_title', 'SUBSCRIBE US') ) ) ); |
| [234](#L234) | $this->cmp\_register\_string( 'CMP - Coming Soon & Maintenance', 'Popup Subscribe GDPR Message',  stripslashes(get\_option('niteoCS\_subscribe\_label\_popup') ) ); |
| [235](#L235) |  |
| [236](#L236) | foreach ( $translation as $translate ) { |
| [237](#L237) | $this->cmp\_register\_string( 'CMP - Coming Soon & Maintenance', $translate['name'], stripslashes( $translate['translation'] ) ); |
| [238](#L238) | } |
| [239](#L239) |  |
| [240](#L240) | if ( $overlay\_status == '1' && in\_array( $themeslug, $this->cmp\_overlay\_text\_themes() ) ) { |
| [241](#L241) | $this->cmp\_register\_string( 'CMP - Coming Soon & Maintenance', 'Overlay Title', stripslashes( get\_option('niteoCS\_overlay\_text[heading]', 'NEW WEBSITE ON THE WAY!') ) ); |
| [242](#L242) | $this->cmp\_register\_string( 'CMP - Coming Soon & Maintenance', 'Overlay Content', stripslashes( get\_option('niteoCS\_overlay\_text[paragraph]', '') ) ); |
| [243](#L243) | $this->cmp\_register\_string( 'CMP - Coming Soon & Maintenance', 'Overlay Button Text', stripslashes( get\_option('niteoCS\_overlay\_text[button\_text]', 'Call to Action!') ) ); |
| [244](#L244) | } |
| [245](#L245) |  |
| [246](#L246) | // register strings from themes |
| [247](#L247) | if ( file\_exists( $this->cmp\_theme\_dir( $themeslug ).$themeslug.'/translation-strings.php' ) && function\_exists('icl\_register\_string') ) { |
| [248](#L248) | require\_once $this->cmp\_theme\_dir( $themeslug ).$themeslug.'/translation-strings.php'; |
| [249](#L249) | } |
| [250](#L250) | } |
| [251](#L251) | } |
| [252](#L252) |  |
| [253](#L253) | public function cmp\_register\_string( $group, $name, $string, $multiline = false ) { |
| [254](#L254) |  |
| [255](#L255) | if ( function\_exists('pll\_register\_string') ) { |
| [256](#L256) | pll\_register\_string( $name, $string, $group, $multiline ); |
| [257](#L257) |  |
| [258](#L258) | } else if ( defined( 'ICL\_SITEPRESS\_VERSION' ) ) { |
| [259](#L259) | do\_action( 'wpml\_register\_single\_string', $group, $name, $string ); |
| [260](#L260) | } |
| [261](#L261) | } |
| [262](#L262) |  |
| [263](#L263) | /\*\* |
| [264](#L264) | \* Translates given string |
| [265](#L265) | \* |
| [266](#L266) | \* @since 3.7.5 |
| [267](#L267) | \* @return string |
| [268](#L268) | \*/ |
| [269](#L269) | public function cmp\_wpml\_translate\_string( $translation, $name ) { |
| [270](#L270) |  |
| [271](#L271) | if ( defined( 'ICL\_SITEPRESS\_VERSION' ) && version\_compare( ICL\_SITEPRESS\_VERSION, '3.2', '>=' ) ) { |
| [272](#L272) | $translation = apply\_filters( 'wpml\_translate\_single\_string', $translation , 'CMP - Coming Soon & Maintenance', $name ); |
| [273](#L273) | // WPML and Polylang compatibility |
| [274](#L274) | } elseif ( function\_exists( 'icl\_t' ) ) { |
| [275](#L275) | $translation = icl\_t( 'CMP - Coming Soon & Maintenance', $name, $translation ); |
| [276](#L276) | } |
| [277](#L277) |  |
| [278](#L278) | return $translation; |
| [279](#L279) | } |
| [280](#L280) |  |
| [281](#L281) | /\*\* |
| [282](#L282) | \* Translates CMP saved option niteoCS\_translation by Polylang / WPML |
| [283](#L283) | \* |
| [284](#L284) | \* @since 3.7.5 |
| [285](#L285) | \* @return string |
| [286](#L286) | \*/ |
| [287](#L287) | public function cmp\_wpml\_niteoCS\_translation() { |
| [288](#L288) |  |
| [289](#L289) | $translation = json\_decode( get\_option('niteoCS\_translation'), true ); |
| [290](#L290) |  |
| [291](#L291) | if ( defined( 'ICL\_SITEPRESS\_VERSION' ) && version\_compare( ICL\_SITEPRESS\_VERSION, '3.2', '>=' ) ) { |
| [292](#L292) | foreach ( $translation as $key => $translate ) { |
| [293](#L293) | $translation[$key]['translation'] = apply\_filters( 'wpml\_translate\_single\_string', $translate['translation'], 'CMP - Coming Soon & Maintenance', $translate['name'] ); |
| [294](#L294) | } |
| [295](#L295) | // WPML and Polylang compatibility |
| [296](#L296) | } elseif ( function\_exists( 'icl\_t' ) ) { |
| [297](#L297) | foreach ( $translation as $key => $translate ) { |
| [298](#L298) | $translation[$key]['translation'] = icl\_t( 'CMP - Coming Soon & Maintenance', $translate['name'], $translate['translation'] ); |
| [299](#L299) | } |
| [300](#L300) | } |
| [301](#L301) |  |
| [302](#L302) | return $translation; |
| [303](#L303) | } |
| [304](#L304) |  |
| [305](#L305) | /\*\* |
| [306](#L306) | \* returns current language |
| [307](#L307) | \* |
| [308](#L308) | \* @since 3.7.5 |
| [309](#L309) | \* @return string |
| [310](#L310) | \*/ |
| [311](#L311) | public function cmp\_get\_current\_lang( $type = 'slug' ) { |
| [312](#L312) | $lang = null; |
| [313](#L313) |  |
| [314](#L314) | if ( function\_exists('pll\_current\_language') ) { |
| [315](#L315) | $lang = pll\_current\_language( $type ); |
| [316](#L316) |  |
| [317](#L317) | } else if ( defined('ICL\_LANGUAGE\_CODE') ) { |
| [318](#L318) | $lang = $type === 'slug' ? ICL\_LANGUAGE\_CODE : ICL\_LANGUAGE\_NAME; |
| [319](#L319) | } |
| [320](#L320) |  |
| [321](#L321) | return $lang; |
| [322](#L322) | } |
| [323](#L323) |  |
| [324](#L324) | /\*\* |
| [325](#L325) | \* returns configured languages slug |
| [326](#L326) | \* |
| [327](#L327) | \* @since 3.7.5 |
| [328](#L328) | \* @return array |
| [329](#L329) | \*/ |
| [330](#L330) | public function cmp\_get\_language\_list() { |
| [331](#L331) | $langs = array(); |
| [332](#L332) |  |
| [333](#L333) | if ( function\_exists('pll\_languages\_list') ) { |
| [334](#L334) | $langs = pll\_languages\_list(); |
| [335](#L335) |  |
| [336](#L336) | } else if ( defined( 'ICL\_SITEPRESS\_VERSION' ) ) { |
| [337](#L337) | $langs = apply\_filters( 'wpml\_active\_languages', NULL, array( 'skip\_missing' => 0 ) ); |
| [338](#L338) | $langs = array\_keys( $langs ); |
| [339](#L339) | } |
| [340](#L340) |  |
| [341](#L341) | return $langs; |
| [342](#L342) | } |
| [343](#L343) |  |
| [344](#L344) | /\*\* |
| [345](#L345) | \* returns default language slug |
| [346](#L346) | \* |
| [347](#L347) | \* @since 3.7.5 |
| [348](#L348) | \* @return string |
| [349](#L349) | \*/ |
| [350](#L350) | public function cmp\_get\_default\_language() { |
| [351](#L351) | $default = null; |
| [352](#L352) |  |
| [353](#L353) | if ( function\_exists('pll\_default\_language') ) { |
| [354](#L354) | $default = pll\_default\_language(); |
| [355](#L355) |  |
| [356](#L356) | } else if ( defined( 'ICL\_SITEPRESS\_VERSION' ) ) { |
| [357](#L357) | global $sitepress; |
| [358](#L358) | $default = $sitepress->get\_default\_language(); |
| [359](#L359) | } |
| [360](#L360) |  |
| [361](#L361) | return $default; |
| [362](#L362) | } |
| [363](#L363) |  |
| [364](#L364) | /\*\* |
| [365](#L365) | \* get translated object by id |
| [366](#L366) | \* |
| [367](#L367) | \* @since 3.7.5 |
| [368](#L368) | \* @return object |
| [369](#L369) | \*/ |
| [370](#L370) | public function cmp\_get\_translated\_id( $id ) { |
| [371](#L371) |  |
| [372](#L372) | if ( function\_exists('pll\_get\_post') ) { |
| [373](#L373) | $updated\_id = pll\_get\_post( $id ); |
| [374](#L374) |  |
| [375](#L375) | } else if ( defined( 'ICL\_SITEPRESS\_VERSION' ) ) { |
| [376](#L376) | $updated\_id = apply\_filters( 'wpml\_object\_id', $id ); |
| [377](#L377) | } |
| [378](#L378) |  |
| [379](#L379) | if (!$updated\_id) { |
| [380](#L380) | return $id; |
| [381](#L381) | } |
| [382](#L382) |  |
| [383](#L383) | return $updated\_id; |
| [384](#L384) | } |
| [385](#L385) |  |
| [386](#L386) | /\*\* |
| [387](#L387) | \* Define Bundled CMP themes and return them in array |
| [388](#L388) | \* |
| [389](#L389) | \* @since 2.8.3 |
| [390](#L390) | \* @return array |
| [391](#L391) | \*/ |
| [392](#L392) | public function cmp\_themes\_bundled() { |
| [393](#L393) | return array('construct', 'countdown', 'hardwork'); |
| [394](#L394) | } |
| [395](#L395) |  |
| [396](#L396) | public function cmp\_theme\_supports( $themeslug, $supports ) { |
| [397](#L397) |  |
| [398](#L398) | if ( file\_exists($this->cmp\_theme\_dir( $themeslug ).$themeslug.'/'.$themeslug . '-defaults.php') ) { |
| [399](#L399) | require $this->cmp\_theme\_dir( $themeslug ).$themeslug.'/'.$themeslug . '-defaults.php'; |
| [400](#L400) |  |
| [401](#L401) | foreach  ($theme\_supports as $key => $value ) { |
| [402](#L402) |  |
| [403](#L403) | if ( $key === $supports ) { |
| [404](#L404) | return $value; |
| [405](#L405) | } |
| [406](#L406) | } |
| [407](#L407) | } |
| [408](#L408) |  |
| [409](#L409) | return false; |
| [410](#L410) | } |
| [411](#L411) |  |
| [412](#L412) | /\*\* |
| [413](#L413) | \* Define CMP Themes Using Font Animation styles |
| [414](#L414) | \* |
| [415](#L415) | \* @since 2.8.3 |
| [416](#L416) | \* @return array |
| [417](#L417) | \*/ |
| [418](#L418) | public function cmp\_font\_animation\_themes() { |
| [419](#L419) | return array( 'hardwork\_premium', 'fifty', 'orbit', 'stylo', 'apollo', 'vega', 'pluto' ); |
| [420](#L420) | } |
| [421](#L421) |  |
| [422](#L422) | /\*\* |
| [423](#L423) | \* Define CMP Themes Using CF7 |
| [424](#L424) | \* |
| [425](#L425) | \* @since 2.8.5 |
| [426](#L426) | \* @return array |
| [427](#L427) | \*/ |
| [428](#L428) | public function cmp\_cf7\_themes() { |
| [429](#L429) | return array( 'stylo', 'agency' ); |
| [430](#L430) | } |
| [431](#L431) |  |
| [432](#L432) | /\*\* |
| [433](#L433) | \* Define CMP Themes supporting Overlay text |
| [434](#L434) | \* |
| [435](#L435) | \* @since 2.8.5 |
| [436](#L436) | \* @return array |
| [437](#L437) | \*/ |
| [438](#L438) | public function cmp\_overlay\_text\_themes() { |
| [439](#L439) | return array( 'agency' ); |
| [440](#L440) | } |
| [441](#L441) |  |
| [442](#L442) | /\*\* |
| [443](#L443) | \* Define CMP themes supporting 3rd party page builders |
| [444](#L444) | \* |
| [445](#L445) | \* @since 3.7.3 |
| [446](#L446) | \* @return array |
| [447](#L447) | \*/ |
| [448](#L448) | public function cmp\_builder\_themes() { |
| [449](#L449) | return array( 'divi', 'elementor', 'oxygen\_builder' ); |
| [450](#L450) | } |
| [451](#L451) |  |
| [452](#L452) | /\*\* |
| [453](#L453) | \* Check if WPML or Polylang is activated |
| [454](#L454) | \* |
| [455](#L455) | \* @since 3.7.9 |
| [456](#L456) | \* @return array |
| [457](#L457) | \*/ |
| [458](#L458) | public function translation\_active() { |
| [459](#L459) | return function\_exists('pll\_languages\_list') || defined('ICL\_SITEPRESS\_VERSION'); |
| [460](#L460) | } |
| [461](#L461) |  |
| [462](#L462) | /\*\* |
| [463](#L463) | \* returns array list of premium themes => manually defined |
| [464](#L464) | \* |
| [465](#L465) | \* @return array |
| [466](#L466) | \*/ |
| [467](#L467) | public function cmp\_premium\_themes() { |
| [468](#L468) |  |
| [469](#L469) | $premium\_themes = array(); |
| [470](#L470) | array\_push( $premium\_themes, array('name' => 'nova', 'url' => 'https://niteothemes.com/downloads/cmp-nova-theme/?utm\_source=cmp&utm\_medium=referral&utm\_campaign=nova', 'price' => '12') ); |
| [471](#L471) | array\_push( $premium\_themes, array('name' => 'mercury', 'url' => 'https://niteothemes.com/downloads/cmp-mercury-theme/?utm\_source=cmp&utm\_medium=referral&utm\_campaign=mercury', 'price' => '10') ); |
| [472](#L472) | array\_push( $premium\_themes, array('name' => 'fifty', 'url' => 'https://niteothemes.com/downloads/cmp-fifty-theme/?utm\_source=cmp&utm\_medium=referral&utm\_campaign=fifty', 'price' => '10') ); |
| [473](#L473) | array\_push( $premium\_themes, array('name' => 'apollo', 'url' => 'https://niteothemes.com/downloads/cmp-apollo-theme/?utm\_source=cmp&utm\_medium=referral&utm\_campaign=apollo', 'price' => '10') ); |
| [474](#L474) | array\_push( $premium\_themes, array('name' => 'loki', 'url' => 'https://niteothemes.com/downloads/cmp-loki-theme/?utm\_source=cmp&utm\_medium=referral&utm\_campaign=loki', 'price' => '12') ); |
| [475](#L475) | array\_push( $premium\_themes, array('name' => 'orion', 'url' => 'https://niteothemes.com/downloads/cmp-orion-theme/?utm\_source=cmp&utm\_medium=referral&utm\_campaign=orion', 'price' => '12') ); |
| [476](#L476) | array\_push( $premium\_themes, array('name' => 'vega', 'url' => 'https://niteothemes.com/downloads/cmp-vega-theme/?utm\_source=cmp&utm\_medium=referral&utm\_campaign=vega', 'price' => '10') ); |
| [477](#L477) | array\_push( $premium\_themes, array('name' => 'mosaic', 'url' => 'https://niteothemes.com/downloads/cmp-mosaic-theme/?utm\_source=cmp&utm\_medium=referral&utm\_campaign=mosaic', 'price' => '10') ); |
| [478](#L478) | array\_push( $premium\_themes, array('name' => 'titan', 'url' => 'https://niteothemes.com/downloads/cmp-titan-theme/?utm\_source=cmp&utm\_medium=referral&utm\_campaign=titan', 'price' => '12') ); |
| [479](#L479) | array\_push( $premium\_themes, array('name' => 'saturn', 'url' => 'https://niteothemes.com/downloads/cmp-saturn-theme/?utm\_source=cmp&utm\_medium=referral&utm\_campaign=saturn', 'price' => '12') ); |
| [480](#L480) | array\_push( $premium\_themes, array('name' => 'atlas', 'url' => 'https://niteothemes.com/downloads/cmp-atlas-theme/?utm\_source=cmp&utm\_medium=referral&utm\_campaign=atlas', 'price' => '12') ); |
| [481](#L481) | array\_push( $premium\_themes, array('name' => 'scout', 'url' => 'https://niteothemes.com/downloads/cmp-scout-theme/?utm\_source=cmp&utm\_medium=referral&utm\_campaign=scout', 'price' => '10') ); |
| [482](#L482) | array\_push( $premium\_themes, array('name' => 'libra', 'url' => 'https://niteothemes.com/downloads/cmp-libra-theme/?utm\_source=cmp&utm\_medium=referral&utm\_campaign=libra', 'price' => '10') ); |
| [483](#L483) | array\_push( $premium\_themes, array('name' => 'delta', 'url' => 'https://niteothemes.com/downloads/cmp-delta-theme/?utm\_source=cmp&utm\_medium=referral&utm\_campaign=delta', 'price' => '10') ); |
| [484](#L484) | array\_push( $premium\_themes, array('name' => 'headliner', 'url' => 'https://niteothemes.com/downloads/cmp-headliner-theme/?utm\_source=cmp&utm\_medium=referral&utm\_campaign=headliner', 'price' => '10') ); |
| [485](#L485) | array\_push( $premium\_themes, array('name' => 'elementor', 'url' => 'https://niteothemes.com/downloads/cmp-elementor-addon/?utm\_source=cmp&utm\_medium=referral&utm\_campaign=elementor', 'price' => '29') ); |
| [486](#L486) | array\_push( $premium\_themes, array('name' => 'divi', 'url' => 'https://niteothemes.com/downloads/cmp-divi-addon/?utm\_source=cmp&utm\_medium=referral&utm\_campaign=divi', 'price' => '29') ); |
| [487](#L487) | array\_push( $premium\_themes, array('name' => 'timex', 'url' => 'https://niteothemes.com/downloads/cmp-timex-theme/?utm\_source=cmp&utm\_medium=referral&utm\_campaign=timex', 'price' => '15') ); |
| [488](#L488) | array\_push( $premium\_themes, array('name' => 'thor', 'url' => 'https://niteothemes.com/downloads/cmp-thor-theme/?utm\_source=cmp&utm\_medium=referral&utm\_campaign=thor', 'price' => '10') ); |
| [489](#L489) | array\_push( $premium\_themes, array('name' => 'hardwork\_premium', 'url' => 'https://niteothemes.com/downloads/cmp-hardwork-premium/?utm\_source=cmp&utm\_medium=referral&utm\_campaign=hardwork\_premium', 'price' => '10') ); |
| [490](#L490) | array\_push( $premium\_themes, array('name' => 'tempie', 'url' => 'https://niteothemes.com/downloads/cmp-tempie-theme/?utm\_source=cmp&utm\_medium=referral&utm\_campaign=tempie', 'price' => '10') ); |
| [491](#L491) | array\_push( $premium\_themes, array('name' => 'stylo', 'url' => 'https://niteothemes.com/downloads/cmp-stylo-theme/?utm\_source=cmp&utm\_medium=referral&utm\_campaign=stylo', 'price' => '10') ); |
| [492](#L492) | array\_push( $premium\_themes, array('name' => 'ares', 'url' => 'https://niteothemes.com/downloads/cmp-ares-theme/?utm\_source=cmp&utm\_medium=referral&utm\_campaign=ares', 'price' => '10') ); |
| [493](#L493) | array\_push( $premium\_themes, array('name' => 'juno', 'url' => 'https://niteothemes.com/downloads/cmp-juno-theme/?utm\_source=cmp&utm\_medium=referral&utm\_campaign=juno', 'price' => '10') ); |
| [494](#L494) | array\_push( $premium\_themes, array('name' => 'pluto', 'url' => 'https://niteothemes.com/downloads/cmp-pluto-theme/?utm\_source=cmp&utm\_medium=referral&utm\_campaign=pluto', 'price' => '10') ); |
| [495](#L495) | array\_push( $premium\_themes, array('name' => 'agency', 'url' => 'https://niteothemes.com/downloads/cmp-agency-theme/?utm\_source=cmp&utm\_medium=referral&utm\_campaign=agency', 'price' => '15') ); |
| [496](#L496) | array\_push( $premium\_themes, array('name' => 'element', 'url' => 'https://niteothemes.com/downloads/cmp-element-theme/?utm\_source=cmp&utm\_medium=referral&utm\_campaign=element', 'price' => '10') ); |
| [497](#L497) | array\_push( $premium\_themes, array('name' => 'postery', 'url' => 'https://niteothemes.com/downloads/cmp-postery/?utm\_source=cmp&utm\_medium=referral&utm\_campaign=postery', 'price' => '10') ); |
| [498](#L498) | array\_push( $premium\_themes, array('name' => 'frame', 'url' => 'https://niteothemes.com/downloads/cmp-frame-theme/?utm\_source=cmp&utm\_medium=referral&utm\_campaign=frame', 'price' => '10') ); |
| [499](#L499) | array\_push( $premium\_themes, array('name' => 'eclipse', 'url' => 'https://niteothemes.com/downloads/cmp-eclipse-theme/?utm\_source=cmp&utm\_medium=referral&utm\_campaign=eclipse', 'price' =>'0') ); |
| [500](#L500) | array\_push( $premium\_themes, array('name' => 'orbit', 'url' => 'https://niteothemes.com/downloads/cmp-orbit-theme/?utm\_source=cmp&utm\_medium=referral&utm\_campaign=orbit', 'price' => '0') ); |
| [501](#L501) |  |
| [502](#L502) | return $premium\_themes; |
| [503](#L503) | } |
| [504](#L504) | /\*\* |
| [505](#L505) | \* Returns CMP Premium themes from PREMIUM tHEMES DIR |
| [506](#L506) | \* |
| [507](#L507) | \* @since 2.8.3 |
| [508](#L508) | \* @return array |
| [509](#L509) | \*/ |
| [510](#L510) | public function cmp\_premium\_themes\_installed() { |
| [511](#L511) | $premium\_themes = array(); |
| [512](#L512) |  |
| [513](#L513) | if ( file\_exists( CMP\_PREMIUM\_THEMES\_DIR ) ) { |
| [514](#L514) | $premium\_themes = glob( CMP\_PREMIUM\_THEMES\_DIR . '\*', GLOB\_ONLYDIR ); |
| [515](#L515) | $premium\_themes = array\_map( 'basename', $premium\_themes ); |
| [516](#L516) | } |
| [517](#L517) |  |
| [518](#L518) | return $premium\_themes; |
| [519](#L519) | } |
| [520](#L520) |  |
| [521](#L521) | /\*\* |
| [522](#L522) | \* Merge and return bundled themes with premium installed themes |
| [523](#L523) | \* |
| [524](#L524) | \* @since 2.8.3 |
| [525](#L525) | \* @return array |
| [526](#L526) | \*/ |
| [527](#L527) | public function cmp\_themes\_available() { |
| [528](#L528) | return array\_merge( $this->cmp\_themes\_bundled(), $this->cmp\_premium\_themes\_installed() ); |
| [529](#L529) | } |
| [530](#L530) |  |
| [531](#L531) | /\*\* |
| [532](#L532) | \* Enqueue admin scripts and styles |
| [533](#L533) | \*/ |
| [534](#L534) | public function cmp\_add\_topbar\_scripts() { |
| [535](#L535) |  |
| [536](#L536) | // return of user is not logged in |
| [537](#L537) | if ( !is\_user\_logged\_in() ) { |
| [538](#L538) | return; |
| [539](#L539) | } |
| [540](#L540) |  |
| [541](#L541) | // return if Top Bar Icon is disabled |
| [542](#L542) | if ( get\_option('niteoCS\_topbar\_icon', '1') == '0' ) { |
| [543](#L543) | return; |
| [544](#L544) | } |
| [545](#L545) |  |
| [546](#L546) | wp\_register\_style( 'cmp-admin-head-style',  plugins\_url('/css/cmp-admin-head.css', \_\_FILE\_\_), array(), CMP\_VERSION); |
| [547](#L547) | wp\_register\_script( 'cmp\_admin\_script',  plugins\_url('/js/cmp-admin-head.js', \_\_FILE\_\_), array('jquery'), CMP\_VERSION); |
| [548](#L548) |  |
| [549](#L549) | $roles\_topbar = json\_decode( get\_option('niteoCS\_roles\_topbar', '[]'), true ); |
| [550](#L550) |  |
| [551](#L551) | // push WP administrator to roles array, since it is default |
| [552](#L552) | array\_push( $roles\_topbar, 'administrator' ); |
| [553](#L553) |  |
| [554](#L554) |  |
| [555](#L555) |  |
| [556](#L556) | // get current user |
| [557](#L557) | $current\_user = wp\_get\_current\_user(); |
| [558](#L558) | // check for roles array length |
| [559](#L559) | if ( count( $current\_user->roles ) > 0 ) { |
| [560](#L560) | // enqueue topbar script and style only, if current user is allowed to display topbar, or is admin |
| [561](#L561) | foreach  ( $current\_user->roles as $role ) { |
| [562](#L562) | if ( in\_array( $role, $roles\_topbar ) ) { |
| [563](#L563) | wp\_enqueue\_style( 'cmp-admin-head-style' ); |
| [564](#L564) | wp\_enqueue\_script( 'cmp\_admin\_script' ); |
| [565](#L565) | wp\_localize\_script( 'cmp\_admin\_script', 'cmp\_ajax', array( 'ajax\_url' => admin\_url( 'admin-ajax.php' ) ) ); |
| [566](#L566) | break; |
| [567](#L567) | } |
| [568](#L568) | }; |
| [569](#L569) |  |
| [570](#L570) | // this one is for broken wp admin, where current user does not have any roles |
| [571](#L571) | } else { |
| [572](#L572) | wp\_enqueue\_script( 'cmp\_admin\_script' ); |
| [573](#L573) | wp\_enqueue\_style( 'cmp-admin-head-style' ); |
| [574](#L574) | } |
| [575](#L575) |  |
| [576](#L576) | } |
| [577](#L577) |  |
| [578](#L578) | /\*\* |
| [579](#L579) | \* Add CMP admin style for its settings pages |
| [580](#L580) | \* |
| [581](#L581) | \* @since 2.8.9 |
| [582](#L582) | \*/ |
| [583](#L583) | public function cmp\_add\_admin\_style($hook) { |
| [584](#L584) | // return of user is not logged in |
| [585](#L585) | if ( !is\_user\_logged\_in() ) { |
| [586](#L586) | return; |
| [587](#L587) | } |
| [588](#L588) |  |
| [589](#L589) | $prefix = sanitize\_title( \_\_( 'CMP Settings', 'cmp-coming-soon-maintenance' ) ); |
| [590](#L590) |  |
| [591](#L591) | $cmp\_pages = array( |
| [592](#L592) | 'toplevel\_page\_cmp-settings', |
| [593](#L593) | $prefix.'\_page\_cmp-advanced', |
| [594](#L594) | $prefix.'\_page\_cmp-subscribers', |
| [595](#L595) | $prefix.'\_page\_cmp-translate', |
| [596](#L596) | $prefix.'\_page\_cmp-upload-theme', |
| [597](#L597) | $prefix.'\_page\_cmp-themes-manager', |
| [598](#L598) | $prefix.'\_page\_cmp-addons', |
| [599](#L599) | ); |
| [600](#L600) |  |
| [601](#L601) | if ( in\_array( $hook, $cmp\_pages )  ) { |
| [602](#L602) | wp\_enqueue\_style( 'cmp-style' ); |
| [603](#L603) | } |
| [604](#L604) | } |
| [605](#L605) |  |
| [606](#L606) | /\*\* |
| [607](#L607) | \* Set Plugin assets minified or full path based on DEBUG mode |
| [608](#L608) | \* |
| [609](#L609) | \* @since 2.8.1 |
| [610](#L610) | \*/ |
| [611](#L611) | public function cmp\_assets\_suffix() { |
| [612](#L612) |  |
| [613](#L613) | // If there's no debug mode, use the minified assets supplied. |
| [614](#L614) | if ( ! defined( 'CMP\_DEBUG' ) ) { |
| [615](#L615) | define( 'CMP\_ASSET\_SUFFIX', '.min' ); |
| [616](#L616) | return; |
| [617](#L617) | } |
| [618](#L618) |  |
| [619](#L619) | if ( true === CMP\_DEBUG ) { |
| [620](#L620) | define( 'CMP\_ASSET\_SUFFIX', null ); |
| [621](#L621) | } else { |
| [622](#L622) | define( 'CMP\_ASSET\_SUFFIX', '.min' ); |
| [623](#L623) | } |
| [624](#L624) | } |
| [625](#L625) |  |
| [626](#L626) |  |
| [627](#L627) | /\*\* |
| [628](#L628) | \* Register CMP menus pages |
| [629](#L629) | \*/ |
| [630](#L630) | public function cmp\_adminMenu() { |
| [631](#L631) | /\* Register our plugin page \*/ |
| [632](#L632) | $page = add\_menu\_page(\_\_('CMP Settings', 'cmp-coming-soon-maintenance'), \_\_('CMP Settings', 'cmp-coming-soon-maintenance'), 'manage\_options', 'cmp-settings', array($this, 'cmp\_settings\_page'), plugins\_url('/img/cmp.png', \_\_FILE\_\_)); |
| [633](#L633) | add\_submenu\_page('cmp-settings', \_\_('CMP Basic Setup', 'cmp-coming-soon-maintenance'), \_\_('CMP Basic Setup', 'cmp-coming-soon-maintenance'), 'manage\_options', 'cmp-settings' ); |
| [634](#L634) | add\_submenu\_page('cmp-settings', \_\_('CMP Advanced Setup', 'cmp-coming-soon-maintenance'), \_\_('CMP Advanced Setup', 'cmp-coming-soon-maintenance'), 'manage\_options', 'cmp-advanced', array($this, 'cmp\_advanced\_page') ); |
| [635](#L635) | add\_submenu\_page('cmp-settings', \_\_('CMP Subscribers', 'cmp-coming-soon-maintenance'), \_\_('CMP Subscribers', 'cmp-coming-soon-maintenance'), 'manage\_options', 'cmp-subscribers', array($this, 'cmp\_subs\_page') ); |
| [636](#L636) | add\_submenu\_page('cmp-settings', \_\_('CMP Translation', 'cmp-coming-soon-maintenance'), \_\_('CMP Translation', 'cmp-coming-soon-maintenance'), 'manage\_options', 'cmp-translate', array($this, 'cmp\_translate\_page') ); |
| [637](#L637) | add\_submenu\_page('cmp-settings', \_\_('Upload CMP Theme', 'cmp-coming-soon-maintenance'), \_\_('Upload CMP Theme', 'cmp-coming-soon-maintenance'), 'manage\_options', 'cmp-upload-theme', array($this, 'cmp\_upload\_page') ); |
| [638](#L638) | /\* Using registered $page handle to hook script load \*/ |
| [639](#L639) | add\_action('admin\_print\_scripts-'.$page, array($this, 'cmp\_admin\_scripts')); |
| [640](#L640) |  |
| [641](#L641) | } |
| [642](#L642) |  |
| [643](#L643) | /\*\* |
| [644](#L644) | \* enqueue styles and scripts when navigated to CMP Settings page |
| [645](#L645) | \*/ |
| [646](#L646) | public function cmp\_admin\_scripts() { |
| [647](#L647) | wp\_enqueue\_media(); |
| [648](#L648) | if ( function\_exists( 'wp\_enqueue\_code\_editor' ) ) { |
| [649](#L649) | wp\_enqueue\_code\_editor( array( 'type' => 'text/css' ) ); |
| [650](#L650) | } |
| [651](#L651) | wp\_localize\_script( 'cmp-typography', 'fonts', array( 'google' => $this->cmp\_get\_google\_fonts() ) ); |
| [652](#L652) | wp\_enqueue\_script( 'cmp\_settings\_js' ); |
| [653](#L653) | wp\_enqueue\_script( 'cmp-typography' ); |
| [654](#L654) | wp\_enqueue\_script( 'wp-color-picker' ); |
| [655](#L655) | wp\_enqueue\_script( 'webfont' ); |
| [656](#L656) | wp\_enqueue\_script( 'cmp-select2-js' ); |
| [657](#L657) |  |
| [658](#L658) | if ( $this->translation\_active() ) { |
| [659](#L659) | $langs = $this->cmp\_get\_language\_list(); |
| [660](#L660) | $default\_lang = $this->cmp\_get\_default\_language(); |
| [661](#L661) | wp\_localize\_script( 'cmp-editor-translation', 'translation', array( 'langs' => $langs, 'default' => $default\_lang ) ); |
| [662](#L662) | wp\_enqueue\_script( 'cmp-editor-translation' ); |
| [663](#L663) | } |
| [664](#L664) |  |
| [665](#L665) | wp\_enqueue\_style( 'wp-color-picker' ); |
| [666](#L666) | wp\_enqueue\_style( 'cmp-font-awesome' ); |
| [667](#L667) |  |
| [668](#L668) | if ( in\_array( $this->cmp\_selectedTheme(), $this->cmp\_font\_animation\_themes() ) ) { |
| [669](#L669) | wp\_enqueue\_style('animate-css'); |
| [670](#L670) | } |
| [671](#L671) | } |
| [672](#L672) |  |
| [673](#L673) | function cmp\_admin\_css() { ?> |
| [674](#L674) | <style type="text/css" media="screen"> |
| [675](#L675) | #toplevel\_page\_cmp-settings img { |
| [676](#L676) | max-width: 14px!important; |
| [677](#L677) | padding-top: 5px!important; |
| [678](#L678) | } |
| [679](#L679) | </style> |
| [680](#L680) | <?php |
| [681](#L681) | } |
| [682](#L682) |  |
| [683](#L683) | /\*\* |
| [684](#L684) | \* Render CMP Settings Page |
| [685](#L685) | \*/ |
| [686](#L686) | public function cmp\_settings\_page() { |
| [687](#L687) |  |
| [688](#L688) | $this->cmp\_check\_update( $this->cmp\_selectedTheme() ); |
| [689](#L689) | require\_once ('cmp-settings.php'); |
| [690](#L690) | } |
| [691](#L691) |  |
| [692](#L692) | /\*\* |
| [693](#L693) | \* Render CMP Advanced Settings Sub Page |
| [694](#L694) | \*/ |
| [695](#L695) | public function cmp\_advanced\_page() { |
| [696](#L696) | wp\_enqueue\_script( 'cmp-select2-js' ); |
| [697](#L697) | wp\_enqueue\_script( 'cmp\_advanced\_js' ); |
| [698](#L698) | wp\_enqueue\_style( 'cmp-font-awesome' ); |
| [699](#L699) | require\_once ('cmp-advanced.php'); |
| [700](#L700) | } |
| [701](#L701) |  |
| [702](#L702) | /\*\* |
| [703](#L703) | \* Render CMP Subscribers Sub Page |
| [704](#L704) | \*/ |
| [705](#L705) | public function cmp\_subs\_page() { |
| [706](#L706) | require\_once ('cmp-subscribers.php'); |
| [707](#L707) | } |
| [708](#L708) |  |
| [709](#L709) | /\*\* |
| [710](#L710) | \* Render CMP Translation Sub Page |
| [711](#L711) | \*/ |
| [712](#L712) | public function cmp\_translate\_page() { |
| [713](#L713) | require\_once ('cmp-translate.php'); |
| [714](#L714) | } |
| [715](#L715) |  |
| [716](#L716) | /\*\* |
| [717](#L717) | \* Render CMP Upload new Theme Sub Page |
| [718](#L718) | \*/ |
| [719](#L719) | public function cmp\_upload\_page() { |
| [720](#L720) | require\_once ('cmp-upload.php'); |
| [721](#L721) | } |
| [722](#L722) |  |
| [723](#L723) | /\*\* |
| [724](#L724) | \* Load text domain |
| [725](#L725) | \*/ |
| [726](#L726) | public function load\_textdomain() { |
| [727](#L727) | load\_plugin\_textdomain( 'cmp-coming-soon-maintenance', false, dirname( plugin\_basename( \_\_FILE\_\_ ) ) . '/languages/' ); |
| [728](#L728) | } |
| [729](#L729) |  |
| [730](#L730) | /\*\* |
| [731](#L731) | \* Return CMP active status 0 or 1 |
| [732](#L732) | \* Default is 0 after CMP plugin installation |
| [733](#L733) | \* @since 3.1.2 |
| [734](#L734) | \* @return string |
| [735](#L735) | \*/ |
| [736](#L736) | public function cmp\_active() { |
| [737](#L737) | return get\_option('niteoCS\_status', '0') === '0' ? '0': '1'; |
| [738](#L738) | } |
| [739](#L739) |  |
| [740](#L740) | /\*\* |
| [741](#L741) | \* Return CMP Mode status |
| [742](#L742) | \* |
| [743](#L743) | \* @since 3.1.2 |
| [744](#L744) | \* @return string |
| [745](#L745) | \*/ |
| [746](#L746) | public function cmp\_mode() { |
| [747](#L747) | return get\_option( 'niteoCS\_activation', '2' ); |
| [748](#L748) |  |
| [749](#L749) | } |
| [750](#L750) |  |
| [751](#L751) | /\*\* |
| [752](#L752) | \* returns bundled plugin`s assets URL for Premium Themes |
| [753](#L753) | \* |
| [754](#L754) | \* @since 2.6 |
| [755](#L755) | \* @access public |
| [756](#L756) | \* @param string |
| [757](#L757) | \* @return URL string |
| [758](#L758) | \*/ |
| [759](#L759) | public function cmp\_asset\_url( $filepath ) { |
| [760](#L760) | return  plugins\_url( $filepath, \_\_FILE\_\_ ); |
| [761](#L761) | } |
| [762](#L762) |  |
| [763](#L763) | /\*\* |
| [764](#L764) | \* Overrides wp login page, Loggout current user and wp redirect, if cmp is enabled |
| [765](#L765) | \* |
| [766](#L766) | \* @access public |
| [767](#L767) | \*/ |
| [768](#L768) | // public function cmp\_admin\_override() { |
| [769](#L769) | //      // if admin is logged in or CMP is disabled, or not on page filter |
| [770](#L770) | //      if ( $this->cmp\_active() === '0' || $this->cmp\_roles\_filter() || !$this->cmp\_page\_filter() ) { |
| [771](#L771) | //              return; |
| [772](#L772) | //      } |
| [773](#L773) |  |
| [774](#L774) | //      wp\_logout(); |
| [775](#L775) | //      wp\_redirect( get\_bloginfo('url') ); |
| [776](#L776) | //      exit(); |
| [777](#L777) | // } |
| [778](#L778) |  |
| [779](#L779) | // function to display CMP landing page |
| [780](#L780) | public function cmp\_displayPage() { |
| [781](#L781) |  |
| [782](#L782) | $theme = $this->cmp\_selectedTheme(); |
| [783](#L783) |  |
| [784](#L784) | // register html class for rendering of HTML elements in Themes |
| [785](#L785) | $html = new CMP\_Coming\_Soon\_and\_Maintenance\_Render\_HTML(); |
| [786](#L786) |  |
| [787](#L787) | // check if preview is set |
| [788](#L788) | if ( isset($\_GET['cmp\_preview']) && $\_GET['cmp\_preview'] == 'true' )  { |
| [789](#L789) | $theme = isset( $\_GET['cmp\_theme'] ) ? $\_GET['cmp\_theme'] : $theme; |
| [790](#L790) |  |
| [791](#L791) | if ( !in\_array($theme, $this->cmp\_themes\_available()) ) { |
| [792](#L792) | $theme = $this->cmp\_selectedTheme(); |
| [793](#L793) | } |
| [794](#L794) |  |
| [795](#L795) | //  finally render theme preview cmp\_preview=true |
| [796](#L796) | if ( file\_exists( $this->cmp\_theme\_dir( $theme ).$theme.'/'.$theme.'-theme.php') ) { |
| [797](#L797) | require\_once ( $this->cmp\_theme\_dir( $theme ).$theme.'/'.$theme.'-theme.php' ); |
| [798](#L798) | die(); |
| [799](#L799) | } |
| [800](#L800) | } |
| [801](#L801) |  |
| [802](#L802) | // return if CMP is disabled, user bypass by role or page is whitelisted |
| [803](#L803) | if ( $this->cmp\_active() === '0' || $this->cmp\_roles\_filter() || !$this->cmp\_page\_filter() ) { |
| [804](#L804) | return; |
| [805](#L805) | } |
| [806](#L806) |  |
| [807](#L807) | // bypass CMP and set cookie for user defined period of time, if bypass is enabled,  bypass ID is set, and match CMP bypass settings |
| [808](#L808) | if ( isset( $\_GET['cmp\_bypass'] ) && $\_GET['cmp\_bypass'] == get\_option('niteoCS\_bypass\_id', md5( get\_home\_url() )) && get\_option('niteoCS\_bypass', '0') == '1' ) { |
| [809](#L809) | nocache\_headers(); |
| [810](#L810) | header('Cache-Control: max-age=0; private'); |
| [811](#L811) | setcookie('cmp\_bypass', get\_option('niteoCS\_bypass\_id', md5( get\_home\_url() ) ), time() + get\_option('niteoCS\_bypass\_expire', 172800)); |
| [812](#L812) | // exit CMP |
| [813](#L813) | return; |
| [814](#L814) | } |
| [815](#L815) |  |
| [816](#L816) | // if bypass Cookie is set, return |
| [817](#L817) | if ( isset($\_COOKIE['cmp\_bypass']) && $\_COOKIE['cmp\_bypass'] == get\_option('niteoCS\_bypass\_id', md5( get\_home\_url() ) ) && get\_option('niteoCS\_bypass', '0') == '1' ) { |
| [818](#L818) | // exit CMP |
| [819](#L819) | return; |
| [820](#L820) | } |
| [821](#L821) |  |
| [822](#L822) | // if CMP in redirect mode with 0 timeout, die early with redirect |
| [823](#L823) | if ( $this->cmp\_mode() == 3 && get\_option('niteoCS\_redirect\_time') == 0 ) { |
| [824](#L824) |  |
| [825](#L825) | $redirect\_url = get\_option('niteoCS\_URL\_redirect'); |
| [826](#L826) | // redirect to URL |
| [827](#L827) | if ( $redirect\_url != '' ) { |
| [828](#L828) | header('Location: '.esc\_url( $redirect\_url )); |
| [829](#L829) | die(); |
| [830](#L830) | } |
| [831](#L831) | } |
| [832](#L832) |  |
| [833](#L833) |  |
| [834](#L834) | // check for mailpoptin ajax |
| [835](#L835) | if ( isset($\_GET['mailoptin-ajax']) ) { |
| [836](#L836) |  |
| [837](#L837) | $campaign\_id = get\_option('niteoCS\_mailoptin\_selected'); |
| [838](#L838) | $campaign = MailOptin\Core\Repositories\OptinCampaignsRepository::get\_optin\_campaign\_by\_id($campaign\_id); |
| [839](#L839) |  |
| [840](#L840) | if ( isset($\_POST['optin\_data']) && $\_POST['optin\_data']['optin\_uuid'] == $campaign['uuid'] ) { |
| [841](#L841) | return; |
| [842](#L842) | } |
| [843](#L843) |  |
| [844](#L844) | } |
| [845](#L845) |  |
| [846](#L846) | // if themes with countdown timer |
| [847](#L847) | if ( $this->cmp\_theme\_supports( $theme, 'counter' ) ) { |
| [848](#L848) |  |
| [849](#L849) | // if counter is enabled - default yes |
| [850](#L850) | if ( get\_option('niteoCS\_counter', '1') == '1' ) { |
| [851](#L851) |  |
| [852](#L852) | // if countdown date is set - default 24 hours |
| [853](#L853) | if ( get\_option('niteoCS\_counter\_date' ) && get\_option('niteoCS\_counter\_date' ) != '' ) { |
| [854](#L854) |  |
| [855](#L855) | // if timer < timestamp do pre-set action |
| [856](#L856) | if ( get\_option('niteoCS\_counter\_date' ) < time() ) { |
| [857](#L857) |  |
| [858](#L858) | $action = get\_option('niteoCS\_countdown\_action', 'no-action'); |
| [859](#L859) |  |
| [860](#L860) | // send notification email if email transient is not set |
| [861](#L861) | if ( get\_option('niteoCS\_countdown\_notification', '1') == '1' && get\_option( 'niteoCS\_counter\_email', false ) !== 'sent' ) { |
| [862](#L862) |  |
| [863](#L863) | switch ( $action ) { |
| [864](#L864) | case 'no-action': |
| [865](#L865) | $message = \_\_('Counter expired but it is set to make no action - you should login to your Wordpress Admin and adjust the expired timer or disable Coming Soon / Maintenance Mode.', 'cmp-coming-soon-maintenance'); |
| [866](#L866) | break; |
| [867](#L867) | case 'hide': |
| [868](#L868) | $message = \_\_('Counter expired and and it is hidden on your website per settings.', 'cmp-coming-soon-maintenance'); |
| [869](#L869) | break; |
| [870](#L870) |  |
| [871](#L871) | case 'disable-cmp': |
| [872](#L872) | $message = \_\_('Counter expired and Coming soon / Maintanance mode was disabled.', 'cmp-coming-soon-maintenance'); |
| [873](#L873) | break; |
| [874](#L874) |  |
| [875](#L875) | case 'redirect': |
| [876](#L876) | $message = \_\_('Counter expired and your Website is redirected to external URL per settings.', 'cmp-coming-soon-maintenance'); |
| [877](#L877) | break; |
| [878](#L878) |  |
| [879](#L879) | default: |
| [880](#L880) | $message = ''; |
| [881](#L881) | break; |
| [882](#L882) | } |
| [883](#L883) |  |
| [884](#L884) | $to = get\_option('niteoCS\_countdown\_email\_address', get\_option( 'admin\_email' )); |
| [885](#L885) | $subject = 'Countdown timer just expired on your Coming Soon Page - ' . get\_site\_url(); |
| [886](#L886) | $body = $message . ' This is auto generated message from CMP - Coming Soon & Maintenance Plugin installed on ' . get\_site\_url(); |
| [887](#L887) | $headers = array('Content-Type: text/plain; charset=UTF-8'); |
| [888](#L888) | // send email |
| [889](#L889) | wp\_mail( $to, $subject, $body, $headers ); |
| [890](#L890) |  |
| [891](#L891) | // set email option |
| [892](#L892) | update\_option( 'niteoCS\_counter\_email', 'sent' ); |
| [893](#L893) |  |
| [894](#L894) | } |
| [895](#L895) |  |
| [896](#L896) |  |
| [897](#L897) | // if action set to redirect |
| [898](#L898) | if ( $action == 'redirect' ) { |
| [899](#L899) | $redirect\_url = esc\_url( get\_option('niteoCS\_countdown\_redirect') ); |
| [900](#L900) | header('Location: '.$redirect\_url); |
| [901](#L901) | die(); |
| [902](#L902) | } |
| [903](#L903) |  |
| [904](#L904) | } |
| [905](#L905) | } |
| [906](#L906) | } |
| [907](#L907) | } |
| [908](#L908) |  |
| [909](#L909) | // if maintanance mode send correct 503 headers |
| [910](#L910) | if ( $this->cmp\_mode() == '1' ) { |
| [911](#L911) | header('HTTP/1.1 503 Service Temporarily Unavailable'); |
| [912](#L912) | header('Status: 503 Service Temporarily Unavailable'); |
| [913](#L913) | header('Retry-After: 86400'); // retry in a day |
| [914](#L914) | } |
| [915](#L915) |  |
| [916](#L916) | // send no-cache headers if set in Settings |
| [917](#L917) | if ( get\_option('niteoCS\_seo\_nocache', '1') == '1' ){ |
| [918](#L918) | nocache\_headers(); |
| [919](#L919) | header('Cache-Control: no-cache; private'); |
| [920](#L920) | } |
| [921](#L921) |  |
| [922](#L922) | // set cookie for WPML AJAX translation |
| [923](#L923) | if ( defined('ICL\_LANGUAGE\_CODE') ) { |
| [924](#L924) | setcookie('wp-wpml\_current\_language', ICL\_LANGUAGE\_CODE, time()+3600, '/'); |
| [925](#L925) | setcookie('\_icl\_current\_language', ICL\_LANGUAGE\_CODE, time()+3600, '/'); |
| [926](#L926) | } |
| [927](#L927) |  |
| [928](#L928) | // finally render selected CMP theme |
| [929](#L929) | if ( file\_exists( $this->cmp\_theme\_dir( $theme ).$theme.'/'.$theme.'-theme.php') ) { |
| [930](#L930) | require\_once ( $this->cmp\_theme\_dir( $theme ).$theme.'/'.$theme.'-theme.php' ); |
| [931](#L931) | die(); |
| [932](#L932) | } |
| [933](#L933) |  |
| [934](#L934) | } |
| [935](#L935) |  |
| [936](#L936) | // function to toggle CMP activation for admin menu icon |
| [937](#L937) | public function cmp\_ajax\_toggle\_activation() { |
| [938](#L938) | // check for ajax payoload |
| [939](#L939) | if ( isset( $\_POST['payload'] ) && $\_POST['payload'] == 'toggle\_cmp\_status' ) { |
| [940](#L940) |  |
| [941](#L941) | // verify nonce |
| [942](#L942) | check\_ajax\_referer( 'cmp-coming-soon-ajax-secret', 'security' ); |
| [943](#L943) | // verify user rights |
| [944](#L944) | if ( !$this->cmp\_user\_can\_admin\_bar\_activation() ) { |
| [945](#L945) | echo 'Current user cannot toggle CMP activation'; |
| [946](#L946) | wp\_die(); |
| [947](#L947) | return; |
| [948](#L948) | } |
| [949](#L949) |  |
| [950](#L950) | if ( $this->cmp\_active() === '0' ) { |
| [951](#L951) | update\_option('niteoCS\_status', '1'); |
| [952](#L952) | $this->cmp\_send\_notification('on'); |
| [953](#L953) |  |
| [954](#L954) | } else { |
| [955](#L955) | update\_option('niteoCS\_status', '0'); |
| [956](#L956) | $this->cmp\_send\_notification('off'); |
| [957](#L957) | } |
| [958](#L958) |  |
| [959](#L959) | $this->cmp\_purge\_cache(); |
| [960](#L960) |  |
| [961](#L961) | echo 'success'; |
| [962](#L962) | wp\_die(); |
| [963](#L963) | return; |
| [964](#L964) | } |
| [965](#L965) | } |
| [966](#L966) |  |
| [967](#L967) | // return selected theme, defaults to hardwork |
| [968](#L968) | public function cmp\_selectedTheme() { |
| [969](#L969) | return get\_option('niteoCS\_theme', 'hardwork'); |
| [970](#L970) | } |
| [971](#L971) |  |
| [972](#L972) |  |
| [973](#L973) | // return installed theme dir path |
| [974](#L974) | public function cmp\_theme\_dir( $slug ) { |
| [975](#L975) | if ( in\_array( $slug, $this->cmp\_themes\_bundled() ) ) { |
| [976](#L976) | return CMP\_PLUGIN\_DIR . 'themes/'; |
| [977](#L977) |  |
| [978](#L978) | } else { |
| [979](#L979) | return CMP\_PREMIUM\_THEMES\_DIR; |
| [980](#L980) | } |
| [981](#L981) | } |
| [982](#L982) |  |
| [983](#L983) | // return installed theme URL |
| [984](#L984) | public function cmp\_themeURL( $slug ) { |
| [985](#L985) | if ( in\_array( $slug, $this->cmp\_themes\_bundled() ) ) { |
| [986](#L986) | return plugins\_url( '/themes/', \_\_FILE\_\_ ); |
| [987](#L987) |  |
| [988](#L988) | } else { |
| [989](#L989) | return plugins\_url( '/cmp-premium-themes/'); |
| [990](#L990) |  |
| [991](#L991) | } |
| [992](#L992) | } |
| [993](#L993) |  |
| [994](#L994) | // display admin topbar notice |
| [995](#L995) | public function cmp\_admin\_bar() { |
| [996](#L996) |  |
| [997](#L997) | $prefix = sanitize\_title( \_\_( 'CMP Settings', 'cmp-coming-soon-maintenance' ) ); |
| [998](#L998) |  |
| [999](#L999) | if ( $\_SERVER['REQUEST\_METHOD'] == 'POST' ) { |
| [1000](#L1000) | if ( current\_user\_can('publish\_pages') && function\_exists('get\_current\_screen') && is\_admin() && get\_current\_screen()->id == $prefix.'\_page\_cmp-advanced' && wp\_verify\_nonce( $\_POST['save\_options\_field'], 'save\_options' ) ) { |
| [1001](#L1001) | // check POST if user wants to enable or disable the topbar from settings |
| [1002](#L1002) | if ( isset( $\_POST['niteoCS\_topbar\_icon'] ) && is\_numeric( $\_POST['niteoCS\_topbar\_icon'] ) ) { |
| [1003](#L1003) | update\_option('niteoCS\_topbar\_icon', sanitize\_text\_field( $\_POST['niteoCS\_topbar\_icon'] )); |
| [1004](#L1004) | } |
| [1005](#L1005) |  |
| [1006](#L1006) | if ( isset( $\_POST['niteoCS\_topbar\_version'] ) ) { |
| [1007](#L1007) | update\_option('niteoCS\_topbar\_version', sanitize\_text\_field( $\_POST['niteoCS\_topbar\_version'] )); |
| [1008](#L1008) | } |
| [1009](#L1009) | } |
| [1010](#L1010) | } |
| [1011](#L1011) |  |
| [1012](#L1012) |  |
| [1013](#L1013) | if ( !$this->cmp\_user\_can\_admin\_bar\_activation() ) { |
| [1014](#L1014) | return false; |
| [1015](#L1015) | } |
| [1016](#L1016) |  |
| [1017](#L1017) | // CMP PLUGIN ACTIVATION AND STATUS CHANGE SETTINGS! |
| [1018](#L1018) | if ( $\_SERVER['REQUEST\_METHOD'] == 'POST' && ( function\_exists('get\_current\_screen') && is\_admin() && get\_current\_screen()->id == 'toplevel\_page\_cmp-settings' ) ) { |
| [1019](#L1019) |  |
| [1020](#L1020) | // verify nonce and user rights |
| [1021](#L1021) | if ( !wp\_verify\_nonce($\_POST['save\_options\_field'], 'save\_options') || !current\_user\_can('publish\_pages') ) { |
| [1022](#L1022) | die('Sorry, but this request is invalid'); |
| [1023](#L1023) | } |
| [1024](#L1024) |  |
| [1025](#L1025) | if ( isset($\_POST['activate']) && is\_numeric($\_POST['activate']) ) { |
| [1026](#L1026) | update\_option('niteoCS\_activation', sanitize\_text\_field($\_POST['activate'])); |
| [1027](#L1027) | } |
| [1028](#L1028) |  |
| [1029](#L1029) | if ( isset($\_POST['cmp\_status']) ) { |
| [1030](#L1030) | update\_option('niteoCS\_status', $this->sanitize\_checkbox($\_POST['cmp\_status'])); |
| [1031](#L1031) | $this->cmp\_send\_notification('on'); |
| [1032](#L1032) |  |
| [1033](#L1033) | } else if ( !isset($\_POST['submit\_theme']) ) { |
| [1034](#L1034) | update\_option('niteoCS\_status', '0'); |
| [1035](#L1035) | $this->cmp\_send\_notification('off'); |
| [1036](#L1036) | } |
| [1037](#L1037) | } |
| [1038](#L1038) |  |
| [1039](#L1039) | // create nonce for ajax request |
| [1040](#L1040) | $ajax\_nonce = wp\_create\_nonce( 'cmp-coming-soon-ajax-secret' ); |
| [1041](#L1041) |  |
| [1042](#L1042) | global $wp\_admin\_bar; |
| [1043](#L1043) |  |
| [1044](#L1044) | $class = ''; |
| [1045](#L1045) | $msg = ''; |
| [1046](#L1046) | $icon = '<img src="'.plugins\_url('/img/cmp.png', \_\_FILE\_\_).'" alt="CMP Logo" class="cmp-logo" style="max-width:20px;">'; |
| [1047](#L1047) |  |
| [1048](#L1048) | $topbar\_version = get\_option('niteoCS\_topbar\_version', 'cmp-topbar-full'); |
| [1049](#L1049) |  |
| [1050](#L1050) | if ( $topbar\_version === 'cmp-topbar-full' ) { |
| [1051](#L1051) | switch ( $this->cmp\_mode() ) { |
| [1052](#L1052) | case '1': |
| [1053](#L1053) | $msg = \_\_('Maintenance Mode:', 'cmp-coming-soon-maintenance'); |
| [1054](#L1054) | $class = ' maintenance'; |
| [1055](#L1055) | break; |
| [1056](#L1056) | case '2': |
| [1057](#L1057) | $msg = \_\_('Coming Soon Mode:', 'cmp-coming-soon-maintenance'); |
| [1058](#L1058) | $class = ' coming-soon'; |
| [1059](#L1059) | break; |
| [1060](#L1060) | case '3': |
| [1061](#L1061) | $msg = \_\_('Redirect Mode:', 'cmp-coming-soon-maintenance'); |
| [1062](#L1062) | $class = ' redirect'; |
| [1063](#L1063) | break; |
| [1064](#L1064) | default: |
| [1065](#L1065) | break; |
| [1066](#L1066) | } |
| [1067](#L1067) |  |
| [1068](#L1068) | $msg = '<span class="cmp-status-msg ab-label">'.$msg.'</span>'; |
| [1069](#L1069) | } |
| [1070](#L1070) |  |
| [1071](#L1071) |  |
| [1072](#L1072) | $topbar = $icon.$msg.'<div class="toggle-wrapper"><div id="cmp-status-menubar" class="toggle-checkbox"></div><div id="cmp-toggle-adminbar" class="status-' . esc\_attr( $this->cmp\_active() ) . '" data-security="'. esc\_attr( $ajax\_nonce ).'"><span class="toggle\_handler"></span></div></div>'; |
| [1073](#L1073) |  |
| [1074](#L1074) | //Add the main siteadmin menu item |
| [1075](#L1075) | $wp\_admin\_bar->add\_menu( array( |
| [1076](#L1076) | 'id'     => 'cmp-admin-notice', |
| [1077](#L1077) | 'href' => admin\_url().'admin.php?page=cmp-settings', |
| [1078](#L1078) | 'parent' => 'top-secondary', |
| [1079](#L1079) | 'title'  => $topbar, |
| [1080](#L1080) | 'meta'   => array( 'class' => 'cmp-notice'.$class ), |
| [1081](#L1081) | ) ); |
| [1082](#L1082) |  |
| [1083](#L1083) | // Display CMP Settings in topbar only for administrator |
| [1084](#L1084) | if ( current\_user\_can( 'administrator' ) ) { |
| [1085](#L1085) | $wp\_admin\_bar->add\_node( array( |
| [1086](#L1086) | 'id'     => 'cmp-basic-settings', |
| [1087](#L1087) | 'title'  => \_\_('CMP Basic Settings', 'cmp-coming-soon-maintenance'), |
| [1088](#L1088) | 'href'   => admin\_url('admin.php?page=cmp-settings'), |
| [1089](#L1089) | 'parent' => 'cmp-admin-notice' |
| [1090](#L1090) | )); |
| [1091](#L1091) |  |
| [1092](#L1092) | $wp\_admin\_bar->add\_node( array( |
| [1093](#L1093) | 'id'     => 'cmp-advanced-settings', |
| [1094](#L1094) | 'title'  => \_\_('CMP Advanced Settings', 'cmp-coming-soon-maintenance'), |
| [1095](#L1095) | 'href'   => admin\_url('admin.php?page=cmp-advanced'), |
| [1096](#L1096) | 'parent' => 'cmp-admin-notice' |
| [1097](#L1097) | )); |
| [1098](#L1098) | } |
| [1099](#L1099) |  |
| [1100](#L1100) | $wp\_admin\_bar->add\_node( array( |
| [1101](#L1101) | 'id'    => 'cmp-preview', |
| [1102](#L1102) | 'title' => \_\_('CMP Preview', 'cmp-coming-soon-maintenance'), |
| [1103](#L1103) | 'href'  => get\_site\_url().'/?cmp\_preview=true', |
| [1104](#L1104) | 'parent'=> 'cmp-admin-notice', |
| [1105](#L1105) | 'meta' => array('target' => '\_blank' ) |
| [1106](#L1106) | )); |
| [1107](#L1107) |  |
| [1108](#L1108) | } |
| [1109](#L1109) |  |
| [1110](#L1110) | public function cmp\_activate() { |
| [1111](#L1111) |  |
| [1112](#L1112) | if ( get\_option('niteoCS\_archive') ) { |
| [1113](#L1113) | //get all the options back from the archive |
| [1114](#L1114) | $options = get\_option('niteoCS\_archive'); |
| [1115](#L1115) | // update options |
| [1116](#L1116) | foreach ($options as $option) { |
| [1117](#L1117) | update\_option($option['name'], $option['value']); |
| [1118](#L1118) | } |
| [1119](#L1119) |  |
| [1120](#L1120) | update\_option( 'niteoCS\_activation\_notice', false ); |
| [1121](#L1121) |  |
| [1122](#L1122) | // delete archive |
| [1123](#L1123) | delete\_option('niteoCS\_archive'); |
| [1124](#L1124) | } |
| [1125](#L1125) | } |
| [1126](#L1126) |  |
| [1127](#L1127) | // archive plugin stuff when plugin is deactivated |
| [1128](#L1128) | public function cmp\_deactivate() { |
| [1129](#L1129) | //get all the options. store them in an array |
| [1130](#L1130) | $options = array(); |
| [1131](#L1131) |  |
| [1132](#L1132) | global $wpdb; |
| [1133](#L1133) | $saved\_options = $wpdb->get\_results( "SELECT \* FROM $wpdb->options WHERE option\_name LIKE 'niteoCS\_%'", OBJECT ); |
| [1134](#L1134) | $i = 0; |
| [1135](#L1135) | foreach ($saved\_options as $option) { |
| [1136](#L1136) | $options[$i] = array('name' => $option->option\_name, 'value' => get\_option( $option->option\_name) ); |
| [1137](#L1137) | $i++; |
| [1138](#L1138) | } |
| [1139](#L1139) |  |
| [1140](#L1140) | //store the options all in one record, in case we ever reactivate the plugin |
| [1141](#L1141) | update\_option('niteoCS\_archive', $options); |
| [1142](#L1142) |  |
| [1143](#L1143) | //delete the separate ones |
| [1144](#L1144) | foreach ( $options as $option ) { |
| [1145](#L1145) | delete\_option($option['name']); |
| [1146](#L1146) | } |
| [1147](#L1147) |  |
| [1148](#L1148) | $this->cmp\_purge\_cache(); |
| [1149](#L1149) | } |
| [1150](#L1150) |  |
| [1151](#L1151) | /\*\* |
| [1152](#L1152) | \* Difference between Premium Themes installed and Premium Themes available sets in cmp\_premium\_themes() function. |
| [1153](#L1153) | \* |
| [1154](#L1154) | \* @since 2.2 |
| [1155](#L1155) | \* @access public |
| [1156](#L1156) | \* @return array |
| [1157](#L1157) | \*/ |
| [1158](#L1158) | public function cmp\_downloadable\_themes() { |
| [1159](#L1159) | $downloadable\_themes = array(); |
| [1160](#L1160) |  |
| [1161](#L1161) | foreach ( $this->cmp\_premium\_themes() as $premium ) { |
| [1162](#L1162) | if ( !in\_array($premium['name'], $this->cmp\_premium\_themes\_installed()) ) { |
| [1163](#L1163) | array\_push( $downloadable\_themes, $premium ); |
| [1164](#L1164) | } |
| [1165](#L1165) | } |
| [1166](#L1166) |  |
| [1167](#L1167) | return $downloadable\_themes; |
| [1168](#L1168) | } |
| [1169](#L1169) |  |
| [1170](#L1170) | /\*\* |
| [1171](#L1171) | \* Disable CMP Coming Soon Mode via AJAX |
| [1172](#L1172) | \* |
| [1173](#L1173) | \* @since 3.7.6 |
| [1174](#L1174) | \* @access public |
| [1175](#L1175) | \* @return JSON |
| [1176](#L1176) | \*/ |
| [1177](#L1177) | public function cmp\_disable\_comingsoon\_ajax() { |
| [1178](#L1178) |  |
| [1179](#L1179) | $theme = $this->cmp\_selectedTheme(); |
| [1180](#L1180) |  |
| [1181](#L1181) | if ( !in\_array( $theme, $this->cmp\_builder\_themes() ) ) { |
| [1182](#L1182) | check\_ajax\_referer( 'cmp-coming-soon-maintenance-nonce', 'security' ); |
| [1183](#L1183) | } |
| [1184](#L1184) |  |
| [1185](#L1185) | $result = array( 'message' => 'error'); |
| [1186](#L1186) |  |
| [1187](#L1187) | if ( get\_option('niteoCS\_countdown\_action', 'no-action') !== 'disable-cmp' ) { |
| [1188](#L1188) | echo json\_encode( $result ); |
| [1189](#L1189) | wp\_die(); |
| [1190](#L1190) | } |
| [1191](#L1191) |  |
| [1192](#L1192) | if ( !empty( $\_REQUEST['status'] ) && $\_REQUEST['status'] === 'disable-cmp' && get\_option('niteoCS\_counter\_date' ) < time() ) { |
| [1193](#L1193) | update\_option('niteoCS\_status', '0'); |
| [1194](#L1194) | $this->cmp\_purge\_cache(); |
| [1195](#L1195) | $result = array( 'message' => 'success'); |
| [1196](#L1196) | } |
| [1197](#L1197) |  |
| [1198](#L1198) | echo json\_encode( $result ); |
| [1199](#L1199) |  |
| [1200](#L1200) | wp\_die(); |
| [1201](#L1201) | } |
| [1202](#L1202) |  |
| [1203](#L1203) | // theme updates function |
| [1204](#L1204) | public function cmp\_check\_update( $theme\_slug ) { |
| [1205](#L1205) |  |
| [1206](#L1206) | $ajax = false; |
| [1207](#L1207) | // check for ajax |
| [1208](#L1208) | if ( isset( $\_POST['theme\_slug'] ) ) { |
| [1209](#L1209) | // verify nonce |
| [1210](#L1210) | check\_ajax\_referer( 'cmp-coming-soon-ajax-secret', 'security' ); |
| [1211](#L1211) | // verify user rights |
| [1212](#L1212) | if( !current\_user\_can('publish\_pages') ) { |
| [1213](#L1213) | die('Sorry, but this request is invalid'); |
| [1214](#L1214) | } |
| [1215](#L1215) |  |
| [1216](#L1216) | // sanitize array |
| [1217](#L1217) | $\_POST = filter\_input\_array(INPUT\_POST, FILTER\_SANITIZE\_STRING); |
| [1218](#L1218) |  |
| [1219](#L1219) | if ( !empty( $\_POST['theme\_slug'] ) ) { |
| [1220](#L1220) | $theme\_slug = $\_POST['theme\_slug']; |
| [1221](#L1221) | $ajax   = true; |
| [1222](#L1222) | } |
| [1223](#L1223) | } |
| [1224](#L1224) |  |
| [1225](#L1225) | if ( !in\_array( $theme\_slug, $this->cmp\_premium\_themes\_installed() ) ) { |
| [1226](#L1226) | return; |
| [1227](#L1227) | } |
| [1228](#L1228) |  |
| [1229](#L1229) | // check for current theme version |
| [1230](#L1230) | $remote\_version = ''; |
| [1231](#L1231) | $current\_version = ''; |
| [1232](#L1232) |  |
| [1233](#L1233) | if ( CMP\_DEBUG === TRUE ) { |
| [1234](#L1234) | delete\_transient( $theme\_slug.'\_updatecheck' ); |
| [1235](#L1235) | } |
| [1236](#L1236) |  |
| [1237](#L1237) | // always check if update check transient is set or ajax request |
| [1238](#L1238) | if ( false === ( $updatecheck\_transient = get\_transient( $theme\_slug.'\_updatecheck' ) ) || $ajax === TRUE ) { |
| [1239](#L1239) |  |
| [1240](#L1240) | $current\_version = $this->cmp\_theme\_version($theme\_slug); |
| [1241](#L1241) | // get remote version from  remote server |
| [1242](#L1242) | $request = wp\_remote\_post( CMP\_UPDATE\_URL .'?action=get\_metadata&slug='.$theme\_slug, array('body' => array('action' => 'version')) ); |
| [1243](#L1243) |  |
| [1244](#L1244) | // if no error, retrivee body |
| [1245](#L1245) | if ( !is\_wp\_error( $request ) ) { |
| [1246](#L1246) |  |
| [1247](#L1247) | // decode to json |
| [1248](#L1248) | $remote\_version = json\_decode( $request['body'], true ); |
| [1249](#L1249) |  |
| [1250](#L1250) | // get remove version key |
| [1251](#L1251) | if ( isset($remote\_version['version']) ) { |
| [1252](#L1252) |  |
| [1253](#L1253) | $remote\_version = $remote\_version['version']; |
| [1254](#L1254) |  |
| [1255](#L1255) | // if remote version is bigger than current, display info about new version |
| [1256](#L1256) | if ( (float)$remote\_version > (float)$current\_version ) { |
| [1257](#L1257) |  |
| [1258](#L1258) | $title = ucwords(str\_replace('\_', ' ', $theme\_slug)); |
| [1259](#L1259) |  |
| [1260](#L1260) | // create nonce |
| [1261](#L1261) | $ajax\_nonce = wp\_create\_nonce( 'cmp-coming-soon-ajax-secret' ); |
| [1262](#L1262) |  |
| [1263](#L1263) | // if admin screen is not in updating theme |
| [1264](#L1264) | if (!isset($\_GET['theme']) || (isset($\_GET['theme']) && $\_GET['theme'] != $theme\_slug)) { |
| [1265](#L1265) |  |
| [1266](#L1266) | $transient = '<div class="notice notice-warning"><p class="message">'.sprintf(\_\_('There is a <b>recommended</b> update of <b>CMP Theme: %s</b> available:', 'cmp-coming-soon-maintenance'), $title).' <a href="'.admin\_url().'options-general.php?page=cmp-settings&action=update-cmp-theme&theme='.esc\_attr($theme\_slug).'&type=premium" class="cmp update-theme" data-type="premium" data-security="'.esc\_attr($ajax\_nonce).'" data-slug="'.esc\_attr($theme\_slug).'" data-name="'.esc\_attr($title).'" data-remote\_url="' . esc\_url( CMP\_UPDATE\_URL ) . '" data-new\_ver="' . esc\_attr( $remote\_version ) . '">'.sprintf(\_\_(' click to update to %s version from NiteoThemes server now','cmp-coming-soon-maintenance'), esc\_attr( $remote\_version )).'!</a></div>'; |
| [1267](#L1267) |  |
| [1268](#L1268) | // set transient with 12 hour expire |
| [1269](#L1269) | set\_transient( $theme\_slug.'\_updatecheck', $transient, 60\*60\*12 ); |
| [1270](#L1270) |  |
| [1271](#L1271) | // die early if this is ajax request with status = true |
| [1272](#L1272) | if ( $ajax ) { |
| [1273](#L1273) | wp\_die($remote\_version); |
| [1274](#L1274) | return; |
| [1275](#L1275) | } |
| [1276](#L1276) |  |
| [1277](#L1277) |  |
| [1278](#L1278) | echo $transient; |
| [1279](#L1279) | } |
| [1280](#L1280) |  |
| [1281](#L1281) | } else { |
| [1282](#L1282) | // die early if this is ajax request with status = false |
| [1283](#L1283) | if ( $ajax ) { |
| [1284](#L1284) | wp\_die('false'); |
| [1285](#L1285) | return; |
| [1286](#L1286) | } |
| [1287](#L1287) | // set transient no update available with 12 hours expire |
| [1288](#L1288) | set\_transient( $theme\_slug.'\_updatecheck', '', 60\*60\*12 ); |
| [1289](#L1289) | } |
| [1290](#L1290) |  |
| [1291](#L1291) | } |
| [1292](#L1292) | } |
| [1293](#L1293) |  |
| [1294](#L1294) | // empty transient means theme was updated in last 24 hours |
| [1295](#L1295) | } else if ( $updatecheck\_transient != '' ) { |
| [1296](#L1296) |  |
| [1297](#L1297) | echo $updatecheck\_transient; |
| [1298](#L1298) | } |
| [1299](#L1299) |  |
| [1300](#L1300) | if ( $ajax ) { |
| [1301](#L1301) | wp\_die('false'); |
| [1302](#L1302) | } |
| [1303](#L1303) |  |
| [1304](#L1304) | return; |
| [1305](#L1305) | } |
| [1306](#L1306) |  |
| [1307](#L1307) | public function cmp\_theme\_upload($uploadedfile) { |
| [1308](#L1308) |  |
| [1309](#L1309) | if ( !current\_user\_can('administrator') ) { |
| [1310](#L1310) | return false; |
| [1311](#L1311) | } |
| [1312](#L1312) |  |
| [1313](#L1313) | // allow zip file to upload |
| [1314](#L1314) | add\_filter('upload\_mimes', array( $this, 'cmp\_allow\_mimes') ); |
| [1315](#L1315) |  |
| [1316](#L1316) | // load PHP WP FILE |
| [1317](#L1317) | if ( ! function\_exists( 'wp\_handle\_upload' ) ) { |
| [1318](#L1318) | require\_once realpath('../../../wp-admin/includes/file.php'); |
| [1319](#L1319) | } |
| [1320](#L1320) |  |
| [1321](#L1321) | $filename               = $uploadedfile['name']; |
| [1322](#L1322) | /\* You can use wp\_check\_filetype() public function to check the |
| [1323](#L1323) | file type and go on wit the upload or stop it.\*/ |
| [1324](#L1324) | $filetype = wp\_check\_filetype( $filename ); |
| [1325](#L1325) |  |
| [1326](#L1326) | if ( $filetype['ext'] == 'zip' ) { |
| [1327](#L1327) | // Upload file |
| [1328](#L1328) | $movefile = wp\_handle\_upload( $uploadedfile, array('test\_form' => FALSE) ); |
| [1329](#L1329) |  |
| [1330](#L1330) | if ( $movefile && !isset( $movefile['error'] ) ) { |
| [1331](#L1331) |  |
| [1332](#L1332) | WP\_Filesystem(); |
| [1333](#L1333) | $source\_path            = $movefile['file']; |
| [1334](#L1334) | $theme\_name                     = str\_replace('.zip', '', $filename); |
| [1335](#L1335) | $destination\_path       = CMP\_PREMIUM\_THEMES\_DIR; |
| [1336](#L1336) |  |
| [1337](#L1337) | // create new theme DIR |
| [1338](#L1338) | if ( wp\_mkdir\_p( $destination\_path ) ) { |
| [1339](#L1339) | // Unzip FILE into that DIR |
| [1340](#L1340) | $unzipfile = unzip\_file( $source\_path, $destination\_path); |
| [1341](#L1341) |  |
| [1342](#L1342) | if ( $unzipfile ) { |
| [1343](#L1343) | // delete FILE |
| [1344](#L1344) | wp\_delete\_file( $source\_path ); |
| [1345](#L1345) |  |
| [1346](#L1346) | if ( $theme\_name == 'pluto' ) { |
| [1347](#L1347) | delete\_option('niteoCS\_banner'); |
| [1348](#L1348) | } |
| [1349](#L1349) | echo '<div class="notice notice-success is-dismissible"><p class="message">'.ucwords(str\_replace('\_', ' ', $theme\_name)).' '.\_\_(' theme was successfully installed!', 'cmp-coming-soon-maintenance').'</p></div>'; |
| [1350](#L1350) | return; |
| [1351](#L1351) |  |
| [1352](#L1352) | } else { |
| [1353](#L1353) | echo '<div class="notice notice-error is-dismissible"><p>'.\_\_('There was an error unzipping the file!', 'cmp-coming-soon-maintenance').'</p></div>'; |
| [1354](#L1354) | return; |
| [1355](#L1355) | } |
| [1356](#L1356) |  |
| [1357](#L1357) | } else { |
| [1358](#L1358) | echo '<div class="notice notice-error is-dismissible"><p>'.\_\_('Error creating Theme subdirectory!', 'cmp-coming-soon-maintenance').'</p></div>'; |
| [1359](#L1359) | return; |
| [1360](#L1360) | } |
| [1361](#L1361) |  |
| [1362](#L1362) | } else { |
| [1363](#L1363) | /\*\* |
| [1364](#L1364) | \* Error generated by \_wp\_handle\_upload() |
| [1365](#L1365) | \* @see \_wp\_handle\_upload() in wp-admin/includes/file.php |
| [1366](#L1366) | \*/ |
| [1367](#L1367) | echo '<div class="notice notice-error is-dismissible"><p>'.$movefile['error'].'</p></div>'; |
| [1368](#L1368) | return; |
| [1369](#L1369) | } |
| [1370](#L1370) | } else { |
| [1371](#L1371) | echo '<div class="notice notice-error is-dismissible"><p>'.\_\_('Unable to upload new Theme file .', 'cmp-coming-soon-maintenance'). strtoupper($filetype['ext']) .\_\_(' file extension is not supported. Please upload ZIP file containing CMP Theme.', 'cmp-coming-soon-maintenance').'</p></div>'; |
| [1372](#L1372) | return; |
| [1373](#L1373) | } |
| [1374](#L1374) |  |
| [1375](#L1375) | add\_filter('upload\_mimes', array($this, 'cmp\_remove\_mimes')); |
| [1376](#L1376) | return; |
| [1377](#L1377) | } |
| [1378](#L1378) |  |
| [1379](#L1379) | public function cmp\_theme\_update\_install( $file ) { |
| [1380](#L1380) | $ajax = false; |
| [1381](#L1381) | // check for ajax |
| [1382](#L1382) | if ( isset( $\_POST['file'] ) ) { |
| [1383](#L1383) | // verify nonce |
| [1384](#L1384) | check\_ajax\_referer( 'cmp-coming-soon-ajax-secret', 'security' ); |
| [1385](#L1385) | // verify user rights |
| [1386](#L1386) | if( !current\_user\_can('publish\_pages') ) { |
| [1387](#L1387) | die('Sorry, but this request is invalid'); |
| [1388](#L1388) | } |
| [1389](#L1389) |  |
| [1390](#L1390) | // sanitize array |
| [1391](#L1391) | $\_POST = filter\_input\_array(INPUT\_POST, FILTER\_SANITIZE\_STRING); |
| [1392](#L1392) |  |
| [1393](#L1393) | if ( !empty( $\_POST['file'] ) ) { |
| [1394](#L1394) | $file = $\_POST['file']; |
| [1395](#L1395) | $ajax   = true; |
| [1396](#L1396) | } |
| [1397](#L1397) | } |
| [1398](#L1398) |  |
| [1399](#L1399) | // load PHP WP FILE |
| [1400](#L1400) | if ( ! empty( $file ) ) { |
| [1401](#L1401) | // Download file to temp location. |
| [1402](#L1402) | $file['tmp\_name'] = download\_url( $file['url'] ); |
| [1403](#L1403) | //WARNING: The file is not automatically deleted, The script must unlink() the file. |
| [1404](#L1404) |  |
| [1405](#L1405) | // If error storing temporarily, return the error. |
| [1406](#L1406) | if ( !is\_wp\_error( $file['tmp\_name'] ) ) { |
| [1407](#L1407) | WP\_Filesystem(); |
| [1408](#L1408) |  |
| [1409](#L1409) | // create new theme DIR |
| [1410](#L1410) | if ( wp\_mkdir\_p( CMP\_PREMIUM\_THEMES\_DIR ) ) { |
| [1411](#L1411) | // Unzip FILE into that DIR |
| [1412](#L1412) | $unzipfile = unzip\_file( $file['tmp\_name'], CMP\_PREMIUM\_THEMES\_DIR ); |
| [1413](#L1413) |  |
| [1414](#L1414) | if ( !is\_wp\_error( $unzipfile ) ) { |
| [1415](#L1415) | // delete tmp FILE |
| [1416](#L1416) | wp\_delete\_file( $file['tmp\_name'] ); |
| [1417](#L1417) |  |
| [1418](#L1418) | // set transient no update available with 24 hours expire |
| [1419](#L1419) | set\_transient( $file['name'] . '\_updatecheck', '', 60\*60\*24 ); |
| [1420](#L1420) |  |
| [1421](#L1421) | // die |
| [1422](#L1422) | if ( $ajax ) { |
| [1423](#L1423) | wp\_die('success'); |
| [1424](#L1424) | return; |
| [1425](#L1425) |  |
| [1426](#L1426) | } else { |
| [1427](#L1427) | echo '<div class="notice notice-success is-dismissible"><p>CMP '. ucwords( str\_replace( '\_', ' ', $file['name'] ) ) .' '. \_\_( 'Theme has been updated to latest version!', 'cmp-coming-soon-maintenance' ).'</p></div>'; |
| [1428](#L1428) | return; |
| [1429](#L1429) | } |
| [1430](#L1430) |  |
| [1431](#L1431) | } else { |
| [1432](#L1432) | echo '<div class="notice notice-error is-dismissible"><p>'.\_\_('There was an error unzipping the file due to error: ', 'cmp-coming-soon-maintenance') . $unzipfile->get\_error\_message().'</p></div>'; |
| [1433](#L1433) |  |
| [1434](#L1434) | if ( $ajax ) { |
| [1435](#L1435) | wp\_die('error'); |
| [1436](#L1436) | return; |
| [1437](#L1437) | } |
| [1438](#L1438) | } |
| [1439](#L1439) |  |
| [1440](#L1440) | } else { |
| [1441](#L1441) | echo '<div class="notice notice-error is-dismissible"><p>'.\_\_('Error creating Theme subdirectory!', 'cmp-coming-soon-maintenance').'</p></div>'; |
| [1442](#L1442) | if ( $ajax ) { |
| [1443](#L1443) | wp\_die('error'); |
| [1444](#L1444) | return; |
| [1445](#L1445) | } |
| [1446](#L1446) | } |
| [1447](#L1447) |  |
| [1448](#L1448) | } else { |
| [1449](#L1449) | echo '<div class="notice notice-error is-dismissible"><p>'.\_\_('Error during updating Theme files:', 'cmp-coming-soon-maintenance').' '.$file['tmp\_name']->get\_error\_message().'</p></div>'; |
| [1450](#L1450) | if ( $ajax === true ) { |
| [1451](#L1451) | wp\_die('error'); |
| [1452](#L1452) | return; |
| [1453](#L1453) | } |
| [1454](#L1454) | } |
| [1455](#L1455) | } else { |
| [1456](#L1456) |  |
| [1457](#L1457) | echo '<div class="notice notice-error is-dismissible"><p>'.\_\_('General Error during updating Theme files.', 'cmp-coming-soon-maintenance').'</p></div>'; |
| [1458](#L1458) | if ( $ajax === true ) { |
| [1459](#L1459) | wp\_die('error'); |
| [1460](#L1460) | return; |
| [1461](#L1461) | } |
| [1462](#L1462) | } |
| [1463](#L1463) |  |
| [1464](#L1464) | return; |
| [1465](#L1465) | } |
| [1466](#L1466) |  |
| [1467](#L1467) |  |
| [1468](#L1468) | // build unsplash api |
| [1469](#L1469) | public function cmp\_unsplash\_api ( $query ) { |
| [1470](#L1470) |  |
| [1471](#L1471) | $api\_url = 'https://api.unsplash.com/'.$query.'&client\_id=41f043163758cf2e898e8a868bc142c20bc3f5966e7abac4779ee684088092ab' ; |
| [1472](#L1472) |  |
| [1473](#L1473) | if ( function\_exists( 'wp\_remote\_get' ) ) { |
| [1474](#L1474) |  |
| [1475](#L1475) | $response = wp\_remote\_get( $api\_url ); |
| [1476](#L1476) |  |
| [1477](#L1477) | if ( !is\_object( $response ) && isset( $response['body'] ) ) { |
| [1478](#L1478) |  |
| [1479](#L1479) | $body = $response['body']; |
| [1480](#L1480) | $data = array( 'response' => $response['response']['code'], 'body' => $body ); |
| [1481](#L1481) |  |
| [1482](#L1482) | } else { |
| [1483](#L1483) | $data = array( 'response' => 'Unplash API', 'body' => 'Not responding after 5000ms' ); |
| [1484](#L1484) | } |
| [1485](#L1485) |  |
| [1486](#L1486) | } else { |
| [1487](#L1487) | $data = array( 'response' => '500', 'body' => 'You have neither cUrl installed nor allow\_url\_fopen activated. Ask your server hosting provider to allow on of those options.' ); |
| [1488](#L1488) | } |
| [1489](#L1489) |  |
| [1490](#L1490) | return $data; |
| [1491](#L1491) | } |
| [1492](#L1492) |  |
| [1493](#L1493) | // prepare unsplash url and get unsplash photo via cmp\_unsplash\_api() |
| [1494](#L1494) | public function niteo\_unsplash( $params ) { |
| [1495](#L1495) | $ajax = false; |
| [1496](#L1496) |  |
| [1497](#L1497) | // check for ajax |
| [1498](#L1498) | if ( isset( $\_POST['params'] ) ) { |
| [1499](#L1499) | // verify nonce |
| [1500](#L1500) | check\_ajax\_referer( 'cmp-coming-soon-ajax-secret', 'security' ); |
| [1501](#L1501) | // verify user rights |
| [1502](#L1502) | if( !current\_user\_can('publish\_pages') ) { |
| [1503](#L1503) | die('Sorry, but this request is invalid'); |
| [1504](#L1504) | } |
| [1505](#L1505) |  |
| [1506](#L1506) | // sanitize array |
| [1507](#L1507) | $\_POST = filter\_input\_array(INPUT\_POST, FILTER\_SANITIZE\_STRING); |
| [1508](#L1508) |  |
| [1509](#L1509) | if ( !empty( $\_POST['params'] ) ) { |
| [1510](#L1510) | $params = $\_POST['params']; |
| [1511](#L1511) | $ajax   = true; |
| [1512](#L1512) | } |
| [1513](#L1513) | } |
| [1514](#L1514) |  |
| [1515](#L1515) | array\_key\_exists ('feed', $params)                  ? $feed                 = $params['feed']               : $feed = ''; |
| [1516](#L1516) | array\_key\_exists ('url', $params)                   ? $url                  = $params['url']                : $url = ''; |
| [1517](#L1517) | array\_key\_exists ('feat', $params)                  ? $feat                 = $params['feat']               : $feat = ''; |
| [1518](#L1518) | array\_key\_exists ('custom\_str', $params)    ? $custom\_str   = $params['custom\_str'] : $custom\_str = ''; |
| [1519](#L1519) | array\_key\_exists ('count', $params)                 ? $count                = $params['count']              : $count = '1'; |
| [1520](#L1520) |  |
| [1521](#L1521) | switch ( $feed ) { |
| [1522](#L1522) | // specific unsplash photo by url/id |
| [1523](#L1523) | case '0': |
| [1524](#L1524) | $id = ''; |
| [1525](#L1525) | // check if $query contains unsplash.com url |
| [1526](#L1526) | if ( strpos( $url, 'unsplash.com' ) !== false ) { |
| [1527](#L1527) | $parts = parse\_url( $url ); |
| [1528](#L1528) | // check for photo parameter in URL |
| [1529](#L1529) | if ( isset($parts['query'])) { |
| [1530](#L1530) | parse\_str($parts['query'], $query); |
| [1531](#L1531) | $id = $query['photo']; |
| [1532](#L1532) | } |
| [1533](#L1533) | // if no ID found, get last part of URL containing ID |
| [1534](#L1534) | if ( $id == '' ) { |
| [1535](#L1535) |  |
| [1536](#L1536) | $pathFragments = explode('/', $parts['path']); |
| [1537](#L1537) | $id = end($pathFragments); |
| [1538](#L1538) | } |
| [1539](#L1539) |  |
| [1540](#L1540) | // $query is ID |
| [1541](#L1541) | } else { |
| [1542](#L1542) | $id = $url; |
| [1543](#L1543) | } |
| [1544](#L1544) |  |
| [1545](#L1545) | // prepare query for single image |
| [1546](#L1546) | $api\_query = 'photos/'.$id.'?'; |
| [1547](#L1547) | break; |
| [1548](#L1548) |  |
| [1549](#L1549) | // random from user |
| [1550](#L1550) | case '1': |
| [1551](#L1551) |  |
| [1552](#L1552) | if ( $custom\_str[0] == '@' ) { |
| [1553](#L1553) | $custom\_str = substr($custom\_str, 1); |
| [1554](#L1554) | } |
| [1555](#L1555) |  |
| [1556](#L1556) | // prepare query for random photo from collection |
| [1557](#L1557) | $api\_query = 'photos/random/?username='.$custom\_str.'&count='.$count; |
| [1558](#L1558) | break; |
| [1559](#L1559) |  |
| [1560](#L1560) | // random from collection |
| [1561](#L1561) | case '2': |
| [1562](#L1562) | if ( is\_numeric( $url ) ) { |
| [1563](#L1563) | $collection = $url; |
| [1564](#L1564) | } else { |
| [1565](#L1565) | $collection = filter\_var($url, FILTER\_SANITIZE\_NUMBER\_INT); |
| [1566](#L1566) | $collection = str\_replace('-', '', $collection ); |
| [1567](#L1567) | } |
| [1568](#L1568) |  |
| [1569](#L1569) | // prepare query for random photo from collection |
| [1570](#L1570) | $api\_query = 'photos/random/?collections='.$collection.'&count='.$count; |
| [1571](#L1571) | break; |
| [1572](#L1572) |  |
| [1573](#L1573) | // random photo |
| [1574](#L1574) | case '3': |
| [1575](#L1575) |  |
| [1576](#L1576) | // featured |
| [1577](#L1577) | if ( $feat == '0' || $feat == '') { |
| [1578](#L1578) | $featured = 'false'; |
| [1579](#L1579) | } else { |
| [1580](#L1580) | $featured = 'true'; |
| [1581](#L1581) | } |
| [1582](#L1582) |  |
| [1583](#L1583) | // category |
| [1584](#L1584) | $search = str\_replace(' ', ',', $url); |
| [1585](#L1585) |  |
| [1586](#L1586) | if ( $search !== '' ) { |
| [1587](#L1587) | $search = 'query='.$search.'&'; |
| [1588](#L1588) | } |
| [1589](#L1589) | // prepare query for random photo |
| [1590](#L1590) | $api\_query = 'photos/random/?orientation=landscape&featured='.$featured.'&'.$search.'count='.$count; |
| [1591](#L1591) | break; |
| [1592](#L1592) |  |
| [1593](#L1593) | default: |
| [1594](#L1594) | $api\_query = 'photos/random/?orientation=landscape&count='.$count; |
| [1595](#L1595) | break; |
| [1596](#L1596) | } |
| [1597](#L1597) |  |
| [1598](#L1598) | $unsplash\_img = $this->cmp\_unsplash\_api( $api\_query ); |
| [1599](#L1599) |  |
| [1600](#L1600) | if ( $ajax === true ) { |
| [1601](#L1601) | echo json\_encode($unsplash\_img); |
| [1602](#L1602) | wp\_die(); |
| [1603](#L1603) |  |
| [1604](#L1604) | } else { |
| [1605](#L1605) | return $unsplash\_img; |
| [1606](#L1606) | } |
| [1607](#L1607) | } |
| [1608](#L1608) |  |
| [1609](#L1609) | // check value in multidimensional array |
| [1610](#L1610) | public function niteo\_in\_array\_r($needle, $haystack, $strict = false) { |
| [1611](#L1611) | foreach ( $haystack as $item ) { |
| [1612](#L1612) | if ( ( $strict ? $item === $needle : $item == $needle ) || ( is\_array( $item ) && $this->niteo\_in\_array\_r( $needle, $item, $strict ) ) ) { |
| [1613](#L1613) | return true; |
| [1614](#L1614) | } |
| [1615](#L1615) | } |
| [1616](#L1616) |  |
| [1617](#L1617) | return false; |
| [1618](#L1618) | } |
| [1619](#L1619) | /\*\* |
| [1620](#L1620) | \* Recaptcha integration |
| [1621](#L1621) | \* |
| [1622](#L1622) | \* @since 3.6.16 |
| [1623](#L1623) | \* @access public |
| [1624](#L1624) | \* @return boolean |
| [1625](#L1625) | \*/ |
| [1626](#L1626) | public function is\_human( $token ) { |
| [1627](#L1627) |  |
| [1628](#L1628) | $this->define( 'RECAPTCHA\_SECRET', get\_option('niteoCS\_recaptcha\_secret') ); |
| [1629](#L1629) |  |
| [1630](#L1630) | $request = array( |
| [1631](#L1631) | 'body' => array( |
| [1632](#L1632) | 'secret' => RECAPTCHA\_SECRET, |
| [1633](#L1633) | 'response' => $token, |
| [1634](#L1634) | ), |
| [1635](#L1635) | ); |
| [1636](#L1636) |  |
| [1637](#L1637) | $response = wp\_remote\_post( esc\_url\_raw( 'https://www.google.com/recaptcha/api/siteverify' ), $request ); |
| [1638](#L1638) | $response\_body = wp\_remote\_retrieve\_body( $response ); |
| [1639](#L1639) | $recaptcha = json\_decode( $response\_body, true ); |
| [1640](#L1640) |  |
| [1641](#L1641) | if ( $recaptcha['success'] === true & $recaptcha['score'] > 0.50 ) { |
| [1642](#L1642) | return true; |
| [1643](#L1643) | } |
| [1644](#L1644) |  |
| [1645](#L1645) | return false; |
| [1646](#L1646) |  |
| [1647](#L1647) | } |
| [1648](#L1648) |  |
| [1649](#L1649) | // save subscribe function |
| [1650](#L1650) | // $check must be true, to avoid duplicated requests after update to 2.1 |
| [1651](#L1651) | public function niteo\_subscribe( $check ) { |
| [1652](#L1652) |  |
| [1653](#L1653) | $subscribe\_method = get\_option('niteoCS\_subscribe\_method', 'cmp'); |
| [1654](#L1654) | $response = ''; |
| [1655](#L1655) |  |
| [1656](#L1656) | // get translation lists |
| [1657](#L1657) | if ( get\_option('niteoCS\_translation') ) { |
| [1658](#L1658) | $translation                = json\_decode( get\_option('niteoCS\_translation'), TRUE ); |
| [1659](#L1659) | $response\_ok                = $this->cmp\_wpml\_translate\_string( $translation[7]['translation'], 'Subscribe Response Thanks' ); |
| [1660](#L1660) | $response\_duplicate         = $this->cmp\_wpml\_translate\_string( $translation[5]['translation'], 'Subscribe Response Duplicate' ); |
| [1661](#L1661) | $response\_invalid           = $this->cmp\_wpml\_translate\_string( $translation[6]['translation'], 'Subscribe Response Not Valid' ); |
| [1662](#L1662) | } |
| [1663](#L1663) |  |
| [1664](#L1664) | $ajax = ( isset( $\_POST['ajax'] ) && $\_POST['ajax'] == TRUE ) ? TRUE : FALSE; |
| [1665](#L1665) |  |
| [1666](#L1666) | if ( $\_SERVER['REQUEST\_METHOD'] == 'POST' && isset( $\_POST['form\_honeypot'] ) && $\_POST['form\_honeypot'] === '' && isset( $\_POST['email'] ) ) : |
| [1667](#L1667) |  |
| [1668](#L1668) | if  ( $ajax ) { |
| [1669](#L1669) | check\_ajax\_referer( 'cmp-subscribe-action', 'security' ); |
| [1670](#L1670) | } |
| [1671](#L1671) |  |
| [1672](#L1672) | // check recatpcha score if integration is enabled |
| [1673](#L1673) | if ( get\_option( 'niteoCS\_recaptcha\_status', '1' ) === '1' && !empty(get\_option('niteoCS\_recaptcha\_site', ''))) { |
| [1674](#L1674) | if ( !$this->is\_human( sanitize\_text\_field( $\_POST['token'] ) ) ) { |
| [1675](#L1675) | echo json\_encode( array( 'status' => '0', 'message' => 'Sorry, robots not allowed.') ); |
| [1676](#L1676) | wp\_die(); |
| [1677](#L1677) | } |
| [1678](#L1678) | } |
| [1679](#L1679) |  |
| [1680](#L1680) | if ( filter\_var( $\_POST['email'], FILTER\_VALIDATE\_EMAIL ) ) { |
| [1681](#L1681) | // email already passed is\_email, no need to sanitize |
| [1682](#L1682) | $email = sanitize\_email( $\_POST['email'] ); |
| [1683](#L1683) |  |
| [1684](#L1684) | // sanitize all inputs |
| [1685](#L1685) | $ip\_address = ( isset( $\_POST['lastname'] ) ) ? sanitize\_text\_field($\_SERVER['REMOTE\_ADDR']) : ''; |
| [1686](#L1686) | $firstname = ( isset( $\_POST['firstname'] ) ) ? sanitize\_text\_field( $\_POST['firstname'] ) : ''; |
| [1687](#L1687) | $lastname = ( isset( $\_POST['lastname'] ) ) ? sanitize\_text\_field( $\_POST['lastname'] ) : ''; |
| [1688](#L1688) | $timestamp = time(); |
| [1689](#L1689) |  |
| [1690](#L1690) | switch ( $subscribe\_method ) { |
| [1691](#L1691) | // default custom CMP method |
| [1692](#L1692) | case 'cmp': |
| [1693](#L1693) | // get subscribe list |
| [1694](#L1694) | $subscribe\_list = get\_option('niteoCS\_subscribers\_list'); |
| [1695](#L1695) |  |
| [1696](#L1696) | // if no subscribe list yet, create first item and insert it into DB |
| [1697](#L1697) | if ( !$subscribe\_list ) { |
| [1698](#L1698) | $new\_list = array(); |
| [1699](#L1699) | $new\_email = array( 'id' => '0', 'timestamp' => $timestamp, 'email' => $email, 'ip\_address' => $ip\_address, 'firstname' => $firstname, 'lastname' => $lastname ); |
| [1700](#L1700) | array\_push( $new\_list, $new\_email ); |
| [1701](#L1701) | update\_option( 'niteoCS\_subscribers\_list', $new\_list ); |
| [1702](#L1702) | $response = array( 'status' => '1', 'message' => $response\_ok); |
| [1703](#L1703) |  |
| [1704](#L1704) | } else { |
| [1705](#L1705) | // check if email don`t already exists |
| [1706](#L1706) | if ( !$this->niteo\_in\_array\_r( $email, $subscribe\_list, true ) ) { |
| [1707](#L1707) | $count = count( $subscribe\_list ); |
| [1708](#L1708) | $new\_email = array( 'id' => $count, 'timestamp' => $timestamp, 'email' => $email, 'ip\_address' => $ip\_address, 'firstname' => $firstname, 'lastname' => $lastname ); |
| [1709](#L1709) | array\_push( $subscribe\_list, $new\_email ); |
| [1710](#L1710) | update\_option('niteoCS\_subscribers\_list', $subscribe\_list); |
| [1711](#L1711) | $response = array( 'status' => '1', 'message' => $response\_ok); |
| [1712](#L1712) | // sent notif email |
| [1713](#L1713) | if ( get\_option('niteoCS\_subscribe\_notification', '0') ) { |
| [1714](#L1714) | $subscribe\_notif\_email = get\_option('niteoCS\_subscribe\_email\_address', get\_option( 'admin\_email' )); |
| [1715](#L1715) | $subject = sprintf(\_\_('You have a new Subscriber on %s!', 'cmp-coming-soon-maintenance'), get\_site\_url()); |
| [1716](#L1716) | $body = \_\_('This is auto generated message from CMP - Coming Soon & Maintenance WordPress Plugin. You can disable these emails under CMP Advanced Settings > Email Notifications.', 'cmp-coming-soon-maintenance'); |
| [1717](#L1717) | $headers = array('Content-Type: text/plain; charset=UTF-8'); |
| [1718](#L1718) | wp\_mail( $subscribe\_notif\_email, $subject, $body, $headers ); |
| [1719](#L1719) | } |
| [1720](#L1720) |  |
| [1721](#L1721) | // if email exists return duplicate response |
| [1722](#L1722) | } else { |
| [1723](#L1723) | $response = array( 'status' => '0', 'message' => $response\_duplicate); |
| [1724](#L1724) | } |
| [1725](#L1725) | } |
| [1726](#L1726) | break; |
| [1727](#L1727) |  |
| [1728](#L1728) | // mailchimp API call |
| [1729](#L1729) | case 'mailchimp': |
| [1730](#L1730) | $api\_key        = esc\_attr( get\_option('niteoCS\_mailchimp\_apikey') ); |
| [1731](#L1731) | $list\_id        = esc\_attr( get\_option('niteoCS\_mailchimp\_list\_selected') ); |
| [1732](#L1732) | $double\_opt = get\_option( 'niteoCS\_mailchimp[double-opt]', '0' ); |
| [1733](#L1733) | $status         = ( $double\_opt == '1') ? 'pending' : 'subscribed'; // subscribed, cleaned, pending |
| [1734](#L1734) |  |
| [1735](#L1735) | $args = array( |
| [1736](#L1736) | 'method' => 'PUT', |
| [1737](#L1737) | 'headers' => array( |
| [1738](#L1738) | 'Authorization' => 'Basic ' . base64\_encode( 'user:'. $api\_key ) |
| [1739](#L1739) | ), |
| [1740](#L1740) | 'body' => json\_encode(array( |
| [1741](#L1741) | 'email\_address'         => $email, |
| [1742](#L1742) | 'status'                => $status, |
| [1743](#L1743) | 'merge\_fields'          => array( |
| [1744](#L1744) | 'FNAME'             => $firstname, |
| [1745](#L1745) | 'LNAME'             => $lastname |
| [1746](#L1746) | ) |
| [1747](#L1747) | )) |
| [1748](#L1748) | ); |
| [1749](#L1749) |  |
| [1750](#L1750) | $mailchimp = wp\_remote\_post( 'https://' . substr($api\_key,strpos($api\_key,'-')+1) . '.api.mailchimp.com/3.0/lists/'. $list\_id .'/members/' . md5(strtolower($email)), $args ); |
| [1751](#L1751) |  |
| [1752](#L1752) | if ( !is\_wp\_error( $mailchimp ) ) { |
| [1753](#L1753) |  |
| [1754](#L1754) | $body = json\_decode( $mailchimp['body'] ); |
| [1755](#L1755) |  |
| [1756](#L1756) | if ( $mailchimp['response']['code'] == 200 && $body->status == $status ) { |
| [1757](#L1757) | $response = array( 'status' => '1', 'message' => $response\_ok); |
| [1758](#L1758) |  |
| [1759](#L1759) | } else { |
| [1760](#L1760) | $response = array( 'status' => '0', 'message' => 'Error ' . $mailchimp['response']['code'] . ' ' . $body->title . ': ' . $body->detail); |
| [1761](#L1761) | } |
| [1762](#L1762) |  |
| [1763](#L1763) | } else { |
| [1764](#L1764) | $error = $mailchimp->get\_error\_message(); |
| [1765](#L1765) | $response = array( 'status' => '0', 'message' => $error); |
| [1766](#L1766) | } |
| [1767](#L1767) |  |
| [1768](#L1768) | break; |
| [1769](#L1769) |  |
| [1770](#L1770) | // MailPoet integration |
| [1771](#L1771) | case 'mailpoet': |
| [1772](#L1772) | $response = array( 'status' => '0', 'message' => \_\_('Something went wrong please try again later.', 'cmp-coming-soon-maintenance') ); |
| [1773](#L1773) | $mailpoet\_list = get\_option('niteoCS\_mailpoet\_list\_selected'); |
| [1774](#L1774) | $list\_ids = array($mailpoet\_list); |
| [1775](#L1775) | $firstname = $firstname === '' ? null : $firstname; |
| [1776](#L1776) | $lastname = $lastname === '' ? null : $lastname; |
| [1777](#L1777) | $subscriber = array( |
| [1778](#L1778) | 'email' => $email, |
| [1779](#L1779) | 'first\_name' => $firstname, |
| [1780](#L1780) | 'last\_name' => $lastname |
| [1781](#L1781) | ); |
| [1782](#L1782) |  |
| [1783](#L1783) | if ( class\_exists(\MailPoet\API\API::class) ) { |
| [1784](#L1784) | // Get MailPoet API instance |
| [1785](#L1785) | $mailpoet\_api = \MailPoet\API\API::MP('v1'); |
| [1786](#L1786) |  |
| [1787](#L1787) | // Check if subscriber exists. If subscriber doesn't exist an exception is thrown |
| [1788](#L1788) | try { |
| [1789](#L1789) | $subscribed = $mailpoet\_api->getSubscriber( $subscriber['email'] ); |
| [1790](#L1790) | } catch (\Exception $e) {} |
| [1791](#L1791) |  |
| [1792](#L1792) | try { |
| [1793](#L1793) | if (!$subscribed) { |
| [1794](#L1794) | // Subscriber doesn't exist let's create one |
| [1795](#L1795) | $mailpoet\_api->addSubscriber( $subscriber, $list\_ids ); |
| [1796](#L1796) | $response = array( 'status' => '1', 'message' => $response\_ok ); |
| [1797](#L1797) |  |
| [1798](#L1798) | } else { |
| [1799](#L1799) | // In case subscriber exists just add him to new lists |
| [1800](#L1800) | $mailpoet\_api->subscribeToLists( $subscriber['email'], $list\_ids ); |
| [1801](#L1801) | $response = array( 'status' => '1', 'message' => $response\_ok ); |
| [1802](#L1802) |  |
| [1803](#L1803) | } |
| [1804](#L1804) | } catch (\Exception $e) { |
| [1805](#L1805) | $error\_message = $e->getMessage(); |
| [1806](#L1806) | $response = array( 'status' => '0', 'message' => $error\_message ); |
| [1807](#L1807) | } |
| [1808](#L1808) |  |
| [1809](#L1809) | } |
| [1810](#L1810) |  |
| [1811](#L1811) | break; |
| [1812](#L1812) |  |
| [1813](#L1813) | // Mailster integration |
| [1814](#L1814) | case 'mailster': |
| [1815](#L1815) | $response = array( 'status' => '0', 'message' => \_\_('Something went wrong please try again later.', 'cmp-coming-soon-maintenance') ); |
| [1816](#L1816) | $mailster\_list\_id = get\_option('niteoCS\_mailster\_list\_selected'); |
| [1817](#L1817) |  |
| [1818](#L1818) | if ( function\_exists( 'mailster' ) ){ |
| [1819](#L1819) | // define to overwrite existing users |
| [1820](#L1820) | $overwrite = true; |
| [1821](#L1821) |  |
| [1822](#L1822) | // add with double opt in |
| [1823](#L1823) | $double\_opt\_in = true; |
| [1824](#L1824) |  |
| [1825](#L1825) | $subscriber = array( |
| [1826](#L1826) | 'email' => $email, |
| [1827](#L1827) | 'firstname' => $firstname, |
| [1828](#L1828) | 'lastname' => $lastname, |
| [1829](#L1829) | 'status' => get\_option( 'niteoCS\_mailster\_double\_opt', '1' ) ? 0 :1 |
| [1830](#L1830) | ); |
| [1831](#L1831) |  |
| [1832](#L1832) | // add a new subscriber and $overwrite it if exists |
| [1833](#L1833) | $subscriber\_id = mailster( 'subscribers' )->add( $subscriber, $overwrite ); |
| [1834](#L1834) |  |
| [1835](#L1835) | // if result isn't a WP\_error assign the lists |
| [1836](#L1836) | if ( ! is\_wp\_error( $subscriber\_id ) ) { |
| [1837](#L1837) | mailster( 'subscribers' )->assign\_lists( $subscriber\_id, $mailster\_list\_id ); |
| [1838](#L1838) | $response = array( 'status' => '1', 'message' => $response\_ok); |
| [1839](#L1839) |  |
| [1840](#L1840) | } else { |
| [1841](#L1841) | $response = array( 'status' => '0', 'message' => $subscriber\_id->get\_error\_message() ); |
| [1842](#L1842) | } |
| [1843](#L1843) | } |
| [1844](#L1844) |  |
| [1845](#L1845) | break; |
| [1846](#L1846) |  |
| [1847](#L1847) | default: |
| [1848](#L1848) | break; |
| [1849](#L1849) | } |
| [1850](#L1850) |  |
| [1851](#L1851) | // if not email, set response invalid |
| [1852](#L1852) | } else { |
| [1853](#L1853) | $response = array( 'status' => '0', 'message' => $response\_invalid); |
| [1854](#L1854) | } |
| [1855](#L1855) | endif; |
| [1856](#L1856) |  |
| [1857](#L1857) | if ( $ajax === TRUE ) { |
| [1858](#L1858) | echo json\_encode( $response ); |
| [1859](#L1859) | wp\_die(); |
| [1860](#L1860) |  |
| [1861](#L1861) | } else { |
| [1862](#L1862) | return ( $response == '' ) ? $response : json\_encode( $response ); |
| [1863](#L1863) | } |
| [1864](#L1864) |  |
| [1865](#L1865) | } |
| [1866](#L1866) |  |
| [1867](#L1867) | public function niteo\_export\_csv() { |
| [1868](#L1868) |  |
| [1869](#L1869) | if ( !current\_user\_can('publish\_pages') ) { |
| [1870](#L1870) | die('Sorry, but this request is invalid'); |
| [1871](#L1871) | } |
| [1872](#L1872) |  |
| [1873](#L1873) | check\_ajax\_referer( 'cmp-coming-soon-ajax-secret', 'security' ); |
| [1874](#L1874) |  |
| [1875](#L1875) | // load subscribers array |
| [1876](#L1876) | $subscribers = get\_option('niteoCS\_subscribers\_list'); |
| [1877](#L1877) |  |
| [1878](#L1878) | if( !empty($subscribers) ) { |
| [1879](#L1879) | $filename = 'cmp-subscribers-export-' . date('Y-m-d') . '.csv'; |
| [1880](#L1880) |  |
| [1881](#L1881) | header('Content-Type: text/csv'); |
| [1882](#L1882) | header('Content-Disposition: attachment;filename='.$filename); |
| [1883](#L1883) |  |
| [1884](#L1884) | $fp = fopen('php://output', 'w'); |
| [1885](#L1885) |  |
| [1886](#L1886) | fputcsv($fp, array( |
| [1887](#L1887) | \_\_('ID','cmp-coming-soon-maintenance'), |
| [1888](#L1888) | \_\_('Date','cmp-coming-soon-maintenance'), |
| [1889](#L1889) | \_\_('Email','cmp-coming-soon-maintenance'), |
| [1890](#L1890) | \_\_('Firstname','cmp-coming-soon-maintenance'), |
| [1891](#L1891) | \_\_('Lastname','cmp-coming-soon-maintenance'), |
| [1892](#L1892) | \_\_('Fullname', 'cmp-coming-soon-maintenance') |
| [1893](#L1893) | ) |
| [1894](#L1894) | ); |
| [1895](#L1895) | foreach ( $subscribers as $key => $value ) { |
| [1896](#L1896) |  |
| [1897](#L1897) | if ( isset( $value['ip\_address'] ) ) { |
| [1898](#L1898) | unset($subscribers[$key]['ip\_address']); |
| [1899](#L1899) | } |
| [1900](#L1900) |  |
| [1901](#L1901) | if ( isset( $value['timestamp'] ) )     { |
| [1902](#L1902) | $format="Y-m-d H:i:s"; |
| [1903](#L1903) | $subscribers[$key]['timestamp'] = date\_i18n($format, $subscribers[$key]['timestamp']); |
| [1904](#L1904) | } |
| [1905](#L1905) |  |
| [1906](#L1906) | $subscribers[$key]['Name'] = ''; |
| [1907](#L1907) |  |
| [1908](#L1908) | if ( $value['firstname'] !== '' || $value['lastname'] !== '' ) { |
| [1909](#L1909) | $subscribers[$key]['Name'] = $value['firstname'] . ' ' . $value['lastname']; |
| [1910](#L1910) | } |
| [1911](#L1911) |  |
| [1912](#L1912) | $subscribers[$key]['Name'] = trim($subscribers[$key]['Name']); |
| [1913](#L1913) |  |
| [1914](#L1914) | } |
| [1915](#L1915) |  |
| [1916](#L1916) | foreach ( $subscribers as $key => $value ) { |
| [1917](#L1917) | fputcsv($fp, $value, $delimiter = ',', $enclosure = '"' ); |
| [1918](#L1918) | } |
| [1919](#L1919) |  |
| [1920](#L1920) | fclose($fp); |
| [1921](#L1921) | } |
| [1922](#L1922) | die(); |
| [1923](#L1923) | } |
| [1924](#L1924) |  |
| [1925](#L1925) | public function cmp\_allow\_mimes( $mimes = array() ) { |
| [1926](#L1926) | // add your own extension here - as many as you like |
| [1927](#L1927) | $mimes['zip'] = 'application/zip'; |
| [1928](#L1928) |  |
| [1929](#L1929) | return $mimes; |
| [1930](#L1930) | } |
| [1931](#L1931) |  |
| [1932](#L1932) | public function cmp\_allow\_font\_mimes( $mimes = array() ) { |
| [1933](#L1933) | // add your own extension here - as many as you like |
| [1934](#L1934) | $mimes['woff']  = 'application/x-font-woff'; |
| [1935](#L1935) | $mimes['woff2'] = 'application/x-font-woff2'; |
| [1936](#L1936) | $mimes['ttf']   = 'application/x-font-ttf'; |
| [1937](#L1937) | $mimes['eot']   = 'application/vnd.ms-fontobject'; |
| [1938](#L1938) | $mimes['otf']   = 'font/otf'; |
| [1939](#L1939) | if ( current\_user\_can('administrator') ) { |
| [1940](#L1940) | $mimes['svg']   = 'image/svg+xml'; |
| [1941](#L1941) | } |
| [1942](#L1942) | return $mimes; |
| [1943](#L1943) | } |
| [1944](#L1944) |  |
| [1945](#L1945) | public function cmp\_admin\_notice() { |
| [1946](#L1946) | global $pagenow; |
| [1947](#L1947) |  |
| [1948](#L1948) | // display save messages |
| [1949](#L1949) | if ( isset($\_GET['page']) && ($\_GET['page'] == 'cmp-settings' || $\_GET['page'] == 'cmp-translate' || $\_GET['page'] == 'cmp-advanced') ) { |
| [1950](#L1950) | if (isset($\_GET['status']) && $\_GET['status'] == 'settings-saved') { |
| [1951](#L1951) | $status         = 'success'; |
| [1952](#L1952) | $message        = \_\_('CMP Settings Saved', 'cmp-coming-soon-maintenance'); |
| [1953](#L1953) |  |
| [1954](#L1954) | echo '<div class="notice notice-'.$status.' is-dismissible"><p>'.$message.'.</p></div>'; |
| [1955](#L1955) | } |
| [1956](#L1956) | } |
| [1957](#L1957) |  |
| [1958](#L1958) | // display activation notice |
| [1959](#L1959) | if ( !get\_option( 'niteoCS\_activation\_notice' ) ) { |
| [1960](#L1960) | if ( ( $pagenow == 'plugins.php') ) { |
| [1961](#L1961) | // load the notices view |
| [1962](#L1962) | require\_once( dirname( \_\_FILE\_\_) . '/inc/cmp-activation-notice.php' ); |
| [1963](#L1963) | } |
| [1964](#L1964) | } |
| [1965](#L1965) | return; |
| [1966](#L1966) | } |
| [1967](#L1967) |  |
| [1968](#L1968) | // convert hex to rgba |
| [1969](#L1969) | public function hex2rgba ( $hex, $opacity = null ) { |
| [1970](#L1970) | list( $red, $green, $blue ) = sscanf( $hex, '#%02x%02x%02x' ); |
| [1971](#L1971) |  |
| [1972](#L1972) | if ( $opacity === null ) { |
| [1973](#L1973) | return $red . ',' . $green . ',' . $blue; |
| [1974](#L1974) | } |
| [1975](#L1975) |  |
| [1976](#L1976) | $rgba = 'rgba(' . $red . ',' . $green . ',' . $blue . ',' . $opacity.')'; |
| [1977](#L1977) |  |
| [1978](#L1978) | return $rgba; |
| [1979](#L1979) | } |
| [1980](#L1980) |  |
| [1981](#L1981) | // convert hex to hsl css |
| [1982](#L1982) | public function hex2hsl( $hex, $opacity ) { |
| [1983](#L1983) |  |
| [1984](#L1984) | if ( $hex[0] != '#' ) { |
| [1985](#L1985) | $rgba = explode( ',', $hex); |
| [1986](#L1986) | $rgba[3] = str\_replace(')', '', $rgba[3]); |
| [1987](#L1987) | $rgba[3] = $rgba[3] - ( $opacity / 100 ); |
| [1988](#L1988) | $rgba = $rgba[0] . ',' . $rgba[1] . ',' . $rgba[2] . ',' . $rgba[3] . ')'; |
| [1989](#L1989) | return $rgba; |
| [1990](#L1990) | } |
| [1991](#L1991) |  |
| [1992](#L1992) | list( $red, $green, $blue ) = sscanf( $hex, '#%02x%02x%02x' ); |
| [1993](#L1993) |  |
| [1994](#L1994) | $r = $red / 255.0; |
| [1995](#L1995) | $g = $green / 255.0; |
| [1996](#L1996) | $b = $blue / 255.0; |
| [1997](#L1997) | $H = 0; |
| [1998](#L1998) | $S = 0; |
| [1999](#L1999) | $V = 0; |
| [2000](#L2000) |  |
| [2001](#L2001) | $min = min( $r, $g, $b ); |
| [2002](#L2002) | $max = max( $r, $g, $b ); |
| [2003](#L2003) | $delta = ( $max - $min ); |
| [2004](#L2004) |  |
| [2005](#L2005) | $L = ( $max + $min ) / 2.0; |
| [2006](#L2006) |  |
| [2007](#L2007) | if( $delta == 0 ) { |
| [2008](#L2008) | $H = 0; |
| [2009](#L2009) | $S = 0; |
| [2010](#L2010) | } else { |
| [2011](#L2011) | $S = $L > 0.5 ? $delta / ( 2 - $max - $min ) : $delta / ( $max + $min ); |
| [2012](#L2012) |  |
| [2013](#L2013) | $dR = ( ( ( $max - $r ) / 6) + ( $delta / 2  ) ) / $delta; |
| [2014](#L2014) | $dG = ( ( ( $max - $g ) / 6) + ( $delta / 2  ) ) / $delta; |
| [2015](#L2015) | $dB = ( ( ( $max - $b ) / 6) + ( $delta / 2  ) ) / $delta; |
| [2016](#L2016) |  |
| [2017](#L2017) | if ( $r == $max ) |
| [2018](#L2018) | $H = $dB - $dG; |
| [2019](#L2019) | else if( $g == $max ) |
| [2020](#L2020) | $H = ( 1/3 ) + $dR - $dB; |
| [2021](#L2021) | else |
| [2022](#L2022) | $H = ( 2/3 ) + $dG - $dR; |
| [2023](#L2023) |  |
| [2024](#L2024) | if ( $H < 0 ) |
| [2025](#L2025) | $H += 1; |
| [2026](#L2026) | if ( $H > 1 ) |
| [2027](#L2027) | $H -= 1; |
| [2028](#L2028) | } |
| [2029](#L2029) |  |
| [2030](#L2030) | $HSL = array( 'hue' => round( ($H\*360), 0 ), 'saturation'=> round( ($S\*100), 0 ), 'luminosity' => round( ( $L\*100 ), 0) ); |
| [2031](#L2031) |  |
| [2032](#L2032) | // if color is white { |
| [2033](#L2033) | if ( $HSL['hue'] == 0 && $HSL['saturation'] == 0) { |
| [2034](#L2034) | $requested\_lumi = $HSL['luminosity'] + $opacity; |
| [2035](#L2035) | } else { |
| [2036](#L2036) | $requested\_lumi = $HSL['luminosity'] - $opacity; |
| [2037](#L2037) | } |
| [2038](#L2038) |  |
| [2039](#L2039) | $requested\_lumi = (int)round($requested\_lumi); |
| [2040](#L2040) |  |
| [2041](#L2041) | if ( $requested\_lumi > 90 ) { |
| [2042](#L2042) |  |
| [2043](#L2043) | $requested\_lumi = 90; |
| [2044](#L2044) | } |
| [2045](#L2045) |  |
| [2046](#L2046) | $HSL = 'hsl( '. $HSL['hue'] .', '.( $HSL['saturation']) .'%, '. $requested\_lumi . '%)'; |
| [2047](#L2047) | return $HSL; |
| [2048](#L2048) | } |
| [2049](#L2049) |  |
| [2050](#L2050) | // check if mobile |
| [2051](#L2051) | public function isMobile() { |
| [2052](#L2052) | if ( isset($\_SERVER["HTTP\_USER\_AGENT"]) ) { |
| [2053](#L2053) | return preg\_match("/(android|avantgo|blackberry|bolt|boost|cricket|docomo|fone|hiptop|mini|mobi|palm|phone|pie|tablet|up\.browser|up\.link|webos|wos)/i", $\_SERVER["HTTP\_USER\_AGENT"]); |
| [2054](#L2054) |  |
| [2055](#L2055) | } else { |
| [2056](#L2056) | return false; |
| [2057](#L2057) | } |
| [2058](#L2058) | } |
| [2059](#L2059) |  |
| [2060](#L2060) | // sanitize function |
| [2061](#L2061) | public function sanitize\_checkbox( $input ) { |
| [2062](#L2062) | return ( ( isset( $input ) && true == $input ) ? '1' : '0' ); |
| [2063](#L2063) | } |
| [2064](#L2064) |  |
| [2065](#L2065) | // sanitize function |
| [2066](#L2066) | public function niteo\_sanitize\_html( $html ) { |
| [2067](#L2067) |  |
| [2068](#L2068) | if ( !current\_user\_can( 'unfiltered\_html' ) ) { |
| [2069](#L2069) | $allowed = wp\_kses\_allowed\_html( 'post' ); |
| [2070](#L2070) | $html = wp\_kses( $html, $allowed ); |
| [2071](#L2071) | } |
| [2072](#L2072) |  |
| [2073](#L2073) | return $html; |
| [2074](#L2074) | } |
| [2075](#L2075) |  |
| [2076](#L2076) | // public function to sort social icons |
| [2077](#L2077) | public function sort\_social($a, $b){ |
| [2078](#L2078) | if ( $a['hidden'] == $b['hidden'] ) { |
| [2079](#L2079) | if( $a['order'] == $b['order'] ) { |
| [2080](#L2080) | return 0; |
| [2081](#L2081) | } |
| [2082](#L2082) | return $a['order'] < $b['order'] ? -1 : 1; |
| [2083](#L2083) | } else { |
| [2084](#L2084) | return $a['hidden'] > $b['hidden'] ? 1 : -1; |
| [2085](#L2085) | } |
| [2086](#L2086) | } |
| [2087](#L2087) |  |
| [2088](#L2088) | // public function to shift multidimensional array |
| [2089](#L2089) | public function customShift($array, $name){ |
| [2090](#L2090) |  |
| [2091](#L2091) | foreach($array as $key => $val){     // loop all elements |
| [2092](#L2092) | if($val['name'] == $name){             // check for id $id |
| [2093](#L2093) | unset($array[$key]);         // unset the $array with id $id |
| [2094](#L2094) | array\_unshift($array, $val); // unshift the array with $val to push in the beginning of array |
| [2095](#L2095) | return $array;               // return new $array |
| [2096](#L2096) | } |
| [2097](#L2097) | } |
| [2098](#L2098) | } |
| [2099](#L2099) |  |
| [2100](#L2100) | public function get\_youtube\_img( $youtube\_url ) { |
| [2101](#L2101) | $yt\_id = $this->get\_youtube\_id( $youtube\_url ); |
| [2102](#L2102) |  |
| [2103](#L2103) | $youtube\_image = 'http://img.youtube.com/vi/' . $yt\_id . '/hqdefault.jpg'; |
| [2104](#L2104) |  |
| [2105](#L2105) | return $youtube\_image; |
| [2106](#L2106) | } |
| [2107](#L2107) |  |
| [2108](#L2108) |  |
| [2109](#L2109) | public function get\_youtube\_id( $youtube\_url ) { |
| [2110](#L2110) | $youtube = preg\_match('/.\*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]\*).\*/', $youtube\_url, $url); |
| [2111](#L2111) |  |
| [2112](#L2112) | return $url[7]; |
| [2113](#L2113) | } |
| [2114](#L2114) |  |
| [2115](#L2115) | public function cmp\_get\_pages( $post\_status = 'publish,draft', $builder = false) { |
| [2116](#L2116) | $meta\_query = array(); |
| [2117](#L2117) | $pages = array(); |
| [2118](#L2118) |  |
| [2119](#L2119) | // meta\_query for pages built by elementor |
| [2120](#L2120) | if ( $builder === 'elementor' ) { |
| [2121](#L2121) | $meta\_query = array( |
| [2122](#L2122) | 'key' => '\_elementor\_edit\_mode', |
| [2123](#L2123) | 'compare' => 'EXISTS' |
| [2124](#L2124) | ); |
| [2125](#L2125) | } |
| [2126](#L2126) | // meta\_query for pages built by Divi |
| [2127](#L2127) | if ( $builder === 'divi' ) { |
| [2128](#L2128) | $meta\_query = array( |
| [2129](#L2129) | 'key' => '\_et\_pb\_use\_builder', |
| [2130](#L2130) | 'compare' => 'EXISTS' |
| [2131](#L2131) | ); |
| [2132](#L2132) | } |
| [2133](#L2133) |  |
| [2134](#L2134) | $args = array( |
| [2135](#L2135) | 'post\_type' => 'page', |
| [2136](#L2136) | 'post\_status' => $post\_status, |
| [2137](#L2137) | 'posts\_per\_page' => -1, |
| [2138](#L2138) | 'meta\_query' => array($meta\_query) |
| [2139](#L2139) | ); |
| [2140](#L2140) |  |
| [2141](#L2141) | $the\_query = new WP\_Query( $args ); |
| [2142](#L2142) |  |
| [2143](#L2143) | if ( $the\_query->have\_posts() ) { |
| [2144](#L2144) |  |
| [2145](#L2145) | foreach( $the\_query->posts as $post ) { |
| [2146](#L2146) | // check for gutenberg pages |
| [2147](#L2147) | if ( $builder === 'gutenberg' && !has\_blocks($post->ID) ) { |
| [2148](#L2148) | continue; |
| [2149](#L2149) | } |
| [2150](#L2150) |  |
| [2151](#L2151) | $post\_info = array('id' => $post->ID, 'name' => $post->post\_title); |
| [2152](#L2152) | array\_push($pages, $post\_info); |
| [2153](#L2153) | } |
| [2154](#L2154) | wp\_reset\_postdata(); |
| [2155](#L2155) | } |
| [2156](#L2156) |  |
| [2157](#L2157) | return $pages; |
| [2158](#L2158) | } |
| [2159](#L2159) |  |
| [2160](#L2160) | // send json data for theme info overlay AJAX request |
| [2161](#L2161) | public function niteo\_themeinfo( ) { |
| [2162](#L2162) |  |
| [2163](#L2163) | // check for ajax |
| [2164](#L2164) | if ( isset( $\_POST['theme\_slug'] ) ) { |
| [2165](#L2165) | // verify nonce |
| [2166](#L2166) | check\_ajax\_referer( 'cmp-coming-soon-ajax-secret', 'security' ); |
| [2167](#L2167) | // verify user rights |
| [2168](#L2168) | if( !current\_user\_can('publish\_pages') ) { |
| [2169](#L2169) | die('Sorry, but this request is invalid'); |
| [2170](#L2170) | } |
| [2171](#L2171) |  |
| [2172](#L2172) |  |
| [2173](#L2173) | // sanitize  $post |
| [2174](#L2174) | $theme\_slug = sanitize\_text\_field( $\_POST['theme\_slug'] ); |
| [2175](#L2175) | $data = array( 'result' => 'true', 'author\_homepage' => CMP\_AUTHOR\_HOMEPAGE, 'author' => CMP\_AUTHOR ); |
| [2176](#L2176) |  |
| [2177](#L2177) | if ( !empty( $theme\_slug ) ) { |
| [2178](#L2178) | $headers  = array('Theme Name', 'Description'); |
| [2179](#L2179) | $theme\_info = get\_file\_data(plugin\_dir\_path( \_\_FILE\_\_ ).'/themes/'. $theme\_slug. '.txt', $headers, ''); |
| [2180](#L2180) |  |
| [2181](#L2181) | $screenshots = array\_map( 'basename', glob( plugin\_dir\_path( \_\_FILE\_\_ ) . 'img/thumbnails/'.$theme\_slug.'/\*' ) ); |
| [2182](#L2182) |  |
| [2183](#L2183) | foreach ( $screenshots as $key => $screenshot ) { |
| [2184](#L2184) | $screenshots[$key] = plugins\_url('img/thumbnails/'.$theme\_slug.'/'.$screenshot, \_\_FILE\_\_ ); |
| [2185](#L2185) | } |
| [2186](#L2186) |  |
| [2187](#L2187) | $data['name'] = $theme\_info[0]; |
| [2188](#L2188) | $data['description'] = $theme\_info[1]; |
| [2189](#L2189) | $data['screenshots'] = $screenshots; |
| [2190](#L2190) | } |
| [2191](#L2191) |  |
| [2192](#L2192) | echo json\_encode ($data); |
| [2193](#L2193) | wp\_die(); |
| [2194](#L2194) | } |
| [2195](#L2195) | } |
| [2196](#L2196) |  |
| [2197](#L2197) | // legacy function for premium themes redirect |
| [2198](#L2198) | public function niteo\_redirect() { |
| [2199](#L2199) | return; |
| [2200](#L2200) | } |
| [2201](#L2201) |  |
| [2202](#L2202) | // returns array of google fonts from /inc/webfonts.php |
| [2203](#L2203) | public function cmp\_get\_google\_fonts() { |
| [2204](#L2204) | $fonts = include\_once wp\_normalize\_path( dirname( \_\_FILE\_\_ ) . '/inc/webfonts.php' ); |
| [2205](#L2205) | $google\_fonts = json\_decode( $fonts, true); |
| [2206](#L2206) |  |
| [2207](#L2207) | return $google\_fonts; |
| [2208](#L2208) | } |
| [2209](#L2209) |  |
| [2210](#L2210) | public function cmp\_google\_variant\_title( $variant ) { |
| [2211](#L2211) |  |
| [2212](#L2212) | switch( $variant ) { |
| [2213](#L2213) | case '100': |
| [2214](#L2214) | return 'Thin 100'; |
| [2215](#L2215) | break; |
| [2216](#L2216) | case '100italic': |
| [2217](#L2217) | return 'Thin 100 Italic'; |
| [2218](#L2218) | break; |
| [2219](#L2219) | case '200': |
| [2220](#L2220) | return 'Extra-light 200'; |
| [2221](#L2221) | break; |
| [2222](#L2222) | case '200italic': |
| [2223](#L2223) | return 'Extra-light 200 Italic'; |
| [2224](#L2224) | break; |
| [2225](#L2225) | case '300': |
| [2226](#L2226) | return 'Light 300'; |
| [2227](#L2227) | break; |
| [2228](#L2228) | case '300italic': |
| [2229](#L2229) | return 'Light 300 Italic'; |
| [2230](#L2230) | break; |
| [2231](#L2231) | case '400': |
| [2232](#L2232) | case 'regular': |
| [2233](#L2233) | return 'Regular 400'; |
| [2234](#L2234) | break; |
| [2235](#L2235) | case '400italic': |
| [2236](#L2236) | case 'italic': |
| [2237](#L2237) | return 'Regular 400 Italic'; |
| [2238](#L2238) | break; |
| [2239](#L2239) | case '500': |
| [2240](#L2240) | return 'Medium 500'; |
| [2241](#L2241) | break; |
| [2242](#L2242) | case '500italic': |
| [2243](#L2243) | return 'Meidum 500 Italic'; |
| [2244](#L2244) | break; |
| [2245](#L2245) | case '600': |
| [2246](#L2246) | return 'Semi-Bold 600'; |
| [2247](#L2247) | break; |
| [2248](#L2248) | case '600italic': |
| [2249](#L2249) | return 'Semi-Bold 600 Italic'; |
| [2250](#L2250) | break; |
| [2251](#L2251) | case '700': |
| [2252](#L2252) | return 'Bold 700'; |
| [2253](#L2253) | break; |
| [2254](#L2254) | case '700italic': |
| [2255](#L2255) | return 'Bold 700 Italic'; |
| [2256](#L2256) | break; |
| [2257](#L2257) | case '800': |
| [2258](#L2258) | return 'Extra-Bold 800'; |
| [2259](#L2259) | break; |
| [2260](#L2260) | case '800italic': |
| [2261](#L2261) | return 'Extra-Bold Italic'; |
| [2262](#L2262) | break; |
| [2263](#L2263) | case '900': |
| [2264](#L2264) | return 'Black 900'; |
| [2265](#L2265) | break; |
| [2266](#L2266) | case '900italic': |
| [2267](#L2267) | return 'Black 900 Italic'; |
| [2268](#L2268) | break; |
| [2269](#L2269) | case 'Not Applicable': |
| [2270](#L2270) | return 'Not Applicable'; |
| [2271](#L2271) | break; |
| [2272](#L2272) | default: |
| [2273](#L2273) | break; |
| [2274](#L2274) | } |
| [2275](#L2275) | } |
| [2276](#L2276) |  |
| [2277](#L2277) | // returns true if current page should display CMP page |
| [2278](#L2278) | // since 2.2 |
| [2279](#L2279) | public function cmp\_page\_filter() { |
| [2280](#L2280) | global $wp; |
| [2281](#L2281) |  |
| [2282](#L2282) | $uri = isset($\_SERVER['HTTP\_HOST']) ? $\_SERVER['HTTP\_HOST'] . $\_SERVER['REQUEST\_URI'] : ''; |
| [2283](#L2283) |  |
| [2284](#L2284) | $current\_url = trailingslashit( (isset($\_SERVER['HTTPS']) && $\_SERVER['HTTPS'] === 'on' ? "https" : "http") . "://"  . $uri ); |
| [2285](#L2285) |  |
| [2286](#L2286) | $custom\_login\_url = get\_option('niteoCS\_custom\_login\_url', ''); |
| [2287](#L2287) |  |
| [2288](#L2288) | // return early if login page or ajax call |
| [2289](#L2289) | if ( fnmatch( '\*wp-login.php\*', $current\_url ) || wp\_doing\_ajax() ) { |
| [2290](#L2290) | return false; |
| [2291](#L2291) | } |
| [2292](#L2292) |  |
| [2293](#L2293) | // return early if custom login page |
| [2294](#L2294) | if ( $custom\_login\_url !== '' && fnmatch('\*'.$custom\_login\_url.'\*', $current\_url) ) { |
| [2295](#L2295) | return false; |
| [2296](#L2296) | } |
| [2297](#L2297) |  |
| [2298](#L2298) | // WPS HIDE login integration |
| [2299](#L2299) | if ( defined('WPS\_HIDE\_LOGIN\_BASENAME') ) { |
| [2300](#L2300) | if ( fnmatch('\*'.get\_option( 'whl\_page' ), $current\_url) ) { |
| [2301](#L2301) | return false; |
| [2302](#L2302) | } |
| [2303](#L2303) | } |
| [2304](#L2304) |  |
| [2305](#L2305) | // allow / block RSS |
| [2306](#L2306) | if ( get\_option('niteoCS\_rss\_status', '1') && is\_feed() ) { |
| [2307](#L2307) | return false; |
| [2308](#L2308) | } |
| [2309](#L2309) |  |
| [2310](#L2310) | // get current page IDs |
| [2311](#L2311) | if ( is\_front\_page() && is\_home() ) { |
| [2312](#L2312) | // default homepage |
| [2313](#L2313) | $page\_id = '-1'; |
| [2314](#L2314) | } elseif ( is\_front\_page() ) { |
| [2315](#L2315) | // static homepage |
| [2316](#L2316) | $page\_id = '-1'; |
| [2317](#L2317) | } elseif ( is\_home() ) { |
| [2318](#L2318) | // posts page |
| [2319](#L2319) | $page\_id = get\_option( 'page\_for\_posts' ); |
| [2320](#L2320) | } else { |
| [2321](#L2321) | //everyting else |
| [2322](#L2322) | $page\_id = get\_the\_ID(); |
| [2323](#L2323) | } |
| [2324](#L2324) |  |
| [2325](#L2325) | // check whitelist or blacklist and return true/false |
| [2326](#L2326) | switch ( get\_option('niteoCS\_page\_filter', '0') ) { |
| [2327](#L2327) | // disabled return true |
| [2328](#L2328) | case '0': |
| [2329](#L2329) | return true; |
| [2330](#L2330) | break; |
| [2331](#L2331) |  |
| [2332](#L2332) | // whitelist |
| [2333](#L2333) | case '1': |
| [2334](#L2334) | $whitelist = json\_decode( get\_option('niteoCS\_page\_whitelist', '[]'), true ); |
| [2335](#L2335) | if ( !empty( $whitelist ) && in\_array( $page\_id, $whitelist ) ) { |
| [2336](#L2336) | return true; |
| [2337](#L2337) | } |
| [2338](#L2338) |  |
| [2339](#L2339) | $page\_wl\_custom = json\_decode(get\_option('niteoCS\_page\_whitelist\_custom', '[]'), true); |
| [2340](#L2340) | if ( !empty( $page\_wl\_custom ) ) { |
| [2341](#L2341) | foreach ( $page\_wl\_custom as $url ) { |
| [2342](#L2342) | if ( fnmatch( $url, $current\_url ) ) { |
| [2343](#L2343) | return true; |
| [2344](#L2344) | } |
| [2345](#L2345) | } |
| [2346](#L2346) | } |
| [2347](#L2347) |  |
| [2348](#L2348) | return false; |
| [2349](#L2349) | break; |
| [2350](#L2350) |  |
| [2351](#L2351) | // blacklist |
| [2352](#L2352) | case '2': |
| [2353](#L2353) | $blacklist = json\_decode( get\_option('niteoCS\_page\_blacklist', '[]'), true ); |
| [2354](#L2354) |  |
| [2355](#L2355) | if ( !empty( $blacklist ) && in\_array( $page\_id, $blacklist ) ) { |
| [2356](#L2356) | return false; |
| [2357](#L2357) | } |
| [2358](#L2358) |  |
| [2359](#L2359) | $page\_bl\_custom = json\_decode(get\_option('niteoCS\_page\_blacklist\_custom', '[]'), true); |
| [2360](#L2360) |  |
| [2361](#L2361) | if ( !empty( $page\_bl\_custom ) ) { |
| [2362](#L2362) | foreach ($page\_bl\_custom as $url ) { |
| [2363](#L2363) | if ( fnmatch( $url, $current\_url ) ) { |
| [2364](#L2364) | return false; |
| [2365](#L2365) | } |
| [2366](#L2366) | } |
| [2367](#L2367) | } |
| [2368](#L2368) |  |
| [2369](#L2369) | return true; |
| [2370](#L2370) | break; |
| [2371](#L2371) |  |
| [2372](#L2372) | default: |
| [2373](#L2373) | return true; |
| [2374](#L2374) | break; |
| [2375](#L2375) | } |
| [2376](#L2376) |  |
| [2377](#L2377) | return true; |
| [2378](#L2378) | } |
| [2379](#L2379) |  |
| [2380](#L2380) | // returns true if logged in user meet CMP roles filter |
| [2381](#L2381) | // since 2.2 |
| [2382](#L2382) | public function cmp\_roles\_filter() { |
| [2383](#L2383) | $roles = json\_decode( get\_option('niteoCS\_roles', '[]'), true ); |
| [2384](#L2384) | // push WP administrator to roles array, since it is default |
| [2385](#L2385) | array\_push( $roles, 'administrator' ); |
| [2386](#L2386) |  |
| [2387](#L2387) | $current\_user = wp\_get\_current\_user(); |
| [2388](#L2388) |  |
| [2389](#L2389) | foreach ( $current\_user->roles as $role ) { |
| [2390](#L2390) | if ( in\_array( $role, $roles ) ) { |
| [2391](#L2391) | return true; |
| [2392](#L2392) | } |
| [2393](#L2393) | }; |
| [2394](#L2394) |  |
| [2395](#L2395) | return false; |
| [2396](#L2396) | } |
| [2397](#L2397) |  |
| [2398](#L2398) |  |
| [2399](#L2399) | public function add\_action\_links( $links ) { |
| [2400](#L2400) | $settings = array( |
| [2401](#L2401) | '<a href="' . admin\_url( 'admin.php?page=cmp-settings' ) . '">CMP Settings</a>', |
| [2402](#L2402) | ); |
| [2403](#L2403) | return array\_merge( $settings, $links ); |
| [2404](#L2404) | } |
| [2405](#L2405) |  |
| [2406](#L2406) |  |
| [2407](#L2407) | // returns version of selected CMP theme |
| [2408](#L2408) | public function cmp\_theme\_version( $theme\_slug ) { |
| [2409](#L2409) |  |
| [2410](#L2410) | $version = CMP\_VERSION; |
| [2411](#L2411) |  |
| [2412](#L2412) | // if premium theme style.css exists get its version |
| [2413](#L2413) | if ( in\_array( $theme\_slug, $this->cmp\_premium\_themes\_installed() ) ) { |
| [2414](#L2414) | if ( file\_exists( CMP\_PREMIUM\_THEMES\_DIR . $theme\_slug . '/style.css' ) ) { |
| [2415](#L2415) | $version = get\_file\_data( CMP\_PREMIUM\_THEMES\_DIR . $theme\_slug . '/style.css', array('Version'), '' ); |
| [2416](#L2416) | } |
| [2417](#L2417) |  |
| [2418](#L2418) | } |
| [2419](#L2419) |  |
| [2420](#L2420) | // if we have local version of theme and not in updating theme |
| [2421](#L2421) | if ( is\_array( $version ) ) { |
| [2422](#L2422) | $version =  $version[0]; |
| [2423](#L2423) | } |
| [2424](#L2424) |  |
| [2425](#L2425) | return $version; |
| [2426](#L2426) | } |
| [2427](#L2427) |  |
| [2428](#L2428) | /\*\* |
| [2429](#L2429) | \* Connect to Mailchimp via API and retrieve Mailchimp lists |
| [2430](#L2430) | \* |
| [2431](#L2431) | \* @since 2.6 |
| [2432](#L2432) | \* @access public |
| [2433](#L2433) | \* @return Object |
| [2434](#L2434) | \*/ |
| [2435](#L2435) | public function cmp\_mailchimp\_list\_ajax( $apikey ) { |
| [2436](#L2436) |  |
| [2437](#L2437) | // check for ajax |
| [2438](#L2438) | if ( isset( $\_POST['params'] ) ) { |
| [2439](#L2439) | // verify nonce |
| [2440](#L2440) | check\_ajax\_referer( 'cmp-coming-soon-ajax-secret', 'security' ); |
| [2441](#L2441) | // verify user rights |
| [2442](#L2442) | if( !current\_user\_can('publish\_pages') ) { |
| [2443](#L2443) | die('Sorry, but this request is invalid'); |
| [2444](#L2444) | } |
| [2445](#L2445) |  |
| [2446](#L2446) | // sanitize array |
| [2447](#L2447) | $\_POST = filter\_input\_array(INPUT\_POST, FILTER\_SANITIZE\_STRING); |
| [2448](#L2448) |  |
| [2449](#L2449) | // check params |
| [2450](#L2450) | if ( !empty( $\_POST['params'] ) ) { |
| [2451](#L2451) | $params = $\_POST['params']; |
| [2452](#L2452) | } |
| [2453](#L2453) |  |
| [2454](#L2454) | $api\_key = $params['apikey']; |
| [2455](#L2455) |  |
| [2456](#L2456) | $dc = substr( $api\_key,strpos($api\_key,'-') + 1 ); // datacenter, it is the part of your api key - us5, us8 etc |
| [2457](#L2457) |  |
| [2458](#L2458) | $args = array( |
| [2459](#L2459) | 'headers' => array( |
| [2460](#L2460) | 'Authorization' => 'Basic ' . base64\_encode( 'user:'. $api\_key ) |
| [2461](#L2461) | ) |
| [2462](#L2462) | ); |
| [2463](#L2463) |  |
| [2464](#L2464) |  |
| [2465](#L2465) | // retrieve response from mailchimp |
| [2466](#L2466) | $response = wp\_remote\_get( 'https://'.$dc.'.api.mailchimp.com/3.0/lists/', $args ); |
| [2467](#L2467) |  |
| [2468](#L2468) | // if we have it, create new array with lists id and name, else push error messages into array |
| [2469](#L2469) | if ( !is\_wp\_error( $response ) ) { |
| [2470](#L2470) | $lists\_array = array(); |
| [2471](#L2471) |  |
| [2472](#L2472) | $body = json\_decode( $response['body'], true); |
| [2473](#L2473) |  |
| [2474](#L2474) | if ( $response['response']['code'] == 200 ) { |
| [2475](#L2475) | $lists\_array['response'] = 200; |
| [2476](#L2476) | $i = 0; |
| [2477](#L2477) | foreach ( $body['lists'] as $list ) { |
| [2478](#L2478) | $lists\_array['lists'][$i]['id'] = $list['id']; |
| [2479](#L2479) | $lists\_array['lists'][$i]['name'] = $list['name']; |
| [2480](#L2480) | $i++; |
| [2481](#L2481) | } |
| [2482](#L2482) |  |
| [2483](#L2483) | } else { |
| [2484](#L2484) | $lists\_array['response'] = $response['response']['code']; |
| [2485](#L2485) | $lists\_array['message'] = $body['title'] . ': ' . $body['detail']; |
| [2486](#L2486) | } |
| [2487](#L2487) |  |
| [2488](#L2488) | } else { |
| [2489](#L2489) | $lists\_array['response'] = '500'; |
| [2490](#L2490) | $lists\_array['message'] = $response->get\_error\_message(); |
| [2491](#L2491) | } |
| [2492](#L2492) |  |
| [2493](#L2493) | // json encode response |
| [2494](#L2494) | $lists\_json = json\_encode( $lists\_array ); |
| [2495](#L2495) |  |
| [2496](#L2496) | // save it |
| [2497](#L2497) | update\_option('niteoCS\_mailchimp\_lists', $lists\_json); |
| [2498](#L2498) |  |
| [2499](#L2499) | // delete selected old mailchimp list because we do not want it |
| [2500](#L2500) | delete\_option('niteoCS\_mailchimp\_list\_selected'); |
| [2501](#L2501) |  |
| [2502](#L2502) | // echo ajax result |
| [2503](#L2503) | echo $lists\_json; |
| [2504](#L2504) | wp\_die(); |
| [2505](#L2505) |  |
| [2506](#L2506) | } |
| [2507](#L2507) |  |
| [2508](#L2508) | } |
| [2509](#L2509) |  |
| [2510](#L2510) | /\*\* |
| [2511](#L2511) | \* Returns Background image URL |
| [2512](#L2512) | \* |
| [2513](#L2513) | \* @since 2.8.4 |
| [2514](#L2514) | \* @access public |
| [2515](#L2515) | \* @return string |
| [2516](#L2516) | \*/ |
| [2517](#L2517) | public function cmp\_get\_background\_img\_for\_seo() { |
| [2518](#L2518) |  |
| [2519](#L2519) | $themeslug = $this->cmp\_selectedTheme(); |
| [2520](#L2520) | $default\_img = ''; |
| [2521](#L2521) |  |
| [2522](#L2522) | $background\_type = get\_option('niteoCS\_banner', '2'); |
| [2523](#L2523) |  |
| [2524](#L2524) | if ( file\_exists( $this->cmp\_theme\_dir( $this->cmp\_selectedTheme() ).$this->cmp\_selectedTheme().'/img/'.$this->cmp\_selectedTheme().'\_banner\_large.jpg' ) ) { |
| [2525](#L2525) | $default\_img = $this->cmp\_themeURL( $this->cmp\_selectedTheme() ).$this->cmp\_selectedTheme().'/img/'.$this->cmp\_selectedTheme().'\_banner\_large.jpg'; |
| [2526](#L2526) | } elseif ( file\_exists( $this->cmp\_theme\_dir( $this->cmp\_selectedTheme() ).$this->cmp\_selectedTheme().'/img/'.$this->cmp\_selectedTheme().'\_banner\_large.png' ) ) { |
| [2527](#L2527) | $default\_img = $this->cmp\_themeURL( $this->cmp\_selectedTheme() ).$this->cmp\_selectedTheme().'/img/'.$this->cmp\_selectedTheme().'\_banner\_large.png'; |
| [2528](#L2528) | } |
| [2529](#L2529) |  |
| [2530](#L2530) | switch ( $background\_type ) { |
| [2531](#L2531) | // custom img |
| [2532](#L2532) | case '0': |
| [2533](#L2533) | $banner\_id = get\_option('niteoCS\_banner\_id'); |
| [2534](#L2534) |  |
| [2535](#L2535) | if ( $banner\_id != '' ) { |
| [2536](#L2536) | $banner\_ids = explode(',', $banner\_id); |
| [2537](#L2537) | $image\_url = wp\_get\_attachment\_image\_src( $banner\_ids[0], 'large'); |
| [2538](#L2538) |  |
| [2539](#L2539) | if ( isset( $image\_url[0] ) ) { |
| [2540](#L2540) | $image\_url = $image\_url[0]; |
| [2541](#L2541) | } |
| [2542](#L2542) |  |
| [2543](#L2543) | } else { |
| [2544](#L2544) | // send default image |
| [2545](#L2545) | $image\_url = $default\_img; |
| [2546](#L2546) | } |
| [2547](#L2547) |  |
| [2548](#L2548) | break; |
| [2549](#L2549) | // unsplash |
| [2550](#L2550) | case '1': |
| [2551](#L2551) | $unplash\_feed   = get\_option('niteoCS\_unsplash\_feed', '3'); |
| [2552](#L2552) |  |
| [2553](#L2553) | switch ( $unplash\_feed ) { |
| [2554](#L2554) | // specific photo from id |
| [2555](#L2555) | case '0': |
| [2556](#L2556) | $params = array('feed' => '0', 'url' => get\_option('niteoCS\_unsplash\_0', '') ); |
| [2557](#L2557) | $unsplash = $this->niteo\_unsplash(  $params ); |
| [2558](#L2558) | break; |
| [2559](#L2559) |  |
| [2560](#L2560) | // random from user |
| [2561](#L2561) | case '1': |
| [2562](#L2562) | $params = array('feed' => '1', 'custom\_str' => get\_option('niteoCS\_unsplash\_1', '') ); |
| [2563](#L2563) | $unsplash = $this->niteo\_unsplash(  $params ); |
| [2564](#L2564) | break; |
| [2565](#L2565) |  |
| [2566](#L2566) | // random from collection |
| [2567](#L2567) | case '2': |
| [2568](#L2568) | $params = array('feed' => '2', 'url' => get\_option('niteoCS\_unsplash\_2', '') ); |
| [2569](#L2569) | $unsplash = $this->niteo\_unsplash(  $params ); |
| [2570](#L2570) | break; |
| [2571](#L2571) |  |
| [2572](#L2572) | // random photo |
| [2573](#L2573) | case '3': |
| [2574](#L2574) | $params = array('feed' => '3', 'url' => get\_option('niteoCS\_unsplash\_3', ''), 'feat' => get\_option('niteoCS\_unsplash\_feat', '0') ); |
| [2575](#L2575) | $unsplash = $this->niteo\_unsplash(  $params ); |
| [2576](#L2576) | break; |
| [2577](#L2577) | default: |
| [2578](#L2578) | break; |
| [2579](#L2579) | } |
| [2580](#L2580) |  |
| [2581](#L2581) | // get raw url from response |
| [2582](#L2582) | if ( isset( $unsplash['response'] ) && $unsplash['response'] == '200' ) { |
| [2583](#L2583) | $body = json\_decode ($unsplash['body'], true ); |
| [2584](#L2584) |  |
| [2585](#L2585) | if ( isset( $body[0] ) ) { |
| [2586](#L2586) | foreach ( $body as $item ) { |
| [2587](#L2587) | $unsplash\_url = $item['urls']['raw']; |
| [2588](#L2588) | } |
| [2589](#L2589) | } else { |
| [2590](#L2590) | $unsplash\_url = $body['urls']['raw']; |
| [2591](#L2591) | } |
| [2592](#L2592) |  |
| [2593](#L2593) | $image\_url = $unsplash\_url . '?ixlib=rb-0.3.5&q=80&fm=jpg&crop=entropy&cs=tinysrgb&fit=crop&w=1200&h=630'; |
| [2594](#L2594) | } |
| [2595](#L2595) |  |
| [2596](#L2596) | break; |
| [2597](#L2597) | // default image |
| [2598](#L2598) | case '2': |
| [2599](#L2599) | $image\_url = $default\_img; |
| [2600](#L2600) | break; |
| [2601](#L2601) |  |
| [2602](#L2602) | case '3': |
| [2603](#L2603) | // Pattern |
| [2604](#L2604) | $niteoCS\_banner\_pattern = get\_option('niteoCS\_banner\_pattern', 'sakura'); |
| [2605](#L2605) |  |
| [2606](#L2606) | if ( $niteoCS\_banner\_pattern != 'custom' ) { |
| [2607](#L2607) | $image\_url =  CMP\_PLUGIN\_URL.'img/patterns/'.esc\_attr($niteoCS\_banner\_pattern).'.png'; |
| [2608](#L2608) |  |
| [2609](#L2609) | } else { |
| [2610](#L2610) | $image\_url = get\_option('niteoCS\_banner\_pattern\_custom'); |
| [2611](#L2611) | $image\_url = wp\_get\_attachment\_image\_src( $image\_url, 'large' ); |
| [2612](#L2612) | if ( isset($image\_url[0]) ){ |
| [2613](#L2613) | $image\_url = $image\_url[0]; |
| [2614](#L2614) | } |
| [2615](#L2615) | } |
| [2616](#L2616) |  |
| [2617](#L2617) | break; |
| [2618](#L2618) |  |
| [2619](#L2619) | case '5': |
| [2620](#L2620) | $image\_url   = wp\_get\_attachment\_image\_src( get\_option('niteoCS\_video\_thumb'), 'large' ); |
| [2621](#L2621) |  |
| [2622](#L2622) | if ( !empty( $image\_url ) ) { |
| [2623](#L2623) | $image\_url = $image\_url[0]; |
| [2624](#L2624) | } |
| [2625](#L2625) |  |
| [2626](#L2626) | break; |
| [2627](#L2627) |  |
| [2628](#L2628) | case '6': |
| [2629](#L2629) | case '4': |
| [2630](#L2630) | default: |
| [2631](#L2631) | $image\_url = ''; |
| [2632](#L2632) | break; |
| [2633](#L2633) | } |
| [2634](#L2634) |  |
| [2635](#L2635) | return $image\_url; |
| [2636](#L2636) | } |
| [2637](#L2637) |  |
| [2638](#L2638) |  |
| [2639](#L2639) | /\*\* |
| [2640](#L2640) | \* Purge cache for popular caching plugins |
| [2641](#L2641) | \* |
| [2642](#L2642) | \* @since 2.8.5 |
| [2643](#L2643) | \* @access public |
| [2644](#L2644) | \* @return string |
| [2645](#L2645) | \*/ |
| [2646](#L2646) | public function cmp\_purge\_cache() { |
| [2647](#L2647) |  |
| [2648](#L2648) | // WP cache |
| [2649](#L2649) | wp\_cache\_flush(); |
| [2650](#L2650) |  |
| [2651](#L2651) | // W3 Total Cache |
| [2652](#L2652) | if ( function\_exists('w3tc\_flush\_all') )  { |
| [2653](#L2653) | w3tc\_flush\_all(); |
| [2654](#L2654) | } |
| [2655](#L2655) |  |
| [2656](#L2656) | // wp super cache |
| [2657](#L2657) | if ( function\_exists( 'wp\_cache\_clear\_cache' ) ) { |
| [2658](#L2658) | wp\_cache\_clear\_cache(); |
| [2659](#L2659) | } |
| [2660](#L2660) |  |
| [2661](#L2661) | // Clear Cachify Cache |
| [2662](#L2662) | if ( has\_action('cachify\_flush\_cache') ) { |
| [2663](#L2663) | do\_action('cachify\_flush\_cache'); |
| [2664](#L2664) | } |
| [2665](#L2665) |  |
| [2666](#L2666) | // endurance cache |
| [2667](#L2667) | if ( class\_exists( 'Endurance\_Page\_Cache' ) && method\_exists('Endurance\_Page\_Cache','purge\_all'))  { |
| [2668](#L2668) | $epc = new Endurance\_Page\_Cache; |
| [2669](#L2669) | $epc->purge\_all(); |
| [2670](#L2670) | } |
| [2671](#L2671) |  |
| [2672](#L2672) | // SG Optimizer |
| [2673](#L2673) | if ( class\_exists( 'SG\_CachePress\_Supercacher' ) && method\_exists( 'SG\_CachePress\_Supercacher', 'purge\_cache' ) ) { |
| [2674](#L2674) | SG\_CachePress\_Supercacher::purge\_cache( true ); |
| [2675](#L2675) | } |
| [2676](#L2676) |  |
| [2677](#L2677) | if (class\_exists('SiteGround\_Optimizer\Supercacher\Supercacher')) { |
| [2678](#L2678) | SiteGround\_Optimizer\Supercacher\Supercacher::purge\_cache(); |
| [2679](#L2679) | } |
| [2680](#L2680) |  |
| [2681](#L2681) | // WP Fastest Cache |
| [2682](#L2682) | if ( isset( $GLOBALS['wp\_fastest\_cache'] ) && method\_exists( $GLOBALS['wp\_fastest\_cache'], 'deleteCache' ) ) { |
| [2683](#L2683) | $GLOBALS['wp\_fastest\_cache']->deleteCache( true ); |
| [2684](#L2684) | } |
| [2685](#L2685) |  |
| [2686](#L2686) | // Swift Performance |
| [2687](#L2687) | if ( is\_callable( array( 'Swift\_Performance\_Cache', 'clear\_all\_cache' ) ) ) { |
| [2688](#L2688) | Swift\_Performance\_Cache::clear\_all\_cache(); |
| [2689](#L2689) | } |
| [2690](#L2690) |  |
| [2691](#L2691) | // WP Rocket |
| [2692](#L2692) | if ( function\_exists( 'rocket\_clean\_domain' ) ) { |
| [2693](#L2693) | rocket\_clean\_domain(); |
| [2694](#L2694) | } |
| [2695](#L2695) |  |
| [2696](#L2696) | if (is\_callable(array('Hummingbird\WP\_Hummingbird', 'flush\_cache'))) { |
| [2697](#L2697) | Hummingbird\WP\_Hummingbird::flush\_cache(true, false); |
| [2698](#L2698) | } |
| [2699](#L2699) |  |
| [2700](#L2700) | // wp-optimize |
| [2701](#L2701) | if ( class\_exists('WP\_Optimize') ) { |
| [2702](#L2702) | if (!class\_exists('WP\_Optimize\_Cache\_Commands')) include\_once(WPO\_PLUGIN\_MAIN\_PATH . 'cache/class-cache-commands.php'); |
| [2703](#L2703) | $cache\_commands = new WP\_Optimize\_Cache\_Commands(); |
| [2704](#L2704) | $cache\_commands->purge\_page\_cache(); |
| [2705](#L2705) | } |
| [2706](#L2706) |  |
| [2707](#L2707) | // Clear Litespeed cache |
| [2708](#L2708) | if ( class\_exists('LiteSpeed\_Cache\_API') && method\_exists( 'LiteSpeed\_Cache\_API', 'purge\_all' ) ) { |
| [2709](#L2709) | LiteSpeed\_Cache\_API::purge\_all(); |
| [2710](#L2710) | } |
| [2711](#L2711) |  |
| [2712](#L2712) | if (function\_exists('rocket\_clean\_domain')) { |
| [2713](#L2713) | rocket\_clean\_domain(); |
| [2714](#L2714) | } |
| [2715](#L2715) | } |
| [2716](#L2716) |  |
| [2717](#L2717) | /\*\* |
| [2718](#L2718) | \* Checks if user defined role has permission to access and toggle CMP from Admin Bar Icon |
| [2719](#L2719) | \* |
| [2720](#L2720) | \* @since 2.8.5 |
| [2721](#L2721) | \* @access public |
| [2722](#L2722) | \* @return boolean |
| [2723](#L2723) | \*/ |
| [2724](#L2724) | public function cmp\_user\_can\_admin\_bar\_activation() { |
| [2725](#L2725) |  |
| [2726](#L2726) | // return if Top Bar Icon is disabled |
| [2727](#L2727) | if ( get\_option('niteoCS\_topbar\_icon', '1') == '0' ) { |
| [2728](#L2728) | return false; |
| [2729](#L2729) | } |
| [2730](#L2730) |  |
| [2731](#L2731) | require\_once(ABSPATH . 'wp-admin/includes/screen.php'); |
| [2732](#L2732) |  |
| [2733](#L2733) | // get defined roles for admin topbar access |
| [2734](#L2734) | $roles\_topbar = json\_decode( get\_option('niteoCS\_roles\_topbar', '[]'), true ); |
| [2735](#L2735) |  |
| [2736](#L2736) | // push WP administrator to roles array, since it is default |
| [2737](#L2737) | array\_push( $roles\_topbar, 'administrator' ); |
| [2738](#L2738) |  |
| [2739](#L2739) | // get current user |
| [2740](#L2740) | $current\_user = wp\_get\_current\_user(); |
| [2741](#L2741) |  |
| [2742](#L2742) | // if current user can access topbar, return true |
| [2743](#L2743) | foreach  ( $current\_user->roles as $role ) { |
| [2744](#L2744) | if ( in\_array( $role, $roles\_topbar ) ) { |
| [2745](#L2745) | return true; |
| [2746](#L2746) | } |
| [2747](#L2747) | } |
| [2748](#L2748) |  |
| [2749](#L2749) | return false; |
| [2750](#L2750) | } |
| [2751](#L2751) |  |
| [2752](#L2752) | /\*\* |
| [2753](#L2753) | \* Returns full post content via AJAX |
| [2754](#L2754) | \* |
| [2755](#L2755) | \* @since 3.0 |
| [2756](#L2756) | \* @access public |
| [2757](#L2757) | \* @return array |
| [2758](#L2758) | \*/ |
| [2759](#L2759) | public function cmp\_get\_post\_detail() { |
| [2760](#L2760) | $id = isset($\_POST['id']) ? esc\_attr($\_POST['id']) : ''; |
| [2761](#L2761) | $size = $this->isMobile ? 'large' : 'large'; |
| [2762](#L2762) |  |
| [2763](#L2763) | $post = array( |
| [2764](#L2764) | 'img'   => '', |
| [2765](#L2765) | 'date'  => '', |
| [2766](#L2766) | 'title' => 'Post is not published or is Password protected', |
| [2767](#L2767) | 'body'  => '', |
| [2768](#L2768) | 'url'   => '', |
| [2769](#L2769) | ); |
| [2770](#L2770) |  |
| [2771](#L2771) | if ( get\_post\_status( $id ) === 'publish' && !post\_password\_required( $id ) ) { |
| [2772](#L2772) |  |
| [2773](#L2773) | $post =  array( |
| [2774](#L2774) | 'img'   => get\_the\_post\_thumbnail( $id, $size ), |
| [2775](#L2775) | 'date'  => get\_the\_date( 'F j, Y', $id ), |
| [2776](#L2776) | 'title' => get\_the\_title( $id ), |
| [2777](#L2777) | 'body'  => apply\_filters( 'the\_content', get\_post\_field('post\_content', $id) ), |
| [2778](#L2778) | 'url'   => get\_the\_permalink( $id ), |
| [2779](#L2779) | ); |
| [2780](#L2780) | } |
| [2781](#L2781) |  |
| [2782](#L2782) | wp\_send\_json( $post ); |
| [2783](#L2783) |  |
| [2784](#L2784) | } |
| [2785](#L2785) |  |
| [2786](#L2786) | /\*\* |
| [2787](#L2787) | \* Dismiss activation notice |
| [2788](#L2788) | \* |
| [2789](#L2789) | \* @since 3.4.3 |
| [2790](#L2790) | \* @access public |
| [2791](#L2791) | \* @return void |
| [2792](#L2792) | \*/ |
| [2793](#L2793) | function cmp\_ajax\_dismiss\_activation\_notice() { |
| [2794](#L2794) | check\_ajax\_referer( 'cmp-coming-soon-maintenance-nonce', 'nonce' ); |
| [2795](#L2795) | // user has dismissed the welcome notice |
| [2796](#L2796) | update\_option( 'niteoCS\_activation\_notice', true ); |
| [2797](#L2797) | wp\_die(); |
| [2798](#L2798) | exit; |
| [2799](#L2799) | } |
| [2800](#L2800) |  |
| [2801](#L2801) | /\*\* |
| [2802](#L2802) | \* Upload custom Fonts to CMP |
| [2803](#L2803) | \* |
| [2804](#L2804) | \* @since 3.5 |
| [2805](#L2805) | \* @access public |
| [2806](#L2806) | \* @return string |
| [2807](#L2807) | \*/ |
| [2808](#L2808) | public function cmp\_ajax\_upload\_font() { |
| [2809](#L2809) | // verify nonce |
| [2810](#L2810) | check\_ajax\_referer( 'cmp-coming-soon-ajax-secret', 'security' ); |
| [2811](#L2811) |  |
| [2812](#L2812) | // verify user rights |
| [2813](#L2813) | if( !current\_user\_can('publish\_pages') ) { |
| [2814](#L2814) | die('Sorry, but this request is invalid'); |
| [2815](#L2815) | } |
| [2816](#L2816) |  |
| [2817](#L2817) |  |
| [2818](#L2818) | if ( isset($\_POST['payload']) ) { |
| [2819](#L2819) |  |
| [2820](#L2820) | $payload = json\_decode( stripslashes($\_POST['payload']), true ); |
| [2821](#L2821) | $action = $payload['action']; |
| [2822](#L2822) |  |
| [2823](#L2823) | if ( $action === 'upload\_font' ) { |
| [2824](#L2824) |  |
| [2825](#L2825) | $new\_fonts = $payload['files']; |
| [2826](#L2826) |  |
| [2827](#L2827) | // delete\_option('niteoCS\_custom\_fonts'); |
| [2828](#L2828) |  |
| [2829](#L2829) | if ( get\_option('niteoCS\_custom\_fonts') ) { |
| [2830](#L2830) |  |
| [2831](#L2831) | $old\_fonts = json\_decode( get\_option('niteoCS\_custom\_fonts'), true ); |
| [2832](#L2832) |  |
| [2833](#L2833) | $i = 0; |
| [2834](#L2834) |  |
| [2835](#L2835) | foreach ( $old\_fonts as $old\_font ) { |
| [2836](#L2836) |  |
| [2837](#L2837) | foreach ( $new\_fonts as $new\_font ) { |
| [2838](#L2838) | if ( $old\_font['id'] === $new\_font['id'] ) { |
| [2839](#L2839) |  |
| [2840](#L2840) | $old\_fonts[$i]['urls'] = ( is\_array($old\_font['urls']) ) ? array\_unique(array\_merge( $old\_font['urls'], $new\_font['urls'] )) : $new\_font['urls']; |
| [2841](#L2841) | $old\_fonts[$i]['ids'] = ( is\_array($old\_font['ids']) ) ? array\_unique(array\_merge( $old\_font['ids'], $new\_font['ids'] )) : $new\_font['ids']; |
| [2842](#L2842) |  |
| [2843](#L2843) | } else if ( !$this->niteo\_in\_array\_r($new\_font['id'], $old\_fonts) ) { |
| [2844](#L2844) | array\_push($old\_fonts, $new\_font); |
| [2845](#L2845) | } |
| [2846](#L2846) | } |
| [2847](#L2847) |  |
| [2848](#L2848) | $i++; |
| [2849](#L2849) | } |
| [2850](#L2850) |  |
| [2851](#L2851) | $new\_fonts = $old\_fonts; |
| [2852](#L2852) | } |
| [2853](#L2853) |  |
| [2854](#L2854) | update\_option( 'niteoCS\_custom\_fonts', json\_encode( $new\_fonts ) ); |
| [2855](#L2855) |  |
| [2856](#L2856) | } |
| [2857](#L2857) |  |
| [2858](#L2858) | } |
| [2859](#L2859) |  |
| [2860](#L2860) | // echo confirmation |
| [2861](#L2861) | echo 'success'; |
| [2862](#L2862) | wp\_die(); |
| [2863](#L2863) | } |
| [2864](#L2864) |  |
| [2865](#L2865) | /\*\* |
| [2866](#L2866) | \* Export function of CMP Settings to JSON |
| [2867](#L2867) | \* |
| [2868](#L2868) | \* @since 3.5.3 |
| [2869](#L2869) | \* @access public |
| [2870](#L2870) | \* @return string |
| [2871](#L2871) | \*/ |
| [2872](#L2872) | public function cmp\_export\_settings() { |
| [2873](#L2873) |  |
| [2874](#L2874) | $options = array(); |
| [2875](#L2875) | // add default cmp identifier |
| [2876](#L2876) | $options[0] = 'CMP\_EXPORT'; |
| [2877](#L2877) |  |
| [2878](#L2878) | global $wpdb; |
| [2879](#L2879) | $saved\_options = $wpdb->get\_results( "SELECT \* FROM $wpdb->options WHERE option\_name LIKE 'niteoCS\_%'", OBJECT ); |
| [2880](#L2880) | $i = 1; |
| [2881](#L2881) |  |
| [2882](#L2882) | foreach ($saved\_options as $option) { |
| [2883](#L2883) |  |
| [2884](#L2884) | $option\_name = $option->option\_name; |
| [2885](#L2885) | $option\_value = get\_option( $option\_name ); |
| [2886](#L2886) |  |
| [2887](#L2887) | $img\_settings = array( 'niteoCS\_banner\_id', 'niteoCS\_logo\_id', 'niteoCS\_seo\_img\_id', 'niteoCS\_favicon\_id', 'niteoCS\_subs\_img\_id', 'niteoCS\_subs\_img\_popup\_id' ); |
| [2888](#L2888) |  |
| [2889](#L2889) | if ( in\_array($option\_name, $img\_settings) && $option\_value && $option\_value != '' ) { |
| [2890](#L2890) | $option\_value = $this->cmp\_get\_img\_urls($option\_value); |
| [2891](#L2891) | } |
| [2892](#L2892) |  |
| [2893](#L2893) | if ( $option\_name === 'niteoCS\_posts' ) { |
| [2894](#L2894) | $option\_value = '[]'; |
| [2895](#L2895) | } |
| [2896](#L2896) |  |
| [2897](#L2897) |  |
| [2898](#L2898) | $options[$i] = array( $option\_name => $option\_value ); |
| [2899](#L2899) | $i++; |
| [2900](#L2900) | } |
| [2901](#L2901) |  |
| [2902](#L2902) | return json\_encode($options); |
| [2903](#L2903) | } |
| [2904](#L2904) |  |
| [2905](#L2905) | /\*\* |
| [2906](#L2906) | \* Helper function to retrieve full img URL, comma separated, by ID |
| [2907](#L2907) | \* |
| [2908](#L2908) | \* @since 3.5.3 |
| [2909](#L2909) | \* @access public |
| [2910](#L2910) | \* @return string |
| [2911](#L2911) | \*/ |
| [2912](#L2912) |  |
| [2913](#L2913) | public function cmp\_get\_img\_urls( $ids ) { |
| [2914](#L2914) |  |
| [2915](#L2915) | $id\_array = explode(',', $ids); |
| [2916](#L2916) | $i = 1; |
| [2917](#L2917) | $urls = ''; |
| [2918](#L2918) |  |
| [2919](#L2919) | foreach ($id\_array as $id) { |
| [2920](#L2920) | $sep = ($i < count($id\_array)) ? ',' : ''; |
| [2921](#L2921) | $image\_url = wp\_get\_attachment\_image\_src( $id, 'full'); |
| [2922](#L2922) |  |
| [2923](#L2923) | if ( isset( $image\_url[0] ) ) { |
| [2924](#L2924) | $image\_url = $image\_url[0]; |
| [2925](#L2925) | } |
| [2926](#L2926) |  |
| [2927](#L2927) | $urls .= $image\_url . $sep; |
| [2928](#L2928) |  |
| [2929](#L2929) | $i++; |
| [2930](#L2930) | } |
| [2931](#L2931) |  |
| [2932](#L2932) | return $urls; |
| [2933](#L2933) | } |
| [2934](#L2934) |  |
| [2935](#L2935) | /\*\* |
| [2936](#L2936) | \* export settings to JSON via AJAX |
| [2937](#L2937) | \* |
| [2938](#L2938) | \* @since 3.5.3 |
| [2939](#L2939) | \* @access public |
| [2940](#L2940) | \* @return string |
| [2941](#L2941) | \*/ |
| [2942](#L2942) | public function cmp\_ajax\_export\_settings() { |
| [2943](#L2943) | // verify nonce |
| [2944](#L2944) | check\_ajax\_referer( 'cmp-coming-soon-ajax-secret', 'security' ); |
| [2945](#L2945) |  |
| [2946](#L2946) | // verify user rights |
| [2947](#L2947) | if( !current\_user\_can('publish\_pages') ) { |
| [2948](#L2948) | die('Sorry, but this request is invalid'); |
| [2949](#L2949) | } |
| [2950](#L2950) |  |
| [2951](#L2951) | $settings = $this->cmp\_export\_settings(); |
| [2952](#L2952) |  |
| [2953](#L2953) | $replace = array('https://', 'http://'); |
| [2954](#L2954) | $home\_url = str\_replace($replace, '', get\_home\_url()); |
| [2955](#L2955) |  |
| [2956](#L2956) | if ( !empty($settings) ) { |
| [2957](#L2957) | $filename =  $home\_url. '-cmp-settings-' . date('Y-m-d') . '.json'; |
| [2958](#L2958) |  |
| [2959](#L2959) | header('Content-Type: application/json'); |
| [2960](#L2960) | header('Content-Disposition: attachment;filename=' . $filename); |
| [2961](#L2961) |  |
| [2962](#L2962) | $fp = fopen('php://output', 'w'); |
| [2963](#L2963) |  |
| [2964](#L2964) | fwrite($fp , $settings); |
| [2965](#L2965) | fclose($fp); |
| [2966](#L2966) | } |
| [2967](#L2967) | die(); |
| [2968](#L2968) | } |
| [2969](#L2969) |  |
| [2970](#L2970) | /\*\* |
| [2971](#L2971) | \* import settings function |
| [2972](#L2972) | \* |
| [2973](#L2973) | \* @since 3.5.3 |
| [2974](#L2974) | \* @access public |
| [2975](#L2975) | \* @return string |
| [2976](#L2976) | \*/ |
| [2977](#L2977) | public function cmp\_ajax\_import\_settings( ) { |
| [2978](#L2978) |  |
| [2979](#L2979) | check\_ajax\_referer( 'cmp-coming-soon-ajax-secret', 'security' ); |
| [2980](#L2980) |  |
| [2981](#L2981) | // verify user rights |
| [2982](#L2982) | if( !current\_user\_can('publish\_pages') ) { |
| [2983](#L2983) | die('Sorry, but this request is invalid'); |
| [2984](#L2984) | } |
| [2985](#L2985) |  |
| [2986](#L2986) | $settings = json\_decode( stripslashes($\_POST['json']), true ); |
| [2987](#L2987) |  |
| [2988](#L2988) | $result = array( |
| [2989](#L2989) | 'result' => 'success', |
| [2990](#L2990) | 'message' => \_\_('All done!', 'cmp-coming-soon-maintenance') |
| [2991](#L2991) | ); |
| [2992](#L2992) |  |
| [2993](#L2993) | if ( json\_last\_error() == JSON\_ERROR\_NONE ) { |
| [2994](#L2994) | if ( $settings[0] === 'CMP\_EXPORT' ) { |
| [2995](#L2995) | // remove first value used for JSON CMP Settings check |
| [2996](#L2996) | unset($settings[0]); |
| [2997](#L2997) |  |
| [2998](#L2998) | // delete all current CMP Settings |
| [2999](#L2999) | global $wpdb; |
| [3000](#L3000) | $saved\_options = $wpdb->get\_results( "SELECT \* FROM $wpdb->options WHERE option\_name LIKE 'niteoCS\_%'", OBJECT ); |
| [3001](#L3001) | foreach ($saved\_options as $option) { |
| [3002](#L3002) | delete\_option($option->option\_name); |
| [3003](#L3003) | } |
| [3004](#L3004) |  |
| [3005](#L3005) | // import cmp settings from JSON structure |
| [3006](#L3006) | foreach ( $settings as $setting ) { |
| [3007](#L3007) |  |
| [3008](#L3008) | $img\_settings = array( 'niteoCS\_banner\_id', 'niteoCS\_logo\_id', 'niteoCS\_seo\_img\_id', 'niteoCS\_favicon\_id', 'niteoCS\_subs\_img\_id', 'niteoCS\_subs\_img\_popup\_id' ); |
| [3009](#L3009) |  |
| [3010](#L3010) | $name = key($setting); |
| [3011](#L3011) | $value = $setting[$name]; |
| [3012](#L3012) |  |
| [3013](#L3013) | if ( in\_array($name, $img\_settings) ) { |
| [3014](#L3014) |  |
| [3015](#L3015) | $urls = explode(',', $value); |
| [3016](#L3016) |  |
| [3017](#L3017) | if (is\_array($urls)) { |
| [3018](#L3018) | foreach ( $urls as $url ) { |
| [3019](#L3019) | $value = $this->cmp\_insert\_attachment\_from\_url($url); |
| [3020](#L3020) | $value .= ',' . $value; |
| [3021](#L3021) | } |
| [3022](#L3022) | } |
| [3023](#L3023) | } |
| [3024](#L3024) |  |
| [3025](#L3025) | update\_option( $name, $value ); |
| [3026](#L3026) | } |
| [3027](#L3027) | } else { |
| [3028](#L3028) | $result = array( |
| [3029](#L3029) | 'result' => 'error', |
| [3030](#L3030) | 'message' =>  \_\_('JSON file is valid but it does not contain CMP Settings.', 'cmp-coming-soon-maintenance') |
| [3031](#L3031) | ); |
| [3032](#L3032) | } |
| [3033](#L3033) | } else { |
| [3034](#L3034) | $result = array( |
| [3035](#L3035) | 'result' => 'error', |
| [3036](#L3036) | 'message' =>  \_\_('Please insert valid JSON file and try again.', 'cmp-coming-soon-maintenance') |
| [3037](#L3037) | ); |
| [3038](#L3038) |  |
| [3039](#L3039) | } |
| [3040](#L3040) |  |
| [3041](#L3041) | echo json\_encode($result); |
| [3042](#L3042) | wp\_die(); |
| [3043](#L3043) |  |
| [3044](#L3044) | } |
| [3045](#L3045) |  |
| [3046](#L3046) | /\*\* |
| [3047](#L3047) | \* Insert an attachment from an URL address. |
| [3048](#L3048) | \* by https://gist.github.com/m1r0/f22d5237ee93bcccb0d9 |
| [3049](#L3049) | \* |
| [3050](#L3050) | \* @param  String $url |
| [3051](#L3051) | \* @param  Int    $parent\_post\_id |
| [3052](#L3052) | \* @return Int    Attachment ID |
| [3053](#L3053) | \*/ |
| [3054](#L3054) | private function cmp\_insert\_attachment\_from\_url($url, $parent\_post\_id = null) { |
| [3055](#L3055) |  |
| [3056](#L3056) | if( !class\_exists( 'WP\_Http' ) ) { |
| [3057](#L3057) | include\_once( ABSPATH . WPINC . '/class-http.php' ); |
| [3058](#L3058) | } |
| [3059](#L3059) |  |
| [3060](#L3060) | $http = new WP\_Http(); |
| [3061](#L3061) |  |
| [3062](#L3062) | $response = $http->request( $url ); |
| [3063](#L3063) |  |
| [3064](#L3064) | if( is\_wp\_error( $response ) || $response['response']['code'] != 200 ) { |
| [3065](#L3065) | return false; |
| [3066](#L3066) | } |
| [3067](#L3067) |  |
| [3068](#L3068) | $upload = wp\_upload\_bits( basename($url), null, $response['body'] ); |
| [3069](#L3069) |  |
| [3070](#L3070) | if( !empty( $upload['error'] ) ) { |
| [3071](#L3071) | return false; |
| [3072](#L3072) | } |
| [3073](#L3073) |  |
| [3074](#L3074) | $file\_path = $upload['file']; |
| [3075](#L3075) | $file\_name = basename( $file\_path ); |
| [3076](#L3076) | $file\_type = wp\_check\_filetype( $file\_name, null ); |
| [3077](#L3077) | $attachment\_title = sanitize\_file\_name( pathinfo( $file\_name, PATHINFO\_FILENAME ) ); |
| [3078](#L3078) | $wp\_upload\_dir = wp\_upload\_dir(); |
| [3079](#L3079) | $post\_info = array( |
| [3080](#L3080) | 'guid'           => $wp\_upload\_dir['url'] . '/' . $file\_name, |
| [3081](#L3081) | 'post\_mime\_type' => $file\_type['type'], |
| [3082](#L3082) | 'post\_title'     => $attachment\_title, |
| [3083](#L3083) | 'post\_content'   => '', |
| [3084](#L3084) | 'post\_status'    => 'inherit', |
| [3085](#L3085) | ); |
| [3086](#L3086) |  |
| [3087](#L3087) | // Create the attachment |
| [3088](#L3088) | $attach\_id = wp\_insert\_attachment( $post\_info, $file\_path, $parent\_post\_id ); |
| [3089](#L3089) | // Include image.php |
| [3090](#L3090) | require\_once( ABSPATH . 'wp-admin/includes/image.php' ); |
| [3091](#L3091) | // Define attachment metadata |
| [3092](#L3092) | $attach\_data = wp\_generate\_attachment\_metadata( $attach\_id, $file\_path ); |
| [3093](#L3093) | // Assign metadata to attachment |
| [3094](#L3094) | wp\_update\_attachment\_metadata( $attach\_id,  $attach\_data ); |
| [3095](#L3095) |  |
| [3096](#L3096) | return $attach\_id; |
| [3097](#L3097) | } |
| [3098](#L3098) |  |
| [3099](#L3099) |  |
| [3100](#L3100) | /\*\* |
| [3101](#L3101) | \* Send email notification to specify user |
| [3102](#L3102) | \* |
| [3103](#L3103) | \* @param  String $message |
| [3104](#L3104) | \*/ |
| [3105](#L3105) | private function cmp\_send\_notification( $status ) { |
| [3106](#L3106) | // send notification email to admin, if enabled |
| [3107](#L3107) | if ( get\_option('niteoCS\_mode\_change\_notification', '0') == '1' ) { |
| [3108](#L3108) | switch ( $this->cmp\_mode() ) { |
| [3109](#L3109) | case '1': |
| [3110](#L3110) | $mode = \_\_('Maintenance','cmp-coming-soon-maintenance'); |
| [3111](#L3111) | break; |
| [3112](#L3112) | case '2': |
| [3113](#L3113) | $mode = \_\_('Coming Soon','cmp-coming-soon-maintenance'); |
| [3114](#L3114) | break; |
| [3115](#L3115) | case '3': |
| [3116](#L3116) | $mode = \_\_('Redirect','cmp-coming-soon-maintenance'); |
| [3117](#L3117) | break; |
| [3118](#L3118) | default: |
| [3119](#L3119) | break; |
| [3120](#L3120) | } |
| [3121](#L3121) | $current\_user = wp\_get\_current\_user(); |
| [3122](#L3122) | $email = get\_option('niteoCS\_mode\_change\_email\_address', get\_option( 'admin\_email' )); |
| [3123](#L3123) | $subject = $mode . ' mode on your website - ' . get\_site\_url() . ' - was just turned ' . $status . ' by ' . $current\_user->user\_login; |
| [3124](#L3124) | $body = 'This is auto generated message from CMP - Coming Soon & Maintenance WordPress Plugin. You can disable these messages under CMP Advanced Settings > Email Notifications.'; |
| [3125](#L3125) | $headers = array('Content-Type: text/plain; charset=UTF-8'); |
| [3126](#L3126) | // send email |
| [3127](#L3127) | wp\_mail( $email, $subject, $body, $headers ); |
| [3128](#L3128) | } |
| [3129](#L3129) |  |
| [3130](#L3130) | return; |
| [3131](#L3131) | } |
| [3132](#L3132) |  |
| [3133](#L3133) | /\*\* |
| [3134](#L3134) | \* Display Admin notices |
| [3135](#L3135) | \* |
| [3136](#L3136) | \* @since 3.7.3 |
| [3137](#L3137) | \*/ |
| [3138](#L3138) | public function cmp\_display\_admin\_notice( $type, $dismisable, $message ) { |
| [3139](#L3139) |  |
| [3140](#L3140) | echo '<div class="notice notice-'.$type.' '.$dismisable.'"><p class="message">'.$message.'</p></div>'; |
| [3141](#L3141) | } |
| [3142](#L3142) |  |
| [3143](#L3143) | /\*\* |
| [3144](#L3144) | \* Disable REST API if required |
| [3145](#L3145) | \*/ |
| [3146](#L3146) | function restrict\_rest\_api( $result ) { |
| [3147](#L3147) | if ( true === $result || is\_wp\_error( $result ) ) { |
| [3148](#L3148) | return $result; |
| [3149](#L3149) | } |
| [3150](#L3150) |  |
| [3151](#L3151) | // No authentication has been performed yet. |
| [3152](#L3152) | // Return an error if user is not logged in. |
| [3153](#L3153) | if ( ! is\_user\_logged\_in() ) { |
| [3154](#L3154) | return new WP\_Error( |
| [3155](#L3155) | 'rest\_disabled', |
| [3156](#L3156) | \_\_( 'JSON API is disabled by CMP – Coming Soon & Maintenance Plugin.' ), |
| [3157](#L3157) | array( 'status' => 401 ) |
| [3158](#L3158) | ); |
| [3159](#L3159) | } |
| [3160](#L3160) |  |
| [3161](#L3161) | } |
| [3162](#L3162) |  |
| [3163](#L3163) | function jetpack\_stats\_compatibility() { |
| [3164](#L3164) | if ( function\_exists( 'stats\_footer' ) ) { |
| [3165](#L3165) | add\_action( 'cmp\_footer', 'stats\_footer', 101 ); |
| [3166](#L3166) | } |
| [3167](#L3167) | } |
| [3168](#L3168) |  |
| [3169](#L3169) | } |
| [3170](#L3170) |  |
| [3171](#L3171) |  |
| [3172](#L3172) | endif; |
| [3173](#L3173) |  |
| [3174](#L3174) | /\* |
| [3175](#L3175) | \* @since 2.8.1 |
| [3176](#L3176) | \* @return object|CMP\_Coming\_Soon\_and\_Maintenance instance. |
| [3177](#L3177) | \*/ |
| [3178](#L3178) | function cmp\_coming\_soon\_and\_maintenance() { |
| [3179](#L3179) | return CMP\_Coming\_Soon\_and\_Maintenance::instance(); |
| [3180](#L3180) | } |
| [3181](#L3181) |  |
| [3182](#L3182) | // Get the things running |
| [3183](#L3183) | cmp\_coming\_soon\_and\_maintenance(); |
| [3184](#L3184) |  |
| [3185](#L3185) | register\_uninstall\_hook( \_\_FILE\_\_, 'cmp\_plugin\_delete' ); |
| [3186](#L3186) |  |
| [3187](#L3187) | // And here goes the uninstallation function: |
| [3188](#L3188) | function cmp\_plugin\_delete() { |
| [3189](#L3189) | delete\_option('niteoCS\_archive'); |
| [3190](#L3190) | } |
| [3191](#L3191) |  |
| [3192](#L3192) |  |
| [3193](#L3193) |  |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/cmp-coming-soon-maintenance/tags/4.1.6/niteo-cmp.php?format=txt)
* [Original Format](/export/3222449/cmp-coming-soon-maintenance/tags/4.1.6/niteo-cmp.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


