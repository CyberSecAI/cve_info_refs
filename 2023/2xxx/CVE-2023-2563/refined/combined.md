=== Content from plugins.trac.wordpress.org_2989b172_20250114_195418.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fcontact-forms%2Ftrunk%2Faccua-forms.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/contact-forms/trunk/accua-forms.php?rev=3079392 "Revision 3079392")
* Next Revision →
* [Blame](/browser/contact-forms/trunk/accua-forms.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/contact-forms/trunk/accua-forms.php)

---

# [source:](/browser?order=name "Go to repository root") [contact-forms](/browser/contact-forms?order=name "View contact-forms")/[trunk](/browser/contact-forms/trunk?order=name "View trunk")/[accua-forms.php](/browser/contact-forms/trunk/accua-forms.php?order=name "View accua-forms.php")

View diff against:

View revision:

| [Last change](/changeset/3196728/contact-forms/trunk/accua-forms.php "View differences") on this file was [3196728](/changeset/3196728/ "View changeset 3196728"), checked in by cimatti, [7 weeks ago](/timeline?from=2024-11-25T17%3A15%3A35Z&precision=second "See timeline at 11/25/2024 05:15:35 PM") |
| --- |
| 1.9.3  * Matomo support for tracking field filled in and form submissions as events * Fixed CSRF vulnerability |
| **File size:** 195.4 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | add\_action('admin\_menu', 'accua\_forms\_menu', -95); |
| [3](#L3) | function accua\_forms\_menu(){ |
| [4](#L4) | $dashboard\_admin\_page=add\_menu\_page('Wordpress Contact Forms by Cimatti', 'Contact Forms', 'manage\_options', 'accua\_forms', 'accua\_forms\_dashboard\_page', ACCUA\_FORMS\_DIR\_URL.'img/cimatti-icon-10.png', '90.90300'); |
| [5](#L5) | add\_action('load-'.$dashboard\_admin\_page, 'accua\_forms\_dashboard\_page\_head'); |
| [6](#L6) |  |
| [7](#L7) | add\_submenu\_page('accua\_forms', 'Wordpress Contact Forms by Cimatti', 'Dashboard', 'manage\_options', "accua\_forms", 'accua\_forms\_dashboard\_page'); |
| [8](#L8) |  |
| [9](#L9) | $form\_edit\_page = add\_submenu\_page('accua\_forms', 'Forms', 'Forms', 'manage\_options', "accua\_forms\_list", 'accua\_forms\_list\_page'); |
| [10](#L10) | add\_action('admin\_head-'.$form\_edit\_page, 'accua\_forms\_edit\_page\_head'); |
| [11](#L11) | add\_action( 'admin\_print\_styles-'.$form\_edit\_page, 'accua\_forms\_edit\_page\_head\_styles'); |
| [12](#L12) | add\_action( 'admin\_print\_scripts-'.$form\_edit\_page, 'accua\_forms\_edit\_page\_head\_scripts'); |
| [13](#L13) |  |
| [14](#L14) | $form\_add\_page = add\_submenu\_page('accua\_forms', \_\_('Add new form', 'contact-forms'), \_\_('Add new', 'contact-forms'), 'manage\_options', "accua\_forms\_add", 'accua\_forms\_add\_page'); |
| [15](#L15) | add\_action('admin\_head-'.$form\_add\_page, 'accua\_forms\_edit\_page\_head'); |
| [16](#L16) | add\_action( 'admin\_print\_styles-'.$form\_add\_page, 'accua\_forms\_edit\_page\_head\_styles'); |
| [17](#L17) | add\_action( 'admin\_print\_scripts-'.$form\_add\_page, 'accua\_forms\_edit\_page\_head\_scripts'); |
| [18](#L18) |  |
| [19](#L19) | $form\_submissions\_page =  add\_submenu\_page('accua\_forms', \_\_('Forms submissions', 'contact-forms') , \_\_('Submissions', 'contact-forms'), 'manage\_options', "accua\_forms\_submissions\_list", '\_\_accua\_forms\_submissions\_list\_page'); |
| [20](#L20) | add\_action('admin\_head-'.$form\_submissions\_page, 'accua\_forms\_submissions\_list\_page\_head'); |
| [21](#L21) | add\_action( 'admin\_print\_styles-'.$form\_submissions\_page, 'accua\_forms\_edit\_page\_head\_styles'); |
| [22](#L22) |  |
| [23](#L23) | $form\_fields\_page = add\_submenu\_page('accua\_forms', \_\_( 'Form fields', 'contact-forms'), \_\_('Fields', 'contact-forms'), 'manage\_options', "accua\_forms\_fields", 'accua\_forms\_fields\_page'); |
| [24](#L24) | //add\_action('admin\_head-'.$form\_fields\_page, 'accua\_forms\_fields\_page\_head'); |
| [25](#L25) | add\_action( 'admin\_print\_styles-'.$form\_fields\_page, 'accua\_forms\_edit\_page\_head\_styles'); |
| [26](#L26) |  |
| [27](#L27) | $settings\_page = add\_submenu\_page('accua\_forms', \_\_( 'Default Forms settings', 'contact-forms'), \_\_('Settings', 'contact-forms'), 'manage\_options', "accua\_forms\_settings", 'accua\_forms\_settings\_page'); |
| [28](#L28) | add\_action( 'admin\_print\_styles-'.$settings\_page, 'accua\_forms\_edit\_page\_head\_styles'); |
| [29](#L29) | add\_action( 'admin\_print\_scripts-'.$settings\_page, 'accua\_forms\_settings\_page\_head\_scripts'); |
| [30](#L30) |  |
| [31](#L31) | wp\_enqueue\_script('jquery-form'); |
| [32](#L32) | wp\_enqueue\_script('jquery-color'); |
| [33](#L33) | wp\_enqueue\_script('jquery-ui-core'); |
| [34](#L34) | wp\_enqueue\_script('jquery-ui-tabs'); |
| [35](#L35) | wp\_enqueue\_script('jquery-ui-sortable'); |
| [36](#L36) | wp\_enqueue\_script('jquery-ui-draggable'); |
| [37](#L37) | wp\_enqueue\_script('jquery-ui-droppable'); |
| [38](#L38) | wp\_enqueue\_script('jquery-ui-selectable'); |
| [39](#L39) | wp\_enqueue\_script('jquery-ui-resizable'); |
| [40](#L40) | wp\_enqueue\_script('jquery-ui-dialog'); |
| [41](#L41) | wp\_enqueue\_style('wp-jquery-ui-dialog'); |
| [42](#L42) | } |
| [43](#L43) |  |
| [44](#L44) | function accua\_forms\_report\_page\_head(){ |
| [45](#L45) | $column\_list = array( |
| [46](#L46) | 'month' => \_\_( 'Month', 'contact-forms'), |
| [47](#L47) | 'unique\_submissions' => \_\_( 'Unique submissions', 'contact-forms') , |
| [48](#L48) | 'submissions' => \_\_('Total submissions', 'contact-forms'), |
| [49](#L49) | ); |
| [50](#L50) | global $hook\_suffix; |
| [51](#L51) | register\_column\_headers($hook\_suffix, $column\_list); |
| [52](#L52) |  |
| [53](#L53) | //$baseurl = WP\_PLUGIN\_URL.'/'.substr(plugin\_basename(\_\_FILE\_\_),0,-strlen(basename(\_\_FILE\_\_))); |
| [54](#L54) | //echo '<link href="'.$baseurl.'/flot/layout.css" rel="stylesheet" type="text/css">'; |
| [55](#L55) | //echo '<!--[if lte IE 8]><script language="javascript" type="text/javascript" src="'.$baseurl.'/flot/excanvas.min.js"></script><![endif]-->'; |
| [56](#L56) | //echo '<script language="javascript" type="text/javascript" src="'.$baseurl.'/flot/jquery.flot.js"></script>'; |
| [57](#L57) |  |
| [58](#L58) | } |
| [59](#L59) |  |
| [60](#L60) |  |
| [61](#L61) | function accua\_forms\_report\_page() { |
| [62](#L62) | ?> |
| [63](#L63) | <div id="accua\_forms\_report\_page" class="accua\_forms\_admin\_page wrap"> |
| [64](#L64) | <h2>Forms submissions report</h2> |
| [65](#L65) |  |
| [66](#L66) | <?php |
| [67](#L67) | global $wpdb, $hook\_suffix; |
| [68](#L68) | $months = array(1 => 'January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'); |
| [69](#L69) |  |
| [70](#L70) | $query = "SELECT YEAR(sub\_date) AS `year`, MONTH(sub\_date) AS `month`, COUNT(DISTINCT `email`) AS `unique\_submissions`, COUNT(\*) AS `submissions` |
| [71](#L71) | FROM `{$wpdb->prefix}cformssubmissions` |
| [72](#L72) | GROUP BY `year`, `month` |
| [73](#L73) | ORDER BY `year` DESC, `month` DESC"; |
| [74](#L74) |  |
| [75](#L75) | $results = $wpdb->get\_results($query); |
| [76](#L76) |  |
| [77](#L77) | if ($results) { |
| [78](#L78) | ?> |
| [79](#L79) | <style type="text/css"> |
| [80](#L80) | .column-submissions, .column-unique\_submissions { |
| [81](#L81) | text-align: right !important; |
| [82](#L82) | } |
| [83](#L83) | </style> |
| [84](#L84) | <div id="accua-form-report-graph" style="height:300px;"></div> |
| [85](#L85) | <table class="widefat" id="stnl\_review\_reviewed"> |
| [86](#L86) | <thead> |
| [87](#L87) | <tr><?php print\_column\_headers($hook\_suffix); ?></tr> |
| [88](#L88) | </thead> |
| [89](#L89) |  |
| [90](#L90) | <tfoot> |
| [91](#L91) | <tr><?php print\_column\_headers($hook\_suffix, false); ?></tr> |
| [92](#L92) | </tfoot> |
| [93](#L93) |  |
| [94](#L94) | <tbody> |
| [95](#L95) | <?php |
| [96](#L96) | $alternate = false; |
| [97](#L97) | $hidden = get\_hidden\_columns($hook\_suffix); |
| [98](#L98) | $data = array( |
| [99](#L99) | array( 'label' => \_\_( 'Unique submissions', 'contact-forms'), 'data' => array()), |
| [100](#L100) | array( 'label' => \_\_( 'Total submissions', 'contact-forms'), 'data' => array()), |
| [101](#L101) | ); |
| [102](#L102) | foreach ($results as $result){ |
| [103](#L103) | $month = $months[$result->month]; |
| [104](#L104) | echo "<tr class='iedit ".(($alternate = !$alternate)?'alternate':'')."'>\n"; |
| [105](#L105) | echo "<td class='column-month'".(in\_array('month', $hidden)?" style='display:none;'":'').">$month {$result->year}</td>\n"; |
| [106](#L106) | echo "<td class='column-unique\_submissions'".(in\_array('unique\_submissions', $hidden)?" style='display:none;'":'').">{$result->unique\_submissions}</td>\n"; |
| [107](#L107) | echo "<td class='column-submissions'".(in\_array('submissions', $hidden)?" style='display:none;'":'').">{$result->submissions}</td>\n"; |
| [108](#L108) | echo "</tr>\n"; |
| [109](#L109) | $time = mktime(0, 0, 0, $result->month, 1, $result->year) \* 1000; |
| [110](#L110) | $data[0]['data'][] = array($time, (int)$result->unique\_submissions); |
| [111](#L111) | $data[1]['data'][] = array($time, (int)$result->submissions); |
| [112](#L112) | } |
| [113](#L113) | /\* |
| [114](#L114) | $year = $results[0]->year; |
| [115](#L115) | $month = $results[0]->month; |
| [116](#L116) | while ($year <= $result->year || $month <= $result->month) { |
| [117](#L117) |  |
| [118](#L118) | $month++; |
| [119](#L119) | if ($month > 12) { |
| [120](#L120) | $year++; |
| [121](#L121) | $month = 1; |
| [122](#L122) | } |
| [123](#L123) | } |
| [124](#L124) | \*/ |
| [125](#L125) | ?> |
| [126](#L126) | </tbody> |
| [127](#L127) | </table> |
| [128](#L128) | <script type="text/javascript"> |
| [129](#L129) | jQuery(function($){ |
| [130](#L130) | var data = <?php print \_accua\_forms\_json\_encode($data); ?> ; |
| [131](#L131) | var options = { |
| [132](#L132) | xaxis: { |
| [133](#L133) | //autoscaleMargin: 0.005, |
| [134](#L134) | mode: "time", |
| [135](#L135) | timeformat: "%b %y", |
| [136](#L136) | minTickSize: [1, "month"] |
| [137](#L137) | }, |
| [138](#L138) | legend: { |
| [139](#L139) | position: "nw" |
| [140](#L140) | } |
| [141](#L141) | }; |
| [142](#L142) | $.plot($("#accua-form-report-graph"), data, options); |
| [143](#L143) | }); |
| [144](#L144) | </script> |
| [145](#L145) | <?php |
| [146](#L146) | } |
| [147](#L147) | ?> |
| [148](#L148) |  |
| [149](#L149) | </div> |
| [150](#L150) | <?php |
| [151](#L151) | } |
| [152](#L152) |  |
| [153](#L153) | function accua\_forms\_edit\_page\_head\_styles() { |
| [154](#L154) | //wp\_admin\_css( 'widgets' ); |
| [155](#L155) | wp\_enqueue\_style( 'wp-pointer' ); //for tooltips |
| [156](#L156) | wp\_enqueue\_style( 'accua-forms-admin', plugins\_url('accua-forms-admin.css', ACCUA\_FORMS\_FILE), array(), ACCUA\_FORMS\_CSS\_VERSION); // |
| [157](#L157) | } |
| [158](#L158) |  |
| [159](#L159) | function accua\_forms\_edit\_page\_head\_scripts() { |
| [160](#L160) | //wp\_enqueue\_script('admin-widgets'); |
| [161](#L161) | /\*wp\_enqueue\_script('jquery-ui-sortable'); |
| [162](#L162) | wp\_enqueue\_script('jquery-ui-draggable'); |
| [163](#L163) | wp\_enqueue\_script('jquery-ui-droppable');\*/ |
| [164](#L164) | wp\_enqueue\_script( 'wp-pointer' ); //for tooltips |
| [165](#L165) | wp\_enqueue\_script('accua-jqColorPicker', plugins\_url('/js/jqColorPicker.min.js', ACCUA\_FORMS\_FILE ), array( 'jquery' ), ACCUA\_FORMS\_JS\_VERSION); |
| [166](#L166) |  |
| [167](#L167) | wp\_enqueue\_script( 'accua-form-fields', plugins\_url( 'form-fields.js' , ACCUA\_FORMS\_FILE ), array( 'jquery-ui-sortable', 'jquery-ui-draggable', 'jquery-ui-droppable' ), ACCUA\_FORMS\_JS\_VERSION); |
| [168](#L168) | wp\_enqueue\_script( 'accua-form-settings', plugins\_url('form-settings.js', ACCUA\_FORMS\_FILE), array('jquery'), ACCUA\_FORMS\_JS\_VERSION); |
| [169](#L169) | } |
| [170](#L170) |  |
| [171](#L171) | function accua\_forms\_settings\_page\_head\_scripts() { |
| [172](#L172) | wp\_enqueue\_script('accua-jqColorPicker', plugins\_url('/js/jqColorPicker.min.js', ACCUA\_FORMS\_FILE ), array( 'jquery' ), ACCUA\_FORMS\_JS\_VERSION); |
| [173](#L173) | } |
| [174](#L174) |  |
| [175](#L175) | function accua\_forms\_edit\_page\_head() { |
| [176](#L176) | if (isset($\_POST['accua-form-edit-action']) || (!isset($\_GET['fid']))) { |
| [177](#L177) | \_accua\_forms\_form\_edit\_action(); |
| [178](#L178) | require\_once('accua-forms-list-page.php'); |
| [179](#L179) | accua\_forms\_list\_page\_table(true); |
| [180](#L180) | } |
| [181](#L181) |  |
| [182](#L182) | ?> |
| [183](#L183) | <style type="text/css"> |
| [184](#L184) | .container > div { |
| [185](#L185) | padding: 0px; |
| [186](#L186) | margin-bottom: 6px; |
| [187](#L187) | } |
| [188](#L188) | .widget-liquid-right .widget, #wp\_inactive\_widgets .widget, .widget-liquid-right .sidebar-description, .widget-placeholder { |
| [189](#L189) | width: 95%; |
| [190](#L190) | } |
| [191](#L191) | .column-submissions { |
| [192](#L192) | text-align: right !important; |
| [193](#L193) | } |
| [194](#L194) | </style> |
| [195](#L195) | <?php |
| [196](#L196) | } |
| [197](#L197) |  |
| [198](#L198) | add\_action( 'wp\_ajax\_accua-form-fields-order' , 'accua\_forms\_form\_fields\_order'); |
| [199](#L199) | function accua\_forms\_form\_fields\_order() { |
| [200](#L200) | if (!current\_user\_can('manage\_options')){ |
| [201](#L201) | wp\_die( -1, 403 ); |
| [202](#L202) | } |
| [203](#L203) | check\_ajax\_referer('edit\_form', '\_nonce\_edit\_form'); |
| [204](#L204) |  |
| [205](#L205) | $post = stripslashes\_deep($\_POST); |
| [206](#L206) | //update\_option('accua\_forms\_form\_fields\_order\_post', $post); |
| [207](#L207) |  |
| [208](#L208) | if (empty($post['sidebars'])) { |
| [209](#L209) | die('-1'); |
| [210](#L210) | } |
| [211](#L211) |  |
| [212](#L212) | $forms\_data = get\_option('accua\_forms\_saved\_forms', array()); |
| [213](#L213) |  |
| [214](#L214) | foreach ($post['sidebars'] as $fid => $order) { |
| [215](#L215) | if (strpos($fid, 'cimatti-accua-fields-form-area-') !== 0){ |
| [216](#L216) | die('-1'); |
| [217](#L217) | } |
| [218](#L218) | $fid = substr($fid, 31); |
| [219](#L219) |  |
| [220](#L220) | if (empty($forms\_data[$fid]['fields'])) { |
| [221](#L221) | die('-1'); |
| [222](#L222) | } |
| [223](#L223) |  |
| [224](#L224) | $old\_fields = $forms\_data[$fid]['fields']; |
| [225](#L225) | unset($forms\_data[$fid]['fields']); |
| [226](#L226) | $new\_fields = array(); |
| [227](#L227) |  |
| [228](#L228) | $order = explode(',', $order); |
| [229](#L229) |  |
| [230](#L230) | foreach ($order as $i) { |
| [231](#L231) | $i = preg\_replace('/^(new-)?widget-\\d+\_/', '', $i); |
| [232](#L232) | if (isset($old\_fields[$i])) { |
| [233](#L233) | $new\_fields[$i] = $old\_fields[$i]; |
| [234](#L234) | unset($old\_fields[$i]); |
| [235](#L235) | } |
| [236](#L236) | } |
| [237](#L237) |  |
| [238](#L238) | if($old\_fields){ |
| [239](#L239) | $new\_fields += $old\_fields; |
| [240](#L240) | } |
| [241](#L241) | $forms\_data[$fid]['fields'] = $new\_fields; |
| [242](#L242) | } |
| [243](#L243) |  |
| [244](#L244) | update\_option('accua\_forms\_saved\_forms', $forms\_data); |
| [245](#L245) |  |
| [246](#L246) | die('1'); |
| [247](#L247) | } |
| [248](#L248) |  |
| [249](#L249) | add\_action( 'wp\_ajax\_accua-save-form-field', 'accua\_forms\_save\_form\_field'); |
| [250](#L250) | /\* azione dove vengono salvati i campi dei un form \*/ |
| [251](#L251) | function accua\_forms\_save\_form\_field() { |
| [252](#L252) | if (!current\_user\_can('manage\_options')){ |
| [253](#L253) | wp\_die( -1, 403 ); |
| [254](#L254) | } |
| [255](#L255) | check\_ajax\_referer('edit\_form', '\_nonce\_edit\_form'); |
| [256](#L256) |  |
| [257](#L257) | $post = stripslashes\_deep($\_POST); |
| [258](#L258) |  |
| [259](#L259) | //update\_option('accua\_forms\_save\_form\_field\_post', $post); |
| [260](#L260) |  |
| [261](#L261) | $forms\_data = get\_option('accua\_forms\_saved\_forms', array()); |
| [262](#L262) | $fid = $post['form-id']; |
| [263](#L263) | if (accua\_forms\_validate\_form\_id($fid) !== '') { |
| [264](#L264) | die('-1'); |
| [265](#L265) | } |
| [266](#L266) | if (empty($forms\_data[$fid]['fields'])) { |
| [267](#L267) | $forms\_data[$fid]['fields'] = array(); |
| [268](#L268) | } |
| [269](#L269) |  |
| [270](#L270) | $avail\_fields = get\_option('accua\_forms\_avail\_fields', array()); |
| [271](#L271) | @ $wid = (string) $post['widget-id']; |
| [272](#L272) | if (isset($avail\_fields[$wid])) { |
| [273](#L273) | $check\_ref = $wid; |
| [274](#L274) | } else { |
| [275](#L275) | if (preg\_match('/^(\_\_html|\_\_fieldset-begin|\_\_fieldset-end)-\d+$/', $wid, $matches)) { |
| [276](#L276) | $check\_ref = $matches[1]; |
| [277](#L277) | } else { |
| [278](#L278) | die('-1'); |
| [279](#L279) | } |
| [280](#L280) | } |
| [281](#L281) | if (empty($post['delete\_widget'])) { |
| [282](#L282) | //$istance\_id = $post['multi\_number']; |
| [283](#L283) | @ $ref = $post['id\_base']; |
| [284](#L284) | if ($ref !== $check\_ref) { |
| [285](#L285) | die('-1'); |
| [286](#L286) | } |
| [287](#L287) | $required = !empty($post["form-field-{$wid}-required"]); |
| [288](#L288) | $widget\_number = empty($post['multi\_number']) ? (empty($post['widget\_number']) ? '' : (int)$post['widget\_number']) : (int)$post['multi\_number']; |
| [289](#L289) |  |
| [290](#L290) | if (isset($forms\_data[$fid]['fields'][$wid])) { |
| [291](#L291) | $old\_istance\_data = $forms\_data[$fid]['fields'][$wid]; |
| [292](#L292) | } else { |
| [293](#L293) | $old\_istance\_data = array(); |
| [294](#L294) | } |
| [295](#L295) |  |
| [296](#L296) | $forms\_data[$fid]['fields'][$wid] = array ( |
| [297](#L297) | 'version' => 2, |
| [298](#L298) | 'istance\_id' => $wid, |
| [299](#L299) | 'widget\_number' => $widget\_number, |
| [300](#L300) | 'ref' => $ref, |
| [301](#L301) | 'required' => $required, |
| [302](#L302) | ); |
| [303](#L303) |  |
| [304](#L304) | if (!empty($post["form-field-{$wid}-override-label"])) { |
| [305](#L305) | @ $label = (string) $post["form-field-{$wid}-label"]; |
| [306](#L306) | if (!current\_user\_can('unfiltered\_html')) { |
| [307](#L307) | $label = wp\_kses($label, 'post'); |
| [308](#L308) | } |
| [309](#L309) | $forms\_data[$fid]['fields'][$wid]['label'] = $label; |
| [310](#L310) | } |
| [311](#L311) |  |
| [312](#L312) | $is\_file = false; |
| [313](#L313) | $is\_date = false; |
| [314](#L314) | if (isset($avail\_fields[$wid]['type'])) { |
| [315](#L315) | if ($avail\_fields[$wid]['type'] == 'file') { |
| [316](#L316) | $is\_file = true; |
| [317](#L317) | } else if ($avail\_fields[$wid]['type'] == 'date') { |
| [318](#L318) | $is\_date = true; |
| [319](#L319) | } |
| [320](#L320) | } |
| [321](#L321) |  |
| [322](#L322) | if (!empty($post["form-field-{$wid}-override-default-value"])) { |
| [323](#L323) | @ $default\_value = (string) $post["form-field-{$wid}-default-value"]; |
| [324](#L324) | if ($is\_date) { |
| [325](#L325) | $default\_value = accua\_forms\_filter\_date($default\_value); |
| [326](#L326) | } else if (!current\_user\_can('unfiltered\_html')) { |
| [327](#L327) | //This is filtered in any case because field type can change |
| [328](#L328) | $default\_value = wp\_kses($default\_value, 'post'); |
| [329](#L329) | } |
| [330](#L330) | $forms\_data[$fid]['fields'][$wid]['default\_value'] = $default\_value; |
| [331](#L331) | } |
| [332](#L332) |  |
| [333](#L333) | if (!empty($post["form-field-{$wid}-override-allowed-values"])) { |
| [334](#L334) | @ $allowed\_values = (string) $post["form-field-{$wid}-allowed-values"]; |
| [335](#L335) | if ($is\_file){ |
| [336](#L336) | $forms\_data[$fid]['fields'][$wid]['allowed\_extensions'] = accua\_forms\_filter\_extensions($allowed\_values); |
| [337](#L337) | } else { |
| [338](#L338) | $forms\_data[$fid]['fields'][$wid]['allowed\_values'] = $allowed\_values; |
| [339](#L339) | } |
| [340](#L340) | } |
| [341](#L341) | if (!empty($post["form-field-{$wid}-override-datemin-values"])) { |
| [342](#L342) | @ $mindate\_values = (string) $post["form-field-{$wid}-min-of-date"]; |
| [343](#L343) | $forms\_data[$fid]['fields'][$wid]['min\_date'] = accua\_forms\_filter\_date($mindate\_values); |
| [344](#L344) | } |
| [345](#L345) | if (!empty($post["form-field-{$wid}-override-datemax-values"])) { |
| [346](#L346) | @ $maxdate\_values = (string) $post["form-field-{$wid}-max-of-date"]; |
| [347](#L347) | $forms\_data[$fid]['fields'][$wid]['max\_date'] = accua\_forms\_filter\_date($maxdate\_values); |
| [348](#L348) | } |
| [349](#L349) | } else { |
| [350](#L350) | unset($forms\_data[$fid]['fields'][$wid]); |
| [351](#L351) | } |
| [352](#L352) |  |
| [353](#L353) | update\_option('accua\_forms\_saved\_forms', $forms\_data); |
| [354](#L354) |  |
| [355](#L355) | die('1'); |
| [356](#L356) | } |
| [357](#L357) |  |
| [358](#L358) | function accua\_forms\_filter\_text($text) { |
| [359](#L359) | if ( is\_object( $text ) || is\_array( $text ) ) { |
| [360](#L360) | return ''; |
| [361](#L361) | } |
| [362](#L362) |  |
| [363](#L363) | $text = (string) $text; |
| [364](#L364) | $text = wp\_check\_invalid\_utf8( $text ); |
| [365](#L365) | $text = preg\_replace( '/[ \t\n\r\0\x0B]+/', ' ', $text ); |
| [366](#L366) | $text = trim( $text ); |
| [367](#L367) |  |
| [368](#L368) | return $text; |
| [369](#L369) | } |
| [370](#L370) |  |
| [371](#L371) | function accua\_forms\_filter\_email($email) { |
| [372](#L372) | $parts = explode('<', $email); |
| [373](#L373) | if (isset($parts[1])) { |
| [374](#L374) | $email = accua\_forms\_filter\_text(trim($parts[1], "<> \t\n\r\0\x0B")); |
| [375](#L375) | $display\_name = accua\_forms\_filter\_text(trim($parts[0])); |
| [376](#L376) | return "$display\_name <$email>"; |
| [377](#L377) | } else { |
| [378](#L378) | return accua\_forms\_filter\_text($email); |
| [379](#L379) | } |
| [380](#L380) | } |
| [381](#L381) |  |
| [382](#L382) | function accua\_forms\_filter\_emails($emails) { |
| [383](#L383) | $split\_emails = preg\_split("/\s\*[,;]\s\*/", $emails); |
| [384](#L384) | $emails = array(); |
| [385](#L385) | foreach ($split\_emails as $email) { |
| [386](#L386) | $emails[] = accua\_forms\_filter\_email($email); |
| [387](#L387) | } |
| [388](#L388) | return implode(', ', $emails); |
| [389](#L389) | } |
| [390](#L390) |  |
| [391](#L391) | function accua\_forms\_filter\_extensions($extensions) { |
| [392](#L392) | $cleaned\_extensions = array(); |
| [393](#L393) | $mimes = get\_allowed\_mime\_types(); |
| [394](#L394) | $extensions = explode("\n", $extensions); |
| [395](#L395) | foreach ($extensions as $extension) { |
| [396](#L396) | $extension = trim($extension); |
| [397](#L397) | if ($extension !== '') { |
| [398](#L398) | foreach ( $mimes as $ext\_preg => $mime\_match ) { |
| [399](#L399) | $ext\_preg = '!^' . $ext\_preg . '$!i'; |
| [400](#L400) | if ( preg\_match( $ext\_preg, $extension ) ) { |
| [401](#L401) | $cleaned\_extensions[] = $extension; |
| [402](#L402) | break; |
| [403](#L403) | } |
| [404](#L404) | } |
| [405](#L405) | } |
| [406](#L406) | } |
| [407](#L407) | return implode("\n", $cleaned\_extensions); |
| [408](#L408) | } |
| [409](#L409) |  |
| [410](#L410) | function accua\_forms\_filter\_settings($form\_settings) { |
| [411](#L411) | foreach($form\_settings as $k => $v) { |
| [412](#L412) | switch ($k) { |
| [413](#L413) | case 'success\_message\_no\_message': |
| [414](#L414) | case 'error\_message\_no\_message': |
| [415](#L415) | case 'admin\_emails\_message\_no\_message': |
| [416](#L416) | case 'confirmation\_emails\_message\_no\_message': |
| [417](#L417) | case 'use\_ajax': |
| [418](#L418) | //boolean |
| [419](#L419) | $form\_settings[$k] = (bool) $v; |
| [420](#L420) | break; |
| [421](#L421) | case 'layout': |
| [422](#L422) | $form\_settings[$k] = ($v === 'toplabel') ? 'toplabel' : 'sidebyside'; |
| [423](#L423) | break; |
| [424](#L424) | case 'emails\_from': |
| [425](#L425) | // single email |
| [426](#L426) | $form\_settings[$k] = accua\_forms\_filter\_email($v); |
| [427](#L427) | break; |
| [428](#L428) | case 'admin\_emails\_to': |
| [429](#L429) | case 'emails\_bcc': |
| [430](#L430) | //emails list |
| [431](#L431) | $form\_settings[$k] = accua\_forms\_filter\_email($v); |
| [432](#L432) | break; |
| [433](#L433) | case 'success\_message': |
| [434](#L434) | case 'error\_message': |
| [435](#L435) | case 'admin\_emails\_message': |
| [436](#L436) | case 'confirmation\_emails\_message': |
| [437](#L437) | //HTML |
| [438](#L438) | if (!current\_user\_can('unfiltered\_html')) { |
| [439](#L439) | $form\_settings[$k] = wp\_kses($v, 'post'); |
| [440](#L440) | } |
| [441](#L441) | break; |
| [442](#L442) | //case 'title': |
| [443](#L443) | //case 'emails\_from\_name': |
| [444](#L444) | //case 'admin\_emails\_subject': |
| [445](#L445) | //case 'confirmation\_emails\_subject': |
| [446](#L446) | //case 'style\_\*': |
| [447](#L447) | default: |
| [448](#L448) | // text field |
| [449](#L449) | $form\_settings[$k] = accua\_forms\_filter\_text($v); |
| [450](#L450) | } |
| [451](#L451) | } |
| [452](#L452) | return $form\_settings; |
| [453](#L453) | } |
| [454](#L454) |  |
| [455](#L455) | add\_action( 'wp\_ajax\_accua-save-form-settings', 'accua\_forms\_save\_form\_settings'); |
| [456](#L456) | function accua\_forms\_save\_form\_settings() { |
| [457](#L457) | if (!current\_user\_can('manage\_options')){ |
| [458](#L458) | wp\_die( -1, 403 ); |
| [459](#L459) | } |
| [460](#L460) | check\_ajax\_referer('edit\_form', '\_nonce\_edit\_form'); |
| [461](#L461) |  |
| [462](#L462) | $post = stripslashes\_deep($\_POST); |
| [463](#L463) |  |
| [464](#L464) | $forms\_data = get\_option('accua\_forms\_saved\_forms', array()); |
| [465](#L465) | $fid = $post['form-id']; |
| [466](#L466) | if (accua\_forms\_validate\_form\_id($fid) !== '') { |
| [467](#L467) | die('-1'); |
| [468](#L468) | } |
| [469](#L469) |  |
| [470](#L470) | $settings = array( |
| [471](#L471) | 'title', |
| [472](#L472) | 'success\_message', |
| [473](#L473) | 'success\_message\_no\_message', |
| [474](#L474) | 'error\_message', |
| [475](#L475) | 'error\_message\_no\_message', |
| [476](#L476) | 'emails\_from\_name', |
| [477](#L477) | 'emails\_from', |
| [478](#L478) | 'admin\_emails\_to', |
| [479](#L479) | 'emails\_bcc', |
| [480](#L480) | 'admin\_emails\_subject', |
| [481](#L481) | 'admin\_emails\_message', |
| [482](#L482) | 'admin\_emails\_message\_no\_message', |
| [483](#L483) | 'confirmation\_emails\_subject', |
| [484](#L484) | 'confirmation\_emails\_message', |
| [485](#L485) | 'confirmation\_emails\_message\_no\_message', |
| [486](#L486) | //'use\_ajax', |
| [487](#L487) |  |
| [488](#L488) | 'layout', |
| [489](#L489) | 'style\_margin', |
| [490](#L490) | 'style\_border\_color', |
| [491](#L491) | 'style\_border\_width', |
| [492](#L492) | 'style\_border\_radius', |
| [493](#L493) | 'style\_background\_color', |
| [494](#L494) | 'style\_padding', |
| [495](#L495) | 'style\_color', |
| [496](#L496) | 'style\_font\_size', |
| [497](#L497) | 'style\_field\_spacing', |
| [498](#L498) | 'style\_field\_border\_color', |
| [499](#L499) | 'style\_field\_border\_width', |
| [500](#L500) | 'style\_field\_border\_radius', |
| [501](#L501) | 'style\_field\_background\_color', |
| [502](#L502) | 'style\_field\_padding', |
| [503](#L503) | 'style\_field\_color', |
| [504](#L504) | 'style\_submit\_border\_color', |
| [505](#L505) | 'style\_submit\_border\_width', |
| [506](#L506) | 'style\_submit\_border\_radius', |
| [507](#L507) | 'style\_submit\_background\_color', |
| [508](#L508) | 'style\_submit\_padding', |
| [509](#L509) | 'style\_submit\_color', |
| [510](#L510) | 'style\_submit\_font\_size', |
| [511](#L511) | ); |
| [512](#L512) |  |
| [513](#L513) | // print\_r($post); |
| [514](#L514) |  |
| [515](#L515) | $new\_form\_settings = array(); |
| [516](#L516) | foreach($settings as $i) { |
| [517](#L517) | if (isset($post[$i])) { |
| [518](#L518) | $new\_form\_settings[$i] = $post[$i]; |
| [519](#L519) | } |
| [520](#L520) | unset($forms\_data[$fid][$i]); |
| [521](#L521) | } |
| [522](#L522) |  |
| [523](#L523) | $forms\_data[$fid] += accua\_forms\_filter\_settings($new\_form\_settings); |
| [524](#L524) |  |
| [525](#L525) | $forms\_data[$fid]['use\_ajax'] = !empty($post['use\_ajax']); |
| [526](#L526) |  |
| [527](#L527) | update\_option('accua\_forms\_saved\_forms', $forms\_data); |
| [528](#L528) |  |
| [529](#L529) | //print\_r($forms\_data[$fid]); |
| [530](#L530) |  |
| [531](#L531) | die(''); |
| [532](#L532) | } |
| [533](#L533) |  |
| [534](#L534) | function accua\_forms\_field\_settings\_form\_counter() { |
| [535](#L535) | static $i = 0; |
| [536](#L536) | $i++; |
| [537](#L537) | return $i; |
| [538](#L538) | } |
| [539](#L539) |  |
| [540](#L540) | /\* impostazioni dei campi \*/ |
| [541](#L541) | function accua\_forms\_field\_text\_settings\_form($fid, $field\_data=array(), $istance\_data=array()){ |
| [542](#L542) | static $html\_multi\_number = 0; |
| [543](#L543) | $i = accua\_forms\_field\_settings\_form\_counter(); |
| [544](#L544) |  |
| [545](#L545) | $hidden = ''; |
| [546](#L546) | if (!is\_array($istance\_data)) { |
| [547](#L547) | if ($istance\_data === 'hidden') { |
| [548](#L548) | $hidden = 'style="display:none"'; |
| [549](#L549) | } |
| [550](#L550) | $istance\_data = array(); |
| [551](#L551) | $empty\_istance = true; |
| [552](#L552) | } else { |
| [553](#L553) | $empty\_istance = empty($istance\_data); |
| [554](#L554) | } |
| [555](#L555) |  |
| [556](#L556) | if (!is\_array($field\_data)){ |
| [557](#L557) | $field\_data = array(); |
| [558](#L558) | } |
| [559](#L559) |  |
| [560](#L560) | $field\_data += array( |
| [561](#L561) | 'version' => '1', |
| [562](#L562) | 'id' => '\_\_html', |
| [563](#L563) | 'name' => \_\_( 'Custom HTML content', 'contact-forms'), |
| [564](#L564) | 'type' => 'html', |
| [565](#L565) | 'description' => \_\_('Use this special field to inject raw HTML in the form. You can use this multiple times.', 'contact-forms'), |
| [566](#L566) | 'default\_value' => '', |
| [567](#L567) | 'allowed\_values' => '', |
| [568](#L568) | 'allowed\_extensions' => '', |
| [569](#L569) | ); |
| [570](#L570) |  |
| [571](#L571) | $override\_label = isset($istance\_data['label']) ? 'checked="checked"' : ''; |
| [572](#L572) | $override\_default\_value = isset($istance\_data['default\_value']) ? 'checked="checked"' : ''; |
| [573](#L573) | $override\_allowed\_values = isset($istance\_data['allowed\_values']) ? 'checked="checked"' : ''; |
| [574](#L574) | $override\_allowed\_extensions = ''; |
| [575](#L575) |  |
| [576](#L576) | if ($field\_data['type'] == 'file') { |
| [577](#L577) | if (isset($istance\_data['version']) && $istance\_data['version'] >= 2) { |
| [578](#L578) | if (isset($istance\_data['allowed\_extensions'])) { |
| [579](#L579) | $override\_allowed\_extensions = 'checked="checked"'; |
| [580](#L580) | } |
| [581](#L581) | } else { |
| [582](#L582) | if (isset($istance\_data['allowed\_values'])) { |
| [583](#L583) | $istance\_data['allowed\_extensions'] = $istance\_data['allowed\_values']; |
| [584](#L584) | $override\_allowed\_extensions = 'checked="checked"'; |
| [585](#L585) | } |
| [586](#L586) | } |
| [587](#L587) |  |
| [588](#L588) | if ($field\_data['version'] < 2) { |
| [589](#L589) | $field\_data['allowed\_extensions'] = $field\_data['allowed\_values']; |
| [590](#L590) | } |
| [591](#L591) |  |
| [592](#L592) | if ($field\_data['allowed\_extensions'] === '') { |
| [593](#L593) | $file\_data = get\_option('accua\_forms\_default\_file\_field\_data',array()); |
| [594](#L594) | if (isset($file\_data['valid\_extensions'])){ |
| [595](#L595) | $field\_data['allowed\_extensions'] = $file\_data['valid\_extensions']; |
| [596](#L596) | } |
| [597](#L597) | } |
| [598](#L598) | } |
| [599](#L599) |  |
| [600](#L600) | if ($field\_data['type'] == 'date') { |
| [601](#L601) | $override\_mindate\_values = isset($istance\_data['min\_date']) ? 'checked="checked"' : ''; |
| [602](#L602) | $override\_maxdate\_values = isset($istance\_data['max\_date']) ? 'checked="checked"' : ''; |
| [603](#L603) | //$override\_default\_value = isset($istance\_data['default\_date\_value']) ? 'checked="checked"' : ''; |
| [604](#L604) |  |
| [605](#L605) | $istance\_data += array( |
| [606](#L606) | 'min\_date' => $field\_data['min\_date'], |
| [607](#L607) | 'max\_date' => $field\_data['max\_date'], |
| [608](#L608) | 'default\_value' => $field\_data['default\_date\_value'], |
| [609](#L609) | ); |
| [610](#L610) | } |
| [611](#L611) |  |
| [612](#L612) | $istance\_data += array( |
| [613](#L613) | //'version' => 1, |
| [614](#L614) | 'istance\_id' => $field\_data['id'], |
| [615](#L615) | 'widget\_number' => '', |
| [616](#L616) | 'ref' => $field\_data['id'], |
| [617](#L617) | 'label' => $field\_data['name'], |
| [618](#L618) | 'default\_value' => $field\_data['default\_value'], |
| [619](#L619) | 'allowed\_values' => $field\_data['allowed\_values'], |
| [620](#L620) | 'allowed\_extensions' => $field\_data['allowed\_extensions'], |
| [621](#L621) | 'required' => false, |
| [622](#L622) | ); |
| [623](#L623) |  |
| [624](#L624) | foreach ($istance\_data as $key => $value) { |
| [625](#L625) | $istance\_data[$key] = htmlspecialchars($istance\_data[$key], ENT\_QUOTES); |
| [626](#L626) | } |
| [627](#L627) |  |
| [628](#L628) | foreach ($field\_data as $key => $value) { |
| [629](#L629) | $field\_data[$key] = htmlspecialchars($field\_data[$key], ENT\_QUOTES); |
| [630](#L630) | } |
| [631](#L631) |  |
| [632](#L632) | $multi\_number = ''; |
| [633](#L633) | $add\_new = ''; |
| [634](#L634) |  |
| [635](#L635) | if (in\_array($istance\_data['ref'], array('\_\_html','\_\_fieldset-begin','\_\_fieldset-end'))) { |
| [636](#L636) | $forceoverride\_field = true; |
| [637](#L637) | if ($empty\_istance) { |
| [638](#L638) | $add\_new = 'multi'; |
| [639](#L639) | $istance\_data['istance\_id'] .= '-\_\_i\_\_'; |
| [640](#L640) | $istance\_data['widget\_number'] = 1; |
| [641](#L641) | $multi\_number = 1 + $html\_multi\_number; |
| [642](#L642) | } else { |
| [643](#L643) | if ($html\_multi\_number < $istance\_data['widget\_number']) { |
| [644](#L644) | $html\_multi\_number = $istance\_data['widget\_number']; |
| [645](#L645) | } |
| [646](#L646) | } |
| [647](#L647) | } else { |
| [648](#L648) | $forceoverride\_field = false; |
| [649](#L649) | $add\_new = $empty\_istance ? 'single' : ''; |
| [650](#L650) | } |
| [651](#L651) |  |
| [652](#L652) | $fid = htmlspecialchars($fid, ENT\_QUOTES); |
| [653](#L653) | $testi\_eot = array ( |
| [654](#L654) | 'label' => \_\_( 'Label', 'contact-forms'), |
| [655](#L655) | 'override' => \_\_( 'override', 'contact-forms'), |
| [656](#L656) | 'default\_value' => \_\_( 'Default value', 'contact-forms'), |
| [657](#L657) | 'default\_values' => \_\_( 'Default value(s)', 'contact-forms'), |
| [658](#L658) | 'desc\_def' => \_\_( 'For multiple default values, use | as separator.', 'contact-forms'), |
| [659](#L659) | 'allowed\_values' => \_\_( 'Allowed values', 'contact-forms'), |
| [660](#L660) | 'desc\_all' => \_\_( 'The possible values this field can contain. Enter one value per line, in the format key|label. The key is the value that will be stored in the database. The label is optional, and the key will be used as the label if no label is specified.', 'contact-forms'), |
| [661](#L661) | 'allowed\_extensions' => \_\_( 'Allowed extensions', 'contact-forms'), |
| [662](#L662) | 'desc\_all\_ext' => \_\_( 'Accepted file extensions. One per line, without dots.', 'contact-forms'), |
| [663](#L663) | 'required' => \_\_( 'Required', 'contact-forms'), |
| [664](#L664) | 'custom\_HTML\_content' => \_\_( 'Custom HTML content', 'contact-forms'), |
| [665](#L665) | 'remove' => \_\_( 'Remove', 'contact-forms'), |
| [666](#L666) | 'close' => \_\_( 'Close', 'contact-forms'), |
| [667](#L667) | 'save' => \_\_( 'Save', 'contact-forms'), |
| [668](#L668) | 'min-of-date' => \_\_( 'Min date', 'contact-forms'), |
| [669](#L669) | 'max-of-date' => \_\_( 'Max date', 'contact-forms') |
| [670](#L670) | ); |
| [671](#L671) |  |
| [672](#L672) | if ($forceoverride\_field) { |
| [673](#L673) | $override\_begin = ''; |
| [674](#L674) | $override\_type = 'hidden'; |
| [675](#L675) | $override\_end = ''; |
| [676](#L676) | } else { |
| [677](#L677) | $override\_begin = "({$testi\_eot['override']}: "; |
| [678](#L678) | $override\_type = 'checkbox'; |
| [679](#L679) | $override\_end = ')'; |
| [680](#L680) | } |
| [681](#L681) |  |
| [682](#L682) | $content = <<<EOT |
| [683](#L683) | <p><label for="widget-{$istance\_data['istance\_id']}-label">{$testi\_eot['label']}:</label> |
| [684](#L684) | {$override\_begin}<input type="{$override\_type}" name="form-field-{$istance\_data['istance\_id']}-override-label" value="1" {$override\_label} />{$override\_end}<br> |
| [685](#L685) | <input type="text" value="{$istance\_data['label']}" name="form-field-{$istance\_data['istance\_id']}-label" id="widget-{$istance\_data['istance\_id']}-label" class="widefat"></p> |
| [686](#L686) | EOT; |
| [687](#L687) |  |
| [688](#L688) | $default\_value = <<<EOT |
| [689](#L689) | <p><label for="widget-{$istance\_data['istance\_id']}-default-value">{$testi\_eot['default\_value']}:</label> |
| [690](#L690) | {$override\_begin}<input type="{$override\_type}" name="form-field-{$istance\_data['istance\_id']}-override-default-value" value="1" {$override\_default\_value} />{$override\_end}<br> |
| [691](#L691) | <input type="text" value="{$istance\_data['default\_value']}" name="form-field-{$istance\_data['istance\_id']}-default-value" id="widget-{$istance\_data['istance\_id']}-default-value" class="widefat"></p> |
| [692](#L692) | EOT; |
| [693](#L693) |  |
| [694](#L694) | $default\_values = <<<EOT |
| [695](#L695) | <p><label for="widget-{$istance\_data['istance\_id']}-default-value">{$testi\_eot['default\_value']}:</label> |
| [696](#L696) | {$override\_begin}<input type="{$override\_type}" name="form-field-{$istance\_data['istance\_id']}-override-default-value" value="1" {$override\_default\_value} />{$override\_end}<br> |
| [697](#L697) | <input type="text" value="{$istance\_data['default\_value']}" name="form-field-{$istance\_data['istance\_id']}-default-value" id="widget-{$istance\_data['istance\_id']}-default-value" class="widefat"><br /> |
| [698](#L698) | </p> |
| [699](#L699) | EOT; |
| [700](#L700) |  |
| [701](#L701) | $allowed\_values = <<<EOT |
| [702](#L702) | <p><label for="widget-{$istance\_data['istance\_id']}-allowed-values">{$testi\_eot['allowed\_values']}:</label> |
| [703](#L703) | {$override\_begin}<input type="{$override\_type}" name="form-field-{$istance\_data['istance\_id']}-override-allowed-values" value="1" {$override\_allowed\_values} />{$override\_end}<br> |
| [704](#L704) | <textarea rows="6" cols="50" name="form-field-{$istance\_data['istance\_id']}-allowed-values" id="widget-{$istance\_data['istance\_id']}-allowed-values" class="widefat">{$istance\_data['allowed\_values']}</textarea><br /> |
| [705](#L705) | {$testi\_eot['desc\_all']}</p> |
| [706](#L706) | EOT; |
| [707](#L707) |  |
| [708](#L708) | $allowed\_ext = <<<EOT |
| [709](#L709) | <p><label for="widget-{$istance\_data['istance\_id']}-allowed-values">{$testi\_eot['allowed\_extensions']}:</label> |
| [710](#L710) | {$override\_begin}<input type="{$override\_type}" name="form-field-{$istance\_data['istance\_id']}-override-allowed-values" value="1" {$override\_allowed\_extensions} />{$override\_end}<br> |
| [711](#L711) | <textarea rows="6" cols="50" name="form-field-{$istance\_data['istance\_id']}-allowed-values" id="widget-{$istance\_data['istance\_id']}-allowed-values" class="widefat">{$istance\_data['allowed\_extensions']}</textarea><br /> |
| [712](#L712) | {$testi\_eot['desc\_all\_ext']}</p> |
| [713](#L713) | EOT; |
| [714](#L714) |  |
| [715](#L715) | $required\_checked = empty($istance\_data['required']) ? '' : 'checked="checked"'; |
| [716](#L716) | $required = <<<EOT |
| [717](#L717) | <p><label for="widget-{$istance\_data['istance\_id']}-required">{$testi\_eot['required']}:</label> |
| [718](#L718) | <input type="checkbox" value="1" {$required\_checked} name="form-field-{$istance\_data['istance\_id']}-required" id="widget-{$istance\_data['istance\_id']}-required"></p> |
| [719](#L719) | EOT; |
| [720](#L720) |  |
| [721](#L721) | if ($field\_data['type'] == 'date'){ |
| [722](#L722) | $default\_date\_value = <<<EOT |
| [723](#L723) | <p><label for="widget-{$istance\_data['istance\_id']}-default-value">{$testi\_eot['default\_value']}:</label> |
| [724](#L724) | {$override\_begin}<input type="{$override\_type}" name="form-field-{$istance\_data['istance\_id']}-override-default-value" value="1" {$override\_default\_value} />{$override\_end}<br> |
| [725](#L725) | <input type="date" value="{$istance\_data['default\_value']}" name="form-field-{$istance\_data['istance\_id']}-default-value" id="widget-{$istance\_data['istance\_id']}-default-value" class="widefat"></p> |
| [726](#L726) | EOT; |
| [727](#L727) | $min\_date = <<<EOT |
| [728](#L728) | <p><label for="widget-{$istance\_data['istance\_id']}-min-of-date">{$testi\_eot['min-of-date']}:</label> |
| [729](#L729) | {$override\_begin}<input type="{$override\_type}" name="form-field-{$istance\_data['istance\_id']}-override-datemin-values" value="1" {$override\_mindate\_values} />{$override\_end}<br> |
| [730](#L730) | <input type="date" value="{$istance\_data['min\_date']}" name="form-field-{$istance\_data['istance\_id']}-min-of-date" id="widget-{$istance\_data['istance\_id']}-min-of-date"></p> |
| [731](#L731) | EOT; |
| [732](#L732) | $max\_date = <<<EOT |
| [733](#L733) | <p><label for="widget-{$istance\_data['istance\_id']}-max-of-date">{$testi\_eot['max-of-date']}:</label> |
| [734](#L734) | {$override\_begin}<input type="{$override\_type}" name="form-field-{$istance\_data['istance\_id']}-override-datemax-values" value="1" {$override\_maxdate\_values} />{$override\_end}<br> |
| [735](#L735) | <input type="date" value="{$istance\_data['max\_date']}" name="form-field-{$istance\_data['istance\_id']}-max-of-date" id="widget-{$istance\_data['istance\_id']}-max-of-date"></p> |
| [736](#L736) | EOT; |
| [737](#L737) | } |
| [738](#L738) |  |
| [739](#L739) | switch ($field\_data['type']) { |
| [740](#L740) | case 'textarea': |
| [741](#L741) | $content .= <<<EOT |
| [742](#L742) | <p><label for="widget-{$istance\_data['istance\_id']}-default-value">{$testi\_eot['default\_value']}:</label> |
| [743](#L743) | {$override\_begin}<input type="{$override\_type}" name="form-field-{$istance\_data['istance\_id']}-override-default-value" value="1" {$override\_default\_value} />{$override\_end}<br> |
| [744](#L744) | <textarea rows="6" cols="50" name="form-field-{$istance\_data['istance\_id']}-default-value" id="widget-{$istance\_data['istance\_id']}-default-value" class="widefat">{$istance\_data['default\_value']}</textarea></p> |
| [745](#L745) | $required |
| [746](#L746) | EOT; |
| [747](#L747) | break; |
| [748](#L748) | case 'hidden': |
| [749](#L749) | $content = $default\_value; |
| [750](#L750) | break; |
| [751](#L751) | case 'checkbox': |
| [752](#L752) | $content .= $default\_value . $required; |
| [753](#L753) | break; |
| [754](#L754) | case 'select': |
| [755](#L755) | case 'radio': |
| [756](#L756) | case 'post-select': |
| [757](#L757) | $content .= $default\_value . $allowed\_values . $required; |
| [758](#L758) | break; |
| [759](#L759) | case 'multiselect': |
| [760](#L760) | case 'multicheckbox': |
| [761](#L761) | case 'post-multicheckbox': |
| [762](#L762) | $content .= $default\_values . $allowed\_values . $required; |
| [763](#L763) | break; |
| [764](#L764) | case 'file': |
| [765](#L765) | $content .= $allowed\_ext . $required; |
| [766](#L766) | case 'submit': |
| [767](#L767) | case 'fieldset-begin': |
| [768](#L768) | //just the label |
| [769](#L769) | break; |
| [770](#L770) | case 'fieldset-end': |
| [771](#L771) | //Nothing! |
| [772](#L772) | $content = ''; |
| [773](#L773) | break; |
| [774](#L774) | case 'html': |
| [775](#L775) | $content = <<<EOT |
| [776](#L776) | <p><label for="widget-{$istance\_data['istance\_id']}-default-value">{$testi\_eot['custom\_HTML\_content']}</label> |
| [777](#L777) | {$override\_begin}<input type="{$override\_type}" name="form-field-{$istance\_data['istance\_id']}-override-default-value" value="1" {$override\_default\_value} />{$override\_end}<br> |
| [778](#L778) | <textarea rows="6" cols="50" name="form-field-{$istance\_data['istance\_id']}-default-value" id="widget-{$istance\_data['istance\_id']}-default-value" class="widefat">{$istance\_data['default\_value']}</textarea></p> |
| [779](#L779) | EOT; |
| [780](#L780) | break; |
| [781](#L781) | case 'date': |
| [782](#L782) | $content .= $default\_date\_value . $min\_date . $max\_date . $required; |
| [783](#L783) | break; |
| [784](#L784) | case 'email': |
| [785](#L785) | case 'autoreply\_email': |
| [786](#L786) | case 'textfield': |
| [787](#L787) | case 'colorpicker': |
| [788](#L788) | case 'datepicker': |
| [789](#L789) | case 'dateselect': |
| [790](#L790) | default: |
| [791](#L791) | $content .= $default\_value . $required; |
| [792](#L792) | break; |
| [793](#L793) | } |
| [794](#L794) | $adminurl = admin\_url(); |
| [795](#L795) |  |
| [796](#L796) | return <<<EOT |
| [797](#L797) | <div class="widget ui-draggable" id="widget-{$i}\_{$istance\_data['istance\_id']}" $hidden>  <div class="widget-top"> |
| [798](#L798) | <div class="widget-title-action"> |
| [799](#L799) | <a href="#available-widgets" class="widget-action hide-if-no-js"></a> |
| [800](#L800) | </div> |
| [801](#L801) | <div class="widget-title"><h4>{$field\_data['name']}<span class="in-widget-title"></span></h4></div> |
| [802](#L802) | </div> |
| [803](#L803) |  |
| [804](#L804) | <div class="widget-inside"> |
| [805](#L805) | <form method="post" action=""> |
| [806](#L806) | <div class="widget-content"> |
| [807](#L807) | $content |
| [808](#L808) | </div> |
| [809](#L809) | <input type="hidden" value="{$fid}" name="form-id"> |
| [810](#L810) | <input type="hidden" value="{$istance\_data['istance\_id']}" class="widget-id" name="widget-id"> |
| [811](#L811) | <input type="hidden" value="{$field\_data['id']}" class="id\_base" name="id\_base"> |
| [812](#L812) | <input type="hidden" value="250" class="widget-width" name="widget-width"> |
| [813](#L813) | <input type="hidden" value="200" class="widget-height" name="widget-height"> |
| [814](#L814) | <input type="hidden" value="{$istance\_data['widget\_number']}" class="widget\_number" name="widget\_number"> |
| [815](#L815) | <input type="hidden" value="{$multi\_number}" class="multi\_number" name="multi\_number"> |
| [816](#L816) | <input type="hidden" value="{$add\_new}" class="add\_new" name="add\_new"> |
| [817](#L817) |  |
| [818](#L818) | <div class="widget-control-actions"> |
| [819](#L819) | <div class="alignleft"> |
| [820](#L820) | <a href="#remove" class="widget-control-remove delete">{$testi\_eot['remove']}</a> | |
| [821](#L821) | <a href="#close" class="widget-control-close">{$testi\_eot['close']}</a> |
| [822](#L822) | </div> |
| [823](#L823) | <div  class="alignright"> |
| [824](#L824) | <img alt="" title="" class="ajax-feedback" src="{$adminurl}images/wpspin\_light.gif"> |
| [825](#L825) | <input type="submit" value="{$testi\_eot['save']}" class="button-primary widget-control-save" id="widget-{$istance\_data['istance\_id']}-savewidget" name="savewidget"> |
| [826](#L826) | </div> |
| [827](#L827) | <br class="clear"> |
| [828](#L828) | </div> |
| [829](#L829) | </form> |
| [830](#L830) | </div> |
| [831](#L831) |  |
| [832](#L832) | <!--<div class="widget-description"> |
| [833](#L833) | {$field\_data['description']} |
| [834](#L834) | </div>--> |
| [835](#L835) | </div> |
| [836](#L836) |  |
| [837](#L837) | EOT; |
| [838](#L838) | } |
| [839](#L839) |  |
| [840](#L840) | function accua\_forms\_add\_page($message='') { |
| [841](#L841) | $forms\_data = get\_option('accua\_forms\_saved\_forms', array()); |
| [842](#L842) | $trash\_data = get\_option('accua\_forms\_trash\_forms', array()); |
| [843](#L843) | if (!empty($\_GET['fid'])) { |
| [844](#L844) | $fid = htmlspecialchars(stripslashes($\_GET['fid']), ENT\_QUOTES); |
| [845](#L845) | } else { |
| [846](#L846) | if ($message === '') { |
| [847](#L847) | $fid = 1 + ((int) get\_option('accua\_forms\_lastid', 0)); |
| [848](#L848) | while (isset($forms\_data[$fid]) || isset($trash\_data[$fid])) { |
| [849](#L849) | $fid++; |
| [850](#L850) | } |
| [851](#L851) | update\_option('accua\_forms\_lastid', $fid); |
| [852](#L852) | $message = \_accua\_forms\_test\_clonefrom($fid); |
| [853](#L853) | if ($message === '') { |
| [854](#L854) | return accua\_forms\_edit\_page($fid); |
| [855](#L855) | } |
| [856](#L856) | } else { |
| [857](#L857) | $fid = ''; |
| [858](#L858) | } |
| [859](#L859) | } |
| [860](#L860) | if (!empty($\_GET['clonefrom'])) { |
| [861](#L861) | check\_admin\_referer('clone\_posts'); |
| [862](#L862) | $clonefrom = stripslashes($\_GET['clonefrom']); |
| [863](#L863) | } else { |
| [864](#L864) | $clonefrom = ''; |
| [865](#L865) | } |
| [866](#L866) | ?> |
| [867](#L867) |  |
| [868](#L868) | <div id="accua\_forms\_add\_page" class="accua\_forms\_admin\_page wrap"> |
| [869](#L869) | <h2><?php \_e( 'Create a form', 'contact-forms'); ?> </h2> |
| [870](#L870) | <?php if ($message !== '') { |
| [871](#L871) | echo "<div style='border:1px solid; padding: 10px;'>$message</div>"; |
| [872](#L872) | } ?> |
| [873](#L873) | <form action="admin.php" method="GET"> |
| [874](#L874) | <?php wp\_nonce\_field('edit\_posts', '\_wpnonce', false, true) ?> |
| [875](#L875) | <input type="hidden" name="page" value="accua\_forms\_list" /> |
| [876](#L876) | <p>Form id: <input type="text" name="fid" value="<?php echo $fid; ?>" /></p> |
| [877](#L877) | <?php |
| [878](#L878) | if ($forms\_data) { |
| [879](#L879) | echo '<p><select name="clonefrom"> |
| [880](#L880) | <option value="">'.\_\_( 'Empty form', 'contact-forms').'</option> |
| [881](#L881) | <optgroup label="'.\_\_( 'Clone form:', 'contact-forms').'">'; |
| [882](#L882) | foreach ($forms\_data as $i => $formdata) { |
| [883](#L883) | $sel = ($i == $clonefrom) ? " selected='selected'" : ''; |
| [884](#L884) | $i = htmlspecialchars($i, ENT\_QUOTES); |
| [885](#L885) | if (isset($formdata['title']) && ('' !== trim($formdata['title']))) { |
| [886](#L886) | $formtitle = htmlspecialchars($formdata['title']); |
| [887](#L887) | } else { |
| [888](#L888) | $formtitle = $i; |
| [889](#L889) | } |
| [890](#L890) | echo "<option value='$i'$sel>$formtitle</option>\n"; |
| [891](#L891) | } |
| [892](#L892) | echo '</optgroup></select></p>'; |
| [893](#L893) | } |
| [894](#L894) | ?> |
| [895](#L895) | <p><input type="submit" value="<?php \_e( 'Create', 'contact-forms'); ?>" /></p> |
| [896](#L896) | </form> |
| [897](#L897) | </div> |
| [898](#L898) | <?php |
| [899](#L899) | } |
| [900](#L900) |  |
| [901](#L901) | function \_accua\_forms\_test\_clonefrom($fid){ |
| [902](#L902) | $error = ''; |
| [903](#L903) | if (isset($\_GET['clonefrom'])&&$\_GET['clonefrom']!=='') { |
| [904](#L904) | $clonefrom = stripslashes($\_GET['clonefrom']); |
| [905](#L905) | $forms\_data = get\_option('accua\_forms\_saved\_forms', array()); |
| [906](#L906) | if (isset($forms\_data[$fid])){ |
| [907](#L907) | $error .= "<p>".\_\_( 'Form already exists', 'contact-forms')."</p>"; |
| [908](#L908) | } else if (empty($forms\_data[$clonefrom])) { |
| [909](#L909) | $error .= "<p>".\_\_( 'Source form doesn\'t exists.', 'contact-forms')."</p>"; |
| [910](#L910) | } else { |
| [911](#L911) | $forms\_data[$fid] = $forms\_data[$clonefrom]; |
| [912](#L912) | if (!isset($forms\_data[$fid]['title'])) { |
| [913](#L913) | $forms\_data[$fid]['title'] = $clonefrom ." ".\_\_( 'clone', 'contact-forms'); |
| [914](#L914) | } else { |
| [915](#L915) | $forms\_data[$fid]['title'] .= " ". \_\_( 'clone', 'contact-forms'); |
| [916](#L916) | } |
| [917](#L917) | update\_option('accua\_forms\_saved\_forms', $forms\_data); |
| [918](#L918) | } |
| [919](#L919) | } |
| [920](#L920) | return $error; |
| [921](#L921) | } |
| [922](#L922) |  |
| [923](#L923) | function \_accua\_forms\_form\_edit\_action() { |
| [924](#L924) | static $message = null; |
| [925](#L925) | if ($message === null) { |
| [926](#L926) | $message = ''; |
| [927](#L927) | if (isset($\_POST['accua-form-edit-action'])){ |
| [928](#L928) | $post = stripslashes\_deep($\_POST); |
| [929](#L929) | switch ($post['accua-form-edit-action']) { |
| [930](#L930) | case 'delete': |
| [931](#L931) | $fid = $post['form-id']; |
| [932](#L932) | check\_admin\_referer('contact-forms-delete\_'.$fid); |
| [933](#L933) | $forms\_data = get\_option('accua\_forms\_saved\_forms', array()); |
| [934](#L934) | unset($forms\_data[$fid]); |
| [935](#L935) | update\_option('accua\_forms\_saved\_forms', $forms\_data); |
| [936](#L936) | $fid = htmlspecialchars($fid); |
| [937](#L937) | $message .= sprintf( \_\_( 'Form "%s" deleted','contact-forms' ), $fid ); |
| [938](#L938) | break; |
| [939](#L939) | } |
| [940](#L940) | } |
| [941](#L941) | } |
| [942](#L942) | return $message; |
| [943](#L943) | } |
| [944](#L944) |  |
| [945](#L945) | function accua\_forms\_validate\_form\_id($fid) { |
| [946](#L946) | $error = ''; |
| [947](#L947) | if (!preg\_match('/^[a-z0-9\_-]+$/i', $fid)) { |
| [948](#L948) | $error .= "<p>".\_\_( 'Only letters, numbers, hyphen and underscores allowed in form identificative name', 'contact-forms')."</p>"; |
| [949](#L949) | } |
| [950](#L950) | if (substr($fid,0,2) == '\_\_') { |
| [951](#L951) | $error .= "<p>".\_\_( 'The identificative name can\'t start with two underscores (\_\_)', 'contact-forms')."</p>"; |
| [952](#L952) | } |
| [953](#L953) | if (strlen($fid) > 70) { |
| [954](#L954) | $error .= "<p>".\_\_( 'You cannot use more than 70 characters for the identificative name', 'contact-forms')."</p>"; |
| [955](#L955) | } |
| [956](#L956) | return $error; |
| [957](#L957) | } |
| [958](#L958) |  |
| [959](#L959) | function accua\_forms\_list\_page() { |
| [960](#L960) | $message = ''; |
| [961](#L961) | if (isset($\_POST['accua-form-edit-action'])){ |
| [962](#L962) | $message = \_accua\_forms\_form\_edit\_action(); |
| [963](#L963) | } else if (isset($\_GET['fid'])) { |
| [964](#L964) | check\_admin\_referer('edit\_posts'); |
| [965](#L965) | $fid = stripslashes($\_GET['fid']); |
| [966](#L966) | $error = accua\_forms\_validate\_form\_id($fid); |
| [967](#L967) | if ($error === '' && (isset($\_GET['clonefrom'])&&$\_GET['clonefrom']!=='')) { |
| [968](#L968) | $error .= \_accua\_forms\_test\_clonefrom($fid); |
| [969](#L969) | } |
| [970](#L970) | if ($error === '') { |
| [971](#L971) | return accua\_forms\_edit\_page($fid); |
| [972](#L972) | } else { |
| [973](#L973) | return accua\_forms\_add\_page($error); |
| [974](#L974) | } |
| [975](#L975) | } |
| [976](#L976) | ?> |
| [977](#L977) | <div id="accua\_forms\_list\_page" class="accua\_forms\_admin\_page wrap"> |
| [978](#L978) | <?php if ($message !== '') { |
| [979](#L979) | echo "<div style='border:1px solid; padding: 10px;'>$message</div>"; |
| [980](#L980) | } ?> |
| [981](#L981) | <h2><img src="<?php echo ACCUA\_FORMS\_DIR\_URL.'img/cimatti-icon-20.png'; ?>"/> <?php \_e( 'Contact Forms', 'contact-forms'); ?> |
| [982](#L982) | <a class="add-new-h2" href="<?php echo get\_admin\_url(); ?>admin.php?page=accua\_forms\_add"><?php \_e('Add New','contact-forms'); ?></a> |
| [983](#L983) | </h2> |
| [984](#L984) | <div ><?php |
| [985](#L985) | echo strtr(\_\_( 'Use the turquoise blue %img\_c button in the TinyMCE editor to include the forms in posts, pages or other content types (shortcode and php functions also available)', 'contact-forms'), |
| [986](#L986) | array('%img\_c'=>'<img alt="C" src="' . plugins\_url('img/cimatti-icon-16.png', ACCUA\_FORMS\_FILE ) . '" />') |
| [987](#L987) | ); |
| [988](#L988) | ?></div> |
| [989](#L989) | <?php |
| [990](#L990) | accua\_forms\_list\_page\_table(); |
| [991](#L991) | ?> |
| [992](#L992) | </div> |
| [993](#L993) | <?php |
| [994](#L994) | } |
| [995](#L995) |  |
| [996](#L996) | function accua\_forms\_edit\_page($fid) { |
| [997](#L997) | wp\_enqueue\_script('jquery-ui-tabs','','','',true); |
| [998](#L998) | wp\_enqueue\_script('contact\_forms\_tabs', plugins\_url('accua\_tabs.js', ACCUA\_FORMS\_FILE ), array( 'jquery' ), ACCUA\_FORMS\_JS\_VERSION); |
| [999](#L999) |  |
| [1000](#L1000) | if (!class\_exists('AccuaFormsHelp')) { |
| [1001](#L1001) | require\_once('accua-forms-help.php'); |
| [1002](#L1002) | } |
| [1003](#L1003) | $accuaHelp = AccuaFormsHelp::getInstance(); |
| [1004](#L1004) | /\* |
| [1005](#L1005) | $avail\_fields = array( |
| [1006](#L1006) | 'first\_name' => array ( |
| [1007](#L1007) | 'id' => "first\_name", |
| [1008](#L1008) | 'name' => "First Name", |
| [1009](#L1009) | 'type' => "textfield", |
| [1010](#L1010) | 'description' => 'This is the first name', |
| [1011](#L1011) | ), |
| [1012](#L1012) | 'last\_name' => array ( |
| [1013](#L1013) | 'id' => "last\_name", |
| [1014](#L1014) | 'name' => "Last Name", |
| [1015](#L1015) | 'type' => "textfield", |
| [1016](#L1016) | 'description' => 'This is the last name', |
| [1017](#L1017) | ), |
| [1018](#L1018) | 'email' => array ( |
| [1019](#L1019) | 'id' => "email", |
| [1020](#L1020) | 'name' => "Email", |
| [1021](#L1021) | 'type' => "email", |
| [1022](#L1022) | 'description' => 'This is the email', |
| [1023](#L1023) | ), |
| [1024](#L1024) | ); |
| [1025](#L1025) | \*/ |
| [1026](#L1026) |  |
| [1027](#L1027) | $avail\_fields = get\_option('accua\_forms\_avail\_fields', array()); |
| [1028](#L1028) | $default\_form\_data = get\_option('accua\_forms\_default\_form\_data',array()); |
| [1029](#L1029) |  |
| [1030](#L1030) |  |
| [1031](#L1031) |  |
| [1032](#L1032) | $form\_data = \_accua\_forms\_get\_form\_data($fid, true, !empty($\_GET['restore'])); |
| [1033](#L1033) | $form\_overrided\_data = $form\_data['\_overrided']; |
| [1034](#L1034) |  |
| [1035](#L1035) | $fid\_esc = htmlspecialchars($fid, ENT\_QUOTES); |
| [1036](#L1036) |  |
| [1037](#L1037) | $adminurl = admin\_url(); |
| [1038](#L1038) |  |
| [1039](#L1039) | global $wp\_version; |
| [1040](#L1040) | if (version\_compare($wp\_version, '4') >= 0) { |
| [1041](#L1041) | ?> |
| [1042](#L1042) | <style> |
| [1043](#L1043) | #widgets-right .accua-form-widget-scroll-wrapper .widget.ui-draggable { |
| [1044](#L1044) | height: auto !important; |
| [1045](#L1045) | } |
| [1046](#L1046) | </style> |
| [1047](#L1047) | <?php |
| [1048](#L1048) | } |
| [1049](#L1049) |  |
| [1050](#L1050) | ?> |
| [1051](#L1051) | <div id="accua\_forms\_edit\_page" class="accua\_forms\_admin\_page wrap"> |
| [1052](#L1052) | <h2><img src="<?php echo ACCUA\_FORMS\_DIR\_URL.'img/cimatti-icon-20.png'; ?>"/> <?php  \_e('Contact Forms - Edit Form', 'contact-forms'); ?></h2> |
| [1053](#L1053) | <div class="accua\_form\_save\_settings\_status"></div> |
| [1054](#L1054) | <?php wp\_nonce\_field('edit\_form', '\_nonce\_edit\_form'); ?> |
| [1055](#L1055) | <div id="titlediv"><br /> |
| [1056](#L1056) | <label id="title-prompt-text" class="screen-reader-text" for="title"><?php  \_e( 'Enter title here', 'contact-forms'); ?></label> |
| [1057](#L1057) | <input id="title" type="text" autocomplete="off" value="<?php echo htmlspecialchars($form\_data['title'], ENT\_QUOTES) ?>" size="30" name="post\_title"> |
| [1058](#L1058) | <script type="text/javascript"> |
| [1059](#L1059) | jQuery(function($){ |
| [1060](#L1060) | if ( jQuery('#titlediv #title').val() == '' ) |
| [1061](#L1061) | jQuery('#title-prompt-text').removeClass('screen-reader-text'); |
| [1062](#L1062) |  |
| [1063](#L1063) | jQuery('#titlediv #title').focus(function() { |
| [1064](#L1064) | jQuery('#title-prompt-text').addClass('screen-reader-text'); |
| [1065](#L1065) | }); |
| [1066](#L1066) | jQuery('#titlediv #title').blur(function() { |
| [1067](#L1067) | if ( jQuery('#titlediv #title').val() == '' ) |
| [1068](#L1068) | jQuery('#title-prompt-text').removeClass('screen-reader-text'); |
| [1069](#L1069) | }); |
| [1070](#L1070) | }); |
| [1071](#L1071) | </script> |
| [1072](#L1072) | </div> |
| [1073](#L1073) | <div id="accua\_tabs"> |
| [1074](#L1074) | <div id="save\_settings\_top" class="accua\_forms\_save\_settings\_top"> |
| [1075](#L1075) | <form id="delete\_form" action="admin.php?page=accua\_forms\_list" method="POST" onsubmit="return confirm(<?php print htmlspecialchars(\_accua\_forms\_json\_encode(\_\_('Do you really want to delete this form?', 'contact-forms')), ENT\_QUOTES); ?>);"> |
| [1076](#L1076) | <input type="hidden" name="accua-form-edit-action" value="delete" /> |
| [1077](#L1077) | <input type="hidden" name="form-id" value="<?php echo $fid\_esc; ?>" /> |
| [1078](#L1078) | <input type="submit" value="<?php \_e( 'Delete this form', 'contact-forms'); ?>" /> |
| [1079](#L1079) | <?php wp\_nonce\_field( 'contact-forms-delete\_'.$fid ); ?> |
| [1080](#L1080) | </form> |
| [1081](#L1081) | <?php /\*<input class="button button-primary button-large accua\_form\_save\_settings\_button" id="accua\_form\_save\_settings" type="button" value="<?php echo htmlspecialchars(\_\_( 'Save settings', 'contact-forms'), ENT\_QUOTES); ?>" /> \*/ ?> |
| [1082](#L1082) | </div> |
| [1083](#L1083) | <ul id="ul\_accua\_tabs"> |
| [1084](#L1084) | <li class="tabs"><a href="#accua\_tab\_fields"><?php \_e( 'Fields', 'contact-forms'); ?></a></li> |
| [1085](#L1085) | <li class="tabs"><a href="#accua\_tab\_messages"><?php \_e( 'Messages', 'contact-forms'); ?></a></li> |
| [1086](#L1086) | <?php /\*<li class="tabs"><a href="#accua\_tab\_preview"><?php \_e( 'Preview/Test', 'contact-forms'); ?></a></li> \*/ ?> |
| [1087](#L1087) | </ul> |
| [1088](#L1088) | <div id="accua\_tab\_fields" class="content\_tab"> |
| [1089](#L1089) | <div style="width:50%; float:left;background: #f4f4f4;"> |
| [1090](#L1090) | <div style="padding: 20px;"> |
| [1091](#L1091) | <input class="button button-primary button-large accua\_form\_save\_settings\_button" id="accua\_form\_save\_settings\_inside" type="button" value="<?php echo htmlspecialchars(\_\_( 'Save', 'contact-forms'), ENT\_QUOTES); ?>" /> |
| [1092](#L1092) | <div id="accua\_tabs2"> |
| [1093](#L1093) | <ul> |
| [1094](#L1094) | <li class="tabs"><a href="#accua\_tab\_fields2"><?php \_e( 'Fields', 'contact-forms'); ?></a></li> |
| [1095](#L1095) | <li class="tabs"><a href="#accua\_tab\_customise"><?php \_e( 'Appearance', 'contact-forms'); ?></a></li> |
| [1096](#L1096) | </ul> |
| [1097](#L1097) | <div id="accua\_tab\_fields2"> |
| [1098](#L1098) | <h2><?php \_e( 'Drag & Drop Form Fields', 'contact-forms'); ?></h2> |
| [1099](#L1099) | <?php /\*<a href="admin.php?page=accua\_forms\_fields" target="\_blank"><strong><?php \_e( 'Create new fields here', 'contact-forms'); ?></strong></a></p> \*/ ?> |
| [1100](#L1100) | <div style="width:30%; float:left;"> |
| [1101](#L1101) | <!-- Begin available fields --> |
| [1102](#L1102) |  |
| [1103](#L1103) | <div class="widget-liquid-left" style="margin-right:0"> |
| [1104](#L1104) | <!-- <div id="widgets-left"> --> |
| [1105](#L1105) | <div id="widgets-left" style="margin-right:5px;"> |
| [1106](#L1106) | <div id="available-widgets" class="widgets-holder-wrap"> |
| [1107](#L1107) | <div class="widget-holder"> |
| [1108](#L1108) | <div id="widget-list"> |
| [1109](#L1109) | <!-- begin fields list --> |
| [1110](#L1110) |  |
| [1111](#L1111) | <?php |
| [1112](#L1112) |  |
| [1113](#L1113) | //This block must be executed before the output of available fields so accua\_forms\_field\_text\_settings\_form() can initialize $html\_multi\_number for further html and fieldset fields |
| [1114](#L1114) | $form\_fields\_html = ''; |
| [1115](#L1115) | foreach ($form\_data['fields'] as $field) { |
| [1116](#L1116) | if (empty($avail\_fields[$field['ref']])) { |
| [1117](#L1117) | $ref = array(); |
| [1118](#L1118) | if (!empty($field['ref'])) { |
| [1119](#L1119) | if ($field['ref'] == '\_\_fieldset-begin') { |
| [1120](#L1120) | $ref = array( |
| [1121](#L1121) | 'id' => '\_\_fieldset-begin', |
| [1122](#L1122) | 'name' => \_\_('Fieldset begin', 'contact-forms'), |
| [1123](#L1123) | 'type' => 'fieldset-begin', |
| [1124](#L1124) | 'description' => '', |
| [1125](#L1125) | ); |
| [1126](#L1126) | } else if ($field['ref'] == '\_\_fieldset-end') { |
| [1127](#L1127) | $ref = array( |
| [1128](#L1128) | 'id' => '\_\_fieldset-end', |
| [1129](#L1129) | 'name' => \_\_('Fieldset end', 'contact-forms'), |
| [1130](#L1130) | 'type' => 'fieldset-end', |
| [1131](#L1131) | 'description' => '', |
| [1132](#L1132) | ); |
| [1133](#L1133) | } |
| [1134](#L1134) | } |
| [1135](#L1135) | } else { |
| [1136](#L1136) | $ref = $avail\_fields[$field['ref']]; |
| [1137](#L1137) | } |
| [1138](#L1138) |  |
| [1139](#L1139) | //print\_r($ref); |
| [1140](#L1140) | $form\_fields\_html .= accua\_forms\_field\_text\_settings\_form($fid, $ref, $field); |
| [1141](#L1141) | } |
| [1142](#L1142) |  |
| [1143](#L1143) |  |
| [1144](#L1144) | foreach ($avail\_fields as $avail\_field) { |
| [1145](#L1145) | $hidden = (empty($form\_data['fields'][$avail\_field['id']])) ? false : 'hidden'; |
| [1146](#L1146) | echo accua\_forms\_field\_text\_settings\_form($fid, $avail\_field, $hidden); |
| [1147](#L1147) | } |
| [1148](#L1148) | //Custom HTML field |
| [1149](#L1149) | echo accua\_forms\_field\_text\_settings\_form($fid); |
| [1150](#L1150) | //Fieldset begin |
| [1151](#L1151) | echo accua\_forms\_field\_text\_settings\_form($fid, array( |
| [1152](#L1152) | 'id' => '\_\_fieldset-begin', |
| [1153](#L1153) | 'name' => \_\_( 'Fieldset begin', 'contact-forms'), |
| [1154](#L1154) | 'type' => 'fieldset-begin', |
| [1155](#L1155) | 'description' => \_\_('You can use this field multiple times.', 'contact-forms'), |
| [1156](#L1156) | 'default\_value' => '', |
| [1157](#L1157) | 'allowed\_values' => '', |
| [1158](#L1158) | )); |
| [1159](#L1159) | //Fieldset end |
| [1160](#L1160) | echo accua\_forms\_field\_text\_settings\_form($fid, array( |
| [1161](#L1161) | 'id' => '\_\_fieldset-end', |
| [1162](#L1162) | 'name' => \_\_( 'Fieldset end', 'contact-forms'), |
| [1163](#L1163) | 'type' => 'fieldset-end', |
| [1164](#L1164) | 'description' => \_\_('You can use this field multiple times.', 'contact-forms'), |
| [1165](#L1165) | 'default\_value' => '', |
| [1166](#L1166) | 'allowed\_values' => '', |
| [1167](#L1167) | )); |
| [1168](#L1168) | ?> |
| [1169](#L1169) |  |
| [1170](#L1170) | <!-- end fields list --> |
| [1171](#L1171) | </div> |
| [1172](#L1172) |  |
| [1173](#L1173) | <br class='clear' /> |
| [1174](#L1174) | </div> |
| [1175](#L1175) | <br class="clear" /> |
| [1176](#L1176) | </div> |
| [1177](#L1177) |  |
| [1178](#L1178) | </div> |
| [1179](#L1179) | </div> |
| [1180](#L1180) | <!-- End available fields --> |
| [1181](#L1181) | </div> |
| [1182](#L1182) |  |
| [1183](#L1183) | <div style="width:70%; float:left;" class="container"> |
| [1184](#L1184) | <!-- |
| [1185](#L1185) | <h3>Form Fields</h3> |
| [1186](#L1186) | <div id="form\_fields\_container"> |
| [1187](#L1187) | </div> |
| [1188](#L1188) | --> |
| [1189](#L1189) |  |
| [1190](#L1190) | <div class="widget-liquid-right" style="width:100%"> |
| [1191](#L1191) | <div id="widgets-right" style="width:100%"> |
| [1192](#L1192) | <div class="widgets-holder-wrap dashed"> |
| [1193](#L1193) | <div class="sidebar-name"> |
| [1194](#L1194) | <div class="sidebar-name-arrow"><br></div> |
| [1195](#L1195) | <h3><?php \_e( 'Drop fields here', 'contact-forms'); ?> <span><img alt="" title="" class="ajax-feedback" src="<?php echo $adminurl;?>images/wpspin\_light.gif"></span></h3> |
| [1196](#L1196) | </div> |
| [1197](#L1197) | <div class="widgets-sortables ui-sortable" id="cimatti-accua-fields-form-area-<?php echo $fid\_esc ?>"> |
| [1198](#L1198) | <?php echo $form\_fields\_html; ?> |
| [1199](#L1199) | </div> |
| [1200](#L1200) | </div> |
| [1201](#L1201) | </div> |
| [1202](#L1202) | </div> |
| [1203](#L1203) |  |
| [1204](#L1204) | </div> |
| [1205](#L1205) | </div> |
| [1206](#L1206) | <div id="accua\_tab\_customise"> |
| [1207](#L1207) | <div style="width: 48%; float:left;"> |
| [1208](#L1208) | <h3><?php \_e( 'General', 'contact-forms'); ?></h3> |
| [1209](#L1209) | <p id="accua\_form\_use\_ajax"><input class="accua\_form\_value" type="checkbox" value="1" <?php if (!empty($form\_data['use\_ajax'])) {echo 'checked="checked" ';} ?>/><?php \_e('Do not reload the page on form submission', 'contact-forms'); ?></p> |
| [1210](#L1210) |  |
| [1211](#L1211) | <p id="accua\_form\_layout"><?php \_e( 'Labels', 'contact-forms'); ?> <select name="layout" class="accua\_form\_value"> |
| [1212](#L1212) | <option value="" <?php if (isset($form\_overrided\_data['layout'])) { echo 'selected="selected"'; } ?>>default (<?php if($default\_form\_data['layout']=='sidebyside') \_e( 'Labels on the left of the fields', 'contact-forms'); else \_e( 'Labels on top of the fields', 'contact-forms'); ?>)</option><option value="sidebyside" <?php if ((isset($form\_overrided\_data['layout'])) && ($form\_data['layout'] == 'sidebyside')) { echo 'selected="selected"'; } ?>><?php \_e( 'Labels on the left of the fields', 'contact-forms'); ?></option><option value="toplabel" <?php if ((isset($form\_overrided\_data['layout'])) && ($form\_data['layout'] == 'toplabel')) { echo 'selected="selected"'; } ?>><?php \_e( 'Labels on top of the fields', 'contact-forms'); ?></option></select> |
| [1213](#L1213) | </p> |
| [1214](#L1214) |  |
| [1215](#L1215) | <div id="accua\_form\_style\_margin" class="label\_input" class="label\_container"> |
| [1216](#L1216) | <input name="accua\_form\_style\_margin" class="accua\_form\_check\_override" type="checkbox" value="1" <?php if (isset($form\_overrided\_data['style\_margin'])) {echo 'checked="checked" ';} ?>/><strong><?php \_e( 'Margin', 'contact-forms'); ?></strong> |
| [1217](#L1217) | <div class="default\_value"><?php echo htmlspecialchars($default\_form\_data['style\_margin']); ?></div> |
| [1218](#L1218) | <input class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_margin'], ENT\_QUOTES) ?>" /> |
| [1219](#L1219) |  |
| [1220](#L1220) | </div> |
| [1221](#L1221) |  |
| [1222](#L1222) | <div class="label\_input"> |
| [1223](#L1223) | <div id="accua\_form\_style\_border\_color" class="label\_container"> |
| [1224](#L1224) | <input name="accua\_form\_style\_border\_color" class="accua\_form\_check\_override" type="checkbox" value="1" <?php if (isset($form\_overrided\_data['style\_border\_color'])) {echo 'checked="checked" ';} ?>/><strong><?php \_e( 'Border color', 'contact-forms'); ?></strong> |
| [1225](#L1225) | <div class="default\_value"><?php echo htmlspecialchars($default\_form\_data['style\_border\_color']); ?></div> |
| [1226](#L1226) | <input class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_border\_color'], ENT\_QUOTES) ?>" /> |
| [1227](#L1227) | </div> |
| [1228](#L1228) | <div id="accua\_form\_style\_border\_width" class="label\_container"> |
| [1229](#L1229) | <input name="accua\_form\_style\_border\_width" class="accua\_form\_check\_override" type="checkbox" value="1" <?php if (isset($form\_overrided\_data['style\_border\_width'])) {echo 'checked="checked" ';} ?>/><?php \_e( 'Width', 'contact-forms'); ?> |
| [1230](#L1230) | <div class="default\_value"><?php echo htmlspecialchars($default\_form\_data['style\_border\_width']); ?></div> |
| [1231](#L1231) | <input class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_border\_width'], ENT\_QUOTES) ?>" /> |
| [1232](#L1232) | </div> |
| [1233](#L1233) | <div id="accua\_form\_style\_border\_radius" class="label\_container"> |
| [1234](#L1234) | <input name="accua\_form\_style\_border\_radius" class="accua\_form\_check\_override" type="checkbox" value="1" <?php if (isset($form\_overrided\_data['style\_border\_radius'])) {echo 'checked="checked" ';} ?>/><?php \_e( 'Radius', 'contact-forms'); ?> |
| [1235](#L1235) | <div class="default\_value"><?php echo htmlspecialchars($default\_form\_data['style\_border\_radius']); ?></div> |
| [1236](#L1236) | <input class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_border\_radius'], ENT\_QUOTES) ?>" /> |
| [1237](#L1237) | </div> |
| [1238](#L1238) | </div> |
| [1239](#L1239) |  |
| [1240](#L1240) | <div class="label\_input"> |
| [1241](#L1241) | <div id="accua\_form\_style\_background\_color" class="label\_container"> |
| [1242](#L1242) | <input name="accua\_form\_style\_background\_color" class="accua\_form\_check\_override" type="checkbox" value="1" <?php if (isset($form\_overrided\_data['style\_background\_color'])) {echo 'checked="checked" ';} ?>/><strong><?php \_e( 'Background', 'contact-forms'); ?></strong> |
| [1243](#L1243) | <div class="default\_value"><?php echo htmlspecialchars($default\_form\_data['style\_background\_color']); ?></div> |
| [1244](#L1244) | <input class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_background\_color'], ENT\_QUOTES) ?>" /> |
| [1245](#L1245) | </div> |
| [1246](#L1246) |  |
| [1247](#L1247) | <div id="accua\_form\_style\_padding" class="label\_container"> |
| [1248](#L1248) | <input name="accua\_form\_style\_padding" class="accua\_form\_check\_override" type="checkbox" value="1" <?php if (isset($form\_overrided\_data['style\_padding'])) {echo 'checked="checked" ';} ?>/><strong><?php \_e( 'Padding', 'contact-forms'); ?></strong> |
| [1249](#L1249) | <div class="default\_value"><?php echo htmlspecialchars($default\_form\_data['style\_padding']); ?></div> |
| [1250](#L1250) | <input class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_padding'], ENT\_QUOTES) ?>" /> |
| [1251](#L1251) | </div> |
| [1252](#L1252) | </div> |
| [1253](#L1253) | <div class="label\_input"> |
| [1254](#L1254) | <div id="accua\_form\_style\_color" class="label\_container"> |
| [1255](#L1255) | <input name="accua\_form\_style\_color" class="accua\_form\_check\_override" type="checkbox" value="1" <?php if (isset($form\_overrided\_data['style\_color'])) {echo 'checked="checked" ';} ?>/><strong><?php \_e( 'Font', 'contact-forms'); ?></strong> |
| [1256](#L1256) | <div class="default\_value"><?php echo htmlspecialchars($default\_form\_data['style\_color']); ?></div> |
| [1257](#L1257) | <input class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_color'], ENT\_QUOTES) ?>" /> |
| [1258](#L1258) | </div> |
| [1259](#L1259) |  |
| [1260](#L1260) | <div id="accua\_form\_style\_font\_size" class="label\_container"> |
| [1261](#L1261) | <input name="accua\_form\_style\_font\_size" class="accua\_form\_check\_override" type="checkbox" value="1" <?php if (isset($form\_overrided\_data['style\_font\_size'])) {echo 'checked="checked" ';} ?>/><?php \_e( 'Size', 'contact-forms'); ?> |
| [1262](#L1262) | <div class="default\_value"><?php echo htmlspecialchars($default\_form\_data['style\_font\_size']); ?></div> |
| [1263](#L1263) | <input class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_font\_size'], ENT\_QUOTES) ?>" /> |
| [1264](#L1264) | </div> |
| [1265](#L1265) | </div> |
| [1266](#L1266) | </div> |
| [1267](#L1267) | <div style="width: 48%; float:left;"> |
| [1268](#L1268) |  |
| [1269](#L1269) | <h3><?php \_e( 'Fields', 'contact-forms'); ?></h3> |
| [1270](#L1270) |  |
| [1271](#L1271) | <div id="accua\_form\_style\_field\_spacing" class="label\_input"> |
| [1272](#L1272) | <input name="accua\_form\_style\_field\_spacing" class="accua\_form\_check\_override" type="checkbox" value="1" <?php if (isset($form\_overrided\_data['style\_field\_spacing'])) {echo 'checked="checked" ';} ?>/><?php \_e( 'Spacing', 'contact-forms'); ?> |
| [1273](#L1273) | <div class="default\_value"><?php echo htmlspecialchars($default\_form\_data['style\_field\_spacing']); ?></div> |
| [1274](#L1274) | <input class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_field\_spacing'], ENT\_QUOTES) ?>" /> |
| [1275](#L1275) | </div> |
| [1276](#L1276) |  |
| [1277](#L1277) | <div id="accua\_form\_style\_field\_border\_color" class="label\_input"> |
| [1278](#L1278) | <input name="accua\_form\_style\_field\_border\_color" class="accua\_form\_check\_override" type="checkbox" value="1" <?php if (isset($form\_overrided\_data['style\_field\_border\_color'])) {echo 'checked="checked" ';} ?>/><?php \_e( 'Border color', 'contact-forms'); ?> |
| [1279](#L1279) | <div class="default\_value"><?php echo htmlspecialchars($default\_form\_data['style\_field\_border\_color']); ?></div> |
| [1280](#L1280) | <input class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_field\_border\_color'], ENT\_QUOTES) ?>" /> |
| [1281](#L1281) | </div> |
| [1282](#L1282) |  |
| [1283](#L1283) | <div id="accua\_form\_style\_field\_border\_width" class="label\_input"> |
| [1284](#L1284) | <input name="accua\_form\_style\_field\_border\_width" class="accua\_form\_check\_override" type="checkbox" value="1" <?php if (isset($form\_overrided\_data['style\_field\_border\_width'])) {echo 'checked="checked" ';} ?>/><?php \_e( 'Border width', 'contact-forms'); ?> |
| [1285](#L1285) | <div class="default\_value"><?php echo htmlspecialchars($default\_form\_data['style\_field\_border\_width']); ?></div> |
| [1286](#L1286) | <input class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_field\_border\_width'], ENT\_QUOTES) ?>" /> |
| [1287](#L1287) | </div> |
| [1288](#L1288) |  |
| [1289](#L1289) | <div id="accua\_form\_style\_field\_border\_radius" class="label\_input"> |
| [1290](#L1290) | <input name="accua\_form\_style\_field\_border\_radius" class="accua\_form\_check\_override" type="checkbox" value="1" <?php if (isset($form\_overrided\_data['style\_field\_border\_radius'])) {echo 'checked="checked" ';} ?>/><?php \_e( 'Rounded corner radius', 'contact-forms'); ?> |
| [1291](#L1291) | <div class="default\_value"><?php echo htmlspecialchars($default\_form\_data['style\_field\_border\_radius']); ?></div> |
| [1292](#L1292) | <input class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_field\_border\_radius'], ENT\_QUOTES) ?>" /> |
| [1293](#L1293) | </div> |
| [1294](#L1294) |  |
| [1295](#L1295) | <div id="accua\_form\_style\_field\_background\_color" class="label\_input"> |
| [1296](#L1296) | <input name="accua\_form\_style\_field\_background\_color" class="accua\_form\_check\_override" type="checkbox" value="1" <?php if (isset($form\_overrided\_data['style\_field\_background\_color'])) {echo 'checked="checked" ';} ?>/><?php \_e( 'Background color', 'contact-forms'); ?> |
| [1297](#L1297) | <div class="default\_value"><?php echo htmlspecialchars($default\_form\_data['style\_field\_background\_color']); ?></div> |
| [1298](#L1298) | <input class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_field\_background\_color'], ENT\_QUOTES) ?>" /> |
| [1299](#L1299) | </div> |
| [1300](#L1300) |  |
| [1301](#L1301) | <div id="accua\_form\_style\_field\_padding" class="label\_input"> |
| [1302](#L1302) | <input name="accua\_form\_style\_field\_padding" class="accua\_form\_check\_override" type="checkbox" value="1" <?php if (isset($form\_overrided\_data['style\_field\_padding'])) {echo 'checked="checked" ';} ?>/><?php \_e( 'Padding', 'contact-forms'); ?> |
| [1303](#L1303) | <div class="default\_value"><?php echo htmlspecialchars($default\_form\_data['style\_field\_padding']); ?></div> |
| [1304](#L1304) | <input class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_field\_padding'], ENT\_QUOTES) ?>" /> |
| [1305](#L1305) | </div> |
| [1306](#L1306) |  |
| [1307](#L1307) | <div id="accua\_form\_style\_field\_color" class="label\_input"> |
| [1308](#L1308) | <input name="accua\_form\_style\_field\_color" class="accua\_form\_check\_override" type="checkbox" value="1" <?php if (isset($form\_overrided\_data['style\_field\_color'])) {echo 'checked="checked" ';} ?>/><?php \_e( 'Text color', 'contact-forms'); ?> |
| [1309](#L1309) | <div class="default\_value"><?php echo htmlspecialchars($default\_form\_data['style\_field\_color']); ?></div> |
| [1310](#L1310) | <input class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_field\_color'], ENT\_QUOTES) ?>" /> |
| [1311](#L1311) | </div> |
| [1312](#L1312) |  |
| [1313](#L1313) |  |
| [1314](#L1314) | <h3><?php \_e( 'Submit button', 'contact-forms'); ?></h3> |
| [1315](#L1315) |  |
| [1316](#L1316) | <div id="accua\_form\_style\_submit\_border\_color" class="label\_input"> |
| [1317](#L1317) | <input name="accua\_form\_style\_submit\_border\_color" class="accua\_form\_check\_override" type="checkbox" value="1" <?php if (isset($form\_overrided\_data['style\_submit\_border\_color'])) {echo 'checked="checked" ';} ?>/><?php \_e( 'Border color', 'contact-forms'); ?> |
| [1318](#L1318) | <div class="default\_value"><?php echo htmlspecialchars($default\_form\_data['style\_submit\_border\_color']); ?></div> |
| [1319](#L1319) | <input class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_submit\_border\_color'], ENT\_QUOTES) ?>" /> |
| [1320](#L1320) | <?php \_e( 'Customize', 'contact-forms'); ?> |
| [1321](#L1321) | </div> |
| [1322](#L1322) |  |
| [1323](#L1323) | <div id="accua\_form\_style\_submit\_border\_width" class="label\_input"> |
| [1324](#L1324) | <input name="accua\_form\_style\_submit\_border\_width" class="accua\_form\_check\_override" type="checkbox" value="1" <?php if (isset($form\_overrided\_data['style\_submit\_border\_width'])) {echo 'checked="checked" ';} ?>/><?php \_e( 'Border width', 'contact-forms'); ?> |
| [1325](#L1325) | <div class="default\_value"><?php echo htmlspecialchars($default\_form\_data['style\_submit\_border\_width']); ?></div> |
| [1326](#L1326) | <input class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_submit\_border\_width'], ENT\_QUOTES) ?>" /> |
| [1327](#L1327) | </div> |
| [1328](#L1328) |  |
| [1329](#L1329) | <div id="accua\_form\_style\_submit\_border\_radius" class="label\_input"> |
| [1330](#L1330) | <input name="accua\_form\_style\_submit\_border\_radius" class="accua\_form\_check\_override" type="checkbox" value="1" <?php if (isset($form\_overrided\_data['style\_submit\_border\_radius'])) {echo 'checked="checked" ';} ?>/><?php \_e( 'Rounded corner radius', 'contact-forms'); ?> |
| [1331](#L1331) | <div class="default\_value"><?php echo htmlspecialchars($default\_form\_data['style\_submit\_border\_radius']); ?></div> |
| [1332](#L1332) | <input class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_submit\_border\_radius'], ENT\_QUOTES) ?>" /> |
| [1333](#L1333) | </div> |
| [1334](#L1334) |  |
| [1335](#L1335) | <div id="accua\_form\_style\_submit\_background\_color" class="label\_input"> |
| [1336](#L1336) | <input name="accua\_form\_style\_submit\_background\_color" class="accua\_form\_check\_override" type="checkbox" value="1" <?php if (isset($form\_overrided\_data['style\_submit\_background\_color'])) {echo 'checked="checked" ';} ?>/><?php \_e( 'Background color', 'contact-forms'); ?> |
| [1337](#L1337) | <div class="default\_value"><?php echo htmlspecialchars($default\_form\_data['style\_submit\_background\_color']); ?></div> |
| [1338](#L1338) | <input class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_submit\_background\_color'], ENT\_QUOTES) ?>" /> |
| [1339](#L1339) | </div> |
| [1340](#L1340) |  |
| [1341](#L1341) | <div id="accua\_form\_style\_submit\_padding" class="label\_input"> |
| [1342](#L1342) | <input name="accua\_form\_style\_submit\_padding" class="accua\_form\_check\_override" type="checkbox" value="1" <?php if (isset($form\_overrided\_data['style\_submit\_padding'])) {echo 'checked="checked" ';} ?>/><?php \_e( 'Padding', 'contact-forms'); ?> |
| [1343](#L1343) | <div class="default\_value"><?php echo htmlspecialchars($default\_form\_data['style\_submit\_padding']); ?></div> |
| [1344](#L1344) | <input class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_submit\_padding'], ENT\_QUOTES) ?>" /> |
| [1345](#L1345) | </div> |
| [1346](#L1346) |  |
| [1347](#L1347) | <div id="accua\_form\_style\_submit\_color" class="label\_input"> |
| [1348](#L1348) | <input name="accua\_form\_style\_submit\_color" class="accua\_form\_check\_override" type="checkbox" value="1" <?php if (isset($form\_overrided\_data['style\_submit\_color'])) {echo 'checked="checked" ';} ?>/><?php \_e( 'Text color', 'contact-forms'); ?> |
| [1349](#L1349) | <div class="default\_value"><?php echo htmlspecialchars($default\_form\_data['style\_submit\_color']); ?></div> |
| [1350](#L1350) | <input class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_submit\_color'], ENT\_QUOTES) ?>" /> |
| [1351](#L1351) | </div> |
| [1352](#L1352) |  |
| [1353](#L1353) | <div id="accua\_form\_style\_submit\_font\_size" class="label\_input"> |
| [1354](#L1354) | <input name="accua\_form\_style\_submit\_font\_size" class="accua\_form\_check\_override" type="checkbox" value="1" <?php if (isset($form\_overrided\_data['style\_submit\_font\_size'])) {echo 'checked="checked" ';} ?>/><?php \_e( 'Font size', 'contact-forms'); ?> |
| [1355](#L1355) | <div class="default\_value"><?php echo htmlspecialchars($default\_form\_data['style\_submit\_font\_size']); ?></div> |
| [1356](#L1356) | <input class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_submit\_font\_size'], ENT\_QUOTES) ?>" /> |
| [1357](#L1357) | </div> |
| [1358](#L1358) |  |
| [1359](#L1359) | <br clear="all"/> |
| [1360](#L1360) | </div> |
| [1361](#L1361) | </div> |
| [1362](#L1362) | </div> |
| [1363](#L1363) |  |
| [1364](#L1364) |  |
| [1365](#L1365) |  |
| [1366](#L1366) | </div> |
| [1367](#L1367) | </div> |
| [1368](#L1368) | <div style="width:50%; float:right;"> |
| [1369](#L1369) | <div style="padding: 15px;"> |
| [1370](#L1370) | <h2><?php \_e('Preview', 'contact-forms'); ?> |
| [1371](#L1371) | <?php echo $accuaHelp->add\_pointer('form\_edit\_preview'); ?> |
| [1372](#L1372) | </h2> |
| [1373](#L1373) | <div id="accua\_form\_preview\_area\_wrapper"> |
| [1374](#L1374) | <?php |
| [1375](#L1375) | echo "<script> |
| [1376](#L1376) | function resizeIframe(obj) { |
| [1377](#L1377) | altezza = obj.contentWindow.document.documentElement.scrollHeight + 200; |
| [1378](#L1378) | obj.style.height = altezza + 'px'; |
| [1379](#L1379) | } |
| [1380](#L1380) | </script>"; |
| [1381](#L1381) |  |
| [1382](#L1382) | ?> |
| [1383](#L1383) | <iframe id="accua\_form\_preview\_area" src="admin-ajax.php?action=accua\_forms\_preview&fid=<?php echo htmlspecialchars($fid,ENT\_QUOTES);?>"  frameborder="0" scrolling="no" onload="resizeIframe(this)" ></iframe> |
| [1384](#L1384) | <?php //todo: posso usare lo stile del sito? font ecc ?> |
| [1385](#L1385) | </div> |
| [1386](#L1386) |  |
| [1387](#L1387) | </div> |
| [1388](#L1388) | </div> |
| [1389](#L1389) |  |
| [1390](#L1390) | <div style="clear:both;">&nbsp;</div> |
| [1391](#L1391) |  |
| [1392](#L1392) | <?php /\* \* / ?> |
| [1393](#L1393) | <pre> |
| [1394](#L1394) | accua\_forms\_form\_fields\_order\_post: <?php echo htmlspecialchars(print\_r(get\_option('accua\_forms\_form\_fields\_order\_post'), true)); ?> |
| [1395](#L1395) |  |
| [1396](#L1396) | accua\_forms\_save\_form\_field\_post: <?php echo htmlspecialchars(print\_r(get\_option('accua\_forms\_save\_form\_field\_post'), true)); ?> |
| [1397](#L1397) |  |
| [1398](#L1398) | accua\_forms\_saved\_form\_data: <?php echo htmlspecialchars(print\_r($form\_data, true)); ?> |
| [1399](#L1399) |  |
| [1400](#L1400) | </pre> |
| [1401](#L1401) | <?php /\* \*/ ?> |
| [1402](#L1402) | </div> |
| [1403](#L1403) | <div id="accua\_tab\_messages" class="content\_tab"> |
| [1404](#L1404) | <?php |
| [1405](#L1405) | $settings\_editor = array( |
| [1406](#L1406) | 'teeny' => true, |
| [1407](#L1407) | 'editor\_class' => 'accua\_form\_value', |
| [1408](#L1408) | 'tinymce' => array( |
| [1409](#L1409) | 'theme\_advanced\_buttons1' => 'bold,italic,underline,|,bullist,numlist,')); |
| [1410](#L1410) | ?> |
| [1411](#L1411) |  |
| [1412](#L1412) | <div class="metabox-holder accua-forms-metabox-holder"> |
| [1413](#L1413) | <div class="postbox "> |
| [1414](#L1414) | <h3 class="hndle"><span><?php \_e('1. On-screen success message', 'contact-forms'); ?></span></h3> |
| [1415](#L1415) | <div class="inside" id="dashboard\_right\_now"> |
| [1416](#L1416) | <div id="accua\_form\_success\_message"> |
| [1417](#L1417) | <input class="accua\_form\_check\_override"  name="accua\_form\_success\_message" type="radio" value="0" <?php if (!isset($form\_overrided\_data['success\_message'])) {echo ' checked ';} ?>> <?php \_e( 'Use the default message', 'contact-forms'); ?> |
| [1418](#L1418) | <input class="accua\_form\_check\_override"  name="accua\_form\_success\_message" type="radio" value="1" <?php if (isset($form\_overrided\_data['success\_message']) && !isset($form\_overrided\_data['success\_message\_no\_message'])) {echo ' checked ';} ?>/> <?php \_e( 'Customize', 'contact-forms'); ?> |
| [1419](#L1419) | <input class="accua\_form\_check\_override"  name="accua\_form\_success\_message" type="radio" value="-1" <?php if (isset($form\_overrided\_data['success\_message\_no\_message'])) {echo ' checked ';} ?>/> <?php \_e( 'Don\'t show any messages', 'contact-forms'); ?><br /> |
| [1420](#L1420) | <div class="defalut\_message"> |
| [1421](#L1421) | <?php \_e( 'Default Success message', 'contact-forms'); ?> |
| [1422](#L1422) | <div class="defalut\_content\_message"><?php echo wpautop($default\_form\_data['success\_message']); ?></div> |
| [1423](#L1423) | </div> |
| [1424](#L1424) | <?php  wp\_editor( $form\_data['success\_message'] , 'accua\_form\_success\_message\_textarea' , $settings\_editor);   ?> |
| [1425](#L1425) | <!--  <textarea class="accua\_form\_value" style="width:95%"; cols="80" rows="8"><?php echo htmlspecialchars($form\_data['success\_message'], ENT\_QUOTES) ?></textarea> --> |
| [1426](#L1426) | </div> |
| [1427](#L1427) | </div> |
| [1428](#L1428) | </div> |
| [1429](#L1429) | </div> |
| [1430](#L1430) |  |
| [1431](#L1431) | <div class="metabox-holder accua-forms-metabox-holder"> |
| [1432](#L1432) | <div class="postbox "> |
| [1433](#L1433) | <h3 class="hndle"><span><?php \_e('2. On-screen error message', 'contact-forms'); ?></span></h3> |
| [1434](#L1434) | <div class="inside" id="dashboard\_right\_now"> |
| [1435](#L1435) | <div id="accua\_form\_error\_message"> |
| [1436](#L1436) | <input class="accua\_form\_check\_override"  name="accua\_form\_error\_message" type="radio" value="0" <?php if (!isset($form\_overrided\_data['error\_message'])) {echo ' checked ';} ?>> <?php \_e( 'Use the default message', 'contact-forms'); ?> |
| [1437](#L1437) | <input class="accua\_form\_check\_override"  name="accua\_form\_error\_message" type="radio" value="1" <?php if (isset($form\_overrided\_data['error\_message']) && !isset($form\_overrided\_data['error\_message\_no\_message'])) {echo ' checked ';} ?>/> <?php \_e( 'Customize', 'contact-forms'); ?> |
| [1438](#L1438) | <input class="accua\_form\_check\_override"  name="accua\_form\_error\_message" type="radio" value="-1" <?php if (isset($form\_overrided\_data['error\_message\_no\_message'])) {echo ' checked ';} ?>/> <?php \_e( 'Don\'t show any messages', 'contact-forms'); ?><br /> |
| [1439](#L1439) | <div class="defalut\_message"> |
| [1440](#L1440) | <?php \_e( 'Default error message', 'contact-forms'); ?> <br /> |
| [1441](#L1441) | <div  class="defalut\_content\_message" ><?php echo wpautop($default\_form\_data['error\_message']); ?></div> |
| [1442](#L1442) | </div> |
| [1443](#L1443) | <?php  wp\_editor( $form\_data['error\_message'] , 'accua\_form\_error\_message\_textarea' , $settings\_editor); ?> |
| [1444](#L1444) | </div> |
| [1445](#L1445) | </div> |
| [1446](#L1446) | </div> |
| [1447](#L1447) | </div> |
| [1448](#L1448) | <br clear="all"/> |
| [1449](#L1449) | <div class="metabox-holder accua-forms-metabox-holder"> |
| [1450](#L1450) | <div class="postbox "> |
| [1451](#L1451) | <h3 class="hndle"><span><?php \_e('3. Email  to notify administrator', 'contact-forms'); ?></span></h3> |
| [1452](#L1452) | <div class="inside" id="dashboard\_right\_now"> |
| [1453](#L1453) | <div id="accua\_form\_admin\_emails\_to" class="label\_input"> |
| [1454](#L1454) | <label><?php \_e('To', 'contact-forms'); ?></label> |
| [1455](#L1455) | <div class="default\_value"><?php echo htmlspecialchars($default\_form\_data['admin\_emails\_to']); ?></div> |
| [1456](#L1456) | <input class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['admin\_emails\_to'], ENT\_QUOTES) ?>" /> |
| [1457](#L1457) | <input name="accua\_form\_admin\_emails\_to" class="accua\_form\_check\_override" type="checkbox" value="1" <?php if (isset($form\_overrided\_data['admin\_emails\_to'])) {echo 'checked="checked" ';} ?>/><?php \_e( 'Customize', 'contact-forms'); ?> |
| [1458](#L1458) | </div> |
| [1459](#L1459) | <div id="accua\_form\_emails\_bcc" class="label\_input"> |
| [1460](#L1460) | <label><?php \_e('Bcc', 'contact-forms'); ?></label> |
| [1461](#L1461) | <div class="default\_value"><?php echo htmlspecialchars($default\_form\_data['emails\_bcc']); ?></div> |
| [1462](#L1462) | <input class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['emails\_bcc'], ENT\_QUOTES) ?>" /> |
| [1463](#L1463) | <input name ="accua\_form\_emails\_bcc" class="accua\_form\_check\_override" type="checkbox" value="1" <?php if (isset($form\_overrided\_data['emails\_bcc'])) {echo 'checked="checked" ';} ?>/><?php \_e( 'Customize', 'contact-forms'); ?> |
| [1464](#L1464) | </div> |
| [1465](#L1465) |  |
| [1466](#L1466) | <div id="accua\_form\_admin\_emails\_subject" class="label\_input"> |
| [1467](#L1467) | <label><?php \_e( 'Subject', 'contact-forms'); ?></label> |
| [1468](#L1468) | <div class="default\_value"><?php echo htmlspecialchars($default\_form\_data['admin\_emails\_subject']); ?></div> |
| [1469](#L1469) | <input class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['admin\_emails\_subject'], ENT\_QUOTES) ?>" /> |
| [1470](#L1470) | <input name="accua\_form\_admin\_emails\_subject" class="accua\_form\_check\_override" type="checkbox" value="1" <?php if (isset($form\_overrided\_data['admin\_emails\_subject'])) {echo 'checked="checked" ';} ?>/><?php \_e( 'Customize', 'contact-forms'); ?> |
| [1471](#L1471) | </div> |
| [1472](#L1472) |  |
| [1473](#L1473) | <div id="accua\_form\_admin\_emails\_message"> |
| [1474](#L1474) | <input class="accua\_form\_check\_override"  name="accua\_form\_admin\_emails\_message" type="radio" value="0" <?php if (!isset($form\_overrided\_data['admin\_emails\_message'])) {echo ' checked ';} ?>> <?php \_e( 'Use the default message', 'contact-forms'); ?> |
| [1475](#L1475) | <input class="accua\_form\_check\_override"  name="accua\_form\_admin\_emails\_message" type="radio" value="1" <?php if (isset($form\_overrided\_data['admin\_emails\_message']) && !isset($form\_overrided\_data['admin\_emails\_message\_no\_message'])) {echo ' checked ';} ?>/> <?php \_e( 'Customize', 'contact-forms'); ?> |
| [1476](#L1476) | <input class="accua\_form\_check\_override"  name="accua\_form\_admin\_emails\_message" type="radio" value="-1" <?php if (isset($form\_overrided\_data['admin\_emails\_message\_no\_message'])) {echo ' checked ';} ?>/> <?php \_e( 'Don\'t show any messages', 'contact-forms'); ?><br /> |
| [1477](#L1477) | <div class="defalut\_message"> |
| [1478](#L1478) | <?php \_e( 'Default message', 'contact-forms'); ?> |
| [1479](#L1479) | <div class="defalut\_content\_message"><?php echo wpautop($default\_form\_data['admin\_emails\_message']); ?></div> |
| [1480](#L1480) | </div> |
| [1481](#L1481) | <?php  wp\_editor( $form\_data['admin\_emails\_message'] , 'accua\_form\_admin\_emails\_message\_textarea' , $settings\_editor);   ?> |
| [1482](#L1482) | </div> |
| [1483](#L1483) |  |
| [1484](#L1484) | </div> |
| [1485](#L1485) | </div> |
| [1486](#L1486) | </div> |
| [1487](#L1487) |  |
| [1488](#L1488) | <div class="metabox-holder accua-forms-metabox-holder"> |
| [1489](#L1489) | <div class="postbox "> |
| [1490](#L1490) | <h3 class="hndle"><span><?php \_e('4. Email confirmation to the person who completed the form', 'contact-forms'); ?></span></h3> |
| [1491](#L1491) | <div class="inside" id="dashboard\_right\_now"> |
| [1492](#L1492) | <div id="accua\_form\_emails\_from\_name" class="label\_input"> |
| [1493](#L1493) | <label><?php \_e( 'From name', 'contact-forms'); ?></label> |
| [1494](#L1494) | <div class="default\_value"><?php echo htmlspecialchars($default\_form\_data['emails\_from\_name']); ?></div> |
| [1495](#L1495) | <input class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['emails\_from\_name'], ENT\_QUOTES) ?>" /> |
| [1496](#L1496) | <input name="accua\_form\_emails\_from\_name" class="accua\_form\_check\_override" type="checkbox" value="1" <?php if (isset($form\_overrided\_data['emails\_from\_name'])) {echo 'checked="checked" ';} ?>/><?php \_e( 'Customize', 'contact-forms'); ?> |
| [1497](#L1497) | </div> |
| [1498](#L1498) | <div id="accua\_form\_emails\_from" class="label\_input"> |
| [1499](#L1499) | <label><?php \_e( 'From email', 'contact-forms'); ?></label> |
| [1500](#L1500) | <div class="default\_value"><?php echo htmlspecialchars($default\_form\_data['emails\_from']); ?></div> |
| [1501](#L1501) | <input class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['emails\_from'], ENT\_QUOTES) ?>" /> |
| [1502](#L1502) | <input name="accua\_form\_emails\_from" class="accua\_form\_check\_override" type="checkbox" value="1" <?php if (isset($form\_overrided\_data['emails\_from'])) {echo 'checked="checked" ';} ?>/><?php \_e( 'Customize', 'contact-forms'); ?> |
| [1503](#L1503) | </div> |
| [1504](#L1504) | <div id="accua\_form\_confirmation\_emails\_subject" class="label\_input"> |
| [1505](#L1505) | <label><?php \_e( 'Subject', 'contact-forms'); ?></label> |
| [1506](#L1506) | <div class="default\_value"><?php echo htmlspecialchars($default\_form\_data['confirmation\_emails\_subject']); ?></div> |
| [1507](#L1507) | <input class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['confirmation\_emails\_subject'], ENT\_QUOTES) ?>" /> |
| [1508](#L1508) | <input name="accua\_form\_confirmation\_emails\_subject" class="accua\_form\_check\_override" type="checkbox" value="1" <?php if (isset($form\_overrided\_data['confirmation\_emails\_subject'])) {echo 'checked="checked" ';} ?>/><?php \_e( 'Customize', 'contact-forms'); ?> |
| [1509](#L1509) | </div> |
| [1510](#L1510) |  |
| [1511](#L1511) | <div id="accua\_form\_confirmation\_emails\_message"> |
| [1512](#L1512) | <input class="accua\_form\_check\_override"  name="accua\_form\_confirmation\_emails\_message" type="radio" value="0" <?php if (!isset($form\_overrided\_data['confirmation\_emails\_message'])) {echo ' checked ';} ?>> <?php \_e( 'Use the default message', 'contact-forms'); ?> |
| [1513](#L1513) | <input class="accua\_form\_check\_override"  name="accua\_form\_confirmation\_emails\_message" type="radio" value="1" <?php if (isset($form\_overrided\_data['confirmation\_emails\_message']) && !isset($form\_overrided\_data['confirmation\_emails\_message\_no\_message'])) {echo ' checked ';} ?>/> <?php \_e( 'Customize', 'contact-forms'); ?> |
| [1514](#L1514) | <input class="accua\_form\_check\_override"  name="accua\_form\_confirmation\_emails\_message" type="radio" value="-1" <?php if (isset($form\_overrided\_data['confirmation\_emails\_message\_no\_message'])) {echo ' checked ';} ?>/> <?php \_e( 'Don\'t show any messages', 'contact-forms'); ?><br /> |
| [1515](#L1515) | <div class="defalut\_message"> |
| [1516](#L1516) | <?php \_e( 'Default message', 'contact-forms'); ?> |
| [1517](#L1517) | <div class="defalut\_content\_message"><?php echo wpautop($default\_form\_data['confirmation\_emails\_message']); ?></div> |
| [1518](#L1518) | </div> |
| [1519](#L1519) | <?php  wp\_editor( $form\_data['confirmation\_emails\_message'] , 'accua\_form\_confirmation\_emails\_message\_textarea' , $settings\_editor);   ?> |
| [1520](#L1520) | </div> |
| [1521](#L1521) | </div> |
| [1522](#L1522) | </div> |
| [1523](#L1523) | </div> |
| [1524](#L1524) | <br clear="all"/> |
| [1525](#L1525) |  |
| [1526](#L1526) | <?php accua\_forms\_print\_tokens(); ?> |
| [1527](#L1527) |  |
| [1528](#L1528) | <input type="hidden" id="accua\_form\_save\_settings\_id" value="<?php echo $fid\_esc; ?>" /> |
| [1529](#L1529) | </div> |
| [1530](#L1530) | <?php /\* |
| [1531](#L1531) | <div id="accua\_tab\_preview" class="content\_tab"> |
| [1532](#L1532) | </div> \*/?> |
| [1533](#L1533) | <p></p> |
| [1534](#L1534) | <input  class="button button-primary button-large accua\_form\_save\_settings\_button" id="accua\_form\_save\_settings\_2" type="button" value="<?php \_e( 'Save settings', 'contact-forms'); ?>" /> <span class="accua\_form\_save\_settings\_status"></span> |
| [1535](#L1535) |  |
| [1536](#L1536) | </div> |
| [1537](#L1537) | <script> |
| [1538](#L1538) | jQuery('input[type=radio]').change(function() { |
| [1539](#L1539) | var name = jQuery(this).attr('name'); |
| [1540](#L1540) | if (jQuery(this).val() == '1') { |
| [1541](#L1541) | jQuery('#'+name+' .defalut\_message').hide(); |
| [1542](#L1542) | jQuery('#'+name+' .wp-editor-wrap').show(); |
| [1543](#L1543) | } |
| [1544](#L1544) | else { |
| [1545](#L1545) | if(jQuery(this).val() != '-1') |
| [1546](#L1546) | jQuery('#'+name+' .defalut\_message').show(); |
| [1547](#L1547) | else |
| [1548](#L1548) | jQuery('#'+name+' .defalut\_message').hide(); |
| [1549](#L1549) | jQuery('#'+name+' .wp-editor-wrap').hide(); |
| [1550](#L1550) | } |
| [1551](#L1551) | }); |
| [1552](#L1552) |  |
| [1553](#L1553) | jQuery('input[type=checkbox]').click(function() { |
| [1554](#L1554) | var name = jQuery(this).attr('name'); |
| [1555](#L1555) | if (!this.checked) { |
| [1556](#L1556) | jQuery('#'+name+' .default\_value').show(); |
| [1557](#L1557) | jQuery('#'+name+' .accua\_form\_value, #'+name+' .cp-color-picker').hide(); |
| [1558](#L1558) | } |
| [1559](#L1559) | else { |
| [1560](#L1560) | jQuery('#'+name+' .default\_value').hide(); |
| [1561](#L1561) | jQuery('#'+name+' .accua\_form\_value, #'+name+' .cp-color-picker').show(); |
| [1562](#L1562) | //cp-color-picker |
| [1563](#L1563) | } |
| [1564](#L1564) | }); |
| [1565](#L1565) |  |
| [1566](#L1566) | jQuery(".token\_link").click(function() { |
| [1567](#L1567) | jQuery("#dialog\_token").dialog("open"); |
| [1568](#L1568) | return false; |
| [1569](#L1569) | }); |
| [1570](#L1570) |  |
| [1571](#L1571) | //inizializzazione |
| [1572](#L1572) | jQuery(document).ready(function($){ |
| [1573](#L1573) | $('#accua\_form\_preview\_area\_wrapper').resizable({handles: 's'}); |
| [1574](#L1574) | $('#accua\_form\_preview\_area').css({ |
| [1575](#L1575) | 'width': '100%', |
| [1576](#L1576) | 'height': '100%' |
| [1577](#L1577) | }); |
| [1578](#L1578) | $.each( |
| [1579](#L1579) | ['success\_message','error\_message','admin\_emails\_message','confirmation\_emails\_message'], |
| [1580](#L1580) | function(i,key){ |
| [1581](#L1581) | var value = $('#accua\_form\_'+key+' .accua\_form\_check\_override:checked').val(); |
| [1582](#L1582) | if(value!=undefined && value!=0) { |
| [1583](#L1583) | if(value!=-1) |
| [1584](#L1584) | jQuery('#accua\_form\_'+key+' .wp-editor-wrap').show(); |
| [1585](#L1585) | else |
| [1586](#L1586) | jQuery('#accua\_form\_'+key+' .wp-editor-wrap').hide(); |
| [1587](#L1587) | jQuery('#accua\_form\_'+key+' .defalut\_message').hide(); |
| [1588](#L1588) |  |
| [1589](#L1589) | } |
| [1590](#L1590) | else { |
| [1591](#L1591) | jQuery('#accua\_form\_'+key+' .wp-editor-wrap').hide(); |
| [1592](#L1592) | jQuery('#accua\_form\_'+key+' .defalut\_message').show(); |
| [1593](#L1593) | } |
| [1594](#L1594) | } |
| [1595](#L1595) | ); |
| [1596](#L1596) | $.each( |
| [1597](#L1597) | ['emails\_from\_name','emails\_from','admin\_emails\_to','emails\_bcc','admin\_emails\_subject','confirmation\_emails\_subject','style\_margin','style\_border\_color','style\_border\_width','style\_border\_radius','style\_background\_color','style\_padding','style\_color','style\_font\_size','style\_field\_spacing','style\_field\_border\_color','style\_field\_border\_width','style\_field\_border\_radius','style\_field\_background\_color','style\_field\_padding','style\_field\_color','style\_submit\_border\_color','style\_submit\_border\_width','style\_submit\_border\_radius','style\_submit\_background\_color','style\_submit\_padding','style\_submit\_color','style\_submit\_font\_size'], |
| [1598](#L1598) | function(i,key){ |
| [1599](#L1599) | if(!$('#accua\_form\_'+key+' .accua\_form\_check\_override').is(':checked')) { |
| [1600](#L1600) | jQuery('#accua\_form\_'+key+' .default\_value').show(); |
| [1601](#L1601) | jQuery('#accua\_form\_'+key+' .accua\_form\_value, #accua\_form\_'+key+' .wp-picker-container').hide(); |
| [1602](#L1602) | } |
| [1603](#L1603) | else { |
| [1604](#L1604) | jQuery('#accua\_form\_'+key+' .default\_value').hide(); |
| [1605](#L1605) | jQuery('#accua\_form\_'+key+' .accua\_form\_value, #accua\_form\_'+key+' .wp-picker-container').show(); |
| [1606](#L1606) | } |
| [1607](#L1607) | }); |
| [1608](#L1608) | $("#dialog\_token").dialog({ dialogClass:'wp-dialog' ,autoOpen : false, modal : true, show : "blind", hide : "blind"}); |
| [1609](#L1609) |  |
| [1610](#L1610) | $('#accua\_token a').appendTo('.wp-media-buttons'); |
| [1611](#L1611) |  |
| [1612](#L1612) | }); |
| [1613](#L1613) |  |
| [1614](#L1614) | jQuery(document).ready(function($){ |
| [1615](#L1615) |  |
| [1616](#L1616) | var originalWidth = $(document).width(); |
| [1617](#L1617) | if(originalWidth <= 883) { //iphone |
| [1618](#L1618) | $(".metabox-holder").width('98%'); |
| [1619](#L1619) | } |
| [1620](#L1620) |  |
| [1621](#L1621) | $(window).resize(function (e) { |
| [1622](#L1622) | var newWidth = $(document).width(); |
| [1623](#L1623) | if(newWidth <= 883) { |
| [1624](#L1624) | if (originalWidth > 883) { |
| [1625](#L1625) | $(".metabox-holder").width('98%'); |
| [1626](#L1626) | } |
| [1627](#L1627) | } else if (originalWidth<=883) { |
| [1628](#L1628) | $(".metabox-holder").width('47%'); |
| [1629](#L1629) | } |
| [1630](#L1630) | originalWidth = newWidth; |
| [1631](#L1631) | }); |
| [1632](#L1632) | }); |
| [1633](#L1633) |  |
| [1634](#L1634) | </script> |
| [1635](#L1635) |  |
| [1636](#L1636) | <?php |
| [1637](#L1637) | $accuaHelp->finished(); |
| [1638](#L1638) | } |
| [1639](#L1639) |  |
| [1640](#L1640) | function accua\_forms\_fields\_page\_head() { |
| [1641](#L1641) | /\* |
| [1642](#L1642) | $baseurl = WP\_PLUGIN\_URL.'/'.substr(plugin\_basename(\_\_FILE\_\_),0,-strlen(basename(\_\_FILE\_\_))); |
| [1643](#L1643) | ?> |
| [1644](#L1644) | <script type="text/javascript" src="<?php echo $baseurl.'/qtip/jquery.qtip-1.0.0-rc3.js'; ?>"></script> |
| [1645](#L1645) | <script type="text/javascript"> |
| [1646](#L1646) | var avail\_fields = { |
| [1647](#L1647) | first\_name: { |
| [1648](#L1648) | id: "first\_name", |
| [1649](#L1649) | name: "First Name", |
| [1650](#L1650) | type: "textfield" |
| [1651](#L1651) | }, |
| [1652](#L1652) | last\_name: { |
| [1653](#L1653) | id: "last\_name", |
| [1654](#L1654) | name: "Last Name", |
| [1655](#L1655) | type: "textfield" |
| [1656](#L1656) | }, |
| [1657](#L1657) | email: { |
| [1658](#L1658) | id: "email", |
| [1659](#L1659) | name: "Email", |
| [1660](#L1660) | type: "email" |
| [1661](#L1661) | } |
| [1662](#L1662) | }; |
| [1663](#L1663) |  |
| [1664](#L1664) | jQuery(function($){ |
| [1665](#L1665) | $avail = $('#available\_fields\_container'); |
| [1666](#L1666) | for(var id in avail\_fields) { |
| [1667](#L1667) | var field = avail\_fields[id]; |
| [1668](#L1668) | var el = $('<div></div>').text(field.name); |
| [1669](#L1669) | el.prepend('<input type="checkbox" />'); |
| [1670](#L1670) | var content = $('<div><span>Id: </span></div>'); |
| [1671](#L1671) | content.append($('<input type="text" />').val(field.id)); |
| [1672](#L1672) | content.append($('<br /><span>Name: </span>')); |
| [1673](#L1673) | content.append($('<input type="text" />').val(field.name)); |
| [1674](#L1674) | content.append($('<br /><span>Type: </span>')); |
| [1675](#L1675) | content.append($('<select><option value="textfield">Textfield</option><option value="textarea">Textarea</option><option value="email">Email</option></select>').val(field.type)); |
| [1676](#L1676) | el.qtip({ |
| [1677](#L1677) | content: { |
| [1678](#L1678) | text: content |
| [1679](#L1679) | }, |
| [1680](#L1680) | position: { |
| [1681](#L1681) | target: 'mouse', |
| [1682](#L1682) | corner: { |
| [1683](#L1683) | target: 'bottomRight', |
| [1684](#L1684) | tooltip: 'topLeft' |
| [1685](#L1685) | }, |
| [1686](#L1686) | adjust: { |
| [1687](#L1687) | mouse: false |
| [1688](#L1688) | } |
| [1689](#L1689) | }, |
| [1690](#L1690) | show: { |
| [1691](#L1691) | when: { |
| [1692](#L1692) | event: 'mouseover' |
| [1693](#L1693) | }, |
| [1694](#L1694) | solo: true |
| [1695](#L1695) | }, |
| [1696](#L1696) | hide: { |
| [1697](#L1697) | when: { |
| [1698](#L1698) | event: 'unfocus' |
| [1699](#L1699) | } |
| [1700](#L1700) | } |
| [1701](#L1701) | }); |
| [1702](#L1702) | $avail.append(el); |
| [1703](#L1703) | } |
| [1704](#L1704) | }); |
| [1705](#L1705) | </script> |
| [1706](#L1706) | <style type="text/css"> |
| [1707](#L1707) | .container > div { |
| [1708](#L1708) | padding: 0px; |
| [1709](#L1709) | margin-bottom: 6px; |
| [1710](#L1710) | } |
| [1711](#L1711) | </style> |
| [1712](#L1712) | <?php |
| [1713](#L1713) | \*/ |
| [1714](#L1714) | } |
| [1715](#L1715) |  |
| [1716](#L1716) | function accua\_forms\_fields\_get\_types() { |
| [1717](#L1717) | return array( |
| [1718](#L1718) | 'textfield' => \_\_( 'Text Field', 'contact-forms'), |
| [1719](#L1719) | 'textarea' => \_\_( 'Text Area', 'contact-forms'), |
| [1720](#L1720) | 'email' =>  \_\_( 'Email', 'contact-forms'), |
| [1721](#L1721) | 'autoreply\_email' => \_\_( 'Autoreply Email', 'contact-forms'), |
| [1722](#L1722) | 'checkbox' => \_\_( 'Checkbox','contact-forms'), |
| [1723](#L1723) | 'select' => \_\_('Select',  'contact-forms'), |
| [1724](#L1724) | 'radio' => \_\_( 'Radio buttons', 'contact-forms'), |
| [1725](#L1725) | 'multiselect' => \_\_( 'Multiple selections area', 'contact-forms'), |
| [1726](#L1726) | 'multicheckbox' => \_\_( 'Multiple checkboxes', 'contact-forms'), |
| [1727](#L1727) | 'post-select' => \_\_( 'Post select', 'contact-forms'), |
| [1728](#L1728) | 'post-multicheckbox' => \_\_( 'Multiple post checkboxes', 'contact-forms'), |
| [1729](#L1729) | 'colorpicker' => \_\_( 'Color picker', 'contact-forms'), |
| [1730](#L1730) | 'hidden' => \_\_('Hidden value',  'contact-forms'), |
| [1731](#L1731) | 'file' => \_\_('File upload',  'contact-forms'), |
| [1732](#L1732) | 'submit' => \_\_( 'Submit button', 'contact-forms'), |
| [1733](#L1733) | 'html' => \_\_( 'Custom HTML', 'contact-forms'), |
| [1734](#L1734) | 'captcha' => \_\_( 'Captcha', 'contact-forms'), |
| [1735](#L1735) | 'password' => 'Password', |
| [1736](#L1736) | 'password-and-confirm' => \_\_( 'Password and password confirmation','contact-forms'), |
| [1737](#L1737) | 'date' => \_\_( 'Date','contact-forms'), |
| [1738](#L1738) | ); |
| [1739](#L1739) | } |
| [1740](#L1740) |  |
| [1741](#L1741) | function accua\_forms\_filter\_date($value){ |
| [1742](#L1742) | if (($value !== '') && preg\_match('/^\d{4}-\d{2}-\d{2}$/', $value)) { |
| [1743](#L1743) | try { |
| [1744](#L1744) | $date = new DateTime($value); |
| [1745](#L1745) | if ($date) { |
| [1746](#L1746) | return $value; |
| [1747](#L1747) | } |
| [1748](#L1748) | } catch (Exception $e) { |
| [1749](#L1749) | } |
| [1750](#L1750) | } |
| [1751](#L1751) | return ''; |
| [1752](#L1752) | } |
| [1753](#L1753) |  |
| [1754](#L1754) | function accua\_forms\_fields\_filter\_values($post, $old\_data = array()) { |
| [1755](#L1755) | //TODO: funzione di validazione dei field |
| [1756](#L1756) | $data = array( |
| [1757](#L1757) | 'version' => 2, |
| [1758](#L1758) | 'id' => $post['form-field-id'], |
| [1759](#L1759) | 'name' => $post['form-field-name'], |
| [1760](#L1760) | 'type' => $post['form-field-type'], |
| [1761](#L1761) | 'description' => $post['form-field-description'], |
| [1762](#L1762) | 'default\_value' => $post['form-field-default-value'], |
| [1763](#L1763) | 'default\_date\_value' => $post['form-field-default-date-value'], |
| [1764](#L1764) | 'allowed\_values' => $post['form-field-allowed-values'], |
| [1765](#L1765) | 'allowed\_extensions' => '', |
| [1766](#L1766) | 'min\_date' => $post['form-field-min-of-date'], |
| [1767](#L1767) | 'max\_date' => $post['form-field-max-of-date'], |
| [1768](#L1768) | ); |
| [1769](#L1769) | $valid = true; |
| [1770](#L1770) | $message = ''; |
| [1771](#L1771) |  |
| [1772](#L1772) | $types = accua\_forms\_fields\_get\_types(); |
| [1773](#L1773) | if (!isset($types[$data['type']])) { |
| [1774](#L1774) | $message .= "<p>".\_\_('Invalid type', 'contact-forms')."</p>"; |
| [1775](#L1775) | $valid = false; |
| [1776](#L1776) | $data['type'] = 'textfield'; |
| [1777](#L1777) | } |
| [1778](#L1778) |  |
| [1779](#L1779) | if (!current\_user\_can('unfiltered\_html')) { |
| [1780](#L1780) | $filter\_fields = array('name', 'description', 'default\_value', 'allowed\_values'); |
| [1781](#L1781) | foreach ($filter\_fields as $k) { |
| [1782](#L1782) | $data[$k] = wp\_kses($data[$k], 'post'); |
| [1783](#L1783) | } |
| [1784](#L1784) | } |
| [1785](#L1785) |  |
| [1786](#L1786) | if ($data['type'] == 'file') { |
| [1787](#L1787) | $data['allowed\_extensions'] = accua\_forms\_filter\_extensions($data['allowed\_values']); |
| [1788](#L1788) | } |
| [1789](#L1789) |  |
| [1790](#L1790) | $dates = array( |
| [1791](#L1791) | 'default\_date\_value' => \_\_('Invalid default date', 'contact-forms'), |
| [1792](#L1792) | 'min\_date' => \_\_('Invalid min date', 'contact-forms'), |
| [1793](#L1793) | 'max\_date' => \_\_('Invalid max date', 'contact-forms'), |
| [1794](#L1794) | ); |
| [1795](#L1795) | foreach ($dates as $k => $errormsg) { |
| [1796](#L1796) | if ($data[$k] !== '') { |
| [1797](#L1797) | $data[$k] = accua\_forms\_filter\_date($data[$k]); |
| [1798](#L1798) | if ($data[$k] === '') { |
| [1799](#L1799) | $message .= "<p>".$errormsg."</p>"; |
| [1800](#L1800) | $valid = false; |
| [1801](#L1801) | } |
| [1802](#L1802) | } |
| [1803](#L1803) | } |
| [1804](#L1804) |  |
| [1805](#L1805) | return array( |
| [1806](#L1806) | 'data' => $data, |
| [1807](#L1807) | 'valid' => $valid, |
| [1808](#L1808) | 'message' => $message, |
| [1809](#L1809) | ); |
| [1810](#L1810) | } |
| [1811](#L1811) |  |
| [1812](#L1812) | function accua\_forms\_fields\_page() { |
| [1813](#L1813) | /\* |
| [1814](#L1814) | ?> |
| [1815](#L1815) | <div class="wrap"><h2>Edit Form Fields</h2> |
| [1816](#L1816) | <div id="available\_fields\_container" class="container"></div> |
| [1817](#L1817) | </div> |
| [1818](#L1818) | <?php |
| [1819](#L1819) | \*/ |
| [1820](#L1820) | $message = ''; |
| [1821](#L1821) | $taxonomy = ''; |
| [1822](#L1822) | $post\_type = ''; |
| [1823](#L1823) |  |
| [1824](#L1824) | /\* |
| [1825](#L1825) | $avail\_fields = array( |
| [1826](#L1826) | 'first\_name' => array ( |
| [1827](#L1827) | 'id' => "first\_name", |
| [1828](#L1828) | 'name' => "First Name", |
| [1829](#L1829) | 'type' => "textfield", |
| [1830](#L1830) | 'description' => 'This is the first name', |
| [1831](#L1831) | ), |
| [1832](#L1832) | 'last\_name' => array ( |
| [1833](#L1833) | 'id' => "last\_name", |
| [1834](#L1834) | 'name' => "Last Name", |
| [1835](#L1835) | 'type' => "textfield", |
| [1836](#L1836) | 'description' => 'This is the last name', |
| [1837](#L1837) | ), |
| [1838](#L1838) | 'email' => array ( |
| [1839](#L1839) | 'id' => "email", |
| [1840](#L1840) | 'name' => "Email", |
| [1841](#L1841) | 'type' => "email", |
| [1842](#L1842) | 'description' => 'This is the email', |
| [1843](#L1843) | ), |
| [1844](#L1844) | ); |
| [1845](#L1845) | \*/ |
| [1846](#L1846) |  |
| [1847](#L1847) | $avail\_fields = get\_option('accua\_forms\_avail\_fields', array()); |
| [1848](#L1848) |  |
| [1849](#L1849) | $default\_form\_values = array( |
| [1850](#L1850) | 'version' => 1, |
| [1851](#L1851) | 'id' => '', |
| [1852](#L1852) | 'name' => '', |
| [1853](#L1853) | 'type' => 'textfield', |
| [1854](#L1854) | 'description' => '', |
| [1855](#L1855) | 'default\_value' => '', |
| [1856](#L1856) | 'default\_date\_value' => '', |
| [1857](#L1857) | 'allowed\_values' => '', |
| [1858](#L1858) | 'allowed\_extensions' => '', |
| [1859](#L1859) | 'min\_date' => '', |
| [1860](#L1860) | 'max\_date' => '', |
| [1861](#L1861) | ); |
| [1862](#L1862) |  |
| [1863](#L1863) | $editing = false; |
| [1864](#L1864) | $adding = true; |
| [1865](#L1865) |  |
| [1866](#L1866) | if (!empty($\_POST['action'])) { |
| [1867](#L1867) | check\_admin\_referer('edit\_form\_field', '\_wpnonce\_edit\_form\_field'); |
| [1868](#L1868) | $post = stripslashes\_deep($\_POST) + $default\_form\_values; |
| [1869](#L1869) | switch($post['action']) { |
| [1870](#L1870) | case 'edit-form-field': |
| [1871](#L1871) | if (empty($avail\_fields[$post['form-field-id']])) { |
| [1872](#L1872) | $message .= 'Field "'.htmlspecialchars(sanitize\_text\_field($post['form-field-id'])).'" doesn\'t exists'; |
| [1873](#L1873) | } else { |
| [1874](#L1874) | if (empty($post['delete-field'])) { |
| [1875](#L1875) | $filtered\_data = accua\_forms\_fields\_filter\_values($post, $avail\_fields[$post['form-field-id']]); |
| [1876](#L1876) | $avail\_fields[$post['form-field-id']] = $filtered\_data['data']; |
| [1877](#L1877) | $message .= sprintf( \_\_( 'Field "%s" updated', 'contact-forms'), htmlspecialchars($post['form-field-id']) ); |
| [1878](#L1878) | do\_action('accua\_forms\_field\_updated', $avail\_fields[$post['form-field-id']]); |
| [1879](#L1879) | } else { |
| [1880](#L1880) | $deleting\_field = $avail\_fields[$post['form-field-id']]; |
| [1881](#L1881) | unset ($avail\_fields[$post['form-field-id']]); |
| [1882](#L1882) | $message .= sprintf( \_\_( 'Field "%s" deleted', 'contact-forms'), htmlspecialchars($post['form-field-id']) ); |
| [1883](#L1883) | do\_action('accua\_forms\_field\_deleted', $deleting\_field); |
| [1884](#L1884) | } |
| [1885](#L1885) | update\_option('accua\_forms\_avail\_fields', $avail\_fields); |
| [1886](#L1886) | } |
| [1887](#L1887) | break; |
| [1888](#L1888) | case 'add-form-field': |
| [1889](#L1889) | $fill\_form\_fields = true; |
| [1890](#L1890) | $valid = true; |
| [1891](#L1891) | if (empty($post['form-field-id']) || !preg\_match('/^[a-z0-9\_-]+$/i', $post['form-field-id'])) { |
| [1892](#L1892) | $message .= "<p>".\_\_( 'Only letters, numbers, hyphen and underscores allowed in field identificative slug', 'contact-forms')."</p>"; |
| [1893](#L1893) | $valid = false; |
| [1894](#L1894) | } |
| [1895](#L1895) | if(substr($post['form-field-id'], 0, 2) == '\_\_') { |
| [1896](#L1896) | $message .= "<p>".\_\_( 'The field identificative slug can\'t start with two underscores (\_\_)', 'contact-forms')."</p>"; |
| [1897](#L1897) | $valid = false; |
| [1898](#L1898) | } |
| [1899](#L1899) | if (!empty($avail\_fields[$post['form-field-id']])) { |
| [1900](#L1900) | $message .= sprintf( \_\_( '<p>A field with identificative slug "%s" already exists</p> Field "%s" deleted', 'contact-forms'), htmlspecialchars($post['form-field-id']) ); |
| [1901](#L1901) | $valid = false; |
| [1902](#L1902) | } |
| [1903](#L1903) | if (strlen($post['form-field-id']) > 70) { |
| [1904](#L1904) | $message .= "<p>".\_\_( 'The identificative slug cannot be longer than 70 characters', 'contact-forms')."</p>"; |
| [1905](#L1905) | $valid = false; |
| [1906](#L1906) | } |
| [1907](#L1907) | $filtered\_data = accua\_forms\_fields\_filter\_values($post); |
| [1908](#L1908) | $message .= $filtered\_data['message']; |
| [1909](#L1909) | $valid = $valid && $filtered\_data['valid']; |
| [1910](#L1910) | if ($valid) { |
| [1911](#L1911) | $fill\_form\_fields = false; |
| [1912](#L1912) | $avail\_fields[$post['form-field-id']] = $filtered\_data['data']; |
| [1913](#L1913) | update\_option('accua\_forms\_avail\_fields', $avail\_fields); |
| [1914](#L1914) | $message .= sprintf( \_\_( 'Field "%s" created', 'contact-forms'), htmlspecialchars($post['form-field-id']) ); |
| [1915](#L1915) | do\_action('accua\_forms\_field\_added', $avail\_fields[$post['form-field-id']]); |
| [1916](#L1916) | } |
| [1917](#L1917) | if ($fill\_form\_fields) { |
| [1918](#L1918) | $editing = true; |
| [1919](#L1919) | $default\_form\_values = $filtered\_data['data']; |
| [1920](#L1920) | } |
| [1921](#L1921) | break; |
| [1922](#L1922) | } |
| [1923](#L1923) | } else if (!empty($\_GET['edit-fid'])) { |
| [1924](#L1924) | $fid = stripslashes($\_GET['edit-fid']); |
| [1925](#L1925) | if (empty($avail\_fields[$fid])) { |
| [1926](#L1926) | $message .= sprintf( \_\_( 'Field "%s" doesn\'t exists', 'contact-forms'), htmlspecialchars($fid) ); |
| [1927](#L1927) | } else { |
| [1928](#L1928) | $adding = false; |
| [1929](#L1929) | $editing = true; |
| [1930](#L1930) | $default\_form\_values = $avail\_fields[$fid] + $default\_form\_values; |
| [1931](#L1931) | } |
| [1932](#L1932) | } |
| [1933](#L1933) | if ($default\_form\_values['version'] >= 2 && $default\_form\_values['type'] == 'file') { |
| [1934](#L1934) | //Show allowed\_extensions value in allowed\_values field |
| [1935](#L1935) | $default\_form\_values['allowed\_values'] = $default\_form\_values['allowed\_extensions']; |
| [1936](#L1936) | } |
| [1937](#L1937) |  |
| [1938](#L1938) | ?> |
| [1939](#L1939) | <div id="accua\_forms\_fields\_page" class="accua\_forms\_admin\_page wrap nosubsub"> |
| [1940](#L1940) | <h2><img src="<?php echo ACCUA\_FORMS\_DIR\_URL.'img/cimatti-icon-20.png'; ?>"/> <?php \_e('Contact Forms - Fields', 'contact-forms'); ?></h2> |
| [1941](#L1941) | <?php /\* screen\_icon(); ?> |
| [1942](#L1942) | <h2><?php echo esc\_html( $title ); |
| [1943](#L1943) | if ( !empty($\_REQUEST['s']) ) |
| [1944](#L1944) | printf( '<span class="subtitle">' . \_\_('Search results for &#8220;%s&#8221;') . '</span>', esc\_html( stripslashes($\_REQUEST['s']) ) ); ?> |
| [1945](#L1945) | </h2> |
| [1946](#L1946) |  |
| [1947](#L1947) | <?php if ( isset($\_REQUEST['message']) && ( $msg = (int) $\_REQUEST['message'] ) ) : ?> |
| [1948](#L1948) | <div id="message" class="updated"><p><?php echo $messages[$msg]; ?></p></div> |
| [1949](#L1949) | <?php $\_SERVER['REQUEST\_URI'] = remove\_query\_arg(array('message'), $\_SERVER['REQUEST\_URI']); |
| [1950](#L1950) | endif; \*/ ?> |
| [1951](#L1951) | <div id="ajax-response"><?php echo $message?></div> |
| [1952](#L1952) |  |
| [1953](#L1953) | <?php /\* |
| [1954](#L1954) | <form class="search-form" action="" method="get"> |
| [1955](#L1955) | <input type="hidden" name="taxonomy" value="<?php echo esc\_attr($taxonomy); ?>" /> |
| [1956](#L1956) | <input type="hidden" name="post\_type" value="<?php echo esc\_attr($post\_type); ?>" /> |
| [1957](#L1957) |  |
| [1958](#L1958) | <?php $wp\_list\_table->search\_box( $tax->labels->search\_items, 'tag' ); ?> |
| [1959](#L1959) |  |
| [1960](#L1960) | </form> |
| [1961](#L1961) | \*/ ?> |
| [1962](#L1962) |  |
| [1963](#L1963) | <br class="clear" /> |
| [1964](#L1964) |  |
| [1965](#L1965) | <div id="col-container"> |
| [1966](#L1966) |  |
| [1967](#L1967) | <div id="col-right"> |
| [1968](#L1968) | <div class="col-wrap"> |
| [1969](#L1969) | <?php if (!$editing) { ?> |
| [1970](#L1970) | <form id="posts-filter" action="" method="post"> |
| [1971](#L1971) | <input type="hidden" name="taxonomy" value="<?php echo esc\_attr($taxonomy); /\* TODO: Is this needed? \*/ ?>" /> |
| [1972](#L1972) | <input type="hidden" name="post\_type" value="<?php echo esc\_attr($post\_type); /\* TODO: Is this needed? \*/ ?>" /> |
| [1973](#L1973) |  |
| [1974](#L1974) | <?php /\* $wp\_list\_table->display(); \*/ ?> |
| [1975](#L1975) |  |
| [1976](#L1976) | <table cellspacing="0" class="wp-list-table widefat fixed tags"> |
| [1977](#L1977) | <thead> |
| [1978](#L1978) | <tr> |
| [1979](#L1979) | <th style="" class="manage-column column-cb check-column" id="cb" scope="col"><input type="checkbox" /></th> |
| [1980](#L1980) | <th style="" class="manage-column column-name" id="name" scope="col"><?php \_e( 'Label', 'contact-forms'); ?></th> |
| [1981](#L1981) | <th style="" class="manage-column column-description" id="description" scope="col"><?php \_e( 'Description', 'contact-forms'); ?></th> |
| [1982](#L1982) | <th style="" class="manage-column column-slug" id="slug" scope="col"><?php \_e( 'Slug', 'contact-forms'); ?></th> |
| [1983](#L1983) | <th style="" class="manage-column column-type" id="type" scope="col"><?php \_e( 'Type', 'contact-forms'); ?></th> |
| [1984](#L1984) | </tr> |
| [1985](#L1985) | </thead> |
| [1986](#L1986) |  |
| [1987](#L1987) | <tfoot> |
| [1988](#L1988) | <tr> |
| [1989](#L1989) | <th style="" class="manage-column column-cb check-column" scope="col"><input type="checkbox" /></th> |
| [1990](#L1990) | <th style="" class="manage-column column-name" scope="col"><?php \_e( 'Label', 'contact-forms'); ?></th> |
| [1991](#L1991) | <th style="" class="manage-column column-description" scope="col"><?php \_e( 'Description', 'contact-forms'); ?></th> |
| [1992](#L1992) | <th style="" class="manage-column column-slug" scope="col"><?php \_e( 'Slug', 'contact-forms'); ?></th> |
| [1993](#L1993) | <th style="" class="manage-column column-type" scope="col"><?php \_e( 'Type', 'contact-forms'); ?></th> |
| [1994](#L1994) | </tr> |
| [1995](#L1995) | </tfoot> |
| [1996](#L1996) |  |
| [1997](#L1997) | <tbody class="list:tag" id="the-list"> |
| [1998](#L1998) | <?php |
| [1999](#L1999) | foreach ($avail\_fields as $id => $field) { |
| [2000](#L2000) | foreach (array('id', 'name', 'type', 'description') as $i) { |
| [2001](#L2001) | $field[$i] = htmlspecialchars($field[$i], ENT\_QUOTES); |
| [2002](#L2002) | $field[$i] = sanitize\_text\_field($field[$i]); |
| [2003](#L2003) | } |
| [2004](#L2004) | echo <<<END\_OF\_ROW |
| [2005](#L2005) | <tr id="field-{$field['id']}"> |
| [2006](#L2006) | <th class="check-column" scope="row"><input type="checkbox" /></th> |
| [2007](#L2007) | <td class="name column-name"><strong><a title="Edit “{$field['name']}”" href="admin.php?page=accua\_forms\_fields&amp;edit-fid={$field['id']}" class="row-title">{$field['name']}</a></strong><br><div class="row-actions"><span class="edit"><a href="admin.php?page=accua\_forms\_fields&amp;edit-fid={$field['id']}">Edit</a></span></div></td> |
| [2008](#L2008) | <td class="description column-description">{$field['description']}</td> |
| [2009](#L2009) | <td class="slug column-slug">{$field['id']}</td> |
| [2010](#L2010) | <td class="type column-type">{$field['type']}</td> |
| [2011](#L2011) | </tr> |
| [2012](#L2012) | END\_OF\_ROW; |
| [2013](#L2013) | } |
| [2014](#L2014) | ?> |
| [2015](#L2015) | </tbody> |
| [2016](#L2016) | </table> |
| [2017](#L2017) |  |
| [2018](#L2018) | <br class="clear" /> |
| [2019](#L2019) | </form> |
| [2020](#L2020) | <?php } ?> |
| [2021](#L2021) | <?php /\* if ( 'category' == $taxonomy ) : ?> |
| [2022](#L2022) | <div class="form-wrap"> |
| [2023](#L2023) | <p><?php printf(\_\_('<strong>Note:</strong><br />Deleting a category does not delete the posts in that category. Instead, posts that were only assigned to the deleted category are set to the category <strong>%s</strong>.'), apply\_filters('the\_category', get\_cat\_name(get\_option('default\_category')))) ?></p> |
| [2024](#L2024) | <?php if ( current\_user\_can( 'import' ) ) : ?> |
| [2025](#L2025) | <p><?php printf(\_\_('Categories can be selectively converted to tags using the <a href="%s">category to tag converter</a>.'), 'import.php') ?></p> |
| [2026](#L2026) | <?php endif; ?> |
| [2027](#L2027) | </div> |
| [2028](#L2028) | <?php elseif ( 'post\_tag' == $taxonomy && current\_user\_can( 'import' ) ) : ?> |
| [2029](#L2029) | <div class="form-wrap"> |
| [2030](#L2030) | <p><?php printf(\_\_('Tags can be selectively converted to categories using the <a href="%s">tag to category converter</a>'), 'import.php') ;?>.</p> |
| [2031](#L2031) | </div> |
| [2032](#L2032) | <?php endif; |
| [2033](#L2033) | do\_action('after-' . $taxonomy . '-table', $taxonomy); |
| [2034](#L2034) | \*/ ?> |
| [2035](#L2035) |  |
| [2036](#L2036) | </div> |
| [2037](#L2037) | </div><!-- /col-right --> |
| [2038](#L2038) |  |
| [2039](#L2039) | <div id="col-left"> |
| [2040](#L2040) | <div class="col-wrap"> |
| [2041](#L2041) |  |
| [2042](#L2042) | <?php |
| [2043](#L2043) | /\* |
| [2044](#L2044) | if ( !is\_null( $tax->labels->popular\_items ) ) { |
| [2045](#L2045) | if ( current\_user\_can( $tax->cap->edit\_terms ) ) |
| [2046](#L2046) | $tag\_cloud = wp\_tag\_cloud( array( 'taxonomy' => $taxonomy, 'echo' => false, 'link' => 'edit' ) ); |
| [2047](#L2047) | else |
| [2048](#L2048) | $tag\_cloud = wp\_tag\_cloud( array( 'taxonomy' => $taxonomy, 'echo' => false ) ); |
| [2049](#L2049) |  |
| [2050](#L2050) | if ( $tag\_cloud ) : |
| [2051](#L2051) | ?> |
| [2052](#L2052) | <div class="tagcloud"> |
| [2053](#L2053) | <h3><?php echo $tax->labels->popular\_items; ?></h3> |
| [2054](#L2054) | <?php echo $tag\_cloud; unset( $tag\_cloud ); ?> |
| [2055](#L2055) | </div> |
| [2056](#L2056) | <?php |
| [2057](#L2057) | endif; |
| [2058](#L2058) | } |
| [2059](#L2059) | \*/ |
| [2060](#L2060) |  |
| [2061](#L2061) | /\* |
| [2062](#L2062) | if ( current\_user\_can($tax->cap->edit\_terms) ) { |
| [2063](#L2063) | // Back compat hooks. Deprecated in preference to {$taxonomy}\_pre\_add\_form |
| [2064](#L2064) | if ( 'category' == $taxonomy ) |
| [2065](#L2065) | do\_action('add\_category\_form\_pre', (object)array('parent' => 0) ); |
| [2066](#L2066) | elseif ( 'link\_category' == $taxonomy ) |
| [2067](#L2067) | do\_action('add\_link\_category\_form\_pre', (object)array('parent' => 0) ); |
| [2068](#L2068) | else |
| [2069](#L2069) | do\_action('add\_tag\_form\_pre', $taxonomy); |
| [2070](#L2070) |  |
| [2071](#L2071) | do\_action($taxonomy . '\_pre\_add\_form', $taxonomy); |
| [2072](#L2072) | \*/ |
| [2073](#L2073) |  |
| [2074](#L2074) | $types = accua\_forms\_fields\_get\_types(); |
| [2075](#L2075) | ?> |
| [2076](#L2076) | <div class="form-wrap"> |
| [2077](#L2077) | <h3><?php echo $adding? \_\_( 'Add new field','contact-forms'): \_\_( 'Edit field','contact-forms') ; ?></h3> |
| [2078](#L2078) | <form id="addtag" method="post" action="admin.php?page=accua\_forms\_fields" class="validate"> |
| [2079](#L2079) | <input type="hidden" name="action" value="<?php echo $adding?'add':'edit'; ?>-form-field" /> |
| [2080](#L2080) | <?php /\* |
| [2081](#L2081) | <input type="hidden" name="screen" value="<?php echo esc\_attr($current\_screen->id); ?>" /> |
| [2082](#L2082) | <input type="hidden" name="taxonomy" value="<?php echo esc\_attr($taxonomy); ?>" /> |
| [2083](#L2083) | <input type="hidden" name="post\_type" value="<?php echo esc\_attr($post\_type); ?>" /> |
| [2084](#L2084) | \*/ ?> |
| [2085](#L2085) | <?php wp\_nonce\_field('edit\_form\_field', '\_wpnonce\_edit\_form\_field'); ?> |
| [2086](#L2086) |  |
| [2087](#L2087) | <div class="form-field form-required"> |
| [2088](#L2088) | <label for="tag-name"><?php \_e( 'Field label', 'contact-forms'); ?></label> |
| [2089](#L2089) | <input name="form-field-name" id="tag-name" type="text" value="<?php echo htmlspecialchars($default\_form\_values['name'], ENT\_QUOTES) ?>" size="40" aria-required="true" /> |
| [2090](#L2090) | <p><?php \_e('The name is how it appears on your site.', 'contact-forms'); ?></p> |
| [2091](#L2091) | </div> |
| [2092](#L2092) | <?php /\* if ( ! global\_terms\_enabled() ) : \*/ ?> |
| [2093](#L2093) | <div class="form-field"> |
| [2094](#L2094) | <label for="tag-slug"><?php \_e( 'Field slug (identificative)', 'contact-forms'); ?></label> |
| [2095](#L2095) | <input name="form-field-id" id="tag-slug" type="text" value="<?php echo htmlspecialchars($default\_form\_values['id'], ENT\_QUOTES) ?>" <?php if (!$adding) { echo 'disabled="disabled"'; } ?> size="40" /> |
| [2096](#L2096) | <?php if (!$adding) { echo '<input type="hidden" name="form-field-id" value="'.htmlspecialchars($default\_form\_values['id'], ENT\_QUOTES).'" />'; } ?> |
| [2097](#L2097) | <p><?php \_e('The &#8220;slug&#8221; is the URL-friendly version of the name. It is used as an identificator, and is unchangeable. It is usually all lowercase and it must contains only letters, numbers, and underscores.', 'contact-forms'); ?></p> |
| [2098](#L2098) | </div> |
| [2099](#L2099) | <div class="form-field"> |
| [2100](#L2100) | <label for="parent"><?php \_e( 'Field type', 'contact-forms'); ?></label> |
| [2101](#L2101) | <select class="postform" id="parent" name="form-field-type"> |
| [2102](#L2102) | <?php /\* |
| [2103](#L2103) | <option value="textfield" class="level-0" <?php echo ($default\_form\_values['type'] == 'textfield')?'selected="selected"':'';?> >Text Field</option> |
| [2104](#L2104) | <option value="textarea" class="level-0" <?php echo ($default\_form\_values['type'] == 'textarea')?'selected="selected"':'';?> >Text Area</option> |
| [2105](#L2105) | <option value="email" class="level-0" <?php echo ($default\_form\_values['type'] == 'email')?'selected="selected"':'';?> >Email</option> |
| [2106](#L2106) | <option value="checkbox" class="level-0" <?php echo ($default\_form\_values['type'] == 'checkbox')?'selected="selected"':'';?> >Checkbox</option> |
| [2107](#L2107) | <option value="select" class="level-0" <?php echo ($default\_form\_values['type'] == 'select')?'selected="selected"':'';?> >Select</option> |
| [2108](#L2108) | \*/ |
| [2109](#L2109) | foreach ($types as $typeid => $typename) { |
| [2110](#L2110) | $selected = ($default\_form\_values['type'] == $typeid)?'selected="selected"':''; |
| [2111](#L2111) | echo <<<EOT |
| [2112](#L2112) | <option value="{$typeid}" class="level-0" {$selected} >{$typename}</option> |
| [2113](#L2113) | EOT; |
| [2114](#L2114) | } |
| [2115](#L2115) |  |
| [2116](#L2116) | ?> |
| [2117](#L2117) | </select> |
| [2118](#L2118) | </div> |
| [2119](#L2119) | <?php /\* endif; // global\_terms\_enabled() \*/ ?> |
| [2120](#L2120) | <?php /\* if ( is\_taxonomy\_hierarchical($taxonomy) ) : ?> |
| [2121](#L2121) | <div class="form-field"> |
| [2122](#L2122) | <label for="parent"><?php \_ex('Parent', 'Taxonomy Parent'); ?></label> |
| [2123](#L2123) | <?php wp\_dropdown\_categories(array('hide\_empty' => 0, 'hide\_if\_empty' => false, 'taxonomy' => $taxonomy, 'name' => 'parent', 'orderby' => 'name', 'hierarchical' => true, 'show\_option\_none' => \_\_('None'))); ?> |
| [2124](#L2124) | <?php if ( 'category' == $taxonomy ) : // @todo: Generic text for hierarchical taxonomies ?> |
| [2125](#L2125) | <p><?php \_e('Categories, unlike tags, can have a hierarchy. You might have a Jazz category, and under that have children categories for Bebop and Big Band. Totally optional.'); ?></p> |
| [2126](#L2126) | <?php endif; ?> |
| [2127](#L2127) | </div> |
| [2128](#L2128) | <?php endif; // is\_taxonomy\_hierarchical() \*/ ?> |
| [2129](#L2129) | <div class="form-field"> |
| [2130](#L2130) | <label for="tag-description"><?php \_e( 'Field description', 'contact-forms'); ?></label> |
| [2131](#L2131) | <textarea name="form-field-description" id="tag-description" rows="5" cols="40"><?php echo htmlspecialchars($default\_form\_values['description'], ENT\_QUOTES) ?></textarea> |
| [2132](#L2132) | <p><?php \_e('The description is not prominent by default; however, some themes may show it.', 'contact-forms'); ?></p> |
| [2133](#L2133) | </div> |
| [2134](#L2134) |  |
| [2135](#L2135) | <div class="form-field"> |
| [2136](#L2136) | <label for="form-field-default-value"><?php \_e( 'Default value(s)', 'contact-forms'); ?>:</label> |
| [2137](#L2137) | <textarea name="form-field-default-value" id="form-field-default-value" rows="5" cols="40"><?php echo htmlspecialchars($default\_form\_values['default\_value'], ENT\_QUOTES) ?></textarea> |
| [2138](#L2138) | <p><?php \_e( 'For multiple default values in multiple select and multiple checkboxes, use | as separator.', 'contact-forms'); ?></p> |
| [2139](#L2139) | </div> |
| [2140](#L2140) |  |
| [2141](#L2141) | <div class="form-field"> |
| [2142](#L2142) | <label for="form-field-allowed-values"><?php \_e( 'Allowed values', 'contact-forms'); ?>:</label> |
| [2143](#L2143) | <textarea rows="5" cols="40" name="form-field-allowed-values" id=form-field-allowed-values"><?php echo htmlspecialchars($default\_form\_values['allowed\_values'], ENT\_QUOTES) ?></textarea> |
| [2144](#L2144) | <p><?php \_e( 'Options used in select, radio and multiple checkboxes. Enter one value per line, in the format key|label. The key is the value that will be stored in the database. The label is optional, and the key will be used as the label if no label is specified. For file fields, this indicates allowed extensions (one per line without dot)', 'contact-forms'); ?></p> |
| [2145](#L2145) | </div> |
| [2146](#L2146) |  |
| [2147](#L2147) | <div class="form-field"> |
| [2148](#L2148) | <?php \_e( 'Settings for date fields', 'contact-forms'); ?> |
| [2149](#L2149) | <div class="form-field"> |
| [2150](#L2150) | <label for="form-field-default-date-value"><?php \_e( 'Default value', 'contact-forms'); ?>:</label> |
| [2151](#L2151) | <input type="date" name="form-field-default-date-value" id="form-field-default-date-value" value="<?php echo htmlspecialchars($default\_form\_values['default\_date\_value'], ENT\_QUOTES) ?>"> |
| [2152](#L2152) | </div> |
| [2153](#L2153) |  |
| [2154](#L2154) |  |
| [2155](#L2155) | <label for="form-field-min-of-date"><?php \_e( 'Min date', 'contact-forms'); ?>:</label> |
| [2156](#L2156) | <input type="date" id="form-field-min-of-date" name="form-field-min-of-date" value="<?php echo htmlspecialchars($default\_form\_values['min\_date'], ENT\_QUOTES) ?>"> |
| [2157](#L2157) |  |
| [2158](#L2158) | <label for="form-field-max-of-date"><?php \_e( 'Max date', 'contact-forms'); ?>:</label> |
| [2159](#L2159) | <input type="date" id="form-field-max-of-date" name="form-field-max-of-date" value="<?php echo htmlspecialchars($default\_form\_values['max\_date'], ENT\_QUOTES) ?>"> |
| [2160](#L2160) |  |
| [2161](#L2161) | </div> |
| [2162](#L2162) |  |
| [2163](#L2163) |  |
| [2164](#L2164) | <?php |
| [2165](#L2165) | /\* |
| [2166](#L2166) | if ( ! is\_taxonomy\_hierarchical($taxonomy) ) |
| [2167](#L2167) | do\_action('add\_tag\_form\_fields', $taxonomy); |
| [2168](#L2168) | do\_action($taxonomy . '\_add\_form\_fields', $taxonomy); |
| [2169](#L2169) | \*/ |
| [2170](#L2170) |  |
| [2171](#L2171) | if ($adding) { |
| [2172](#L2172) | submit\_button( \_\_( 'Add new field', 'contact-forms'), 'button' ); |
| [2173](#L2173) | } else { |
| [2174](#L2174) | submit\_button( \_\_( 'Save changes', 'contact-forms'), 'button' ); |
| [2175](#L2175) | submit\_button( \_\_( 'Delete field', 'contact-forms'), 'button', 'delete-field'); |
| [2176](#L2176) | } |
| [2177](#L2177) |  |
| [2178](#L2178) | /\* |
| [2179](#L2179) | // Back compat hooks. Deprecated in preference to {$taxonomy}\_add\_form |
| [2180](#L2180) | if ( 'category' == $taxonomy ) |
| [2181](#L2181) | do\_action('edit\_category\_form', (object)array('parent' => 0) ); |
| [2182](#L2182) | elseif ( 'link\_category' == $taxonomy ) |
| [2183](#L2183) | do\_action('edit\_link\_category\_form', (object)array('parent' => 0) ); |
| [2184](#L2184) | else |
| [2185](#L2185) | do\_action('add\_tag\_form', $taxonomy); |
| [2186](#L2186) |  |
| [2187](#L2187) | do\_action($taxonomy . '\_add\_form', $taxonomy); |
| [2188](#L2188) | \*/ |
| [2189](#L2189) | ?> |
| [2190](#L2190) | </form></div> |
| [2191](#L2191) | <?php /\* } \*/ ?> |
| [2192](#L2192) |  |
| [2193](#L2193) | </div> |
| [2194](#L2194) | </div><!-- /col-left --> |
| [2195](#L2195) |  |
| [2196](#L2196) | </div><!-- /col-container --> |
| [2197](#L2197) | </div><!-- /wrap --> |
| [2198](#L2198) | <?php |
| [2199](#L2199) | /\* echo '<pre>accua\_forms\_avail\_fields:', htmlspecialchars(print\_r($avail\_fields, true)), '</pre>'; \*/ |
| [2200](#L2200) | } |
| [2201](#L2201) |  |
| [2202](#L2202) | function accua\_forms\_settings\_page() { |
| [2203](#L2203) | ?> |
| [2204](#L2204) | <div id="accua\_forms\_settings\_page" class="accua\_forms\_admin\_page wrap"> |
| [2205](#L2205) | <h2><img src="<?php echo ACCUA\_FORMS\_DIR\_URL.'img/cimatti-icon-20.png'; ?>"/> <?php \_e('Contact Forms - Default Settings', 'contact-forms'); ?></h2> |
| [2206](#L2206) | <?php |
| [2207](#L2207) | $empty\_form\_data = array( |
| [2208](#L2208) | 'success\_message' => '', |
| [2209](#L2209) | 'error\_message' => '', |
| [2210](#L2210) | 'emails\_from\_name' => '', |
| [2211](#L2211) | 'emails\_from' => '', |
| [2212](#L2212) | 'admin\_emails\_to' => '', |
| [2213](#L2213) | 'emails\_bcc' => '', |
| [2214](#L2214) | 'admin\_emails\_subject' => '', |
| [2215](#L2215) | 'admin\_emails\_message' => '', |
| [2216](#L2216) | 'confirmation\_emails\_subject' => '', |
| [2217](#L2217) | 'confirmation\_emails\_message' => '', |
| [2218](#L2218) | 'layout' => 'sidebyside', |
| [2219](#L2219) | 'style\_margin' => '', |
| [2220](#L2220) | 'style\_border\_color' => '', |
| [2221](#L2221) | 'style\_border\_width' => '', |
| [2222](#L2222) | 'style\_border\_radius' => '', |
| [2223](#L2223) | 'style\_background\_color' => '', |
| [2224](#L2224) | 'style\_padding' => '', |
| [2225](#L2225) | 'style\_color' => '', |
| [2226](#L2226) | 'style\_font\_size' => '', |
| [2227](#L2227) | 'style\_field\_spacing' => '', |
| [2228](#L2228) | 'style\_field\_border\_color' => '', |
| [2229](#L2229) | 'style\_field\_border\_width' => '', |
| [2230](#L2230) | 'style\_field\_border\_radius' => '', |
| [2231](#L2231) | 'style\_field\_background\_color' => '', |
| [2232](#L2232) | 'style\_field\_padding' => '', |
| [2233](#L2233) | 'style\_field\_color' => '', |
| [2234](#L2234) | 'style\_submit\_border\_color' => '', |
| [2235](#L2235) | 'style\_submit\_border\_width' => '', |
| [2236](#L2236) | 'style\_submit\_border\_radius' => '', |
| [2237](#L2237) | 'style\_submit\_background\_color' => '', |
| [2238](#L2238) | 'style\_submit\_padding' => '', |
| [2239](#L2239) | 'style\_submit\_color' => '', |
| [2240](#L2240) | 'style\_submit\_font\_size' => '', |
| [2241](#L2241) | ); |
| [2242](#L2242) |  |
| [2243](#L2243) | $empty\_file\_data = array( |
| [2244](#L2244) | 'valid\_extensions' => '', |
| [2245](#L2245) | 'max\_size' => '', |
| [2246](#L2246) | 'dest\_path' => '', |
| [2247](#L2247) | ); |
| [2248](#L2248) |  |
| [2249](#L2249) | $empty\_captcha\_data = array( |
| [2250](#L2250) | 'recaptcha\_force\_v1' => '', |
| [2251](#L2251) | 'recaptcha\_public\_key' => '', |
| [2252](#L2252) | 'recaptcha\_private\_key' => '', |
| [2253](#L2253) | ); |
| [2254](#L2254) |  |
| [2255](#L2255) | $empty\_analytics\_data = array( |
| [2256](#L2256) | 'analytics\_track\_submit' => false, |
| [2257](#L2257) | 'analytics\_track\_fields' => false, |
| [2258](#L2258) | ); |
| [2259](#L2259) |  |
| [2260](#L2260) | $empty\_anonymize\_ip\_data = array( |
| [2261](#L2261) | 'anonymize\_ip\_bytes' => 0, |
| [2262](#L2262) | ); |
| [2263](#L2263) |  |
| [2264](#L2264) | if($\_SERVER['REQUEST\_METHOD'] == 'POST' && !empty($\_POST['accua\_form\_save\_form\_settings'])) { |
| [2265](#L2265) | check\_admin\_referer('accua\_form\_save\_settings', '\_nonce\_accua\_form\_save\_settings'); |
| [2266](#L2266) | $post = stripslashes\_deep($\_POST); |
| [2267](#L2267) | $post += $empty\_form\_data; |
| [2268](#L2268) | $post += $empty\_file\_data; |
| [2269](#L2269) | $post += $empty\_captcha\_data; |
| [2270](#L2270) | $post += $empty\_analytics\_data; |
| [2271](#L2271) | $post += $empty\_anonymize\_ip\_data; |
| [2272](#L2272) | $form\_data = array(); |
| [2273](#L2273) | $file\_data = array(); |
| [2274](#L2274) | $captcha\_data = array(); |
| [2275](#L2275) | $analytics\_data = array(); |
| [2276](#L2276) | $anonymize\_ip\_data = array(); |
| [2277](#L2277) | foreach($empty\_form\_data as $key=>$val){ |
| [2278](#L2278) | $form\_data[$key] = $post[$key]; |
| [2279](#L2279) | } |
| [2280](#L2280) | $form\_data = accua\_forms\_filter\_settings($form\_data); |
| [2281](#L2281) |  |
| [2282](#L2282) | $file\_data['valid\_extensions'] = accua\_forms\_filter\_extensions($post['valid\_extensions']); |
| [2283](#L2283) | $file\_data['max\_size'] = $post['max\_size']; |
| [2284](#L2284) | if (current\_user\_can('edit\_files') || current\_user\_can('install\_plugins')) { |
| [2285](#L2285) | $file\_data['dest\_path'] = $post['dest\_path']; |
| [2286](#L2286) | } else { |
| [2287](#L2287) | $old\_file\_data = get\_option('accua\_forms\_default\_file\_field\_data',array()); |
| [2288](#L2288) | $file\_data['dest\_path'] = isset($old\_file\_data['dest\_path']) ? $old\_file\_data['dest\_path'] : ''; |
| [2289](#L2289) | } |
| [2290](#L2290) |  |
| [2291](#L2291) | $captcha\_data['recaptcha\_force\_v1'] = (bool) $post['recaptcha\_force\_v1']; |
| [2292](#L2292) | $captcha\_data['recaptcha\_public\_key'] = sanitize\_text\_field($post['recaptcha\_public\_key']); |
| [2293](#L2293) | $captcha\_data['recaptcha\_private\_key'] = sanitize\_text\_field($post['recaptcha\_private\_key']); |
| [2294](#L2294) |  |
| [2295](#L2295) | foreach($empty\_analytics\_data as $key=>$val){ |
| [2296](#L2296) | $analytics\_data[$key] = (bool) $post[$key]; |
| [2297](#L2297) | } |
| [2298](#L2298) |  |
| [2299](#L2299) | /\* foreach($empty\_anonymize\_ip\_data as $key=>$val){ |
| [2300](#L2300) | $anonymize\_ip\_data[$key] = $post[$key]; |
| [2301](#L2301) | } \*/ |
| [2302](#L2302) | $anonymize\_ip\_bytes = (int) $post['anonymize\_ip\_bytes']; |
| [2303](#L2303) | if ($anonymize\_ip\_bytes < 0) { |
| [2304](#L2304) | $anonymize\_ip\_bytes = 0; |
| [2305](#L2305) | } else if ($anonymize\_ip\_bytes > 4) { |
| [2306](#L2306) | $anonymize\_ip\_bytes = 4; |
| [2307](#L2307) | } |
| [2308](#L2308) | $anonymize\_ip\_data['anonymize\_ip\_bytes'] = $anonymize\_ip\_bytes; |
| [2309](#L2309) |  |
| [2310](#L2310) | update\_option('accua\_forms\_default\_form\_data', $form\_data); |
| [2311](#L2311) | update\_option('accua\_forms\_default\_file\_field\_data', $file\_data); |
| [2312](#L2312) | update\_option('accua\_forms\_default\_captcha\_field\_data', $captcha\_data); |
| [2313](#L2313) | update\_option('accua\_forms\_default\_analytics\_data', $analytics\_data); |
| [2314](#L2314) | update\_option('accua\_forms\_anonymize\_ip\_data', $anonymize\_ip\_data); |
| [2315](#L2315) |  |
| [2316](#L2316) | if (!empty($post['delete\_previous\_ip\_values'])) { |
| [2317](#L2317) | global $wpdb; |
| [2318](#L2318) | $wpdb->query("UPDATE `{$wpdb->prefix}accua\_forms\_submissions` SET afs\_ip = ''"); |
| [2319](#L2319) | } |
| [2320](#L2320) | } else { |
| [2321](#L2321) | $form\_data = get\_option('accua\_forms\_default\_form\_data',array()) + $empty\_form\_data; |
| [2322](#L2322) | $file\_data = get\_option('accua\_forms\_default\_file\_field\_data',array()) + $empty\_file\_data; |
| [2323](#L2323) | $captcha\_data = get\_option('accua\_forms\_default\_captcha\_field\_data',array()) + $empty\_captcha\_data; |
| [2324](#L2324) | $analytics\_data = get\_option('accua\_forms\_default\_analytics\_data',array()) + $empty\_analytics\_data; |
| [2325](#L2325) | $anonymize\_ip\_data = get\_option('accua\_forms\_anonymize\_ip\_data',array()) + $empty\_anonymize\_ip\_data; |
| [2326](#L2326) | } |
| [2327](#L2327) | if ($captcha\_data['recaptcha\_force\_v1']) { |
| [2328](#L2328) | $captcha\_data = $empty\_captcha\_data; |
| [2329](#L2329) | } |
| [2330](#L2330) | ?> |
| [2331](#L2331) | <form method="post"> |
| [2332](#L2332) | <?php wp\_nonce\_field('accua\_form\_save\_settings', '\_nonce\_accua\_form\_save\_settings'); ?> |
| [2333](#L2333) | <input type="hidden" name="accua\_form\_save\_form\_settings" value="1" /> |
| [2334](#L2334) | <?php /\* |
| [2335](#L2335) | <p id="accua\_form\_layout"><?php \_e( 'Layout', 'contact-forms'); ?>: <select name="layout" class="accua\_form\_value"><option value="sidebyside" <?php if ($form\_data['layout'] == 'sidebyside') { echo 'selected="selected"'; } ?>>Labels on the left of the fields</option><option value="toplabel" <?php if ($form\_data['layout'] == 'toplabel') { echo 'selected="selected"'; } ?>>Labels on top of the fields</option></select></p> |
| [2336](#L2336) | <p id="accua\_form\_success\_message"><?php \_e( 'Success message', 'contact-forms'); ?>:<br /><textarea name="success\_message" class="accua\_form\_value" style="width:95%"; cols="80" rows="8"><?php echo htmlspecialchars($form\_data['success\_message'], ENT\_QUOTES) ?></textarea></p> |
| [2337](#L2337) | <p id="accua\_form\_error\_message"><?php \_e( 'Error message', 'contact-forms'); ?>:<br /><textarea name="error\_message" class="accua\_form\_value" style="width:95%"; cols="80" rows="8"><?php echo htmlspecialchars($form\_data['error\_message'], ENT\_QUOTES) ?></textarea></p> |
| [2338](#L2338) | <p id="accua\_form\_emails\_from"><?php \_e( 'Emails from', 'contact-forms'); ?>: <input name="emails\_from" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['emails\_from'], ENT\_QUOTES) ?>" /></p> |
| [2339](#L2339) | <p id="accua\_form\_admin\_emails\_to"><?php \_e( 'Admin emails to', 'contact-forms'); ?>: <input name="admin\_emails\_to" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['admin\_emails\_to'], ENT\_QUOTES) ?>" /></p> |
| [2340](#L2340) | <p id="accua\_form\_emails\_bcc"><?php \_e( 'Emails bcc', 'contact-forms'); ?>: <input name="emails\_bcc" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['emails\_bcc'], ENT\_QUOTES) ?>" /></p> |
| [2341](#L2341) | <p id="accua\_form\_admin\_emails\_subject"><?php \_e( 'Admin email subject', 'contact-forms'); ?>: <input name="admin\_emails\_subject" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['admin\_emails\_subject'], ENT\_QUOTES) ?>" /></p> |
| [2342](#L2342) | <p id="accua\_form\_admin\_emails\_message"><?php \_e( 'Admin email message', 'contact-forms'); ?>:<br /><textarea name="admin\_emails\_message" class="accua\_form\_value" style="width:95%"; cols="80" rows="8"><?php echo htmlspecialchars($form\_data['admin\_emails\_message'], ENT\_QUOTES) ?></textarea></p> |
| [2343](#L2343) | <p id="accua\_form\_confirmation\_emails\_subject"><?php \_e( 'Confirmation email subject', 'contact-forms'); ?>: <input name="confirmation\_emails\_subject" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['confirmation\_emails\_subject'], ENT\_QUOTES) ?>" /></p> |
| [2344](#L2344) | <p id="accua\_form\_confirmation\_emails\_message"><?php \_e( 'Confirmation email message', 'contact-forms'); ?>:<br /><textarea name="confirmation\_emails\_message" class="accua\_form\_value" style="width:95%"; cols="80" rows="8"><?php echo htmlspecialchars($form\_data['confirmation\_emails\_message'], ENT\_QUOTES) ?></textarea></p> |
| [2345](#L2345) | \*/ ?> |
| [2346](#L2346) | <div id="accua\_tab\_messages" class="content\_tab"> |
| [2347](#L2347) | <?php |
| [2348](#L2348) | $settings\_editor = array( |
| [2349](#L2349) | 'teeny' => true, |
| [2350](#L2350) | 'editor\_class' => 'accua\_form\_value', |
| [2351](#L2351) | 'tinymce' => array( |
| [2352](#L2352) | 'theme\_advanced\_buttons1' => 'bold,italic,underline,|,bullist,numlist,')); |
| [2353](#L2353) | ?> |
| [2354](#L2354) | <div class="metabox-holder accua-forms-metabox-holder"> |
| [2355](#L2355) | <div class="postbox "> |
| [2356](#L2356) | <h3 class="hndle"><span><?php \_e('1. On-screen success message', 'contact-forms'); ?></span></h3> |
| [2357](#L2357) | <div class="inside" id="dashboard\_right\_now"> |
| [2358](#L2358) | <div id="accua\_form\_success\_message"> |
| [2359](#L2359) | <?php  wp\_editor( $form\_data['success\_message'] , 'success\_message' , $settings\_editor);   ?> |
| [2360](#L2360) | </div> |
| [2361](#L2361) | </div> |
| [2362](#L2362) | </div> |
| [2363](#L2363) | </div> |
| [2364](#L2364) |  |
| [2365](#L2365) | <div class="metabox-holder accua-forms-metabox-holder"> |
| [2366](#L2366) | <div class="postbox "> |
| [2367](#L2367) | <h3 class="hndle"><span><?php \_e('2. On-screen error message', 'contact-forms'); ?></span></h3> |
| [2368](#L2368) | <div class="inside" id="dashboard\_right\_now"> |
| [2369](#L2369) | <div id="accua\_form\_error\_message"> |
| [2370](#L2370) | <?php  wp\_editor( $form\_data['error\_message'] , 'error\_message' , $settings\_editor); ?> |
| [2371](#L2371) | </div> |
| [2372](#L2372) | </div> |
| [2373](#L2373) | </div> |
| [2374](#L2374) | </div> |
| [2375](#L2375) | <br clear="all"/> |
| [2376](#L2376) | <div class="metabox-holder accua-forms-metabox-holder"> |
| [2377](#L2377) | <div class="postbox "> |
| [2378](#L2378) | <h3 class="hndle"><span><?php \_e('3. Email  to notify administrator', 'contact-forms'); ?></span></h3> |
| [2379](#L2379) | <div class="inside" id="dashboard\_right\_now"> |
| [2380](#L2380) | <div id="accua\_form\_admin\_emails\_to" class="label\_input"> |
| [2381](#L2381) | <label><?php \_e( 'To', 'contact-forms'); ?></label> |
| [2382](#L2382) | <input name="admin\_emails\_to" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['admin\_emails\_to'], ENT\_QUOTES) ?>" /> |
| [2383](#L2383) | </div> |
| [2384](#L2384) | <br clear="all" /> |
| [2385](#L2385) | <div id="accua\_form\_emails\_bcc" class="label\_input"> |
| [2386](#L2386) | <label><?php \_e( 'Bcc', 'contact-forms'); ?></label> |
| [2387](#L2387) | <input name="emails\_bcc" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['emails\_bcc'], ENT\_QUOTES) ?>" /> |
| [2388](#L2388) | </div> |
| [2389](#L2389) | <br clear="all" /> |
| [2390](#L2390) | <div id="accua\_form\_admin\_emails\_subject" class="label\_input"> |
| [2391](#L2391) | <label><?php \_e( 'Subject', 'contact-forms'); ?></label> |
| [2392](#L2392) | <input name="admin\_emails\_subject" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['admin\_emails\_subject'], ENT\_QUOTES) ?>" /> |
| [2393](#L2393) | </div> |
| [2394](#L2394) | <br clear="all" /> |
| [2395](#L2395) | <div id="accua\_form\_admin\_emails\_message"> |
| [2396](#L2396) | <?php  wp\_editor( $form\_data['admin\_emails\_message'] , 'admin\_emails\_message' , $settings\_editor);   ?> |
| [2397](#L2397) | </div> |
| [2398](#L2398) |  |
| [2399](#L2399) | </div> |
| [2400](#L2400) | </div> |
| [2401](#L2401) | </div> |
| [2402](#L2402) |  |
| [2403](#L2403) | <div class="metabox-holder accua-forms-metabox-holder"> |
| [2404](#L2404) | <div class="postbox "> |
| [2405](#L2405) | <h3 class="hndle"><span><?php \_e('4. Email confirmation to the person who completed the form', 'contact-forms'); ?></span></h3> |
| [2406](#L2406) | <div class="inside" id="dashboard\_right\_now"> |
| [2407](#L2407) | <div id="accua\_form\_emails\_from\_name" class="label\_input"> |
| [2408](#L2408) | <label><?php \_e( 'From name', 'contact-forms'); ?></label> |
| [2409](#L2409) | <input class="accua\_form\_value" name="emails\_from\_name" type="text" value="<?php echo htmlspecialchars($form\_data['emails\_from\_name'], ENT\_QUOTES) ?>" /> |
| [2410](#L2410) | </div> |
| [2411](#L2411) | <div id="accua\_form\_emails\_from" class="label\_input"> |
| [2412](#L2412) | <label><?php \_e( 'From email', 'contact-forms'); ?></label> |
| [2413](#L2413) | <input class="accua\_form\_value" name="emails\_from" type="text" value="<?php echo htmlspecialchars($form\_data['emails\_from'], ENT\_QUOTES) ?>" /> |
| [2414](#L2414) | </div> |
| [2415](#L2415) | <br clear="all" /> |
| [2416](#L2416) | <div id="accua\_form\_confirmation\_emails\_subject" class="label\_input"> |
| [2417](#L2417) | <label><?php \_e( 'Subject', 'contact-forms'); ?></label> |
| [2418](#L2418) | <input class="accua\_form\_value" type="text" name="confirmation\_emails\_subject" value="<?php echo htmlspecialchars($form\_data['confirmation\_emails\_subject'], ENT\_QUOTES) ?>" /> |
| [2419](#L2419) | </div> |
| [2420](#L2420) | <br clear="all" /> |
| [2421](#L2421) | <div id="accua\_form\_confirmation\_emails\_message"> |
| [2422](#L2422) | <?php  wp\_editor( $form\_data['confirmation\_emails\_message'] , 'confirmation\_emails\_message' , $settings\_editor);   ?> |
| [2423](#L2423) | </div> |
| [2424](#L2424) | </div> |
| [2425](#L2425) | </div> |
| [2426](#L2426) | </div> |
| [2427](#L2427) | <br clear="all"/> |
| [2428](#L2428) |  |
| [2429](#L2429) | <div class="metabox-holder accua-forms-metabox-holder"> |
| [2430](#L2430) | <div class="postbox "> |
| [2431](#L2431) | <h3 class="hndle"><span><?php \_e( 'File upload default settings', 'contact-forms'); ?></span></h3> |
| [2432](#L2432) | <div class="inside" id="dashboard\_right\_now"> |
| [2433](#L2433) | <div id="accua\_form\_valid\_extensions"><?php \_e( 'Valid extensions', 'contact-forms'); ?> <br /><textarea name="valid\_extensions" class="accua\_form\_value" style="width:95%"; cols="80" rows="8"><?php echo htmlspecialchars($file\_data['valid\_extensions'], ENT\_QUOTES) ?></textarea> |
| [2434](#L2434) | <small><?php \_e( 'List of valid extensions, without dot, one per line.', 'contact-forms'); ?></small> |
| [2435](#L2435) | </div> |
| [2436](#L2436) | <div id="accua\_form\_max\_size"><?php \_e( 'Maximum file size:', 'contact-forms'); ?> <input name="max\_size" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($file\_data['max\_size'], ENT\_QUOTES) ?>" /><br /> |
| [2437](#L2437) | <small><?php \_e( 'You can use suffix K, M or G for kilobyte, megabyte or gigabyte.', 'contact-forms'); ?> |
| [2438](#L2438) | <?php |
| [2439](#L2439) | $server\_max\_size = AccuaForm\_Element\_File::file\_upload\_max\_size(); |
| [2440](#L2440) | if ($server\_max\_size > 0) { |
| [2441](#L2441) | \_e( 'This value is limited by server upload limits of ', 'contact-forms'); |
| [2442](#L2442) | echo  AccuaForm\_Element\_File::format\_size($server\_max\_size).". "; |
| [2443](#L2443) | \_e( 'If you need a greater limit you should ask to the server administrator.', 'contact-forms'); |
| [2444](#L2444) | } |
| [2445](#L2445) | ?> |
| [2446](#L2446) | </small> |
| [2447](#L2447) | </div> |
| [2448](#L2448) | <?php if (current\_user\_can('edit\_files') || current\_user\_can('install\_plugins')) { ?> |
| [2449](#L2449) | <div id="accua\_form\_dest\_path"><?php \_e( 'Upload path', 'contact-forms');?> : <input name="dest\_path" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($file\_data['dest\_path'], ENT\_QUOTES) ?>" /> |
| [2450](#L2450) | <small><?php \_e( 'If it stars with \'/\' an absolute path is used, otherwise a path relative to the WordPress installation directory. Default value is "wp-content/uploads/accua-forms"', 'contact-forms');?>.</small> |
| [2451](#L2451) | </div> |
| [2452](#L2452) | <?php } ?> |
| [2453](#L2453) | </div> |
| [2454](#L2454) | </div> |
| [2455](#L2455) |  |
| [2456](#L2456) | <div class="postbox "> |
| [2457](#L2457) | <h3 class="hndle"><span><?php \_e( 'reCaptcha settings', 'contact-forms'); ?></span></h3> |
| [2458](#L2458) | <div class="inside" id="dashboard\_right\_now"> |
| [2459](#L2459) | <p><?php \_e( 'As reCAPTCHA v1 is discontinued, only reCAPTCHA v2 is supported', 'contact-forms');?></p> |
| [2460](#L2460) | <p><?php echo strtr(\_\_('Please register this site for reCAPTCHA v2 on %REGISTERURL%, then  enter the keys for this site in the following fields', 'contact-forms'), array('%REGISTERURL%' => '<a href="https://www.google.com/recaptcha" target="\_blank">google.com/recaptcha</a>'));?></p> |
| [2461](#L2461) | <div id="accua\_form\_recaptcha\_public\_key"><?php \_e('Site key', 'contact-forms');?> : <input name="recaptcha\_public\_key" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($captcha\_data['recaptcha\_public\_key'], ENT\_QUOTES) ?>" /> |
| [2462](#L2462) | </div> |
| [2463](#L2463) | <div id="accua\_form\_recaptcha\_private\_key"><?php \_e('Secret key', 'contact-forms');?> : <input name="recaptcha\_private\_key" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($captcha\_data['recaptcha\_private\_key'], ENT\_QUOTES) ?>" /> |
| [2464](#L2464) | </div> |
| [2465](#L2465) | </div> |
| [2466](#L2466) | </div> |
| [2467](#L2467) |  |
| [2468](#L2468) | <div class="postbox "> |
| [2469](#L2469) | <h3 class="hndle"><span><?php \_e( 'IP address tracking', 'contact-forms'); ?></span></h3> |
| [2470](#L2470) | <div class="inside" id="dashboard\_accua\_form\_anonymize\_ip\_addresses"> |
| [2471](#L2471) | <p> |
| [2472](#L2472) | <?php \_e("Select how many bytes of the visitor's IPs should be masked.", 'contact-forms');?> |
| [2473](#L2473) | </p> |
| [2474](#L2474) | <p> |
| [2475](#L2475) | <input type="radio" name="anonymize\_ip\_bytes" id="anonymize\_ip\_bytes\_0" value="0" <?php if($anonymize\_ip\_data['anonymize\_ip\_bytes'] == 0) { echo 'checked="checked"'; } ?> /> |
| [2476](#L2476) | <label for="anonymize\_ip\_bytes\_0"><?php \_e('No mask - e.g. 192.168.1.1', 'contact-forms');?></label><br /> |
| [2477](#L2477) | </p> |
| [2478](#L2478) | <p> |
| [2479](#L2479) | <input type="radio" name="anonymize\_ip\_bytes" id="anonymize\_ip\_bytes\_1" value="1" <?php if($anonymize\_ip\_data['anonymize\_ip\_bytes'] == 1) { echo 'checked="checked"'; } ?> /> |
| [2480](#L2480) | <label for="anonymize\_ip\_bytes\_1"><?php \_e('1 byte - e.g. 192.168.1.xxx', 'contact-forms');?></label><br /> |
| [2481](#L2481) | </p> |
| [2482](#L2482) | <p> |
| [2483](#L2483) | <input type="radio" name="anonymize\_ip\_bytes" id="anonymize\_ip\_bytes\_2" value="2" <?php if($anonymize\_ip\_data['anonymize\_ip\_bytes'] == 2) { echo 'checked="checked"'; } ?> /> |
| [2484](#L2484) | <label for="anonymize\_ip\_bytes\_2"><?php \_e('2 byte - e.g. 192.168.xxx.xxx', 'contact-forms');?></label><br /> |
| [2485](#L2485) | </p> |
| [2486](#L2486) | <p> |
| [2487](#L2487) | <input type="radio" name="anonymize\_ip\_bytes" id="anonymize\_ip\_bytes\_3" value="3" <?php if($anonymize\_ip\_data['anonymize\_ip\_bytes'] == 3) { echo 'checked="checked"'; } ?> /> |
| [2488](#L2488) | <label for="anonymize\_ip\_bytes\_3"><?php \_e('3 byte - e.g. 192.xxx.xxx.xxx', 'contact-forms');?></label><br /> |
| [2489](#L2489) | </p> |
| [2490](#L2490) | <p> |
| [2491](#L2491) | <input type="radio" name="anonymize\_ip\_bytes" id="anonymize\_ip\_bytes\_4" value="4" <?php if($anonymize\_ip\_data['anonymize\_ip\_bytes'] == 4) { echo 'checked="checked"'; } ?> /> |
| [2492](#L2492) | <label for="anonymize\_ip\_bytes\_4"><?php \_e('Fully mask IP address', 'contact-forms');?></label><br /> |
| [2493](#L2493) | </p> |
| [2494](#L2494) | <h4><?php \_e( 'Delete IP addresses', 'contact-forms'); ?></h4> |
| [2495](#L2495) | <p> |
| [2496](#L2496) | <input type="checkbox" id="delete\_previous\_ip\_values" name="delete\_previous\_ip\_values" class="accua\_form\_value" value="1" /> |
| [2497](#L2497) | <label for="delete\_previous\_ip\_values"><?php \_e('Delete all previous IP values', 'contact-forms');?></label><br /> |
| [2498](#L2498) | </p> |
| [2499](#L2499) | <br clear="all"> |
| [2500](#L2500) | </div> |
| [2501](#L2501) | </div> |
| [2502](#L2502) |  |
| [2503](#L2503) | <div class="postbox "> |
| [2504](#L2504) | <h3 class="hndle"><span><?php \_e( 'Track actions with Google Analytics and/or Matomo', 'contact-forms'); ?></span></h3> |
| [2505](#L2505) | <div class="inside" id="dashboard\_right\_now"> |
| [2506](#L2506) | <p> |
| [2507](#L2507) | <input type="checkbox" id="accua\_form\_analytics\_track\_submit" name="analytics\_track\_submit" class="accua\_form\_value" value="1" <?php if($analytics\_data['analytics\_track\_submit']) { echo 'checked="checked"'; } ?> /> |
| [2508](#L2508) | <label for="accua\_form\_analytics\_track\_submit"><?php \_e('Track submissions', 'contact-forms');?></label> |
| [2509](#L2509) | </p> |
| [2510](#L2510) | <p> |
| [2511](#L2511) | <input type="checkbox" id="accua\_form\_analytics\_track\_fields" name="analytics\_track\_fields" class="accua\_form\_value" value="1" <?php if($analytics\_data['analytics\_track\_fields']) { echo 'checked="checked"'; } ?> /> |
| [2512](#L2512) | <label for="accua\_form\_analytics\_track\_fields"><?php \_e('Track fields filled in', 'contact-forms');?></label> |
| [2513](#L2513) | </p> |
| [2514](#L2514) | </div> |
| [2515](#L2515) | </div> |
| [2516](#L2516) |  |
| [2517](#L2517) | </div> |
| [2518](#L2518) |  |
| [2519](#L2519) | <div class="metabox-holder accua-forms-metabox-holder"> |
| [2520](#L2520) | <div class="postbox "> |
| [2521](#L2521) | <h3 class="hndle"><span><?php \_e( 'Layout &amp; Styling', 'contact-forms'); ?></span></h3> |
| [2522](#L2522) | <div class="inside" id="dashboard\_right\_now"> |
| [2523](#L2523) | <p><?php \_e( 'Customize the look and feel of your forms. Leave fields empty if you wish to use the native styles of your WordPress Theme.', 'contact-forms'); ?><p> |
| [2524](#L2524) | <h4><?php \_e( 'Forms', 'contact-forms'); ?></h4> |
| [2525](#L2525) | <div id="accua\_form\_layout"> <?php \_e( 'Layout', 'contact-forms'); ?> |
| [2526](#L2526) | <select name="layout" class="accua\_form\_value"><option value="sidebyside" <?php if ($form\_data['layout'] == 'sidebyside') { echo 'selected="selected"'; } ?>>Labels on the left of the fields</option><option value="toplabel" <?php if ($form\_data['layout'] == 'toplabel') { echo 'selected="selected"'; } ?>>Labels on top of the fields</option></select> |
| [2527](#L2527) | </div> |
| [2528](#L2528) | <div id="accua\_form\_style\_margin" class="label\_input"> |
| [2529](#L2529) | <label><?php \_e( 'Margin', 'contact-forms'); ?></label> |
| [2530](#L2530) | <input name="style\_margin" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_margin'], ENT\_QUOTES) ?>" /> |
| [2531](#L2531) | </div> |
| [2532](#L2532) | <div id="accua\_form\_style\_border\_color" class="label\_input"> |
| [2533](#L2533) | <label><?php \_e( 'Border color', 'contact-forms'); ?></label> |
| [2534](#L2534) | <input name="style\_border\_color" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_border\_color'], ENT\_QUOTES) ?>" /> |
| [2535](#L2535) | </div> |
| [2536](#L2536) | <div id="accua\_form\_style\_border\_width" class="label\_input"> |
| [2537](#L2537) | <label><?php \_e( 'Border width', 'contact-forms'); ?></label> |
| [2538](#L2538) | <input name="style\_border\_width" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_border\_width'], ENT\_QUOTES) ?>" /> |
| [2539](#L2539) | </div> |
| [2540](#L2540) | <div id="accua\_form\_style\_border\_radius" class="label\_input"> |
| [2541](#L2541) | <label><?php \_e( 'Rounded corner radius', 'contact-forms'); ?></label> |
| [2542](#L2542) | <input name="style\_border\_radius" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_border\_radius'], ENT\_QUOTES) ?>" /> |
| [2543](#L2543) | </div> |
| [2544](#L2544) | <div id="accua\_form\_style\_background\_color" class="label\_input"> |
| [2545](#L2545) | <label><?php \_e( 'Background color', 'contact-forms'); ?></label> |
| [2546](#L2546) | <input name="style\_background\_color" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_background\_color'], ENT\_QUOTES) ?>" /> |
| [2547](#L2547) | </div> |
| [2548](#L2548) | <div id="accua\_form\_style\_padding" class="label\_input"> |
| [2549](#L2549) | <label><?php \_e( 'Padding', 'contact-forms'); ?></label> |
| [2550](#L2550) | <input name="style\_padding" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_padding'], ENT\_QUOTES) ?>" /> |
| [2551](#L2551) | </div> |
| [2552](#L2552) | <div id="accua\_form\_style\_color" class="label\_input"> |
| [2553](#L2553) | <label><?php \_e( 'Text color', 'contact-forms'); ?></label> |
| [2554](#L2554) | <input name="style\_color" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_color'], ENT\_QUOTES) ?>" /> |
| [2555](#L2555) | </div> |
| [2556](#L2556) | <div id="accua\_form\_style\_font\_size" class="label\_input"> |
| [2557](#L2557) | <label><?php \_e( 'Font size', 'contact-forms'); ?></label> |
| [2558](#L2558) | <input name="style\_font\_size" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_font\_size'], ENT\_QUOTES) ?>" /> |
| [2559](#L2559) | </div> |
| [2560](#L2560) |  |
| [2561](#L2561) | <h4><?php \_e( 'Fields', 'contact-forms'); ?></h4> |
| [2562](#L2562) | <div id="accua\_form\_style\_field\_spacing" class="label\_input"> |
| [2563](#L2563) | <label><?php \_e( 'Spacing', 'contact-forms'); ?></label> |
| [2564](#L2564) | <input name="style\_field\_spacing" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_field\_spacing'], ENT\_QUOTES) ?>" /> |
| [2565](#L2565) | </div> |
| [2566](#L2566) | <div id="accua\_form\_style\_field\_border\_color" class="label\_input"> |
| [2567](#L2567) | <label><?php \_e( 'Border color', 'contact-forms'); ?></label> |
| [2568](#L2568) | <input name="style\_field\_border\_color" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_field\_border\_color'], ENT\_QUOTES) ?>" /> |
| [2569](#L2569) | </div> |
| [2570](#L2570) | <div id="accua\_form\_style\_field\_border\_width" class="label\_input"> |
| [2571](#L2571) | <label><?php \_e( 'Border width', 'contact-forms'); ?></label> |
| [2572](#L2572) | <input name="style\_field\_border\_width" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_field\_border\_width'], ENT\_QUOTES) ?>" /> |
| [2573](#L2573) | </div> |
| [2574](#L2574) | <div id="accua\_form\_style\_field\_border\_radius" class="label\_input"> |
| [2575](#L2575) | <label><?php \_e( 'Rounded corner radius', 'contact-forms'); ?></label> |
| [2576](#L2576) | <input name="style\_field\_border\_radius" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_field\_border\_radius'], ENT\_QUOTES) ?>" /> |
| [2577](#L2577) | </div> |
| [2578](#L2578) | <div id="accua\_form\_style\_field\_background\_color" class="label\_input"> |
| [2579](#L2579) | <label><?php \_e( 'Background color', 'contact-forms'); ?></label> |
| [2580](#L2580) | <input name="style\_field\_background\_color" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_field\_background\_color'], ENT\_QUOTES) ?>" /> |
| [2581](#L2581) | </div> |
| [2582](#L2582) | <div id="accua\_form\_style\_field\_padding" class="label\_input"> |
| [2583](#L2583) | <label><?php \_e( 'Padding', 'contact-forms'); ?></label> |
| [2584](#L2584) | <input name="style\_field\_padding" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_field\_padding'], ENT\_QUOTES) ?>" /> |
| [2585](#L2585) | </div> |
| [2586](#L2586) | <div id="accua\_form\_style\_field\_color" class="label\_input"> |
| [2587](#L2587) | <label><?php \_e( 'Text color', 'contact-forms'); ?></label> |
| [2588](#L2588) | <input name="style\_field\_color" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_field\_color'], ENT\_QUOTES) ?>" /> |
| [2589](#L2589) | </div> |
| [2590](#L2590) |  |
| [2591](#L2591) | <h4><?php \_e( 'Submit button', 'contact-forms'); ?></h4> |
| [2592](#L2592) | <div id="accua\_form\_style\_submit\_border\_color" class="label\_input"> |
| [2593](#L2593) | <label><?php \_e( 'Border color', 'contact-forms'); ?></label> |
| [2594](#L2594) | <input name="style\_submit\_border\_color" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_submit\_border\_color'], ENT\_QUOTES) ?>" /> |
| [2595](#L2595) | </div> |
| [2596](#L2596) | <div id="accua\_form\_style\_submit\_border\_width" class="label\_input"> |
| [2597](#L2597) | <label><?php \_e( 'Border width', 'contact-forms'); ?></label> |
| [2598](#L2598) | <input name="style\_submit\_border\_width" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_submit\_border\_width'], ENT\_QUOTES) ?>" /> |
| [2599](#L2599) | </div> |
| [2600](#L2600) | <div id="accua\_form\_style\_submit\_border\_radius" class="label\_input"> |
| [2601](#L2601) | <label><?php \_e( 'Rounded corner radius', 'contact-forms'); ?></label> |
| [2602](#L2602) | <input name="style\_submit\_border\_radius" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_submit\_border\_radius'], ENT\_QUOTES) ?>" /> |
| [2603](#L2603) | </div> |
| [2604](#L2604) | <div id="accua\_form\_style\_submit\_background\_color" class="label\_input"> |
| [2605](#L2605) | <label><?php \_e( 'Background color', 'contact-forms'); ?></label> |
| [2606](#L2606) | <input name="style\_submit\_background\_color" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_submit\_background\_color'], ENT\_QUOTES) ?>" /> |
| [2607](#L2607) | </div> |
| [2608](#L2608) | <div id="accua\_form\_style\_submit\_padding" class="label\_input"> |
| [2609](#L2609) | <label><?php \_e( 'Padding', 'contact-forms'); ?></label> |
| [2610](#L2610) | <input name="style\_submit\_padding" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_submit\_padding'], ENT\_QUOTES) ?>" /> |
| [2611](#L2611) | </div> |
| [2612](#L2612) | <div id="accua\_form\_style\_submit\_color" class="label\_input"> |
| [2613](#L2613) | <label><?php \_e( 'Text color', 'contact-forms'); ?></label> |
| [2614](#L2614) | <input name="style\_submit\_color" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_submit\_color'], ENT\_QUOTES) ?>" /> |
| [2615](#L2615) | </div> |
| [2616](#L2616) | <div id="accua\_form\_style\_submit\_font\_size" class="label\_input"> |
| [2617](#L2617) | <label><?php \_e( 'Font size', 'contact-forms'); ?></label> |
| [2618](#L2618) | <input name="style\_submit\_font\_size" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($form\_data['style\_submit\_font\_size'], ENT\_QUOTES) ?>" /> |
| [2619](#L2619) | </div> |
| [2620](#L2620) | <br clear="all" /> |
| [2621](#L2621) | </div> |
| [2622](#L2622) | </div> |
| [2623](#L2623) | </div> |
| [2624](#L2624) |  |
| [2625](#L2625) |  |
| [2626](#L2626) | <br clear="all"/> |
| [2627](#L2627) |  |
| [2628](#L2628) | </div> |
| [2629](#L2629) |  |
| [2630](#L2630) | <?php /\* |
| [2631](#L2631) | <h3><?php \_e( 'File upload default settings', 'contact-forms'); ?></h3> |
| [2632](#L2632) | <p id="accua\_form\_valid\_extensions"><?php \_e( 'Valid extensions', 'contact-forms'); ?> <br /><textarea name="valid\_extensions" class="accua\_form\_value" style="width:95%"; cols="80" rows="8"><?php echo htmlspecialchars($file\_data['valid\_extensions'], ENT\_QUOTES) ?></textarea> |
| [2633](#L2633) | <small><?php \_e( 'List of valid extensions, without dot, one per line.', 'contact-forms'); ?></small> |
| [2634](#L2634) | </p> |
| [2635](#L2635) | <p id="accua\_form\_max\_size"><?php \_e( 'Maximum file size:', 'contact-forms'); ?> <input name="max\_size" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($file\_data['max\_size'], ENT\_QUOTES) ?>" /><br /> |
| [2636](#L2636) | <small><?php \_e( 'You can use suffix K, M or G for kilobyte, megabyte or gigabyte.', 'contact-forms'); ?> |
| [2637](#L2637) | <?php |
| [2638](#L2638) | $server\_max\_size = AccuaForm\_Element\_File::file\_upload\_max\_size(); |
| [2639](#L2639) | if ($server\_max\_size > 0) { |
| [2640](#L2640) | \_e( 'This value is limited by server upload limits of ', 'contact-forms'); |
| [2641](#L2641) | echo  AccuaForm\_Element\_File::format\_size($server\_max\_size).". "; |
| [2642](#L2642) | \_e( 'If you need a greater limit you should ask to the server administrator.', 'contact-forms'); |
| [2643](#L2643) | } |
| [2644](#L2644) | ?> |
| [2645](#L2645) | </small></p> |
| [2646](#L2646) | <p id="accua\_form\_dest\_path"><?php \_e( 'Upload path', 'contact-forms');?> : <input name="dest\_path" class="accua\_form\_value" type="text" value="<?php echo htmlspecialchars($file\_data['dest\_path'], ENT\_QUOTES) ?>" /> |
| [2647](#L2647) | <small><?php \_e( 'If it stars with \'/\' an absolute path is used, otherwise a path relative to the WordPress installation directory. Default value is "wp-content/uploads/accua-forms"', 'contact-forms');?>.</small> |
| [2648](#L2648) | </p> \*/ ?> |
| [2649](#L2649) | <p><input class="button button-primary button-large" id="accua\_form\_save\_settings" type="submit" value="Save settings" /></p> |
| [2650](#L2650) |  |
| [2651](#L2651) | <?php accua\_forms\_print\_tokens(); ?> |
| [2652](#L2652) |  |
| [2653](#L2653) | </form> |
| [2654](#L2654) | </div> |
| [2655](#L2655) |  |
| [2656](#L2656) | <script type='text/javascript'> |
| [2657](#L2657) | jQuery(function($) { |
| [2658](#L2658) | $('#accua\_form\_style\_border\_color .accua\_form\_value').colorPicker(); |
| [2659](#L2659) | $('#accua\_form\_style\_background\_color .accua\_form\_value').colorPicker(); |
| [2660](#L2660) | $('#accua\_form\_style\_color .accua\_form\_value').colorPicker(); |
| [2661](#L2661) | $('#accua\_form\_style\_field\_border\_color .accua\_form\_value').colorPicker(); |
| [2662](#L2662) | $('#accua\_form\_style\_field\_background\_color .accua\_form\_value').colorPicker(); |
| [2663](#L2663) | $('#accua\_form\_style\_field\_color .accua\_form\_value').colorPicker(); |
| [2664](#L2664) | $('#accua\_form\_style\_submit\_border\_color .accua\_form\_value').colorPicker(); |
| [2665](#L2665) | $('#accua\_form\_style\_submit\_background\_color .accua\_form\_value').colorPicker(); |
| [2666](#L2666) | $('#accua\_form\_style\_submit\_color .accua\_form\_value').colorPicker(); |
| [2667](#L2667) | }); |
| [2668](#L2668) | </script> |
| [2669](#L2669) |  |
| [2670](#L2670) | <?php |
| [2671](#L2671) | } |
| [2672](#L2672) |  |
| [2673](#L2673) | function \_accua\_forms\_get\_abs\_dest\_path($dest\_path = '') { |
| [2674](#L2674) | if ($dest\_path === '') { |
| [2675](#L2675) | return realpath(ABSPATH) . '/wp-content/uploads/accua-forms'; |
| [2676](#L2676) | } else if (substr($dest\_path,0,1) === '/') { |
| [2677](#L2677) | return $dest\_path; |
| [2678](#L2678) | } else { |
| [2679](#L2679) | return realpath(ABSPATH) . '/' . $dest\_path; |
| [2680](#L2680) | } |
| [2681](#L2681) | } |
| [2682](#L2682) |  |
| [2683](#L2683) | function \_accua\_forms\_get\_form\_data($fid = false, $return\_empty = true, $restore\_trash = false){ |
| [2684](#L2684) | $empty\_form\_data = array( |
| [2685](#L2685) | 'fields' => array(), |
| [2686](#L2686) | 'title' => '', |
| [2687](#L2687) | 'success\_message' => '', |
| [2688](#L2688) | 'error\_message' => '', |
| [2689](#L2689) | 'emails\_from\_name' => '', |
| [2690](#L2690) | 'emails\_from' => '', |
| [2691](#L2691) | 'admin\_emails\_to' => '', |
| [2692](#L2692) | 'emails\_bcc' => '', |
| [2693](#L2693) | 'admin\_emails\_subject' => '', |
| [2694](#L2694) | 'admin\_emails\_message' => '', |
| [2695](#L2695) | 'confirmation\_emails\_subject' => '', |
| [2696](#L2696) | 'confirmation\_emails\_message' => '', |
| [2697](#L2697) | 'use\_ajax' => true, |
| [2698](#L2698) | 'layout' => 'sidebyside', |
| [2699](#L2699) | 'style\_margin' => '', |
| [2700](#L2700) | 'style\_border\_color' => '', |
| [2701](#L2701) | 'style\_border\_width' => '', |
| [2702](#L2702) | 'style\_border\_radius' => '', |
| [2703](#L2703) | 'style\_background\_color' => '', |
| [2704](#L2704) | 'style\_padding' => '', |
| [2705](#L2705) | 'style\_color' => '', |
| [2706](#L2706) | 'style\_font\_size' => '', |
| [2707](#L2707) | 'style\_field\_spacing' => '', |
| [2708](#L2708) | 'style\_field\_border\_color' => '', |
| [2709](#L2709) | 'style\_field\_border\_width' => '', |
| [2710](#L2710) | 'style\_field\_border\_radius' => '', |
| [2711](#L2711) | 'style\_field\_background\_color' => '', |
| [2712](#L2712) | 'style\_field\_padding' => '', |
| [2713](#L2713) | 'style\_field\_color' => '', |
| [2714](#L2714) | 'style\_submit\_border\_color' => '', |
| [2715](#L2715) | 'style\_submit\_border\_width' => '', |
| [2716](#L2716) | 'style\_submit\_border\_radius' => '', |
| [2717](#L2717) | 'style\_submit\_background\_color' => '', |
| [2718](#L2718) | 'style\_submit\_padding' => '', |
| [2719](#L2719) | 'style\_submit\_color' => '', |
| [2720](#L2720) | 'style\_submit\_font\_size' => '', |
| [2721](#L2721) | ); |
| [2722](#L2722) |  |
| [2723](#L2723) | if ($fid === false) { |
| [2724](#L2724) | return $empty\_form\_data; |
| [2725](#L2725) | } |
| [2726](#L2726) |  |
| [2727](#L2727) | $default\_form\_data = get\_option('accua\_forms\_default\_form\_data',array()); |
| [2728](#L2728) |  |
| [2729](#L2729) | if ($fid === null) { |
| [2730](#L2730) | return $default\_form\_data + $empty\_form\_data; |
| [2731](#L2731) | } |
| [2732](#L2732) |  |
| [2733](#L2733) | $forms\_data = get\_option('accua\_forms\_saved\_forms', array()); |
| [2734](#L2734) | if ($restore\_trash) { |
| [2735](#L2735) | $trash\_data = get\_option('accua\_forms\_trash\_forms', array()); |
| [2736](#L2736) | if (isset($trash\_data[$fid])) { |
| [2737](#L2737) | $forms\_data[$fid] = $trash\_data[$fid]; |
| [2738](#L2738) | update\_option('accua\_forms\_saved\_forms', $forms\_data); |
| [2739](#L2739) | unset($trash\_data[$fid]); |
| [2740](#L2740) | update\_option('accua\_forms\_trash\_forms', $trash\_data); |
| [2741](#L2741) | } |
| [2742](#L2742) | } |
| [2743](#L2743) |  |
| [2744](#L2744) | if (isset($forms\_data[$fid])) { |
| [2745](#L2745) | $form\_data = array( |
| [2746](#L2746) | '\_overrided' => $forms\_data[$fid] |
| [2747](#L2747) | ) + $forms\_data[$fid] + $default\_form\_data + $empty\_form\_data; |
| [2748](#L2748) | /\* |
| [2749](#L2749) | if ($form\_data['fields']) { |
| [2750](#L2750) | foreach ($form\_data['fields'] as $i => $istance\_data) { |
| [2751](#L2751) | // TODO: popuplate default fields data? |
| [2752](#L2752) | } |
| [2753](#L2753) | } |
| [2754](#L2754) | \*/ |
| [2755](#L2755) | return $form\_data; |
| [2756](#L2756) | } else if ($return\_empty) { |
| [2757](#L2757) | return array( |
| [2758](#L2758) | '\_overrided' => array() |
| [2759](#L2759) | ) + $default\_form\_data + $empty\_form\_data; |
| [2760](#L2760) | } else { |
| [2761](#L2761) | return null; |
| [2762](#L2762) | } |
| [2763](#L2763) |  |
| [2764](#L2764) | } |
| [2765](#L2765) |  |
| [2766](#L2766) | function \_accua\_forms\_style\_parameters($params) { |
| [2767](#L2767) | $ret = ''; |
| [2768](#L2768) | foreach ($params as $key => $value) { |
| [2769](#L2769) | $value = trim($value); |
| [2770](#L2770) | if ($value !== '') { |
| [2771](#L2771) | if (is\_numeric($value)) { |
| [2772](#L2772) | $ret .= "{$key}:{$value}px;"; |
| [2773](#L2773) | } else { |
| [2774](#L2774) | $ret .= "{$key}:{$value};"; |
| [2775](#L2775) | } |
| [2776](#L2776) | if ($key == 'border-width') { |
| [2777](#L2777) | $ret .= "border-style:solid;"; |
| [2778](#L2778) | } |
| [2779](#L2779) | } |
| [2780](#L2780) | } |
| [2781](#L2781) | return $ret; |
| [2782](#L2782) | } |
| [2783](#L2783) |  |
| [2784](#L2784) | /\* |
| [2785](#L2785) | \* generazione del form (e della preview) |
| [2786](#L2786) | \* \*/ |
| [2787](#L2787) | add\_action('accua\_form\_alter', 'accua\_forms\_form\_generate', -999, 2); |
| [2788](#L2788) | function accua\_forms\_form\_generate($baseid, $form) { |
| [2789](#L2789) | if (substr($baseid, 0, 14) == '\_\_accua-form\_\_') { |
| [2790](#L2790) | $fid = substr($baseid,14); |
| [2791](#L2791) | $form\_data = \_accua\_forms\_get\_form\_data($fid, false); |
| [2792](#L2792) | /\* |
| [2793](#L2793) | echo '<!-- fid = '; |
| [2794](#L2794) | print\_r($fid); |
| [2795](#L2795) | echo "\n\nform\_data = "; |
| [2796](#L2796) | print\_r($form\_data); |
| [2797](#L2797) | echo "\n-->"; |
| [2798](#L2798) | \*/ |
| [2799](#L2799) | if ($form\_data) { |
| [2800](#L2800) | $form\_style = \_accua\_forms\_style\_parameters(array( |
| [2801](#L2801) | 'margin' => $form\_data['style\_margin'], |
| [2802](#L2802) | 'border-color' => $form\_data['style\_border\_color'], |
| [2803](#L2803) | 'border-width' => $form\_data['style\_border\_width'], |
| [2804](#L2804) | 'border-radius' => $form\_data['style\_border\_radius'], |
| [2805](#L2805) | 'background' => $form\_data['style\_background\_color'], |
| [2806](#L2806) | 'padding' => $form\_data['style\_padding'], |
| [2807](#L2807) | 'color' => $form\_data['style\_color'], |
| [2808](#L2808) | 'font-size' => $form\_data['style\_font\_size'], |
| [2809](#L2809) | )); |
| [2810](#L2810) |  |
| [2811](#L2811) | $field\_style = \_accua\_forms\_style\_parameters(array( |
| [2812](#L2812) | 'margin-bottom' => $form\_data['style\_field\_spacing'], |
| [2813](#L2813) | 'border-color' => $form\_data['style\_field\_border\_color'], |
| [2814](#L2814) | 'border-width' => $form\_data['style\_field\_border\_width'], |
| [2815](#L2815) | 'border-radius' => $form\_data['style\_field\_border\_radius'], |
| [2816](#L2816) | 'background' => (trim($form\_data['style\_field\_background\_color']) === '')?'transparent':$form\_data['style\_field\_background\_color'], |
| [2817](#L2817) | 'padding' => $form\_data['style\_field\_padding'], |
| [2818](#L2818) | 'color' => (trim($form\_data['style\_field\_color']) === '')?$form\_data['style\_color']:$form\_data['style\_field\_color'], |
| [2819](#L2819) | 'font-size' => $form\_data['style\_font\_size'], |
| [2820](#L2820) | )); |
| [2821](#L2821) | $field\_properties = array(); |
| [2822](#L2822) | if ($field\_style !== '') { |
| [2823](#L2823) | $field\_properties['style'] = $field\_style; |
| [2824](#L2824) | } |
| [2825](#L2825) |  |
| [2826](#L2826) | $submit\_style = \_accua\_forms\_style\_parameters(array( |
| [2827](#L2827) | 'border-color' => $form\_data['style\_submit\_border\_color'], |
| [2828](#L2828) | 'border-width' => $form\_data['style\_submit\_border\_width'], |
| [2829](#L2829) | 'border-radius' => $form\_data['style\_submit\_border\_radius'], |
| [2830](#L2830) | 'background' => $form\_data['style\_submit\_background\_color'], |
| [2831](#L2831) | 'padding' => $form\_data['style\_submit\_padding'], |
| [2832](#L2832) | 'color' => $form\_data['style\_submit\_color'], |
| [2833](#L2833) | 'font-size' => $form\_data['style\_submit\_font\_size'], |
| [2834](#L2834) | )); |
| [2835](#L2835) | $submit\_properties = array(); |
| [2836](#L2836) | if ($submit\_style !== '') { |
| [2837](#L2837) | $submit\_properties['style'] = $submit\_style; |
| [2838](#L2838) | } |
| [2839](#L2839) |  |
| [2840](#L2840) | if ($form\_style !== '') { |
| [2841](#L2841) | $form->configure(array('style' => $form\_style)); |
| [2842](#L2842) | } |
| [2843](#L2843) |  |
| [2844](#L2844) | if (!empty($form\_data['use\_ajax'])){ |
| [2845](#L2845) | $form->configure(array( |
| [2846](#L2846) | "accua\_ajax" => 1, |
| [2847](#L2847) | )); |
| [2848](#L2848) | } |
| [2849](#L2849) |  |
| [2850](#L2850) | $add\_submit = true; |
| [2851](#L2851) | $fieldset\_open = false; |
| [2852](#L2852) | $avail\_fields = get\_option('accua\_forms\_avail\_fields', array()); |
| [2853](#L2853) |  |
| [2854](#L2854) | foreach ($form\_data['fields'] as $istance\_data) { |
| [2855](#L2855) | if (empty($avail\_fields[$istance\_data['ref']])) { |
| [2856](#L2856) | $field\_data = array(); |
| [2857](#L2857) | if (!empty($istance\_data['ref'])) { |
| [2858](#L2858) | if ($istance\_data['ref'] == '\_\_fieldset-begin') { |
| [2859](#L2859) | $field\_data = array( |
| [2860](#L2860) | 'id' => '\_\_fieldset-begin', |
| [2861](#L2861) | 'name' => \_\_('Fieldset begin', 'contact-forms'), |
| [2862](#L2862) | 'type' => 'fieldset-begin', |
| [2863](#L2863) | 'description' => '', |
| [2864](#L2864) | ); |
| [2865](#L2865) | } else if ($istance\_data['ref'] == '\_\_fieldset-end') { |
| [2866](#L2866) | $field\_data = array( |
| [2867](#L2867) | 'id' => '\_\_fieldset-end', |
| [2868](#L2868) | 'name' => \_\_('Fieldset end', 'contact-forms'), |
| [2869](#L2869) | 'type' => 'fieldset-end', |
| [2870](#L2870) | 'description' => '', |
| [2871](#L2871) | ); |
| [2872](#L2872) | } |
| [2873](#L2873) | } |
| [2874](#L2874) | } else { |
| [2875](#L2875) | $field\_data = $avail\_fields[$istance\_data['ref']]; |
| [2876](#L2876) | } |
| [2877](#L2877) |  |
| [2878](#L2878) | $field\_data += array( |
| [2879](#L2879) | 'version' => 1, |
| [2880](#L2880) | 'id' => '\_\_html', |
| [2881](#L2881) | 'name' => \_\_( 'Custom HTML content', 'contact-forms'), |
| [2882](#L2882) | 'type' => 'html', |
| [2883](#L2883) | 'description' => \_\_('Use this special field to inject raw HTML in the form. You can use this multiple times.', 'contact-forms'), |
| [2884](#L2884) | 'default\_value' => '', |
| [2885](#L2885) | 'allowed\_values' => '', |
| [2886](#L2886) | 'allowed\_extensions' => '', |
| [2887](#L2887) | ); |
| [2888](#L2888) |  |
| [2889](#L2889) | $istance\_data += array( |
| [2890](#L2890) | 'version' => 1, |
| [2891](#L2891) | ); |
| [2892](#L2892) |  |
| [2893](#L2893) | if ($field\_data['type'] == 'file') { |
| [2894](#L2894) | if ($field\_data['version'] < 2) { |
| [2895](#L2895) | $field\_data['allowed\_extensions'] = $field\_data['allowed\_values']; |
| [2896](#L2896) | } |
| [2897](#L2897) | if ($istance\_data['version'] < 2 && isset($istance\_data['allowed\_values'])) { |
| [2898](#L2898) | $istance\_data['allowed\_extensions'] = $istance\_data['allowed\_values']; |
| [2899](#L2899) | } |
| [2900](#L2900) | } |
| [2901](#L2901) |  |
| [2902](#L2902) | /\* prendo i dati relativi ai campi di tipo date |
| [2903](#L2903) | lo faccio prima, così default value in questo modo viene sovrascritto se un campo è di un tipo diverso |
| [2904](#L2904) |  |
| [2905](#L2905) | NB: se i campi sono già sovrascritti, si trovano già in istance\_data \*/ |
| [2906](#L2906) | if ($field\_data['type'] == 'date'){ |
| [2907](#L2907) | $istance\_data += array( |
| [2908](#L2908) | 'default\_value' => $field\_data['default\_date\_value'], |
| [2909](#L2909) | 'min\_date' => $field\_data['min\_date'], |
| [2910](#L2910) | 'max\_date' => $field\_data['max\_date'], |
| [2911](#L2911) | ); |
| [2912](#L2912) | } |
| [2913](#L2913) |  |
| [2914](#L2914) | $istance\_data += array( |
| [2915](#L2915) | 'istance\_id' => $field\_data['id'], |
| [2916](#L2916) | 'widget\_number' => '', |
| [2917](#L2917) | 'ref' => $field\_data['id'], |
| [2918](#L2918) | 'label' => $field\_data['name'], |
| [2919](#L2919) | 'default\_value' => $field\_data['default\_value'], /\* viene impostato il valore di defualt se non è un campo data \*/ |
| [2920](#L2920) | 'allowed\_values' => $field\_data['allowed\_values'], |
| [2921](#L2921) | 'allowed\_extensions' => $field\_data['allowed\_extensions'], |
| [2922](#L2922) | ); |
| [2923](#L2923) |  |
| [2924](#L2924) | $element = NULL; |
| [2925](#L2925) | $element\_conf = NULL; |
| [2926](#L2926) |  |
| [2927](#L2927) | $allowed\_val = trim($istance\_data['allowed\_values']); |
| [2928](#L2928) |  |
| [2929](#L2929) | if ($field\_data['type'] == 'post-multicheckbox' || $field\_data['type'] == 'post-select') { |
| [2930](#L2930) | $posts = accua\_get\_pages($allowed\_val); |
| [2931](#L2931) | $allowed\_values = array(); |
| [2932](#L2932) | foreach ($posts as $p) { |
| [2933](#L2933) | //$allowed\_values[$p->ID] = apply\_filters( 'the\_title', $p->post\_title, $p->ID ); |
| [2934](#L2934) | $allowed\_values[$p->ID] = $p->post\_title; |
| [2935](#L2935) | } |
| [2936](#L2936) | } else { |
| [2937](#L2937) | if ($field\_data['type'] == 'file') { |
| [2938](#L2938) | $filedata = get\_option('accua\_forms\_default\_file\_field\_data',array()); |
| [2939](#L2939) | $filedata += array( |
| [2940](#L2940) | 'valid\_extensions' => '', |
| [2941](#L2941) | 'max\_filesize' => '', |
| [2942](#L2942) | 'dest\_path' => '', |
| [2943](#L2943) | ); |
| [2944](#L2944) | $allowed\_val = accua\_forms\_filter\_extensions($istance\_data['allowed\_extensions']); |
| [2945](#L2945) | if ($allowed\_val == '') { |
| [2946](#L2946) | $allowed\_val = accua\_forms\_filter\_extensions($filedata['valid\_extensions']); |
| [2947](#L2947) | } |
| [2948](#L2948) | } |
| [2949](#L2949) |  |
| [2950](#L2950) | $allowed\_val = explode("\n",$allowed\_val); |
| [2951](#L2951) | $allowed\_values = array(); |
| [2952](#L2952) | foreach ($allowed\_val as $val) { |
| [2953](#L2953) | $val = explode('|',$val,2); |
| [2954](#L2954) | $val[0] = trim($val[0]); |
| [2955](#L2955) | /\* |
| [2956](#L2956) | if (empty($val[0])) { |
| [2957](#L2957) | continue; |
| [2958](#L2958) | } |
| [2959](#L2959) | \*/ |
| [2960](#L2960) | if ((!isset($val[1])) || (trim($val[1])==='')) { |
| [2961](#L2961) | if ($val[0] === '') { |
| [2962](#L2962) | continue; |
| [2963](#L2963) | } else { |
| [2964](#L2964) | $val[1] = $val[0]; |
| [2965](#L2965) | } |
| [2966](#L2966) | } |
| [2967](#L2967) | $allowed\_values[$val[0]] = $val[1]; |
| [2968](#L2968) | } |
| [2969](#L2969) | } |
| [2970](#L2970) |  |
| [2971](#L2971) | switch ($field\_data['type']) { |
| [2972](#L2972) | case 'textarea': |
| [2973](#L2973) | $element = new Element\_Textarea($istance\_data['label'], $istance\_data['istance\_id'], $field\_properties+array('cols' => '50', 'value'=>$istance\_data['default\_value'])); |
| [2974](#L2974) | break; |
| [2975](#L2975) | case 'hidden': |
| [2976](#L2976) | $element = new Element\_Hidden($istance\_data['istance\_id'], $istance\_data['default\_value']); |
| [2977](#L2977) | break; |
| [2978](#L2978) | case 'checkbox': |
| [2979](#L2979) | $lab = $istance\_data['label']; |
| [2980](#L2980) | if (!empty($istance\_data['required'])) { |
| [2981](#L2981) | $lab .= ' <strong>\*</strong>'; |
| [2982](#L2982) | } |
| [2983](#L2983) | if ($allowed\_values) { |
| [2984](#L2984) | reset($allowed\_values); |
| [2985](#L2985) | $val = (string) key($allowed\_values); |
| [2986](#L2986) | $defval = trim($istance\_data['default\_value']); |
| [2987](#L2987) | } else if ($istance\_data['default\_value'] == '1') { |
| [2988](#L2988) | $defval = $val = '1'; |
| [2989](#L2989) | } else { |
| [2990](#L2990) | $val = empty($istance\_data['default\_value'])?'1':$istance\_data['default\_value']; |
| [2991](#L2991) | $defval = ''; |
| [2992](#L2992) | } |
| [2993](#L2993) | $element = new AccuaForm\_Element\_Checkbox('', $istance\_data['istance\_id'], array($val => $lab), array('value' => $defval)); |
| [2994](#L2994) | break; |
| [2995](#L2995) | case 'select': |
| [2996](#L2996) | case 'post-select': |
| [2997](#L2997) | if (!isset($allowed\_values[''])) { |
| [2998](#L2998) | $allowed\_values = array('' => '') + $allowed\_values; |
| [2999](#L2999) | } |
| [3000](#L3000) | $defval = trim($istance\_data['default\_value']); |
| [3001](#L3001) | $element = new AccuaForm\_Element\_Select($istance\_data['label'], $istance\_data['istance\_id'], $allowed\_values, $field\_properties+array('value'=>$defval)); |
| [3002](#L3002) | break; |
| [3003](#L3003) | case 'radio': |
| [3004](#L3004) | $defval = trim($istance\_data['default\_value']); |
| [3005](#L3005) | $element = new AccuaForm\_Element\_Radio($istance\_data['label'], $istance\_data['istance\_id'], $allowed\_values, array('value'=>$defval)); |
| [3006](#L3006) | break; |
| [3007](#L3007) | case 'multiselect': |
| [3008](#L3008) | $defval = explode('|', $istance\_data['default\_value']); |
| [3009](#L3009) | foreach ($defval as $k => $v) { |
| [3010](#L3010) | $defval[$k] = trim($v); |
| [3011](#L3011) | } |
| [3012](#L3012) | $element = new AccuaForm\_Element\_Select($istance\_data['label'], $istance\_data['istance\_id'], $allowed\_values, $field\_properties+array('multiple' => true, 'value'=>$defval)); |
| [3013](#L3013) | break; |
| [3014](#L3014) | case 'multicheckbox': |
| [3015](#L3015) | case 'post-multicheckbox': |
| [3016](#L3016) | $defval = explode('|', $istance\_data['default\_value']); |
| [3017](#L3017) | foreach ($defval as $k => $v) { |
| [3018](#L3018) | $defval[$k] = trim($v); |
| [3019](#L3019) | } |
| [3020](#L3020) | $element = new AccuaForm\_Element\_Checkbox($istance\_data['label'], $istance\_data['istance\_id'], $allowed\_values, array('value'=>$defval)); |
| [3021](#L3021) | break; |
| [3022](#L3022) | case 'file': |
| [3023](#L3023) | $fdata = array(); |
| [3024](#L3024) |  |
| [3025](#L3025) | if ($allowed\_values) { |
| [3026](#L3026) | $fdata['validExtensions'] = array\_keys($allowed\_values); |
| [3027](#L3027) | } |
| [3028](#L3028) |  |
| [3029](#L3029) | if (!empty($filedata['max\_size'])){ |
| [3030](#L3030) | $fdata['maxSize'] = $filedata['max\_size']; |
| [3031](#L3031) | } |
| [3032](#L3032) |  |
| [3033](#L3033) | $fdata['destPath'] = \_accua\_forms\_get\_abs\_dest\_path($filedata['dest\_path']); |
| [3034](#L3034) |  |
| [3035](#L3035) | $element = new AccuaForm\_Element\_File($istance\_data['label'], $istance\_data['istance\_id'], $field\_properties+$fdata); |
| [3036](#L3036) | break; |
| [3037](#L3037) | case 'html': |
| [3038](#L3038) | $element = new Element\_HTML($istance\_data['default\_value']); |
| [3039](#L3039) | break; |
| [3040](#L3040) | case 'email': |
| [3041](#L3041) | case 'autoreply\_email': |
| [3042](#L3042) | $element = new AccuaForm\_Element\_Email($istance\_data['label'], $istance\_data['istance\_id'], $field\_properties+array('value'=>$istance\_data['default\_value'])); |
| [3043](#L3043) | $element->setValidation(new Validation\_Email( |
| [3044](#L3044) | str\_replace('%element%', $istance\_data['label'], \_\_("Attention: '%element%' must contain an email address.", 'contact-forms')) |
| [3045](#L3045) | )); |
| [3046](#L3046) | //"Errore: '{$istance\_data['label']}' deve contenere un indirizzo email valido." |
| [3047](#L3047) | break; |
| [3048](#L3048) | case 'colorpicker': |
| [3049](#L3049) | $element = new AccuaForm\_Element\_ColorPicker($istance\_data['label'], $istance\_data['istance\_id'], $field\_properties+array('value'=>$istance\_data['default\_value'])); |
| [3050](#L3050) | break; |
| [3051](#L3051) | case 'fieldset-begin': |
| [3052](#L3052) | if ($fieldset\_open) { |
| [3053](#L3053) | $form->addElement(new AccuaForm\_Element\_FieldsetEnd()); |
| [3054](#L3054) | } else { |
| [3055](#L3055) | $fieldset\_open = true; |
| [3056](#L3056) | } |
| [3057](#L3057) | $element = new AccuaForm\_Element\_FieldsetBegin($istance\_data['label'], $istance\_data['istance\_id']); |
| [3058](#L3058) | break; |
| [3059](#L3059) | case 'fieldset-end': |
| [3060](#L3060) | if ($fieldset\_open) { |
| [3061](#L3061) | $element = new AccuaForm\_Element\_FieldsetEnd(); |
| [3062](#L3062) | $fieldset\_open = false; |
| [3063](#L3063) | } |
| [3064](#L3064) | break; |
| [3065](#L3065) | case 'submit': |
| [3066](#L3066) | $add\_submit = false; |
| [3067](#L3067) | $element = new Element\_Button($istance\_data['label'], 'submit', $submit\_properties+array('name' => $istance\_data['istance\_id'], 'value' => $istance\_data['default\_value'])); |
| [3068](#L3068) | break; |
| [3069](#L3069) | case 'captcha': |
| [3070](#L3070) | $empty\_captcha\_data = array( |
| [3071](#L3071) | 'recaptcha\_force\_v1' => '', |
| [3072](#L3072) | 'recaptcha\_public\_key' => '', |
| [3073](#L3073) | 'recaptcha\_private\_key' => '', |
| [3074](#L3074) | ); |
| [3075](#L3075) | $captcha\_data = get\_option('accua\_forms\_default\_captcha\_field\_data',array()) + $empty\_captcha\_data; |
| [3076](#L3076) | $captcha\_properties = array("description" => ""); |
| [3077](#L3077) | $captcha\_use\_v1 = true; |
| [3078](#L3078) | if (($captcha\_data['recaptcha\_public\_key'] !== '') && ($captcha\_data['recaptcha\_private\_key'] !== '')) { |
| [3079](#L3079) | $captcha\_properties['privateKey'] = $captcha\_data['recaptcha\_private\_key']; |
| [3080](#L3080) | $captcha\_properties['publicKey'] = $captcha\_data['recaptcha\_public\_key']; |
| [3081](#L3081) | $captcha\_use\_v1 = $captcha\_data['recaptcha\_force\_v1']; |
| [3082](#L3082) | } |
| [3083](#L3083) | if ($captcha\_use\_v1) { |
| [3084](#L3084) | $element = new Element\_HTML("\n\n<!-- ReCaptcha 1 is discontinued, please go to Contact Forms settings page and set reCaptcha v2 keys -->\n\n"); |
| [3085](#L3085) | } else { |
| [3086](#L3086) | $element = new AccuaForm\_Element\_Captcha2 ($istance\_data['label'], '', $captcha\_properties); |
| [3087](#L3087) | } |
| [3088](#L3088) | break; |
| [3089](#L3089) | case 'password': |
| [3090](#L3090) | $element = new Element\_Password($istance\_data['label'], $istance\_data['istance\_id'], $field\_properties+array('value'=>$istance\_data['default\_value'])); |
| [3091](#L3091) | break; |
| [3092](#L3092) | case 'password-and-confirm': |
| [3093](#L3093) | $id\_2 = "\_\_\_{$istance\_data['istance\_id']}\_\_\_confirmpass"; |
| [3094](#L3094) | $element = new Element\_Password(\_\_("Password", 'contact-forms'), $istance\_data['istance\_id'], $field\_properties+array('value'=>$istance\_data['default\_value'])); |
| [3095](#L3095) | $element\_conf = new Element\_Password(\_\_("Confirm password", 'contact-forms'), $id\_2, $field\_properties+array('value'=>$istance\_data['default\_value'])); |
| [3096](#L3096) | $element\_conf\_validator = new AccuaForm\_Validation\_Password(); |
| [3097](#L3097) | $element\_conf\_validator->configure(array('otherPasswordFieldName'=>$istance\_data['istance\_id'])); |
| [3098](#L3098) | $element\_conf->setValidation($element\_conf\_validator); |
| [3099](#L3099) | break; |
| [3100](#L3100) | case 'date': |
| [3101](#L3101) | $element = new AccuaForm\_Element\_Date($istance\_data['label'], $istance\_data['istance\_id'], $field\_properties+array('value'=>$istance\_data['default\_value'], 'minDate'=>$istance\_data['min\_date'], 'maxDate'=>$istance\_data['max\_date'])); |
| [3102](#L3102) | break; |
| [3103](#L3103) | //case 'textfield': |
| [3104](#L3104) | default: |
| [3105](#L3105) | $element = new Element\_Textbox($istance\_data['label'], $istance\_data['istance\_id'], $field\_properties+array('value'=>$istance\_data['default\_value'])); |
| [3106](#L3106) | break; |
| [3107](#L3107) | } |
| [3108](#L3108) | if ($element) { |
| [3109](#L3109) | if (!empty($istance\_data['required'])) { |
| [3110](#L3110) | $element->setClass('accuaforms-field-required'); |
| [3111](#L3111) | if($field\_data['type'] == 'captcha' && empty($captcha\_use\_v1)) { |
| [3112](#L3112) | //nothing |
| [3113](#L3113) | } else if($field\_data['type'] == 'password-and-confirm') { |
| [3114](#L3114) | $element->setValidation(new Validation\_Required( |
| [3115](#L3115) | str\_replace('%element%', $istance\_data['label'], \_\_("Attention: Passwords are required fields.", 'contact-forms')) |
| [3116](#L3116) | )); |
| [3117](#L3117) | } else { |
| [3118](#L3118) | $element->setValidation(new Validation\_Required( |
| [3119](#L3119) | str\_replace('%element%', $istance\_data['label'], \_\_("Attention: '%element%' is a required field.", 'contact-forms')) |
| [3120](#L3120) | )); |
| [3121](#L3121) | } |
| [3122](#L3122) | } |
| [3123](#L3123) |  |
| [3124](#L3124) | if ($elementName = $element->getName()) { |
| [3125](#L3125) | $element->setClass('accuaform-fieldname-'.$elementName); |
| [3126](#L3126) | } |
| [3127](#L3127) |  |
| [3128](#L3128) | if ($field\_data['type']) { |
| [3129](#L3129) | $element->setClass('accuaform-fieldtype-'.$field\_data['type']); |
| [3130](#L3130) | } |
| [3131](#L3131) |  |
| [3132](#L3132) | $form->addElement($element); |
| [3133](#L3133) | if($element\_conf!=NULL) { |
| [3134](#L3134) | $form->addElement($element\_conf); |
| [3135](#L3135) | $element\_conf=NULL; |
| [3136](#L3136) | } |
| [3137](#L3137) | } |
| [3138](#L3138) | } |
| [3139](#L3139) | if ($fieldset\_open) { |
| [3140](#L3140) | $form->addElement(new AccuaForm\_Element\_FieldsetEnd()); |
| [3141](#L3141) | $fieldset\_open = false; |
| [3142](#L3142) | } |
| [3143](#L3143) | if ($add\_submit) { |
| [3144](#L3144) | $form->addElement(new Element\_Button(\_\_('Submit', 'contact-forms'), 'submit', $submit\_properties)); |
| [3145](#L3145) | } |
| [3146](#L3146) | } |
| [3147](#L3147) |  |
| [3148](#L3148) | } |
| [3149](#L3149) | } |
| [3150](#L3150) |  |
| [3151](#L3151) | function accua\_forms\_aggregate\_submitted\_data(&$replace\_map, $params = array()) { |
| [3152](#L3152) | if (empty($params['txt']) && empty($params['html']) && empty($params['json']) && empty($params['email'])) { |
| [3153](#L3153) | $params += array( |
| [3154](#L3154) | 'txt' => true, |
| [3155](#L3155) | 'html' => true, |
| [3156](#L3156) | 'json' => true, |
| [3157](#L3157) | 'email' => true, |
| [3158](#L3158) | ); |
| [3159](#L3159) | } |
| [3160](#L3160) |  |
| [3161](#L3161) | if (!empty($params['txt'])) { |
| [3162](#L3162) | $replace\_map['\_\_submitted\_txt'] = implode("\n",$replace\_map['\_\_submitted\_txt\_raw']); |
| [3163](#L3163) | } |
| [3164](#L3164) | if (!empty($params['html'])) { |
| [3165](#L3165) | $replace\_map['\_\_submitted\_html'] = implode('</td></tr><tr><td>',$replace\_map['\_\_submitted\_html\_raw']); |
| [3166](#L3166) | } |
| [3167](#L3167) | if (!empty($params['json'])) { |
| [3168](#L3168) | $replace\_map['\_\_submitted\_json'] = \_accua\_forms\_json\_encode($replace\_map['\_\_submitted\_json\_raw']); |
| [3169](#L3169) | } |
| [3170](#L3170) | if (!empty($params['email'])) { |
| [3171](#L3171) | $replace\_map['\_\_autoreply\_email'] = implode('; ', $replace\_map['\_\_autoreply\_email\_raw']); |
| [3172](#L3172) | } |
| [3173](#L3173) |  |
| [3174](#L3174) | } |
| [3175](#L3175) |  |
| [3176](#L3176) | add\_filter('accua\_form\_validate', 'accua\_forms\_validation\_handler', 10, 4); |
| [3177](#L3177) | function accua\_forms\_validation\_handler($valid, $submittedID, $submittedData, $form){ |
| [3178](#L3178) | if (substr($submittedID, 0, 14) == '\_\_accua-form\_\_') { |
| [3179](#L3179) | $fid = substr($submittedID,14); |
| [3180](#L3180) | $form\_data = \_accua\_forms\_get\_form\_data($fid, false); |
| [3181](#L3181) | if ($form\_data) { |
| [3182](#L3182) | return apply\_filters('accua\_forms\_validation', $valid, $fid, $submittedData, $form); |
| [3183](#L3183) | } |
| [3184](#L3184) | } |
| [3185](#L3185) | return $valid; |
| [3186](#L3186) | } |
| [3187](#L3187) |  |
| [3188](#L3188) | function accua\_forms\_anonymize\_ip($ip) { |
| [3189](#L3189) | $ip = (string) $ip; |
| [3190](#L3190) | $anonymize\_ip\_data = get\_option('accua\_forms\_anonymize\_ip\_data',array()); |
| [3191](#L3191) | if (empty($anonymize\_ip\_data['anonymize\_ip\_bytes'])) { |
| [3192](#L3192) | return $ip; |
| [3193](#L3193) | } |
| [3194](#L3194) | switch ($anonymize\_ip\_data['anonymize\_ip\_bytes']) { |
| [3195](#L3195) | case 1: |
| [3196](#L3196) | $ip = preg\_replace('/\.[^.]+$/', '.xxx', $ip); |
| [3197](#L3197) | break; |
| [3198](#L3198) | case 2: |
| [3199](#L3199) | $ip = preg\_replace('/\.[^.]+\.[^.]+$/', '.xxx.xxx', $ip); |
| [3200](#L3200) | break; |
| [3201](#L3201) | case 3: |
| [3202](#L3202) | $ip = preg\_replace('/\.[^.]+\.[^.]+\.[^.]+$/', '.xxx.xxx.xxx', $ip); |
| [3203](#L3203) | break; |
| [3204](#L3204) | case 4: |
| [3205](#L3205) | $ip = ''; |
| [3206](#L3206) | } |
| [3207](#L3207) | return $ip; |
| [3208](#L3208) | } |
| [3209](#L3209) |  |
| [3210](#L3210) | add\_action('accua\_form\_submit', 'accua\_forms\_form\_submission\_handler', -10, 3); |
| [3211](#L3211) | function accua\_forms\_form\_submission\_handler($submittedID, $submittedData, $form) { |
| [3212](#L3212) | if (empty($GLOBALS['wp\_rewrite'])) { |
| [3213](#L3213) | $GLOBALS['wp\_rewrite'] = new WP\_Rewrite(); |
| [3214](#L3214) | } |
| [3215](#L3215) |  |
| [3216](#L3216) | if (!class\_exists('AccuaConditionalReplacer')){ |
| [3217](#L3217) | require\_once('AccuaConditionalReplacer.php'); |
| [3218](#L3218) | } |
| [3219](#L3219) |  |
| [3220](#L3220) | if (substr($submittedID, 0, 14) == '\_\_accua-form\_\_') { |
| [3221](#L3221) | $fid = substr($submittedID,14); |
| [3222](#L3222) | $form\_data = \_accua\_forms\_get\_form\_data($fid, false); |
| [3223](#L3223) | if ($form\_data) { |
| [3224](#L3224) | global $wpdb; |
| [3225](#L3225) |  |
| [3226](#L3226) | $time = time(); |
| [3227](#L3227) |  |
| [3228](#L3228) | $afs\_stats = \_accua\_forms\_json\_encode(array( |
| [3229](#L3229) | 'user\_agent' => $form->stats['user\_agent'], |
| [3230](#L3230) | 'platform' => $form->stats['platform'], |
| [3231](#L3231) | 'tentatives' => $form->stats['tentatives'], |
| [3232](#L3232) | 'submit\_method' => $form->stats['submit\_method'], |
| [3233](#L3233) | )); |
| [3234](#L3234) |  |
| [3235](#L3235) | $anonymized\_ip = accua\_forms\_anonymize\_ip($form->stats['ip']); |
| [3236](#L3236) |  |
| [3237](#L3237) | $insert\_ret = $wpdb->insert( |
| [3238](#L3238) | $wpdb->prefix . 'accua\_forms\_submissions', |
| [3239](#L3239) | array ( |
| [3240](#L3240) | 'afs\_form\_id' => (string) $fid, |
| [3241](#L3241) | 'afs\_post\_id' => (string) $form->stats['pid'], |
| [3242](#L3242) | 'afs\_ip' => $anonymized\_ip, |
| [3243](#L3243) | 'afs\_uri' => (string) $form->stats['uri'], |
| [3244](#L3244) | 'afs\_referrer' => (string) $form->stats['referrer'], |
| [3245](#L3245) | 'afs\_lang' => (string) $form->stats['lang'], |
| [3246](#L3246) | 'afs\_created' => (string) gmdate('Y-m-d H:i:s', $form->stats['created']), |
| [3247](#L3247) | 'afs\_submitted' => (string) gmdate('Y-m-d H:i:s', $time), |
| [3248](#L3248) | 'afs\_stats' => (string) $afs\_stats, |
| [3249](#L3249) | ) |
| [3250](#L3250) | ); |
| [3251](#L3251) |  |
| [3252](#L3252) | if ($insert\_ret) { |
| [3253](#L3253) | $submission\_id = $form->stats['submission\_id'] = $wpdb->insert\_id; |
| [3254](#L3254) | } else { |
| [3255](#L3255) | $submission\_id = $form->stats['submission\_id'] = 0; |
| [3256](#L3256) | error\_log("[WordPress Contact Forms] unable to save submitted form data"); |
| [3257](#L3257) | } |
| [3258](#L3258) |  |
| [3259](#L3259) | $review\_submission\_url = admin\_url('admin.php').'?page=accua\_forms\_submissions\_list&sid='.$submission\_id; |
| [3260](#L3260) |  |
| [3261](#L3261) | $replace\_map = array( |
| [3262](#L3262) | '\_\_fid' => $fid, |
| [3263](#L3263) | '\_\_subid' => $submission\_id, |
| [3264](#L3264) | '\_\_pid' => $form->stats['pid'], |
| [3265](#L3265) | '\_\_ip' => $form->stats['ip'], |
| [3266](#L3266) | '\_\_anonymized\_ip' => $anonymized\_ip, |
| [3267](#L3267) | '\_\_uri' => $form->stats['uri'], |
| [3268](#L3268) | '\_\_url' => $form->stats['url'], |
| [3269](#L3269) | '\_\_referrer' => $form->stats['referrer'], |
| [3270](#L3270) | '\_\_lang' => $form->stats['lang'], |
| [3271](#L3271) | '\_\_locale' => $form->stats['locale'], |
| [3272](#L3272) | '\_\_created' => $form->stats['created'], |
| [3273](#L3273) | '\_\_created\_day' => date('l j F Y', $form->stats['created']), |
| [3274](#L3274) | '\_\_created\_day\_month\_year' => date('j F Y', $form->stats['created']), |
| [3275](#L3275) | '\_\_created\_hour' => date('G:i', $form->stats['created']), |
| [3276](#L3276) | '\_\_submitted' => $time, |
| [3277](#L3277) | '\_\_submitted\_day' => date('l j F Y', $time), |
| [3278](#L3278) | '\_\_submitted\_day\_month\_year' => date('j F Y', $time), |
| [3279](#L3279) | '\_\_submitted\_hour' => date('G:i', $time), |
| [3280](#L3280) | '\_\_confirmation\_emails\_message' => $form\_data['confirmation\_emails\_message'], |
| [3281](#L3281) | '\_\_user\_agent' => $form->stats['user\_agent'], |
| [3282](#L3282) | '\_\_platform' => $form->stats['platform'], |
| [3283](#L3283) | '\_\_tentatives' => $form->stats['tentatives'], |
| [3284](#L3284) | '\_\_submit\_method' => $form->stats['submit\_method'], |
| [3285](#L3285) | '\_\_review\_submission\_url' => $review\_submission\_url, |
| [3286](#L3286) | ); |
| [3287](#L3287) |  |
| [3288](#L3288) | $avail\_fields = get\_option('accua\_forms\_avail\_fields', array()); |
| [3289](#L3289) |  |
| [3290](#L3290) | $replace\_map['\_\_autoreply\_email\_raw'] = array(); |
| [3291](#L3291) | $replace\_map['\_\_submitted\_txt\_raw'] = array(); |
| [3292](#L3292) | $replace\_map['\_\_submitted\_html\_raw'] = array(); |
| [3293](#L3293) | $replace\_map['\_\_submitted\_json\_raw'] = array(); |
| [3294](#L3294) |  |
| [3295](#L3295) | $\_field\_data = array(); |
| [3296](#L3296) | $\_istance\_data = array(); |
| [3297](#L3297) | $field\_data = array(); |
| [3298](#L3298) |  |
| [3299](#L3299) | foreach ($submittedData as $istance\_id => $value) { |
| [3300](#L3300) | if (empty($form\_data['fields'][$istance\_id])) { |
| [3301](#L3301) | continue; |
| [3302](#L3302) | } |
| [3303](#L3303) | $istance\_data = $form\_data['fields'][$istance\_id]; |
| [3304](#L3304) |  |
| [3305](#L3305) | if (empty($avail\_fields[$istance\_data['ref']])) { |
| [3306](#L3306) | $fieldset\_data = array(); |
| [3307](#L3307) | if (!empty($istance\_data['ref'])) { |
| [3308](#L3308) | if ($istance\_data['ref'] == '\_\_fieldset-begin') { |
| [3309](#L3309) | $field\_data = array( |
| [3310](#L3310) | 'id' => '\_\_fieldset-begin', |
| [3311](#L3311) | 'name' => \_\_('Fieldset begin', 'contact-forms'), |
| [3312](#L3312) | 'type' => 'fieldset-begin', |
| [3313](#L3313) | 'description' => '', |
| [3314](#L3314) | ); |
| [3315](#L3315) | } else if ($istance\_data['ref'] == '\_\_fieldset-end') { |
| [3316](#L3316) | $field\_data = array( |
| [3317](#L3317) | 'id' => '\_\_fieldset-end', |
| [3318](#L3318) | 'name' => \_\_('Fieldset end', 'contact-forms'), |
| [3319](#L3319) | 'type' => 'fieldset-end', |
| [3320](#L3320) | 'description' => '', |
| [3321](#L3321) | ); |
| [3322](#L3322) | } |
| [3323](#L3323) | } |
| [3324](#L3324) | } else { |
| [3325](#L3325) | $field\_data = $avail\_fields[$istance\_data['ref']]; |
| [3326](#L3326) | } |
| [3327](#L3327) |  |
| [3328](#L3328) | $field\_data += array( |
| [3329](#L3329) | 'id' => '\_\_html', |
| [3330](#L3330) | 'name' => \_\_( 'Custom HTML content', 'contact-forms'), |
| [3331](#L3331) | 'type' => 'html', |
| [3332](#L3332) | 'description' => \_\_( 'Use this special field to inject raw HTML in the form. You can use this multiple times.', 'contact-forms'), |
| [3333](#L3333) | 'default\_value' => '', |
| [3334](#L3334) | 'allowed\_values' => '', |
| [3335](#L3335) | ); |
| [3336](#L3336) |  |
| [3337](#L3337) | /\* |
| [3338](#L3338) | echo "<!-- istance\_data: " |
| [3339](#L3339) | , print\_r($istance\_data, true) |
| [3340](#L3340) | , "\nfield\_data: " |
| [3341](#L3341) | , print\_r($field\_data, true) |
| [3342](#L3342) | , "\nvalue: " |
| [3343](#L3343) | , print\_r($value, true) |
| [3344](#L3344) | , "\n-->\n"; |
| [3345](#L3345) | \*/ |
| [3346](#L3346) |  |
| [3347](#L3347) | $istance\_data += array( |
| [3348](#L3348) | 'istance\_id' => $field\_data['id'], |
| [3349](#L3349) | 'widget\_number' => '', |
| [3350](#L3350) | 'ref' => $field\_data['id'], |
| [3351](#L3351) | 'label' => $field\_data['name'], |
| [3352](#L3352) | 'default\_value' => $field\_data['default\_value'], |
| [3353](#L3353) | 'allowed\_values' => $field\_data['allowed\_values'], |
| [3354](#L3354) | ); |
| [3355](#L3355) |  |
| [3356](#L3356) | $type = $field\_data['type']; |
| [3357](#L3357) | $file\_download\_url = ''; |
| [3358](#L3358) |  |
| [3359](#L3359) | switch ($field\_data['type']) { |
| [3360](#L3360) | case 'checkbox': |
| [3361](#L3361) | case 'submit': |
| [3362](#L3362) | if (empty($value)) { |
| [3363](#L3363) | $replace\_map[$istance\_data['istance\_id']] = $value = ''; |
| [3364](#L3364) | } else { |
| [3365](#L3365) | if (empty($istance\_data['default\_value'])) { |
| [3366](#L3366) | $replace\_map[$istance\_data['istance\_id']] = 'Checked'; |
| [3367](#L3367) | $value = '1'; |
| [3368](#L3368) | } else { |
| [3369](#L3369) | $replace\_map[$istance\_data['istance\_id']] = $value = $istance\_data['default\_value']; |
| [3370](#L3370) | } |
| [3371](#L3371) | } |
| [3372](#L3372) | break; |
| [3373](#L3373) | case 'multiselect': |
| [3374](#L3374) | case 'multicheckbox': |
| [3375](#L3375) | case 'select': |
| [3376](#L3376) | case 'radio': |
| [3377](#L3377) | $el = $form->getElementByName($istance\_id); |
| [3378](#L3378) | $opts = $el->getOptions(); |
| [3379](#L3379) | if (!is\_array($value)) { |
| [3380](#L3380) | $value = array($value); |
| [3381](#L3381) | } |
| [3382](#L3382) | $label = array(); |
| [3383](#L3383) | foreach ($value as $val) { |
| [3384](#L3384) | if (isset($opts[$val])) { |
| [3385](#L3385) | $label[] = $opts[$val]; |
| [3386](#L3386) | } |
| [3387](#L3387) | } |
| [3388](#L3388) | $replace\_map['\_\_label\_'.$istance\_data['istance\_id']] = implode(", ", $label); |
| [3389](#L3389) | $replace\_map[$istance\_data['istance\_id']] = implode(', ',$value); |
| [3390](#L3390) | $value = implode('|',$value); |
| [3391](#L3391) | break; |
| [3392](#L3392) | case 'post-multicheckbox': |
| [3393](#L3393) | if (is\_array($value) && $value) { |
| [3394](#L3394) | $el = $form->getElementByName($istance\_id); |
| [3395](#L3395) | $opts = $el->getOptions(); |
| [3396](#L3396) | $value2 = array(); |
| [3397](#L3397) | $titles = array(); |
| [3398](#L3398) | $ids = array(); |
| [3399](#L3399) | $urls = array(); |
| [3400](#L3400) | foreach ($value as $val) { |
| [3401](#L3401) | if (isset($opts[$val])) { |
| [3402](#L3402) | $titles[] = $opts[$val]; |
| [3403](#L3403) | $ids[] = $value; |
| [3404](#L3404) | $urls[] = get\_permalink($value); |
| [3405](#L3405) | $value2[] = $val . ': ' . trim(preg\_replace('/[\s\n\r]+/', ' ', $opts[$val])); |
| [3406](#L3406) | } |
| [3407](#L3407) | } |
| [3408](#L3408) | $replace\_map['\_\_label\_'.$istance\_data['istance\_id']] = $replace\_map['\_\_post\_title\_'.$istance\_data['istance\_id']] = implode("\n", $titles); |
| [3409](#L3409) | $replace\_map['\_\_post\_id\_'.$istance\_data['istance\_id']] = implode("\n", $ids); |
| [3410](#L3410) | $replace\_map['\_\_post\_url\_'.$istance\_data['istance\_id']] = implode("\n", $urls); |
| [3411](#L3411) | $replace\_map[$istance\_data['istance\_id']] = $value = implode("\n", $value2); |
| [3412](#L3412) | } else { |
| [3413](#L3413) | $replace\_map['\_\_label\_'.$istance\_data['istance\_id']] = $replace\_map['\_\_post\_title\_'.$istance\_data['istance\_id']] = ''; |
| [3414](#L3414) | $replace\_map['\_\_post\_id\_'.$istance\_data['istance\_id']] = ''; |
| [3415](#L3415) | $replace\_map['\_\_post\_url\_'.$istance\_data['istance\_id']] = ''; |
| [3416](#L3416) | $replace\_map[$istance\_data['istance\_id']] = $value = ''; |
| [3417](#L3417) | } |
| [3418](#L3418) | break; |
| [3419](#L3419) | case 'post-select': |
| [3420](#L3420) | if ($value !== '') { |
| [3421](#L3421) | $el = $form->getElementByName($istance\_id); |
| [3422](#L3422) | $opts = $el->getOptions(); |
| [3423](#L3423) | if (isset($opts[$value])) { |
| [3424](#L3424) | $replace\_map['\_\_label\_'.$istance\_data['istance\_id']] = $replace\_map['\_\_post\_title\_'.$istance\_data['istance\_id']] = $opts[$value]; |
| [3425](#L3425) | $replace\_map['\_\_post\_id\_'.$istance\_data['istance\_id']] = $value; |
| [3426](#L3426) | $replace\_map['\_\_post\_url\_'.$istance\_data['istance\_id']] = get\_permalink($value); |
| [3427](#L3427) | $value = $value . ': ' . trim(preg\_replace('/[\s\n\r]+/', ' ', $opts[$value])); |
| [3428](#L3428) | } else { |
| [3429](#L3429) | $replace\_map['\_\_label\_'.$istance\_data['istance\_id']] = $replace\_map['\_\_post\_title\_'.$istance\_data['istance\_id']] = ''; |
| [3430](#L3430) | $replace\_map['\_\_post\_id\_'.$istance\_data['istance\_id']] = ''; |
| [3431](#L3431) | $replace\_map['\_\_post\_url\_'.$istance\_data['istance\_id']] = ''; |
| [3432](#L3432) | $value = ''; |
| [3433](#L3433) | } |
| [3434](#L3434) | } |
| [3435](#L3435) | $replace\_map[$istance\_data['istance\_id']] = $value; |
| [3436](#L3436) | break; |
| [3437](#L3437) | case 'autoreply\_email': |
| [3438](#L3438) | if ($value !== '') { |
| [3439](#L3439) | $replace\_map['\_\_autoreply\_email\_raw'][] = $value; |
| [3440](#L3440) | } |
| [3441](#L3441) | $replace\_map[$istance\_data['istance\_id']] = $value; |
| [3442](#L3442) | break; |
| [3443](#L3443) | case 'file': |
| [3444](#L3444) | //TODO: move temp file to "{$submission\_id}\_{$field\_data['id']}\_{$file['name']}"; value is $file['name'] |
| [3445](#L3445) | $buildid = $submittedData['\_AccuaForm\_buildID']; |
| [3446](#L3446) | $file = $form->getFile($istance\_id); |
| [3447](#L3447) | if ($value !== null && $value !== '' && $file) { |
| [3448](#L3448) | if ($form->renameFile($istance\_id, "{$submission\_id}\_{$field\_data['id']}\_{$file['name']}")) { |
| [3449](#L3449) | $urlfield = rawurlencode($istance\_data['istance\_id']); |
| [3450](#L3450) | $urlfile = rawurlencode($value); |
| [3451](#L3451) | $file\_download\_url = admin\_url('admin-ajax.php') . "?action=accua\_forms\_download\_submitted\_file&subid={$submission\_id}&field={$urlfield}&file={$urlfile}"; |
| [3452](#L3452) | } |
| [3453](#L3453) | } |
| [3454](#L3454) | $replace\_map[$istance\_data['istance\_id']] = $value; |
| [3455](#L3455) | $replace\_map['\_\_download\_'.$istance\_data['istance\_id']] = $file\_download\_url; |
| [3456](#L3456) | break; |
| [3457](#L3457) | case 'password': |
| [3458](#L3458) | case 'password-and-confirm': |
| [3459](#L3459) | $value = trim($value); |
| [3460](#L3460) | $replace\_map[$istance\_data['istance\_id']] = $value; |
| [3461](#L3461) | $type = 'hashed-password'; |
| [3462](#L3462) | if ($value !== '') { |
| [3463](#L3463) | $value = wp\_hash\_password($value); |
| [3464](#L3464) | } |
| [3465](#L3465) | $replace\_map['\_\_hashed\_'.$istance\_data['istance\_id']] = $value; |
| [3466](#L3466) | break; |
| [3467](#L3467) | default: |
| [3468](#L3468) | $replace\_map[$istance\_data['istance\_id']] = $value; |
| [3469](#L3469) | } |
| [3470](#L3470) |  |
| [3471](#L3471) | switch ($field\_data['type']) { |
| [3472](#L3472) | case 'file': |
| [3473](#L3473) | $replace\_map['\_\_submitted\_txt\_raw'][$istance\_data['istance\_id']] = "{$istance\_data['istance\_id']}\t$value\t$file\_download\_url"; |
| [3474](#L3474) | $replace\_map['\_\_submitted\_json\_raw'][$istance\_data['istance\_id']] = "$value\t$file\_download\_url"; |
| [3475](#L3475) | $replace\_map['\_\_submitted\_html\_raw'][$istance\_data['istance\_id']] = "<strong>{$istance\_data['istance\_id']}</strong></td><td class='valori\_submitted'><a href='".htmlspecialchars($file\_download\_url,ENT\_QUOTES)."'>".htmlspecialchars($value)."</a>"; |
| [3476](#L3476) | break; |
| [3477](#L3477) |  |
| [3478](#L3478) | case 'email': |
| [3479](#L3479) | case 'autoreply\_email': |
| [3480](#L3480) | $replace\_map['\_\_submitted\_txt\_raw'][$istance\_data['istance\_id']] = "{$istance\_data['istance\_id']}\t$value"; |
| [3481](#L3481) | $replace\_map['\_\_submitted\_json\_raw'][$istance\_data['istance\_id']] = $value; |
| [3482](#L3482) | $replace\_map['\_\_submitted\_html\_raw'][$istance\_data['istance\_id']] = "<strong>{$istance\_data['istance\_id']}</strong></td><td class='valori\_submitted'><a href='mailto:".htmlspecialchars($value,ENT\_QUOTES)."'>".htmlspecialchars($value)."</a>"; |
| [3483](#L3483) | break; |
| [3484](#L3484) | case 'submit': |
| [3485](#L3485) | break; |
| [3486](#L3486) | case 'colorpicker': |
| [3487](#L3487) | $replace\_map['\_\_submitted\_txt\_raw'][$istance\_data['istance\_id']] = "{$istance\_data['istance\_id']}\t$value"; |
| [3488](#L3488) | $replace\_map['\_\_submitted\_json\_raw'][$istance\_data['istance\_id']] = $value; |
| [3489](#L3489) | if ($value === '') { |
| [3490](#L3490) | $value\_html = ''; |
| [3491](#L3491) | } else { |
| [3492](#L3492) | $value\_esc = htmlspecialchars($value, ENT\_QUOTES); |
| [3493](#L3493) | $value\_html = "<span style='color: $value\_esc'><font color='$value\_esc'>&#9608;</font></span> $value\_esc"; |
| [3494](#L3494) | } |
| [3495](#L3495) | $replace\_map['\_\_submitted\_html\_raw'][$istance\_data['istance\_id']] = "<strong>{$istance\_data['istance\_id']}</strong></td><td class='valori\_submitted'>$value\_html"; |
| [3496](#L3496) | break; |
| [3497](#L3497) | case 'password': |
| [3498](#L3498) | case 'password-and-confirm': |
| [3499](#L3499) | break; |
| [3500](#L3500) | default: |
| [3501](#L3501) | $replace\_map['\_\_submitted\_txt\_raw'][$istance\_data['istance\_id']] = "{$istance\_data['istance\_id']}\t$value"; |
| [3502](#L3502) | $replace\_map['\_\_submitted\_json\_raw'][$istance\_data['istance\_id']] = $value; |
| [3503](#L3503) | $replace\_map['\_\_submitted\_html\_raw'][$istance\_data['istance\_id']] = "<strong>{$istance\_data['istance\_id']}</strong></td><td class='valori\_submitted'>".htmlspecialchars($value); |
| [3504](#L3504) | } |
| [3505](#L3505) |  |
| [3506](#L3506) | if ($submission\_id) { |
| [3507](#L3507) | $wpdb->insert( |
| [3508](#L3508) | $wpdb->prefix . 'accua\_forms\_submissions\_values', |
| [3509](#L3509) | array ( |
| [3510](#L3510) | 'afsv\_sub\_id' => $submission\_id, |
| [3511](#L3511) | 'afsv\_field\_id' => $istance\_data['istance\_id'], |
| [3512](#L3512) | 'afsv\_type' => $type, |
| [3513](#L3513) | 'afsv\_value' => $value, |
| [3514](#L3514) | ), |
| [3515](#L3515) | array('%d','%s','%s','%s') |
| [3516](#L3516) | ); |
| [3517](#L3517) | } |
| [3518](#L3518) |  |
| [3519](#L3519) | $\_field\_data[$istance\_data['istance\_id']] = $field\_data; |
| [3520](#L3520) | $\_istance\_data[$istance\_data['istance\_id']] = $istance\_data; |
| [3521](#L3521) |  |
| [3522](#L3522) | } |
| [3523](#L3523) |  |
| [3524](#L3524) | $replace\_map['\_\_autoreply'] = (bool) ($replace\_map['\_\_autoreply\_email\_raw'] |
| [3525](#L3525) | && $form\_data['confirmation\_emails\_subject'] |
| [3526](#L3526) | && $form\_data['confirmation\_emails\_message']); |
| [3527](#L3527) |  |
| [3528](#L3528) | accua\_forms\_aggregate\_submitted\_data($replace\_map); |
| [3529](#L3529) |  |
| [3530](#L3530) | //Older undocumented filter, maintained for backward compatibility. In fact filter accua\_forms\_form\_submission\_handler is called before accua\_forms\_submission, but for the rest they are the same |
| [3531](#L3531) | $replace\_map = apply\_filters('accua\_forms\_form\_submission\_handler', $replace\_map, $fid, $submittedData, $form, $\_field\_data, $\_istance\_data); |
| [3532](#L3532) |  |
| [3533](#L3533) | //Newer filter, with an easier name |
| [3534](#L3534) | $replace\_map = apply\_filters('accua\_forms\_submission', $replace\_map, $fid, $submittedData, $form, $\_field\_data, $\_istance\_data); |
| [3535](#L3535) |  |
| [3536](#L3536) | $submitted\_html = '<table><tr><td>' . $replace\_map['\_\_submitted\_html'] . '</td></tr></table>'; |
| [3537](#L3537) | $confirmation\_emails\_message = $replace\_map['\_\_confirmation\_emails\_message']; |
| [3538](#L3538) | unset($replace\_map['\_\_submitted\_html'], $replace\_map['\_\_confirmation\_emails\_message'], $replace\_map['\_\_submitted\_txt\_raw'], $replace\_map['\_\_submitted\_html\_raw'], $replace\_map['\_\_submitted\_json\_raw'], $replace\_map['\_\_autoreply\_email\_raw']); |
| [3539](#L3539) |  |
| [3540](#L3540) | $replace\_map\_html = array(); |
| [3541](#L3541) | foreach($replace\_map as $key => $value) { |
| [3542](#L3542) | $replace\_map\_html["!$key"] = wp\_kses($value, 'post'); |
| [3543](#L3543) | $replace\_map\_html[$key] = htmlspecialchars($value, ENT\_QUOTES); |
| [3544](#L3544) | } |
| [3545](#L3545) |  |
| [3546](#L3546) | $replace\_map['\_\_submitted\_html'] = $replace\_map\_html['\_\_submitted\_html'] = $replace\_map\_html['!\_\_submitted\_html'] = $submitted\_html; |
| [3547](#L3547) | $replacer\_html = new AccuaConditionalReplacer($replace\_map\_html); |
| [3548](#L3548) |  |
| [3549](#L3549) | $confirmation\_emails\_message = $replace\_map['\_\_confirmation\_emails\_message'] = $replacer\_html->doReplace($confirmation\_emails\_message); |
| [3550](#L3550) | $replacer\_html->appendPattern(array('\_\_confirmation\_emails\_message' => $confirmation\_emails\_message, '!\_\_confirmation\_emails\_message' => $confirmation\_emails\_message)); |
| [3551](#L3551) | $replacer = new AccuaConditionalReplacer($replace\_map); |
| [3552](#L3552) |  |
| [3553](#L3553) | $form\_data\_replaced = array(); |
| [3554](#L3554) |  |
| [3555](#L3555) | $settings = array( |
| [3556](#L3556) | 'emails\_from\_name', |
| [3557](#L3557) | 'emails\_from', |
| [3558](#L3558) | 'admin\_emails\_to', |
| [3559](#L3559) | 'emails\_bcc', |
| [3560](#L3560) | 'admin\_emails\_subject', |
| [3561](#L3561) | 'confirmation\_emails\_subject', |
| [3562](#L3562) | ); |
| [3563](#L3563) |  |
| [3564](#L3564) | foreach($settings as $i) { |
| [3565](#L3565) | $form\_data\_replaced[$i] = $replacer->doReplace($form\_data[$i]); |
| [3566](#L3566) | } |
| [3567](#L3567) |  |
| [3568](#L3568) | $settings\_html = array( |
| [3569](#L3569) | 'success\_message', |
| [3570](#L3570) | 'admin\_emails\_message', |
| [3571](#L3571) | ); |
| [3572](#L3572) |  |
| [3573](#L3573) | foreach($settings\_html as $i) { |
| [3574](#L3574) | $form\_data\_replaced[$i] = $replacer\_html->doReplace($form\_data[$i]); |
| [3575](#L3575) | } |
| [3576](#L3576) |  |
| [3577](#L3577) | AccuaForm::appendSubmittedMessages(wpautop($form\_data\_replaced['success\_message'])); |
| [3578](#L3578) |  |
| [3579](#L3579) | $header = array("Content-Type: text/html; charset=".get\_option('blog\_charset')); |
| [3580](#L3580) |  |
| [3581](#L3581) | $emails\_from = trim($form\_data\_replaced['emails\_from']); |
| [3582](#L3582) | if (strpos($emails\_from, '@') !== false) { |
| [3583](#L3583) | if ((strpos($emails\_from, '<') === false) && is\_email($emails\_from)) { |
| [3584](#L3584) | $emails\_from\_name = trim($form\_data\_replaced['emails\_from\_name']); |
| [3585](#L3585) | if ($emails\_from\_name !== '') { |
| [3586](#L3586) | $emails\_from = "=?" . get\_bloginfo('charset') . "?B?" . base64\_encode($emails\_from\_name) . "?= <$emails\_from>"; |
| [3587](#L3587) | } |
| [3588](#L3588) | } |
| [3589](#L3589) | $header[] = 'From: '.$emails\_from; |
| [3590](#L3590) | } |
| [3591](#L3591) |  |
| [3592](#L3592) | if ($form\_data\_replaced['emails\_bcc']) { |
| [3593](#L3593) | $header[] = 'Bcc: '.$form\_data\_replaced['emails\_bcc']; |
| [3594](#L3594) | } |
| [3595](#L3595) |  |
| [3596](#L3596) | if ($form\_data\_replaced['admin\_emails\_to'] |
| [3597](#L3597) | && $form\_data\_replaced['admin\_emails\_subject']) { |
| [3598](#L3598) | /\* |
| [3599](#L3599) | $admin\_tos = explode(',', strtr($form\_data\_replaced['admin\_emails\_to'], "\n\t\r;", ',,,,')); |
| [3600](#L3600) | foreach ($admin\_tos as $admin\_to) { |
| [3601](#L3601) | $mail1 = wp\_mail(trim($admin\_to), $form\_data\_replaced['admin\_emails\_subject'], $form\_data\_replaced['admin\_emails\_message'], $header); |
| [3602](#L3602) | } |
| [3603](#L3603) | \*/ |
| [3604](#L3604) | $mail1 = wp\_mail($form\_data\_replaced['admin\_emails\_to'], $form\_data\_replaced['admin\_emails\_subject'],'<html><head></head><body style="background:#f9f8f8;font-size: 12px;font-family: "Lucida Sans","Lucida Grande", Verdana, Arial, Sans-Serif;"">'.wpautop($form\_data\_replaced['admin\_emails\_message']).'</body></html>', $header); |
| [3605](#L3605) | } |
| [3606](#L3606) |  |
| [3607](#L3607) | if ($replace\_map['\_\_autoreply'] && $replace\_map['\_\_autoreply\_email'] |
| [3608](#L3608) | && $form\_data\_replaced['confirmation\_emails\_subject'] |
| [3609](#L3609) | && $confirmation\_emails\_message) { |
| [3610](#L3610) | $mail2 = wp\_mail($replace\_map['\_\_autoreply\_email'], $form\_data\_replaced['confirmation\_emails\_subject'], '<html><head></head><body>'.wpautop($confirmation\_emails\_message).'</body></html>', $header); |
| [3611](#L3611) | } |
| [3612](#L3612) |  |
| [3613](#L3613) | /\* |
| [3614](#L3614) | echo "<!-- replace\_map: " |
| [3615](#L3615) | , print\_r($replace\_map, true) |
| [3616](#L3616) | , "\nreplace\_map: " |
| [3617](#L3617) | , print\_r($replace\_map, true) |
| [3618](#L3618) | , "\nform\_data\_replaced: " |
| [3619](#L3619) | , print\_r($form\_data\_replaced, true) |
| [3620](#L3620) | , "\nautoreply\_email: " |
| [3621](#L3621) | , print\_r($autoreply\_email, true) |
| [3622](#L3622) | , "\nmail1: " |
| [3623](#L3623) | , print\_r($mail1, true) |
| [3624](#L3624) | , "\nmail2: " |
| [3625](#L3625) | , print\_r($mail2, true) |
| [3626](#L3626) | ,"\n-->"; |
| [3627](#L3627) | \*/ |
| [3628](#L3628) | } |
| [3629](#L3629) | } |
| [3630](#L3630) | } |
| [3631](#L3631) |  |
| [3632](#L3632) | function accua\_forms\_get\_submission\_data($subid, $options = array()){ |
| [3633](#L3633) | //TODO: Completa e usa per sostituire i campi |
| [3634](#L3634) | global $wpdb; |
| [3635](#L3635) | $subid = (int) $subid; |
| [3636](#L3636) | $options += array( |
| [3637](#L3637) | 'extra' => true, |
| [3638](#L3638) | 'file\_format' => 'name', |
| [3639](#L3639) | ); |
| [3640](#L3640) | $ret = array(); |
| [3641](#L3641) | if ($options['extra']) { |
| [3642](#L3642) | $query1 = "SELECT \* |
| [3643](#L3643) | FROM `{$wpdb->prefix}accua\_forms\_submissions` |
| [3644](#L3644) | WHERE afs\_id = $subid"; |
| [3645](#L3645) | $data = $wpdb->get\_row($query1); |
| [3646](#L3646) | if (!empty($data)) { |
| [3647](#L3647) | $created = $data->afs\_created; |
| [3648](#L3648) | $created[10] = 'T'; |
| [3649](#L3649) | $created.='.00+00:00'; |
| [3650](#L3650) | $created = strtotime($created); |
| [3651](#L3651) | $submitted = $data->afs\_submitted; |
| [3652](#L3652) | $submitted[10] = 'T'; |
| [3653](#L3653) | $submitted.='.00+00:00'; |
| [3654](#L3654) | $submitted = strtotime($submitted); |
| [3655](#L3655) | if ($data->afs\_stats) { |
| [3656](#L3656) | $stats = json\_decode($data->afs\_stats, true); |
| [3657](#L3657) | if (!$stats) { |
| [3658](#L3658) | $stats = array(); |
| [3659](#L3659) | } |
| [3660](#L3660) | } else { |
| [3661](#L3661) | $stats = array(); |
| [3662](#L3662) | } |
| [3663](#L3663) | $stats += array( |
| [3664](#L3664) | 'user\_agent' => '', |
| [3665](#L3665) | 'platform' => '', |
| [3666](#L3666) | 'tentatives' => '', |
| [3667](#L3667) | 'submit\_method' => '', |
| [3668](#L3668) | ); |
| [3669](#L3669) | $ret += array( |
| [3670](#L3670) | '\_\_fid' => $data->afs\_form\_id, |
| [3671](#L3671) | '\_\_subid' => $subid, |
| [3672](#L3672) | '\_\_pid' => $data->afs\_post\_id, |
| [3673](#L3673) | '\_\_ip' => $data->afs\_ip, |
| [3674](#L3674) | '\_\_anonymized\_ip' => accua\_forms\_anonymize\_ip($data->afs\_ip), |
| [3675](#L3675) | '\_\_uri' => $data->afs\_uri, |
| [3676](#L3676) | '\_\_referrer' => $data->afs\_referrer, |
| [3677](#L3677) | '\_\_lang' => $data->afs\_lang, |
| [3678](#L3678) | '\_\_created' => $created, |
| [3679](#L3679) | '\_\_created\_day' => date('l j F Y', $created), |
| [3680](#L3680) | '\_\_created\_hour' => date('G:i', $created), |
| [3681](#L3681) | '\_\_submitted' => $submitted, |
| [3682](#L3682) | '\_\_submitted\_day' => date('l j F Y', $submitted), |
| [3683](#L3683) | '\_\_submitted\_hour' => date('G:i', $submitted), |
| [3684](#L3684) | '\_\_user\_agent' => $stats['user\_agent'], |
| [3685](#L3685) | '\_\_platform' => $stats['platform'], |
| [3686](#L3686) | '\_\_tentatives' => $stats['tentatives'], |
| [3687](#L3687) | '\_\_submit\_method' => $stats['submit\_method'], |
| [3688](#L3688) | ); |
| [3689](#L3689) | } |
| [3690](#L3690) | } |
| [3691](#L3691) |  |
| [3692](#L3692) | $query2 = "SELECT \* |
| [3693](#L3693) | FROM `{$wpdb->prefix}accua\_forms\_submissions\_values` |
| [3694](#L3694) | WHERE afsv\_sub\_id = $subid"; |
| [3695](#L3695) |  |
| [3696](#L3696) | $data2 = $wpdb->get\_results($query2, OBJECT); |
| [3697](#L3697) |  |
| [3698](#L3698) | foreach ($data2 as $row) { |
| [3699](#L3699) | switch ($row->afsv\_type) { |
| [3700](#L3700) | case 'file' : |
| [3701](#L3701) | if ($options['file\_format'] == 'url' || $options['file\_format'] == 'link') { |
| [3702](#L3702) | $fieldid = rawurlencode($row->afsv\_field\_id); |
| [3703](#L3703) | $filename = rawurlencode($row->afsv\_value); |
| [3704](#L3704) | $url = admin\_url('admin-ajax.php') . "?action=accua\_forms\_download\_submitted\_file&subid={$row->afsv\_sub\_id}&field={$fieldid}&file={$filename}"; |
| [3705](#L3705) | if ($options['file\_format'] == 'link'){ |
| [3706](#L3706) | $url = htmlspecialchars($url,ENT\_QUOTES); |
| [3707](#L3707) | $filename = htmlspecialchars($row->afsv\_value,ENT\_QUOTES); |
| [3708](#L3708) | $fielddata = "<a href='{$url}' target='\_blank'>{$filename}</a>"; |
| [3709](#L3709) | } else { |
| [3710](#L3710) | $fielddata = $url; |
| [3711](#L3711) | } |
| [3712](#L3712) | } else { // $options['file\_format'] == 'name' |
| [3713](#L3713) | $fielddata = $row->afsv\_value; |
| [3714](#L3714) | } |
| [3715](#L3715) | break; |
| [3716](#L3716) | default: |
| [3717](#L3717) | $fielddata = $row->afsv\_value; |
| [3718](#L3718) | } |
| [3719](#L3719) | $ret[$row->afsv\_field\_id] = $fielddata; |
| [3720](#L3720) | } |
| [3721](#L3721) | return $ret; |
| [3722](#L3722) | } |
| [3723](#L3723) |  |
| [3724](#L3724) | add\_shortcode( 'accua-form', 'accua\_forms\_shortcode\_handler' ); |
| [3725](#L3725) | function accua\_forms\_shortcode\_handler($atts, $content = '', $code = '') { |
| [3726](#L3726) | if (empty($atts['fid'])) { |
| [3727](#L3727) | return ''; |
| [3728](#L3728) | } |
| [3729](#L3729) |  |
| [3730](#L3730) | $fid = $atts['fid']; |
| [3731](#L3731) | $form\_data = \_accua\_forms\_get\_form\_data($fid, false); |
| [3732](#L3732) |  |
| [3733](#L3733) | if (! $form\_data) { |
| [3734](#L3734) | return ''; |
| [3735](#L3735) | } |
| [3736](#L3736) |  |
| [3737](#L3737) | $fid = '\_\_accua-form\_\_'.$fid; |
| [3738](#L3738) |  |
| [3739](#L3739) | $out = ''; |
| [3740](#L3740) |  |
| [3741](#L3741) | if (AccuaForm::getSubmittedID() == $fid) { |
| [3742](#L3742) | /\* return "<pre>Form submitted.\n\nData: " . print\_r(AccuaForm::getSubmittedData(), true) . '</pre>'; \*/ |
| [3743](#L3743) | $messages = AccuaForm::getSubmittedMessages(); |
| [3744](#L3744) | if ($messages) { |
| [3745](#L3745) | $out .= '<div id="\_response\_messages\_'.$fid.'" class="accua-form-messages">'.$messages.'</div>'; |
| [3746](#L3746) | } |
| [3747](#L3747) | if (AccuaForm::isValid()) { |
| [3748](#L3748) | return $out; |
| [3749](#L3749) | } |
| [3750](#L3750) | $form = AccuaForm::getSubmittedForm(); |
| [3751](#L3751) | } else { |
| [3752](#L3752) | $analytics\_data = get\_option('accua\_forms\_default\_analytics\_data',array()); |
| [3753](#L3753) | $params = array( |
| [3754](#L3754) | 'layout' => $form\_data['layout'], |
| [3755](#L3755) | 'title' => $form\_data['title'], |
| [3756](#L3756) | 'track\_submit' => !empty($analytics\_data['analytics\_track\_submit']), |
| [3757](#L3757) | 'track\_fields' => !empty($analytics\_data['analytics\_track\_fields']), |
| [3758](#L3758) | ); |
| [3759](#L3759) | $form = AccuaForm::create($fid, $params); |
| [3760](#L3760) | } |
| [3761](#L3761) |  |
| [3762](#L3762) | $out .= $form->render(true); |
| [3763](#L3763) |  |
| [3764](#L3764) | $doing\_ajax = function\_exists('wp\_doing\_ajax') ? wp\_doing\_ajax() : (defined( 'DOING\_AJAX' ) && DOING\_AJAX); |
| [3765](#L3765) | if ($doing\_ajax && ($\_REQUEST['action'] === 'wpseo\_filter\_shortcodes')) { |
| [3766](#L3766) | $strip\_regexp = '/(<iframe[^>]\*>(.\*?)<\/iframe>|<script[^>]\*>(.\*?)<\/script>|<input([^>]\*)type="hidden"[^>]\*>)/is'; |
| [3767](#L3767) | $out = preg\_replace($strip\_regexp, '', $out); |
| [3768](#L3768) | } |
| [3769](#L3769) |  |
| [3770](#L3770) | return $out; |
| [3771](#L3771) |  |
| [3772](#L3772) | } |
| [3773](#L3773) |  |
| [3774](#L3774) | function accua\_forms\_include($fid, $atts=array(), $content = '', $code = '') { |
| [3775](#L3775) | $atts['fid'] = $fid; |
| [3776](#L3776) | echo accua\_forms\_shortcode\_handler($atts, $content, $code); |
| [3777](#L3777) | } |
| [3778](#L3778) |  |
| [3779](#L3779) | function \_\_accua\_forms\_submissions\_list\_page(){ |
| [3780](#L3780) | if(isset($\_GET['sid'])) { |
| [3781](#L3781) | accua\_forms\_single\_submission(); |
| [3782](#L3782) | } else { |
| [3783](#L3783) | accua\_forms\_submissions\_list\_page(); |
| [3784](#L3784) | } |
| [3785](#L3785) | } |
| [3786](#L3786) | function accua\_forms\_submissions\_list\_page\_head(){ |
| [3787](#L3787) | if(isset($\_GET['sid'])) { |
| [3788](#L3788) | require\_once('accua-forms-single-submission.php'); |
| [3789](#L3789) | accua\_forms\_single\_submission(true); |
| [3790](#L3790) | } else { |
| [3791](#L3791) | require\_once('accua-forms-submissions-page.php'); |
| [3792](#L3792) | accua\_forms\_submissions\_list\_page(true); |
| [3793](#L3793) | } |
| [3794](#L3794) |  |
| [3795](#L3795) | } |
| [3796](#L3796) |  |
| [3797](#L3797) | add\_action('wp\_ajax\_accua\_forms\_download\_submitted\_file', 'accua\_forms\_download\_submitted\_file'); |
| [3798](#L3798) | add\_action('wp\_ajax\_nopriv\_accua\_forms\_download\_submitted\_file', 'accua\_forms\_download\_submitted\_file'); |
| [3799](#L3799) | function accua\_forms\_download\_submitted\_file(){ |
| [3800](#L3800) | $get = stripslashes\_deep($\_GET); |
| [3801](#L3801) | if (isset($get['subid'],$get['field'],$get['file'])) { |
| [3802](#L3802) | if (!empty($get['html'])) { |
| [3803](#L3803) | header("Content-type: text/html"); |
| [3804](#L3804) | $subid = rawurlencode($get['subid']); |
| [3805](#L3805) | $fieldid = rawurlencode($get['field']); |
| [3806](#L3806) | $filename = rawurlencode($get['file']); |
| [3807](#L3807) | $url = admin\_url('admin-ajax.php') . "?action=accua\_forms\_download\_submitted\_file&subid={$subid}&field={$fieldid}&file={$filename}"; |
| [3808](#L3808) | $url = htmlspecialchars($url,ENT\_QUOTES); |
| [3809](#L3809) | $filename = htmlspecialchars($get['file'],ENT\_QUOTES); |
| [3810](#L3810) | die("<html><head><title>{$filename}</title><meta http-equiv='refresh' content='0;URL={$url}'></head><body><a href='{$url}'>{$filename}</a></body></html>"); |
| [3811](#L3811) | } |
| [3812](#L3812) | global $wpdb; |
| [3813](#L3813) | $subid = (int) $get['subid']; |
| [3814](#L3814) | $field = $get['field']; |
| [3815](#L3815) | $file = $get['file']; |
| [3816](#L3816) | $query = "SELECT \* |
| [3817](#L3817) | FROM `{$wpdb->prefix}accua\_forms\_submissions\_values` |
| [3818](#L3818) | WHERE afsv\_sub\_id = %d |
| [3819](#L3819) | AND afsv\_field\_id = %s |
| [3820](#L3820) | AND afsv\_value = %s |
| [3821](#L3821) | "; |
| [3822](#L3822) | $query = $wpdb->prepare($query, $subid, $field, $file); |
| [3823](#L3823) | $subval = $wpdb->get\_results($query, OBJECT); |
| [3824](#L3824) | if ($subval) { |
| [3825](#L3825) | $file\_data = get\_option('accua\_forms\_default\_file\_field\_data',array()) + array('dest\_path' => ''); |
| [3826](#L3826) | $dest\_path = \_accua\_forms\_get\_abs\_dest\_path($file\_data['dest\_path']); |
| [3827](#L3827) | $filename = "{$dest\_path}/{$subid}\_{$field}\_{$file}"; |
| [3828](#L3828) | if (is\_file($filename) && is\_readable($filename)){ |
| [3829](#L3829) | if (function\_exists('finfo\_open')){ |
| [3830](#L3830) | @ $finfo = finfo\_open(FILEINFO\_MIME); |
| [3831](#L3831) | if ($finfo) { |
| [3832](#L3832) | @ $filetype = finfo\_file($finfo, $filename); |
| [3833](#L3833) | @ finfo\_close($finfo); |
| [3834](#L3834) | } |
| [3835](#L3835) | } |
| [3836](#L3836) | if (empty($filetype) && function\_exists('mime\_content\_type')){ |
| [3837](#L3837) | @ $filetype = mime\_content\_type($filename); |
| [3838](#L3838) | } |
| [3839](#L3839) | if (empty($filetype)) { |
| [3840](#L3840) | $filetype = "application/octet-stream"; |
| [3841](#L3841) | } |
| [3842](#L3842) | header("Content-type: $filetype"); |
| [3843](#L3843) | header("Content-length: ".filesize($filename)); |
| [3844](#L3844) | if (empty($\_GET['view'])) { |
| [3845](#L3845) | header("Content-disposition: attachment; filename=\"$file\""); |
| [3846](#L3846) | } |
| [3847](#L3847) | readfile($filename); |
| [3848](#L3848) | die(''); |
| [3849](#L3849) | } |
| [3850](#L3850) | } |
| [3851](#L3851) | } |
| [3852](#L3852) | header("HTTP/1.0 404 Not Found"); |
| [3853](#L3853) | //header("Status: 404 Not Found"); |
| [3854](#L3854) | die('File not found'); |
| [3855](#L3855) | } |
| [3856](#L3856) |  |
| [3857](#L3857) | function accua\_forms\_buildConditionalReplacer($map = array()) { |
| [3858](#L3858) | if (!class\_exists('AccuaConditionalReplacer')){ |
| [3859](#L3859) | require\_once('AccuaConditionalReplacer.php'); |
| [3860](#L3860) | } |
| [3861](#L3861) | return new AccuaConditionalReplacer($map); |
| [3862](#L3862) | } |
| [3863](#L3863) |  |
| [3864](#L3864) |  |
| [3865](#L3865) | add\_action('wp\_ajax\_accua\_forms\_preview', 'accua\_forms\_preview'); |
| [3866](#L3866) | function accua\_forms\_preview() { |
| [3867](#L3867) | if (!current\_user\_can('manage\_options')){ |
| [3868](#L3868) | die (''); |
| [3869](#L3869) | } |
| [3870](#L3870) |  |
| [3871](#L3871) | echo '<html><head> |
| [3872](#L3872) | <style> |
| [3873](#L3873) | body {font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif;} |
| [3874](#L3874) | </style>'; |
| [3875](#L3875) | wp\_print\_styles(); |
| [3876](#L3876) | wp\_print\_head\_scripts(); |
| [3877](#L3877) | echo '</head><body>'; |
| [3878](#L3878) | echo accua\_forms\_shortcode\_handler(array('fid'=>$\_REQUEST['fid'])); |
| [3879](#L3879) | wp\_print\_footer\_scripts(); |
| [3880](#L3880) | echo '</body></html>'; |
| [3881](#L3881) | die(''); |
| [3882](#L3882) | } |
| [3883](#L3883) |  |
| [3884](#L3884) | //salvataggio file excel |
| [3885](#L3885) | add\_action('wp\_ajax\_accua\_forms\_submission\_page\_save\_excel', 'accua\_forms\_submission\_page\_save\_excel'); |
| [3886](#L3886) | //add\_action('wp\_ajax\_nopriv\_accua\_forms\_submission\_page\_save\_excel', 'accua\_forms\_submission\_page\_save\_excel'); |
| [3887](#L3887) |  |
| [3888](#L3888) | function accua\_forms\_submission\_page\_save\_excel() { |
| [3889](#L3889) | if (!current\_user\_can('manage\_options')){ |
| [3890](#L3890) | header("HTTP/1.0 401 Access Denied"); |
| [3891](#L3891) | //header("Status: 401 Access Denied"); |
| [3892](#L3892) | die('You are not authorized to access this page.'); |
| [3893](#L3893) | } |
| [3894](#L3894) |  |
| [3895](#L3895) | require\_once('accua-forms-submissions-page.php'); |
| [3896](#L3896) | $listTable = new Accua\_Forms\_Submissions\_List\_Table(); |
| [3897](#L3897) | $listTable->export\_xls = true; |
| [3898](#L3898) | $listTable->prepare\_items(true); |
| [3899](#L3899) | $show\_col = explode( ',', $\_GET['accua\_show\_field']); |
| [3900](#L3900) | $show\_col = array\_diff($show\_col, array('singlesub')); |
| [3901](#L3901) | header("Content-disposition: attachment; filename=downloads-report.xls"); |
| [3902](#L3902) | header("Content-type: application/vnd.ms-excel"); |
| [3903](#L3903) | accua\_forms\_submission\_page\_save\_excel\_general($listTable,$show\_col); |
| [3904](#L3904) | die(''); |
| [3905](#L3905) | } |
| [3906](#L3906) |  |
| [3907](#L3907) |  |
| [3908](#L3908) |  |
| [3909](#L3909) | function accua\_forms\_submission\_page\_save\_excel\_general(Accua\_Forms\_Submissions\_List\_Table $listTable,array $show\_col,array $options=array()) { |
| [3910](#L3910) | global $wpdb; |
| [3911](#L3911) |  |
| [3912](#L3912) | $content\_type = 'text/html; charset=' . get\_option('blog\_charset'); |
| [3913](#L3913) |  |
| [3914](#L3914) | //creo il file excel |
| [3915](#L3915) | ?><html xmlns:o="urn:schemas-microsoft-com:office:office" |
| [3916](#L3916) | xmlns:x="urn:schemas-microsoft-com:office:excel" |
| [3917](#L3917) | xmlns="http://www.w3.org/TR/REC-html40"> |
| [3918](#L3918) | <head> |
| [3919](#L3919) | <meta http-equiv=Content-Type content="<?php echo $content\_type; ?>" /> |
| [3920](#L3920) | <meta name=ProgId content=Excel.Sheet /> |
| [3921](#L3921) | <style> |
| [3922](#L3922) | <!-- |
| [3923](#L3923) | td {vertical-align:top;} |
| [3924](#L3924) | .head\_row {font-weight:bold;} |
| [3925](#L3925) | .column-date { mso-number-format:"Short Date"; } |
| [3926](#L3926) | .datetime\_cell { mso-number-format:"yyyy\\-mm\\-dd\\ hh\:mm\:ss"; } |
| [3927](#L3927) | --> |
| [3928](#L3928) | </style> |
| [3929](#L3929) | <!--[if gte mso 9]><xml> |
| [3930](#L3930) | <x:ExcelWorkbook> |
| [3931](#L3931) | <x:ExcelWorksheets> |
| [3932](#L3932) | <x:ExcelWorksheet> |
| [3933](#L3933) | <x:WorksheetOptions> |
| [3934](#L3934) | <x:FreezePanes/> |
| [3935](#L3935) | <x:FilterOn/> |
| [3936](#L3936) | <x:SplitHorizontal>1</x:SplitHorizontal> |
| [3937](#L3937) | <x:TopRowBottomPane>1</x:TopRowBottomPane> |
| [3938](#L3938) | <x:ActivePane>2</x:ActivePane> |
| [3939](#L3939) | <x:Panes> |
| [3940](#L3940) | <x:Pane> |
| [3941](#L3941) | <x:Number>3</x:Number> |
| [3942](#L3942) | </x:Pane> |
| [3943](#L3943) | <x:Pane> |
| [3944](#L3944) | <x:Number>2</x:Number> |
| [3945](#L3945) | </x:Pane> |
| [3946](#L3946) | </x:Panes> |
| [3947](#L3947) | </x:WorksheetOptions> |
| [3948](#L3948) | </x:ExcelWorksheet> |
| [3949](#L3949) | </x:ExcelWorksheets> |
| [3950](#L3950) | </x:ExcelWorkbook> |
| [3951](#L3951) | </xml><![endif]--> |
| [3952](#L3952) | </head> |
| [3953](#L3953) | <body> |
| [3954](#L3954) | <table x:str border=1 > |
| [3955](#L3955) | <tr class='head-row'> |
| [3956](#L3956) | <?php |
| [3957](#L3957) | $cols = $listTable->get\_columns(); |
| [3958](#L3958) | foreach($cols as $col\_key=>$col\_value) { |
| [3959](#L3959) | if(in\_array($col\_key, $show\_col)) { ?> |
| [3960](#L3960) | <td x:autofilter="all"><?php echo $col\_value; ?></td> |
| [3961](#L3961) | <?php } |
| [3962](#L3962) | } ?> |
| [3963](#L3963) | </tr> |
| [3964](#L3964) |  |
| [3965](#L3965) | <?php |
| [3966](#L3966) | $lead\_statuses = accua\_forms\_get\_lead\_statuses(); |
| [3967](#L3967) |  |
| [3968](#L3968) | foreach($listTable->items as $id\_submission=>$single\_submission) { |
| [3969](#L3969) | @ set\_time\_limit(10); |
| [3970](#L3970) | echo "<tr>"; |
| [3971](#L3971) | foreach($cols as $col\_key=>$col\_value) { |
| [3972](#L3972) | if(in\_array($col\_key, $show\_col)) { |
| [3973](#L3973) | echo "<td class='.$col\_key.'>"; |
| [3974](#L3974) | if ($col\_key == 'lead\_status') { |
| [3975](#L3975) | if (isset($lead\_statuses[$single\_submission['lead\_status']])) { |
| [3976](#L3976) | echo htmlspecialchars($lead\_statuses[$single\_submission['lead\_status']]); |
| [3977](#L3977) | } |
| [3978](#L3978) | } else if(isset($single\_submission[$col\_key])) { |
| [3979](#L3979) | if ( method\_exists( $listTable, 'column\_' . $col\_key ) ) { |
| [3980](#L3980) | echo call\_user\_func( array( &$listTable, 'column\_' . $col\_key ), $single\_submission ); |
| [3981](#L3981) | } |
| [3982](#L3982) | else { |
| [3983](#L3983) | echo $listTable->column\_default( $single\_submission, $col\_key ); |
| [3984](#L3984) | } |
| [3985](#L3985) | } |
| [3986](#L3986) | echo "</td>"; |
| [3987](#L3987) | } |
| [3988](#L3988) |  |
| [3989](#L3989) | } |
| [3990](#L3990) | echo "</tr>"; |
| [3991](#L3991) | } |
| [3992](#L3992) |  |
| [3993](#L3993) | ?> |
| [3994](#L3994) | </table> |
| [3995](#L3995) | </body> |
| [3996](#L3996) | </html> |
| [3997](#L3997) | <?php |
| [3998](#L3998) | } |
| [3999](#L3999) |  |
| [4000](#L4000) | function accua\_forms\_print\_tokens() { |
| [4001](#L4001) | $avail\_fields = get\_option('accua\_forms\_avail\_fields', array()); |
| [4002](#L4002) | $tokens = ''; |
| [4003](#L4003) | foreach($avail\_fields as $key=>$value) { |
| [4004](#L4004) | $tokens .= $value['name'] . ": {" . $key . "}\n"; |
| [4005](#L4005) | switch ($value['type']) { |
| [4006](#L4006) | case 'file': |
| [4007](#L4007) | $tokens .= $value['name'] . " (download link): {\_\_download\_" . $key . "}\n"; |
| [4008](#L4008) | break; |
| [4009](#L4009) | case 'multiselect': |
| [4010](#L4010) | case 'multicheckbox': |
| [4011](#L4011) | $tokens .= $value['name'] . " (labels): {\_\_label\_" . $key . "}\n"; |
| [4012](#L4012) | break; |
| [4013](#L4013) | case 'select': |
| [4014](#L4014) | case 'radio': |
| [4015](#L4015) | $tokens .= $value['name'] . " (label): {\_\_label\_" . $key . "}\n"; |
| [4016](#L4016) | break; |
| [4017](#L4017) | case 'post-multicheckbox': |
| [4018](#L4018) | $tokens .= $value['name'] . " (posts titles): {\_\_label\_" . $key . "}\n"; |
| [4019](#L4019) | $tokens .= $value['name'] . " (posts ids): {\_\_post\_id\_" . $key . "}\n"; |
| [4020](#L4020) | $tokens .= $value['name'] . " (posts urls): {\_\_post\_url\_" . $key . "}\n"; |
| [4021](#L4021) | break; |
| [4022](#L4022) | case 'post-select': |
| [4023](#L4023) | $tokens .= $value['name'] . " (post title): {\_\_label\_" . $key . "}\n"; |
| [4024](#L4024) | $tokens .= $value['name'] . " (post id): {\_\_post\_id\_" . $key . "}\n"; |
| [4025](#L4025) | $tokens .= $value['name'] . " (post url): {\_\_post\_url\_" . $key . "}\n"; |
| [4026](#L4026) | break; |
| [4027](#L4027) | } |
| [4028](#L4028) | } |
| [4029](#L4029) |  |
| [4030](#L4030) | echo <<<EOT |
| [4031](#L4031) | <div class="accua\_forms\_token\_list"> |
| [4032](#L4032) | <h2>Tokens</h2> |
| [4033](#L4033) | <em>In HTML text, use {!token\_name} to insert unfiltered token value</em> |
| [4034](#L4034) | <h3>Fields</h3> |
| [4035](#L4035) | <em>These tokens are available only if the field is added to the form</em> |
| [4036](#L4036) | <pre>$tokens</pre> |
| [4037](#L4037) | <h3>Generic tokens</h3> |
| [4038](#L4038) | <pre>{\_\_fid} |
| [4039](#L4039) | {\_\_subid} |
| [4040](#L4040) | {\_\_pid} |
| [4041](#L4041) | {\_\_ip} |
| [4042](#L4042) | {\_\_anonymized\_ip} |
| [4043](#L4043) | {\_\_uri} |
| [4044](#L4044) | {\_\_url} |
| [4045](#L4045) | {\_\_referrer} |
| [4046](#L4046) | {\_\_lang} |
| [4047](#L4047) | {\_\_locale} |
| [4048](#L4048) | {\_\_created} |
| [4049](#L4049) | {\_\_created\_day} |
| [4050](#L4050) | {\_\_created\_day\_month\_year} |
| [4051](#L4051) | {\_\_created\_hour} |
| [4052](#L4052) | {\_\_submitted} |
| [4053](#L4053) | {\_\_submitted\_day} |
| [4054](#L4054) | {\_\_submitted\_day\_month\_year} |
| [4055](#L4055) | {\_\_submitted\_hour} |
| [4056](#L4056) | {\_\_user\_agent} |
| [4057](#L4057) | {\_\_platform} |
| [4058](#L4058) | {\_\_tentatives} |
| [4059](#L4059) | {\_\_submit\_method} |
| [4060](#L4060) | {\_\_submitted\_txt} |
| [4061](#L4061) | {\_\_submitted\_html} |
| [4062](#L4062) | {\_\_submitted\_json} |
| [4063](#L4063) | {\_\_autoreply} |
| [4064](#L4064) | {\_\_autoreply\_email} |
| [4065](#L4065) | {\_\_confirmation\_emails\_message} |
| [4066](#L4066) | {\_\_review\_submission\_url}</pre> |
| [4067](#L4067) | </div> |
| [4068](#L4068) | EOT; |
| [4069](#L4069) | do\_action('accua\_forms\_print\_tokens'); |
| [4070](#L4070) | } |
| [4071](#L4071) |  |
| [4072](#L4072) | function accua\_get\_pages($args = '') { |
| [4073](#L4073) | global $wpdb; |
| [4074](#L4074) |  |
| [4075](#L4075) | $defaults = array( |
| [4076](#L4076) | 'child\_of' => 0, |
| [4077](#L4077) | 'sort\_order' => 'ASC', |
| [4078](#L4078) | 'sort\_column' => 'post\_title', |
| [4079](#L4079) | 'hierarchical' => 1, |
| [4080](#L4080) | 'exclude' => array(), |
| [4081](#L4081) | 'include' => array(), |
| [4082](#L4082) | 'meta\_key' => '', |
| [4083](#L4083) | 'meta\_value' => '', |
| [4084](#L4084) | 'meta\_value\_lt' => '', |
| [4085](#L4085) | 'meta\_value\_gt' => '', |
| [4086](#L4086) | 'meta\_value\_le' => '', |
| [4087](#L4087) | 'meta\_value\_ge' => '', |
| [4088](#L4088) | 'meta\_value\_like' => '', |
| [4089](#L4089) | 'meta\_value\_format' => 'string', |
| [4090](#L4090) | 'authors' => '', |
| [4091](#L4091) | 'parent' => -1, |
| [4092](#L4092) | 'exclude\_tree' => '', |
| [4093](#L4093) | 'number' => '', |
| [4094](#L4094) | 'offset' => 0, |
| [4095](#L4095) | 'post\_type' => 'page', |
| [4096](#L4096) | 'post\_status' => 'publish', |
| [4097](#L4097) | ); |
| [4098](#L4098) |  |
| [4099](#L4099) | $r = wp\_parse\_args( $args, $defaults ); |
| [4100](#L4100) | $child\_of = (int) $r['child\_of']; |
| [4101](#L4101) | $sort\_order = $r['sort\_order']; |
| [4102](#L4102) | $sort\_column = $r['sort\_column']; |
| [4103](#L4103) | $hierarchical = $r['hierarchical']; |
| [4104](#L4104) | $exclude = $r['exclude']; |
| [4105](#L4105) | $include = $r['include']; |
| [4106](#L4106) | $meta\_key = $r['meta\_key']; |
| [4107](#L4107) | $meta\_value = $r['meta\_value']; |
| [4108](#L4108) | $meta\_value\_lt = $r['meta\_value\_lt']; |
| [4109](#L4109) | $meta\_value\_gt = $r['meta\_value\_gt']; |
| [4110](#L4110) | $meta\_value\_le = $r['meta\_value\_le']; |
| [4111](#L4111) | $meta\_value\_ge = $r['meta\_value\_ge']; |
| [4112](#L4112) | $meta\_value\_like = $r['meta\_value\_like']; |
| [4113](#L4113) | $meta\_value\_format = $r['meta\_value\_format']; |
| [4114](#L4114) | $authors = $r['authors']; |
| [4115](#L4115) | $parent = $r['parent']; |
| [4116](#L4116) | $exclude\_tree = $r['exclude\_tree']; |
| [4117](#L4117) | $number = (int) $r['number']; |
| [4118](#L4118) | $offset = (int) $r['offset']; |
| [4119](#L4119) | $post\_type = $r['post\_type']; |
| [4120](#L4120) | $post\_status = $r['post\_status']; |
| [4121](#L4121) |  |
| [4122](#L4122) | /\* |
| [4123](#L4123) | // Make sure the post type is hierarchical |
| [4124](#L4124) | $hierarchical\_post\_types = get\_post\_types( array( 'hierarchical' => true ) ); |
| [4125](#L4125) | if ( !in\_array( $post\_type, $hierarchical\_post\_types ) ) |
| [4126](#L4126) | return false; |
| [4127](#L4127) | \*/ |
| [4128](#L4128) |  |
| [4129](#L4129) | // Make sure we have a valid post type |
| [4130](#L4130) | if ( !is\_array( $post\_type ) ) |
| [4131](#L4131) | $post\_type = explode( ',', $post\_type ); |
| [4132](#L4132) | if ( array\_diff( $post\_type, get\_post\_types() ) ) |
| [4133](#L4133) | return false; |
| [4134](#L4134) |  |
| [4135](#L4135) | // Make sure we have a valid post status |
| [4136](#L4136) | if ( !is\_array( $post\_status ) ) |
| [4137](#L4137) | $post\_status = explode( ',', $post\_status ); |
| [4138](#L4138) | if ( array\_diff( $post\_status, get\_post\_stati() ) ) |
| [4139](#L4139) | return false; |
| [4140](#L4140) |  |
| [4141](#L4141) | /\* |
| [4142](#L4142) | $cache = array(); |
| [4143](#L4143) | $key = md5( serialize( compact(array\_keys($defaults)) ) ); |
| [4144](#L4144) | if ( $cache = wp\_cache\_get( 'get\_pages', 'posts' ) ) { |
| [4145](#L4145) | if ( is\_array($cache) && isset( $cache[ $key ] ) ) { |
| [4146](#L4146) | $pages = apply\_filters('get\_pages', $cache[ $key ], $r ); |
| [4147](#L4147) | return $pages; |
| [4148](#L4148) | } |
| [4149](#L4149) | } |
| [4150](#L4150) |  |
| [4151](#L4151) | if ( !is\_array($cache) ) |
| [4152](#L4152) | $cache = array(); |
| [4153](#L4153) | \*/ |
| [4154](#L4154) |  |
| [4155](#L4155) | $inclusions = ''; |
| [4156](#L4156) | if ( !empty($include) ) { |
| [4157](#L4157) | $child\_of = 0; //ignore child\_of, parent, exclude, meta\_key, and meta\_value params if using include |
| [4158](#L4158) | $parent = -1; |
| [4159](#L4159) | $exclude = ''; |
| [4160](#L4160) | $meta\_key = ''; |
| [4161](#L4161) | $meta\_value = ''; |
| [4162](#L4162) | $meta\_value\_lt = ''; |
| [4163](#L4163) | $meta\_value\_gt = ''; |
| [4164](#L4164) | $meta\_value\_le = ''; |
| [4165](#L4165) | $meta\_value\_ge = ''; |
| [4166](#L4166) | $meta\_value\_like = ''; |
| [4167](#L4167) | $hierarchical = false; |
| [4168](#L4168) | $incpages = wp\_parse\_id\_list( $include ); |
| [4169](#L4169) | if ( ! empty( $incpages ) ) { |
| [4170](#L4170) | foreach ( $incpages as $incpage ) { |
| [4171](#L4171) | if (empty($inclusions)) |
| [4172](#L4172) | $inclusions = $wpdb->prepare(' AND ( ID = %d ', $incpage); |
| [4173](#L4173) | else |
| [4174](#L4174) | $inclusions .= $wpdb->prepare(' OR ID = %d ', $incpage); |
| [4175](#L4175) | } |
| [4176](#L4176) | } |
| [4177](#L4177) | } |
| [4178](#L4178) | if (!empty($inclusions)) |
| [4179](#L4179) | $inclusions .= ')'; |
| [4180](#L4180) |  |
| [4181](#L4181) | $exclusions = ''; |
| [4182](#L4182) | if ( !empty($exclude) ) { |
| [4183](#L4183) | $expages = wp\_parse\_id\_list( $exclude ); |
| [4184](#L4184) | if ( ! empty( $expages ) ) { |
| [4185](#L4185) | foreach ( $expages as $expage ) { |
| [4186](#L4186) | if (empty($exclusions)) |
| [4187](#L4187) | $exclusions = $wpdb->prepare(' AND ( ID <> %d ', $expage); |
| [4188](#L4188) | else |
| [4189](#L4189) | $exclusions .= $wpdb->prepare(' AND ID <> %d ', $expage); |
| [4190](#L4190) | } |
| [4191](#L4191) | } |
| [4192](#L4192) | } |
| [4193](#L4193) | if (!empty($exclusions)) |
| [4194](#L4194) | $exclusions .= ')'; |
| [4195](#L4195) |  |
| [4196](#L4196) | $author\_query = ''; |
| [4197](#L4197) | if (!empty($authors)) { |
| [4198](#L4198) | $post\_authors = preg\_split('/[\s,]+/',$authors); |
| [4199](#L4199) |  |
| [4200](#L4200) | if ( ! empty( $post\_authors ) ) { |
| [4201](#L4201) | foreach ( $post\_authors as $post\_author ) { |
| [4202](#L4202) | //Do we have an author id or an author login? |
| [4203](#L4203) | if ( 0 == intval($post\_author) ) { |
| [4204](#L4204) | $post\_author = get\_user\_by('login', $post\_author); |
| [4205](#L4205) | if ( empty($post\_author) ) |
| [4206](#L4206) | continue; |
| [4207](#L4207) | if ( empty($post\_author->ID) ) |
| [4208](#L4208) | continue; |
| [4209](#L4209) | $post\_author = $post\_author->ID; |
| [4210](#L4210) | } |
| [4211](#L4211) |  |
| [4212](#L4212) | if ( '' == $author\_query ) |
| [4213](#L4213) | $author\_query = $wpdb->prepare(' post\_author = %d ', $post\_author); |
| [4214](#L4214) | else |
| [4215](#L4215) | $author\_query .= $wpdb->prepare(' OR post\_author = %d ', $post\_author); |
| [4216](#L4216) | } |
| [4217](#L4217) | if ( '' != $author\_query ) |
| [4218](#L4218) | $author\_query = " AND ($author\_query)"; |
| [4219](#L4219) | } |
| [4220](#L4220) | } |
| [4221](#L4221) |  |
| [4222](#L4222) | $allowed\_keys = array('author', 'post\_author', 'date', 'post\_date', 'title', 'post\_title', 'name', 'post\_name', 'modified', |
| [4223](#L4223) | 'post\_modified', 'modified\_gmt', 'post\_modified\_gmt', 'menu\_order', 'parent', 'post\_parent', |
| [4224](#L4224) | 'ID', 'rand', 'comment\_count'); |
| [4225](#L4225) |  |
| [4226](#L4226) | $join = ''; |
| [4227](#L4227) | $where = "$exclusions $inclusions "; |
| [4228](#L4228) | if ( ! ( empty( $meta\_key ) && empty( $meta\_value ) |
| [4229](#L4229) | && empty( $meta\_value\_lt ) && empty( $meta\_value\_gt ) |
| [4230](#L4230) | && empty( $meta\_value\_le ) && empty( $meta\_value\_ge ) |
| [4231](#L4231) | && empty( $meta\_value\_like ) ) ) { |
| [4232](#L4232) | $join = " LEFT JOIN $wpdb->postmeta ON ( $wpdb->posts.ID = $wpdb->postmeta.post\_id )"; |
| [4233](#L4233) | $allowed\_keys[] = 'meta\_key'; |
| [4234](#L4234) | $allowed\_keys[] = 'meta\_value'; |
| [4235](#L4235) |  |
| [4236](#L4236) | // meta\_key and meta\_value might be slashed |
| [4237](#L4237) | $meta\_key = stripslashes($meta\_key); |
| [4238](#L4238) | $meta\_value = stripslashes($meta\_value); |
| [4239](#L4239) | $meta\_value\_lt = stripslashes($meta\_value\_lt); |
| [4240](#L4240) | $meta\_value\_gt = stripslashes($meta\_value\_gt); |
| [4241](#L4241) | $meta\_value\_le = stripslashes($meta\_value\_le); |
| [4242](#L4242) | $meta\_value\_ge = stripslashes($meta\_value\_ge); |
| [4243](#L4243) | $meta\_value\_like = stripslashes($meta\_value\_like); |
| [4244](#L4244) |  |
| [4245](#L4245) | if ( ! empty( $meta\_key ) ) { |
| [4246](#L4246) | $where .= $wpdb->prepare(" AND $wpdb->postmeta.meta\_key = %s", $meta\_key); |
| [4247](#L4247) | } |
| [4248](#L4248) |  |
| [4249](#L4249) | $meta\_value\_field = "$wpdb->postmeta.meta\_value"; |
| [4250](#L4250) | $meta\_value\_timestamp = false; |
| [4251](#L4251) | switch($meta\_value\_format) { |
| [4252](#L4252) | case 'timestamp': |
| [4253](#L4253) | $meta\_value\_field = "TIMESTAMP( $meta\_value\_field )"; |
| [4254](#L4254) | $meta\_value\_param = "FROM\_UNIXTIME( %s )"; |
| [4255](#L4255) | $meta\_value\_timestamp = true; |
| [4256](#L4256) | break; |
| [4257](#L4257) | case 'int': |
| [4258](#L4258) | $meta\_value\_param = "%d"; |
| [4259](#L4259) | break; |
| [4260](#L4260) | case 'float': |
| [4261](#L4261) | $meta\_value\_param = "%f"; |
| [4262](#L4262) | break; |
| [4263](#L4263) | //case 'string': |
| [4264](#L4264) | default: |
| [4265](#L4265) | $meta\_value\_param = "%s"; |
| [4266](#L4266) | } |
| [4267](#L4267) |  |
| [4268](#L4268) | if ( ! empty( $meta\_value ) ) { |
| [4269](#L4269) | if ($meta\_value\_timestamp) { |
| [4270](#L4270) | $meta\_value = strtotime($meta\_value); |
| [4271](#L4271) | } |
| [4272](#L4272) | $where .= $wpdb->prepare(" AND $meta\_value\_field = $meta\_value\_param", $meta\_value); |
| [4273](#L4273) | } |
| [4274](#L4274) | if ( ! empty( $meta\_value\_lt ) ) { |
| [4275](#L4275) | if ($meta\_value\_timestamp) { |
| [4276](#L4276) | $meta\_value\_lt = strtotime($meta\_value\_lt); |
| [4277](#L4277) | } |
| [4278](#L4278) | $where .= $wpdb->prepare(" AND $meta\_value\_field < $meta\_value\_param", $meta\_value\_lt); |
| [4279](#L4279) | } |
| [4280](#L4280) | if ( ! empty( $meta\_value\_gt ) ) { |
| [4281](#L4281) | if ($meta\_value\_timestamp) { |
| [4282](#L4282) | $meta\_value\_gt = strtotime($meta\_value\_gt); |
| [4283](#L4283) | } |
| [4284](#L4284) | $where .= $wpdb->prepare(" AND $meta\_value\_field > $meta\_value\_param", $meta\_value\_gt); |
| [4285](#L4285) | } |
| [4286](#L4286) | if ( ! empty( $meta\_value\_le ) ) { |
| [4287](#L4287) | if ($meta\_value\_timestamp) { |
| [4288](#L4288) | $meta\_value\_le = strtotime($meta\_value\_le); |
| [4289](#L4289) | } |
| [4290](#L4290) | $where .= $wpdb->prepare(" AND $meta\_value\_field <= $meta\_value\_param", $meta\_value\_le); |
| [4291](#L4291) | } |
| [4292](#L4292) | if ( ! empty( $meta\_value\_ge ) ) { |
| [4293](#L4293) | if ($meta\_value\_timestamp) { |
| [4294](#L4294) | $meta\_value\_ge = strtotime($meta\_value\_ge); |
| [4295](#L4295) | } |
| [4296](#L4296) | $where .= $wpdb->prepare(" AND $meta\_value\_field >= $meta\_value\_param", $meta\_value\_ge); |
| [4297](#L4297) | } |
| [4298](#L4298) | if ( ! empty( $meta\_value\_like ) ) { |
| [4299](#L4299) | if ($meta\_value\_timestamp) { |
| [4300](#L4300) | $meta\_value\_like = strtotime($meta\_value\_like); |
| [4301](#L4301) | } |
| [4302](#L4302) | $where .= $wpdb->prepare(" AND $meta\_value\_field like $meta\_value\_param", $meta\_value\_like); |
| [4303](#L4303) | } |
| [4304](#L4304) | } |
| [4305](#L4305) |  |
| [4306](#L4306) | if ( $parent >= 0 ) |
| [4307](#L4307) | $where .= $wpdb->prepare(' AND post\_parent = %d ', $parent); |
| [4308](#L4308) |  |
| [4309](#L4309) |  |
| [4310](#L4310) | if ( 1 == count ( $post\_type ) ) { |
| [4311](#L4311) | $where\_post\_type = $wpdb->prepare( "post\_type = %s", array\_shift( $post\_type ) ); |
| [4312](#L4312) | } else { |
| [4313](#L4313) | $post\_type = implode( "', '", $post\_type ); |
| [4314](#L4314) | $where\_post\_type = "post\_type IN ('$post\_type')"; |
| [4315](#L4315) | } |
| [4316](#L4316) |  |
| [4317](#L4317) | if ( 1 == count( $post\_status ) ) { |
| [4318](#L4318) | $where\_post\_type .= $wpdb->prepare( " AND post\_status = %s", array\_shift( $post\_status ) ); |
| [4319](#L4319) | } else { |
| [4320](#L4320) | $post\_status = implode( "', '", $post\_status ); |
| [4321](#L4321) | $where\_post\_type .= " AND post\_status IN ('$post\_status')"; |
| [4322](#L4322) | } |
| [4323](#L4323) |  |
| [4324](#L4324) | $orderby\_array = array(); |
| [4325](#L4325) | foreach ( explode( ',', $sort\_column ) as $orderby ) { |
| [4326](#L4326) | $orderby = trim( $orderby ); |
| [4327](#L4327) | if ( !in\_array( $orderby, $allowed\_keys ) ) |
| [4328](#L4328) | continue; |
| [4329](#L4329) |  |
| [4330](#L4330) | switch ( $orderby ) { |
| [4331](#L4331) | case 'menu\_order': |
| [4332](#L4332) | break; |
| [4333](#L4333) | case 'ID': |
| [4334](#L4334) | $orderby = "$wpdb->posts.ID"; |
| [4335](#L4335) | break; |
| [4336](#L4336) | case 'rand': |
| [4337](#L4337) | $orderby = 'RAND()'; |
| [4338](#L4338) | break; |
| [4339](#L4339) | case 'comment\_count': |
| [4340](#L4340) | $orderby = "$wpdb->posts.comment\_count"; |
| [4341](#L4341) | break; |
| [4342](#L4342) | case 'meta\_key': |
| [4343](#L4343) | case 'meta\_value': |
| [4344](#L4344) | $orderby = "$wpdb->postmeta.$orderby"; |
| [4345](#L4345) | break; |
| [4346](#L4346) | default: |
| [4347](#L4347) | if ( 0 === strpos( $orderby, 'post\_' ) ) |
| [4348](#L4348) | $orderby = "$wpdb->posts." . $orderby; |
| [4349](#L4349) | else |
| [4350](#L4350) | $orderby = "$wpdb->posts.post\_" . $orderby; |
| [4351](#L4351) | } |
| [4352](#L4352) |  |
| [4353](#L4353) | $orderby\_array[] = $orderby; |
| [4354](#L4354) |  |
| [4355](#L4355) | } |
| [4356](#L4356) | $sort\_column = ! empty( $orderby\_array ) ? implode( ',', $orderby\_array ) : "$wpdb->posts.post\_title"; |
| [4357](#L4357) |  |
| [4358](#L4358) | $sort\_order = strtoupper( $sort\_order ); |
| [4359](#L4359) | if ( '' !== $sort\_order && !in\_array( $sort\_order, array( 'ASC', 'DESC' ) ) ) |
| [4360](#L4360) | $sort\_order = 'ASC'; |
| [4361](#L4361) |  |
| [4362](#L4362) | $query = "SELECT \* FROM $wpdb->posts $join WHERE ($where\_post\_type) $where "; |
| [4363](#L4363) | $query .= $author\_query; |
| [4364](#L4364) | $query .= " ORDER BY " . $sort\_column . " " . $sort\_order ; |
| [4365](#L4365) |  |
| [4366](#L4366) | if ( !empty($number) && !empty($offset) ) { |
| [4367](#L4367) | $query .= $wpdb->prepare(' LIMIT %d, %d', $offset, $number); |
| [4368](#L4368) | } |
| [4369](#L4369) |  |
| [4370](#L4370) | //echo "<!-- accua\_forms\_query:\n$query\n-->"; |
| [4371](#L4371) |  |
| [4372](#L4372) | $pages = $wpdb->get\_results($query); |
| [4373](#L4373) |  |
| [4374](#L4374) | if ( empty($pages) ) { |
| [4375](#L4375) | $pages = apply\_filters('get\_pages', array(), $r); |
| [4376](#L4376) | return $pages; |
| [4377](#L4377) | } |
| [4378](#L4378) |  |
| [4379](#L4379) | // Sanitize before caching so it'll only get done once |
| [4380](#L4380) | $num\_pages = count($pages); |
| [4381](#L4381) | for ($i = 0; $i < $num\_pages; $i++) { |
| [4382](#L4382) | $pages[$i] = sanitize\_post($pages[$i], 'raw'); |
| [4383](#L4383) | } |
| [4384](#L4384) |  |
| [4385](#L4385) | /\* |
| [4386](#L4386) | // Update cache. |
| [4387](#L4387) | update\_post\_cache( $pages ); |
| [4388](#L4388) | \*/ |
| [4389](#L4389) |  |
| [4390](#L4390) | if ( $child\_of || $hierarchical ) |
| [4391](#L4391) | $pages = get\_page\_children($child\_of, $pages); |
| [4392](#L4392) |  |
| [4393](#L4393) | if ( !empty($exclude\_tree) ) { |
| [4394](#L4394) | $exclude = (int) $exclude\_tree; |
| [4395](#L4395) | $children = get\_page\_children($exclude, $pages); |
| [4396](#L4396) | $excludes = array(); |
| [4397](#L4397) | foreach ( $children as $child ) |
| [4398](#L4398) | $excludes[] = $child->ID; |
| [4399](#L4399) | $excludes[] = $exclude; |
| [4400](#L4400) | $num\_pages = count($pages); |
| [4401](#L4401) | for ( $i = 0; $i < $num\_pages; $i++ ) { |
| [4402](#L4402) | if ( in\_array($pages[$i]->ID, $excludes) ) |
| [4403](#L4403) | unset($pages[$i]); |
| [4404](#L4404) | } |
| [4405](#L4405) | } |
| [4406](#L4406) |  |
| [4407](#L4407) | $pages = apply\_filters('get\_pages', $pages, $r); |
| [4408](#L4408) |  |
| [4409](#L4409) | return $pages; |
| [4410](#L4410) | } |
| [4411](#L4411) |  |
| [4412](#L4412) | function accua\_forms\_trash\_submission($id\_sub){ |
| [4413](#L4413) | global $wpdb; |
| [4414](#L4414) | return $wpdb->query($wpdb->prepare("UPDATE `{$wpdb->prefix}accua\_forms\_submissions` SET afs\_status = -1 WHERE afs\_id = %d", $id\_sub)) !== FALSE; |
| [4415](#L4415) | } |
| [4416](#L4416) |  |
| [4417](#L4417) | function accua\_forms\_get\_lead\_statuses() { |
| [4418](#L4418) | static $statuses = NULL; |
| [4419](#L4419) | if ($statuses === NULL) { |
| [4420](#L4420) | $statuses = array( |
| [4421](#L4421) | 0 => \_\_('Undefined', 'contact-forms'), |
| [4422](#L4422) | -1 => \_\_('Spam', 'contact-forms'), |
| [4423](#L4423) | 1 => \_\_('Job Candidate', 'contact-forms'), |
| [4424](#L4424) | 2 => \_\_('Lead', 'contact-forms'), |
| [4425](#L4425) | 3 => \_\_('Prospect', 'contact-forms'), |
| [4426](#L4426) | 4 => \_\_('Opportunity', 'contact-forms'), |
| [4427](#L4427) | 5 => \_\_('Customer', 'contact-forms'), |
| [4428](#L4428) | 6 => \_\_('Supplier', 'contact-forms'), |
| [4429](#L4429) | 7 => \_\_('Other', 'contact-forms'), |
| [4430](#L4430) | ); |
| [4431](#L4431) | } |
| [4432](#L4432) | return $statuses; |
| [4433](#L4433) | } |
| [4434](#L4434) |  |
| [4435](#L4435) | function accua\_forms\_select\_lead\_status($subid, $original\_lead\_status) { |
| [4436](#L4436) | static $accuaHelp = NULL; |
| [4437](#L4437) | if ($accuaHelp === NULL) { |
| [4438](#L4438) | if (!class\_exists('AccuaFormsHelp')) { |
| [4439](#L4439) | require\_once('accua-forms-help.php'); |
| [4440](#L4440) | } |
| [4441](#L4441) | $accuaHelp = AccuaFormsHelp::getInstance(); |
| [4442](#L4442) | } |
| [4443](#L4443) | $nonce = htmlspecialchars(\_accua\_forms\_json\_encode(wp\_create\_nonce( "set\_lead\_status\_$subid" )),ENT\_QUOTES); |
| [4444](#L4444) | $ret = "<select onchange=\"accua\_forms\_set\_lead\_status(this, $subid, $nonce, $original\_lead\_status)\">"; |
| [4445](#L4445) | $statuses = accua\_forms\_get\_lead\_statuses(); |
| [4446](#L4446) | foreach ($statuses as $k => $l) { |
| [4447](#L4447) | $selected = ($k == $original\_lead\_status) ? ' selected="selected" ' : ''; |
| [4448](#L4448) | $ret .= "<option value=\"$k\"$selected>" . htmlspecialchars($l) . "</option>"; |
| [4449](#L4449) | } |
| [4450](#L4450) | $ret .= "</select>" . $accuaHelp->add\_pointer('contact\_forms\_lead\_statuses') . "<span class='accua-forms-select-lead-status-progress'></span>"; |
| [4451](#L4451) | return $ret; |
| [4452](#L4452) | } |
| [4453](#L4453) |  |
| [4454](#L4454) | add\_action( 'wp\_ajax\_accua-forms-set-lead-status' , 'accua\_forms\_set\_lead\_status'); |
| [4455](#L4455) | function accua\_forms\_set\_lead\_status() { |
| [4456](#L4456) | if (!current\_user\_can('manage\_options')){ |
| [4457](#L4457) | wp\_die(0, 403); |
| [4458](#L4458) | } |
| [4459](#L4459) | $post = $\_POST + array( |
| [4460](#L4460) | 'subid' => 0, |
| [4461](#L4461) | 'lead\_status' => 0, |
| [4462](#L4462) | ); |
| [4463](#L4463) | $subid = (int) $post['subid']; |
| [4464](#L4464) |  |
| [4465](#L4465) | if ($subid) { |
| [4466](#L4466) | check\_ajax\_referer("set\_lead\_status\_$subid", '\_nonce\_set\_lead\_status'); |
| [4467](#L4467) | $lead\_status = (int) $post['lead\_status']; |
| [4468](#L4468) | $statuses = accua\_forms\_get\_lead\_statuses(); |
| [4469](#L4469) | if (isset($statuses[$lead\_status])) { |
| [4470](#L4470) | global $wpdb; |
| [4471](#L4471) | $ret = $wpdb->update("{$wpdb->prefix}accua\_forms\_submissions", |
| [4472](#L4472) | array('afs\_lead\_status' => $lead\_status), |
| [4473](#L4473) | array('afs\_id' => $subid), |
| [4474](#L4474) | '%d', '%d' |
| [4475](#L4475) | ); |
| [4476](#L4476) | if ($ret !== FALSE) { |
| [4477](#L4477) | wp\_die(1, 200); |
| [4478](#L4478) | } |
| [4479](#L4479) | } |
| [4480](#L4480) | } |
| [4481](#L4481) | wp\_die(0, 500); |
| [4482](#L4482) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/contact-forms/trunk/accua-forms.php?format=txt)
* [Original Format](/export/3222464/contact-forms/trunk/accua-forms.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_1a46d0b7_20250114_195442.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D2924628%2540contact-forms%26old%3D2924628%2540contact-forms)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/2918570/contact-forms "Changeset 2918570 for contact-forms")
* [Next Change](/changeset/2942913/contact-forms "Changeset 2942913 for contact-forms") →

---

# Changeset [2924628](/changeset/2924628 "Show full changeset") for [contact-forms](/browser/contact-forms?rev=2924628 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
06/12/2023 07:53:19 AM
([19 months](/timeline?from=2023-06-12T07%3A53%3A19Z&precision=second "See timeline at 06/12/2023 07:53:19 AM") ago)

Author:
cimatti
Message:

=1.5.8=

Location:
[contact-forms](/browser/contact-forms?rev=2924628)
Files:

40 edited
1 copied

* [tags/1.5.8](/browser/contact-forms/tags/1.5.8?rev=2924628 "Show entry in browser")
  (copied)
  *(copied from [contact-forms/trunk](/browser/contact-forms/trunk?rev=2918570 "Show original file (revision 2924627)"))*
* [tags/1.5.8/AccuaForm.php](/browser/contact-forms/tags/1.5.8/AccuaForm.php?rev=2924628 "Show entry in browser")
  (modified)
  ([7 diffs](#file1 "Show differences"))
* [tags/1.5.8/accua-forms-dashboard.php](/browser/contact-forms/tags/1.5.8/accua-forms-dashboard.php?rev=2924628 "Show entry in browser")
  (modified)
  ([9 diffs](#file2 "Show differences"))
* [tags/1.5.8/accua-forms-help.php](/browser/contact-forms/tags/1.5.8/accua-forms-help.php?rev=2924628 "Show entry in browser")
  (modified)
  ([4 diffs](#file3 "Show differences"))
* [tags/1.5.8/accua-forms-list-page.php](/browser/contact-forms/tags/1.5.8/accua-forms-list-page.php?rev=2924628 "Show entry in browser")
  (modified)
  ([4 diffs](#file4 "Show differences"))
* [tags/1.5.8/accua-forms-single-submission.php](/browser/contact-forms/tags/1.5.8/accua-forms-single-submission.php?rev=2924628 "Show entry in browser")
  (modified)
  ([7 diffs](#file5 "Show differences"))
* [tags/1.5.8/accua-forms-submissions-page.php](/browser/contact-forms/tags/1.5.8/accua-forms-submissions-page.php?rev=2924628 "Show entry in browser")
  (modified)
  ([3 diffs](#file6 "Show differences"))
* [tags/1.5.8/accua-forms.php](/browser/contact-forms/tags/1.5.8/accua-forms.php?rev=2924628 "Show entry in browser")
  (modified)
  ([32 diffs](#file7 "Show differences"))
* [tags/1.5.8/classes/Element/Captcha2.php](/browser/contact-forms/tags/1.5.8/classes/Element/Captcha2.php?rev=2924628 "Show entry in browser")
  (modified)
  ([2 diffs](#file8 "Show differences"))
* [tags/1.5.8/classes/Element/Date.php](/browser/contact-forms/tags/1.5.8/classes/Element/Date.php?rev=2924628 "Show entry in browser")
  (modified)
  ([1 diff](#file9 "Show differences"))
* [tags/1.5.8/classes/Validation/Date.php](/browser/contact-forms/tags/1.5.8/classes/Validation/Date.php?rev=2924628 "Show entry in browser")
  (modified)
  ([1 diff](#file10 "Show differences"))
* [tags/1.5.8/contact-forms.php](/browser/contact-forms/tags/1.5.8/contact-forms.php?rev=2924628 "Show entry in browser")
  (modified)
  ([6 diffs](#file11 "Show differences"))
* [tags/1.5.8/form-fields.js](/browser/contact-forms/tags/1.5.8/form-fields.js?rev=2924628 "Show entry in browser")
  (modified)
  ([2 diffs](#file12 "Show differences"))
* [tags/1.5.8/form-settings.js](/browser/contact-forms/tags/1.5.8/form-settings.js?rev=2924628 "Show entry in browser")
  (modified)
  ([1 diff](#file13 "Show differences"))
* [tags/1.5.8/languages/contact-forms-de\_DE.mo](/browser/contact-forms/tags/1.5.8/languages/contact-forms-de_DE.mo?rev=2924628 "Show entry in browser")
  (modified)
  ([previous](/browser/contact-forms/trunk/languages/contact-forms-de_DE.mo?rev=1401405 "Show previous version in browser"))
* [tags/1.5.8/languages/contact-forms-es\_ES.mo](/browser/contact-forms/tags/1.5.8/languages/contact-forms-es_ES.mo?rev=2924628 "Show entry in browser")
  (modified)
  ([previous](/browser/contact-forms/trunk/languages/contact-forms-es_ES.mo?rev=1401405 "Show previous version in browser"))
* [tags/1.5.8/languages/contact-forms-es\_ES.po](/browser/contact-forms/tags/1.5.8/languages/contact-forms-es_ES.po?rev=2924628 "Show entry in browser")
  (modified)
  ([1 diff](#file16 "Show differences"))
* [tags/1.5.8/languages/contact-forms-it\_IT.mo](/browser/contact-forms/tags/1.5.8/languages/contact-forms-it_IT.mo?rev=2924628 "Show entry in browser")
  (modified)
  ([previous](/browser/contact-forms/trunk/languages/contact-forms-it_IT.mo?rev=2879909 "Show previous version in browser"))
* [tags/1.5.8/languages/contact-forms-it\_IT.po](/browser/contact-forms/tags/1.5.8/languages/contact-forms-it_IT.po?rev=2924628 "Show entry in browser")
  (modified)
  ([30 diffs](#file18 "Show differences"))
* [tags/1.5.8/phpseclib-crypt/Base.php](/browser/contact-forms/tags/1.5.8/phpseclib-crypt/Base.php?rev=2924628 "Show entry in browser")
  (modified)
  ([1 diff](#file19 "Show differences"))
* [tags/1.5.8/readme.txt](/browser/contact-forms/tags/1.5.8/readme.txt?rev=2924628 "Show entry in browser")
  (modified)
  ([3 diffs](#file20 "Show differences"))
* [trunk/AccuaForm.php](/browser/contact-forms/trunk/AccuaForm.php?rev=2924628 "Show entry in browser")
  (modified)
  ([7 diffs](#file21 "Show differences"))
* [trunk/accua-forms-dashboard.php](/browser/contact-forms/trunk/accua-forms-dashboard.php?rev=2924628 "Show entry in browser")
  (modified)
  ([9 diffs](#file22 "Show differences"))
* [trunk/accua-forms-help.php](/browser/contact-forms/trunk/accua-forms-help.php?rev=2924628 "Show entry in browser")
  (modified)
  ([4 diffs](#file23 "Show differences"))
* [trunk/accua-forms-list-page.php](/browser/contact-forms/trunk/accua-forms-list-page.php?rev=2924628 "Show entry in browser")
  (modified)
  ([4 diffs](#file24 "Show differences"))
* [trunk/accua-forms-single-submission.php](/browser/contact-forms/trunk/accua-forms-single-submission.php?rev=2924628 "Show entry in browser")
  (modified)
  ([7 diffs](#file25 "Show differences"))
* [trunk/accua-forms-submissions-page.php](/browser/contact-forms/trunk/accua-forms-submissions-page.php?rev=2924628 "Show entry in browser")
  (modified)
  ([3 diffs](#file26 "Show differences"))
* [trunk/accua-forms.php](/browser/contact-forms/trunk/accua-forms.php?rev=2924628 "Show entry in browser")
  (modified)
  ([32 diffs](#file27 "Show differences"))
* [trunk/classes/Element/Captcha2.php](/browser/contact-forms/trunk/classes/Element/Captcha2.php?rev=2924628 "Show entry in browser")
  (modified)
  ([2 diffs](#file28 "Show differences"))
* [trunk/classes/Element/Date.php](/browser/contact-forms/trunk/classes/Element/Date.php?rev=2924628 "Show entry in browser")
  (modified)
  ([1 diff](#file29 "Show differences"))
* [trunk/classes/Validation/Date.php](/browser/contact-forms/trunk/classes/Validation/Date.php?rev=2924628 "Show entry in browser")
  (modified)
  ([1 diff](#file30 "Show differences"))
* [trunk/contact-forms.php](/browser/contact-forms/trunk/contact-forms.php?rev=2924628 "Show entry in browser")
  (modified)
  ([6 diffs](#file31 "Show differences"))
* [trunk/form-fields.js](/browser/contact-forms/trunk/form-fields.js?rev=2924628 "Show entry in browser")
  (modified)
  ([2 diffs](#file32 "Show differences"))
* [trunk/form-settings.js](/browser/contact-forms/trunk/form-settings.js?rev=2924628 "Show entry in browser")
  (modified)
  ([1 diff](#file33 "Show differences"))
* [trunk/languages/contact-forms-de\_DE.mo](/browser/contact-forms/trunk/languages/contact-forms-de_DE.mo?rev=2924628 "Show entry in browser")
  (modified)
  ([previous](/browser/contact-forms/trunk/languages/contact-forms-de_DE.mo?rev=1401405 "Show previous version in browser"))
* [trunk/languages/contact-forms-es\_ES.mo](/browser/contact-forms/trunk/languages/contact-forms-es_ES.mo?rev=2924628 "Show entry in browser")
  (modified)
  ([previous](/browser/contact-forms/trunk/languages/contact-forms-es_ES.mo?rev=1401405 "Show previous version in browser"))
* [trunk/languages/contact-forms-es\_ES.po](/browser/contact-forms/trunk/languages/contact-forms-es_ES.po?rev=2924628 "Show entry in browser")
  (modified)
  ([1 diff](#file36 "Show differences"))
* [trunk/languages/contact-forms-it\_IT.mo](/browser/contact-forms/trunk/languages/contact-forms-it_IT.mo?rev=2924628 "Show entry in browser")
  (modified)
  ([previous](/browser/contact-forms/trunk/languages/contact-forms-it_IT.mo?rev=2879909 "Show previous version in browser"))
* [trunk/languages/contact-forms-it\_IT.po](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2924628 "Show entry in browser")
  (modified)
  ([30 diffs](#file38 "Show differences"))
* [trunk/phpseclib-crypt/Base.php](/browser/contact-forms/trunk/phpseclib-crypt/Base.php?rev=2924628 "Show entry in browser")
  (modified)
  ([1 diff](#file39 "Show differences"))
* [trunk/readme.txt](/browser/contact-forms/trunk/readme.txt?rev=2924628 "Show entry in browser")
  (modified)
  ([3 diffs](#file40 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [contact-forms/tags/1.5.8/AccuaForm.php](/changeset/2924628/contact-forms/tags/1.5.8/AccuaForm.php "Show the changeset 2924628 restricted to contact-forms/tags/1.5.8/AccuaForm.php")

  | [r2879909](/browser/contact-forms/trunk/AccuaForm.php?rev=2879909#L696 "Show revision 2879909 of this file in browser") | [r2924628](/browser/contact-forms/tags/1.5.8/AccuaForm.php?rev=2924628#L696 "Show revision 2924628 of this file in browser") |  |
  | --- | --- | --- |
  | 696 | 696 | echo <<<JS |
  | 697 | 697 | <script type="text/javascript"> |
  | 698 |  | //<![CDATA[ |
  |  | 698 | <!-- |
  | 699 | 699 | var \_handle\_ajax\_submit\_{$js\_buildid} = function() {return true;} |
  | 700 | 700 | var \_handle\_ajax\_submit\_complete\_{$js\_buildid} = function() {return false;} |
  | […](/browser/contact-forms/trunk/AccuaForm.php?rev=2879909#L986) | […](/browser/contact-forms/tags/1.5.8/AccuaForm.php?rev=2924628#L986) |  |
  | 986 | 986 | thisform.attr("onsubmit","return \_handle\_ajax\_submit\_{$js\_buildid}()"); |
  | 987 | 987 | }); |
  | 988 |  | //~~]]~~> |
  |  | 988 | // --> |
  | 989 | 989 | </script> |
  | 990 | 990 | <iframe id="submit\_target\_{$js\_buildid}" title="" name="submit\_target\_{$js\_buildid}" onload="\_handle\_ajax\_submit\_complete\_{$js\_buildid}()" onerror="\_handle\_ajax\_submit\_complete\_{$js\_buildid}()" style="width:0;height:0;border:0px solid #fff"></iframe> |
  | […](/browser/contact-forms/trunk/AccuaForm.php?rev=2879909#L994) | […](/browser/contact-forms/tags/1.5.8/AccuaForm.php?rev=2924628#L994) |  |
  | 994 | 994 | echo <<<JSREFERRER |
  | 995 | 995 | <script type="text/javascript"> |
  |  | 996 | <!-- |
  | 996 | 997 | jQuery(function($){ |
  | 997 | 998 | var referrerfield = $("#{$this->buildID} input[name='\_AccuaForm\_referrer']"); |
  | […](/browser/contact-forms/trunk/AccuaForm.php?rev=2879909#L1002) | […](/browser/contact-forms/tags/1.5.8/AccuaForm.php?rev=2924628#L1003) |  |
  | 1002 | 1003 | $("#{$this->buildID} input[name='\_AccuaForm\_platform']").val(navigator.platform); |
  | 1003 | 1004 | }); |
  |  | 1005 | // --> |
  | 1004 | 1006 | </script> |
  | 1005 | 1007 | JSREFERRER; |
  | […](/browser/contact-forms/trunk/AccuaForm.php?rev=2879909#L1015) | […](/browser/contact-forms/tags/1.5.8/AccuaForm.php?rev=2924628#L1017) |  |
  | 1015 | 1017 | $this->renderJSFiles(); |
  | 1016 | 1018 |  |
  | 1017 |  | echo '<script type="text/javascript">'; |
  |  | 1019 | echo <<<JS |
  |  | 1020 | <script type="text/javascript"> |
  |  | 1021 | <!-- |
  |  | 1022 |  |
  |  | 1023 | JS; |
  | 1018 | 1024 | $this->view->renderJS(); |
  | 1019 | 1025 | foreach($this->elements as $element) |
  | […](/browser/contact-forms/trunk/AccuaForm.php?rev=2879909#L1028) | […](/browser/contact-forms/tags/1.5.8/AccuaForm.php?rev=2924628#L1034) |  |
  | 1028 | 1034 |  |
  | 1029 | 1035 | $this->view->jQueryDocumentReady(); |
  | 1030 |  | foreach($this->elements as $element) |
  |  | 1036 | foreach($this->elements as $element) { |
  | 1031 | 1037 | $element->jQueryDocumentReady(); |
  |  | 1038 | } |
  | 1032 | 1039 |  |
  | 1033 | 1040 | /\*For ajax, an anonymous onsubmit javascript function is bound to the form using jQuery.  jQuery's |
  | […](/browser/contact-forms/trunk/AccuaForm.php?rev=2879909#L1065) | […](/browser/contact-forms/tags/1.5.8/AccuaForm.php?rev=2924628#L1072) |  |
  | 1065 | 1072 | echo <<<JS |
  | 1066 | 1073 | }); |
  |  | 1074 | // --> |
  | 1067 | 1075 | </script> |
  | 1068 | 1076 | JS; |
* ## [contact-forms/tags/1.5.8/accua-forms-dashboard.php](/changeset/2924628/contact-forms/tags/1.5.8/accua-forms-dashboard.php "Show the changeset 2924628 restricted to contact-forms/tags/1.5.8/accua-forms-dashboard.php")

  | [r2880592](/browser/contact-forms/trunk/accua-forms-dashboard.php?rev=2880592#L24 "Show revision 2880592 of this file in browser") | [r2924628](/browser/contact-forms/tags/1.5.8/accua-forms-dashboard.php?rev=2924628#L24 "Show revision 2924628 of this file in browser") |  |
  | --- | --- | --- |
  | 24 | 24 | $avail\_fields = get\_option('accua\_forms\_avail\_fields', array()); |
  | 25 | 25 | foreach($avail\_fields as $key=>$single\_field){ |
  | 26 |  | if($single\_field['type'] == 'email' || $single\_field['type'] == 'autoreply\_email') |
  | 27 |  | $email\_fields[] = "'".$key."'"; |
  | 28 |  | } |
  | 29 |  | $email\_fields\_string = implode(',',$email\_fields); |
  | 30 |  | $num\_emails = $wpdb->get\_results("SELECT COUNT(DISTINCT (`afsv\_value`)) as num\_row |
  |  | 26 | if($single\_field['type'] == 'email' || $single\_field['type'] == 'autoreply\_email') { |
  |  | 27 | $email\_fields[] = $wpdb->prepare('%s', $key); |
  |  | 28 | } |
  |  | 29 | } |
  |  | 30 | if ($email\_fields) { |
  |  | 31 | $email\_fields\_string = implode(',', $email\_fields); |
  |  | 32 | $num\_emails = $wpdb->get\_results("SELECT COUNT(DISTINCT (`afsv\_value`)) as num\_row |
  | 31 | 33 | FROM {$wpdb->prefix}accua\_forms\_submissions, {$wpdb->prefix}accua\_forms\_submissions\_values |
  | 32 | 34 | WHERE `afs\_id` = `afsv\_sub\_id` |
  | 33 | 35 | AND afsv\_field\_id IN ({$email\_fields\_string}) |
  | 34 | 36 | AND afs\_status >= 0", ARRAY\_A); |
  |  | 37 | } else { |
  |  | 38 | $num\_emails = 0; |
  |  | 39 | } |
  | 35 | 40 |  |
  | 36 | 41 |  |
  | […](/browser/contact-forms/trunk/accua-forms-dashboard.php?rev=2880592#L60) | […](/browser/contact-forms/tags/1.5.8/accua-forms-dashboard.php?rev=2924628#L65) |  |
  | 60 | 65 | if(isset($\_POST['del\_sub\_form'])) { |
  | 61 | 66 | $id = (int)$\_POST['del\_sub\_form']; |
  |  | 67 | check\_admin\_referer("del\_sub\_form\_{$id}", "\_wpnonce\_del\_sub\_form"); |
  | 62 | 68 | accua\_forms\_trash\_submission($id); |
  | 63 | 69 | } |
  | 64 | 70 |  |
  | 65 |  | //costruisco il grafico |
  | 66 |  | $query\_grafico = $wpdb->get\_results("SELECT YEAR( afs\_submitted ) AS `year` , MONTH( afs\_submitted ) AS `month` , COUNT( DISTINCT (`afs\_id`) ) AS `submissions` , COUNT( DISTINCT (`afsv\_value`)) AS `unique\_submissions` |
  |  | 71 | $label\_my = array(); |
  |  | 72 | $submissions = array(); |
  |  | 73 | $unique\_submissions = array(); |
  |  | 74 | $origin\_label\_my = array(); |
  |  | 75 |  |
  |  | 76 | if ($email\_fields) { |
  |  | 77 | //costruisco il grafico |
  |  | 78 | $query\_grafico = $wpdb->get\_results("SELECT YEAR( afs\_submitted ) AS `year` , MONTH( afs\_submitted ) AS `month` , COUNT( DISTINCT (`afs\_id`) ) AS `submissions` , COUNT( DISTINCT (`afsv\_value`)) AS `unique\_submissions` |
  | 67 | 79 | FROM `{$wpdb->prefix}accua\_forms\_submissions` |
  | 68 | 80 | LEFT JOIN `{$wpdb->prefix}accua\_forms\_submissions\_values` ON `afs\_id` = `afsv\_sub\_id` |
  | […](/browser/contact-forms/trunk/accua-forms-dashboard.php?rev=2880592#L73) | […](/browser/contact-forms/tags/1.5.8/accua-forms-dashboard.php?rev=2924628#L85) |  |
  | 73 | 85 | ORDER BY `year` DESC , `month` DESC"); |
  | 74 | 86 |  |
  | 75 |  | if($query\_grafico){ |
  | 76 |  | $label\_my = array(); |
  | 77 |  | $submissions = array(); |
  | 78 |  | $unique\_submissions = array(); |
  | 79 |  | /\* cicliamo per ogni mese in modo da riempire con 0 i mesi senza compilazioni \*/ |
  | 80 |  | for($i=date('Y'); $i>=$query\_grafico[count($query\_grafico)-1]->year; $i-- ) { |
  | 81 |  | $start\_month=12; |
  | 82 |  | $end\_month = 1; |
  | 83 |  | if($i==date('Y')) $start\_month= date('n'); |
  | 84 |  | if($i==$query\_grafico[count($query\_grafico)-1]->year) $end\_month=$query\_grafico[count($query\_grafico)-1]->month; |
  | 85 |  | for($j=$start\_month;$j>=$end\_month;$j--) { |
  | 86 |  | $find=false; |
  | 87 |  | foreach ($query\_grafico as $result){ |
  | 88 |  | if(!$find && (int)$result->year == $i && (int)$result->month==$j) { |
  | 89 |  | $label\_my[] =  $j .'/'. $i; |
  | 90 |  | $submissions[] = (int)$result->submissions; |
  | 91 |  | $unique\_submissions[] = (int)$result->unique\_submissions; |
  | 92 |  | $find=true; |
  |  | 87 | if ($query\_grafico) { |
  |  | 88 | /\* cicliamo per ogni mese in modo da riempire con 0 i mesi senza compilazioni \*/ |
  |  | 89 | for ($i = date('Y'); $i >= $query\_grafico[count($query\_grafico) - 1]->year; $i--) { |
  |  | 90 | $start\_month = 12; |
  |  | 91 | $end\_month = 1; |
  |  | 92 | if ($i == date('Y')) $start\_month = date('n'); |
  |  | 93 | if ($i == $query\_grafico[count($query\_grafico) - 1]->year) $end\_month = $query\_grafico[count($query\_grafico) - 1]->month; |
  |  | 94 | for ($j = $start\_month; $j >= $end\_month; $j--) { |
  |  | 95 | $find = false; |
  |  | 96 | foreach ($query\_grafico as $result) { |
  |  | 97 | if (!$find && (int)$result->year == $i && (int)$result->month == $j) { |
  |  | 98 | $label\_my[] = $j . '/' . $i; |
  |  | 99 | $submissions[] = (int)$result->submissions; |
  |  | 100 | $unique\_submissions[] = (int)$result->unique\_submissions; |
  |  | 101 | $find = true; |
  |  | 102 | } |
  |  | 103 | } |
  |  | 104 | if (!$find) { |
  |  | 105 | $label\_my[] = $j . '/' . $i; |
  |  | 106 | $submissions[] = 0; |
  |  | 107 | $unique\_submissions[] = 0; |
  |  | 108 |  |
  | 93 | 109 | } |
  | 94 | 110 | } |
  | 95 |  | ~~if(!$find)~~ |
  | 96 |  | ~~{~~ |
  | 97 |  | ~~$label\_my[] = $j .'/'. $i;~~ |
  | 98 |  | ~~$submissions[] = 0;~~ |
  | 99 |  | ~~$unique\_submissions[] = 0;~~ |
  | 100 |  |  |
  | 101 |  | ~~}~~ |
  | 102 | 111 | } |
  |  | 112 | $origin\_label\_my = $label\_my; |
  |  | 113 | $origin\_submissions = $submissions; |
  |  | 114 | $origin\_unique\_submissions = $unique\_submissions; |
  |  | 115 |  |
  |  | 116 | if ($period != -1) { |
  |  | 117 | $label\_my = array\_slice($label\_my, 0, $period); |
  |  | 118 | $submissions = array\_slice($submissions, 0, $period); |
  |  | 119 | $unique\_submissions = array\_slice($unique\_submissions, 0, $period); |
  |  | 120 | } |
  |  | 121 |  |
  |  | 122 | $label\_my = array\_reverse($label\_my); |
  |  | 123 | $submissions = array\_reverse($submissions); |
  |  | 124 | $unique\_submissions = array\_reverse($unique\_submissions); |
  | 103 | 125 | } |
  | 104 |  | ~~$origin\_label\_my = $label\_my;~~ |
  | 105 |  | ~~$origin\_submissions = $submissions;~~ |
  | 106 |  | ~~$origin\_unique\_submissions = $unique\_submissions;~~ |
  | 107 |  |  |
  | 108 |  | ~~if($period != -1){~~ |
  | 109 |  | ~~$label\_my = array\_slice($label\_my, 0, $period);~~ |
  | 110 |  | ~~$submissions = array\_slice($submissions, 0, $period);~~ |
  | 111 |  | ~~$unique\_submissions = array\_slice($unique\_submissions, 0, $period);~~ |
  | 112 |  | ~~}~~ |
  | 113 |  |  |
  | 114 |  | ~~$label\_my = array\_reverse($label\_my);~~ |
  | 115 |  | ~~$submissions = array\_reverse($submissions);~~ |
  | 116 |  | ~~$unique\_submissions = array\_reverse($unique\_submissions);~~ |
  | 117 | 126 | } |
  | 118 | 127 |  |
  | […](/browser/contact-forms/trunk/accua-forms-dashboard.php?rev=2880592#L233) | […](/browser/contact-forms/tags/1.5.8/accua-forms-dashboard.php?rev=2924628#L242) |  |
  | 233 | 242 | var ctx = document.getElementById('ContactChart').getContext('2d'); |
  | 234 | 243 | var myChart = new Chart(ctx, config); |
  | 235 |  | ~~console.log('chart initialized', myChart); //todo: togliere prima di pubblicare~~ |
  |  | 244 | //console.log('chart initialized', myChart); |
  | 236 | 245 |  |
  | 237 | 246 | function update\_mychart\_submissions(item, index) { |
  | […](/browser/contact-forms/trunk/accua-forms-dashboard.php?rev=2880592#L301) | […](/browser/contact-forms/tags/1.5.8/accua-forms-dashboard.php?rev=2924628#L310) |  |
  | 301 | 310 | foreach ($data\_last\_submissions as $row) { |
  | 302 | 311 | /\* problema: i campi nome e cognome sono spesso diversi |
  | 303 |  | ~~cimatti.it -> nome e cognome~~ |
  | 304 |  | ~~comecer.com -> firstname e last~~name |
  | 305 |  | ~~ultimi siti -> first\_name e last\_name~~ |
  | 306 |  | \*/ |
  |  | 312 | in origine non erano creati in modo predefinito e in ogni sito possono essere diversi. |
  |  | 313 | Ora sono di default sono first\_name e last\_name |
  |  | 314 | ma comunque anche ora possono essere eliminati e se ne possono usare altri |
  |  | 315 |  |
  | 307 | 316 | $query\_meta\_submission\_nome = "SELECT `afsv\_value` |
  | 308 | 317 | FROM `{$wpdb->prefix}accua\_forms\_submissions\_values` |
  | […](/browser/contact-forms/trunk/accua-forms-dashboard.php?rev=2880592#L314) | […](/browser/contact-forms/tags/1.5.8/accua-forms-dashboard.php?rev=2924628#L323) |  |
  | 314 | 323 | WHERE `afsv\_sub\_id` = %d |
  | 315 | 324 | AND `afsv\_field\_id` LIKE 'cognome'"; |
  | 316 |  |  |
  |  | 325 | \*/ |
  | 317 | 326 | $query\_meta\_submission\_email = "SELECT `afsv\_value` |
  | 318 | 327 | FROM `{$wpdb->prefix}accua\_forms\_submissions\_values` |
  | […](/browser/contact-forms/trunk/accua-forms-dashboard.php?rev=2880592#L327) | […](/browser/contact-forms/tags/1.5.8/accua-forms-dashboard.php?rev=2924628#L336) |  |
  | 327 | 336 | WHERE `afs\_id` = %d"; |
  | 328 | 337 |  |
  | 329 |  | $data\_meta\_submission\_nome = $wpdb->get\_var($wpdb->prepare($query\_meta\_submission\_nome, $row->afs\_id)); |
  | 330 |  | $data\_meta\_submission\_cognome = $wpdb->get\_var($wpdb->prepare($query\_meta\_submission\_cognome, $row->afs\_id)); |
  | 331 |  | $data\_meta\_submission\_email = $wpdb->get\_var($wpdb->prepare($query\_meta\_submission\_email, $row->afs\_id)); |
  | 332 |  | $data\_meta\_submission\_uri = $wpdb->get\_var($wpdb->prepare($query\_data\_submission\_uri, $row->afs\_id)); |
  | 333 |  | $data\_meta\_submission\_ref = $wpdb->get\_var($wpdb->prepare($query\_data\_submission\_ref, $row->afs\_id)); |
  | 334 |  |  |
  |  | 338 | //$data\_meta\_submission\_nome = $wpdb->get\_var($wpdb->prepare($query\_meta\_submission\_nome, $row->afs\_id)); |
  |  | 339 | //$data\_meta\_submission\_cognome = $wpdb->get\_var($wpdb->prepare($query\_meta\_submission\_cognome, $row->afs\_id)); |
  |  | 340 | $data\_meta\_submission\_email = (string) $wpdb->get\_var($wpdb->prepare($query\_meta\_submission\_email, $row->afs\_id)); |
  |  | 341 | $data\_meta\_submission\_uri = (string) $wpdb->get\_var($wpdb->prepare($query\_data\_submission\_uri, $row->afs\_id)); |
  |  | 342 | $data\_meta\_submission\_ref = (string) $wpdb->get\_var($wpdb->prepare($query\_data\_submission\_ref, $row->afs\_id)); |
  | 335 | 343 |  |
  | 336 | 344 | echo '<tr>'; |
  | […](/browser/contact-forms/trunk/accua-forms-dashboard.php?rev=2880592#L342) | […](/browser/contact-forms/tags/1.5.8/accua-forms-dashboard.php?rev=2924628#L350) |  |
  | 342 | 350 | } |
  | 343 | 351 | //echo '<td>'.$data\_meta\_submission\_nome.' '.$data\_meta\_submission\_cognome.'</td>'; |
  | 344 |  | echo '<td>'.~~$data\_meta\_submission\_email~~.'</td>'; |
  |  | 352 | echo '<td>'.htmlspecialchars($data\_meta\_submission\_email).'</td>'; |
  | 345 | 353 | echo '<td>'; |
  | 346 | 354 | //referrer |
  | 347 |  | echo '<a href="'.~~get\_bloginfo('url').$data\_meta\_submission\_ref.'" title="" target="\_blank">'.$data\_meta\_submission\_ref~~.'</a>'; |
  |  | 355 | echo '<a href="'.htmlspecialchars($data\_meta\_submission\_ref, ENT\_QUOTES).'" title="" target="\_blank">'.htmlspecialchars($data\_meta\_submission\_ref, ENT\_QUOTES).'</a>'; |
  | 348 | 356 | echo '</td>'; |
  | 349 | 357 | echo '<td>'; |
  | 350 |  | echo '<a href="'.~~get\_bloginfo('url').$data\_meta\_submission\_uri.'" title="" target="\_blank">'.$data\_meta\_submission\_uri~~.'</a>'; |
  |  | 358 | echo '<a href="'.htmlspecialchars(get\_bloginfo('url').$data\_meta\_submission\_uri, ENT\_QUOTES).'" title="" target="\_blank">'.htmlspecialchars($data\_meta\_submission\_uri, ENT\_QUOTES).'</a>'; |
  | 351 | 359 | echo '</td>'; |
  | 352 | 360 | //echo '<td>valido/non valido/ecc..</td>'; |
  | […](/browser/contact-forms/trunk/accua-forms-dashboard.php?rev=2880592#L355) | […](/browser/contact-forms/tags/1.5.8/accua-forms-dashboard.php?rev=2924628#L363) |  |
  | 355 | 363 | <form id="delete-sub" method="post" action=""> |
  | 356 | 364 | <input type="hidden" name="del\_sub\_form" value="<?php echo $row->afs\_id; ?>" /> |
  |  | 365 | <?php wp\_nonce\_field("del\_sub\_form\_{$row->afs\_id}", "\_wpnonce\_del\_sub\_form"); ?> |
  | 357 | 366 | <input type="submit" id="delete-sub-data" class="accua\_forms\_trash" value="<?php \_e('Trash', 'contact-forms') ?>" onclick='return window.confirm("Are you sure you want to trash this submission?");'/> |
  | 358 | 367 | </form> |
* ## [contact-forms/tags/1.5.8/accua-forms-help.php](/changeset/2924628/contact-forms/tags/1.5.8/accua-forms-help.php "Show the changeset 2924628 restricted to contact-forms/tags/1.5.8/accua-forms-help.php")

  | [r2880279](/browser/contact-forms/trunk/accua-forms-help.php?rev=2880279#L21 "Show revision 2880279 of this file in browser") | [r2924628](/browser/contact-forms/tags/1.5.8/accua-forms-help.php?rev=2924628#L21 "Show revision 2924628 of this file in browser") |  |
  | --- | --- | --- |
  | 21 | 21 | $ret = ''; |
  | 22 | 22 | switch ($name) { |
  | 23 |  | /\*~~contacts-page | query \*/~~ |
  |  | 23 | /\* |
  | 24 | 24 | case 'help\_1': |
  | 25 | 25 | $ret = array( |
  | […](/browser/contact-forms/trunk/accua-forms-help.php?rev=2880279#L33) | […](/browser/contact-forms/tags/1.5.8/accua-forms-help.php?rev=2924628#L33) |  |
  | 33 | 33 | 'text' => \_\_('2', 'contact-forms'). |
  | 34 | 34 | "<br/><dl>". |
  | 35 |  | "<dt>aaaa</dt><dd>". \_\_('bbb', '~~accua-contact~~s')."</dd>". |
  | 36 |  | "<dt>cccc</dt><dd>". \_\_('dddd', '~~accua-contact~~s')."</dd>". |
  |  | 35 | "<dt>aaaa</dt><dd>". \_\_('bbb', 'contact-forms')."</dd>". |
  |  | 36 | "<dt>cccc</dt><dd>". \_\_('dddd', 'contact-forms')."</dd>". |
  | 37 | 37 | "</dl>", |
  |  | 38 | ); |
  |  | 39 | break; |
  |  | 40 | \*/ |
  |  | 41 | case 'form\_edit\_preview': |
  |  | 42 | $ret = array( |
  |  | 43 | 'header' => \_\_('Unstyled Preview', 'contact-forms'), |
  |  | 44 | 'text' => \_\_('This representation does not incorporate the active theme styles of your website. To view the finalized look, integrate this form within your website.', 'contact-forms'), |
  | 38 | 45 | ); |
  | 39 | 46 | break; |
  | […](/browser/contact-forms/trunk/accua-forms-help.php?rev=2880279#L64) | […](/browser/contact-forms/tags/1.5.8/accua-forms-help.php?rev=2924628#L71) |  |
  | 64 | 71 | $id = $this->counter++; |
  | 65 | 72 | //$id = count($this->helpTextSet); |
  | 66 |  | $anchor\_id = "~~tooltipExt~~\_$id"; |
  |  | 73 | $anchor\_id = "accua\_forms\_tooltip\_$id"; |
  | 67 | 74 |  |
  | 68 | 75 | $this->helpTextSet[] = array( |
  | […](/browser/contact-forms/trunk/accua-forms-help.php?rev=2880279#L92) | […](/browser/contact-forms/tags/1.5.8/accua-forms-help.php?rev=2924628#L99) |  |
  | 92 | 99 | // error\_log(print\_r($pointer, true)); |
  | 93 | 100 | ?> |
  | 94 |  | $(~~' <?php echo $pointer['anchor\_id']; ?> '~~).click(function(){ |
  | 95 |  | $(~~' <?php echo $pointer['anchor\_id']; ?> '~~).pointer( { |
  | 96 |  | content: ~~'<?php echo $pointer['content']; ?>'~~, |
  |  | 101 | $(<?php echo \_accua\_forms\_json\_encode($pointer['anchor\_id']); ?>).click(function(){ |
  |  | 102 | $( <?php echo \_accua\_forms\_json\_encode($pointer['anchor\_id']); ?> ).pointer( { |
  |  | 103 | content: <?php echo \_accua\_forms\_json\_encode($pointer['content']); ?>, |
  | 97 | 104 | position: { |
  | 98 |  | edge: ~~'<?php echo $pointer['edge']; ?>'~~, |
  | 99 |  | align: ~~'<?php echo $pointer['align']; ?>'~~ |
  |  | 105 | edge: <?php echo \_accua\_forms\_json\_encode($pointer['edge']); ?>, |
  |  | 106 | align: <?php echo \_accua\_forms\_json\_encode($pointer['align']); ?> |
  | 100 | 107 | }, |
  | 101 | 108 | }).pointer( 'open' ); |
* ## [contact-forms/tags/1.5.8/accua-forms-list-page.php](/changeset/2924628/contact-forms/tags/1.5.8/accua-forms-list-page.php "Show the changeset 2924628 restricted to contact-forms/tags/1.5.8/accua-forms-list-page.php")

  | [r2887413](/browser/contact-forms/trunk/accua-forms-list-page.php?rev=2887413#L51 "Show revision 2887413 of this file in browser") | [r2924628](/browser/contact-forms/tags/1.5.8/accua-forms-list-page.php?rev=2924628#L51 "Show revision 2924628 of this file in browser") |  |
  | --- | --- | --- |
  | 51 | 51 | $item\_name = $item['ID']; |
  | 52 | 52 | } |
  |  | 53 | $nonced\_edit = wp\_nonce\_url('admin.php?page=accua\_forms\_list&amp;fid=' . $item['ID'] . '&amp;restore=1', 'restore\_post'); |
  | 53 | 54 | $actions = array( |
  | 54 |  | 'edit' => "<a href='~~admin.php?page=accua\_forms\_list&amp;fid={$item['ID']}&amp;restore=1~~'>".\_\_("Restore", 'contact-forms')."</a>", |
  |  | 55 | 'edit' => "<a href='" . $nonced\_edit . "'>".\_\_("Restore", 'contact-forms')."</a>", |
  | 55 | 56 | ); |
  | 56 | 57 | return "<strong>".$item\_name."</strong>".$this->row\_actions($actions); |
  | 57 | 58 | } else { |
  |  | 59 | $nonced\_edit = wp\_nonce\_url('admin.php?page=accua\_forms\_list&amp;fid=' . $item['ID'], 'edit\_posts'); |
  |  | 60 | $nonced\_clone = wp\_nonce\_url('admin.php?page=accua\_forms\_add&amp;clonefrom=' . $item['ID'], 'clone\_posts'); |
  |  | 61 | $nonced\_del = wp\_nonce\_url('admin.php?page=accua\_forms\_list&amp;fid\_del=' . $item['ID'], 'trash\_posts'); |
  | 58 | 62 | $actions = array( |
  | 59 |  | 'edit' => "<a href='~~admin.php?page=accua\_forms\_list&amp;fid={$item['ID']~~}'>".\_\_("Edit", 'contact-forms')."</a>" |
  | 60 |  | . " &middot; <a href='~~admin.php?page=accua\_forms\_add&amp;clonefrom={$item['ID']~~}'>".\_\_("Clone", 'contact-forms')."</a>" |
  |  | 63 | 'edit' => "<a href='{$nonced\_edit}'>".\_\_("Edit", 'contact-forms')."</a>" |
  |  | 64 | . " &middot; <a href='{$nonced\_clone}'>".\_\_("Clone", 'contact-forms')."</a>" |
  | 61 | 65 | . " &middot; <a href='admin.php?page=accua\_forms\_submissions\_list&amp;fid={$item['ID']}'>".\_\_("Report", 'contact-forms')."</a>" |
  | 62 |  | . " &middot; <a href='~~admin.php?page=accua\_forms\_list&amp;fid\_del={$item['ID']~~}'>".\_\_("Trash", 'contact-forms')."</a>", |
  | 63 |  | ); |
  | 64 |  | return "<strong><a class='row-title' href='~~admin.php?page=accua\_forms\_list&amp;fid=".$item['ID']."~~'>".htmlspecialchars($item['title'])."</a></strong>".$this->row\_actions($actions); |
  |  | 66 | . " &middot; <a href='{$nonced\_del}'>".\_\_("Trash", 'contact-forms')."</a>", |
  |  | 67 | ); |
  |  | 68 | return "<strong><a class='row-title' href='{$nonced\_edit}'>".htmlspecialchars($item['title'])."</a></strong>".$this->row\_actions($actions); |
  | 65 | 69 | } |
  | 66 | 70 | } |
  | […](/browser/contact-forms/trunk/accua-forms-list-page.php?rev=2887413#L201) | […](/browser/contact-forms/tags/1.5.8/accua-forms-list-page.php?rev=2924628#L205) |  |
  | 201 | 205 |  |
  | 202 | 206 | if ($del) { |
  |  | 207 | check\_admin\_referer('deleted\_forms'); |
  | 203 | 208 | $start = $forms\_trash; |
  | 204 | 209 | } else { |
  | […](/browser/contact-forms/trunk/accua-forms-list-page.php?rev=2887413#L299) | […](/browser/contact-forms/tags/1.5.8/accua-forms-list-page.php?rev=2924628#L304) |  |
  | 299 | 304 |  |
  | 300 | 305 | static $listTable = null; |
  | 301 |  |  |
  | 302 |  | if(isset($\_GET['fid\_del'])) |
  |  | 306 | //var\_dump($\_REQUEST); |
  |  | 307 |  |
  |  | 308 | if(isset($\_GET['fid\_del'])) |
  | 303 | 309 | { |
  | 304 |  | ~~$referer = $\_SERVER['HTTP\_REFERER'];~~ |
  | 305 |  | ~~$referer = str\_replace(['http://', 'https://'], '', $referer);~~ |
  | 306 |  | ~~$host = $\_SERVER['HTTP\_HOST'];~~ |
  | 307 |  |  |
  | 308 |  | ~~if ( $host !== substr($referer, 0, strlen($host))) {~~ |
  | 309 |  | ~~wp\_die("Accesso non consentito!");~~ |
  | 310 |  | ~~}~~ |
  | 311 | 310 | $fid = $\_GET['fid\_del']; |
  | 312 | 311 | $forms\_data = get\_option('accua\_forms\_saved\_forms', array()); |
  | […](/browser/contact-forms/trunk/accua-forms-list-page.php?rev=2887413#L336) | […](/browser/contact-forms/tags/1.5.8/accua-forms-list-page.php?rev=2924628#L335) |  |
  | 336 | 335 | <ul class="subsubsub"> |
  | 337 | 336 | <li> |
  | 338 |  | <a <?php if (!isset($\_GET['del']) || ($\_GET['del']!=1)) { echo " class='current' "; } ?> href="admin.php?page=accua\_forms\_list"> |
  |  | 337 | <?php $nonced\_url = wp\_nonce\_url('admin.php?page=accua\_forms\_list', 'home\_forms') ?> |
  |  | 338 | <a <?php if (!isset($\_GET['del']) || ($\_GET['del']!=1)) { echo " class='current' "; } ?> href="<?= $nonced\_url ?? 'admin.php?page=accua\_forms\_list' ?>"> |
  | 339 | 339 | <?php \_e("Active", 'contact-forms'); ?></a> (<?php echo $listTable->get\_num\_of\_active\_items(); ?>) | |
  | 340 | 340 | </li> |
  | 341 | 341 | <li> |
  | 342 |  | <a  <?php if (isset($\_GET['del']) && ($\_GET['del']==1)) { echo " class='current' "; } ?> href="admin.php?page=accua\_forms\_list&del=1"> |
  |  | 342 | <?php $nonced\_url = wp\_nonce\_url('admin.php?page=accua\_forms\_list&del=1', 'deleted\_forms'); ?> |
  |  | 343 | <a  <?php if (isset($\_GET['del']) && ($\_GET['del']==1)) { echo " class='current' "; } ?> href="<?= $nonced\_url ?? 'admin.php?page=accua\_forms\_list&del=1' ?>"> |
  | 343 | 344 | <?php \_e("Trash", 'contact-forms'); ?></a> (<?php echo $listTable->get\_num\_of\_del\_items(); ?>) |
  | 344 | 345 | </li> |
* ## [contact-forms/tags/1.5.8/accua-forms-single-submission.php](/changeset/2924628/contact-forms/tags/1.5.8/accua-forms-single-submission.php "Show the changeset 2924628 restricted to contact-forms/tags/1.5.8/accua-forms-single-submission.php")

  | [r2886518](/browser/contact-forms/trunk/accua-forms-single-submission.php?rev=2886518#L44 "Show revision 2886518 of this file in browser") | [r2924628](/browser/contact-forms/tags/1.5.8/accua-forms-single-submission.php?rev=2924628#L44 "Show revision 2924628 of this file in browser") |  |
  | --- | --- | --- |
  | 44 | 44 | foreach ($query\_submission\_notes as $value) { |
  | 45 | 45 | echo '<div class="note system-note"> |
  | 46 |  | <div class="note\_content">' . ~~$value->afsn\_text~~ . '</div> |
  |  | 46 | <div class="note\_content">' . htmlspecialchars($value->afsn\_text, ENT\_QUOTES, null, false) . '</div> |
  | 47 | 47 | <p class="meta"> |
  | 48 | 48 | <span class="note-date">' . $value->afsn\_date . '</span> &middot; <span>'. $value->afsn\_user.'</span> |
  | […](/browser/contact-forms/trunk/accua-forms-single-submission.php?rev=2886518#L51) | […](/browser/contact-forms/tags/1.5.8/accua-forms-single-submission.php?rev=2924628#L51) |  |
  | 51 | 51 | <input type="hidden" name="del\_note\_sid" value="'.$value->afsn\_sub\_id.'" /> |
  | 52 | 52 | <input type="hidden" name="del\_note\_date" value="'.$value->afsn\_date.'" />'; ?> |
  |  | 53 | <?php wp\_nonce\_field("submission\_{$value->afsn\_sub\_id}\_note\_del", "\_wpnonce\_note\_del"); ?> |
  | 53 | 54 | <input type="submit" id="delete-note" class="submitdelete deletion" value="<?php \_e('Delete note', 'contact-forms'); ?>" onclick="return window.confirm('Are you sure you want to trash this note?');"/> |
  | 54 | 55 | <?php echo '</form> |
  | […](/browser/contact-forms/trunk/accua-forms-single-submission.php?rev=2886518#L75) | […](/browser/contact-forms/tags/1.5.8/accua-forms-single-submission.php?rev=2924628#L76) |  |
  | 75 | 76 | global $wpdb; |
  | 76 | 77 | if (isset($\_GET['sid'])) { |
  | 77 |  | $sid = ~~stripslashes((string)$\_GET['sid'])~~; |
  |  | 78 | $sid = (int) $\_GET['sid']; |
  | 78 | 79 | } |
  | 79 | 80 |  |
  | […](/browser/contact-forms/trunk/accua-forms-single-submission.php?rev=2886518#L82) | […](/browser/contact-forms/tags/1.5.8/accua-forms-single-submission.php?rev=2924628#L83) |  |
  | 82 | 83 | } |
  | 83 | 84 | $post = stripslashes\_deep($\_POST); |
  | 84 |  | if(isset($post['note\_site\_user'])){ |
  |  | 85 | if(isset($post['note\_site\_user']) && isset($post['note\_id\_sub'])){ |
  | 85 | 86 | $note\_site\_user = $post['note\_site\_user']; |
  | 86 | 87 | $id\_sub = $post['note\_id\_sub']; |
  |  | 88 | check\_admin\_referer("submission\_{$id\_sub}\_note\_add", "\_wpnonce\_note\_add"); |
  | 87 | 89 | accua\_forms\_add\_submission\_note($id\_sub, $note\_site\_user); |
  | 88 | 90 | } |
  | 89 | 91 | if(isset($post['del\_note\_sid'])){ |
  |  | 92 | check\_admin\_referer("submission\_{$post['del\_note\_sid']}\_note\_del", "\_wpnonce\_note\_del"); |
  | 90 | 93 | accua\_forms\_delete\_submission\_note($post['del\_note\_sid'], $post['del\_note\_date']); |
  | 91 | 94 | } |
  | […](/browser/contact-forms/trunk/accua-forms-single-submission.php?rev=2886518#L95) | […](/browser/contact-forms/tags/1.5.8/accua-forms-single-submission.php?rev=2924628#L98) |  |
  | 95 | 98 | if(isset($post['del\_sub\_form'])) { |
  | 96 | 99 | $id = (int)$post['del\_sub\_form']; |
  |  | 100 | check\_admin\_referer("del\_sub\_form\_{$id}", "\_wpnonce\_sub\_del"); |
  | 97 | 101 | accua\_forms\_single\_submission\_movetotrash($id); |
  | 98 | 102 | } ?> |
  | […](/browser/contact-forms/trunk/accua-forms-single-submission.php?rev=2886518#L118) | […](/browser/contact-forms/tags/1.5.8/accua-forms-single-submission.php?rev=2924628#L122) |  |
  | 118 | 122 | <form style="margin-top: 20px;" id="delete-sub" method="post" action=""> |
  | 119 | 123 | <input type="hidden" name="del\_sub\_form" value="<?php echo $sid; ?>" /> |
  | 120 |  | <input type="submit" id="delete-sub-data" class="submitdelete deletion" value="<?php \_e('Move to trash', 'contact-forms') ?> (Solo per Spam/test)" onclick='return window.confirm("Are you sure you want to trash this submission?");'/> |
  |  | 124 | <?php wp\_nonce\_field("del\_sub\_form\_{$sid}", "\_wpnonce\_sub\_del"); ?> |
  |  | 125 | <input type="submit" id="delete-sub-data" class="submitdelete deletion" value="<?php \_e('Move to trash', 'contact-forms'); \_e('(for spam or tests submissions)', 'contact-forms'); ?>" onclick='return window.confirm("Are you sure you want to trash this submission?");'/> |
  | 121 | 126 | </form> |
  | 122 | 127 | </div> |
  | […](/browser/contact-forms/trunk/accua-forms-single-submission.php?rev=2886518#L225) | […](/browser/contact-forms/tags/1.5.8/accua-forms-single-submission.php?rev=2924628#L230) |  |
  | 225 | 230 | <textarea id="note\_site\_user" name="note\_site\_user" rows="4" style="width: 100%; margin-bottom:5px" placeholder="<?php \_e('Insert your note here...', 'contact-forms'); ?>"></textarea> |
  | 226 | 231 | <input type="hidden" name="note\_id\_sub" value="<?php echo $sid; ?>" /> |
  |  | 232 | <?php wp\_nonce\_field("submission\_{$sid}\_note\_add", "\_wpnonce\_note\_add"); ?> |
  | 227 | 233 | <input type="submit" class="button button-secondary" value="<?php \_e( 'Save', 'contact-forms'); ?>" /></p> |
  | 228 | 234 | </form> |
* ## [contact-forms/tags/1.5.8/accua-forms-submissions-page.php](/changeset/2924628/contact-forms/tags/1.5.8/accua-forms-submissions-page.php "Show the changeset 2924628 restricted to contact-forms/tags/1.5.8/accua-forms-submissions-page.php")

  | [r2879909](/browser/contact-forms/trunk/accua-forms-submissions-page.php?rev=2879909#L523 "Show revision 2879909 of this file in browser") | [r2924628](/browser/contact-forms/tags/1.5.8/accua-forms-submissions-page.php?rev=2924628#L523 "Show revision 2924628 of this file in browser") |  |
  | --- | --- | --- |
  | 523 | 523 | <form style="margin-top: 20px;" id="submissions-action" method="get" action=""> |
  | 524 | 524 | <!-- For plugins, we also need to ensure that the form posts back to our current page --> |
  | 525 |  | <input type="hidden" name="page" value="<?php ~~echo htmlspecialchars(stripslashes($\_REQUEST['page']));~~ ?>" /> |
  | 526 |  | <input type="hidden" name="del" value="<?php ~~echo htmlspecialchars(stripslashes($\_REQUEST['del']));~~ ?>" /> |
  |  | 525 | <input type="hidden" name="page" value="<?php if (isset($\_REQUEST['page'])) { echo htmlspecialchars(stripslashes($\_REQUEST['page'])); } ?>" /> |
  |  | 526 | <input type="hidden" name="del" value="<?php if (isset($\_REQUEST['del'])) { echo htmlspecialchars(stripslashes($\_REQUEST['del'])); } ?>" /> |
  | 527 | 527 | <!-- SEARCH FORM --> |
  | 528 | 528 | <?php $listTable->search\_box(\_\_("Search", 'contact-forms'), 'search\_id'); ?> |
  | […](/browser/contact-forms/trunk/accua-forms-submissions-page.php?rev=2879909#L540) | […](/browser/contact-forms/tags/1.5.8/accua-forms-submissions-page.php?rev=2924628#L540) |  |
  | 540 | 540 | $saved\_forms\_id\_string = implode(',',$saved\_forms\_id); |
  | 541 | 541 |  |
  | 542 |  | $id\_del\_other\_forms = $wpdb->get\_results("SELECT distinct afs\_form\_id |
  | 543 |  | FROM {$wpdb->prefix}accua\_forms\_submissions WHERE afs\_form\_id NOT IN ($saved\_forms\_id\_string) AND afs\_status >= 0", ARRAY\_A); |
  |  | 542 | if ($saved\_forms\_id\_string) { |
  |  | 543 | $id\_del\_other\_forms = $wpdb->get\_results("SELECT distinct afs\_form\_id |
  |  | 544 | FROM {$wpdb->prefix}accua\_forms\_submissions WHERE afs\_form\_id NOT IN ($saved\_forms\_id\_string) AND afs\_status >= 0", ARRAY\_A); |
  |  | 545 | } else { |
  |  | 546 | $id\_del\_other\_forms = array(); |
  |  | 547 | } |
  | 544 | 548 |  |
  | 545 | 549 |  |
  | […](/browser/contact-forms/trunk/accua-forms-submissions-page.php?rev=2879909#L672) | […](/browser/contact-forms/tags/1.5.8/accua-forms-submissions-page.php?rev=2924628#L676) |  |
  | 672 | 676 | <form style="margin-top: 20px;" id="submissions-action" method="get" action=""> |
  | 673 | 677 | <!-- Now we can render the completed list table --> |
  | 674 |  | <input type="hidden" name="page" value="<?php ~~echo htmlspecialchars(stripslashes($\_REQUEST['page']));~~ ?>" /> |
  | 675 |  | <input type="hidden" name="del" value="<?php ~~echo htmlspecialchars(stripslashes($\_REQUEST['del']));~~ ?>" /> |
  |  | 678 | <input type="hidden" name="page" value="<?php  if (isset($\_REQUEST['page'])) { echo htmlspecialchars(stripslashes($\_REQUEST['page'])); } ?>" /> |
  |  | 679 | <input type="hidden" name="del" value="<?php  if (isset($\_REQUEST['del'])) { echo htmlspecialchars(stripslashes($\_REQUEST['del'])); } ?>" /> |
  | 676 | 680 | <?php $listTable->display(); ?> |
  | 677 | 681 | </form> |
* ## [contact-forms/tags/1.5.8/accua-forms.php](/changeset/2924628/contact-forms/tags/1.5.8/accua-forms.php "Show the changeset 2924628 restricted to contact-forms/tags/1.5.8/accua-forms.php")

  | [r2887413](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L152 "Show revision 2887413 of this file in browser") | [r2924628](/browser/contact-forms/tags/1.5.8/accua-forms.php?rev=2924628#L152 "Show revision 2924628 of this file in browser") |  |
  | --- | --- | --- |
  | 152 | 152 | function accua\_forms\_edit\_page\_head\_styles() { |
  | 153 | 153 | //wp\_admin\_css( 'widgets' ); |
  |  | 154 | wp\_enqueue\_style( 'wp-pointer' ); //for tooltips |
  | 154 | 155 | wp\_enqueue\_style( 'accua-forms-admin', plugins\_url('accua-forms-admin.css', \_\_FILE\_\_), array('wp-color-picker'), ACCUA\_FORMS\_CSS\_VERSION); // |
  | 155 | 156 | } |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L160) | […](/browser/contact-forms/tags/1.5.8/accua-forms.php?rev=2924628#L161) |  |
  | 160 | 161 | wp\_enqueue\_script('jquery-ui-draggable'); |
  | 161 | 162 | wp\_enqueue\_script('jquery-ui-droppable');\*/ |
  | 162 |  | wp\_enqueue\_script('accua', plugins\_url('/js/jqColorPicker.min.js', \_\_FILE\_\_ ), array( 'jquery' ), ACCUA\_FORMS\_JS\_VERSION); |
  |  | 163 | wp\_enqueue\_script( 'wp-pointer' ); //for tooltips |
  |  | 164 | wp\_enqueue\_script('accua-jqColorPicker', plugins\_url('/js/jqColorPicker.min.js', \_\_FILE\_\_ ), array( 'jquery' ), ACCUA\_FORMS\_JS\_VERSION); |
  | 163 | 165 |  |
  | 164 | 166 | wp\_enqueue\_script( 'accua-form-fields', plugins\_url( 'form-fields.js' , \_\_FILE\_\_ ), array( 'jquery-ui-sortable', 'jquery-ui-draggable', 'jquery-ui-droppable' ), ACCUA\_FORMS\_JS\_VERSION); |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L167) | […](/browser/contact-forms/tags/1.5.8/accua-forms.php?rev=2924628#L169) |  |
  | 167 | 169 |  |
  | 168 | 170 | function accua\_forms\_settings\_page\_head\_scripts() { |
  |  | 171 | wp\_enqueue\_script('accua-jqColorPicker', plugins\_url('/js/jqColorPicker.min.js', \_\_FILE\_\_ ), array( 'jquery' ), ACCUA\_FORMS\_JS\_VERSION); |
  | 169 | 172 | //wp\_enqueue\_script('wp-color-picker'); |
  | 170 | 173 | } |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L172) | […](/browser/contact-forms/tags/1.5.8/accua-forms.php?rev=2924628#L175) |  |
  | 172 | 175 | function accua\_forms\_edit\_page\_head() { |
  | 173 | 176 | if (isset($\_POST['accua-form-edit-action']) || (!isset($\_GET['fid']))) { |
  | 174 |  | \_accua\_forms\_form\_edit\_action(); |
  |  | 177 | \_accua\_forms\_form\_edit\_action(); |
  | 175 | 178 | require\_once('accua-forms-list-page.php'); |
  | 176 | 179 | accua\_forms\_list\_page\_table(true); |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L195) | […](/browser/contact-forms/tags/1.5.8/accua-forms.php?rev=2924628#L198) |  |
  | 195 | 198 | add\_action( 'wp\_ajax\_accua-form-fields-order' , 'accua\_forms\_form\_fields\_order'); |
  | 196 | 199 | function accua\_forms\_form\_fields\_order() { |
  |  | 200 | check\_ajax\_referer('edit\_form', '\_nonce\_edit\_form'); |
  |  | 201 |  |
  | 197 | 202 | $post = stripslashes\_deep($\_POST); |
  | 198 | 203 | //update\_option('accua\_forms\_form\_fields\_order\_post', $post); |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L238) | […](/browser/contact-forms/tags/1.5.8/accua-forms.php?rev=2924628#L243) |  |
  | 238 | 243 | /\* azione dove vengono salvati i campi dei un form \*/ |
  | 239 | 244 | function accua\_forms\_save\_form\_field() { |
  |  | 245 | check\_ajax\_referer('edit\_form', '\_nonce\_edit\_form'); |
  |  | 246 |  |
  | 240 | 247 | $post = stripslashes\_deep($\_POST); |
  | 241 | 248 |  |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L296) | […](/browser/contact-forms/tags/1.5.8/accua-forms.php?rev=2924628#L303) |  |
  | 296 | 303 | add\_action( 'wp\_ajax\_accua-save-form-settings', 'accua\_forms\_save\_form\_settings'); |
  | 297 | 304 | function accua\_forms\_save\_form\_settings() { |
  |  | 305 | check\_ajax\_referer('edit\_form', '\_nonce\_edit\_form'); |
  |  | 306 |  |
  | 298 | 307 | $post = stripslashes\_deep($\_POST); |
  | 299 | 308 |  |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L503) | […](/browser/contact-forms/tags/1.5.8/accua-forms.php?rev=2924628#L512) |  |
  | 503 | 512 | <input type="text" value="{$istance\_data['default\_value']}" name="form-field-{$istance\_data['istance\_id']}-default-value" id="widget-{$istance\_data['istance\_id']}-default-value" class="widefat"></p> |
  | 504 | 513 | EOT; |
  | 505 |  | ~~$default\_date\_value = <<<EOT~~ |
  | 506 |  | ~~<p><label for="widget-{$istance\_data['istance\_id']}-default-value">{$testi\_eot['default\_value']}:</label>~~ |
  | 507 |  | ~~{$override\_begin}<input type="{$override\_type}" name="form-field-{$istance\_data['istance\_id']}-override-default-value" value="1" {$override\_default\_value} />{$override\_end}<br>~~ |
  | 508 |  | ~~<input type="date" value="{$istance\_data['default\_date\_value']}" name="form-field-{$istance\_data['istance\_id']}-default-value" id="widget-{$istance\_data['istance\_id']}-default-value" class="widefat"></p>~~ |
  | 509 |  | ~~EOT;~~ |
  | 510 | 514 |  |
  | 511 | 515 | $default\_values = <<<EOT |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L535) | […](/browser/contact-forms/tags/1.5.8/accua-forms.php?rev=2924628#L539) |  |
  | 535 | 539 | <input type="checkbox" value="1" {$required\_checked} name="form-field-{$istance\_data['istance\_id']}-required" id="widget-{$istance\_data['istance\_id']}-required"></p> |
  | 536 | 540 | EOT; |
  | 537 |  | $min\_date = <<<EOT |
  | 538 |  | <p><label for="widget-{$istance\_data['istance\_id']}-min-of-date">{$testi\_eot['min-of-date']}:</label> |
  | 539 |  | {$override\_begin}<input type="{$override\_type}" name="form-field-{$istance\_data['istance\_id']}-override-datemin-values" value="1" {$override\_mindate\_values} />{$override\_end}<br> |
  | 540 |  | <input type="date" value="{$istance\_data['min\_date']}" name="form-field-{$istance\_data['istance\_id']}-min-of-date" id="widget-{$istance\_data['istance\_id']}-min-of-date"></p> |
  |  | 541 |  |
  |  | 542 | if ($field\_data['type'] == 'date'){ |
  |  | 543 | $default\_date\_value = <<<EOT |
  |  | 544 | <p><label for="widget-{$istance\_data['istance\_id']}-default-value">{$testi\_eot['default\_value']}:</label> |
  |  | 545 | {$override\_begin}<input type="{$override\_type}" name="form-field-{$istance\_data['istance\_id']}-override-default-value" value="1" {$override\_default\_value} />{$override\_end}<br> |
  |  | 546 | <input type="date" value="{$istance\_data['default\_date\_value']}" name="form-field-{$istance\_data['istance\_id']}-default-value" id="widget-{$istance\_data['istance\_id']}-default-value" class="widefat"></p> |
  | 541 | 547 | EOT; |
  | 542 |  | ~~$max~~\_date = <<<EOT |
  | 543 |  | ~~<p><label for="widget-{$istance\_data['istance\_id']}-max-of-date">{$testi\_eot['max~~-of-date']}:</label> |
  | 544 |  | ~~{$override\_begin}<input type="{$override\_type}" name="form-field-{$istance\_data['istance\_id']}-override-datemax-values" value="1" {$override\_max~~date\_values} />{$override\_end}<br> |
  | 545 |  | ~~<input type="date" value="{$istance\_data['max\_date']}" name="form-field-{$istance\_data['istance\_id']}-max-of-date" id="widget-{$istance\_data['istance\_id']}-max~~-of-date"></p> |
  |  | 548 | $min\_date = <<<EOT |
  |  | 549 | <p><label for="widget-{$istance\_data['istance\_id']}-min-of-date">{$testi\_eot['min-of-date']}:</label> |
  |  | 550 | {$override\_begin}<input type="{$override\_type}" name="form-field-{$istance\_data['istance\_id']}-override-datemin-values" value="1" {$override\_mindate\_values} />{$override\_end}<br> |
  |  | 551 | <input type="date" value="{$istance\_data['min\_date']}" name="form-field-{$istance\_data['istance\_id']}-min-of-date" id="widget-{$istance\_data['istance\_id']}-min-of-date"></p> |
  | 546 | 552 | EOT; |
  |  | 553 | $max\_date = <<<EOT |
  |  | 554 | <p><label for="widget-{$istance\_data['istance\_id']}-max-of-date">{$testi\_eot['max-of-date']}:</label> |
  |  | 555 | {$override\_begin}<input type="{$override\_type}" name="form-field-{$istance\_data['istance\_id']}-override-datemax-values" value="1" {$override\_maxdate\_values} />{$override\_end}<br> |
  |  | 556 | <input type="date" value="{$istance\_data['max\_date']}" name="form-field-{$istance\_data['istance\_id']}-max-of-date" id="widget-{$istance\_data['istance\_id']}-max-of-date"></p> |
  |  | 557 | EOT; |
  |  | 558 | } |
  | 547 | 559 |  |
  | 548 | 560 | switch ($field\_data['type']) { |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L648) | […](/browser/contact-forms/tags/1.5.8/accua-forms.php?rev=2924628#L660) |  |
  | 648 | 660 |  |
  | 649 | 661 | function accua\_forms\_add\_page($message='') { |
  | 650 |  | ~~$referer = $\_SERVER['HTTP\_REFERER'];~~ |
  | 651 |  | ~~$referer = str\_replace(['http://', 'https://'], '', $referer);~~ |
  | 652 |  | ~~$host = $\_SERVER['HTTP\_HOST'];~~ |
  | 653 |  |  |
  | 654 |  | ~~if ( $host !== substr($referer, 0, strlen($host))) {~~ |
  | 655 |  | ~~wp\_die("Accesso non consentito!");~~ |
  | 656 |  | ~~}~~ |
  | 657 |  |  |
  | 658 | 662 | $forms\_data = get\_option('accua\_forms\_saved\_forms', array()); |
  | 659 | 663 | $trash\_data = get\_option('accua\_forms\_trash\_forms', array()); |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L676) | […](/browser/contact-forms/tags/1.5.8/accua-forms.php?rev=2924628#L680) |  |
  | 676 | 680 | } |
  | 677 | 681 | if (!empty($\_GET['clonefrom'])) { |
  |  | 682 | check\_admin\_referer('clone\_posts'); |
  | 678 | 683 | $clonefrom = stripslashes($\_GET['clonefrom']); |
  | 679 | 684 | } else { |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L688) | […](/browser/contact-forms/tags/1.5.8/accua-forms.php?rev=2924628#L693) |  |
  | 688 | 693 | } ?> |
  | 689 | 694 | <form action="admin.php" method="GET"> |
  |  | 695 | <?php wp\_nonce\_field('edit\_posts', '\_wpnonce', false, true) ?> |
  | 690 | 696 | <input type="hidden" name="page" value="accua\_forms\_list" /> |
  | 691 | 697 | <p>Form id: <input type="text" name="fid" value="<?php echo $fid; ?>" /></p> |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L745) | […](/browser/contact-forms/tags/1.5.8/accua-forms.php?rev=2924628#L751) |  |
  | 745 | 751 | case 'delete': |
  | 746 | 752 | $fid = $post['form-id']; |
  |  | 753 | check\_admin\_referer('contact-forms-delete\_'.$fid); |
  | 747 | 754 | $forms\_data = get\_option('accua\_forms\_saved\_forms', array()); |
  | 748 | 755 | unset($forms\_data[$fid]); |
  | 749 | 756 | update\_option('accua\_forms\_saved\_forms', $forms\_data); |
  | 750 | 757 | $fid = htmlspecialchars($fid); |
  | 751 |  | $message .= sprintf( \_\_( 'Form ~~\"%s\~~" deleted','contact-forms' ), $fid ); |
  |  | 758 | $message .= sprintf( \_\_( 'Form "%s" deleted','contact-forms' ), $fid ); |
  | 752 | 759 | break; |
  | 753 | 760 | } |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L762) | […](/browser/contact-forms/tags/1.5.8/accua-forms.php?rev=2924628#L769) |  |
  | 762 | 769 | $message = \_accua\_forms\_form\_edit\_action(); |
  | 763 | 770 | } else if (isset($\_GET['fid'])) { |
  |  | 771 |  |
  |  | 772 | check\_admin\_referer('edit\_posts'); |
  |  | 773 |  |
  | 764 | 774 | if (!isset($fid)) { |
  | 765 | 775 | $fid = stripslashes($\_GET['fid']); |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L808) | […](/browser/contact-forms/tags/1.5.8/accua-forms.php?rev=2924628#L818) |  |
  | 808 | 818 | wp\_enqueue\_script('jquery-ui-tabs','','','',true); |
  | 809 | 819 | wp\_enqueue\_script('contact\_forms\_tabs', plugins\_url('accua\_tabs.js', \_\_FILE\_\_ ), array( 'jquery' ), ACCUA\_FORMS\_JS\_VERSION); |
  |  | 820 |  |
  |  | 821 | if (!class\_exists('AccuaFormsHelp')) { |
  |  | 822 | require\_once('accua-forms-help.php'); |
  |  | 823 | } |
  |  | 824 | $accuaHelp = AccuaFormsHelp::getInstance(); |
  | 810 | 825 | /\* |
  | 811 | 826 | $avail\_fields = array( |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L859) | […](/browser/contact-forms/tags/1.5.8/accua-forms.php?rev=2924628#L874) |  |
  | 859 | 874 | <h2><?php \_e( 'Edit Form', 'contact-forms'); ?></h2> |
  | 860 | 875 | <div class="accua\_form\_save\_settings\_status"></div> |
  |  | 876 | <?php wp\_nonce\_field('edit\_form', '\_nonce\_edit\_form'); ?> |
  | 861 | 877 | <div id="titlediv"><br /> |
  | 862 | 878 | <label id="title-prompt-text" class="screen-reader-text" for="title"><?php  \_e( 'Enter title here', 'contact-forms'); ?></label> |
  | 863 | 879 | <input id="title" type="text" autocomplete="off" value="<?php echo htmlspecialchars($form\_data['title'], ENT\_QUOTES) ?>" size="30" name="post\_title"> |
  | 864 |  |  |
  | 865 | 880 | <script type="text/javascript"> |
  | 866 | 881 | jQuery(function($){ |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L884) | […](/browser/contact-forms/tags/1.5.8/accua-forms.php?rev=2924628#L899) |  |
  | 884 | 899 | <input type="hidden" name="form-id" value="<?php echo $fid\_esc; ?>" /> |
  | 885 | 900 | <input type="submit" value="<?php \_e( 'Delete this form', 'contact-forms'); ?>" /> |
  |  | 901 | <?php wp\_nonce\_field( 'contact-forms-delete\_'.$fid ); ?> |
  | 886 | 902 | </form> |
  | 887 | 903 | <?php /\*<input class="button button-primary button-large accua\_form\_save\_settings\_button" id="accua\_form\_save\_settings" type="button" value="<?php echo htmlspecialchars(\_\_( 'Save settings', 'contact-forms'), ENT\_QUOTES); ?>" /> \*/ ?> |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L898) | […](/browser/contact-forms/tags/1.5.8/accua-forms.php?rev=2924628#L914) |  |
  | 898 | 914 | <div id="accua\_tabs2"> |
  | 899 | 915 | <ul> |
  | 900 |  | <li class="tabs"><a href="#accua\_tab\_fields2">~~Campi~~</a></li> |
  | 901 |  | <li class="tabs"><a href="#accua\_tab\_customise">~~Grafica~~</a></li> |
  |  | 916 | <li class="tabs"><a href="#accua\_tab\_fields2"><?php \_e( 'Fields', 'contact-forms'); ?></a></li> |
  |  | 917 | <li class="tabs"><a href="#accua\_tab\_customise"><?php \_e( 'Appearance', 'contact-forms'); ?></a></li> |
  | 902 | 918 | </ul> |
  | 903 | 919 | <div id="accua\_tab\_fields2"> |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L1008) | […](/browser/contact-forms/tags/1.5.8/accua-forms.php?rev=2924628#L1024) |  |
  | 1008 | 1024 | <div id="accua\_tab\_customise"> |
  | 1009 | 1025 | <div style="width: 48%; float:left;"> |
  | 1010 |  | <?php |
  | 1011 |  | if (!class\_exists('AccuaFormsHelp')) { |
  | 1012 |  | require\_once('accua-forms-help.php'); |
  | 1013 |  | } |
  | 1014 |  | $accuaHelp = AccuaFormsHelp::getInstance(); ?> |
  | 1015 |  |  |
  | 1016 |  | <h3>Generali<?php // \_e( 'Forms', 'contact-forms'); ?></h3> |
  | 1017 |  | <?php echo $accuaHelp->add\_pointer('help\_1'); |
  | 1018 |  | $accuaHelp->finished();  ?> |
  | 1019 |  | <p id="accua\_form\_use\_ajax"><input class="accua\_form\_value" type="checkbox" value="1" <?php if (!empty($form\_data['use\_ajax'])) {echo 'checked="checked" ';} ?>/>Non ricaricare la pagina alla compilazione del form</p> |
  | 1020 |  |  |
  | 1021 |  | <p id="accua\_form\_layout">Etichette<?php //\_e('Layout', 'contact-forms'); ?> <select name="layout" class="accua\_form\_value"> |
  |  | 1026 | <h3><?php \_e( 'General', 'contact-forms'); ?></h3> |
  |  | 1027 | <p id="accua\_form\_use\_ajax"><input class="accua\_form\_value" type="checkbox" value="1" <?php if (!empty($form\_data['use\_ajax'])) {echo 'checked="checked" ';} ?>/><?php \_e('Do not reload the page on form submission', 'contact-forms'); ?></p> |
  |  | 1028 |  |
  |  | 1029 | <p id="accua\_form\_layout"><?php \_e( 'Labels', 'contact-forms'); ?> <select name="layout" class="accua\_form\_value"> |
  | 1022 | 1030 | <option value="" <?php if (isset($form\_overrided\_data['layout'])) { echo 'selected="selected"'; } ?>>default (<?php if($default\_form\_data['layout']=='sidebyside') \_e( 'Labels on the left of the fields', 'contact-forms'); else \_e( 'Labels on top of the fields', 'contact-forms'); ?>)</option><option value="sidebyside" <?php if ((isset($form\_overrided\_data['layout'])) && ($form\_data['layout'] == 'sidebyside')) { echo 'selected="selected"'; } ?>><?php \_e( 'Labels on the left of the fields', 'contact-forms'); ?></option><option value="toplabel" <?php if ((isset($form\_overrided\_data['layout'])) && ($form\_data['layout'] == 'toplabel')) { echo 'selected="selected"'; } ?>><?php \_e( 'Labels on top of the fields', 'contact-forms'); ?></option></select> |
  | 1023 | 1031 | </p> |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L1178) | […](/browser/contact-forms/tags/1.5.8/accua-forms.php?rev=2924628#L1186) |  |
  | 1178 | 1186 | <div style="width:50%; float:right;"> |
  | 1179 | 1187 | <div style="padding: 15px;"> |
  | 1180 |  | <h2>Anteprima con intestazione del sito</h2> |
  |  | 1188 | <h2><?php \_e('Preview', 'contact-forms'); ?> |
  |  | 1189 | <?php echo $accuaHelp->add\_pointer('form\_edit\_preview'); ?> |
  |  | 1190 | </h2> |
  | 1181 | 1191 | <div id="accua\_form\_preview\_area\_wrapper"> |
  | 1182 | 1192 | <?php |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L1443) | […](/browser/contact-forms/tags/1.5.8/accua-forms.php?rev=2924628#L1453) |  |
  | 1443 | 1453 |  |
  | 1444 | 1454 | <?php |
  |  | 1455 | $accuaHelp->finished(); |
  | 1445 | 1456 | } |
  | 1446 | 1457 |  |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L1529) | […](/browser/contact-forms/tags/1.5.8/accua-forms.php?rev=2924628#L1540) |  |
  | 1529 | 1540 | <?php |
  | 1530 | 1541 | \*/ |
  | 1531 |  |  |
  | 1532 |  | ~~$\_GET['edit-fid'] = sanitize\_text\_field($\_GET['edit-fid']);~~ |
  | 1533 |  |  |
  | 1534 | 1542 | $message = ''; |
  | 1535 | 1543 | $taxonomy = ''; |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L1567) | […](/browser/contact-forms/tags/1.5.8/accua-forms.php?rev=2924628#L1575) |  |
  | 1567 | 1575 | 'description' => '', |
  | 1568 | 1576 | 'default\_value' => '', |
  |  | 1577 | 'default\_date\_value' => '', |
  | 1569 | 1578 | 'allowed\_values' => '', |
  |  | 1579 | 'min\_date' => '', |
  |  | 1580 | 'max\_date' => '', |
  | 1570 | 1581 | ); |
  | 1571 | 1582 |  |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L1574) | […](/browser/contact-forms/tags/1.5.8/accua-forms.php?rev=2924628#L1585) |  |
  | 1574 | 1585 |  |
  | 1575 | 1586 | if (!empty($\_POST['action'])) { |
  |  | 1587 | check\_admin\_referer('edit\_form\_field', '\_wpnonce\_edit\_form\_field'); |
  | 1576 | 1588 | $post = stripslashes\_deep($\_POST); |
  | 1577 | 1589 | switch($post['action']) { |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L1658) | […](/browser/contact-forms/tags/1.5.8/accua-forms.php?rev=2924628#L1670) |  |
  | 1658 | 1670 | $fid = stripslashes($\_GET['edit-fid']); |
  | 1659 | 1671 | if (empty($avail\_fields[$fid])) { |
  | 1660 |  | $message .= sprintf( \_\_( 'Field "%s" doesn\'t exists', 'contact-forms'), ~~$fid~~ ); |
  |  | 1672 | $message .= sprintf( \_\_( 'Field "%s" doesn\'t exists', 'contact-forms'), htmlspecialchars($fid) ); |
  | 1661 | 1673 | } else { |
  | 1662 | 1674 | $adding = false; |
  | 1663 | 1675 | $editing = true; |
  | 1664 |  | $default\_form\_values = $avail\_fields[$fid]; |
  |  | 1676 | $default\_form\_values = $avail\_fields[$fid] + $default\_form\_values; |
  | 1665 | 1677 | } |
  | 1666 | 1678 | } |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L1837) | […](/browser/contact-forms/tags/1.5.8/accua-forms.php?rev=2924628#L1849) |  |
  | 1837 | 1849 | <input type="hidden" name="post\_type" value="<?php echo esc\_attr($post\_type); ?>" /> |
  | 1838 | 1850 | \*/ ?> |
  | 1839 |  | <?php wp\_nonce\_field('~~add-tag', '\_wpnonce\_add-form-~~field'); ?> |
  |  | 1851 | <?php wp\_nonce\_field('edit\_form\_field', '\_wpnonce\_edit\_form\_field'); ?> |
  | 1840 | 1852 |  |
  | 1841 | 1853 | <div class="form-field form-required"> |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L1900) | […](/browser/contact-forms/tags/1.5.8/accua-forms.php?rev=2924628#L1912) |  |
  | 1900 | 1912 |  |
  | 1901 | 1913 | <div class="form-field"> |
  | 1902 |  | Campi x date |
  |  | 1914 | <?php \_e( 'Settings for date fields', 'contact-forms'); ?> |
  | 1903 | 1915 | <div class="form-field"> |
  | 1904 |  | <label for="form-field-default-date-value"><?php \_e( 'Default value~~(s)~~', 'contact-forms'); ?>:</label> |
  |  | 1916 | <label for="form-field-default-date-value"><?php \_e( 'Default value', 'contact-forms'); ?>:</label> |
  | 1905 | 1917 | <input type="date" name="form-field-default-date-value" id="form-field-default-date-value" value="<?php echo htmlspecialchars($default\_form\_values['default\_date\_value'], ENT\_QUOTES) ?>"> |
  | 1906 | 1918 | </div> |
  | 1907 | 1919 |  |
  | 1908 | 1920 |  |
  | 1909 |  | <label for="form-field-~~allowed-values~~"><?php \_e( 'Min date', 'contact-forms'); ?>:</label> |
  |  | 1921 | <label for="form-field-min-of-date"><?php \_e( 'Min date', 'contact-forms'); ?>:</label> |
  | 1910 | 1922 | <input type="date" id="form-field-min-of-date" name="form-field-min-of-date" value="<?php echo htmlspecialchars($default\_form\_values['min\_date'], ENT\_QUOTES) ?>"> |
  | 1911 | 1923 |  |
  | 1912 |  | <label for="form-field-~~allowed-values~~"><?php \_e( 'Max date', 'contact-forms'); ?>:</label> |
  |  | 1924 | <label for="form-field-max-of-date"><?php \_e( 'Max date', 'contact-forms'); ?>:</label> |
  | 1913 | 1925 | <input type="date" id="form-field-max-of-date" name="form-field-max-of-date" value="<?php echo htmlspecialchars($default\_form\_values['max\_date'], ENT\_QUOTES) ?>"> |
  | 1914 | 1926 |  |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L2014) | […](/browser/contact-forms/tags/1.5.8/accua-forms.php?rev=2924628#L2026) |  |
  | 2014 | 2026 |  |
  | 2015 | 2027 | if($\_SERVER['REQUEST\_METHOD'] == 'POST' && !empty($\_POST['accua\_form\_save\_form\_settings'])) { |
  |  | 2028 | check\_admin\_referer('accua\_form\_save\_settings', '\_nonce\_accua\_form\_save\_settings'); |
  | 2016 | 2029 | $post = stripslashes\_deep($\_POST); |
  | 2017 | 2030 | $post += $empty\_form\_data; |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L2050) | […](/browser/contact-forms/tags/1.5.8/accua-forms.php?rev=2924628#L2063) |  |
  | 2050 | 2063 | } |
  | 2051 | 2064 | ?> |
  | 2052 |  | ~~Todo: quanto tempo mantenere il dato (GDPR)?~~ |
  | 2053 |  |  |
  | 2054 | 2065 | <form method="post"> |
  |  | 2066 | <?php wp\_nonce\_field('accua\_form\_save\_settings', '\_nonce\_accua\_form\_save\_settings'); ?> |
  | 2055 | 2067 | <input type="hidden" name="accua\_form\_save\_form\_settings" value="1" /> |
  | 2056 | 2068 | <?php /\* |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L2300) | […](/browser/contact-forms/tags/1.5.8/accua-forms.php?rev=2924628#L2312) |  |
  | 2300 | 2312 | </div> |
  | 2301 | 2313 | <br clear="all" /> |
  | 2302 |  |  |
  | 2303 |  | ~~<div>~~ |
  | 2304 |  | ~~<?php~~ |
  | 2305 |  | ~~/\* tutti i file della cartella css del tema \*/~~ |
  | 2306 |  | ~~$template\_dir = get\_template\_directory().'/css';~~ |
  | 2307 |  | ~~if(is\_dir($template\_dir) && false) :~~ |
  | 2308 |  | ~~?>~~ |
  | 2309 |  | ~~<h3>Include css from theme</h3>~~ |
  | 2310 |  | ~~<?php~~ |
  | 2311 |  | ~~//echo $template\_dir;~~ |
  | 2312 |  | ~~$files1 = scandir($template\_dir);~~ |
  | 2313 |  | ~~echo "<pre>";~~ |
  | 2314 |  | ~~print\_r($files1);~~ |
  | 2315 |  | ~~echo "</pre>"; ?>~~ |
  | 2316 |  | ~~<?php endif; ?>~~ |
  | 2317 |  | ~~</div>~~ |
  | 2318 |  |  |
  | 2319 | 2314 | </div> |
  | 2320 | 2315 | </div> |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L2780) | […](/browser/contact-forms/tags/1.5.8/accua-forms.php?rev=2924628#L2775) |  |
  | 2780 | 2775 | break; |
  | 2781 | 2776 | case 'date': |
  | 2782 |  | $element = new AccuaForm\_Element\_Date($istance\_data['label'], $istance\_data['istance\_id'], $field\_properties+array('value'=>$istance\_data['default\_value'], 'min~~'=>$istance\_data['min\_date'], 'max~~'=>$istance\_data['max\_date'])); |
  |  | 2777 | $element = new AccuaForm\_Element\_Date($istance\_data['label'], $istance\_data['istance\_id'], $field\_properties+array('value'=>$istance\_data['default\_value'], 'minDate'=>$istance\_data['min\_date'], 'maxDate'=>$istance\_data['max\_date'])); |
  | 2783 | 2778 | break; |
  | 2784 | 2779 | //case 'textfield': |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L3520) | […](/browser/contact-forms/tags/1.5.8/accua-forms.php?rev=2924628#L3515) |  |
  | 3520 | 3515 | } |
  | 3521 | 3516 |  |
  | 3522 |  | echo '<html><head>'; |
  | 3523 |  | //wp\_enqueue\_style( 'style', get\_template\_directory\_uri().'/css/style.css' ); |
  |  | 3517 | echo '<html><head> |
  |  | 3518 | <style> |
  |  | 3519 | body {font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif;} |
  |  | 3520 | </style>'; |
  | 3524 | 3521 | wp\_print\_styles(); |
  | 3525 | 3522 | wp\_print\_head\_scripts(); |
  | 3526 |  |  |
  | 3527 |  |  |
  |  | 3523 | echo '</head><body>'; |
  | 3528 | 3524 | echo accua\_forms\_shortcode\_handler(array('fid'=>$\_REQUEST['fid'])); |
  | 3529 | 3525 | wp\_print\_footer\_scripts(); |
* ## [contact-forms/tags/1.5.8/classes/Element/Captcha2.php](/changeset/2924628/contact-forms/tags/1.5.8/classes/Element/Captcha2.php "Show the changeset 2924628 restricted to contact-forms/tags/1.5.8/classes/Element/Captcha2.php")

  | [r2879909](/browser/contact-forms/trunk/classes/Element/Captcha2.php?rev=2879909#L4 "Show revision 2879909 of this file in browser") | [r2924628](/browser/contact-forms/tags/1.5.8/classes/Element/Captcha2.php?rev=2924628#L4 "Show revision 2924628 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | protected $publicKey = ""; |
  | 5 | 5 |  |
  | 6 |  | public function \_\_construct($label = "", $unused, array $properties = null) { |
  |  | 6 | public function \_\_construct($label = "", $unused = null, array $properties = null) { |
  | 7 | 7 | if ($properties === null && is\_array($unused)) { |
  | 8 | 8 | $properties = $unused; |
  | […](/browser/contact-forms/trunk/classes/Element/Captcha2.php?rev=2879909#L24) | […](/browser/contact-forms/tags/1.5.8/classes/Element/Captcha2.php?rev=2924628#L24) |  |
  | 24 | 24 | <script type="text/javascript"> |
  | 25 | 25 | <!-- |
  | 26 |  | let clicked = false; |
  | 27 |  | let reqclick = document.querySelector(".accuaforms-field-required"); |
  | 28 |  |  |
  | 29 |  | reqclick.addEventListener('keypress', function() { |
  | 30 |  | if(!clicked){ |
  | 31 |  | if (typeof(accuaform\_recaptcha2\_ajax\_loaded) == "undefined" || !accuaform\_recaptcha2\_ajax\_loaded) { |
  | 32 |  | var accuaform\_recaptcha2\_ajax\_loaded = true; |
  | 33 |  | var accuaform\_recaptcha2\_ajax\_loading = true ; |
  | 34 |  | var accuaform\_recaptcha2\_ajax\_controller = jQuery({}); |
  | 35 |  | var accuaform\_recaptcha2\_ajax\_initialized = {}; |
  | 36 |  | jQuery.getScript( $js\_path , function(){ |
  | 37 |  | jQuery.getScript( "https://www.recaptcha.net/recaptcha/api.js?onload=accua\_forms\_onload\_recaptcha2&render=explicit&hl=" + $js\_lang ); |
  | 38 |  | accuaform\_recaptcha2\_ajax\_loading = false; |
  | 39 |  | accuaform\_recaptcha2\_ajax\_controller.trigger('loaded'); |
  | 40 |  | }); |
  | 41 |  | if (!accuaform\_recaptcha2\_ajax\_initialized[ $js\_field\_id ]) { |
  | 42 |  | accuaform\_recaptcha2\_ajax\_initialized[ $js\_field\_id ] = true; |
  | 43 |  | jQuery(function(){ |
  | 44 |  | //punto da modificare |
  | 45 |  | if (accuaform\_recaptcha2\_ajax\_loading) { |
  | 46 |  | accuaform\_recaptcha2\_ajax\_controller.one('loaded', function(){ |
  | 47 |  | accua\_forms\_show\_recaptcha2( $js\_field\_id , { sitekey: $js\_publicKey }); |
  | 48 |  | }) |
  | 49 |  | } else { |
  | 50 |  | accua\_forms\_show\_recaptcha2( $js\_field\_id , { sitekey: $js\_publicKey }); |
  | 51 |  | } |
  | 52 |  | }); |
  | 53 |  | } |
  | 54 |  | } |
  |  | 26 | if (typeof(accuaform\_recaptcha2\_ajax\_loaded) == "undefined" || !accuaform\_recaptcha2\_ajax\_loaded) { |
  |  | 27 | var accuaform\_recaptcha2\_ajax\_loaded = true; |
  |  | 28 | var accuaform\_recaptcha2\_ajax\_delaying = true; |
  |  | 29 | var accuaform\_recaptcha2\_ajax\_loading = true ; |
  |  | 30 | var accuaform\_recaptcha2\_ajax\_controller = jQuery({}); |
  |  | 31 | var accuaform\_recaptcha2\_ajax\_initialized = {}; |
  |  | 32 | jQuery(".accuaforms-field-required, .pfbc-fieldwrap > \*").one('change', function() { |
  |  | 33 | if(accuaform\_recaptcha2\_ajax\_delaying){ |
  |  | 34 | accuaform\_recaptcha2\_ajax\_delaying = false; |
  |  | 35 | jQuery.getScript( $js\_path , function(){ |
  |  | 36 | jQuery.getScript( "https://www.recaptcha.net/recaptcha/api.js?onload=accua\_forms\_onload\_recaptcha2&render=explicit&hl=" + $js\_lang ); |
  |  | 37 | accuaform\_recaptcha2\_ajax\_loading = false; |
  |  | 38 | accuaform\_recaptcha2\_ajax\_controller.trigger('loaded'); |
  |  | 39 | }); |
  | 55 | 40 | } |
  | 56 |  | clicked = true; |
  | 57 |  | }); |
  | 58 |  |  |
  | 59 |  |  |
  | 60 |  |  |
  |  | 41 | }); |
  |  | 42 | } |
  |  | 43 | if (!accuaform\_recaptcha2\_ajax\_initialized[ $js\_field\_id ]) { |
  |  | 44 | accuaform\_recaptcha2\_ajax\_initialized[ $js\_field\_id ] = true; |
  |  | 45 | jQuery(function(){ |
  |  | 46 | if (accuaform\_recaptcha2\_ajax\_loading) { |
  |  | 47 | accuaform\_recaptcha2\_ajax\_controller.one('loaded', function(){ |
  |  | 48 | accua\_forms\_show\_recaptcha2( $js\_field\_id , { sitekey: $js\_publicKey }); |
  |  | 49 | }) |
  |  | 50 | } else { |
  |  | 51 | accua\_forms\_show\_recaptcha2( $js\_field\_id , { sitekey: $js\_publicKey }); |
  |  | 52 | } |
  |  | 53 | }); |
  |  | 54 | } |
  | 61 | 55 | // --> |
  | 62 | 56 | </script> |
* ## [contact-forms/tags/1.5.8/classes/Element/Date.php](/changeset/2924628/contact-forms/tags/1.5.8/classes/Element/Date.php "Show the changeset 2924628 restricted to contact-forms/tags/1.5.8/classes/Element/Date.php")

  | [r2880279](/browser/contact-forms/trunk/classes/Element/Date.php?rev=2880279#L1 "Show revision 2880279 of this file in browser") | [r2924628](/browser/contact-forms/tags/1.5.8/classes/Element/Date.php?rev=2924628#L1 "Show revision 2924628 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 | class AccuaForm\_Element\_Date extends Element\_Textbox { |
  |  | 3 | protected $minDate = null; |
  |  | 4 | protected $maxDate = null; |
  | 3 | 5 | public function \_\_construct($label, $name, array $properties = null) { |
  | 4 | 6 | parent::\_\_construct($label,$name,$properties); |
  | 5 | 7 | $this->attributes['type'] = 'date'; |
  | 6 | 8 | $this->attributes['pattern'] = '\d{4}-\d{2}-\d{2}'; |
  | 7 |  | $~~this->setValidation(~~new AccuaForm\_Validation\_Date( |
  |  | 9 | $validator = new AccuaForm\_Validation\_Date( |
  | 8 | 10 | str\_replace('%element%', $label, \_\_("Attention: '%element%' must contain a valid date.", 'contact-forms')) |
  | 9 |  | )); |
  |  | 11 | ); |
  |  | 12 | $validator->configure(array('minDate' => $this->minDate, 'maxDate'=> $this->maxDate)); |
  |  | 13 | $this->setValidation($validator); |
  | 10 | 14 | } |
  | 11 | 15 | } |
* ## [contact-forms/tags/1.5.8/classes/Validation/Date.php](/changeset/2924628/contact-forms/tags/1.5.8/classes/Validation/Date.php "Show the changeset 2924628 restricted to contact-forms/tags/1.5.8/classes/Validation/Date.php")

  | [r2880279](/browser/contact-forms/trunk/classes/Validation/Date.php?rev=2880279#L2 "Show revision 2880279 of this file in browser") | [r2924628](/browser/contact-forms/tags/1.5.8/classes/Validation/Date.php?rev=2924628#L2 "Show revision 2924628 of this file in browser") |  |
  | --- | --- | --- |
  | 2 | 2 | class AccuaForm\_Validation\_Date extends Validation { |
  | 3 | 3 | protected $message = "Error: %element% must contain a valid date."; |
  |  | 4 | protected $minDate = null; |
  |  | 5 | protected $maxDate = null; |
  | 4 | 6 |  |
  | 5 | 7 | public function isValid($value) { |
  |  | 8 | if ($value === '') { |
  |  | 9 | return true; |
  |  | 10 | } |
  | 6 | 11 | if (preg\_match('/^\d{4}-\d{2}-\d{2}$/', $value)) { |
  | 7 | 12 | try { |
  | 8 | 13 | $date = new DateTime($value); |
  | 9 | 14 | if ($date) { |
  |  | 15 | if ($this->minDate && ($value < $this->minDate)) { |
  |  | 16 | return false; |
  |  | 17 | } |
  |  | 18 | if ($this->maxDate && ($value > $this->maxDate)) { |
  |  | 19 | return false; |
  |  | 20 | } |
  | 10 | 21 | return true; |
  | 11 | 22 | } |
* ## [contact-forms/tags/1.5.8/contact-forms.php](/changeset/2924628/contact-forms/tags/1.5.8/contact-forms.php "Show the changeset 2924628 restricted to contact-forms/tags/1.5.8/contact-forms.php")

  | [r2893400](/browser/contact-forms/trunk/contact-forms.php?rev=2893400#L3 "Show revision 2893400 of this file in browser") | [r2924628](/browser/contact-forms/tags/1.5.8/contact-forms.php?rev=2924628#L3 "Show revision 2924628 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | Plugin Name: WordPress Contact Forms by Cimatti |
  | 4 | 4 | Description: Quickly create and publish forms in your WordPress powered website. |
  | 5 |  | Version: 1.5.~~7~~ |
  |  | 5 | Version: 1.5.8 |
  | 6 | 6 | Plugin URI: https://www.cimatti.it/wordpress/contact-forms/ |
  | 7 | 7 | Author: Cimatti Consulting |
  | […](/browser/contact-forms/trunk/contact-forms.php?rev=2893400#L13) | […](/browser/contact-forms/tags/1.5.8/contact-forms.php?rev=2924628#L13) |  |
  | 13 | 13 | /\* |
  | 14 | 14 | WordPress Contact Forms by Cimatti |
  | 15 |  | Copyright (c) 2011-202~~2~~ Andrea Cimatti |
  |  | 15 | Copyright (c) 2011-2023 Andrea Cimatti |
  | 16 | 16 |  |
  | 17 | 17 | This program is free software; you can redistribute it and/or |
  | […](/browser/contact-forms/trunk/contact-forms.php?rev=2893400#L36) | […](/browser/contact-forms/tags/1.5.8/contact-forms.php?rev=2924628#L36) |  |
  | 36 | 36 | define('ACCUA\_FORMS\_DB\_VERSION', '11'); |
  | 37 | 37 | define('ACCUA\_FORMS\_CSS\_VERSION', '49'); |
  | 38 |  | define('ACCUA\_FORMS\_JS\_VERSION', '~~6~~'); |
  |  | 38 | define('ACCUA\_FORMS\_JS\_VERSION', '7'); |
  | 39 | 39 | define('ACCUA\_FORMS\_DIR\_URL', plugin\_dir\_url( \_\_FILE\_\_ )); |
  | 40 | 40 | define('ACCUA\_FORMS\_DIR', dirname( \_\_FILE\_\_ )); |
  | […](/browser/contact-forms/trunk/contact-forms.php?rev=2893400#L45) | […](/browser/contact-forms/tags/1.5.8/contact-forms.php?rev=2924628#L45) |  |
  | 45 | 45 |  |
  | 46 | 46 | function accua\_forms\_dashboard\_page\_head(){ |
  | 47 |  | ~~$referer = $\_SERVER['HTTP\_REFERER'];~~ |
  | 48 |  | ~~$referer = str\_replace(['http://', 'https://'], '', $referer);~~ |
  | 49 |  | ~~$host = $\_SERVER['HTTP\_HOST'];~~ |
  | 50 |  |  |
  | 51 |  | ~~if ( $host !== substr($referer, 0, strlen($host))) {~~ |
  | 52 |  | ~~wp\_die("Accesso non consentito!");~~ |
  | 53 |  | ~~}~~ |
  | 54 | 47 | $screen = get\_current\_screen(); |
  | 55 | 48 | $screen->add\_help\_tab( array( |
  | […](/browser/contact-forms/trunk/contact-forms.php?rev=2893400#L138) | […](/browser/contact-forms/tags/1.5.8/contact-forms.php?rev=2924628#L131) |  |
  | 138 | 131 | global $wpdb; |
  | 139 | 132 |  |
  | 140 |  | require\_once(ABSPATH.'wp-admin/~~upgrade-functions~~.php'); |
  |  | 133 | require\_once(ABSPATH.'wp-admin/includes/upgrade.php'); |
  | 141 | 134 |  |
  | 142 | 135 | $charset\_collate = ''; |
  | […](/browser/contact-forms/trunk/contact-forms.php?rev=2893400#L149) | […](/browser/contact-forms/tags/1.5.8/contact-forms.php?rev=2924628#L142) |  |
  | 149 | 142 |  |
  | 150 | 143 | if ($old\_db\_version < 3) { |
  | 151 |  | @ $wpdb->query("ALTER TABLE `{$wpdb->prefix}accua\_forms\_submissions` DROP INDEX uri"); |
  | 152 |  | @ $wpdb->query("ALTER TABLE `{$wpdb->prefix}accua\_forms\_submissions` DROP INDEX referrer"); |
  |  | 144 | $wpdb\_suppress\_errors\_status = $wpdb->suppress\_errors(); |
  |  | 145 | $wpdb->query("ALTER TABLE `{$wpdb->prefix}accua\_forms\_submissions` DROP INDEX uri"); |
  |  | 146 | $wpdb->query("ALTER TABLE `{$wpdb->prefix}accua\_forms\_submissions` DROP INDEX referrer"); |
  |  | 147 | $wpdb->suppress\_errors($wpdb\_suppress\_errors\_status); |
  | 153 | 148 | } |
  | 154 | 149 |  |
* ## [contact-forms/tags/1.5.8/form-fields.js](/changeset/2924628/contact-forms/tags/1.5.8/form-fields.js "Show the changeset 2924628 restricted to contact-forms/tags/1.5.8/form-fields.js")

  | [r2879909](/browser/contact-forms/trunk/form-fields.js?rev=2879909#L178 "Show revision 2879909 of this file in browser") | [r2924628](/browser/contact-forms/tags/1.5.8/form-fields.js?rev=2924628#L178 "Show revision 2924628 of this file in browser") |  |
  | --- | --- | --- |
  | 178 | 178 | var a = { |
  | 179 | 179 | action: 'accua-form-fields-order', |
  | 180 |  | ~~savewidgets: $('#\_wpnonce\_widgets~~').val(), |
  |  | 180 | \_nonce\_edit\_form: $('#\_nonce\_edit\_form').val(), |
  | 181 | 181 | sidebars: [] |
  | 182 | 182 | }; |
  | […](/browser/contact-forms/trunk/form-fields.js?rev=2879909#L204) | […](/browser/contact-forms/tags/1.5.8/form-fields.js?rev=2924628#L204) |  |
  | 204 | 204 | a = { |
  | 205 | 205 | action: 'accua-save-form-field', |
  | 206 |  | ~~savewidgets: $('#\_wpnonce\_widgets~~').val(), |
  |  | 206 | \_nonce\_edit\_form: $('#\_nonce\_edit\_form').val(), |
  | 207 | 207 | sidebar: sb |
  | 208 | 208 | }; |
* ## [contact-forms/tags/1.5.8/form-settings.js](/changeset/2924628/contact-forms/tags/1.5.8/form-settings.js "Show the changeset 2924628 restricted to contact-forms/tags/1.5.8/form-settings.js")

  | [r2879909](/browser/contact-forms/trunk/form-settings.js?rev=2879909#L31 "Show revision 2879909 of this file in browser") | [r2924628](/browser/contact-forms/tags/1.5.8/form-settings.js?rev=2924628#L31 "Show revision 2924628 of this file in browser") |  |
  | --- | --- | --- |
  | 31 | 31 | 'action': 'accua-save-form-settings', |
  | 32 | 32 | 'form-id': form\_id, |
  |  | 33 | '\_nonce\_edit\_form': $('#\_nonce\_edit\_form').val(), |
  | 33 | 34 | 'title': $('#title').val(), |
  | 34 | 35 | 'use\_ajax': ($('#accua\_form\_use\_ajax .accua\_form\_value').is(':checked') ? 1 : 0) |
* ## [contact-forms/tags/1.5.8/languages/contact-forms-es\_ES.po](/changeset/2924628/contact-forms/tags/1.5.8/languages/contact-forms-es_ES.po "Show the changeset 2924628 restricted to contact-forms/tags/1.5.8/languages/contact-forms-es_ES.po")

  | [r2879750](/browser/contact-forms/trunk/languages/contact-forms-es_ES.po?rev=2879750#L338 "Show revision 2879750 of this file in browser") | [r2924628](/browser/contact-forms/tags/1.5.8/languages/contact-forms-es_ES.po?rev=2924628#L338 "Show revision 2924628 of this file in browser") |  |
  | --- | --- | --- |
  | 338 | 338 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:667 |
  | 339 | 339 | #, php-format |
  | 340 |  | msgid "Form \~~\\"%s\\~~\" deleted" |
  | 341 |  | msgstr "Formulario \~~\\"%s\\~~\" eliminado" |
  |  | 340 | msgid "Form \"%s\" deleted" |
  |  | 341 | msgstr "Formulario \"%s\" eliminado" |
  | 342 | 342 |  |
  | 343 | 343 | #: D:\Accua |
* ## [contact-forms/tags/1.5.8/languages/contact-forms-it\_IT.po](/changeset/2924628/contact-forms/tags/1.5.8/languages/contact-forms-it_IT.po "Show the changeset 2924628 restricted to contact-forms/tags/1.5.8/languages/contact-forms-it_IT.po")

  | [r2879909](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L31 "Show revision 2879909 of this file in browser") | [r2924628](/browser/contact-forms/tags/1.5.8/languages/contact-forms-it_IT.po?rev=2924628#L31 "Show revision 2924628 of this file in browser") |  |
  | --- | --- | --- |
  | 31 | 31 | #: D:\Accua |
  | 32 | 32 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms-list-page.php:53 |
  | 33 |  | ~~#, fuzzy~~ |
  | 34 | 33 | msgid "Report" |
  | 35 |  | msgstr "~~Esporta~~" |
  |  | 34 | msgstr "Report" |
  | 36 | 35 |  |
  | 37 | 36 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L39) | […](/browser/contact-forms/tags/1.5.8/languages/contact-forms-it_IT.po?rev=2924628#L38) |  |
  | 39 | 38 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms-list-page.php:287 |
  | 40 | 39 | msgid "Trash" |
  | 41 |  | msgstr "" |
  |  | 40 | msgstr "Cestino" |
  | 42 | 41 |  |
  | 43 | 42 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L68) | […](/browser/contact-forms/tags/1.5.8/languages/contact-forms-it_IT.po?rev=2924628#L67) |  |
  | 68 | 67 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms-list-page.php:183 |
  | 69 | 68 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms-list-page.php:197 |
  | 70 |  | ~~#, fuzzy~~ |
  | 71 | 69 | msgid "(no title)" |
  | 72 |  | msgstr "~~Titolo del form~~" |
  |  | 70 | msgstr "(nessun titolo)" |
  | 73 | 71 |  |
  | 74 | 72 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L159) | […](/browser/contact-forms/tags/1.5.8/languages/contact-forms-it_IT.po?rev=2924628#L157) |  |
  | 159 | 157 | #: D:\Accua |
  | 160 | 158 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms-submissions-page.php:506 |
  | 161 |  | ~~#, fuzzy~~ |
  | 162 | 159 | msgid "Export to excel" |
  | 163 |  | msgstr "Esporta in formato excel~~avanzato~~" |
  |  | 160 | msgstr "Esporta in formato excel" |
  | 164 | 161 |  |
  | 165 | 162 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L340) | […](/browser/contact-forms/tags/1.5.8/languages/contact-forms-it_IT.po?rev=2924628#L337) |  |
  | 340 | 337 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:667 |
  | 341 | 338 | #, php-format |
  | 342 |  | msgid "Form \~~\\"%s\\~~\" deleted" |
  | 343 |  | msgstr "Form \~~\\"%s\\~~\" cancellato" |
  |  | 339 | msgid "Form \"%s\" deleted" |
  |  | 340 | msgstr "Form \"%s\" cancellato" |
  | 344 | 341 |  |
  | 345 | 342 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L359) | […](/browser/contact-forms/tags/1.5.8/languages/contact-forms-it_IT.po?rev=2924628#L356) |  |
  | 359 | 356 |  |
  | 360 | 357 | #: D:\Accua |
  | 361 |  | ~~#: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:708~~ |
  | 362 |  | ~~#, fuzzy~~ |
  | 363 |  | ~~msgid "Accua Forms"~~ |
  | 364 |  | ~~msgstr "Impostazioni di Accua Forms"~~ |
  | 365 |  |  |
  | 366 |  | ~~#: D:\Accua~~ |
  | 367 | 358 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:709 |
  | 368 |  | ~~#, fuzzy~~ |
  | 369 | 359 | msgid "Add New" |
  | 370 |  | msgstr "Crea" |
  |  | 360 | msgstr "Crea Nuovo" |
  | 371 | 361 |  |
  | 372 | 362 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L436) | […](/browser/contact-forms/tags/1.5.8/languages/contact-forms-it_IT.po?rev=2924628#L426) |  |
  | 436 | 426 | #: D:\Accua |
  | 437 | 427 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:816 |
  | 438 |  | ~~#, fuzzy~~ |
  | 439 | 428 | msgid "Drop fields here" |
  | 440 | 429 | msgstr "Trascina qui i campi" |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L447) | […](/browser/contact-forms/tags/1.5.8/languages/contact-forms-it_IT.po?rev=2924628#L436) |  |
  | 447 | 436 | #: D:\Accua |
  | 448 | 437 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:851 |
  | 449 |  | ~~#, fuzzy~~ |
  | 450 | 438 | msgid "Drag fields from here to a sidebar on the right to activate them. Drag fields back here to deactivate them." |
  | 451 | 439 | msgstr "Per attivare i campi, trascinali da qui alla sidebar sulla destra. Trascinali di nuovo qui per disattivarli e cancellare le loro impostazioni." |
  | 452 | 440 |  |
  | 453 | 441 | #: D:\Accua |
  | 454 |  | ~~#: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:852~~ |
  | 455 |  | ~~#, fuzzy~~ |
  | 456 |  | ~~msgid "Create new fields here"~~ |
  | 457 |  | ~~msgstr "crea un nuovo campo"~~ |
  | 458 |  |  |
  | 459 |  | ~~#: D:\Accua~~ |
  | 460 | 442 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:901 |
  | 461 | 443 | msgid "Token" |
  | 462 |  | msgstr "" |
  |  | 444 | msgstr "Token" |
  | 463 | 445 |  |
  | 464 | 446 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L490) | […](/browser/contact-forms/tags/1.5.8/languages/contact-forms-it_IT.po?rev=2924628#L472) |  |
  | 490 | 472 |  |
  | 491 | 473 | #: D:\Accua |
  | 492 |  | ~~#: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:920~~ |
  | 493 |  | ~~#: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:939~~ |
  | 494 |  | ~~#: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:977~~ |
  | 495 |  | ~~#: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1009~~ |
  | 496 |  | ~~#, fuzzy~~ |
  | 497 |  | ~~msgid "Nessun messaggio"~~ |
  | 498 |  | ~~msgstr "Messaggio di conferma"~~ |
  | 499 |  |  |
  | 500 |  | ~~#: D:\Accua~~ |
  | 501 | 474 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:922 |
  | 502 |  | ~~#, fuzzy~~ |
  | 503 | 475 | msgid "Default Success message" |
  | 504 |  | msgstr "Messaggio di conferma" |
  |  | 476 | msgstr "Messaggio di conferma predefinito" |
  | 505 | 477 |  |
  | 506 | 478 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L511) | […](/browser/contact-forms/tags/1.5.8/languages/contact-forms-it_IT.po?rev=2924628#L483) |  |
  | 511 | 483 | #: D:\Accua |
  | 512 | 484 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:941 |
  | 513 |  | ~~#, fuzzy~~ |
  | 514 | 485 | msgid "Default error message" |
  | 515 |  | msgstr "Messaggio di errore" |
  |  | 486 | msgstr "Messaggio di errore predefinito" |
  | 516 | 487 |  |
  | 517 | 488 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L525) | […](/browser/contact-forms/tags/1.5.8/languages/contact-forms-it_IT.po?rev=2924628#L496) |  |
  | 525 | 496 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1718 |
  | 526 | 497 | msgid "To" |
  | 527 |  | msgstr "" |
  |  | 498 | msgstr "A" |
  | 528 | 499 |  |
  | 529 | 500 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L531) | […](/browser/contact-forms/tags/1.5.8/languages/contact-forms-it_IT.po?rev=2924628#L502) |  |
  | 531 | 502 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1723 |
  | 532 | 503 | msgid "Bcc" |
  | 533 |  | msgstr "" |
  |  | 504 | msgstr "Ccn" |
  | 534 | 505 |  |
  | 535 | 506 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L539) | […](/browser/contact-forms/tags/1.5.8/languages/contact-forms-it_IT.po?rev=2924628#L510) |  |
  | 539 | 510 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1750 |
  | 540 | 511 | msgid "Subject" |
  | 541 |  | msgstr "" |
  |  | 512 | msgstr "Oggetto" |
  | 542 | 513 |  |
  | 543 | 514 | #: D:\Accua |
  | 544 | 515 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:979 |
  | 545 | 516 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1011 |
  | 546 |  | ~~#, fuzzy~~ |
  | 547 | 517 | msgid "Default message" |
  | 548 |  | msgstr "Valore di default" |
  | 549 |  |  |
  | 550 |  | #: D:\Accua |
  | 551 |  | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:991 |
  | 552 |  | msgid "4. Email confirmation to the person who completed the form " |
  | 553 |  | msgstr "" |
  | 554 |  |  |
  | 555 |  | #: D:\Accua |
  | 556 |  | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:994 |
  | 557 |  | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1745 |
  | 558 |  | #, fuzzy |
  | 559 |  | msgid "From" |
  | 560 |  | msgstr "Form" |
  | 561 |  |  |
  | 562 |  | #: D:\Accua |
  | 563 |  | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1029 |
  | 564 |  | msgid "Se hai fatto modifiche, salva prima le modifiche poi" |
  | 565 |  | msgstr "" |
  | 566 |  |  |
  | 567 |  | #: D:\Accua |
  | 568 |  | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1030 |
  | 569 |  | msgid "ricarica la pagina" |
  | 570 |  | msgstr "" |
  |  | 518 | msgstr "Messaggio predefinito" |
  | 571 | 519 |  |
  | 572 | 520 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L578) | […](/browser/contact-forms/tags/1.5.8/languages/contact-forms-it_IT.po?rev=2924628#L526) |  |
  | 578 | 526 | #: D:\Accua |
  | 579 | 527 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1274 |
  | 580 |  | ~~#, fuzzy, php-format~~ |
  | 581 | 528 | msgid "Field \"%s\" deleted" |
  | 582 |  | msgstr "Campo \"%s\" ~~aggiorn~~ato" |
  |  | 529 | msgstr "Campo \"%s\" cancellato" |
  | 583 | 530 |  |
  | 584 | 531 | #: D:\Accua |
  | 585 | 532 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1283 |
  | 586 |  | ~~#, fuzzy~~ |
  | 587 | 533 | msgid "Only letters, numbers, hyphen and underscores allowed in field identificative slug" |
  | 588 |  | msgstr "Sono consentite solo lettere, numeri e lineette nel~~nome~~ identificativo del form" |
  |  | 534 | msgstr "Sono consentite solo lettere, numeri e lineette nello slug identificativo del form" |
  | 589 | 535 |  |
  | 590 | 536 | #: D:\Accua |
  | 591 | 537 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1287 |
  | 592 |  | ~~#, fuzzy~~ |
  | 593 | 538 | msgid "The field identificative slug can't start with two underscores (\_\_)" |
  | 594 | 539 | msgstr "Il nome identificativo non può iniziare con due trattini bassi (\_\_)" |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L598) | […](/browser/contact-forms/tags/1.5.8/languages/contact-forms-it_IT.po?rev=2924628#L543) |  |
  | 598 | 543 | #, php-format |
  | 599 | 544 | msgid "<p>A field with identificative slug \"%s\" already exists</p> Field \"%s\" deleted" |
  | 600 |  | msgstr "Un campo con slug \"%s\" esiste già</p> Campo \"%s\" cancellato" |
  |  | 545 | msgstr "<p>Un campo con slug \"%s\" esiste già</p> Campo \"%s\" cancellato" |
  | 601 | 546 |  |
  | 602 | 547 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L607) | […](/browser/contact-forms/tags/1.5.8/languages/contact-forms-it_IT.po?rev=2924628#L552) |  |
  | 607 | 552 | #: D:\Accua |
  | 608 | 553 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1309 |
  | 609 |  | ~~#, fuzzy, php-format~~ |
  | 610 | 554 | msgid "Field \"%s\" created" |
  | 611 |  | msgstr "Campo \"%s\" ~~aggiorn~~ato" |
  |  | 555 | msgstr "Campo \"%s\" creato" |
  | 612 | 556 |  |
  | 613 | 557 | #: D:\Accua |
  | 614 | 558 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1327 |
  | 615 |  | ~~#, fuzzy, php-format~~ |
  | 616 | 559 | msgid "Field \"%s\" doesn't exists" |
  | 617 |  | msgstr "Il ~~form sorgente non esiste.~~" |
  |  | 560 | msgstr "Il campo \"%s\" non esiste" |
  | 618 | 561 |  |
  | 619 | 562 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L637) | […](/browser/contact-forms/tags/1.5.8/languages/contact-forms-it_IT.po?rev=2924628#L580) |  |
  | 637 | 580 | #: D:\Accua |
  | 638 | 581 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1487 |
  | 639 |  | ~~#, fuzzy~~ |
  | 640 | 582 | msgid "Text Field" |
  | 641 |  | msgstr "Camp~~i~~" |
  |  | 583 | msgstr "Campo di testo" |
  | 642 | 584 |  |
  | 643 | 585 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L658) | […](/browser/contact-forms/tags/1.5.8/languages/contact-forms-it_IT.po?rev=2924628#L600) |  |
  | 658 | 600 | #: D:\Accua |
  | 659 | 601 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1492 |
  | 660 |  | ~~#, fuzzy~~ |
  | 661 | 602 | msgid "Select" |
  | 662 |  | msgstr "~~Cancella~~" |
  |  | 603 | msgstr "Select" |
  | 663 | 604 |  |
  | 664 | 605 | #: D:\Accua |
  | 665 | 606 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1493 |
  | 666 | 607 | msgid "Radio buttons" |
  | 667 |  | msgstr "" |
  |  | 608 | msgstr "Pulsanti radio" |
  | 668 | 609 |  |
  | 669 | 610 | #: D:\Accua |
  | 670 | 611 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1494 |
  | 671 | 612 | msgid "Multiple selections area" |
  | 672 |  | msgstr "" |
  |  | 613 | msgstr "Area di selezione multipla" |
  | 673 | 614 |  |
  | 674 | 615 | #: D:\Accua |
  | 675 | 616 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1495 |
  | 676 | 617 | msgid "Multiple checkboxes" |
  | 677 |  | msgstr "" |
  |  | 618 | msgstr "Checkbox multipli" |
  | 678 | 619 |  |
  | 679 | 620 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L689) | […](/browser/contact-forms/tags/1.5.8/languages/contact-forms-it_IT.po?rev=2924628#L630) |  |
  | 689 | 630 | #: D:\Accua |
  | 690 | 631 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1498 |
  | 691 |  | ~~#, fuzzy~~ |
  | 692 | 632 | msgid "Submit button" |
  | 693 | 633 | msgstr "Bottone di invio" |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L695) | […](/browser/contact-forms/tags/1.5.8/languages/contact-forms-it_IT.po?rev=2924628#L635) |  |
  | 695 | 635 | #: D:\Accua |
  | 696 | 636 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1499 |
  | 697 |  | ~~#, fuzzy~~ |
  | 698 | 637 | msgid "Custom HTML" |
  | 699 | 638 | msgstr "Contenuto HTML personalizzato" |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L702) | […](/browser/contact-forms/tags/1.5.8/languages/contact-forms-it_IT.po?rev=2924628#L641) |  |
  | 702 | 641 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1500 |
  | 703 | 642 | msgid "Captcha" |
  | 704 |  | msgstr "" |
  |  | 643 | msgstr "Captcha" |
  | 705 | 644 |  |
  | 706 | 645 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L712) | […](/browser/contact-forms/tags/1.5.8/languages/contact-forms-it_IT.po?rev=2924628#L651) |  |
  | 712 | 651 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1508 |
  | 713 | 652 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1587 |
  | 714 |  | ~~#, fuzzy~~ |
  | 715 | 653 | msgid "Add new field" |
  | 716 |  | msgstr "Crea nuovo ~~form~~" |
  |  | 654 | msgstr "Crea nuovo campo" |
  | 717 | 655 |  |
  | 718 | 656 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L743) | […](/browser/contact-forms/tags/1.5.8/languages/contact-forms-it_IT.po?rev=2924628#L681) |  |
  | 743 | 681 | #: D:\Accua |
  | 744 | 682 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1531 |
  | 745 |  | ~~#, fuzzy~~ |
  | 746 | 683 | msgid "Field type" |
  | 747 |  | msgstr "~~Filtra~~" |
  |  | 684 | msgstr "Tipo di campo" |
  | 748 | 685 |  |
  | 749 | 686 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L759) | […](/browser/contact-forms/tags/1.5.8/languages/contact-forms-it_IT.po?rev=2924628#L696) |  |
  | 759 | 696 | #: D:\Accua |
  | 760 | 697 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1569 |
  | 761 |  | ~~#, fuzzy~~ |
  | 762 | 698 | msgid "For multiple default values in multiple select and multiple checkboxes, use | as separator." |
  | 763 |  | msgstr "Usa | per dividere più valori di default." |
  |  | 699 | msgstr "Usa | per dividere più valori di default nei campi di selezione multipla e checkbox multipli." |
  | 764 | 700 |  |
  | 765 | 701 | #: D:\Accua |
  | 766 | 702 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1575 |
  | 767 |  | ~~#, fuzzy~~ |
  | 768 | 703 | msgid "Options used in select, radio and multiple checkboxes. Enter one value per line, in the format key|label. The key is the value that will be stored in the database. The label is optional, and the key will be used as the label if no label is specified. For file fields, this indicates allowed extensions (one per line without dot)" |
  | 769 |  | msgstr "~~Valori che il campo può contenere. Inserisci un valore per riga, nel formato chiave|etichetta. La chiave è il valore che verrà salvato nel database. L'etichetta è opzionale: se non è specificata, verrà utilizzata la chiave.~~" |
  |  | 704 | msgstr "Opzioni dei campi select, radio e checkbox multipli. Inserisci un valore per riga, nel formato chiave|etichetta. La chiave è il valore che verrà salvato nel database. L'etichetta è opzionale: se non è specificata, verrà utilizzata la chiave. Per i campi file, questo indica le estensioni abilitate (una per linea senza punto)" |
  | 770 | 705 |  |
  | 771 | 706 | #: D:\Accua |
  | 772 | 707 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1589 |
  | 773 |  | ~~#, fuzzy~~ |
  | 774 | 708 | msgid "Save changes" |
  | 775 |  | msgstr "Salva ~~le~~ impostazioni" |
  |  | 709 | msgstr "Salva impostazioni" |
  | 776 | 710 |  |
  | 777 | 711 | #: D:\Accua |
  | 778 | 712 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1590 |
  | 779 |  | ~~#, fuzzy~~ |
  | 780 | 713 | msgid "Delete field" |
  | 781 |  | msgstr "~~Cancella~~" |
  |  | 714 | msgstr "Elimina campo" |
  | 782 | 715 |  |
  | 783 | 716 | #: D:\Accua |
  | 784 | 717 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1621 |
  | 785 |  | ~~#, fuzzy~~ |
  | 786 | 718 | msgid "Default Form settings" |
  | 787 |  | msgstr "Impostazioni di ~~Accua Forms~~" |
  |  | 719 | msgstr "Impostazioni di Default dei Form" |
  | 788 | 720 |  |
  | 789 | 721 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L831) | […](/browser/contact-forms/tags/1.5.8/languages/contact-forms-it_IT.po?rev=2924628#L763) |  |
  | 831 | 763 | msgid "Confirmation email message" |
  | 832 | 764 | msgstr "Messaggio nell'email di conferma" |
  | 833 |  |  |
  | 834 |  | ~~#: D:\Accua~~ |
  | 835 |  | ~~#: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1704~~ |
  | 836 |  | ~~#, fuzzy~~ |
  | 837 |  | ~~msgid "2 On-screen error message"~~ |
  | 838 |  | ~~msgstr "1. Messaggio di successo al completamento del form"~~ |
  | 839 | 765 |  |
  | 840 | 766 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L852) | […](/browser/contact-forms/tags/1.5.8/languages/contact-forms-it_IT.po?rev=2924628#L778) |  |
  | 852 | 778 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1766 |
  | 853 | 779 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1793 |
  | 854 |  | ~~#, fuzzy~~ |
  | 855 | 780 | msgid "Valid extensions" |
  | 856 | 781 | msgstr "Estensioni consentite" |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L878) | […](/browser/contact-forms/tags/1.5.8/languages/contact-forms-it_IT.po?rev=2924628#L803) |  |
  | 878 | 803 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1801 |
  | 879 | 804 | msgid "This value is limited by server upload limits of " |
  | 880 |  | msgstr "" |
  |  | 805 | msgstr "Questo valore è ristretto dal limite di upload del server di " |
  | 881 | 806 |  |
  | 882 | 807 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L884) | […](/browser/contact-forms/tags/1.5.8/languages/contact-forms-it_IT.po?rev=2924628#L809) |  |
  | 884 | 809 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1803 |
  | 885 | 810 | msgid "If you need a greater limit you should ask to the server administrator." |
  | 886 |  | msgstr "" |
  |  | 811 | msgstr "Se hai bisogno di un limite più alto devi chiedere all'amministratore del server." |
  | 887 | 812 |  |
  | 888 | 813 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L890) | […](/browser/contact-forms/tags/1.5.8/languages/contact-forms-it_IT.po?rev=2924628#L815) |  |
  | 890 | 815 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1807 |
  | 891 | 816 | msgid "Upload path" |
  | 892 |  | msgstr "" |
  | 893 |  |  |
  | 894 |  | #: D:\Accua |
  | 895 |  | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1782 |
  | 896 |  | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1808 |
  | 897 |  | msgid "If it stars with " |
  | 898 |  | msgstr "" |
  |  | 817 | msgstr "Percorso caricamento" |
  | 899 | 818 |  |
  | 900 | 819 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L1118) | […](/browser/contact-forms/tags/1.5.8/languages/contact-forms-it_IT.po?rev=2924628#L1037) |  |
  | 1118 | 1037 | msgid "Post select" |
  | 1119 | 1038 | msgstr "Select dei post" |
  |  | 1039 |  |
  |  | 1040 | msgid "Preview" |
  |  | 1041 | msgstr "Anteprima" |
  |  | 1042 |  |
  |  | 1043 | msgid "(for spam or tests submissions)" |
  |  | 1044 | msgstr "(per invii  di spam o test)" |
  |  | 1045 |  |
  |  | 1046 | msgid "Appearance" |
  |  | 1047 | msgstr "Grafica" |
  |  | 1048 |  |
  |  | 1049 | msgid "General" |
  |  | 1050 | msgstr "Generali" |
  |  | 1051 |  |
  |  | 1052 | msgid "Do not reload the page on form submission" |
  |  | 1053 | msgstr "Non ricaricare la pagina alla compilazione del form" |
  |  | 1054 |  |
  |  | 1055 | msgid "Labels" |
  |  | 1056 | msgstr "Etichette" |
  |  | 1057 |  |
  |  | 1058 | msgid "Unstyled Preview" |
  |  | 1059 | msgstr "Anteprima senza stile" |
  |  | 1060 |  |
  |  | 1061 | msgid "This representation does not incorporate the active theme styles of your website. To view the finalized look, integrate this form within your website." |
  |  | 1062 | msgstr "Questa anteprima non include gli stili del tema attivo del tuo sito. Per visualizzare l'aspetto finale, integra questo form nel tuo sito." |
  |  | 1063 |  |
  |  | 1064 | msgid "Drag & Drop Form Fields" |
  |  | 1065 | msgstr "Trascina i Campi del Form" |
* ## [contact-forms/tags/1.5.8/phpseclib-crypt/Base.php](/changeset/2924628/contact-forms/tags/1.5.8/phpseclib-crypt/Base.php "Show the changeset 2924628 restricted to contact-forms/tags/1.5.8/phpseclib-crypt/Base.php")

  | [r2048304](/browser/contact-forms/trunk/phpseclib-crypt/Base.php?rev=2048304#L123 "Show revision 2048304 of this file in browser") | [r2924628](/browser/contact-forms/tags/1.5.8/phpseclib-crypt/Base.php?rev=2924628#L123 "Show revision 2924628 of this file in browser") |  |
  | --- | --- | --- |
  | 123 | 123 | \* @access  public |
  | 124 | 124 | \*/ |
  |  | 125 | #[AllowDynamicProperties] |
  | 125 | 126 | class Crypt\_Base |
  | 126 | 127 | { |
* ## [contact-forms/tags/1.5.8/readme.txt](/changeset/2924628/contact-forms/tags/1.5.8/readme.txt "Show the changeset 2924628 restricted to contact-forms/tags/1.5.8/readme.txt")

  | [r2893400](/browser/contact-forms/trunk/readme.txt?rev=2893400#L4 "Show revision 2893400 of this file in browser") | [r2924628](/browser/contact-forms/tags/1.5.8/readme.txt?rev=2924628#L4 "Show revision 2924628 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Requires at least: 3.5 |
  | 5 | 5 | Tested up to: 6.2.0 |
  | 6 |  | Stable tag: 1.5.~~7~~ |
  |  | 6 | Stable tag: 1.5.8 |
  | 7 | 7 | License: GPLv2 or later |
  | 8 | 8 | License URI: http://www.gnu.org/licenses/gpl-2.0.html |
  | […](/browser/contact-forms/trunk/readme.txt?rev=2893400#L88) | […](/browser/contact-forms/tags/1.5.8/readme.txt?rev=2924628#L88) |  |
  | 88 | 88 | == Changelog == |
  | 89 | 89 |  |
  |  | 90 | = 1.5.8 = |
  |  | 91 | \* Fixed CSRF vulnerabilities |
  |  | 92 | \* Fixed some JavaScript errors due to WordPress filters |
  |  | 93 | \* Fixed many minor bugs |
  |  | 94 |  |
  | 90 | 95 | = 1.5.7 = |
  | 91 |  | \* tested compatibility ~~for wordp~~ress 6.2.0 |
  |  | 96 | \* tested compatibility with WordPress 6.2.0 |
  | 92 | 97 |  |
  | 93 | 98 | = 1.5.6 = |
  | […](/browser/contact-forms/trunk/readme.txt?rev=2893400#L95) | […](/browser/contact-forms/tags/1.5.8/readme.txt?rev=2924628#L100) |  |
  | 95 | 100 |  |
  | 96 | 101 | = 1.5.5 = |
  | 97 |  | \* Fixed XSS vulnerability |
  | 98 |  | \* Fixed XSS vulnerability |
  |  | 102 | \* Fixed XSS vulnerabilities |
  | 99 | 103 |  |
  | 100 | 104 | = 1.5.4 = |
* ## [contact-forms/trunk/AccuaForm.php](/changeset/2924628/contact-forms/trunk/AccuaForm.php "Show the changeset 2924628 restricted to contact-forms/trunk/AccuaForm.php")

  | [r2879909](/browser/contact-forms/trunk/AccuaForm.php?rev=2879909#L696 "Show revision 2879909 of this file in browser") | [r2924628](/browser/contact-forms/trunk/AccuaForm.php?rev=2924628#L696 "Show revision 2924628 of this file in browser") |  |
  | --- | --- | --- |
  | 696 | 696 | echo <<<JS |
  | 697 | 697 | <script type="text/javascript"> |
  | 698 |  | //<![CDATA[ |
  |  | 698 | <!-- |
  | 699 | 699 | var \_handle\_ajax\_submit\_{$js\_buildid} = function() {return true;} |
  | 700 | 700 | var \_handle\_ajax\_submit\_complete\_{$js\_buildid} = function() {return false;} |
  | […](/browser/contact-forms/trunk/AccuaForm.php?rev=2879909#L986) | […](/browser/contact-forms/trunk/AccuaForm.php?rev=2924628#L986) |  |
  | 986 | 986 | thisform.attr("onsubmit","return \_handle\_ajax\_submit\_{$js\_buildid}()"); |
  | 987 | 987 | }); |
  | 988 |  | //~~]]~~> |
  |  | 988 | // --> |
  | 989 | 989 | </script> |
  | 990 | 990 | <iframe id="submit\_target\_{$js\_buildid}" title="" name="submit\_target\_{$js\_buildid}" onload="\_handle\_ajax\_submit\_complete\_{$js\_buildid}()" onerror="\_handle\_ajax\_submit\_complete\_{$js\_buildid}()" style="width:0;height:0;border:0px solid #fff"></iframe> |
  | […](/browser/contact-forms/trunk/AccuaForm.php?rev=2879909#L994) | […](/browser/contact-forms/trunk/AccuaForm.php?rev=2924628#L994) |  |
  | 994 | 994 | echo <<<JSREFERRER |
  | 995 | 995 | <script type="text/javascript"> |
  |  | 996 | <!-- |
  | 996 | 997 | jQuery(function($){ |
  | 997 | 998 | var referrerfield = $("#{$this->buildID} input[name='\_AccuaForm\_referrer']"); |
  | […](/browser/contact-forms/trunk/AccuaForm.php?rev=2879909#L1002) | […](/browser/contact-forms/trunk/AccuaForm.php?rev=2924628#L1003) |  |
  | 1002 | 1003 | $("#{$this->buildID} input[name='\_AccuaForm\_platform']").val(navigator.platform); |
  | 1003 | 1004 | }); |
  |  | 1005 | // --> |
  | 1004 | 1006 | </script> |
  | 1005 | 1007 | JSREFERRER; |
  | […](/browser/contact-forms/trunk/AccuaForm.php?rev=2879909#L1015) | […](/browser/contact-forms/trunk/AccuaForm.php?rev=2924628#L1017) |  |
  | 1015 | 1017 | $this->renderJSFiles(); |
  | 1016 | 1018 |  |
  | 1017 |  | echo '<script type="text/javascript">'; |
  |  | 1019 | echo <<<JS |
  |  | 1020 | <script type="text/javascript"> |
  |  | 1021 | <!-- |
  |  | 1022 |  |
  |  | 1023 | JS; |
  | 1018 | 1024 | $this->view->renderJS(); |
  | 1019 | 1025 | foreach($this->elements as $element) |
  | […](/browser/contact-forms/trunk/AccuaForm.php?rev=2879909#L1028) | […](/browser/contact-forms/trunk/AccuaForm.php?rev=2924628#L1034) |  |
  | 1028 | 1034 |  |
  | 1029 | 1035 | $this->view->jQueryDocumentReady(); |
  | 1030 |  | foreach($this->elements as $element) |
  |  | 1036 | foreach($this->elements as $element) { |
  | 1031 | 1037 | $element->jQueryDocumentReady(); |
  |  | 1038 | } |
  | 1032 | 1039 |  |
  | 1033 | 1040 | /\*For ajax, an anonymous onsubmit javascript function is bound to the form using jQuery.  jQuery's |
  | […](/browser/contact-forms/trunk/AccuaForm.php?rev=2879909#L1065) | […](/browser/contact-forms/trunk/AccuaForm.php?rev=2924628#L1072) |  |
  | 1065 | 1072 | echo <<<JS |
  | 1066 | 1073 | }); |
  |  | 1074 | // --> |
  | 1067 | 1075 | </script> |
  | 1068 | 1076 | JS; |
* ## [contact-forms/trunk/accua-forms-dashboard.php](/changeset/2924628/contact-forms/trunk/accua-forms-dashboard.php "Show the changeset 2924628 restricted to contact-forms/trunk/accua-forms-dashboard.php")

  | [r2880592](/browser/contact-forms/trunk/accua-forms-dashboard.php?rev=2880592#L24 "Show revision 2880592 of this file in browser") | [r2924628](/browser/contact-forms/trunk/accua-forms-dashboard.php?rev=2924628#L24 "Show revision 2924628 of this file in browser") |  |
  | --- | --- | --- |
  | 24 | 24 | $avail\_fields = get\_option('accua\_forms\_avail\_fields', array()); |
  | 25 | 25 | foreach($avail\_fields as $key=>$single\_field){ |
  | 26 |  | if($single\_field['type'] == 'email' || $single\_field['type'] == 'autoreply\_email') |
  | 27 |  | $email\_fields[] = "'".$key."'"; |
  | 28 |  | } |
  | 29 |  | $email\_fields\_string = implode(',',$email\_fields); |
  | 30 |  | $num\_emails = $wpdb->get\_results("SELECT COUNT(DISTINCT (`afsv\_value`)) as num\_row |
  |  | 26 | if($single\_field['type'] == 'email' || $single\_field['type'] == 'autoreply\_email') { |
  |  | 27 | $email\_fields[] = $wpdb->prepare('%s', $key); |
  |  | 28 | } |
  |  | 29 | } |
  |  | 30 | if ($email\_fields) { |
  |  | 31 | $email\_fields\_string = implode(',', $email\_fields); |
  |  | 32 | $num\_emails = $wpdb->get\_results("SELECT COUNT(DISTINCT (`afsv\_value`)) as num\_row |
  | 31 | 33 | FROM {$wpdb->prefix}accua\_forms\_submissions, {$wpdb->prefix}accua\_forms\_submissions\_values |
  | 32 | 34 | WHERE `afs\_id` = `afsv\_sub\_id` |
  | 33 | 35 | AND afsv\_field\_id IN ({$email\_fields\_string}) |
  | 34 | 36 | AND afs\_status >= 0", ARRAY\_A); |
  |  | 37 | } else { |
  |  | 38 | $num\_emails = 0; |
  |  | 39 | } |
  | 35 | 40 |  |
  | 36 | 41 |  |
  | […](/browser/contact-forms/trunk/accua-forms-dashboard.php?rev=2880592#L60) | […](/browser/contact-forms/trunk/accua-forms-dashboard.php?rev=2924628#L65) |  |
  | 60 | 65 | if(isset($\_POST['del\_sub\_form'])) { |
  | 61 | 66 | $id = (int)$\_POST['del\_sub\_form']; |
  |  | 67 | check\_admin\_referer("del\_sub\_form\_{$id}", "\_wpnonce\_del\_sub\_form"); |
  | 62 | 68 | accua\_forms\_trash\_submission($id); |
  | 63 | 69 | } |
  | 64 | 70 |  |
  | 65 |  | //costruisco il grafico |
  | 66 |  | $query\_grafico = $wpdb->get\_results("SELECT YEAR( afs\_submitted ) AS `year` , MONTH( afs\_submitted ) AS `month` , COUNT( DISTINCT (`afs\_id`) ) AS `submissions` , COUNT( DISTINCT (`afsv\_value`)) AS `unique\_submissions` |
  |  | 71 | $label\_my = array(); |
  |  | 72 | $submissions = array(); |
  |  | 73 | $unique\_submissions = array(); |
  |  | 74 | $origin\_label\_my = array(); |
  |  | 75 |  |
  |  | 76 | if ($email\_fields) { |
  |  | 77 | //costruisco il grafico |
  |  | 78 | $query\_grafico = $wpdb->get\_results("SELECT YEAR( afs\_submitted ) AS `year` , MONTH( afs\_submitted ) AS `month` , COUNT( DISTINCT (`afs\_id`) ) AS `submissions` , COUNT( DISTINCT (`afsv\_value`)) AS `unique\_submissions` |
  | 67 | 79 | FROM `{$wpdb->prefix}accua\_forms\_submissions` |
  | 68 | 80 | LEFT JOIN `{$wpdb->prefix}accua\_forms\_submissions\_values` ON `afs\_id` = `afsv\_sub\_id` |
  | […](/browser/contact-forms/trunk/accua-forms-dashboard.php?rev=2880592#L73) | […](/browser/contact-forms/trunk/accua-forms-dashboard.php?rev=2924628#L85) |  |
  | 73 | 85 | ORDER BY `year` DESC , `month` DESC"); |
  | 74 | 86 |  |
  | 75 |  | if($query\_grafico){ |
  | 76 |  | $label\_my = array(); |
  | 77 |  | $submissions = array(); |
  | 78 |  | $unique\_submissions = array(); |
  | 79 |  | /\* cicliamo per ogni mese in modo da riempire con 0 i mesi senza compilazioni \*/ |
  | 80 |  | for($i=date('Y'); $i>=$query\_grafico[count($query\_grafico)-1]->year; $i-- ) { |
  | 81 |  | $start\_month=12; |
  | 82 |  | $end\_month = 1; |
  | 83 |  | if($i==date('Y')) $start\_month= date('n'); |
  | 84 |  | if($i==$query\_grafico[count($query\_grafico)-1]->year) $end\_month=$query\_grafico[count($query\_grafico)-1]->month; |
  | 85 |  | for($j=$start\_month;$j>=$end\_month;$j--) { |
  | 86 |  | $find=false; |
  | 87 |  | foreach ($query\_grafico as $result){ |
  | 88 |  | if(!$find && (int)$result->year == $i && (int)$result->month==$j) { |
  | 89 |  | $label\_my[] =  $j .'/'. $i; |
  | 90 |  | $submissions[] = (int)$result->submissions; |
  | 91 |  | $unique\_submissions[] = (int)$result->unique\_submissions; |
  | 92 |  | $find=true; |
  |  | 87 | if ($query\_grafico) { |
  |  | 88 | /\* cicliamo per ogni mese in modo da riempire con 0 i mesi senza compilazioni \*/ |
  |  | 89 | for ($i = date('Y'); $i >= $query\_grafico[count($query\_grafico) - 1]->year; $i--) { |
  |  | 90 | $start\_month = 12; |
  |  | 91 | $end\_month = 1; |
  |  | 92 | if ($i == date('Y')) $start\_month = date('n'); |
  |  | 93 | if ($i == $query\_grafico[count($query\_grafico) - 1]->year) $end\_month = $query\_grafico[count($query\_grafico) - 1]->month; |
  |  | 94 | for ($j = $start\_month; $j >= $end\_month; $j--) { |
  |  | 95 | $find = false; |
  |  | 96 | foreach ($query\_grafico as $result) { |
  |  | 97 | if (!$find && (int)$result->year == $i && (int)$result->month == $j) { |
  |  | 98 | $label\_my[] = $j . '/' . $i; |
  |  | 99 | $submissions[] = (int)$result->submissions; |
  |  | 100 | $unique\_submissions[] = (int)$result->unique\_submissions; |
  |  | 101 | $find = true; |
  |  | 102 | } |
  |  | 103 | } |
  |  | 104 | if (!$find) { |
  |  | 105 | $label\_my[] = $j . '/' . $i; |
  |  | 106 | $submissions[] = 0; |
  |  | 107 | $unique\_submissions[] = 0; |
  |  | 108 |  |
  | 93 | 109 | } |
  | 94 | 110 | } |
  | 95 |  | ~~if(!$find)~~ |
  | 96 |  | ~~{~~ |
  | 97 |  | ~~$label\_my[] = $j .'/'. $i;~~ |
  | 98 |  | ~~$submissions[] = 0;~~ |
  | 99 |  | ~~$unique\_submissions[] = 0;~~ |
  | 100 |  |  |
  | 101 |  | ~~}~~ |
  | 102 | 111 | } |
  |  | 112 | $origin\_label\_my = $label\_my; |
  |  | 113 | $origin\_submissions = $submissions; |
  |  | 114 | $origin\_unique\_submissions = $unique\_submissions; |
  |  | 115 |  |
  |  | 116 | if ($period != -1) { |
  |  | 117 | $label\_my = array\_slice($label\_my, 0, $period); |
  |  | 118 | $submissions = array\_slice($submissions, 0, $period); |
  |  | 119 | $unique\_submissions = array\_slice($unique\_submissions, 0, $period); |
  |  | 120 | } |
  |  | 121 |  |
  |  | 122 | $label\_my = array\_reverse($label\_my); |
  |  | 123 | $submissions = array\_reverse($submissions); |
  |  | 124 | $unique\_submissions = array\_reverse($unique\_submissions); |
  | 103 | 125 | } |
  | 104 |  | ~~$origin\_label\_my = $label\_my;~~ |
  | 105 |  | ~~$origin\_submissions = $submissions;~~ |
  | 106 |  | ~~$origin\_unique\_submissions = $unique\_submissions;~~ |
  | 107 |  |  |
  | 108 |  | ~~if($period != -1){~~ |
  | 109 |  | ~~$label\_my = array\_slice($label\_my, 0, $period);~~ |
  | 110 |  | ~~$submissions = array\_slice($submissions, 0, $period);~~ |
  | 111 |  | ~~$unique\_submissions = array\_slice($unique\_submissions, 0, $period);~~ |
  | 112 |  | ~~}~~ |
  | 113 |  |  |
  | 114 |  | ~~$label\_my = array\_reverse($label\_my);~~ |
  | 115 |  | ~~$submissions = array\_reverse($submissions);~~ |
  | 116 |  | ~~$unique\_submissions = array\_reverse($unique\_submissions);~~ |
  | 117 | 126 | } |
  | 118 | 127 |  |
  | […](/browser/contact-forms/trunk/accua-forms-dashboard.php?rev=2880592#L233) | […](/browser/contact-forms/trunk/accua-forms-dashboard.php?rev=2924628#L242) |  |
  | 233 | 242 | var ctx = document.getElementById('ContactChart').getContext('2d'); |
  | 234 | 243 | var myChart = new Chart(ctx, config); |
  | 235 |  | ~~console.log('chart initialized', myChart); //todo: togliere prima di pubblicare~~ |
  |  | 244 | //console.log('chart initialized', myChart); |
  | 236 | 245 |  |
  | 237 | 246 | function update\_mychart\_submissions(item, index) { |
  | […](/browser/contact-forms/trunk/accua-forms-dashboard.php?rev=2880592#L301) | […](/browser/contact-forms/trunk/accua-forms-dashboard.php?rev=2924628#L310) |  |
  | 301 | 310 | foreach ($data\_last\_submissions as $row) { |
  | 302 | 311 | /\* problema: i campi nome e cognome sono spesso diversi |
  | 303 |  | ~~cimatti.it -> nome e cognome~~ |
  | 304 |  | ~~comecer.com -> firstname e last~~name |
  | 305 |  | ~~ultimi siti -> first\_name e last\_name~~ |
  | 306 |  | \*/ |
  |  | 312 | in origine non erano creati in modo predefinito e in ogni sito possono essere diversi. |
  |  | 313 | Ora sono di default sono first\_name e last\_name |
  |  | 314 | ma comunque anche ora possono essere eliminati e se ne possono usare altri |
  |  | 315 |  |
  | 307 | 316 | $query\_meta\_submission\_nome = "SELECT `afsv\_value` |
  | 308 | 317 | FROM `{$wpdb->prefix}accua\_forms\_submissions\_values` |
  | […](/browser/contact-forms/trunk/accua-forms-dashboard.php?rev=2880592#L314) | […](/browser/contact-forms/trunk/accua-forms-dashboard.php?rev=2924628#L323) |  |
  | 314 | 323 | WHERE `afsv\_sub\_id` = %d |
  | 315 | 324 | AND `afsv\_field\_id` LIKE 'cognome'"; |
  | 316 |  |  |
  |  | 325 | \*/ |
  | 317 | 326 | $query\_meta\_submission\_email = "SELECT `afsv\_value` |
  | 318 | 327 | FROM `{$wpdb->prefix}accua\_forms\_submissions\_values` |
  | […](/browser/contact-forms/trunk/accua-forms-dashboard.php?rev=2880592#L327) | […](/browser/contact-forms/trunk/accua-forms-dashboard.php?rev=2924628#L336) |  |
  | 327 | 336 | WHERE `afs\_id` = %d"; |
  | 328 | 337 |  |
  | 329 |  | $data\_meta\_submission\_nome = $wpdb->get\_var($wpdb->prepare($query\_meta\_submission\_nome, $row->afs\_id)); |
  | 330 |  | $data\_meta\_submission\_cognome = $wpdb->get\_var($wpdb->prepare($query\_meta\_submission\_cognome, $row->afs\_id)); |
  | 331 |  | $data\_meta\_submission\_email = $wpdb->get\_var($wpdb->prepare($query\_meta\_submission\_email, $row->afs\_id)); |
  | 332 |  | $data\_meta\_submission\_uri = $wpdb->get\_var($wpdb->prepare($query\_data\_submission\_uri, $row->afs\_id)); |
  | 333 |  | $data\_meta\_submission\_ref = $wpdb->get\_var($wpdb->prepare($query\_data\_submission\_ref, $row->afs\_id)); |
  | 334 |  |  |
  |  | 338 | //$data\_meta\_submission\_nome = $wpdb->get\_var($wpdb->prepare($query\_meta\_submission\_nome, $row->afs\_id)); |
  |  | 339 | //$data\_meta\_submission\_cognome = $wpdb->get\_var($wpdb->prepare($query\_meta\_submission\_cognome, $row->afs\_id)); |
  |  | 340 | $data\_meta\_submission\_email = (string) $wpdb->get\_var($wpdb->prepare($query\_meta\_submission\_email, $row->afs\_id)); |
  |  | 341 | $data\_meta\_submission\_uri = (string) $wpdb->get\_var($wpdb->prepare($query\_data\_submission\_uri, $row->afs\_id)); |
  |  | 342 | $data\_meta\_submission\_ref = (string) $wpdb->get\_var($wpdb->prepare($query\_data\_submission\_ref, $row->afs\_id)); |
  | 335 | 343 |  |
  | 336 | 344 | echo '<tr>'; |
  | […](/browser/contact-forms/trunk/accua-forms-dashboard.php?rev=2880592#L342) | […](/browser/contact-forms/trunk/accua-forms-dashboard.php?rev=2924628#L350) |  |
  | 342 | 350 | } |
  | 343 | 351 | //echo '<td>'.$data\_meta\_submission\_nome.' '.$data\_meta\_submission\_cognome.'</td>'; |
  | 344 |  | echo '<td>'.~~$data\_meta\_submission\_email~~.'</td>'; |
  |  | 352 | echo '<td>'.htmlspecialchars($data\_meta\_submission\_email).'</td>'; |
  | 345 | 353 | echo '<td>'; |
  | 346 | 354 | //referrer |
  | 347 |  | echo '<a href="'.~~get\_bloginfo('url').$data\_meta\_submission\_ref.'" title="" target="\_blank">'.$data\_meta\_submission\_ref~~.'</a>'; |
  |  | 355 | echo '<a href="'.htmlspecialchars($data\_meta\_submission\_ref, ENT\_QUOTES).'" title="" target="\_blank">'.htmlspecialchars($data\_meta\_submission\_ref, ENT\_QUOTES).'</a>'; |
  | 348 | 356 | echo '</td>'; |
  | 349 | 357 | echo '<td>'; |
  | 350 |  | echo '<a href="'.~~get\_bloginfo('url').$data\_meta\_submission\_uri.'" title="" target="\_blank">'.$data\_meta\_submission\_uri~~.'</a>'; |
  |  | 358 | echo '<a href="'.htmlspecialchars(get\_bloginfo('url').$data\_meta\_submission\_uri, ENT\_QUOTES).'" title="" target="\_blank">'.htmlspecialchars($data\_meta\_submission\_uri, ENT\_QUOTES).'</a>'; |
  | 351 | 359 | echo '</td>'; |
  | 352 | 360 | //echo '<td>valido/non valido/ecc..</td>'; |
  | […](/browser/contact-forms/trunk/accua-forms-dashboard.php?rev=2880592#L355) | […](/browser/contact-forms/trunk/accua-forms-dashboard.php?rev=2924628#L363) |  |
  | 355 | 363 | <form id="delete-sub" method="post" action=""> |
  | 356 | 364 | <input type="hidden" name="del\_sub\_form" value="<?php echo $row->afs\_id; ?>" /> |
  |  | 365 | <?php wp\_nonce\_field("del\_sub\_form\_{$row->afs\_id}", "\_wpnonce\_del\_sub\_form"); ?> |
  | 357 | 366 | <input type="submit" id="delete-sub-data" class="accua\_forms\_trash" value="<?php \_e('Trash', 'contact-forms') ?>" onclick='return window.confirm("Are you sure you want to trash this submission?");'/> |
  | 358 | 367 | </form> |
* ## [contact-forms/trunk/accua-forms-help.php](/changeset/2924628/contact-forms/trunk/accua-forms-help.php "Show the changeset 2924628 restricted to contact-forms/trunk/accua-forms-help.php")

  | [r2880279](/browser/contact-forms/trunk/accua-forms-help.php?rev=2880279#L21 "Show revision 2880279 of this file in browser") | [r2924628](/browser/contact-forms/trunk/accua-forms-help.php?rev=2924628#L21 "Show revision 2924628 of this file in browser") |  |
  | --- | --- | --- |
  | 21 | 21 | $ret = ''; |
  | 22 | 22 | switch ($name) { |
  | 23 |  | /\*~~contacts-page | query \*/~~ |
  |  | 23 | /\* |
  | 24 | 24 | case 'help\_1': |
  | 25 | 25 | $ret = array( |
  | […](/browser/contact-forms/trunk/accua-forms-help.php?rev=2880279#L33) | […](/browser/contact-forms/trunk/accua-forms-help.php?rev=2924628#L33) |  |
  | 33 | 33 | 'text' => \_\_('2', 'contact-forms'). |
  | 34 | 34 | "<br/><dl>". |
  | 35 |  | "<dt>aaaa</dt><dd>". \_\_('bbb', '~~accua-contact~~s')."</dd>". |
  | 36 |  | "<dt>cccc</dt><dd>". \_\_('dddd', '~~accua-contact~~s')."</dd>". |
  |  | 35 | "<dt>aaaa</dt><dd>". \_\_('bbb', 'contact-forms')."</dd>". |
  |  | 36 | "<dt>cccc</dt><dd>". \_\_('dddd', 'contact-forms')."</dd>". |
  | 37 | 37 | "</dl>", |
  |  | 38 | ); |
  |  | 39 | break; |
  |  | 40 | \*/ |
  |  | 41 | case 'form\_edit\_preview': |
  |  | 42 | $ret = array( |
  |  | 43 | 'header' => \_\_('Unstyled Preview', 'contact-forms'), |
  |  | 44 | 'text' => \_\_('This representation does not incorporate the active theme styles of your website. To view the finalized look, integrate this form within your website.', 'contact-forms'), |
  | 38 | 45 | ); |
  | 39 | 46 | break; |
  | […](/browser/contact-forms/trunk/accua-forms-help.php?rev=2880279#L64) | […](/browser/contact-forms/trunk/accua-forms-help.php?rev=2924628#L71) |  |
  | 64 | 71 | $id = $this->counter++; |
  | 65 | 72 | //$id = count($this->helpTextSet); |
  | 66 |  | $anchor\_id = "~~tooltipExt~~\_$id"; |
  |  | 73 | $anchor\_id = "accua\_forms\_tooltip\_$id"; |
  | 67 | 74 |  |
  | 68 | 75 | $this->helpTextSet[] = array( |
  | […](/browser/contact-forms/trunk/accua-forms-help.php?rev=2880279#L92) | […](/browser/contact-forms/trunk/accua-forms-help.php?rev=2924628#L99) |  |
  | 92 | 99 | // error\_log(print\_r($pointer, true)); |
  | 93 | 100 | ?> |
  | 94 |  | $(~~' <?php echo $pointer['anchor\_id']; ?> '~~).click(function(){ |
  | 95 |  | $(~~' <?php echo $pointer['anchor\_id']; ?> '~~).pointer( { |
  | 96 |  | content: ~~'<?php echo $pointer['content']; ?>'~~, |
  |  | 101 | $(<?php echo \_accua\_forms\_json\_encode($pointer['anchor\_id']); ?>).click(function(){ |
  |  | 102 | $( <?php echo \_accua\_forms\_json\_encode($pointer['anchor\_id']); ?> ).pointer( { |
  |  | 103 | content: <?php echo \_accua\_forms\_json\_encode($pointer['content']); ?>, |
  | 97 | 104 | position: { |
  | 98 |  | edge: ~~'<?php echo $pointer['edge']; ?>'~~, |
  | 99 |  | align: ~~'<?php echo $pointer['align']; ?>'~~ |
  |  | 105 | edge: <?php echo \_accua\_forms\_json\_encode($pointer['edge']); ?>, |
  |  | 106 | align: <?php echo \_accua\_forms\_json\_encode($pointer['align']); ?> |
  | 100 | 107 | }, |
  | 101 | 108 | }).pointer( 'open' ); |
* ## [contact-forms/trunk/accua-forms-list-page.php](/changeset/2924628/contact-forms/trunk/accua-forms-list-page.php "Show the changeset 2924628 restricted to contact-forms/trunk/accua-forms-list-page.php")

  | [r2887413](/browser/contact-forms/trunk/accua-forms-list-page.php?rev=2887413#L51 "Show revision 2887413 of this file in browser") | [r2924628](/browser/contact-forms/trunk/accua-forms-list-page.php?rev=2924628#L51 "Show revision 2924628 of this file in browser") |  |
  | --- | --- | --- |
  | 51 | 51 | $item\_name = $item['ID']; |
  | 52 | 52 | } |
  |  | 53 | $nonced\_edit = wp\_nonce\_url('admin.php?page=accua\_forms\_list&amp;fid=' . $item['ID'] . '&amp;restore=1', 'restore\_post'); |
  | 53 | 54 | $actions = array( |
  | 54 |  | 'edit' => "<a href='~~admin.php?page=accua\_forms\_list&amp;fid={$item['ID']}&amp;restore=1~~'>".\_\_("Restore", 'contact-forms')."</a>", |
  |  | 55 | 'edit' => "<a href='" . $nonced\_edit . "'>".\_\_("Restore", 'contact-forms')."</a>", |
  | 55 | 56 | ); |
  | 56 | 57 | return "<strong>".$item\_name."</strong>".$this->row\_actions($actions); |
  | 57 | 58 | } else { |
  |  | 59 | $nonced\_edit = wp\_nonce\_url('admin.php?page=accua\_forms\_list&amp;fid=' . $item['ID'], 'edit\_posts'); |
  |  | 60 | $nonced\_clone = wp\_nonce\_url('admin.php?page=accua\_forms\_add&amp;clonefrom=' . $item['ID'], 'clone\_posts'); |
  |  | 61 | $nonced\_del = wp\_nonce\_url('admin.php?page=accua\_forms\_list&amp;fid\_del=' . $item['ID'], 'trash\_posts'); |
  | 58 | 62 | $actions = array( |
  | 59 |  | 'edit' => "<a href='~~admin.php?page=accua\_forms\_list&amp;fid={$item['ID']~~}'>".\_\_("Edit", 'contact-forms')."</a>" |
  | 60 |  | . " &middot; <a href='~~admin.php?page=accua\_forms\_add&amp;clonefrom={$item['ID']~~}'>".\_\_("Clone", 'contact-forms')."</a>" |
  |  | 63 | 'edit' => "<a href='{$nonced\_edit}'>".\_\_("Edit", 'contact-forms')."</a>" |
  |  | 64 | . " &middot; <a href='{$nonced\_clone}'>".\_\_("Clone", 'contact-forms')."</a>" |
  | 61 | 65 | . " &middot; <a href='admin.php?page=accua\_forms\_submissions\_list&amp;fid={$item['ID']}'>".\_\_("Report", 'contact-forms')."</a>" |
  | 62 |  | . " &middot; <a href='~~admin.php?page=accua\_forms\_list&amp;fid\_del={$item['ID']~~}'>".\_\_("Trash", 'contact-forms')."</a>", |
  | 63 |  | ); |
  | 64 |  | return "<strong><a class='row-title' href='~~admin.php?page=accua\_forms\_list&amp;fid=".$item['ID']."~~'>".htmlspecialchars($item['title'])."</a></strong>".$this->row\_actions($actions); |
  |  | 66 | . " &middot; <a href='{$nonced\_del}'>".\_\_("Trash", 'contact-forms')."</a>", |
  |  | 67 | ); |
  |  | 68 | return "<strong><a class='row-title' href='{$nonced\_edit}'>".htmlspecialchars($item['title'])."</a></strong>".$this->row\_actions($actions); |
  | 65 | 69 | } |
  | 66 | 70 | } |
  | […](/browser/contact-forms/trunk/accua-forms-list-page.php?rev=2887413#L201) | […](/browser/contact-forms/trunk/accua-forms-list-page.php?rev=2924628#L205) |  |
  | 201 | 205 |  |
  | 202 | 206 | if ($del) { |
  |  | 207 | check\_admin\_referer('deleted\_forms'); |
  | 203 | 208 | $start = $forms\_trash; |
  | 204 | 209 | } else { |
  | […](/browser/contact-forms/trunk/accua-forms-list-page.php?rev=2887413#L299) | […](/browser/contact-forms/trunk/accua-forms-list-page.php?rev=2924628#L304) |  |
  | 299 | 304 |  |
  | 300 | 305 | static $listTable = null; |
  | 301 |  |  |
  | 302 |  | if(isset($\_GET['fid\_del'])) |
  |  | 306 | //var\_dump($\_REQUEST); |
  |  | 307 |  |
  |  | 308 | if(isset($\_GET['fid\_del'])) |
  | 303 | 309 | { |
  | 304 |  | ~~$referer = $\_SERVER['HTTP\_REFERER'];~~ |
  | 305 |  | ~~$referer = str\_replace(['http://', 'https://'], '', $referer);~~ |
  | 306 |  | ~~$host = $\_SERVER['HTTP\_HOST'];~~ |
  | 307 |  |  |
  | 308 |  | ~~if ( $host !== substr($referer, 0, strlen($host))) {~~ |
  | 309 |  | ~~wp\_die("Accesso non consentito!");~~ |
  | 310 |  | ~~}~~ |
  | 311 | 310 | $fid = $\_GET['fid\_del']; |
  | 312 | 311 | $forms\_data = get\_option('accua\_forms\_saved\_forms', array()); |
  | […](/browser/contact-forms/trunk/accua-forms-list-page.php?rev=2887413#L336) | […](/browser/contact-forms/trunk/accua-forms-list-page.php?rev=2924628#L335) |  |
  | 336 | 335 | <ul class="subsubsub"> |
  | 337 | 336 | <li> |
  | 338 |  | <a <?php if (!isset($\_GET['del']) || ($\_GET['del']!=1)) { echo " class='current' "; } ?> href="admin.php?page=accua\_forms\_list"> |
  |  | 337 | <?php $nonced\_url = wp\_nonce\_url('admin.php?page=accua\_forms\_list', 'home\_forms') ?> |
  |  | 338 | <a <?php if (!isset($\_GET['del']) || ($\_GET['del']!=1)) { echo " class='current' "; } ?> href="<?= $nonced\_url ?? 'admin.php?page=accua\_forms\_list' ?>"> |
  | 339 | 339 | <?php \_e("Active", 'contact-forms'); ?></a> (<?php echo $listTable->get\_num\_of\_active\_items(); ?>) | |
  | 340 | 340 | </li> |
  | 341 | 341 | <li> |
  | 342 |  | <a  <?php if (isset($\_GET['del']) && ($\_GET['del']==1)) { echo " class='current' "; } ?> href="admin.php?page=accua\_forms\_list&del=1"> |
  |  | 342 | <?php $nonced\_url = wp\_nonce\_url('admin.php?page=accua\_forms\_list&del=1', 'deleted\_forms'); ?> |
  |  | 343 | <a  <?php if (isset($\_GET['del']) && ($\_GET['del']==1)) { echo " class='current' "; } ?> href="<?= $nonced\_url ?? 'admin.php?page=accua\_forms\_list&del=1' ?>"> |
  | 343 | 344 | <?php \_e("Trash", 'contact-forms'); ?></a> (<?php echo $listTable->get\_num\_of\_del\_items(); ?>) |
  | 344 | 345 | </li> |
* ## [contact-forms/trunk/accua-forms-single-submission.php](/changeset/2924628/contact-forms/trunk/accua-forms-single-submission.php "Show the changeset 2924628 restricted to contact-forms/trunk/accua-forms-single-submission.php")

  | [r2886518](/browser/contact-forms/trunk/accua-forms-single-submission.php?rev=2886518#L44 "Show revision 2886518 of this file in browser") | [r2924628](/browser/contact-forms/trunk/accua-forms-single-submission.php?rev=2924628#L44 "Show revision 2924628 of this file in browser") |  |
  | --- | --- | --- |
  | 44 | 44 | foreach ($query\_submission\_notes as $value) { |
  | 45 | 45 | echo '<div class="note system-note"> |
  | 46 |  | <div class="note\_content">' . ~~$value->afsn\_text~~ . '</div> |
  |  | 46 | <div class="note\_content">' . htmlspecialchars($value->afsn\_text, ENT\_QUOTES, null, false) . '</div> |
  | 47 | 47 | <p class="meta"> |
  | 48 | 48 | <span class="note-date">' . $value->afsn\_date . '</span> &middot; <span>'. $value->afsn\_user.'</span> |
  | […](/browser/contact-forms/trunk/accua-forms-single-submission.php?rev=2886518#L51) | […](/browser/contact-forms/trunk/accua-forms-single-submission.php?rev=2924628#L51) |  |
  | 51 | 51 | <input type="hidden" name="del\_note\_sid" value="'.$value->afsn\_sub\_id.'" /> |
  | 52 | 52 | <input type="hidden" name="del\_note\_date" value="'.$value->afsn\_date.'" />'; ?> |
  |  | 53 | <?php wp\_nonce\_field("submission\_{$value->afsn\_sub\_id}\_note\_del", "\_wpnonce\_note\_del"); ?> |
  | 53 | 54 | <input type="submit" id="delete-note" class="submitdelete deletion" value="<?php \_e('Delete note', 'contact-forms'); ?>" onclick="return window.confirm('Are you sure you want to trash this note?');"/> |
  | 54 | 55 | <?php echo '</form> |
  | […](/browser/contact-forms/trunk/accua-forms-single-submission.php?rev=2886518#L75) | […](/browser/contact-forms/trunk/accua-forms-single-submission.php?rev=2924628#L76) |  |
  | 75 | 76 | global $wpdb; |
  | 76 | 77 | if (isset($\_GET['sid'])) { |
  | 77 |  | $sid = ~~stripslashes((string)$\_GET['sid'])~~; |
  |  | 78 | $sid = (int) $\_GET['sid']; |
  | 78 | 79 | } |
  | 79 | 80 |  |
  | […](/browser/contact-forms/trunk/accua-forms-single-submission.php?rev=2886518#L82) | […](/browser/contact-forms/trunk/accua-forms-single-submission.php?rev=2924628#L83) |  |
  | 82 | 83 | } |
  | 83 | 84 | $post = stripslashes\_deep($\_POST); |
  | 84 |  | if(isset($post['note\_site\_user'])){ |
  |  | 85 | if(isset($post['note\_site\_user']) && isset($post['note\_id\_sub'])){ |
  | 85 | 86 | $note\_site\_user = $post['note\_site\_user']; |
  | 86 | 87 | $id\_sub = $post['note\_id\_sub']; |
  |  | 88 | check\_admin\_referer("submission\_{$id\_sub}\_note\_add", "\_wpnonce\_note\_add"); |
  | 87 | 89 | accua\_forms\_add\_submission\_note($id\_sub, $note\_site\_user); |
  | 88 | 90 | } |
  | 89 | 91 | if(isset($post['del\_note\_sid'])){ |
  |  | 92 | check\_admin\_referer("submission\_{$post['del\_note\_sid']}\_note\_del", "\_wpnonce\_note\_del"); |
  | 90 | 93 | accua\_forms\_delete\_submission\_note($post['del\_note\_sid'], $post['del\_note\_date']); |
  | 91 | 94 | } |
  | […](/browser/contact-forms/trunk/accua-forms-single-submission.php?rev=2886518#L95) | […](/browser/contact-forms/trunk/accua-forms-single-submission.php?rev=2924628#L98) |  |
  | 95 | 98 | if(isset($post['del\_sub\_form'])) { |
  | 96 | 99 | $id = (int)$post['del\_sub\_form']; |
  |  | 100 | check\_admin\_referer("del\_sub\_form\_{$id}", "\_wpnonce\_sub\_del"); |
  | 97 | 101 | accua\_forms\_single\_submission\_movetotrash($id); |
  | 98 | 102 | } ?> |
  | […](/browser/contact-forms/trunk/accua-forms-single-submission.php?rev=2886518#L118) | […](/browser/contact-forms/trunk/accua-forms-single-submission.php?rev=2924628#L122) |  |
  | 118 | 122 | <form style="margin-top: 20px;" id="delete-sub" method="post" action=""> |
  | 119 | 123 | <input type="hidden" name="del\_sub\_form" value="<?php echo $sid; ?>" /> |
  | 120 |  | <input type="submit" id="delete-sub-data" class="submitdelete deletion" value="<?php \_e('Move to trash', 'contact-forms') ?> (Solo per Spam/test)" onclick='return window.confirm("Are you sure you want to trash this submission?");'/> |
  |  | 124 | <?php wp\_nonce\_field("del\_sub\_form\_{$sid}", "\_wpnonce\_sub\_del"); ?> |
  |  | 125 | <input type="submit" id="delete-sub-data" class="submitdelete deletion" value="<?php \_e('Move to trash', 'contact-forms'); \_e('(for spam or tests submissions)', 'contact-forms'); ?>" onclick='return window.confirm("Are you sure you want to trash this submission?");'/> |
  | 121 | 126 | </form> |
  | 122 | 127 | </div> |
  | […](/browser/contact-forms/trunk/accua-forms-single-submission.php?rev=2886518#L225) | […](/browser/contact-forms/trunk/accua-forms-single-submission.php?rev=2924628#L230) |  |
  | 225 | 230 | <textarea id="note\_site\_user" name="note\_site\_user" rows="4" style="width: 100%; margin-bottom:5px" placeholder="<?php \_e('Insert your note here...', 'contact-forms'); ?>"></textarea> |
  | 226 | 231 | <input type="hidden" name="note\_id\_sub" value="<?php echo $sid; ?>" /> |
  |  | 232 | <?php wp\_nonce\_field("submission\_{$sid}\_note\_add", "\_wpnonce\_note\_add"); ?> |
  | 227 | 233 | <input type="submit" class="button button-secondary" value="<?php \_e( 'Save', 'contact-forms'); ?>" /></p> |
  | 228 | 234 | </form> |
* ## [contact-forms/trunk/accua-forms-submissions-page.php](/changeset/2924628/contact-forms/trunk/accua-forms-submissions-page.php "Show the changeset 2924628 restricted to contact-forms/trunk/accua-forms-submissions-page.php")

  | [r2879909](/browser/contact-forms/trunk/accua-forms-submissions-page.php?rev=2879909#L523 "Show revision 2879909 of this file in browser") | [r2924628](/browser/contact-forms/trunk/accua-forms-submissions-page.php?rev=2924628#L523 "Show revision 2924628 of this file in browser") |  |
  | --- | --- | --- |
  | 523 | 523 | <form style="margin-top: 20px;" id="submissions-action" method="get" action=""> |
  | 524 | 524 | <!-- For plugins, we also need to ensure that the form posts back to our current page --> |
  | 525 |  | <input type="hidden" name="page" value="<?php ~~echo htmlspecialchars(stripslashes($\_REQUEST['page']));~~ ?>" /> |
  | 526 |  | <input type="hidden" name="del" value="<?php ~~echo htmlspecialchars(stripslashes($\_REQUEST['del']));~~ ?>" /> |
  |  | 525 | <input type="hidden" name="page" value="<?php if (isset($\_REQUEST['page'])) { echo htmlspecialchars(stripslashes($\_REQUEST['page'])); } ?>" /> |
  |  | 526 | <input type="hidden" name="del" value="<?php if (isset($\_REQUEST['del'])) { echo htmlspecialchars(stripslashes($\_REQUEST['del'])); } ?>" /> |
  | 527 | 527 | <!-- SEARCH FORM --> |
  | 528 | 528 | <?php $listTable->search\_box(\_\_("Search", 'contact-forms'), 'search\_id'); ?> |
  | […](/browser/contact-forms/trunk/accua-forms-submissions-page.php?rev=2879909#L540) | […](/browser/contact-forms/trunk/accua-forms-submissions-page.php?rev=2924628#L540) |  |
  | 540 | 540 | $saved\_forms\_id\_string = implode(',',$saved\_forms\_id); |
  | 541 | 541 |  |
  | 542 |  | $id\_del\_other\_forms = $wpdb->get\_results("SELECT distinct afs\_form\_id |
  | 543 |  | FROM {$wpdb->prefix}accua\_forms\_submissions WHERE afs\_form\_id NOT IN ($saved\_forms\_id\_string) AND afs\_status >= 0", ARRAY\_A); |
  |  | 542 | if ($saved\_forms\_id\_string) { |
  |  | 543 | $id\_del\_other\_forms = $wpdb->get\_results("SELECT distinct afs\_form\_id |
  |  | 544 | FROM {$wpdb->prefix}accua\_forms\_submissions WHERE afs\_form\_id NOT IN ($saved\_forms\_id\_string) AND afs\_status >= 0", ARRAY\_A); |
  |  | 545 | } else { |
  |  | 546 | $id\_del\_other\_forms = array(); |
  |  | 547 | } |
  | 544 | 548 |  |
  | 545 | 549 |  |
  | […](/browser/contact-forms/trunk/accua-forms-submissions-page.php?rev=2879909#L672) | […](/browser/contact-forms/trunk/accua-forms-submissions-page.php?rev=2924628#L676) |  |
  | 672 | 676 | <form style="margin-top: 20px;" id="submissions-action" method="get" action=""> |
  | 673 | 677 | <!-- Now we can render the completed list table --> |
  | 674 |  | <input type="hidden" name="page" value="<?php ~~echo htmlspecialchars(stripslashes($\_REQUEST['page']));~~ ?>" /> |
  | 675 |  | <input type="hidden" name="del" value="<?php ~~echo htmlspecialchars(stripslashes($\_REQUEST['del']));~~ ?>" /> |
  |  | 678 | <input type="hidden" name="page" value="<?php  if (isset($\_REQUEST['page'])) { echo htmlspecialchars(stripslashes($\_REQUEST['page'])); } ?>" /> |
  |  | 679 | <input type="hidden" name="del" value="<?php  if (isset($\_REQUEST['del'])) { echo htmlspecialchars(stripslashes($\_REQUEST['del'])); } ?>" /> |
  | 676 | 680 | <?php $listTable->display(); ?> |
  | 677 | 681 | </form> |
* ## [contact-forms/trunk/accua-forms.php](/changeset/2924628/contact-forms/trunk/accua-forms.php "Show the changeset 2924628 restricted to contact-forms/trunk/accua-forms.php")

  | [r2887413](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L152 "Show revision 2887413 of this file in browser") | [r2924628](/browser/contact-forms/trunk/accua-forms.php?rev=2924628#L152 "Show revision 2924628 of this file in browser") |  |
  | --- | --- | --- |
  | 152 | 152 | function accua\_forms\_edit\_page\_head\_styles() { |
  | 153 | 153 | //wp\_admin\_css( 'widgets' ); |
  |  | 154 | wp\_enqueue\_style( 'wp-pointer' ); //for tooltips |
  | 154 | 155 | wp\_enqueue\_style( 'accua-forms-admin', plugins\_url('accua-forms-admin.css', \_\_FILE\_\_), array('wp-color-picker'), ACCUA\_FORMS\_CSS\_VERSION); // |
  | 155 | 156 | } |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L160) | […](/browser/contact-forms/trunk/accua-forms.php?rev=2924628#L161) |  |
  | 160 | 161 | wp\_enqueue\_script('jquery-ui-draggable'); |
  | 161 | 162 | wp\_enqueue\_script('jquery-ui-droppable');\*/ |
  | 162 |  | wp\_enqueue\_script('accua', plugins\_url('/js/jqColorPicker.min.js', \_\_FILE\_\_ ), array( 'jquery' ), ACCUA\_FORMS\_JS\_VERSION); |
  |  | 163 | wp\_enqueue\_script( 'wp-pointer' ); //for tooltips |
  |  | 164 | wp\_enqueue\_script('accua-jqColorPicker', plugins\_url('/js/jqColorPicker.min.js', \_\_FILE\_\_ ), array( 'jquery' ), ACCUA\_FORMS\_JS\_VERSION); |
  | 163 | 165 |  |
  | 164 | 166 | wp\_enqueue\_script( 'accua-form-fields', plugins\_url( 'form-fields.js' , \_\_FILE\_\_ ), array( 'jquery-ui-sortable', 'jquery-ui-draggable', 'jquery-ui-droppable' ), ACCUA\_FORMS\_JS\_VERSION); |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L167) | […](/browser/contact-forms/trunk/accua-forms.php?rev=2924628#L169) |  |
  | 167 | 169 |  |
  | 168 | 170 | function accua\_forms\_settings\_page\_head\_scripts() { |
  |  | 171 | wp\_enqueue\_script('accua-jqColorPicker', plugins\_url('/js/jqColorPicker.min.js', \_\_FILE\_\_ ), array( 'jquery' ), ACCUA\_FORMS\_JS\_VERSION); |
  | 169 | 172 | //wp\_enqueue\_script('wp-color-picker'); |
  | 170 | 173 | } |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L172) | […](/browser/contact-forms/trunk/accua-forms.php?rev=2924628#L175) |  |
  | 172 | 175 | function accua\_forms\_edit\_page\_head() { |
  | 173 | 176 | if (isset($\_POST['accua-form-edit-action']) || (!isset($\_GET['fid']))) { |
  | 174 |  | \_accua\_forms\_form\_edit\_action(); |
  |  | 177 | \_accua\_forms\_form\_edit\_action(); |
  | 175 | 178 | require\_once('accua-forms-list-page.php'); |
  | 176 | 179 | accua\_forms\_list\_page\_table(true); |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L195) | […](/browser/contact-forms/trunk/accua-forms.php?rev=2924628#L198) |  |
  | 195 | 198 | add\_action( 'wp\_ajax\_accua-form-fields-order' , 'accua\_forms\_form\_fields\_order'); |
  | 196 | 199 | function accua\_forms\_form\_fields\_order() { |
  |  | 200 | check\_ajax\_referer('edit\_form', '\_nonce\_edit\_form'); |
  |  | 201 |  |
  | 197 | 202 | $post = stripslashes\_deep($\_POST); |
  | 198 | 203 | //update\_option('accua\_forms\_form\_fields\_order\_post', $post); |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L238) | […](/browser/contact-forms/trunk/accua-forms.php?rev=2924628#L243) |  |
  | 238 | 243 | /\* azione dove vengono salvati i campi dei un form \*/ |
  | 239 | 244 | function accua\_forms\_save\_form\_field() { |
  |  | 245 | check\_ajax\_referer('edit\_form', '\_nonce\_edit\_form'); |
  |  | 246 |  |
  | 240 | 247 | $post = stripslashes\_deep($\_POST); |
  | 241 | 248 |  |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L296) | […](/browser/contact-forms/trunk/accua-forms.php?rev=2924628#L303) |  |
  | 296 | 303 | add\_action( 'wp\_ajax\_accua-save-form-settings', 'accua\_forms\_save\_form\_settings'); |
  | 297 | 304 | function accua\_forms\_save\_form\_settings() { |
  |  | 305 | check\_ajax\_referer('edit\_form', '\_nonce\_edit\_form'); |
  |  | 306 |  |
  | 298 | 307 | $post = stripslashes\_deep($\_POST); |
  | 299 | 308 |  |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L503) | […](/browser/contact-forms/trunk/accua-forms.php?rev=2924628#L512) |  |
  | 503 | 512 | <input type="text" value="{$istance\_data['default\_value']}" name="form-field-{$istance\_data['istance\_id']}-default-value" id="widget-{$istance\_data['istance\_id']}-default-value" class="widefat"></p> |
  | 504 | 513 | EOT; |
  | 505 |  | ~~$default\_date\_value = <<<EOT~~ |
  | 506 |  | ~~<p><label for="widget-{$istance\_data['istance\_id']}-default-value">{$testi\_eot['default\_value']}:</label>~~ |
  | 507 |  | ~~{$override\_begin}<input type="{$override\_type}" name="form-field-{$istance\_data['istance\_id']}-override-default-value" value="1" {$override\_default\_value} />{$override\_end}<br>~~ |
  | 508 |  | ~~<input type="date" value="{$istance\_data['default\_date\_value']}" name="form-field-{$istance\_data['istance\_id']}-default-value" id="widget-{$istance\_data['istance\_id']}-default-value" class="widefat"></p>~~ |
  | 509 |  | ~~EOT;~~ |
  | 510 | 514 |  |
  | 511 | 515 | $default\_values = <<<EOT |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L535) | […](/browser/contact-forms/trunk/accua-forms.php?rev=2924628#L539) |  |
  | 535 | 539 | <input type="checkbox" value="1" {$required\_checked} name="form-field-{$istance\_data['istance\_id']}-required" id="widget-{$istance\_data['istance\_id']}-required"></p> |
  | 536 | 540 | EOT; |
  | 537 |  | $min\_date = <<<EOT |
  | 538 |  | <p><label for="widget-{$istance\_data['istance\_id']}-min-of-date">{$testi\_eot['min-of-date']}:</label> |
  | 539 |  | {$override\_begin}<input type="{$override\_type}" name="form-field-{$istance\_data['istance\_id']}-override-datemin-values" value="1" {$override\_mindate\_values} />{$override\_end}<br> |
  | 540 |  | <input type="date" value="{$istance\_data['min\_date']}" name="form-field-{$istance\_data['istance\_id']}-min-of-date" id="widget-{$istance\_data['istance\_id']}-min-of-date"></p> |
  |  | 541 |  |
  |  | 542 | if ($field\_data['type'] == 'date'){ |
  |  | 543 | $default\_date\_value = <<<EOT |
  |  | 544 | <p><label for="widget-{$istance\_data['istance\_id']}-default-value">{$testi\_eot['default\_value']}:</label> |
  |  | 545 | {$override\_begin}<input type="{$override\_type}" name="form-field-{$istance\_data['istance\_id']}-override-default-value" value="1" {$override\_default\_value} />{$override\_end}<br> |
  |  | 546 | <input type="date" value="{$istance\_data['default\_date\_value']}" name="form-field-{$istance\_data['istance\_id']}-default-value" id="widget-{$istance\_data['istance\_id']}-default-value" class="widefat"></p> |
  | 541 | 547 | EOT; |
  | 542 |  | ~~$max~~\_date = <<<EOT |
  | 543 |  | ~~<p><label for="widget-{$istance\_data['istance\_id']}-max-of-date">{$testi\_eot['max~~-of-date']}:</label> |
  | 544 |  | ~~{$override\_begin}<input type="{$override\_type}" name="form-field-{$istance\_data['istance\_id']}-override-datemax-values" value="1" {$override\_max~~date\_values} />{$override\_end}<br> |
  | 545 |  | ~~<input type="date" value="{$istance\_data['max\_date']}" name="form-field-{$istance\_data['istance\_id']}-max-of-date" id="widget-{$istance\_data['istance\_id']}-max~~-of-date"></p> |
  |  | 548 | $min\_date = <<<EOT |
  |  | 549 | <p><label for="widget-{$istance\_data['istance\_id']}-min-of-date">{$testi\_eot['min-of-date']}:</label> |
  |  | 550 | {$override\_begin}<input type="{$override\_type}" name="form-field-{$istance\_data['istance\_id']}-override-datemin-values" value="1" {$override\_mindate\_values} />{$override\_end}<br> |
  |  | 551 | <input type="date" value="{$istance\_data['min\_date']}" name="form-field-{$istance\_data['istance\_id']}-min-of-date" id="widget-{$istance\_data['istance\_id']}-min-of-date"></p> |
  | 546 | 552 | EOT; |
  |  | 553 | $max\_date = <<<EOT |
  |  | 554 | <p><label for="widget-{$istance\_data['istance\_id']}-max-of-date">{$testi\_eot['max-of-date']}:</label> |
  |  | 555 | {$override\_begin}<input type="{$override\_type}" name="form-field-{$istance\_data['istance\_id']}-override-datemax-values" value="1" {$override\_maxdate\_values} />{$override\_end}<br> |
  |  | 556 | <input type="date" value="{$istance\_data['max\_date']}" name="form-field-{$istance\_data['istance\_id']}-max-of-date" id="widget-{$istance\_data['istance\_id']}-max-of-date"></p> |
  |  | 557 | EOT; |
  |  | 558 | } |
  | 547 | 559 |  |
  | 548 | 560 | switch ($field\_data['type']) { |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L648) | […](/browser/contact-forms/trunk/accua-forms.php?rev=2924628#L660) |  |
  | 648 | 660 |  |
  | 649 | 661 | function accua\_forms\_add\_page($message='') { |
  | 650 |  | ~~$referer = $\_SERVER['HTTP\_REFERER'];~~ |
  | 651 |  | ~~$referer = str\_replace(['http://', 'https://'], '', $referer);~~ |
  | 652 |  | ~~$host = $\_SERVER['HTTP\_HOST'];~~ |
  | 653 |  |  |
  | 654 |  | ~~if ( $host !== substr($referer, 0, strlen($host))) {~~ |
  | 655 |  | ~~wp\_die("Accesso non consentito!");~~ |
  | 656 |  | ~~}~~ |
  | 657 |  |  |
  | 658 | 662 | $forms\_data = get\_option('accua\_forms\_saved\_forms', array()); |
  | 659 | 663 | $trash\_data = get\_option('accua\_forms\_trash\_forms', array()); |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L676) | […](/browser/contact-forms/trunk/accua-forms.php?rev=2924628#L680) |  |
  | 676 | 680 | } |
  | 677 | 681 | if (!empty($\_GET['clonefrom'])) { |
  |  | 682 | check\_admin\_referer('clone\_posts'); |
  | 678 | 683 | $clonefrom = stripslashes($\_GET['clonefrom']); |
  | 679 | 684 | } else { |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L688) | […](/browser/contact-forms/trunk/accua-forms.php?rev=2924628#L693) |  |
  | 688 | 693 | } ?> |
  | 689 | 694 | <form action="admin.php" method="GET"> |
  |  | 695 | <?php wp\_nonce\_field('edit\_posts', '\_wpnonce', false, true) ?> |
  | 690 | 696 | <input type="hidden" name="page" value="accua\_forms\_list" /> |
  | 691 | 697 | <p>Form id: <input type="text" name="fid" value="<?php echo $fid; ?>" /></p> |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L745) | […](/browser/contact-forms/trunk/accua-forms.php?rev=2924628#L751) |  |
  | 745 | 751 | case 'delete': |
  | 746 | 752 | $fid = $post['form-id']; |
  |  | 753 | check\_admin\_referer('contact-forms-delete\_'.$fid); |
  | 747 | 754 | $forms\_data = get\_option('accua\_forms\_saved\_forms', array()); |
  | 748 | 755 | unset($forms\_data[$fid]); |
  | 749 | 756 | update\_option('accua\_forms\_saved\_forms', $forms\_data); |
  | 750 | 757 | $fid = htmlspecialchars($fid); |
  | 751 |  | $message .= sprintf( \_\_( 'Form ~~\"%s\~~" deleted','contact-forms' ), $fid ); |
  |  | 758 | $message .= sprintf( \_\_( 'Form "%s" deleted','contact-forms' ), $fid ); |
  | 752 | 759 | break; |
  | 753 | 760 | } |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L762) | […](/browser/contact-forms/trunk/accua-forms.php?rev=2924628#L769) |  |
  | 762 | 769 | $message = \_accua\_forms\_form\_edit\_action(); |
  | 763 | 770 | } else if (isset($\_GET['fid'])) { |
  |  | 771 |  |
  |  | 772 | check\_admin\_referer('edit\_posts'); |
  |  | 773 |  |
  | 764 | 774 | if (!isset($fid)) { |
  | 765 | 775 | $fid = stripslashes($\_GET['fid']); |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L808) | […](/browser/contact-forms/trunk/accua-forms.php?rev=2924628#L818) |  |
  | 808 | 818 | wp\_enqueue\_script('jquery-ui-tabs','','','',true); |
  | 809 | 819 | wp\_enqueue\_script('contact\_forms\_tabs', plugins\_url('accua\_tabs.js', \_\_FILE\_\_ ), array( 'jquery' ), ACCUA\_FORMS\_JS\_VERSION); |
  |  | 820 |  |
  |  | 821 | if (!class\_exists('AccuaFormsHelp')) { |
  |  | 822 | require\_once('accua-forms-help.php'); |
  |  | 823 | } |
  |  | 824 | $accuaHelp = AccuaFormsHelp::getInstance(); |
  | 810 | 825 | /\* |
  | 811 | 826 | $avail\_fields = array( |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L859) | […](/browser/contact-forms/trunk/accua-forms.php?rev=2924628#L874) |  |
  | 859 | 874 | <h2><?php \_e( 'Edit Form', 'contact-forms'); ?></h2> |
  | 860 | 875 | <div class="accua\_form\_save\_settings\_status"></div> |
  |  | 876 | <?php wp\_nonce\_field('edit\_form', '\_nonce\_edit\_form'); ?> |
  | 861 | 877 | <div id="titlediv"><br /> |
  | 862 | 878 | <label id="title-prompt-text" class="screen-reader-text" for="title"><?php  \_e( 'Enter title here', 'contact-forms'); ?></label> |
  | 863 | 879 | <input id="title" type="text" autocomplete="off" value="<?php echo htmlspecialchars($form\_data['title'], ENT\_QUOTES) ?>" size="30" name="post\_title"> |
  | 864 |  |  |
  | 865 | 880 | <script type="text/javascript"> |
  | 866 | 881 | jQuery(function($){ |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L884) | […](/browser/contact-forms/trunk/accua-forms.php?rev=2924628#L899) |  |
  | 884 | 899 | <input type="hidden" name="form-id" value="<?php echo $fid\_esc; ?>" /> |
  | 885 | 900 | <input type="submit" value="<?php \_e( 'Delete this form', 'contact-forms'); ?>" /> |
  |  | 901 | <?php wp\_nonce\_field( 'contact-forms-delete\_'.$fid ); ?> |
  | 886 | 902 | </form> |
  | 887 | 903 | <?php /\*<input class="button button-primary button-large accua\_form\_save\_settings\_button" id="accua\_form\_save\_settings" type="button" value="<?php echo htmlspecialchars(\_\_( 'Save settings', 'contact-forms'), ENT\_QUOTES); ?>" /> \*/ ?> |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L898) | […](/browser/contact-forms/trunk/accua-forms.php?rev=2924628#L914) |  |
  | 898 | 914 | <div id="accua\_tabs2"> |
  | 899 | 915 | <ul> |
  | 900 |  | <li class="tabs"><a href="#accua\_tab\_fields2">~~Campi~~</a></li> |
  | 901 |  | <li class="tabs"><a href="#accua\_tab\_customise">~~Grafica~~</a></li> |
  |  | 916 | <li class="tabs"><a href="#accua\_tab\_fields2"><?php \_e( 'Fields', 'contact-forms'); ?></a></li> |
  |  | 917 | <li class="tabs"><a href="#accua\_tab\_customise"><?php \_e( 'Appearance', 'contact-forms'); ?></a></li> |
  | 902 | 918 | </ul> |
  | 903 | 919 | <div id="accua\_tab\_fields2"> |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L1008) | […](/browser/contact-forms/trunk/accua-forms.php?rev=2924628#L1024) |  |
  | 1008 | 1024 | <div id="accua\_tab\_customise"> |
  | 1009 | 1025 | <div style="width: 48%; float:left;"> |
  | 1010 |  | <?php |
  | 1011 |  | if (!class\_exists('AccuaFormsHelp')) { |
  | 1012 |  | require\_once('accua-forms-help.php'); |
  | 1013 |  | } |
  | 1014 |  | $accuaHelp = AccuaFormsHelp::getInstance(); ?> |
  | 1015 |  |  |
  | 1016 |  | <h3>Generali<?php // \_e( 'Forms', 'contact-forms'); ?></h3> |
  | 1017 |  | <?php echo $accuaHelp->add\_pointer('help\_1'); |
  | 1018 |  | $accuaHelp->finished();  ?> |
  | 1019 |  | <p id="accua\_form\_use\_ajax"><input class="accua\_form\_value" type="checkbox" value="1" <?php if (!empty($form\_data['use\_ajax'])) {echo 'checked="checked" ';} ?>/>Non ricaricare la pagina alla compilazione del form</p> |
  | 1020 |  |  |
  | 1021 |  | <p id="accua\_form\_layout">Etichette<?php //\_e('Layout', 'contact-forms'); ?> <select name="layout" class="accua\_form\_value"> |
  |  | 1026 | <h3><?php \_e( 'General', 'contact-forms'); ?></h3> |
  |  | 1027 | <p id="accua\_form\_use\_ajax"><input class="accua\_form\_value" type="checkbox" value="1" <?php if (!empty($form\_data['use\_ajax'])) {echo 'checked="checked" ';} ?>/><?php \_e('Do not reload the page on form submission', 'contact-forms'); ?></p> |
  |  | 1028 |  |
  |  | 1029 | <p id="accua\_form\_layout"><?php \_e( 'Labels', 'contact-forms'); ?> <select name="layout" class="accua\_form\_value"> |
  | 1022 | 1030 | <option value="" <?php if (isset($form\_overrided\_data['layout'])) { echo 'selected="selected"'; } ?>>default (<?php if($default\_form\_data['layout']=='sidebyside') \_e( 'Labels on the left of the fields', 'contact-forms'); else \_e( 'Labels on top of the fields', 'contact-forms'); ?>)</option><option value="sidebyside" <?php if ((isset($form\_overrided\_data['layout'])) && ($form\_data['layout'] == 'sidebyside')) { echo 'selected="selected"'; } ?>><?php \_e( 'Labels on the left of the fields', 'contact-forms'); ?></option><option value="toplabel" <?php if ((isset($form\_overrided\_data['layout'])) && ($form\_data['layout'] == 'toplabel')) { echo 'selected="selected"'; } ?>><?php \_e( 'Labels on top of the fields', 'contact-forms'); ?></option></select> |
  | 1023 | 1031 | </p> |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L1178) | […](/browser/contact-forms/trunk/accua-forms.php?rev=2924628#L1186) |  |
  | 1178 | 1186 | <div style="width:50%; float:right;"> |
  | 1179 | 1187 | <div style="padding: 15px;"> |
  | 1180 |  | <h2>Anteprima con intestazione del sito</h2> |
  |  | 1188 | <h2><?php \_e('Preview', 'contact-forms'); ?> |
  |  | 1189 | <?php echo $accuaHelp->add\_pointer('form\_edit\_preview'); ?> |
  |  | 1190 | </h2> |
  | 1181 | 1191 | <div id="accua\_form\_preview\_area\_wrapper"> |
  | 1182 | 1192 | <?php |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L1443) | […](/browser/contact-forms/trunk/accua-forms.php?rev=2924628#L1453) |  |
  | 1443 | 1453 |  |
  | 1444 | 1454 | <?php |
  |  | 1455 | $accuaHelp->finished(); |
  | 1445 | 1456 | } |
  | 1446 | 1457 |  |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L1529) | […](/browser/contact-forms/trunk/accua-forms.php?rev=2924628#L1540) |  |
  | 1529 | 1540 | <?php |
  | 1530 | 1541 | \*/ |
  | 1531 |  |  |
  | 1532 |  | ~~$\_GET['edit-fid'] = sanitize\_text\_field($\_GET['edit-fid']);~~ |
  | 1533 |  |  |
  | 1534 | 1542 | $message = ''; |
  | 1535 | 1543 | $taxonomy = ''; |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L1567) | […](/browser/contact-forms/trunk/accua-forms.php?rev=2924628#L1575) |  |
  | 1567 | 1575 | 'description' => '', |
  | 1568 | 1576 | 'default\_value' => '', |
  |  | 1577 | 'default\_date\_value' => '', |
  | 1569 | 1578 | 'allowed\_values' => '', |
  |  | 1579 | 'min\_date' => '', |
  |  | 1580 | 'max\_date' => '', |
  | 1570 | 1581 | ); |
  | 1571 | 1582 |  |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L1574) | […](/browser/contact-forms/trunk/accua-forms.php?rev=2924628#L1585) |  |
  | 1574 | 1585 |  |
  | 1575 | 1586 | if (!empty($\_POST['action'])) { |
  |  | 1587 | check\_admin\_referer('edit\_form\_field', '\_wpnonce\_edit\_form\_field'); |
  | 1576 | 1588 | $post = stripslashes\_deep($\_POST); |
  | 1577 | 1589 | switch($post['action']) { |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L1658) | […](/browser/contact-forms/trunk/accua-forms.php?rev=2924628#L1670) |  |
  | 1658 | 1670 | $fid = stripslashes($\_GET['edit-fid']); |
  | 1659 | 1671 | if (empty($avail\_fields[$fid])) { |
  | 1660 |  | $message .= sprintf( \_\_( 'Field "%s" doesn\'t exists', 'contact-forms'), ~~$fid~~ ); |
  |  | 1672 | $message .= sprintf( \_\_( 'Field "%s" doesn\'t exists', 'contact-forms'), htmlspecialchars($fid) ); |
  | 1661 | 1673 | } else { |
  | 1662 | 1674 | $adding = false; |
  | 1663 | 1675 | $editing = true; |
  | 1664 |  | $default\_form\_values = $avail\_fields[$fid]; |
  |  | 1676 | $default\_form\_values = $avail\_fields[$fid] + $default\_form\_values; |
  | 1665 | 1677 | } |
  | 1666 | 1678 | } |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L1837) | […](/browser/contact-forms/trunk/accua-forms.php?rev=2924628#L1849) |  |
  | 1837 | 1849 | <input type="hidden" name="post\_type" value="<?php echo esc\_attr($post\_type); ?>" /> |
  | 1838 | 1850 | \*/ ?> |
  | 1839 |  | <?php wp\_nonce\_field('~~add-tag', '\_wpnonce\_add-form-~~field'); ?> |
  |  | 1851 | <?php wp\_nonce\_field('edit\_form\_field', '\_wpnonce\_edit\_form\_field'); ?> |
  | 1840 | 1852 |  |
  | 1841 | 1853 | <div class="form-field form-required"> |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L1900) | […](/browser/contact-forms/trunk/accua-forms.php?rev=2924628#L1912) |  |
  | 1900 | 1912 |  |
  | 1901 | 1913 | <div class="form-field"> |
  | 1902 |  | Campi x date |
  |  | 1914 | <?php \_e( 'Settings for date fields', 'contact-forms'); ?> |
  | 1903 | 1915 | <div class="form-field"> |
  | 1904 |  | <label for="form-field-default-date-value"><?php \_e( 'Default value~~(s)~~', 'contact-forms'); ?>:</label> |
  |  | 1916 | <label for="form-field-default-date-value"><?php \_e( 'Default value', 'contact-forms'); ?>:</label> |
  | 1905 | 1917 | <input type="date" name="form-field-default-date-value" id="form-field-default-date-value" value="<?php echo htmlspecialchars($default\_form\_values['default\_date\_value'], ENT\_QUOTES) ?>"> |
  | 1906 | 1918 | </div> |
  | 1907 | 1919 |  |
  | 1908 | 1920 |  |
  | 1909 |  | <label for="form-field-~~allowed-values~~"><?php \_e( 'Min date', 'contact-forms'); ?>:</label> |
  |  | 1921 | <label for="form-field-min-of-date"><?php \_e( 'Min date', 'contact-forms'); ?>:</label> |
  | 1910 | 1922 | <input type="date" id="form-field-min-of-date" name="form-field-min-of-date" value="<?php echo htmlspecialchars($default\_form\_values['min\_date'], ENT\_QUOTES) ?>"> |
  | 1911 | 1923 |  |
  | 1912 |  | <label for="form-field-~~allowed-values~~"><?php \_e( 'Max date', 'contact-forms'); ?>:</label> |
  |  | 1924 | <label for="form-field-max-of-date"><?php \_e( 'Max date', 'contact-forms'); ?>:</label> |
  | 1913 | 1925 | <input type="date" id="form-field-max-of-date" name="form-field-max-of-date" value="<?php echo htmlspecialchars($default\_form\_values['max\_date'], ENT\_QUOTES) ?>"> |
  | 1914 | 1926 |  |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L2014) | […](/browser/contact-forms/trunk/accua-forms.php?rev=2924628#L2026) |  |
  | 2014 | 2026 |  |
  | 2015 | 2027 | if($\_SERVER['REQUEST\_METHOD'] == 'POST' && !empty($\_POST['accua\_form\_save\_form\_settings'])) { |
  |  | 2028 | check\_admin\_referer('accua\_form\_save\_settings', '\_nonce\_accua\_form\_save\_settings'); |
  | 2016 | 2029 | $post = stripslashes\_deep($\_POST); |
  | 2017 | 2030 | $post += $empty\_form\_data; |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L2050) | […](/browser/contact-forms/trunk/accua-forms.php?rev=2924628#L2063) |  |
  | 2050 | 2063 | } |
  | 2051 | 2064 | ?> |
  | 2052 |  | ~~Todo: quanto tempo mantenere il dato (GDPR)?~~ |
  | 2053 |  |  |
  | 2054 | 2065 | <form method="post"> |
  |  | 2066 | <?php wp\_nonce\_field('accua\_form\_save\_settings', '\_nonce\_accua\_form\_save\_settings'); ?> |
  | 2055 | 2067 | <input type="hidden" name="accua\_form\_save\_form\_settings" value="1" /> |
  | 2056 | 2068 | <?php /\* |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L2300) | […](/browser/contact-forms/trunk/accua-forms.php?rev=2924628#L2312) |  |
  | 2300 | 2312 | </div> |
  | 2301 | 2313 | <br clear="all" /> |
  | 2302 |  |  |
  | 2303 |  | ~~<div>~~ |
  | 2304 |  | ~~<?php~~ |
  | 2305 |  | ~~/\* tutti i file della cartella css del tema \*/~~ |
  | 2306 |  | ~~$template\_dir = get\_template\_directory().'/css';~~ |
  | 2307 |  | ~~if(is\_dir($template\_dir) && false) :~~ |
  | 2308 |  | ~~?>~~ |
  | 2309 |  | ~~<h3>Include css from theme</h3>~~ |
  | 2310 |  | ~~<?php~~ |
  | 2311 |  | ~~//echo $template\_dir;~~ |
  | 2312 |  | ~~$files1 = scandir($template\_dir);~~ |
  | 2313 |  | ~~echo "<pre>";~~ |
  | 2314 |  | ~~print\_r($files1);~~ |
  | 2315 |  | ~~echo "</pre>"; ?>~~ |
  | 2316 |  | ~~<?php endif; ?>~~ |
  | 2317 |  | ~~</div>~~ |
  | 2318 |  |  |
  | 2319 | 2314 | </div> |
  | 2320 | 2315 | </div> |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L2780) | […](/browser/contact-forms/trunk/accua-forms.php?rev=2924628#L2775) |  |
  | 2780 | 2775 | break; |
  | 2781 | 2776 | case 'date': |
  | 2782 |  | $element = new AccuaForm\_Element\_Date($istance\_data['label'], $istance\_data['istance\_id'], $field\_properties+array('value'=>$istance\_data['default\_value'], 'min~~'=>$istance\_data['min\_date'], 'max~~'=>$istance\_data['max\_date'])); |
  |  | 2777 | $element = new AccuaForm\_Element\_Date($istance\_data['label'], $istance\_data['istance\_id'], $field\_properties+array('value'=>$istance\_data['default\_value'], 'minDate'=>$istance\_data['min\_date'], 'maxDate'=>$istance\_data['max\_date'])); |
  | 2783 | 2778 | break; |
  | 2784 | 2779 | //case 'textfield': |
  | […](/browser/contact-forms/trunk/accua-forms.php?rev=2887413#L3520) | […](/browser/contact-forms/trunk/accua-forms.php?rev=2924628#L3515) |  |
  | 3520 | 3515 | } |
  | 3521 | 3516 |  |
  | 3522 |  | echo '<html><head>'; |
  | 3523 |  | //wp\_enqueue\_style( 'style', get\_template\_directory\_uri().'/css/style.css' ); |
  |  | 3517 | echo '<html><head> |
  |  | 3518 | <style> |
  |  | 3519 | body {font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif;} |
  |  | 3520 | </style>'; |
  | 3524 | 3521 | wp\_print\_styles(); |
  | 3525 | 3522 | wp\_print\_head\_scripts(); |
  | 3526 |  |  |
  | 3527 |  |  |
  |  | 3523 | echo '</head><body>'; |
  | 3528 | 3524 | echo accua\_forms\_shortcode\_handler(array('fid'=>$\_REQUEST['fid'])); |
  | 3529 | 3525 | wp\_print\_footer\_scripts(); |
* ## [contact-forms/trunk/classes/Element/Captcha2.php](/changeset/2924628/contact-forms/trunk/classes/Element/Captcha2.php "Show the changeset 2924628 restricted to contact-forms/trunk/classes/Element/Captcha2.php")

  | [r2879909](/browser/contact-forms/trunk/classes/Element/Captcha2.php?rev=2879909#L4 "Show revision 2879909 of this file in browser") | [r2924628](/browser/contact-forms/trunk/classes/Element/Captcha2.php?rev=2924628#L4 "Show revision 2924628 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | protected $publicKey = ""; |
  | 5 | 5 |  |
  | 6 |  | public function \_\_construct($label = "", $unused, array $properties = null) { |
  |  | 6 | public function \_\_construct($label = "", $unused = null, array $properties = null) { |
  | 7 | 7 | if ($properties === null && is\_array($unused)) { |
  | 8 | 8 | $properties = $unused; |
  | […](/browser/contact-forms/trunk/classes/Element/Captcha2.php?rev=2879909#L24) | […](/browser/contact-forms/trunk/classes/Element/Captcha2.php?rev=2924628#L24) |  |
  | 24 | 24 | <script type="text/javascript"> |
  | 25 | 25 | <!-- |
  | 26 |  | let clicked = false; |
  | 27 |  | let reqclick = document.querySelector(".accuaforms-field-required"); |
  | 28 |  |  |
  | 29 |  | reqclick.addEventListener('keypress', function() { |
  | 30 |  | if(!clicked){ |
  | 31 |  | if (typeof(accuaform\_recaptcha2\_ajax\_loaded) == "undefined" || !accuaform\_recaptcha2\_ajax\_loaded) { |
  | 32 |  | var accuaform\_recaptcha2\_ajax\_loaded = true; |
  | 33 |  | var accuaform\_recaptcha2\_ajax\_loading = true ; |
  | 34 |  | var accuaform\_recaptcha2\_ajax\_controller = jQuery({}); |
  | 35 |  | var accuaform\_recaptcha2\_ajax\_initialized = {}; |
  | 36 |  | jQuery.getScript( $js\_path , function(){ |
  | 37 |  | jQuery.getScript( "https://www.recaptcha.net/recaptcha/api.js?onload=accua\_forms\_onload\_recaptcha2&render=explicit&hl=" + $js\_lang ); |
  | 38 |  | accuaform\_recaptcha2\_ajax\_loading = false; |
  | 39 |  | accuaform\_recaptcha2\_ajax\_controller.trigger('loaded'); |
  | 40 |  | }); |
  | 41 |  | if (!accuaform\_recaptcha2\_ajax\_initialized[ $js\_field\_id ]) { |
  | 42 |  | accuaform\_recaptcha2\_ajax\_initialized[ $js\_field\_id ] = true; |
  | 43 |  | jQuery(function(){ |
  | 44 |  | //punto da modificare |
  | 45 |  | if (accuaform\_recaptcha2\_ajax\_loading) { |
  | 46 |  | accuaform\_recaptcha2\_ajax\_controller.one('loaded', function(){ |
  | 47 |  | accua\_forms\_show\_recaptcha2( $js\_field\_id , { sitekey: $js\_publicKey }); |
  | 48 |  | }) |
  | 49 |  | } else { |
  | 50 |  | accua\_forms\_show\_recaptcha2( $js\_field\_id , { sitekey: $js\_publicKey }); |
  | 51 |  | } |
  | 52 |  | }); |
  | 53 |  | } |
  | 54 |  | } |
  |  | 26 | if (typeof(accuaform\_recaptcha2\_ajax\_loaded) == "undefined" || !accuaform\_recaptcha2\_ajax\_loaded) { |
  |  | 27 | var accuaform\_recaptcha2\_ajax\_loaded = true; |
  |  | 28 | var accuaform\_recaptcha2\_ajax\_delaying = true; |
  |  | 29 | var accuaform\_recaptcha2\_ajax\_loading = true ; |
  |  | 30 | var accuaform\_recaptcha2\_ajax\_controller = jQuery({}); |
  |  | 31 | var accuaform\_recaptcha2\_ajax\_initialized = {}; |
  |  | 32 | jQuery(".accuaforms-field-required, .pfbc-fieldwrap > \*").one('change', function() { |
  |  | 33 | if(accuaform\_recaptcha2\_ajax\_delaying){ |
  |  | 34 | accuaform\_recaptcha2\_ajax\_delaying = false; |
  |  | 35 | jQuery.getScript( $js\_path , function(){ |
  |  | 36 | jQuery.getScript( "https://www.recaptcha.net/recaptcha/api.js?onload=accua\_forms\_onload\_recaptcha2&render=explicit&hl=" + $js\_lang ); |
  |  | 37 | accuaform\_recaptcha2\_ajax\_loading = false; |
  |  | 38 | accuaform\_recaptcha2\_ajax\_controller.trigger('loaded'); |
  |  | 39 | }); |
  | 55 | 40 | } |
  | 56 |  | clicked = true; |
  | 57 |  | }); |
  | 58 |  |  |
  | 59 |  |  |
  | 60 |  |  |
  |  | 41 | }); |
  |  | 42 | } |
  |  | 43 | if (!accuaform\_recaptcha2\_ajax\_initialized[ $js\_field\_id ]) { |
  |  | 44 | accuaform\_recaptcha2\_ajax\_initialized[ $js\_field\_id ] = true; |
  |  | 45 | jQuery(function(){ |
  |  | 46 | if (accuaform\_recaptcha2\_ajax\_loading) { |
  |  | 47 | accuaform\_recaptcha2\_ajax\_controller.one('loaded', function(){ |
  |  | 48 | accua\_forms\_show\_recaptcha2( $js\_field\_id , { sitekey: $js\_publicKey }); |
  |  | 49 | }) |
  |  | 50 | } else { |
  |  | 51 | accua\_forms\_show\_recaptcha2( $js\_field\_id , { sitekey: $js\_publicKey }); |
  |  | 52 | } |
  |  | 53 | }); |
  |  | 54 | } |
  | 61 | 55 | // --> |
  | 62 | 56 | </script> |
* ## [contact-forms/trunk/classes/Element/Date.php](/changeset/2924628/contact-forms/trunk/classes/Element/Date.php "Show the changeset 2924628 restricted to contact-forms/trunk/classes/Element/Date.php")

  | [r2880279](/browser/contact-forms/trunk/classes/Element/Date.php?rev=2880279#L1 "Show revision 2880279 of this file in browser") | [r2924628](/browser/contact-forms/trunk/classes/Element/Date.php?rev=2924628#L1 "Show revision 2924628 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 | class AccuaForm\_Element\_Date extends Element\_Textbox { |
  |  | 3 | protected $minDate = null; |
  |  | 4 | protected $maxDate = null; |
  | 3 | 5 | public function \_\_construct($label, $name, array $properties = null) { |
  | 4 | 6 | parent::\_\_construct($label,$name,$properties); |
  | 5 | 7 | $this->attributes['type'] = 'date'; |
  | 6 | 8 | $this->attributes['pattern'] = '\d{4}-\d{2}-\d{2}'; |
  | 7 |  | $~~this->setValidation(~~new AccuaForm\_Validation\_Date( |
  |  | 9 | $validator = new AccuaForm\_Validation\_Date( |
  | 8 | 10 | str\_replace('%element%', $label, \_\_("Attention: '%element%' must contain a valid date.", 'contact-forms')) |
  | 9 |  | )); |
  |  | 11 | ); |
  |  | 12 | $validator->configure(array('minDate' => $this->minDate, 'maxDate'=> $this->maxDate)); |
  |  | 13 | $this->setValidation($validator); |
  | 10 | 14 | } |
  | 11 | 15 | } |
* ## [contact-forms/trunk/classes/Validation/Date.php](/changeset/2924628/contact-forms/trunk/classes/Validation/Date.php "Show the changeset 2924628 restricted to contact-forms/trunk/classes/Validation/Date.php")

  | [r2880279](/browser/contact-forms/trunk/classes/Validation/Date.php?rev=2880279#L2 "Show revision 2880279 of this file in browser") | [r2924628](/browser/contact-forms/trunk/classes/Validation/Date.php?rev=2924628#L2 "Show revision 2924628 of this file in browser") |  |
  | --- | --- | --- |
  | 2 | 2 | class AccuaForm\_Validation\_Date extends Validation { |
  | 3 | 3 | protected $message = "Error: %element% must contain a valid date."; |
  |  | 4 | protected $minDate = null; |
  |  | 5 | protected $maxDate = null; |
  | 4 | 6 |  |
  | 5 | 7 | public function isValid($value) { |
  |  | 8 | if ($value === '') { |
  |  | 9 | return true; |
  |  | 10 | } |
  | 6 | 11 | if (preg\_match('/^\d{4}-\d{2}-\d{2}$/', $value)) { |
  | 7 | 12 | try { |
  | 8 | 13 | $date = new DateTime($value); |
  | 9 | 14 | if ($date) { |
  |  | 15 | if ($this->minDate && ($value < $this->minDate)) { |
  |  | 16 | return false; |
  |  | 17 | } |
  |  | 18 | if ($this->maxDate && ($value > $this->maxDate)) { |
  |  | 19 | return false; |
  |  | 20 | } |
  | 10 | 21 | return true; |
  | 11 | 22 | } |
* ## [contact-forms/trunk/contact-forms.php](/changeset/2924628/contact-forms/trunk/contact-forms.php "Show the changeset 2924628 restricted to contact-forms/trunk/contact-forms.php")

  | [r2893400](/browser/contact-forms/trunk/contact-forms.php?rev=2893400#L3 "Show revision 2893400 of this file in browser") | [r2924628](/browser/contact-forms/trunk/contact-forms.php?rev=2924628#L3 "Show revision 2924628 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | Plugin Name: WordPress Contact Forms by Cimatti |
  | 4 | 4 | Description: Quickly create and publish forms in your WordPress powered website. |
  | 5 |  | Version: 1.5.~~7~~ |
  |  | 5 | Version: 1.5.8 |
  | 6 | 6 | Plugin URI: https://www.cimatti.it/wordpress/contact-forms/ |
  | 7 | 7 | Author: Cimatti Consulting |
  | […](/browser/contact-forms/trunk/contact-forms.php?rev=2893400#L13) | […](/browser/contact-forms/trunk/contact-forms.php?rev=2924628#L13) |  |
  | 13 | 13 | /\* |
  | 14 | 14 | WordPress Contact Forms by Cimatti |
  | 15 |  | Copyright (c) 2011-202~~2~~ Andrea Cimatti |
  |  | 15 | Copyright (c) 2011-2023 Andrea Cimatti |
  | 16 | 16 |  |
  | 17 | 17 | This program is free software; you can redistribute it and/or |
  | […](/browser/contact-forms/trunk/contact-forms.php?rev=2893400#L36) | […](/browser/contact-forms/trunk/contact-forms.php?rev=2924628#L36) |  |
  | 36 | 36 | define('ACCUA\_FORMS\_DB\_VERSION', '11'); |
  | 37 | 37 | define('ACCUA\_FORMS\_CSS\_VERSION', '49'); |
  | 38 |  | define('ACCUA\_FORMS\_JS\_VERSION', '~~6~~'); |
  |  | 38 | define('ACCUA\_FORMS\_JS\_VERSION', '7'); |
  | 39 | 39 | define('ACCUA\_FORMS\_DIR\_URL', plugin\_dir\_url( \_\_FILE\_\_ )); |
  | 40 | 40 | define('ACCUA\_FORMS\_DIR', dirname( \_\_FILE\_\_ )); |
  | […](/browser/contact-forms/trunk/contact-forms.php?rev=2893400#L45) | […](/browser/contact-forms/trunk/contact-forms.php?rev=2924628#L45) |  |
  | 45 | 45 |  |
  | 46 | 46 | function accua\_forms\_dashboard\_page\_head(){ |
  | 47 |  | ~~$referer = $\_SERVER['HTTP\_REFERER'];~~ |
  | 48 |  | ~~$referer = str\_replace(['http://', 'https://'], '', $referer);~~ |
  | 49 |  | ~~$host = $\_SERVER['HTTP\_HOST'];~~ |
  | 50 |  |  |
  | 51 |  | ~~if ( $host !== substr($referer, 0, strlen($host))) {~~ |
  | 52 |  | ~~wp\_die("Accesso non consentito!");~~ |
  | 53 |  | ~~}~~ |
  | 54 | 47 | $screen = get\_current\_screen(); |
  | 55 | 48 | $screen->add\_help\_tab( array( |
  | […](/browser/contact-forms/trunk/contact-forms.php?rev=2893400#L138) | […](/browser/contact-forms/trunk/contact-forms.php?rev=2924628#L131) |  |
  | 138 | 131 | global $wpdb; |
  | 139 | 132 |  |
  | 140 |  | require\_once(ABSPATH.'wp-admin/~~upgrade-functions~~.php'); |
  |  | 133 | require\_once(ABSPATH.'wp-admin/includes/upgrade.php'); |
  | 141 | 134 |  |
  | 142 | 135 | $charset\_collate = ''; |
  | […](/browser/contact-forms/trunk/contact-forms.php?rev=2893400#L149) | […](/browser/contact-forms/trunk/contact-forms.php?rev=2924628#L142) |  |
  | 149 | 142 |  |
  | 150 | 143 | if ($old\_db\_version < 3) { |
  | 151 |  | @ $wpdb->query("ALTER TABLE `{$wpdb->prefix}accua\_forms\_submissions` DROP INDEX uri"); |
  | 152 |  | @ $wpdb->query("ALTER TABLE `{$wpdb->prefix}accua\_forms\_submissions` DROP INDEX referrer"); |
  |  | 144 | $wpdb\_suppress\_errors\_status = $wpdb->suppress\_errors(); |
  |  | 145 | $wpdb->query("ALTER TABLE `{$wpdb->prefix}accua\_forms\_submissions` DROP INDEX uri"); |
  |  | 146 | $wpdb->query("ALTER TABLE `{$wpdb->prefix}accua\_forms\_submissions` DROP INDEX referrer"); |
  |  | 147 | $wpdb->suppress\_errors($wpdb\_suppress\_errors\_status); |
  | 153 | 148 | } |
  | 154 | 149 |  |
* ## [contact-forms/trunk/form-fields.js](/changeset/2924628/contact-forms/trunk/form-fields.js "Show the changeset 2924628 restricted to contact-forms/trunk/form-fields.js")

  | [r2879909](/browser/contact-forms/trunk/form-fields.js?rev=2879909#L178 "Show revision 2879909 of this file in browser") | [r2924628](/browser/contact-forms/trunk/form-fields.js?rev=2924628#L178 "Show revision 2924628 of this file in browser") |  |
  | --- | --- | --- |
  | 178 | 178 | var a = { |
  | 179 | 179 | action: 'accua-form-fields-order', |
  | 180 |  | ~~savewidgets: $('#\_wpnonce\_widgets~~').val(), |
  |  | 180 | \_nonce\_edit\_form: $('#\_nonce\_edit\_form').val(), |
  | 181 | 181 | sidebars: [] |
  | 182 | 182 | }; |
  | […](/browser/contact-forms/trunk/form-fields.js?rev=2879909#L204) | […](/browser/contact-forms/trunk/form-fields.js?rev=2924628#L204) |  |
  | 204 | 204 | a = { |
  | 205 | 205 | action: 'accua-save-form-field', |
  | 206 |  | ~~savewidgets: $('#\_wpnonce\_widgets~~').val(), |
  |  | 206 | \_nonce\_edit\_form: $('#\_nonce\_edit\_form').val(), |
  | 207 | 207 | sidebar: sb |
  | 208 | 208 | }; |
* ## [contact-forms/trunk/form-settings.js](/changeset/2924628/contact-forms/trunk/form-settings.js "Show the changeset 2924628 restricted to contact-forms/trunk/form-settings.js")

  | [r2879909](/browser/contact-forms/trunk/form-settings.js?rev=2879909#L31 "Show revision 2879909 of this file in browser") | [r2924628](/browser/contact-forms/trunk/form-settings.js?rev=2924628#L31 "Show revision 2924628 of this file in browser") |  |
  | --- | --- | --- |
  | 31 | 31 | 'action': 'accua-save-form-settings', |
  | 32 | 32 | 'form-id': form\_id, |
  |  | 33 | '\_nonce\_edit\_form': $('#\_nonce\_edit\_form').val(), |
  | 33 | 34 | 'title': $('#title').val(), |
  | 34 | 35 | 'use\_ajax': ($('#accua\_form\_use\_ajax .accua\_form\_value').is(':checked') ? 1 : 0) |
* ## [contact-forms/trunk/languages/contact-forms-es\_ES.po](/changeset/2924628/contact-forms/trunk/languages/contact-forms-es_ES.po "Show the changeset 2924628 restricted to contact-forms/trunk/languages/contact-forms-es_ES.po")

  | [r2879750](/browser/contact-forms/trunk/languages/contact-forms-es_ES.po?rev=2879750#L338 "Show revision 2879750 of this file in browser") | [r2924628](/browser/contact-forms/trunk/languages/contact-forms-es_ES.po?rev=2924628#L338 "Show revision 2924628 of this file in browser") |  |
  | --- | --- | --- |
  | 338 | 338 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:667 |
  | 339 | 339 | #, php-format |
  | 340 |  | msgid "Form \~~\\"%s\\~~\" deleted" |
  | 341 |  | msgstr "Formulario \~~\\"%s\\~~\" eliminado" |
  |  | 340 | msgid "Form \"%s\" deleted" |
  |  | 341 | msgstr "Formulario \"%s\" eliminado" |
  | 342 | 342 |  |
  | 343 | 343 | #: D:\Accua |
* ## [contact-forms/trunk/languages/contact-forms-it\_IT.po](/changeset/2924628/contact-forms/trunk/languages/contact-forms-it_IT.po "Show the changeset 2924628 restricted to contact-forms/trunk/languages/contact-forms-it_IT.po")

  | [r2879909](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L31 "Show revision 2879909 of this file in browser") | [r2924628](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2924628#L31 "Show revision 2924628 of this file in browser") |  |
  | --- | --- | --- |
  | 31 | 31 | #: D:\Accua |
  | 32 | 32 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms-list-page.php:53 |
  | 33 |  | ~~#, fuzzy~~ |
  | 34 | 33 | msgid "Report" |
  | 35 |  | msgstr "~~Esporta~~" |
  |  | 34 | msgstr "Report" |
  | 36 | 35 |  |
  | 37 | 36 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L39) | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2924628#L38) |  |
  | 39 | 38 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms-list-page.php:287 |
  | 40 | 39 | msgid "Trash" |
  | 41 |  | msgstr "" |
  |  | 40 | msgstr "Cestino" |
  | 42 | 41 |  |
  | 43 | 42 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L68) | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2924628#L67) |  |
  | 68 | 67 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms-list-page.php:183 |
  | 69 | 68 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms-list-page.php:197 |
  | 70 |  | ~~#, fuzzy~~ |
  | 71 | 69 | msgid "(no title)" |
  | 72 |  | msgstr "~~Titolo del form~~" |
  |  | 70 | msgstr "(nessun titolo)" |
  | 73 | 71 |  |
  | 74 | 72 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L159) | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2924628#L157) |  |
  | 159 | 157 | #: D:\Accua |
  | 160 | 158 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms-submissions-page.php:506 |
  | 161 |  | ~~#, fuzzy~~ |
  | 162 | 159 | msgid "Export to excel" |
  | 163 |  | msgstr "Esporta in formato excel~~avanzato~~" |
  |  | 160 | msgstr "Esporta in formato excel" |
  | 164 | 161 |  |
  | 165 | 162 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L340) | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2924628#L337) |  |
  | 340 | 337 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:667 |
  | 341 | 338 | #, php-format |
  | 342 |  | msgid "Form \~~\\"%s\\~~\" deleted" |
  | 343 |  | msgstr "Form \~~\\"%s\\~~\" cancellato" |
  |  | 339 | msgid "Form \"%s\" deleted" |
  |  | 340 | msgstr "Form \"%s\" cancellato" |
  | 344 | 341 |  |
  | 345 | 342 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L359) | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2924628#L356) |  |
  | 359 | 356 |  |
  | 360 | 357 | #: D:\Accua |
  | 361 |  | ~~#: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:708~~ |
  | 362 |  | ~~#, fuzzy~~ |
  | 363 |  | ~~msgid "Accua Forms"~~ |
  | 364 |  | ~~msgstr "Impostazioni di Accua Forms"~~ |
  | 365 |  |  |
  | 366 |  | ~~#: D:\Accua~~ |
  | 367 | 358 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:709 |
  | 368 |  | ~~#, fuzzy~~ |
  | 369 | 359 | msgid "Add New" |
  | 370 |  | msgstr "Crea" |
  |  | 360 | msgstr "Crea Nuovo" |
  | 371 | 361 |  |
  | 372 | 362 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L436) | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2924628#L426) |  |
  | 436 | 426 | #: D:\Accua |
  | 437 | 427 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:816 |
  | 438 |  | ~~#, fuzzy~~ |
  | 439 | 428 | msgid "Drop fields here" |
  | 440 | 429 | msgstr "Trascina qui i campi" |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L447) | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2924628#L436) |  |
  | 447 | 436 | #: D:\Accua |
  | 448 | 437 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:851 |
  | 449 |  | ~~#, fuzzy~~ |
  | 450 | 438 | msgid "Drag fields from here to a sidebar on the right to activate them. Drag fields back here to deactivate them." |
  | 451 | 439 | msgstr "Per attivare i campi, trascinali da qui alla sidebar sulla destra. Trascinali di nuovo qui per disattivarli e cancellare le loro impostazioni." |
  | 452 | 440 |  |
  | 453 | 441 | #: D:\Accua |
  | 454 |  | ~~#: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:852~~ |
  | 455 |  | ~~#, fuzzy~~ |
  | 456 |  | ~~msgid "Create new fields here"~~ |
  | 457 |  | ~~msgstr "crea un nuovo campo"~~ |
  | 458 |  |  |
  | 459 |  | ~~#: D:\Accua~~ |
  | 460 | 442 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:901 |
  | 461 | 443 | msgid "Token" |
  | 462 |  | msgstr "" |
  |  | 444 | msgstr "Token" |
  | 463 | 445 |  |
  | 464 | 446 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L490) | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2924628#L472) |  |
  | 490 | 472 |  |
  | 491 | 473 | #: D:\Accua |
  | 492 |  | ~~#: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:920~~ |
  | 493 |  | ~~#: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:939~~ |
  | 494 |  | ~~#: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:977~~ |
  | 495 |  | ~~#: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1009~~ |
  | 496 |  | ~~#, fuzzy~~ |
  | 497 |  | ~~msgid "Nessun messaggio"~~ |
  | 498 |  | ~~msgstr "Messaggio di conferma"~~ |
  | 499 |  |  |
  | 500 |  | ~~#: D:\Accua~~ |
  | 501 | 474 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:922 |
  | 502 |  | ~~#, fuzzy~~ |
  | 503 | 475 | msgid "Default Success message" |
  | 504 |  | msgstr "Messaggio di conferma" |
  |  | 476 | msgstr "Messaggio di conferma predefinito" |
  | 505 | 477 |  |
  | 506 | 478 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L511) | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2924628#L483) |  |
  | 511 | 483 | #: D:\Accua |
  | 512 | 484 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:941 |
  | 513 |  | ~~#, fuzzy~~ |
  | 514 | 485 | msgid "Default error message" |
  | 515 |  | msgstr "Messaggio di errore" |
  |  | 486 | msgstr "Messaggio di errore predefinito" |
  | 516 | 487 |  |
  | 517 | 488 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L525) | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2924628#L496) |  |
  | 525 | 496 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1718 |
  | 526 | 497 | msgid "To" |
  | 527 |  | msgstr "" |
  |  | 498 | msgstr "A" |
  | 528 | 499 |  |
  | 529 | 500 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L531) | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2924628#L502) |  |
  | 531 | 502 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1723 |
  | 532 | 503 | msgid "Bcc" |
  | 533 |  | msgstr "" |
  |  | 504 | msgstr "Ccn" |
  | 534 | 505 |  |
  | 535 | 506 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L539) | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2924628#L510) |  |
  | 539 | 510 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1750 |
  | 540 | 511 | msgid "Subject" |
  | 541 |  | msgstr "" |
  |  | 512 | msgstr "Oggetto" |
  | 542 | 513 |  |
  | 543 | 514 | #: D:\Accua |
  | 544 | 515 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:979 |
  | 545 | 516 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1011 |
  | 546 |  | ~~#, fuzzy~~ |
  | 547 | 517 | msgid "Default message" |
  | 548 |  | msgstr "Valore di default" |
  | 549 |  |  |
  | 550 |  | #: D:\Accua |
  | 551 |  | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:991 |
  | 552 |  | msgid "4. Email confirmation to the person who completed the form " |
  | 553 |  | msgstr "" |
  | 554 |  |  |
  | 555 |  | #: D:\Accua |
  | 556 |  | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:994 |
  | 557 |  | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1745 |
  | 558 |  | #, fuzzy |
  | 559 |  | msgid "From" |
  | 560 |  | msgstr "Form" |
  | 561 |  |  |
  | 562 |  | #: D:\Accua |
  | 563 |  | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1029 |
  | 564 |  | msgid "Se hai fatto modifiche, salva prima le modifiche poi" |
  | 565 |  | msgstr "" |
  | 566 |  |  |
  | 567 |  | #: D:\Accua |
  | 568 |  | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1030 |
  | 569 |  | msgid "ricarica la pagina" |
  | 570 |  | msgstr "" |
  |  | 518 | msgstr "Messaggio predefinito" |
  | 571 | 519 |  |
  | 572 | 520 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L578) | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2924628#L526) |  |
  | 578 | 526 | #: D:\Accua |
  | 579 | 527 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1274 |
  | 580 |  | ~~#, fuzzy, php-format~~ |
  | 581 | 528 | msgid "Field \"%s\" deleted" |
  | 582 |  | msgstr "Campo \"%s\" ~~aggiorn~~ato" |
  |  | 529 | msgstr "Campo \"%s\" cancellato" |
  | 583 | 530 |  |
  | 584 | 531 | #: D:\Accua |
  | 585 | 532 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1283 |
  | 586 |  | ~~#, fuzzy~~ |
  | 587 | 533 | msgid "Only letters, numbers, hyphen and underscores allowed in field identificative slug" |
  | 588 |  | msgstr "Sono consentite solo lettere, numeri e lineette nel~~nome~~ identificativo del form" |
  |  | 534 | msgstr "Sono consentite solo lettere, numeri e lineette nello slug identificativo del form" |
  | 589 | 535 |  |
  | 590 | 536 | #: D:\Accua |
  | 591 | 537 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1287 |
  | 592 |  | ~~#, fuzzy~~ |
  | 593 | 538 | msgid "The field identificative slug can't start with two underscores (\_\_)" |
  | 594 | 539 | msgstr "Il nome identificativo non può iniziare con due trattini bassi (\_\_)" |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L598) | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2924628#L543) |  |
  | 598 | 543 | #, php-format |
  | 599 | 544 | msgid "<p>A field with identificative slug \"%s\" already exists</p> Field \"%s\" deleted" |
  | 600 |  | msgstr "Un campo con slug \"%s\" esiste già</p> Campo \"%s\" cancellato" |
  |  | 545 | msgstr "<p>Un campo con slug \"%s\" esiste già</p> Campo \"%s\" cancellato" |
  | 601 | 546 |  |
  | 602 | 547 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L607) | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2924628#L552) |  |
  | 607 | 552 | #: D:\Accua |
  | 608 | 553 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1309 |
  | 609 |  | ~~#, fuzzy, php-format~~ |
  | 610 | 554 | msgid "Field \"%s\" created" |
  | 611 |  | msgstr "Campo \"%s\" ~~aggiorn~~ato" |
  |  | 555 | msgstr "Campo \"%s\" creato" |
  | 612 | 556 |  |
  | 613 | 557 | #: D:\Accua |
  | 614 | 558 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1327 |
  | 615 |  | ~~#, fuzzy, php-format~~ |
  | 616 | 559 | msgid "Field \"%s\" doesn't exists" |
  | 617 |  | msgstr "Il ~~form sorgente non esiste.~~" |
  |  | 560 | msgstr "Il campo \"%s\" non esiste" |
  | 618 | 561 |  |
  | 619 | 562 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L637) | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2924628#L580) |  |
  | 637 | 580 | #: D:\Accua |
  | 638 | 581 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1487 |
  | 639 |  | ~~#, fuzzy~~ |
  | 640 | 582 | msgid "Text Field" |
  | 641 |  | msgstr "Camp~~i~~" |
  |  | 583 | msgstr "Campo di testo" |
  | 642 | 584 |  |
  | 643 | 585 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L658) | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2924628#L600) |  |
  | 658 | 600 | #: D:\Accua |
  | 659 | 601 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1492 |
  | 660 |  | ~~#, fuzzy~~ |
  | 661 | 602 | msgid "Select" |
  | 662 |  | msgstr "~~Cancella~~" |
  |  | 603 | msgstr "Select" |
  | 663 | 604 |  |
  | 664 | 605 | #: D:\Accua |
  | 665 | 606 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1493 |
  | 666 | 607 | msgid "Radio buttons" |
  | 667 |  | msgstr "" |
  |  | 608 | msgstr "Pulsanti radio" |
  | 668 | 609 |  |
  | 669 | 610 | #: D:\Accua |
  | 670 | 611 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1494 |
  | 671 | 612 | msgid "Multiple selections area" |
  | 672 |  | msgstr "" |
  |  | 613 | msgstr "Area di selezione multipla" |
  | 673 | 614 |  |
  | 674 | 615 | #: D:\Accua |
  | 675 | 616 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1495 |
  | 676 | 617 | msgid "Multiple checkboxes" |
  | 677 |  | msgstr "" |
  |  | 618 | msgstr "Checkbox multipli" |
  | 678 | 619 |  |
  | 679 | 620 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L689) | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2924628#L630) |  |
  | 689 | 630 | #: D:\Accua |
  | 690 | 631 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1498 |
  | 691 |  | ~~#, fuzzy~~ |
  | 692 | 632 | msgid "Submit button" |
  | 693 | 633 | msgstr "Bottone di invio" |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L695) | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2924628#L635) |  |
  | 695 | 635 | #: D:\Accua |
  | 696 | 636 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1499 |
  | 697 |  | ~~#, fuzzy~~ |
  | 698 | 637 | msgid "Custom HTML" |
  | 699 | 638 | msgstr "Contenuto HTML personalizzato" |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L702) | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2924628#L641) |  |
  | 702 | 641 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1500 |
  | 703 | 642 | msgid "Captcha" |
  | 704 |  | msgstr "" |
  |  | 643 | msgstr "Captcha" |
  | 705 | 644 |  |
  | 706 | 645 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L712) | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2924628#L651) |  |
  | 712 | 651 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1508 |
  | 713 | 652 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1587 |
  | 714 |  | ~~#, fuzzy~~ |
  | 715 | 653 | msgid "Add new field" |
  | 716 |  | msgstr "Crea nuovo ~~form~~" |
  |  | 654 | msgstr "Crea nuovo campo" |
  | 717 | 655 |  |
  | 718 | 656 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L743) | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2924628#L681) |  |
  | 743 | 681 | #: D:\Accua |
  | 744 | 682 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1531 |
  | 745 |  | ~~#, fuzzy~~ |
  | 746 | 683 | msgid "Field type" |
  | 747 |  | msgstr "~~Filtra~~" |
  |  | 684 | msgstr "Tipo di campo" |
  | 748 | 685 |  |
  | 749 | 686 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L759) | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2924628#L696) |  |
  | 759 | 696 | #: D:\Accua |
  | 760 | 697 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1569 |
  | 761 |  | ~~#, fuzzy~~ |
  | 762 | 698 | msgid "For multiple default values in multiple select and multiple checkboxes, use | as separator." |
  | 763 |  | msgstr "Usa | per dividere più valori di default." |
  |  | 699 | msgstr "Usa | per dividere più valori di default nei campi di selezione multipla e checkbox multipli." |
  | 764 | 700 |  |
  | 765 | 701 | #: D:\Accua |
  | 766 | 702 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1575 |
  | 767 |  | ~~#, fuzzy~~ |
  | 768 | 703 | msgid "Options used in select, radio and multiple checkboxes. Enter one value per line, in the format key|label. The key is the value that will be stored in the database. The label is optional, and the key will be used as the label if no label is specified. For file fields, this indicates allowed extensions (one per line without dot)" |
  | 769 |  | msgstr "~~Valori che il campo può contenere. Inserisci un valore per riga, nel formato chiave|etichetta. La chiave è il valore che verrà salvato nel database. L'etichetta è opzionale: se non è specificata, verrà utilizzata la chiave.~~" |
  |  | 704 | msgstr "Opzioni dei campi select, radio e checkbox multipli. Inserisci un valore per riga, nel formato chiave|etichetta. La chiave è il valore che verrà salvato nel database. L'etichetta è opzionale: se non è specificata, verrà utilizzata la chiave. Per i campi file, questo indica le estensioni abilitate (una per linea senza punto)" |
  | 770 | 705 |  |
  | 771 | 706 | #: D:\Accua |
  | 772 | 707 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1589 |
  | 773 |  | ~~#, fuzzy~~ |
  | 774 | 708 | msgid "Save changes" |
  | 775 |  | msgstr "Salva ~~le~~ impostazioni" |
  |  | 709 | msgstr "Salva impostazioni" |
  | 776 | 710 |  |
  | 777 | 711 | #: D:\Accua |
  | 778 | 712 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1590 |
  | 779 |  | ~~#, fuzzy~~ |
  | 780 | 713 | msgid "Delete field" |
  | 781 |  | msgstr "~~Cancella~~" |
  |  | 714 | msgstr "Elimina campo" |
  | 782 | 715 |  |
  | 783 | 716 | #: D:\Accua |
  | 784 | 717 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1621 |
  | 785 |  | ~~#, fuzzy~~ |
  | 786 | 718 | msgid "Default Form settings" |
  | 787 |  | msgstr "Impostazioni di ~~Accua Forms~~" |
  |  | 719 | msgstr "Impostazioni di Default dei Form" |
  | 788 | 720 |  |
  | 789 | 721 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L831) | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2924628#L763) |  |
  | 831 | 763 | msgid "Confirmation email message" |
  | 832 | 764 | msgstr "Messaggio nell'email di conferma" |
  | 833 |  |  |
  | 834 |  | ~~#: D:\Accua~~ |
  | 835 |  | ~~#: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1704~~ |
  | 836 |  | ~~#, fuzzy~~ |
  | 837 |  | ~~msgid "2 On-screen error message"~~ |
  | 838 |  | ~~msgstr "1. Messaggio di successo al completamento del form"~~ |
  | 839 | 765 |  |
  | 840 | 766 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L852) | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2924628#L778) |  |
  | 852 | 778 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1766 |
  | 853 | 779 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1793 |
  | 854 |  | ~~#, fuzzy~~ |
  | 855 | 780 | msgid "Valid extensions" |
  | 856 | 781 | msgstr "Estensioni consentite" |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L878) | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2924628#L803) |  |
  | 878 | 803 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1801 |
  | 879 | 804 | msgid "This value is limited by server upload limits of " |
  | 880 |  | msgstr "" |
  |  | 805 | msgstr "Questo valore è ristretto dal limite di upload del server di " |
  | 881 | 806 |  |
  | 882 | 807 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L884) | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2924628#L809) |  |
  | 884 | 809 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1803 |
  | 885 | 810 | msgid "If you need a greater limit you should ask to the server administrator." |
  | 886 |  | msgstr "" |
  |  | 811 | msgstr "Se hai bisogno di un limite più alto devi chiedere all'amministratore del server." |
  | 887 | 812 |  |
  | 888 | 813 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L890) | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2924628#L815) |  |
  | 890 | 815 | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1807 |
  | 891 | 816 | msgid "Upload path" |
  | 892 |  | msgstr "" |
  | 893 |  |  |
  | 894 |  | #: D:\Accua |
  | 895 |  | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1782 |
  | 896 |  | #: 07\_08\27\_06\_2013\accua-forms/accua-forms.php:1808 |
  | 897 |  | msgid "If it stars with " |
  | 898 |  | msgstr "" |
  |  | 817 | msgstr "Percorso caricamento" |
  | 899 | 818 |  |
  | 900 | 819 | #: D:\Accua |
  | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2879909#L1118) | […](/browser/contact-forms/trunk/languages/contact-forms-it_IT.po?rev=2924628#L1037) |  |
  | 1118 | 1037 | msgid "Post select" |
  | 1119 | 1038 | msgstr "Select dei post" |
  |  | 1039 |  |
  |  | 1040 | msgid "Preview" |
  |  | 1041 | msgstr "Anteprima" |
  |  | 1042 |  |
  |  | 1043 | msgid "(for spam or tests submissions)" |
  |  | 1044 | msgstr "(per invii  di spam o test)" |
  |  | 1045 |  |
  |  | 1046 | msgid "Appearance" |
  |  | 1047 | msgstr "Grafica" |
  |  | 1048 |  |
  |  | 1049 | msgid "General" |
  |  | 1050 | msgstr "Generali" |
  |  | 1051 |  |
  |  | 1052 | msgid "Do not reload the page on form submission" |
  |  | 1053 | msgstr "Non ricaricare la pagina alla compilazione del form" |
  |  | 1054 |  |
  |  | 1055 | msgid "Labels" |
  |  | 1056 | msgstr "Etichette" |
  |  | 1057 |  |
  |  | 1058 | msgid "Unstyled Preview" |
  |  | 1059 | msgstr "Anteprima senza stile" |
  |  | 1060 |  |
  |  | 1061 | msgid "This representation does not incorporate the active theme styles of your website. To view the finalized look, integrate this form within your website." |
  |  | 1062 | msgstr "Questa anteprima non include gli stili del tema attivo del tuo sito. Per visualizzare l'aspetto finale, integra questo form nel tuo sito." |
  |  | 1063 |  |
  |  | 1064 | msgid "Drag & Drop Form Fields" |
  |  | 1065 | msgstr "Trascina i Campi del Form" |
* ## [contact-forms/trunk/phpseclib-crypt/Base.php](/changeset/2924628/contact-forms/trunk/phpseclib-crypt/Base.php "Show the changeset 2924628 restricted to contact-forms/trunk/phpseclib-crypt/Base.php")

  | [r2048304](/browser/contact-forms/trunk/phpseclib-crypt/Base.php?rev=2048304#L123 "Show revision 2048304 of this file in browser") | [r2924628](/browser/contact-forms/trunk/phpseclib-crypt/Base.php?rev=2924628#L123 "Show revision 2924628 of this file in browser") |  |
  | --- | --- | --- |
  | 123 | 123 | \* @access  public |
  | 124 | 124 | \*/ |
  |  | 125 | #[AllowDynamicProperties] |
  | 125 | 126 | class Crypt\_Base |
  | 126 | 127 | { |
* ## [contact-forms/trunk/readme.txt](/changeset/2924628/contact-forms/trunk/readme.txt "Show the changeset 2924628 restricted to contact-forms/trunk/readme.txt")

  | [r2893400](/browser/contact-forms/trunk/readme.txt?rev=2893400#L4 "Show revision 2893400 of this file in browser") | [r2924628](/browser/contact-forms/trunk/readme.txt?rev=2924628#L4 "Show revision 2924628 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Requires at least: 3.5 |
  | 5 | 5 | Tested up to: 6.2.0 |
  | 6 |  | Stable tag: 1.5.~~7~~ |
  |  | 6 | Stable tag: 1.5.8 |
  | 7 | 7 | License: GPLv2 or later |
  | 8 | 8 | License URI: http://www.gnu.org/licenses/gpl-2.0.html |
  | […](/browser/contact-forms/trunk/readme.txt?rev=2893400#L88) | […](/browser/contact-forms/trunk/readme.txt?rev=2924628#L88) |  |
  | 88 | 88 | == Changelog == |
  | 89 | 89 |  |
  |  | 90 | = 1.5.8 = |
  |  | 91 | \* Fixed CSRF vulnerabilities |
  |  | 92 | \* Fixed some JavaScript errors due to WordPress filters |
  |  | 93 | \* Fixed many minor bugs |
  |  | 94 |  |
  | 90 | 95 | = 1.5.7 = |
  | 91 |  | \* tested compatibility ~~for wordp~~ress 6.2.0 |
  |  | 96 | \* tested compatibility with WordPress 6.2.0 |
  | 92 | 97 |  |
  | 93 | 98 | = 1.5.6 = |
  | […](/browser/contact-forms/trunk/readme.txt?rev=2893400#L95) | […](/browser/contact-forms/trunk/readme.txt?rev=2924628#L100) |  |
  | 95 | 100 |  |
  | 96 | 101 | = 1.5.5 = |
  | 97 |  | \* Fixed XSS vulnerability |
  | 98 |  | \* Fixed XSS vulnerability |
  |  | 102 | \* Fixed XSS vulnerabilities |
  | 99 | 103 |  |
  | 100 | 104 | = 1.5.4 = |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=2924628)
* [Zip Archive](?format=zip&new=2924628)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_4a291fbd_20250114_195445.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# WordPress Contact Forms by Cimatti <= 1.5.7 - Cross-Site Request Forgery via \_accua\_forms\_form\_edit\_action

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   WordPress Contact Forms by Cimatti <= 1.5.7 - Cross-Site Request Forgery via \_accua\_forms\_form\_edit\_action

4.3

**Cross-Site Request Forgery (CSRF)**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:L/A:N)

| CVE | [CVE-2023-2563](https://www.cve.org/CVERecord?id=CVE-2023-2563) |
| --- | --- |
| CVSS | 4.3 (Medium) |
| Publicly Published | June 12, 2023 |
| Last Updated | January 22, 2024 |
| Researcher | [Marco Wotschka - Wordfence](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/marco-wotschka) |

### Description

The WordPress Contact Forms by Cimatti plugin for WordPress is vulnerable to Cross-Site Request Forgery in versions up to, and including, 1.5.7. This is due to missing or incorrect nonce validation on the function \_accua\_forms\_form\_edit\_action. This makes it possible for unauthenticated attackers to delete forms created with this plugin via a forged request granted they can trick a site administrator into performing an action such as clicking on a link.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/contact-forms/trunk/accua-forms.php#L738)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&old=2924628%40contact-forms&new=2924628%40contact-forms&sfp_email=&sfph_mail=)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fcontact-forms%2Fwordpress-contact-forms-by-cimatti-157-cross-site-request-forgery-via-accua-forms-form-edit-action&t=WordPress%20Contact%20Forms%20by%20Cimatti%20%3C%3D%201.5.7%20-%20Cross-Site%20Request%20Forgery%20via%20_accua_forms_form_edit_action "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fcontact-forms%2Fwordpress-contact-forms-by-cimatti-157-cross-site-request-forgery-via-accua-forms-form-edit-action&text=WordPress%20Contact%20Forms%20by%20Cimatti%20%3C%3D%201.5.7%20-%20Cross-Site%20Request%20Forgery%20via%20_accua_forms_form_edit_action "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fcontact-forms%2Fwordpress-contact-forms-by-cimatti-157-cross-site-request-forgery-via-accua-forms-form-edit-action "LinkedIn")
Email

## Vulnerability Details for WordPress Contact Forms by Cimatti

#### [WordPress Contact Forms by Cimatti](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/contact-forms)

| Software Type | Plugin |
| --- | --- |
| Software Slug | contact-forms [(view on wordpress.org)](https://wordpress.org/plugins/contact-forms) |
| Patched? | Yes |
| Remediation | Update to version 1.5.8, or a newer patched version |
| Affected Version | * <= 1.5.7 |
| Patched Version | * 1.5.8 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation


