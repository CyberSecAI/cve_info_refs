=== Content from github.com_62fde82d_20250114_185325.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flidofinance%2Fgate-seals%2Fblob%2F051593e74df01a4131c485b4fda52e691cd4b7d8%2Fcontracts%2FGateSeal.vy)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flidofinance%2Fgate-seals%2Fblob%2F051593e74df01a4131c485b4fda52e691cd4b7d8%2Fcontracts%2FGateSeal.vy)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=lidofinance%2Fgate-seals)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[lidofinance](/lidofinance)
/
**[gate-seals](/lidofinance/gate-seals)**
Public

* [Notifications](/login?return_to=%2Flidofinance%2Fgate-seals) You must be signed in to change notification settings
* [Fork
  3](/login?return_to=%2Flidofinance%2Fgate-seals)
* [Star
   8](/login?return_to=%2Flidofinance%2Fgate-seals)

* [Code](/lidofinance/gate-seals)
* [Issues
  0](/lidofinance/gate-seals/issues)
* [Pull requests
  11](/lidofinance/gate-seals/pulls)
* [Actions](/lidofinance/gate-seals/actions)
* [Projects
  0](/lidofinance/gate-seals/projects)
* [Security](/lidofinance/gate-seals/security)
* [Insights](/lidofinance/gate-seals/pulse)

Additional navigation options

* [Code](/lidofinance/gate-seals)
* [Issues](/lidofinance/gate-seals/issues)
* [Pull requests](/lidofinance/gate-seals/pulls)
* [Actions](/lidofinance/gate-seals/actions)
* [Projects](/lidofinance/gate-seals/projects)
* [Security](/lidofinance/gate-seals/security)
* [Insights](/lidofinance/gate-seals/pulse)

## Files

 051593e
## Breadcrumbs

1. [gate-seals](/lidofinance/gate-seals/tree/051593e74df01a4131c485b4fda52e691cd4b7d8)
2. /[contracts](/lidofinance/gate-seals/tree/051593e74df01a4131c485b4fda52e691cd4b7d8/contracts)
/
# GateSeal.vy

Copy path Blame  Blame
## Latest commit

## History

[History](/lidofinance/gate-seals/commits/051593e74df01a4131c485b4fda52e691cd4b7d8/contracts/GateSeal.vy)232 lines (180 loc) · 8.46 KB 051593e
## Breadcrumbs

1. [gate-seals](/lidofinance/gate-seals/tree/051593e74df01a4131c485b4fda52e691cd4b7d8)
2. /[contracts](/lidofinance/gate-seals/tree/051593e74df01a4131c485b4fda52e691cd4b7d8/contracts)
/
# GateSeal.vy

Top
## File metadata and controls

* Code
* Blame

232 lines (180 loc) · 8.46 KB[Raw](https://github.com/lidofinance/gate-seals/raw/051593e74df01a4131c485b4fda52e691cd4b7d8/contracts/GateSeal.vy)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232# @version 0.3.7
"""@title GateSeal@author mymphe@notice A one-time panic button for pausable contracts@dev GateSeal is an one-time immediate emergency pause for pausable contracts. It must be operated by a multisig committee, though the code does not perform any such checks. Bypassing the DAO vote, GateSeal pauses  the contract(s) immediately for a set duration, e.g. one week, which gives the DAO the time to analyze the situation, decide on the course of action, hold a vote, implement fixes, etc. GateSeal can only be used once. GateSeal assumes that they have the permission to pause the contracts.
 GateSeals are only a temporary solution and will be deprecated in the future, as it is undesireable for the protocol to rely on a multisig. This is why each GateSeal has an expiry date. Once expired, GateSeal is no longer usable and a new GateSeal must be set up with a new multisig committee. This works as a kind of difficulty bomb, a device that encourages the protocol to get rid of GateSeals sooner rather than later.
 In the context of GateSeals, sealing is synonymous with pausing the contracts, sealables are pausable contracts that implement `pauseFor(duration)` interface."""
event Sealed: gate\_seal: address sealed\_by: address sealed\_for: uint256 sealable: address sealed\_at: uint256
interface IPausableUntil: def pauseFor(\_duration: uint256): nonpayable def isPaused() -> bool: view
SECONDS\_PER\_DAY: constant(uint256) = 60 \* 60 \* 24
# The minimum allowed seal duration is 4 days. This is because it takes at least# 3 days to pass and enact. Additionally, we want to include a 1-day padding.MIN\_SEAL\_DURATION\_DAYS: constant(uint256) = 4MIN\_SEAL\_DURATION\_SECONDS: constant(uint256) = SECONDS\_PER\_DAY \* MIN\_SEAL\_DURATION\_DAYS
# The maximum allowed seal duration is 14 days.# Anything higher than that may be too long of a disruption for the protocol.# Keep in mind, that the DAO still retains the ability to resume the contracts# (or, in the GateSeal terms, "break the seal") prematurely.MAX\_SEAL\_DURATION\_DAYS: constant(uint256) = 14MAX\_SEAL\_DURATION\_SECONDS: constant(uint256) = SECONDS\_PER\_DAY \* MAX\_SEAL\_DURATION\_DAYS
# The maximum number of sealables is 8.# GateSeals were originally designed to pause WithdrawalQueue and ValidatorExitBus,# however, there is a non-zero chance that there might be more in the future, which# is why we've opted to use a dynamic-size array.MAX\_SEALABLES: constant(uint256) = 8
# The maximum GateSeal expiry duration is 1 year.MAX\_EXPIRY\_PERIOD\_DAYS: constant(uint256) = 365MAX\_EXPIRY\_PERIOD\_SECONDS: constant(uint256) = SECONDS\_PER\_DAY \* MAX\_EXPIRY\_PERIOD\_DAYS
# To simplify the code, we chose not to implement committees in GateSeals.# Instead, GateSeals are operated by a single account which must be a multisig.# The code does not perform any such checks but we pinky-promise that# the sealing committee will always be a multisig. SEALING\_COMMITTEE: immutable(address)
# The duration of the seal in seconds. This period cannot exceed 14 days. # The DAO may decide to resume the contracts prematurely via the DAO voting process.SEAL\_DURATION\_SECONDS: immutable(uint256)
# The addresses of pausable contracts. The gate seal must have the permission to# pause these contracts at the time of the sealing.# Sealing can be partial, meaning the committee may decide to pause only a subset of this list,# though GateSeal will still expire immediately.sealables: DynArray[address, MAX\_SEALABLES]
# A unix epoch timestamp starting from which GateSeal is completely unusable# and a new GateSeal will have to be set up. This timestamp will be changed# upon sealing to expire GateSeal immediately which will revert any consecutive sealings.expiry\_timestamp: uint256
@externaldef \_\_init\_\_( \_sealing\_committee: address, \_seal\_duration\_seconds: uint256, \_sealables: DynArray[address, MAX\_SEALABLES], \_expiry\_timestamp: uint256): assert \_sealing\_committee != empty(address), "sealing committee: zero address" assert \_seal\_duration\_seconds >= MIN\_SEAL\_DURATION\_SECONDS, "seal duration: too short" assert \_seal\_duration\_seconds <= MAX\_SEAL\_DURATION\_SECONDS, "seal duration: exceeds max" assert len(\_sealables) > 0, "sealables: empty list" assert \_expiry\_timestamp > block.timestamp, "expiry timestamp: must be in the future" assert \_expiry\_timestamp <= block.timestamp + MAX\_EXPIRY\_PERIOD\_SECONDS, "expiry timestamp: exceeds max expiry period" for sealable in \_sealables: assert sealable != empty(address), "sealables: includes zero address" assert not self.has\_duplicates(\_sealables), "sealables: includes duplicates"
 SEALING\_COMMITTEE = \_sealing\_committee SEAL\_DURATION\_SECONDS = \_seal\_duration\_seconds self.sealables = \_sealables self.expiry\_timestamp = \_expiry\_timestamp
@external@viewdef get\_sealing\_committee() -> address: return SEALING\_COMMITTEE
@external@viewdef get\_seal\_duration\_seconds() -> uint256: return SEAL\_DURATION\_SECONDS
@external@viewdef get\_sealables() -> DynArray[address, MAX\_SEALABLES]: return self.sealables
@external@viewdef get\_expiry\_timestamp() -> uint256: return self.expiry\_timestamp
@external@viewdef is\_expired() -> bool: return self.\_is\_expired()
@externaldef seal(\_sealables: DynArray[address, MAX\_SEALABLES]): """ @notice Seal the contract(s). @dev Immediately expires GateSeal and, thus, can only be called once. @param \_sealables a proper/improper subset of sealables. """ assert msg.sender == SEALING\_COMMITTEE, "sender: not SEALING\_COMMITTEE" assert not self.\_is\_expired(), "gate seal: expired" assert len(\_sealables) > 0, "sealables: empty subset" assert not self.has\_duplicates(\_sealables), "sealables: includes duplicates"
 self.\_expire\_immediately()
 # Instead of reverting the transaction as soon as one of the sealables fails, # we iterate through the entire list and collect the indexes of those that failed # and report them in the dynamically-generated error message. # This will make it easier for us to debug in a hectic situation. failed\_indexes: DynArray[uint256, MAX\_SEALABLES] = [] sealable\_index: uint256 = 0
 for sealable in \_sealables: assert sealable in self.sealables, "sealables: includes a non-sealable"
 success: bool = False
 # using `raw\_call` to catch external revert and continue execution success = raw\_call( sealable, \_abi\_encode(SEAL\_DURATION\_SECONDS, method\_id=method\_id("pauseFor(uint256)")), revert\_on\_failure=False )  if success and IPausableUntil(sealable).isPaused(): log Sealed(self, SEALING\_COMMITTEE, SEAL\_DURATION\_SECONDS, sealable, block.timestamp) else: failed\_indexes.append(sealable\_index)  sealable\_index += 1
 assert len(failed\_indexes) == 0, self.to\_error\_string(failed\_indexes)
@internal@viewdef \_is\_expired() -> bool: return block.timestamp >= self.expiry\_timestamp
@internaldef \_expire\_immediately(): self.expiry\_timestamp = block.timestamp
@internal@puredef has\_duplicates(\_sealables: DynArray[address, MAX\_SEALABLES]) -> bool: """ @notice checks the list for duplicates  @param \_sealables list of addresses to check """ unique: DynArray[address, MAX\_SEALABLES] = []
 for sealable in \_sealables: if sealable in unique: return True unique.append(sealable)
 return False
@internal@puredef to\_error\_string(\_failed\_indexes: DynArray[uint256, MAX\_SEALABLES]) -> String[78]: """ @notice converts a list of indexes into an error message to faciliate debugging @dev The indexes in the error message are given in the descending order to avoid losing leading zeros when casting to string,
 e.g. [0, 2, 3, 6] -> "6320" @param \_failed\_indexes a list of sealable indexes that failed to seal  """ indexes\_as\_decimal: uint256 = 0 loop\_index: uint256 = 0
 # convert failed indexes to a decimal representation for failed\_index in \_failed\_indexes: indexes\_as\_decimal += failed\_index \* 10 \*\* loop\_index loop\_index += 1
 # generate error message with indexes as a decimal string # return type of `uint2str` is String[78] because 2^256 has 78 digits error\_message: String[78] = uint2str(indexes\_as\_decimal)
 # assert that there are no failed indexes, else revert with error message return error\_message

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from docs.vyperlang.org_486f4573_20250114_185323.html ===

 [Vyper
![Logo](_static/vyper-logo-transparent.svg)](toctree.html)
v0.3.7

* [Overview](index.html)

Getting Started

* [Installing Vyper](installing-vyper.html)
* [Vyper by Example](vyper-by-example.html)

Language Description

* [Structure of a Contract](structure-of-a-contract.html)
* [Types](types.html)
* [Environment Variables and Constants](constants-and-vars.html)
* [Statements](statements.html)
* [Control Structures](control-structures.html)
* [Scoping and Declarations](scoping-and-declarations.html)
* Built-in Functions
  + [Bitwise Operations](#bitwise-operations)
  + [Chain Interaction](#chain-interaction)
  + [Cryptography](#cryptography)
  + [Data Manipulation](#data-manipulation)
  + [Math](#math)
  + [Utilities](#utilities)
* [Interfaces](interfaces.html)
* [Event Logging](event-logging.html)
* [NatSpec Metadata](natspec.html)

Using the Compiler

* [Compiling a Contract](compiling-a-contract.html)
* [Compiler Exceptions](compiler-exceptions.html)
* [Deploying a Contract](deploying-contracts.html)
* [Testing a Contract](testing-contracts.html)

Additional Resources

* [Release Notes](release-notes.html)
* [Contributing](contributing.html)
* [Style Guide](style-guide.html)
* [Vyper Versioning Guideline](versioning.html)

[Vyper](toctree.html)

* »
* Built-in Functions
* [Edit on GitHub](https://github.com/vyperlang/vyper/blob/v0.3.7/docs/built-in-functions.rst)

---

# Built-in Functions[Â¶](#built-in-functions "Permalink to this headline")

Vyper provides a collection of built-in functions available in the global namespace of all contracts.

## Bitwise Operations[Â¶](#bitwise-operations "Permalink to this headline")

bitwise\_and(*x: uint256*, *y: uint256*) → uint256[Â¶](#bitwise_and "Permalink to this definition")

Perform a âbitwise andâ operation. Each bit of the output is 1 if the corresponding bit of `x` AND of `y` is 1, otherwise it is 0.

```
@external
@view
def foo(x: uint256, y: uint256) -> uint256:
    return bitwise_and(x, y)

```

```
>>> ExampleContract.foo(31337, 8008135)
12353

```

Note

This function has been deprecated from version 0.3.4 onwards. Please use the `&` operator instead.

bitwise\_not(*x: uint256*) → uint256[Â¶](#bitwise_not "Permalink to this definition")

Return the bitwise complement of `x` - the number you get by switching each 1 for a 0 and each 0 for a 1.

```
@external
@view
def foo(x: uint256) -> uint256:
    return bitwise_not(x)

```

```
>>> ExampleContract.foo(0)
115792089237316195423570985008687907853269984665640564039457584007913129639935

```

Note

This function has been deprecated from version 0.3.4 onwards. Please use the `~` operator instead.

bitwise\_or(*x: uint256*, *y: uint256*) → uint256[Â¶](#bitwise_or "Permalink to this definition")

Perform a âbitwise orâ operation. Each bit of the output is 0 if the corresponding bit of `x` AND of `y` is 0, otherwise it is 1.

```
@external
@view
def foo(x: uint256, y: uint256) -> uint256:
    return bitwise_or(x, y)

```

```
>>> ExampleContract.foo(31337, 8008135)
8027119

```

Note

This function has been deprecated from version 0.3.4 onwards. Please use the `|` operator instead.

bitwise\_xor(*x: uint256*, *y: uint256*) → uint256[Â¶](#bitwise_xor "Permalink to this definition")

Perform a âbitwise exclusive orâ operation. Each bit of the output is the same as the corresponding bit in `x` if that bit in `y` is 0, and it is the complement of the bit in `x` if that bit in `y` is 1.

```
@external
@view
def foo(x: uint256, y: uint256) -> uint256:
    return bitwise_xor(x, y)

```

```
>>> ExampleContract.foo(31337, 8008135)
8014766

```

Note

This function has been deprecated from version 0.3.4 onwards. Please use the `^` operator instead.

shift(*x: uint256*, *\_shift: int128*) → uint256[Â¶](#shift "Permalink to this definition")

Return `x` with the bits shifted `_shift` places. A positive `_shift` value equals a left shift, a negative value is a right shift.

```
@external
@view
def foo(x: uint256, y: int128) -> uint256:
    return shift(x, y)

```

```
>>> ExampleContract.foo(2, 8)
512

```

## Chain Interaction[Â¶](#chain-interaction "Permalink to this headline")

Vyper has three built-ins for contract creation; all three contract creation built-ins rely on the code to deploy already being stored on-chain, but differ in call vs deploy overhead, and whether or not they invoke the constructor of the contract to be deployed. The following list provides a short summary of the differences between them.

* `create_minimal_proxy_to(target: address, ...)`
  + Creates an immutable proxy to `target`
  + Expensive to call (incurs a single `DELEGATECALL` overhead on every invocation), cheap to create (since it only deploys `EIP-1167` forwarder bytecode)
  + Does not have the ability to call a constructor
  + Does **not** check that there is code at `target` (allows one to deploy proxies counterfactually)
* `create_copy_of(target: address, ...)`
  + Creates a byte-for-byte copy of runtime code stored at `target`
  + Cheap to call (no `DELEGATECALL` overhead), expensive to create (200 gas per deployed byte)
  + Does not have the ability to call a constructor
  + Performs an `EXTCODESIZE` check to check there is code at `target`
* `create_from_blueprint(target: address, ...)`
  + Deploys a contract using the initcode stored at `target`
  + Cheap to call (no `DELEGATECALL` overhead), expensive to create (200 gas per deployed byte)
  + Invokes constructor, requires a special âblueprintâ contract to be deployed
  + Performs an `EXTCODESIZE` check to check there is code at `target`

create\_minimal\_proxy\_to(*target: address*, *value: uint256 = 0*[, *salt: bytes32*]) → address[Â¶](#create_minimal_proxy_to "Permalink to this definition")

Deploys a small, EIP1167-compliant âminimal proxy contractâ that duplicates the logic of the contract at `target`, but has its own state since every call to `target` is made using `DELEGATECALL` to `target`. To the end user, this should be indistinguishable from an independently deployed contract with the same code as `target`.

* `target`: Address of the contract to proxy to
* `value`: The wei value to send to the new contract address (Optional, default 0)
* `salt`: A `bytes32` value utilized by the deterministic `CREATE2` opcode (Optional, if not supplied, `CREATE` is used)

Returns the address of the newly created proxy contract. If the create operation fails (for instance, in the case of a `CREATE2` collision), execution will revert.

```
@external
def foo(target: address) -> address:
    return create_minimal_proxy_to(target)

```

Note

It is very important that the deployed contract at `target` is code you know and trust, and does not implement the `selfdestruct` opcode or have upgradeable code as this will affect the operation of the proxy contract.

Note

There is no runtime check that there is code already deployed at `target` (since a proxy may be deployed counterfactually). Most applications may want to insert this check.

Note

Before version 0.3.4, this function was named `create_forwarder_to`.

create\_copy\_of(*target: address*, *value: uint256 = 0*[, *salt: bytes32*]) → address[Â¶](#create_copy_of "Permalink to this definition")

Create a physical copy of the runtime code at `target`. The code at `target` is byte-for-byte copied into a newly deployed contract.

* `target`: Address of the contract to copy
* `value`: The wei value to send to the new contract address (Optional, default 0)
* `salt`: A `bytes32` value utilized by the deterministic `CREATE2` opcode (Optional, if not supplied, `CREATE` is used)

Returns the address of the created contract. If the create operation fails (for instance, in the case of a `CREATE2` collision), execution will revert. If there is no code at `target`, execution will revert.

```
@external
def foo(target: address) -> address:
    return create_copy_of(target)

```

Note

The implementation of `create_copy_of` assumes that the code at `target` is smaller than 16MB. While this is much larger than the EIP-170 constraint of 24KB, it is a conservative size limit intended to future-proof deployer contracts in case the EIP-170 constraint is lifted. If the code at `target` is larger than 16MB, the behavior of `create_copy_of` is undefined.

create\_from\_blueprint(*target: address*, *\*args*, *value: uint256 = 0*, *code\_offset=0*[, *salt: bytes32*]) → address[Â¶](#create_from_blueprint "Permalink to this definition")

Copy the code of `target` into memory and execute it as initcode. In other words, this operation interprets the code at `target` not as regular runtime code, but directly as initcode. The `*args` are interpreted as constructor arguments, and are ABI-encoded and included when executing the initcode.

* `target`: Address of the blueprint to invoke
* `*args`: Constructor arguments to forward to the initcode.
* `value`: The wei value to send to the new contract address (Optional, default 0)
* `code_offset`: The offset to start the `EXTCODECOPY` from (Optional, default 0)
* `salt`: A `bytes32` value utilized by the deterministic `CREATE2` opcode (Optional, if not supplied, `CREATE` is used)

Returns the address of the created contract. If the create operation fails (for instance, in the case of a `CREATE2` collision), execution will revert. If `code_offset >= target.codesize` (ex. if there is no code at `target`), execution will revert.

```
@external
def foo(blueprint: address) -> address:
    arg1: uint256 = 18
    arg2: String = "some string"
    return create_from_blueprint(blueprint, arg1, arg2, code_offset=1)

```

Note

To properly deploy a blueprint contract, special deploy bytecode must be used. Deploying blueprint contracts is generally out of scope of this article, but the following preamble, prepended to regular deploy bytecode (output of `vyper -f bytecode`), should deploy the blueprint in an ordinary contract creation transaction: `deploy_preamble = "61" + <bytecode len in 4 hex characters> + "3d81600a3d39f3"`. To see an example of this, please see [the setup code for testing create\_from\_blueprint](https://github.com/vyperlang/vyper/blob/2adc34ffd3bee8b6dee90f552bbd9bb844509e19/tests/base_conftest.py#L130-L160).

Warning

It is recommended to deploy blueprints with the ERC5202 preamble `0xfe7100` to guard them from being called as regular contracts. This is particularly important for factories where the constructor has side effects (including `SELFDESTRUCT`!), as those could get executed by *anybody* calling the blueprint contract directly. The `code_offset=` kwarg is provided to enable this pattern:

```
@external
def foo(blueprint: address) -> address:
    # `blueprint` is a blueprint contract with some known preamble b"abcd..."
    return create_from_blueprint(blueprint, code_offset=<preamble length>)

```

raw\_call(*to: address*, *data: Bytes*, *max\_outsize: [int](https://docs.python.org/3.8/library/functions.html#int "(in Python v3.8)") = 0*, *gas: uint256 = gasLeft*, *value: uint256 = 0*, *is\_delegate\_call: [bool](https://docs.python.org/3.8/library/functions.html#bool "(in Python v3.8)") = False*, *is\_static\_call: [bool](https://docs.python.org/3.8/library/functions.html#bool "(in Python v3.8)") = False*, *revert\_on\_failure: [bool](https://docs.python.org/3.8/library/functions.html#bool "(in Python v3.8)") = True*) → Bytes[max\_outsize][Â¶](#raw_call "Permalink to this definition")

Call to the specified Ethereum address.

* `to`: Destination address to call to
* `data`: Data to send to the destination address
* `max_outsize`: Maximum length of the bytes array returned from the call. If the returned call data exceeds this length, only this number of bytes is returned.
* `gas`: The amount of gas to attach to the call. If not set, all remaining gas is forwarded.
* `value`: The wei value to send to the address (Optional, default `0`)
* `is_delegate_call`: If `True`, the call will be sent as `DELEGATECALL` (Optional, default `False`)
* `is_static_call`: If `True`, the call will be sent as `STATICCALL` (Optional, default `False`)
* `revert_on_failure`: If `True`, the call will revert on a failure, otherwise `success` will be returned (Optional, default `True`)

Note

Returns the data returned by the call as a `Bytes` list, with `max_outsize` as the max length. The actual size of the returned data may be less than `max_outsize`. You can use `len` to obtain the actual size.

Returns nothing if `max_outsize` is omitted or set to `0`.

Returns `success` in a tuple with return value if `revert_on_failure` is set to `False`.

```
@external
@payable
def foo(_target: address) -> Bytes[32]:
    response: Bytes[32] = raw_call(_target, method_id("someMethodName()"), max_outsize=32, value=msg.value)
    return response

@external
@payable
def bar(_target: address) -> Bytes[32]:
    success: bool = False
    response: Bytes[32] = b""
    x: uint256 = 123
    success, response = raw_call(
        _target,
        _abi_encode(x, method_id=method_id("someMethodName(uint256)")),
        max_outsize=32,
        value=msg.value,
        revert_on_failure=False
        )
    assert success
    return response

```

raw\_log(*topics: bytes32[4]*, *data: Union[Bytes, bytes32]*) → [None](https://docs.python.org/3.8/library/constants.html#None "(in Python v3.8)")[Â¶](#raw_log "Permalink to this definition")

Provides low level access to the `LOG` opcodes, emitting a log without having to specify an ABI type.

* `topics`: List of `bytes32` log topics. The length of this array determines which opcode is used.
* `data`: Unindexed event data to include in the log. May be given as `Bytes` or `bytes32`.

```
@external
def foo(_topic: bytes32, _data: Bytes[100]):
    raw_log([_topic], _data)

```

selfdestruct(*to: address*) → [None](https://docs.python.org/3.8/library/constants.html#None "(in Python v3.8)")[Â¶](#selfdestruct "Permalink to this definition")

Trigger the `SELFDESTRUCT` opcode (`0xFF`), causing the contract to be destroyed.

* `to`: Address to forward the contractâs ether balance to

Warning

This method delete the contract from the blockchain. All non-ether assets associated with this contract are âburnedâ and the contract is no longer accessible.

```
@external
def do_the_needful():
    selfdestruct(msg.sender)

```

send(*to: address*, *value: uint256*) → [None](https://docs.python.org/3.8/library/constants.html#None "(in Python v3.8)")[Â¶](#send "Permalink to this definition")

Send ether from the contract to the specified Ethereum address.

* `to`: The destination address to send ether to
* `value`: The wei value to send to the address

Note

The amount to send is always specified in `wei`.

```
@external
def foo(_receiver: address, _amount: uint256):
    send(_receiver, _amount)

```

## Cryptography[Â¶](#cryptography "Permalink to this headline")

ecadd(*a: uint256[2]*, *b: uint256[2]*) → uint256[2][Â¶](#ecadd "Permalink to this definition")

Take two points on the Alt-BN128 curve and add them together.

```
@external
@view
def foo(x: uint256[2], y: uint256[2]) -> uint256[2]:
    return ecadd(x, y)

```

```
>>> ExampleContract.foo([1, 2], [1, 2])
[
    1368015179489954701390400359078579693043519447331113978918064868415326638035,
    9918110051302171585080402603319702774565515993150576347155970296011118125764,
]

```

ecmul(*point: uint256[2]*, *scalar: uint256*) → uint256[2][Â¶](#ecmul "Permalink to this definition")

Take a point on the Alt-BN128 curve (`p`) and a scalar value (`s`), and return the result of adding the point to itself `s` times, i.e. `p * s`.

* `point`: Point to be multiplied
* `scalar`: Scalar value

```
@external
@view
def foo(point: uint256[2], scalar: uint256) -> uint256[2]:
    return ecmul(point, scalar)

```

```
>>> ExampleContract.foo([1, 2], 3)
[
    3353031288059533942658390886683067124040920775575537747144343083137631628272,
    19321533766552368860946552437480515441416830039777911637913418824951667761761,
]

```

ecrecover(*hash: bytes32*, *v: uint256 | uint8*, *r: uint256 | bytes32*, *s: uint256 | bytes32*) → address[Â¶](#ecrecover "Permalink to this definition")

Recover the address associated with the public key from the given elliptic curve signature.

* `r`: first 32 bytes of signature
* `s`: second 32 bytes of signature
* `v`: final 1 byte of signature

Returns the associated address, or `0` on error.

```
@external
@view
def foo(hash: bytes32, v: uint8, r:bytes32, s:bytes32) -> address:
    return ecrecover(hash, v, r, s)

@external
@view
def foo(hash: bytes32, v: uint256, r:uint256, s:uint256) -> address:
    return ecrecover(hash, v, r, s)

```

```
>>> ExampleContract.foo('0x6c9c5e133b8aafb2ea74f524a5263495e7ae5701c7248805f7b511d973dc7055',
     28,
     78616903610408968922803823221221116251138855211764625814919875002740131251724,
     37668412420813231458864536126575229553064045345107737433087067088194345044408
    )
'0x9eE53ad38Bb67d745223a4257D7d48cE973FeB7A'

```

keccak256(*\_value*) → bytes32[Â¶](#keccak256 "Permalink to this definition")

Return a `keccak256` hash of the given value.

* `_value`: Value to hash. Can be a literal string, `Bytes`, or `bytes32`.

```
@external
@view
def foo(_value: Bytes[100]) -> bytes32
    return keccak256(_value)

```

```
>>> ExampleContract.foo(b"potato")
0x9e159dfcfe557cc1ca6c716e87af98fdcb94cd8c832386d0429b2b7bec02754f

```

sha256(*\_value*) → bytes32[Â¶](#sha256 "Permalink to this definition")

Return a `sha256` (SHA2 256-bit output) hash of the given value.

* `_value`: Value to hash. Can be a literal string, `Bytes`, or `bytes32`.

```
@external
@view
def foo(_value: Bytes[100]) -> bytes32
    return sha256(_value)

```

```
>>> ExampleContract.foo(b"potato")
0xe91c254ad58860a02c788dfb5c1a65d6a8846ab1dc649631c7db16fef4af2dec

```

## Data Manipulation[Â¶](#data-manipulation "Permalink to this headline")

concat(*a*, *b*, *\*args*) → Union[Bytes, String][Â¶](#concat "Permalink to this definition")

Take 2 or more bytes arrays of type `bytes32`, `Bytes` or `String` and combine them into a single value.

If the input arguments are `String` the return type is `String`. Otherwise the return type is `Bytes`.

```
@external
@view
def foo(a: String[5], b: String[5], c: String[5]) -> String[100]:
    return concat(a, " ", b, " ", c, "!")

```

```
>>> ExampleContract.foo("why","hello","there")
"why hello there!"

```

convert(*value*, *type\_*) → Any[Â¶](#convert "Permalink to this definition")

Converts a variable or literal from one type to another.

* `value`: Value to convert
* `type_`: The destination type to convert to (e.g., `bool`, `decimal`, `int128`, `uint256` or `bytes32`)

Returns a value of the type specified by `type_`.

For more details on available type conversions, see [Type Conversions](types.html#type-conversions).

uint2str(*value: unsigned integer*) → String[Â¶](#uint2str "Permalink to this definition")

Returns an unsigned integerâs string representation.

* `value`: Unsigned integer to convert.

Returns the string representation of `value`.

```
@external
@view
def foo(b: uint256) -> String[78]:
    return uint2str(b)

```

```
>>> ExampleContract.foo(420)
"420"

```

extract32(*b: Bytes*, *start: uint256*, *output\_type=bytes32*) → Any[Â¶](#extract32 "Permalink to this definition")

Extract a value from a `Bytes` list.

* `b`: `Bytes` list to extract from
* `start`: Start point to extract from
* `output_type`: Type of output (`bytes32`, `integer`, or `address`). Defaults to `bytes32`.

Returns a value of the type specified by `output_type`.

```
@external
@view
def foo(b: Bytes[32]) -> address:
    return extract32(b, 0, output_type=address)

```

```
>>> ExampleContract.foo("0x0000000000000000000000009f8F72aA9304c8B593d555F12eF6589cC3A579A2")
"0x9f8F72aA9304c8B593d555F12eF6589cC3A579A2"

```

slice(*b: Union[Bytes, bytes32, String]*, *start: uint256*, *length: uint256*) → Union[Bytes, String][Â¶](#slice "Permalink to this definition")

Copy a list of bytes and return a specified slice.

* `b`: value being sliced
* `start`: start position of the slice
* `length`: length of the slice, must be constant. Immutables and variables are not supported.

If the value being sliced is a `Bytes` or `bytes32`, the return type is `Bytes`. If it is a `String`, the return type is `String`.

```
@external
@view
def foo(s: String[32]) -> String[5]:
    return slice(s, 4, 5)

```

```
>>> ExampleContract.foo("why hello! how are you?")
"hello"

```

## Math[Â¶](#math "Permalink to this headline")

abs(*value: int256*) → int256[Â¶](#abs "Permalink to this definition")

Return the absolute value of a signed integer.

* `value`: Integer to return the absolute value of

```
@external
@view
def foo(value: int256) -> int256:
    return abs(value)

```

```
>>> ExampleContract.foo(-31337)
31337

```

ceil(*value: decimal*) → int256[Â¶](#ceil "Permalink to this definition")

Round a decimal up to the nearest integer.

* `value`: Decimal value to round up

```
@external
@view
def foo(x: decimal) -> int256:
    return ceil(x)

```

```
>>> ExampleContract.foo(3.1337)
4

```

floor(*value: decimal*) → int256[Â¶](#floor "Permalink to this definition")

Round a decimal down to the nearest integer.

* `value`: Decimal value to round down

```
@external
@view
def foo(x: decimal) -> int256:
    return floor(x)

```

```
>>> ExampleContract.foo(3.1337)
3

```

max(*a: numeric*, *b: numeric*) → numeric[Â¶](#max "Permalink to this definition")

Return the greater value of `a` and `b`. The input values may be any numeric type as long as they are both of the same type. The output value is of the same type as the input values.

```
@external
@view
def foo(a: uint256, b: uint256) -> uint256:
    return max(a, b)

```

```
>>> ExampleContract.foo(23, 42)
42

```

max\_value(*type\_*) → numeric[Â¶](#max_value "Permalink to this definition")

Returns the maximum value of the numeric type specified by `type_` (e.g., `int128`, `uint256`, `decimal`).

```
@external
@view
def foo() -> int256:
    return max_value(int256)

```

```
>>> ExampleContract.foo()
57896044618658097711785492504343953926634992332820282019728792003956564819967

```

min(*a: numeric*, *b: numeric*) → numeric[Â¶](#min "Permalink to this definition")

Returns the lesser value of `a` and `b`. The input values may be any numeric type as long as they are both of the same type. The output value is of the same type as the input values.

```
@external
@view
def foo(a: uint256, b: uint256) -> uint256:
    return min(a, b)

```

```
>>> ExampleContract.foo(23, 42)
23

```

min\_value(*type\_*) → numeric[Â¶](#min_value "Permalink to this definition")

Returns the minimum value of the numeric type specified by `type_` (e.g., `int128`, `uint256`, `decimal`).

```
@external
@view
def foo() -> int256:
    return min_value(int256)

```

```
>>> ExampleContract.foo()
-57896044618658097711785492504343953926634992332820282019728792003956564819968

```

pow\_mod256(*a: uint256*, *b: uint256*) → uint256[Â¶](#pow_mod256 "Permalink to this definition")

Return the result of `a ** b % (2 ** 256)`.

This method is used to perform exponentiation without overflow checks.

```
@external
@view
def foo(a: uint256, b: uint256) -> uint256:
    return pow_mod256(a, b)

```

```
>>> ExampleContract.foo(2, 3)
8
>>> ExampleContract.foo(100, 100)
59041770658110225754900818312084884949620587934026984283048776718299468660736

```

sqrt(*d: decimal*) → decimal[Â¶](#sqrt "Permalink to this definition")

Return the square root of the provided decimal number, using the Babylonian square root algorithm.

```
@external
@view
def foo(d: decimal) -> decimal:
    return sqrt(d)

```

```
>>> ExampleContract.foo(9.0)
3.0

```

isqrt(*x: uint256*) → uint256[Â¶](#isqrt "Permalink to this definition")

Return the (integer) square root of the provided integer number, using the Babylonian square root algorithm. The rounding mode is to round down to the nearest integer. For instance, `isqrt(101) == 10`.

```
@external
@view
def foo(x: uint256) -> uint256:
    return isqrt(x)

```

```
>>> ExampleContract.foo(101)
10

```

uint256\_addmod(*a: uint256*, *b: uint256*, *c: uint256*) → uint256[Â¶](#uint256_addmod "Permalink to this definition")

Return the modulo of `(a + b) % c`. Reverts if `c == 0`.

```
@external
@view
def foo(a: uint256, b: uint256, c: uint256) -> uint256:
    return uint256_addmod(a, b, c)

```

```
>>> (6 + 13) % 8
3
>>> ExampleContract.foo(6, 13, 8)
3

```

uint256\_mulmod(*a: uint256*, *b: uint256*, *c: uint256*) → uint256[Â¶](#uint256_mulmod "Permalink to this definition")

Return the modulo from `(a * b) % c`. Reverts if `c == 0`.

```
@external
@view
def foo(a: uint256, b: uint256, c: uint256) -> uint256:
    return uint256_mulmod(a, b, c)

```

```
>>> (11 * 2) % 5
2
>>> ExampleContract.foo(11, 2, 5)
2

```

unsafe\_add(*x: integer*, *y: integer*) → integer[Â¶](#unsafe_add "Permalink to this definition")

Add `x` and `y`, without checking for overflow. `x` and `y` must both be integers of the same type. If the result exceeds the bounds of the input type, it will be wrapped.

```
@external
@view
def foo(x: uint8, y: uint8) -> uint8:
    return unsafe_add(x, y)

@external
@view
def bar(x: int8, y: int8) -> int8:
    return unsafe_add(x, y)

```

```
>>> ExampleContract.foo(1, 1)
2

>>> ExampleContract.foo(255, 255)
254

>>> ExampleContract.bar(127, 127)
-2

```

Note

Performance note: for the native word types of the EVM `uint256` and `int256`, this will compile to a single `ADD` instruction, since the EVM natively wraps addition on 256-bit words.

unsafe\_sub(*x: integer*, *y: integer*) → integer[Â¶](#unsafe_sub "Permalink to this definition")

Subtract `x` and `y`, without checking for overflow. `x` and `y` must both be integers of the same type. If the result underflows the bounds of the input type, it will be wrapped.

```
@external
@view
def foo(x: uint8, y: uint8) -> uint8:
    return unsafe_sub(x, y)

@external
@view
def bar(x: int8, y: int8) -> int8:
    return unsafe_sub(x, y)

```

```
>>> ExampleContract.foo(4, 3)
1

>>> ExampleContract.foo(0, 1)
255

>>> ExampleContract.bar(-128, 1)
127

```

Note

Performance note: for the native word types of the EVM `uint256` and `int256`, this will compile to a single `SUB` instruction, since the EVM natively wraps subtraction on 256-bit words.

unsafe\_mul(*x: integer*, *y: integer*) → integer[Â¶](#unsafe_mul "Permalink to this definition")

Multiply `x` and `y`, without checking for overflow. `x` and `y` must both be integers of the same type. If the result exceeds the bounds of the input type, it will be wrapped.

```
@external
@view
def foo(x: uint8, y: uint8) -> uint8:
    return unsafe_mul(x, y)

@external
@view
def bar(x: int8, y: int8) -> int8:
    return unsafe_mul(x, y)

```

```
>>> ExampleContract.foo(1, 1)
1

>>> ExampleContract.foo(255, 255)
1

>>> ExampleContract.bar(-128, -128)
0

>>> ExampleContract.bar(127, -128)
-128

```

Note

Performance note: for the native word types of the EVM `uint256` and `int256`, this will compile to a single `MUL` instruction, since the EVM natively wraps multiplication on 256-bit words.

unsafe\_div(*x: integer*, *y: integer*) → integer[Â¶](#unsafe_div "Permalink to this definition")

Divide `x` and `y`, without checking for division-by-zero. `x` and `y` must both be integers of the same type. If the denominator is zero, the result will (following EVM semantics) be zero.

```
@external
@view
def foo(x: uint8, y: uint8) -> uint8:
    return unsafe_div(x, y)

@external
@view
def bar(x: int8, y: int8) -> int8:
    return unsafe_div(x, y)

```

```
>>> ExampleContract.foo(1, 1)
1

>>> ExampleContract.foo(1, 0)
0

>>> ExampleContract.bar(-128, -1)
-128

```

Note

Performance note: this will compile to a single `SDIV` or `DIV` instruction, depending on if the inputs are signed or unsigned (respectively).

## Utilities[Â¶](#utilities "Permalink to this headline")

as\_wei\_value(*\_value*, *unit: [str](https://docs.python.org/3.8/library/stdtypes.html#str "(in Python v3.8)")*) → uint256[Â¶](#as_wei_value "Permalink to this definition")

Take an amount of ether currency specified by a number and a unit and return the integer quantity of wei equivalent to that amount.

* `_value`: Value for the ether unit. Any numeric type may be used, however the value cannot be negative.
* `unit`: Ether unit name (e.g. `"wei"`, `"ether"`, `"gwei"`, etc.) indicating the denomination of `_value`. Must be given as a literal string.

```
@external
@view
def foo(s: String[32]) -> uint256:
    return as_wei_value(1.337, "ether")

```

```
>>> ExampleContract.foo(1)
1337000000000000000

```

blockhash(*block\_num: uint256*) → bytes32[Â¶](#blockhash "Permalink to this definition")

Return the hash of the block at the specified height.

Note

The EVM only provides access to the most recent 256 blocks. This function returns `EMPTY_BYTES32` if the block number is greater than or equal to the current block number or more than 256 blocks behind the current block.

```
@external
@view
def foo() -> bytes32:
    return blockhash(block.number - 16)

```

```
>>> ExampleContract.foo()
0xf3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855

```

empty(*typename*) → Any[Â¶](#empty "Permalink to this definition")

Return a value which is the default (zero-ed) value of its type. Useful for initializing new memory variables.

* `typename`: Name of the type

```
@external
@view
def foo():
    x: uint256[2][5] = empty(uint256[2][5])

```

len(*b: Union[Bytes, String]*) → uint256[Â¶](#len "Permalink to this definition")

Return the length of a given `Bytes` or `String`.

```
@external
@view
def foo(s: String[32]) -> uint256:
    return len(s)

```

```
>>> ExampleContract.foo("hello")
5

```

method\_id(*method*, *output\_type: [type](https://docs.python.org/3.8/library/functions.html#type "(in Python v3.8)") = Bytes[4]*) → Union[Bytes[4], bytes4][Â¶](#method_id "Permalink to this definition")

Takes a function declaration and returns its method\_id (used in data field to call it).

* `method`: Method declaration as given as a literal string
* `output_type`: The type of output (`Bytes[4]` or `bytes4`). Defaults to `Bytes[4]`.

Returns a value of the type specified by `output_type`.

```
@external
@view
def foo() -> Bytes[4]:
    return method_id('transfer(address,uint256)', output_type=Bytes[4])

```

```
>>> ExampleContract.foo()
0xa9059cbb

```

\_abi\_encode(*\*args*, *ensure\_tuple: [bool](https://docs.python.org/3.8/library/functions.html#bool "(in Python v3.8)") = True*) → Bytes[<depends on input>][Â¶](#abi_encode "Permalink to this definition")

Takes a variable number of args as input, and returns the ABIv2-encoded bytestring. Used for packing arguments to raw\_call, EIP712 and other cases where a consistent and efficient serialization method is needed.
Once this function has seen more use we provisionally plan to put it into the `ethereum.abi` namespace.

* `*args`: Arbitrary arguments
* `ensure_tuple`: If set to True, ensures that even a single argument is encoded as a tuple. In other words, `bytes` gets encoded as `(bytes,)`, and `(bytes,)` gets encoded as `((bytes,),)` This is the calling convention for Vyper and Solidity functions. Except for very specific use cases, this should be set to True. Must be a literal.
* `method_id`: A literal hex or Bytes[4] value to append to the beginning of the abi-encoded bytestring.

Returns a bytestring whose max length is determined by the arguments. For example, encoding a `Bytes[32]` results in a `Bytes[64]` (first word is the length of the bytestring variable).

```
@external
@view
def foo() -> Bytes[132]:
    x: uint256 = 1
    y: Bytes[32] = b"234"
    return _abi_encode(x, y, method_id=method_id("foo()"))

```

```
>>> ExampleContract.foo().hex()
"c2985578"
"0000000000000000000000000000000000000000000000000000000000000001"
"0000000000000000000000000000000000000000000000000000000000000040"
"0000000000000000000000000000000000000000000000000000000000000003"
"3233340000000000000000000000000000000000000000000000000000000000"

```

\_abi\_decode(*b: Bytes*, *output\_type: type\_*, *unwrap\_tuple: [bool](https://docs.python.org/3.8/library/functions.html#bool "(in Python v3.8)") = True*) → Any[Â¶](#abi_decode "Permalink to this definition")

Takes a byte array as input, and returns the decoded values according to the specified output types. Used for unpacking ABIv2-encoded values.
Once this function has seen more use we provisionally plan to put it into the `ethereum.abi` namespace.

* `b`: A byte array of a length that is between the minimum and maximum ABIv2 size bounds of the `output type`.
* `output_type`: Name of the output type, or tuple of output types, to be decoded.
* `unwrap_tuple`: If set to True, the input is decoded as a tuple even if only one output type is specified. In other words, `_abi_decode(b, Bytes[32])` gets decoded as `(Bytes[32],)`. This is the convention for ABIv2-encoded values generated by Vyper and Solidity functions. Except for very specific use cases, this should be set to True. Must be a literal.

Returns the decoded value(s), with type as specified by output\_type.

```
@external
@view
def foo(someInput: Bytes[128]) -> (uint256, Bytes[32]):
    x: uint256 = empty(uint256)
    y: Bytes[32] = empty(Bytes[32])
    x, y =  _abi_decode(someInput, (uint256, Bytes[32]))
    return x, y

```

print(*\*args*, *hardhat\_compat=False*) → [None](https://docs.python.org/3.8/library/constants.html#None "(in Python v3.8)")[Â¶](#print "Permalink to this definition")

âprintsâ the arguments by issuing a static call to the âconsoleâ address, `0x000000000000000000636F6E736F6C652E6C6F67`. This is supported by some smart contract development frameworks.

The default mode works natively with titanoboa. For hardhat-style frameworks, use `hardhat_compat=True)`.

Note

Issuing of the static call is *NOT* mode-dependent (that is, it is not removed from production code), although the compiler will issue a warning whenever `print` is used.

[Next](interfaces.html "Interfaces")
 [Previous](scoping-and-declarations.html "Scoping and Declarations")

---

© Copyright 2017-2020 CC-BY-4.0 Vyper Team.
Revision `6020b8bb`.

Built with [Sphinx](https://www.sphinx-doc.org/) using a
[theme](https://github.com/readthedocs/sphinx_rtd_theme)
provided by [Read the Docs](https://readthedocs.org).



=== Content from github.com_69ce569d_20250114_185327.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flidofinance%2Fgate-seals%2Fpull%2F5%2Ffiles)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flidofinance%2Fgate-seals%2Fpull%2F5%2Ffiles)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fpull_requests%2Fshow%2Ffiles&source=header-repo&source_repo=lidofinance%2Fgate-seals)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[lidofinance](/lidofinance)
/
**[gate-seals](/lidofinance/gate-seals)**
Public

* [Notifications](/login?return_to=%2Flidofinance%2Fgate-seals) You must be signed in to change notification settings
* [Fork
  3](/login?return_to=%2Flidofinance%2Fgate-seals)
* [Star
   8](/login?return_to=%2Flidofinance%2Fgate-seals)

* [Code](/lidofinance/gate-seals)
* [Issues
  0](/lidofinance/gate-seals/issues)
* [Pull requests
  11](/lidofinance/gate-seals/pulls)
* [Actions](/lidofinance/gate-seals/actions)
* [Projects
  0](/lidofinance/gate-seals/projects)
* [Security](/lidofinance/gate-seals/security)
* [Insights](/lidofinance/gate-seals/pulse)

Additional navigation options

* [Code](/lidofinance/gate-seals)
* [Issues](/lidofinance/gate-seals/issues)
* [Pull requests](/lidofinance/gate-seals/pulls)
* [Actions](/lidofinance/gate-seals/actions)
* [Projects](/lidofinance/gate-seals/projects)
* [Security](/lidofinance/gate-seals/security)
* [Insights](/lidofinance/gate-seals/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Flidofinance%2Fgate-seals%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Flidofinance%2Fgate-seals%2Fissues%2Fnew%2Fchoose)
to your account

# fix: capture response from raw\_call #5

 Merged

[failingtwice](/failingtwice)
merged 6 commits into
[main](/lidofinance/gate-seals/tree/main "lidofinance/gate-seals:main")
from
[raw-call-response](/lidofinance/gate-seals/tree/raw-call-response "lidofinance/gate-seals:raw-call-response")

Apr 14, 2023

+56

−1

[Conversation
7](/lidofinance/gate-seals/pull/5)
[Commits
6](/lidofinance/gate-seals/pull/5/commits)
[Checks
0](/lidofinance/gate-seals/pull/5/checks)
[Files changed
3](/lidofinance/gate-seals/pull/5/files)

 Merged

# [fix: capture response from raw\_call](#top) #5

 Show file tree

 Hide file tree

 Changes from **all commits**

Commits

[Show all changes

6 commits](/lidofinance/gate-seals/pull/5/files)
Select commit
Hold shift + click to select a range

[`68a368c`
fix: capture response from raw\_call

failingtwice Apr 13, 2023](/lidofinance/gate-seals/pull/5/commits/68a368c269ea7b6231c6e41a400e487ce81a2fef)
[`c0f1d37`
fix: typo

failingtwice Apr 14, 2023](/lidofinance/gate-seals/pull/5/commits/c0f1d37484d0e059e8c40be1418d45263d25a589)
[`f5ffd5b`
test: raw\_call returns actual success

failingtwice Apr 14, 2023](/lidofinance/gate-seals/pull/5/commits/f5ffd5b7f6ec65f0be2d62280cd90e6ae3bf232f)
[`f2b3ac2`
fix: rename

failingtwice Apr 14, 2023](/lidofinance/gate-seals/pull/5/commits/f2b3ac216f86d48180ebc50b4ed4f1fe68059cf2)
[`5b29f7f`
feat: explain not checking response

failingtwice Apr 14, 2023](/lidofinance/gate-seals/pull/5/commits/5b29f7fea9fd6c88d7dba35753d3962caea13e3e)
[`2b1243b`
fix: update comment

failingtwice Apr 14, 2023](/lidofinance/gate-seals/pull/5/commits/2b1243b3cd37d142cf17a3141fac2b5ccf9601fa)

**File filter**

### Filter by extension

Filter by extension

.py
(1)

.vy
(2)

All 2 file types selected

---

Viewed files

[Clear filters](/lidofinance/gate-seals/pull/5/files)

 **Conversations**

Failed to load comments.  Retry

 Loading

 **Jump to**

Jump to file

Failed to load files.  Retry

 Loading

##### Diff view

![Unified Diff View](https://github.githubassets.com/assets/unified-6de447b07fd7.svg)

Unified

![Split Diff View](https://github.githubassets.com/assets/split-b930d4a1df45.svg)

Split

Hide whitespace

 Apply and reload

Show whitespace

##### Diff view

![Unified Diff View](https://github.githubassets.com/assets/unified-6de447b07fd7.svg)

Unified

![Split Diff View](https://github.githubassets.com/assets/split-b930d4a1df45.svg)

Split

Hide whitespace

 Apply and reload

* contracts

  + contracts/GateSeal.vy
    [GateSeal.vy](#diff-bc84648db4a3a4253eafddffcb574dc1f1807f6bab7e8f5138228f9cf0c7bad0)
  + test\_helpers

    - contracts/test\_helpers/SealableMock.vy
      [SealableMock.vy](#diff-0980bd0715d142856d9ce486a4fc2d5a9ff4d7ec776214658cc07fa2d01a0c86)
* tests

  + tests/test\_gate\_seal.py
    [test\_gate\_seal.py](#diff-82b738b4c166ad0af525a5294a96d43acc4da70cb4cb23b82f833426e9db2256)

## There are no files selected for viewing

7 changes: 6 additions & 1 deletion

7
[contracts/GateSeal.vy](#diff-bc84648db4a3a4253eafddffcb574dc1f1807f6bab7e8f5138228f9cf0c7bad0 "contracts/GateSeal.vy")

Show comments

[View file](/lidofinance/gate-seals/blob/2b1243b3cd37d142cf17a3141fac2b5ccf9601fa/contracts/GateSeal.vy)
Edit file

Delete file

[Open in desktop](https://desktop.github.com)

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -159,11 +159,16 @@ def seal(\_sealables: DynArray[address, MAX\_SEALABLES]): |
|  |  | assert sealable in self.sealables, "sealables: includes a non-sealable" |
|  |  |  |
|  |  | success: bool = False |
|  |  | response: Bytes[32] = b"" |
|  |  |  |
|  |  | # using `raw\_call` to catch external revert and continue execution |
|  |  | success = raw\_call( |
|  |  | # capturing `response` to keep the compiler from acting out but will not be checking it |
|  |  | # as different sealables may return different values if anything at all |
|  |  | # for details, see https://docs.vyperlang.org/en/stable/built-in-functions.html#raw\_call |
|  |  | success, response = raw\_call( |
| **TheDZhon** marked this conversation as resolved.   Show resolved  Hide resolved | | |
|  |  | sealable, |
|  |  | \_abi\_encode(SEAL\_DURATION\_SECONDS, method\_id=method\_id("pauseFor(uint256)")), |
|  |  | max\_outsize=32, |
|  |  | revert\_on\_failure=False |
|  |  | ) |
|  |  |  |
| Expand Down | |  |

7 changes: 7 additions & 0 deletions

7
[contracts/test\_helpers/SealableMock.vy](#diff-0980bd0715d142856d9ce486a4fc2d5a9ff4d7ec776214658cc07fa2d01a0c86 "contracts/test_helpers/SealableMock.vy")

Show comments

[View file](/lidofinance/gate-seals/blob/2b1243b3cd37d142cf17a3141fac2b5ccf9601fa/contracts/test_helpers/SealableMock.vy)
Edit file

Delete file

[Open in desktop](https://desktop.github.com)

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -16,6 +16,13 @@ def isPaused() -> bool: |
|  |  | return self.\_is\_paused() |
|  |  |  |
|  |  |  |
|  |  | @external |
|  |  | def \_\_force\_pause\_for(\_duration: uint256): |
|  |  | # pause ignoring any checks |
|  |  | # required to simulate cases where Sealable is already paused but the seal() reverts |
|  |  | self.resumed\_timestamp = block.timestamp + \_duration |
|  |  |  |
|  |  |  |
|  |  | @external |
|  |  | def pauseFor(\_duration: uint256): |
|  |  | assert not self.reverts, "simulating revert" |
| Expand Down | |  |

43 changes: 43 additions & 0 deletions

43
[tests/test\_gate\_seal.py](#diff-82b738b4c166ad0af525a5294a96d43acc4da70cb4cb23b82f833426e9db2256 "tests/test_gate_seal.py")

Show comments

[View file](/lidofinance/gate-seals/blob/2b1243b3cd37d142cf17a3141fac2b5ccf9601fa/tests/test_gate_seal.py)
Edit file

Delete file

[Open in desktop](https://desktop.github.com)

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -428,3 +428,46 @@ def test\_cannot\_seal\_twice\_in\_one\_tx(gate\_seal, sealables, sealing\_committee): |
|  |  | gate\_seal.seal(sealables, sender=sealing\_committee) |
|  |  | with reverts("gate seal: expired"): |
|  |  | gate\_seal.seal(sealables, sender=sealing\_committee) |
|  |  |  |
|  |  |  |
|  |  | def test\_raw\_call\_success\_should\_be\_false\_when\_sealable\_reverts\_on\_pause(project, deployer, generate\_sealables, sealing\_committee, seal\_duration\_seconds, expiry\_timestamp): |
|  |  | """ |
|  |  | `raw\_call` without `max\_outsize` and with `revert\_on\_failure=True` for some reason returns the boolean value of memory[0] :^) |
|  |  |  |
|  |  | Which is why we specify `max\_outsize=32`, even though don't actually use it. |
|  |  |  |
|  |  | To test that `success` returns actual value instead of returning bool of memory[0], |
|  |  | we need to pause the contract before the sealing, |
|  |  | so that the condition `success and is\_paused()` is false (i.e `False and True`), see GateSeal.vy::seal() |
|  |  |  |
|  |  | For that, we use `\_\_force\_pause\_for` on SealableMock to ignore any checks and forcefully pause the contract. |
|  |  | After calling this function, the SealableMock is paused but the call to `pauseFor` will still revert, |
|  |  | thus the returned `success` should be False, the condition fails and the call reverts altogether. |
|  |  |  |
|  |  | Without `max\_outsize=32`, the transaction would not revert. |
|  |  | """ |
|  |  |  |
|  |  | unpausable = False |
|  |  | should\_revert = True |
|  |  | # we'll use only 1 sealable |
|  |  | sealables = generate\_sealables(1, unpausable, should\_revert) |
|  |  |  |
|  |  | # deploy GateSeal |
|  |  | gate\_seal = project.GateSeal.deploy( |
|  |  | sealing\_committee, |
|  |  | seal\_duration\_seconds, |
|  |  | sealables, |
|  |  | expiry\_timestamp, |
|  |  | sender=deployer, |
|  |  | ) |
|  |  |  |
|  |  | # making sure we have the right contract |
|  |  | assert gate\_seal.get\_sealables() == sealables |
|  |  |  |
|  |  | # forcefully pause the sealable before sealing |
|  |  | sealables[0].\_\_force\_pause\_for(seal\_duration\_seconds, sender=deployer) |
|  |  | assert sealables[0].isPaused(), "should be paused now" |
|  |  |  |
|  |  | # seal() should revert because `raw\_call` to sealable returns `success=False`, even though isPaused() is True. |
|  |  | with reverts("0"): |
|  |  | gate\_seal.seal(sealables, sender=sealing\_committee) |

Toggle all file notes
Toggle all file annotations

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_435368f4_20250114_185329.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvyperlang%2Fvyper%2Fsecurity%2Fadvisories%2FGHSA-w9g2-3w7p-72g9)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvyperlang%2Fvyper%2Fsecurity%2Fadvisories%2FGHSA-w9g2-3w7p-72g9)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=vyperlang%2Fvyper)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[vyperlang](/vyperlang)
/
**[vyper](/vyperlang/vyper)**
Public

* [Notifications](/login?return_to=%2Fvyperlang%2Fvyper) You must be signed in to change notification settings
* [Fork
  818](/login?return_to=%2Fvyperlang%2Fvyper)
* [Star
   4.9k](/login?return_to=%2Fvyperlang%2Fvyper)

* [Code](/vyperlang/vyper)
* [Issues
  407](/vyperlang/vyper/issues)
* [Pull requests
  82](/vyperlang/vyper/pulls)
* [Discussions](/vyperlang/vyper/discussions)
* [Actions](/vyperlang/vyper/actions)
* [Projects
  0](/vyperlang/vyper/projects)
* [Wiki](/vyperlang/vyper/wiki)
* [Security](/vyperlang/vyper/security)
* [Insights](/vyperlang/vyper/pulse)

Additional navigation options

* [Code](/vyperlang/vyper)
* [Issues](/vyperlang/vyper/issues)
* [Pull requests](/vyperlang/vyper/pulls)
* [Discussions](/vyperlang/vyper/discussions)
* [Actions](/vyperlang/vyper/actions)
* [Projects](/vyperlang/vyper/projects)
* [Wiki](/vyperlang/vyper/wiki)
* [Security](/vyperlang/vyper/security)
* [Insights](/vyperlang/vyper/pulse)

# raw\_call with outsize=0 and revert\_on\_failure=False returns incorrect success value

Moderate

[charles-cooper](/charles-cooper)
published
GHSA-w9g2-3w7p-72g9
Apr 24, 2023

## Package

pip

vyper
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

>=v0.3.1, <=0.3.7

## Patched versions

0.3.8

## Description

### Background

During the audit of [Lido's Gate Seals](https://github.com/lidofinance/gate-seals) code [statemind](https://statemind.io) team identified a weird behavior of the code that uses `raw_call`: <https://github.com/lidofinance/gate-seals/blob/051593e74df01a4131c485b4fda52e691cd4b7d8/contracts/GateSeal.vy#L164> .

Construction like this:

```
success = raw_call(
    sealable,
    _abi_encode(SEAL_DURATION_SECONDS, method_id=method_id("pauseFor(uint256)")),
    revert_on_failure=False
)
```

was not fully documented: <https://docs.vyperlang.org/en/v0.3.7/built-in-functions.html#raw_call> .

The documentation says that: if `max_outsize=0` it should return nothing and then it says that if `revert_on_failure=False` it should return a `success` flag in the tuple of response, but what if `max_outsize=0` and `revert_on_failure=False`.

[![image](https://user-images.githubusercontent.com/22330612/232125364-d2b3bbac-0b4f-40cb-80ff-f55d8eafef44.png)](https://user-images.githubusercontent.com/22330612/232125364-d2b3bbac-0b4f-40cb-80ff-f55d8eafef44.png)

So the team started researching what exactly happened in that case, after some research we found that the Vyper compiler generates the wrong bytecode in that case, it generates the sequence:

```
CALL // call
MLOAD // MLOAD is wrong since the CALL result is already stored in the stack

```
### Impact

Example of buggy code:

```
@external
def returnSome(calling: address, a: uint256) -> bool:
    success: bool = false
    success = raw_call(
        calling,
        _abi_encode(a, method_id=method_id("a(uint256)")),
        revert_on_failure=False
        )
```

any contract that uses the `raw_call` with `revert_on_failure=False` and `max_outsize=0` receives the wrong response from `raw_call`. Depending on the memory garbage, the result can be either `True` or `False`.

### Patches

Fix by [@charles-cooper](https://github.com/charles-cooper) [851f7a1](https://github.com/vyperlang/vyper/commit/851f7a1b3aa2a36fd041e3d0ed38f9355a58c8ae)

### Workarounds

The simple workaround is always to put `max_outsize>0`.

Workaround example <https://github.com/lidofinance/gate-seals/pull/5/files>

### References

Lido's fix: <https://github.com/lidofinance/gate-seals/pull/5/files>

### Severity

Moderate

### CVE ID

CVE-2023-30629

### Weaknesses

No CWEs

### Credits

* [![@algys](https://avatars.githubusercontent.com/u/22330612?s=40&v=4)](/algys)
  [algys](/algys)
  Reporter
* [![@pavelvm5](https://avatars.githubusercontent.com/u/56404416?s=40&v=4)](/pavelvm5)
  [pavelvm5](/pavelvm5)
  Finder

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_65f02639_20250114_185328.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvyperlang%2Fvyper%2Fcommit%2F851f7a1b3aa2a36fd041e3d0ed38f9355a58c8ae)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvyperlang%2Fvyper%2Fcommit%2F851f7a1b3aa2a36fd041e3d0ed38f9355a58c8ae)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=vyperlang%2Fvyper)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[vyperlang](/vyperlang)
/
**[vyper](/vyperlang/vyper)**
Public

* [Notifications](/login?return_to=%2Fvyperlang%2Fvyper) You must be signed in to change notification settings
* [Fork
  818](/login?return_to=%2Fvyperlang%2Fvyper)
* [Star
   4.9k](/login?return_to=%2Fvyperlang%2Fvyper)

* [Code](/vyperlang/vyper)
* [Issues
  407](/vyperlang/vyper/issues)
* [Pull requests
  82](/vyperlang/vyper/pulls)
* [Discussions](/vyperlang/vyper/discussions)
* [Actions](/vyperlang/vyper/actions)
* [Projects
  0](/vyperlang/vyper/projects)
* [Wiki](/vyperlang/vyper/wiki)
* [Security](/vyperlang/vyper/security)
* [Insights](/vyperlang/vyper/pulse)

Additional navigation options

* [Code](/vyperlang/vyper)
* [Issues](/vyperlang/vyper/issues)
* [Pull requests](/vyperlang/vyper/pulls)
* [Discussions](/vyperlang/vyper/discussions)
* [Actions](/vyperlang/vyper/actions)
* [Projects](/vyperlang/vyper/projects)
* [Wiki](/vyperlang/vyper/wiki)
* [Security](/vyperlang/vyper/security)
* [Insights](/vyperlang/vyper/pulse)

## Commit

[Permalink](/vyperlang/vyper/commit/851f7a1b3aa2a36fd041e3d0ed38f9355a58c8ae)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-w9g2-3w7p-72g9](https://github.com/advisories/GHSA-w9g2-3w7p-72g9 "GHSA-w9g2-3w7p-72g9")

[Browse files](/vyperlang/vyper/tree/851f7a1b3aa2a36fd041e3d0ed38f9355a58c8ae)
Browse the repository at this point in the history

```
it was getting tagged as a pointer instead of a stack value during
codegen
```

* Loading branch information

[![@charles-cooper](https://avatars.githubusercontent.com/u/3867501?s=40&v=4)](/charles-cooper)

[charles-cooper](/vyperlang/vyper/commits?author=charles-cooper "View all commits by charles-cooper")
authored
Apr 24, 2023

1 parent
[25781f6](/vyperlang/vyper/commit/25781f64bb903e0fce3291d066d65cebb42cbb56)

commit 851f7a1

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**33 additions**
and
**7 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* tests/parser/functions

  + tests/parser/functions/test\_raw\_call.py
    [test\_raw\_call.py](#diff-11cf3f87121253f3f60dd8acbd71cf9abc9ebd5f8f73273f999ea1f744532b70)
* vyper/builtins

  + vyper/builtins/functions.py
    [functions.py](#diff-e90bab969567793a8abf25b22fa03548e4abe48db25f48a05e2c51ce78e0613e)

## There are no files selected for viewing

18 changes: 18 additions & 0 deletions

18
[tests/parser/functions/test\_raw\_call.py](#diff-11cf3f87121253f3f60dd8acbd71cf9abc9ebd5f8f73273f999ea1f744532b70 "tests/parser/functions/test_raw_call.py")

Show comments

[View file](/vyperlang/vyper/blob/851f7a1b3aa2a36fd041e3d0ed38f9355a58c8ae/tests/parser/functions/test_raw_call.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -296,8 +296,10 @@ def test\_checkable\_raw\_call(get\_contract, assert\_tx\_failed): |
|  |  | def fail1(should\_raise: bool): |
|  |  | if should\_raise: |
|  |  | raise "fail" |
|  |  |  |
|  |  | # test both paths for raw\_call - |
|  |  | # they are different depending if callee has or doesn't have returntype |
|  |  | # (fail2 fails because of staticcall) |
|  |  | @external |
|  |  | def fail2(should\_raise: bool) -> int128: |
|  |  | if should\_raise: |
| Expand All | | @@ -320,6 +322,7 @@ def foo(\_addr: address, should\_raise: bool) -> uint256: |
|  |  | ) |
|  |  | assert success == (not should\_raise) |
|  |  | return 1 |
|  |  |  |
|  |  | @external |
|  |  | @view |
|  |  | def bar(\_addr: address, should\_raise: bool) -> uint256: |
| Expand All | | @@ -334,6 +337,19 @@ def bar(\_addr: address, should\_raise: bool) -> uint256: |
|  |  | ) |
|  |  | assert success == (not should\_raise) |
|  |  | return 2 |
|  |  |  |
|  |  | # test max\_outsize not set case |
|  |  | @external |
|  |  | @nonpayable |
|  |  | def baz(\_addr: address, should\_raise: bool) -> uint256: |
|  |  | success: bool = True |
|  |  | success = raw\_call( |
|  |  | \_addr, |
|  |  | \_abi\_encode(should\_raise, method\_id=method\_id("fail1(bool)")), |
|  |  | revert\_on\_failure=False, |
|  |  | ) |
|  |  | assert success == (not should\_raise) |
|  |  | return 3 |
|  |  | """ |
|  |  |  |
|  |  | target = get\_contract(target\_source) |
| Expand All | | @@ -343,6 +359,8 @@ def bar(\_addr: address, should\_raise: bool) -> uint256: |
|  |  | assert caller.foo(target.address, False) == 1 |
|  |  | assert caller.bar(target.address, True) == 2 |
|  |  | assert caller.bar(target.address, False) == 2 |
|  |  | assert caller.baz(target.address, True) == 3 |
|  |  | assert caller.baz(target.address, False) == 3 |
|  |  |  |
|  |  |  |
|  |  | uncompilable\_code = [ |
| Expand Down | |  |

22 changes: 15 additions & 7 deletions

22
[vyper/builtins/functions.py](#diff-e90bab969567793a8abf25b22fa03548e4abe48db25f48a05e2c51ce78e0613e "vyper/builtins/functions.py")

Show comments

[View file](/vyperlang/vyper/blob/851f7a1b3aa2a36fd041e3d0ed38f9355a58c8ae/vyper/builtins/functions.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1188,7 +1188,9 @@ def build\_IR(self, expr, args, kwargs, context): |
|  |  |  |
|  |  | if revert\_on\_failure: |
|  |  | typ = bytes\_ty |
|  |  | # check the call success flag, and store returndata in memory |
|  |  | ret\_ir = ["seq", check\_external\_call(call\_ir), store\_output\_size] |
|  |  | return IRnode.from\_list(ret\_ir, typ=typ, location=MEMORY) |
|  |  | else: |
|  |  | typ = TupleT([bool\_ty, bytes\_ty]) |
|  |  | ret\_ir = [ |
| Expand All | | @@ -1198,16 +1200,22 @@ def build\_IR(self, expr, args, kwargs, context): |
|  |  | IRnode.from\_list(call\_ir, typ=bool\_ty), |
|  |  | IRnode.from\_list(store\_output\_size, typ=bytes\_ty, location=MEMORY), |
|  |  | ] |
|  |  | # return an IR tuple of call success flag and returndata pointer |
|  |  | return IRnode.from\_list(ret\_ir, typ=typ) |
|  |  |  |
|  |  | # max\_outsize is 0. |
|  |  |  |
|  |  | if not revert\_on\_failure: |
|  |  | # return call flag as stack item |
|  |  | typ = bool\_ty |
|  |  | return IRnode.from\_list(call\_ir, typ=typ) |
|  |  |  |
|  |  | else: |
|  |  | if revert\_on\_failure: |
|  |  | typ = None |
|  |  | ret\_ir = check\_external\_call(call\_ir) |
|  |  | else: |
|  |  | typ = bool\_ty |
|  |  | ret\_ir = call\_ir |
|  |  | # check the call success flag and don't return anything |
|  |  | ret\_ir = check\_external\_call(call\_ir) |
|  |  | return IRnode.from\_list(ret\_ir, typ=None) |
|  |  |  |
|  |  | return IRnode.from\_list(ret\_ir, typ=typ, location=MEMORY) |
|  |  | raise CompilerPanic("unreachable!") |
|  |  |  |
|  |  |  |
|  |  | class Send(BuiltinFunction): |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `851f7a1`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvyperlang%2Fvyper%2Fcommit%2F851f7a1b3aa2a36fd041e3d0ed38f9355a58c8ae) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


