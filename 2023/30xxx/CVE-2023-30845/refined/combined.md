=== Content from github.com_790d6e35_20250115_094615.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FGoogleCloudPlatform%2Fesp-v2%2Fcommit%2F0bcdfc024ce96b34db4e1b4f2211b509d9be93cd)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FGoogleCloudPlatform%2Fesp-v2%2Fcommit%2F0bcdfc024ce96b34db4e1b4f2211b509d9be93cd)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=GoogleCloudPlatform%2Fesp-v2)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[GoogleCloudPlatform](/GoogleCloudPlatform)
/
**[esp-v2](/GoogleCloudPlatform/esp-v2)**
Public

* [Notifications](/login?return_to=%2FGoogleCloudPlatform%2Fesp-v2) You must be signed in to change notification settings
* [Fork
  170](/login?return_to=%2FGoogleCloudPlatform%2Fesp-v2)
* [Star
   275](/login?return_to=%2FGoogleCloudPlatform%2Fesp-v2)

* [Code](/GoogleCloudPlatform/esp-v2)
* [Issues
  63](/GoogleCloudPlatform/esp-v2/issues)
* [Pull requests
  17](/GoogleCloudPlatform/esp-v2/pulls)
* [Actions](/GoogleCloudPlatform/esp-v2/actions)
* [Security](/GoogleCloudPlatform/esp-v2/security)
* [Insights](/GoogleCloudPlatform/esp-v2/pulse)

Additional navigation options

* [Code](/GoogleCloudPlatform/esp-v2)
* [Issues](/GoogleCloudPlatform/esp-v2/issues)
* [Pull requests](/GoogleCloudPlatform/esp-v2/pulls)
* [Actions](/GoogleCloudPlatform/esp-v2/actions)
* [Security](/GoogleCloudPlatform/esp-v2/security)
* [Insights](/GoogleCloudPlatform/esp-v2/pulse)

## Commit

[Permalink](/GoogleCloudPlatform/esp-v2/commit/0bcdfc024ce96b34db4e1b4f2211b509d9be93cd)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Changelog for v2.43.0

[Browse files](/GoogleCloudPlatform/esp-v2/tree/0bcdfc024ce96b34db4e1b4f2211b509d9be93cd)
Browse the repository at this point in the history

* Loading branch information

[![@shuoyang2016](https://avatars.githubusercontent.com/u/6464547?s=40&v=4)](/shuoyang2016)

[shuoyang2016](/GoogleCloudPlatform/esp-v2/commits?author=shuoyang2016 "View all commits by shuoyang2016")
committed
Mar 28, 2023

1 parent
[8f73d48](/GoogleCloudPlatform/esp-v2/commit/8f73d48ac60a04bfcd9ab3f1a22690b378ff12bd)

commit 0bcdfc0

Showing
**1 changed file**
with
**6 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

6 changes: 6 additions & 0 deletions

6
[CHANGELOG.md](#diff-06572a96a58dc510037d5efa622f9bec8519bc1beab13c9f251e97e657a9d4ed "CHANGELOG.md")

Show comments

[View file](/GoogleCloudPlatform/esp-v2/blob/0bcdfc024ce96b34db4e1b4f2211b509d9be93cd/CHANGELOG.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -1,3 +1,9 @@ |
|  |  | # Release 2.43.0 28-03-2023 |
|  |  |  |
|  |  | - move x-http-method-override to beginning of filter chain (#801) |
|  |  | - Reduce default jwt\_cache\_size to 1000 (#798) |
|  |  | - improve parsing and handling of ServiceControlUrl (#800) |
|  |  |  |
|  |  | # Release 2.42.0 27-02-2023 |
|  |  |  |
|  |  | - Add flag --disable\_jwt\_audience\_service\_name\_check (#779) |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `0bcdfc0`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FGoogleCloudPlatform%2Fesp-v2%2Fcommit%2F0bcdfc024ce96b34db4e1b4f2211b509d9be93cd) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_1364b252_20250115_094618.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FGoogleCloudPlatform%2Fesp-v2%2Fcommit%2Fe95670146f5e96bb5565b0a9c1e153886b3e04ce)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FGoogleCloudPlatform%2Fesp-v2%2Fcommit%2Fe95670146f5e96bb5565b0a9c1e153886b3e04ce)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=GoogleCloudPlatform%2Fesp-v2)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[GoogleCloudPlatform](/GoogleCloudPlatform)
/
**[esp-v2](/GoogleCloudPlatform/esp-v2)**
Public

* [Notifications](/login?return_to=%2FGoogleCloudPlatform%2Fesp-v2) You must be signed in to change notification settings
* [Fork
  170](/login?return_to=%2FGoogleCloudPlatform%2Fesp-v2)
* [Star
   275](/login?return_to=%2FGoogleCloudPlatform%2Fesp-v2)

* [Code](/GoogleCloudPlatform/esp-v2)
* [Issues
  63](/GoogleCloudPlatform/esp-v2/issues)
* [Pull requests
  17](/GoogleCloudPlatform/esp-v2/pulls)
* [Actions](/GoogleCloudPlatform/esp-v2/actions)
* [Security](/GoogleCloudPlatform/esp-v2/security)
* [Insights](/GoogleCloudPlatform/esp-v2/pulse)

Additional navigation options

* [Code](/GoogleCloudPlatform/esp-v2)
* [Issues](/GoogleCloudPlatform/esp-v2/issues)
* [Pull requests](/GoogleCloudPlatform/esp-v2/pulls)
* [Actions](/GoogleCloudPlatform/esp-v2/actions)
* [Security](/GoogleCloudPlatform/esp-v2/security)
* [Insights](/GoogleCloudPlatform/esp-v2/pulse)

## Commit

[Permalink](/GoogleCloudPlatform/esp-v2/commit/e95670146f5e96bb5565b0a9c1e153886b3e04ce)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

move x-http-method-override to beginning of filter chain ([#801](https://github.com/GoogleCloudPlatform/esp-v2/pull/801))

[Browse files](/GoogleCloudPlatform/esp-v2/tree/e95670146f5e96bb5565b0a9c1e153886b3e04ce)
Browse the repository at this point in the history

```
Create a new filter to handle method override. Tested via integration test.
```

* Loading branch information

[![@nareddyt](https://avatars.githubusercontent.com/u/11142171?s=40&v=4)](/nareddyt)

[nareddyt](/GoogleCloudPlatform/esp-v2/commits?author=nareddyt "View all commits by nareddyt")
authored
Mar 28, 2023

1 parent
[75d0819](/GoogleCloudPlatform/esp-v2/commit/75d081969e7b2b8ef7eec146f8b7e4b22ec545de)

commit e956701

 Show file tree

 Hide file tree

Showing
**25 changed files**
with
**474 additions**
and
**25 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* api

  + envoy/v11/http/header\_sanitizer

    - api/envoy/v11/http/header\_sanitizer/BUILD
      [BUILD](#diff-927b7f0ededd65e8b127c496fa63ead024c6fd8253d78b0787354697570a194c)
    - api/envoy/v11/http/header\_sanitizer/config.proto
      [config.proto](#diff-caa797f03895d56a77e5b24085690395d5960b957262bdd5ac63daf2d697c95d)
  + scripts

    - api/scripts/go\_proto\_gen.sh
      [go\_proto\_gen.sh](#diff-5f9c16ffd101313dd44c29e602532e028faaf45cde5886c2ae943d5d916587d0)
* examples

  + auth

    - examples/auth/envoy\_config.json
      [envoy\_config.json](#diff-70587c0c1cab1aa8e497717d1a3c2ef7eebb97407a556812ab2dbe8e97780ad2)
  + dynamic\_routing

    - examples/dynamic\_routing/envoy\_config.json
      [envoy\_config.json](#diff-7fbc87bc2d21531cebc9294a3b8d126d3ead8504ec6bf21df5c27d4d8d0db5d4)
  + grpc\_dynamic\_routing

    - examples/grpc\_dynamic\_routing/envoy\_config.json
      [envoy\_config.json](#diff-fb00fd568a31c1b179a15aa0ae41facd7fa227aa1b55099d288a5d23735915c5)
  + service\_control

    - examples/service\_control/envoy\_config.json
      [envoy\_config.json](#diff-71427ba427c36608a9c32bcbf6f30b5f86a972b17969b25ea3fb7289366a2207)
  + testdata

    - route\_match

      * examples/testdata/route\_match/envoy\_config.json
        [envoy\_config.json](#diff-08bb404dc21f254c59e915876aba859e87de3e821a15a17301faa825666ab89c)
    - sidecar\_backend

      * examples/testdata/sidecar\_backend/envoy\_config.json
        [envoy\_config.json](#diff-6038b168dae6a9b39884897cd147f1f788fbdd83674f8afe602fd38c389c5ab0)
* src

  + envoy

    - src/envoy/BUILD
      [BUILD](#diff-0086be648cf7972b6bd45d5c6a10da39df7822b63f0787e6051bfaf931ac24dc)
    - http

      * header\_sanitizer

        + src/envoy/http/header\_sanitizer/BUILD
          [BUILD](#diff-eedcbc9196fcbb8aff05230bb5f0afd499b5eef1c7d437e85eabba4ae6a5d140)
        + src/envoy/http/header\_sanitizer/filter.cc
          [filter.cc](#diff-3fdab465644870e5ed525baa1361e3f1186ae841e4e79f59edda4872666711b2)
        + src/envoy/http/header\_sanitizer/filter.h
          [filter.h](#diff-41c58281972c52bba3e9a9709c16d69eba16ebc411287928896397f70ff8fb6e)
        + src/envoy/http/header\_sanitizer/filter\_factory.cc
          [filter\_factory.cc](#diff-a8d11adbdae4184f22a70e93e7c1f2566ea71854c24c360aa8d6c7624272d199)
      * service\_control

        + src/envoy/http/service\_control/filter.cc
          [filter.cc](#diff-61af1cb9428752568bb4a28505d2b5c35b45ea202ea21424eaf3c3ffc65749ce)
  + go

    - configgenerator

      * src/go/configgenerator/filter\_generator.go
        [filter\_generator.go](#diff-538d1a37e62780f130ddf5309657eca765cbf24abc36904fd5f9864c688204c7)
      * filtergen

        + src/go/configgenerator/filtergen/header\_sanitizer.go
          [header\_sanitizer.go](#diff-f689965c826e8ab066f6033e1ddd01cf1aace5d97b151769ec0abef2397ad51a)
      * src/go/configgenerator/listener\_generator\_test.go
        [listener\_generator\_test.go](#diff-3526f43459c44794dcb30b3e9d69c4a503f8acf51584373321eda484c80df8ff)
    - configmanager/testdata

      * src/go/configmanager/testdata/test\_fetch\_listeners.go
        [test\_fetch\_listeners.go](#diff-3cbed65966877954be7ffe20d6f64c4f363c1ba8389bc3851af4c238931c26db)
      * src/go/configmanager/testdata/test\_fixed\_mode\_dynamic\_routing.go
        [test\_fixed\_mode\_dynamic\_routing.go](#diff-f8dc145e1665cfa949caa2d237ad7192c541411e8cd3d40492bf1c2e34acfb60)
    - util

      * src/go/util/marshal.go
        [marshal.go](#diff-0c0419a43cabd11d8d31795fe86e3e783b3a5e397883231c23a008bc0f0b83e8)
      * src/go/util/xds\_name.go
        [xds\_name.go](#diff-415fb5b98f45d1a99610c08d230341107a58a57da0279ce91a96345f3d58bf84)
* tests

  + env/platform

    - tests/env/platform/ports.go
      [ports.go](#diff-b101a3fd70c3e418b58e71db09dd455b54c35219857ec47025ace094cb0412e9)
  + integration\_test

    - http1\_integration\_test

      * tests/integration\_test/http1\_integration\_test/http1\_integration\_test.go
        [http1\_integration\_test.go](#diff-2f385d459abfd1cd87b7ab7545e06e697c2d351ccdf66a6c7eaf4230c63dd2df)
    - jwt\_auth\_integration\_test

      * tests/integration\_test/jwt\_auth\_integration\_test/jwt\_auth\_integration\_test.go
        [jwt\_auth\_integration\_test.go](#diff-dbe3e2474b8ee5502b421638f1584d493c3505e97f21dc779340277de3b6cdf8)

## There are no files selected for viewing

18 changes: 18 additions & 0 deletions

18
[api/envoy/v11/http/header\_sanitizer/BUILD](#diff-927b7f0ededd65e8b127c496fa63ead024c6fd8253d78b0787354697570a194c "api/envoy/v11/http/header_sanitizer/BUILD")

Show comments

[View file](/GoogleCloudPlatform/esp-v2/blob/e95670146f5e96bb5565b0a9c1e153886b3e04ce/api/envoy/v11/http/header_sanitizer/BUILD)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,18 @@ |
|  |  | load("@envoy\_api//bazel:api\_build\_system.bzl", "api\_cc\_py\_proto\_library") |
|  |  | load("@io\_bazel\_rules\_go//proto:def.bzl", "go\_proto\_library") |
|  |  |  |
|  |  | package(default\_visibility = ["//visibility:public"]) |
|  |  |  |
|  |  | api\_cc\_py\_proto\_library( |
|  |  | name = "config\_proto", |
|  |  | srcs = [ |
|  |  | "config.proto", |
|  |  | ], |
|  |  | visibility = ["//visibility:public"], |
|  |  | ) |
|  |  |  |
|  |  | go\_proto\_library( |
|  |  | name = "config\_go\_proto", |
|  |  | importpath = "github.com/GoogleCloudPlatform/esp-v2/src/go/proto/api/envoy/v11/http/header\_sanitizer", |
|  |  | proto = ":config\_proto", |
|  |  | ) |

22 changes: 22 additions & 0 deletions

22
[api/envoy/v11/http/header\_sanitizer/config.proto](#diff-caa797f03895d56a77e5b24085690395d5960b957262bdd5ac63daf2d697c95d "api/envoy/v11/http/header_sanitizer/config.proto")

Show comments

[View file](/GoogleCloudPlatform/esp-v2/blob/e95670146f5e96bb5565b0a9c1e153886b3e04ce/api/envoy/v11/http/header_sanitizer/config.proto)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,22 @@ |
|  |  | // Copyright 2023 Google LLC |
|  |  | // |
|  |  | // Licensed under the Apache License, Version 2.0 (the "License"); |
|  |  | // you may not use this file except in compliance with the License. |
|  |  | // You may obtain a copy of the License at |
|  |  | // |
|  |  | // http://www.apache.org/licenses/LICENSE-2.0 |
|  |  | // |
|  |  | // Unless required by applicable law or agreed to in writing, software |
|  |  | // distributed under the License is distributed on an "AS IS" BASIS, |
|  |  | // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. |
|  |  | // See the License for the specific language governing permissions and |
|  |  | // limitations under the License. |
|  |  |  |
|  |  | syntax = "proto3"; |
|  |  |  |
|  |  | package espv2.api.envoy.v11.http.header\_sanitizer; |
|  |  |  |
|  |  | // header\_sanitizer filter doesn't need any config. |
|  |  | // But a config protobuf type is required by FilterFactory. |
|  |  | // Hence defines an empty FilterConfig here. |
|  |  | message FilterConfig {} |

4 changes: 4 additions & 0 deletions

4
[api/scripts/go\_proto\_gen.sh](#diff-5f9c16ffd101313dd44c29e602532e028faaf45cde5886c2ae943d5d916587d0 "api/scripts/go_proto_gen.sh")

Show comments

[View file](/GoogleCloudPlatform/esp-v2/blob/e95670146f5e96bb5565b0a9c1e153886b3e04ce/api/scripts/go_proto_gen.sh)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -42,3 +42,7 @@ cp -f bazel-bin/api/envoy/v11/http/backend\_auth/config\_go\_proto\_/github.com/Goog |
|  |  | bazelisk build //api/envoy/v11/http/grpc\_metadata\_scrubber:config\_go\_proto |
|  |  | mkdir -p src/go/proto/api/envoy/v11/http/grpc\_metadata\_scrubber |
|  |  | cp -f bazel-bin/api/envoy/v11/http/grpc\_metadata\_scrubber/config\_go\_proto\_/github.com/GoogleCloudPlatform/esp-v2/src/go/proto/api/envoy/v11/http/grpc\_metadata\_scrubber/\* src/go/proto/api/envoy/v11/http/grpc\_metadata\_scrubber |
|  |  | # HTTP filter header\_sanitizer |
|  |  | bazelisk build //api/envoy/v11/http/header\_sanitizer:config\_go\_proto |
|  |  | mkdir -p src/go/proto/api/envoy/v11/http/header\_sanitizer |
|  |  | cp -f bazel-bin/api/envoy/v11/http/header\_sanitizer/config\_go\_proto\_/github.com/GoogleCloudPlatform/esp-v2/src/go/proto/api/envoy/v11/http/header\_sanitizer/\* src/go/proto/api/envoy/v11/http/header\_sanitizer |

6 changes: 6 additions & 0 deletions

6
[examples/auth/envoy\_config.json](#diff-70587c0c1cab1aa8e497717d1a3c2ef7eebb97407a556812ab2dbe8e97780ad2 "examples/auth/envoy_config.json")

Show comments

[View file](/GoogleCloudPlatform/esp-v2/blob/e95670146f5e96bb5565b0a9c1e153886b3e04ce/examples/auth/envoy_config.json)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -163,6 +163,12 @@ |
|  |  | "headersWithUnderscoresAction": "REJECT\_REQUEST" |
|  |  | }, |
|  |  | "httpFilters": [ |
|  |  | { |
|  |  | "name": "com.google.espv2.filters.http.header\_sanitizer", |
|  |  | "typedConfig": { |
|  |  | "@type": "type.googleapis.com/espv2.api.envoy.v11.http.header\_sanitizer.FilterConfig" |
|  |  | } |
|  |  | }, |
|  |  | { |
|  |  | "name": "envoy.filters.http.jwt\_authn", |
|  |  | "typedConfig": { |
| Expand Down | |  |

6 changes: 6 additions & 0 deletions

6
[examples/dynamic\_routing/envoy\_config.json](#diff-7fbc87bc2d21531cebc9294a3b8d126d3ead8504ec6bf21df5c27d4d8d0db5d4 "examples/dynamic_routing/envoy_config.json")

Show comments

[View file](/GoogleCloudPlatform/esp-v2/blob/e95670146f5e96bb5565b0a9c1e153886b3e04ce/examples/dynamic_routing/envoy_config.json)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -218,6 +218,12 @@ |
|  |  | "headersWithUnderscoresAction": "REJECT\_REQUEST" |
|  |  | }, |
|  |  | "httpFilters": [ |
|  |  | { |
|  |  | "name": "com.google.espv2.filters.http.header\_sanitizer", |
|  |  | "typedConfig": { |
|  |  | "@type": "type.googleapis.com/espv2.api.envoy.v11.http.header\_sanitizer.FilterConfig" |
|  |  | } |
|  |  | }, |
|  |  | { |
|  |  | "name": "com.google.espv2.filters.http.backend\_auth", |
|  |  | "typedConfig": { |
| Expand Down | |  |

6 changes: 6 additions & 0 deletions

6
[examples/grpc\_dynamic\_routing/envoy\_config.json](#diff-fb00fd568a31c1b179a15aa0ae41facd7fa227aa1b55099d288a5d23735915c5 "examples/grpc_dynamic_routing/envoy_config.json")

Show comments

[View file](/GoogleCloudPlatform/esp-v2/blob/e95670146f5e96bb5565b0a9c1e153886b3e04ce/examples/grpc_dynamic_routing/envoy_config.json)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -231,6 +231,12 @@ |
|  |  | "headersWithUnderscoresAction": "REJECT\_REQUEST" |
|  |  | }, |
|  |  | "httpFilters": [ |
|  |  | { |
|  |  | "name": "com.google.espv2.filters.http.header\_sanitizer", |
|  |  | "typedConfig": { |
|  |  | "@type": "type.googleapis.com/espv2.api.envoy.v11.http.header\_sanitizer.FilterConfig" |
|  |  | } |
|  |  | }, |
|  |  | { |
|  |  | "name": "envoy.filters.http.compressor", |
|  |  | "typedConfig": { |
| Expand Down | |  |

6 changes: 6 additions & 0 deletions

6
[examples/service\_control/envoy\_config.json](#diff-71427ba427c36608a9c32bcbf6f30b5f86a972b17969b25ea3fb7289366a2207 "examples/service_control/envoy_config.json")

Show comments

[View file](/GoogleCloudPlatform/esp-v2/blob/e95670146f5e96bb5565b0a9c1e153886b3e04ce/examples/service_control/envoy_config.json)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -124,6 +124,12 @@ |
|  |  | "headersWithUnderscoresAction": "REJECT\_REQUEST" |
|  |  | }, |
|  |  | "httpFilters": [ |
|  |  | { |
|  |  | "name": "com.google.espv2.filters.http.header\_sanitizer", |
|  |  | "typedConfig": { |
|  |  | "@type": "type.googleapis.com/espv2.api.envoy.v11.http.header\_sanitizer.FilterConfig" |
|  |  | } |
|  |  | }, |
|  |  | { |
|  |  | "name": "com.google.espv2.filters.http.service\_control", |
|  |  | "typedConfig": { |
| Expand Down | |  |

6 changes: 6 additions & 0 deletions

6
[examples/testdata/route\_match/envoy\_config.json](#diff-08bb404dc21f254c59e915876aba859e87de3e821a15a17301faa825666ab89c "examples/testdata/route_match/envoy_config.json")

Show comments

[View file](/GoogleCloudPlatform/esp-v2/blob/e95670146f5e96bb5565b0a9c1e153886b3e04ce/examples/testdata/route_match/envoy_config.json)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -202,6 +202,12 @@ |
|  |  | "headersWithUnderscoresAction": "REJECT\_REQUEST" |
|  |  | }, |
|  |  | "httpFilters": [ |
|  |  | { |
|  |  | "name": "com.google.espv2.filters.http.header\_sanitizer", |
|  |  | "typedConfig": { |
|  |  | "@type": "type.googleapis.com/espv2.api.envoy.v11.http.header\_sanitizer.FilterConfig" |
|  |  | } |
|  |  | }, |
|  |  | { |
|  |  | "name": "com.google.espv2.filters.http.backend\_auth", |
|  |  | "typedConfig": { |
| Expand Down | |  |

6 changes: 6 additions & 0 deletions

6
[examples/testdata/sidecar\_backend/envoy\_config.json](#diff-6038b168dae6a9b39884897cd147f1f788fbdd83674f8afe602fd38c389c5ab0 "examples/testdata/sidecar_backend/envoy_config.json")

Show comments

[View file](/GoogleCloudPlatform/esp-v2/blob/e95670146f5e96bb5565b0a9c1e153886b3e04ce/examples/testdata/sidecar_backend/envoy_config.json)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -124,6 +124,12 @@ |
|  |  | "headersWithUnderscoresAction": "REJECT\_REQUEST" |
|  |  | }, |
|  |  | "httpFilters": [ |
|  |  | { |
|  |  | "name": "com.google.espv2.filters.http.header\_sanitizer", |
|  |  | "typedConfig": { |
|  |  | "@type": "type.googleapis.com/espv2.api.envoy.v11.http.header\_sanitizer.FilterConfig" |
|  |  | } |
|  |  | }, |
|  |  | { |
|  |  | "name": "com.google.espv2.filters.http.grpc\_metadata\_scrubber", |
|  |  | "typedConfig": { |
| Expand Down | |  |

6 changes: 6 additions & 0 deletions

6
[src/envoy/BUILD](#diff-0086be648cf7972b6bd45d5c6a10da39df7822b63f0787e6051bfaf931ac24dc "src/envoy/BUILD")

Show comments

[View file](/GoogleCloudPlatform/esp-v2/blob/e95670146f5e96bb5565b0a9c1e153886b3e04ce/src/envoy/BUILD)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -17,6 +17,11 @@ alias( |
|  |  | actual = "//src/envoy/http/grpc\_metadata\_scrubber:filter\_factory", |
|  |  | ) |
|  |  |  |
|  |  | alias( |
|  |  | name = "header\_sanitizer", |
|  |  | actual = "//src/envoy/http/header\_sanitizer:filter\_factory", |
|  |  | ) |
|  |  |  |
|  |  | alias( |
|  |  | name = "path\_rewrite", |
|  |  | actual = "//src/envoy/http/path\_rewrite:filter\_factory", |
| Expand All | | @@ -38,6 +43,7 @@ envoy\_cc\_binary( |
|  |  | deps = [ |
|  |  | ":backend\_auth", |
|  |  | ":grpc\_metadata\_scrubber", |
|  |  | ":header\_sanitizer", |
|  |  | ":main", |
|  |  | ":path\_rewrite", |
|  |  | ":service\_control", |
| Expand Down | |  |

39 changes: 39 additions & 0 deletions

39
[src/envoy/http/header\_sanitizer/BUILD](#diff-eedcbc9196fcbb8aff05230bb5f0afd499b5eef1c7d437e85eabba4ae6a5d140 "src/envoy/http/header_sanitizer/BUILD")

Show comments

[View file](/GoogleCloudPlatform/esp-v2/blob/e95670146f5e96bb5565b0a9c1e153886b3e04ce/src/envoy/http/header_sanitizer/BUILD)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,39 @@ |
|  |  | load( |
|  |  | "@envoy//bazel:envoy\_build\_system.bzl", |
|  |  | "envoy\_cc\_library", |
|  |  | "envoy\_cc\_test", |
|  |  | ) |
|  |  |  |
|  |  | package( |
|  |  | default\_visibility = [ |
|  |  | "//src/envoy:\_\_subpackages\_\_", |
|  |  | ], |
|  |  | ) |
|  |  |  |
|  |  | envoy\_cc\_library( |
|  |  | name = "filter\_lib", |
|  |  | srcs = [ |
|  |  | "filter.cc", |
|  |  | ], |
|  |  | hdrs = [ |
|  |  | "filter.h", |
|  |  | ], |
|  |  | repository = "@envoy", |
|  |  | deps = [ |
|  |  | "//src/envoy/utils:http\_header\_utils\_lib", |
|  |  | "//src/envoy/utils:rc\_detail\_utils\_lib", |
|  |  | "@envoy//envoy/stats:stats\_interface", |
|  |  | "@envoy//source/extensions/filters/http/common:pass\_through\_filter\_lib", |
|  |  | ], |
|  |  | ) |
|  |  |  |
|  |  | envoy\_cc\_library( |
|  |  | name = "filter\_factory", |
|  |  | srcs = ["filter\_factory.cc"], |
|  |  | repository = "@envoy", |
|  |  | deps = [ |
|  |  | ":filter\_lib", |
|  |  | "//api/envoy/v11/http/header\_sanitizer:config\_proto\_cc\_proto", |
|  |  | "@envoy//source/exe:envoy\_common\_lib", |
|  |  | ], |
|  |  | ) |

49 changes: 49 additions & 0 deletions

49
[src/envoy/http/header\_sanitizer/filter.cc](#diff-3fdab465644870e5ed525baa1361e3f1186ae841e4e79f59edda4872666711b2 "src/envoy/http/header_sanitizer/filter.cc")

Show comments

[View file](/GoogleCloudPlatform/esp-v2/blob/e95670146f5e96bb5565b0a9c1e153886b3e04ce/src/envoy/http/header_sanitizer/filter.cc)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,49 @@ |
|  |  | // Copyright 2023 Google LLC |
|  |  | // |
|  |  | // Licensed under the Apache License, Version 2.0 (the "License"); |
|  |  | // you may not use this file except in compliance with the License. |
|  |  | // You may obtain a copy of the License at |
|  |  | // |
|  |  | // http://www.apache.org/licenses/LICENSE-2.0 |
|  |  | // |
|  |  | // Unless required by applicable law or agreed to in writing, software |
|  |  | // distributed under the License is distributed on an "AS IS" BASIS, |
|  |  | // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. |
|  |  | // See the License for the specific language governing permissions and |
|  |  | // limitations under the License. |
|  |  |  |
|  |  | #include "src/envoy/http/header\_sanitizer/filter.h" |
|  |  |  |
|  |  | #include <string> |
|  |  |  |
|  |  | #include "envoy/http/header\_map.h" |
|  |  | #include "source/common/http/headers.h" |
|  |  | #include "source/common/http/utility.h" |
|  |  | #include "src/envoy/utils/http\_header\_utils.h" |
|  |  | #include "src/envoy/utils/rc\_detail\_utils.h" |
|  |  |  |
|  |  | namespace espv2 { |
|  |  | namespace envoy { |
|  |  | namespace http\_filters { |
|  |  | namespace header\_sanitizer { |
|  |  |  |
|  |  | using Envoy::Http::FilterDataStatus; |
|  |  | using Envoy::Http::FilterHeadersStatus; |
|  |  | using Envoy::Http::FilterTrailersStatus; |
|  |  | using Envoy::Http::RequestHeaderMap; |
|  |  |  |
|  |  | FilterHeadersStatus Filter::decodeHeaders(RequestHeaderMap& headers, bool) { |
|  |  | if (utils::handleHttpMethodOverride(headers)) { |
|  |  | // Update later filters that the HTTP method has changed by clearing the |
|  |  | // route cache. |
|  |  | ENVOY\_LOG(debug, "HTTP method override occurred, recalculating route"); |
|  |  | decoder\_callbacks\_->downstreamCallbacks()->clearRouteCache(); |
|  |  | } |
|  |  |  |
|  |  | return FilterHeadersStatus::Continue; |
|  |  | } |
|  |  |  |
|  |  | } // namespace header\_sanitizer |
|  |  | } // namespace http\_filters |
|  |  | } // namespace envoy |
|  |  | } // namespace espv2 |

40 changes: 40 additions & 0 deletions

40
[src/envoy/http/header\_sanitizer/filter.h](#diff-41c58281972c52bba3e9a9709c16d69eba16ebc411287928896397f70ff8fb6e "src/envoy/http/header_sanitizer/filter.h")

Show comments

[View file](/GoogleCloudPlatform/esp-v2/blob/e95670146f5e96bb5565b0a9c1e153886b3e04ce/src/envoy/http/header_sanitizer/filter.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,40 @@ |
|  |  | // Copyright 2023 Google LLC |
|  |  | // |
|  |  | // Licensed under the Apache License, Version 2.0 (the "License"); |
|  |  | // you may not use this file except in compliance with the License. |
|  |  | // You may obtain a copy of the License at |
|  |  | // |
|  |  | // http://www.apache.org/licenses/LICENSE-2.0 |
|  |  | // |
|  |  | // Unless required by applicable law or agreed to in writing, software |
|  |  | // distributed under the License is distributed on an "AS IS" BASIS, |
|  |  | // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. |
|  |  | // See the License for the specific language governing permissions and |
|  |  | // limitations under the License. |
|  |  |  |
|  |  | #pragma once |
|  |  |  |
|  |  | #include "envoy/http/filter.h" |
|  |  | #include "envoy/http/header\_map.h" |
|  |  | #include "source/common/common/logger.h" |
|  |  | #include "source/extensions/filters/http/common/pass\_through\_filter.h" |
|  |  |  |
|  |  | namespace espv2 { |
|  |  | namespace envoy { |
|  |  | namespace http\_filters { |
|  |  | namespace header\_sanitizer { |
|  |  |  |
|  |  | class Filter : public Envoy::Http::PassThroughDecoderFilter, |
|  |  | public Envoy::Logger::Loggable<Envoy::Logger::Id::filter> { |
|  |  | public: |
|  |  | Filter() = default; |
|  |  |  |
|  |  | // Envoy::Http::StreamDecoderFilter |
|  |  | Envoy::Http::FilterHeadersStatus decodeHeaders(Envoy::Http::RequestHeaderMap&, |
|  |  | bool) override; |
|  |  | }; |
|  |  |  |
|  |  | } // namespace header\_sanitizer |
|  |  | } // namespace http\_filters |
|  |  | } // namespace envoy |
|  |  | } // namespace espv2 |

59 changes: 59 additions & 0 deletions

59
[src/envoy/http/header\_sanitizer/filter\_factory.cc](#diff-a8d11adbdae4184f22a70e93e7c1f2566ea71854c24c360aa8d6c7624272d199 "src/envoy/http/header_sanitizer/filter_factory.cc")

Show comments

[View file](/GoogleCloudPlatform/esp-v2/blob/e95670146f5e96bb5565b0a9c1e153886b3e04ce/src/envoy/http/header_sanitizer/filter_factory.cc)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,59 @@ |
|  |  | // Copyright 2023 Google LLC |
|  |  | // |
|  |  | // Licensed under the Apache License, Version 2.0 (the "License"); |
|  |  | // you may not use this file except in compliance with the License. |
|  |  | // You may obtain a copy of the License at |
|  |  | // |
|  |  | // http://www.apache.org/licenses/LICENSE-2.0 |
|  |  | // |
|  |  | // Unless required by applicable law or agreed to in writing, software |
|  |  | // distributed under the License is distributed on an "AS IS" BASIS, |
|  |  | // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. |
|  |  | // See the License for the specific language governing permissions and |
|  |  | // limitations under the License. |
|  |  |  |
|  |  | #include "api/envoy/v11/http/header\_sanitizer/config.pb.h" |
|  |  | #include "api/envoy/v11/http/header\_sanitizer/config.pb.validate.h" |
|  |  | #include "envoy/registry/registry.h" |
|  |  | #include "source/extensions/filters/http/common/factory\_base.h" |
|  |  | #include "src/envoy/http/header\_sanitizer/filter.h" |
|  |  |  |
|  |  | namespace espv2 { |
|  |  | namespace envoy { |
|  |  | namespace http\_filters { |
|  |  | namespace header\_sanitizer { |
|  |  |  |
|  |  | constexpr const char kFilterName[] = |
|  |  | "com.google.espv2.filters.http.header\_sanitizer"; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Config registration for ESPv2 header sanitizer filter. |
|  |  | \*/ |
|  |  | class FilterFactory |
|  |  | : public Envoy::Extensions::HttpFilters::Common::FactoryBase< |
|  |  | ::espv2::api::envoy::v11::http::header\_sanitizer::FilterConfig> { |
|  |  | public: |
|  |  | FilterFactory() : FactoryBase(kFilterName) {} |
|  |  |  |
|  |  | private: |
|  |  | Envoy::Http::FilterFactoryCb createFilterFactoryFromProtoTyped( |
|  |  | const ::espv2::api::envoy::v11::http::header\_sanitizer::FilterConfig&, |
|  |  | const std::string&, |
|  |  | Envoy::Server::Configuration::FactoryContext&) override { |
|  |  | return [](Envoy::Http::FilterChainFactoryCallbacks& callbacks) -> void { |
|  |  | auto filter = std::make\_shared<Filter>(); |
|  |  | callbacks.addStreamDecoderFilter(filter); |
|  |  | }; |
|  |  | } |
|  |  | }; |
|  |  | /\*\* |
|  |  | \* Static registration for the filter. @see RegisterFactory. |
|  |  | \*/ |
|  |  | static Envoy::Registry::RegisterFactory< |
|  |  | FilterFactory, Envoy::Server::Configuration::NamedHttpFilterConfigFactory> |
|  |  | register\_; |
|  |  |  |
|  |  | } // namespace header\_sanitizer |
|  |  | } // namespace http\_filters |
|  |  | } // namespace envoy |
|  |  | } // namespace espv2 |

7 changes: 0 additions & 7 deletions

7
[src/envoy/http/service\_control/filter.cc](#diff-61af1cb9428752568bb4a28505d2b5c35b45ea202ea21424eaf3c3ffc65749ce "src/envoy/http/service_control/filter.cc")

Show comments

[View file](/GoogleCloudPlatform/esp-v2/blob/e95670146f5e96bb5565b0a9c1e153886b3e04ce/src/envoy/http/service_control/filter.cc)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -53,13 +53,6 @@ Envoy::Http::FilterHeadersStatus ServiceControlFilter::decodeHeaders( |
|  |  | return Envoy::Http::FilterHeadersStatus::StopIteration; |
|  |  | } |
|  |  |  |
|  |  | if (utils::handleHttpMethodOverride(headers)) { |
|  |  | // Update later filters that the HTTP method has changed by clearing the |
|  |  | // route cache. |
|  |  | ENVOY\_LOG(debug, "HTTP method override occurred, recalculating route"); |
|  |  | decoder\_callbacks\_->downstreamCallbacks()->clearRouteCache(); |
|  |  | } |
|  |  |  |
|  |  | // Make sure route is calculated |
|  |  | auto route = decoder\_callbacks\_->route(); |
|  |  |  |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[src/go/configgenerator/filter\_generator.go](#diff-538d1a37e62780f130ddf5309657eca765cbf24abc36904fd5f9864c688204c7 "src/go/configgenerator/filter_generator.go")

Show comments

[View file](/GoogleCloudPlatform/esp-v2/blob/e95670146f5e96bb5565b0a9c1e153886b3e04ce/src/go/configgenerator/filter_generator.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -49,6 +49,7 @@ type FilterGenerator interface { |
|  |  | // MakeFilterGenerators provide of a slice of FilterGenerator in sequence. |
|  |  | func MakeFilterGenerators(serviceInfo \*ci.ServiceInfo) ([]FilterGenerator, error) { |
|  |  | return []FilterGenerator{ |
|  |  | &filtergen.HeaderSanitizerGenerator{}, |
|  |  | filtergen.NewCORSGenerator(serviceInfo), |
|  |  |  |
|  |  | // Health check filter is behind Path Matcher filter, since Service Control |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `e956701`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FGoogleCloudPlatform%2Fesp-v2%2Fcommit%2Fe95670146f5e96bb5565b0a9c1e153886b3e04ce) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_6e321aa5_20250115_094622.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FGoogleCloudPlatform%2Fesp-v2%2Fsecurity%2Fadvisories%2FGHSA-6qmp-9p95-fc5f)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FGoogleCloudPlatform%2Fesp-v2%2Fsecurity%2Fadvisories%2FGHSA-6qmp-9p95-fc5f)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=GoogleCloudPlatform%2Fesp-v2)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[GoogleCloudPlatform](/GoogleCloudPlatform)
/
**[esp-v2](/GoogleCloudPlatform/esp-v2)**
Public

* [Notifications](/login?return_to=%2FGoogleCloudPlatform%2Fesp-v2) You must be signed in to change notification settings
* [Fork
  170](/login?return_to=%2FGoogleCloudPlatform%2Fesp-v2)
* [Star
   275](/login?return_to=%2FGoogleCloudPlatform%2Fesp-v2)

* [Code](/GoogleCloudPlatform/esp-v2)
* [Issues
  63](/GoogleCloudPlatform/esp-v2/issues)
* [Pull requests
  17](/GoogleCloudPlatform/esp-v2/pulls)
* [Actions](/GoogleCloudPlatform/esp-v2/actions)
* [Security](/GoogleCloudPlatform/esp-v2/security)
* [Insights](/GoogleCloudPlatform/esp-v2/pulse)

Additional navigation options

* [Code](/GoogleCloudPlatform/esp-v2)
* [Issues](/GoogleCloudPlatform/esp-v2/issues)
* [Pull requests](/GoogleCloudPlatform/esp-v2/pulls)
* [Actions](/GoogleCloudPlatform/esp-v2/actions)
* [Security](/GoogleCloudPlatform/esp-v2/security)
* [Insights](/GoogleCloudPlatform/esp-v2/pulse)

# JWT authentication bypass via `X-HTTP-Method-Override` header

High

[nareddyt](/nareddyt)
published
GHSA-6qmp-9p95-fc5f
Apr 26, 2023

## Package

No package listed

## Affected versions

v2.20.0 to v2.42.0

## Patched versions

v2.43.0+

## Description

## Summary

ESPv2 contains an authentication bypass vulnerability. API clients can craft a malicious `X-HTTP-Method-Override` header value to bypass JWT authentication in specific cases.

## Background

For reference, background information on `X-HTTP-Method-Override` and JWT Authentication is copied below.

### X-HTTP-Method-Override

In certain situations (for example, when the service or its consumers are behind an overzealous corporate firewall, or if the main consumer is a web page), only the `GET` and `POST` HTTP methods might be available. In such a case, it is possible to emulate the missing verbs by passing the `X-HTTP-Method-Override` header in requests.

For example, an API client can send a `PUT` request over `POST` via the following request:

```
curl --request POST \
     --header "X-HTTP-Method-Override: PUT" \
     --header "Content-Type: application/json" \
     --data '{"username":"xyz"}' \
     https://my-endpoint.com/api
```
### JWT Authentication

ESPv2 uses JWT authentication if you followed any of the OpenAPI or gRPC tutorials below:

* [Using Firebase to authenticate users](https://cloud.google.com/endpoints/docs/openapi/authenticating-users-firebase)
* [Using Auth0 to authenticate users](https://cloud.google.com/endpoints/docs/openapi/authenticating-users-auth0)
* [Using Okta to authenticate users](https://cloud.google.com/endpoints/docs/openapi/authenticating-users-okta)
* [Using Google ID tokens to authenticate users](https://cloud.google.com/endpoints/docs/openapi/authenticating-users-google-id)
* [Using a custom method to authenticate users](https://cloud.google.com/endpoints/docs/openapi/authenticating-users-custom)
* [Authentication between services](https://cloud.google.com/endpoints/docs/openapi/service-account-authentication)

## Impact

ESPv2 allows malicious requests to bypass authentication if both the conditions are true:

1. The requested HTTP method is **not** in the API service definition (OpenAPI spec or gRPC `google.api.http` proto annotations).
2. The specified `X-HTTP-Method-Override` is a valid HTTP method in the API service definition.

ESPv2 will forward the request to your backend without checking the JWT. Attackers can craft requests with a malicious `X-HTTP-Method-Override` value that allows them to bypass specifying JWTs.

### Non-Impact

[Restricting API access with API keys](https://cloud.google.com/endpoints/docs/openapi/restricting-api-access-with-api-keys) works as intended and is **not** affected by this vulnerability.

## Example

Consider an example in which a simple REST API service accepts `POST` requests at the path `/restricted`.

```
@app.route("/restricted", methods=['POST'])
def restricted():
    message = "Accessing restricted message."
    payload = request.get_json().get('payload', '')
    return jsonify({'method':'POST', 'message': message, 'payload': payload})
```

The service is put behind ESPv2, and ESPv2 is configured to accept `POST` requests only from clients that provide a valid JWT token. Following [Using Google ID tokens to authenticate users](https://cloud.google.com/endpoints/docs/openapi/authenticating-users-google-id):

```
# config.yaml
swagger: "2.0"
info:
  title: "restrictedAPI"
  version: "1.0.0"
paths:
  "/restricted":
    post:
      summary: "Restricted path POST"
      operationId: "restrictedPost"
      security:
      - google_id_token: []
securityDefinitions:
  google_id_token:
    authorizationUrl: ""
    flow: "implicit"
    type: "oauth2"
    x-google-issuer: "https://accounts.google.com"
    x-google-jwks_uri: "https://www.googleapis.com/oauth2/v3/certs"
    x-google-audiences: "XXXXXXXXXXX.apps.googleusercontent.com"
```

If a malicious API client makes a `PUT` request and passes the `POST` method in the `X-HTTP-Method-Override` header as follows:

```
curl --request PUT  \
     --header "X-HTTP-Method-Override: POST" \
     --header "Content-Type: application/json" \
     --data '{"payload":"compromised"}' \
     https://url-to-espv2.com
```

The malicious client successfully bypasses [Using Google ID tokens to authenticate users](https://cloud.google.com/endpoints/docs/openapi/authenticating-users-google-id) without specifying a JWT:

```
{"message":"Accessing restricted method.","method":"POST","payload":"compromised"}

```
## Remediation and Mitigation

**Upgrade deployments to release v2.43.0 or higher.** This release ensures that JWT authentication occurs, even when the caller specifies `x-http-method-override`.

`x-http-method-override` is still supported by v2.43.0+. API clients can continue sending this header to ESPv2.

## Timeline

* Date disclosed to ESPv2 team: 2023-03-14
* Date fixed in ESPv2: 2023-03-28

### Severity

High

8.2

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
High

Integrity
Low

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:L/A:N

### CVE ID

CVE-2023-30845

### Weaknesses

No CWEs

### Credits

* [![@panagiotisvasilikos](https://avatars.githubusercontent.com/u/94691274?s=40&v=4)](/panagiotisvasilikos)
  [panagiotisvasilikos](/panagiotisvasilikos)
  Reporter
* [![@nareddyt](https://avatars.githubusercontent.com/u/11142171?s=40&v=4)](/nareddyt)
  [nareddyt](/nareddyt)
  Remediation developer

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_8a048a2e_20250115_094621.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FGoogleCloudPlatform%2Fesp-v2%2Fcommit%2Fe98061ee4527a564506ba4e814c0ecf324dc2c6f)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FGoogleCloudPlatform%2Fesp-v2%2Fcommit%2Fe98061ee4527a564506ba4e814c0ecf324dc2c6f)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=GoogleCloudPlatform%2Fesp-v2)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[GoogleCloudPlatform](/GoogleCloudPlatform)
/
**[esp-v2](/GoogleCloudPlatform/esp-v2)**
Public

* [Notifications](/login?return_to=%2FGoogleCloudPlatform%2Fesp-v2) You must be signed in to change notification settings
* [Fork
  170](/login?return_to=%2FGoogleCloudPlatform%2Fesp-v2)
* [Star
   275](/login?return_to=%2FGoogleCloudPlatform%2Fesp-v2)

* [Code](/GoogleCloudPlatform/esp-v2)
* [Issues
  63](/GoogleCloudPlatform/esp-v2/issues)
* [Pull requests
  17](/GoogleCloudPlatform/esp-v2/pulls)
* [Actions](/GoogleCloudPlatform/esp-v2/actions)
* [Security](/GoogleCloudPlatform/esp-v2/security)
* [Insights](/GoogleCloudPlatform/esp-v2/pulse)

Additional navigation options

* [Code](/GoogleCloudPlatform/esp-v2)
* [Issues](/GoogleCloudPlatform/esp-v2/issues)
* [Pull requests](/GoogleCloudPlatform/esp-v2/pulls)
* [Actions](/GoogleCloudPlatform/esp-v2/actions)
* [Security](/GoogleCloudPlatform/esp-v2/security)
* [Insights](/GoogleCloudPlatform/esp-v2/pulse)

## Commit

[Permalink](/GoogleCloudPlatform/esp-v2/commit/e98061ee4527a564506ba4e814c0ecf324dc2c6f)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Add back in HTTP method override in service control filter ([#802](https://github.com/GoogleCloudPlatform/esp-v2/pull/802))

[Browse files](/GoogleCloudPlatform/esp-v2/tree/e98061ee4527a564506ba4e814c0ecf324dc2c6f)
Browse the repository at this point in the history

```
This is NOT used by ESPv2, but it is needed for CAG temporarily. We can remove once their rollout is complete.

Signed-off-by: Teju Nareddy <nareddyt@google.com>
```

* Loading branch information

[![@nareddyt](https://avatars.githubusercontent.com/u/11142171?s=40&v=4)](/nareddyt)

[nareddyt](/GoogleCloudPlatform/esp-v2/commits?author=nareddyt "View all commits by nareddyt")
authored
Mar 28, 2023

1 parent
[e956701](/GoogleCloudPlatform/esp-v2/commit/e95670146f5e96bb5565b0a9c1e153886b3e04ce)

commit e98061e

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**10 additions**
and
**2 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* api

  + api/README.md
    [README.md](#diff-c7b1c23e00a1fd0378f6ea41a7dfe1c9e043d766f738dba26860c783b82e8c6a)
* src/envoy/http/service\_control

  + src/envoy/http/service\_control/filter.cc
    [filter.cc](#diff-61af1cb9428752568bb4a28505d2b5c35b45ea202ea21424eaf3c3ffc65749ce)

## There are no files selected for viewing

4 changes: 2 additions & 2 deletions

4
[api/README.md](#diff-c7b1c23e00a1fd0378f6ea41a7dfe1c9e043d766f738dba26860c783b82e8c6a "api/README.md")

Show comments

[View file](/GoogleCloudPlatform/esp-v2/blob/e98061ee4527a564506ba4e814c0ecf324dc2c6f/api/README.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -12,8 +12,8 @@ When making changes to the config proto files, make sure: |
|  |  | \* No breaking changes, the changes should be backward compatible, |
|  |  | \* If a breaking change is required, increase config version. |
|  |  |  |
|  |  | When making changes to Config Manager, make sure the new config is compatible |
|  |  | with older Envoy binaries under the current API version. If it's incompatible, |
|  |  | When making changes to Config Manager, make sure that \*\*older\*\* config generator binaries are compatible |
|  |  | with \*\*newer\*\* Envoy binaries under the current API version. If it's incompatible, |
|  |  | increase the config version. |
|  |  |  |
|  |  | ## Steps to increase config version |
| Expand Down | |  |

8 changes: 8 additions & 0 deletions

8
[src/envoy/http/service\_control/filter.cc](#diff-61af1cb9428752568bb4a28505d2b5c35b45ea202ea21424eaf3c3ffc65749ce "src/envoy/http/service_control/filter.cc")

Show comments

[View file](/GoogleCloudPlatform/esp-v2/blob/e98061ee4527a564506ba4e814c0ecf324dc2c6f/src/envoy/http/service_control/filter.cc)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -53,6 +53,14 @@ Envoy::Http::FilterHeadersStatus ServiceControlFilter::decodeHeaders( |
|  |  | return Envoy::Http::FilterHeadersStatus::StopIteration; |
|  |  | } |
|  |  |  |
|  |  | // TODO(b/273531500): Temporary until CAG rollout is complete. |
|  |  | if (utils::handleHttpMethodOverride(headers)) { |
|  |  | // Update later filters that the HTTP method has changed by clearing the |
|  |  | // route cache. |
|  |  | ENVOY\_LOG(debug, "HTTP method override occurred, recalculating route"); |
|  |  | decoder\_callbacks\_->downstreamCallbacks()->clearRouteCache(); |
|  |  | } |
|  |  |  |
|  |  | // Make sure route is calculated |
|  |  | auto route = decoder\_callbacks\_->route(); |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `e98061e`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FGoogleCloudPlatform%2Fesp-v2%2Fcommit%2Fe98061ee4527a564506ba4e814c0ecf324dc2c6f) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


