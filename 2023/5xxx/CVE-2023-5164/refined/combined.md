=== Content from plugins.trac.wordpress.org_05ca50b4_20250114_195949.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fbellows-accordion-menu%2Ftags%2F1.4.2%2Fincludes%2Fbellows.api.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/bellows-accordion-menu/trunk/includes/bellows.api.php?rev=2762012 "Revision 2762012")
* [Next Revision](/browser/bellows-accordion-menu/trunk/includes/bellows.api.php?rev=2986331 "Revision 2986331") →
* [Blame](/browser/bellows-accordion-menu/trunk/includes/bellows.api.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/bellows-accordion-menu/tags/1.4.2/includes/bellows.api.php)

---

# [source:](/browser?order=name "Go to repository root") [bellows-accordion-menu](/browser/bellows-accordion-menu?order=name "View bellows-accordion-menu")/[tags](/browser/bellows-accordion-menu/tags?order=name "View tags")/[1.4.2](/browser/bellows-accordion-menu/tags/1.4.2?order=name "View 1.4.2")/[includes](/browser/bellows-accordion-menu/tags/1.4.2/includes?order=name "View includes")/[bellows.api.php](/browser/bellows-accordion-menu/tags/1.4.2/includes/bellows.api.php?order=name "View bellows.api.php")

View diff against:

View revision:

| [Last change](/changeset/2860904/bellows-accordion-menu/trunk/includes/bellows.api.php "View differences") on this file was [2860904](/changeset/2860904/ "View changeset 2860904"), checked in by sevenspark, [2 years ago](/timeline?from=2023-02-06T15%3A23%3A58Z&precision=second "See timeline at 02/06/2023 03:23:58 PM") |
| --- |
| Committing 1.4.2 to trunk |
| **File size:** 11.7 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | function bellows\_menu\_toggle( $menu\_id, $content, $btn\_class, $args ){ |
| [4](#L4) | $content = apply\_filters( 'bellows\_menu\_toggle\_content', $content, $menu\_id, $args ); |
| [5](#L5) | $btn = '<button class="bellows-menu-toggle '.$btn\_class.'" aria-controls="'.$menu\_id.'">'.$content.'</button>'; |
| [6](#L6) | return apply\_filters( 'bellows\_menu\_toggle', $btn, $menu\_id, $args ); |
| [7](#L7) | } |
| [8](#L8) |  |
| [9](#L9) | /\*\* |
| [10](#L10) | \* Generate a Bellows menu |
| [11](#L11) | \* |
| [12](#L12) | \* If $menu\_args['echo'] is true, the menu will be printed |
| [13](#L13) | \* |
| [14](#L14) | \* |
| [15](#L15) | \*/ |
| [16](#L16) | function bellows( $config\_id = 'main' , $menu\_args = [] ){ |
| [17](#L17) |  |
| [18](#L18) | \_BELLOWS()->set\_current\_config\_id( $config\_id ); |
| [19](#L19) |  |
| [20](#L20) | $menu\_args['bellows\_source'] = 'menu'; // Default source |
| [21](#L21) | $args = bellows\_get\_nav\_menu\_args( $config\_id , $menu\_args ); |
| [22](#L22) |  |
| [23](#L23) | // Should the toggle and menu be printed |
| [24](#L24) | $print = isset( $args['echo'] ) ? $args['echo'] : true; |
| [25](#L25) |  |
| [26](#L26) | // Get the toggle based on config settings |
| [27](#L27) | $toggle = bellows\_menu\_toggle\_default( $args['container\_id'], $config\_id, $args ); |
| [28](#L28) |  |
| [29](#L29) | // If we're printing, print the toggle. |
| [30](#L30) | if( $print ){ |
| [31](#L31) | echo $toggle; |
| [32](#L32) | } |
| [33](#L33) |  |
| [34](#L34) | // Generate the menu (wp\_nav\_menu will print if we're printing) |
| [35](#L35) | $menu = wp\_nav\_menu( $args ); |
| [36](#L36) |  |
| [37](#L37) | // $menu will be empty if we're printing, but $toggle will not |
| [38](#L38) | return $toggle . $menu; |
| [39](#L39) | } |
| [40](#L40) |  |
| [41](#L41) |  |
| [42](#L42) | add\_shortcode( 'bellows' , 'bellows\_shortcode' ); |
| [43](#L43) | function bellows\_shortcode( $atts, $content = null ){ |
| [44](#L44) |  |
| [45](#L45) | extract( shortcode\_atts( array( |
| [46](#L46) | 'config\_id'                     => 'main', |
| [47](#L47) | 'theme\_location'        => '', |
| [48](#L48) | 'menu'                          => '', |
| [49](#L49) |  |
| [50](#L50) |  |
| [51](#L51) | ), $atts)); |
| [52](#L52) |  |
| [53](#L53) | $args = array(); |
| [54](#L54) | $args['echo'] = false; |
| [55](#L55) |  |
| [56](#L56) |  |
| [57](#L57) | if( $theme\_location ){ |
| [58](#L58) | $args['theme\_location'] = $theme\_location; |
| [59](#L59) | } |
| [60](#L60) | if( $menu ){ |
| [61](#L61) | $args['menu'] = $menu; |
| [62](#L62) | } |
| [63](#L63) |  |
| [64](#L64) | return bellows( $config\_id , $args ); |
| [65](#L65) |  |
| [66](#L66) |  |
| [67](#L67) | } |
| [68](#L68) |  |
| [69](#L69) | /\*\* |
| [70](#L70) | \* Numeric menu ID is required |
| [71](#L71) | \*/ |
| [72](#L72) | function bellows\_section( string $config\_id, array $menu\_args, array $section\_args ){ |
| [73](#L73) |  |
| [74](#L74) | if( !BELLOWS\_PRO ){ |
| [75](#L75) | return bellows\_admin\_notice( |
| [76](#L76) | 'Upgrade to <a href="' . BELLOWS\_PRO\_URL . '">Bellows Pro</a> to use the Bellows Menu Section feature.' , |
| [77](#L77) | false |
| [78](#L78) | ); |
| [79](#L79) | } |
| [80](#L80) |  |
| [81](#L81) | if( !isset( $menu\_args['menu'] ) ){ |
| [82](#L82) | return '<!-- No menu ID passed, cannot generate Bellows Section -->'; |
| [83](#L83) | } |
| [84](#L84) | if( !isset( $section\_args['root']) ){ |
| [85](#L85) | return '<!-- No section root passed, cannot generate Bellows Section -->'; |
| [86](#L86) | } |
| [87](#L87) |  |
| [88](#L88) | \_BELLOWS()->set\_current\_config\_id( $config\_id ); |
| [89](#L89) |  |
| [90](#L90) | $menu\_args['bellows\_source'] = 'section'; // Default source |
| [91](#L91) | $menu\_args['bellows\_section'] = $section\_args; |
| [92](#L92) | $args = bellows\_get\_nav\_menu\_args( $config\_id , $menu\_args ); |
| [93](#L93) | $args['container\_id'] = 'bellows-'.$config\_id.'-'.sanitize\_key( $menu\_args['menu'] ).'-section-'.$section\_args['root']; |
| [94](#L94) |  |
| [95](#L95) | // Should the toggle and menu be printed |
| [96](#L96) | $print = isset( $args['echo'] ) ? $args['echo'] : true; |
| [97](#L97) |  |
| [98](#L98) | // Get the toggle based on config settings |
| [99](#L99) | $toggle = bellows\_menu\_toggle\_default( $args['container\_id'], $config\_id, $args ); |
| [100](#L100) |  |
| [101](#L101) | // If we're printing, print the toggle. |
| [102](#L102) | if( $print ){ |
| [103](#L103) | echo $toggle; |
| [104](#L104) | } |
| [105](#L105) |  |
| [106](#L106) | // Generate the menu (wp\_nav\_menu will print if we're printing) |
| [107](#L107) | add\_filter( 'wp\_nav\_menu\_objects' , 'bellows\_filter\_section' , 10, 2 ); |
| [108](#L108) | $menu = wp\_nav\_menu( $args ); |
| [109](#L109) | remove\_filter( 'wp\_nav\_menu\_objects' , 'bellows\_filter\_section' , 10, 2 ); |
| [110](#L110) |  |
| [111](#L111) | // $menu will be empty if we're printing, but $toggle will not |
| [112](#L112) | return $toggle . $menu; |
| [113](#L113) | } |
| [114](#L114) |  |
| [115](#L115) | add\_shortcode( 'bellows\_section' , 'bellows\_section\_shortcode' ); |
| [116](#L116) | function bellows\_section\_shortcode( $atts, $content = null ){ |
| [117](#L117) |  |
| [118](#L118) | extract( shortcode\_atts( [ |
| [119](#L119) | 'config\_id'                     => 'main', |
| [120](#L120) | 'menu'                          => '', |
| [121](#L121) | 'root'                          => '', |
| [122](#L122) | 'include\_root'          => 'false', |
| [123](#L123) | ], $atts)); |
| [124](#L124) |  |
| [125](#L125) | $args = []; |
| [126](#L126) | $args['echo'] = false; |
| [127](#L127) |  |
| [128](#L128) |  |
| [129](#L129) | if( $menu ){ |
| [130](#L130) | $args['menu'] = $menu; |
| [131](#L131) | } |
| [132](#L132) |  |
| [133](#L133) | $include\_root = strtolower( $include\_root ) === 'true' ? true : false; |
| [134](#L134) |  |
| [135](#L135) | $section\_args = [ |
| [136](#L136) | 'root'  => $root, |
| [137](#L137) | 'include\_root' => $include\_root, |
| [138](#L138) | ]; |
| [139](#L139) |  |
| [140](#L140) | return bellows\_section( $config\_id , $args, $section\_args ); |
| [141](#L141) |  |
| [142](#L142) | } |
| [143](#L143) |  |
| [144](#L144) |  |
| [145](#L145) |  |
| [146](#L146) | function bellows\_terms( $config\_id = 'main' , $term\_args = array() , $menu\_args = array() ){ |
| [147](#L147) |  |
| [148](#L148) | if( !BELLOWS\_PRO ){ |
| [149](#L149) | return bellows\_admin\_notice( |
| [150](#L150) | 'Upgrade to <a href="' . BELLOWS\_PRO\_URL . '">Bellows Pro</a> to use the Terms Autopopulation feature.' , |
| [151](#L151) | false |
| [152](#L152) | ); |
| [153](#L153) | } |
| [154](#L154) |  |
| [155](#L155) | // If 'taxonomies' is passed, convert to 'taxonomy' |
| [156](#L156) | if( isset( $term\_args['taxonomies'] ) && !isset( $term\_args['taxonomy'] ) ){ |
| [157](#L157) | $term\_args['taxonomy'] = $term\_args['taxonomies']; |
| [158](#L158) | } |
| [159](#L159) |  |
| [160](#L160) | $term\_args\_defaults = array( |
| [161](#L161) | 'taxonomy'              => 'category', |
| [162](#L162) | 'number'                => 0, |
| [163](#L163) | 'offset'                => '', |
| [164](#L164) | 'child\_of'              => 0, |
| [165](#L165) | 'order'                 => 'ASC', |
| [166](#L166) | 'orderby'               => 'name', |
| [167](#L167) | 'hide\_empty'    => true, |
| [168](#L168) | 'hierarchical'  => true, |
| [169](#L169) | 'exclude'               => '', |
| [170](#L170) | 'counts'                => false, |
| [171](#L171) | ); |
| [172](#L172) | $term\_args = wp\_parse\_args( $term\_args, $term\_args\_defaults ); |
| [173](#L173) |  |
| [174](#L174) | // Set up meta\_term\_order custom meta query if that's the selected orderby field |
| [175](#L175) | if( $term\_args['orderby'] === 'meta\_term\_order' ){ |
| [176](#L176) | // Set up custom meta query |
| [177](#L177) | $term\_args['meta\_query'] = [ |
| [178](#L178) | 'meta\_term\_order' => [ |
| [179](#L179) | 'key' => 'order', |
| [180](#L180) | 'type' => 'NUMERIC', |
| [181](#L181) | ] |
| [182](#L182) | ]; |
| [183](#L183) | } |
| [184](#L184) |  |
| [185](#L185) |  |
| [186](#L186) | \_BELLOWS()->set\_current\_config\_id( $config\_id ); |
| [187](#L187) |  |
| [188](#L188) |  |
| [189](#L189) | $menu\_args['bellows\_source'] = 'terms'; |
| [190](#L190) | $menu\_args['bellows\_terms'] = $term\_args; |
| [191](#L191) | $menu\_args['bellows\_populate\_terms'] = true; |
| [192](#L192) |  |
| [193](#L193) | // Assign the depth, but only if it's actually set - if we set it to '', which is the default coming from |
| [194](#L194) | // the generator due to the empty string text field, that blows everything up |
| [195](#L195) | if( isset( $term\_args['depth'] ) && $term\_args['depth'] !== '' ){ |
| [196](#L196) | $menu\_args['depth'] = $term\_args['depth']; |
| [197](#L197) | } |
| [198](#L198) |  |
| [199](#L199) |  |
| [200](#L200) | $menu\_args = bellows\_get\_nav\_menu\_args( $config\_id , $menu\_args ); |
| [201](#L201) | // bellp( $menu\_args ); |
| [202](#L202) |  |
| [203](#L203) | //add\_filter( 'wp\_get\_nav\_menu\_items' , 'bellows\_populate\_terms' , 10, 3 ); |
| [204](#L204) | add\_filter( 'wp\_nav\_menu\_objects' , 'bellows\_populate\_terms' , 10, 2 ); |
| [205](#L205) | $menu = wp\_nav\_menu( $menu\_args ); |
| [206](#L206) | remove\_filter( 'wp\_nav\_menu\_objects' , 'bellows\_populate\_terms' , 10, 2 ); |
| [207](#L207) | //remove\_filter( 'wp\_get\_nav\_menu\_items' , 'bellows\_populate\_terms' , 10, 3 ); |
| [208](#L208) |  |
| [209](#L209) | //TODO: ECHO OR RETURN CHECK |
| [210](#L210) |  |
| [211](#L211) | return $menu; |
| [212](#L212) | } |
| [213](#L213) |  |
| [214](#L214) |  |
| [215](#L215) | add\_shortcode( 'bellows\_terms' , 'bellows\_terms\_shortcode' ); |
| [216](#L216) | function bellows\_terms\_shortcode( $atts, $content = null ){ |
| [217](#L217) |  |
| [218](#L218) | $term\_args = shortcode\_atts( array( |
| [219](#L219) | 'config\_id'                     => 'main', |
| [220](#L220) |  |
| [221](#L221) | 'taxonomy'                      => 'category', |
| [222](#L222) | 'number'                        => '', |
| [223](#L223) | 'offset'                        => '', |
| [224](#L224) | 'orderby'                       => 'name', |
| [225](#L225) | 'order'                         => 'ASC', |
| [226](#L226) | 'hide\_empty'            => 'true', |
| [227](#L227) | 'hierarchical'          => 'true', |
| [228](#L228) | 'child\_of'                      => 0, |
| [229](#L229) | 'depth'                         => 0, |
| [230](#L230) | 'exclude'                       => '', |
| [231](#L231) | 'counts'                        => false, |
| [232](#L232) |  |
| [233](#L233) | ), $atts); |
| [234](#L234) |  |
| [235](#L235) | extract( $term\_args ); |
| [236](#L236) |  |
| [237](#L237) | $menu\_args = array(); |
| [238](#L238) | $menu\_args['echo'] = false; |
| [239](#L239) |  |
| [240](#L240) | $taxonomies = isset( $atts['taxonomies'] ) ? $atts['taxonomies'] : $taxonomy; |
| [241](#L241) |  |
| [242](#L242) | if( $taxonomies ){ |
| [243](#L243) |  |
| [244](#L244) | unset( $term\_args['config\_id'] ); |
| [245](#L245) |  |
| [246](#L246) | //Taxonomies |
| [247](#L247) | $taxonomies = explode( ',' , $taxonomies ); |
| [248](#L248) | foreach( $taxonomies as $key => $tax ){ |
| [249](#L249) | $taxonomies[$key] = trim( $tax ); |
| [250](#L250) | } |
| [251](#L251) | $term\_args['taxonomy'] = $taxonomies; |
| [252](#L252) |  |
| [253](#L253) | //TODO: Handle booleans that are strings |
| [254](#L254) | if( $term\_args['hide\_empty'] == 'false' ) $term\_args['hide\_empty'] = false; |
| [255](#L255) | else if( $term\_args['hide\_empty'] == 'true'  ) $term\_args['hide\_empty'] = true; |
| [256](#L256) | if( $term\_args['hierarchical'] == 'false' ) $term\_args['hierarchical'] = false; |
| [257](#L257) | else if( $term\_args['hierarchical'] == 'true' ) $term\_args['hierarchical'] = true; |
| [258](#L258) |  |
| [259](#L259) | //if( $child\_of ) $term\_args['child\_of'] = $child\_of; |
| [260](#L260) |  |
| [261](#L261) | //bellp( $term\_args ); |
| [262](#L262) | return bellows\_terms( $config\_id , $term\_args , $menu\_args ); |
| [263](#L263) | } |
| [264](#L264) |  |
| [265](#L265) | //else need to set a taxonomy (alert?) |
| [266](#L266) |  |
| [267](#L267) | } |
| [268](#L268) |  |
| [269](#L269) |  |
| [270](#L270) |  |
| [271](#L271) |  |
| [272](#L272) | function bellows\_posts( $config\_id = 'main' , $post\_args = array() , $menu\_args = array( 'echo' => true ) ){ |
| [273](#L273) |  |
| [274](#L274) | if( !BELLOWS\_PRO ){ |
| [275](#L275) | return bellows\_admin\_notice( |
| [276](#L276) | 'Upgrade to <a href="' . BELLOWS\_PRO\_URL . '">Bellows Pro</a> to use the Posts Autopopulation feature.' , |
| [277](#L277) | false |
| [278](#L278) | ); |
| [279](#L279) | } |
| [280](#L280) |  |
| [281](#L281) | $post\_arg\_defaults = array( |
| [282](#L282) | 'post\_type'             => 'page', |
| [283](#L283) | 'post\_parent'   => '', //0, |
| [284](#L284) | 'include\_parent' => false, |
| [285](#L285) | 'numberposts'   => -1, |
| [286](#L286) | 'offset'                => 0, |
| [287](#L287) | 'orderby'               => 'title', |
| [288](#L288) | 'order'                 => 'ASC', |
| [289](#L289) | 'author'                => '', |
| [290](#L290) | 'cat'                   => '', //ID |
| [291](#L291) | 'category\_\_and' => '', |
| [292](#L292) | 'category\_\_in'  => '', |
| [293](#L293) | 'tag\_id'                        => '', //ID |
| [294](#L294) | 'tag\_\_and'              => '', |
| [295](#L295) | 'tag\_\_in'               => '', |
| [296](#L296) | 'depth'                 => 2, |
| [297](#L297) | 'exclude'               => '', |
| [298](#L298) |  |
| [299](#L299) | ); |
| [300](#L300) |  |
| [301](#L301) | $taxonomies = get\_taxonomies( array( |
| [302](#L302) | 'public'        => true, |
| [303](#L303) | //'\_builtin'    => true, |
| [304](#L304) | ) ); |
| [305](#L305) | foreach( $taxonomies as $tax\_name ){ |
| [306](#L306) | $post\_arg\_defaults['tax\_'.$tax\_name] = ''; |
| [307](#L307) | } |
| [308](#L308) |  |
| [309](#L309) | $post\_args = wp\_parse\_args( $post\_args, $post\_arg\_defaults ); |
| [310](#L310) | //bellp( $post\_args ); |
| [311](#L311) |  |
| [312](#L312) | //Inherit current page as parent |
| [313](#L313) | if( $post\_args['post\_parent'] < 0 ){ |
| [314](#L314) | $post\_args['post\_parent'] = bellows\_get\_dynamic\_post\_parent( $post\_args['post\_parent'] ); |
| [315](#L315) | } |
| [316](#L316) | //bellp( $post\_args ); |
| [317](#L317) |  |
| [318](#L318) | foreach( $post\_args as $arg\_name => $val ){ |
| [319](#L319) |  |
| [320](#L320) | //Expand taxonomy queries |
| [321](#L321) | if( $val && strpos( $arg\_name , 'tax\_' ) === 0 ){ |
| [322](#L322) | $tax\_id = substr( $arg\_name , 4 ); |
| [323](#L323) | unset( $post\_args[$arg\_name] ); |
| [324](#L324) |  |
| [325](#L325) | if( !isset( $post\_args['tax\_query'] ) ){ |
| [326](#L326) | $post\_args['tax\_query'] = array(); |
| [327](#L327) | } |
| [328](#L328) | $post\_args['tax\_query'][] = array( |
| [329](#L329) | 'taxonomy'      => $tax\_id, |
| [330](#L330) | 'field'         => 'term\_id', |
| [331](#L331) | 'terms'         => $val, |
| [332](#L332) | ); |
| [333](#L333) | } |
| [334](#L334) | } |
| [335](#L335) | //bellp( $post\_args ); |
| [336](#L336) |  |
| [337](#L337) | \_BELLOWS()->set\_current\_config\_id( $config\_id ); |
| [338](#L338) |  |
| [339](#L339) |  |
| [340](#L340) | $menu\_args['bellows\_source'] = 'posts'; |
| [341](#L341) | $menu\_args['bellows\_posts'] = $post\_args; |
| [342](#L342) | $menu\_args['bellows\_populate\_posts'] = true; |
| [343](#L343) |  |
| [344](#L344) | $menu\_args = bellows\_get\_nav\_menu\_args( $config\_id , $menu\_args ); |
| [345](#L345) |  |
| [346](#L346) | //bellp( get\_term( 73, 'nav\_menu' ) ); |
| [347](#L347) |  |
| [348](#L348) | // bellp( $post\_args ); |
| [349](#L349) | // bellp( $menu\_args ); |
| [350](#L350) |  |
| [351](#L351) | //add\_filter( 'wp\_get\_nav\_menu\_items' , 'bellows\_populate\_terms' , 10, 3 ); |
| [352](#L352) | //add\_filter( 'wp\_get\_nav\_menu\_object' , 'bellows\_dummy\_menu\_object' , 10 ); |
| [353](#L353) | add\_filter( 'wp\_nav\_menu\_objects' , 'bellows\_populate\_posts' , 10, 2 ); |
| [354](#L354) | $menu = wp\_nav\_menu( $menu\_args ); |
| [355](#L355) | remove\_filter( 'wp\_nav\_menu\_objects' , 'bellows\_populate\_posts' , 10, 2 ); |
| [356](#L356) | //remove\_filter( 'wp\_get\_nav\_menu\_items' , 'bellows\_populate\_terms' , 10, 3 ); |
| [357](#L357) |  |
| [358](#L358) | //TODO: ECHO OR RETURN CHECK |
| [359](#L359) | return $menu; |
| [360](#L360) |  |
| [361](#L361) | } |
| [362](#L362) |  |
| [363](#L363) | function bellows\_posts\_shortcode( $atts, $content = null ){ |
| [364](#L364) |  |
| [365](#L365) | $post\_arg\_defaults = array( |
| [366](#L366) | 'config\_id'                     => 'main', |
| [367](#L367) | 'post\_type'                     => 'page', |
| [368](#L368) | 'post\_parent'           => '', |
| [369](#L369) | 'include\_parent'        => false, |
| [370](#L370) | 'numberposts'           => -1, |
| [371](#L371) | 'orderby'                       => 'title', |
| [372](#L372) | 'order'                         => 'ASC', |
| [373](#L373) | 'depth'                         => 2, |
| [374](#L374) | 'exclude'                       => '', |
| [375](#L375) | ); |
| [376](#L376) | $taxonomies = get\_taxonomies( array( |
| [377](#L377) | 'public'        => true, |
| [378](#L378) | //'\_builtin'    => true, |
| [379](#L379) | ) ); |
| [380](#L380) | foreach( $taxonomies as $tax\_name ){ |
| [381](#L381) | $post\_arg\_defaults['tax\_'.$tax\_name] = ''; |
| [382](#L382) | } |
| [383](#L383) |  |
| [384](#L384) | $post\_args = shortcode\_atts( $post\_arg\_defaults , $atts); |
| [385](#L385) |  |
| [386](#L386) | extract( $post\_args ); |
| [387](#L387) |  |
| [388](#L388) | //Menu Arguments |
| [389](#L389) | $menu\_args = array(); |
| [390](#L390) | $menu\_args['echo'] = false; |
| [391](#L391) |  |
| [392](#L392) |  |
| [393](#L393) | //Post Query Arguments |
| [394](#L394) | unset( $post\_args['config\_id'] ); |
| [395](#L395) |  |
| [396](#L396) |  |
| [397](#L397) | // Handle booleans that are strings |
| [398](#L398) | if( $post\_args['include\_parent'] === 'false' ) $post\_args['include\_parent'] = false; |
| [399](#L399) | else if( $post\_args['include\_parent'] === 'true'  ) $post\_args['include\_parent'] = true; |
| [400](#L400) |  |
| [401](#L401) |  |
| [402](#L402) | return bellows\_posts( $config\_id , $post\_args , $menu\_args ); |
| [403](#L403) |  |
| [404](#L404) | } |
| [405](#L405) | add\_shortcode( 'bellows\_posts' , 'bellows\_posts\_shortcode' ); |
| [406](#L406) |  |
| [407](#L407) |  |
| [408](#L408) |  |
| [409](#L409) |  |
| [410](#L410) |  |
| [411](#L411) | function bellows\_menu( $query\_id , $menu\_args = array() ){ |
| [412](#L412) |  |
| [413](#L413) | if( !$query\_id ){ |
| [414](#L414) | bellows\_admin\_notice( 'No Saved Query ID provided, cannot display menu' ); |
| [415](#L415) | return; |
| [416](#L416) | } |
| [417](#L417) |  |
| [418](#L418) | $query = get\_post( $query\_id ); |
| [419](#L419) | if( $query->post\_type != 'bellows\_query' ){ |
| [420](#L420) | bellows\_admin\_notice( 'Post is not a Bellow Query ' . '['.$query\_id.'].' ); |
| [421](#L421) | return; |
| [422](#L422) | } |
| [423](#L423) |  |
| [424](#L424) |  |
| [425](#L425) | $query\_type = get\_post\_meta( $query\_id , 'query\_type' , true ); |
| [426](#L426) | $query\_args = get\_post\_meta( $query\_id , 'query\_args' , true ); |
| [427](#L427) | //bellp( $query\_args ); |
| [428](#L428) | $config\_id = $query\_args['config\_id']; |
| [429](#L429) | unset( $query\_args['config\_id'] ); |
| [430](#L430) |  |
| [431](#L431) | switch( $query\_type ){ |
| [432](#L432) | case 'post': |
| [433](#L433) | return bellows\_posts( $config\_id , $query\_args , $menu\_args ); |
| [434](#L434) | break; |
| [435](#L435) | case 'term': |
| [436](#L436) | //Convert saved string to array if necessary |
| [437](#L437) | $taxonomies = explode( ',' , $query\_args['taxonomies'] ); |
| [438](#L438) | foreach( $taxonomies as $key => $tax ){ |
| [439](#L439) | $taxonomies[$key] = trim( $tax ); |
| [440](#L440) | } |
| [441](#L441) | $query\_args['taxonomies'] = $taxonomies; |
| [442](#L442) |  |
| [443](#L443) | return bellows\_terms( $config\_id , $query\_args , $menu\_args ); |
| [444](#L444) | break; |
| [445](#L445) |  |
| [446](#L446) | default: |
| [447](#L447) | break; |
| [448](#L448) | } |
| [449](#L449) |  |
| [450](#L450) |  |
| [451](#L451) | } |
| [452](#L452) | function bellows\_menu\_shortcode( $atts , $content = null ){ |
| [453](#L453) | $defaults = array( |
| [454](#L454) | 'qid'   => 0, |
| [455](#L455) | ); |
| [456](#L456) | extract( shortcode\_atts( $defaults , $atts ) ); |
| [457](#L457) |  |
| [458](#L458) | return bellows\_menu( $qid , array( 'echo' => false )); |
| [459](#L459) | } |
| [460](#L460) | add\_shortcode( 'bellows\_menu' , 'bellows\_menu\_shortcode' ); |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/bellows-accordion-menu/tags/1.4.2/includes/bellows.api.php?format=txt)
* [Original Format](/export/3222464/bellows-accordion-menu/tags/1.4.2/includes/bellows.api.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_53f97512_20250114_195955.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fbellows-accordion-menu%2Ftags%2F1.4.2%2Fincludes%2Ffunctions.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/bellows-accordion-menu/trunk/includes/functions.php?rev=2602032 "Revision 2602032")
* [Next Revision](/browser/bellows-accordion-menu/trunk/includes/functions.php?rev=2986331 "Revision 2986331") →
* [Blame](/browser/bellows-accordion-menu/trunk/includes/functions.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/bellows-accordion-menu/tags/1.4.2/includes/functions.php)

---

# [source:](/browser?order=name "Go to repository root") [bellows-accordion-menu](/browser/bellows-accordion-menu?order=name "View bellows-accordion-menu")/[tags](/browser/bellows-accordion-menu/tags?order=name "View tags")/[1.4.2](/browser/bellows-accordion-menu/tags/1.4.2?order=name "View 1.4.2")/[includes](/browser/bellows-accordion-menu/tags/1.4.2/includes?order=name "View includes")/[functions.php](/browser/bellows-accordion-menu/tags/1.4.2/includes/functions.php?order=name "View functions.php")

View diff against:

View revision:

| [Last change](/changeset/2860904/bellows-accordion-menu/trunk/includes/functions.php "View differences") on this file was [2860904](/changeset/2860904/ "View changeset 2860904"), checked in by sevenspark, [2 years ago](/timeline?from=2023-02-06T15%3A23%3A58Z&precision=second "See timeline at 02/06/2023 03:23:58 PM") |
| --- |
| Committing 1.4.2 to trunk |
| **File size:** 6.9 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | require\_once( BELLOWS\_DIR . 'includes/asset.loader.php' ); |
| [4](#L4) | require\_once( BELLOWS\_DIR . 'includes/skins.php' ); |
| [5](#L5) | require\_once( BELLOWS\_DIR . 'includes/widget.php' ); |
| [6](#L6) |  |
| [7](#L7) | function bellows\_get\_nav\_menu\_args( $config\_id , $args = array() ){ |
| [8](#L8) |  |
| [9](#L9) | $args['container']                      = bellows\_op( 'container\_tag' , $config\_id ); |
| [10](#L10) | $args['container\_class']        = 'bellows bellows-nojs'; |
| [11](#L11) | $args['menu\_class']                     = 'bellows-nav'; |
| [12](#L12) | $args['items\_wrap']                     = '<'.BELLOWS\_GROUP\_TAG.' id="%1$s" class="%2$s" data-bellows-config="'.$config\_id.'">%3$s</'.BELLOWS\_GROUP\_TAG.'>'; |
| [13](#L13) | $args['walker']                         = new BellowsWalker; |
| [14](#L14) |  |
| [15](#L15) | $args['bellows\_config']         = $config\_id; |
| [16](#L16) |  |
| [17](#L17) | //TODO: ALLOW ID TO BE OVERRIDDEN, HANDLE TAXONOMY TYPE - OR MAYBE DONT AUTO GENERATE ID AT ALL |
| [18](#L18) |  |
| [19](#L19) | //Get the menu ID and theme location |
| [20](#L20) | $nav\_menu\_id = 0; |
| [21](#L21) | $theme\_location = 0; |
| [22](#L22) | if( isset( $args['menu'] ) && $args['menu'] ){ |
| [23](#L23) | $nav\_menu\_id = $args['menu']; |
| [24](#L24) | } |
| [25](#L25) | else if( isset( $args['theme\_location'] ) && $args['theme\_location'] ){ |
| [26](#L26) | $theme\_location = $args['theme\_location']; |
| [27](#L27) | \_BELLOWS()->count\_theme\_location( $theme\_location ); |
| [28](#L28) | if( $theme\_location && has\_nav\_menu( $theme\_location ) ){ |
| [29](#L29) | $menus = get\_nav\_menu\_locations(); |
| [30](#L30) | $nav\_menu\_id = $menus[$theme\_location]; |
| [31](#L31) | } |
| [32](#L32) | } |
| [33](#L33) | //Make sure nav menu ID is a string so that it can be used as part of the ID |
| [34](#L34) | if( is\_object( $nav\_menu\_id ) ){ |
| [35](#L35) | if( isset( $nav\_menu\_id->term\_id ) ){ |
| [36](#L36) | $nav\_menu\_id = $nav\_menu\_id->term\_id; |
| [37](#L37) | } |
| [38](#L38) | else{ |
| [39](#L39) | $nav\_menu\_id = '\_bad\_id\_'; |
| [40](#L40) | } |
| [41](#L41) | } |
| [42](#L42) | $args['\_\_bellows\_menu\_id'] = $nav\_menu\_id; |
| [43](#L43) | \_BELLOWS()->count\_menu\_instance( $nav\_menu\_id ); |
| [44](#L44) |  |
| [45](#L45) | //ID |
| [46](#L46) | $args['container\_id']           = 'bellows-'.$config\_id.'-'.sanitize\_key( $nav\_menu\_id ); |
| [47](#L47) | if( $theme\_location ){ |
| [48](#L48) | $args['container\_id'].='-'.sanitize\_key( $theme\_location ); |
| [49](#L49) | $theme\_location\_count = \_BELLOWS()->get\_theme\_location\_count( $theme\_location ); |
| [50](#L50) | if( $theme\_location\_count > 1 ){ |
| [51](#L51) | $args['container\_id'].= '-'.$theme\_location\_count; |
| [52](#L52) | } |
| [53](#L53) | } |
| [54](#L54) | else{ |
| [55](#L55) | $menu\_instance\_count = \_BELLOWS()->get\_menu\_instance\_count( $nav\_menu\_id ); |
| [56](#L56) | if( $menu\_instance\_count > 1 ){ |
| [57](#L57) | $args['container\_id'].= '-'.$menu\_instance\_count; |
| [58](#L58) | } |
| [59](#L59) | } |
| [60](#L60) |  |
| [61](#L61) | //Config |
| [62](#L62) | $args['container\_class']        .= ' bellows-'.$config\_id; |
| [63](#L63) |  |
| [64](#L64) | //Source |
| [65](#L65) | $args['container\_class']        .= ' bellows-source-'.$args['bellows\_source']; |
| [66](#L66) |  |
| [67](#L67) | //Alignment |
| [68](#L68) | $args['container\_class']        .= ' bellows-align-' . bellows\_op( 'menu\_align' , $config\_id ); |
| [69](#L69) |  |
| [70](#L70) | //Skin |
| [71](#L71) | $args['container\_class']        .= ' bellows-skin-' . bellows\_op( 'skin' , $config\_id ); |
| [72](#L72) |  |
| [73](#L73) | //Tree |
| [74](#L74) | $args['container\_class']        .= ' bellows-type-' . bellows\_op( 'menu\_type', $config\_id ); |
| [75](#L75) |  |
| [76](#L76) | // Expand Current |
| [77](#L77) | $args['container\_class']        .= bellows\_op( 'current\_expansion' , $config\_id ) === 'on' ? ' bellows-expand-current' : ''; |
| [78](#L78) |  |
| [79](#L79) | //Mobile collapse |
| [80](#L80) | if( bellows\_op( 'mobile\_collapse', $config\_id ) === 'on' ){ |
| [81](#L81) | $args['container\_class'].= ' bellows-mobile-collapse'; |
| [82](#L82) | } |
| [83](#L83) |  |
| [84](#L84) | return $args; |
| [85](#L85) | } |
| [86](#L86) |  |
| [87](#L87) | function bellows\_menu\_toggle\_default( $menu\_id, $config\_id, $args ){ |
| [88](#L88) |  |
| [89](#L89) | if( bellows\_op( 'mobile\_collapse', $config\_id ) !== 'on' ) return ''; |
| [90](#L90) |  |
| [91](#L91) | $text = bellows\_op( 'toggle\_text', $config\_id ); |
| [92](#L92) | // bellp( $args ); |
| [93](#L93) | $localized = \_\_( 'Menu', 'bellows' ); |
| [94](#L94) | switch( $text ){ |
| [95](#L95) | case '': |
| [96](#L96) | $text = $localized; |
| [97](#L97) | break; |
| [98](#L98) | case ' ': |
| [99](#L99) | $text = ''; |
| [100](#L100) | break; |
| [101](#L101) | case '{menu\_name}': |
| [102](#L102) | if( isset( $args['\_\_bellows\_menu\_id'] ) ){ |
| [103](#L103) | $nav\_menu\_ob = wp\_get\_nav\_menu\_object( $args['\_\_bellows\_menu\_id'] ); |
| [104](#L104) | $text = $nav\_menu\_ob ? $nav\_menu\_ob->name : ''; |
| [105](#L105) | } |
| [106](#L106) | else{ |
| [107](#L107) | $text = $localized; |
| [108](#L108) | } |
| [109](#L109) | break; |
| [110](#L110) | default: |
| [111](#L111) | $text = do\_shortcode( $text ); |
| [112](#L112) | break; |
| [113](#L113) | } |
| [114](#L114) |  |
| [115](#L115) | $text = '<span class="bellows-menu-toggle-text">'.apply\_filters( 'bellow\_menu\_toggle\_default\_text', $text, $menu\_id, $args ).'</span>'; |
| [116](#L116) |  |
| [117](#L117) |  |
| [118](#L118) | $icon = '<i class="fa fa-bars"></i>'; |
| [119](#L119) |  |
| [120](#L120) | $content = $icon. ' ' .$text; |
| [121](#L121) |  |
| [122](#L122) | $skin = bellows\_op( 'skin' , $config\_id ); |
| [123](#L123) | $btn\_class = "bellows-menu-toggle-skin-$skin"; |
| [124](#L124) | return bellows\_menu\_toggle( $menu\_id, $content, $btn\_class, $args ); |
| [125](#L125) | } |
| [126](#L126) |  |
| [127](#L127) | function bellows\_get\_dynamic\_post\_parent( $dpp ){ |
| [128](#L128) | global $post; |
| [129](#L129) |  |
| [130](#L130) | if( $post && $post->ID ){ |
| [131](#L131) | switch( $dpp ){ |
| [132](#L132) | // Current item |
| [133](#L133) | case -1: |
| [134](#L134) | return $post->ID; |
| [135](#L135) | break; |
| [136](#L136) | // Current Parent |
| [137](#L137) | case -2: |
| [138](#L138) | //Parent item |
| [139](#L139) | //If this is a top level item, just use this ID |
| [140](#L140) | if( $post->post\_parent == 0 ) return $post->ID; |
| [141](#L141) | else return $post->post\_parent; |
| [142](#L142) | break; |
| [143](#L143) | // Current Root |
| [144](#L144) | case -3: |
| [145](#L145) | //Root item |
| [146](#L146) | //If this is a top level item, just use this ID |
| [147](#L147) | if( $post->post\_parent == 0 ){ |
| [148](#L148) | return $post->ID; |
| [149](#L149) | } |
| [150](#L150) | //Otherwise, find the root |
| [151](#L151) | else{ |
| [152](#L152) | $ancestors = get\_post\_ancestors( $post ); |
| [153](#L153) | return $ancestors ? $ancestors[count($ancestors) - 1] : $post->ID; |
| [154](#L154) | } |
| [155](#L155) | break; |
| [156](#L156) |  |
| [157](#L157) | default: |
| [158](#L158) | //invalid |
| [159](#L159) | } |
| [160](#L160) |  |
| [161](#L161) | // This would prevent the post parent from ever being set to 0, which would return all top level items |
| [162](#L162) | // if( $dpp == 0 ){ |
| [163](#L163) | //      return $post->ID; |
| [164](#L164) | // } |
| [165](#L165) |  |
| [166](#L166) | } |
| [167](#L167) | } |
| [168](#L168) |  |
| [169](#L169) |  |
| [170](#L170) | /\* Translation files \*/ |
| [171](#L171) | add\_action( 'plugins\_loaded' , 'bellows\_load\_textdomain' ); |
| [172](#L172) | function bellows\_load\_textdomain(){ |
| [173](#L173) | $domain = 'bellows'; |
| [174](#L174) | load\_plugin\_textdomain( $domain , false , BELLOWS\_BASEDIR.'/languages' ); |
| [175](#L175) |  |
| [176](#L176) | $locale = apply\_filters( 'plugin\_locale', get\_locale(), $domain ); |
| [177](#L177) | load\_textdomain( $domain, trailingslashit( WP\_LANG\_DIR ) . $domain . '/' . $domain . '-' . $locale . '.mo' ); |
| [178](#L178) | } |
| [179](#L179) |  |
| [180](#L180) |  |
| [181](#L181) |  |
| [182](#L182) | /\*\* Admin Notices \*\*/ |
| [183](#L183) | function bellows\_user\_is\_admin(){ |
| [184](#L184) | return current\_user\_can( 'manage\_options' ); |
| [185](#L185) | } |
| [186](#L186) |  |
| [187](#L187) | function bellows\_admin\_notice( $content , $echo = true ){ |
| [188](#L188) | //$showtips = false; |
| [189](#L189) |  |
| [190](#L190) | if( bellows\_op( 'admin\_notices' , 'general' ) == 'on' ){ |
| [191](#L191) | if( bellows\_user\_is\_admin() ){ |
| [192](#L192) | $notice = '<div class="bellows-admin-notice"><i class="bellows-admin-notice-icon fa fa-lightbulb-o"></i>'.$content.'</div>'; |
| [193](#L193) |  |
| [194](#L194) | if( $echo ) echo $notice; |
| [195](#L195) | return $notice; |
| [196](#L196) | } |
| [197](#L197) | } |
| [198](#L198) |  |
| [199](#L199) | } |
| [200](#L200) |  |
| [201](#L201) |  |
| [202](#L202) | add\_filter( 'plugin\_action\_links\_'.BELLOWS\_BASENAME , 'bellows\_action\_links' ); |
| [203](#L203) | function bellows\_action\_links( $links ) { |
| [204](#L204) | $links[] = '<a href="'. admin\_url( 'themes.php?page=bellows-settings' ) .'">Control Panel</a>'; |
| [205](#L205) | $links[] = '<a target="\_blank" href="'.BELLOWS\_KB\_URL.'">Knowledgebase</a>'; |
| [206](#L206) | return $links; |
| [207](#L207) | } |
| [208](#L208) |  |
| [209](#L209) |  |
| [210](#L210) | function bellows\_get\_support\_url(){ |
| [211](#L211) | return \_BELLOWS()->get\_support\_url(); |
| [212](#L212) | } |
| [213](#L213) |  |
| [214](#L214) |  |
| [215](#L215) |  |
| [216](#L216) |  |
| [217](#L217) | function bellows\_get\_menu\_item\_data( $item\_id ){ |
| [218](#L218) | $meta = get\_post\_meta( $item\_id , BELLOWS\_MENU\_ITEM\_META\_KEY , true ); |
| [219](#L219) |  |
| [220](#L220) | //Add URL for image |
| [221](#L221) | if( !empty( $meta['item\_image'] ) ){ |
| [222](#L222) | $src = wp\_get\_attachment\_image\_src( $meta['item\_image'] ); |
| [223](#L223) | if( $src ){ |
| [224](#L224) | $meta['item\_image\_url'] = $src[0]; |
| [225](#L225) | $meta['item\_image\_edit'] = get\_edit\_post\_link( $meta['item\_image'], 'raw' ); |
| [226](#L226) | } |
| [227](#L227) | } |
| [228](#L228) |  |
| [229](#L229) | return $meta; |
| [230](#L230) | } |
| [231](#L231) |  |
| [232](#L232) |  |
| [233](#L233) | add\_filter( 'wp\_nav\_menu\_args' , 'bellows\_force\_prefilter' , 1 , 1 ); |
| [234](#L234) | function bellows\_force\_prefilter($args){ |
| [235](#L235) |  |
| [236](#L236) | if( bellows\_op( 'force\_override\_theme\_filters' , 'general' ) != 'off' ){ |
| [237](#L237) | if( isset( $args['bellows\_config'] ) ){ |
| [238](#L238) | $args['bellows\_args'] = $args; |
| [239](#L239) | } |
| [240](#L240) | } |
| [241](#L241) | return $args; |
| [242](#L242) | } |
| [243](#L243) |  |
| [244](#L244) | add\_filter( 'wp\_nav\_menu\_args' , 'bellows\_force\_refilter' , 999999 , 1 ); |
| [245](#L245) | function bellows\_force\_refilter($args){ |
| [246](#L246) | if( bellows\_op( 'force\_override\_theme\_filters' , 'general' ) != 'off' ){ |
| [247](#L247) | if( isset( $args['bellows\_args'] ) ){ |
| [248](#L248) | $args = $args['bellows\_args']; |
| [249](#L249) | } |
| [250](#L250) | } |
| [251](#L251) | return $args; |
| [252](#L252) | } |
| [253](#L253) |  |
| [254](#L254) |  |
| [255](#L255) |  |
| [256](#L256) | function bellp( $d ){ |
| [257](#L257) | echo '<pre>'; |
| [258](#L258) | print\_r( $d ); |
| [259](#L259) | echo '</pre>'; |
| [260](#L260) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/bellows-accordion-menu/tags/1.4.2/includes/functions.php?format=txt)
* [Original Format](/export/3222464/bellows-accordion-menu/tags/1.4.2/includes/functions.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_f3aaeb25_20250114_195956.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Bellows Accordion Menu <= 1.4.2 - Authenticated (Contributor+) Stored Cross-Site Scripting via Shortcode

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Bellows Accordion Menu <= 1.4.2 - Authenticated (Contributor+) Stored Cross-Site Scripting via Shortcode

6.4

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N)

| CVE | [CVE-2023-5164](https://www.cve.org/CVERecord?id=CVE-2023-5164) |
| --- | --- |
| CVSS | 6.4 (Medium) |
| Publicly Published | October 29, 2023 |
| Last Updated | January 22, 2024 |
| Researcher | [István Márton - Wordfence](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/lana-codes) |

### Description

The Bellows Accordion Menu plugin for WordPress is vulnerable to Stored Cross-Site Scripting via shortcodes in versions up to, and including, 1.4.2 due to insufficient input sanitization and output escaping on user supplied attributes. This makes it possible for authenticated attackers with contributor-level and above permissions to inject arbitrary web scripts in pages that will execute whenever a user accesses an injected page.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/bellows-accordion-menu/tags/1.4.2/includes/functions.php#L12)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/bellows-accordion-menu/tags/1.4.2/includes/bellows.api.php#L5)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&new=2986331%40bellows-accordion-menu%2Ftrunk&old=2860904%40bellows-accordion-menu%2Ftrunk&sfp_email=&sfph_mail=)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fbellows-accordion-menu%2Fbellows-accordion-menu-142-authenticated-contributor-stored-cross-site-scripting-via-shortcode&t=Bellows%20Accordion%20Menu%20%3C%3D%201.4.2%20-%20Authenticated%20%28Contributor%2B%29%20Stored%20Cross-Site%20Scripting%20via%20Shortcode "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fbellows-accordion-menu%2Fbellows-accordion-menu-142-authenticated-contributor-stored-cross-site-scripting-via-shortcode&text=Bellows%20Accordion%20Menu%20%3C%3D%201.4.2%20-%20Authenticated%20%28Contributor%2B%29%20Stored%20Cross-Site%20Scripting%20via%20Shortcode "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fbellows-accordion-menu%2Fbellows-accordion-menu-142-authenticated-contributor-stored-cross-site-scripting-via-shortcode "LinkedIn")
Email

## Vulnerability Details for Bellows Accordion Menu

#### [Bellows Accordion Menu](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/bellows-accordion-menu)

| Software Type | Plugin |
| --- | --- |
| Software Slug | bellows-accordion-menu [(view on wordpress.org)](https://wordpress.org/plugins/bellows-accordion-menu) |
| Patched? | Yes |
| Remediation | Update to version 1.4.3, or a newer patched version |
| Affected Version | * <= 1.4.2 |
| Patched Version | * 1.4.3 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation


