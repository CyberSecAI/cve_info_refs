=== Content from www.wordfence.com_87cfcb75_20250115_100022.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Debug Log Manager <= 2.2.0 - Cross-Site Request Forgery

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Debug Log Manager <= 2.2.0 - Cross-Site Request Forgery

4.3

**Cross-Site Request Forgery (CSRF)**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:L/A:N)

| CVE | [CVE-2023-5772](https://www.cve.org/CVERecord?id=CVE-2023-5772) |
| --- | --- |
| CVSS | 4.3 (Medium) |
| Publicly Published | November 29, 2023 |
| Last Updated | December 11, 2023 |
| Researcher | [Dmitrii Ignatyev - CleanTalk Inc](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/dmitrii) |

### Description

The Debug Log Manager plugin for WordPress is vulnerable to Cross-Site Request Forgery in all versions up to, and including, 2.2.1. This is due to missing or incorrect nonce validation on the clear\_log() function. This makes it possible for unauthenticated attackers to clear the debug log via a forged request granted they can trick a site administrator into performing an action such as clicking on a link.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/debug-log-manager/tags/2.2.0/classes/class-debug-log.php#L822)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/debug-log-manager/tags/2.2.2/classes/class-debug-log.php#L828)
* [research.cleantalk.org](https://research.cleantalk.org/cve-2023-5772-debug-log-manager-csrf-to-clear-error-logs-poc/)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fdebug-log-manager%2Fdebug-log-manager-220-cross-site-request-forgery&t=Debug%20Log%20Manager%20%3C%3D%202.2.0%20-%20Cross-Site%20Request%20Forgery "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fdebug-log-manager%2Fdebug-log-manager-220-cross-site-request-forgery&text=Debug%20Log%20Manager%20%3C%3D%202.2.0%20-%20Cross-Site%20Request%20Forgery "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fdebug-log-manager%2Fdebug-log-manager-220-cross-site-request-forgery "LinkedIn")
Email

## Vulnerability Details for Debug Log Manager

#### [Debug Log Manager](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/debug-log-manager)

| Software Type | Plugin |
| --- | --- |
| Software Slug | debug-log-manager [(view on wordpress.org)](https://wordpress.org/plugins/debug-log-manager) |
| Patched? | Yes |
| Remediation | Update to version 2.2.2, or a newer patched version |
| Affected Version | * <= 2.2.1 |
| Patched Version | * 2.2.2 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_ac255b1f_20250115_100020.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fdebug-log-manager%2Ftags%2F2.2.2%2Fclasses%2Fclass-debug-log.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Blame](/browser/debug-log-manager/tags/2.2.2/classes/class-debug-log.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/debug-log-manager/tags/2.2.2/classes/class-debug-log.php)

---

# [source:](/browser?order=name "Go to repository root") [debug-log-manager](/browser/debug-log-manager?order=name "View debug-log-manager")/[tags](/browser/debug-log-manager/tags?order=name "View tags")/[2.2.2](/browser/debug-log-manager/tags/2.2.2?order=name "View 2.2.2")/[classes](/browser/debug-log-manager/tags/2.2.2/classes?order=name "View classes")/[class-debug-log.php](/browser/debug-log-manager/tags/2.2.2/classes/class-debug-log.php?order=name "View class-debug-log.php")

View diff against:

View revision:

| [Last change](/changeset/3003178/debug-log-manager/tags/2.2.2/classes/class-debug-log.php "View differences") on this file was [3003178](/changeset/3003178/ "View changeset 3003178"), checked in by qriouslad, [14 months ago](/timeline?from=2023-11-29T10%3A00%3A25Z&precision=second "See timeline at 11/29/2023 10:00:25 AM") |
| --- |
| v2.2.2 release |
| * Property **svn:eol-style** set to   *`native`* | |
| **File size:** 34.1 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | namespace DLM\Classes; |
| [4](#L4) |  |
| [5](#L5) | /\*\* |
| [6](#L6) | \* Class related to the debug log file and entries |
| [7](#L7) | \* |
| [8](#L8) | \* @since 1.0.0 |
| [9](#L9) | \*/ |
| [10](#L10) | class Debug\_Log { |
| [11](#L11) |  |
| [12](#L12) | // The wp\_config object |
| [13](#L13) | private $wp\_config; |
| [14](#L14) |  |
| [15](#L15) | /\*\* |
| [16](#L16) | \* Class constructor |
| [17](#L17) | \*/ |
| [18](#L18) | public function \_\_construct() { |
| [19](#L19) |  |
| [20](#L20) | $this->wp\_config = new WP\_Config\_Transformer; // already in the DLM\Classes namespace, so, no need to repeat |
| [21](#L21) |  |
| [22](#L22) | } |
| [23](#L23) |  |
| [24](#L24) | /\*\* |
| [25](#L25) | \* Get status of WP\_DEBUG |
| [26](#L26) | \* |
| [27](#L27) | \* @since 1.0.0 |
| [28](#L28) | \*/ |
| [29](#L29) | public function get\_status() { |
| [30](#L30) |  |
| [31](#L31) | // If non-existent, create an empty index to prevent directory browsing and download of the debug log file |
| [32](#L32) | $uploads\_path = wp\_upload\_dir()['basedir'] . '/debug-log-manager'; |
| [33](#L33) | if ( ! is\_file( $uploads\_path . '/index.php' ) ) { |
| [34](#L34) | file\_put\_contents( $uploads\_path . '/index.php', '<?php // Nothing to show here' ); |
| [35](#L35) | } |
| [36](#L36) |  |
| [37](#L37) | $value          = get\_option( 'debug\_log\_manager' ); |
| [38](#L38) | $status         = $value['status']; |
| [39](#L39) |  |
| [40](#L40) | if ( function\_exists( 'wp\_date' ) ) { |
| [41](#L41) | $date\_time      = wp\_date( 'M j, Y - H:i:s', strtotime( $value['on'] ) ); |
| [42](#L42) | } else { |
| [43](#L43) | $date\_time      = date\_i18n( 'M j, Y - H:i:s', strtotime( $value['on'] ) ); |
| [44](#L44) | } |
| [45](#L45) |  |
| [46](#L46) | if ( 'enabled' == $status ) { |
| [47](#L47) |  |
| [48](#L48) | return '<div id="debug-log-status" class="dlm-log-status"><strong>' . esc\_html\_\_( 'Error Logging', 'debug-log-manager' ) . '</strong>: ' . ucfirst( esc\_html\_\_( 'enabled', 'debug-log-manager' ) ) . ' ' . esc\_html\_\_( 'on', 'debug-log-manager' ) . ' ' . esc\_html( $date\_time ) . '</div>'; |
| [49](#L49) |  |
| [50](#L50) | } elseif ( 'disabled' == $status ) { |
| [51](#L51) |  |
| [52](#L52) | return '<div id="debug-log-status" class="dlm-log-status"><strong>' . esc\_html\_\_( 'Error Logging', 'debug-log-manager' ) . '</strong>: ' . ucfirst( esc\_html\_\_( 'disabled', 'debug-log-manager' ) ) . ' ' . esc\_html\_\_( 'on', 'debug-log-manager' ) . ' ' . esc\_html( $date\_time ) . '</div>'; |
| [53](#L53) |  |
| [54](#L54) | } else {} |
| [55](#L55) |  |
| [56](#L56) | } |
| [57](#L57) |  |
| [58](#L58) | /\*\* |
| [59](#L59) | \* Get log auto-refresh status |
| [60](#L60) | \* |
| [61](#L61) | \* @since 1.3.0 |
| [62](#L62) | \*/ |
| [63](#L63) | public function get\_autorefresh\_status() { |
| [64](#L64) |  |
| [65](#L65) | if ( false !== get\_option( 'debug\_log\_manager\_autorefresh' ) ) { |
| [66](#L66) |  |
| [67](#L67) | $autorefresh\_status = get\_option( 'debug\_log\_manager\_autorefresh' ); |
| [68](#L68) |  |
| [69](#L69) | } else { |
| [70](#L70) |  |
| [71](#L71) | $autorefresh\_status = 'disabled'; |
| [72](#L72) | update\_option( 'debug\_log\_manager\_autorefresh', $autorefresh\_status, false ); |
| [73](#L73) |  |
| [74](#L74) | } |
| [75](#L75) |  |
| [76](#L76) | if ( 'enabled' == $autorefresh\_status ) { |
| [77](#L77) |  |
| [78](#L78) | return '<div id="debug-autorefresh-status" class="dlm-autorefresh-status"><strong>Auto-Refresh</strong>: ' . ucfirst( esc\_html\_\_( 'enabled', 'debug-log-manager' ) ) . '</div>'; |
| [79](#L79) |  |
| [80](#L80) | } elseif ( 'disabled' == $autorefresh\_status ) { |
| [81](#L81) |  |
| [82](#L82) | return '<div id="debug-autorefresh-status" class="dlm-autorefresh-status"><strong>Auto-Refresh</strong>: ' . ucfirst( esc\_html\_\_( 'disabled', 'debug-log-manager' ) ) . '</div>'; |
| [83](#L83) |  |
| [84](#L84) | } |
| [85](#L85) |  |
| [86](#L86) | } |
| [87](#L87) |  |
| [88](#L88) | /\*\* |
| [89](#L89) | \* Enable / disable WP\_DEBUG |
| [90](#L90) | \* |
| [91](#L91) | \* @since 1.0.0 |
| [92](#L92) | \*/ |
| [93](#L93) | public function toggle\_debugging() { |
| [94](#L94) |  |
| [95](#L95) | if ( isset( $\_REQUEST ) ) { |
| [96](#L96) |  |
| [97](#L97) | $log\_info                               = get\_option( 'debug\_log\_manager' ); |
| [98](#L98) | $dlm\_debug\_log\_file\_path        = get\_option( 'debug\_log\_manager\_file\_path' ); |
| [99](#L99) |  |
| [100](#L100) | if ( function\_exists( 'wp\_date' ) ) { |
| [101](#L101) | $date\_time      = wp\_date( 'M j, Y - H:i:s' ); // Localized according to WP timezone settings |
| [102](#L102) | } else { |
| [103](#L103) | $date\_time      = date\_i18n( 'M j, Y - H:i:s' ); |
| [104](#L104) |  |
| [105](#L105) | } |
| [106](#L106) | $date\_time\_for\_option   = date( 'M j, Y H:i:s' ); // in UTC |
| [107](#L107) |  |
| [108](#L108) | if ( 'disabled' == $log\_info['status']  ) { |
| [109](#L109) |  |
| [110](#L110) | $option\_value = array( |
| [111](#L111) | 'status'        => 'enabled', |
| [112](#L112) | 'on'            => $date\_time\_for\_option, |
| [113](#L113) | ); |
| [114](#L114) |  |
| [115](#L115) | update\_option( 'debug\_log\_manager', $option\_value, false ); |
| [116](#L116) |  |
| [117](#L117) | // If WP\_DEBUG\_LOG is defined, copy content of existing debug.log file into the log file created by this plugin |
| [118](#L118) |  |
| [119](#L119) | if ( $this->wp\_config->exists( 'constant', 'WP\_DEBUG\_LOG' ) ) { |
| [120](#L120) |  |
| [121](#L121) | $wp\_debug\_log\_const = $this->wp\_config->get\_value( 'constant', 'WP\_DEBUG\_LOG' ); |
| [122](#L122) |  |
| [123](#L123) | if ( in\_array( $wp\_debug\_log\_const, array( 'true', 'false' ), true ) ) { |
| [124](#L124) | $wp\_debug\_log\_const = (bool) $wp\_debug\_log\_const; |
| [125](#L125) | } |
| [126](#L126) |  |
| [127](#L127) | if ( is\_bool( $wp\_debug\_log\_const ) ) { |
| [128](#L128) | // WP\_DEBUG\_LOG is true or false. Log file is in default location of /wp-content/debug.log. |
| [129](#L129) |  |
| [130](#L130) | if ( is\_file( WP\_CONTENT\_DIR . '/debug.log' ) ) { |
| [131](#L131) | // Copy existing debug log content to this plugin's debug log. |
| [132](#L132) | $default\_debug\_log\_content = file\_get\_contents( WP\_CONTENT\_DIR . '/debug.log' ); |
| [133](#L133) | file\_put\_contents( $dlm\_debug\_log\_file\_path, $default\_debug\_log\_content ); |
| [134](#L134) | unlink( realpath( WP\_CONTENT\_DIR . '/debug.log' ) ); // delete existing debug log |
| [135](#L135) | } |
| [136](#L136) |  |
| [137](#L137) | } elseif ( is\_string( $wp\_debug\_log\_const ) ) { |
| [138](#L138) | // WP\_DEBUG\_LOG is custom path to log file. Copy existing debug log content to this plugin's debug log. |
| [139](#L139) |  |
| [140](#L140) | if ( is\_file( $wp\_debug\_log\_const ) && ( $wp\_debug\_log\_const != $dlm\_debug\_log\_file\_path ) ) { |
| [141](#L141) | $custom\_debug\_log\_content = file\_get\_contents( $wp\_debug\_log\_const ); |
| [142](#L142) | file\_put\_contents( $dlm\_debug\_log\_file\_path, $custom\_debug\_log\_content ); |
| [143](#L143) | unlink( $wp\_debug\_log\_const ); // delete existing debug log |
| [144](#L144) | } |
| [145](#L145) |  |
| [146](#L146) | } |
| [147](#L147) |  |
| [148](#L148) | $copy = true; // existing debug.log file's entries are copied to this plugin's debug.log file |
| [149](#L149) |  |
| [150](#L150) | } else { |
| [151](#L151) |  |
| [152](#L152) | $copy = false; // existing debug.log file's entries are NOT copied to this plugin's debug.log file |
| [153](#L153) |  |
| [154](#L154) | } |
| [155](#L155) |  |
| [156](#L156) | // Define Debug constants in wp-config.php |
| [157](#L157) |  |
| [158](#L158) | $options = array( |
| [159](#L159) | 'add'       => true, // Add the config if missing. |
| [160](#L160) | 'raw'       => true, // Display value in raw format without quotes. |
| [161](#L161) | 'normalize' => false, // Normalize config output using WP Coding Standards. |
| [162](#L162) | ); |
| [163](#L163) |  |
| [164](#L164) | $this->wp\_config->update( 'constant', 'WP\_DEBUG', 'true', $options ); |
| [165](#L165) |  |
| [166](#L166) | $options = array( |
| [167](#L167) | 'add'       => true, // Add the config if missing. |
| [168](#L168) | 'raw'       => true, // Display value in raw format without quotes. |
| [169](#L169) | 'normalize' => false, // Normalize config output using WP Coding Standards. |
| [170](#L170) | ); |
| [171](#L171) |  |
| [172](#L172) | $this->wp\_config->update( 'constant', 'SCRIPT\_DEBUG', 'true', $options ); |
| [173](#L173) |  |
| [174](#L174) | $options = array( |
| [175](#L175) | 'add'       => true, // Add the config if missing. |
| [176](#L176) | 'raw'       => false, // Display value in raw format without quotes. |
| [177](#L177) | 'normalize' => false, // Normalize config output using WP Coding Standards. |
| [178](#L178) | ); |
| [179](#L179) |  |
| [180](#L180) | $this->wp\_config->update( 'constant', 'WP\_DEBUG\_LOG', get\_option( 'debug\_log\_manager\_file\_path' ), $options ); |
| [181](#L181) |  |
| [182](#L182) | $options = array( |
| [183](#L183) | 'add'       => true, // Add the config if missing. |
| [184](#L184) | 'raw'       => true, // Display value in raw format without quotes. |
| [185](#L185) | 'normalize' => false, // Normalize config output using WP Coding Standards. |
| [186](#L186) | ); |
| [187](#L187) |  |
| [188](#L188) | $this->wp\_config->update( 'constant', 'WP\_DEBUG\_DISPLAY', 'false', $options ); |
| [189](#L189) |  |
| [190](#L190) | $options = array( |
| [191](#L191) | 'add'       => true, // Add the config if missing. |
| [192](#L192) | 'raw'       => true, // Display value in raw format without quotes. |
| [193](#L193) | 'normalize' => false, // Normalize config output using WP Coding Standards. |
| [194](#L194) | ); |
| [195](#L195) |  |
| [196](#L196) | $this->wp\_config->update( 'constant', 'DISALLOW\_FILE\_EDIT', 'false', $options ); |
| [197](#L197) |  |
| [198](#L198) | // Get the debug.log file size |
| [199](#L199) |  |
| [200](#L200) | $log\_file\_path          = get\_option( 'debug\_log\_manager\_file\_path' ); |
| [201](#L201) | $log\_file\_shortpath = str\_replace( sanitize\_text\_field( $\_SERVER['DOCUMENT\_ROOT'] ), "", $log\_file\_path ); |
| [202](#L202) | $file\_size                      = size\_format( (int) filesize( $log\_file\_path ) ); |
| [203](#L203) |  |
| [204](#L204) | // Prepare entries from the debug log for the data table |
| [205](#L205) |  |
| [206](#L206) | $errors\_master\_list = json\_decode( $this->get\_processed\_entries(), true ); |
| [207](#L207) |  |
| [208](#L208) | $n = 1; |
| [209](#L209) | $entries = array(); |
| [210](#L210) |  |
| [211](#L211) | foreach ( $errors\_master\_list as $error ) { |
| [212](#L212) |  |
| [213](#L213) | if ( function\_exists( 'wp\_date' ) ) { |
| [214](#L214) | $localized\_timestamp    = wp\_date( 'M j, Y - H:i:s', strtotime( $error['occurrences'][0] ) ); // last occurrence |
| [215](#L215) | } else { |
| [216](#L216) | $localized\_timestamp    = date\_i18n( 'M j, Y - H:i:s', strtotime( $error['occurrences'][0] ) ); |
| [217](#L217) | } |
| [218](#L218) |  |
| [219](#L219) | $occurrence\_count               = count( $error['occurrences'] ); |
| [220](#L220) |  |
| [221](#L221) | $entry = array( |
| [222](#L222) | $n, |
| [223](#L223) | $error['type'], |
| [224](#L224) | $error['details'], |
| [225](#L225) | $localized\_timestamp . '<br /><span class="dlm-faint">(' . sprintf( \_n( '%s occurrence logged', '%s occurrences logged', $occurrence\_count, 'debug-log-manager' ), number\_format\_i18n( $occurrence\_count ) ) . ')<span>', |
| [226](#L226) | ); |
| [227](#L227) |  |
| [228](#L228) | $entries[] = $entry; |
| [229](#L229) |  |
| [230](#L230) | $n++; |
| [231](#L231) |  |
| [232](#L232) | } |
| [233](#L233) |  |
| [234](#L234) | // Assemble data to return |
| [235](#L235) |  |
| [236](#L236) | $data = array( |
| [237](#L237) | 'status'        => 'enabled', |
| [238](#L238) | 'copy'          => $copy, |
| [239](#L239) | 'message'       => '<strong>' . esc\_html\_\_( 'Error Logging', 'debug-log-manager' ) . '</strong>: ' . esc\_html\_\_( 'Enabled on', 'debug-log-manager' ) . ' ' . esc\_html( $date\_time ), |
| [240](#L240) | 'entries'       => $entries, |
| [241](#L241) | 'size'          => $file\_size, |
| [242](#L242) | ); |
| [243](#L243) |  |
| [244](#L244) | echo json\_encode( $data ); |
| [245](#L245) |  |
| [246](#L246) | } elseif ( 'enabled' == $log\_info['status'] ) { |
| [247](#L247) |  |
| [248](#L248) | $option\_value = array( |
| [249](#L249) | 'status'        => 'disabled', |
| [250](#L250) | 'on'            => $date\_time\_for\_option, |
| [251](#L251) | ); |
| [252](#L252) |  |
| [253](#L253) | update\_option( 'debug\_log\_manager', $option\_value, false ); |
| [254](#L254) |  |
| [255](#L255) | // Remove Debug constants in wp-config.php |
| [256](#L256) |  |
| [257](#L257) | $this->wp\_config->remove( 'constant', 'WP\_DEBUG' ); |
| [258](#L258) | $this->wp\_config->remove( 'constant', 'SCRIPT\_DEBUG' ); |
| [259](#L259) | $this->wp\_config->remove( 'constant', 'WP\_DEBUG\_LOG' ); |
| [260](#L260) | $this->wp\_config->remove( 'constant', 'WP\_DEBUG\_DISPLAY' ); |
| [261](#L261) | $this->wp\_config->remove( 'constant', 'DISALLOW\_FILE\_EDIT' ); |
| [262](#L262) |  |
| [263](#L263) | // Assemble data to return |
| [264](#L264) |  |
| [265](#L265) | $data = array( |
| [266](#L266) | 'status'        => 'disabled', |
| [267](#L267) | 'copy'          => false, |
| [268](#L268) | 'message'       => '<strong>' . esc\_html\_\_( 'Error Logging', 'debug-log-manager' ) . '</strong>: ' . esc\_html\_\_( 'Disabled on', 'debug-log-manager' ) . ' ' . esc\_html( $date\_time ), |
| [269](#L269) | 'entries'       => '', |
| [270](#L270) | 'size'          => '', |
| [271](#L271) | ); |
| [272](#L272) |  |
| [273](#L273) | echo json\_encode( $data ); |
| [274](#L274) |  |
| [275](#L275) | } else {} |
| [276](#L276) |  |
| [277](#L277) | } |
| [278](#L278) |  |
| [279](#L279) | } |
| [280](#L280) |  |
| [281](#L281) | /\*\* |
| [282](#L282) | \* Toggle auto-refresh of entries table |
| [283](#L283) | \* |
| [284](#L284) | \* @since 1.3.0 |
| [285](#L285) | \*/ |
| [286](#L286) | public function toggle\_autorefresh() { |
| [287](#L287) |  |
| [288](#L288) | if ( isset( $\_REQUEST ) ) { |
| [289](#L289) |  |
| [290](#L290) | $autorefresh\_status = get\_option( 'debug\_log\_manager\_autorefresh' ); |
| [291](#L291) |  |
| [292](#L292) | if ( $autorefresh\_status == 'disabled' ) { |
| [293](#L293) |  |
| [294](#L294) | update\_option( 'debug\_log\_manager\_autorefresh', 'enabled', false ); |
| [295](#L295) |  |
| [296](#L296) | $data = array( |
| [297](#L297) | 'status'        => 'enabled', |
| [298](#L298) | 'message'       => '<strong>' . esc\_html\_\_( 'Auto-Refresh', 'debug-log-manager' ) . '</strong>: ' . esc\_html\_\_( 'Enabled', 'debug-log-manager' ), |
| [299](#L299) | ); |
| [300](#L300) |  |
| [301](#L301) | echo json\_encode( $data ); |
| [302](#L302) |  |
| [303](#L303) | } elseif ( $autorefresh\_status == 'enabled' ) { |
| [304](#L304) |  |
| [305](#L305) | update\_option( 'debug\_log\_manager\_autorefresh', 'disabled', false ); |
| [306](#L306) |  |
| [307](#L307) | $data = array( |
| [308](#L308) | 'status'        => 'disabled', |
| [309](#L309) | 'message'       => '<strong>' . esc\_html\_\_( 'Auto-Refresh', 'debug-log-manager' ) . '</strong>: ' . esc\_html\_\_( 'Disabled', 'debug-log-manager' ), |
| [310](#L310) | ); |
| [311](#L311) |  |
| [312](#L312) | echo json\_encode( $data ); |
| [313](#L313) |  |
| [314](#L314) | } else {} |
| [315](#L315) |  |
| [316](#L316) | } |
| [317](#L317) |  |
| [318](#L318) | } |
| [319](#L319) |  |
| [320](#L320) | /\*\* |
| [321](#L321) | \* Get the processed debug log data |
| [322](#L322) | \* |
| [323](#L323) | \* @return string $errors\_master\_list The processed error log entries |
| [324](#L324) | \* @since 1.2.0 |
| [325](#L325) | \*/ |
| [326](#L326) | public function get\_processed\_entries() { |
| [327](#L327) |  |
| [328](#L328) | $debug\_log\_file\_path = get\_option( 'debug\_log\_manager\_file\_path' ); |
| [329](#L329) |  |
| [330](#L330) | // Read the errors log file |
| [331](#L331) | $log    = file\_get\_contents( $debug\_log\_file\_path ); |
| [332](#L332) |  |
| [333](#L333) | $log    = str\_replace( "[\\", "^\\", $log ); // certain error message contains the '[\' string, which will make the following split via explode() to split lines at places in the message it's not supposed to. So, we temporarily replace those with '^\' |
| [334](#L334) |  |
| [335](#L335) | $log    = str\_replace( "[\"", "^\"", $log ); // certain error message contains the '["' string, which will make the following split via explode() to split lines at places in the message it's not supposed to. So, we temporarily replace those with '^"' |
| [336](#L336) |  |
| [337](#L337) | $log = str\_replace( "[internal function]", "^internal function^", $log ); |
| [338](#L338) |  |
| [339](#L339) | // We are splitting the log file not using PHP\_EOL to preserve the stack traces for PHP Fatal Errors among other things |
| [340](#L340) | $lines  = explode("[", $log); |
| [341](#L341) | $prepended\_lines = array(); |
| [342](#L342) |  |
| [343](#L343) | // Pluck out the last 100k entries, the newest entry is last |
| [344](#L344) | // To pluck out the first 100000 entries, use array\_slice( $lines, 0, 100000 ) |
| [345](#L345) | $lines  = array\_slice( $lines, -100000 ); |
| [346](#L346) |  |
| [347](#L347) | foreach ( $lines as $line ) { |
| [348](#L348) | if ( !empty($line) ) { |
| [349](#L349) | $line                   = str\_replace( "UTC]", "UTC]@@@", $line ); // add '@@@' as marker/separator after time stamp |
| [350](#L350) | $line                   = str\_replace( "Stack trace:", "<hr />Stack trace:", $line ); // add line break for stack trace section |
| [351](#L351) | if ( strpos( $line, 'PHP Fatal' ) !== false ) { |
| [352](#L352) | $line           = str\_replace( "#", "<hr />#", $line ); // add line break on PHP Fatal error's stack trace lines |
| [353](#L353) | } |
| [354](#L354) | $line                   = str\_replace( "Argument <hr />#", "Argument #", $line ); // remove hr on certain error message |
| [355](#L355) | $line                   = str\_replace( "parameter <hr />#", "parameter #", $line ); // remove hr on certain error message |
| [356](#L356) | $line                   = str\_replace( "the <hr />#", "the #", $line ); // remove hr on certain error message |
| [357](#L357) | $line                   = str\_replace( "^\\", "[\\", $line ); // reverse the temporary replacement of '[\' with '^\' |
| [358](#L358) | $line                   = str\_replace( "^\"", "[\"", $line ); // reverse the temporary replacement of '["' with '^"' |
| [359](#L359) | $line                   = str\_replace( "^internal function^", "[internal function]", $line ); |
| [360](#L360) | $prepended\_line         = '[' . $line; // Put back the missing '[' after explode operation |
| [361](#L361) | $prepended\_lines[]      = $prepended\_line; |
| [362](#L362) | } |
| [363](#L363) | } |
| [364](#L364) |  |
| [365](#L365) | // Reverse the order of the entries, so the newest entry is first |
| [366](#L366) | $latest\_lines   = array\_reverse( $prepended\_lines ); |
| [367](#L367) |  |
| [368](#L368) | // Will hold error details types |
| [369](#L369) | $errors\_master\_list = array(); |
| [370](#L370) |  |
| [371](#L371) | foreach( $latest\_lines as $line ) { |
| [372](#L372) |  |
| [373](#L373) | $line = explode("@@@ ", trim( $line ) ); // split the line using the '@@@' marker/separator defined earlier. '@@@' will be deleted by explode(). |
| [374](#L374) |  |
| [375](#L375) | $timestamp = str\_replace( [ "[", "]" ], "", $line[0] ); |
| [376](#L376) |  |
| [377](#L377) | // Initialize error-related variables |
| [378](#L378) | $error = ''; |
| [379](#L379) | $error\_source = ''; |
| [380](#L380) | $error\_file = ''; |
| [381](#L381) | $error\_file\_path = ''; |
| [382](#L382) | $error\_file\_line = ''; |
| [383](#L383) |  |
| [384](#L384) | if ( array\_key\_exists('1', $line) ) { |
| [385](#L385) | $error = $line[1]; |
| [386](#L386) |  |
| [387](#L387) | // Check if there is a file path to pluck out of the error line |
| [388](#L388) | if ( false !== strpos( $error, ABSPATH ) ) { |
| [389](#L389) |  |
| [390](#L390) | // Separata file path and error line from error message |
| [391](#L391) |  |
| [392](#L392) | // Handling for PHP Fatal errors with stack trace included |
| [393](#L393) | if ( false !== strpos( $error, 'Stack trace:' ) ) { |
| [394](#L394) | $error\_parts = explode( 'Stack trace:', $error ); |
| [395](#L395) | $error\_message = str\_replace( '<hr />', '', $error\_parts[0] ); |
| [396](#L396) | if ( isset( $error\_parts[1] ) ) { |
| [397](#L397) | $error\_stack\_trace = ' ' . $error\_parts[1]; |
| [398](#L398) | } |
| [399](#L399) |  |
| [400](#L400) | $error\_message\_parts = explode( ' in /', $error\_message ); |
| [401](#L401) |  |
| [402](#L402) | // Reconstruct the error details without error file path and line info |
| [403](#L403) | $error = $error\_message\_parts[0] . '<hr />Stack trace:' . $error\_stack\_trace; |
| [404](#L404) | // Shorten the file path in the error details |
| [405](#L405) | $error = str\_replace( ABSPATH, '/', $error ); |
| [406](#L406) | if ( isset( $error\_message\_parts[1] ) ) { |
| [407](#L407) | $error\_file = '/' . $error\_message\_parts[1]; |
| [408](#L408) | $error\_file\_info = explode ( ':', $error\_file ); |
| [409](#L409) | $error\_file\_path = $error\_file\_info[0]; |
| [410](#L410) | if ( array\_key\_exists('1', $error\_file\_info) ) { |
| [411](#L411) | $error\_file\_line = $error\_file\_info[1]; |
| [412](#L412) | } |
| [413](#L413) | } |
| [414](#L414) | } else { |
| [415](#L415) | $error\_message\_parts = explode( ' in /', $error ); |
| [416](#L416) |  |
| [417](#L417) | $error = $error\_message\_parts[0]; |
| [418](#L418) | if ( isset( $error\_message\_parts[1] ) ) { |
| [419](#L419) | $error\_file = '/' . $error\_message\_parts[1]; |
| [420](#L420) |  |
| [421](#L421) | $error\_file\_info = explode ( ' on line ', $error\_file ); |
| [422](#L422) | $error\_file\_path = $error\_file\_info[0]; |
| [423](#L423) | if ( array\_key\_exists('1', $error\_file\_info) ) { |
| [424](#L424) | $error\_file\_line = $error\_file\_info[1]; |
| [425](#L425) | } |
| [426](#L426) | } |
| [427](#L427) | } |
| [428](#L428) |  |
| [429](#L429) | // Shorten the file path where the error occurred |
| [430](#L430) | $error\_file\_path = str\_replace( ABSPATH, '/', $error\_file\_path ); |
| [431](#L431) |  |
| [432](#L432) | // Define whether source of error is WP Core, Theme, Plugin or Other |
| [433](#L433) |  |
| [434](#L434) | if ( ( false !== strpos( $error\_file, '/wp-admin/' ) ) || |
| [435](#L435) | ( false !== strpos( $error\_file, '/wp-includes/' ) ) ) { |
| [436](#L436) | $error\_source = \_\_( 'WordPress core', 'debug-log-manager' ); |
| [437](#L437) | } elseif ( ( false !== strpos( $error\_file, '/wp-content/themes/' ) ) ) { |
| [438](#L438) | $error\_source = \_\_( 'Theme', 'debug-log-manager' ); |
| [439](#L439) | } elseif ( ( false !== strpos( $error\_file, '/wp-content/plugins/' ) ) ) { |
| [440](#L440) | $error\_source = \_\_( 'Plugin', 'debug-log-manager' ); |
| [441](#L441) | } else { |
| [442](#L442) | $error\_source = ''; |
| [443](#L443) | } |
| [444](#L444) |  |
| [445](#L445) | // Get plugin/theme directory name of error file when error source is plugin or theme |
| [446](#L446) |  |
| [447](#L447) | if ( ( 'Plugin' == $error\_source ) || ( 'Theme' == $error\_source ) ) { |
| [448](#L448) | $error\_file\_path\_parts = explode( '/', $error\_file\_path ); |
| [449](#L449) | $error\_file\_directory = $error\_file\_path\_parts[3]; |
| [450](#L450) | } |
| [451](#L451) |  |
| [452](#L452) | // Get plugin name |
| [453](#L453) |  |
| [454](#L454) | $plugins = get\_plugins(); |
| [455](#L455) |  |
| [456](#L456) | if ( 'Plugin' == $error\_source ) { |
| [457](#L457) | foreach ( $plugins as $plugin\_path\_file => $plugin\_info ) { |
| [458](#L458) | if ( false !== strpos( $plugin\_path\_file, $error\_file\_directory ) ) { |
| [459](#L459) | $error\_source\_plugin\_path\_file = $plugin\_path\_file; |
| [460](#L460) | $error\_source\_plugin\_name = $plugin\_info['Name']; |
| [461](#L461) | $error\_source\_plugin\_uri = $plugin\_info['PluginURI']; |
| [462](#L462) | // $error\_source\_plugin\_version = $plugin\_info['Version']; |
| [463](#L463) | } |
| [464](#L464) | } |
| [465](#L465) | } |
| [466](#L466) |  |
| [467](#L467) | // Get theme name |
| [468](#L468) |  |
| [469](#L469) | if ( 'Theme' == $error\_source ) { |
| [470](#L470) | $theme = wp\_get\_theme( $error\_file\_directory ); |
| [471](#L471) | if ( $theme->exists() ) { |
| [472](#L472) | $error\_source\_theme\_dir = $error\_file\_directory; |
| [473](#L473) | $error\_source\_theme\_name = $theme->get( 'Name' ); |
| [474](#L474) | $error\_source\_theme\_uri = $theme->get( 'ThemeURI' ); |
| [475](#L475) | // $error\_source\_theme\_version = $theme->get( 'Version' ); |
| [476](#L476) | } else { |
| [477](#L477) | $error\_source\_theme\_name = $error\_file\_directory; |
| [478](#L478) | } |
| [479](#L479) | } |
| [480](#L480) |  |
| [481](#L481) | } |
| [482](#L482) |  |
| [483](#L483) | } else { |
| [484](#L484) |  |
| [485](#L485) | $error = \_\_( 'No error message specified...', 'debug-log-manager' ); |
| [486](#L486) |  |
| [487](#L487) | } |
| [488](#L488) |  |
| [489](#L489) | if ( ( false !== strpos( $error, 'PHP Fatal' )) || ( false !== strpos( $error, 'FATAL' ) ) || ( false !== strpos( $error, 'E\_ERROR' ) ) ) { |
| [490](#L490) | $error\_type     = \_\_( 'PHP Fatal', 'debug-log-manager' ); |
| [491](#L491) | $error\_details  = str\_replace( "PHP Fatal error: ", "", $error ); |
| [492](#L492) | $error\_details  = str\_replace( "PHP Fatal: ", "", $error\_details ); |
| [493](#L493) | $error\_details  = str\_replace( "FATAL ", "", $error\_details ); |
| [494](#L494) | $error\_details  = str\_replace( "E\_ERROR: ", "", $error\_details ); |
| [495](#L495) | } elseif ( ( false !== strpos( $error, 'PHP Warning' ) ) || (  false !== strpos( $error, 'E\_WARNING' ) ) ) { |
| [496](#L496) | $error\_type     = \_\_( 'PHP Warning', 'debug-log-manager' ); |
| [497](#L497) | $error\_details  = str\_replace( "PHP Warning: ", "", $error ); |
| [498](#L498) | $error\_details  = str\_replace( "E\_WARNING: ", "", $error\_details ); |
| [499](#L499) | } elseif ( ( false !== strpos( $error, 'PHP Notice' ) ) || ( false !== strpos( $error, 'E\_NOTICE' ) ) ) { |
| [500](#L500) | $error\_type     = \_\_( 'PHP Notice', 'debug-log-manager' ); |
| [501](#L501) | $error\_details  = str\_replace( "PHP Notice: ", "", $error ); |
| [502](#L502) | $error\_details  = str\_replace( "E\_NOTICE: ", "", $error\_details ); |
| [503](#L503) | } elseif ( false !== strpos( $error, 'PHP Deprecated' ) ) { |
| [504](#L504) | $error\_type     = \_\_( 'PHP Deprecated', 'debug-log-manager' ); |
| [505](#L505) | $error\_details  = str\_replace( "PHP Deprecated: ", "", $error ); |
| [506](#L506) | } elseif ( ( false !== strpos( $error, 'PHP Parse' ) ) || ( false !== strpos( $error, 'E\_PARSE' ) ) ) { |
| [507](#L507) | $error\_type     = \_\_( 'PHP Parse', 'debug-log-manager' ); |
| [508](#L508) | $error\_details  = str\_replace( "PHP Parse error: ", "", $error ); |
| [509](#L509) | $error\_details  = str\_replace( "E\_PARSE: ", "", $error\_details ); |
| [510](#L510) | } elseif ( false !== strpos( $error, 'EXCEPTION:' ) ) { |
| [511](#L511) | $error\_type     = \_\_( 'PHP Exception', 'debug-log-manager' ); |
| [512](#L512) | $error\_details  = str\_replace( "EXCEPTION: ", "", $error ); |
| [513](#L513) | } elseif ( false !== strpos( $error, 'WordPress database error' ) ) { |
| [514](#L514) | $error\_type     = \_\_( 'Database', 'debug-log-manager' ); |
| [515](#L515) | $error\_details  = str\_replace( "WordPress database error ", "", $error ); |
| [516](#L516) | } elseif ( false !== strpos( $error, 'JavaScript Error' ) ) { |
| [517](#L517) | $error\_type     = \_\_( 'JavaScript', 'debug-log-manager' ); |
| [518](#L518) | $error\_details  = str\_replace( "JavaScript Error: ", "", $error ); |
| [519](#L519) | } else { |
| [520](#L520) | $error\_type     = \_\_( 'Other', 'debug-log-manager' ); |
| [521](#L521) | $error\_details  = $error; |
| [522](#L522) | if ( $this->is\_json( $error\_details ) ) { |
| [523](#L523) | // For JSON string in error message, originally added via error\_log( json\_encode( $variable ) ) |
| [524](#L524) | // This will output said JSON string as well-formated array in the log entries table |
| [525](#L525) | $error\_details = '<pre>' . print\_r( json\_decode( $error\_details, true ), true ) . '</pre>'; |
| [526](#L526) | } |
| [527](#L527) | } |
| [528](#L528) |  |
| [529](#L529) | // Append error source, file path and line number info to error details. If core plugin/theme editor is not disabled, link file path to the editor view. |
| [530](#L530) |  |
| [531](#L531) | if ( ! empty( $error\_source ) ) { |
| [532](#L532) | if ( 'WordPress core' == $error\_source ) { |
| [533](#L533) | $wp\_version = get\_bloginfo( 'version' ); |
| [534](#L534) | $file\_viewer\_url = 'https://github.com/WordPress/wordpress-develop/blob/' . $wp\_version . '/src' . $error\_file\_path; |
| [535](#L535) | $error\_details = '<span class="error-details">' . $error\_details . '</span><hr />' . $error\_source . '<br />' . \_\_( 'File', 'debug-log-manager' ) . ': <a href="' . $file\_viewer\_url . '" target="\_blank" class="error-source-link">' . $error\_file\_path . '<span class="dashicons dashicons-visibility offset-down"></span></a><br />' . \_\_( 'Line', 'debug-log-manager' ) . ': ' . $error\_file\_line; |
| [536](#L536) | } elseif ( 'Theme' == $error\_source ) { |
| [537](#L537) | if ( ! defined( 'DISALLOW\_FILE\_EDIT' ) || ( false === constant( 'DISALLOW\_FILE\_EDIT' ) ) ) { |
| [538](#L538) | $file\_viewer\_url = get\_admin\_url() . 'theme-editor.php?file=' . urlencode( str\_replace( '/wp-content/themes/', '', $error\_file\_path ) ) . '&theme=' . $error\_source\_theme\_dir; |
| [539](#L539) | $error\_details = '<span class="error-details">' . $error\_details . '</span><hr />' . $error\_source . ': <a href="' . $error\_source\_theme\_uri . '" target="\_blank" class="error-source-link">' . $error\_source\_theme\_name . '<span class="dashicons dashicons-external offset-up"></span></a><br />' . \_\_( 'File', 'debug-log-manager' ) . ': <a href="' . $file\_viewer\_url . '" target="\_blank" class="error-source-link">' . $error\_file\_path . '<span class="dashicons dashicons-visibility offset-down"></span></a><br />' . \_\_( 'Line', 'debug-log-manager' ) . ': ' . $error\_file\_line; |
| [540](#L540) | } |
| [541](#L541) | if ( defined( 'DISALLOW\_FILE\_EDIT' ) && ( true === constant( 'DISALLOW\_FILE\_EDIT' ) ) ) { |
| [542](#L542) | $error\_details = '<span class="error-details">' . $error\_details . '</span><hr />' . $error\_source . ': <a href="' . $error\_source\_theme\_uri . '" target="\_blank" class="error-source-link">' . $error\_source\_theme\_name . '<span class="dashicons dashicons-external offset-up"></span></a><br />' . \_\_( 'File', 'debug-log-manager' ) . ': ' . $error\_file\_path . '<br />' . \_\_( 'Line', 'debug-log-manager' ) . ': ' . $error\_file\_line; |
| [543](#L543) | } |
| [544](#L544) | } elseif ( 'Plugin' == $error\_source ) { |
| [545](#L545) | if ( ! defined( 'DISALLOW\_FILE\_EDIT' ) || ( false === constant( 'DISALLOW\_FILE\_EDIT' ) ) ) { |
| [546](#L546) | $file\_viewer\_url = get\_admin\_url() . 'plugin-editor.php?file=' . urlencode( str\_replace( '/wp-content/plugins/', '', $error\_file\_path ) ) . '&plugin=' . urlencode( $error\_source\_plugin\_path\_file ); |
| [547](#L547) | $error\_details = '<span class="error-details">' . $error\_details . '</span><hr />' . $error\_source . ': <a href="' . $error\_source\_plugin\_uri . '" target="\_blank" class="error-source-link">' . $error\_source\_plugin\_name . '<span class="dashicons dashicons-external offset-up"></span></a><br />' . \_\_( 'File', 'debug-log-manager' ) . ': <a href="' . $file\_viewer\_url . '" target="\_blank" class="error-source-link">' . $error\_file\_path . '<span class="dashicons dashicons-visibility offset-down"></span></a><br />' . \_\_( 'Line', 'debug-log-manager' ) . ': ' . $error\_file\_line; |
| [548](#L548) | } |
| [549](#L549) | if ( defined( 'DISALLOW\_FILE\_EDIT' ) && ( true === constant( 'DISALLOW\_FILE\_EDIT' ) ) ) { |
| [550](#L550) | $error\_details = '<span class="error-details">' . $error\_details . '</span><hr />' . $error\_source . ': <a href="' . $error\_source\_plugin\_uri . '" target="\_blank" class="error-source-link">' . $error\_source\_plugin\_name . '<span class="dashicons dashicons-external offset-up"></span></a><br />' . \_\_( 'File', 'debug-log-manager' ) . ': ' . $error\_file\_path . '<br />' . \_\_( 'Line', 'debug-log-manager' ) . ': ' . $error\_file\_line; |
| [551](#L551) | } |
| [552](#L552) | } |
| [553](#L553) | } |
| [554](#L554) |  |
| [555](#L555) | // https://www.php.net/manual/en/function.array-search.php#120784 |
| [556](#L556) | if ( array\_search( trim( $error\_details ), array\_column( $errors\_master\_list, 'details' ) ) === false ) { |
| [557](#L557) |  |
| [558](#L558) | $errors\_master\_list[] = array( |
| [559](#L559) | 'type'                  => $error\_type, |
| [560](#L560) | 'details'               => trim( $error\_details ), |
| [561](#L561) | 'occurrences'   => array( $timestamp ), |
| [562](#L562) | ); |
| [563](#L563) |  |
| [564](#L564) | } else { |
| [565](#L565) |  |
| [566](#L566) | $error\_position = array\_search( trim( $error\_details ), array\_column( $errors\_master\_list, 'details' ) ); // integer |
| [567](#L567) |  |
| [568](#L568) | array\_push( $errors\_master\_list[$error\_position]['occurrences'], $timestamp ); |
| [569](#L569) |  |
| [570](#L570) | } |
| [571](#L571) |  |
| [572](#L572) | } |
| [573](#L573) |  |
| [574](#L574) | return json\_encode( $errors\_master\_list ); |
| [575](#L575) |  |
| [576](#L576) | } |
| [577](#L577) |  |
| [578](#L578) | /\*\* |
| [579](#L579) | \* Get the latest entries for auto-refresh feature |
| [580](#L580) | \* |
| [581](#L581) | \* @since 1.0.0 |
| [582](#L582) | \*/ |
| [583](#L583) | public function get\_latest\_entries() { |
| [584](#L584) |  |
| [585](#L585) | $errors\_master\_list = json\_decode( $this->get\_processed\_entries(), true ); |
| [586](#L586) |  |
| [587](#L587) | $n = 1; |
| [588](#L588) | $entries = array(); |
| [589](#L589) |  |
| [590](#L590) | foreach ( $errors\_master\_list as $error ) { |
| [591](#L591) |  |
| [592](#L592) | if ( function\_exists( 'wp\_date' ) ) { |
| [593](#L593) | $localized\_timestamp    = wp\_date( 'M j, Y - H:i:s', strtotime( $error['occurrences'][0] ) ); // last occurrence |
| [594](#L594) | } else { |
| [595](#L595) | $localized\_timestamp    = date\_i18n( 'M j, Y - H:i:s', strtotime( $error['occurrences'][0] ) ); |
| [596](#L596) | } |
| [597](#L597) |  |
| [598](#L598) | $occurrence\_count               = count( $error['occurrences'] ); |
| [599](#L599) |  |
| [600](#L600) | $entry = array( |
| [601](#L601) | $n, |
| [602](#L602) | $error['type'], |
| [603](#L603) | $error['details'], |
| [604](#L604) | $localized\_timestamp . '<br /><span class="dlm-faint">(' . sprintf( \_n( '%s occurrence logged', '%s occurrences logged', $occurrence\_count, 'debug-log-manager' ), number\_format\_i18n( $occurrence\_count ) ) . ')<span>', |
| [605](#L605) | ); |
| [606](#L606) |  |
| [607](#L607) | $entries[] = $entry; |
| [608](#L608) |  |
| [609](#L609) | $n++; |
| [610](#L610) |  |
| [611](#L611) | } |
| [612](#L612) |  |
| [613](#L613) | $data = array( |
| [614](#L614) | 'entries'       => $entries, |
| [615](#L615) | ); |
| [616](#L616) |  |
| [617](#L617) | echo json\_encode( $data ); |
| [618](#L618) |  |
| [619](#L619) | } |
| [620](#L620) |  |
| [621](#L621) | /\*\* |
| [622](#L622) | \* Get debug log in data table format |
| [623](#L623) | \* |
| [624](#L624) | \* @since 1.0.0 |
| [625](#L625) | \*/ |
| [626](#L626) | public function get\_entries\_datatable() { |
| [627](#L627) |  |
| [628](#L628) | ?> |
| [629](#L629) | <div> |
| [630](#L630) | <select id="errorTypeFilter" class="dlm-error-type-filter"> |
| [631](#L631) | <option value=""><?php esc\_html\_e( 'All Error Types', 'debug-log-manager' ); ?></option> |
| [632](#L632) | <option value="<?php esc\_attr\_e( 'PHP Fatal', 'debug-log-manager' ); ?>"><?php esc\_html\_e( 'PHP Fatal', 'debug-log-manager' ); ?></option> |
| [633](#L633) | <option value="<?php esc\_attr\_e( 'PHP Warning', 'debug-log-manager' ); ?>"><?php esc\_html\_e( 'PHP Warning', 'debug-log-manager' ); ?></option> |
| [634](#L634) | <option value="<?php esc\_attr\_e( 'PHP Notice', 'debug-log-manager' ); ?>"><?php esc\_html\_e( 'PHP Notice', 'debug-log-manager' ); ?></option> |
| [635](#L635) | <option value="<?php esc\_attr\_e( 'PHP Deprecated', 'debug-log-manager' ); ?>"><?php esc\_html\_e( 'PHP Deprecated', 'debug-log-manager' ); ?></option> |
| [636](#L636) | <option value="<?php esc\_attr\_e( 'PHP Parse', 'debug-log-manager' ); ?>"><?php esc\_html\_e( 'PHP Parse', 'debug-log-manager' ); ?></option> |
| [637](#L637) | <option value="<?php esc\_attr\_e( 'PHP Exception', 'debug-log-manager' ); ?>"><?php esc\_html\_e( 'PHP Exception', 'debug-log-manager' ); ?></option> |
| [638](#L638) | <option value="<?php esc\_attr\_e( 'Database', 'debug-log-manager' ); ?>"><?php esc\_html\_e( 'Database', 'debug-log-manager' ); ?></option> |
| [639](#L639) | <option value="<?php esc\_attr\_e( 'JavaScript', 'debug-log-manager' ); ?>"><?php esc\_html\_e( 'JavaScript', 'debug-log-manager' ); ?></option> |
| [640](#L640) | <option value="<?php esc\_attr\_e( 'Other', 'debug-log-manager' ); ?>"><?php esc\_html\_e( 'Other', 'debug-log-manager' ); ?></option> |
| [641](#L641) | </select> |
| [642](#L642) | </div> |
| [643](#L643) | <table id="debug-log" class="wp-list-table widefat striped"> |
| [644](#L644) | <thead> |
| [645](#L645) | <tr> |
| [646](#L646) | <th class="dlm-entry-no">#</th> |
| [647](#L647) | <th class="dlm-entry-type"><?php esc\_html\_e( 'Error Type', 'debug-log-manager' ); ?></th> |
| [648](#L648) | <th class="dlm-entry-details"><?php esc\_html\_e( 'Details', 'debug-log-manager' ); ?></th> |
| [649](#L649) | <th class="dlm-entry-datetime"><?php esc\_html\_e( 'Last Occurrence', 'debug-log-manager' ); ?></th> |
| [650](#L650) | </tr> |
| [651](#L651) | </thead> |
| [652](#L652) | <tbody> |
| [653](#L653) | <?php |
| [654](#L654) |  |
| [655](#L655) | $errors\_master\_list = json\_decode( $this->get\_processed\_entries(), true ); |
| [656](#L656) |  |
| [657](#L657) | $n = 1; |
| [658](#L658) |  |
| [659](#L659) | foreach ( $errors\_master\_list as $error ) { |
| [660](#L660) |  |
| [661](#L661) | if ( function\_exists( 'wp\_date' ) ) { |
| [662](#L662) | $localized\_timestamp    = wp\_date( 'M j, Y - H:i:s', strtotime( $error['occurrences'][0] ) ); // last occurrence |
| [663](#L663) | } else { |
| [664](#L664) | $localized\_timestamp    = date\_i18n( 'M j, Y - H:i:s', strtotime( $error['occurrences'][0] ) ); |
| [665](#L665) | } |
| [666](#L666) |  |
| [667](#L667) | $occurrence\_count               = count( $error['occurrences'] ); |
| [668](#L668) | ?> |
| [669](#L669) |  |
| [670](#L670) | <tr> |
| [671](#L671) | <td class="dlm-entry-no"><?php echo esc\_html( $n ); ?></td> |
| [672](#L672) | <td class="dlm-entry-type"><?php echo esc\_html( $error['type'] ); ?></td> |
| [673](#L673) | <td class="dlm-entry-details"><?php echo wp\_kses( $error['details'], 'post' ); ?></td> |
| [674](#L674) | <td class="dlm-entry-datetime"><?php echo esc\_html( $localized\_timestamp ); ?><br /><span class="dlm-faint">(<?php printf( \_n( '%s occurrence logged', '%s occurrences logged', $occurrence\_count, 'debug-log-manager' ), number\_format\_i18n( $occurrence\_count ) ); ?>)<span></td> |
| [675](#L675) | </tr> |
| [676](#L676) |  |
| [677](#L677) | <?php |
| [678](#L678) | $n++; |
| [679](#L679) |  |
| [680](#L680) | } |
| [681](#L681) |  |
| [682](#L682) | ?> |
| [683](#L683) | </tbody> |
| [684](#L684) | </table> |
| [685](#L685) | <?php |
| [686](#L686) |  |
| [687](#L687) | } |
| [688](#L688) |  |
| [689](#L689) | /\*\* |
| [690](#L690) | \* Get entries for dashboard widget |
| [691](#L691) | \* |
| [692](#L692) | \* @since 1.8.0 |
| [693](#L693) | \*/ |
| [694](#L694) | public function get\_dashboard\_widget\_entries() { |
| [695](#L695) |  |
| [696](#L696) | $errors\_master\_list = json\_decode( $this->get\_processed\_entries(), true ); |
| [697](#L697) |  |
| [698](#L698) | $n = 1; |
| [699](#L699) | $entries\_to\_show = 5; |
| [700](#L700) |  |
| [701](#L701) | ?> |
| [702](#L702) | <style> |
| [703](#L703) |  |
| [704](#L704) | #debug\_log\_manager\_widget.postbox .inside { |
| [705](#L705) | margin: 0; |
| [706](#L706) | padding: 0; |
| [707](#L707) | } |
| [708](#L708) |  |
| [709](#L709) | .dlm-dashboard-widget-entry { |
| [710](#L710) | padding: 12px; |
| [711](#L711) | border-bottom: 1px solid #e6e7e7; |
| [712](#L712) | word-wrap:  break-word; /\* All browsers since IE 5.5+ \*/ |
| [713](#L713) | overflow-wrap: break-word; /\* Renamed property in CSS3 draft spec \*/ |
| [714](#L714) | } |
| [715](#L715) |  |
| [716](#L716) | .dlm-dashboard-widget-entry:nth-child(odd) { |
| [717](#L717) | background-color: #f6f7f7; |
| [718](#L718) | } |
| [719](#L719) |  |
| [720](#L720) | .dlm-dashboard-widget-entry-message a.error-source-link { |
| [721](#L721) | color: #50575e; |
| [722](#L722) | text-decoration: none; |
| [723](#L723) | } |
| [724](#L724) |  |
| [725](#L725) | .dlm-dashboard-widget-entry-message a.error-source-link span { |
| [726](#L726) | position: relative; |
| [727](#L727) | margin-left: 2px; |
| [728](#L728) | color: #777; |
| [729](#L729) | font-size: 18px; |
| [730](#L730) | width: 18px; |
| [731](#L731) | height: 18px; |
| [732](#L732) | transition: .25s; |
| [733](#L733) | text-decoration: none; |
| [734](#L734) | } |
| [735](#L735) |  |
| [736](#L736) | .dlm-dashboard-widget-entry-message a.error-source-link span.offset-up { |
| [737](#L737) | top: -1px; |
| [738](#L738) | } |
| [739](#L739) |  |
| [740](#L740) | .dlm-dashboard-widget-entry-message a.error-source-link span.offset-down { |
| [741](#L741) | top: 1px; |
| [742](#L742) | } |
| [743](#L743) |  |
| [744](#L744) | .dlm-dashboard-widget-entry-message a.error-source-link:hover { |
| [745](#L745) | color: #2271b1; |
| [746](#L746) | text-decoration: underline; |
| [747](#L747) | } |
| [748](#L748) |  |
| [749](#L749) | #debug-log .dlm-entry-details a.error-source-link:hover span { |
| [750](#L750) | color: #2271b1; |
| [751](#L751) | text-decoration: none; |
| [752](#L752) | } |
| [753](#L753) |  |
| [754](#L754) | .dlm-dashboard-widget-entry-meta { |
| [755](#L755) | display: flex; |
| [756](#L756) | } |
| [757](#L757) |  |
| [758](#L758) | .dlm-dashboard-widget-entry-type { |
| [759](#L759) | margin-right: 4px; |
| [760](#L760) | font-weight: 600; |
| [761](#L761) | } |
| [762](#L762) |  |
| [763](#L763) | .dlm-dashboard-widget-footer { |
| [764](#L764) | display: flex; |
| [765](#L765) | justify-content: space-between; |
| [766](#L766) | align-items: center; |
| [767](#L767) | width: 100%; |
| [768](#L768) | box-sizing: border-box; |
| [769](#L769) | padding: 12px; |
| [770](#L770) | background-color: #f6f7f7; |
| [771](#L771) | } |
| [772](#L772) |  |
| [773](#L773) | </style> |
| [774](#L774) | <div class="dlm-dashboard-widget-entries"> |
| [775](#L775) | <?php |
| [776](#L776) |  |
| [777](#L777) | foreach ( $errors\_master\_list as $error ) { |
| [778](#L778) |  |
| [779](#L779) | if ( $n <= $entries\_to\_show ) { |
| [780](#L780) |  |
| [781](#L781) | if ( function\_exists( 'wp\_date' ) ) { |
| [782](#L782) | $localized\_timestamp    = wp\_date( 'M j, Y, H:i:s', strtotime( $error['occurrences'][0] ) ); // last occurrence |
| [783](#L783) | } else { |
| [784](#L784) | $localized\_timestamp    = date\_i18n( 'M j, Y - H:i:s', strtotime( $error['occurrences'][0] ) ); |
| [785](#L785) | } |
| [786](#L786) |  |
| [787](#L787) | $occurrence\_count               = count( $error['occurrences'] ); |
| [788](#L788) |  |
| [789](#L789) | ?> |
| [790](#L790) | <div class="dlm-dashboard-widget-entry"> |
| [791](#L791) | <div class="dlm-dashboard-widget-entry-meta"> |
| [792](#L792) | <div class="dlm-dashboard-widget-entry-type"> |
| [793](#L793) | <?php echo esc\_html( $error['type'] ); ?> |
| [794](#L794) | </div> |
| [795](#L795) | <div class="dlm-dashboard-widget-entry-datetime"> |
| [796](#L796) | | <?php echo esc\_html( $localized\_timestamp ); ?> |
| [797](#L797) | </div> |
| [798](#L798) | </div> |
| [799](#L799) | <div class="dlm-dashboard-widget-entry-message"> |
| [800](#L800) | <?php echo wp\_kses( $error['details'], 'post' ); ?> |
| [801](#L801) | </div> |
| [802](#L802) | </div> |
| [803](#L803) | <?php |
| [804](#L804) |  |
| [805](#L805) | } |
| [806](#L806) |  |
| [807](#L807) | $n++; |
| [808](#L808) |  |
| [809](#L809) | } |
| [810](#L810) |  |
| [811](#L811) | ?> |
| [812](#L812) | </div> |
| [813](#L813) | <div class="dlm-dashboard-widget-footer"> |
| [814](#L814) | <div class="dlm-dashboard-widget-logging-status"> |
| [815](#L815) | <?php echo $this->get\_status(); ?> |
| [816](#L816) | </div> |
| [817](#L817) | <a href="<?php echo get\_dashboard\_url(); ?>tools.php?page=debug-log-manager" class="button"><?php esc\_html\_e( 'Go to Debug Log Manager', 'debug-log-manager' ); ?></a> |
| [818](#L818) | </div> |
| [819](#L819) | <?php |
| [820](#L820) |  |
| [821](#L821) | } |
| [822](#L822) |  |
| [823](#L823) | /\*\* |
| [824](#L824) | \* Clear log file |
| [825](#L825) | \* |
| [826](#L826) | \* @since 1.0.0 |
| [827](#L827) | \*/ |
| [828](#L828) | public function clear\_log() { |
| [829](#L829) |  |
| [830](#L830) | if ( isset( $\_REQUEST ) && current\_user\_can( 'manage\_options' ) ) { |
| [831](#L831) |  |
| [832](#L832) | if ( wp\_verify\_nonce( sanitize\_text\_field( $\_REQUEST['nonce'] ), 'dlm-app' . get\_current\_user\_id() ) ) { |
| [833](#L833) |  |
| [834](#L834) | $debug\_log\_file\_path = get\_option( 'debug\_log\_manager\_file\_path' ); |
| [835](#L835) |  |
| [836](#L836) | file\_put\_contents( $debug\_log\_file\_path, '' ); |
| [837](#L837) |  |
| [838](#L838) | echo true; |
| [839](#L839) |  |
| [840](#L840) | } |
| [841](#L841) |  |
| [842](#L842) | } |
| [843](#L843) |  |
| [844](#L844) | } |
| [845](#L845) |  |
| [846](#L846) | /\*\* |
| [847](#L847) | \* Disable WP core's plugin/theme editor |
| [848](#L848) | \* |
| [849](#L849) | \* @since 2.0.0 |
| [850](#L850) | \*/ |
| [851](#L851) | public function disable\_wp\_file\_editor() { |
| [852](#L852) |  |
| [853](#L853) | $options = array( |
| [854](#L854) | 'add'       => true, // Add the config if missing. |
| [855](#L855) | 'raw'       => true, // Display value in raw format without quotes. |
| [856](#L856) | 'normalize' => false, // Normalize config output using WP Coding Standards. |
| [857](#L857) | ); |
| [858](#L858) |  |
| [859](#L859) | $this->wp\_config->update( 'constant', 'DISALLOW\_FILE\_EDIT', 'true', $options ); |
| [860](#L860) |  |
| [861](#L861) | // Prepare entries from the debug log for the data table |
| [862](#L862) |  |
| [863](#L863) | $errors\_master\_list = json\_decode( $this->get\_processed\_entries(), true ); |
| [864](#L864) |  |
| [865](#L865) | $n = 1; |
| [866](#L866) | $entries = array(); |
| [867](#L867) |  |
| [868](#L868) | foreach ( $errors\_master\_list as $error ) { |
| [869](#L869) |  |
| [870](#L870) | if ( function\_exists( 'wp\_date' ) ) { |
| [871](#L871) | $localized\_timestamp    = wp\_date( 'M j, Y - H:i:s', strtotime( $error['occurrences'][0] ) ); // last occurrence |
| [872](#L872) | } else { |
| [873](#L873) | $localized\_timestamp    = date\_i18n( 'M j, Y - H:i:s', strtotime( $error['occurrences'][0] ) ); |
| [874](#L874) | } |
| [875](#L875) |  |
| [876](#L876) | $occurrence\_count               = count( $error['occurrences'] ); |
| [877](#L877) |  |
| [878](#L878) | $entry = array( |
| [879](#L879) | $n, |
| [880](#L880) | $error['type'], |
| [881](#L881) | $error['details'], |
| [882](#L882) | $localized\_timestamp . '<br /><span class="dlm-faint">(' . sprintf( \_n( '%s occurrence logged', '%s occurrences logged', $occurrence\_count, 'debug-log-manager' ), number\_format\_i18n( $occurrence\_count ) ) . ')<span>', |
| [883](#L883) | ); |
| [884](#L884) |  |
| [885](#L885) | $entries[] = $entry; |
| [886](#L886) |  |
| [887](#L887) | $n++; |
| [888](#L888) |  |
| [889](#L889) | } |
| [890](#L890) |  |
| [891](#L891) | // Assemble data to return |
| [892](#L892) |  |
| [893](#L893) | $data = array( |
| [894](#L894) | 'status'        => 'disabled', // Plugin/theme editor |
| [895](#L895) | 'entries'       => $entries, // To parse data table with unlinked plugin/theme file paths |
| [896](#L896) | ); |
| [897](#L897) |  |
| [898](#L898) | echo json\_encode( $data ); |
| [899](#L899) |  |
| [900](#L900) | } |
| [901](#L901) |  |
| [902](#L902) | /\*\* |
| [903](#L903) | \* Log javascript errors |
| [904](#L904) | \* |
| [905](#L905) | \* @since 1.4.0 |
| [906](#L906) | \*/ |
| [907](#L907) | public function log\_js\_errors() { |
| [908](#L908) |  |
| [909](#L909) | // Since we are using XHR for the js error logging, JSON data comes in via php://input |
| [910](#L910) | $request = json\_decode(urldecode(file\_get\_contents('php://input')), true); // an array |
| [911](#L911) |  |
| [912](#L912) | // Verify error content and nonce and then log the JS error |
| [913](#L913) | // Source: https://plugins.svn.wordpress.org/lh-javascript-error-log/trunk/lh-javascript-error-log.php |
| [914](#L914) | if ( isset( $request['message'] ) && isset( $request['script'] ) && isset( $request['lineNo'] ) && isset( $request['columnNo'] ) && ! empty( $request['nonce'] ) && wp\_verify\_nonce( $request['nonce'], DLM\_SLUG ) ) { |
| [915](#L915) |  |
| [916](#L916) | error\_log( 'JavaScript Error: ' . $request['message'] . ' in ' . $request['script'] . ' on line ' . $request['lineNo'] . ' column ' . $request['columnNo'] . ' at ' . get\_site\_url() . $request['pageUrl'] ); |
| [917](#L917) |  |
| [918](#L918) | } else { |
| [919](#L919) |  |
| [920](#L920) | wp\_die(); |
| [921](#L921) |  |
| [922](#L922) | } |
| [923](#L923) |  |
| [924](#L924) | } |
| [925](#L925) |  |
| [926](#L926) | /\*\* |
| [927](#L927) | \* Check if a string is valid JSON |
| [928](#L928) | \* |
| [929](#L929) | \* @link https://stackoverflow.com/a/6041773 |
| [930](#L930) | \* @since 2.1.0 |
| [931](#L931) | \*/ |
| [932](#L932) | public function is\_json( $string ) { |
| [933](#L933) |  |
| [934](#L934) | json\_decode( $string ); |
| [935](#L935) | return json\_last\_error() === JSON\_ERROR\_NONE; |
| [936](#L936) |  |
| [937](#L937) | } |
| [938](#L938) |  |
| [939](#L939) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/debug-log-manager/tags/2.2.2/classes/class-debug-log.php?format=txt)
* [Original Format](/export/3222751/debug-log-manager/tags/2.2.2/classes/class-debug-log.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


