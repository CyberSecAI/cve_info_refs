=== Content from www.hashicorp.com_9f6bff0c_20250114_190428.html ===
[Skip to main content](#main)[![HashiCorp logo](/_next/static/media/hashicorp-horizontal_on-light.1d7be3dd.svg)](/ "HashiCorp")Back

* [Log in](https://portal.cloud.hashicorp.com/sign-in)

* PlatformPlatform
  + [The Infrastructure CloudSolve your biggest cloud infrastructure challenges](/infrastructure-cloud)
  + [Infrastructure Lifecycle ManagementInfrastructure as code to automate and manage all environments](/infrastructure-cloud/infrastructure-lifecycle-management)
  + [Security Lifecycle ManagementProtect, inspect, and connect your infrastructure to reduce your risk and improve your security posture](/infrastructure-cloud/security-lifecycle-management)HashiCorp Cloud PlatformGet started in minutes with our cloud products[Sign up for free](https://portal.cloud.hashicorp.com/sign-up?ajs_aid=3e3b5796-ecd1-48e1-afed-7ee0ddb0f256)
* ProductsProducts
  + Infrastructure Lifecycle Management
    - [TerraformProvisioning cloud infrastructure using a common workflow](/products/terraform)
    - [PackerBuild and manage images as code​​​​‌﻿‍﻿​‍​‍‌‍﻿﻿‌﻿​‍‌‍‍‌‌‍‌﻿‌‍‍‌‌‍﻿‍​‍​‍​﻿‍‍​‍​‍‌‍‌​‌‍​‌‌﻿‌​‌‍﻿﻿‌‍​﻿‌‍﻿‌‌﻿​﻿​‍﻿‍‌‍​﻿‌‍﻿﻿‌‍﻿‌​‍​‍​‍﻿​​‍​‍‌‍‍​‌﻿​‍‌‍‌‌‌‍‌‍​‍​‍​﻿‍‍​‍​‍‌‍‍​‌﻿‌​‌﻿‌​‌﻿​​‌﻿​﻿​﻿‍‍​‍﻿﻿​‍﻿﻿‌‍‍​‌‍​‌‌﻿​﻿‌‍‍​‌‍‍‌‌‍​﻿‌‍﻿﻿‌﻿​‍‌﻿​​​‍﻿‍‌‍​‌‌‍‌​‌‍﻿‌‌‍‍‌‌‍﻿‍​‍﻿‍‌‍‌​‌‍​‌‌﻿‌​‌‍﻿﻿‌‍​﻿‌‍﻿‌‌﻿​﻿​‍﻿‍‌‍​﻿‌‍﻿﻿‌‍﻿‌​‍﻿﻿‌‍‌‌‌‍‌​‌‍‍‌‌﻿‌​‌‍﻿﻿‌﻿​‍​‍﻿﻿‌‍‍‌‌﻿‌​‌‍‌‌‌‍﻿‌‌‌﻿﻿‌﻿‌​‌﻿‍‌‌﻿​​‌‍‌‌‌﻿​﻿​‍﻿﻿‌‌‍‌​﻿‌‍‌‍﻿﻿‌﻿‍​‌​‌‌‌​​‍‌‌‌‍‌‌‍‌‌‌‌​‌﻿​‌‌​﻿﻿‌​﻿﻿​﻿‌﻿‌﻿‍‌‌​﻿​‌​﻿﻿‌﻿‌﻿‌‍‍﻿‌​‌﻿‌‌‍‍‌﻿‌﻿‌​​‌​‍﻿﻿‌‍‍‌‌﻿‌​‌‍‌‌‌‍﻿‌‌﻿​﻿​‍﻿﻿‌‍​‍‌‍﻿‍‌​‌‍​﻿​‌‌‍‍‌​﻿​﻿‌‍​‌‌‍﻿‍‌‌​‌‌‍‍﻿‌​​﻿‌﻿‍‍‌﻿‌﻿‌﻿‌﻿‌​​﻿‌‍‍‍‌‍‌﻿‌​‍‌​﻿‍​‌​​‍‌‌‍​‌‌​‌​‍​‍‌﻿﻿‌](/products/packer)
    - [Waypoint​​​​Internal developer platform​​​​‌﻿‍﻿​‍​‍‌‍﻿﻿‌﻿​‍‌‍‍‌‌‍‌﻿‌‍‍‌‌‍﻿‍​‍​‍​﻿‍‍​‍​‍‌‍‌​‌‍​‌‌﻿‌​‌‍﻿﻿‌‍​﻿‌‍﻿‌‌﻿​﻿​‍﻿‍‌‍​﻿‌‍﻿﻿‌‍﻿‌​‍​‍​‍﻿​​‍​‍‌‍‍​‌﻿​‍‌‍‌‌‌‍‌‍​‍​‍​﻿‍‍​‍​‍‌‍‍​‌﻿‌​‌﻿‌​‌﻿​​‌﻿​﻿​﻿‍‍​‍﻿﻿​‍﻿﻿‌‍‍​‌‍​‌‌﻿​﻿‌‍‍​‌‍‍‌‌‍​﻿‌‍﻿﻿‌﻿​‍‌﻿​​​‍﻿‍‌‍​‌‌‍‌​‌‍﻿‌‌‍‍‌‌‍﻿‍​‍﻿‍‌‍‌​‌‍​‌‌﻿‌​‌‍﻿﻿‌‍​﻿‌‍﻿‌‌﻿​﻿​‍﻿‍‌‍​﻿‌‍﻿﻿‌‍﻿‌​‍﻿﻿‌‍‌‌‌‍‌​‌‍‍‌‌﻿‌​‌‍﻿﻿‌﻿​‍​‍﻿﻿‌‍‍‌‌﻿‌​‌‍‌‌‌‍﻿‌‌‌﻿﻿‌﻿‌​‌﻿‍‌‌﻿​​‌‍‌‌‌﻿​﻿​‍﻿﻿‌‌‍‌​﻿‌‍‌‍﻿﻿‌﻿‍​‌​‌‌‌​​‍‌‌‌‍‌‌‍‌‌‌‌​‌﻿​‌‌​﻿﻿‌​﻿﻿​﻿‌﻿‌﻿‍‌‌​﻿​‌​﻿﻿‌﻿‌﻿‌‍‍﻿‌​‌﻿‌‌‍‍‌﻿‌﻿‌​​‌​‍﻿﻿‌‍‍‌‌﻿‌​‌‍‌‌‌‍﻿‌‌﻿​﻿​‍﻿﻿‌‍​‍‌‍﻿‍‌​‌‍​﻿​‌‌‍‍‌​﻿​﻿‌‍​‌‌‍﻿‍‌‌​‌‌‍‍﻿‌​​﻿‌﻿‍‍‌﻿‌﻿‌﻿‌﻿‌​​﻿‌‍‍‍‌‍‌﻿‌​‍‌​﻿‍​‌​​‍‌‌‍​‌‌​‌​‍​‍‌﻿﻿‌‌﻿‍﻿​‍​‍‌‍﻿﻿‌﻿​‍‌‍‍‌‌‍‌﻿‌‍‍‌‌‍﻿‍​‍​‍​﻿‍‍​‍​‍‌‍‌​‌‍​‌‌﻿‌​‌‍﻿﻿‌‍​﻿‌‍﻿‌‌﻿​﻿​‍﻿‍‌‍​﻿‌‍﻿﻿‌‍﻿‌​‍​‍​‍﻿​​‍​‍‌‍‍​‌﻿​‍‌‍‌‌‌‍‌‍​‍​‍​﻿‍‍​‍​‍‌‍‍​‌﻿‌​‌﻿‌​‌﻿​​‌﻿​﻿​﻿‍‍​‍﻿﻿​‍﻿﻿‌‍‍​‌‍​‌‌﻿​﻿‌‍‍​‌‍‍‌‌‍​﻿‌‍﻿﻿‌﻿​‍‌﻿​​​‍﻿‍‌‍​‌‌‍‌​‌‍﻿‌‌‍‍‌‌‍﻿‍​‍﻿‍‌‍‌​‌‍​‌‌﻿‌​‌‍﻿﻿‌‍​﻿‌‍﻿‌‌﻿​﻿​‍﻿‍‌‍​﻿‌‍﻿﻿‌‍﻿‌​‍﻿﻿‌‍‌‌‌‍‌​‌‍‍‌‌﻿‌​‌‍﻿﻿‌﻿​‍​‍﻿﻿‌‍‍‌‌﻿‌​‌‍‌‌‌‍﻿‌‌‌﻿﻿‌﻿‌​‌﻿‍‌‌﻿​​‌‍‌‌‌﻿​﻿​‍﻿﻿‌‌‍‌​﻿‌‍‌‍﻿﻿‌﻿‍​‌​‌‌‌​​‍‌‌‌‍‌‌‍‌‌‌‌​‌﻿​‌‌​﻿﻿‌​﻿﻿​﻿‌﻿‌﻿‍‌‌​﻿​‌​﻿﻿‌﻿‌﻿‌‍‍﻿‌​‌﻿‌‌‍‍‌﻿‌﻿‌​​‌​‍﻿﻿‌‍‍‌‌﻿‌​‌‍‌‌‌‍﻿‌‌﻿​﻿​‍﻿﻿‌‍​‍‌‍﻿‍‌​‌‍​﻿​‌‌‍‍‌​﻿​﻿‌‍​‌‌‍﻿‍‌‌​‌‌‍‍﻿‌​​﻿‌﻿‍‍‌﻿‌﻿‌﻿‌﻿‌​​﻿‌‍‍‍‌‍‌﻿‌​‍‌​﻿‍​‌​​‍‌‌‍​‌‌​‌​‍​‍‌﻿﻿‌](/products/waypoint)
    - [NomadWorkload scheduling and orchestration](/products/nomad)
  + Security Lifecycle Management
    - [VaultIdentity-based secrets management​​​​‌﻿‍﻿​‍​‍‌‍﻿﻿‌﻿​‍‌‍‍‌‌‍‌﻿‌‍‍‌‌‍﻿‍​‍​‍​﻿‍‍​‍​‍‌‍‌​‌‍​‌‌﻿‌​‌‍﻿﻿‌‍​﻿‌‍﻿‌‌﻿​﻿​‍﻿‍‌‍​﻿‌‍﻿﻿‌‍﻿‌​‍​‍​‍﻿​​‍​‍‌‍‍​‌﻿​‍‌‍‌‌‌‍‌‍​‍​‍​﻿‍‍​‍​‍‌‍‍​‌﻿‌​‌﻿‌​‌﻿​​‌﻿​﻿​﻿‍‍​‍﻿﻿​‍﻿﻿‌‍‍​‌‍​‌‌﻿​﻿‌‍‍​‌‍‍‌‌‍​﻿‌‍﻿﻿‌﻿​‍‌﻿​​​‍﻿‍‌‍​‌‌‍‌​‌‍﻿‌‌‍‍‌‌‍﻿‍​‍﻿‍‌‍‌​‌‍​‌‌﻿‌​‌‍﻿﻿‌‍​﻿‌‍﻿‌‌﻿​﻿​‍﻿‍‌‍​﻿‌‍﻿﻿‌‍﻿‌​‍﻿﻿‌‍‌‌‌‍‌​‌‍‍‌‌﻿‌​‌‍﻿﻿‌﻿​‍​‍﻿﻿‌‍‍‌‌﻿‌​‌‍‌‌‌‍﻿‌‌‌﻿﻿‌﻿‌​‌﻿‍‌‌﻿​​‌‍‌‌‌﻿​﻿​‍﻿﻿‌‌‍‌​﻿‌‍‌‍﻿﻿‌﻿‍​‌​‌‌‌​​‍‌‌‌‍‌‌‍‌‌‌‌​‌﻿​‌‌​﻿﻿‌​﻿﻿​﻿‌﻿‌﻿‍‌‌​﻿​‌​﻿﻿‌﻿‌﻿‌‍‍﻿‌​‌﻿‌‌‍‍‌﻿‌﻿‌​​‌​‍﻿﻿‌‍‍‌‌﻿‌​‌‍‌‌‌‍﻿‌‌﻿​﻿​‍﻿﻿‌‍​‍‌‍﻿‍‌​‌‍​﻿​‌‌‍‍‌​﻿​﻿‌‍​‌‌‍﻿‍‌‌​‌‌‍‍﻿‌​​﻿‌﻿‍‍‌﻿‌﻿‌﻿‌﻿‌​​﻿‌‍‍‍‌‍‌﻿‌​‍‌​﻿‍​‌​​‍‌‌‍​‌‌​‌​‍​‍‌﻿﻿‌](/products/vault)
    - [BoundarySecure remote access](/products/boundary)
    - [ConsulService-based networking](/products/consul)HashiCorp Cloud PlatformGet started in minutes with our cloud products[Sign up for free](https://portal.cloud.hashicorp.com/sign-up?ajs_aid=3e3b5796-ecd1-48e1-afed-7ee0ddb0f256)
* DevelopersDevelopers
  + [Documentation](https://developer.hashicorp.com/)
  + [Certifications](/certification)
  + [Integrations](/partners/find-a-partner)
  + [Webinars](/events?type=Webinar)
  + [Tutorials](https://developer.hashicorp.com/tutorials)
  + [Community](/community)
  + [Service status](https://status.hashicorp.com/)
* ResourcesResources
  + [Training](/training)
  + [Resource library](/resources)
  + [Blog](/blog)
  + [Case studies](/case-studies)
  + [White papers](/resources?contentType=White%20Paper)
  + [Partner portal login](https://hashicorp.my.site.com/PartnerCommunity/s/login/?ec=302&startURL=/PartnerCommunity/s/)
  + [Partners & integrations](/partners)
  + [Solutions](/solutions)
  + [Industries](/solutions#industries)
  + [Enterprise academy](/enterprise-academy)
  + [Professional services](/professional-services)
  + [Support](https://support.hashicorp.com/hc/en-us)
* CompanyCompany
  + [About](/about)
  + [Press](/press)
  + [Careers](/careers)
  + [Events](/events)
  + [Our principles](/our-principles)
  + [The Tao of HashiCorp](/tao-of-hashicorp)
  + [Become a partner](/partners/become-a-partner)
  + [Investors](https://ir.hashicorp.com/)

* [Log in](https://portal.cloud.hashicorp.com/sign-in)

* [Log in](https://portal.cloud.hashicorp.com/sign-in)
[Blog](/blog "Blog")

* [Home](/blog)
* [Products & Technology](/blog/categories/products-technology)
* [Strategy and Insights](/blog/categories/strategy-and-insights)
* [Company](/blog/categories/company)
* [HashiCorp Voices](/blog/categories/hashicorp-voices)
* [All](/blog/all)
Products & Technology

* Twitter share
* LinkedIn share
* Facebook share
* Copy URL
# Protecting Consul from RCE Risk in Specific Configurations

Nov 27 2018[The Consul Team](/blog/authors/the-consul-team)
### [»](#introduction)Introduction

We’ve recently become aware of a set of malware targeting Consul nodes with a specific configuration which allows remote code execution. Members of our community also (responsibly) reported incidents caused by this malware, and worked with us to include a patch in a recent version of Consul that protects from this threat in the wild.

This post details how this malware may affect users, depending on their configuration, as well as outlines the steps we've taken to backport a patch for versions 1.2.4, 1.1.1, 1.0.8, and 0.9.4 to make it easy for older versions of Consul to be secured without a major version upgrade.

### [»](#summary)Summary

You should take action if you have `-enable-script-checks` set to true, or are running Consul 0.9.0 or earlier, and the Consul API is available on an interface that can be accessed over the network.

Steps to remediate:

1. Upgrade to one of the versions linked below.
2. Change `-enable-script-checks` to `-enable-local-script-checks` on Consul agents if script checks are required.
3. Disable script checks on Consul servers.
4. Ensure the Consul HTTP API is bound to a loopback interface instead of one publicly accessible.
5. [Enable ACLs](https://www.consul.io/docs/guides/acl.html#bootstrapping-acls) if not already enabled.

For full details, continue reading below.

### [»](#how-script-checks-can-be-exploited)How Script Checks Can Be Exploited

Script checks are one type of health check Consul can execute to determine the health status of a target service. Supported check types are HTTP, TCP, gRPC, Docker, Alias, TTL, and script checks. Checks can be registered via the Consul API or loaded from a directory of check definitions by the Consul agent.

Script checks will execute any command or inline script by the Consul process at the configured interval. Docker checks are the same, but execute the script within a running Docker container via the Docker daemon's API. Script (and Docker) checks are disabled by default in Consul installations as of Consul 0.9.0, and though they are useful for many cases present a potential security risk.

The Consul API is the HTTP interface for interacting with the Consul agent, including registering health check definitions as noted above. We recommend binding this API to the loopback interface in the majority of cases to prevent accidental exposure. We provide an extensive ACL system that can be utilized to protect API interactions, including registering checks.

The necessary conditions that make an agent vulnerable to this attack are:

* The API is available on an interface that can be accessed over the network.
* Script checks are enabled.
* ACLs are disabled or an ACL token is compromised.

Given the above conditions, an attacker can register a check on a remote agent with a malicious payload. By design, script checks allow arbitrary code execution, so allowing service registration with checks enabled via an exposed API presents an RCE (remote code execution) threat.

Consul's early design assumed that HTTP API was restricted to trusted local network access, and only later did it become clear that many users were not aware (or still chose) to expose it for a variety of reasons, prompting the change to disable script checks by default in 0.9.0.

Enabling ACLs is recommended as a best practice, but even with restrictive ACLs in place, if an attacker compromises a host with at least one ACL present that can register a service, that same ACL token will allow the attacker to register with a script check on any remote node that is exposed, since ACLs by design are not scoped to a single agent. We are not aware of malware exploiting locally-available ACL tokens against an ACL-protected cluster yet, but wish to proactively point out this risk.

### [»](#known-impact)Known Impact

We've had several reports of this in the last month and have confirmed that it is becoming more widespread. We want to ensure our community of Consul users is aware of this threat and knows how to protect themselves against this type of attack.

In each known case, the attacker gained access to one host in the datacenter via some unrelated vulnerability outside of Consul. The attacker then detected exposed Consul APIs on the network (likely though automated scanning) and used script checks to propagate the malware to other servers.

### [»](#remediation)Remediation

Many users use the script check feature for services across their infrastructure, so disabling script checks altogether would disable functionality they rely on.

In Consul 1.3.0, released earlier this month, [a member of](https://github.com/Aestek) the Consul community [contributed a patch](https://github.com/hashicorp/consul/pull/4715) that adds a new configuration option, [`-enable-local-script-checks`](https://www.consul.io/docs/agent/options.html#_enable_local_script_checks), which allows script checks to be registered only via local configuration files, thus preventing use of the HTTP API to register malicious checks. We recommend all users who need script checks switch to this option and find ways to avoid depending on remote API access to agents.

In addition to this, we recommend reviewing usage of the ACL system and interfaces that the Consul API is listening on. Script checks remain disabled entirely by default.

Given the challenge of upgrading through multiple major version changes to 1.3.0, where this feature was released, we have backported the [`-enable-local-script-checks`](https://www.consul.io/docs/agent/options.html#_enable_local_script_checks) option and released multiple patched versions of Consul to ensure our users can mitigate this threat with minimum disruption and effort:

* 1.2.4
  + [Changelog link](https://github.com/hashicorp/consul/blob/5ffa400008c73dee191549a60c7c3ad94d37b6de/CHANGELOG.md#124-november-27-2018)
  + [Download link](https://releases.hashicorp.com/consul/1.2.4/)
* 1.1.1
  + [Changelog link](https://github.com/hashicorp/consul/blob/5ffa400008c73dee191549a60c7c3ad94d37b6de/CHANGELOG.md#111-november-27-2018)
  + [Download link](https://releases.hashicorp.com/consul/1.1.1/)
* 1.0.8
  + [Changelog link](https://github.com/hashicorp/consul/blob/5ffa400008c73dee191549a60c7c3ad94d37b6de/CHANGELOG.md#108-november-27-2018)
  + [Download link](https://releases.hashicorp.com/consul/1.0.8/)
* 0.9.4
  + [Changelog link](https://github.com/hashicorp/consul/blob/5ffa400008c73dee191549a60c7c3ad94d37b6de/CHANGELOG.md#094-november-27-2018)
  + [Download link](https://releases.hashicorp.com/consul/0.9.4/)

These are drop-in replacements for users operating versions in that series. If you are currently using a version before 0.9.0, we recommend upgrading to 0.9.4 - there may be some breaking changes from earlier versions, but these are minimal compared with the much larger changes made in 1.0.0. As always, we recommend following our [upgrade guide](https://www.consul.io/docs/upgrade-specific.html) for all upgrades. Version 1.3.0 and onwards already contain this feature. Enterprise binaries for the same versions are also available.

In general, we prefer to see users upgrade, and rarely backport fixes like this. Because of the nature of this threat, we decided to backport this fix so that users could protect themselves quickly, without needing a major version upgrade that might potentially introduce breaking changes.

Users that rely on registering script checks via the HTTP API can continue to use `-enable-script-checks`, but should take extra care to enable ACLs and to ensure the API listener is not accessible on the network. We recommend finding alternative deployment patterns where remote HTTP API access is not required as soon as possible.

It is especially dangerous to allow script checks on Consul servers, especially since it's common to expose the API on servers for global tooling or UI access. Remotely registerable script checks on servers risk exposing all Consul state including ACL tokens to the attacker from any node on the network. We are considering making it a hard error to configure script checks on servers in future versions of Consul. Generally Consul servers tend not to run other workloads anyway so disabling script checks on them isn't likely to cause a problem, but please check your configuration didn't enable them just because other clients need to.

We are also exploring several other options to help notify users of this potentially insecure configuration, as well as considering additional protections for script checks for future releases. We added more prominent warnings to our documentation for script checks and agent configuration as well as adding a new section to our [security model](https://www.consul.io/docs/internals/security.html#known-insecure-configurations) highlighting known-insecure ways to configure Consul. As part of making running Consul securely more accessible, [we redesigned the interfaces to our ACL system in Consul 1.4.0](https://www.consul.io/docs/upgrade-specific.html#acl-upgrade) and recommend usage of that for users not currently using ACLs with Consul.

---

#### Sign up for the latest HashiCorp news

Email RequiredSend me news about HashiCorp products, releases, and events.By submitting this form, you acknowledge and agree that HashiCorp will process your personal information in accordance with the [Privacy Policy](https://www.hashicorp.com/trust/privacy).Sign Up
#### More blog posts like this one

[![HashiCorp at AWS re:Invent: Your blueprint to cloud success](/_next/image?url=https%3A%2F%2Fwww.datocms-assets.com%2F2885%2F1608227931-blog-library-product-aws.png&w=3840&q=75)November 07 2024 | Company
##### HashiCorp at AWS re:Invent: Your blueprint to cloud success

If you’re attending AWS re:Invent in Las Vegas, Dec. 2 - Dec. 6th, visit us for breakout sessions, expert talks, and product demos to learn how to take a unified approach to Infrastructure and Security Lifecycle Management.](/blog/hashicorp-at-aws-re-invent-your-blueprint-to-cloud-success)[![Consul 1.20 improves multi-tenancy, metrics, and OpenShift deployment](/_next/image?url=https%3A%2F%2Fwww.datocms-assets.com%2F2885%2F1714170780-blog-library-product-consul-dark-gradient.jpg&w=3840&q=75)October 15 2024 | Products & Technology
##### Consul 1.20 improves multi-tenancy, metrics, and OpenShift deployment

HashiCorp Consul 1.20 is a significant upgrade for the Kubernetes operator and developer experience, including better multi-tenant service discovery, catalog registration metrics, and secure OpenShift integration.](/blog/consul-1-20-improves-multi-tenancy-metrics-openshift-deployment)[![New SLM offerings for Vault, Boundary, and Consul at HashiConf 2024 make security easier](/_next/image?url=https%3A%2F%2Fwww.datocms-assets.com%2F2885%2F1723503850-hc-slm.png&w=3840&q=75)October 15 2024 | Products & Technology
##### New SLM offerings for Vault, Boundary, and Consul at HashiConf 2024 make security easier

The latest Security Lifecycle Management (SLM) features from HashiCorp Vault, Boundary, and Consul help organizations offer a smoother path to better security practices for developers.](/blog/new-slm-offerings-vault-boundary-consul-hashiconf-2024-make-security-easier)Sign up for HashiCorp newsEmail RequiredSend me news about HashiCorp products, releases, and events.By submitting this form, you acknowledge and agree that HashiCorp will process your personal information in accordance with the [Privacy Policy](https://www.hashicorp.com/privacy).Subscribe![HashiCorp logo](/_next/static/media/hashicorp-horizontal_on-dark.cc53b9aa.svg)Products

* [Terraform](/products/terraform)
* [Packer](/products/packer)
* [Vault](/products/vault)
* [Consul](/products/consul)
* [Nomad](/products/nomad)
* [Waypoint](/products/waypoint)
* [Vagrant](https://www.vagrantup.com)
* [Boundary](/products/boundary)
Resources

* [White papers](/resources?contentType=White%20Paper)
* [Events](/events)
* [Webinars](/resources?contentType=Recorded%20Webinar)
* [Support](https://support.hashicorp.com/hc/en-us)
* [Community](/community)
* [Podcast](/resources?contentType=HashiCorp%20Podcast)
* [Training](/training)
* [Professional services](/professional-services)
Developers

* [Docs](https://developer.hashicorp.com/)
* [Tutorials](https://developer.hashicorp.com/tutorials)
* [Integrations](/partners/find-a-partner)
* [Resource library](/resources)
* [Community](/community)
* [Become a partner](/partners/become-a-partner)
* [Partner portal login](https://hashicorp.my.site.com/PartnerCommunity/s/)
Company

* [About](/about)
* [Press](/press)
* [Careers](/careers)
* [Blog](/blog)
* [Investors](https://ir.hashicorp.com/)
* [Brand](https://brand.hashicorp.com/)
* [Contact us](/contact)
International sites

* [French](https://local.hashicorp.com/fr)
* [German](https://local.hashicorp.com/de)
* [Japanese](https://local.hashicorp.com/ja)
* [Korean](https://local.hashicorp.com/ko)
* [Portuguese](https://local.hashicorp.com/pt)
* [Spanish](https://local.hashicorp.com/es)

* [System Status](https://status.hashicorp.com/)
* Cookie Manager
* [Terms of use](/terms-of-service)
* [Trust center](/trust)
* [Trademark policy](/trademark-policy)
* [Trade controls](/trade-controls)

* [GitHub](https://github.com/hashicorp)
* [X](https://twitter.com/hashicorp)
* [Youtube](https://www.youtube.com/HashiCorp)
* [LinkedIn](https://www.linkedin.com/company/hashicorp)
* [Facebook](https://www.facebook.com/HashiCorp)
* [Meetup](https://www.meetup.com/pro/hugs)


=== Content from gitlab.com_f1cd4b20_20250114_190427.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Consul RCE vulnerability `enable-script-checks`

### Summary

[GitLab Premium *in GitLab*](/gitlab-org/gitlab/-/issues?label_name=GitLab+Premium "Features or changes limited or intended as part of GitLab Premium. For GitLab.com, corresponds to any non-admin features in the Silver and Gold Plans https://about.gitlab.com/gitlab-com/") [customer](/gitlab-org/omnibus-gitlab/-/issues?label_name=customer "Issues that were reported by Enterprise Edition subscribers. This label should be accompanied by either the 'bug' or 'feature proposal' label") engaged GitLab Support to disclose the ability to exploit an RCE vulnerability in Consul, using GitLab Omnibus version v15.11.3 with Consul 1.12.5.

In 2019 there was an MR that addressed this by upgrading Consul for Omnibus:
[!3400 (merged)](https://gitlab.com/gitlab-org/omnibus-gitlab/-/merge_requests/3400 "Update Consul Version in Omnibus")

This MR addressed the following issue:
[#4124 (closed)](https://gitlab.com/gitlab-org/omnibus-gitlab/-/issues/4124 "Security: update consul to 0.9.4 to address vulnerability")

The customer has indicated that upgrading the Consul version to a patched version is not enough to mitigate the vulnerability. Apparently we still set `enable_script_checks` to `true` by default in the Omnibus cookbook, and part of the mitigation is changing `enable_script_checks` to `enable_local_script_checks`.

### Steps to reproduce

[![exploit](data:image/gif;base64...)](/-/project/20699/uploads/5128533c565cb7e66ad33f790a26c6db/exploit.jpg)

### Mitigation steps

[![mitigation](data:image/gif;base64...)](/-/project/20699/uploads/a77fb311f6bcdaa9c0bf0410d617e84a/mitigation.png)

### Example Project

### What is the current *bug* behavior?

### What is the expected *correct* behavior?

### Relevant logs and/or screenshots

### Output of checks

#### Results of GitLab environment info

Expand for output related to GitLab environment info
```

(For installations with omnibus-gitlab package run and paste the output of:
`sudo gitlab-rake gitlab:env:info`)

(For installations from source run and paste the output of:
`sudo -u git -H bundle exec rake gitlab:env:info RAILS_ENV=production`)

```
#### Results of GitLab application Check

Expand for output related to the GitLab application check
```

(For installations with omnibus-gitlab package run and paste the output of:
sudo gitlab-rake gitlab:check SANITIZE=true)

(For installations from source run and paste the output of:
sudo -u git -H bundle exec rake gitlab:check RAILS_ENV=production SANITIZE=true)

(we will only investigate if the tests are passing)

```
### Possible fixes

---

cc [@gitlab-com/gl-security/appsec](/gitlab-com/gl-security/appsec "GitLab.com / GitLab Security Department / Application Security")

Edited May 17, 2023 by [Michael Trainor](/tmike)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


