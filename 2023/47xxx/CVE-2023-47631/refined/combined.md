=== Content from github.com_eab43975_20250114_195019.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvantage6%2Fvantage6%2Fcommit%2Fbf83521eb12fa80aa5fc92ef1692010a9a7f8243)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvantage6%2Fvantage6%2Fcommit%2Fbf83521eb12fa80aa5fc92ef1692010a9a7f8243)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=vantage6%2Fvantage6)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[vantage6](/vantage6)
/
**[vantage6](/vantage6/vantage6)**
Public

* [Notifications](/login?return_to=%2Fvantage6%2Fvantage6) You must be signed in to change notification settings
* [Fork
  11](/login?return_to=%2Fvantage6%2Fvantage6)
* [Star
   31](/login?return_to=%2Fvantage6%2Fvantage6)

* [Code](/vantage6/vantage6)
* [Issues
  241](/vantage6/vantage6/issues)
* [Pull requests
  6](/vantage6/vantage6/pulls)
* [Actions](/vantage6/vantage6/actions)
* [Projects
  2](/vantage6/vantage6/projects)
* [Security](/vantage6/vantage6/security)
* [Insights](/vantage6/vantage6/pulse)

Additional navigation options

* [Code](/vantage6/vantage6)
* [Issues](/vantage6/vantage6/issues)
* [Pull requests](/vantage6/vantage6/pulls)
* [Actions](/vantage6/vantage6/actions)
* [Projects](/vantage6/vantage6/projects)
* [Security](/vantage6/vantage6/security)
* [Insights](/vantage6/vantage6/pulse)

## Commit

[Permalink](/vantage6/vantage6/commit/bf83521eb12fa80aa5fc92ef1692010a9a7f8243)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-vc3v-ppc7-v486](https://github.com/advisories/GHSA-vc3v-ppc7-v486 "GHSA-vc3v-ppc7-v486")

[Browse files](/vantage6/vantage6/tree/bf83521eb12fa80aa5fc92ef1692010a9a7f8243)
Browse the repository at this point in the history

```
Remove lines that skip checking if algorithm is allowed when parent id is set
```

* Loading branch information

[![@bartvanb](https://avatars.githubusercontent.com/u/10533678?s=40&v=4)](/bartvanb)

[bartvanb](/vantage6/vantage6/commits?author=bartvanb "View all commits by bartvanb")
authored
Nov 14, 2023

2 parents
[78af06c](/vantage6/vantage6/commit/78af06c76f4cb4565519258fd2c0bebb40e37893)
+
[9215958](/vantage6/vantage6/commit/92159580f11a17cd2e06f73f636088bbcbfe9cbc)

commit bf83521

Showing
**1 changed file**
with
**0 additions**
and
**5 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

5 changes: 0 additions & 5 deletions

5
[vantage6-node/vantage6/node/docker/docker\_manager.py](#diff-1c56fc2af306de3738154bdf3cae29e34633d2ba8b3a9a11f4d8856f0936c2f8 "vantage6-node/vantage6/node/docker/docker_manager.py")

Show comments

[View file](/vantage6/vantage6/blob/bf83521eb12fa80aa5fc92ef1692010a9a7f8243/vantage6-node/vantage6/node/docker/docker_manager.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -262,11 +262,6 @@ def is\_docker\_image\_allowed( |
|  |  | bool |
|  |  | Whether docker image is allowed or not |
|  |  | """ |
|  |  | # in case of subtasks, don't check anymore, as parent has already |
|  |  | # been checked |
|  |  | if task\_info['parent'] is not None: |
|  |  | return True |
|  |  |  |
|  |  | # check if algorithm matches any of the regex cases |
|  |  | allow\_basics = self.\_policies.get('allow\_basics\_algorithm', True) |
|  |  | allowed\_algorithms = self.\_policies.get('allowed\_algorithms') |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `bf83521`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvantage6%2Fvantage6%2Fcommit%2Fbf83521eb12fa80aa5fc92ef1692010a9a7f8243) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_c6f195ea_20250114_195015.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvantage6%2Fvantage6%2Fblob%2Fversion%2F4.1.1%2Fvantage6-node%2Fvantage6%2Fnode%2Fdocker%2Fdocker_manager.py)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvantage6%2Fvantage6%2Fblob%2Fversion%2F4.1.1%2Fvantage6-node%2Fvantage6%2Fnode%2Fdocker%2Fdocker_manager.py)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=vantage6%2Fvantage6)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[vantage6](/vantage6)
/
**[vantage6](/vantage6/vantage6)**
Public

* [Notifications](/login?return_to=%2Fvantage6%2Fvantage6) You must be signed in to change notification settings
* [Fork
  11](/login?return_to=%2Fvantage6%2Fvantage6)
* [Star
   31](/login?return_to=%2Fvantage6%2Fvantage6)

* [Code](/vantage6/vantage6/tree/version/4.1.1)
* [Issues
  241](/vantage6/vantage6/issues)
* [Pull requests
  6](/vantage6/vantage6/pulls)
* [Actions](/vantage6/vantage6/actions)
* [Projects
  2](/vantage6/vantage6/projects)
* [Security](/vantage6/vantage6/security)
* [Insights](/vantage6/vantage6/pulse)

Additional navigation options

* [Code](/vantage6/vantage6/tree/version/4.1.1)
* [Issues](/vantage6/vantage6/issues)
* [Pull requests](/vantage6/vantage6/pulls)
* [Actions](/vantage6/vantage6/actions)
* [Projects](/vantage6/vantage6/projects)
* [Security](/vantage6/vantage6/security)
* [Insights](/vantage6/vantage6/pulse)

## Files

 version/4.1.1
## Breadcrumbs

1. [vantage6](/vantage6/vantage6/tree/version/4.1.1)
2. /[vantage6-node](/vantage6/vantage6/tree/version/4.1.1/vantage6-node)
3. /[vantage6](/vantage6/vantage6/tree/version/4.1.1/vantage6-node/vantage6)
4. /[node](/vantage6/vantage6/tree/version/4.1.1/vantage6-node/vantage6/node)
5. /[docker](/vantage6/vantage6/tree/version/4.1.1/vantage6-node/vantage6/node/docker)
/
# docker\_manager.py

Copy path Blame  Blame
## Latest commit

## History

[History](/vantage6/vantage6/commits/version/4.1.1/vantage6-node/vantage6/node/docker/docker_manager.py)700 lines (608 loc) · 24.7 KB version/4.1.1
## Breadcrumbs

1. [vantage6](/vantage6/vantage6/tree/version/4.1.1)
2. /[vantage6-node](/vantage6/vantage6/tree/version/4.1.1/vantage6-node)
3. /[vantage6](/vantage6/vantage6/tree/version/4.1.1/vantage6-node/vantage6)
4. /[node](/vantage6/vantage6/tree/version/4.1.1/vantage6-node/vantage6/node)
5. /[docker](/vantage6/vantage6/tree/version/4.1.1/vantage6-node/vantage6/node/docker)
/
# docker\_manager.py

Top
## File metadata and controls

* Code
* Blame

700 lines (608 loc) · 24.7 KB[Raw](https://github.com/vantage6/vantage6/raw/refs/tags/version/4.1.1/vantage6-node/vantage6/node/docker/docker_manager.py)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700"""Docker manager
The docker manager is responsible for communicating with the docker-daemon andis a wrapper around the docker module. It has methodsfor creating docker networks, docker volumes, start containers and retrieveresults from finished containers."""import osimport timeimport loggingimport dockerimport reimport shutil
from typing import NamedTuplefrom pathlib import Path
from vantage6.common import logger\_namefrom vantage6.common import get\_database\_configfrom vantage6.common.docker.addons import get\_container, running\_in\_dockerfrom vantage6.common.globals import APPNAME, BASIC\_PROCESSING\_IMAGEfrom vantage6.common.task\_status import TaskStatus, has\_task\_failedfrom vantage6.common.docker.network\_manager import NetworkManagerfrom vantage6.algorithm.tools.wrappers import get\_column\_namesfrom vantage6.cli.context import NodeContextfrom vantage6.node.context import DockerNodeContextfrom vantage6.node.docker.docker\_base import DockerBaseManagerfrom vantage6.node.docker.vpn\_manager import VPNManagerfrom vantage6.node.docker.task\_manager import DockerTaskManagerfrom vantage6.node.docker.squid import Squidfrom vantage6.common.client.node\_client import NodeClientfrom vantage6.node.docker.exceptions import ( UnknownAlgorithmStartFail, PermanentAlgorithmStartFail, AlgorithmContainerNotFound)
log = logging.getLogger(logger\_name(\_\_name\_\_))
class Result(NamedTuple): """ Data class to store the result of the docker image.
 Attributes ---------- run\_id: int ID of the current algorithm run logs: str Logs attached to current algorithm run data: str Output data of the algorithm status\_code: int Status code of the algorithm run """ run\_id: int task\_id: int logs: str data: str status: str parent\_id: int | None
class ToBeKilled(NamedTuple): """ Data class to store which tasks should be killed """ task\_id: int run\_id: int organization\_id: int
class KilledRun(NamedTuple): """ Data class to store which algorithms have been killed """ run\_id: int task\_id: int parent\_id: int
class DockerManager(DockerBaseManager): """ Wrapper for the docker-py module.
 This class manages tasks related to Docker, such as logging in to docker registries, managing input/output files, logs etc. Results can be retrieved through `get\_result()` which returns the first available algorithm result. """ log = logging.getLogger(logger\_name(\_\_name\_\_))
 def \_\_init\_\_(self, ctx: DockerNodeContext | NodeContext, isolated\_network\_mgr: NetworkManager, vpn\_manager: VPNManager, tasks\_dir: Path, client: NodeClient, proxy: Squid | None = None) -> None: """ Initialization of DockerManager creates docker connection and sets some default values.
 Parameters ---------- ctx: DockerNodeContext | NodeContext Context object from which some settings are obtained isolated\_network\_mgr: NetworkManager Manager for the isolated network vpn\_manager: VPNManager VPN Manager object tasks\_dir: Path Directory in which this task's data are stored client: NodeClient Client object to communicate with the server proxy: Squid | None Squid proxy object """ self.log.debug("Initializing DockerManager") super().\_\_init\_\_(isolated\_network\_mgr)
 self.data\_volume\_name = ctx.docker\_volume\_name config = ctx.config self.algorithm\_env = config.get('algorithm\_env', {}) self.vpn\_manager = vpn\_manager self.client = client self.\_\_tasks\_dir = tasks\_dir self.alpine\_image = config.get('alpine') self.proxy = proxy
 # keep track of the running containers self.active\_tasks: list[DockerTaskManager] = []
 # keep track of the containers that have failed to start self.failed\_tasks: list[DockerTaskManager] = []
 # before a task is executed it gets exposed to these policies self.\_policies = config.get("policies", {})
 # node name is used to identify algorithm containers belonging # to this node. This is required as multiple nodes may run at # a single machine sharing the docker daemon while using a # different server. Using a different server means that there # could be duplicate result\_id's running at the node at the same # time. self.node\_name = ctx.name
 # name of the container that is running the node self.node\_container\_name = ctx.docker\_container\_name
 # login to the registries docker\_registries = ctx.config.get("docker\_registries", []) self.login\_to\_registries(docker\_registries)
 # set database uri and whether or not it is a file self.\_set\_database(ctx.databases)
 # keep track of linked docker services self.linked\_services: list[str] = []
 # set algorithm device requests self.algorithm\_device\_requests = [] if 'algorithm\_device\_requests' in config: self.\_set\_algorithm\_device\_requests( config['algorithm\_device\_requests'] )
 def \_set\_database(self, databases: dict | list) -> None: """ Set database location and whether or not it is a file
 Parameters ---------- databases: dict | list databases as specified in the config file """ db\_labels = [db['label'] for db in databases]
 # If we're running in a docker container, database\_uri would point # to a path on the \*host\* (since it's been read from the config # file). That's no good here. Therefore, we expect the CLI to set # the environment variables for us. This has the added bonus that we # can override the URI from the command line as well. self.databases = {} for label in db\_labels: label\_upper = label.upper() db\_config = get\_database\_config(databases, label) if running\_in\_docker(): uri = os.environ[f'{label\_upper}\_DATABASE\_URI'] else: uri = db\_config['uri']
 if running\_in\_docker(): db\_is\_file = Path(f'/mnt/{uri}').exists() if db\_is\_file: uri = f'/mnt/{uri}' else: db\_is\_file = Path(uri).exists()
 if db\_is\_file: # We'll copy the file to the folder `data` in our task\_dir. self.log.info(f'Copying {uri} to {self.\_\_tasks\_dir}') shutil.copy(uri, self.\_\_tasks\_dir) uri = self.\_\_tasks\_dir / os.path.basename(uri)
 self.databases[label] = {'uri': uri, 'is\_file': db\_is\_file, 'type': db\_config['type'], 'env': db\_config.get('env', {})} self.log.debug(f"Databases: {self.databases}")
 def \_set\_algorithm\_device\_requests(self, device\_requests\_config: dict) \ -> None: """ Configure device access for the algorithm container.
 Parameters ---------- device\_requests\_config: dict A dictionary containing configuration options for device access. Supported keys: - 'gpu': A boolean value indicating whether GPU access is required. """ device\_requests = [] if device\_requests\_config.get('gpu', False): device = docker.types.DeviceRequest(count=-1, capabilities=[['gpu']]) device\_requests.append(device) self.algorithm\_device\_requests = device\_requests
 def create\_volume(self, volume\_name: str) -> None: """ Create a temporary volume for a single run.
 A single run can consist of multiple algorithm containers. It is important to note that all algorithm containers having the same job\_id have access to this container.
 Parameters ---------- volume\_name: str Name of the volume to be created """ try: self.docker.volumes.get(volume\_name) self.log.debug(f"Volume {volume\_name} already exists.")
 except docker.errors.NotFound: self.log.debug(f"Creating volume {volume\_name}") self.docker.volumes.create(volume\_name)
 def is\_docker\_image\_allowed( self, docker\_image\_name: str, task\_info: dict ) -> bool: """ Checks the docker image name.
 Against a list of regular expressions as defined in the configuration file. If no expressions are defined, all docker images are accepted.
 Parameters ---------- docker\_image\_name: str uri to the docker image task\_info: dict Dictionary with information about the task
 Returns ------- bool Whether docker image is allowed or not """ # in case of subtasks, don't check anymore, as parent has already # been checked if task\_info['parent'] is not None: return True
 # check if algorithm matches any of the regex cases allow\_basics = self.\_policies.get('allow\_basics\_algorithm', True) allowed\_algorithms = self.\_policies.get('allowed\_algorithms') if docker\_image\_name.startswith(BASIC\_PROCESSING\_IMAGE): if not allow\_basics: self.log.warn("A task was sent with a basics algorithm that " "this node does not allow to run.") return False # else: basics are allowed, so we don't need to check the regex elif allowed\_algorithms: if isinstance(allowed\_algorithms, str): allowed\_algorithms = [allowed\_algorithms] found = False for regex\_expr in allowed\_algorithms: expr\_ = re.compile(regex\_expr) if expr\_.match(docker\_image\_name): found = True
 if not found: self.log.warn("A task was sent with a docker image that this" " node does not allow to run.") return False
 # check if user or their organization is allowed allowed\_users = self.\_policies.get('allowed\_users', []) allowed\_orgs = self.\_policies.get('allowed\_organizations', []) if allowed\_users or allowed\_orgs: is\_allowed = self.client.check\_user\_allowed\_to\_send\_task( allowed\_users, allowed\_orgs, task\_info['init\_org']['id'], task\_info['init\_user']['id'] ) if not is\_allowed: self.log.warn("A task was sent by a user or organization that " "this node does not allow to start tasks.") return False
 # if no limits are declared, log warning if not self.\_policies: self.log.warn("All docker images are allowed on this Node!")
 return True
 def is\_running(self, run\_id: int) -> bool: """ Check if a container is already running for <run\_id>.
 Parameters ---------- run\_id: int run\_id of the algorithm container to be found
 Returns ------- bool Whether or not algorithm container is running already """ running\_containers = self.docker.containers.list(filters={ "label": [ f"{APPNAME}-type=algorithm", f"node={self.node\_name}", f"run\_id={run\_id}" ] }) return bool(running\_containers)
 def cleanup\_tasks(self) -> list[KilledRun]: """ Stop all active tasks
 Returns ------- list[KilledRun]: List of information on tasks that have been killed """ run\_ids\_killed = [] if self.active\_tasks: self.log.debug(f'Killing {len(self.active\_tasks)} active task(s)') while self.active\_tasks: task = self.active\_tasks.pop() task.cleanup() run\_ids\_killed.append(KilledRun( run\_id=task.run\_id, task\_id=task.task\_id, parent\_id=task.parent\_id )) return run\_ids\_killed
 def cleanup(self) -> None: """ Stop all active tasks and delete the isolated network
 Note: the temporary docker volumes are kept as they may still be used by a parent container """ # note: the function `cleanup\_tasks` returns a list of tasks that were # killed, but we don't register them as killed so they will be run # again when the node is restarted self.cleanup\_tasks() for service in self.linked\_services: self.isolated\_network\_mgr.disconnect(service)
 # remove the node container from the network, it runs this code.. so # it does not make sense to delete it just yet self.isolated\_network\_mgr.disconnect(self.node\_container\_name)
 # remove the connected containers and the network self.isolated\_network\_mgr.delete(kill\_containers=True)
 def run(self, run\_id: int, task\_info: dict, image: str, docker\_input: bytes, tmp\_vol\_name: str, token: str, databases\_to\_use: list[str] ) -> tuple[TaskStatus, list[dict] | None]: """ Checks if docker task is running. If not, creates DockerTaskManager to run the task
 Parameters ---------- run\_id: int Server run identifier task\_info: dict Dictionary with task information image: str Docker image name docker\_input: bytes Input that can be read by docker container tmp\_vol\_name: str Name of temporary docker volume assigned to the algorithm token: str Bearer token that the container can use databases\_to\_use: list[str] Labels of the databases to use
 Returns ------- TaskStatus, list[dict] | None Returns a tuple with the status of the task and a description of each port on the VPN client that forwards traffic to the algorithm container (``None`` if VPN is not set up). """ # Verify that an allowed image is used if not self.is\_docker\_image\_allowed(image, task\_info): msg = f"Docker image {image} is not allowed on this Node!" self.log.critical(msg) return TaskStatus.NOT\_ALLOWED, None
 # Check that this task is not already running if self.is\_running(run\_id): self.log.warn("Task is already being executed, discarding task") self.log.debug(f"run\_id={run\_id} is discarded") return TaskStatus.ACTIVE, None
 task = DockerTaskManager( image=image, run\_id=run\_id, task\_info=task\_info, vpn\_manager=self.vpn\_manager, node\_name=self.node\_name, tasks\_dir=self.\_\_tasks\_dir, isolated\_network\_mgr=self.isolated\_network\_mgr, databases=self.databases, docker\_volume\_name=self.data\_volume\_name, alpine\_image=self.alpine\_image, proxy=self.proxy, device\_requests=self.algorithm\_device\_requests )
 # attempt to kick of the task. If it fails do to unknown reasons we try # again. If it fails permanently we add it to the failed tasks to be # handled by the speaking worker of the node attempts = 1 while not (task.status == TaskStatus.ACTIVE) and attempts < 3: try: vpn\_ports = task.run( docker\_input=docker\_input, tmp\_vol\_name=tmp\_vol\_name, token=token, algorithm\_env=self.algorithm\_env, databases\_to\_use=databases\_to\_use )
 except UnknownAlgorithmStartFail: self.log.exception(f'Failed to start run {run\_id} for an ' 'unknown reason. Retrying...') time.sleep(1) # add some time before retrying the next attempt
 except PermanentAlgorithmStartFail: break
 attempts += 1
 # keep track of the active container if has\_task\_failed(task.status): self.failed\_tasks.append(task) return task.status, None else: self.active\_tasks.append(task) return task.status, vpn\_ports
 def get\_result(self) -> Result: """ Returns the oldest (FIFO) finished docker container.
 This is a blocking method until a finished container shows up. Once the container is obtained and the results are read, the container is removed from the docker environment.
 Returns ------- Result result of the docker image """
 # get finished results and get the first one, if no result is available # this is blocking finished\_tasks = [] while (not finished\_tasks) and (not self.failed\_tasks): for task in self.active\_tasks:
 try: if task.is\_finished(): finished\_tasks.append(task) self.active\_tasks.remove(task) break except AlgorithmContainerNotFound: self.log.exception(f'Failed to find container for ' f'result {task.result\_id}') self.failed\_tasks.append(task) self.active\_tasks.remove(task) break
 # sleep for a second before checking again time.sleep(1)
 if finished\_tasks: # at least one task is finished
 finished\_task = finished\_tasks.pop() self.log.debug(f"Run id={finished\_task.run\_id} is finished")
 # Check exit status and report logs = finished\_task.report\_status()
 # Cleanup containers finished\_task.cleanup()
 # Retrieve results from file results = finished\_task.get\_results()
 # remove the VPN ports of this run from the database self.client.request( 'port', params={'run\_id': finished\_task.run\_id}, method="DELETE" ) else: # at least one task failed to start finished\_task = self.failed\_tasks.pop() logs = 'Container failed' results = b''
 return Result( run\_id=finished\_task.run\_id, task\_id=finished\_task.task\_id, logs=logs, data=results, status=finished\_task.status, parent\_id=finished\_task.parent\_id, )
 def login\_to\_registries(self, registries: list = []) -> None: """ Login to the docker registries
 Parameters ---------- registries: list list of registries to login to """ for registry in registries: try: self.docker.login( username=registry.get("username"), password=registry.get("password"), registry=registry.get("registry") ) self.log.info(f"Logged in to {registry.get('registry')}") except docker.errors.APIError as e: self.log.warn(f"Could not login to {registry.get('registry')}") self.log.debug(e)
 def link\_container\_to\_network(self, container\_name: str, config\_alias: str) -> None: """ Link a docker container to the isolated docker network
 Parameters ---------- container\_name: str Name of the docker container to be linked to the network config\_alias: str Alias of the docker container defined in the config file """ container = get\_container( docker\_client=self.docker, name=container\_name ) if not container: self.log.error(f"Could not link docker container {container\_name} " "that was specified in the configuration file to " "the isolated docker network.") self.log.error("Container not found!") return self.isolated\_network\_mgr.connect( container\_name=container\_name, aliases=[config\_alias] ) self.linked\_services.append(container\_name)
 def kill\_selected\_tasks( self, org\_id: int, kill\_list: list[ToBeKilled] = None ) -> list[KilledRun]: """ Kill tasks specified by a kill list, if they are currently running on this node
 Parameters ---------- org\_id: int The organization id of this node kill\_list: list[ToBeKilled] A list of info about tasks that should be killed.
 Returns ------- list[KilledRun] List with information on killed tasks """ killed\_list = [] for container\_to\_kill in kill\_list: if container\_to\_kill['organization\_id'] != org\_id: continue # this run is on another node # find the task task = next(( t for t in self.active\_tasks if t.run\_id == container\_to\_kill['run\_id'] ), None) if task: self.log.info( f"Killing containers for run\_id={task.run\_id}") self.active\_tasks.remove(task) task.cleanup() killed\_list.append(KilledRun( run\_id=task.run\_id, task\_id=task.task\_id, parent\_id=task.parent\_id, )) else: self.log.warn( "Received instruction to kill run\_id=" f"{container\_to\_kill['run\_id']}, but it was not " "found running on this node.") return killed\_list
 def kill\_tasks(self, org\_id: int, kill\_list: list[ToBeKilled] = None) -> list[KilledRun]: """ Kill tasks currently running on this node.
 Parameters ---------- org\_id: int The organization id of this node kill\_list: list[ToBeKilled] (optional) A list of info on tasks that should be killed. If the list is not specified, all running algorithm containers will be killed.
 Returns ------- list[KilledRun] List of dictionaries with information on killed tasks """ if kill\_list: killed\_runs = self.kill\_selected\_tasks(org\_id=org\_id, kill\_list=kill\_list) else: # received instruction to kill all tasks on this node self.log.warn( "Received instruction from server to kill all algorithms " "running on this node. Executing that now...") killed\_runs = self.cleanup\_tasks() if len(killed\_runs): self.log.warn( "Killed the following run ids as instructed via socket:" f" {', '.join([str(r.run\_id) for r in killed\_runs])}" ) else: self.log.warn( "Instructed to kill tasks but none were running" ) return killed\_runs
 def get\_column\_names(self, label: str, type\_: str) -> list[str]: """ Get column names from a node database
 Parameters ---------- label: str Label of the database type\_: str Type of the database
 Returns ------- list[str] List of column names """ db = self.databases.get(label) if not db: self.log.error("Database with label %s not found", label) return [] if not db['is\_file']: self.log.error("Database with label %s is not a file. Cannot" " determine columns without query", label) return [] if db['type'] == 'excel': self.log.error("Cannot determine columns for excel database " " without a worksheet") return [] if type\_ not in ('csv', 'sparql'): self.log.error("Cannot determine columns for database of type %s." "Only csv and sparql are supported", type\_) return [] return get\_column\_names(db['uri'], type\_)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_3b673067_20250114_195022.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvantage6%2Fvantage6%2Fsecurity%2Fadvisories%2FGHSA-vc3v-ppc7-v486)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvantage6%2Fvantage6%2Fsecurity%2Fadvisories%2FGHSA-vc3v-ppc7-v486)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=vantage6%2Fvantage6)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[vantage6](/vantage6)
/
**[vantage6](/vantage6/vantage6)**
Public

* [Notifications](/login?return_to=%2Fvantage6%2Fvantage6) You must be signed in to change notification settings
* [Fork
  11](/login?return_to=%2Fvantage6%2Fvantage6)
* [Star
   31](/login?return_to=%2Fvantage6%2Fvantage6)

* [Code](/vantage6/vantage6)
* [Issues
  241](/vantage6/vantage6/issues)
* [Pull requests
  6](/vantage6/vantage6/pulls)
* [Actions](/vantage6/vantage6/actions)
* [Projects
  2](/vantage6/vantage6/projects)
* [Security](/vantage6/vantage6/security)
* [Insights](/vantage6/vantage6/pulse)

Additional navigation options

* [Code](/vantage6/vantage6)
* [Issues](/vantage6/vantage6/issues)
* [Pull requests](/vantage6/vantage6/pulls)
* [Actions](/vantage6/vantage6/actions)
* [Projects](/vantage6/vantage6/projects)
* [Security](/vantage6/vantage6/security)
* [Insights](/vantage6/vantage6/pulse)

# Node accepts non-whitelisted algorithms from malicious server

Moderate

[bartvanb](/bartvanb)
published
GHSA-vc3v-ppc7-v486
Nov 14, 2023

## Package

pip

vantage6-server
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

<4.1.1

## Patched versions

None

## Description

### Impact

A node does not check if an image is allowed to run if a `parent_id` is set. A malicious party that breaches the server may modify it to set a fake `parent_id` and send a task of a non-whitelisted algorithm. The node will then execute it because the `parent_id` that is set prevents checks from being run. Relevant node code [here](https://github.com/vantage6/vantage6/blob/version/4.1.1/vantage6-node/vantage6/node/docker/docker_manager.py#L265-L268)

This impacts all servers that are breached by an expert user

### Patches

Fixed in v4.1.2

### Workarounds

None

### Severity

Moderate

### CVE ID

CVE-2023-47631

### Weaknesses

[CWE-358](/advisories?query=cwe%3A358)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


