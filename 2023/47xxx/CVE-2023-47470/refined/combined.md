=== Content from github.com_63171d32_20250114_185841.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoldds96%2FReport%2Ftree%2Fmain%2FFFmpeg)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoldds96%2FReport%2Ftree%2Fmain%2FFFmpeg)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Ffiles%2Fdisambiguate&source=header-repo&source_repo=goldds96%2FReport)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[goldds96](/goldds96)
/
**[Report](/goldds96/Report)**
Public

* [Notifications](/login?return_to=%2Fgoldds96%2FReport) You must be signed in to change notification settings
* [Fork
  0](/login?return_to=%2Fgoldds96%2FReport)
* [Star
   1](/login?return_to=%2Fgoldds96%2FReport)

* [Code](/goldds96/Report)
* [Issues
  0](/goldds96/Report/issues)
* [Pull requests
  0](/goldds96/Report/pulls)
* [Actions](/goldds96/Report/actions)
* [Projects
  0](/goldds96/Report/projects)
* [Security](/goldds96/Report/security)
* [Insights](/goldds96/Report/pulse)

Additional navigation options

* [Code](/goldds96/Report)
* [Issues](/goldds96/Report/issues)
* [Pull requests](/goldds96/Report/pulls)
* [Actions](/goldds96/Report/actions)
* [Projects](/goldds96/Report/projects)
* [Security](/goldds96/Report/security)
* [Insights](/goldds96/Report/pulse)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from patchwork.ffmpeg.org_49702b87_20250114_185842.html ===

Toggle navigation

[Patchwork](/)
FFmpeg

* [Patches](/project/ffmpeg/list/)
* [Bundles](/project/ffmpeg/bundles/)
* [About this project](/project/ffmpeg/)

* [Login](/user/login/)
* [Register](/register/)
* [Mail settings](/mail/)

43745

[diff](/project/ffmpeg/patch/20230915131147.5945-2-michael%40niedermayer.cc/raw/ "Download patch diff")
[mbox](/project/ffmpeg/patch/20230915131147.5945-2-michael%40niedermayer.cc/mbox/ "Download patch mbox")
[series](/series/9699/mbox/ "Download patch mbox with dependencies")
# [FFmpeg-devel,2/4] avcodec/evc\_ps: Check ref\_pic\_num and sps\_max\_dec\_pic\_buffering\_minus1

| Message ID | 20230915131147.5945-2-michael@niedermayer.cc |
| --- | --- |
| State | New |
| Headers | show ``` Delivered-To: ffmpegpatchwork2@gmail.com Received: by 2002:a05:6a20:bca2:b0:149:dfde:5c0a with SMTP id  fx34csp305571pzb;         Fri, 15 Sep 2023 06:12:38 -0700 (PDT) X-Google-Smtp-Source:   AGHT+IFAVBPTBREzOWpd+NF2m86LTHxJ0lGiC9fWaPlmd7uDMpQxLqzchWsjwVqsN1q0tI+tvPSV X-Received: by 2002:aa7:c642:0:b0:522:4764:8baa with SMTP id  z2-20020aa7c642000000b0052247648baamr2417500edr.12.1694783556510;         Fri, 15 Sep 2023 06:12:36 -0700 (PDT) ARC-Seal: i=1; a=rsa-sha256; t=1694783556; cv=none;         d=google.com; s=arc-20160816;         b=N0xUNuZosqlJt9x4lpvuVUoK1Mdq9GTN2FyeKrigakTBhmddwkoKty4q1PkMvdGUtd          pNU4ReQkPXasFejQX1M1wxQqeUw/vHNj+Ax4RUHwPVwManYdKfgQ70l+9EsGf+/OwRtX          3iQDPHsquWhjMRRXbGXdK3heJVtK1iYsjDwc0SSCROueAYfJD8CDLkaJUm+416qHjNvu          Hs37dwvn5xxRIDTcm4UA7i3yRxWKrd+Qvy2h+pw5KRbz/qnjIpJ+jhih1JXa6lCxh1tb          xD6dJKe9ZWU+eFTZyF+pWYKROJIXl7mxaYJnQgCRQbMM5aqXaeaV6y0hcd5ktXXfeT5O          jG0Q== ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com;  s=arc-20160816;         h=sender:errors-to:content-transfer-encoding:mime-version:reply-to          :list-subscribe:list-help:list-post:list-archive:list-unsubscribe          :list-id:precedence:subject:references:in-reply-to:message-id:date          :to:from:delivered-to;         bh=LgAJC/GTceEP2QXcQ6lV6GGnp2chh2kVYt65KlrUA/I=;         fh=e5zN9xSzcxLA6bGo3lF+CqTbY/oLwzApV03EO/RBfgQ=;         b=hyuIPEZ6YOHGOQ6Jo7+YifoAefDU57xJp1psomnGEFg7tVlS4NoARXICE9ZTT8FgNj          vynW8KpMe2Vsz/o0LLW8hevRjJeJEQaFWsxuclBdvOMGaPCf7+02ZVHEejkRO1Es34pM          4kJGTUgAfJiGMn9zbvYfXTfrfONnfLeAIyGSM9qvToyD7aHzcoFRwY6uN1bUd70eTc3P          3c0V9GIYl0sYmh2MXZBfyNJwm8YRqQx2f/RuY0u3qKHJyLLUopu6NsXks/ADBvl2fVPO          UEMfpIxLgU/GRlVXhwZaZXbeyuM1LP+jbypIQE+y41k7LLn7J58vY1oByf4orGZ5BOGh          BYqw== ARC-Authentication-Results: i=1; mx.google.com;        spf=pass (google.com: domain of ffmpeg-devel-bounces@ffmpeg.org  designates 79.124.17.100 as permitted sender)  smtp.mailfrom=ffmpeg-devel-bounces@ffmpeg.org Return-Path: <ffmpeg-devel-bounces@ffmpeg.org> Received: from ffbox0-bg.mplayerhq.hu (ffbox0-bg.ffmpeg.org. [79.124.17.100])         by mx.google.com with ESMTP id  c12-20020aa7d60c000000b0052a40d398dfsi3132179edr.691.2023.09.15.06.12.13;         Fri, 15 Sep 2023 06:12:36 -0700 (PDT) Received-SPF: pass (google.com: domain of ffmpeg-devel-bounces@ffmpeg.org  designates 79.124.17.100 as permitted sender) client-ip=79.124.17.100; Authentication-Results: mx.google.com;        spf=pass (google.com: domain of ffmpeg-devel-bounces@ffmpeg.org  designates 79.124.17.100 as permitted sender)  smtp.mailfrom=ffmpeg-devel-bounces@ffmpeg.org Received: from [127.0.1.1] (localhost [127.0.0.1]) 	by ffbox0-bg.mplayerhq.hu (Postfix) with ESMTP id 46A6668C7BB; 	Fri, 15 Sep 2023 16:11:56 +0300 (EEST) X-Original-To: ffmpeg-devel@ffmpeg.org Delivered-To: ffmpeg-devel@ffmpeg.org Received: from relay9-d.mail.gandi.net (relay9-d.mail.gandi.net  [217.70.183.199])  by ffbox0-bg.mplayerhq.hu (Postfix) with ESMTPS id 0FDEF68C765  for <ffmpeg-devel@ffmpeg.org>; Fri, 15 Sep 2023 16:11:50 +0300 (EEST) Received: by mail.gandi.net (Postfix) with ESMTPSA id 3C89EFF80F  for <ffmpeg-devel@ffmpeg.org>; Fri, 15 Sep 2023 13:11:48 +0000 (UTC) From: Michael Niedermayer <michael@niedermayer.cc> To: FFmpeg development discussions and patches <ffmpeg-devel@ffmpeg.org> Date: Fri, 15 Sep 2023 15:11:45 +0200 Message-Id: <20230915131147.5945-2-michael@niedermayer.cc> X-Mailer: git-send-email 2.17.1 In-Reply-To: <20230915131147.5945-1-michael@niedermayer.cc> References: <20230915131147.5945-1-michael@niedermayer.cc> X-GND-Sasl: michael@niedermayer.cc Subject: [FFmpeg-devel] [PATCH 2/4] avcodec/evc_ps: Check ref_pic_num and  sps_max_dec_pic_buffering_minus1 X-BeenThere: ffmpeg-devel@ffmpeg.org X-Mailman-Version: 2.1.29 Precedence: list List-Id: FFmpeg development discussions and patches <ffmpeg-devel.ffmpeg.org> List-Unsubscribe: <https://ffmpeg.org/mailman/options/ffmpeg-devel>,  <mailto:ffmpeg-devel-request@ffmpeg.org?subject=unsubscribe> List-Archive: <https://ffmpeg.org/pipermail/ffmpeg-devel> List-Post: <mailto:ffmpeg-devel@ffmpeg.org> List-Help: <mailto:ffmpeg-devel-request@ffmpeg.org?subject=help> List-Subscribe: <https://ffmpeg.org/mailman/listinfo/ffmpeg-devel>,  <mailto:ffmpeg-devel-request@ffmpeg.org?subject=subscribe> Reply-To: FFmpeg development discussions and patches <ffmpeg-devel@ffmpeg.org> MIME-Version: 1.0 Content-Type: text/plain; charset="us-ascii" Content-Transfer-Encoding: 7bit Errors-To: ffmpeg-devel-bounces@ffmpeg.org Sender: "ffmpeg-devel" <ffmpeg-devel-bounces@ffmpeg.org> X-TUID: nzU0cx4+u8Y3 ``` |
| Series | [[FFmpeg-devel,1/4] avcodec/evc\_ps: Check cpb\_cnt\_minus1 and propagate error](/project/ffmpeg/list/?series=9699) | expand   * [[FFmpeg-devel,1/4] avcodec/evc\_ps: Check cpb\_cnt\_minus1 and propagate error](/project/ffmpeg/patch/20230915131147.5945-1-michael%40niedermayer.cc/) * [FFmpeg-devel,2/4] avcodec/evc\_ps: Check ref\_pic\_num and sps\_max\_dec\_pic\_buffering\_minus1 * [[FFmpeg-devel,3/4] avutil/tx\_template: Fix some signed integer overflows in DECL\_FFT5()](/project/ffmpeg/patch/20230915131147.5945-3-michael%40niedermayer.cc/) * [[FFmpeg-devel,4/4] avcodec/osq: avoid using too large numbers for shifts and integers in update\_res…](/project/ffmpeg/patch/20230915131147.5945-4-michael%40niedermayer.cc/) |

## Checks

| Context | Check | Description |
| --- | --- | --- |
| andriy/make\_x86 | success | Make finished |
| andriy/make\_fate\_x86 | success | Make fate finished |

## Commit Message

[Michael Niedermayer](/project/ffmpeg/list/?submitter=1)
Sept. 15, 2023, 1:11 p.m. UTC
```

Fixes: out of array write

Found-by: dongsookim@korea.ac.kr
Signed-off-by: Michael Niedermayer <michael@niedermayer.cc>
---
 libavcodec/evc_ps.c | 13 +++++++++----
 1 file changed, 9 insertions(+), 4 deletions(-)

```
## Comments

[James Almer](/project/ffmpeg/list/?submitter=12)
Sept. 15, 2023, 1:57 p.m. UTC |
[#1](/comment/79844/)

Addressed

Unaddressed

```

On 9/15/2023 10:11 AM, Michael Niedermayer wrote:
> Fixes: out of array write
>
> Found-by: dongsookim@korea.ac.kr
> Signed-off-by: Michael Niedermayer <michael@niedermayer.cc>
> ---
>   libavcodec/evc_ps.c | 13 +++++++++----
>   1 file changed, 9 insertions(+), 4 deletions(-)
>
> diff --git a/libavcodec/evc_ps.c b/libavcodec/evc_ps.c
> index 7fe13fd32f0..96237ed2911 100644
> --- a/libavcodec/evc_ps.c
> +++ b/libavcodec/evc_ps.c
> @@ -22,12 +22,15 @@
>   #include "evc_ps.h"
>
>   #define EXTENDED_SAR 255
> -
>   // @see ISO_IEC_23094-1 (7.3.7 Reference picture list structure syntax)
> -static int ref_pic_list_struct(GetBitContext *gb, RefPicListStruct *rpl)
> +static int ref_pic_list_struct(EVCParserSPS *sps, GetBitContext *gb, RefPicListStruct *rpl)
>   {
>       uint32_t delta_poc_st, strp_entry_sign_flag = 0;
>       rpl->ref_pic_num = get_ue_golomb_long(gb);
> +
> +    if ((unsigned)rpl->ref_pic_num  > sps->sps_max_dec_pic_buffering_minus1)
> +        return AVERROR_INVALIDDATA;
> +
>       if (rpl->ref_pic_num > 0) {
>           delta_poc_st = get_ue_golomb_long(gb);
>
> @@ -251,6 +254,8 @@ int ff_evc_parse_sps(GetBitContext *gb, EVCParamSets *ps)
>           sps->max_num_tid0_ref_pics = get_ue_golomb_31(gb);
>       else {
>           sps->sps_max_dec_pic_buffering_minus1 = get_ue_golomb_long(gb);
> +        if ((unsigned)sps->sps_max_dec_pic_buffering_minus1 > 16 - 1)
> +            return AVERROR_INVALIDDATA;
>           sps->long_term_ref_pic_flag = get_bits1(gb);
>           sps->rpl1_same_as_rpl0_flag = get_bits1(gb);
>           sps->num_ref_pic_list_in_sps[0] = get_ue_golomb(gb);
> @@ -261,7 +266,7 @@ int ff_evc_parse_sps(GetBitContext *gb, EVCParamSets *ps)
>           }
>
>           for (int i = 0; i < sps->num_ref_pic_list_in_sps[0]; ++i)
> -            ref_pic_list_struct(gb, &sps->rpls[0][i]);
> +            ref_pic_list_struct(sps, gb, &sps->rpls[0][i]);

Could check and propagate the error value here while at it.
>
>           if (!sps->rpl1_same_as_rpl0_flag) {
>               sps->num_ref_pic_list_in_sps[1] = get_ue_golomb(gb);
> @@ -270,7 +275,7 @@ int ff_evc_parse_sps(GetBitContext *gb, EVCParamSets *ps)
>                   goto fail;
>               }
>               for (int i = 0; i < sps->num_ref_pic_list_in_sps[1]; ++i)
> -                ref_pic_list_struct(gb, &sps->rpls[1][i]);
> +                ref_pic_list_struct(sps, gb, &sps->rpls[1][i]);

Ditto.
>           }
>       }
>

Should be ok.

```

[Michael Niedermayer](/project/ffmpeg/list/?submitter=1)
Sept. 15, 2023, 3:01 p.m. UTC |
[#2](/comment/79846/)

Addressed

Unaddressed

```

On Fri, Sep 15, 2023 at 10:57:29AM -0300, James Almer wrote:
> On 9/15/2023 10:11 AM, Michael Niedermayer wrote:
> > Fixes: out of array write
> >
> > Found-by: dongsookim@korea.ac.kr
> > Signed-off-by: Michael Niedermayer <michael@niedermayer.cc>
> > ---
> >   libavcodec/evc_ps.c | 13 +++++++++----
> >   1 file changed, 9 insertions(+), 4 deletions(-)
> >
> > diff --git a/libavcodec/evc_ps.c b/libavcodec/evc_ps.c
> > index 7fe13fd32f0..96237ed2911 100644
> > --- a/libavcodec/evc_ps.c
> > +++ b/libavcodec/evc_ps.c
> > @@ -22,12 +22,15 @@
> >   #include "evc_ps.h"
> >   #define EXTENDED_SAR 255
> > -
> >   // @see ISO_IEC_23094-1 (7.3.7 Reference picture list structure syntax)
> > -static int ref_pic_list_struct(GetBitContext *gb, RefPicListStruct *rpl)
> > +static int ref_pic_list_struct(EVCParserSPS *sps, GetBitContext *gb, RefPicListStruct *rpl)
> >   {
> >       uint32_t delta_poc_st, strp_entry_sign_flag = 0;
> >       rpl->ref_pic_num = get_ue_golomb_long(gb);
> > +
> > +    if ((unsigned)rpl->ref_pic_num  > sps->sps_max_dec_pic_buffering_minus1)
> > +        return AVERROR_INVALIDDATA;
> > +
> >       if (rpl->ref_pic_num > 0) {
> >           delta_poc_st = get_ue_golomb_long(gb);
> > @@ -251,6 +254,8 @@ int ff_evc_parse_sps(GetBitContext *gb, EVCParamSets *ps)
> >           sps->max_num_tid0_ref_pics = get_ue_golomb_31(gb);
> >       else {
> >           sps->sps_max_dec_pic_buffering_minus1 = get_ue_golomb_long(gb);
> > +        if ((unsigned)sps->sps_max_dec_pic_buffering_minus1 > 16 - 1)
> > +            return AVERROR_INVALIDDATA;
> >           sps->long_term_ref_pic_flag = get_bits1(gb);
> >           sps->rpl1_same_as_rpl0_flag = get_bits1(gb);
> >           sps->num_ref_pic_list_in_sps[0] = get_ue_golomb(gb);
> > @@ -261,7 +266,7 @@ int ff_evc_parse_sps(GetBitContext *gb, EVCParamSets *ps)
> >           }
> >           for (int i = 0; i < sps->num_ref_pic_list_in_sps[0]; ++i)
> > -            ref_pic_list_struct(gb, &sps->rpls[0][i]);
> > +            ref_pic_list_struct(sps, gb, &sps->rpls[0][i]);
>
> Could check and propagate the error value here while at it.
>
> >           if (!sps->rpl1_same_as_rpl0_flag) {
> >               sps->num_ref_pic_list_in_sps[1] = get_ue_golomb(gb);
> > @@ -270,7 +275,7 @@ int ff_evc_parse_sps(GetBitContext *gb, EVCParamSets *ps)
> >                   goto fail;
> >               }
> >               for (int i = 0; i < sps->num_ref_pic_list_in_sps[1]; ++i)
> > -                ref_pic_list_struct(gb, &sps->rpls[1][i]);
> > +                ref_pic_list_struct(sps, gb, &sps->rpls[1][i]);
>
> Ditto.
>
> >           }
> >       }
>
> Should be ok.

will apply with these changes

thx

[...]

```

43745

[diff](/project/ffmpeg/patch/20230915131147.5945-2-michael%40niedermayer.cc/raw/ "Download patch diff")
[mbox](/project/ffmpeg/patch/20230915131147.5945-2-michael%40niedermayer.cc/mbox/ "Download patch mbox")
[series](/series/9699/mbox/ "Download patch mbox with dependencies")
## Patch

```

diff --git a/libavcodec/evc_ps.c b/libavcodec/evc_ps.c
index 7fe13fd32f0..96237ed2911 100644
--- a/libavcodec/evc_ps.c
+++ b/libavcodec/evc_ps.c
@@ -22,12 +22,15 @@
 #include "evc_ps.h"

 #define EXTENDED_SAR 255
-
 // @see ISO_IEC_23094-1 (7.3.7 Reference picture list structure syntax)
-static int ref_pic_list_struct(GetBitContext *gb, RefPicListStruct *rpl)
+static int ref_pic_list_struct(EVCParserSPS *sps, GetBitContext *gb, RefPicListStruct *rpl)
 {
     uint32_t delta_poc_st, strp_entry_sign_flag = 0;
     rpl->ref_pic_num = get_ue_golomb_long(gb);
+
+    if ((unsigned)rpl->ref_pic_num  > sps->sps_max_dec_pic_buffering_minus1)
+        return AVERROR_INVALIDDATA;
+
     if (rpl->ref_pic_num > 0) {
         delta_poc_st = get_ue_golomb_long(gb);

@@ -251,6 +254,8 @@  int ff_evc_parse_sps(GetBitContext *gb, EVCParamSets *ps)
         sps->max_num_tid0_ref_pics = get_ue_golomb_31(gb);
     else {
         sps->sps_max_dec_pic_buffering_minus1 = get_ue_golomb_long(gb);
+        if ((unsigned)sps->sps_max_dec_pic_buffering_minus1 > 16 - 1)
+            return AVERROR_INVALIDDATA;
         sps->long_term_ref_pic_flag = get_bits1(gb);
         sps->rpl1_same_as_rpl0_flag = get_bits1(gb);
         sps->num_ref_pic_list_in_sps[0] = get_ue_golomb(gb);
@@ -261,7 +266,7 @@  int ff_evc_parse_sps(GetBitContext *gb, EVCParamSets *ps)
         }

         for (int i = 0; i < sps->num_ref_pic_list_in_sps[0]; ++i)
-            ref_pic_list_struct(gb, &sps->rpls[0][i]);
+            ref_pic_list_struct(sps, gb, &sps->rpls[0][i]);

         if (!sps->rpl1_same_as_rpl0_flag) {
             sps->num_ref_pic_list_in_sps[1] = get_ue_golomb(gb);
@@ -270,7 +275,7 @@  int ff_evc_parse_sps(GetBitContext *gb, EVCParamSets *ps)
                 goto fail;
             }
             for (int i = 0; i < sps->num_ref_pic_list_in_sps[1]; ++i)
-                ref_pic_list_struct(gb, &sps->rpls[1][i]);
+                ref_pic_list_struct(sps, gb, &sps->rpls[1][i]);
         }
     }

```

[patchwork](http://jk.ozlabs.org/projects/patchwork/) patch tracking system |
version v3.2.1.post13+gitb22f2c5 |
[about patchwork](/about/)



=== Content from github.com_4a308ed6_20250114_185841.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FFFmpeg%2FFFmpeg%2Fcommit%2F4565747056a11356210ed8edcecb920105e40b60)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FFFmpeg%2FFFmpeg%2Fcommit%2F4565747056a11356210ed8edcecb920105e40b60)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=FFmpeg%2FFFmpeg)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[FFmpeg](/FFmpeg)
/
**[FFmpeg](/FFmpeg/FFmpeg)**
Public

* [Notifications](/login?return_to=%2FFFmpeg%2FFFmpeg) You must be signed in to change notification settings
* [Fork
  12.3k](/login?return_to=%2FFFmpeg%2FFFmpeg)
* [Star
   47.3k](/login?return_to=%2FFFmpeg%2FFFmpeg)

* [Code](/FFmpeg/FFmpeg)
* [Pull requests
  1](/FFmpeg/FFmpeg/pulls)
* [Actions](/FFmpeg/FFmpeg/actions)
* [Security](/FFmpeg/FFmpeg/security)
* [Insights](/FFmpeg/FFmpeg/pulse)

Additional navigation options

* [Code](/FFmpeg/FFmpeg)
* [Pull requests](/FFmpeg/FFmpeg/pulls)
* [Actions](/FFmpeg/FFmpeg/actions)
* [Security](/FFmpeg/FFmpeg/security)
* [Insights](/FFmpeg/FFmpeg/pulse)

## Commit

[Permalink](/FFmpeg/FFmpeg/commit/4565747056a11356210ed8edcecb920105e40b60)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

avcodec/evc\_ps: Check ref\_pic\_num and sps\_max\_dec\_pic\_buffering\_minus1

[Browse files](/FFmpeg/FFmpeg/tree/4565747056a11356210ed8edcecb920105e40b60)
Browse the repository at this point in the history

```
Fixes: out of array write

Found-by: dongsookim@korea.ac.kr
Reviewed-by: James Almer <jamrial@gmail.com>
Signed-off-by: Michael Niedermayer <michael@niedermayer.cc>
```

* Loading branch information

[![@michaelni](https://avatars.githubusercontent.com/u/729390?s=40&v=4)](/michaelni)

[michaelni](/FFmpeg/FFmpeg/commits?author=michaelni "View all commits by michaelni")
committed
Sep 15, 2023

1 parent
[5c635b7](/FFmpeg/FFmpeg/commit/5c635b7d8c7c4a7fe0c93b5b3cefff3c72bff237)

commit 4565747

Showing
**1 changed file**
with
**17 additions**
and
**5 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

22 changes: 17 additions & 5 deletions

22
[libavcodec/evc\_ps.c](#diff-60ba9ba0a33980c828039844d846d7647bb5ef691b6786fd5bdaed8edca9f174 "libavcodec/evc_ps.c")

Show comments

[View file](/FFmpeg/FFmpeg/blob/4565747056a11356210ed8edcecb920105e40b60/libavcodec/evc_ps.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -24,10 +24,14 @@ |
|  |  | #define EXTENDED\_SAR 255 |
|  |  |  |
|  |  | // @see ISO\_IEC\_23094-1 (7.3.7 Reference picture list structure syntax) |
|  |  | static int ref\_pic\_list\_struct(GetBitContext \*gb, RefPicListStruct \*rpl) |
|  |  | static int ref\_pic\_list\_struct(EVCParserSPS \*sps, GetBitContext \*gb, RefPicListStruct \*rpl) |
|  |  | { |
|  |  | uint32\_t delta\_poc\_st, strp\_entry\_sign\_flag = 0; |
|  |  | rpl->ref\_pic\_num = get\_ue\_golomb\_long(gb); |
|  |  |  |
|  |  | if ((unsigned)rpl->ref\_pic\_num > sps->sps\_max\_dec\_pic\_buffering\_minus1) |
|  |  | return AVERROR\_INVALIDDATA; |
|  |  |  |
|  |  | if (rpl->ref\_pic\_num > 0) { |
|  |  | delta\_poc\_st = get\_ue\_golomb\_long(gb); |
|  |  |  |
| Expand Down  Expand Up | | @@ -239,6 +243,8 @@ int ff\_evc\_parse\_sps(GetBitContext \*gb, EVCParamSets \*ps) |
|  |  | sps->max\_num\_tid0\_ref\_pics = get\_ue\_golomb\_31(gb); |
|  |  | else { |
|  |  | sps->sps\_max\_dec\_pic\_buffering\_minus1 = get\_ue\_golomb\_long(gb); |
|  |  | if ((unsigned)sps->sps\_max\_dec\_pic\_buffering\_minus1 > 16 - 1) |
|  |  | return AVERROR\_INVALIDDATA; |
|  |  | sps->long\_term\_ref\_pic\_flag = get\_bits1(gb); |
|  |  | sps->rpl1\_same\_as\_rpl0\_flag = get\_bits1(gb); |
|  |  | sps->num\_ref\_pic\_list\_in\_sps[0] = get\_ue\_golomb(gb); |
| Expand All | | @@ -248,17 +254,23 @@ int ff\_evc\_parse\_sps(GetBitContext \*gb, EVCParamSets \*ps) |
|  |  | goto fail; |
|  |  | } |
|  |  |  |
|  |  | for (int i = 0; i < sps->num\_ref\_pic\_list\_in\_sps[0]; ++i) |
|  |  | ref\_pic\_list\_struct(gb, &sps->rpls[0][i]); |
|  |  | for (int i = 0; i < sps->num\_ref\_pic\_list\_in\_sps[0]; ++i) { |
|  |  | ret = ref\_pic\_list\_struct(sps, gb, &sps->rpls[0][i]); |
|  |  | if (ret < 0) |
|  |  | goto fail; |
|  |  | } |
|  |  |  |
|  |  | if (!sps->rpl1\_same\_as\_rpl0\_flag) { |
|  |  | sps->num\_ref\_pic\_list\_in\_sps[1] = get\_ue\_golomb(gb); |
|  |  | if ((unsigned)sps->num\_ref\_pic\_list\_in\_sps[1] >= EVC\_MAX\_NUM\_RPLS) { |
|  |  | ret = AVERROR\_INVALIDDATA; |
|  |  | goto fail; |
|  |  | } |
|  |  | for (int i = 0; i < sps->num\_ref\_pic\_list\_in\_sps[1]; ++i) |
|  |  | ref\_pic\_list\_struct(gb, &sps->rpls[1][i]); |
|  |  | for (int i = 0; i < sps->num\_ref\_pic\_list\_in\_sps[1]; ++i) { |
|  |  | ret = ref\_pic\_list\_struct(sps, gb, &sps->rpls[1][i]); |
|  |  | if (ret < 0) |
|  |  | goto fail; |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `4565747`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FFFmpeg%2FFFmpeg%2Fcommit%2F4565747056a11356210ed8edcecb920105e40b60) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


