=== Content from jira.xwiki.org_4234273f_20250115_090657.html ===


[Log in](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-20348)[Skip to main content](#main)[Skip to sidebar](#sidebar)Linked ApplicationsLoading…[![XWiki.org JIRA](/s/-65z3d2/930000/8ws80b/_/jira-logo-scaled.png)](https://jira.xwiki.org/secure/MyJiraHome.jspa)

* [Dashboards](/secure/Dashboard.jspa "View and manage your dashboards")
* [Projects](/secure/BrowseProjects.jspa "View recent projects and browse a list of projects")
* [Issues](/issues/ "Search for issues and view recent issues")

* Give feedback to Atlassian
* [Help](https://docs.atlassian.com/jira/jcore-docs-093/ "Help")
  + [Jira Core help](https://docs.atlassian.com/jira/jcore-docs-093/ "Go to the online documentation for Jira Core")
  + [Keyboard Shortcuts](/secure/ViewKeyboardShortcuts%21default.jspa "Get more information about Jira's Keyboard Shortcuts")
  + [About Jira](/secure/AboutPage.jspa "Get more information about Jira")
  + [Jira Credits](/secure/credits/AroundTheWorld%21default.jspa "See who did what")
* [Log In](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-20348)

![Uploaded image for project: 'XWiki Platform'](https://jira.xwiki.org/secure/projectavatar?pid=10010&avatarId=13602)

1. [XWiki Platform](/browse/XWIKI)
2. [XWIKI-20348](/browse/XWIKI-20348)

# SXSS via source in text area

[Log In](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-20348 "Log In")ClosedExportnull

XMLWordPrintable
#### Details

* **Type:**
  ![](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.") Bug
* **Resolution:**
  Solved By
* **Priority:**
  ![](/images/icons/priorities/blocker.svg "Blocker - Blocks development and/or testing work, production could not run.") Blocker
* **Fix Version/s:**
  [14.10](/issues/?jql=project+%3D+XWIKI+AND+fixVersion+%3D+14.10 "14.10 ")
* **Affects Version/s:**
  14.6-rc-1
* **Component/s:**
  [User - User Profile](/issues/?jql=project+%3D+XWIKI+AND+component+%3D+%22User+-+User+Profile%22 "User - User Profile ")
* **Labels:**
  + [attack\_xss](/issues/?jql=labels+%3D+attack_xss "attack_xss")
  + [attacker\_account](/issues/?jql=labels+%3D+attacker_account "attacker_account")
  + [attacker\_comment](/issues/?jql=labels+%3D+attacker_comment "attacker_comment")
  + [intigriti](/issues/?jql=labels+%3D+intigriti "intigriti")
  + [security](/issues/?jql=labels+%3D+security "security")

* **Difficulty:**
  Unknown
* **Documentation:**
  N/A
* **Documentation in Release Notes:**
  N/A
* **Similar issues:**

#### Description

**SUBMISSION REFERENCES**

* **Submission code**: XWIKI-PST6B4ZK
* **Submission URL**: <https://www.intigriti.com/auth/dashboard?redirect=/submissions/e95a7ad5-7029-4627-abf0-3e3e3ea0b4ce/XWIKI-PST6B4ZK>

**RESEARCHER INFORMATION**

* **Submitter**: ynoof

**SUBMISSION INFORMATION**

* **Created at**: Fri, 04 Nov 2022 14:36:49 GMT
* **Submission status**: Archived

**REPORT CONTENT**

* **Severity**: High
* **Domain**: <https://intigriti.xwiki.com/> (Url)
* **Proof of concept**: Hello,

Stored XSS at user profile via `about` text area.

1. 1. 1. Steps to reproduce

         1. Go to user profile

         2. Add the following payload in the `about` text area.

```

html

'"<!--><Details Open OnToggle=confirm("Ynoof/Was/Here")>

/html

```

Click on source before saving.

1. 1. 1. POC
         {186066}

Thanks,

Ynoof

* **Impact**: An attacker can execute any js code on the victim's browser.
* **Personal data involved**: No
* **Endpoint**: <https://intigriti.xwiki.com/xwiki/bin/view/XWiki/ynsec3>
* **Type**: Stored Cross-Site Scripting
* **Attachments**: poc.png

#### Attachments

#### Attachments

* Options
  + [Sort By Name](/browse/XWIKI-20348?attachmentSortBy=fileName#attachmentmodule "viewissue.subtasks.tab.show.all.name")
  + [Sort By Date](/browse/XWIKI-20348?attachmentSortBy=dateTime#attachmentmodule "Sort By Date")
  + [Ascending](/browse/XWIKI-20348?attachmentOrder=asc#attachmentmodule "Ascending")
  + [Descending](/browse/XWIKI-20348?attachmentOrder=desc#attachmentmodule "Descending")
  + [Thumbnails](/browse/XWIKI-20348?attachmentViewMode=gallery#attachmentmodule "Thumbnails")
  + [List](/browse/XWIKI-20348?attachmentViewMode=list#attachmentmodule "List")
  + [Download All](/secure/attachmentzip/69995.zip "Download all attachments as a ZIP file")

1. [![186066_poc.png](https://jira.xwiki.org/secure/thumbnail/40862/_thumb_40862.png)](/secure/attachment/40862/186066_poc.png "186066_poc.png - Latest 10/Nov/22 10:20 - Intigriti Integration")[186066\_poc.png](/secure/attachment/40862/186066_poc.png "186066_poc.png - Latest 10/Nov/22 10:20 - Intigriti Integration")70 kB10/Nov/22 10:20
#### Issue Links

is caused by

![Bug - A problem which impairs or prevents the functions of the product.](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.")
[XCOMMONS-2568](/browse/XCOMMONS-2568)
Restricted HTML filtering bypass (XSS) via HTML comments

* ![Blocker - Blocks development and/or testing work, production could not run.](/images/icons/priorities/blocker.svg "Blocker - Blocks development and/or testing work, production could not run.")
* Closed

#### Activity

#### People

Assignee:

![MichaelHamann](https://jira.xwiki.org/secure/useravatar?size=small&avatarId=10222)
Michael Hamann

Reporter:

![intigriti](https://jira.xwiki.org/secure/useravatar?size=small&avatarId=10222)
Intigriti Integration

Votes:
0
Vote for this issue

Watchers:
1
Start watching this issue

#### Dates

Created:

10/Nov/22 10:20

Updated:

10/Dec/24 17:10

Resolved:

18/Nov/22 12:32

* Atlassian Jira [Project Management Software](https://www.atlassian.com/software/jira)
* [About Jira](/secure/AboutPage.jspa/secure/AboutPage.jspa)
* [Report a problem](/secure/CreateIssue%21default.jspa)

Powered by a free Atlassian [Jira](http://www.atlassian.com/software/jira) open source license for XWiki.org. Try Jira - [bug tracking software](http://www.atlassian.com/software/jira) for *your* team.

[Atlassian](http://www.atlassian.com/)



=== Content from github.com_5de5151c_20250115_090656.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxwiki%2Fxwiki-commons%2Fsecurity%2Fadvisories%2FGHSA-x37v-36wv-6v6h)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxwiki%2Fxwiki-commons%2Fsecurity%2Fadvisories%2FGHSA-x37v-36wv-6v6h)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=xwiki%2Fxwiki-commons)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[xwiki](/xwiki)
/
**[xwiki-commons](/xwiki/xwiki-commons)**
Public

* [Notifications](/login?return_to=%2Fxwiki%2Fxwiki-commons) You must be signed in to change notification settings
* [Fork
  123](/login?return_to=%2Fxwiki%2Fxwiki-commons)
* [Star
   85](/login?return_to=%2Fxwiki%2Fxwiki-commons)

* [Code](/xwiki/xwiki-commons)
* [Pull requests
  28](/xwiki/xwiki-commons/pulls)
* [Actions](/xwiki/xwiki-commons/actions)
* [Projects
  0](/xwiki/xwiki-commons/projects)
* [Security](/xwiki/xwiki-commons/security)
* [Insights](/xwiki/xwiki-commons/pulse)

Additional navigation options

* [Code](/xwiki/xwiki-commons)
* [Pull requests](/xwiki/xwiki-commons/pulls)
* [Actions](/xwiki/xwiki-commons/actions)
* [Projects](/xwiki/xwiki-commons/projects)
* [Security](/xwiki/xwiki-commons/security)
* [Insights](/xwiki/xwiki-commons/pulse)

# Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting') in org.xwiki.commons:xwiki-commons-xml

Critical

[tmortagne](/tmortagne)
published
GHSA-x37v-36wv-6v6h
Apr 20, 2023

## Package

maven

 org.xwiki.commons:xwiki-commons-xml
([Maven](/advisories?query=ecosystem%3Amaven))

## Affected versions

>= 4.2-milestone-1, < 14.10

## Patched versions

14.10

## Description

### Impact

The "restricted" mode of the HTML cleaner in XWiki, introduced in version 4.2-milestone-1 and massively improved in version 14.6-rc-1, allowed the injection of arbitrary HTML code and thus cross-site scripting via invalid HTML comments. As a consequence, any code relying on this "restricted" mode for security is vulnerable to JavaScript injection ("cross-site scripting"/XSS). An example are anonymous comments in XWiki where the HTML macro filters HTML using restricted mode:

```
{{html}}
<!--> <Details Open OnToggle=confirm("XSS")>
{{/html}}
```

When a privileged user with programming rights visits such a comment in XWiki, the malicious JavaScript code is executed in the context of the user session. This allows server-side code execution with programming rights, impacting the confidentiality, integrity and availability of the XWiki instance.

Note that while all versions since 4.2-milestone-1 should be vulnerable, only starting with version 14.6-rc-1 the HTML comment is necessary for the attack to succeed due to [another vulnerability](https://github.com/xwiki/xwiki-commons/security/advisories/GHSA-m3jr-cvhj-f35j) that has been patched in version 14.6-rc-1.

### Patches

This problem has been patched in XWiki 14.10, HTML comments are now removed in restricted mode and a check has been introduced that ensures that comments don't start with `>`.

### Workarounds

There are no known workarounds apart from upgrading to a version including the fix.

### References

* <https://jira.xwiki.org/browse/XCOMMONS-2568>
* <https://jira.xwiki.org/browse/XWIKI-20348>
* [8ff1a9d](https://github.com/xwiki/xwiki-commons/commit/8ff1a9d7e5d7b45b690134a537d53dc05cae04ab)

### For more information

If you have any questions or comments about this advisory:

* Open an issue in [Jira XWiki](https://jira.xwiki.org/)
* Email us at XWiki Security mailing-list

### Attribution

This vulnerability was reported on Intigriti by [ynoof](https://twitter.com/ynoofAssiri) [@Ynoof5](https://github.com/Ynoof5).

### Severity

Critical

9.1

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
Low

User interaction
Required

Scope
Changed

Confidentiality
High

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:H/I:H/A:H

### CVE ID

CVE-2023-29528

### Weaknesses

[CWE-79](/advisories?query=cwe%3A79)

### Credits

* [![@Ynoof5](https://avatars.githubusercontent.com/u/55372552?s=40&v=4)](/Ynoof5)
  [Ynoof5](/Ynoof5)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from jira.xwiki.org_41dcbffa_20250115_090656.html ===


[Log in](/login.jsp?os_destination=%2Fbrowse%2FXCOMMONS-2568)[Skip to main content](#main)[Skip to sidebar](#sidebar)Linked ApplicationsLoading…[![XWiki.org JIRA](/s/-65z3d2/930000/8ws80b/_/jira-logo-scaled.png)](https://jira.xwiki.org/secure/MyJiraHome.jspa)

* [Dashboards](/secure/Dashboard.jspa "View and manage your dashboards")
* [Projects](/secure/BrowseProjects.jspa "View recent projects and browse a list of projects")
* [Issues](/issues/ "Search for issues and view recent issues")

* Give feedback to Atlassian
* [Help](https://docs.atlassian.com/jira/jcore-docs-093/ "Help")
  + [Jira Core help](https://docs.atlassian.com/jira/jcore-docs-093/ "Go to the online documentation for Jira Core")
  + [Keyboard Shortcuts](/secure/ViewKeyboardShortcuts%21default.jspa "Get more information about Jira's Keyboard Shortcuts")
  + [About Jira](/secure/AboutPage.jspa "Get more information about Jira")
  + [Jira Credits](/secure/credits/AroundTheWorld%21default.jspa "See who did what")
* [Log In](/login.jsp?os_destination=%2Fbrowse%2FXCOMMONS-2568)

![Uploaded image for project: 'XWiki Commons'](https://jira.xwiki.org/secure/projectavatar?pid=10620&avatarId=13603)

1. [XWiki Commons](/browse/XCOMMONS)
2. [XCOMMONS-2568](/browse/XCOMMONS-2568)

# Restricted HTML filtering bypass (XSS) via HTML comments

[Log In](/login.jsp?os_destination=%2Fbrowse%2FXCOMMONS-2568 "Log In")ClosedExportnull

XMLWordPrintable
#### Details

* **Type:**
  ![](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.") Bug
* **Resolution:**
  Fixed
* **Priority:**
  ![](/images/icons/priorities/blocker.svg "Blocker - Blocks development and/or testing work, production could not run.") Blocker
* **Fix Version/s:**
  [14.10](/issues/?jql=project+%3D+XCOMMONS+AND+fixVersion+%3D+14.10 "14.10 ")
* **Affects Version/s:**
  14.6-rc-1
* **Component/s:**
  [XML](/issues/?jql=project+%3D+XCOMMONS+AND+component+%3D+XML "XML XML Module")
* **Labels:**
  + [attack\_xss](/issues/?jql=labels+%3D+attack_xss "attack_xss")
  + [attacker\_account](/issues/?jql=labels+%3D+attacker_account "attacker_account")
  + [attacker\_comment](/issues/?jql=labels+%3D+attacker_comment "attacker_comment")
  + [security](/issues/?jql=labels+%3D+security "security")

* **Tests:**
  Unit
* **Difficulty:**
  Unknown
* **Documentation:**
  N/A
* **Documentation in Release Notes:**
  N/A
* **Pull Request Status:**
  Pull Request accepted
* **Similar issues:**

#### Description

**Steps to reproduce:**

Filter the input

```
<!--> <Details Open OnToggle=confirm("XSS")>
```

in restricted mode (in XWiki, e.g., put the code in an HTML macro as a user without script right or in a comment).

**Expected result:**

Either the ontoggle parameter is removed or the whole content is interpreted as a comment without starting <.

**Actual result:**

```
<!--> <Details Open OnToggle=confirm("XSS")>-->
```

In the context of a browser a confirmation message "XSS" is displayed.

The reason for this is that HtmlCleaner parses <!--> as the start of an HTML comment while browsers (correctly) parse this [as an empty comment](https://html.spec.whatwg.org/#parse-error-abrupt-closing-of-empty-comment). The reason for this is that [HTML comments](https://html.spec.whatwg.org/#comments) must not start with >.

This issue has also been reported to HtmlCleaner as [bug 234](https://sourceforge.net/p/htmlcleaner/bugs/234/).

This security issue only exists since XWiki 14.6RC1 as only since [~~XCOMMONS-1680~~](https://jira.xwiki.org/browse/XCOMMONS-1680 "Filter Html attributes in restricted mode based on a whitelist") HTML attributes are actually filtered to prevent XSS.

#### Attachments

#### Issue Links

causes

![Bug - A problem which impairs or prevents the functions of the product.](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.")
[XWIKI-20348](/browse/XWIKI-20348)
SXSS via source in text area

* ![Blocker - Blocks development and/or testing work, production could not run.](/images/icons/priorities/blocker.svg "Blocker - Blocks development and/or testing work, production could not run.")
* Closed

links to

![Web Link](https://github.com/favicon.ico "Web Link")
[GitHub Security advisory](https://github.com/xwiki/xwiki-commons/security/advisories/GHSA-x37v-36wv-6v6h)

#### Activity

#### People

Assignee:

![MichaelHamann](https://jira.xwiki.org/secure/useravatar?size=small&avatarId=10222)
Michael Hamann

Reporter:

![MichaelHamann](https://jira.xwiki.org/secure/useravatar?size=small&avatarId=10222)
Michael Hamann

Votes:
0
Vote for this issue

Watchers:
1
Start watching this issue

#### Dates

Created:

15/Nov/22 14:01

Updated:

12/Apr/23 14:10

Resolved:

16/Nov/22 18:21

* Atlassian Jira [Project Management Software](https://www.atlassian.com/software/jira)
* [About Jira](/secure/AboutPage.jspa/secure/AboutPage.jspa)
* [Report a problem](/secure/CreateIssue%21default.jspa)

Powered by a free Atlassian [Jira](http://www.atlassian.com/software/jira) open source license for XWiki.org. Try Jira - [bug tracking software](http://www.atlassian.com/software/jira) for *your* team.

[Atlassian](http://www.atlassian.com/)



=== Content from github.com_44bb628e_20250115_090656.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxwiki%2Fxwiki-commons%2Fcommit%2F8ff1a9d7e5d7b45b690134a537d53dc05cae04ab)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxwiki%2Fxwiki-commons%2Fcommit%2F8ff1a9d7e5d7b45b690134a537d53dc05cae04ab)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=xwiki%2Fxwiki-commons)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[xwiki](/xwiki)
/
**[xwiki-commons](/xwiki/xwiki-commons)**
Public

* [Notifications](/login?return_to=%2Fxwiki%2Fxwiki-commons) You must be signed in to change notification settings
* [Fork
  123](/login?return_to=%2Fxwiki%2Fxwiki-commons)
* [Star
   85](/login?return_to=%2Fxwiki%2Fxwiki-commons)

* [Code](/xwiki/xwiki-commons)
* [Pull requests
  28](/xwiki/xwiki-commons/pulls)
* [Actions](/xwiki/xwiki-commons/actions)
* [Projects
  0](/xwiki/xwiki-commons/projects)
* [Security](/xwiki/xwiki-commons/security)
* [Insights](/xwiki/xwiki-commons/pulse)

Additional navigation options

* [Code](/xwiki/xwiki-commons)
* [Pull requests](/xwiki/xwiki-commons/pulls)
* [Actions](/xwiki/xwiki-commons/actions)
* [Projects](/xwiki/xwiki-commons/projects)
* [Security](/xwiki/xwiki-commons/security)
* [Insights](/xwiki/xwiki-commons/pulse)

## Commit

[Permalink](/xwiki/xwiki-commons/commit/8ff1a9d7e5d7b45b690134a537d53dc05cae04ab)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

XCOMMONS-2568: Improve comment handling in HTMLCleaner ([#306](https://github.com/xwiki/xwiki-commons/pull/306))

[Browse files](/xwiki/xwiki-commons/tree/8ff1a9d7e5d7b45b690134a537d53dc05cae04ab)
Browse the repository at this point in the history

* Loading branch information

[![@michitux](https://avatars.githubusercontent.com/u/198317?s=40&v=4)](/michitux)

[michitux](/xwiki/xwiki-commons/commits?author=michitux "View all commits by michitux")
authored
Nov 16, 2022

1 parent
[a2f20a6](/xwiki/xwiki-commons/commit/a2f20a6ed4b2ae2aaf206d455d5719637dc9c7ee)

commit 8ff1a9d

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**75 additions**
and
**2 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* xwiki-commons-core/xwiki-commons-xml/src

  + main/java/org/xwiki/xml

    - html

      * xwiki-commons-core/xwiki-commons-xml/src/main/java/org/xwiki/xml/html/HTMLUtils.java
        [HTMLUtils.java](#diff-9360badff580832565db136778c929d7aa7f04d7022d8fb40433bb7f80e8c911)
    - internal/html

      * xwiki-commons-core/xwiki-commons-xml/src/main/java/org/xwiki/xml/internal/html/DefaultHTMLCleaner.java
        [DefaultHTMLCleaner.java](#diff-3584354d62cdd7827c8e17f74b3bfd58cdde9d68d0fe4ec1771d8fc58aa3a903)
  + test/java/org/xwiki/xml/internal/html

    - xwiki-commons-core/xwiki-commons-xml/src/test/java/org/xwiki/xml/internal/html/DefaultHTMLCleanerTest.java
      [DefaultHTMLCleanerTest.java](#diff-8f4184ae46501b7812490e56339d20e9d5481edd7b29f01c2c9add66c61d7aab)

## There are no files selected for viewing

17 changes: 17 additions & 0 deletions

17
[xwiki-commons-core/xwiki-commons-xml/src/main/java/org/xwiki/xml/html/HTMLUtils.java](#diff-9360badff580832565db136778c929d7aa7f04d7022d8fb40433bb7f80e8c911 "xwiki-commons-core/xwiki-commons-xml/src/main/java/org/xwiki/xml/html/HTMLUtils.java")

Show comments

[View file](/xwiki/xwiki-commons/blob/8ff1a9d7e5d7b45b690134a537d53dc05cae04ab/xwiki-commons-core/xwiki-commons-xml/src/main/java/org/xwiki/xml/html/HTMLUtils.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -26,6 +26,7 @@ |
|  |  | import java.util.regex.Matcher; |
|  |  | import java.util.regex.Pattern; |
|  |  |  |
|  |  | import org.jdom.Comment; |
|  |  | import org.jdom.DocType; |
|  |  | import org.jdom.Element; |
|  |  | import org.jdom.input.DOMBuilder; |
| Expand Down  Expand Up | | @@ -179,6 +180,22 @@ protected void printElement(Writer out, Element element, int level, NamespaceSta |
|  |  | currentFormat.setExpandEmptyElements(currentFormatPolicy); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | @Override |
|  |  | protected void printComment(Writer out, Comment comment) throws IOException |
|  |  | { |
|  |  | String commentText = comment.getText(); |
|  |  |  |
|  |  | // TODO: remove this again when https://sourceforge.net/p/htmlcleaner/bugs/234/ has been fixed. |
|  |  | // Make sure that the comment text conforms to the HTML specification, in particular: "Optionally, text, |
|  |  | // with the additional restriction that the text must not start with the string ">", nor start with the |
|  |  | // string "->", nor contain the strings "<!--", "-->", or "--!>", nor end with the string "<!-"." |
|  |  | while (commentText.startsWith(">") || commentText.startsWith("->")) { |
|  |  | commentText = commentText.substring(1); |
|  |  | } |
|  |  |  |
|  |  | super.printComment(out, new Comment(commentText)); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
| Expand Down | |  |

20 changes: 18 additions & 2 deletions

20
[...-core/xwiki-commons-xml/src/main/java/org/xwiki/xml/internal/html/DefaultHTMLCleaner.java](#diff-3584354d62cdd7827c8e17f74b3bfd58cdde9d68d0fe4ec1771d8fc58aa3a903 "xwiki-commons-core/xwiki-commons-xml/src/main/java/org/xwiki/xml/internal/html/DefaultHTMLCleaner.java")

Show comments

[View file](/xwiki/xwiki-commons/blob/8ff1a9d7e5d7b45b690134a537d53dc05cae04ab/xwiki-commons-core/xwiki-commons-xml/src/main/java/org/xwiki/xml/internal/html/DefaultHTMLCleaner.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -267,6 +267,13 @@ private CleanerProperties getDefaultCleanerProperties(HTMLCleanerConfiguration c |
|  |  |  |
|  |  | defaultProperties.setDeserializeEntities(true); |
|  |  |  |
|  |  | // Omit comments in restricted mode to avoid any potential parser confusion. |
|  |  | // Any part of the filtered HTML that contains unfiltered input is potentially dangerous/a candidate for |
|  |  | // parser confusion. Comments, style and script elements seem to be frequently found ingredients in successful |
|  |  | // attacks against good sanitizers. We're already removing style and script elements, so removing comments |
|  |  | // seems like a good defense against future attacks. |
|  |  | defaultProperties.setOmitComments(isRestricted(configuration)); |
|  |  |  |
|  |  | return defaultProperties; |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -314,8 +321,7 @@ private TrimAttributeCleanerTransformations getDefaultCleanerTransformations(HTM |
|  |  | defaultTransformations.addTransformation(tt); |
|  |  | } |
|  |  |  |
|  |  | String restricted = configuration.getParameters().get(HTMLCleanerConfiguration.RESTRICTED); |
|  |  | if ("true".equalsIgnoreCase(restricted)) { |
|  |  | if (isRestricted(configuration)) { |
|  |  |  |
|  |  | tt = new TagTransformation(HTMLConstants.TAG\_SCRIPT, HTMLConstants.TAG\_PRE, false); |
|  |  | defaultTransformations.addTransformation(tt); |
| Expand All | | @@ -336,6 +342,16 @@ private boolean isHTML5(HTMLCleanerConfiguration configuration) |
|  |  | return getHTMLVersion(configuration) == 5; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* @param configuration the configuration to parse |
|  |  | \* @return if the parsing should happen in restricted mode |
|  |  | \*/ |
|  |  | private boolean isRestricted(HTMLCleanerConfiguration configuration) |
|  |  | { |
|  |  | String restricted = configuration.getParameters().get(HTMLCleanerConfiguration.RESTRICTED); |
|  |  | return "true".equalsIgnoreCase(restricted); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* @param configuration The configuration to parse. |
|  |  | \* @return The HTML version specified in the configuration. |
| Expand Down | |  |

40 changes: 40 additions & 0 deletions

40
[...e/xwiki-commons-xml/src/test/java/org/xwiki/xml/internal/html/DefaultHTMLCleanerTest.java](#diff-8f4184ae46501b7812490e56339d20e9d5481edd7b29f01c2c9add66c61d7aab "xwiki-commons-core/xwiki-commons-xml/src/test/java/org/xwiki/xml/internal/html/DefaultHTMLCleanerTest.java")

Show comments

[View file](/xwiki/xwiki-commons/blob/8ff1a9d7e5d7b45b690134a537d53dc05cae04ab/xwiki-commons-core/xwiki-commons-xml/src/test/java/org/xwiki/xml/internal/html/DefaultHTMLCleanerTest.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -33,6 +33,8 @@ |
|  |  | import org.junit.jupiter.api.BeforeEach; |
|  |  | import org.junit.jupiter.api.Disabled; |
|  |  | import org.junit.jupiter.api.Test; |
|  |  | import org.junit.jupiter.params.ParameterizedTest; |
|  |  | import org.junit.jupiter.params.provider.CsvSource; |
|  |  | import org.w3c.dom.Document; |
|  |  | import org.w3c.dom.NodeList; |
|  |  | import org.xwiki.component.manager.ComponentManager; |
| Expand Down  Expand Up | | @@ -327,6 +329,44 @@ void restrictedAttributesAndTags() throws Exception |
|  |  | + "</mi></math>"); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Verify comment handling in restricted mode. |
|  |  | \*/ |
|  |  | @ParameterizedTest |
|  |  | @CsvSource({ |
|  |  | "<p><strong>Hello World</strong></p>,<strong>Hello <!-- a comment --> World</strong>", |
|  |  | "'', <!--My favorite operators are > and <!-->", |
|  |  | // FIXME: Actually, just the comment should be removed but due to erroneous parsing in HTMLCleaner, the whole |
|  |  | // string is treated as a comment. |
|  |  | "'', <!--> <a href=\"#\">no comment</a>", |
|  |  | "'', <!---> <a href=\"#\">no comment</a>" |
|  |  | }) |
|  |  | void restrictedComments(String expected, String actual) |
|  |  | { |
|  |  | Map<String, String> parameters = new HashMap<>(this.cleanerConfiguration.getParameters()); |
|  |  | parameters.put("restricted", "true"); |
|  |  | this.cleanerConfiguration.setParameters(parameters); |
|  |  |  |
|  |  | assertHTML(expected, actual); |
|  |  | } |
|  |  |  |
|  |  | @ParameterizedTest |
|  |  | @CsvSource({ |
|  |  | "<!--My favorite operators are > and <!-->, <!--My favorite operators are > and <!-->", |
|  |  | "<!-- a comment ==!> not a comment-->, <!-- a comment --!> not a comment", |
|  |  | // FIXME: this is wrongly parsed as a full comment. |
|  |  | "<!-- <a foo=`bar`>not a comment</a>-->, <!--> <a foo=`bar`>not a comment</a>", |
|  |  | "<!--=>-->, <!--->", |
|  |  | // FIXME: according to the HTML specification, this should be a comment. |
|  |  | "'', <! fake comment >", |
|  |  | "<!-- <!== comment -->, <!-- <!-- comment -->", |
|  |  | "<!--My favorite operators are > and <!=-->, <!--My favorite operators are > and <!--->" |
|  |  | }) |
|  |  | void comments(String expected, String actual) |
|  |  | { |
|  |  | assertHTML(expected, actual); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Verify that passing a fully-formed XHTML header works fine. |
|  |  | \*/ |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `8ff1a9d`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxwiki%2Fxwiki-commons%2Fcommit%2F8ff1a9d7e5d7b45b690134a537d53dc05cae04ab) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


