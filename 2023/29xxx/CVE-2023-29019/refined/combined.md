=== Content from owasp.org_76ec8669_20250114_183713.html ===


For full functionality of this site it is necessary to enable JavaScript. Here are the  [instructions how to enable JavaScript in your web browser](http://turnonjs.com/).

[![OWASP logo](https://owasp.org/assets/images/logo.png)](https://owasp.org/)

[![](https://owasp.org/assets/images/logo.png)](https://owasp.org/)

 [Store](https://owasp.org/store)
[Donate](https://owasp.org/donate?reponame=www-community)
[Join](https://owasp.org/membership)

This website uses cookies to analyze our traffic and only share that information with our analytics partners.

Accept

x

[Store](https://owasp.org/store)
[Donate](https://owasp.org/donate?reponame=www-community)
[Join](https://owasp.org/membership)

# Session fixation

**Author:** mwood

**Contributor(s):** Nsrav, Greenapple8189, KirstenS, Alan Jex, Mark Sienkiewicz, Bill Sempf, kingthorin

## Description

Session Fixation is an attack that permits an attacker to hijack a valid
user session. The attack explores a limitation in the way the web
application manages the session ID, more specifically the vulnerable web
application. When authenticating a user, it doesn’t assign a new session
ID, making it possible to use an existent session ID. The attack
consists of obtaining a valid session ID (e.g. by connecting to the
application), inducing a user to authenticate himself with that session
ID, and then hijacking the user-validated session by the knowledge of
the used session ID. The attacker has to provide a legitimate Web
application session ID and try to make the victim’s browser use it.

The session fixation attack is not a class of [Session
Hijacking](Session_hijacking_attack), which steals the
established session between the client and the Web Server after the user
logs in. Instead, the Session Fixation attack fixes an established
session on the victim’s browser, so the attack starts before the user
logs in.

There are several techniques to execute the attack; it depends on how
the Web application deals with session tokens. Below are some of the
most common techniques:

* **Session token in the URL argument:** The Session ID is sent to the
  victim in a hyperlink and the victim accesses the site through the
  malicious URL.
* **Session token in a hidden form field:** In this method, the victim
  must be tricked to authenticate in the target Web Server, using a login
  form developed for the attacker. The form could be hosted in the evil
  web server or directly in html formatted e-mail.
* **Session ID in a cookie:**

  + Client-side script

    Most browsers support the execution of client-side scripting. In this
    case, the aggressor could use attacks of code injection as the
    [XSS](Cross-site_Scripting_%5C%28XSS%5C%29 "wikilink") (Cross-site scripting)
    attack to insert a malicious code in the hyperlink sent to the victim
    and fix a Session ID in its cookie. Using the function document.cookie,
    the browser which executes the command becomes capable of fixing values
    inside of the cookie that it will use to keep a session between the
    client and the Web Application.
  + META Tag

    Is considered a code injection attack, however, different from
    the XSS attack where undesirable scripts can be disabled, or the
    execution can be denied. The attack using this method becomes much more
    efficient because it’s impossible to disable the processing of these
    tags in the browsers.
  + HTTP header response-

    This method explores the server response to fix the Session ID in the
    victim’s browser. Including the parameter Set-Cookie in the HTTP header
    response, the attacker is able to insert the value of Session ID in the
    cookie and sends it to the victim’s browser.

## Examples

### Example 1

The example below explains a simple form, the process of the attack, and
the expected results.

1. The attacker has to establish a legitimate connection with the web
   server which
2. issues a session ID or, the attacker can create a new
   session with the proposed session ID, then
3. the attacker has to send
   a link with the established session ID to the victim, they have to click
   on the link sent from the attacker accessing the site
4. the Web
   Server saw that session was already established and a new one need not
   to be created
5. the victim provides their credentials to the Web
   Server
6. knowing the session ID, the attacker can access the user’s
   account.

![Session sniffing](../assets/images/attacks/Session_Attacks_Fixation.jpg)

Figure 1. Simple example of Session Fixation attack.

### Example 2

Client-side scripting

The processes for the attack using the execution of scripts in the
victim’s browser are very similar to example 1, however, in this case,
the Session ID does not appear as an argument of the URL, but inside of
the cookie. To fix the value of the Session ID in the victim’s cookie,
the attacker could insert a JavaScript code in the URL that will be
executed in the victim’s browser.

` http://website.kom/`

### Example 3

META Tag

As well as client-side scripting, the code injection must be made in the
URL that will be sent to the victim.

`http://website.kon/<meta http-equiv=Set-Cookie content=”sessionid=abcd”>`

### Example 4

HTTP header response

The insertion of the value of the SessionID into the cookie manipulating
the server response can be made, intercepting the packages exchanged
between the client and the Web Application inserting the Set-Cookie
parameter.

![Session sniffing](../assets/images/attacks/Session_Attacks_Fixation2.jpg)

Figure 2. Set-Cookie in the HTTP header response

## Related [Attacks](https://owasp.org/www-community/attacks/)

* <XSS>
* [Session hijacking attack](Session_hijacking_attack)

## References

* <http://www.acros.si/papers/session_fixation.pdf>
* [http://en.wikipedia.org/wiki/Session\_fixation](https://en.wikipedia.org/wiki/Session_fixation)
* <http://www.derkeiler.com/pdf/Mailing-Lists/Securiteam/2002-12/0099.pdf>

---

[Watch](https://github.com/owasp/www-community/subscription)
[Star](https://github.com/owasp/www-community)

**The OWASP® Foundation** works to improve the security of software through its community-led open source software projects,
hundreds of chapters worldwide, tens of thousands of members, and by hosting local and global conferences.
### Important Community Links

* [Community](/www-community/)
* Attacks (You are here)
* [Vulnerabilities](/www-community/vulnerabilities)
* [Controls](/www-community/controls)

### Upcoming OWASP Global Events

## Corporate Supporters

[Become a corporate supporter](https://owasp.org/supporters)

* [HOME](https://owasp.org/)
* [PROJECTS](https://owasp.org/projects/)
* [CHAPTERS](https://owasp.org/chapters/)
* [EVENTS](https://owasp.org/events/)
* [ABOUT](https://owasp.org/about/)
* [PRIVACY](https://owasp.org/www-policy/operational/privacy)
* [SITEMAP](https://owasp.org/sitemap/)
* [CONTACT](https://owasp.org/contact/)

OWASP, the OWASP logo, and Global AppSec are registered trademarks and AppSec Days, AppSec California, AppSec Cali, SnowFROC, and LASCON are trademarks of the OWASP Foundation, Inc. Unless otherwise specified, all content on the site is Creative Commons Attribution-ShareAlike v4.0 and provided without warranty of service or accuracy. For more information, please refer to our [General Disclaimer](/www-policy/operational/general-disclaimer.html). OWASP does not endorse or recommend commercial products or services, allowing our community to remain vendor neutral with the collective wisdom of the best minds in software security worldwide. Copyright 2025, OWASP Foundation, Inc.



=== Content from github.com_3747d950_20250114_183712.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffastify%2Ffastify-passport%2Fsecurity%2Fadvisories%2FGHSA-4m3m-ppvx-xgw9)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffastify%2Ffastify-passport%2Fsecurity%2Fadvisories%2FGHSA-4m3m-ppvx-xgw9)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=fastify%2Ffastify-passport)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[fastify](/fastify)
/
**[fastify-passport](/fastify/fastify-passport)**
Public

* [Notifications](/login?return_to=%2Ffastify%2Ffastify-passport) You must be signed in to change notification settings
* [Fork
  47](/login?return_to=%2Ffastify%2Ffastify-passport)
* [Star
   266](/login?return_to=%2Ffastify%2Ffastify-passport)

* [Code](/fastify/fastify-passport)
* [Issues
  6](/fastify/fastify-passport/issues)
* [Pull requests
  5](/fastify/fastify-passport/pulls)
* [Actions](/fastify/fastify-passport/actions)
* [Security](/fastify/fastify-passport/security)
* [Insights](/fastify/fastify-passport/pulse)

Additional navigation options

* [Code](/fastify/fastify-passport)
* [Issues](/fastify/fastify-passport/issues)
* [Pull requests](/fastify/fastify-passport/pulls)
* [Actions](/fastify/fastify-passport/actions)
* [Security](/fastify/fastify-passport/security)
* [Insights](/fastify/fastify-passport/pulse)

# Session fixation in fastify-passport

High

[mcollina](/mcollina)
published
GHSA-4m3m-ppvx-xgw9
Apr 21, 2023

## Package

npm

@fastify/passport
([npm](/advisories?query=ecosystem%3Anpm))

## Affected versions

<= 1.0.1 && 2.0.0 <= 2.2.0

## Patched versions

>= 1.1.0 < 2.0.0 && >= 2.3.0

## Description

Applications using `@fastify/passport` for user authentication, in combination with `@fastify/session` as the underlying session management mechanism, are vulnerable to [session fixation attacks](https://owasp.org/www-community/attacks/Session_fixation) from network and same-site attackers.

## Details

fastify applications rely on the `@fastify/passport` library for user authentication. The login and user validation are performed by the `authenticate` function. When executing this function, the `sessionId` is preserved between the pre-login and the authenticated session. Network and [same-site attackers](https://canitakeyoursubdomain.name/) can hijack the victim's session by tossing a valid `sessionId` cookie in the victim's browser and waiting for the victim to log in on the website.

## Fix

As a solution, newer versions of `@fastify/passport` regenerate `sessionId` upon login, preventing the attacker-controlled pre-session cookie from being upgraded to an authenticated session.

## Credits

* Pedro Adão ([@pedromigueladao](https://github.com/pedromigueladao)), [Instituto Superior Técnico, University of Lisbon](https://tecnico.ulisboa.pt/)
* Marco Squarcina ([@lavish](https://github.com/lavish)), [Security & Privacy Research Unit, TU Wien](https://secpriv.wien/)

### Severity

High

8.1

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
Required

Scope
Unchanged

Confidentiality
High

Integrity
High

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:N

### CVE ID

CVE-2023-29019

### Weaknesses

[CWE-384](/advisories?query=cwe%3A384)

### Credits

* [![@pedromigueladao](https://avatars.githubusercontent.com/u/15143244?s=40&v=4)](/pedromigueladao)
  [pedromigueladao](/pedromigueladao)
  Reporter
* [![@lavish](https://avatars.githubusercontent.com/u/446674?s=40&v=4)](/lavish)
  [lavish](/lavish)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_36ce7cb9_20250114_183712.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffastify%2Ffastify-passport%2Fcommit%2F43c82c321db58ea3e375dd475de60befbfcf2a11)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffastify%2Ffastify-passport%2Fcommit%2F43c82c321db58ea3e375dd475de60befbfcf2a11)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=fastify%2Ffastify-passport)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[fastify](/fastify)
/
**[fastify-passport](/fastify/fastify-passport)**
Public

* [Notifications](/login?return_to=%2Ffastify%2Ffastify-passport) You must be signed in to change notification settings
* [Fork
  47](/login?return_to=%2Ffastify%2Ffastify-passport)
* [Star
   266](/login?return_to=%2Ffastify%2Ffastify-passport)

* [Code](/fastify/fastify-passport)
* [Issues
  6](/fastify/fastify-passport/issues)
* [Pull requests
  5](/fastify/fastify-passport/pulls)
* [Actions](/fastify/fastify-passport/actions)
* [Security](/fastify/fastify-passport/security)
* [Insights](/fastify/fastify-passport/pulse)

Additional navigation options

* [Code](/fastify/fastify-passport)
* [Issues](/fastify/fastify-passport/issues)
* [Pull requests](/fastify/fastify-passport/pulls)
* [Actions](/fastify/fastify-passport/actions)
* [Security](/fastify/fastify-passport/security)
* [Insights](/fastify/fastify-passport/pulse)

## Commit

[Permalink](/fastify/fastify-passport/commit/43c82c321db58ea3e375dd475de60befbfcf2a11)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-4m3m-ppvx-xgw9](https://github.com/advisories/GHSA-4m3m-ppvx-xgw9 "GHSA-4m3m-ppvx-xgw9")

[Browse files](/fastify/fastify-passport/tree/43c82c321db58ea3e375dd475de60befbfcf2a11)
Browse the repository at this point in the history

```
Signed-off-by: RafaelGSS <rafael.nunu@hotmail.com>
```

* Loading branch information

[![@RafaelGSS](https://avatars.githubusercontent.com/u/26234614?s=40&v=4)](/RafaelGSS)

[RafaelGSS](/fastify/fastify-passport/commits?author=RafaelGSS "View all commits by RafaelGSS")
authored
Apr 20, 2023

1 parent
[121afae](/fastify/fastify-passport/commit/121afaefc8601d3ffcf1b327aff3661ae9acce63)

commit 43c82c3

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**57 additions**
and
**29 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* src/session-managers

  + src/session-managers/SecureSessionManager.ts
    [SecureSessionManager.ts](#diff-d4b95aa9053ee947861ea8f7bf5a8a94e1a0c4194defa55c95acf0971bc50041)
* test

  + test/session-isolation.test.ts
    [session-isolation.test.ts](#diff-a6cea5e0a13ec5970b2be0b20c3c81d8209d3edce661d5a06525ca10dee9fdf5)

## There are no files selected for viewing

8 changes: 8 additions & 0 deletions

8
[src/session-managers/SecureSessionManager.ts](#diff-d4b95aa9053ee947861ea8f7bf5a8a94e1a0c4194defa55c95acf0971bc50041 "src/session-managers/SecureSessionManager.ts")

Show comments

[View file](/fastify/fastify-passport/blob/43c82c321db58ea3e375dd475de60befbfcf2a11/src/session-managers/SecureSessionManager.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -24,11 +24,19 @@ export class SecureSessionManager { |
|  |  |  |
|  |  | async logIn(request: FastifyRequest, user: any) { |
|  |  | const object = await this.serializeUser(user, request) |
|  |  | // Handle sessions using @fastify/session |
|  |  | if (request.session.regenerate) { |
|  |  | // regenerate session to guard against session fixation |
|  |  | await request.session.regenerate() |
|  |  | } |
|  |  | request.session.set(this.key, object) |
|  |  | } |
|  |  |  |
|  |  | async logOut(request: FastifyRequest) { |
|  |  | request.session.set(this.key, undefined) |
|  |  | if (request.session.regenerate) { |
|  |  | await request.session.regenerate() |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | getUserFromSession(request: FastifyRequest) { |
| Expand Down | |  |

78 changes: 49 additions & 29 deletions

78
[test/session-isolation.test.ts](#diff-a6cea5e0a13ec5970b2be0b20c3c81d8209d3edce661d5a06525ca10dee9fdf5 "test/session-isolation.test.ts")

Show comments

[View file](/fastify/fastify-passport/blob/43c82c321db58ea3e375dd475de60befbfcf2a11/test/session-isolation.test.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,38 +1,44 @@ |
|  |  | /\* eslint-disable @typescript-eslint/no-empty-function \*/ |
|  |  | import { generateTestUser, getConfiguredTestServer, TestBrowserSession } from './helpers' |
|  |  |  |
|  |  | const { server, fastifyPassport } = getConfiguredTestServer() |
|  |  |  |
|  |  | server.get( |
|  |  | '/protected', |
|  |  | { preValidation: fastifyPassport.authenticate('test', { authInfo: false }) }, |
|  |  | async () => 'hello!' |
|  |  | ) |
|  |  | server.get('/my-id', { preValidation: fastifyPassport.authenticate('test', { authInfo: false }) }, async (request) => |
|  |  | String((request.user as any).id) |
|  |  | ) |
|  |  | server.post( |
|  |  | '/login', |
|  |  | { preValidation: fastifyPassport.authenticate('test', { authInfo: false }) }, |
|  |  | async () => 'success' |
|  |  | ) |
|  |  |  |
|  |  | server.post('/force-login', async (request, reply) => { |
|  |  | await request.logIn(generateTestUser()) |
|  |  | void reply.send('logged in') |
|  |  | }) |
|  |  |  |
|  |  | server.post( |
|  |  | '/logout', |
|  |  | { preValidation: fastifyPassport.authenticate('test', { authInfo: false }) }, |
|  |  | async (request, reply) => { |
|  |  | await request.logout() |
|  |  | void reply.send('logged out') |
|  |  | } |
|  |  | ) |
|  |  | function createServer() { |
|  |  | const { server, fastifyPassport } = getConfiguredTestServer() |
|  |  |  |
|  |  | server.get( |
|  |  | '/protected', |
|  |  | { preValidation: fastifyPassport.authenticate('test', { authInfo: false }) }, |
|  |  | async () => 'hello!' |
|  |  | ) |
|  |  | server.get('/my-id', { preValidation: fastifyPassport.authenticate('test', { authInfo: false }) }, async (request) => |
|  |  | String((request.user as any).id) |
|  |  | ) |
|  |  | server.post( |
|  |  | '/login', |
|  |  | { preValidation: fastifyPassport.authenticate('test', { authInfo: false }) }, |
|  |  | async () => 'success' |
|  |  | ) |
|  |  |  |
|  |  | server.post('/force-login', async (request, reply) => { |
|  |  | await request.logIn(generateTestUser()) |
|  |  | void reply.send('logged in') |
|  |  | }) |
|  |  |  |
|  |  | server.post( |
|  |  | '/logout', |
|  |  | { preValidation: fastifyPassport.authenticate('test', { authInfo: false }) }, |
|  |  | async (request, reply) => { |
|  |  | await request.logout() |
|  |  | void reply.send('logged out') |
|  |  | } |
|  |  | ) |
|  |  | return server |
|  |  | } |
|  |  |  |
|  |  | const suite = (sessionPluginName) => { |
|  |  | process.env.SESSION\_PLUGIN = sessionPluginName |
|  |  | const server = createServer() |
|  |  | describe(`${sessionPluginName} tests`, () => { |
|  |  | const sessionOnlyTest = sessionPluginName === '@fastify/session' ? test : test.skip |
|  |  | describe('session isolation', () => { |
|  |  | let userA, userB, userC |
|  |  |  |
| Expand Down  Expand Up | | @@ -175,8 +181,22 @@ const suite = (sessionPluginName) => { |
|  |  | // expect each returned ID to be unique |
|  |  | expect(Array.from(new Set(ids)).sort()).toEqual(ids.sort()) |
|  |  | }) |
|  |  |  |
|  |  | sessionOnlyTest('should regenerate session on login', async () => { |
|  |  | expect(userA.cookies['sessionId']).toBeUndefined() |
|  |  | await userA.inject({ method: 'GET', url: '/protected' }) |
|  |  | expect(userA.cookies['sessionId']).not.toBeUndefined() |
|  |  | const prevSessionId = userA.cookies.sessionId |
|  |  | await userA.inject({ |
|  |  | method: 'POST', |
|  |  | url: '/login', |
|  |  | payload: { login: 'test', password: 'test' }, |
|  |  | }) |
|  |  | expect(userA.cookies.sessionId).not.toBe(prevSessionId) |
|  |  | }) |
|  |  | }) |
|  |  | }) |
|  |  | delete process.env.SESSION\_PLUGIN |
|  |  | } |
|  |  |  |
|  |  | suite('@fastify/session') |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `43c82c3`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffastify%2Ffastify-passport%2Fcommit%2F43c82c321db58ea3e375dd475de60befbfcf2a11) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


