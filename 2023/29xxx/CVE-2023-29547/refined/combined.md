=== Content from www.mozilla.org_acf64303_20250114_225612.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2023-13

## Security Vulnerabilities fixed in Firefox 112, Firefox for Android 112, Focus for Android 112

Announced
April 11, 2023
Impact
high
Products
Firefox, Firefox for Android, Focus for Android
Fixed in

* Firefox 112
* Firefox for Android 112
* Focus for Android 112

#### [#CVE-2023-29531: Out-of-bound memory access in WebGL on macOS](#CVE-2023-29531)

Reporter
DoHyun Lee
Impact
high
##### Description

An attacker could have caused an out of bounds memory access using WebGL APIs, leading to memory corruption and a potentially exploitable crash.
*This bug only affects Firefox for macOS. Other operating systems are unaffected.*

##### References

* [Bug 1794292](https://bugzilla.mozilla.org/show_bug.cgi?id=1794292)

#### [#CVE-2023-29532: Mozilla Maintenance Service Write-lock bypass](#CVE-2023-29532)

Reporter
Holger Fuhrmannek
Impact
high
##### Description

A local attacker can trick the Mozilla Maintenance Service into applying an unsigned update file by pointing the service at an update file on a malicious SMB server. The update file can be replaced after the signature check, before the use, because the write-lock requested by the service does not work on a SMB server.
*Note: This attack requires local system access and only affects Windows. Other operating systems are not affected.*

##### References

* [Bug 1806394](https://bugzilla.mozilla.org/show_bug.cgi?id=1806394)

#### [#CVE-2023-29533: Fullscreen notification obscured](#CVE-2023-29533)

Reporter
Irvan Kurniawan
Impact
high
##### Description

A website could have obscured the fullscreen notification by using a combination of `window.open`, fullscreen requests, `window.name` assignments, and `setInterval` calls. This could have led to user confusion and possible spoofing attacks.

##### References

* [Bug 1814597](https://bugzilla.mozilla.org/show_bug.cgi?id=1814597)
* [Bug 1798219](https://bugzilla.mozilla.org/show_bug.cgi?id=1798219)

#### [#CVE-2023-29534: Fullscreen notification could have been obscured on Firefox for Android](#CVE-2023-29534)

Reporter
Shaheen Fazim and Hafiizh
Impact
high
##### Description

Different techniques existed to obscure the fullscreen notification in Firefox and Focus for Android. These could have led to potential user confusion and spoofing attacks.
*This bug only affects Firefox and Focus for Android. Other versions of Firefox are unaffected.*

##### References

* [Bug 1816059](https://bugzilla.mozilla.org/show_bug.cgi?id=1816059)
* [Bug 1816007](https://bugzilla.mozilla.org/show_bug.cgi?id=1816007)
* [Bug 1821155](https://bugzilla.mozilla.org/show_bug.cgi?id=1821155)
* [Bug 1821576](https://bugzilla.mozilla.org/show_bug.cgi?id=1821576)
* [Bug 1821906](https://bugzilla.mozilla.org/show_bug.cgi?id=1821906)
* [Bug 1822298](https://bugzilla.mozilla.org/show_bug.cgi?id=1822298)
* [Bug 1822305](https://bugzilla.mozilla.org/show_bug.cgi?id=1822305)

#### [#CVE-2023-1999: Double-free in libwebp](#CVE-2023-1999)

Reporter
Irvan Kurniawan
Impact
high
##### Description

A double-free in libwebp could have led to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1819244](https://bugzilla.mozilla.org/show_bug.cgi?id=1819244)

#### [#CVE-2023-29535: Potential Memory Corruption following Garbage Collector compaction](#CVE-2023-29535)

Reporter
Lukas Bernhard
Impact
high
##### Description

Following a Garbage Collector compaction, weak maps may have been accessed before they were correctly traced. This resulted in memory corruption and a potentially exploitable crash.

##### References

* [Bug 1820543](https://bugzilla.mozilla.org/show_bug.cgi?id=1820543)

#### [#CVE-2023-29536: Invalid free from JavaScript code](#CVE-2023-29536)

Reporter
zx from qriousec
Impact
high
##### Description

An attacker could cause the memory manager to incorrectly free a pointer that addresses attacker-controlled memory, resulting in an assertion, memory corruption, or a potentially exploitable crash.

##### References

* [Bug 1821959](https://bugzilla.mozilla.org/show_bug.cgi?id=1821959)

#### [#CVE-2023-29537: Data Races in font initialization code](#CVE-2023-29537)

Reporter
Looben Yang
Impact
high
##### Description

Multiple race conditions in the font initialization could have led to memory corruption and execution of attacker-controlled code.

##### References

* [Bug 1823365](https://bugzilla.mozilla.org/show_bug.cgi?id=1823365)
* [Bug 1824200](https://bugzilla.mozilla.org/show_bug.cgi?id=1824200)
* [Bug 1825569](https://bugzilla.mozilla.org/show_bug.cgi?id=1825569)

#### [#CVE-2023-29538: Directory information could have been leaked to WebExtensions](#CVE-2023-29538)

Reporter
Alexis aka zoracon
Impact
moderate
##### Description

Under specific circumstances a WebExtension may have received a `jar:file:///` URI instead of a `moz-extension:///` URI during a load request. This leaked directory paths on the user's machine.

##### References

* [Bug 1685403](https://bugzilla.mozilla.org/show_bug.cgi?id=1685403)

#### [#CVE-2023-29539: Content-Disposition filename truncation leads to Reflected File Download](#CVE-2023-29539)

Reporter
Trung Pham
Impact
moderate
##### Description

When handling the filename directive in the Content-Disposition header, the filename would be truncated if the filename contained a NULL character. This could have led to reflected file download attacks potentially tricking users to install malware.

##### References

* [Bug 1784348](https://bugzilla.mozilla.org/show_bug.cgi?id=1784348)

#### [#CVE-2023-29540: Iframe sandbox bypass using redirects and sourceMappingUrls](#CVE-2023-29540)

Reporter
Axel Chong (@Haxatron)
Impact
moderate
##### Description

Using a redirect embedded into `sourceMappingUrls` could allow for navigation to external protocol links in sandboxed iframes without `allow-top-navigation-to-custom-protocols`.

##### References

* [Bug 1790542](https://bugzilla.mozilla.org/show_bug.cgi?id=1790542)

#### [#CVE-2023-29541: Files with malicious extensions could have been downloaded unsafely on Linux](#CVE-2023-29541)

Reporter
Ameen Basha M K
Impact
moderate
##### Description

Firefox did not properly handle downloads of files ending in `.desktop`, which can be interpreted to run attacker-controlled commands.
*This bug only affects Firefox for Linux on certain Distributions. Other operating systems are unaffected, and Mozilla is unable to enumerate all affected Linux Distributions.*

##### References

* [Bug 1810191](https://bugzilla.mozilla.org/show_bug.cgi?id=1810191)

#### [#CVE-2023-29542: Bypass of file download extension restrictions](#CVE-2023-29542)

Reporter
Shaheen Fazim and Ameen Basha M K
Impact
moderate
##### Description

A newline in a filename could have been used to bypass the file extension security mechanisms that replace malicious file extensions such as .lnk with .download. This could have led to accidental execution of malicious code.
*This bug only affects Firefox on Windows. Other versions of Firefox are unaffected.*

##### References

* [Bug 1815062](https://bugzilla.mozilla.org/show_bug.cgi?id=1815062)
* [Bug 1810793](https://bugzilla.mozilla.org/show_bug.cgi?id=1810793)

#### [#CVE-2023-29543: Use-after-free in debugging APIs](#CVE-2023-29543)

Reporter
Lukas Bernhard
Impact
moderate
##### Description

An attacker could have caused memory corruption and a potentially exploitable use-after-free of a pointer in a global object's debugger vector.

##### References

* [Bug 1816158](https://bugzilla.mozilla.org/show_bug.cgi?id=1816158)

#### [#CVE-2023-29544: Memory Corruption in garbage collector](#CVE-2023-29544)

Reporter
Lukas Bernhard
Impact
moderate
##### Description

If multiple instances of resource exhaustion occurred at the incorrect time, the garbage collector could have caused memory corruption and a potentially exploitable crash.

##### References

* [Bug 1818781](https://bugzilla.mozilla.org/show_bug.cgi?id=1818781)

#### [#CVE-2023-29545: Windows Save As dialog resolved environment variables](#CVE-2023-29545)

Reporter
Axel Chong (@Haxatron)
Impact
moderate
##### Description

Similar to CVE-2023-28163, this time when choosing 'Save Link As', suggested filenames containing environment variable names would have resolved those in the context of the current user.
*This bug only affects Firefox on Windows. Other versions of Firefox are unaffected.*

##### References

* [Bug 1823077](https://bugzilla.mozilla.org/show_bug.cgi?id=1823077)

#### [#CVE-2023-29546: Screen recording in Private Browsing included address bar on Android](#CVE-2023-29546)

Reporter
Irwan
Impact
low
##### Description

When recording the screen while in Private Browsing on Firefox for Android the address bar and keyboard were not hidden, potentially leaking sensitive information.
*This bug only affects Firefox for Android. Other operating systems are unaffected.*

##### References

* [Bug 1780842](https://bugzilla.mozilla.org/show_bug.cgi?id=1780842)

#### [#CVE-2023-29547: Secure document cookie could be spoofed with insecure cookie](#CVE-2023-29547)

Reporter
Marco Squarcina
Impact
low
##### Description

When a secure cookie existed in the Firefox cookie jar an insecure cookie for the same domain could have been created, when it should have silently failed. This could have led to a desynchronization in expected results when reading from the secure cookie.

##### References

* [Bug 1783536](https://bugzilla.mozilla.org/show_bug.cgi?id=1783536)

#### [#CVE-2023-29548: Incorrect optimization result on ARM64](#CVE-2023-29548)

Reporter
JunYoung Park
Impact
low
##### Description

A wrong lowering instruction in the ARM64 Ion compiler resulted in a wrong optimization result.

##### References

* [Bug 1822754](https://bugzilla.mozilla.org/show_bug.cgi?id=1822754)

#### [#CVE-2023-29549: Javascript's bind function may have failed](#CVE-2023-29549)

Reporter
Lukas Bernhard
Impact
low
##### Description

Under certain circumstances, a call to the `bind` function may have resulted in the incorrect realm. This may have created a vulnerability relating to JavaScript-implemented sandboxes such as SES.

##### References

* [Bug 1823042](https://bugzilla.mozilla.org/show_bug.cgi?id=1823042)

#### [#CVE-2023-29550: Memory safety bugs fixed in Firefox 112 and Firefox ESR 102.10](#CVE-2023-29550)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Randell Jesup, Andrew Osmond, Sebastian Hengst, Andrew McCreight, and the Mozilla Fuzzing Team reported memory safety bugs present in Firefox 111 and Firefox ESR 102.9. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 112 and Firefox ESR 102.10](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1720594%2C1812498%2C1814217%2C1818357%2C1751945%2C1818762%2C1819493%2C1820389%2C1820602%2C1821448%2C1822413%2C1824828)

#### [#CVE-2023-29551: Memory safety bugs fixed in Firefox 112](#CVE-2023-29551)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Randell Jesup, Andrew McCreight, Gabriele Svelto, and the Mozilla Fuzzing Team reported memory safety bugs present in Firefox 111. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 112](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1763625%2C1814314%2C1815798%2C1815890%2C1819239%2C1819465%2C1819486%2C1819492%2C1819957%2C1820514%2C1820776%2C1821838%2C1822175%2C1823547)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_cc30be86_20250114_225610.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1783536)
* [XML](/show_bug.cgi?ctype=xml&id=1783536)

Closed
[Bug 1783536](/show_bug.cgi?id=1783536)
(CVE-2023-29547)

Opened 2 years ago
Closed 2 years ago

# document.cookie in an insecure origin process allows setting an insecure cookie in that process that has the same name as a secure one

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

document.cookie in an insecure origin process allows setting an insecure cookie in that process that has the same name as a secure one

## Categories

### (Core :: Networking: Cookies, defect, P2)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Networking%3A%20Cookies#Networking%3A%20Cookies)

Networking: Cookies
▾

Core :: Networking: Cookies
A general mechanism which server side connections (such as CGI scripts) can use to both store and retrieve information on the client side of the connection. This refers to HTML cookies; little blobs of data we store and share with sites
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Networking%3A%20Cookies&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Networking%3A%20Cookies&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Networking%3A%20Cookies)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Firefox 103

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P2

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S3

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

112 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| a11y-review | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr102 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=wontfix) |
| firefox110 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox110&o1=equals&v1=wontfix) |
| firefox111 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox111&o1=equals&v1=wontfix) |
| firefox112 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox112&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr102 |  | wontfix |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox110 |  | wontfix |
| firefox111 |  | wontfix |
| firefox112 |  | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: squarcina, Assigned: edgul)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/380d527ca6afdc48f587c6e5b8c56143?d=mm&size=40)  [edgul](/user_profile?user_id=701256)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/0874906c730af609518679d8fe58591e?d=mm&size=40)  [squarcina](/user_profile?user_id=566097)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=40)  [jesup](/user_profile?user_id=11539)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

9 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: sec-low, Whiteboard: [necko-triaged][necko-priority-queue][post-critsmash-triage][adv-main112+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2023-29547

[Keywords:](/describekeywords.cgi)

[sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[necko-triaged][necko-priority-queue][post-critsmash-triage][adv-main112+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [RyanVM](/user_profile?user_id=75935) | [in-testsuite](#a17194366_75935 "2 years ago") | + |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | in-testsuite | + |
| --- | --- | --- |
| [btot](/user_profile?user_id=553429) | [qe-verify](#a18286219_553429 "2 years ago") | - |
| --- | --- | --- |
| [btot](/user_profile?user_id=553429) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [ffdesyncsecure.js](/attachment.cgi?id=9288717)  [2 years ago](#c0)  [Marco Squarcina](/user_profile?user_id=566097)   2.02 KB, text/javascript |  | [Details](/attachment.cgi?id=9288717&action=edit) |
| --- | --- | --- |
| [Bug 1783536 - Prevent document.cookie de-sync from cookie jar when setting secure cookies. r=dveditz,#necko-reviewers](/attachment.cgi?id=9295018)  [2 years ago](#c5)  [edgul](/user_profile?user_id=701256)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9295018&action=edit) | [Review](/attachment.cgi?id=9295018) |
| [advisory.txt](/attachment.cgi?id=9327467)  [2 years ago](#c29)  [June Wilde (she/her) [:jewilde]](/user_profile?user_id=626341)   329 bytes, text/plain |  | [Details](/attachment.cgi?id=9327467&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Marco Squarcina](/user_profile?user_id=566097)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1783536#c0)• 2 years ago |
|  | |

Attached file
[ffdesyncsecure.js](attachment.cgi?id=9288717)
— [Details](attachment.cgi?id=9288717&action=edit)

Steps to reproduce:

I am reporting a desynchronization issue between document.cookie and the actual content of the cookie jar in Firefox. This report follows <https://bugzilla.mozilla.org/show_bug.cgi?id=1782561>, but I think these are two separate issues. Similarly to the previous report, this inconsistency could introduce vulnerabilities in applications trusting the cookies read from document.cookie. In particular, this issue may allow same-site and network attackers to spoof the value of a cookie previously set as Secure.

1. Visit <https://example.com>
2. Set a secure cookie using the console, e.g., document.cookie = "test=secure; Secure"
3. In the same tab, visit <http://example.com>
4. Set an insecure cookie `test` to the value `insecure`: document.cookie = "test=insecure"
5. Force a refresh to <http://example.com>

A demo is available at <https://ffdesyncsecure.minimal.blue/>. Nodejs sources are attached to this report.

Actual results:

Step 4. sets the cookie `test=insecure` in document.cookie, altough a Secure cookie with the same name (`test`) already exists. Notice that the cookie `test=insecure` is not saved in the cookie jar by inspecting devtools Storage -> Cookies.

Step 5. as expected, the `test` cookie is not attached in the request to <http://example.com>. At the same time, document.cookie still shows `test=insecure`.

The current behavior causes a desynchronization between document.cookie and the actual cookie jar of the browser.

Expected results:

The document.cookie setter at step 4. should silently fail to set the cookie `test=insecure` due to the presence of a Secure cookie with the same name. Chromium-based browsers behave as expected, i.e., the cookie `test=insecure` does not populate document.cookie.

|  | [Marco Squarcina](/user_profile?user_id=566097)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1783536#c1)• 2 years ago |
|  | |

For the record, non-secure cookies in this case should be discarded according to point 16 of the [Cookies Storage Model (Sec. 5.5)](https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis-10#section-5.5).

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783536#a80014_406194)• 2 years ago |

Group: firefox-core-security → network-core-securityComponent: Untriaged → Networking: CookiesProduct: Firefox → Core

|  | [Dragana Damjanovic [:dragana]](/user_profile?user_id=508195) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1783536#c2)• 2 years ago |
|  | |

Can you take a look?

Flags: needinfo?(dveditz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783536#a2163161_1689)• 2 years ago |

Status: UNCONFIRMED → NEWEver confirmed: trueFlags: needinfo?(dveditz)Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1783536#c3)• 2 years ago |
|  | |

The severity field is not set for this bug.

:valentin, could you have a look please?

For more information, please visit [auto\_nag documentation](https://wiki.mozilla.org/Release_Management/autonag#workflow.2Fno_severity.py).

Flags: needinfo?(valentin.gosu)

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783536#a2369236_415378)• 2 years ago |

Severity: -- → S3Flags: needinfo?(valentin.gosu)Priority: -- → P1Whiteboard: [necko-triaged][necko-priority-queue]

|  | [edgul](/user_profile?user_id=701256)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783536#a2823919_701256)• 2 years ago |

Assignee: nobody → edgul

|  | [edgul](/user_profile?user_id=701256)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1783536#c4)• 2 years ago |
|  | |

Replicated in Nightly 106.0a1 (2022-09-08).

Starting investigation.

|  | [edgul](/user_profile?user_id=701256)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1783536#c5)• 2 years ago |
|  | |

Attached file
[Bug 1783536 - Prevent document.cookie de-sync from cookie jar when setting secure cookies. r=dveditz,#necko-reviewers](attachment.cgi?id=9295018)
— [Details](attachment.cgi?id=9295018&action=edit)

|  | [edgul](/user_profile?user_id=701256)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1783536#c6)• 2 years ago |
|  | |

Status: Writing missing test with mochi-browser test

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783536#a6476433_600971)• 2 years ago |

[Attachment #9295018](/attachment.cgi?id=9295018&action=edit "Bug 1783536 - Prevent document.cookie de-sync from cookie jar when setting secure cookies. r=dveditz,#necko-reviewers") -
Attachment description: WIP: Bug 1783536 - Added xpcshell tests to analyse cookie setting behaviour from http and API → WIP: Bug 1783536 - Added xpcshell and mochi-browser tests to analyse cookie setting behaviour from http and API

|  | [edgul](/user_profile?user_id=701256)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1783536#c7)• 2 years ago |
|  | |

Should have enough tests to proceed now. I have started investigation.

|  | [edgul](/user_profile?user_id=701256)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1783536#c8)• 2 years ago |
|  | |

Continuing with investigation next week.

|  | [edgul](/user_profile?user_id=701256)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1783536#c9)• 2 years ago |
|  | |

Temporarily backburnered for other P1's

|  | [edgul](/user_profile?user_id=701256)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1783536#c10)• 2 years ago |
|  | |

Resuming investigation.

|  | [edgul](/user_profile?user_id=701256)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1783536#c11)• 2 years ago |
|  | |

In progress: Trying to debug with RR on child process with mochi browser test that exhibits behavior.

|  | [edgul](/user_profile?user_id=701256)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1783536#c12)• 2 years ago |
|  | |

Dan, I'm wanting to confirm two things here:

1. That the scheme is not relevant (at least temporarily) to `document.cookie` in the above steps to reproduce as per [this comment](https://bugzilla.mozilla.org/show_bug.cgi?id=1748693#c13) . This appears to have been done for webcompat reasons but seems to contradict [this bug](https://bugzilla.mozilla.org/show_bug.cgi?id=1756213) which suggests that `document.cookie` should be schemeful and the most spec compliant with [schemeful same site](https://github.com/sbingler/schemeful-same-site) and [incrementally better cookies](https://datatracker.ietf.org/doc/html/draft-west-cookie-incrementalism-01). Is the former, schemeless, implementation of `document.cookie` still valid after the schemeful cookie rework that went into re-enabling `network.cookie.sameSite.schemeful` pref?
2. Also, I was a bit surprised to find that the when attempting to overwrite a secure cookie with an insecure one via https, that the overwrite was successful all the way to the cookie jar. Is this expected?
Flags: needinfo?(dveditz)

|  | [edgul](/user_profile?user_id=701256)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1783536#c13)• 2 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1783536&comment_id=16225198 "1 revision") |
|  | |

In reading the storage model spec a little more closely, it looks like my above question #2 is expected.

<https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis-10#section-5.5>

```
If the cookie's secure-only-flag is false, and the scheme component of request-uri does not denote a "secure" protocol,
then abort these steps and ignore the cookie entirely if the cookie store contains one or more cookies that meet all of
the following criteria:
* Their name matches the name of the newly-created cookie.
* Their secure-only-flag is true.
* ...

```

|  | [edgul](/user_profile?user_id=701256)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1783536#c14)• 2 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1783536&comment_id=16225241 "1 revision") |
|  | |

Please let me know if there is some alternative solution that I am missing here. Even with option B it seems like the solution to the below problem is less secure than the affliction. ~~Which further begs the question: Can we even adequately address this bug without [this](https://bugzilla.mozilla.org/show_bug.cgi?id=1788109)?~~

The Problem:

From what I can tell we [aren't sending secure cookies](https://searchfox.org/mozilla-central/source/netwerk/cookie/CookieService.cpp#1048-1051) to non-secure origin processes. So in the case where Tab 1 has <https://example.com> secure cookie and we attempt an overwrite on the same cookie name with an insecure cookie on Tab2 for <http://example.com>, we have a limitation with the current plumbing in that we can't know which secure cookies are in the jar.

Two options readily come to mind:

A. Send all cookies for the relevant base domain + OA (including the secure ones) from the cookie jar in the parent process to the matching child. But this seems like a step backwards in terms of security and cookie isolation, especially if we continue to move towards more schemeful separations.

B. Some kind of additional signalling from parent to relevant content processes that we are holding cookies of these name-host-path, without telling the content process what the values are.

Additionally:

Assuming we get this working. I'm concerned about the edge case behavior if we:

1. Tab 1: set insecure cookie "test=yes" on <http://example.com>
2. Tab 2: set secure cookie "test=overwrite; Secure" on <https://example.com>.

   Step 2 overwrite shouldn't be able to make it to Tab 1's process. I'm guessing we should clear the cookie in Tab 1 process so that we don't create another de-synchronization.

|  | [Marco Squarcina](/user_profile?user_id=566097)  Reporter |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1783536#c15)• 2 years ago |
|  | |

Hi, it's difficult for me to weigh in on option A or B without access to the [bug mentioned above](https://bugzilla.mozilla.org/show_bug.cgi?id=1788109) and due to missing background on Firefox implementation details.

That said, the example cited in the previous message is the dual of the problem I reported. I confirm that it creates an inconsistency since `document.cookie` returns different entries from the content of the cookie jar. Indeed, the insecure cookie `test=yes` should be cleared from `document.cookie` after setting the secure cookie in Tab 2.

Best,

Marco

|  | [edgul](/user_profile?user_id=701256)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1783536#c16)• 2 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1783536&comment_id=16234867 "2 revisions") |
|  | |

Thanks for clarifying Marco.

Not sure if clarification is needed here, but essentially the child process that will be responsible for blocking the cookie-set will need to somehow know the cookie exists (but for a privileged origin) in the jar. But the security concern with Option A is that if the child process is ever compromised, then that process will have easier access to potentially other origin and other process cookies.

Also,

> Which further begs the question: Can we even adequately address this bug without this?

My comment above is a bit confused, I will modify it. But [the bug in question](https://bugzilla.mozilla.org/show_bug.cgi?id=1788109) is still relevant. If it is fixed, then Option A or B for this bug seem like something we definitely should NOT do, but by then another alternative may become available.

Hoping security team can shed some light here.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1783536#c17)• 2 years ago |
|  | |

[Bugzilla usability request: instead of making markdown links to bugs ("this bug", "this comment", "bug mentioned above") please use plain text mentions and let Bugzilla auto-linkify them ("[bug 1756213](/show_bug.cgi?id=1756213 "NEW - document.cookie skips \"schemeful\" samesite checks in nested documents")", "[bug 1748693 comment 13](/show_bug.cgi?id=1748693#c13 "VERIFIED FIXED - Cookie without Secure attribute not sent over HTTP when set from HTTPS page")"). Auto links will reveal the status and bug title in the hover text which can be a time-saver compared to having to open all the links to figure out what they are. If you don't have access to a bug you lose out on the title, but at least you still get a little info about the status.]

> the most spec compliant with [schemeful same site](https://github.com/sbingler/schemeful-same-site) and [incrementally better cookies](https://datatracker.ietf.org/doc/html/draft-west-cookie-incrementalism-01).

Those proposals are obsolete—please do not use them as references. They are probably very similar to what's in the [latest rfc6265bis drafts](https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis/), but there could be subtle changes that end up making a big difference somewhere.

I'm lowering the security severity of this bug, and maybe it's enough of an edge-case it doesn't need to be hidden. This bug doesn't allow the (global) setting of an insecure cookie. The global cookie jar continues to reflect the correct behavior. This bug only affects what is visible to document.cookie in that one child process. To reduce the harm of spectre-style attacks, the fission project has led to each child process having only a subset of cookies relevant to the origin rather than direct access to all cookies. When you've got multiple copies of the same data they are inevitably at risk of being out of sync.

At some point any cookies created using `document.cookie` have to be communicated up to the real cookie jar in the parent, and at that point adding the cookie fails. Why isn't the child process told about this failure so it can clean up `document.cookie`?

To your original questions in [comment 12](/show_bug.cgi?id=1783536#c12 "RESOLVED FIXED - document.cookie in an insecure origin process allows setting an insecure cookie in that process that has the same name as a secure one"):

* as you found, point 2 is fine: a site that can set a secure cookie is allowed to delete it, or replace it with a non-secure cookie
* in question 1 you're confusing two different uses of scheme--as indeed did the implementation that had to be fixed in [bug 1748693](/show_bug.cgi?id=1748693 "VERIFIED FIXED - Cookie without Secure attribute not sent over HTTP when set from HTTPS page"). The "schemeful" in "schemeful samesite" refers to the schemes of the originating browser context and the destination of a request. The cookies themselves have no scheme.

Your analysis in [comment 14](/show_bug.cgi?id=1783536#c14 "RESOLVED FIXED - document.cookie in an insecure origin process allows setting an insecure cookie in that process that has the same name as a secure one") seems spot on.

Option A would be the easiest, at the cost of reintroducing Spectre worries for secure cookies. That seems worse than this bug since the secure site is trying to do the right thing, and this bug only lets an insecure site confuse itself.

Option B is essentially what CookieServiceParent.cpp does with httponly cookies: [bug 1440462](/show_bug.cgi?id=1440462 "RESOLVED FIXED - e10s: stop sending httponly cookies to child processes") changed things to blank out the value but continue sending the name and other metadata so the child process could know not to override those from document.cookie. You could do something like that, but as you pointed out in [comment 14](/show_bug.cgi?id=1783536#c14 "RESOLVED FIXED - document.cookie in an insecure origin process allows setting an insecure cookie in that process that has the same name as a secure one") the `CookieService::GetCookiesForURI()` has already stripped those out. Maybe you could add yet another argument to that routine that lets it know we want a slightly expanded set of cookies than the ones we want to send along with a network request, and then the list gets re-filtered by `CookieServiceChild::GetCookieStringFromDocument()`

Option C might be that when the cookies set in the child process are shipped to the parent, return an error code so the child process can delete the cookie it just added via document.cookie. It'd be tricky though, because we send these as a batch and there's currently no way to signal a specific failed cookie. Maybe we could generate a "cookie was deleted" update message back to the child for each attempt to shadow a secure cookie?

Or even Option D: live with this bug. As long as the cookie isn't set in the real cookie store and isn't sent with network requests it's mostly self-inflicted confusion for the affected site. Of course it could also be set by a MITM of the insecure site, or a malicious sibling domain (in the same session, since the cookie will go away when the process does). so it would be nice to fix.

> But [[bug 1788109](/show_bug.cgi?id=1788109 "NEW")] is still relevant. If it is fixed, then Option A or B for this bug seem like something we definitely should NOT do, but by then another alternative may become available.

I don't think [bug 1788109](/show_bug.cgi?id=1788109 "NEW") is relevant. We currently try to limit what cookies are sent to child processes to prevent spectre-like attacks, which don't require compromising the child process. The problem [bug 1788109](/show_bug.cgi?id=1788109 "NEW") foresees assumes an already-compromised child process. Your options represent the same level of leak either way.

I do agree that Option A is something we should not do: it's a worse risk than the problem described in this bug.

If we could make secure cookies work similarly to httponly cookies then Option B would be reasonable.

Flags: needinfo?(dveditz)Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---) → [sec-low](/buglist.cgi?keywords=sec-low&resolution=---)Summary: document.cookie allows setting an insecure cookie in presence of a secure one with the same name → document.cookie in an insecure origin process allows setting an insecure cookie in that process that has the same name as a secure one

|  | [Greg Hess](/user_profile?user_id=694371) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783536#a14057273_694371)• 2 years ago |

Priority: P1 → P2

|  | [edgul](/user_profile?user_id=701256)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1783536#c18)• 2 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1783536&comment_id=16239930 "1 revision") |
|  | |

I agree that Option B looks like the way to go here.

* The parameter expansion of `GetCookiesForURI` appears necessary since I wouldn't expect the parent-context `CookieService::GetCookieStringFromHttp` to change behavior.
* Checking for secure cookies in an insecure origin will be easy within `GetCookiesForURI`.
* Filtering in `SetCookieStringFromDocument` will be similar.
* Wiping cookie values before broadcast to content processes will align with http-only cookies, namely in functions: `RemoveCookie()`, `AddCookie()`, `RemoveBatchDeletedCookies()` and `SerializeCookieList()`
* Looks like filtering should already work in the `GetCookieStringFromDocument()` for [CookieServiceChild](https://searchfox.org/mozilla-central/rev/5bcbe6ae54ee5b152f6cef29dc5627ec7c0e1f1e/netwerk/cookie/CookieServiceChild.cpp#325-327) and [CookieService](https://searchfox.org/mozilla-central/rev/5bcbe6ae54ee5b152f6cef29dc5627ec7c0e1f1e/netwerk/cookie/CookieService.cpp#438-441) so that's nice.

Further, since we can probably trust a server to not intentionally try to overwrite it's own cookies I would expect the behavior of the following functions to remain the same:

`CookieService::SetCookieStringFromHttp` -> only used to put cookie into jar from response header in parent context

`CookieServiceChild::GetCookieStringFromHttp` -> not implemented

`CookieServiceChild::SetCookieStringFromHttp` -> only used to add cookie from response header to child and notify parent to store cookie in jar

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783536#a14697324_600971)• 2 years ago |

[Attachment #9295018](/attachment.cgi?id=9295018&action=edit "Bug 1783536 - Prevent document.cookie de-sync from cookie jar when setting secure cookies. r=dveditz,#necko-reviewers") -
Attachment description: WIP: Bug 1783536 - Added xpcshell and mochi-browser tests to analyse cookie setting behaviour from http and API → Bug 1783536 - Prevent document.cookie de-sync from cookie jar when setting secure cookies. r=dveditz,#necko-reviewers

|  | [edgul](/user_profile?user_id=701256)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1783536#c19)• 2 years ago |
|  | |

Made some minor adjustments to [attachment 9295018](/attachment.cgi?id=9295018 "Bug 1783536 - Prevent document.cookie de-sync from cookie jar when setting secure cookies. r=dveditz,#necko-reviewers") [[details]](/attachment.cgi?id=9295018&action=edit "Bug 1783536 - Prevent document.cookie de-sync from cookie jar when setting secure cookies. r=dveditz,#necko-reviewers"). Dan, can you have a look?

Treeherder: <https://treeherder.mozilla.org/jobs?repo=try&revision=38aba67f90777dd8912907b6e37f27162db723be>

Flags: needinfo?(dveditz)

|  | [edgul](/user_profile?user_id=701256)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1783536#c20)• 2 years ago |
|  | |

Comment on [attachment 9295018](/attachment.cgi?id=9295018 "Bug 1783536 - Prevent document.cookie de-sync from cookie jar when setting secure cookies. r=dveditz,#necko-reviewers") [[details]](/attachment.cgi?id=9295018&action=edit "Bug 1783536 - Prevent document.cookie de-sync from cookie jar when setting secure cookies. r=dveditz,#necko-reviewers")

[Bug 1783536](/show_bug.cgi?id=1783536 "RESOLVED FIXED - document.cookie in an insecure origin process allows setting an insecure cookie in that process that has the same name as a secure one") - Prevent document.cookie de-sync from cookie jar when setting secure cookies. r=dveditz,#necko-reviewers

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: Not very easily
* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: No
* **Which older supported branches are affected by this flaw?**:
* **If not all supported branches, which bug introduced the flaw?**: None
* **Do you have backports for the affected branches?**: No
* **If not, how different, hard to create, and risky will they be?**: Should port pretty easily
* **How likely is this patch to cause regressions; how much testing does it need?**: Low likelihood. Testing has already been added.
* **Is Android affected?**: Unknown
[Attachment #9295018](/attachment.cgi?id=9295018&action=edit "Bug 1783536 - Prevent document.cookie de-sync from cookie jar when setting secure cookies. r=dveditz,#necko-reviewers") -
Flags: sec-approval?

|  | [edgul](/user_profile?user_id=701256)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783536#a16852176_701256)• 2 years ago |

[Attachment #9295018](/attachment.cgi?id=9295018&action=edit "Bug 1783536 - Prevent document.cookie de-sync from cookie jar when setting secure cookies. r=dveditz,#necko-reviewers") -
Flags: sec-approval?

|  | [edgul](/user_profile?user_id=701256)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1783536#c21)• 2 years ago |
|  | |

Does not need sec-approval as it is sec-low.

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1783536#c22)• 2 years ago |
|  | |

Prevent document.cookie de-sync from cookie jar when setting secure cookies. r=dveditz,necko-reviewers

<https://hg.mozilla.org/integration/autoland/rev/ba89445b47f17de3b38fac4c88bce3be79ca36e0>

<https://hg.mozilla.org/mozilla-central/rev/ba89445b47f1>

Group: network-core-security → core-security-releaseStatus: NEW → RESOLVEDClosed: 2 years ago
[status-firefox112](/buglist.cgi?f1=cf_status_firefox112&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox112&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 112 Branch

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783536#a17194366_75935)• 2 years ago |

[status-firefox110](/buglist.cgi?f1=cf_status_firefox110&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox110&o1=equals&v1=wontfix)
[status-firefox111](/buglist.cgi?f1=cf_status_firefox111&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox111&o1=equals&v1=affected)
[status-firefox-esr102](/buglist.cgi?f1=cf_status_firefox_esr102&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=wontfix)Flags: needinfo?(dveditz) → in-testsuite+

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1783536#c23)• 2 years ago |
|  | |

The patch landed in nightly and beta is affected.

:edgul, is this bug important enough to require an uplift?

* If yes, please nominate the patch for beta approval.
* If no, please set `status-firefox111` to `wontfix`.

For more information, please visit [auto\_nag documentation](https://wiki.mozilla.org/Release_Management/autonag#uplift_beta.py).

Flags: needinfo?(edgul)

|  | [edgul](/user_profile?user_id=701256)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1783536#c24)• 2 years ago |
|  | |

Maybe not. Dan what do you think?

Flags: needinfo?(edgul) → needinfo?(dveditz)

|  | [Marco Squarcina](/user_profile?user_id=566097)  Reporter |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1783536#c25)• 2 years ago |
|  | |

I tried to reproduce the issue against Firefox 112.0a1 (2023-02-22) (64-bit) and I confirm that the problem I reported and its dual (<https://bugzilla.mozilla.org/show_bug.cgi?id=1783536#c14>) are gone. However, I noticed an inconsistency in the Storage Inspector:

1. Go to <http://example.com>, execute `document.cookie = 'test=insecure'`
2. New tab, go to <https://example.com>, execute `document.cookie = 'test=secure; Secure'`
3. Go back to the first tab where <http://example.com> is open. Check Storage > Cookies in the inspector
4. I would expect to see nothing, instead the Secure cookie is shown. Refreshing the page, or visiting <http://example.com> in a new tab does not prune the entry from the cookies listed by the Storage Inspector. Still, no cookies are attached to requests and `document.cookie` is empty.

Additionally, I tested the other desync issue caused by a cookie jar overflow, see <https://bugzilla.mozilla.org/show_bug.cgi?id=1782561>. Unfortunately, this desynchronization is not addressed by the patch landed in FF nightly, so the 2 issues seem to be unrelated.

|  | [edgul](/user_profile?user_id=701256)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1783536#c26)• 2 years ago |
|  | |

Thanks for catching this Marco, I'm seeing the same thing.

I'll take a look at how we interface with dev tools on this.

Flags: needinfo?(edgul)

|  | [Marco Squarcina](/user_profile?user_id=566097)  Reporter |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1783536#c27)• 2 years ago |
|  | |

I have just realized that the Storage Inspector shows Secure cookies irrespective of the scheme of the current page. Contrary to what I initially thought, this discrepancy has nothing to do with the desynchronization issue discussed here, sorry.

I always assumed that cookies listed in the Storage Inspector are scoped to the current origin + path, similar to Chrome. I guess I was wrong. Out of curiosity, I tried to access Secure cookies from a non-secure origin using WebDriver with the code below.

```
#!/usr/bin/env python3

import time
from selenium import webdriver

driver = webdriver.Firefox()

driver.get("https://example.com")
driver.execute_script("document.cookie = 'test=secure; Secure; SameSite=Strict'")
time.sleep(1)
print(f'[S] Cookies on https://example.com: {driver.get_cookies()}')

driver.get("http://example.com/")
time.sleep(1)
print(f'[I] Cookies on http://example.com: {driver.get_cookies()}')

driver.close()

```

Again, to my surprise, the Secure cookie is printed twice on Firefox, whereas on Chrome, the Secure cookie is returned only on <https://example.com>.

I explicitly added the SameSite attribute to level any differences between the two browsers. According to [rfc6265bis](https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis-11), <http://example.com> should be considered a different site wrt <https://example.com>. So WebDriver is showing a cookie scoped for a different site here. This looks like a fun CTF challenge, but maybe there are real-world security implications affecting pipelines using WebDriver + FF?

I also had a quick look at the [WebDriver spec](https://www.w3.org/TR/webdriver/#dfn-associated-cookies) and found out that all associated cookies to a document must meet the requirements specified by the algorithm in [rfc6265, Sec 5.4](https://www.rfc-editor.org/rfc/rfc6265#section-5.4) (step 1) . Despite referencing the *old* standard from 2011, the first step mentions that Secure cookies must be discarded on non-secure documents. This is somehow related to <https://github.com/mozilla/geckodriver/issues/1840> and [bug#1690739](/show_bug.cgi?id=1690739 "NEW - \"WebDriver:AddCookie\" should not secure cookies for insecure connections (HTTP)").

If you think this is relevant (personally I do), shall we keep this issue closed, and I'll open a new one?

|  | [edgul](/user_profile?user_id=701256)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1783536#c28)• 2 years ago |
|  | |

Thanks for looking at how Storage Inspector accesses the cookies.

Yeah, I think we can keep this closed and open a new one.

Flags: needinfo?(edgul)

|  | [edgul](/user_profile?user_id=701256)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783536#a17369191_701256)• 2 years ago |

[status-firefox111](/buglist.cgi?f1=cf_status_firefox111&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox111&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox111&o1=equals&v1=wontfix)Flags: needinfo?(dveditz)

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783536#a18286219_553429)• 2 years ago |

Flags: qe-verify-Whiteboard: [necko-triaged][necko-priority-queue] → [necko-triaged][necko-priority-queue][post-critsmash-triage]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783536#a20886958_578488)• 2 years ago |

Whiteboard: [necko-triaged][necko-priority-queue][post-critsmash-triage] → [necko-triaged][necko-priority-queue][post-critsmash-triage][adv-main112+]

|  | [June Wilde (she/her) [:jewilde]](/user_profile?user_id=626341) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1783536#c29)• 2 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9327467)
— [Details](attachment.cgi?id=9327467&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783536#a21077206_578488)• 2 years ago |

Alias: CVE-2023-29547

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1783536#a37780784_1689)• 1 year ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1783536&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Marco Squarcina](/user_profile?user_id=566097)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


