=== Content from github.com_3c2d696c_20250115_090945.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FRustCrypto%2FRSA%2Fsecurity%2Fadvisories%2FGHSA-c38w-74pg-36hr)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FRustCrypto%2FRSA%2Fsecurity%2Fadvisories%2FGHSA-c38w-74pg-36hr)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=RustCrypto%2FRSA)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[RustCrypto](/RustCrypto)
/
**[RSA](/RustCrypto/RSA)**
Public

* [Notifications](/login?return_to=%2FRustCrypto%2FRSA) You must be signed in to change notification settings
* [Fork
  157](/login?return_to=%2FRustCrypto%2FRSA)
* [Star
   571](/login?return_to=%2FRustCrypto%2FRSA)

* [Code](/RustCrypto/RSA)
* [Issues
  20](/RustCrypto/RSA/issues)
* [Pull requests
  3](/RustCrypto/RSA/pulls)
* [Actions](/RustCrypto/RSA/actions)
* [Security](/RustCrypto/RSA/security)
* [Insights](/RustCrypto/RSA/pulse)

Additional navigation options

* [Code](/RustCrypto/RSA)
* [Issues](/RustCrypto/RSA/issues)
* [Pull requests](/RustCrypto/RSA/pulls)
* [Actions](/RustCrypto/RSA/actions)
* [Security](/RustCrypto/RSA/security)
* [Insights](/RustCrypto/RSA/pulse)

# Marvin Attack: potential key recovery through timing sidechannels

Moderate

[tarcieri](/tarcieri)
published
GHSA-c38w-74pg-36hr
Nov 28, 2023

## Package

cargo

rsa
([Rust](/advisories?query=ecosystem%3Arust))

## Affected versions

\*

## Patched versions

None

## Description

### Impact

Due to a non-constant-time implementation, information about the private key is leaked through timing information which is observable over the network. An attacker may be able to use that information to recover the key.

### Patches

No patch is yet available, however work is underway to migrate to a fully constant-time implementation.

### Workarounds

The only currently available workaround is to avoid using the `rsa` crate in settings where attackers are able to observe timing information, e.g. local use on a non-compromised computer is fine.

### References

This vulnerability was discovered as part of the "Marvin Attack", which revealed several implementations of RSA including OpenSSL had not properly mitigated timing sidechannel attacks.

* <https://rustsec.org/advisories/RUSTSEC-2023-0071.html>
* <https://people.redhat.com/~hkario/marvin/>
* [#19](https://github.com/RustCrypto/RSA/issues/19)

### Severity

Moderate

5.9

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
High

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
High

Integrity
None

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:N/A:N

### CVE ID

CVE-2023-49092

### Weaknesses

[CWE-385](/advisories?query=cwe%3A385)

### Credits

* [![@tomato42](https://avatars.githubusercontent.com/u/618246?s=40&v=4)](/tomato42)
  [tomato42](/tomato42)
  Finder

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_04d783fe_20250115_090944.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FRustCrypto%2FRSA%2Fissues%2F19)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FRustCrypto%2FRSA%2Fissues%2F19)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=RustCrypto%2FRSA)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[RustCrypto](/RustCrypto)
/
**[RSA](/RustCrypto/RSA)**
Public

* [Notifications](/login?return_to=%2FRustCrypto%2FRSA) You must be signed in to change notification settings
* [Fork
  157](/login?return_to=%2FRustCrypto%2FRSA)
* [Star
   571](/login?return_to=%2FRustCrypto%2FRSA)

* [Code](/RustCrypto/RSA)
* [Issues
  20](/RustCrypto/RSA/issues)
* [Pull requests
  3](/RustCrypto/RSA/pulls)
* [Actions](/RustCrypto/RSA/actions)
* [Security](/RustCrypto/RSA/security)
* [Insights](/RustCrypto/RSA/pulse)

Additional navigation options

* [Code](/RustCrypto/RSA)
* [Issues](/RustCrypto/RSA/issues)
* [Pull requests](/RustCrypto/RSA/pulls)
* [Actions](/RustCrypto/RSA/actions)
* [Security](/RustCrypto/RSA/security)
* [Insights](/RustCrypto/RSA/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FRustCrypto%2FRSA%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FRustCrypto%2FRSA%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# modpow implementation is not constant-time #19

Open

[phayes](/phayes) opened this issue
Apr 30, 2019
¬∑ 59 comments

Open

# [modpow implementation is not constant-time](#top) #19

[phayes](/phayes) opened this issue
Apr 30, 2019
¬∑ 59 comments

Labels
[security](/RustCrypto/RSA/labels/security)

## Comments

[![@phayes](https://avatars.githubusercontent.com/u/207037?s=80&u=ef6940cbcc2a17c17b66a45728c774c21af9aa2a&v=4)](/phayes)

Copy link

Contributor

### **[phayes](/phayes)** commented [Apr 30, 2019](#issue-438948363) ‚Ä¢ edited Loading

| Hi there,  I'm the author of sidefuzz (<https://github.com/phayes/sidefuzz>) and I have found what appears to be variable-time behavior in the `rsa::internals::encrypt()` function. Specifically, `rsa::internals::encrypt()` appears to be variable-time in relation to the message. Note that I haven't worked this up into an actual exploit, but merely demonstrated that this function isn't constant-time in relation to the message inputed.  Specifically, the message `20d90c8af42aac9b1ee53dc9a0187201` takes 549894 instructions to encrypt, while the message `5a28cec68d47f6fe3b1df54c9f320f6d` takes 552427 instruction to encrypt. This is a difference of 2533 instructions, or about 0.5%. So it's a slight difference, but probably exploitable with sufficient sampling.  I have crated a fuzzing targets here: <https://github.com/phayes/sidefuzz-targets>  You can confirm this difference with the [sidefuzz](https://github.com/phayes/sidefuzz) tool like so:  ``` sidefuzz check ./target/wasm32-unknown-unknown/release/rsa_encrypt_message.wasm 5a28cec68d47f6fe3b1df54c9f320f6d 20d90c8af42aac9b1ee53dc9a0187201 samples: 20000, t-value: 219771.0790572351, confidence: 100% Found timing difference of 2533 instructions between these two inputs with 100% confidence: input 1: 5a28cec68d47f6fe3b1df54c9f320f6d (552427 instructions) input 2: 20d90c8af42aac9b1ee53dc9a0187201 (549894 instructions)  ```  My first suspicion was that this was due to `num_bigint_dig::BigUint::from_bytes_be()` being variable-time, but fuzzing that function specifically results in what appears to be constant-time behavior. So I'm not actually sure where the problem is. |
| --- |
| The text was updated successfully, but these errors were encountered: |

 üëç
4
 exFalso, DianaNites, AMS21, and 0elek reacted with thumbs up emoji

All reactions

* üëç
  4 reactions

[![@newpavlov](https://avatars.githubusercontent.com/u/329626?s=80&v=4)](/newpavlov)

Copy link

Member

### **[newpavlov](/newpavlov)** commented [Apr 30, 2019](#issuecomment-488095128)

| IIRC RSA blinding (which I believe is used in this implementation) uses random number, so while execution time is still variable, it does not correlate with a protected secret. |
| --- |

All reactions

Sorry, something went wrong.

[![@phayes](https://avatars.githubusercontent.com/u/207037?s=80&u=ef6940cbcc2a17c17b66a45728c774c21af9aa2a&v=4)](/phayes)

Copy link

Contributor

Author

### **[phayes](/phayes)** commented [Apr 30, 2019](#issuecomment-488112355) ‚Ä¢ edited Loading

| Hi [@newpavlov](https://github.com/newpavlov) ,  I don't think that's the case here. The [fuzzing target](https://github.com/phayes/sidefuzz-targets/blob/master/rsa_encrypt_message/src/lib.rs) is directly testing this function:  ``` /// Raw RSA encryption of m with the public key. No padding is performed. #[inline] pub fn encrypt<K: PublicKey>(key: &K, m: &BigUint) -> BigUint {     m.modpow(key.e(), key.n())  ```  So the problem is going to be in the implementation of `modpow`.  I've also got [another fuzzing target](https://github.com/phayes/sidefuzz-targets/blob/master/rsa_encrypt_pkcs1v15_message/src/lib.rs) that does full pkcs1v15 padding with a statically seeded CPRNG. It displays the same variable-time behavior (with a statically seeded deterministic PRNG mind-you), but the first fuzzing target was the more minimal case, so that's what I reported. (sidefuzz also accounts for RNGs by repeated sampling and taking a t-value, but this doesn't apply here)  Admittedly, this could also be an artifact of the fuzzer (which would be a bug in the fuzzer), but I don't think that's the case here either. |
| --- |

 üëç
1
 kkom reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![@dignifiedquire](https://avatars.githubusercontent.com/u/790842?s=80&u=b7dd795afade6650e64ed348b5ab04f40eb5e8ce&v=4)](/dignifiedquire)

Copy link

Member

### **[dignifiedquire](/dignifiedquire)** commented [Apr 30, 2019](#issuecomment-488125930) via email

| thank you for the report. I have not hardned the underlying modpow impl for const timing yet, so I am not surprised. I will look into it as soon as I find the time. ‚Ä¶ On 30. Apr 2019, 22:55 +0200, Patrick D Hayes \*\*\*@\*\*\*.\*\*\*>, wrote: Hi [@newpavlov](https://github.com/newpavlov) , I don't think that's the case here. The fuzzing target is directly testing this function: /// Raw RSA encryption of m with the public key. No padding is performed. #[inline] pub fn encrypt<K: PublicKey>(key: &K, m: &BigUint) -> BigUint { m.modpow(key.e(), key.n()) So the problem is going to be in the implementation of modpow, which only takes secret data as input. I've also got another fuzzing target that does full pkcs1v15 padding with a statically seeded CPRNG. It displays the same variable-time behavior (with a statically seeded PRNG mind-you), but the first fuzzing target was the more minimal case, so that's what I reported. ‚Äî You are receiving this because you are subscribed to this thread. Reply to this email directly, view it on GitHub, or mute the thread. |
| --- |

 üëç
6
 phayes, hpk42, aldanor, kkom, r10s, and jakubadamw reacted with thumbs up emoji

All reactions

* üëç
  6 reactions

Sorry, something went wrong.

[![@dignifiedquire](https://avatars.githubusercontent.com/u/790842?s=40&u=b7dd795afade6650e64ed348b5ab04f40eb5e8ce&v=4)](/dignifiedquire)
[dignifiedquire](/dignifiedquire)
added
the
[security](/RustCrypto/RSA/labels/security)
label
[Aug 27, 2019](#event-2586672074)

[![@jedisct1](https://avatars.githubusercontent.com/u/124872?s=80&v=4)](/jedisct1)

Copy link

### **[jedisct1](/jedisct1)** commented [Jun 25, 2020](#issuecomment-649141194) ‚Ä¢ edited Loading

| * <https://github.com/rust-num/num-bigint/blob/7562ab24330792817e42b808f60b0cac51ca261a/src/monty.rs#L69-L73> * <https://github.com/rust-num/num-bigint/blob/7562ab24330792817e42b808f60b0cac51ca261a/src/monty.rs#L121> * <https://github.com/rust-num/num-bigint/blob/7562ab24330792817e42b808f60b0cac51ca261a/src/monty.rs#L207-L219>   may be causing this. |
| --- |

All reactions

Sorry, something went wrong.

[![@tarcieri](https://avatars.githubusercontent.com/u/797?s=40&u=aca2ca512c04d8fb56e791ffd737ceb54be75ad3&v=4)](/tarcieri)
[tarcieri](/tarcieri)
changed the title
~~Potential timing vulnerability~~
modpow implementation is not constant-time
[Apr 25, 2023](#event-9087519042)

[![@tarcieri](https://avatars.githubusercontent.com/u/797?s=80&u=aca2ca512c04d8fb56e791ffd737ceb54be75ad3&v=4)](/tarcieri)

Copy link

Member

### **[tarcieri](/tarcieri)** commented [Apr 25, 2023](#issuecomment-1521098701) ‚Ä¢ edited Loading

| `crypto-bigint` now has a [constant-time modpow implementation in the form of `DynResidue::pow`](https://docs.rs/crypto-bigint/latest/crypto_bigint/modular/runtime_mod/struct.DynResidue.html#method.pow), however it uses Montgomery form internally so it may not be the fastest option for straight modpow since converting in/out of Montgomery form is costly, and it still monomorphizes around a fixed number of limbs.  For the purposes of `rsa` (and `dsa`) we probably need to add a new `Uint` type like `UintVec` which uses a number of limbs chosen at runtime as a proper `num_bigint_dig::BigUint` replacement.  Edit: work on [`crypto_bigint::BoxedUint`](https://github.com/RustCrypto/crypto-bigint/pull/221) has started. |
| --- |

All reactions

Sorry, something went wrong.

[![@alistair23](https://avatars.githubusercontent.com/u/171674?s=40&v=4)](/alistair23)
[alistair23](/alistair23)
mentioned this issue
[May 29, 2023](#ref-pullrequest-1722507479)

[Add an RSA2048 credential checker
tock/tock#3445](/tock/tock/pull/3445)
 Open

2 tasks

[![@tarcieri](https://avatars.githubusercontent.com/u/797?s=40&u=aca2ca512c04d8fb56e791ffd737ceb54be75ad3&v=4)](/tarcieri)
[tarcieri](/tarcieri)
mentioned this issue
[Jun 27, 2023](#ref-issue-1777322229)

[num-bigint-dig dependency
#342](/RustCrypto/RSA/issues/342)

Closed

[![@tarcieri](https://avatars.githubusercontent.com/u/797?s=80&u=aca2ca512c04d8fb56e791ffd737ceb54be75ad3&v=4)](/tarcieri)

Copy link

Member

### **[tarcieri](/tarcieri)** commented [Sep 5, 2023](#issuecomment-1707357573) ‚Ä¢ edited Loading

| ~~Until this is addressed it seems like something we should more prominently highlight in security-related documentation.~~  Edit: opened [#373](https://github.com/RustCrypto/RSA/pull/373) (and merged!) |
| --- |

All reactions

Sorry, something went wrong.

[![@tomato42](https://avatars.githubusercontent.com/u/618246?s=80&v=4)](/tomato42)

Copy link

### **[tomato42](/tomato42)** commented [Nov 22, 2023](#issuecomment-1822995643) ‚Ä¢ edited Loading

| Hi! üëã  I've recently been working on RSA side-channel attacks, and found that many implementations are vulnerable. That's described in the [Marvin Attack](https://people.redhat.com/~hkario/marvin/).  Thanks to help by [@ueno](https://github.com/ueno), who contributed the [test harness](https://github.com/tomato42/marvin-toolkit/pull/4), I was able to run the test against rust-crypto (exact versions of all packages are in the PR).  Unfortunately I have to report that the side-channel leakage from the numerical library is very substantial and easily detectable over the network. As such, I consider RustCrypto RSA to be vulnerable *and* exploitable.  Test results from a run with 100k repeats per probe on an i9-12900KS @ 5.225GHz:  ``` Sign test mean p-value: 0.2189, median p-value: 0.06354, min p-value: 3.946e-60 Friedman test (chisquare approximation) for all samples p-value: 8.827139162990364e-108 Worst pair: 2(no_padding_48), 4(signature_padding_8) Mean of differences: -8.07298e-07s, 95% CI: -9.06918e-07s, -7.019407e-07s (¬±1.025e-07s) Median of differences: -8.44500e-07s, 95% CI: -9.78000e-07s, -7.200000e-07s (¬±1.290e-07s) Trimmed mean (5%) of differences: -7.27307e-07s, 95% CI: -8.13648e-07s, -6.316737e-07s (¬±9.099e-08s) Trimmed mean (25%) of differences: -8.48652e-07s, 95% CI: -9.17708e-07s, -7.769631e-07s (¬±7.037e-08s) Trimmed mean (45%) of differences: -9.56301e-07s, 95% CI: -1.05768e-06s, -8.603802e-07s (¬±9.865e-08s) Trimean of differences: -4.72000e-07s, 95% CI: -5.76750e-07s, -3.635625e-07s (¬±1.066e-07s)  ```  pairwise results are in [report.txt](https://github.com/RustCrypto/RSA/files/13441305/report.txt)  confidence intervals for the measurements are as follows: [conf_interval_plot_trim_mean_25](https://private-user-images.githubusercontent.com/618246/284953344-277bdc46-e0a5-4c8d-85e3-77a251d58dc1.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY5MzI0ODAsIm5iZiI6MTczNjkzMjE4MCwicGF0aCI6Ii82MTgyNDYvMjg0OTUzMzQ0LTI3N2JkYzQ2LWUwYTUtNGM4ZC04NWUzLTc3YTI1MWQ1OGRjMS5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjUwMTE1JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI1MDExNVQwOTA5NDBaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT01NTNjZDM5ZTRjMDFmNWQzYThmYjZlNjA0YWUwY2Y4ZTUwZWQwY2Q3MDlhY2YyOTE5ZDU5OGU2OTI0ZmE2MzQwJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.KFYgg7iSayBVBmG09xr_ETatZ2DdMfDeYuS9UpEqFko)  legend:  ``` ID,Name 0,header_only 1,no_header_with_payload_48 2,no_padding_48 3,no_structure 4,signature_padding_8 5,valid_0 6,valid_48 7,valid_192 8,valid_246 9,valid_repeated_byte_payload_246_1 10,valid_repeated_byte_payload_246_255 11,zero_byte_in_padding_48_4  ```  explanations of that are in the [step2.py](https://github.com/tomato42/marvin-toolkit/blob/master/step2.py) script in marvin-toolkit repo.  In other words, the protection from adding blinding is not sufficient, and Rust Crypto has at least the same issue as the [CVE-2022-4304](https://nvd.nist.gov/vuln/detail/CVE-2022-4304) in OpenSSL. |
| --- |

 üëÄ
1
 rayyildiz reacted with eyes emoji

All reactions

* üëÄ
  1 reaction

Sorry, something went wrong.

[![@tarcieri](https://avatars.githubusercontent.com/u/797?s=80&u=aca2ca512c04d8fb56e791ffd737ceb54be75ad3&v=4)](/tarcieri)

Copy link

Member

### **[tarcieri](/tarcieri)** commented [Nov 22, 2023](#issuecomment-1823005096)

| [@tomato42](https://github.com/tomato42) indeed that's using PKCS#1v1.5 without random blinding, so with modpow being non-constant-time, it's to be expected. We should definitely get rid of any APIs which permit private key use without random blinding. |
| --- |

All reactions

Sorry, something went wrong.

[![@tarcieri](https://avatars.githubusercontent.com/u/797?s=80&u=aca2ca512c04d8fb56e791ffd737ceb54be75ad3&v=4)](/tarcieri)

Copy link

Member

### **[tarcieri](/tarcieri)** commented [Nov 22, 2023](#issuecomment-1823007964)

| Also just a note for the future, per our [SECURITY.md](https://github.com/RustCrypto/RSA/blob/master/SECURITY.md) we would've appreciated an advisory for this opened under a private security disclosure. |
| --- |

All reactions

Sorry, something went wrong.

[![@tomato42](https://avatars.githubusercontent.com/u/618246?s=80&v=4)](/tomato42)

Copy link

### **[tomato42](/tomato42)** commented [Nov 22, 2023](#issuecomment-1823011449)

| [@tarcieri](https://github.com/tarcieri) If the de-blinding isn't performed using constant-time code, then use of blinding won't remove the side-channel signal, that's what the bug in OpenSSL was about: removal of the blinder and conversion to the constant-length bytes needs to be side-channel free too.  Also just a note for the future, per our [SECURITY.md](https://github.com/RustCrypto/RSA/blob/master/SECURITY.md) we would've appreciated an advisory for this opened under a private security disclosure.  ah, sorry about that; since this was linked as a security issue, I've assumed that the effect of it on security of RSA decryption was assumed public too. |
| --- |

All reactions

Sorry, something went wrong.

[![@tarcieri](https://avatars.githubusercontent.com/u/797?s=80&u=aca2ca512c04d8fb56e791ffd737ceb54be75ad3&v=4)](/tarcieri)

Copy link

Member

### **[tarcieri](/tarcieri)** commented [Nov 22, 2023](#issuecomment-1823013603)

| Our answer until now has been that the application of random blinding prevented such sidechannels, so the fact that isn't the case is news to us |
| --- |

All reactions

Sorry, something went wrong.

[![@tomato42](https://avatars.githubusercontent.com/u/618246?s=80&v=4)](/tomato42)

Copy link

### **[tomato42](/tomato42)** commented [Nov 22, 2023](#issuecomment-1823018292)

| sorry, I'm confused, on one hand you say that the the `privkey.decrypt(Pkcs1v15Encrypt, &buffer);` won't use blinding, yet that's the public API that you say is protected by use of blinding in `README.md`...? |
| --- |

All reactions

Sorry, something went wrong.

[![@tarcieri](https://avatars.githubusercontent.com/u/797?s=80&u=aca2ca512c04d8fb56e791ffd737ceb54be75ad3&v=4)](/tarcieri)

Copy link

Member

### **[tarcieri](/tarcieri)** commented [Nov 22, 2023](#issuecomment-1823019237) ‚Ä¢ edited Loading

| The README.md is wrong in that case.  (Also I'm just discovering this and haven't had time to look over any code yet to confirm specific details) |
| --- |

All reactions

Sorry, something went wrong.

[![@tomato42](https://avatars.githubusercontent.com/u/618246?s=80&v=4)](/tomato42)

Copy link

### **[tomato42](/tomato42)** commented [Nov 22, 2023](#issuecomment-1823028114) ‚Ä¢ edited Loading

| ok, I'm still running test with a larger sample, to see if there aren't additional sources of leakage. If you have any additional questions, feel free to ask |
| --- |

All reactions

Sorry, something went wrong.

[![@tarcieri](https://avatars.githubusercontent.com/u/797?s=80&u=aca2ca512c04d8fb56e791ffd737ceb54be75ad3&v=4)](/tarcieri)

Copy link

Member

### **[tarcieri](/tarcieri)** commented [Nov 22, 2023](#issuecomment-1823032484)

| I'd be curious if you saw similar sidechannels in non-PKCS#1v1.5 constructions like OAEP decryption or PSS signatures |
| --- |

All reactions

Sorry, something went wrong.

[![@tomato42](https://avatars.githubusercontent.com/u/618246?s=80&v=4)](/tomato42)

Copy link

### **[tomato42](/tomato42)** commented [Nov 22, 2023](#issuecomment-1823073241)

| if you could propose a change on top of that PR that adds an OAEP decryption, I can run tests for that too (there are scripts in marvin-toolkit for testing OAEP too)  but since the leak is clearly from the numerical library, that means OAEP is also vulnerable, as that leak happens before any OAEP checks  even if PSS leaks like that, it doesn't make the implementation as easily exploitable, as both PKCS#1v1.5 an OAEP attacks are chosen ciphertext attacks, with PSS (or with PKCS#1 v1.5 signatures) the attacker can only reasonably affect the hash being signed, not the whole plaintext (in other words, it's a fundamentally different attack, so the test for it needs to be different too) |
| --- |

All reactions

Sorry, something went wrong.

[![@tarcieri](https://avatars.githubusercontent.com/u/797?s=80&u=aca2ca512c04d8fb56e791ffd737ceb54be75ad3&v=4)](/tarcieri)

Copy link

Member

### **[tarcieri](/tarcieri)** commented [Nov 22, 2023](#issuecomment-1823082096) ‚Ä¢ edited Loading

| Can you confirm you see the sidechannel against the raw blinded modpow operation (when used with e.g. `rand_core::OsRng`)? That's really what I'm curious about. |
| --- |

All reactions

Sorry, something went wrong.

[![@tomato42](https://avatars.githubusercontent.com/u/618246?s=80&v=4)](/tomato42)

Copy link

### **[tomato42](/tomato42)** commented [Nov 22, 2023](#issuecomment-1823089839)

| Sorry, I'm not a rust developer, you will need to hand-hold me (provide the complete code to execute) if you want me to run any tests |
| --- |

 üëç
1
 tarcieri reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![@tarcieri](https://avatars.githubusercontent.com/u/797?s=80&u=aca2ca512c04d8fb56e791ffd737ceb54be75ad3&v=4)](/tarcieri)

Copy link

Member

### **[tarcieri](/tarcieri)** commented [Nov 22, 2023](#issuecomment-1823104464)

| The branch containing that code has disappeared: <https://github.com/ueno/marvin-toolkit/tree/wip/rust-crypto>  You can test the low-level "hazmat" API: <https://docs.rs/rsa/latest/rsa/hazmat/fn.rsa_decrypt.html>  It would look something like:  <https://github.com/tomato42/marvin-toolkit/pull/4/files#diff-c0f6b76f1d52cf643fb2f30ef85b81b20ace1aa7577d1f4603db0e091e052d66R50-R63>  ...replaced with:  ```     loop {         let mut buffer = vec![0; args.size];         let n = infile.read(&mut buffer)?;         if n == 0 {             break;         }          assert!(n == buffer.len());          let now = Instant::now();         let c = rsa::BigUint::from_bytes_be(&buffer);         let _ =  rsa::hazmat::rsa_decrypt(Some(&mut rand_core::OsRng), &privkey, &c);         writeln!(outfile, "{}", now.elapsed().as_nanos())?;     } ```  Note you'll need to add `rand_core` as a dependency and enable the `hazmat` feature of `rsa`:  <https://github.com/tomato42/marvin-toolkit/pull/4/files#diff-76856434fe4ad8f1f778ba0452c8d8e49e764d25adf1374d385634cd251e1ca2R6-R9>  ``` [dependencies] anyhow = "1" clap = { version = "4", features = ["derive"] } rand_core = { version = "0.6", features = ["getrandom"] } rsa = { version = "0.9", features = ["hazmat"] } ``` |
| --- |

 üëç
1
 tomato42 reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![@tomato42](https://avatars.githubusercontent.com/u/618246?s=80&v=4)](/tomato42)

Copy link

### **[tomato42](/tomato42)** commented [Nov 22, 2023](#issuecomment-1823283824)

| *(will test `rsa_decrypt` from hazmat later)*  With 1 million observations per sample (same setup) I'm getting:  ``` Sign test mean p-value: 0.09834, median p-value: 2.633e-08, min p-value: 0.0 Friedman test (chisquare approximation) for all samples p-value: 0.0 Worst pair: 2(no_padding_48), 4(signature_padding_8) Mean of differences: -2.06196e-06s, 95% CI: -2.09851e-06s, -2.022175e-06s (¬±3.817e-08s) Median of differences: -3.22400e-06s, 95% CI: -3.24600e-06s, -3.205000e-06s (¬±2.050e-08s) Trimmed mean (5%) of differences: -1.99461e-06s, 95% CI: -2.02364e-06s, -1.965729e-06s (¬±2.895e-08s) Trimmed mean (25%) of differences: -2.08608e-06s, 95% CI: -2.10654e-06s, -2.067761e-06s (¬±1.939e-08s) Trimmed mean (45%) of differences: -3.09282e-06s, 95% CI: -3.11547e-06s, -3.070944e-06s (¬±2.227e-08s) Trimean of differences: -2.22769e-06s, 95% CI: -2.25800e-06s, -2.198494e-06s (¬±2.975e-08s  ```  [conf_interval_plot_trim_mean_25](https://private-user-images.githubusercontent.com/618246/285007263-1531e5cf-8ace-49bd-a57e-84b038b9893e.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY5MzI0ODAsIm5iZiI6MTczNjkzMjE4MCwicGF0aCI6Ii82MTgyNDYvMjg1MDA3MjYzLTE1MzFlNWNmLThhY2UtNDliZC1hNTdlLTg0YjAzOGI5ODkzZS5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjUwMTE1JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI1MDExNVQwOTA5NDBaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT1jMWY4ZDM1NDJiYjMyZDQ2ZTFmYWY0MGFkZThiM2JlOThkNDg1Y2E1NTdkYjk0NjhhNjE2NDk3NjZlYWFmNDU5JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.I9ngXYRrY3CoP3UIC2iJpXqQjJRd0LDpOxxjF-xOQiA)  and pairwise results: [report.txt](https://github.com/RustCrypto/RSA/files/13443321/report.txt)  Which show that the errors in padding checks also leak (compare `valid_48` to `valid_246`: sign test p-value of 5.13e-7) |
| --- |

All reactions

Sorry, something went wrong.

[![@tomato42](https://avatars.githubusercontent.com/u/618246?s=80&v=4)](/tomato42)

Copy link

### **[tomato42](/tomato42)** commented [Nov 23, 2023](#issuecomment-1823711671)

| ran the tests against this:  ```         let c = rsa::BigUint::from_bytes_be(&buffer);         let _ =  rsa::hazmat::rsa_decrypt(Some(&mut rand_core::OsRng), &privkey, &c); ```  and have confirmed that it's leaking too.  Same overall configuration but with 2.5 million observations per probe:  ``` Sign test mean p-value: 0.1915, median p-value: 0.008017, min p-value: 1.428e-15 Friedman test (chisquare approximation) for all samples p-value: 6.50448690941627e-27 Worst pair: 0(no_padding_48), 3(too_short_payload_0_1) Mean of differences: -1.11105e-07s, 95% CI: -1.42260e-07s, -7.775684e-08s (¬±3.225e-08s) Median of differences: -9.50000e-08s, 95% CI: -1.19000e-07s, -7.300000e-08s (¬±2.300e-08s) Trimmed mean (5%) of differences: -9.89875e-08s, 95% CI: -1.25208e-07s, -7.384255e-08s (¬±2.568e-08s) Trimmed mean (25%) of differences: -9.23689e-08s, 95% CI: -1.18946e-07s, -6.803432e-08s (¬±2.546e-08s) Trimmed mean (45%) of differences: -9.30858e-08s, 95% CI: -1.17708e-07s, -7.039496e-08s (¬±2.366e-08s) Trimean of differences: -9.47500e-08s, 95% CI: -1.20250e-07s, -7.056250e-08s (¬±2.484e-08s)  ```  [conf_interval_plot_trim_mean_45](https://private-user-images.githubusercontent.com/618246/285074409-f0ec4feb-15df-4868-b174-abcfb2ec4b00.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY5MzI0ODAsIm5iZiI6MTczNjkzMjE4MCwicGF0aCI6Ii82MTgyNDYvMjg1MDc0NDA5LWYwZWM0ZmViLTE1ZGYtNDg2OC1iMTc0LWFiY2ZiMmVjNGIwMC5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjUwMTE1JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI1MDExNVQwOTA5NDBaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT05M2IzNDJjMzUzM2M1Y2NkZTE5YmNhYjhkNDRiZWFkZDM4MzhiMjdkYWZiMDMwMjAyZWY2MTdjNWM2NTE0ODdjJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.dg2c-wITCmIzI4168HdoBr3FNWurRKFyzLbIyO22IEw)  Since for raw RSA padding doesn't matter I've executed a slightly different set of tests:  ``` ID,Name 0,no_padding_48 1,no_structure 2,signature_padding_8 3,too_short_payload_0_1 4,too_short_payload_0_3 5,too_short_payload_0_7 6,too_short_payload_0_15 7,valid_0 8,valid_repeated_byte_payload_245_0  ```  and pairwise statistical test results: [report.txt](https://github.com/RustCrypto/RSA/files/13445324/report.txt) |
| --- |

All reactions

Sorry, something went wrong.

[![@tarcieri](https://avatars.githubusercontent.com/u/797?s=80&u=aca2ca512c04d8fb56e791ffd737ceb54be75ad3&v=4)](/tarcieri)

Copy link

Member

### **[tarcieri](/tarcieri)** commented [Nov 23, 2023](#issuecomment-1823720024)

| I'm not sure what solution we can provide here short of a fully constant time implementation (which was the planned long-term solution for this problem, using e.g. a Barrett reduction as provided by `crypto-bigint`, but that will require a substantial amount of work)  I guess I need to figure out how to run your reproducer.  Can you explain a bit more what those charts are showing? Are you actually able to recover keys? |
| --- |

All reactions

Sorry, something went wrong.

[![@tomato42](https://avatars.githubusercontent.com/u/618246?s=80&v=4)](/tomato42)

Copy link

### **[tomato42](/tomato42)** commented [Nov 23, 2023](#issuecomment-1823748713) ‚Ä¢ edited Loading

| I'm not sure what solution we can provide here short of a fully constant time implementation  what's necessary, is ensuring that the unblinding happens in constant time with respect to the output; that means you need to convert the whatever arbitrary precision format is in use for the modulo exponentiation into constant length integers, then multiply them using real constant-time code, and finally do constant time reduction modulo. Something like what's in <https://github.com/tomato42/ctmpi> but in rust, not in C. Leakage in conversion from one format to the other is not a problem as that value is uncorrelated with the RSA plaintext, so leakage of it doesn't provide useful information to the attacker (as long as the blinding/unblinding factors remain secret).  That being said, if your mod\_exp is leaky, you really have to employ *both* base blinding *and* exponent blinding. Details of that, as well as links to papers showing attacks against implementations that used just one kind of blinding are in the <https://datatracker.ietf.org/doc/html/draft-kario-rsa-guidance-02> But to fix raw RSA implementation against Bleichenbacher/Marvin you just need to fix the last multiplication and reduction modulo.  Can you explain a bit more what those charts are showing?  they show the estimation of the difference in timing for different inputs. Like in the last one, `no_padding_48` (probe 0) is processed about 83 ns slower than `no_structure` (probe 1): that's why it's marked 1-0 (or "probe 1 time subtract probe 0 time")  Are you actually able to recover keys?  those graphs show that it's possible, using time of the decryption, to execute one instance of the Bleichenbacher oracle. To decrypt a RSA ciphertext (or forge a signature) the attacker would need to run the test good few thousand times. See the details on the Marvin vulnerability page and in the associated papers. Since my goal is proving that there is no side-channel, not actually attacking implementations, I don't have good tooling to actually perform the attack (but then there's 25 years of literature on the topic, so once you have a working oracle, there are ready solutions for the rest). |
| --- |

All reactions

Sorry, something went wrong.

[![@tomato42](https://avatars.githubusercontent.com/u/618246?s=80&v=4)](/tomato42)

Copy link

### **[tomato42](/tomato42)** commented [Nov 23, 2023](#issuecomment-1824341149)

| Another run for `rsa_decrypt`, this time with 10.5 million observations per sample:  ``` Sign test mean p-value: 0.1359, median p-value: 2.134e-07, min p-value: 1.433e-60 Friedman test (chisquare approximation) for all samples p-value: 9.61782206869971e-128 Worst pair: 0(no_padding_48), 8(valid_repeated_byte_payload_245_0) Mean of differences: -8.28395e-08s, 95% CI: -9.87044e-08s, -6.762672e-08s (¬±1.554e-08s) Median of differences: -9.10000e-08s, 95% CI: -1.02000e-07s, -8.000000e-08s (¬±1.100e-08s) Trimmed mean (5%) of differences: -8.62429e-08s, 95% CI: -9.87246e-08s, -7.492710e-08s (¬±1.190e-08s) Trimmed mean (25%) of differences: -8.64124e-08s, 95% CI: -9.79358e-08s, -7.520178e-08s (¬±1.137e-08s) Trimmed mean (45%) of differences: -9.07003e-08s, 95% CI: -1.00972e-07s, -7.931308e-08s (¬±1.083e-08s) Trimean of differences: -9.07500e-08s, 95% CI: -1.02000e-07s, -8.025000e-08s (¬±1.087e-08s)  ```  [conf_interval_plot_trim_mean_45](https://private-user-images.githubusercontent.com/618246/285202189-0318f8d5-32d8-4290-b234-1094406782d2.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY5MzI0ODAsIm5iZiI6MTczNjkzMjE4MCwicGF0aCI6Ii82MTgyNDYvMjg1MjAyMTg5LTAzMThmOGQ1LTMyZDgtNDI5MC1iMjM0LTEwOTQ0MDY3ODJkMi5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjUwMTE1JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI1MDExNVQwOTA5NDBaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT05MmRiZjJmNzVkYmI5ZjA5N2U5NmI1YTFkZjc1NDI4M2ZjNTRkODY5YjliZDUxZTcyMjk1YzY4YTY3N2M3YWU1JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.9-R3Y7g_GW6m9lyeB__7yp8z-GSFO2GG-Bb3nRYjRqg)  and pairwise statistical results: [report.txt](https://github.com/RustCrypto/RSA/files/13449694/report.txt)  Which suggests that for the leakage to happen, the whole most significant word needs to be equal 0. This will make attacks against OAEP with 2048 bit keys rather impractical against 64 bit architectures. But it does mean that both 32 bit architectures, and less common key sizes, like 2049 or 2056 bit keys, are rather realistic to attack.  Note: I haven't excluded the possibility of leakage happening with probe 3 or probe 4 (16 and 32 most significant bits being zero respectively), but it does look exactly the same as the leakage pattern for [CVE-2022-4304](https://github.com/advisories/GHSA-p52g-cm5j-mjv4 "CVE-2022-4304"), where I did do that. |
| --- |

All reactions

Sorry, something went wrong.

[![@tarcieri](https://avatars.githubusercontent.com/u/797?s=80&u=aca2ca512c04d8fb56e791ffd737ceb54be75ad3&v=4)](/tarcieri)

Copy link

Member

### **[tarcieri](/tarcieri)** commented [Nov 23, 2023](#issuecomment-1824721892)

| what's necessary, is ensuring that the unblinding happens in constant time with respect to the output; that means you need to convert the whatever arbitrary precision format is in use for the modulo exponentiation into constant length integers, then multiply them using real constant-time code, and finally do constant time reduction modulo. Something like what's in <https://github.com/tomato42/ctmpi> but in rust, not in C.  The core `modpow` operation in `num-bigint-dig` should already implemented in terms of Montgomery multiplication: <https://github.com/dignifiedquire/num-bigint/blob/6f73f0a4025164325e85f8645dad6712b3110c51/src/monty.rs#L129>  That alone is insufficient, however, per the OP. I'd generally worry that `num-bigint` is a general-purpose arbitrary precision bignum library that wasn't designed for constant-time operation.  I could potentially attempt to completely sidestep `num-bigint` for this, extracting the raw limbs out of the `BigUint`s and performing modpow in code which has been carefully written to avoid any secret-dependent branching, similar to what we have already in `crypto-bigint`: <https://github.com/RustCrypto/crypto-bigint/blob/a02c505/src/uint/modular/reduction.rs> |
| --- |

All reactions

Sorry, something went wrong.

[![@tarcieri](https://avatars.githubusercontent.com/u/797?s=40&u=aca2ca512c04d8fb56e791ffd737ceb54be75ad3&v=4)](/tarcieri)
[tarcieri](/tarcieri)
mentioned this issue
[Nov 26, 2023](#ref-issue-2011234601)

[Why not RSA?
rozbb/rust-hpke#56](/rozbb/rust-hpke/issues/56)

Closed

129 hidden items

Load more‚Ä¶

[![@gogo2464](https://avatars.githubusercontent.com/u/57051187?s=80&v=4)](/gogo2464)

Copy link

### **[gogo2464](/gogo2464)** commented [Aug 10, 2024](#issuecomment-2282249617)

| [@tarcieri](https://github.com/tarcieri) thanks ! I am going to dig! |
| --- |

All reactions

Sorry, something went wrong.

[![@gogo2464](https://avatars.githubusercontent.com/u/57051187?s=80&v=4)](/gogo2464)

Copy link

### **[gogo2464](/gogo2464)** commented [Aug 12, 2024](#issuecomment-2284459593)

| [@tarcieri](https://github.com/tarcieri) I am actively digging!!!!  I used the marvin toolkit. I have the data. But I need a tool to recover message from the identified vulnerability from the previously extracted data. Do you know a such tool please? |
| --- |

All reactions

Sorry, something went wrong.

[![@tarcieri](https://avatars.githubusercontent.com/u/797?s=80&u=aca2ca512c04d8fb56e791ffd737ceb54be75ad3&v=4)](/tarcieri)

Copy link

Member

### **[tarcieri](/tarcieri)** commented [Aug 12, 2024](#issuecomment-2284761782)

| I don't offhand, although I believe it's part of the toolkit.  [@gogo2464](https://github.com/gogo2464) it would probably help if you asked these questions on Zulip so we can keep this already quite busy issue on topic for resolving the core issue: <https://rustcrypto.zulipchat.com/#narrow/stream/260047-RSA> |
| --- |

All reactions

Sorry, something went wrong.

[![@tomato42](https://avatars.githubusercontent.com/u/618246?s=80&v=4)](/tomato42)

Copy link

### **[tomato42](/tomato42)** commented [Aug 12, 2024](#issuecomment-2285033734)

| No, the toolkit doesn't have the exploit as part of it, there are multiple reasons for it, but the main one is that it's hard to create one that's universal. In practice, Marvin toolkit is able to run a single instance of the Bleichenbacher oracle, you need to create a separate piece of code that will call this oracle.  the Marvin paper does give a high level overview, for details you'll need to look at the past papers  How much noise time is acceptable in miliseconds to have a reliable exploit please?  I'm not exactly sure what you're asking here... a reliable exploit requires you to be able to run statistical tests that give highly significant results (p-value below 1e-6 at least) for values we're interested in (i.e. ciphertexts that decrypt to plaintexts starting with specific bytes) or ones that consistently rejects values we're not interested in (i.e. ciphertexts that decrypt to plaintexts that don't start with specific bytes). That's a product of everything: size of the sample, size of the side-channel, size of the noise, nature of the noise (is it changing in time?), amount of irrelevant code measured together with the leaky code, resolution, precision and accuracy of the time source used... just as an example of the most significant parts of that. |
| --- |

All reactions

Sorry, something went wrong.

[![@luhring](https://avatars.githubusercontent.com/u/5199289?s=40&v=4)](/luhring)
[luhring](/luhring)
mentioned this issue
[Aug 24, 2024](#ref-pullrequest-2479220514)

[feat(zed): pending-upstream-fix for GHSA-4grx-2x9w-596c, GHSA-c38w-74‚Ä¶
wolfi-dev/advisories#7284](/wolfi-dev/advisories/pull/7284)
 Closed

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
mentioned this issue
[Aug 28, 2024](#ref-issue-2490606925)

[RUSTSEC-2023-0071: Marvin Attack: potential key recovery through timing sidechannels
tauri-apps/tauri#10806](/tauri-apps/tauri/issues/10806)

Open

[![@link2xt](https://avatars.githubusercontent.com/u/18373967?s=40&v=4)](/link2xt)
[link2xt](/link2xt)
mentioned this issue
[Sep 2, 2024](#ref-issue-2501586098)

[Could deltachat be vulnerable to marvin attack?
deltachat/deltachat-core-rust#5947](/deltachat/deltachat-core-rust/issues/5947)

Closed

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
mentioned this issue
[Sep 9, 2024](#ref-issue-2513262548)

[RUSTSEC-2023-0071: Marvin Attack: potential key recovery through timing sidechannels
affinidi/affinidi-did-resolver#2](/affinidi/affinidi-did-resolver/issues/2)

Closed

[![@namegorm](https://avatars.githubusercontent.com/u/61600323?s=40&v=4)](/namegorm)
[namegorm](/namegorm)
mentioned this issue
[Sep 9, 2024](#ref-issue-2514264233)

[RUSTSEC-2023-0071: Marvin Attack: potential key recovery through timing sidechannels
Eugeny/russh#337](/Eugeny/russh/issues/337)

Open

This was referenced Sep 9, 2024

[RUSTSEC-2023-0071: Marvin Attack: potential key recovery through timing sidechannels
affinidi/affinidi-messaging#4](/affinidi/affinidi-messaging/issues/4)

Closed

[RUSTSEC-2023-0071: Marvin Attack: potential key recovery through timing sidechannels
GiganticMinecraft/seichi-portal-backend#542](/GiganticMinecraft/seichi-portal-backend/issues/542)

Open

[![@ogtn](https://avatars.githubusercontent.com/u/7198155?s=40&v=4)](/ogtn)
[ogtn](/ogtn)
mentioned this issue
[Sep 24, 2024](#ref-issue-2432759467)

[Vulnerability in the `rsa` (a recursive dependency of SeaORM)
SeaQL/sea-orm#2301](/SeaQL/sea-orm/issues/2301)

Open

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
mentioned this issue
[Oct 5, 2024](#ref-issue-2567590724)

[RUSTSEC-2023-0071: Marvin Attack: potential key recovery through timing sidechannels
rustaceanrob/kyoto#157](/rustaceanrob/kyoto/issues/157)

Open

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
mentioned this issue
[Oct 24, 2024](#ref-issue-2610092912)

[RUSTSEC-2023-0071: Marvin Attack: potential key recovery through timing sidechannels
mihai-dinculescu/home-automation-tapo#67](/mihai-dinculescu/home-automation-tapo/issues/67)

Closed

[![@tarcieri](https://avatars.githubusercontent.com/u/797?s=40&u=aca2ca512c04d8fb56e791ffd737ceb54be75ad3&v=4)](/tarcieri)
[tarcieri](/tarcieri)
mentioned this issue
[Nov 1, 2024](#ref-issue-2629340263)

[Marvin Attack: potential key recovery through timing sidechannels
#457](/RustCrypto/RSA/issues/457)

Closed

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
mentioned this issue
[Nov 4, 2024](#ref-issue-2631589911)

[RUSTSEC-2023-0071: Marvin Attack: potential key recovery through timing sidechannels
alisonjenkins/zero2prod#27](/alisonjenkins/zero2prod/issues/27)

Open

[![@mepi262](https://avatars.githubusercontent.com/u/185912486?s=80&v=4)](/mepi262)

Copy link

### **[mepi262](/mepi262)** commented [Nov 5, 2024](#issuecomment-2457331961)

| [@tarcieri](https://github.com/tarcieri) Any update on this issue? |
| --- |

All reactions

Sorry, something went wrong.

[![@tarcieri](https://avatars.githubusercontent.com/u/797?s=80&u=aca2ca512c04d8fb56e791ffd737ceb54be75ad3&v=4)](/tarcieri)

Copy link

Member

### **[tarcieri](/tarcieri)** commented [Nov 5, 2024](#issuecomment-2457354905)

| The PR to address it is still open: [#394](https://github.com/RustCrypto/RSA/pull/394) |
| --- |

 üëç
3
 mepi262, Losses, and washanhanzi reacted with thumbs up emoji

All reactions

* üëç
  3 reactions

Sorry, something went wrong.

[![@dignifiedquire](https://avatars.githubusercontent.com/u/790842?s=40&u=b7dd795afade6650e64ed348b5ab04f40eb5e8ce&v=4)](/dignifiedquire)
[dignifiedquire](/dignifiedquire)
mentioned this issue
[Nov 6, 2024](#ref-issue-2586724077)

[RSA very slow, takes 11ms in release
#454](/RustCrypto/RSA/issues/454)

Closed

[![@mnhauke](https://avatars.githubusercontent.com/u/4259039?s=40&v=4)](/mnhauke)
[mnhauke](/mnhauke)
mentioned this issue
[Nov 9, 2024](#ref-issue-2646457542)

[Security vulnerability found by `cargo audit`
VirusTotal/yara-x#240](/VirusTotal/yara-x/issues/240)

Closed

[![@morganava](https://avatars.githubusercontent.com/u/2148104?s=40&v=4)](/morganava)
[morganava](/morganava)
mentioned this issue
[Nov 12, 2024](#ref-issue-2653672857)

[CLN-003 - Rsa crate dependency timing side channel
blueprint-freespeech/gosling#127](/blueprint-freespeech/gosling/issues/127)

Open

[![@tarcieri](https://avatars.githubusercontent.com/u/797?s=40&u=aca2ca512c04d8fb56e791ffd737ceb54be75ad3&v=4)](/tarcieri)
[tarcieri](/tarcieri)
mentioned this issue
[Nov 13, 2024](#ref-issue-2654998383)

[Any plan / ETA to fix Security Issue GHSA-c38w-74pg-36hr ?
#458](/RustCrypto/RSA/issues/458)

Closed

This was referenced Nov 17, 2024

[RUSTSEC-2023-0071: Marvin Attack: potential key recovery through timing sidechannels
izzyhub/botifactory#1](/izzyhub/botifactory/issues/1)

Open

[RUSTSEC-2023-0071: Marvin Attack: potential key recovery through timing sidechannels
cot-rs/cot#72](/cot-rs/cot/issues/72)

Open

[RUSTSEC-2023-0071: Marvin Attack: potential key recovery through timing sidechannels
RustyNova016/Alistral#305](/RustyNova016/Alistral/issues/305)

Closed

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
mentioned this issue
[Dec 23, 2024](#ref-issue-2755026442)

[RUSTSEC-2023-0071: Marvin Attack: potential key recovery through timing sidechannels
conic-apps/website#5](/conic-apps/website/issues/5)

Open

[![@benjaminbruun](https://avatars.githubusercontent.com/u/77008038?s=40&v=4)](/benjaminbruun)
[benjaminbruun](/benjaminbruun)
mentioned this issue
[Dec 23, 2024](#ref-pullrequest-2756043424)

[chore: bump rsa from 0.9.2 to 0.9.x
onomondo/onomondo-softsim-cli#65](/onomondo/onomondo-softsim-cli/pull/65)
 Draft

This was referenced Jan 3, 2025

[RUSTSEC-2023-0071: Marvin Attack: potential key recovery through timing sidechannels
weaveworks/sops-gitops-github-action#1](/weaveworks/sops-gitops-github-action/issues/1)

Open

[RUSTSEC-2023-0071: Marvin Attack: potential key recovery through timing sidechannels
appcypher/monocore#101](/appcypher/monocore/issues/101)

Open

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
mentioned this issue
[Jan 15, 2025](#ref-issue-2788515923)

[RUSTSEC-2023-0071: Marvin Attack: potential key recovery through timing sidechannels
FuelLabs/data-systems#376](/FuelLabs/data-systems/issues/376)

Open

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FRustCrypto%2FRSA%2Fissues%2F19)

Assignees

No one assigned

Labels

[security](/RustCrypto/RSA/labels/security)

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

12 participants

[![@tarcieri](https://avatars.githubusercontent.com/u/797?s=52&v=4)](/tarcieri) [![@jedisct1](https://avatars.githubusercontent.com/u/124872?s=52&v=4)](/jedisct1) [![@phayes](https://avatars.githubusercontent.com/u/207037?s=52&v=4)](/phayes) [![@Shnatsel](https://avatars.githubusercontent.com/u/291257?s=52&v=4)](/Shnatsel) [![@newpavlov](https://avatars.githubusercontent.com/u/329626?s=52&v=4)](/newpavlov) [![@randombit](https://avatars.githubusercontent.com/u/469092?s=52&v=4)](/randombit) [![@tomato42](https://avatars.githubusercontent.com/u/618246?s=52&v=4)](/tomato42) [![@dignifiedquire](https://avatars.githubusercontent.com/u/790842?s=52&v=4)](/dignifiedquire) [![@exFalso](https://avatars.githubusercontent.com/u/1042674?s=52&v=4)](/exFalso) [![@kpcyrd](https://avatars.githubusercontent.com/u/7763184?s=52&v=4)](/kpcyrd) [![@gogo2464](https://avatars.githubusercontent.com/u/57051187?s=52&v=4)](/gogo2464) [![@mepi262](https://avatars.githubusercontent.com/u/185912486?s=52&v=4)](/mepi262)

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.


