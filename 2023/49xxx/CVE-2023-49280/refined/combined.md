=== Content from github.com_ff109e1b_20250115_090002.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxwiki-contrib%2Fapplication-changerequest%2Fsecurity%2Fadvisories%2FGHSA-2fr7-cc7p-p45q)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxwiki-contrib%2Fapplication-changerequest%2Fsecurity%2Fadvisories%2FGHSA-2fr7-cc7p-p45q)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=xwiki-contrib%2Fapplication-changerequest)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[xwiki-contrib](/xwiki-contrib)
/
**[application-changerequest](/xwiki-contrib/application-changerequest)**
Public

* [Notifications](/login?return_to=%2Fxwiki-contrib%2Fapplication-changerequest) You must be signed in to change notification settings
* [Fork
  7](/login?return_to=%2Fxwiki-contrib%2Fapplication-changerequest)
* [Star
   2](/login?return_to=%2Fxwiki-contrib%2Fapplication-changerequest)

* [Code](/xwiki-contrib/application-changerequest)
* [Pull requests
  0](/xwiki-contrib/application-changerequest/pulls)
* [Actions](/xwiki-contrib/application-changerequest/actions)
* [Security](/xwiki-contrib/application-changerequest/security)
* [Insights](/xwiki-contrib/application-changerequest/pulse)

Additional navigation options

* [Code](/xwiki-contrib/application-changerequest)
* [Pull requests](/xwiki-contrib/application-changerequest/pulls)
* [Actions](/xwiki-contrib/application-changerequest/actions)
* [Security](/xwiki-contrib/application-changerequest/security)
* [Insights](/xwiki-contrib/application-changerequest/pulse)

# Data leak of password hash through change requests

High

[surli](/surli)
published
GHSA-2fr7-cc7p-p45q
Dec 4, 2023

## Package

maven

org.xwiki.contrib.changerequest:application-changerequest-default
([Maven](/advisories?query=ecosystem%3Amaven))

## Affected versions

>= 0.1

## Patched versions

1.10

## Description

### Impact

Change request allows to edit any page by default, and the changes are then exported in an XML that anyone can download. So it's possible for an attacker to obtain password hash of users by performing edition of the user profiles and then downloading the XML that has been created. This is also true for any document that might contain password field and that a user can view.

This vulnerability impacts all version of Change Request, but the impact depends on the rights that has been set on the wiki since it requires for the user to have the Change request right (allowed by default) and view rights on the page to target.

Also the issue cannot be easily exploited in an automated way.

### Patches

The patch consists in denying to users the right of editing pages that contains a password field with change request. It means that already existing change request for those pages won't be removed by the patch, administrators needs to take care of it.

The patch is provided in Change Request 1.10, administrators should upgrade immediately.

### Workarounds

It's possible to workaround the vulnerability by denying manually the Change request right on some spaces, such as XWiki space which will include any user profile by default.

### References

* JIRA issue: <https://jira.xwiki.org/browse/CRAPP-302>
* Commit of the fix: [ff0f536](https://github.com/xwiki-contrib/application-changerequest/commit/ff0f5368ea04f0e4aa7b33821c707dc68a8c5ca8)

### For more information

If you have any questions or comments about this advisory:

* Open an issue in [Jira XWiki.org](https://jira.xwiki.org/)
* Email us at Security Mailing List

### Attribution

Thanks Michael Hamann for the report.

### Severity

High

7.7

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
Low

User interaction
None

Scope
Changed

Confidentiality
High

Integrity
None

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:N/A:N

### CVE ID

CVE-2023-49280

### Weaknesses

[CWE-522](/advisories?query=cwe%3A522)

### Credits

* [![@michitux](https://avatars.githubusercontent.com/u/198317?s=40&v=4)](/michitux)
  [michitux](/michitux)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from jira.xwiki.org_a9a81eb3_20250115_090002.html ===


[Log in](/login.jsp?os_destination=%2Fbrowse%2FCRAPP-302)[Skip to main content](#main)[Skip to sidebar](#sidebar)Linked ApplicationsLoading…[![XWiki.org JIRA](/s/-65z3d2/930000/8ws80b/_/jira-logo-scaled.png)](https://jira.xwiki.org/secure/MyJiraHome.jspa)

* [Dashboards](/secure/Dashboard.jspa "View and manage your dashboards")
* [Projects](/secure/BrowseProjects.jspa "View recent projects and browse a list of projects")
* [Issues](/issues/ "Search for issues and view recent issues")

* Give feedback to Atlassian
* [Help](https://docs.atlassian.com/jira/jcore-docs-093/ "Help")
  + [Jira Core help](https://docs.atlassian.com/jira/jcore-docs-093/ "Go to the online documentation for Jira Core")
  + [Keyboard Shortcuts](/secure/ViewKeyboardShortcuts%21default.jspa "Get more information about Jira's Keyboard Shortcuts")
  + [About Jira](/secure/AboutPage.jspa "Get more information about Jira")
  + [Jira Credits](/secure/credits/AroundTheWorld%21default.jspa "See who did what")
* [Log In](/login.jsp?os_destination=%2Fbrowse%2FCRAPP-302)

![Uploaded image for project: 'Change Request Application'](https://jira.xwiki.org/secure/projectavatar?avatarId=13524)

1. [Change Request Application](/browse/CRAPP)
2. [CRAPP-302](/browse/CRAPP-302)

# Change requests of users permit accessing the password hash

[Log In](/login.jsp?os_destination=%2Fbrowse%2FCRAPP-302 "Log In")ClosedExportnull

XMLWordPrintable
#### Details

* **Type:**
  ![](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.") Bug
* **Resolution:**
  Fixed
* **Priority:**
  ![](/images/icons/priorities/blocker.svg "Blocker - Blocks development and/or testing work, production could not run.") Blocker
* **Fix Version/s:**
  [1.10](/issues/?jql=project+%3D+CRAPP+AND+fixVersion+%3D+1.10 "1.10 ")
* **Affects Version/s:**
  0.1
* **Component/s:**
  None
* **Labels:**
  + [attack\_dataleak](/issues/?jql=labels+%3D+attack_dataleak "attack_dataleak")
  + [attacker\_account](/issues/?jql=labels+%3D+attacker_account "attacker_account")
  + [security](/issues/?jql=labels+%3D+security "security")

* **Difficulty:**
  Unknown
* **Documentation:**
  <https://github.com/xwiki-contrib/application-changerequest/security/advisories/GHSA-2fr7-cc7p-p45q>
* **Documentation in Release Notes:**
  N/A
* **Similar issues:**

#### Description

**Steps to reproduce:**

1. Install change request.
2. Login as a regular (non-admin) user or as guest if change request is enabled for guests
3. Enable viewing hidden pages in your user profile or via the shortcut
4. Go to the profile of an admin user
5. Click on "Edit" and then "Save as Change Request" [![](https://jira.xwiki.org/secure/thumbnail/41569/_thumb_41569.png)](/secure/attachment/41569/41569_image-2023-08-07-11-18-36-649.png "image-2023-08-07-11-18-36-649.png")
6. Give the change request a title, you can also mark it as draft to prevent listing in review queues. Click "Save".
7. In the top navigation bar, click on the last triangle to open the menu of child pages and click on the page representing the admin user you just changed [![](https://jira.xwiki.org/secure/thumbnail/41568/_thumb_41568.png)](/secure/attachment/41568/41568_image-2023-08-07-11-20-54-833.png "image-2023-08-07-11-20-54-833.png")
8. Download the XML attachment in the attachments tab [![](https://jira.xwiki.org/secure/thumbnail/41567/_thumb_41567.png)](/secure/attachment/41567/41567_image-2023-08-07-11-21-15-871.png "image-2023-08-07-11-21-15-871.png")

**Expected result:**

There is an error at some point or at least the resulting XML doesn't contain the password hash.

**Actual result:**

The XML file contains the password hash of the admin user, allowing efficient offline attacks against the password.

The affects version is just the tested version. This might affect all versions of change request.

#### Attachments

#### Attachments

* Options
  + [Sort By Name](/browse/CRAPP-302?attachmentSortBy=fileName#attachmentmodule "viewissue.subtasks.tab.show.all.name")
  + [Sort By Date](/browse/CRAPP-302?attachmentSortBy=dateTime#attachmentmodule "Sort By Date")
  + [Ascending](/browse/CRAPP-302?attachmentOrder=asc#attachmentmodule "Ascending")
  + [Descending](/browse/CRAPP-302?attachmentOrder=desc#attachmentmodule "Descending")
  + [Thumbnails](/browse/CRAPP-302?attachmentViewMode=gallery#attachmentmodule "Thumbnails")
  + [List](/browse/CRAPP-302?attachmentViewMode=list#attachmentmodule "List")
  + [Download All](/secure/attachmentzip/71743.zip "Download all attachments as a ZIP file")

1. [![image-2023-08-07-11-18-36-649.png](https://jira.xwiki.org/secure/thumbnail/41569/_thumb_41569.png)](/secure/attachment/41569/image-2023-08-07-11-18-36-649.png "image-2023-08-07-11-18-36-649.png - Latest 07/Aug/23 11:18 - Michael Hamann")[image-2023-08-07-11-18-36-649.png](/secure/attachment/41569/image-2023-08-07-11-18-36-649.png "image-2023-08-07-11-18-36-649.png - Latest 07/Aug/23 11:18 - Michael Hamann")79 kB07/Aug/23 11:18
2. [![image-2023-08-07-11-20-54-833.png](https://jira.xwiki.org/secure/thumbnail/41568/_thumb_41568.png)](/secure/attachment/41568/image-2023-08-07-11-20-54-833.png "image-2023-08-07-11-20-54-833.png - Latest 07/Aug/23 11:20 - Michael Hamann")[image-2023-08-07-11-20-54-833.png](/secure/attachment/41568/image-2023-08-07-11-20-54-833.png "image-2023-08-07-11-20-54-833.png - Latest 07/Aug/23 11:20 - Michael Hamann")54 kB07/Aug/23 11:20
3. [![image-2023-08-07-11-21-15-871.png](https://jira.xwiki.org/secure/thumbnail/41567/_thumb_41567.png)](/secure/attachment/41567/image-2023-08-07-11-21-15-871.png "image-2023-08-07-11-21-15-871.png - Latest 07/Aug/23 11:21 - Michael Hamann")[image-2023-08-07-11-21-15-871.png](/secure/attachment/41567/image-2023-08-07-11-21-15-871.png "image-2023-08-07-11-21-15-871.png - Latest 07/Aug/23 11:21 - Michael Hamann")39 kB07/Aug/23 11:21
#### Activity

#### People

Assignee:

![surli](https://jira.xwiki.org/secure/useravatar?size=small&avatarId=10222)
Simon Urli

Reporter:

![MichaelHamann](https://jira.xwiki.org/secure/useravatar?size=small&avatarId=10222)
Michael Hamann

Votes:
0
Vote for this issue

Watchers:
1
Start watching this issue

#### Dates

Created:

07/Aug/23 11:23

Updated:

04/Dec/23 09:16

Resolved:

30/Aug/23 10:50

Date of First Response:

29/Aug/23 10:42 AM

* Atlassian Jira [Project Management Software](https://www.atlassian.com/software/jira)
* [About Jira](/secure/AboutPage.jspa/secure/AboutPage.jspa)
* [Report a problem](/secure/CreateIssue%21default.jspa)

Powered by a free Atlassian [Jira](http://www.atlassian.com/software/jira) open source license for XWiki.org. Try Jira - [bug tracking software](http://www.atlassian.com/software/jira) for *your* team.

[Atlassian](http://www.atlassian.com/)



=== Content from github.com_90acfdd7_20250115_090001.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxwiki-contrib%2Fapplication-changerequest%2Fcommit%2Fff0f5368ea04f0e4aa7b33821c707dc68a8c5ca8)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxwiki-contrib%2Fapplication-changerequest%2Fcommit%2Fff0f5368ea04f0e4aa7b33821c707dc68a8c5ca8)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=xwiki-contrib%2Fapplication-changerequest)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[xwiki-contrib](/xwiki-contrib)
/
**[application-changerequest](/xwiki-contrib/application-changerequest)**
Public

* [Notifications](/login?return_to=%2Fxwiki-contrib%2Fapplication-changerequest) You must be signed in to change notification settings
* [Fork
  7](/login?return_to=%2Fxwiki-contrib%2Fapplication-changerequest)
* [Star
   2](/login?return_to=%2Fxwiki-contrib%2Fapplication-changerequest)

* [Code](/xwiki-contrib/application-changerequest)
* [Pull requests
  0](/xwiki-contrib/application-changerequest/pulls)
* [Actions](/xwiki-contrib/application-changerequest/actions)
* [Security](/xwiki-contrib/application-changerequest/security)
* [Insights](/xwiki-contrib/application-changerequest/pulse)

Additional navigation options

* [Code](/xwiki-contrib/application-changerequest)
* [Pull requests](/xwiki-contrib/application-changerequest/pulls)
* [Actions](/xwiki-contrib/application-changerequest/actions)
* [Security](/xwiki-contrib/application-changerequest/security)
* [Insights](/xwiki-contrib/application-changerequest/pulse)

## Commit

[Permalink](/xwiki-contrib/application-changerequest/commit/ff0f5368ea04f0e4aa7b33821c707dc68a8c5ca8)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

CRAPP-302: Edit button is not displayed for guest user

[Browse files](/xwiki-contrib/application-changerequest/tree/ff0f5368ea04f0e4aa7b33821c707dc68a8c5ca8)
Browse the repository at this point in the history

```
  * Change the way to deal with change request edition right
```

* Loading branch information

[![@surli](https://avatars.githubusercontent.com/u/1478232?s=40&v=4)](/surli)

[surli](/xwiki-contrib/application-changerequest/commits?author=surli "View all commits by surli")
committed
Aug 29, 2023

1 parent
[5fc0799](/xwiki-contrib/application-changerequest/commit/5fc07995bca0e36e2f785f299d1a33c6f558179a)

commit ff0f536

 Show file tree

 Hide file tree

Showing
**10 changed files**
with
**284 additions**
and
**7 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* application-changerequest-api/src/main/java/org/xwiki/contrib/changerequest

  + application-changerequest-api/src/main/java/org/xwiki/contrib/changerequest/ChangeRequestRightsManager.java
    [ChangeRequestRightsManager.java](#diff-506a767feaef89f007733f67fa7a1907798908a4dcf9e8e74d1734b7b1902516)
* application-changerequest-default/src

  + checkstyle

    - application-changerequest-default/src/checkstyle/checkstyle-suppressions.xml
      [checkstyle-suppressions.xml](#diff-f7a962fa4fb42c3e3dbf933d9e3e22afb550f4089da44eb2695f405bfac3f9cb)
  + main/java/org/xwiki/contrib/changerequest

    - internal

      * application-changerequest-default/src/main/java/org/xwiki/contrib/changerequest/internal/DefaultChangeRequestRightsManager.java
        [DefaultChangeRequestRightsManager.java](#diff-acff9208e3a7581131c99d380ded940d74e48940bdb2a8854222cbdc5b127832)
      * handlers

        + application-changerequest-default/src/main/java/org/xwiki/contrib/changerequest/internal/handlers/AbstractChangeRequestActionHandler.java
          [AbstractChangeRequestActionHandler.java](#diff-da1862a7267879e108cd7933f46e4593f1dac0072cfc64dd928fe90a2004c562)
    - script

      * application-changerequest-default/src/main/java/org/xwiki/contrib/changerequest/script/ChangeRequestAuthorizationScriptService.java
        [ChangeRequestAuthorizationScriptService.java](#diff-78e1871f3781142d0ca0df00f0b2186942024af3c9fce8ce318e84651ddbd876)
  + test/java/org/xwiki/contrib/changerequest/internal

    - application-changerequest-default/src/test/java/org/xwiki/contrib/changerequest/internal/DefaultChangeRequestRightsManagerTest.java
      [DefaultChangeRequestRightsManagerTest.java](#diff-acf75fbbacb2ef63639f0ba3ab7fcd62846e888cd794f8b194ffe34c7b86b9e3)
    - handlers

      * application-changerequest-default/src/test/java/org/xwiki/contrib/changerequest/internal/handlers/AddChangesChangeRequestHandlerTest.java
        [AddChangesChangeRequestHandlerTest.java](#diff-c8f63defa21e70fadd32144ead886957d9c0d71d3998547971df112f51259984)
      * application-changerequest-default/src/test/java/org/xwiki/contrib/changerequest/internal/handlers/CreateChangeRequestHandlerTest.java
        [CreateChangeRequestHandlerTest.java](#diff-b06a326bc80127e5bc128cf12180ebf6946ffd42dff12b71c1b619d33d8f8449)
* application-changerequest-ui/src/main/resources/ChangeRequest/Code

  + application-changerequest-ui/src/main/resources/ChangeRequest/Code/EditPageUIX.xml
    [EditPageUIX.xml](#diff-bc99fa78cecdb335d94995c618e30fe538288eb9bcaf5dd7ae796b0f7e0b670c)
  + application-changerequest-ui/src/main/resources/ChangeRequest/Code/SaveButtonsUIX.xml
    [SaveButtonsUIX.xml](#diff-97124d1048a405c30d830f09ba628a7a18aefe351a00d53421da5069b7c69a74)

## There are no files selected for viewing

29 changes: 29 additions & 0 deletions

29
[...request-api/src/main/java/org/xwiki/contrib/changerequest/ChangeRequestRightsManager.java](#diff-506a767feaef89f007733f67fa7a1907798908a4dcf9e8e74d1734b7b1902516 "application-changerequest-api/src/main/java/org/xwiki/contrib/changerequest/ChangeRequestRightsManager.java")

Show comments

[View file](/xwiki-contrib/application-changerequest/blob/ff0f5368ea04f0e4aa7b33821c707dc68a8c5ca8/application-changerequest-api/src/main/java/org/xwiki/contrib/changerequest/ChangeRequestRightsManager.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -201,4 +201,33 @@ default boolean isAuthorizedToSplit(UserReference userReference, ChangeRequest c |
|  |  | { |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Check if the given user is allowed to use change request to edit the given document reference. |
|  |  | \* @param userReference the user for whom to perform the check |
|  |  | \* @param documentReference the reference for which to check authorization |
|  |  | \* @return {@code true} if the given user is allowed to perform the edition with change request |
|  |  | \* @throws ChangeRequestException in case of problem when performing the check |
|  |  | \* @since 1.10 |
|  |  | \*/ |
|  |  | default boolean isEditWithChangeRequestAllowed(UserReference userReference, DocumentReference documentReference) |
|  |  | throws ChangeRequestException |
|  |  | { |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Check if the given user is allowed to use change request to create a document having the given reference for |
|  |  | \* parent. |
|  |  | \* @param userReference the user for whom to perform the check |
|  |  | \* @param parentSpaceReference the parent space where the new document would be created |
|  |  | \* @return {@code true} if the given user is allowed to create a document with change request at the given place |
|  |  | \* @throws ChangeRequestException in case of problem when performing the check |
|  |  | \* @since 1.10 |
|  |  | \*/ |
|  |  | default boolean isCreateWithChangeRequestAllowed(UserReference userReference, |
|  |  | DocumentReference parentSpaceReference) throws ChangeRequestException |
|  |  | { |
|  |  | return false; |
|  |  | } |
|  |  | } |

1 change: 1 addition & 0 deletions

1
[application-changerequest-default/src/checkstyle/checkstyle-suppressions.xml](#diff-f7a962fa4fb42c3e3dbf933d9e3e22afb550f4089da44eb2695f405bfac3f9cb "application-changerequest-default/src/checkstyle/checkstyle-suppressions.xml")

Show comments

[View file](/xwiki-contrib/application-changerequest/blob/ff0f5368ea04f0e4aa7b33821c707dc68a8c5ca8/application-changerequest-default/src/checkstyle/checkstyle-suppressions.xml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -53,4 +53,5 @@ |
|  |  | <suppress checks="ClassFanOutComplexity" files="ChangeRequestScriptService.java"/> |
|  |  | <suppress checks="ClassFanOutComplexity" files="ChangeRequestResourceHandler.java"/> |
|  |  | <suppress checks="CyclomaticComplexity" files="RightsUpdatedListener.java"/> |
|  |  | <suppress checks="CyclomaticComplexity" files="AbstractChangeRequestActionHandler.java"/> |
|  |  | </suppressions> |

73 changes: 73 additions & 0 deletions

73
[...main/java/org/xwiki/contrib/changerequest/internal/DefaultChangeRequestRightsManager.java](#diff-acff9208e3a7581131c99d380ded940d74e48940bdb2a8854222cbdc5b127832 "application-changerequest-default/src/main/java/org/xwiki/contrib/changerequest/internal/DefaultChangeRequestRightsManager.java")

Show comments

[View file](/xwiki-contrib/application-changerequest/blob/ff0f5368ea04f0e4aa7b33821c707dc68a8c5ca8/application-changerequest-default/src/main/java/org/xwiki/contrib/changerequest/internal/DefaultChangeRequestRightsManager.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -20,14 +20,18 @@ |
|  |  | package org.xwiki.contrib.changerequest.internal; |
|  |  |  |
|  |  | import java.util.ArrayList; |
|  |  | import java.util.Collection; |
|  |  | import java.util.Collections; |
|  |  | import java.util.HashMap; |
|  |  | import java.util.HashSet; |
|  |  | import java.util.List; |
|  |  | import java.util.Map; |
|  |  | import java.util.Objects; |
|  |  | import java.util.Optional; |
|  |  | import java.util.Set; |
|  |  |  |
|  |  | import javax.inject.Inject; |
|  |  | import javax.inject.Provider; |
|  |  | import javax.inject.Singleton; |
|  |  |  |
|  |  | import org.xwiki.component.annotation.Component; |
| Expand All | | @@ -40,6 +44,7 @@ |
|  |  | import org.xwiki.contrib.changerequest.DelegateApproverManager; |
|  |  | import org.xwiki.contrib.changerequest.FileChange; |
|  |  | import org.xwiki.contrib.changerequest.rights.ChangeRequestApproveRight; |
|  |  | import org.xwiki.contrib.changerequest.rights.ChangeRequestRight; |
|  |  | import org.xwiki.contrib.rights.RightsReader; |
|  |  | import org.xwiki.contrib.rights.RightsWriter; |
|  |  | import org.xwiki.contrib.rights.SecurityRuleAbacus; |
| Expand All | | @@ -59,7 +64,12 @@ |
|  |  | import org.xwiki.user.GuestUserReference; |
|  |  | import org.xwiki.user.UserReference; |
|  |  |  |
|  |  | import com.xpn.xwiki.XWikiContext; |
|  |  | import com.xpn.xwiki.XWikiException; |
|  |  | import com.xpn.xwiki.doc.XWikiDocument; |
|  |  | import com.xpn.xwiki.objects.BaseObject; |
|  |  | import com.xpn.xwiki.objects.classes.PasswordClass; |
|  |  | import com.xpn.xwiki.objects.classes.PropertyClass; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Component in charge of performing right synchronization operations. |
| Expand Down  Expand Up | | @@ -98,6 +108,9 @@ public class DefaultChangeRequestRightsManager implements ChangeRequestRightsMan |
|  |  | @Inject |
|  |  | private ChangeRequestConfiguration configuration; |
|  |  |  |
|  |  | @Inject |
|  |  | private Provider<XWikiContext> contextProvider; |
|  |  |  |
|  |  | @Override |
|  |  | public void copyAllButViewRights(ChangeRequest originalChangeRequest, ChangeRequest targetChangeRequest) |
|  |  | throws ChangeRequestException |
| Expand Down  Expand Up | | @@ -618,4 +631,64 @@ public boolean isAuthorizedToSplit(UserReference userReference, ChangeRequest ch |
|  |  | } |
|  |  | return result; |
|  |  | } |
|  |  |  |
|  |  | @Override |
|  |  | public boolean isEditWithChangeRequestAllowed(UserReference userReference, DocumentReference documentReference) |
|  |  | throws ChangeRequestException |
|  |  | { |
|  |  | DocumentReference userDocReference = this.userReferenceConverter.convert(userReference); |
|  |  | boolean hasCREdit = this.authorizationManager.hasAccess(ChangeRequestRight.getRight(), userDocReference, |
|  |  | documentReference); |
|  |  | boolean result = false; |
|  |  | // if the user doesn't have CR edit right, then it's already solved. |
|  |  | if (hasCREdit) { |
|  |  | XWikiContext context = this.contextProvider.get(); |
|  |  | try { |
|  |  | XWikiDocument document = context.getWiki().getDocument(documentReference, context); |
|  |  | // if it's a new document, we don't care |
|  |  | if (document.isNew()) { |
|  |  | result = true; |
|  |  | } else { |
|  |  | Map<DocumentReference, List<BaseObject>> objects = document.getXObjects(); |
|  |  | boolean foundOneObjectWithPassword = false; |
|  |  | for (Map.Entry<DocumentReference, List<BaseObject>> objectsEntry : objects.entrySet()) { |
|  |  | Optional<BaseObject> baseObjectOpt = |
|  |  | objectsEntry.getValue().stream().filter(Objects::nonNull).findFirst(); |
|  |  | if (baseObjectOpt.isPresent() && this.isObjectContainingPassword(baseObjectOpt.get())) { |
|  |  | foundOneObjectWithPassword = true; |
|  |  | break; |
|  |  | } |
|  |  | } |
|  |  | if (!foundOneObjectWithPassword) { |
|  |  | result = true; |
|  |  | } |
|  |  | } |
|  |  | } catch (XWikiException e) { |
|  |  | throw new ChangeRequestException(String.format("Cannot load document [%s] to check if CR right should " |
|  |  | + "be granted for user [%s]", documentReference, userDocReference), e); |
|  |  | } |
|  |  | } |
|  |  | return result; |
|  |  | } |
|  |  |  |
|  |  | @Override |
|  |  | public boolean isCreateWithChangeRequestAllowed(UserReference userReference, DocumentReference parentSpaceReference) |
|  |  | throws ChangeRequestException |
|  |  | { |
|  |  | DocumentReference userDocReference = this.userReferenceConverter.convert(userReference); |
|  |  | return this.authorizationManager.hasAccess(ChangeRequestRight.getRight(), userDocReference, |
|  |  | parentSpaceReference); |
|  |  | } |
|  |  |  |
|  |  | private boolean isObjectContainingPassword(BaseObject baseObject) |
|  |  | { |
|  |  | XWikiContext context = contextProvider.get(); |
|  |  | Collection<PropertyClass> propertyClassCollection = baseObject.getXClass(context).getFieldList(); |
|  |  | for (PropertyClass propertyClass : propertyClassCollection) { |
|  |  | if (propertyClass instanceof PasswordClass) { |
|  |  | return true; |
|  |  | } |
|  |  | } |
|  |  | return false; |
|  |  | } |
|  |  | } |

6 changes: 6 additions & 0 deletions

6
[...org/xwiki/contrib/changerequest/internal/handlers/AbstractChangeRequestActionHandler.java](#diff-da1862a7267879e108cd7933f46e4593f1dac0072cfc64dd928fe90a2004c562 "application-changerequest-default/src/main/java/org/xwiki/contrib/changerequest/internal/handlers/AbstractChangeRequestActionHandler.java")

Show comments

[View file](/xwiki-contrib/application-changerequest/blob/ff0f5368ea04f0e4aa7b33821c707dc68a8c5ca8/application-changerequest-default/src/main/java/org/xwiki/contrib/changerequest/internal/handlers/AbstractChangeRequestActionHandler.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -202,6 +202,12 @@ protected XWikiDocument prepareDocument(HttpServletRequest request, EditForm edi |
|  |  | XWikiContext context = this.contextProvider.get(); |
|  |  | String serializedDocReference = request.getParameter("docReference"); |
|  |  | DocumentReference documentReference = this.documentReferenceResolver.resolve(serializedDocReference); |
|  |  | UserReference currentUserReference = this.currentUserReferenceResolver.resolve(CurrentUserReference.INSTANCE); |
|  |  | if (!this.changeRequestRightsManager.isEditWithChangeRequestAllowed(currentUserReference, documentReference)) { |
|  |  | throw new ChangeRequestException( |
|  |  | String.format("User [%s] is not allowed to edit the document [%s] through a change request.", |
|  |  | currentUserReference, documentReference)); |
|  |  | } |
|  |  |  |
|  |  | XWikiDocument modifiedDocument = null; |
|  |  | try { |
| Expand Down | |  |

29 changes: 29 additions & 0 deletions

29
[.../java/org/xwiki/contrib/changerequest/script/ChangeRequestAuthorizationScriptService.java](#diff-78e1871f3781142d0ca0df00f0b2186942024af3c9fce8ce318e84651ddbd876 "application-changerequest-default/src/main/java/org/xwiki/contrib/changerequest/script/ChangeRequestAuthorizationScriptService.java")

Show comments

[View file](/xwiki-contrib/application-changerequest/blob/ff0f5368ea04f0e4aa7b33821c707dc68a8c5ca8/application-changerequest-default/src/main/java/org/xwiki/contrib/changerequest/script/ChangeRequestAuthorizationScriptService.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -242,4 +242,33 @@ public boolean isAuthorizedToSplit(ChangeRequest changeRequest) |
|  |  | UserReference currentUserReference = this.currentUserReferenceResolver.resolve(CurrentUserReference.INSTANCE); |
|  |  | return this.changeRequestRightsManager.isAuthorizedToSplit(currentUserReference, changeRequest); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Check if the current user is allowed to use change request to edit the given document reference. |
|  |  | \* @param documentReference the reference for which to check authorization |
|  |  | \* @return {@code true} if current user is allowed to perform the edition with change request |
|  |  | \* @throws ChangeRequestException in case of problem when performing the checks |
|  |  | \* @since 1.10 |
|  |  | \*/ |
|  |  | public boolean isEditWithChangeRequestAllowed(DocumentReference documentReference) throws ChangeRequestException |
|  |  | { |
|  |  | UserReference currentUserReference = this.currentUserReferenceResolver.resolve(CurrentUserReference.INSTANCE); |
|  |  | return this.changeRequestRightsManager.isEditWithChangeRequestAllowed(currentUserReference, documentReference); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Check if the current user is allowed to use change request to create a document having the given reference for |
|  |  | \* parent. |
|  |  | \* @param parentSpaceReference the parent space where the new document would be created |
|  |  | \* @return {@code true} if current user is allowed to create a document with change request at the given place |
|  |  | \* @throws ChangeRequestException in case of problem when performing the checks |
|  |  | \* @since 1.10 |
|  |  | \*/ |
|  |  | public boolean isCreateWithChangeRequestAllowed(DocumentReference parentSpaceReference) |
|  |  | throws ChangeRequestException |
|  |  | { |
|  |  | UserReference currentUserReference = this.currentUserReferenceResolver.resolve(CurrentUserReference.INSTANCE); |
|  |  | return this.changeRequestRightsManager.isCreateWithChangeRequestAllowed(currentUserReference, |
|  |  | parentSpaceReference); |
|  |  | } |
|  |  | } |

103 changes: 103 additions & 0 deletions

103
[.../java/org/xwiki/contrib/changerequest/internal/DefaultChangeRequestRightsManagerTest.java](#diff-acf75fbbacb2ef63639f0ba3ab7fcd62846e888cd794f8b194ffe34c7b86b9e3 "application-changerequest-default/src/test/java/org/xwiki/contrib/changerequest/internal/DefaultChangeRequestRightsManagerTest.java")

Show comments

[View file](/xwiki-contrib/application-changerequest/blob/ff0f5368ea04f0e4aa7b33821c707dc68a8c5ca8/application-changerequest-default/src/test/java/org/xwiki/contrib/changerequest/internal/DefaultChangeRequestRightsManagerTest.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -23,12 +23,15 @@ |
|  |  | import java.util.Arrays; |
|  |  | import java.util.Collections; |
|  |  | import java.util.HashSet; |
|  |  | import java.util.LinkedHashMap; |
|  |  | import java.util.List; |
|  |  | import java.util.Map; |
|  |  | import java.util.Set; |
|  |  | import java.util.stream.Collectors; |
|  |  | import java.util.stream.Stream; |
|  |  |  |
|  |  | import javax.inject.Inject; |
|  |  | import javax.inject.Provider; |
|  |  |  |
|  |  | import org.junit.jupiter.api.Test; |
|  |  | import org.xwiki.contrib.changerequest.ApproversManager; |
| Expand All | | @@ -39,6 +42,7 @@ |
|  |  | import org.xwiki.contrib.changerequest.DelegateApproverManager; |
|  |  | import org.xwiki.contrib.changerequest.FileChange; |
|  |  | import org.xwiki.contrib.changerequest.internal.approvers.ChangeRequestApproversManager; |
|  |  | import org.xwiki.contrib.changerequest.rights.ChangeRequestRight; |
|  |  | import org.xwiki.contrib.rights.RightsReader; |
|  |  | import org.xwiki.contrib.rights.RightsWriter; |
|  |  | import org.xwiki.contrib.rights.SecurityRuleAbacus; |
| Expand All | | @@ -61,7 +65,14 @@ |
|  |  | import org.xwiki.user.GuestUserReference; |
|  |  | import org.xwiki.user.UserReference; |
|  |  |  |
|  |  | import com.xpn.xwiki.XWiki; |
|  |  | import com.xpn.xwiki.XWikiContext; |
|  |  | import com.xpn.xwiki.XWikiException; |
|  |  | import com.xpn.xwiki.doc.XWikiDocument; |
|  |  | import com.xpn.xwiki.objects.BaseObject; |
|  |  | import com.xpn.xwiki.objects.classes.BaseClass; |
|  |  | import com.xpn.xwiki.objects.classes.PasswordClass; |
|  |  | import com.xpn.xwiki.objects.classes.PropertyClass; |
|  |  |  |
|  |  | import static org.junit.jupiter.api.Assertions.assertFalse; |
|  |  | import static org.junit.jupiter.api.Assertions.assertTrue; |
| Expand All | | @@ -70,6 +81,7 @@ |
|  |  | import static org.mockito.Mockito.doAnswer; |
|  |  | import static org.mockito.Mockito.mock; |
|  |  | import static org.mockito.Mockito.never; |
|  |  | import static org.mockito.Mockito.times; |
|  |  | import static org.mockito.Mockito.verify; |
|  |  | import static org.mockito.Mockito.verifyNoInteractions; |
|  |  | import static org.mockito.Mockito.when; |
| Expand Down  Expand Up | | @@ -113,6 +125,9 @@ class DefaultChangeRequestRightsManagerTest |
|  |  | @MockComponent |
|  |  | private DelegateApproverManager<ChangeRequest> changeRequestDelegateApproverManager; |
|  |  |  |
|  |  | @MockComponent |
|  |  | private Provider<XWikiContext> contextProvider; |
|  |  |  |
|  |  | @Test |
|  |  | void copyAllButViewRights() throws AuthorizationException, ChangeRequestException, XWikiException |
|  |  | { |
| Expand Down  Expand Up | | @@ -867,4 +882,92 @@ void isAuthorizedToComment() throws ChangeRequestException |
|  |  | when(this.changeRequestApproversManager.isApprover(userReference, changeRequest, false)).thenReturn(false); |
|  |  | assertFalse(this.rightsManager.isAuthorizedToComment(userReference, changeRequest)); |
|  |  | } |
|  |  |  |
|  |  | @Test |
|  |  | void isCreateWithChangeRequestAllowed() throws ChangeRequestException |
|  |  | { |
|  |  | Right crRight = ChangeRequestRight.getRight(); |
|  |  | UserReference userReference = mock(UserReference.class); |
|  |  | DocumentReference userDocReference = mock(DocumentReference.class); |
|  |  | DocumentReference parentSpaceReference = mock(DocumentReference.class); |
|  |  |  |
|  |  | when(this.userReferenceConverter.convert(userReference)).thenReturn(userDocReference); |
|  |  | when(this.authorizationManager.hasAccess(crRight, userDocReference, parentSpaceReference)).thenReturn(true); |
|  |  | assertTrue(this.rightsManager.isCreateWithChangeRequestAllowed(userReference, parentSpaceReference)); |
|  |  |  |
|  |  | verify(this.authorizationManager).hasAccess(crRight, userDocReference, parentSpaceReference); |
|  |  | } |
|  |  |  |
|  |  | @Test |
|  |  | void isEditWithChangeRequestAllowed() throws ChangeRequestException, XWikiException |
|  |  | { |
|  |  | Right crRight = ChangeRequestRight.getRight(); |
|  |  | UserReference userReference = mock(UserReference.class); |
|  |  | DocumentReference userDocReference = mock(DocumentReference.class); |
|  |  | DocumentReference documentReference = mock(DocumentReference.class); |
|  |  | XWikiDocument document = mock(XWikiDocument.class); |
|  |  | XWiki wiki = mock(XWiki.class); |
|  |  | XWikiContext context = mock(XWikiContext.class); |
|  |  |  |
|  |  | when(this.userReferenceConverter.convert(userReference)).thenReturn(userDocReference); |
|  |  | when(this.contextProvider.get()).thenReturn(context); |
|  |  | when(context.getWiki()).thenReturn(wiki); |
|  |  | when(wiki.getDocument(documentReference, context)).thenReturn(document); |
|  |  | when(this.authorizationManager.hasAccess(crRight, userDocReference, documentReference)).thenReturn(false); |
|  |  |  |
|  |  | assertFalse(this.rightsManager.isEditWithChangeRequestAllowed(userReference, documentReference)); |
|  |  |  |
|  |  | verify(this.authorizationManager).hasAccess(crRight, userDocReference, documentReference); |
|  |  | verifyNoInteractions(document); |
|  |  |  |
|  |  | when(this.authorizationManager.hasAccess(crRight, userDocReference, documentReference)).thenReturn(true); |
|  |  | when(document.isNew()).thenReturn(true); |
|  |  | assertTrue(this.rightsManager.isEditWithChangeRequestAllowed(userReference, documentReference)); |
|  |  |  |
|  |  | verify(this.authorizationManager, times(2)).hasAccess(crRight, userDocReference, documentReference); |
|  |  |  |
|  |  | when(document.isNew()).thenReturn(false); |
|  |  |  |
|  |  | DocumentReference objReference1 = mock(DocumentReference.class); |
|  |  | DocumentReference objReference2 = mock(DocumentReference.class); |
|  |  |  |
|  |  | BaseObject baseObject1 = mock(BaseObject.class); |
|  |  | BaseObject baseObject2 = mock(BaseObject.class); |
|  |  | BaseObject baseObject3 = mock(BaseObject.class); |
|  |  |  |
|  |  | List<BaseObject> baseObjectList1 = Arrays.asList(null, baseObject1); |
|  |  | List<BaseObject> baseObjectList2 = Arrays.asList(null, baseObject2, baseObject3); |
|  |  |  |
|  |  | Map<DocumentReference, List<BaseObject>> objectMap = new LinkedHashMap<>(); |
|  |  | objectMap.put(objReference1, baseObjectList1); |
|  |  | objectMap.put(objReference2, baseObjectList2); |
|  |  |  |
|  |  | when(document.getXObjects()).thenReturn(objectMap); |
|  |  | BaseClass class1 = mock(BaseClass.class); |
|  |  | List<PropertyClass> propertyClasses = List.of(mock(PropertyClass.class), mock(PropertyClass.class), |
|  |  | mock(PasswordClass.class)); |
|  |  | when(class1.getFieldList()).thenReturn(propertyClasses); |
|  |  | when(baseObject1.getXClass(context)).thenReturn(class1); |
|  |  |  |
|  |  | assertFalse(this.rightsManager.isEditWithChangeRequestAllowed(userReference, documentReference)); |
|  |  | verify(baseObject1).getXClass(context); |
|  |  | verifyNoInteractions(baseObject2); |
|  |  | verifyNoInteractions(baseObject3); |
|  |  |  |
|  |  | when(class1.getFieldList()).thenReturn(List.of(mock(PropertyClass.class))); |
|  |  | BaseClass class2 = mock(BaseClass.class); |
|  |  | when(class2.getFieldList()).thenReturn(List.of(mock(PasswordClass.class))); |
|  |  | when(baseObject2.getXClass(context)).thenReturn(class2); |
|  |  |  |
|  |  | assertFalse(this.rightsManager.isEditWithChangeRequestAllowed(userReference, documentReference)); |
|  |  | verify(baseObject1, times(2)).getXClass(context); |
|  |  | verify(baseObject2).getXClass(context); |
|  |  | verifyNoInteractions(baseObject3); |
|  |  |  |
|  |  | when(class2.getFieldList()).thenReturn(List.of()); |
|  |  | assertTrue(this.rightsManager.isEditWithChangeRequestAllowed(userReference, documentReference)); |
|  |  | verify(baseObject1, times(3)).getXClass(context); |
|  |  | verify(baseObject2, times(2)).getXClass(context); |
|  |  | verifyNoInteractions(baseObject3); |
|  |  | } |
|  |  | } |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `ff0f536`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxwiki-contrib%2Fapplication-changerequest%2Fcommit%2Fff0f5368ea04f0e4aa7b33821c707dc68a8c5ca8) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


