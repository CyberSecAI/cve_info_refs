=== Content from github.com_d32cea30_20250114_194816.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkoajs%2Fcors%2Fcommit%2Ff31dac99f5355c41e7d4dd3c4a80c5f154941a11)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkoajs%2Fcors%2Fcommit%2Ff31dac99f5355c41e7d4dd3c4a80c5f154941a11)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=koajs%2Fcors)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[koajs](/koajs)
/
**[cors](/koajs/cors)**
Public

* [Notifications](/login?return_to=%2Fkoajs%2Fcors) You must be signed in to change notification settings
* [Fork
  80](/login?return_to=%2Fkoajs%2Fcors)
* [Star
   737](/login?return_to=%2Fkoajs%2Fcors)

* [Code](/koajs/cors)
* [Issues
  15](/koajs/cors/issues)
* [Pull requests
  7](/koajs/cors/pulls)
* [Actions](/koajs/cors/actions)
* [Security](/koajs/cors/security)
* [Insights](/koajs/cors/pulse)

Additional navigation options

* [Code](/koajs/cors)
* [Issues](/koajs/cors/issues)
* [Pull requests](/koajs/cors/pulls)
* [Actions](/koajs/cors/actions)
* [Security](/koajs/cors/security)
* [Insights](/koajs/cors/pulse)

## Commit

[Permalink](/koajs/cors/commit/f31dac99f5355c41e7d4dd3c4a80c5f154941a11)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-qxrj-hx23-xp82](https://github.com/advisories/GHSA-qxrj-hx23-xp82 "GHSA-qxrj-hx23-xp82")

[Browse files](/koajs/cors/tree/f31dac99f5355c41e7d4dd3c4a80c5f154941a11)
Browse the repository at this point in the history

```
This is a security update for the Same Origin Policy (SOP),
and also a BREAKING CHANGE.

closes [GHSA-qxrj-hx23-xp82](https://github.com/koajs/cors/security/advisories/GHSA-qxrj-hx23-xp82 "GHSA-qxrj-hx23-xp82")
```

* Loading branch information

[![@fengmk2](https://avatars.githubusercontent.com/u/156269?s=40&v=4)](/fengmk2)

[fengmk2](/koajs/cors/commits?author=fengmk2 "View all commits by fengmk2")
authored
Dec 11, 2023

1 parent
[0f3f948](/koajs/cors/commit/0f3f948b9b8f00163a47de1b82e413bfef9b4a96)

commit f31dac9

 Show file tree

 Hide file tree

Showing
**5 changed files**
with
**83 additions**
and
**26 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* .github/workflows

  + .github/workflows/nodejs.yml
    [nodejs.yml](#diff-e98936aa52a6dd7416e4296e9628456227d834f7245967383fd9ff80fd985dad)
* README.md
  [README.md](#diff-b335630551682c19a781afebcf4d07bf978fb1f8ac04c6bf87428ed5106870f5)
* index.js
  [index.js](#diff-e727e4bdf3657fd1d798edcd6b099d6e092f8573cba266154583a746bba0f346)
* package.json
  [package.json](#diff-7ae45ad102eab3b6d7e7896acd08c427a9b25b346470d7bc6507b6481575d519)
* test

  + test/cors.test.js
    [cors.test.js](#diff-7e8432240545435eb52c9516382d3fefe577b50690417c0f097cca597f1eaecf)

## There are no files selected for viewing

4 changes: 1 addition & 3 deletions

4
[.github/workflows/nodejs.yml](#diff-e98936aa52a6dd7416e4296e9628456227d834f7245967383fd9ff80fd985dad ".github/workflows/nodejs.yml")

Show comments

[View file](/koajs/cors/blob/f31dac99f5355c41e7d4dd3c4a80c5f154941a11/.github/workflows/nodejs.yml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -12,8 +12,6 @@ on: |
|  |  | branches: |
|  |  | - main |
|  |  | - master |
|  |  | schedule: |
|  |  | - cron: '0 2 \* \* \*' |
|  |  |  |
|  |  | jobs: |
|  |  | build: |
| Expand All | | @@ -22,7 +20,7 @@ jobs: |
|  |  | strategy: |
|  |  | fail-fast: false |
|  |  | matrix: |
|  |  | node-version: [14, 16, 18] |
|  |  | node-version: [14, 16, 18, 20] |
|  |  | os: [ubuntu-latest] |
|  |  |  |
|  |  | steps: |
| Expand Down | |  |

18 changes: 15 additions & 3 deletions

18
[README.md](#diff-b335630551682c19a781afebcf4d07bf978fb1f8ac04c6bf87428ed5106870f5 "README.md")

Show comments

[View file](/koajs/cors/blob/f31dac99f5355c41e7d4dd3c4a80c5f154941a11/README.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -1,5 +1,4 @@ |
|  |  | @koa/cors |
|  |  | ======= |
|  |  | # @koa/cors |
|  |  |  |
|  |  | [![NPM version][npm-image]][npm-url] |
|  |  | [![Node.js CI](https://github.com/koajs/cors/actions/workflows/nodejs.yml/badge.svg)](https://github.com/koajs/cors/actions/workflows/nodejs.yml) |
| Expand Down  Expand Up | | @@ -43,7 +42,8 @@ app.use(cors()); |
|  |  | \* CORS middleware |
|  |  | \* |
|  |  | \* @param {Object} [options] |
|  |  | \* - {String|Function(ctx)} origin `Access-Control-Allow-Origin`, default is request Origin header |
|  |  | \* - {String|Function(ctx)} origin `Access-Control-Allow-Origin`, default is '\*' |
|  |  | \* If `credentials` set and return `true, the `origin` default value will set to the request `Origin` header |
|  |  | \* - {String|Array} allowMethods `Access-Control-Allow-Methods`, default is 'GET,HEAD,PUT,POST,DELETE,PATCH' |
|  |  | \* - {String|Array} exposeHeaders `Access-Control-Expose-Headers` |
|  |  | \* - {String|Array} allowHeaders `Access-Control-Allow-Headers` |
| Expand All | | @@ -57,6 +57,18 @@ app.use(cors()); |
|  |  | \*/ |
|  |  | ``` |
|  |  |  |
|  |  | ## Breaking change between 5.0 and 4.0 |
|  |  |  |
|  |  | The default `origin` is set to `\*`, if you want to keep the 4.0 behavior, you can set the `origin` handler like this: |
|  |  |  |
|  |  | ```js |
|  |  | app.use(cors({ |
|  |  | origin(ctx) { |
|  |  | return ctx.get('Origin') || '\*'; |
|  |  | }, |
|  |  | })); |
|  |  | ``` |
|  |  |  |
|  |  | ## License |
|  |  |  |
|  |  | [MIT](./LICENSE) |
| Expand Down | |  |

11 changes: 6 additions & 5 deletions

11
[index.js](#diff-e727e4bdf3657fd1d798edcd6b099d6e092f8573cba266154583a746bba0f346 "index.js")

Show comments

[View file](/koajs/cors/blob/f31dac99f5355c41e7d4dd3c4a80c5f154941a11/index.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,12 +1,11 @@ |
|  |  | 'use strict'; |
|  |  |  |
|  |  | const vary = require('vary'); |
|  |  |  |
|  |  | /\*\* |
|  |  | \* CORS middleware |
|  |  | \* |
|  |  | \* @param {Object} [options] |
|  |  | \* - {String|Function(ctx)} origin `Access-Control-Allow-Origin`, default is request Origin header |
|  |  | \* - {String|Function(ctx)} origin `Access-Control-Allow-Origin`, default is '\*' |
|  |  | \* If `credentials` set and return `true, the `origin` default value will set to the request `Origin` header |
|  |  | \* - {String|Array} allowMethods `Access-Control-Allow-Methods`, default is 'GET,HEAD,PUT,POST,DELETE,PATCH' |
|  |  | \* - {String|Array} exposeHeaders `Access-Control-Expose-Headers` |
|  |  | \* - {String|Array} allowHeaders `Access-Control-Allow-Headers` |
| Expand Down  Expand Up | | @@ -61,9 +60,11 @@ module.exports = function(options) { |
|  |  | let origin; |
|  |  | if (typeof options.origin === 'function') { |
|  |  | origin = await options.origin(ctx); |
|  |  | if (!origin) return await next(); |
|  |  | if (!origin) { |
|  |  | return await next(); |
|  |  | } |
|  |  | } else { |
|  |  | origin = options.origin || requestOrigin; |
|  |  | origin = options.origin || '\*'; |
| This comment has been minimized. [Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Fkoajs%2Fcors%2Fcommit%2Ff31dac99f5355c41e7d4dd3c4a80c5f154941a11)       Sorry, something went wrong.           Copy link    Quote reply     @julienw **[julienw](/julienw)** [Dec 12, 2023](#r134778913) • edited      Loading      Contributor   I'm puzzled because I don't see how this fixes the security advisory. Indeed `'*'` means `any origin`, so this is essentially the same behavior as before. Unless I'm missing something.  I believe the advisory author would prefer that this behavior is explicit, that is as a user of the library I should specify `"*"` explicitely in the `origin` parameter.  (I would myself be happy enough with just a stronger emphasis in the doc)      All reactions          This comment has been minimized. [Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Fkoajs%2Fcors%2Fcommit%2Ff31dac99f5355c41e7d4dd3c4a80c5f154941a11)       Sorry, something went wrong.           Copy link    Quote reply     @julienw **[julienw](/julienw)** [Dec 12, 2023](#r134779391) Contributor   It looks like there *is* a different behavior related to cookies, but my understanding is that it's not the subject of the advisory.      All reactions          This comment has been minimized. [Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Fkoajs%2Fcors%2Fcommit%2Ff31dac99f5355c41e7d4dd3c4a80c5f154941a11)       Sorry, something went wrong.           Copy link    Quote reply     @fengmk2 **[fengmk2](/fengmk2)** [Dec 12, 2023](#r134779517) Author  Member   Turning on this middleware means that cors will be turned on by default and return `*`.  You are more than welcome to contribute to documentation improvements :)      All reactions          This comment has been minimized. [Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Fkoajs%2Fcors%2Fcommit%2Ff31dac99f5355c41e7d4dd3c4a80c5f154941a11)       Sorry, something went wrong.           Copy link    Quote reply     @julienw **[julienw](/julienw)** [Dec 12, 2023](#r134788921) Contributor   That's what I mean: this doesn't address the concerns in the security advisory, to quote it: "This behavior completely disables one of the most crucial elements of browsers - the Same Origin Policy (SOP), this could cause a very serious security threat to the users of this middleware."  (again, I don't necessarily agree with it, I think users should already know the implications when they enable it)      All reactions          This comment has been minimized. [Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Fkoajs%2Fcors%2Fcommit%2Ff31dac99f5355c41e7d4dd3c4a80c5f154941a11)       Sorry, something went wrong.           Copy link    Quote reply     @julienw **[julienw](/julienw)** [Dec 12, 2023](#r134791129) Contributor   I made [#91](https://github.com/koajs/cors/pull/91) to update the documentation, tell me what you think :-)      All reactions          This comment has been minimized. [Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Fkoajs%2Fcors%2Fcommit%2Ff31dac99f5355c41e7d4dd3c4a80c5f154941a11)       Sorry, something went wrong.           Copy link    Quote reply     @Beace **[Beace](/Beace)** [Dec 12, 2023](#r134798534)  [@fengmk2](https://github.com/fengmk2) [@julienw](https://github.com/julienw) I actually have a similar question, if `credentials` is `true`, the behavior before and after this change is consistent. Because no matter what the `origin` is, it will be set as `requestOrigin`. But it is crucial for `credentials` to be true. I don't understand the significance of this change.      All reactions          This comment has been minimized. [Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Fkoajs%2Fcors%2Fcommit%2Ff31dac99f5355c41e7d4dd3c4a80c5f154941a11)       Sorry, something went wrong.           Copy link    Quote reply     @fengmk2 **[fengmk2](/fengmk2)** [Dec 13, 2023](#r134849700) Author  Member   [@Beace](https://github.com/Beace) This modification is to ensure that the default configuration is the lowest risk. Setting `credentials` is the expected behavior of developers who explicitly want to return `requestOrigin`. The previous default configuration returned `requestOrigin`, which was very risky.     👍 1  Beace reacted with thumbs up emoji   All reactions  * 👍   1 reaction         This comment has been minimized. [Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Fkoajs%2Fcors%2Fcommit%2Ff31dac99f5355c41e7d4dd3c4a80c5f154941a11)       Sorry, something went wrong.           Copy link    Quote reply     @julienw **[julienw](/julienw)** [Jan 4, 2024](#r136196219) Contributor   Can you please elaborate on the risks you're mentioning when you write "lowest risk" and "risky"?  Here is my understanding:   * without CORS, the `same-origin` policy prevents webpage from doing requests to servers with another origin. (except `<script>` and friends) * with CORS, a server can define which webpages can do requests to this server (and methods, etc) * returning `requestOrigin` or `*` is basically identical (any webpage can do a request) except for one point: credentials (cookies and other similar things): requests need to be made without credentials <https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS/Errors/CORSNotSupportingCredentials> * My understanding is that without `credentials`, `Access-Control-Allow-Credentials` wasn't set before, so credentials were *already* rejected with the previous version, even when returning `requestOrigin`. Therefore I think that the change doesn't change anything in practice. * Therefore I don't see that the current situation is "the lowest risk". The lowest risk would be to make the option `origin` mandatory, and do not add the header if it's not present.   Note that the [advisory](https://github.com/koajs/cors/security/advisories/GHSA-qxrj-hx23-xp82) doesn't say anything about cookies or credentials, but instead about the fact that the middleware is configured by default to allow all origins. This change doesn't change that!  Please tell me if I missed anything :-)     👍 2  alecmev and theJC reacted with thumbs up emoji   All reactions  * 👍   2 reactions         This comment has been minimized. [Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Fkoajs%2Fcors%2Fcommit%2Ff31dac99f5355c41e7d4dd3c4a80c5f154941a11)       Sorry, something went wrong.           Copy link    Quote reply     @prabhu **[prabhu](/prabhu)** [Jan 25, 2024](#r137759437)  #PointlessCVE      All reactions | | |
|  |  | } |
|  |  |  |
|  |  | let credentials; |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[package.json](#diff-7ae45ad102eab3b6d7e7896acd08c427a9b25b346470d7bc6507b6481575d519 "package.json")

Show comments

[View file](/koajs/cors/blob/f31dac99f5355c41e7d4dd3c4a80c5f154941a11/package.json)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -46,7 +46,7 @@ |
|  |  | "node": ">= 14.0.0" |
|  |  | }, |
|  |  | "ci": { |
|  |  | "version": "14, 16, 18", |
|  |  | "version": "14, 16, 18, 20", |
|  |  | "os": "linux" |
|  |  | }, |
|  |  | "author": "fengmk2 <fengmk2@gmail.com> (http://github.com/fengmk2)", |
| Expand Down | |  |

74 changes: 60 additions & 14 deletions

74
[test/cors.test.js](#diff-7e8432240545435eb52c9516382d3fefe577b50690417c0f097cca597f1eaecf "test/cors.test.js")

Show comments

[View file](/koajs/cors/blob/f31dac99f5355c41e7d4dd3c4a80c5f154941a11/test/cors.test.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,5 +1,3 @@ |
|  |  | 'use strict'; |
|  |  |  |
|  |  | const assert = require('assert'); |
|  |  | const Koa = require('koa'); |
|  |  | const request = require('supertest'); |
| Expand All | | @@ -13,22 +11,19 @@ describe('cors.test.js', function() { |
|  |  | ctx.body = { foo: 'bar' }; |
|  |  | }); |
|  |  |  |
|  |  | it('should not set `Access-Control-Allow-Origin` when request Origin header missing', function(done) { |
|  |  | it('should set `Access-Control-Allow-Origin` to `\*` when request Origin header missing', function(done) { |
|  |  | request(app.listen()) |
|  |  | .get('/') |
|  |  | .expect({ foo: 'bar' }) |
|  |  | .expect(200, function(err, res) { |
|  |  | assert(!err); |
|  |  | assert(!res.headers['access-control-allow-origin']); |
|  |  | done(); |
|  |  | }); |
|  |  | .expect('access-control-allow-origin', '\*') |
|  |  | .expect(200, done); |
|  |  | }); |
|  |  |  |
|  |  | it('should set `Access-Control-Allow-Origin` to request origin header', function(done) { |
|  |  | it('should set `Access-Control-Allow-Origin` to `\*`', function(done) { |
|  |  | request(app.listen()) |
|  |  | .get('/') |
|  |  | .set('Origin', 'http://koajs.com') |
|  |  | .expect('Access-Control-Allow-Origin', 'http://koajs.com') |
|  |  | .expect('Access-Control-Allow-Origin', '\*') |
|  |  | .expect({ foo: 'bar' }) |
|  |  | .expect(200, done); |
|  |  | }); |
| Expand All | | @@ -38,7 +33,7 @@ describe('cors.test.js', function() { |
|  |  | .options('/') |
|  |  | .set('Origin', 'http://koajs.com') |
|  |  | .set('Access-Control-Request-Method', 'PUT') |
|  |  | .expect('Access-Control-Allow-Origin', 'http://koajs.com') |
|  |  | .expect('Access-Control-Allow-Origin', '\*') |
|  |  | .expect('Access-Control-Allow-Methods', 'GET,HEAD,PUT,POST,DELETE,PATCH') |
|  |  | .expect(204, done); |
|  |  | }); |
| Expand Down  Expand Up | | @@ -87,6 +82,44 @@ describe('cors.test.js', function() { |
|  |  | }); |
|  |  | }); |
|  |  |  |
|  |  | describe('options.origin set the request Origin header', function() { |
|  |  | const app = new Koa(); |
|  |  | app.use(cors({ |
|  |  | origin(ctx) { |
|  |  | return ctx.get('Origin') || '\*'; |
|  |  | }, |
|  |  | })); |
|  |  | app.use(function(ctx) { |
|  |  | ctx.body = { foo: 'bar' }; |
|  |  | }); |
|  |  |  |
|  |  | it('should set `Access-Control-Allow-Origin` to request `Origin` header', function(done) { |
|  |  | request(app.listen()) |
|  |  | .get('/') |
|  |  | .set('Origin', 'http://koajs.com') |
|  |  | .expect('Access-Control-Allow-Origin', 'http://koajs.com') |
|  |  | .expect({ foo: 'bar' }) |
|  |  | .expect(200, done); |
|  |  | }); |
|  |  |  |
|  |  | it('should set `Access-Control-Allow-Origin` to request `origin` header', function(done) { |
|  |  | request(app.listen()) |
|  |  | .get('/') |
|  |  | .set('origin', 'http://origin.koajs.com') |
|  |  | .expect('Access-Control-Allow-Origin', 'http://origin.koajs.com') |
|  |  | .expect({ foo: 'bar' }) |
|  |  | .expect(200, done); |
|  |  | }); |
|  |  |  |
|  |  | it('should set `Access-Control-Allow-Origin` to `\*`, even if no Origin is passed on request', function(done) { |
|  |  | request(app.listen()) |
|  |  | .get('/') |
|  |  | .expect('Access-Control-Allow-Origin', '\*') |
|  |  | .expect({ foo: 'bar' }) |
|  |  | .expect(200, done); |
|  |  | }); |
|  |  | }); |
|  |  |  |
|  |  | describe('options.secureContext=true', function() { |
|  |  | const app = new Koa(); |
|  |  | app.use(cors({ |
| Expand Down  Expand Up | | @@ -651,7 +684,11 @@ describe('cors.test.js', function() { |
|  |  | describe('options.headersKeptOnError', function() { |
|  |  | it('should keep CORS headers after an error', function(done) { |
|  |  | const app = new Koa(); |
|  |  | app.use(cors()); |
|  |  | app.use(cors({ |
|  |  | origin(ctx) { |
|  |  | return ctx.get('Origin') || '\*'; |
|  |  | }, |
|  |  | })); |
|  |  | app.use(function(ctx) { |
|  |  | ctx.body = { foo: 'bar' }; |
|  |  | throw new Error('Whoops!'); |
| Expand All | | @@ -668,7 +705,11 @@ describe('cors.test.js', function() { |
|  |  |  |
|  |  | it('should not affect OPTIONS requests', function(done) { |
|  |  | const app = new Koa(); |
|  |  | app.use(cors()); |
|  |  | app.use(cors({ |
|  |  | origin(ctx) { |
|  |  | return ctx.get('Origin') || '\*'; |
|  |  | }, |
|  |  | })); |
|  |  | app.use(function(ctx) { |
|  |  | ctx.body = { foo: 'bar' }; |
|  |  | throw new Error('Whoops!'); |
| Expand All | | @@ -684,7 +725,11 @@ describe('cors.test.js', function() { |
|  |  |  |
|  |  | it('should not keep unrelated headers', function(done) { |
|  |  | const app = new Koa(); |
|  |  | app.use(cors()); |
|  |  | app.use(cors({ |
|  |  | origin(ctx) { |
|  |  | return ctx.get('Origin') || '\*'; |
|  |  | }, |
|  |  | })); |
|  |  | app.use(function(ctx) { |
|  |  | ctx.body = { foo: 'bar' }; |
|  |  | ctx.set('X-Example', 'Value'); |
| Expand Down  Expand Up | | @@ -752,6 +797,7 @@ describe('cors.test.js', function() { |
|  |  | .expect(200, done); |
|  |  | }); |
|  |  | }); |
|  |  |  |
|  |  | describe('other middleware has set vary header on Error', function() { |
|  |  | it('should append `Origin to other `Vary` header', function(done) { |
|  |  | const app = new Koa(); |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `f31dac9`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkoajs%2Fcors%2Fcommit%2Ff31dac99f5355c41e7d4dd3c4a80c5f154941a11) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_e384abdc_20250114_194816.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkoajs%2Fcors%2Fsecurity%2Fadvisories%2FGHSA-qxrj-hx23-xp82)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkoajs%2Fcors%2Fsecurity%2Fadvisories%2FGHSA-qxrj-hx23-xp82)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=koajs%2Fcors)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[koajs](/koajs)
/
**[cors](/koajs/cors)**
Public

* [Notifications](/login?return_to=%2Fkoajs%2Fcors) You must be signed in to change notification settings
* [Fork
  80](/login?return_to=%2Fkoajs%2Fcors)
* [Star
   737](/login?return_to=%2Fkoajs%2Fcors)

* [Code](/koajs/cors)
* [Issues
  15](/koajs/cors/issues)
* [Pull requests
  7](/koajs/cors/pulls)
* [Actions](/koajs/cors/actions)
* [Security](/koajs/cors/security)
* [Insights](/koajs/cors/pulse)

Additional navigation options

* [Code](/koajs/cors)
* [Issues](/koajs/cors/issues)
* [Pull requests](/koajs/cors/pulls)
* [Actions](/koajs/cors/actions)
* [Security](/koajs/cors/security)
* [Insights](/koajs/cors/pulse)

# The default behavior is extremely dangerous.

High

[fengmk2](/fengmk2)
published
GHSA-qxrj-hx23-xp82
Dec 11, 2023

## Package

npm

@koa/cors
([npm](/advisories?query=ecosystem%3Anpm))

## Affected versions

4.0.0

## Patched versions

None

## Description

Currently, the middleware operates in a way that if an allowed origin is not provided, it will return an `Access-Control-Allow-Origin` header with the value of the origin from the request. This behavior completely disables one of the most crucial elements of browsers - the Same Origin Policy (SOP), this could cause a very serious security threat to the users of this middleware.

If such behavior is expected, for instance, when middleware is used exclusively for prototypes and not for production applications, it should be heavily emphasized in the documentation along with an indication of the risks associated with such behavior, as many users may not be aware of it.

### Severity

High

### CVE ID

CVE-2023-49803

### Weaknesses

No CWEs

### Credits

* [![@PawelJ-PL](https://avatars.githubusercontent.com/u/20472898?s=40&v=4)](/PawelJ-PL)
  [PawelJ-PL](/PawelJ-PL)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


