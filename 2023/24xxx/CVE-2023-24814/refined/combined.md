=== Content from github.com_9fdd64ac_20250115_114648.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-r4f8-f93x-5qh3)

**CVE-2023-24814**

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-r4f8-f93x-5qh3)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2Fadvisories%2F%3Cid%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

1. [GitHub Advisory Database](/advisories)
2. [GitHub Reviewed](/advisories?query=type%3Areviewed)
3. [CVE-2023-24814](/advisories/GHSA-r4f8-f93x-5qh3)

## TYPO3 is vulnerable to Cross-Site Scripting via frontend rendering

High severity

GitHub Reviewed

Published
Feb 7, 2023
in
[TYPO3/typo3](/TYPO3/typo3)
•
Updated Feb 8, 2023

[Vulnerability details](/advisories/GHSA-r4f8-f93x-5qh3)
[Dependabot alerts
0](/advisories/GHSA-r4f8-f93x-5qh3/dependabot)

## Package

composer

typo3/cms
([Composer](/advisories?query=ecosystem%3Acomposer))

## Affected versions

>= 10.0.0, < 10.4.35
>= 11.0.0, < 11.5.23
>= 12.0.0, < 12.2.0

## Patched versions

10.4.35
11.5.23
12.2.0

composer

typo3/cms-core
([Composer](/advisories?query=ecosystem%3Acomposer))

>= 12.0.0, < 12.2.0
>= 11.0.0, < 11.5.23
>= 10.0.0, < 10.4.36
>= 9.0.0, < 9.5.40
>= 8.7.0, < 8.7.51

12.2.0
11.5.23
10.4.36
9.5.40
8.7.51

## Description

> ### CVSS: `CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:H/A:L/E:F/RL:O/RC:C` (8.2)

### Problem

TYPO3 core component `GeneralUtility::getIndpEnv()` uses the unfiltered server environment variable `PATH_INFO`, which allows attackers to inject malicious content.

In combination with the TypoScript setting [`config.absRefPrefix=auto`](https://github.com/TYPO3/typo3/blob/v11.5.22/typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php#L2547-L2549), attackers can inject malicious HTML code into pages that have not yet been rendered and cached. As a result, injected values would be cached and delivered to other website visitors (persisted cross-site scripting).

Individual code which relies on the resolved value of [`GeneralUtility::getIndpEnv('SCRIPT_NAME')`](https://github.com/TYPO3/typo3/blob/v11.5.22/typo3/sysext/core/Classes/Utility/GeneralUtility.php#L2481-L2484) and corresponding usages (as shown below) are vulnerable as well.

* `GeneralUtility::getIndpEnv('PATH_INFO')`
* `GeneralUtility::getIndpEnv('SCRIPT_NAME')`
* `GeneralUtility::getIndpEnv('TYPO3_REQUEST_DIR')`
* `GeneralUtility::getIndpEnv('TYPO3_REQUEST_SCRIPT')`
* `GeneralUtility::getIndpEnv('TYPO3_SITE_PATH')`
* `GeneralUtility::getIndpEnv('TYPO3_SITE_SCRIPT')`
* `GeneralUtility::getIndpEnv('TYPO3_SITE_URL')`

Installations of TYPO3 versions 8.7 and 9.x are probably only affected when server environment variable [`TYPO3_PATH_ROOT`](https://docs.typo3.org/m/typo3/reference-coreapi/9.5/en-us/ApiOverview/Environment/Index.html#configuring-environment-paths) is defined - which is the case if they were installed via Composer.

Additional investigations confirmed that Apache and Microsoft IIS web servers using PHP-CGI (FPM, FCGI/FastCGI, or similar) are affected. There might be the risk that nginx is vulnerable as well. It was not possible to exploit Apache/mod\_php scenarios.

### Solution

The usage of server environment variable `PATH_INFO` has been removed from corresponding processings in `GeneralUtility::getIndpEnv()`. Besides that, the public property `TypoScriptFrontendController::$absRefPrefix` is encoded for both being used as a URI component and for being used as a prefix in an HTML context. This mitigates the cross-site scripting vulnerability.

Update to TYPO3 versions 8.7.51 ELTS, 9.5.40 ELTS, 10.4.36 LTS, 11.5.23 LTS and 12.2.0 that fix the problem described above.

> ℹ️ **Strong security defaults - Manual actions required**
>
> Any web server using PHP-CGI (FPM, FCGI/FastCGI, or similar) needs to ensure that the PHP setting [**`cgi.fix_pathinfo=1`**](https://www.php.net/manual/en/ini.core.php#ini.cgi.fix-pathinfo) is used, which is the default PHP setting. In case this setting is not enabled, an exception is thrown to avoid continuing with invalid path information.

For websites that cannot be patched timely the TypoScript setting [`config.absRefPrefix`](https://docs.typo3.org/m/typo3/reference-typoscript/main/en-us/Setup/Config/Index.html#absrefprefix) at least should be set to a static path value, instead of using `auto` - e.g. `config.absRefPrefix=/` - this **does not fix all aspects of the vulnerability**, and is just considered to be an intermediate mitigation to the most prominent manifestation.

### References

* [TYPO3-CORE-SA-2023-001](https://typo3.org/security/advisory/typo3-core-sa-2023-001)
* [TYPO3-CORE-PSA-2023-001](https://typo3.org/security/advisory/typo3-psa-2023-001) *pre-announcement*

### References

* [GHSA-r4f8-f93x-5qh3](https://github.com/TYPO3/typo3/security/advisories/GHSA-r4f8-f93x-5qh3 "GHSA-r4f8-f93x-5qh3")
* <https://nvd.nist.gov/vuln/detail/CVE-2023-24814>
* [TYPO3/typo3@0005a6f](https://github.com/TYPO3/typo3/commit/0005a6fd86ab97eff8bf2e3a5828bf0e7cb6263a)
* <https://docs.typo3.org/m/typo3/reference-typoscript/main/en-us/Setup/Config/Index.html#absrefprefix>
* <https://github.com/FriendsOfPHP/security-advisories/blob/master/typo3/cms/CVE-2023-24814.yaml>
* <https://github.com/TYPO3/typo3/blob/v11.5.22/typo3/sysext/core/Classes/Utility/GeneralUtility.php#L2481-L2484>
* <https://github.com/TYPO3/typo3/blob/v11.5.22/typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php#L2547-L2549>
* <https://typo3.org/security/advisory/typo3-core-sa-2023-001>
* <https://typo3.org/security/advisory/typo3-psa-2023-001>

[![@ohader](https://avatars.githubusercontent.com/u/402145?s=40&v=4)](/ohader)
[ohader](/ohader)
published to
[TYPO3/typo3](/TYPO3/typo3/security/advisories/GHSA-r4f8-f93x-5qh3)
Feb 7, 2023

Published by the [National Vulnerability Database](https://nvd.nist.gov/vuln/detail/CVE-2023-24814)
Feb 7, 2023

Published to the GitHub Advisory Database
Feb 8, 2023

Reviewed
Feb 8, 2023

Last updated
Feb 8, 2023

### Severity

High

8.8

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
Required

Scope
Changed

Confidentiality
Low

Integrity
High

Availability
Low

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:H/A:L

### [EPSS score](https://www.first.org/epss/user-guide)

0.140%
 (50th percentile)

### Weaknesses

[CWE-79](/advisories?query=cwe%3A79)

### CVE ID

CVE-2023-24814

### GHSA ID

GHSA-r4f8-f93x-5qh3

### Source code

[TYPO3/typo3](https://github.com/TYPO3/typo3)

### Credits

* [![@bnf](https://avatars.githubusercontent.com/u/473155?s=40&v=4)](/bnf)
  [bnf](/bnf)
  Analyst

 Loading

Checking history

See something to contribute?
[Suggest improvements for this vulnerability](/advisories/GHSA-r4f8-f93x-5qh3/improve).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from typo3.org_a6f109a6_20250114_193355.html ===


![](//piwik.typo3.org/piwik.php?idsite=2&rec=1)

![](/_assets/a686d4200d36973f64d48f0547522f58/Images/typo3_logo.svg)

[![TYPO3 Logo](/_assets/a686d4200d36973f64d48f0547522f58/Images/Template/typo3_nomargins.svg "Go to the start page")](/ "Go to the start page")

* [TYPO3 CMS](/cms "Open menu for TYPO3 CMS")
  + [Features](/cms/features "TYPO3 delivers flexible fast content powered by an enterprise open-source CMS. It’s backed by a vibrant professional community and commercial ecosystem.")
    - [Smart Content Management](/cms/features/smart-content-management)
    - [Secure Performant Scalable](/cms/features/secure-performant-scalable)
    - [Universal Frontend User Experience](/cms/features/frontend-experience)
    - [Professional Open Source](/cms/features/professional-open-source)
    - [Open Extensible Customizable](/cms/features/open-extensible-customizable)
    - [Digital Marketing Enabled](/cms/features/digital-marketing-enabled)
    - [Massively Multisite Multilingual](/cms/features/massively-multisite-multilingual)
  + [Development Roadmap](/cms/roadmap "The TYPO3 CMS development roadmap follows an 18-month release cycle for Long Term Support versions. ")
    - [TYPO3 Development Roadmap](/cms/roadmap)
    - [Maintenance Releases Schedule](/cms/roadmap/maintenance-releases)
  + [Strategy](/cms/strategy)
  + [Core Development](/community/teams/typo3-development)
  + [Release News](/cms/release-news)
    - [TYPO3 11 Release Notes](/cms/release-news/typo3-11-release-notes)
    - [TYPO3 10 Release Notes](/cms/release-news/typo3-10-release-notes)
    - [TYPO3 9 Release Notes](/cms/release-news/typo3-9-release-notes)
    - [TYPO3 8 Release Notes](/cms/release-news/typo3-8-release-notes)
    - [TYPO3 7 Release Notes](/cms/roadmap/typo3-7-release-notes)
  + [Documentation](/help/documentation)
  + [Comparison Cards](/cms/comparison-cards "Super charge your sales presentations with fact-based comparisons between TYPO3 and other products and features.")
  + [System Requirements](https://get.typo3.org/version/#system-requirements "It doesn't take a degree in engineering to get TYPO3 up an running. Find the facts and figures you need to get started with your first project.")
  + [Download & Install](https://get.typo3.org "To test the TYPO3 Introduction Package on your local computer, download the sources and install the Introduction Package from a distribution.")
  + [Getting Started](https://docs.typo3.org/Home/GettingStarted.html)
  + [Fluid Template Engine](/fluid)
* [Community](/community "Open menu for Community")
  + [Events](/community/events "You can take part in official events organized by the TYPO3 Association, events organized by the TYPO3 community, and events where TYPO3 participates.")
  + [Meet the Community](/community/meet "Online, at events, or in user groups. There are many ways to meet us.")
    - [Communicate: Where and how](/community/meet/communicate)
    - [User Groups](/community/meet/user-groups)
    - [StackOverflow](https://stackoverflow.com/questions/tagged/typo3)
    - [Forum](https://talk.typo3.org)
    - [Chat (Slack)](/community/meet/chat-slack)
    - [how to use Slack](/community/meet/how-to-use-slack-in-the-typo3-community)
    - [Regular Open Sprints](/community/meet/regular-open-sprints)
    - [You, me, and TYPO3!](/community/meet/you-me-and-typo3)
  + [Contribute / Get Involved](/community/contribute)
    - [TYPO3 remote days](/community/contribute/typo3-remote-days)
    - [Become an Association Member](/project/association/membership)
    - [Get your My TYPO3 account](/community/contribute/get-your-typo3org-community-account)
    - [Donate](/community/contribute/donate)
    - [Mentorship](/community/contribute/mentorship)
    - [Community Writers Program](/community/contribute/community-writers)
  + [Teams & Committees](/community/teams "The teams and committees of the TYPO3 community take on tasks within specific areas, such as core development, education, communication and security. ")
    - [TYPO3 Development](/community/teams/typo3-development)
    - [Academic](/community/teams/academic-committee)
    - [Accessibility](/community/teams/accessibility)
    - [Best Practices](/community/teams/best-practices)
    - [Communication Coordination](/community/teams/communication-coordination)
    - [Community Expansion](/community/teams/community-expansion)
    - [Content](/community/teams/content)
    - [Content Types](/community/teams/structured-content)
    - [Documentation](/community/teams/documentation)
    - [Education & Certification](/community/teams/education-certification)
    - [Localization](/community/teams/localization)
    - [Marketing](/community/teams/marketing)
    - [Ombudsperson](/community/teams/ombudsperson)
    - [Security](/community/teams/security)
    - [Server](/community/teams/server-team)
    - [TYPO3 CMS Product Strategy Group](/community/teams/typo3-cms-strategy-group)
    - [typo3.org website](/community/teams/typo3org)
    - [User Experience (UX)](/community/teams/user-experience-ux)
  + [Values and Proceedings](/community/values "TYPO3 is more than just a piece of software. It is a community. Our values guide our work and make sure the community is a great place for everyone.")
    - [Code of Conduct](/community/values/code-of-conduct)
    - [Community Mediation](/community/values/mediation)
    - [Conflict of Interest Policy](/community/values/conflict-of-interest-policy)
    - [Social Media Guidelines](/community/values/social-media-guidelines)
    - [Decision-Making Processes, Contribution and Participation](/community/values/decision-making-processes-contribution-and-participation)
    - [Open Web Manifesto](/community/values/open-web-manifesto)
    - [Policy for Committees & Official Teams](/community/values/policy-for-committees-official-teams)
    - [Usage of Titles](/community/values/usage-of-titles)
    - [Vision, Mission, Purpose](/community/values/vision-mission-purpose/project)
  + [Team Leader Meetings](/community/team-leader-meetings)
  + [Data Protection Corner](/community/dataprotection-corner)
    - [Training for the TYPO3 teams](/community/dataprotection-corner/training-for-the-typo3-teams)
  + [Services](/community/services "Get an overview about our TYPO3 services for our community (Git, trouble ticketsystems, infrastructure, LDAP, OTRS, Gerrit). ")
    - [e-mail-addresses](/community/services/e-mail-addresses)
* [The Project](/project "Open menu for The Project")
  + [News](/project/news "Read the latest news about TYPO3 CMS and the association and community supporting the word's most popular enterprise-level content management system.")
    - [RSS feed](https://typo3.org/rss)
    - [Security Advisories](/help/security-advisories)
    - [This Month in TYPO3](/project/news/this-month-in-typo3)
    - [Podcast](/project/news/podcast)
  + [Our Products](/project/products "TYPO3 CMS is our most important product. Fluid is a templating engine and Surf a deployment tool. They help deliver groundbreaking technology in TYPO3 CMS.")
  + [TYPO3 Association](/project/association "The TYPO3 Association is a not-for-profit membership organization that coordinates and funds the long-term development of the TYPO3 CMS platform. ")
    - [Become a Member](/project/association/membership)
    - [Our Members](/project/association/members)
    - [Structure](/project/association/structure)
    - [Association News](/project/association/association-news)
    - [Partnerships](/project/association/partnerships)
    - [Funding & Finances](/project/association/funding-finances)
    - [General Assembly](/project/association/structure/general-assembly)
    - [By-Laws & proceedings](/project/association/by-laws)
    - [Contact](/project/association/contact)
    - [Association Strategy](/project/association/strategy)
  + [The Brand](/project/brand "Find information about how to use the brand and trademark rules, and learn how (not) to spell “TYPO3”.")
    - [Trademarks](/project/brand/trademarks)
    - [Style Guide](https://styleguide.typo3.com)
    - [TYPO3 slidedeck](/project/brand/typo3-slidedeck)
    - [Spelling TYPO3](/project/brand/spelling-typo3)
  + [History](/project/history "TYPO3 was developed from scratch by Kasper Skårhøj in 1997. Separating design and content was a smart solution to an emerging problem.")
  + [Press](/project/press "The TYPO3 Association is a not-for-profit organization, founded in 2004 to ensure the long-term development of the web-based content management system TYPO3 CMS. ")
    - [Press Releases](/project/press/press-releases)
    - [TYPO3 v9 Release Material](/project/press/typo3-v9-release-material)
    - [TYPO3 v10 Release Material](/project/press/v10-release-material)
    - [TYPO3 v11 Release Material](/project/press/typo3-v11-release-material)
    - [TYPO3 v12 Release Material](/project/press/typo3-v12-release-material)
    - [TYPO3 v13 Release Material](/project/press/typo3-v13-release-material)
  + [Licenses](/project/licenses "TYPO3 products and extensions use GNU General Public License, where you are allowed to sell the extension as long as you do not change the license terms.")
  + [Technology Supporters](/project/technology-supporters "This section is dedicated to our supporters offering their tools and services for free in the scope of open source software.")
* [Certification](https://typo3.com/services/certifications "Open menu for Certification")
* [Help & Support](/help "Open menu for Help & Support")
  + [Documentation](/help/documentation "TYPO3 CMS has more than ten thousand features. Becoming an expert takes time, but the process will be rewarding. Find your topic of interest or introductions.")
    - [Getting Started](https://docs.typo3.org/Home/GettingStarted.html)
    - [Video Tutorials](/help/documentation/video-tutorials)
    - [What's New](/help/documentation/whats-new)
  + [Security Advisories](/help/security-advisories)
    - [TYPO3 CMS](/help/security-advisories/typo3-cms)
    - [TYPO3 Extensions](/help/security-advisories/typo3-extensions)
    - [Public Service Announcements](/help/security-advisories/public-service-announcements)
    - [Security Advisories (RSS Feed)](https://typo3.org/?type=101)
  + [Professional Services](https://typo3.com/partners/professional-service-listing)
  + [Official TYPO3 Forum](https://talk.typo3.org/)
  + [TYPO3 LTS Extended Support](https://typo3.com/products/extended-support)
  + [Stack Overflow](https://stackoverflow.com/search?q=typo3)
* [Search](/search "Open menu for Search")
* [Login](/login "Login with your typo3.org user account")

* [Overview](/cms "Free and open source, TYPO3 CMS is a leading content management system with a feature set eclipsing that of our commercial and proprietary competitors.")
* [Features](/cms/features "TYPO3 delivers flexible fast content powered by an enterprise open-source CMS. It’s backed by a vibrant professional community and commercial ecosystem.")
  [+](/cms/features "TYPO3 delivers flexible fast content powered by an enterprise open-source CMS. It’s backed by a vibrant professional community and commercial ecosystem.")
* [Development Roadmap](/cms/roadmap "The TYPO3 CMS development roadmap follows an 18-month release cycle for Long Term Support versions. ")
  [+](/cms/roadmap "The TYPO3 CMS development roadmap follows an 18-month release cycle for Long Term Support versions. ")
* [Strategy](/cms/strategy)
* [Core Development](/community/teams/typo3-development)
* [Release News](/cms/release-news)
  [+](/cms/release-news)
* [Documentation](/help/documentation)
* [Comparison Cards](/cms/comparison-cards "Super charge your sales presentations with fact-based comparisons between TYPO3 and other products and features.")
* [System Requirements](https://get.typo3.org/version/#system-requirements "It doesn't take a degree in engineering to get TYPO3 up an running. Find the facts and figures you need to get started with your first project.")
* [Download & Install](https://get.typo3.org "To test the TYPO3 Introduction Package on your local computer, download the sources and install the Introduction Package from a distribution.")
* [Getting Started](https://docs.typo3.org/Home/GettingStarted.html)
* [Fluid Template Engine](/fluid)

* [Smart Content Management](/cms/features/smart-content-management "Make your content management smart without depending on IT. Control user rights easily, use the best tools for SEO and DAM and get great results.")
* [Secure Performant Scalable](/cms/features/secure-performant-scalable "Build digital experiences that load fast and perform well at any scale, within a secure and reliable CMS. Handle the whole installation from a central point")
* [Universal Frontend User Experience](/cms/features/frontend-experience "TYPO3 CMS has endless frontend flexibility and a seamless mobile user experience. Use TYPO3 headless as a powerful middleware.")
* [Professional Open Source](/cms/features/professional-open-source "TYPO3’s vibrant professional ecosystem, focus on quality and security, and its strong commercial vendor set the CMS apart from the crowd.
  ")
* [Open Extensible Customizable](/cms/features/open-extensible-customizable "Build the project you need without sacrificing flexibility and enhancement in the future. TYPO3 gives you the freedom and flexibility of open source.")
* [Digital Marketing Enabled](/cms/features/digital-marketing-enabled "Take advantage of TYPO3’s extensions and integration possibilities of all digital marketing solutions – including everything you know and love.")
* [Massively Multisite Multilingual](/cms/features/massively-multisite-multilingual "Use TYPO3 CMS to reach global audiences with multilingual sites, localized content, and smooth translation workflows.")

* [TYPO3 Development Roadmap](/cms/roadmap)
* [Maintenance Releases Schedule](/cms/roadmap/maintenance-releases)

* [TYPO3 11 Release Notes](/cms/release-news/typo3-11-release-notes "Learn more about the main features of TYPO3 version 11.")
* [TYPO3 10 Release Notes](/cms/release-news/typo3-10-release-notes "Learn more about the main features of TYPO3 version 10.")
* [TYPO3 9 Release Notes](/cms/release-news/typo3-9-release-notes)
* [TYPO3 8 Release Notes](/cms/release-news/typo3-8-release-notes)
* [TYPO3 7 Release Notes](/cms/roadmap/typo3-7-release-notes)

![](/fileadmin/_processed_/2/7/csm_typo3-pagetree-screenshot-mock-up_984f8f3795.jpg)

* [TYPO3 Community](/community "The TYPO3 Community is growing, and we do more than just developing software. Everyone is welcome. Offer your skills and contribute to TYPO3.")
* [Events](/community/events "You can take part in official events organized by the TYPO3 Association, events organized by the TYPO3 community, and events where TYPO3 participates.")
* [Meet the Community](/community/meet "Online, at events, or in user groups. There are many ways to meet us.")
  [+](/community/meet "Online, at events, or in user groups. There are many ways to meet us.")
* [Contribute / Get Involved](/community/contribute)
  [+](/community/contribute)
* [Teams & Committees](/community/teams "The teams and committees of the TYPO3 community take on tasks within specific areas, such as core development, education, communication and security. ")
  [+](/community/teams "The teams and committees of the TYPO3 community take on tasks within specific areas, such as core development, education, communication and security. ")
* [Values and Proceedings](/community/values "TYPO3 is more than just a piece of software. It is a community. Our values guide our work and make sure the community is a great place for everyone.")
  [+](/community/values "TYPO3 is more than just a piece of software. It is a community. Our values guide our work and make sure the community is a great place for everyone.")
* [Team Leader Meetings](/community/team-leader-meetings)
* [Data Protection Corner](/community/dataprotection-corner)
  [+](/community/dataprotection-corner)
* [Services](/community/services "Get an overview about our TYPO3 services for our community (Git, trouble ticketsystems, infrastructure, LDAP, OTRS, Gerrit). ")
  [+](/community/services "Get an overview about our TYPO3 services for our community (Git, trouble ticketsystems, infrastructure, LDAP, OTRS, Gerrit). ")

* [Communicate: Where and how](/community/meet/communicate "Get an overview about our communication channels and learn to choose the right communication channel - Slack, Forum, Support, Decisions ...
  ")
* [User Groups](/community/meet/user-groups "Many users would like to get in personal contact with other TYPO3 enthusiasts. This is how local TYPO3 User Groups (TUG) are formed and knowledge happens.")
* [StackOverflow](https://stackoverflow.com/questions/tagged/typo3)
* [Forum](https://talk.typo3.org)
* [Chat (Slack)](/community/meet/chat-slack)
* [how to use Slack](/community/meet/how-to-use-slack-in-the-typo3-community "Find important channels for the TYPO3 community and learn how to get you started.")
* [Regular Open Sprints](/community/meet/regular-open-sprints)
* [You, me, and TYPO3!](/community/meet/you-me-and-typo3 "You, me, and TYPO3 is a fresh take on young people that make our TYPO3 community so unique.")

* [TYPO3 remote days](/community/contribute/typo3-remote-days)
* [Become an Association Member](/project/association/membership)
* [Get your My TYPO3 account](/community/contribute/get-your-typo3org-community-account "Create login for the online services. Find out which are the main services we are providing for our community.")
* [Donate](/community/contribute/donate "TYPO3 is an Open Source project, dependent in large parts on donations. This page is for those who want to donate money")
* [Mentorship](/community/contribute/mentorship "Local web developers and agencies learn how to use TYPO3, a performant, secure, and flexible CMS, for their projects. All through one-on-on mentorship.")
* [Community Writers Program](/community/contribute/community-writers "Join the Community Writers Program to improve your skills and confidence in writing and content marketing to boost TYPO3’s signal and reach new audiences.")

* [TYPO3 Development](/community/teams/typo3-development "The TYPO3 Core Development Team is dedicated to develop and maintain the central parts of TYPO3 CMS.")
* [Academic](/community/teams/academic-committee "The TYPO3 Academic Committee is made up of TYPO3 Association members from universities that use TYPO3-CMS for their homepages. ")
* [Accessibility](/community/teams/accessibility "The Accessibility Team assists to improve and maintain the accessibility in TYPO3. Therefore we share our accessibility expertise with TYPO3 developers.")
* [Best Practices](/community/teams/best-practices "Focusing on establishing and communicating best practices around TYPO3.")
* [Communication Coordination](/community/teams/communication-coordination "The Committee coordinates the communication and marketing of the TYPO3 Company and Association, through a unified workflow and pipeline.")
* [Community Expansion](/community/teams/community-expansion "The TYPO3 Community Expansion Committee (T3CEC) has the goal to foster the use of TYPO3 all over the world. Find out about its Activities on this page.")
* [Content](/community/teams/content "Write, Translate, Proofread. No coding skills are required. You can support us on a regular basis or when you have time.")
* [Content Types](/community/teams/structured-content "Team to build better, native support for custom, semantically
  structured content for TYPO3.
  ")
* [Documentation](/community/teams/documentation "The documentation team provides exhaustive, quality documentation about TYPO3 products for all users, with the help of the community.")
* [Education & Certification](/community/teams/education-certification "The committee is responsible for the TYPO3 education strategy, enabling easy access to learning materials, as well as official certifications.")
* [Localization](/community/teams/localization)
* [Marketing](/community/teams/marketing "Create. Communicate. Contribute.
  Support us with sharing your knowledge and help us to spread the word about TYPO3.")
* [Ombudsperson](/community/teams/ombudsperson "A TYPO3 committee ensuring the wellbeing of everyone in the community through education about and enforcement of the Code of Conduct.")
* [Security](/community/teams/security)
* [Server](/community/teams/server-team "We are in charge of the TYPO3 IT infrastructure. About a dozen core applications are run and managed by our team directly, additionaly we provide services to other teams within the TYPO3 universe for their own use.")
* [TYPO3 CMS Product Strategy Group](/community/teams/typo3-cms-strategy-group)
* [typo3.org website](/community/teams/typo3org "The typo3.org website team develops and maintains the typo3.org website, the Extension Repository, Events and Certification Listings, and much more.")
* [User Experience (UX)](/community/teams/user-experience-ux "The main goal of this team is to work on TYPO3 existing features UX improvments and also to collaborate on building any new feature during the concept process if help is wanted.")

* [Code of Conduct](/community/values/code-of-conduct "Be constructive and considerate, respect other people's boundaries.
  Consider your actions—are they OK?")
* [Community Mediation](/community/values/mediation)
* [Conflict of Interest Policy](/community/values/conflict-of-interest-policy)
* [Social Media Guidelines](/community/values/social-media-guidelines "These are the official guidelines for participating in social media for the TYPO3 Project.")
* [Decision-Making Processes, Contribution and Participation](/community/values/decision-making-processes-contribution-and-participation "This policy outlines the difference between groups, as well describing the decision-making, Contribution and Participation")
* [Open Web Manifesto](/community/values/open-web-manifesto)
* [Policy for Committees & Official Teams](/community/values/policy-for-committees-official-teams "The TYPO3 Association’s Policy for Committees and Official Teams outlines the structure for teams, committees and initiatives. It is describing empowerment and disbanding processes.
  ")
* [Usage of Titles](/community/values/usage-of-titles "Learn how to use an official title within the TYPO3 Community and Association")
* [Vision, Mission, Purpose](/community/values/vision-mission-purpose/project)

* [Training for the TYPO3 teams](/community/dataprotection-corner/training-for-the-typo3-teams)

* [e-mail-addresses](/community/services/e-mail-addresses)

![](/fileadmin/_processed_/4/3/csm_6932872980_d788451b65_o_4e84bb9425.jpg)
### Inspire people to share

Offer your skills and [contribute to the project](/community/contribute). The community is growing and does more than just coding.

* [The TYPO3 Project](/project "TYPO3 CMS is an open source CMS. The project is international and fully community-driven, and the long-term development is managed by the TYPO3 Association.")
* [News](/project/news "Read the latest news about TYPO3 CMS and the association and community supporting the word's most popular enterprise-level content management system.")
  [+](/project/news "Read the latest news about TYPO3 CMS and the association and community supporting the word's most popular enterprise-level content management system.")
* [Our Products](/project/products "TYPO3 CMS is our most important product. Fluid is a templating engine and Surf a deployment tool. They help deliver groundbreaking technology in TYPO3 CMS.")
* [TYPO3 Association](/project/association "The TYPO3 Association is a not-for-profit membership organization that coordinates and funds the long-term development of the TYPO3 CMS platform. ")
  [+](/project/association "The TYPO3 Association is a not-for-profit membership organization that coordinates and funds the long-term development of the TYPO3 CMS platform. ")
* [The Brand](/project/brand "Find information about how to use the brand and trademark rules, and learn how (not) to spell “TYPO3”.")
  [+](/project/brand "Find information about how to use the brand and trademark rules, and learn how (not) to spell “TYPO3”.")
* [History](/project/history "TYPO3 was developed from scratch by Kasper Skårhøj in 1997. Separating design and content was a smart solution to an emerging problem.")
* [Press](/project/press "The TYPO3 Association is a not-for-profit organization, founded in 2004 to ensure the long-term development of the web-based content management system TYPO3 CMS. ")
  [+](/project/press "The TYPO3 Association is a not-for-profit organization, founded in 2004 to ensure the long-term development of the web-based content management system TYPO3 CMS. ")
* [Licenses](/project/licenses "TYPO3 products and extensions use GNU General Public License, where you are allowed to sell the extension as long as you do not change the license terms.")
* [Technology Supporters](/project/technology-supporters "This section is dedicated to our supporters offering their tools and services for free in the scope of open source software.")

* [RSS feed](https://typo3.org/rss)
* [Security Advisories](/help/security-advisories)
* [This Month in TYPO3](/project/news/this-month-in-typo3 "A report of what happened in the TYPO3 community and in the ecosystem in the recent weeks. Enter interesting articles and everything else what might fit.")
* [Podcast](/project/news/podcast "Inside TYPO3 gives you updates, expert insights, and community stories. Available on Spotify, Apple Podcasts, Amazon Music, and YouTube.")

* [Become a Member](/project/association/membership "Members of the TYPO3 Association support the development of TYPO3 CMS and take part in shaping the future of TYPO3 CMS.")
* [Our Members](/project/association/members "This is a list of personal and organizational members of the TYPO3 Association.")
* [Structure](/project/association/structure "The TYPO3 Association has four main bodies: the General Assembly, the Board, the Expert Advisory Board (EAB), and the Business Control Committee (BCC).")
* [Association News](/project/association/association-news "Get the latest news of the TYPO3 Association. Stay up to date and inform yourself about the TYPO3 project.")
* [Partnerships](/project/association/partnerships)
* [Funding & Finances](/project/association/funding-finances "Most of the Association's income comes from membership fees, donations, and events. €650,000 is funneled back into core development and community projects.")
* [General Assembly](/project/association/structure/general-assembly)
* [By-Laws & proceedings](/project/association/by-laws)
* [Contact](/project/association/contact "For general enquiries, coordination, community involvement and sponsorship feel free to contact: info@typo3.org")
* [Association Strategy](/project/association/strategy)

* [Trademarks](/project/brand/trademarks "The word “TYPO3” is one of the trademarks owned by the TYPO3 Association. We have created guidelines to help people understand what is (and is not) OK.")
* [Style Guide](https://styleguide.typo3.com)
* [TYPO3 slidedeck](/project/brand/typo3-slidedeck)
* [Spelling TYPO3](/project/brand/spelling-typo3 "TYPO3 is always written in uppercase, with no spaces. This rule covers all products under the TYPO3 project. URLs are the only exception to this rule.")

* [Press Releases](/project/press/press-releases)
* [TYPO3 v9 Release Material](/project/press/typo3-v9-release-material)
* [TYPO3 v10 Release Material](/project/press/v10-release-material)
* [TYPO3 v11 Release Material](/project/press/typo3-v11-release-material)
* [TYPO3 v12 Release Material](/project/press/typo3-v12-release-material)
* [TYPO3 v13 Release Material](/project/press/typo3-v13-release-material)

![](/fileadmin/_processed_/1/6/csm_26276623101_a436d2f07a_o_270a7b2c42.jpg)
### A Community Effort

TYPO3 CMS is an Open Source project managed by the TYPO3 Association.

[The Project](/project/association)

* [Getting Help & Support](/help "Ask an editor or developer in the community free help with your TYPO3 questions or pay an agency or freelancer to give you the support you need.")
* [Documentation](/help/documentation "TYPO3 CMS has more than ten thousand features. Becoming an expert takes time, but the process will be rewarding. Find your topic of interest or introductions.")
  [+](/help/documentation "TYPO3 CMS has more than ten thousand features. Becoming an expert takes time, but the process will be rewarding. Find your topic of interest or introductions.")
* [Security Advisories](/help/security-advisories)
  [+](/help/security-advisories)
* [Professional Services](https://typo3.com/partners/professional-service-listing)
* [Official TYPO3 Forum](https://talk.typo3.org/)
* [TYPO3 LTS Extended Support](https://typo3.com/products/extended-support)
* [Stack Overflow](https://stackoverflow.com/search?q=typo3)

* [Getting Started](https://docs.typo3.org/Home/GettingStarted.html)
* [Video Tutorials](/help/documentation/video-tutorials)
* [What's New](/help/documentation/whats-new "The TYPO3 CMS What's New Slides summarise new features, significant improvements, important changes and key facts of new TYPO3 releases.")

* [TYPO3 CMS](/help/security-advisories/typo3-cms)
* [TYPO3 Extensions](/help/security-advisories/typo3-extensions)
* [Public Service Announcements](/help/security-advisories/public-service-announcements)
* [Security Advisories (RSS Feed)](https://typo3.org/?type=101)

![](/fileadmin/_processed_/9/c/csm_startup-photos_3680a49e5f.jpg)
### Do you have a question?

[Ask the community](https://talk.typo3.org) or a [professional partner](https://typo3.com/partners/professional-service-listing).

Tue. 7th February, 2023

# TYPO3-CORE-SA-2023-001: Persisted Cross-Site Scripting in Frontend Rendering

Categories:
[Development](/help/security-advisories/development "Development"),

[TYPO3 CMS](/help/security-advisories/typo3-cms "TYPO3 CMS")

Created by Oliver Hader

It has been discovered that TYPO3 CMS is vulnerable to cross-site scripting.

* **Component Type:** TYPO3 CMS
* **Subcomponent:** Frontend Rendering (ext:frontend, ext:core)
* **Release Date:** February 7, 2023
* **Vulnerability Type:** Cross-Site Scripting
* **Affected Versions:** 8.7.0-8.7.50, 9.0.0-9.5.39, 10.0.0-10.4.34, 11.0.0-11.5.22, 12.0.0-12.1.3
* **Severity:** High
* **Suggested CVSS:** [CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:H/A:L/E:F/RL:O/RC:C](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:H/A:L/E:F/RL:O/RC:C&version=3.1)
* **References:** [CVE-2023-24814](https://nvd.nist.gov/vuln/detail/CVE-2023-24814), [CWE-79](https://cwe.mitre.org/data/definitions/79.html)

### Problem Description

TYPO3 core component *GeneralUtility::getIndpEnv()* uses the unfiltered server environment variable *PATH\_INFO*, which allows attackers to inject malicious content.

In combination with the TypoScript setting [*config.absRefPrefix=auto*](https://github.com/TYPO3/typo3/blob/v11.5.22/typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php#L2547-L2549), attackers can inject malicious HTML code into pages that have not yet been rendered and cached. As a result, injected values would be cached and delivered to other website visitors (persisted cross-site scripting).

Individual code which relies on the resolved value of [*GeneralUtility::getIndpEnv('SCRIPT\_NAME')*](https://github.com/TYPO3/typo3/blob/v11.5.22/typo3/sysext/core/Classes/Utility/GeneralUtility.php#L2481-L2484) and corresponding usages (as shown below) are vulnerable as well.

* *GeneralUtility::getIndpEnv('PATH\_INFO')*
* *GeneralUtility::getIndpEnv('SCRIPT\_NAME')*
* *GeneralUtility::getIndpEnv('TYPO3\_REQUEST\_DIR')*
* *GeneralUtility::getIndpEnv('TYPO3\_REQUEST\_SCRIPT')*
* *GeneralUtility::getIndpEnv('TYPO3\_SITE\_PATH')*
* *GeneralUtility::getIndpEnv('TYPO3\_SITE\_SCRIPT')*
* *GeneralUtility::getIndpEnv('TYPO3\_SITE\_URL')*

Installations of TYPO3 versions 8.7 and 9.x are probably only affected when server environment variable [*TYPO3\_PATH\_ROOT*](https://docs.typo3.org/m/typo3/reference-coreapi/9.5/en-us/ApiOverview/Environment/Index.html#configuring-environment-paths) is defined - which is the case if they were installed via Composer.

Additional investigations confirmed that Apache and Microsoft IIS web servers using PHP-CGI (FPM, FCGI/FastCGI, or similar) are affected. There might be the risk that nginx is vulnerable as well. It was not possible to exploit Apache/mod\_php scenarios.

### Solution

The usage of server environment variable *PATH\_INFO* has been removed from corresponding processings in *GeneralUtility::getIndpEnv()*. Besides that, the public property *TypoScriptFrontendController::$absRefPrefix* is encoded for both being used as a URI component and for being used as a prefix in an HTML context. This mitigates the cross-site scripting vulnerability.

Update to TYPO3 versions 8.7.51 ELTS, 9.5.40 ELTS, 10.4.36 LTS, 11.5.23 LTS and 12.2.0 that fix the problem described above.

**Strong security defaults - Manual actions required**

 Any web server using PHP-CGI (FPM, FCGI/FastCGI, or similar) needs to ensure that the PHP setting *[**cgi.fix\_pathinfo=1**](https://www.php.net/manual/en/ini.core.php#ini.cgi.fix-pathinfo)* is used, which is the default PHP setting. In case this setting is not enabled, an exception is thrown to avoid continuing with invalid path information.

For websites that cannot be patched timely the TypoScript setting [*config.absRefPrefix*](https://docs.typo3.org/m/typo3/reference-typoscript/main/en-us/Setup/Config/Index.html#absrefprefix) at least should be set to a static path value, instead of using *auto* - e.g. *config.absRefPrefix=/* - this **does not fix all aspects of the vulnerability**, and is just considered to be an intermediate mitigation to the most prominent manifestation.

### Credits

Thanks to Lars Michalowski, Kevin Andrews & Robin Martin who reported this issue, and to TYPO3 core team members Benjamin Franzke & Helmut Hummel who fixed the issue.

### General Advice

Follow the recommendations that are given in the [TYPO3 Security Guide](https://docs.typo3.org/typo3cms/CoreApiReference/Security/Index.html#security). Please subscribe to the [typo3-announce](http://lists.typo3.org/cgi-bin/mailman/listinfo/typo3-announce) mailing list.

### General Note

All security related code changes are tagged so that you can easily look them up in our [review system](https://review.typo3.org/#/q/status:merged+project:Packages/TYPO3.CMS+topic:security,n,z).

Ready to get started?

Download TYPO3 CMS for free!

[Download](https://get.typo3.org/)
[Get
more info](https://typo3.org/typo3-cms/overview/)

![TYPO3](/_assets/a686d4200d36973f64d48f0547522f58/Images/Template/typo3_nomargins.svg)

#### Information

* [Decision makers](https://typo3.com/typo3-cms/why-typo3/typo3-for-decision-makers "Why use TYPO3? - Because TYPO3 is the CMS for you!")
* [Users](https://typo3.com/typo3-cms/why-typo3/typo3-for-editing-publishing)
* [Developers](https://typo3.com/typo3-cms/why-typo3/typo3-for-developers)
* [Contact form](/contact)

#### Downloads

* [TYPO3 CMS](https://get.typo3.org "Download and install TYPO3")
* [Extensions for TYPO3](https://extensions.typo3.org "Extend TYPO3 with extensions")

#### Community

* [my.typo3.org](https://my.typo3.org "Log into our community")
* [Slack for TYPO3 community](https://typo3.slack.com "Chat with our community")
* [TYPO3 Code of Conduct](/community/values/code-of-conduct)

#### Popular links

* [Legal Notice](/legal-notice "Legal Notice")
* [TYPO3.com](https://typo3.com "TYPO3.com")
* [TYPO3 Association](/project/association "TYPO3 Association")
* [Privacy Policy](/privacy-policy "Privacy Policy")
* [Social Media Privacy Policy](/social-media-privacy-policy "Social Media Privacy Policy")



=== Content from github.com_d8a44d45_20250114_193348.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTYPO3%2Ftypo3%2Fblob%2Fv11.5.22%2Ftypo3%2Fsysext%2Fcore%2FClasses%2FUtility%2FGeneralUtility.php)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTYPO3%2Ftypo3%2Fblob%2Fv11.5.22%2Ftypo3%2Fsysext%2Fcore%2FClasses%2FUtility%2FGeneralUtility.php)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=TYPO3%2Ftypo3)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[TYPO3](/TYPO3)
/
**[typo3](/TYPO3/typo3)**
Public

* [Notifications](/login?return_to=%2FTYPO3%2Ftypo3) You must be signed in to change notification settings
* [Fork
  674](/login?return_to=%2FTYPO3%2Ftypo3)
* [Star
   1.1k](/login?return_to=%2FTYPO3%2Ftypo3)

* [Code](/TYPO3/typo3/tree/v11.5.22)
* [Pull requests
  0](/TYPO3/typo3/pulls)
* [Actions](/TYPO3/typo3/actions)
* [Projects
  0](/TYPO3/typo3/projects)
* [Security](/TYPO3/typo3/security)
* [Insights](/TYPO3/typo3/pulse)

Additional navigation options

* [Code](/TYPO3/typo3/tree/v11.5.22)
* [Pull requests](/TYPO3/typo3/pulls)
* [Actions](/TYPO3/typo3/actions)
* [Projects](/TYPO3/typo3/projects)
* [Security](/TYPO3/typo3/security)
* [Insights](/TYPO3/typo3/pulse)

## Files

 v11.5.22
## Breadcrumbs

1. [typo3](/TYPO3/typo3/tree/v11.5.22)
2. /[typo3](/TYPO3/typo3/tree/v11.5.22/typo3)
3. /[sysext](/TYPO3/typo3/tree/v11.5.22/typo3/sysext)
4. /[core](/TYPO3/typo3/tree/v11.5.22/typo3/sysext/core)
5. /[Classes](/TYPO3/typo3/tree/v11.5.22/typo3/sysext/core/Classes)
6. /[Utility](/TYPO3/typo3/tree/v11.5.22/typo3/sysext/core/Classes/Utility)
/
# GeneralUtility.php

Copy path Blame  Blame
## Latest commit

## History

[History](/TYPO3/typo3/commits/v11.5.22/typo3/sysext/core/Classes/Utility/GeneralUtility.php)3604 lines (3436 loc) · 157 KB v11.5.22
## Breadcrumbs

1. [typo3](/TYPO3/typo3/tree/v11.5.22)
2. /[typo3](/TYPO3/typo3/tree/v11.5.22/typo3)
3. /[sysext](/TYPO3/typo3/tree/v11.5.22/typo3/sysext)
4. /[core](/TYPO3/typo3/tree/v11.5.22/typo3/sysext/core)
5. /[Classes](/TYPO3/typo3/tree/v11.5.22/typo3/sysext/core/Classes)
6. /[Utility](/TYPO3/typo3/tree/v11.5.22/typo3/sysext/core/Classes/Utility)
/
# GeneralUtility.php

Top
## File metadata and controls

* Code
* Blame

3604 lines (3436 loc) · 157 KB[Raw](https://github.com/TYPO3/typo3/raw/refs/tags/v11.5.22/typo3/sysext/core/Classes/Utility/GeneralUtility.php)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000<?php
/\* \* This file is part of the TYPO3 CMS project. \* \* It is free software; you can redistribute it and/or modify it under \* the terms of the GNU General Public License, either version 2 \* of the License, or any later version. \* \* For the full copyright and license information, please read the \* LICENSE.txt file that was distributed with this source code. \* \* The TYPO3 project - inspiring people to share! \*/
namespace TYPO3\CMS\Core\Utility;
use Egulias\EmailValidator\EmailValidator;use Egulias\EmailValidator\Validation\EmailValidation;use Egulias\EmailValidator\Validation\MultipleValidationWithAnd;use Egulias\EmailValidator\Validation\RFCValidation;use GuzzleHttp\Exception\RequestException;use Psr\Container\ContainerInterface;use Psr\Http\Message\ServerRequestInterface;use Psr\Log\LoggerAwareInterface;use Psr\Log\LoggerInterface;use TYPO3\CMS\Core\Authentication\AbstractAuthenticationService;use TYPO3\CMS\Core\Cache\CacheManager;use TYPO3\CMS\Core\Core\ClassLoadingInformation;use TYPO3\CMS\Core\Core\Environment;use TYPO3\CMS\Core\Http\ApplicationType;use TYPO3\CMS\Core\Http\RequestFactory;use TYPO3\CMS\Core\Log\LogManager;use TYPO3\CMS\Core\Middleware\VerifyHostHeader;use TYPO3\CMS\Core\Package\Exception as PackageException;use TYPO3\CMS\Core\SingletonInterface;
/\*\* \* The legendary "t3lib\_div" class - Miscellaneous functions for general purpose. \* Most of the functions do not relate specifically to TYPO3 \* However a section of functions requires certain TYPO3 features available \* See comments in the source. \* You are encouraged to use this library in your own scripts! \* \* USE: \* All methods in this class are meant to be called statically. \* So use \TYPO3\CMS\Core\Utility\GeneralUtility::[method-name] to refer to the functions, eg. '\TYPO3\CMS\Core\Utility\GeneralUtility::milliseconds()' \*/class GeneralUtility{ /\* @deprecated since v11, will be removed in v12. \*/ public const ENV\_TRUSTED\_HOSTS\_PATTERN\_ALLOW\_ALL = '.\*'; /\* @deprecated since v11, will be removed in v12. \*/ public const ENV\_TRUSTED\_HOSTS\_PATTERN\_SERVER\_NAME = 'SERVER\_NAME';
 /\*\* \* @var ContainerInterface|null \*/ protected static $container;
 /\*\* \* Singleton instances returned by makeInstance, using the class names as \* array keys \* \* @var array<string, SingletonInterface> \*/ protected static $singletonInstances = [];
 /\*\* \* Instances returned by makeInstance, using the class names as array keys \* \* @var array<string, array<object>> \*/ protected static $nonSingletonInstances = [];
 /\*\* \* Cache for makeInstance with given class name and final class names to reduce number of self::getClassName() calls \* \* @var array<string, class-string> Given class name => final class name \*/ protected static $finalClassNameCache = [];
 /\*\* \* @var array<string, string|bool|array<string, string|bool|null>|null> \*/ protected static $indpEnvCache = [];
 final private function \_\_construct() { }
 /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* \* \* GET/POST Variables \* \* Background: \* Input GET/POST variables in PHP may have their quotes escaped with "\" or not depending on configuration. \* TYPO3 has always converted quotes to BE escaped if the configuration told that they would not be so. \* But the clean solution is that quotes are never escaped and that is what the functions below offers. \* Eventually TYPO3 should provide this in the global space as well. \* In the transitional phase (or forever..?) we need to encourage EVERY to read and write GET/POST vars through the API functions below. \* This functionality was previously needed to normalize between magic quotes logic, which was removed from PHP 5.4, \* so these methods are still in use, but not tackle the slash problem anymore. \* \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ /\*\* \* Returns the 'GLOBAL' value of incoming data from POST or GET, with priority to POST, which is equivalent to 'GP' order \* In case you already know by which method your data is arriving consider using GeneralUtility::\_GET or GeneralUtility::\_POST. \* \* @param string $var GET/POST var to return \* @return mixed POST var named $var, if not set, the GET var of the same name and if also not set, NULL. \*/ public static function \_GP($var) { if (empty($var)) { return; }
 $value = $\_POST[$var] ?? $\_GET[$var] ?? null;
 // This is there for backwards-compatibility, in order to avoid NULL if (isset($value) && !is\_array($value)) { $value = (string)$value; } return $value; }
 /\*\* \* Returns the global arrays $\_GET and $\_POST merged with $\_POST taking precedence. \* \* @param string $parameter Key (variable name) from GET or POST vars \* @return array Returns the GET vars merged recursively onto the POST vars. \*/ public static function \_GPmerged($parameter) { $postParameter = isset($\_POST[$parameter]) && is\_array($\_POST[$parameter]) ? $\_POST[$parameter] : []; $getParameter = isset($\_GET[$parameter]) && is\_array($\_GET[$parameter]) ? $\_GET[$parameter] : []; $mergedParameters = $getParameter; ArrayUtility::mergeRecursiveWithOverrule($mergedParameters, $postParameter); return $mergedParameters; }
 /\*\* \* Returns the global $\_GET array (or value from) normalized to contain un-escaped values. \* This function was previously used to normalize between magic quotes logic, which was removed from PHP 5.5 \* \* @param string $var Optional pointer to value in GET array (basically name of GET var) \* @return mixed If $var is set it returns the value of $\_GET[$var]. If $var is NULL (default), returns $\_GET itself. \* @see \_POST() \* @see \_GP() \*/ public static function \_GET($var = null) { $value = $var === null ? $\_GET : (empty($var) ? null : ($\_GET[$var] ?? null)); // This is there for backwards-compatibility, in order to avoid NULL if (isset($value) && !is\_array($value)) { $value = (string)$value; } return $value; }
 /\*\* \* Returns the global $\_POST array (or value from) normalized to contain un-escaped values. \* \* @param string $var Optional pointer to value in POST array (basically name of POST var) \* @return mixed If $var is set it returns the value of $\_POST[$var]. If $var is NULL (default), returns $\_POST itself. \* @see \_GET() \* @see \_GP() \*/ public static function \_POST($var = null) { $value = $var === null ? $\_POST : (empty($var) || !isset($\_POST[$var]) ? null : $\_POST[$var]); // This is there for backwards-compatibility, in order to avoid NULL if (isset($value) && !is\_array($value)) { $value = (string)$value; } return $value; }
 /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* \* \* STRING FUNCTIONS \* \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ /\*\* \* Truncates a string with appended/prepended "..." and takes current character set into consideration. \* \* @param string $string String to truncate \* @param int $chars Must be an integer with an absolute value of at least 4. if negative the string is cropped from the right end. \* @param string $appendString Appendix to the truncated string \* @return string Cropped string \* @todo Add strict types and return types as breaking change in v12. \*/ public static function fixed\_lgd\_cs($string, $chars, $appendString = '...') { $string = (string)$string; if ((int)$chars === 0 || mb\_strlen($string, 'utf-8') <= abs($chars)) { return $string; } if ($chars > 0) { $string = mb\_substr($string, 0, $chars, 'utf-8') . $appendString; } else { $string = $appendString . mb\_substr($string, $chars, mb\_strlen($string, 'utf-8'), 'utf-8'); } return $string; }
 /\*\* \* Match IP number with list of numbers with wildcard \* Dispatcher method for switching into specialised IPv4 and IPv6 methods. \* \* @param string $baseIP Is the current remote IP address for instance, typ. REMOTE\_ADDR \* @param string $list Is a comma-list of IP-addresses to match with. CIDR-notation should be used. For IPv4 addresses only, the \*-wildcard is also allowed instead of number, plus leaving out parts in the IP number is accepted as wildcard (eg. 192.168.\*.\* equals 192.168). If list is "\*" no check is done and the function returns TRUE immediately. An empty list always returns FALSE. \* @return bool TRUE if an IP-mask from $list matches $baseIP \*/ public static function cmpIP($baseIP, $list) { $list = trim($list); if ($list === '') { return false; } if ($list === '\*') { return true; } if (str\_contains($baseIP, ':') && self::validIPv6($baseIP)) { return self::cmpIPv6($baseIP, $list); } return self::cmpIPv4($baseIP, $list); }
 /\*\* \* Match IPv4 number with list of numbers with wildcard \* \* @param string $baseIP Is the current remote IP address for instance, typ. REMOTE\_ADDR \* @param string $list Is a comma-list of IP-addresses to match with. CIDR-notation, \*-wildcard allowed instead of number, plus leaving out parts in the IP number is accepted as wildcard (eg. 192.168.0.0/16 equals 192.168.\*.\* equals 192.168), could also contain IPv6 addresses \* @return bool TRUE if an IP-mask from $list matches $baseIP \*/ public static function cmpIPv4($baseIP, $list) { $IPpartsReq = explode('.', $baseIP); if (count($IPpartsReq) === 4) { $values = self::trimExplode(',', $list, true); foreach ($values as $test) { $testList = explode('/', $test); if (count($testList) === 2) { [$test, $mask] = $testList; } else { $mask = false; } if ((int)$mask) { $mask = (int)$mask; // "192.168.3.0/24" $lnet = (int)ip2long($test); $lip = (int)ip2long($baseIP); $binnet = str\_pad(decbin($lnet), 32, '0', STR\_PAD\_LEFT); $firstpart = substr($binnet, 0, $mask); $binip = str\_pad(decbin($lip), 32, '0', STR\_PAD\_LEFT); $firstip = substr($binip, 0, $mask); $yes = $firstpart === $firstip; } else { // "192.168.\*.\*" $IPparts = explode('.', $test); $yes = 1; foreach ($IPparts as $index => $val) { $val = trim($val); if ($val !== '\*' && $IPpartsReq[$index] !== $val) { $yes = 0; } } } if ($yes) { return true; } } } return false; }
 /\*\* \* Match IPv6 address with a list of IPv6 prefixes \* \* @param string $baseIP Is the current remote IP address for instance \* @param string $list Is a comma-list of IPv6 prefixes, could also contain IPv4 addresses. IPv6 addresses \* must be specified in CIDR-notation, not with \* wildcard, otherwise self::validIPv6() will fail. \* @return bool TRUE If a baseIP matches any prefix \*/ public static function cmpIPv6($baseIP, $list) { // Policy default: Deny connection $success = false; $baseIP = self::normalizeIPv6($baseIP); $values = self::trimExplode(',', $list, true); foreach ($values as $test) { $testList = explode('/', $test); if (count($testList) === 2) { [$test, $mask] = $testList; } else { $mask = false; } if (self::validIPv6($test)) { $test = self::normalizeIPv6($test); $maskInt = (int)$mask ?: 128; // Special case; /0 is an allowed mask - equals a wildcard if ($mask === '0') { $success = true; } elseif ($maskInt == 128) { $success = $test === $baseIP; } else { $testBin = (string)inet\_pton($test); $baseIPBin = (string)inet\_pton($baseIP);
 $success = true; // Modulo is 0 if this is a 8-bit-boundary $maskIntModulo = $maskInt % 8; $numFullCharactersUntilBoundary = (int)($maskInt / 8); $substring = (string)substr($baseIPBin, 0, $numFullCharactersUntilBoundary); if (strpos($testBin, $substring) !== 0) { $success = false; } elseif ($maskIntModulo > 0) { // If not an 8-bit-boundary, check bits of last character $testLastBits = str\_pad(decbin(ord(substr($testBin, $numFullCharactersUntilBoundary, 1))), 8, '0', STR\_PAD\_LEFT); $baseIPLastBits = str\_pad(decbin(ord(substr($baseIPBin, $numFullCharactersUntilBoundary, 1))), 8, '0', STR\_PAD\_LEFT); if (strncmp($testLastBits, $baseIPLastBits, $maskIntModulo) != 0) { $success = false; } } } } if ($success) { return true; } } return false; }
 /\*\* \* Normalize an IPv6 address to full length \* \* @param string $address Given IPv6 address \* @return string Normalized address \*/ public static function normalizeIPv6($address) { $normalizedAddress = ''; // According to RFC lowercase-representation is recommended $address = strtolower($address); // Normalized representation has 39 characters (0000:0000:0000:0000:0000:0000:0000:0000) if (strlen($address) === 39) { // Already in full expanded form return $address; } // Count 2 if if address has hidden zero blocks $chunks = explode('::', $address); if (count($chunks) === 2) { $chunksLeft = explode(':', $chunks[0]); $chunksRight = explode(':', $chunks[1]); $left = count($chunksLeft); $right = count($chunksRight); // Special case: leading zero-only blocks count to 1, should be 0 if ($left === 1 && strlen($chunksLeft[0]) === 0) { $left = 0; } $hiddenBlocks = 8 - ($left + $right); $hiddenPart = ''; $h = 0; while ($h < $hiddenBlocks) { $hiddenPart .= '0000:'; $h++; } if ($left === 0) { $stageOneAddress = $hiddenPart . $chunks[1]; } else { $stageOneAddress = $chunks[0] . ':' . $hiddenPart . $chunks[1]; } } else { $stageOneAddress = $address; } // Normalize the blocks: $blocks = explode(':', $stageOneAddress); $divCounter = 0; foreach ($blocks as $block) { $tmpBlock = ''; $i = 0; $hiddenZeros = 4 - strlen($block); while ($i < $hiddenZeros) { $tmpBlock .= '0'; $i++; } $normalizedAddress .= $tmpBlock . $block; if ($divCounter < 7) { $normalizedAddress .= ':'; $divCounter++; } } return $normalizedAddress; }
 /\*\* \* Validate a given IP address. \* \* Possible format are IPv4 and IPv6. \* \* @param string $ip IP address to be tested \* @return bool TRUE if $ip is either of IPv4 or IPv6 format. \*/ public static function validIP($ip) { return filter\_var($ip, FILTER\_VALIDATE\_IP) !== false; }
 /\*\* \* Validate a given IP address to the IPv4 address format. \* \* Example for possible format: 10.0.45.99 \* \* @param string $ip IP address to be tested \* @return bool TRUE if $ip is of IPv4 format. \*/ public static function validIPv4($ip) { return filter\_var($ip, FILTER\_VALIDATE\_IP, FILTER\_FLAG\_IPV4) !== false; }
 /\*\* \* Validate a given IP address to the IPv6 address format. \* \* Example for possible format: 43FB::BB3F:A0A0:0 | ::1 \* \* @param string $ip IP address to be tested \* @return bool TRUE if $ip is of IPv6 format. \*/ public static function validIPv6($ip) { return filter\_var($ip, FILTER\_VALIDATE\_IP, FILTER\_FLAG\_IPV6) !== false; }
 /\*\* \* Match fully qualified domain name with list of strings with wildcard \* \* @param string $baseHost A hostname or an IPv4/IPv6-address (will by reverse-resolved; typically REMOTE\_ADDR) \* @param string $list A comma-list of domain names to match with. \*-wildcard allowed but cannot be part of a string, so it must match the full host name (eg. myhost.\*.com => correct, myhost.\*domain.com => wrong) \* @return bool TRUE if a domain name mask from $list matches $baseIP \*/ public static function cmpFQDN($baseHost, $list) { $baseHost = trim($baseHost); if (empty($baseHost)) { return false; } if (self::validIPv4($baseHost) || self::validIPv6($baseHost)) { // Resolve hostname // Note: this is reverse-lookup and can be randomly set as soon as somebody is able to set // the reverse-DNS for his IP (security when for example used with REMOTE\_ADDR) $baseHostName = (string)gethostbyaddr($baseHost); if ($baseHostName === $baseHost) { // Unable to resolve hostname return false; } } else { $baseHostName = $baseHost; } $baseHostNameParts = explode('.', $baseHostName); $values = self::trimExplode(',', $list, true); foreach ($values as $test) { $hostNameParts = explode('.', $test); // To match hostNameParts can only be shorter (in case of wildcards) or equal $hostNamePartsCount = count($hostNameParts); $baseHostNamePartsCount = count($baseHostNameParts); if ($hostNamePartsCount > $baseHostNamePartsCount) { continue; } $yes = true; foreach ($hostNameParts as $index => $val) { $val = trim($val); if ($val === '\*') { // Wildcard valid for one or more hostname-parts $wildcardStart = $index + 1; // Wildcard as last/only part always matches, otherwise perform recursive checks if ($wildcardStart < $hostNamePartsCount) { $wildcardMatched = false; $tempHostName = implode('.', array\_slice($hostNameParts, $index + 1)); while ($wildcardStart < $baseHostNamePartsCount && !$wildcardMatched) { $tempBaseHostName = implode('.', array\_slice($baseHostNameParts, $wildcardStart)); $wildcardMatched = self::cmpFQDN($tempBaseHostName, $tempHostName); $wildcardStart++; } if ($wildcardMatched) { // Match found by recursive compare return true; } $yes = false; } } elseif ($baseHostNameParts[$index] !== $val) { // In case of no match $yes = false; } } if ($yes) { return true; } } return false; }
 /\*\* \* Checks if a given URL matches the host that currently handles this HTTP request. \* Scheme, hostname and (optional) port of the given URL are compared. \* \* @param string $url URL to compare with the TYPO3 request host \* @return bool Whether the URL matches the TYPO3 request host \*/ public static function isOnCurrentHost($url) { return stripos($url . '/', self::getIndpEnv('TYPO3\_REQUEST\_HOST') . '/') === 0; }
 /\*\* \* Check for item in list \* Check if an item exists in a comma-separated list of items. \* \* @param string $list Comma-separated list of items (string) \* @param string $item Item to check for \* @return bool TRUE if $item is in $list \*/ public static function inList($list, $item) { return str\_contains(',' . $list . ',', ',' . $item . ','); }
 /\*\* \* Removes an item from a comma-separated list of items. \* \* If $element contains a comma, the behaviour of this method is undefined. \* Empty elements in the list are preserved. \* \* @param string $element Element to remove \* @param string $list Comma-separated list of items (string) \* @return string New comma-separated list of items \* @deprecated since v11, will be removed in v12. \*/ public static function rmFromList($element, $list) { trigger\_error( 'GeneralUtility::rmFromList() is deprecated and will be removed in v12.', E\_USER\_DEPRECATED );
 $items = explode(',', $list); foreach ($items as $k => $v) { if ($v == $element) { unset($items[$k]); } } return implode(',', $items); }
 /\*\* \* Expand a comma-separated list of integers with ranges (eg 1,3-5,7 becomes 1,3,4,5,7). \* Ranges are limited to 1000 values per range. \* \* @param string $list Comma-separated list of integers with ranges (string) \* @return string New comma-separated list of items \*/ public static function expandList($list) { $items = explode(',', $list); $list = []; foreach ($items as $item) { $range = explode('-', $item); if (isset($range[1])) { $runAwayBrake = 1000; for ($n = $range[0]; $n <= $range[1]; $n++) { $list[] = $n; $runAwayBrake--; if ($runAwayBrake <= 0) { break; } } } else { $list[] = $item; } } return implode(',', $list); }
 /\*\* \* Makes a positive integer hash out of the first 7 chars from the md5 hash of the input \* \* @param string $str String to md5-hash \* @return int Returns 28bit integer-hash \*/ public static function md5int($str) { return hexdec(substr(md5($str), 0, 7)); }
 /\*\* \* Returns the first 10 positions of the MD5-hash (changed from 6 to 10 recently) \* \* @param string $input Input string to be md5-hashed \* @param int $len The string-length of the output \* @return string Substring of the resulting md5-hash, being $len chars long (from beginning) \* @deprecated since v11, will be removed in v12. \*/ public static function shortMD5($input, $len = 10) { trigger\_error(\_\_METHOD\_\_ . ' will be removed in TYPO3 v12, use md5() instead.', E\_USER\_DEPRECATED); return substr(md5($input), 0, $len); }
 /\*\* \* Returns a proper HMAC on a given input string and secret TYPO3 encryption key. \* \* @param string $input Input string to create HMAC from \* @param string $additionalSecret additionalSecret to prevent hmac being used in a different context \* @return string resulting (hexadecimal) HMAC currently with a length of 40 (HMAC-SHA-1) \*/ public static function hmac($input, $additionalSecret = '') { $hashAlgorithm = 'sha1'; $hashBlocksize = 64; $secret = $GLOBALS['TYPO3\_CONF\_VARS']['SYS']['encryptionKey'] . $additionalSecret; if (extension\_loaded('hash') && function\_exists('hash\_hmac') && function\_exists('hash\_algos') && in\_array($hashAlgorithm, hash\_algos())) { $hmac = hash\_hmac($hashAlgorithm, $input, $secret); } else { // Outer padding $opad = str\_repeat(chr(92), $hashBlocksize); // Inner padding $ipad = str\_repeat(chr(54), $hashBlocksize); if (strlen($secret) > $hashBlocksize) { // Keys longer than block size are shorten $key = str\_pad(pack('H\*', $hashAlgorithm($secret)), $hashBlocksize, "\0"); } else { // Keys shorter than block size are zero-padded $key = str\_pad($secret, $hashBlocksize, "\0"); } $hmac = $hashAlgorithm(($key ^ $opad) . pack('H\*', $hashAlgorithm(($key ^ $ipad) . $input))); } return $hmac; }
 /\*\* \* Takes comma-separated lists and arrays and removes all duplicates \* If a value in the list is trim(empty), the value is ignored. \* \* @param string $in\_list Accept multiple parameters which can be comma-separated lists of values and arrays. \* @param mixed $secondParameter Dummy field, which if set will show a warning! \* @return string Returns the list without any duplicates of values, space around values are trimmed \* @deprecated since TYPO3 v11, will be removed in TYPO3 v12. Use StringUtility::uniqueList() instead. \*/ public static function uniqueList($in\_list, $secondParameter = null) { trigger\_error( 'GeneralUtility::uniqueList() is deprecated and will be removed in v12. Use StringUtility::uniqueList() instead.', E\_USER\_DEPRECATED ); if (is\_array($in\_list)) { throw new \InvalidArgumentException('TYPO3 Fatal Error: TYPO3\\CMS\\Core\\Utility\\GeneralUtility::uniqueList() does NOT support array arguments anymore! Only string comma lists!', 1270853885); } if (isset($secondParameter)) { throw new \InvalidArgumentException('TYPO3 Fatal Error: TYPO3\\CMS\\Core\\Utility\\GeneralUtility::uniqueList() does NOT support more than a single argument value anymore. You have specified more than one!', 1270853886); } return implode(',', array\_unique(self::trimExplode(',', $in\_list, true))); }
 /\*\* \* Splits a reference to a file in 5 parts \* \* @param string $fileNameWithPath File name with path to be analyzed (must exist if open\_basedir is set) \* @return array<string, string> Contains keys [path], [file], [filebody], [fileext], [realFileext] \*/ public static function split\_fileref($fileNameWithPath) { $info = []; $reg = []; if (preg\_match('/(.\*\\/)(.\*)$/', $fileNameWithPath, $reg)) { $info['path'] = $reg[1]; $info['file'] = $reg[2]; } else { $info['path'] = ''; $info['file'] = $fileNameWithPath; } $reg = ''; // If open\_basedir is set and the fileName was supplied without a path the is\_dir check fails if (!is\_dir($fileNameWithPath) && preg\_match('/(.\*)\\.([^\\.]\*$)/', $info['file'], $reg)) { $info['filebody'] = $reg[1]; $info['fileext'] = strtolower($reg[2]); $info['realFileext'] = $reg[2]; } else { $info['filebody'] = $info['file']; $info['fileext'] = ''; } reset($info); return $info; }
 /\*\* \* Returns the directory part of a path without trailing slash \* If there is no dir-part, then an empty string is returned. \* Behaviour: \* \* '/dir1/dir2/script.php' => '/dir1/dir2' \* '/dir1/' => '/dir1' \* 'dir1/script.php' => 'dir1' \* 'd/script.php' => 'd' \* '/script.php' => '' \* '' => '' \* \* @param string $path Directory name / path \* @return string Processed input value. See function description. \*/ public static function dirname($path) { $p = self::revExplode('/', $path, 2); return count($p) === 2 ? $p[0] : ''; }
 /\*\* \* Returns TRUE if the first part of $str matches the string $partStr \* \* @param string $str Full string to check \* @param string $partStr Reference string which must be found as the "first part" of the full string \* @return bool TRUE if $partStr was found to be equal to the first part of $str \* @deprecated will be removed in TYPO3 v12.0. Use native PHP str\_starts\_with() with proper casting instead. \*/ public static function isFirstPartOfStr($str, $partStr) { trigger\_error('GeneralUtility::isFirstPartOfStr() will be removed in TYPO3 v12.0. Use PHPs str\_starts\_with() function instead.', E\_USER\_DEPRECATED); $str = is\_array($str) ? '' : (string)$str; $partStr = is\_array($partStr) ? '' : (string)$partStr; return $partStr !== '' && strpos($str, $partStr, 0) === 0; }
 /\*\* \* Formats the input integer $sizeInBytes as bytes/kilobytes/megabytes (-/K/M) \* \* @param int $sizeInBytes Number of bytes to format. \* @param string $labels Binary unit name "iec", decimal unit name "si" or labels for bytes, kilo, mega, giga, and so on separated by vertical bar (|) and possibly encapsulated in "". Eg: " | K| M| G". Defaults to "iec". \* @param int $base The unit base if not using a unit name. Defaults to 1024. \* @return string Formatted representation of the byte number, for output. \*/ public static function formatSize($sizeInBytes, $labels = '', $base = 0) { $defaultFormats = [ 'iec' => ['base' => 1024, 'labels' => [' ', ' Ki', ' Mi', ' Gi', ' Ti', ' Pi', ' Ei', ' Zi', ' Yi']], 'si' => ['base' => 1000, 'labels' => [' ', ' k', ' M', ' G', ' T', ' P', ' E', ' Z', ' Y']], ]; // Set labels and base: if (empty($labels)) { $labels = 'iec'; } if (isset($defaultFormats[$labels])) { $base = $defaultFormats[$labels]['base']; $labelArr = $defaultFormats[$labels]['labels']; } else { $base = (int)$base; if ($base !== 1000 && $base !== 1024) { $base = 1024; } $labelArr = explode('|', str\_replace('"', '', $labels)); } // This is set via Site Handling and in the Locales class via setlocale() $localeInfo = localeconv(); $sizeInBytes = max($sizeInBytes, 0); $multiplier = floor(($sizeInBytes ? log($sizeInBytes) : 0) / log($base)); $sizeInUnits = $sizeInBytes / $base \*\* $multiplier; if ($sizeInUnits > ($base \* .9)) { $multiplier++; } $multiplier = min($multiplier, count($labelArr) - 1); $sizeInUnits = $sizeInBytes / $base \*\* $multiplier; return number\_format($sizeInUnits, (($multiplier > 0) && ($sizeInUnits < 20)) ? 2 : 0, $localeInfo['decimal\_point'], '') . $labelArr[$multiplier]; }
 /\*\* \* This splits a string by the chars in $operators (typical /+-\*) and returns an array with them in \* \* @param string $string Input string, eg "123 + 456 / 789 - 4 \* @param string $operators Operators to split by, typically "/+-\* \* @return array<int, array<int, string>> Array with operators and operands separated. \* @see \TYPO3\CMS\Frontend\ContentObject\ContentObjectRenderer::calc() \* @see \TYPO3\CMS\Frontend\Imaging\GifBuilder::calcOffset() \*/ public static function splitCalc($string, $operators) { $res = []; $sign = '+'; while ($string) { $valueLen = strcspn($string, $operators); $value = substr($string, 0, $valueLen); $res[] = [$sign, trim($value)]; $sign = substr($string, $valueLen, 1); $string = substr($string, $valueLen + 1); } reset($res); return $res; }
 /\*\* \* Checking syntax of input email address \* \* @param string $email Input string to evaluate \* @return bool Returns TRUE if the $email address (input string) is valid \*/ public static function validEmail($email) { // Early return in case input is not a string if (!is\_string($email)) { return false; } if (trim($email) !== $email) { return false; } if (!str\_contains($email, '@')) { return false; } $validators = []; foreach ($GLOBALS['TYPO3\_CONF\_VARS']['MAIL']['validators'] ?? [RFCValidation::class] as $className) { $validator = new $className(); if ($validator instanceof EmailValidation) { $validators[] = $validator; } } return (new EmailValidator())->isValid($email, new MultipleValidationWithAnd($validators, MultipleValidationWithAnd::STOP\_ON\_ERROR)); }
 /\*\* \* Returns a given string with underscores as UpperCamelCase. \* Example: Converts blog\_example to BlogExample \* \* @param string $string String to be converted to camel case \* @return string UpperCamelCasedWord \*/ public static function underscoredToUpperCamelCase($string) { return str\_replace(' ', '', ucwords(str\_replace('\_', ' ', strtolower($string)))); }
 /\*\* \* Returns a given string with underscores as lowerCamelCase. \* Example: Converts minimal\_value to minimalValue \* \* @param string $string String to be converted to camel case \* @return string lowerCamelCasedWord \*/ public static function underscoredToLowerCamelCase($string) { return lcfirst(str\_replace(' ', '', ucwords(str\_replace('\_', ' ', strtolower($string))))); }
 /\*\* \* Returns a given CamelCasedString as a lowercase string with underscores. \* Example: Converts BlogExample to blog\_example, and minimalValue to minimal\_value \* \* @param string $string String to be converted to lowercase underscore \* @return string lowercase\_and\_underscored\_string \*/ public static function camelCaseToLowerCaseUnderscored($string) { $value = preg\_replace('/(?<=\\w)([A-Z])/', '\_\\1', $string) ?? ''; return mb\_strtolower($value, 'utf-8'); }
 /\*\* \* Checks if a given string is a Uniform Resource Locator (URL). \* \* On seriously malformed URLs, parse\_url may return FALSE and emit an \* E\_WARNING. \* \* filter\_var() requires a scheme to be present. \* \* http://www.faqs.org/rfcs/rfc2396.html \* Scheme names consist of a sequence of characters beginning with a \* lower case letter and followed by any combination of lower case letters, \* digits, plus ("+"), period ("."), or hyphen ("-"). For resiliency, \* programs interpreting URI should treat upper case letters as equivalent to \* lower case in scheme names (e.g., allow "HTTP" as well as "http"). \* scheme = alpha \*( alpha | digit | "+" | "-" | "." ) \* \* Convert the domain part to punicode if it does not look like a regular \* domain name. Only the domain part because RFC3986 specifies the the rest of \* the url may not contain special characters: \* https://tools.ietf.org/html/rfc3986#appendix-A \* \* @param string $url The URL to be validated \* @return bool Whether the given URL is valid \*/ public static function isValidUrl($url) { $parsedUrl = parse\_url($url); if (!$parsedUrl || !isset($parsedUrl['scheme'])) { return false; } // HttpUtility::buildUrl() will always build urls with <scheme>:// // our original $url might only contain <scheme>: (e.g. mail:) // so we convert that to the double-slashed version to ensure // our check against the $recomposedUrl is proper if (!str\_starts\_with($url, $parsedUrl['scheme'] . '://')) { $url = str\_replace($parsedUrl['scheme'] . ':', $parsedUrl['scheme'] . '://', $url); } $recomposedUrl = HttpUtility::buildUrl($parsedUrl); if ($recomposedUrl !== $url) { // The parse\_url() had to modify characters, so the URL is invalid return false; } if (isset($parsedUrl['host']) && !preg\_match('/^[a-z0-9.\\-]\*$/i', $parsedUrl['host'])) { $host = idn\_to\_ascii($parsedUrl['host']); if ($host === false) { return false; } $parsedUrl['host'] = $host; } return filter\_var(HttpUtility::buildUrl($parsedUrl), FILTER\_VALIDATE\_URL) !== false; }
 /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* \* \* ARRAY FUNCTIONS \* \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/
 /\*\* \* Explodes a $string delimited by $delimiter and casts each item in the array to (int). \* Corresponds to \TYPO3\CMS\Core\Utility\GeneralUtility::trimExplode(), but with conversion to integers for all values. \* \* @param string $delimiter Delimiter string to explode with \* @param string $string The string to explode \* @param bool $removeEmptyValues If set, all empty values (='') will NOT be set in output \* @param int $limit If positive, the result will contain a maximum of limit elements, \* @return int[] Exploded values, all converted to integers \*/ public static function intExplode($delimiter, $string, $removeEmptyValues = false, $limit = 0) { $result = explode($delimiter, $string) ?: []; foreach ($result as $key => &$value) { if ($removeEmptyValues && ($value === '' || trim($value) === '')) { unset($result[$key]); } else { $value = (int)$value; } } unset($value); if ($limit !== 0) { if ($limit < 0) { $result = array\_slice($result, 0, $limit); } elseif (count($result) > $limit) { $lastElements = array\_slice($result, $limit - 1); $result = array\_slice($result, 0, $limit - 1); $result[] = implode($delimiter, $lastElements); } } return $result; }
 /\*\* \* Reverse explode which explodes the string counting from behind. \* \* Note: The delimiter has to given in the reverse order as \* it is occurring within the string. \* \* GeneralUtility::revExplode('[]', '[my][words][here]', 2) \* ==> array('[my][words', 'here]') \* \* @param string $delimiter Delimiter string to explode with \* @param string $string The string to explode \* @param int $count Number of array entries \* @return string[] Exploded values \*/ public static function revExplode($delimiter, $string, $count = 0) { // 2 is the (currently, as of 2014-02) most-used value for $count in the core, therefore we check it first if ($count === 2) { $position = strrpos($string, strrev($delimiter)); if ($position !== false) { return [substr($string, 0, $position), substr($string, $position + strlen($delimiter))]; } return [$string]; } if ($count <= 1) { return [$string]; } $explodedValues = explode($delimiter, strrev($string), $count) ?: []; $explodedValues = array\_map('strrev', $explodedValues); return array\_reverse($explodedValues); }
 /\*\* \* Explodes a string and removes whitespace-only values. \* \* If $removeEmptyValues is set, then all values that contain only whitespace are removed. \* \* Each item will have leading and trailing whitespace removed. However, if the tail items are \* returned as a single array item, their internal whitespace will not be modified. \* \* @param string $delim Delimiter string to explode with \* @param string $string The string to explode \* @param bool $removeEmptyValues If set, all empty values will be removed in output \* @param int $limit If limit is set and positive, the returned array will contain a maximum of limit elements with[View remainder of file in raw view](https://github.com/TYPO3/typo3/raw/refs/tags/v11.5.22/typo3/sysext/core/Classes/Utility/GeneralUtility.php)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from typo3.org_0c3b9d58_20250114_193356.html ===


![](//piwik.typo3.org/piwik.php?idsite=2&rec=1)

![](/_assets/a686d4200d36973f64d48f0547522f58/Images/typo3_logo.svg)

[![TYPO3 Logo](/_assets/a686d4200d36973f64d48f0547522f58/Images/Template/typo3_nomargins.svg "Go to the start page")](/ "Go to the start page")

* [TYPO3 CMS](/cms "Open menu for TYPO3 CMS")
  + [Features](/cms/features "TYPO3 delivers flexible fast content powered by an enterprise open-source CMS. It’s backed by a vibrant professional community and commercial ecosystem.")
    - [Smart Content Management](/cms/features/smart-content-management)
    - [Secure Performant Scalable](/cms/features/secure-performant-scalable)
    - [Universal Frontend User Experience](/cms/features/frontend-experience)
    - [Professional Open Source](/cms/features/professional-open-source)
    - [Open Extensible Customizable](/cms/features/open-extensible-customizable)
    - [Digital Marketing Enabled](/cms/features/digital-marketing-enabled)
    - [Massively Multisite Multilingual](/cms/features/massively-multisite-multilingual)
  + [Development Roadmap](/cms/roadmap "The TYPO3 CMS development roadmap follows an 18-month release cycle for Long Term Support versions. ")
    - [TYPO3 Development Roadmap](/cms/roadmap)
    - [Maintenance Releases Schedule](/cms/roadmap/maintenance-releases)
  + [Strategy](/cms/strategy)
  + [Core Development](/community/teams/typo3-development)
  + [Release News](/cms/release-news)
    - [TYPO3 11 Release Notes](/cms/release-news/typo3-11-release-notes)
    - [TYPO3 10 Release Notes](/cms/release-news/typo3-10-release-notes)
    - [TYPO3 9 Release Notes](/cms/release-news/typo3-9-release-notes)
    - [TYPO3 8 Release Notes](/cms/release-news/typo3-8-release-notes)
    - [TYPO3 7 Release Notes](/cms/roadmap/typo3-7-release-notes)
  + [Documentation](/help/documentation)
  + [Comparison Cards](/cms/comparison-cards "Super charge your sales presentations with fact-based comparisons between TYPO3 and other products and features.")
  + [System Requirements](https://get.typo3.org/version/#system-requirements "It doesn't take a degree in engineering to get TYPO3 up an running. Find the facts and figures you need to get started with your first project.")
  + [Download & Install](https://get.typo3.org "To test the TYPO3 Introduction Package on your local computer, download the sources and install the Introduction Package from a distribution.")
  + [Getting Started](https://docs.typo3.org/Home/GettingStarted.html)
  + [Fluid Template Engine](/fluid)
* [Community](/community "Open menu for Community")
  + [Events](/community/events "You can take part in official events organized by the TYPO3 Association, events organized by the TYPO3 community, and events where TYPO3 participates.")
  + [Meet the Community](/community/meet "Online, at events, or in user groups. There are many ways to meet us.")
    - [Communicate: Where and how](/community/meet/communicate)
    - [User Groups](/community/meet/user-groups)
    - [StackOverflow](https://stackoverflow.com/questions/tagged/typo3)
    - [Forum](https://talk.typo3.org)
    - [Chat (Slack)](/community/meet/chat-slack)
    - [how to use Slack](/community/meet/how-to-use-slack-in-the-typo3-community)
    - [Regular Open Sprints](/community/meet/regular-open-sprints)
    - [You, me, and TYPO3!](/community/meet/you-me-and-typo3)
  + [Contribute / Get Involved](/community/contribute)
    - [TYPO3 remote days](/community/contribute/typo3-remote-days)
    - [Become an Association Member](/project/association/membership)
    - [Get your My TYPO3 account](/community/contribute/get-your-typo3org-community-account)
    - [Donate](/community/contribute/donate)
    - [Mentorship](/community/contribute/mentorship)
    - [Community Writers Program](/community/contribute/community-writers)
  + [Teams & Committees](/community/teams "The teams and committees of the TYPO3 community take on tasks within specific areas, such as core development, education, communication and security. ")
    - [TYPO3 Development](/community/teams/typo3-development)
    - [Academic](/community/teams/academic-committee)
    - [Accessibility](/community/teams/accessibility)
    - [Best Practices](/community/teams/best-practices)
    - [Communication Coordination](/community/teams/communication-coordination)
    - [Community Expansion](/community/teams/community-expansion)
    - [Content](/community/teams/content)
    - [Content Types](/community/teams/structured-content)
    - [Documentation](/community/teams/documentation)
    - [Education & Certification](/community/teams/education-certification)
    - [Localization](/community/teams/localization)
    - [Marketing](/community/teams/marketing)
    - [Ombudsperson](/community/teams/ombudsperson)
    - [Security](/community/teams/security)
    - [Server](/community/teams/server-team)
    - [TYPO3 CMS Product Strategy Group](/community/teams/typo3-cms-strategy-group)
    - [typo3.org website](/community/teams/typo3org)
    - [User Experience (UX)](/community/teams/user-experience-ux)
  + [Values and Proceedings](/community/values "TYPO3 is more than just a piece of software. It is a community. Our values guide our work and make sure the community is a great place for everyone.")
    - [Code of Conduct](/community/values/code-of-conduct)
    - [Community Mediation](/community/values/mediation)
    - [Conflict of Interest Policy](/community/values/conflict-of-interest-policy)
    - [Social Media Guidelines](/community/values/social-media-guidelines)
    - [Decision-Making Processes, Contribution and Participation](/community/values/decision-making-processes-contribution-and-participation)
    - [Open Web Manifesto](/community/values/open-web-manifesto)
    - [Policy for Committees & Official Teams](/community/values/policy-for-committees-official-teams)
    - [Usage of Titles](/community/values/usage-of-titles)
    - [Vision, Mission, Purpose](/community/values/vision-mission-purpose/project)
  + [Team Leader Meetings](/community/team-leader-meetings)
  + [Data Protection Corner](/community/dataprotection-corner)
    - [Training for the TYPO3 teams](/community/dataprotection-corner/training-for-the-typo3-teams)
  + [Services](/community/services "Get an overview about our TYPO3 services for our community (Git, trouble ticketsystems, infrastructure, LDAP, OTRS, Gerrit). ")
    - [e-mail-addresses](/community/services/e-mail-addresses)
* [The Project](/project "Open menu for The Project")
  + [News](/project/news "Read the latest news about TYPO3 CMS and the association and community supporting the word's most popular enterprise-level content management system.")
    - [RSS feed](https://typo3.org/rss)
    - [Security Advisories](/help/security-advisories)
    - [This Month in TYPO3](/project/news/this-month-in-typo3)
    - [Podcast](/project/news/podcast)
  + [Our Products](/project/products "TYPO3 CMS is our most important product. Fluid is a templating engine and Surf a deployment tool. They help deliver groundbreaking technology in TYPO3 CMS.")
  + [TYPO3 Association](/project/association "The TYPO3 Association is a not-for-profit membership organization that coordinates and funds the long-term development of the TYPO3 CMS platform. ")
    - [Become a Member](/project/association/membership)
    - [Our Members](/project/association/members)
    - [Structure](/project/association/structure)
    - [Association News](/project/association/association-news)
    - [Partnerships](/project/association/partnerships)
    - [Funding & Finances](/project/association/funding-finances)
    - [General Assembly](/project/association/structure/general-assembly)
    - [By-Laws & proceedings](/project/association/by-laws)
    - [Contact](/project/association/contact)
    - [Association Strategy](/project/association/strategy)
  + [The Brand](/project/brand "Find information about how to use the brand and trademark rules, and learn how (not) to spell “TYPO3”.")
    - [Trademarks](/project/brand/trademarks)
    - [Style Guide](https://styleguide.typo3.com)
    - [TYPO3 slidedeck](/project/brand/typo3-slidedeck)
    - [Spelling TYPO3](/project/brand/spelling-typo3)
  + [History](/project/history "TYPO3 was developed from scratch by Kasper Skårhøj in 1997. Separating design and content was a smart solution to an emerging problem.")
  + [Press](/project/press "The TYPO3 Association is a not-for-profit organization, founded in 2004 to ensure the long-term development of the web-based content management system TYPO3 CMS. ")
    - [Press Releases](/project/press/press-releases)
    - [TYPO3 v9 Release Material](/project/press/typo3-v9-release-material)
    - [TYPO3 v10 Release Material](/project/press/v10-release-material)
    - [TYPO3 v11 Release Material](/project/press/typo3-v11-release-material)
    - [TYPO3 v12 Release Material](/project/press/typo3-v12-release-material)
    - [TYPO3 v13 Release Material](/project/press/typo3-v13-release-material)
  + [Licenses](/project/licenses "TYPO3 products and extensions use GNU General Public License, where you are allowed to sell the extension as long as you do not change the license terms.")
  + [Technology Supporters](/project/technology-supporters "This section is dedicated to our supporters offering their tools and services for free in the scope of open source software.")
* [Certification](https://typo3.com/services/certifications "Open menu for Certification")
* [Help & Support](/help "Open menu for Help & Support")
  + [Documentation](/help/documentation "TYPO3 CMS has more than ten thousand features. Becoming an expert takes time, but the process will be rewarding. Find your topic of interest or introductions.")
    - [Getting Started](https://docs.typo3.org/Home/GettingStarted.html)
    - [Video Tutorials](/help/documentation/video-tutorials)
    - [What's New](/help/documentation/whats-new)
  + [Security Advisories](/help/security-advisories)
    - [TYPO3 CMS](/help/security-advisories/typo3-cms)
    - [TYPO3 Extensions](/help/security-advisories/typo3-extensions)
    - [Public Service Announcements](/help/security-advisories/public-service-announcements)
    - [Security Advisories (RSS Feed)](https://typo3.org/?type=101)
  + [Professional Services](https://typo3.com/partners/professional-service-listing)
  + [Official TYPO3 Forum](https://talk.typo3.org/)
  + [TYPO3 LTS Extended Support](https://typo3.com/products/extended-support)
  + [Stack Overflow](https://stackoverflow.com/search?q=typo3)
* [Search](/search "Open menu for Search")
* [Login](/login "Login with your typo3.org user account")

* [Overview](/cms "Free and open source, TYPO3 CMS is a leading content management system with a feature set eclipsing that of our commercial and proprietary competitors.")
* [Features](/cms/features "TYPO3 delivers flexible fast content powered by an enterprise open-source CMS. It’s backed by a vibrant professional community and commercial ecosystem.")
  [+](/cms/features "TYPO3 delivers flexible fast content powered by an enterprise open-source CMS. It’s backed by a vibrant professional community and commercial ecosystem.")
* [Development Roadmap](/cms/roadmap "The TYPO3 CMS development roadmap follows an 18-month release cycle for Long Term Support versions. ")
  [+](/cms/roadmap "The TYPO3 CMS development roadmap follows an 18-month release cycle for Long Term Support versions. ")
* [Strategy](/cms/strategy)
* [Core Development](/community/teams/typo3-development)
* [Release News](/cms/release-news)
  [+](/cms/release-news)
* [Documentation](/help/documentation)
* [Comparison Cards](/cms/comparison-cards "Super charge your sales presentations with fact-based comparisons between TYPO3 and other products and features.")
* [System Requirements](https://get.typo3.org/version/#system-requirements "It doesn't take a degree in engineering to get TYPO3 up an running. Find the facts and figures you need to get started with your first project.")
* [Download & Install](https://get.typo3.org "To test the TYPO3 Introduction Package on your local computer, download the sources and install the Introduction Package from a distribution.")
* [Getting Started](https://docs.typo3.org/Home/GettingStarted.html)
* [Fluid Template Engine](/fluid)

* [Smart Content Management](/cms/features/smart-content-management "Make your content management smart without depending on IT. Control user rights easily, use the best tools for SEO and DAM and get great results.")
* [Secure Performant Scalable](/cms/features/secure-performant-scalable "Build digital experiences that load fast and perform well at any scale, within a secure and reliable CMS. Handle the whole installation from a central point")
* [Universal Frontend User Experience](/cms/features/frontend-experience "TYPO3 CMS has endless frontend flexibility and a seamless mobile user experience. Use TYPO3 headless as a powerful middleware.")
* [Professional Open Source](/cms/features/professional-open-source "TYPO3’s vibrant professional ecosystem, focus on quality and security, and its strong commercial vendor set the CMS apart from the crowd.
  ")
* [Open Extensible Customizable](/cms/features/open-extensible-customizable "Build the project you need without sacrificing flexibility and enhancement in the future. TYPO3 gives you the freedom and flexibility of open source.")
* [Digital Marketing Enabled](/cms/features/digital-marketing-enabled "Take advantage of TYPO3’s extensions and integration possibilities of all digital marketing solutions – including everything you know and love.")
* [Massively Multisite Multilingual](/cms/features/massively-multisite-multilingual "Use TYPO3 CMS to reach global audiences with multilingual sites, localized content, and smooth translation workflows.")

* [TYPO3 Development Roadmap](/cms/roadmap)
* [Maintenance Releases Schedule](/cms/roadmap/maintenance-releases)

* [TYPO3 11 Release Notes](/cms/release-news/typo3-11-release-notes "Learn more about the main features of TYPO3 version 11.")
* [TYPO3 10 Release Notes](/cms/release-news/typo3-10-release-notes "Learn more about the main features of TYPO3 version 10.")
* [TYPO3 9 Release Notes](/cms/release-news/typo3-9-release-notes)
* [TYPO3 8 Release Notes](/cms/release-news/typo3-8-release-notes)
* [TYPO3 7 Release Notes](/cms/roadmap/typo3-7-release-notes)

![](/fileadmin/_processed_/2/7/csm_typo3-pagetree-screenshot-mock-up_984f8f3795.jpg)

* [TYPO3 Community](/community "The TYPO3 Community is growing, and we do more than just developing software. Everyone is welcome. Offer your skills and contribute to TYPO3.")
* [Events](/community/events "You can take part in official events organized by the TYPO3 Association, events organized by the TYPO3 community, and events where TYPO3 participates.")
* [Meet the Community](/community/meet "Online, at events, or in user groups. There are many ways to meet us.")
  [+](/community/meet "Online, at events, or in user groups. There are many ways to meet us.")
* [Contribute / Get Involved](/community/contribute)
  [+](/community/contribute)
* [Teams & Committees](/community/teams "The teams and committees of the TYPO3 community take on tasks within specific areas, such as core development, education, communication and security. ")
  [+](/community/teams "The teams and committees of the TYPO3 community take on tasks within specific areas, such as core development, education, communication and security. ")
* [Values and Proceedings](/community/values "TYPO3 is more than just a piece of software. It is a community. Our values guide our work and make sure the community is a great place for everyone.")
  [+](/community/values "TYPO3 is more than just a piece of software. It is a community. Our values guide our work and make sure the community is a great place for everyone.")
* [Team Leader Meetings](/community/team-leader-meetings)
* [Data Protection Corner](/community/dataprotection-corner)
  [+](/community/dataprotection-corner)
* [Services](/community/services "Get an overview about our TYPO3 services for our community (Git, trouble ticketsystems, infrastructure, LDAP, OTRS, Gerrit). ")
  [+](/community/services "Get an overview about our TYPO3 services for our community (Git, trouble ticketsystems, infrastructure, LDAP, OTRS, Gerrit). ")

* [Communicate: Where and how](/community/meet/communicate "Get an overview about our communication channels and learn to choose the right communication channel - Slack, Forum, Support, Decisions ...
  ")
* [User Groups](/community/meet/user-groups "Many users would like to get in personal contact with other TYPO3 enthusiasts. This is how local TYPO3 User Groups (TUG) are formed and knowledge happens.")
* [StackOverflow](https://stackoverflow.com/questions/tagged/typo3)
* [Forum](https://talk.typo3.org)
* [Chat (Slack)](/community/meet/chat-slack)
* [how to use Slack](/community/meet/how-to-use-slack-in-the-typo3-community "Find important channels for the TYPO3 community and learn how to get you started.")
* [Regular Open Sprints](/community/meet/regular-open-sprints)
* [You, me, and TYPO3!](/community/meet/you-me-and-typo3 "You, me, and TYPO3 is a fresh take on young people that make our TYPO3 community so unique.")

* [TYPO3 remote days](/community/contribute/typo3-remote-days)
* [Become an Association Member](/project/association/membership)
* [Get your My TYPO3 account](/community/contribute/get-your-typo3org-community-account "Create login for the online services. Find out which are the main services we are providing for our community.")
* [Donate](/community/contribute/donate "TYPO3 is an Open Source project, dependent in large parts on donations. This page is for those who want to donate money")
* [Mentorship](/community/contribute/mentorship "Local web developers and agencies learn how to use TYPO3, a performant, secure, and flexible CMS, for their projects. All through one-on-on mentorship.")
* [Community Writers Program](/community/contribute/community-writers "Join the Community Writers Program to improve your skills and confidence in writing and content marketing to boost TYPO3’s signal and reach new audiences.")

* [TYPO3 Development](/community/teams/typo3-development "The TYPO3 Core Development Team is dedicated to develop and maintain the central parts of TYPO3 CMS.")
* [Academic](/community/teams/academic-committee "The TYPO3 Academic Committee is made up of TYPO3 Association members from universities that use TYPO3-CMS for their homepages. ")
* [Accessibility](/community/teams/accessibility "The Accessibility Team assists to improve and maintain the accessibility in TYPO3. Therefore we share our accessibility expertise with TYPO3 developers.")
* [Best Practices](/community/teams/best-practices "Focusing on establishing and communicating best practices around TYPO3.")
* [Communication Coordination](/community/teams/communication-coordination "The Committee coordinates the communication and marketing of the TYPO3 Company and Association, through a unified workflow and pipeline.")
* [Community Expansion](/community/teams/community-expansion "The TYPO3 Community Expansion Committee (T3CEC) has the goal to foster the use of TYPO3 all over the world. Find out about its Activities on this page.")
* [Content](/community/teams/content "Write, Translate, Proofread. No coding skills are required. You can support us on a regular basis or when you have time.")
* [Content Types](/community/teams/structured-content "Team to build better, native support for custom, semantically
  structured content for TYPO3.
  ")
* [Documentation](/community/teams/documentation "The documentation team provides exhaustive, quality documentation about TYPO3 products for all users, with the help of the community.")
* [Education & Certification](/community/teams/education-certification "The committee is responsible for the TYPO3 education strategy, enabling easy access to learning materials, as well as official certifications.")
* [Localization](/community/teams/localization)
* [Marketing](/community/teams/marketing "Create. Communicate. Contribute.
  Support us with sharing your knowledge and help us to spread the word about TYPO3.")
* [Ombudsperson](/community/teams/ombudsperson "A TYPO3 committee ensuring the wellbeing of everyone in the community through education about and enforcement of the Code of Conduct.")
* [Security](/community/teams/security)
* [Server](/community/teams/server-team "We are in charge of the TYPO3 IT infrastructure. About a dozen core applications are run and managed by our team directly, additionaly we provide services to other teams within the TYPO3 universe for their own use.")
* [TYPO3 CMS Product Strategy Group](/community/teams/typo3-cms-strategy-group)
* [typo3.org website](/community/teams/typo3org "The typo3.org website team develops and maintains the typo3.org website, the Extension Repository, Events and Certification Listings, and much more.")
* [User Experience (UX)](/community/teams/user-experience-ux "The main goal of this team is to work on TYPO3 existing features UX improvments and also to collaborate on building any new feature during the concept process if help is wanted.")

* [Code of Conduct](/community/values/code-of-conduct "Be constructive and considerate, respect other people's boundaries.
  Consider your actions—are they OK?")
* [Community Mediation](/community/values/mediation)
* [Conflict of Interest Policy](/community/values/conflict-of-interest-policy)
* [Social Media Guidelines](/community/values/social-media-guidelines "These are the official guidelines for participating in social media for the TYPO3 Project.")
* [Decision-Making Processes, Contribution and Participation](/community/values/decision-making-processes-contribution-and-participation "This policy outlines the difference between groups, as well describing the decision-making, Contribution and Participation")
* [Open Web Manifesto](/community/values/open-web-manifesto)
* [Policy for Committees & Official Teams](/community/values/policy-for-committees-official-teams "The TYPO3 Association’s Policy for Committees and Official Teams outlines the structure for teams, committees and initiatives. It is describing empowerment and disbanding processes.
  ")
* [Usage of Titles](/community/values/usage-of-titles "Learn how to use an official title within the TYPO3 Community and Association")
* [Vision, Mission, Purpose](/community/values/vision-mission-purpose/project)

* [Training for the TYPO3 teams](/community/dataprotection-corner/training-for-the-typo3-teams)

* [e-mail-addresses](/community/services/e-mail-addresses)

![](/fileadmin/_processed_/4/3/csm_6932872980_d788451b65_o_4e84bb9425.jpg)
### Inspire people to share

Offer your skills and [contribute to the project](/community/contribute). The community is growing and does more than just coding.

* [The TYPO3 Project](/project "TYPO3 CMS is an open source CMS. The project is international and fully community-driven, and the long-term development is managed by the TYPO3 Association.")
* [News](/project/news "Read the latest news about TYPO3 CMS and the association and community supporting the word's most popular enterprise-level content management system.")
  [+](/project/news "Read the latest news about TYPO3 CMS and the association and community supporting the word's most popular enterprise-level content management system.")
* [Our Products](/project/products "TYPO3 CMS is our most important product. Fluid is a templating engine and Surf a deployment tool. They help deliver groundbreaking technology in TYPO3 CMS.")
* [TYPO3 Association](/project/association "The TYPO3 Association is a not-for-profit membership organization that coordinates and funds the long-term development of the TYPO3 CMS platform. ")
  [+](/project/association "The TYPO3 Association is a not-for-profit membership organization that coordinates and funds the long-term development of the TYPO3 CMS platform. ")
* [The Brand](/project/brand "Find information about how to use the brand and trademark rules, and learn how (not) to spell “TYPO3”.")
  [+](/project/brand "Find information about how to use the brand and trademark rules, and learn how (not) to spell “TYPO3”.")
* [History](/project/history "TYPO3 was developed from scratch by Kasper Skårhøj in 1997. Separating design and content was a smart solution to an emerging problem.")
* [Press](/project/press "The TYPO3 Association is a not-for-profit organization, founded in 2004 to ensure the long-term development of the web-based content management system TYPO3 CMS. ")
  [+](/project/press "The TYPO3 Association is a not-for-profit organization, founded in 2004 to ensure the long-term development of the web-based content management system TYPO3 CMS. ")
* [Licenses](/project/licenses "TYPO3 products and extensions use GNU General Public License, where you are allowed to sell the extension as long as you do not change the license terms.")
* [Technology Supporters](/project/technology-supporters "This section is dedicated to our supporters offering their tools and services for free in the scope of open source software.")

* [RSS feed](https://typo3.org/rss)
* [Security Advisories](/help/security-advisories)
* [This Month in TYPO3](/project/news/this-month-in-typo3 "A report of what happened in the TYPO3 community and in the ecosystem in the recent weeks. Enter interesting articles and everything else what might fit.")
* [Podcast](/project/news/podcast "Inside TYPO3 gives you updates, expert insights, and community stories. Available on Spotify, Apple Podcasts, Amazon Music, and YouTube.")

* [Become a Member](/project/association/membership "Members of the TYPO3 Association support the development of TYPO3 CMS and take part in shaping the future of TYPO3 CMS.")
* [Our Members](/project/association/members "This is a list of personal and organizational members of the TYPO3 Association.")
* [Structure](/project/association/structure "The TYPO3 Association has four main bodies: the General Assembly, the Board, the Expert Advisory Board (EAB), and the Business Control Committee (BCC).")
* [Association News](/project/association/association-news "Get the latest news of the TYPO3 Association. Stay up to date and inform yourself about the TYPO3 project.")
* [Partnerships](/project/association/partnerships)
* [Funding & Finances](/project/association/funding-finances "Most of the Association's income comes from membership fees, donations, and events. €650,000 is funneled back into core development and community projects.")
* [General Assembly](/project/association/structure/general-assembly)
* [By-Laws & proceedings](/project/association/by-laws)
* [Contact](/project/association/contact "For general enquiries, coordination, community involvement and sponsorship feel free to contact: info@typo3.org")
* [Association Strategy](/project/association/strategy)

* [Trademarks](/project/brand/trademarks "The word “TYPO3” is one of the trademarks owned by the TYPO3 Association. We have created guidelines to help people understand what is (and is not) OK.")
* [Style Guide](https://styleguide.typo3.com)
* [TYPO3 slidedeck](/project/brand/typo3-slidedeck)
* [Spelling TYPO3](/project/brand/spelling-typo3 "TYPO3 is always written in uppercase, with no spaces. This rule covers all products under the TYPO3 project. URLs are the only exception to this rule.")

* [Press Releases](/project/press/press-releases)
* [TYPO3 v9 Release Material](/project/press/typo3-v9-release-material)
* [TYPO3 v10 Release Material](/project/press/v10-release-material)
* [TYPO3 v11 Release Material](/project/press/typo3-v11-release-material)
* [TYPO3 v12 Release Material](/project/press/typo3-v12-release-material)
* [TYPO3 v13 Release Material](/project/press/typo3-v13-release-material)

![](/fileadmin/_processed_/1/6/csm_26276623101_a436d2f07a_o_270a7b2c42.jpg)
### A Community Effort

TYPO3 CMS is an Open Source project managed by the TYPO3 Association.

[The Project](/project/association)

* [Getting Help & Support](/help "Ask an editor or developer in the community free help with your TYPO3 questions or pay an agency or freelancer to give you the support you need.")
* [Documentation](/help/documentation "TYPO3 CMS has more than ten thousand features. Becoming an expert takes time, but the process will be rewarding. Find your topic of interest or introductions.")
  [+](/help/documentation "TYPO3 CMS has more than ten thousand features. Becoming an expert takes time, but the process will be rewarding. Find your topic of interest or introductions.")
* [Security Advisories](/help/security-advisories)
  [+](/help/security-advisories)
* [Professional Services](https://typo3.com/partners/professional-service-listing)
* [Official TYPO3 Forum](https://talk.typo3.org/)
* [TYPO3 LTS Extended Support](https://typo3.com/products/extended-support)
* [Stack Overflow](https://stackoverflow.com/search?q=typo3)

* [Getting Started](https://docs.typo3.org/Home/GettingStarted.html)
* [Video Tutorials](/help/documentation/video-tutorials)
* [What's New](/help/documentation/whats-new "The TYPO3 CMS What's New Slides summarise new features, significant improvements, important changes and key facts of new TYPO3 releases.")

* [TYPO3 CMS](/help/security-advisories/typo3-cms)
* [TYPO3 Extensions](/help/security-advisories/typo3-extensions)
* [Public Service Announcements](/help/security-advisories/public-service-announcements)
* [Security Advisories (RSS Feed)](https://typo3.org/?type=101)

![](/fileadmin/_processed_/9/c/csm_startup-photos_3680a49e5f.jpg)
### Do you have a question?

[Ask the community](https://talk.typo3.org) or a [professional partner](https://typo3.com/partners/professional-service-listing).

Mon. 6th February, 2023

# TYPO3-PSA-2023-001: Important Security-Bulletin Pre-Announcement

Categories:
[Development](/help/security-advisories/development "Development"),

[TYPO3 CMS](/help/security-advisories/typo3-cms "TYPO3 CMS")

Created by Oliver Hader

The TYPO3 Security Team pre-announces an important security release.

* **Type:** Pre-Announcement
* **Component Type:** TYPO3 CMS
* **Scheduled Release Date:** February 7, 2023
* **Affected Versions:** 8.7.0-8.7.50, 9.0.0-9.5.39, 10.0.0-10.4.34, 11.0.0-11.5.22, 12.0.0-12.1.3
* **Suggested Severity:** High
* **Suggested CVSS:** [CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:H/A:L](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:H/A:L&version=3.1)
* **References:** [CVE-2023-24814](https://nvd.nist.gov/vuln/detail/CVE-2023-24814)

### Pre-Announcement

The TYPO3 Security Team pre-announces important security releases which are planned to be published on **Tuesday, February 7th, 2023 between 9:00-12:00 UTC**. All officially supported versions are affected and will be fixed. The severity of the vulnerability is “high”.

Website maintainers are advised to apply the updates as soon as possible once they are published.

Corresponding security advisories will be published as usual at <https://typo3.org/help/security-advisories>.

### Upcoming Versions

TYPO3 12.2.0, 11.5.23 LTS, 10.4.35 LTS, 9.5.40 ELTS, 8.7.51 ELTS.

### General Advice

Follow the recommendations that are given in the [TYPO3 Security Guide](https://docs.typo3.org/typo3cms/CoreApiReference/Security/Index.html#security). Please subscribe to the [typo3-announce](http://lists.typo3.org/cgi-bin/mailman/listinfo/typo3-announce) mailing list.

### General Note

All security related code changes are tagged so that you can easily look them up in our [review system](https://review.typo3.org/#/q/status:merged+project:Packages/TYPO3.CMS+topic:security,n,z).

**Updates**
 2023-02-06: Adjusted affected versions segment from "8.0.0-8.7.50" to "8.7.0-8.7.50"
 2023-02-06: Added assigned [CVE-2023-24814](https://nvd.nist.gov/vuln/detail/CVE-2023-24814)

Ready to get started?

Download TYPO3 CMS for free!

[Download](https://get.typo3.org/)
[Get
more info](https://typo3.org/typo3-cms/overview/)

![TYPO3](/_assets/a686d4200d36973f64d48f0547522f58/Images/Template/typo3_nomargins.svg)

#### Information

* [Decision makers](https://typo3.com/typo3-cms/why-typo3/typo3-for-decision-makers "Why use TYPO3? - Because TYPO3 is the CMS for you!")
* [Users](https://typo3.com/typo3-cms/why-typo3/typo3-for-editing-publishing)
* [Developers](https://typo3.com/typo3-cms/why-typo3/typo3-for-developers)
* [Contact form](/contact)

#### Downloads

* [TYPO3 CMS](https://get.typo3.org "Download and install TYPO3")
* [Extensions for TYPO3](https://extensions.typo3.org "Extend TYPO3 with extensions")

#### Community

* [my.typo3.org](https://my.typo3.org "Log into our community")
* [Slack for TYPO3 community](https://typo3.slack.com "Chat with our community")
* [TYPO3 Code of Conduct](/community/values/code-of-conduct)

#### Popular links

* [Legal Notice](/legal-notice "Legal Notice")
* [TYPO3.com](https://typo3.com "TYPO3.com")
* [TYPO3 Association](/project/association "TYPO3 Association")
* [Privacy Policy](/privacy-policy "Privacy Policy")
* [Social Media Privacy Policy](/social-media-privacy-policy "Social Media Privacy Policy")



=== Content from github.com_81d6fa60_20250114_193351.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTYPO3%2Ftypo3%2Fblob%2Fv11.5.22%2Ftypo3%2Fsysext%2Ffrontend%2FClasses%2FController%2FTypoScriptFrontendController.php)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTYPO3%2Ftypo3%2Fblob%2Fv11.5.22%2Ftypo3%2Fsysext%2Ffrontend%2FClasses%2FController%2FTypoScriptFrontendController.php)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=TYPO3%2Ftypo3)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[TYPO3](/TYPO3)
/
**[typo3](/TYPO3/typo3)**
Public

* [Notifications](/login?return_to=%2FTYPO3%2Ftypo3) You must be signed in to change notification settings
* [Fork
  674](/login?return_to=%2FTYPO3%2Ftypo3)
* [Star
   1.1k](/login?return_to=%2FTYPO3%2Ftypo3)

* [Code](/TYPO3/typo3/tree/v11.5.22)
* [Pull requests
  0](/TYPO3/typo3/pulls)
* [Actions](/TYPO3/typo3/actions)
* [Projects
  0](/TYPO3/typo3/projects)
* [Security](/TYPO3/typo3/security)
* [Insights](/TYPO3/typo3/pulse)

Additional navigation options

* [Code](/TYPO3/typo3/tree/v11.5.22)
* [Pull requests](/TYPO3/typo3/pulls)
* [Actions](/TYPO3/typo3/actions)
* [Projects](/TYPO3/typo3/projects)
* [Security](/TYPO3/typo3/security)
* [Insights](/TYPO3/typo3/pulse)

## Files

 v11.5.22
## Breadcrumbs

1. [typo3](/TYPO3/typo3/tree/v11.5.22)
2. /[typo3](/TYPO3/typo3/tree/v11.5.22/typo3)
3. /[sysext](/TYPO3/typo3/tree/v11.5.22/typo3/sysext)
4. /[frontend](/TYPO3/typo3/tree/v11.5.22/typo3/sysext/frontend)
5. /[Classes](/TYPO3/typo3/tree/v11.5.22/typo3/sysext/frontend/Classes)
6. /[Controller](/TYPO3/typo3/tree/v11.5.22/typo3/sysext/frontend/Classes/Controller)
/
# TypoScriptFrontendController.php

Copy path Blame  Blame
## Latest commit

## History

[History](/TYPO3/typo3/commits/v11.5.22/typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php)3662 lines (3415 loc) · 156 KB v11.5.22
## Breadcrumbs

1. [typo3](/TYPO3/typo3/tree/v11.5.22)
2. /[typo3](/TYPO3/typo3/tree/v11.5.22/typo3)
3. /[sysext](/TYPO3/typo3/tree/v11.5.22/typo3/sysext)
4. /[frontend](/TYPO3/typo3/tree/v11.5.22/typo3/sysext/frontend)
5. /[Classes](/TYPO3/typo3/tree/v11.5.22/typo3/sysext/frontend/Classes)
6. /[Controller](/TYPO3/typo3/tree/v11.5.22/typo3/sysext/frontend/Classes/Controller)
/
# TypoScriptFrontendController.php

Top
## File metadata and controls

* Code
* Blame

3662 lines (3415 loc) · 156 KB[Raw](https://github.com/TYPO3/typo3/raw/refs/tags/v11.5.22/typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000<?php
/\* \* This file is part of the TYPO3 CMS project. \* \* It is free software; you can redistribute it and/or modify it under \* the terms of the GNU General Public License, either version 2 \* of the License, or any later version. \* \* For the full copyright and license information, please read the \* LICENSE.txt file that was distributed with this source code. \* \* The TYPO3 project - inspiring people to share! \*/
namespace TYPO3\CMS\Frontend\Controller;
use Psr\Http\Message\ResponseInterface;use Psr\Http\Message\ServerRequestInterface;use Psr\Log\LoggerAwareInterface;use Psr\Log\LoggerAwareTrait;use Psr\Log\LogLevel;use TYPO3\CMS\Backend\FrontendBackendUserAuthentication;use TYPO3\CMS\Core\Cache\CacheManager;use TYPO3\CMS\Core\Cache\Frontend\AbstractFrontend;use TYPO3\CMS\Core\Cache\Frontend\FrontendInterface;use TYPO3\CMS\Core\Charset\CharsetConverter;use TYPO3\CMS\Core\Charset\UnknownCharsetException;use TYPO3\CMS\Core\Compatibility\PublicPropertyDeprecationTrait;use TYPO3\CMS\Core\Configuration\Loader\PageTsConfigLoader;use TYPO3\CMS\Core\Configuration\Parser\PageTsConfigParser;use TYPO3\CMS\Core\Context\Context;use TYPO3\CMS\Core\Context\DateTimeAspect;use TYPO3\CMS\Core\Context\LanguageAspect;use TYPO3\CMS\Core\Context\LanguageAspectFactory;use TYPO3\CMS\Core\Context\UserAspect;use TYPO3\CMS\Core\Context\VisibilityAspect;use TYPO3\CMS\Core\Context\WorkspaceAspect;use TYPO3\CMS\Core\Core\Environment;use TYPO3\CMS\Core\Database\Connection;use TYPO3\CMS\Core\Database\ConnectionPool;use TYPO3\CMS\Core\Database\Query\Restriction\DeletedRestriction;use TYPO3\CMS\Core\Database\Query\Restriction\EndTimeRestriction;use TYPO3\CMS\Core\Database\Query\Restriction\StartTimeRestriction;use TYPO3\CMS\Core\Domain\Repository\PageRepository;use TYPO3\CMS\Core\Error\Http\AbstractServerErrorException;use TYPO3\CMS\Core\Error\Http\PageNotFoundException;use TYPO3\CMS\Core\Error\Http\ShortcutTargetPageNotFoundException;use TYPO3\CMS\Core\Exception\Page\RootLineException;use TYPO3\CMS\Core\Exception\SiteNotFoundException;use TYPO3\CMS\Core\Http\ApplicationType;use TYPO3\CMS\Core\Http\ImmediateResponseException;use TYPO3\CMS\Core\Http\NormalizedParams;use TYPO3\CMS\Core\Http\PropagateResponseException;use TYPO3\CMS\Core\Http\ServerRequestFactory;use TYPO3\CMS\Core\Localization\LanguageService;use TYPO3\CMS\Core\Localization\LanguageServiceFactory;use TYPO3\CMS\Core\Locking\Exception\LockAcquireWouldBlockException;use TYPO3\CMS\Core\Locking\LockFactory;use TYPO3\CMS\Core\Locking\LockingStrategyInterface;use TYPO3\CMS\Core\Page\AssetCollector;use TYPO3\CMS\Core\Page\PageRenderer;use TYPO3\CMS\Core\PageTitle\PageTitleProviderManager;use TYPO3\CMS\Core\Resource\Exception;use TYPO3\CMS\Core\Routing\PageArguments;use TYPO3\CMS\Core\Site\Entity\SiteInterface;use TYPO3\CMS\Core\Site\Entity\SiteLanguage;use TYPO3\CMS\Core\Site\SiteFinder;use TYPO3\CMS\Core\TimeTracker\TimeTracker;use TYPO3\CMS\Core\Type\Bitmask\PageTranslationVisibility;use TYPO3\CMS\Core\Type\Bitmask\Permission;use TYPO3\CMS\Core\TypoScript\Parser\TypoScriptParser;use TYPO3\CMS\Core\TypoScript\TemplateService;use TYPO3\CMS\Core\Utility\ArrayUtility;use TYPO3\CMS\Core\Utility\GeneralUtility;use TYPO3\CMS\Core\Utility\HttpUtility;use TYPO3\CMS\Core\Utility\MathUtility;use TYPO3\CMS\Core\Utility\PathUtility;use TYPO3\CMS\Core\Utility\RootlineUtility;use TYPO3\CMS\Frontend\Aspect\PreviewAspect;use TYPO3\CMS\Frontend\Authentication\FrontendUserAuthentication;use TYPO3\CMS\Frontend\Configuration\TypoScript\ConditionMatching\ConditionMatcher;use TYPO3\CMS\Frontend\ContentObject\ContentObjectRenderer;use TYPO3\CMS\Frontend\Page\CacheHashCalculator;use TYPO3\CMS\Frontend\Page\PageAccessFailureReasons;use TYPO3\CMS\Frontend\Resource\FilePathSanitizer;
/\*\* \* Class for the built TypoScript based frontend. Instantiated in \* \TYPO3\CMS\Frontend\Http\RequestHandler as the global object TSFE. \* \* Main frontend class, instantiated in \TYPO3\CMS\Frontend\Http\RequestHandler \* as the global object TSFE. \* \* This class has a lot of functions and internal variable which are used from \* \TYPO3\CMS\Frontend\Http\RequestHandler \* \* The class is instantiated as $GLOBALS['TSFE'] in \TYPO3\CMS\Frontend\Http\RequestHandler. \* \* The use of this class should be inspired by the order of function calls as \* found in \TYPO3\CMS\Frontend\Http\RequestHandler. \*/class TypoScriptFrontendController implements LoggerAwareInterface{ use LoggerAwareTrait; use PublicPropertyDeprecationTrait; /\*\* \* List previously publicly accessible variables \*/ private array $deprecatedPublicProperties = [ 'ATagParams' => 'Using ATagParams will not be possible anymore in TYPO3 v12.0. Use TSFE->config[config][ATagParams] instead.', ];
 /\*\* \* The page id (int) \* @var string|int \*/ public $id = '';
 /\*\* \* The type (read-only) \* @var int|string \*/ public $type = '';
 /\*\* \* @var SiteInterface \*/ protected $site;
 /\*\* \* @var SiteLanguage \*/ protected $language;
 /\*\* \* @var PageArguments \* @internal \*/ protected $pageArguments;
 /\*\* \* Page will not be cached. Write only TRUE. Never clear value (some other \* code might have reasons to set it TRUE). \* @var bool \*/ public $no\_cache = false;
 /\*\* \* The rootLine (all the way to tree root, not only the current site!) \* @var array \*/ public $rootLine = [];
 /\*\* \* The pagerecord \* @var array \*/ public $page = [];
 /\*\* \* This will normally point to the same value as id, but can be changed to \* point to another page from which content will then be displayed instead. \* @var int \*/ public $contentPid = 0;
 /\*\* \* Gets set when we are processing a page of type mounpoint with enabled overlay in getPageAndRootline() \* Used later in checkPageForMountpointRedirect() to determine the final target URL where the user \* should be redirected to. \* \* @var array|null \*/ protected $originalMountPointPage;
 /\*\* \* Gets set when we are processing a page of type shortcut in the early stages \* of the request when we do not know about languages yet, used later in the request \* to determine the correct shortcut in case a translation changes the shortcut \* target \* @var array|null \* @see checkTranslatedShortcut() \*/ protected $originalShortcutPage;
 /\*\* \* sys\_page-object, pagefunctions \* \* @var PageRepository|string \*/ public $sys\_page = '';
 /\*\* \* Is set to 1 if a pageNotFound handler could have been called. \* @var int \* @internal \*/ public $pageNotFound = 0;
 /\*\* \* Array containing a history of why a requested page was not accessible. \* @var array \*/ protected $pageAccessFailureHistory = [];
 /\*\* \* @var string \* @internal \*/ public $MP = '';
 /\*\* \* The frontend user \* \* @var FrontendUserAuthentication \*/ public $fe\_user;
 /\*\* \* Shows whether logins are allowed in branch \* @var bool \*/ protected $loginAllowedInBranch = true;
 /\*\* \* Shows specific mode (all or groups) \* @var string \* @internal \*/ protected $loginAllowedInBranch\_mode = '';
 /\*\* \* Value that contains the simulated usergroup if any \* @var int \* @internal only to be used in AdminPanel, and within TYPO3 Core \*/ public $simUserGroup = 0;
 /\*\* \* "CONFIG" object from TypoScript. Array generated based on the TypoScript \* configuration of the current page. Saved with the cached pages. \* @var array \*/ public $config = [];
 /\*\* \* The TypoScript template object. Used to parse the TypoScript template \* \* @var TemplateService \*/ public $tmpl;
 /\*\* \* Is set to the time-to-live time of cached pages. Default is 60\*60\*24, which is 24 hours. \* \* @var int \* @internal \*/ protected $cacheTimeOutDefault = 86400;
 /\*\* \* Set internally if cached content is fetched from the database. \* \* @var bool \* @internal \*/ protected $cacheContentFlag = false;
 /\*\* \* Set to the expire time of cached content \* @var int \* @internal \*/ protected $cacheExpires = 0;
 /\*\* \* Set if cache headers allowing caching are sent. \* @var bool \* @internal \*/ protected $isClientCachable = false;
 /\*\* \* Used by template fetching system. This array is an identification of \* the template. If $this->all is empty it's because the template-data is not \* cached, which it must be. \* @var array \* @internal \*/ public $all = [];
 /\*\* \* Toplevel - objArrayName, eg 'page' \* @var string \* @internal should only be used by TYPO3 Core \*/ public $sPre = '';
 /\*\* \* TypoScript configuration of the page-object pointed to by sPre. \* $this->tmpl->setup[$this->sPre.'.'] \* @var array|string \* @internal should only be used by TYPO3 Core \*/ public $pSetup = '';
 /\*\* \* This hash is unique to the template, the $this->id and $this->type vars and \* the list of groups. Used to get and later store the cached data \* @var string \* @internal \*/ public $newHash = '';
 /\*\* \* This flag is set before the page is generated IF $this->no\_cache is set. If this \* flag is set after the page content was generated, $this->no\_cache is forced to be set. \* This is done in order to make sure that PHP code from Plugins / USER scripts does not falsely \* clear the no\_cache flag. \* @var bool \* @internal \*/ protected $no\_cacheBeforePageGen = false;
 /\*\* \* May be set to the pagesTSconfig \* @var array|string \* @internal \*/ protected $pagesTSconfig = '';
 /\*\* \* Eg. insert JS-functions in this array ($additionalHeaderData) to include them \* once. Use associative keys. \* \* Keys in use: \* \* used to accumulate additional HTML-code for the header-section, \* <head>...</head>. Insert either associative keys (like \* additionalHeaderData['myStyleSheet'], see reserved keys above) or num-keys \* (like additionalHeaderData[] = '...') \* \* @var array \*/ public $additionalHeaderData = [];
 /\*\* \* Used to accumulate additional HTML-code for the footer-section of the template \* @var array \*/ public $additionalFooterData = [];
 /\*\* \* Default internal target \* @var string \*/ public $intTarget = '';
 /\*\* \* Default external target \* @var string \*/ public $extTarget = '';
 /\*\* \* Default file link target \* @var string \*/ public $fileTarget = '';
 /\*\* \* If set, typolink() function encrypts email addresses. \* @var string|int \*/ public $spamProtectEmailAddresses = 0;
 /\*\* \* Absolute Reference prefix \* @var string \*/ public $absRefPrefix = '';
 /\*\* \* <A>-tag parameters \* @var string \* @deprecated will be removed in TYPO3 v12.0. Use TSFE->config[config][ATagParams] directly. \*/ protected $ATagParams = '';
 /\*\* \* Search word regex, calculated if there has been search-words send. This is \* used to mark up the found search words on a page when jumped to from a link \* in a search-result. \* @var string \* @internal \*/ public $sWordRegEx = '';
 /\*\* \* Is set to the incoming array sword\_list in case of a page-view jumped to from \* a search-result. \* @var string \* @internal \*/ public $sWordList = '';
 /\*\* \* A string prepared for insertion in all links on the page as url-parameters. \* Based on configuration in TypoScript where you defined which GET\_VARS you \* would like to pass on. \* @var string \*/ public $linkVars = '';
 /\*\* \* If set, edit icons are rendered aside content records. Must be set only if \* the ->beUserLogin flag is set and set\_no\_cache() must be called as well. \* @var string \* @deprecated since v11, will be removed with v12. Drop together with editPanel removal. \*/ public $displayEditIcons = '';
 /\*\* \* If set, edit icons are rendered aside individual fields of content. Must be \* set only if the ->beUserLogin flag is set and set\_no\_cache() must be called as \* well. \* @var string \* @deprecated since v11, will be removed with v12. Drop together with editIcons removal. \*/ public $displayFieldEditIcons = '';
 /\*\* \* 'Global' Storage for various applications. Keys should be 'tx\_'.extKey for \* extensions. \* @var array \*/ public $applicationData = [];
 /\*\* \* @var array \*/ public $register = [];
 /\*\* \* Stack used for storing array and retrieving register arrays (see \* LOAD\_REGISTER and RESTORE\_REGISTER) \* @var array \*/ public $registerStack = [];
 /\*\* \* Checking that the function is not called eternally. This is done by \* interrupting at a depth of 50 \* @var int \* @deprecated since v11, will be removed in v12. \*/ public $cObjectDepthCounter = 50;
 /\*\* \* Used by RecordContentObject and ContentContentObject to ensure the a records is NOT \* rendered twice through it! \* @var array \*/ public $recordRegister = [];
 /\*\* \* This is set to the [table]:[uid] of the latest record rendered. Note that \* class ContentObjectRenderer has an equal value, but that is pointing to the \* record delivered in the $data-array of the ContentObjectRenderer instance, if \* the cObjects CONTENT or RECORD created that instance \* @var string \*/ public $currentRecord = '';
 /\*\* \* Used by class \TYPO3\CMS\Frontend\ContentObject\Menu\AbstractMenuContentObject \* to keep track of access-keys. \* @var array \*/ public $accessKey = [];
 /\*\* \* Used to generate page-unique keys. Point is that uniqid() functions is very \* slow, so a unikey key is made based on this, see function uniqueHash() \* @var int \* @internal \*/ protected $uniqueCounter = 0;
 /\*\* \* @var string \* @internal \*/ protected $uniqueString = '';
 /\*\* \* This value will be used as the title for the page in the indexer (if \* indexing happens) \* @var string \* @internal only used by TYPO3 Core, use PageTitle API instead. \*/ public $indexedDocTitle = '';
 /\*\* \* The base URL set for the page header. \* @var string \*/ public $baseUrl = '';
 /\*\* \* Page content render object \* \* @var ContentObjectRenderer \*/ public $cObj;
 /\*\* \* All page content is accumulated in this variable. See RequestHandler \* @var string \*/ public $content = '';
 /\*\* \* Info-array of the last resulting image resource of content object \* IMG\_RESOURCE (if any), containing width, height and so on. \*/ public ?array $lastImgResourceInfo = null;
 /\*\* \* Output charset of the websites content. This is the charset found in the \* header, meta tag etc. If different than utf-8 a conversion \* happens before output to browser. Defaults to utf-8. \* @var string \*/ public $metaCharset = 'utf-8';
 /\*\* \* Internal calculations for labels \* \* @var LanguageService \*/ protected $languageService;
 /\*\* \* @var LockingStrategyInterface[][] \*/ protected $locks = [];
 /\*\* \* @var PageRenderer \*/ protected $pageRenderer;
 /\*\* \* The page cache object, use this to save pages to the cache and to \* retrieve them again \* \* @var FrontendInterface \*/ protected $pageCache;
 /\*\* \* @var array \*/ protected $pageCacheTags = [];
 /\*\* \* Content type HTTP header being sent in the request. \* @todo Ticket: #63642 Should be refactored to a request/response model later \* @internal Should only be used by TYPO3 core for now \* \* @var string \*/ protected $contentType = 'text/html';
 /\*\* \* Doctype to use \* \* @var string \*/ public $xhtmlDoctype = '';
 /\*\* \* @var int \*/ public $xhtmlVersion;
 /\*\* \* Originally requested id from the initial $\_GET variable \* \* @var int \*/ protected $requestedId;
 /\*\* \* The context for keeping the current state, mostly related to current page information, \* backend user / frontend user access, workspaceId \* \* @var Context \*/ protected $context;
 /\*\* \* If debug mode is enabled, this contains the information if a page is fetched from cache, \* and sent as HTTP Response Header. \*/ protected string $debugInformationHeader = '';
 /\*\* \* Since TYPO3 v10.0, TSFE is composed out of \* - Context \* - Site \* - SiteLanguage \* - PageArguments (containing ID, Type, cHash and MP arguments) \* \* Also sets a unique string (->uniqueString) for this script instance; A md5 hash of the microtime() \* \* @param Context $context the Context object to work with \* @param SiteInterface $site The resolved site to work with \* @param SiteLanguage $siteLanguage The resolved language to work with \* @param PageArguments $pageArguments The PageArguments object containing Page ID, type and GET parameters \* @param FrontendUserAuthentication $frontendUser a FrontendUserAuthentication object \*/ public function \_\_construct(Context $context, SiteInterface $site, SiteLanguage $siteLanguage, PageArguments $pageArguments, FrontendUserAuthentication $frontendUser) { $this->initializeContext($context); $this->site = $site; $this->language = $siteLanguage; $this->setPageArguments($pageArguments); $this->fe\_user = $frontendUser; $this->uniqueString = md5(microtime()); $this->initPageRenderer(); $this->initCaches(); // Initialize LLL behaviour $this->setOutputLanguage(); }
 private function initializeContext(Context $context): void { $this->context = $context; if (!$this->context->hasAspect('frontend.preview')) { $this->context->setAspect('frontend.preview', GeneralUtility::makeInstance(PreviewAspect::class)); } }
 /\*\* \* Initializes the page renderer object \*/ protected function initPageRenderer() { if ($this->pageRenderer !== null) { return; } $this->pageRenderer = GeneralUtility::makeInstance(PageRenderer::class); $this->pageRenderer->setTemplateFile('EXT:frontend/Resources/Private/Templates/MainPage.html'); // As initPageRenderer could be called in constructor and for USER\_INTs, this information is only set // once - in order to not override any previous settings of PageRenderer. if ($this->language instanceof SiteLanguage) { $this->pageRenderer->setLanguage($this->language->getTypo3Language()); } }
 /\*\* \* @param string $contentType \* @internal Must only be used by TYPO3 core \*/ public function setContentType($contentType) { $this->contentType = $contentType; }
 /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* \* \* Initializing, resolving page id \* \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ /\*\* \* Initializes the caching system. \*/ protected function initCaches() { $this->pageCache = GeneralUtility::makeInstance(CacheManager::class)->getCache('pages'); }
 /\*\* \* Initializes the front-end user groups. \* Sets frontend.user aspect based on front-end user status. \*/ public function initUserGroups() { $userAspect = $this->fe\_user->createUserAspect((bool)$this->loginAllowedInBranch); $this->context->setAspect('frontend.user', $userAspect); }
 /\*\* \* Checking if a user is logged in or a group constellation different from "0,-1" \* \* @return bool TRUE if either a login user is found (array fe\_user->user) OR if the gr\_list is set to something else than '0,-1' (could be done even without a user being logged in!) \*/ public function isUserOrGroupSet() { /\*\* @var UserAspect $userAspect \*/ $userAspect = $this->context->getAspect('frontend.user'); return $userAspect->isUserOrGroupSet(); }
 /\*\* \* Clears the preview-flags, sets sim\_exec\_time to current time. \* Hidden pages must be hidden as default, $GLOBALS['SIM\_EXEC\_TIME'] is set to $GLOBALS['EXEC\_TIME'] \* in bootstrap initializeGlobalTimeVariables(). Alter it by adding or subtracting seconds. \*/ public function clear\_preview() { if ($this->isInPreviewMode()) { $GLOBALS['SIM\_EXEC\_TIME'] = $GLOBALS['EXEC\_TIME']; $GLOBALS['SIM\_ACCESS\_TIME'] = $GLOBALS['ACCESS\_TIME']; $this->context->setAspect('frontend.preview', GeneralUtility::makeInstance(PreviewAspect::class)); $this->context->setAspect('date', GeneralUtility::makeInstance(DateTimeAspect::class, new \DateTimeImmutable('@' . $GLOBALS['SIM\_EXEC\_TIME']))); $this->context->setAspect('visibility', GeneralUtility::makeInstance(VisibilityAspect::class)); } }
 /\*\* \* Checks if a backend user is logged in \* \* @return bool whether a backend user is logged in \*/ public function isBackendUserLoggedIn() { return (bool)$this->context->getPropertyFromAspect('backend.user', 'isLoggedIn', false); }
 /\*\* \* Determines the id and evaluates any preview settings \* Basically this function is about determining whether a backend user is logged in, \* if he has read access to the page and if he's previewing the page. \* That all determines which id to show and how to initialize the id. \* \* @param ServerRequestInterface|null $request \*/ public function determineId(ServerRequestInterface $request = null) { $request = $request ?? $GLOBALS['TYPO3\_REQUEST'] ?? ServerRequestFactory::fromGlobals(); // Call pre processing function for id determination foreach ($GLOBALS['TYPO3\_CONF\_VARS']['SC\_OPTIONS']['tslib/class.tslib\_fe.php']['determineId-PreProcessing'] ?? [] as $functionReference) { $parameters = ['parentObject' => $this]; GeneralUtility::callUserFunction($functionReference, $parameters, $this); } // If there is a Backend login we are going to check for any preview settings $originalFrontendUserGroups = $this->applyPreviewSettings($this->getBackendUser()); // If the front-end is showing a preview, caching MUST be disabled. $isPreview = $this->isInPreviewMode(); if ($isPreview) { $this->disableCache(); } // Now, get the id, validate access etc: $this->fetch\_the\_id($request); // Check if backend user has read access to this page. If not, recalculate the id. if ($this->isBackendUserLoggedIn() && $isPreview && !$this->getBackendUser()->doesUserHaveAccess($this->page, Permission::PAGE\_SHOW)) { $this->unsetBackendUser(); // Resetting $this->clear\_preview(); $this->fe\_user->user[$this->fe\_user->usergroup\_column] = $originalFrontendUserGroups; // Fetching the id again, now with the preview settings reset. $this->fetch\_the\_id($request); } // Checks if user logins are blocked for a certain branch and if so, will unset user login and re-fetch ID. $this->loginAllowedInBranch = $this->checkIfLoginAllowedInBranch(); // Logins are not allowed, but there is a login, so will we run this. if (!$this->loginAllowedInBranch && $this->isUserOrGroupSet()) { // Clear out user, and the group will be re-set in >initUserGroups() due to // $this->loginAllowedInBranch = false if ($this->loginAllowedInBranch\_mode === 'all') { $this->fe\_user->hideActiveLogin(); } // Fetching the id again, now with the preview settings reset and respecting $this->loginAllowedInBranch = false $this->fetch\_the\_id($request); } // Final cleaning. // Make sure it's an integer $this->id = ($this->contentPid = (int)$this->id); // Make sure it's an integer $this->type = (int)$this->type; // Setting language and fetch translated page $this->settingLanguage($request); // Call post processing function for id determination: $\_params = ['pObj' => &$this]; foreach ($GLOBALS['TYPO3\_CONF\_VARS']['SC\_OPTIONS']['tslib/class.tslib\_fe.php']['determineId-PostProc'] ?? [] as $\_funcRef) { GeneralUtility::callUserFunction($\_funcRef, $\_params, $this); } }
 protected function unsetBackendUser(): void { // Register an empty backend user as aspect unset($GLOBALS['BE\_USER']); $this->context->setAspect('backend.user', GeneralUtility::makeInstance(UserAspect::class)); $this->context->setAspect('workspace', GeneralUtility::makeInstance(WorkspaceAspect::class)); }
 /\*\* \* Evaluates admin panel or workspace settings to see if \* visibility settings like \* - Preview Aspect: isPreview \* - Visibility Aspect: includeHiddenPages \* - Visibility Aspect: includeHiddenContent \* - $simUserGroup \* should be applied to the current object. \* \* @param FrontendBackendUserAuthentication $backendUser \* @return string|null null if no changes to the current frontend usergroups have been made, otherwise the original list of frontend usergroups \* @internal \*/ protected function applyPreviewSettings($backendUser = null) { if (!$backendUser) { return null; } $originalFrontendUserGroup = null; if ($this->fe\_user->user) { $originalFrontendUserGroup = $this->context->getPropertyFromAspect('frontend.user', 'groupIds'); }
 // The preview flag is set if the current page turns out to be hidden if ($this->id && $this->determineIdIsHiddenPage()) { $this->context->setAspect('frontend.preview', GeneralUtility::makeInstance(PreviewAspect::class, true)); /\*\* @var VisibilityAspect $aspect \*/ $aspect = $this->context->getAspect('visibility'); $newAspect = GeneralUtility::makeInstance(VisibilityAspect::class, true, $aspect->includeHiddenContent(), $aspect->includeDeletedRecords()); $this->context->setAspect('visibility', $newAspect); } // The preview flag will be set if an offline workspace will be previewed if ($this->whichWorkspace() > 0) { $this->context->setAspect('frontend.preview', GeneralUtility::makeInstance(PreviewAspect::class, true)); } return $this->context->getPropertyFromAspect('frontend.preview', 'preview', false) ? $originalFrontendUserGroup : null; }
 /\*\* \* Checks if the page is hidden in the active workspace. \* If it is hidden, preview flags will be set. \* \* @return bool \*/ protected function determineIdIsHiddenPage() { $queryBuilder = GeneralUtility::makeInstance(ConnectionPool::class) ->getQueryBuilderForTable('pages'); $queryBuilder ->getRestrictions() ->removeAll() ->add(GeneralUtility::makeInstance(DeletedRestriction::class));
 $queryBuilder ->select('uid', 'hidden', 'starttime', 'endtime') ->from('pages') ->where( $queryBuilder->expr()->gte('pid', $queryBuilder->createNamedParameter(0, Connection::PARAM\_INT)) ) ->setMaxResults(1);
 // $this->id always points to the ID of the default language page, so we check // the current site language to determine if we need to fetch a translation but consider fallbacks if ($this->language->getLanguageId() > 0) { $languagesToCheck = array\_merge([$this->language->getLanguageId()], $this->language->getFallbackLanguageIds()); // Check for the language and all its fallbacks $constraint = $queryBuilder->expr()->andX( $queryBuilder->expr()->eq('l10n\_parent', $queryBuilder->createNamedParameter($this->id, Connection::PARAM\_INT)), $queryBuilder->expr()->in('sys\_language\_uid', $queryBuilder->createNamedParameter(array\_filter($languagesToCheck), Connection::PARAM\_INT\_ARRAY)) ); // If the fallback language Ids also contains the default language, this needs to be considered if (in\_array(0, $languagesToCheck, true)) { $constraint = $queryBuilder->expr()->orX( $constraint, // Ensure to also fetch the default record $queryBuilder->expr()->andX( $queryBuilder->expr()->eq('uid', $queryBuilder->createNamedParameter($this->id, Connection::PARAM\_INT)), $queryBuilder->expr()->in('sys\_language\_uid', 0) ) ); } // Ensure that the translated records are shown first (maxResults is set to 1) $queryBuilder->orderBy('sys\_language\_uid', 'DESC'); } else { $constraint = $queryBuilder->expr()->eq('uid', $queryBuilder->createNamedParameter($this->id, Connection::PARAM\_INT)); } $queryBuilder->andWhere($constraint);
 $page = $queryBuilder->executeQuery()->fetchAssociative();
 if ($this->whichWorkspace() > 0) { // Fetch overlay of page if in workspace and check if it is hidden $customContext = clone $this->context; $customContext->setAspect('workspace', GeneralUtility::makeInstance(WorkspaceAspect::class, $this->whichWorkspace())); $customContext->setAspect('visibility', GeneralUtility::makeInstance(VisibilityAspect::class)); $pageSelectObject = GeneralUtility::makeInstance(PageRepository::class, $customContext); $targetPage = $pageSelectObject->getWorkspaceVersionOfRecord($this->whichWorkspace(), 'pages', $page['uid']); // Also checks if the workspace version is NOT hidden but the live version is in fact still hidden $result = $targetPage === -1 || $targetPage === -2 || (is\_array($targetPage) && $targetPage['hidden'] == 0 && $page['hidden'] == 1); } else { $result = is\_array($page) && ($page['hidden'] || $page['starttime'] > $GLOBALS['SIM\_EXEC\_TIME'] || $page['endtime'] != 0 && $page['endtime'] <= $GLOBALS['SIM\_EXEC\_TIME']); } return $result; }
 /\*\* \* Resolves the page id and sets up several related properties. \* \* If $this->id is not set at all or is not a plain integer, the method \* does it's best to set the value to an integer. Resolving is based on \* this options: \* \* - Splitting $this->id if it contains an additional type parameter. \* - Finding the domain record start page \* - First visible page \* - Relocating the id below the domain record if outside \* \* The following properties may be set up or updated: \* \* - id \* - requestedId \* - type \* - sys\_page \* - sys\_page->where\_groupAccess \* - sys\_page->where\_hid\_del \* - Context: FrontendUser Aspect \* - no\_cache \* - register['SYS\_LASTCHANGED'] \* - pageNotFound \* \* Via getPageAndRootlineWithDomain() \* \* - rootLine \* - page \* - MP \* - originalShortcutPage \* - originalMountPointPage \* - pageAccessFailureHistory['direct\_access'] \* - pageNotFound \* \* @todo: \* \* On the first impression the method does to much. This is increased by \* the fact, that is is called repeated times by the method determineId. \* The reasons are manifold. \* \* 1.) The first part, the creation of sys\_page and the type \* resolution don't need to be repeated. They could be separated to be \* called only once. \* \* 2.) The user group setup could be done once on a higher level. \* \* 3.) The workflow of the resolution could be elaborated to be less \* tangled. Maybe the check of the page id to be below the domain via the \* root line doesn't need to be done each time, but for the final result \* only. \* \* 4.) The root line does not need to be directly addressed by this class. \* A root line is always related to one page. The rootline could be handled \* indirectly by page objects. Page objects still don't exist. \* \* @internal \* @param ServerRequestInterface|null $request \*/ protected function fetch\_the\_id(ServerRequestInterface $request = null) { $request = $request ?? $GLOBALS['TYPO3\_REQUEST'] ?? ServerRequestFactory::fromGlobals(); $timeTracker = $this->getTimeTracker(); $timeTracker->push('fetch\_the\_id initialize/'); // Set the valid usergroups for FE $this->initUserGroups(); // Initialize the PageRepository has to be done after the frontend usergroups are initialized / resolved, as // frontend group aspect is modified before $this->sys\_page = GeneralUtility::makeInstance(PageRepository::class, $this->context); // The id and type is set to the integer-value - just to be sure... $this->id = (int)$this->id; $this->type = (int)$this->type; $timeTracker->pull(); // We find the first page belonging to the current domain $timeTracker->push('fetch\_the\_id domain/'); if (!$this->id) { // If the id was not previously set, set it to the root page id of the site. $this->id = $this->site->getRootPageId(); } $timeTracker->pull(); $timeTracker->push('fetch\_the\_id rootLine/'); // We store the originally requested id $this->requestedId = $this->id; try { $this->getPageAndRootlineWithDomain($this->site->getRootPageId(), $request); } catch (ShortcutTargetPageNotFoundException $e) { $this->pageNotFound = 1; } $timeTracker->pull(); if ($this->pageNotFound) { switch ($this->pageNotFound) { case 1: $response = GeneralUtility::makeInstance(ErrorController::class)->accessDeniedAction( $request,[View remainder of file in raw view](https://github.com/TYPO3/typo3/raw/refs/tags/v11.5.22/typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_9a493931_20250114_193354.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTYPO3%2Ftypo3%2Fcommit%2F0005a6fd86ab97eff8bf2e3a5828bf0e7cb6263a)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTYPO3%2Ftypo3%2Fcommit%2F0005a6fd86ab97eff8bf2e3a5828bf0e7cb6263a)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=TYPO3%2Ftypo3)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[TYPO3](/TYPO3)
/
**[typo3](/TYPO3/typo3)**
Public

* [Notifications](/login?return_to=%2FTYPO3%2Ftypo3) You must be signed in to change notification settings
* [Fork
  674](/login?return_to=%2FTYPO3%2Ftypo3)
* [Star
   1.1k](/login?return_to=%2FTYPO3%2Ftypo3)

* [Code](/TYPO3/typo3)
* [Pull requests
  0](/TYPO3/typo3/pulls)
* [Actions](/TYPO3/typo3/actions)
* [Projects
  0](/TYPO3/typo3/projects)
* [Security](/TYPO3/typo3/security)
* [Insights](/TYPO3/typo3/pulse)

Additional navigation options

* [Code](/TYPO3/typo3)
* [Pull requests](/TYPO3/typo3/pulls)
* [Actions](/TYPO3/typo3/actions)
* [Projects](/TYPO3/typo3/projects)
* [Security](/TYPO3/typo3/security)
* [Insights](/TYPO3/typo3/pulse)

## Commit

[Permalink](/TYPO3/typo3/commit/0005a6fd86ab97eff8bf2e3a5828bf0e7cb6263a)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[SECURITY] Prevent XSS due to wrong PATH\_INFO evaluation

[Browse files](/TYPO3/typo3/tree/0005a6fd86ab97eff8bf2e3a5828bf0e7cb6263a)
Browse the repository at this point in the history

```
As already started in #88304 (but only for NormalizedParams)
and later reverted in #89312 (because of cgi-bin problems),
PATH_INFO is no longer considered as a preferable SCRIPT_NAME
alternative. All known server configurations set SCRIPT_NAME
these days to a proper value when cgi.fix_pathinfo is set.

The fallback to PATH_INFO has been introduced with
the initial revision of TYPO3 and isn't needed at all nowadays,
it's actually wrong, as a REQUEST_URI like /index.php/foo/bar
would incorrectly be interpreted as $scriptName == "/foo/bar",
which let's all calculations on $scriptName fail and
even leads to XSS where values derived from $scriptName are
printed without being escaped.

Also any ORIG_SCRIPT_NAME evaluation is dropped, as this variable
contains the SCRIPT_NAME that was set by the webserver configuration
before PHP applied cgi.fix_pathinfo. Using ORIG_SCRIPT_NAME
effectively meant bypassing PHP's pathinfo fix. It usually contains
the cgi-wrapper paths, which is why PATH_INFO was used to overrule
wrong ORIG_SCRIPT_NAME values.

GeneralUtility::getIndpEnv('PATH_INFO') is adapted to trust the
servers PATH_INFO information, now that we no longer allow
servers to send SCRIPT_NAME as PATH_INFO (we enforce
cgi.fix_pathinfo=1 for CGI installations).

The normalized SCRIPT_NAME is now adapted to be encoded as a URL
path by default, as all TYPO3 usages expect this to be an URL path.
Note that $_SERVER['SCRIPT_NAME'] refers to the servers file
system path, not the URL encoded value.

This SCRIPT_NAME sanitization actually enables:

a) TYPO3 to be run in a subfolder that contains characters
that need URL encoding
e.g. `/test:site/` – url encoded that'd be `/test3Asite/`.

b) prevention of XSS in case third party extensions
missed to escape any URL that is derived from SCRIPT_NAME
(while making sure that properly escaped
output is not double escaped)

Resolves: #99651
Related: #88304
Related: #89312
Releases: main, 11.5, 10.4
Change-Id: Ief95253d764665db5182a15ce8ffd02ea02ee61e
Security-Bulletin: TYPO3-CORE-SA-2023-001
Security-References: [CVE-2023-24814](https://github.com/advisories/GHSA-r4f8-f93x-5qh3 "CVE-2023-24814")
Reviewed-on: [https://review.typo3.org/c/Packages/TYPO3.CMS/+/77739](https://review.typo3.org/c/Packages/TYPO3.CMS/%2B/77739)
Tested-by: Oliver Hader <oliver.hader@typo3.org>
Reviewed-by: Oliver Hader <oliver.hader@typo3.org>
```

* Loading branch information

[![@bnf](https://avatars.githubusercontent.com/u/473155?s=40&v=4)](/bnf) [![@ohader](https://avatars.githubusercontent.com/u/402145?s=40&v=4)](/ohader)

[bnf](/TYPO3/typo3/commits?author=bnf "View all commits by bnf")
authored and
[ohader](/TYPO3/typo3/commits?author=ohader "View all commits by ohader")
committed
Feb 7, 2023

1 parent
[db06e68](/TYPO3/typo3/commit/db06e6869486fd770fb41c5e0405fcc2add636c6)

commit 0005a6f

 Show file tree

 Hide file tree

Showing
**8 changed files**
with
**55 additions**
and
**119 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* typo3/sysext

  + core

    - Classes

      * Core

        + typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php
          [SystemEnvironmentBuilder.php](#diff-6741e97bb4577d2c32db4e7a708f4dd7071ac4b1079af833c689eaa47b7766d1)
      * Http

        + typo3/sysext/core/Classes/Http/NormalizedParams.php
          [NormalizedParams.php](#diff-b2d3fe7548e27729d76bd4bab72fe94c6c1c25e3aa642b7c2bccd48e13bd3523)
      * Utility

        + typo3/sysext/core/Classes/Utility/GeneralUtility.php
          [GeneralUtility.php](#diff-ecd93e69fd98828ae7d0d7dd66900a8c0ac22ed8850a5dcba20a2b4d9fd4d8a5)
    - Tests

      * Acceptance/Support/Extension

        + typo3/sysext/core/Tests/Acceptance/Support/Extension/ApplicationEnvironment.php
          [ApplicationEnvironment.php](#diff-42c0caf4a00cab4e10215787cc61f610a5e129e865ea59070d1c909fab059330)
      * Unit

        + Http

          - typo3/sysext/core/Tests/Unit/Http/NormalizedParamsTest.php
            [NormalizedParamsTest.php](#diff-72d596ee0e20185f4e28a816bceeafb93492f70f1596e34e5c2f2451b632373d)
        + Log/Processor

          - typo3/sysext/core/Tests/Unit/Log/Processor/WebProcessorTest.php
            [WebProcessorTest.php](#diff-50f60b83c11d3babd41851845be946be8ceac4616c92e772420464faeafbd74d)
  + felogin/Tests/Unit/Validation

    - typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php
      [RedirectUrlValidatorTest.php](#diff-cb8263939eb8bd48778b677eb552c9cca78ef1eb9111da106f0a72494ea02525)
  + frontend/Classes/Controller

    - typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php
      [TypoScriptFrontendController.php](#diff-6dd96118370dfe9aba2916b16f7c479d482af2fae7a4fe20a37553b03cf8d997)

## There are no files selected for viewing

16 changes: 5 additions & 11 deletions

16
[typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php](#diff-6741e97bb4577d2c32db4e7a708f4dd7071ac4b1079af833c689eaa47b7766d1 "typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php")

Show comments

[View file](/TYPO3/typo3/blob/0005a6fd86ab97eff8bf2e3a5828bf0e7cb6263a/typo3/sysext/core/Classes/Core/SystemEnvironmentBuilder.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -255,23 +255,17 @@ protected static function getPathThisScript(bool $isCli) |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Calculate path to entry script if not in cli mode. |
|  |  | \* |
|  |  | \* Depending on the environment, the script path is found in different $\_SERVER variables. |
|  |  | \* Return path to entry script if not in cli mode. |
|  |  | \* |
|  |  | \* @return string Absolute path to entry script |
|  |  | \*/ |
|  |  | protected static function getPathThisScriptNonCli() |
|  |  | { |
|  |  | $isCgi = Environment::isRunningOnCgiServer(); |
|  |  | if ($isCgi && Environment::usesCgiFixPathInfo()) { |
|  |  | return $\_SERVER['SCRIPT\_FILENAME']; |
|  |  | } |
|  |  | $cgiPath = $\_SERVER['ORIG\_PATH\_TRANSLATED'] ?? $\_SERVER['PATH\_TRANSLATED'] ?? ''; |
|  |  | if ($cgiPath && $isCgi) { |
|  |  | return $cgiPath; |
|  |  | if (Environment::isRunningOnCgiServer() && !Environment::usesCgiFixPathInfo()) { |
|  |  | throw new \Exception('TYPO3 does only support being used with cgi.fix\_pathinfo=1 on CGI server APIs.', 1675108421); |
|  |  | } |
|  |  | return $\_SERVER['ORIG\_SCRIPT\_FILENAME'] ?? $\_SERVER['SCRIPT\_FILENAME']; |
|  |  |  |
|  |  | return $\_SERVER['SCRIPT\_FILENAME']; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
| Expand Down | |  |

28 changes: 12 additions & 16 deletions

28
[typo3/sysext/core/Classes/Http/NormalizedParams.php](#diff-b2d3fe7548e27729d76bd4bab72fe94c6c1c25e3aa642b7c2bccd48e13bd3523 "typo3/sysext/core/Classes/Http/NormalizedParams.php")

Show comments

[View file](/TYPO3/typo3/blob/0005a6fd86ab97eff8bf2e3a5828bf0e7cb6263a/typo3/sysext/core/Classes/Http/NormalizedParams.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -311,12 +311,13 @@ public function \_\_construct(array $serverParams, array $configuration, string $p |
|  |  | $requestHost = $this->requestHost = ($isHttps ? 'https://' : 'http://') . $httpHost; |
|  |  | $requestHostOnly = $this->requestHostOnly = self::determineRequestHostOnly($httpHost); |
|  |  | $this->requestPort = self::determineRequestPort($httpHost, $requestHostOnly); |
|  |  | $scriptName = $this->scriptName = self::determineScriptName( |
|  |  | $scriptNameOnFileSystem = self::determineScriptName( |
|  |  | $serverParams, |
|  |  | $configuration, |
|  |  | $isHttps, |
|  |  | $isBehindReverseProxy |
|  |  | ); |
|  |  | $scriptName = $this->scriptName = self::encodeFileSystemPathComponentForUrlPath($scriptNameOnFileSystem); |
|  |  | $requestUri = $this->requestUri = self::determineRequestUri( |
|  |  | $serverParams, |
|  |  | $configuration, |
| Expand All | | @@ -329,7 +330,7 @@ public function \_\_construct(array $serverParams, array $configuration, string $p |
|  |  | $requestDir = $this->requestDir = $requestHost . GeneralUtility::dirname($scriptName) . '/'; |
|  |  | $this->remoteAddress = self::determineRemoteAddress($serverParams, $configuration, $isBehindReverseProxy); |
|  |  | $scriptFilename = $this->scriptFilename = $pathThisScript; |
|  |  | $this->documentRoot = self::determineDocumentRoot($scriptName, $scriptFilename); |
|  |  | $this->documentRoot = self::determineDocumentRoot($scriptNameOnFileSystem, $scriptFilename); |
|  |  | $siteUrl = $this->siteUrl = self::determineSiteUrl($requestDir, $pathThisScript, $pathSite . '/'); |
|  |  | $this->sitePath = self::determineSitePath($requestHost, $siteUrl); |
|  |  | $this->siteScript = self::determineSiteScript($requestUrl, $siteUrl); |
| Expand All | | @@ -344,6 +345,11 @@ public function \_\_construct(array $serverParams, array $configuration, string $p |
|  |  | $this->queryString = $serverParams['QUERY\_STRING'] ?? ''; |
|  |  | } |
|  |  |  |
|  |  | private static function encodeFileSystemPathComponentForUrlPath(string $path): string |
|  |  | { |
|  |  | return implode('/', array\_map('rawurlencode', explode('/', $path))); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* @return string Sanitized HTTP\_HOST value host[:port] |
|  |  | \*/ |
| Expand Down  Expand Up | | @@ -632,17 +638,7 @@ protected static function determineScriptName( |
|  |  | bool $isHttps, |
|  |  | bool $isBehindReverseProxy |
|  |  | ): string { |
|  |  | // see https://forge.typo3.org/issues/89312 |
|  |  | // When using a CGI wrapper to dispatch the PHP process `ORIG\_SCRIPT\_NAME` |
|  |  | // contains the name of the wrapper script (which is most probably outside |
|  |  | // the TYPO3's project root) and leads to invalid prefixes, e.g. resolving |
|  |  | // the `siteUrl` incorrectly as `http://ip10.local/fcgi/` instead of |
|  |  | // actual `http://ip10.local/` |
|  |  | $possiblePathInfo = ($serverParams['ORIG\_PATH\_INFO'] ?? '') ?: ($serverParams['PATH\_INFO'] ?? ''); |
|  |  | $possibleScriptName = ($serverParams['ORIG\_SCRIPT\_NAME'] ?? '') ?: ($serverParams['SCRIPT\_NAME'] ?? ''); |
|  |  | $scriptName = Environment::isRunningOnCgiServer() && $possiblePathInfo |
|  |  | ? $possiblePathInfo |
|  |  | : $possibleScriptName; |
|  |  | $scriptName = $serverParams['SCRIPT\_NAME'] ?? ''; |
|  |  | if ($isBehindReverseProxy) { |
|  |  | // Add a prefix if TYPO3 is behind a proxy: ext-domain.com => int-server.com/prefix |
|  |  | if ($isHttps && !empty($configuration['reverseProxyPrefixSSL'])) { |
| Expand Down  Expand Up | | @@ -778,19 +774,19 @@ protected static function determineRequestPort(string $httpHost, string $httpHos |
|  |  | /\*\* |
|  |  | \* Calculate absolute path to web document root |
|  |  | \* |
|  |  | \* @param string $scriptName Entry script path of URI, without domain and without query parameters, with leading / |
|  |  | \* @param string $scriptNameOnFileSystem Entry script path of URI on file system, without domain and without query parameters, with leading / |
|  |  | \* @param string $scriptFilename Absolute path to entry script on server filesystem |
|  |  | \* @return string Path to document root with trailing slash |
|  |  | \*/ |
|  |  | protected static function determineDocumentRoot(string $scriptName, string $scriptFilename): string |
|  |  | protected static function determineDocumentRoot(string $scriptNameOnFileSystem, string $scriptFilename): string |
|  |  | { |
|  |  | // Get the web root (it is not the root of the TYPO3 installation) |
|  |  | // Some CGI-versions (LA13CGI) and mod-rewrite rules on MODULE versions will deliver a 'wrong' |
|  |  | // DOCUMENT\_ROOT (according to our description). Further various aliases/mod\_rewrite rules can |
|  |  | // disturb this as well. Therefore the DOCUMENT\_ROOT is always calculated as the SCRIPT\_FILENAME |
|  |  | // minus the end part shared with SCRIPT\_NAME. |
|  |  | $webDocRoot = ''; |
|  |  | $scriptNameArray = explode('/', strrev($scriptName)); |
|  |  | $scriptNameArray = explode('/', strrev($scriptNameOnFileSystem)); |
|  |  | $scriptFilenameArray = explode('/', strrev($scriptFilename)); |
|  |  | $path = []; |
|  |  | foreach ($scriptNameArray as $segmentNumber => $segment) { |
| Expand Down | |  |

28 changes: 12 additions & 16 deletions

28
[typo3/sysext/core/Classes/Utility/GeneralUtility.php](#diff-ecd93e69fd98828ae7d0d7dd66900a8c0ac22ed8850a5dcba20a2b4d9fd4d8a5 "typo3/sysext/core/Classes/Utility/GeneralUtility.php")

Show comments

[View file](/TYPO3/typo3/blob/0005a6fd86ab97eff8bf2e3a5828bf0e7cb6263a/typo3/sysext/core/Classes/Utility/GeneralUtility.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2310,10 +2310,7 @@ public static function getIndpEnv($getEnvName) |
|  |  | $retVal = ''; |
|  |  | switch ((string)$getEnvName) { |
|  |  | case 'SCRIPT\_NAME': |
|  |  | $retVal = Environment::isRunningOnCgiServer() |
|  |  | && (($\_SERVER['ORIG\_PATH\_INFO'] ?? false) ?: ($\_SERVER['PATH\_INFO'] ?? false)) |
|  |  | ? (($\_SERVER['ORIG\_PATH\_INFO'] ?? '') ?: ($\_SERVER['PATH\_INFO'] ?? '')) |
|  |  | : (($\_SERVER['ORIG\_SCRIPT\_NAME'] ?? '') ?: ($\_SERVER['SCRIPT\_NAME'] ?? '')); |
|  |  | $retVal = $\_SERVER['SCRIPT\_NAME'] ?? ''; |
|  |  | // Add a prefix if TYPO3 is behind a proxy: ext-domain.com => int-server.com/prefix |
|  |  | if (self::cmpIP($\_SERVER['REMOTE\_ADDR'] ?? '', $GLOBALS['TYPO3\_CONF\_VARS']['SYS']['reverseProxyIP'] ?? '')) { |
|  |  | if (self::getIndpEnv('TYPO3\_SSL') && $GLOBALS['TYPO3\_CONF\_VARS']['SYS']['reverseProxyPrefixSSL']) { |
| Expand All | | @@ -2322,6 +2319,7 @@ public static function getIndpEnv($getEnvName) |
|  |  | $retVal = $GLOBALS['TYPO3\_CONF\_VARS']['SYS']['reverseProxyPrefix'] . $retVal; |
|  |  | } |
|  |  | } |
|  |  | $retVal = self::encodeFileSystemPathComponentForUrlPath($retVal); |
|  |  | break; |
|  |  | case 'SCRIPT\_FILENAME': |
|  |  | $retVal = Environment::getCurrentScript(); |
| Expand Down  Expand Up | | @@ -2350,17 +2348,7 @@ public static function getIndpEnv($getEnvName) |
|  |  | } |
|  |  | break; |
|  |  | case 'PATH\_INFO': |
|  |  | // $\_SERVER['PATH\_INFO'] != $\_SERVER['SCRIPT\_NAME'] is necessary because some servers (Windows/CGI) |
|  |  | // are seen to set PATH\_INFO equal to script\_name |
|  |  | // Further, there must be at least one '/' in the path - else the PATH\_INFO value does not make sense. |
|  |  | // IF 'PATH\_INFO' never works for our purpose in TYPO3 with CGI-servers, |
|  |  | // then 'PHP\_SAPI=='cgi'' might be a better check. |
|  |  | // Right now strcmp($\_SERVER['PATH\_INFO'], GeneralUtility::getIndpEnv('SCRIPT\_NAME')) will always |
|  |  | // return FALSE for CGI-versions, but that is only as long as SCRIPT\_NAME is set equal to PATH\_INFO |
|  |  | // because of PHP\_SAPI=='cgi' (see above) |
|  |  | if (!Environment::isRunningOnCgiServer()) { |
|  |  | $retVal = $\_SERVER['PATH\_INFO'] ?? ''; |
|  |  | } |
|  |  | $retVal = $\_SERVER['PATH\_INFO'] ?? ''; |
|  |  | break; |
|  |  | case 'TYPO3\_REV\_PROXY': |
|  |  | $retVal = self::cmpIP($\_SERVER['REMOTE\_ADDR'] ?? '', $GLOBALS['TYPO3\_CONF\_VARS']['SYS']['reverseProxyIP']); |
| Expand Down  Expand Up | | @@ -2433,7 +2421,10 @@ public static function getIndpEnv($getEnvName) |
|  |  | // Some CGI-versions (LA13CGI) and mod-rewrite rules on MODULE versions will deliver a 'wrong' DOCUMENT\_ROOT (according to our description). Further various aliases/mod\_rewrite rules can disturb this as well. |
|  |  | // Therefore the DOCUMENT\_ROOT is now always calculated as the SCRIPT\_FILENAME minus the end part shared with SCRIPT\_NAME. |
|  |  | $SFN = self::getIndpEnv('SCRIPT\_FILENAME'); |
|  |  | $SN\_A = explode('/', strrev(self::getIndpEnv('SCRIPT\_NAME'))); |
|  |  | // Use rawurldecode to reverse the result of self::encodeFileSystemPathComponentForUrlPath() |
|  |  | // which has been applied to getIndpEnv(SCRIPT\_NAME) for web URI usage. |
|  |  | // We compare with a file system path (SCRIPT\_FILENAME) in here and therefore need to undo the encoding. |
|  |  | $SN\_A = array\_map('rawurldecode', explode('/', strrev(self::getIndpEnv('SCRIPT\_NAME')))); |
|  |  | $SFN\_A = explode('/', strrev($SFN)); |
|  |  | $acc = []; |
|  |  | foreach ($SN\_A as $kk => $vv) { |
| Expand Down  Expand Up | | @@ -2558,6 +2549,11 @@ protected static function webserverUsesHttps() |
|  |  | return !empty($\_SERVER['HTTPS']) && strtolower($\_SERVER['HTTPS']) !== 'off'; |
|  |  | } |
|  |  |  |
|  |  | protected static function encodeFileSystemPathComponentForUrlPath(string $path): string |
|  |  | { |
|  |  | return implode('/', array\_map('rawurlencode', explode('/', $path))); |
|  |  | } |
|  |  |  |
|  |  | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* |
|  |  | \* |
|  |  | \* TYPO3 SPECIFIC FUNCTIONS |
| Expand Down | |  |

1 change: 0 additions & 1 deletion

1
[typo3/sysext/core/Tests/Acceptance/Support/Extension/ApplicationEnvironment.php](#diff-42c0caf4a00cab4e10215787cc61f610a5e129e865ea59070d1c909fab059330 "typo3/sysext/core/Tests/Acceptance/Support/Extension/ApplicationEnvironment.php")

Show comments

[View file](/TYPO3/typo3/blob/0005a6fd86ab97eff8bf2e3a5828bf0e7cb6263a/typo3/sysext/core/Tests/Acceptance/Support/Extension/ApplicationEnvironment.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -145,7 +145,6 @@ private function createServerRequest(string $url, string $method = 'GET'): Serve |
|  |  | 'SCRIPT\_NAME' => '/typo3/index.php', |
|  |  | 'PHP\_SELF' => '/typo3/index.php', |
|  |  | 'SCRIPT\_FILENAME' => $docRoot . '/index.php', |
|  |  | 'PATH\_TRANSLATED' => $docRoot . '/index.php', |
|  |  | 'QUERY\_STRING' => $requestUrlParts['query'] ?? '', |
|  |  | 'REQUEST\_URI' => $requestUrlParts['path'] . (isset($requestUrlParts['query']) ? '?' . $requestUrlParts['query'] : ''), |
|  |  | 'REQUEST\_METHOD' => $method, |
| Expand Down | |  |

85 changes: 18 additions & 67 deletions

85
[typo3/sysext/core/Tests/Unit/Http/NormalizedParamsTest.php](#diff-72d596ee0e20185f4e28a816bceeafb93492f70f1596e34e5c2f2451b632373d "typo3/sysext/core/Tests/Unit/Http/NormalizedParamsTest.php")

Show comments

[View file](/TYPO3/typo3/blob/0005a6fd86ab97eff8bf2e3a5828bf0e7cb6263a/typo3/sysext/core/Tests/Unit/Http/NormalizedParamsTest.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -360,77 +360,19 @@ public function getScriptNameReturnsExpectedValueDataProvider(): array |
|  |  | [], |
|  |  | '', |
|  |  | ], |
|  |  | 'use ORIG\_SCRIPT\_NAME if ORIG\_PATH\_INFO is set but empty' => [ |
|  |  | [ |
|  |  | 'ORIG\_PATH\_INFO' => '', |
|  |  | 'PATH\_INFO' => '', |
|  |  | 'ORIG\_SCRIPT\_NAME' => '/orig/script/name.php', |
|  |  | 'SCRIPT\_NAME' => '/script/name.php', |
|  |  | ], |
|  |  | [], |
|  |  | '/orig/script/name.php', |
|  |  | ], |
|  |  | 'use ORIG\_SCRIPT\_NAME if PATH\_INFO is set but empty' => [ |
|  |  | [ |
|  |  | 'PATH\_INFO' => '', |
|  |  | 'ORIG\_SCRIPT\_NAME' => '/orig/script/name.php', |
|  |  | 'SCRIPT\_NAME' => '/script/name.php', |
|  |  | ], |
|  |  | [], |
|  |  | '/orig/script/name.php', |
|  |  | ], |
|  |  | 'use SCRIPT\_NAME if ORIG\_PATH\_INFO is set but empty' => [ |
|  |  | [ |
|  |  | 'ORIG\_PATH\_INFO' => '', |
|  |  | 'PATH\_INFO' => '', |
|  |  | 'ORIG\_SCRIPT\_NAME' => '', |
|  |  | 'SCRIPT\_NAME' => '/script/name.php', |
|  |  | ], |
|  |  | [], |
|  |  | '/script/name.php', |
|  |  | ], |
|  |  | 'use SCRIPT\_NAME if PATH\_INFO is set but empty' => [ |
|  |  | [ |
|  |  | 'PATH\_INFO' => '', |
|  |  | 'ORIG\_SCRIPT\_NAME' => '', |
|  |  | 'SCRIPT\_NAME' => '/script/name.php', |
|  |  | ], |
|  |  | [], |
|  |  | '/script/name.php', |
|  |  | ], |
|  |  | 'use SCRIPT\_NAME if ORIG\_PATH\_INFO is set' => [ |
|  |  | [ |
|  |  | 'ORIG\_PATH\_INFO' => '/foo/bar', |
|  |  | 'PATH\_INFO' => '', |
|  |  | 'ORIG\_SCRIPT\_NAME' => '', |
|  |  | 'SCRIPT\_NAME' => '/script/name.php', |
|  |  | ], |
|  |  | [], |
|  |  | '/script/name.php', |
|  |  | ], |
|  |  | 'use SCRIPT\_NAME if PATH\_INFO is set' => [ |
|  |  | 'use SCRIPT\_NAME' => [ |
|  |  | [ |
|  |  | 'PATH\_INFO' => '/foo/bar', |
|  |  | 'ORIG\_SCRIPT\_NAME' => '', |
|  |  | 'SCRIPT\_NAME' => '/script/name.php', |
|  |  | ], |
|  |  | [], |
|  |  | '/script/name.php', |
|  |  | ], |
|  |  | 'use ORIG\_SCRIPT\_NAME' => [ |
|  |  | [ |
|  |  | 'ORIG\_SCRIPT\_NAME' => '/orig/script/name.php', |
|  |  | 'SCRIPT\_NAME' => '/script/name.php', |
|  |  | ], |
|  |  | [], |
|  |  | '/orig/script/name.php', |
|  |  | ], |
|  |  | 'use SCRIPT\_NAME' => [ |
|  |  | 'apply URL encoding to SCRIPT\_NAME' => [ |
|  |  | [ |
|  |  | 'SCRIPT\_NAME' => '/script/name.php', |
|  |  | 'SCRIPT\_NAME' => '/test:site/script/name.php', |
|  |  | ], |
|  |  | [], |
|  |  | '/script/name.php', |
|  |  | '/test%3Asite/script/name.php', |
|  |  | ], |
|  |  | 'add proxy ssl prefix' => [ |
|  |  | [ |
| Expand Down  Expand Up | | @@ -497,6 +439,14 @@ public function getRequestUriReturnsExpectedValueDataProvider(): array |
|  |  | [], |
|  |  | '/typo3/index.php?parameter=foo/bar&id=42', |
|  |  | ], |
|  |  | 'use query string and script name in special subdirectory if REQUEST\_URI is not set' => [ |
|  |  | [ |
|  |  | 'QUERY\_STRING' => 'parameter=foo/bar&id=42', |
|  |  | 'SCRIPT\_NAME' => '/sub:dir/typo3/index.php', |
|  |  | ], |
|  |  | [], |
|  |  | '/sub%3Adir/typo3/index.php?parameter=foo/bar&id=42', |
|  |  | ], |
|  |  | 'prefix with proxy prefix with ssl if using REQUEST\_URI' => [ |
|  |  | [ |
|  |  | 'HTTP\_HOST' => 'www.domain.com', |
| Expand Down  Expand Up | | @@ -905,7 +855,6 @@ public function getSiteUrlReturnsExpectedUrl(): void |
|  |  | $serverParams = [ |
|  |  | 'SCRIPT\_NAME' => '/typo3/index.php', |
|  |  | 'HTTP\_HOST' => 'www.domain.com', |
|  |  | 'PATH\_INFO' => '/typo3/index.php', |
|  |  | ]; |
|  |  | $pathThisScript = '/var/www/myInstance/Web/typo3/index.php'; |
|  |  | $pathSite = '/var/www/myInstance/Web'; |
| Expand Down  Expand Up | | @@ -978,7 +927,8 @@ public function getSiteScriptReturnsExpectedPathDataProvider(): array |
|  |  | return [ |
|  |  | 'not in a sub directory' => [ |
|  |  | [ |
|  |  | 'SCRIPT\_NAME' => '/typo3/index.php?id=42&foo=bar', |
|  |  | 'SCRIPT\_NAME' => '/typo3/index.php', |
|  |  | 'REQUEST\_URI' => '/typo3/index.php?id=42&foo=bar', |
|  |  | 'HTTP\_HOST' => 'www.domain.com', |
|  |  | ], |
|  |  | '/var/www/myInstance/Web/typo3/index.php', |
| Expand All | | @@ -987,7 +937,8 @@ public function getSiteScriptReturnsExpectedPathDataProvider(): array |
|  |  | ], |
|  |  | 'in a sub directory' => [ |
|  |  | [ |
|  |  | 'SCRIPT\_NAME' => '/some/sub/dir/typo3/index.php?id=42&foo=bar', |
|  |  | 'SCRIPT\_NAME' => '/some/sub/dir/typo3/index.php', |
|  |  | 'REQUEST\_URI' => '/some/sub/dir/typo3/index.php?id=42&foo=bar', |
|  |  | 'HTTP\_HOST' => 'www.domain.com', |
|  |  | ], |
|  |  | '/var/www/myInstance/Web/typo3/index.php', |
| Expand Down  Expand Up | | @@ -1023,9 +974,9 @@ public function getSiteScriptReturnsExpectedPath(array $serverParams, string $pa |
|  |  | public function getPathInfoReturnsExpectedValue(): void |
|  |  | { |
|  |  | $serverParams = [ |
|  |  | 'PATH\_INFO' => '/typo3/index.php', |
|  |  | 'PATH\_INFO' => '/foo/bar', |
|  |  | ]; |
|  |  | $expected = '/typo3/index.php'; |
|  |  | $expected = '/foo/bar'; |
|  |  | $serverRequestParameters = new NormalizedParams($serverParams, [], '', ''); |
|  |  | self::assertSame($expected, $serverRequestParameters->getPathInfo()); |
|  |  | } |
| Expand Down | |  |

3 changes: 1 addition & 2 deletions

3
[typo3/sysext/core/Tests/Unit/Log/Processor/WebProcessorTest.php](#diff-50f60b83c11d3babd41851845be946be8ceac4616c92e772420464faeafbd74d "typo3/sysext/core/Tests/Unit/Log/Processor/WebProcessorTest.php")

Show comments

[View file](/TYPO3/typo3/blob/0005a6fd86ab97eff8bf2e3a5828bf0e7cb6263a/typo3/sysext/core/Tests/Unit/Log/Processor/WebProcessorTest.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -30,9 +30,8 @@ class WebProcessorTest extends UnitTestCase |
|  |  | \*/ |
|  |  | public function webProcessorAddsWebDataToLogRecord(): void |
|  |  | { |
|  |  | $\_SERVER['PATH\_INFO'] = ''; |
|  |  | $\_SERVER['REQUEST\_URI'] = ''; |
|  |  | $\_SERVER['ORIG\_SCRIPT\_NAME'] = ''; |
|  |  | $\_SERVER['SCRIPT\_NAME'] = ''; |
|  |  | $\_SERVER['REMOTE\_ADDR'] = ''; |
|  |  | $\_SERVER['QUERY\_STRING'] = ''; |
|  |  | $\_SERVER['SSL\_SESSION\_ID'] = ''; |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php](#diff-cb8263939eb8bd48778b677eb552c9cca78ef1eb9111da106f0a72494ea02525 "typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php")

Show comments

[View file](/TYPO3/typo3/blob/0005a6fd86ab97eff8bf2e3a5828bf0e7cb6263a/typo3/sysext/felogin/Tests/Unit/Validation/RedirectUrlValidatorTest.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -64,7 +64,7 @@ protected function setUp(): void |
|  |  | \*/ |
|  |  | protected function setUpFakeSitePathAndHost(): void |
|  |  | { |
|  |  | $\_SERVER['ORIG\_PATH\_INFO'] = $\_SERVER['PATH\_INFO'] = $\_SERVER['ORIG\_SCRIPT\_NAME'] = $\_SERVER['SCRIPT\_NAME'] = $this->testSitePath . 'index.php'; |
|  |  | $\_SERVER['SCRIPT\_NAME'] = $this->testSitePath . 'index.php'; |
|  |  | $\_SERVER['HTTP\_HOST'] = $this->testHostName; |
|  |  |  |
|  |  | $request = ServerRequestFactory::fromGlobals(); |
| Expand Down | |  |

11 changes: 6 additions & 5 deletions

11
[typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php](#diff-6dd96118370dfe9aba2916b16f7c479d482af2fae7a4fe20a37553b03cf8d997 "typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php")

Show comments

[View file](/TYPO3/typo3/blob/0005a6fd86ab97eff8bf2e3a5828bf0e7cb6263a/typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2423,23 +2423,24 @@ protected function setAbsRefPrefix() |
|  |  | if (!$this->absRefPrefix) { |
|  |  | return; |
|  |  | } |
|  |  | $encodedAbsRefPrefix = htmlspecialchars($this->absRefPrefix, ENT\_QUOTES | ENT\_HTML5); |
|  |  | $search = [ |
|  |  | '"\_assets/', |
|  |  | '"typo3temp/', |
|  |  | '"' . PathUtility::stripPathSitePrefix(Environment::getExtensionsPath()) . '/', |
|  |  | '"' . PathUtility::stripPathSitePrefix(Environment::getFrameworkBasePath()) . '/', |
|  |  | ]; |
|  |  | $replace = [ |
|  |  | '"' . $this->absRefPrefix . '\_assets/', |
|  |  | '"' . $this->absRefPrefix . 'typo3temp/', |
|  |  | '"' . $this->absRefPrefix . PathUtility::stripPathSitePrefix(Environment::getExtensionsPath()) . '/', |
|  |  | '"' . $this->absRefPrefix . PathUtility::stripPathSitePrefix(Environment::getFrameworkBasePath()) . '/', |
|  |  | '"' . $encodedAbsRefPrefix . '\_assets/', |
|  |  | '"' . $encodedAbsRefPrefix . 'typo3temp/', |
|  |  | '"' . $encodedAbsRefPrefix . PathUtility::stripPathSitePrefix(Environment::getExtensionsPath()) . '/', |
|  |  | '"' . $encodedAbsRefPrefix . PathUtility::stripPathSitePrefix(Environment::getFrameworkBasePath()) . '/', |
|  |  | ]; |
|  |  | // Process additional directories |
|  |  | $directories = GeneralUtility::trimExplode(',', $GLOBALS['TYPO3\_CONF\_VARS']['FE']['additionalAbsRefPrefixDirectories'], true); |
|  |  | foreach ($directories as $directory) { |
|  |  | $search[] = '"' . $directory; |
|  |  | $replace[] = '"' . $this->absRefPrefix . $directory; |
|  |  | $replace[] = '"' . $encodedAbsRefPrefix . $directory; |
|  |  | } |
|  |  | $this->content = str\_replace( |
|  |  | $search, |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `0005a6f`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTYPO3%2Ftypo3%2Fcommit%2F0005a6fd86ab97eff8bf2e3a5828bf0e7cb6263a) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_cd281b57_20250114_193355.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTYPO3%2Ftypo3%2Fsecurity%2Fadvisories%2FGHSA-r4f8-f93x-5qh3)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTYPO3%2Ftypo3%2Fsecurity%2Fadvisories%2FGHSA-r4f8-f93x-5qh3)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=TYPO3%2Ftypo3)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[TYPO3](/TYPO3)
/
**[typo3](/TYPO3/typo3)**
Public

* [Notifications](/login?return_to=%2FTYPO3%2Ftypo3) You must be signed in to change notification settings
* [Fork
  674](/login?return_to=%2FTYPO3%2Ftypo3)
* [Star
   1.1k](/login?return_to=%2FTYPO3%2Ftypo3)

* [Code](/TYPO3/typo3)
* [Pull requests
  0](/TYPO3/typo3/pulls)
* [Actions](/TYPO3/typo3/actions)
* [Projects
  0](/TYPO3/typo3/projects)
* [Security](/TYPO3/typo3/security)
* [Insights](/TYPO3/typo3/pulse)

Additional navigation options

* [Code](/TYPO3/typo3)
* [Pull requests](/TYPO3/typo3/pulls)
* [Actions](/TYPO3/typo3/actions)
* [Projects](/TYPO3/typo3/projects)
* [Security](/TYPO3/typo3/security)
* [Insights](/TYPO3/typo3/pulse)

# Persisted Cross-Site Scripting in Frontend Rendering

High

[ohader](/ohader)
published
GHSA-r4f8-f93x-5qh3
Feb 7, 2023

## Package

composer

typo3/cms-core
([Composer](/advisories?query=ecosystem%3Acomposer))

## Affected versions

8.7.0-8.7.50, 9.0.0-9.5.39, 10.0.0-10.4.34, 11.0.0-11.5.22, 12.0.0-12.1.3

## Patched versions

8.7.51, 9.5.40, 10.4.36, 11.5.23, 12.2.0

## Description

> ### CVSS: `CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:H/A:L/E:F/RL:O/RC:C` (8.2)

### Problem

TYPO3 core component `GeneralUtility::getIndpEnv()` uses the unfiltered server environment variable `PATH_INFO`, which allows attackers to inject malicious content.

In combination with the TypoScript setting [`config.absRefPrefix=auto`](https://github.com/TYPO3/typo3/blob/v11.5.22/typo3/sysext/frontend/Classes/Controller/TypoScriptFrontendController.php#L2547-L2549), attackers can inject malicious HTML code into pages that have not yet been rendered and cached. As a result, injected values would be cached and delivered to other website visitors (persisted cross-site scripting).

Individual code which relies on the resolved value of [`GeneralUtility::getIndpEnv('SCRIPT_NAME')`](https://github.com/TYPO3/typo3/blob/v11.5.22/typo3/sysext/core/Classes/Utility/GeneralUtility.php#L2481-L2484) and corresponding usages (as shown below) are vulnerable as well.

* `GeneralUtility::getIndpEnv('PATH_INFO')`
* `GeneralUtility::getIndpEnv('SCRIPT_NAME')`
* `GeneralUtility::getIndpEnv('TYPO3_REQUEST_DIR')`
* `GeneralUtility::getIndpEnv('TYPO3_REQUEST_SCRIPT')`
* `GeneralUtility::getIndpEnv('TYPO3_SITE_PATH')`
* `GeneralUtility::getIndpEnv('TYPO3_SITE_SCRIPT')`
* `GeneralUtility::getIndpEnv('TYPO3_SITE_URL')`

Installations of TYPO3 versions 8.7 and 9.x are probably only affected when server environment variable [`TYPO3_PATH_ROOT`](https://docs.typo3.org/m/typo3/reference-coreapi/9.5/en-us/ApiOverview/Environment/Index.html#configuring-environment-paths) is defined - which is the case if they were installed via Composer.

Additional investigations confirmed that Apache and Microsoft IIS web servers using PHP-CGI (FPM, FCGI/FastCGI, or similar) are affected. There might be the risk that nginx is vulnerable as well. It was not possible to exploit Apache/mod\_php scenarios.

### Solution

The usage of server environment variable `PATH_INFO` has been removed from corresponding processings in `GeneralUtility::getIndpEnv()`. Besides that, the public property `TypoScriptFrontendController::$absRefPrefix` is encoded for both being used as a URI component and for being used as a prefix in an HTML context. This mitigates the cross-site scripting vulnerability.

Update to TYPO3 versions 8.7.51 ELTS, 9.5.40 ELTS, 10.4.36 LTS, 11.5.23 LTS and 12.2.0 that fix the problem described above.

> ℹ️ **Strong security defaults - Manual actions required**
>
> Any web server using PHP-CGI (FPM, FCGI/FastCGI, or similar) needs to ensure that the PHP setting [**`cgi.fix_pathinfo=1`**](https://www.php.net/manual/en/ini.core.php#ini.cgi.fix-pathinfo) is used, which is the default PHP setting. In case this setting is not enabled, an exception is thrown to avoid continuing with invalid path information.

For websites that cannot be patched timely the TypoScript setting [`config.absRefPrefix`](https://docs.typo3.org/m/typo3/reference-typoscript/main/en-us/Setup/Config/Index.html#absrefprefix) at least should be set to a static path value, instead of using `auto` - e.g. `config.absRefPrefix=/` - this **does not fix all aspects of the vulnerability**, and is just considered to be an intermediate mitigation to the most prominent manifestation.

### Credits

Thanks to Lars Michalowski, Kevin Andrews & Robin Martin who reported this issue, and to TYPO3 core team members Benjamin Franzke & Helmut Hummel who fixed the issue.

### References

* [TYPO3-CORE-SA-2023-001](https://typo3.org/security/advisory/typo3-core-sa-2023-001)
* [TYPO3-CORE-PSA-2023-001](https://typo3.org/security/advisory/typo3-psa-2023-001) *pre-announcement*

### Severity

High

8.8

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
Required

Scope
Changed

Confidentiality
Low

Integrity
High

Availability
Low

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:H/A:L

### CVE ID

CVE-2023-24814

### Weaknesses

[CWE-79](/advisories?query=cwe%3A79)

### Credits

* [![@bnf](https://avatars.githubusercontent.com/u/473155?s=40&v=4)](/bnf)
  [bnf](/bnf)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


