=== Content from github.com_c91abf3e_20250114_232658.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheonedev%2Fonedev%2Fsecurity%2Fadvisories%2FGHSA-jf5c-9r77-3j5j)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheonedev%2Fonedev%2Fsecurity%2Fadvisories%2FGHSA-jf5c-9r77-3j5j)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=theonedev%2Fonedev)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[theonedev](/theonedev)
/
**[onedev](/theonedev/onedev)**
Public

* [Notifications](/login?return_to=%2Ftheonedev%2Fonedev) You must be signed in to change notification settings
* [Fork
  873](/login?return_to=%2Ftheonedev%2Fonedev)
* [Star
   13.6k](/login?return_to=%2Ftheonedev%2Fonedev)

* [Code](/theonedev/onedev)
* [Pull requests
  0](/theonedev/onedev/pulls)
* [Actions](/theonedev/onedev/actions)
* [Wiki](/theonedev/onedev/wiki)
* [Security](/theonedev/onedev/security)
* [Insights](/theonedev/onedev/pulse)

Additional navigation options

* [Code](/theonedev/onedev)
* [Pull requests](/theonedev/onedev/pulls)
* [Actions](/theonedev/onedev/actions)
* [Wiki](/theonedev/onedev/wiki)
* [Security](/theonedev/onedev/security)
* [Insights](/theonedev/onedev/pulse)

# Random algorithm used to generate access token and password reset is not strong enough

High

[robinshine](/robinshine)
published
GHSA-jf5c-9r77-3j5j
Feb 7, 2023

## Package

Independent application

## Affected versions

< 7.9.12

## Patched versions

7.9.12

## Description

### Impact

The random algorithm used to generate access token and password reset is not strong enough. Existing normal users (or everyone if it allows self-registration) may exploit this to get administrator permission.

### Patches

This issue is solved in 7.9.12

### Credits

This issue is found by [@josephsurin](https://github.com/josephsurin) (elttam) and [@emilytrau](https://github.com/emilytrau). Thank you!

### Severity

High

### CVE ID

CVE-2023-24828

### Weaknesses

No CWEs

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_0cd522e2_20250114_232656.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheonedev%2Fonedev%2Fcommit%2Fd67dd9686897fe5e4ab881d749464aa7c06a68e5)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheonedev%2Fonedev%2Fcommit%2Fd67dd9686897fe5e4ab881d749464aa7c06a68e5)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=theonedev%2Fonedev)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[theonedev](/theonedev)
/
**[onedev](/theonedev/onedev)**
Public

* [Notifications](/login?return_to=%2Ftheonedev%2Fonedev) You must be signed in to change notification settings
* [Fork
  873](/login?return_to=%2Ftheonedev%2Fonedev)
* [Star
   13.6k](/login?return_to=%2Ftheonedev%2Fonedev)

* [Code](/theonedev/onedev)
* [Pull requests
  0](/theonedev/onedev/pulls)
* [Actions](/theonedev/onedev/actions)
* [Wiki](/theonedev/onedev/wiki)
* [Security](/theonedev/onedev/security)
* [Insights](/theonedev/onedev/pulse)

Additional navigation options

* [Code](/theonedev/onedev)
* [Pull requests](/theonedev/onedev/pulls)
* [Actions](/theonedev/onedev/actions)
* [Wiki](/theonedev/onedev/wiki)
* [Security](/theonedev/onedev/security)
* [Insights](/theonedev/onedev/pulse)

## Commit

[Permalink](/theonedev/onedev/commit/d67dd9686897fe5e4ab881d749464aa7c06a68e5)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix issue #1179 - OneDev should use crypto strong random string for a…

[Browse files](/theonedev/onedev/tree/d67dd9686897fe5e4ab881d749464aa7c06a68e5)
Browse the repository at this point in the history

```
…ccess token and password reset
```

* Loading branch information

[![@robinshine](https://avatars.githubusercontent.com/u/3423576?s=40&v=4)](/robinshine)

[robinshine](/theonedev/onedev/commits?author=robinshine "View all commits by robinshine")
committed
Feb 7, 2023

1 parent
[92c3a12](/theonedev/onedev/commit/92c3a12e11d895a2911473cc2c892ba0585856bb)

commit d67dd96

 Show file tree

 Hide file tree

Showing
**11 changed files**
with
**118 additions**
and
**133 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* server-core/src/main/java/io/onedev/server

  + git/hook

    - server-core/src/main/java/io/onedev/server/git/hook/HookUtils.java
      [HookUtils.java](#diff-dd0fb55c9bb31aabffd484a7abbd2f20be47fb03402471948a5c484408f8d415)
  + migration

    - server-core/src/main/java/io/onedev/server/migration/DataMigrator.java
      [DataMigrator.java](#diff-04bb335c671a359a07f55135b938ac452c3ca83646701c64854daf99420e3a02)
  + model

    - server-core/src/main/java/io/onedev/server/model/EmailAddress.java
      [EmailAddress.java](#diff-1c4076d06cc9bbcbaf0451b732aa1812f844a7ba76479ba7a50d3406bd20f7b5)
    - server-core/src/main/java/io/onedev/server/model/User.java
      [User.java](#diff-d42c2ea3dca45c85f0d5296b3a167040d0d66617b41e33dd0544b5e68dd286a7)
    - support

      * server-core/src/main/java/io/onedev/server/model/support/WebHook.java
        [WebHook.java](#diff-b5b42e41aa263e008b5da8262d1beeca6331b0343f93b324bfb7d0ddd1895197)
  + util

    - server-core/src/main/java/io/onedev/server/util/CryptoUtils.java
      [CryptoUtils.java](#diff-fb28fcb2fcee996ea898bfc3702224e56cdacc9c927910760bdb8e6dbca9cf67)
  + web

    - component/user

      * accesstoken

        + server-core/src/main/java/io/onedev/server/web/component/user/accesstoken/AccessTokenPanel.java
          [AccessTokenPanel.java](#diff-b2a4439def8e22abcae771180ea31de78cea8c60a21a714a288270a6e6d0250f)
      * twofactorauthentication

        + server-core/src/main/java/io/onedev/server/web/component/user/twofactorauthentication/TwoFactorAuthenticationSetupPanel.html
          [TwoFactorAuthenticationSetupPanel.html](#diff-7ac833a61622e924cac9fbeb365f24c30ed1f4511f3c35dd113864b38ed3d9ce)
        + server-core/src/main/java/io/onedev/server/web/component/user/twofactorauthentication/TwoFactorAuthenticationSetupPanel.java
          [TwoFactorAuthenticationSetupPanel.java](#diff-6751463d863b6beacfc01f77116375e4ea39a5c74c38196097682eca9433e254)
    - page/simple/security

      * server-core/src/main/java/io/onedev/server/web/page/simple/security/PasswordResetPage.java
        [PasswordResetPage.java](#diff-2cc44c5ee5f9d93ebcccc8559eae07be2b5d28db2fe113f7b67a5c77b52ee223)
* server-product/system/incompatibilities

  + server-product/system/incompatibilities/incompatibilities.md
    [incompatibilities.md](#diff-ef46fa93b03c7ae33901d09bea008b3e7f735b9627aca04ba21b0b59bb593b2f)

## There are no files selected for viewing

22 changes: 10 additions & 12 deletions

22
[server-core/src/main/java/io/onedev/server/git/hook/HookUtils.java](#diff-dd0fb55c9bb31aabffd484a7abbd2f20be47fb03402471948a5c484408f8d415 "server-core/src/main/java/io/onedev/server/git/hook/HookUtils.java")

Show comments

[View file](/theonedev/onedev/blob/d67dd9686897fe5e4ab881d749464aa7c06a68e5/server-core/src/main/java/io/onedev/server/git/hook/HookUtils.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,26 +1,24 @@ |
|  |  | package io.onedev.server.git.hook; |
|  |  |  |
|  |  | import java.io.File; |
|  |  | import java.io.IOException; |
|  |  | import java.io.InputStream; |
|  |  | import java.nio.charset.Charset; |
|  |  | import java.util.HashMap; |
|  |  | import java.util.Map; |
|  |  |  |
|  |  | import org.apache.commons.io.IOUtils; |
|  |  | import org.apache.commons.lang3.RandomStringUtils; |
|  |  |  |
|  |  | import com.google.common.base.Preconditions; |
|  |  |  |
|  |  | import io.onedev.commons.utils.FileUtils; |
|  |  | import io.onedev.commons.utils.StringUtils; |
|  |  | import io.onedev.server.OneDev; |
|  |  | import io.onedev.server.ServerConfig; |
|  |  | import io.onedev.server.entitymanager.SettingManager; |
|  |  | import io.onedev.server.util.CryptoUtils; |
|  |  | import org.apache.commons.io.IOUtils; |
|  |  |  |
|  |  | import java.io.File; |
|  |  | import java.io.IOException; |
|  |  | import java.io.InputStream; |
|  |  | import java.nio.charset.Charset; |
|  |  | import java.util.HashMap; |
|  |  | import java.util.Map; |
|  |  |  |
|  |  | public class HookUtils { |
|  |  |  |
|  |  | public static final String HOOK\_TOKEN = RandomStringUtils.randomAlphanumeric(20); |
|  |  | public static final String HOOK\_TOKEN = CryptoUtils.generateSecret(); |
|  |  |  |
|  |  | private static final String gitReceiveHook; |
|  |  |  |
| Expand Down | |  |

19 changes: 16 additions & 3 deletions

19
[server-core/src/main/java/io/onedev/server/migration/DataMigrator.java](#diff-04bb335c671a359a07f55135b938ac452c3ca83646701c64854daf99420e3a02 "server-core/src/main/java/io/onedev/server/migration/DataMigrator.java")

Show comments

[View file](/theonedev/onedev/blob/d67dd9686897fe5e4ab881d749464aa7c06a68e5/server-core/src/main/java/io/onedev/server/migration/DataMigrator.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -10,9 +10,9 @@ |
|  |  | import io.onedev.server.markdown.MarkdownManager; |
|  |  | import io.onedev.server.markdown.MentionParser; |
|  |  | import io.onedev.server.model.\*; |
|  |  | import io.onedev.server.util.CryptoUtils; |
|  |  | import io.onedev.server.util.Pair; |
|  |  | import org.apache.commons.io.IOUtils; |
|  |  | import org.apache.commons.lang3.RandomStringUtils; |
|  |  | import org.apache.commons.lang3.tuple.Triple; |
|  |  | import org.dom4j.Element; |
|  |  | import org.dom4j.Node; |
| Expand Down  Expand Up | | @@ -2146,7 +2146,7 @@ private void migrate42(File dataDir, Stack<Integer> versions) { |
|  |  | } else if (file.getName().startsWith("Users.xml")) { |
|  |  | VersionedXmlDoc dom = VersionedXmlDoc.fromFile(file); |
|  |  | for (Element element: dom.getRootElement().elements()) { |
|  |  | element.addElement("accessToken").setText(RandomStringUtils.randomAlphanumeric(40)); |
|  |  | element.addElement("accessToken").setText(CryptoUtils.generateSecret()); |
|  |  | element.addElement("ssoInfo").addElement("subject").setText(UUID.randomUUID().toString()); |
|  |  | } |
|  |  | dom.writeToFile(file, false); |
| Expand Down  Expand Up | | @@ -2692,7 +2692,7 @@ private void migrate61(File dataDir, Stack<Integer> versions) { |
|  |  | element.addElement("ssoInfo").addElement("subject").setText(UUID.randomUUID().toString()); |
|  |  | element.addElement("email").setText("unknown email"); |
|  |  | element.addElement("alternateEmails"); |
|  |  | element.addElement("accessToken").setText(RandomStringUtils.randomAlphanumeric(User.ACCESS\_TOKEN\_LEN)); |
|  |  | element.addElement("accessToken").setText(CryptoUtils.generateSecret()); |
|  |  | element.addElement("userProjectQueries"); |
|  |  | element.addElement("userIssueQueries"); |
|  |  | element.addElement("userIssueQueryWatches"); |
| Expand Down  Expand Up | | @@ -4831,5 +4831,18 @@ private void migrate109(File dataDir, Stack<Integer> versions) { |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | private void migrate110(File dataDir, Stack<Integer> versions) { |
|  |  | var updateIds = new HashSet<>(); |
|  |  | for (File file: dataDir.listFiles()) { |
|  |  | if (file.getName().startsWith("Users.xml")) { |
|  |  | VersionedXmlDoc dom = VersionedXmlDoc.fromFile(file); |
|  |  | for (Element element: dom.getRootElement().elements()) { |
|  |  | element.element("accessToken").setText(CryptoUtils.generateSecret()); |
|  |  | } |
|  |  | dom.writeToFile(file, false); |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | } |

22 changes: 7 additions & 15 deletions

22
[server-core/src/main/java/io/onedev/server/model/EmailAddress.java](#diff-1c4076d06cc9bbcbaf0451b732aa1812f844a7ba76479ba7a50d3406bd20f7b5 "server-core/src/main/java/io/onedev/server/model/EmailAddress.java")

Show comments

[View file](/theonedev/onedev/blob/d67dd9686897fe5e4ab881d749464aa7c06a68e5/server-core/src/main/java/io/onedev/server/model/EmailAddress.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,24 +1,16 @@ |
|  |  | package io.onedev.server.model; |
|  |  |  |
|  |  | import javax.persistence.Column; |
|  |  | import javax.persistence.Entity; |
|  |  | import javax.persistence.FetchType; |
|  |  | import javax.persistence.Index; |
|  |  | import javax.persistence.JoinColumn; |
|  |  | import javax.persistence.ManyToOne; |
|  |  | import javax.persistence.Table; |
|  |  |  |
|  |  | import org.apache.commons.lang3.RandomStringUtils; |
|  |  | import com.fasterxml.jackson.annotation.JsonIgnore; |
|  |  | import io.onedev.server.util.CryptoUtils; |
|  |  | import io.onedev.server.util.facade.EmailAddressFacade; |
|  |  | import io.onedev.server.web.editable.annotation.Editable; |
|  |  | import org.hibernate.annotations.Cache; |
|  |  | import org.hibernate.annotations.CacheConcurrencyStrategy; |
|  |  |  |
|  |  | import javax.persistence.\*; |
|  |  | import javax.validation.constraints.Email; |
|  |  | import javax.validation.constraints.NotEmpty; |
|  |  |  |
|  |  | import com.fasterxml.jackson.annotation.JsonIgnore; |
|  |  |  |
|  |  | import io.onedev.server.util.facade.EmailAddressFacade; |
|  |  | import io.onedev.server.web.editable.annotation.Editable; |
|  |  |  |
|  |  | @Editable |
|  |  | @Entity |
|  |  | @Table(indexes={@Index(columnList="o\_owner\_id"), @Index(columnList="value")}) |
| Expand All | | @@ -35,7 +27,7 @@ public class EmailAddress extends AbstractEntity { |
|  |  | private String value; |
|  |  |  |
|  |  | @JsonIgnore |
|  |  | private String verificationCode = RandomStringUtils.randomAlphanumeric(16); |
|  |  | private String verificationCode = CryptoUtils.generateSecret(); |
|  |  |  |
|  |  | private boolean primary; |
|  |  |  |
| Expand Down | |  |

54 changes: 17 additions & 37 deletions

54
[server-core/src/main/java/io/onedev/server/model/User.java](#diff-d42c2ea3dca45c85f0d5296b3a167040d0d66617b41e33dd0544b5e68dd286a7 "server-core/src/main/java/io/onedev/server/model/User.java")

Show comments

[View file](/theonedev/onedev/blob/d67dd9686897fe5e4ab881d749464aa7c06a68e5/server-core/src/main/java/io/onedev/server/model/User.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,41 +1,7 @@ |
|  |  | package io.onedev.server.model; |
|  |  |  |
|  |  | import static io.onedev.server.model.User.PROP\_ACCESS\_TOKEN; |
|  |  | import static io.onedev.server.model.User.PROP\_FULL\_NAME; |
|  |  | import static io.onedev.server.model.User.PROP\_NAME; |
|  |  | import static io.onedev.server.model.User.PROP\_SSO\_CONNECTOR; |
|  |  |  |
|  |  | import java.util.ArrayList; |
|  |  | import java.util.Collection; |
|  |  | import java.util.LinkedHashMap; |
|  |  | import java.util.LinkedHashSet; |
|  |  | import java.util.List; |
|  |  | import java.util.Optional; |
|  |  | import java.util.Stack; |
|  |  | import java.util.stream.Collectors; |
|  |  |  |
|  |  | import javax.annotation.Nullable; |
|  |  | import javax.persistence.CascadeType; |
|  |  | import javax.persistence.Column; |
|  |  | import javax.persistence.Entity; |
|  |  | import javax.persistence.Index; |
|  |  | import javax.persistence.Lob; |
|  |  | import javax.persistence.OneToMany; |
|  |  | import javax.persistence.Table; |
|  |  |  |
|  |  | import org.apache.commons.lang3.RandomStringUtils; |
|  |  | import org.apache.shiro.authc.AuthenticationInfo; |
|  |  | import org.apache.shiro.subject.PrincipalCollection; |
|  |  | import org.apache.shiro.subject.SimplePrincipalCollection; |
|  |  | import org.apache.shiro.subject.Subject; |
|  |  | import org.eclipse.jgit.lib.PersonIdent; |
|  |  | import org.hibernate.annotations.Cache; |
|  |  | import org.hibernate.annotations.CacheConcurrencyStrategy; |
|  |  | import javax.validation.constraints.NotEmpty; |
|  |  |  |
|  |  | import com.fasterxml.jackson.annotation.JsonIgnore; |
|  |  | import com.google.common.base.MoreObjects; |
|  |  |  |
|  |  | import edu.emory.mathcs.backport.java.util.Collections; |
|  |  | import io.onedev.commons.utils.ExplicitException; |
|  |  | import io.onedev.server.OneDev; |
| Expand All | | @@ -51,12 +17,28 @@ |
|  |  | import io.onedev.server.model.support.issue.NamedIssueQuery; |
|  |  | import io.onedev.server.model.support.pullrequest.NamedPullRequestQuery; |
|  |  | import io.onedev.server.security.SecurityUtils; |
|  |  | import io.onedev.server.util.CryptoUtils; |
|  |  | import io.onedev.server.util.facade.UserFacade; |
|  |  | import io.onedev.server.util.validation.annotation.UserName; |
|  |  | import io.onedev.server.util.watch.QuerySubscriptionSupport; |
|  |  | import io.onedev.server.util.watch.QueryWatchSupport; |
|  |  | import io.onedev.server.web.editable.annotation.Editable; |
|  |  | import io.onedev.server.web.editable.annotation.Password; |
|  |  | import org.apache.shiro.authc.AuthenticationInfo; |
|  |  | import org.apache.shiro.subject.PrincipalCollection; |
|  |  | import org.apache.shiro.subject.SimplePrincipalCollection; |
|  |  | import org.apache.shiro.subject.Subject; |
|  |  | import org.eclipse.jgit.lib.PersonIdent; |
|  |  | import org.hibernate.annotations.Cache; |
|  |  | import org.hibernate.annotations.CacheConcurrencyStrategy; |
|  |  |  |
|  |  | import javax.annotation.Nullable; |
|  |  | import javax.persistence.\*; |
|  |  | import javax.validation.constraints.NotEmpty; |
|  |  | import java.util.\*; |
|  |  | import java.util.stream.Collectors; |
|  |  |  |
|  |  | import static io.onedev.server.model.User.\*; |
|  |  |  |
|  |  | @Entity |
|  |  | @Table( |
| Expand All | | @@ -68,8 +50,6 @@ public class User extends AbstractEntity implements AuthenticationInfo { |
|  |  |  |
|  |  | private static final long serialVersionUID = 1L; |
|  |  |  |
|  |  | public static final int ACCESS\_TOKEN\_LEN = 40; |
|  |  |  |
|  |  | public static final Long UNKNOWN\_ID = -2L; |
|  |  |  |
|  |  | public static final Long SYSTEM\_ID = -1L; |
| Expand Down  Expand Up | | @@ -117,7 +97,7 @@ protected Stack<User> initialValue() { |
|  |  |  |
|  |  | @Column(unique=true, nullable=false) |
|  |  | @JsonIgnore |
|  |  | private String accessToken = RandomStringUtils.randomAlphanumeric(ACCESS\_TOKEN\_LEN); |
|  |  | private String accessToken = CryptoUtils.generateSecret(); |
|  |  |  |
|  |  | @JsonIgnore |
|  |  | @Lob |
| Expand Down | |  |

18 changes: 8 additions & 10 deletions

18
[server-core/src/main/java/io/onedev/server/model/support/WebHook.java](#diff-b5b42e41aa263e008b5da8262d1beeca6331b0343f93b324bfb7d0ddd1895197 "server-core/src/main/java/io/onedev/server/model/support/WebHook.java")

Show comments

[View file](/theonedev/onedev/blob/d67dd9686897fe5e4ab881d749464aa7c06a68e5/server-core/src/main/java/io/onedev/server/model/support/WebHook.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,21 +1,19 @@ |
|  |  | package io.onedev.server.model.support; |
|  |  |  |
|  |  | import java.io.Serializable; |
|  |  | import java.util.ArrayList; |
|  |  | import java.util.List; |
|  |  |  |
|  |  | import javax.validation.constraints.NotEmpty; |
|  |  | import javax.validation.constraints.Size; |
|  |  |  |
|  |  | import org.apache.commons.lang3.RandomStringUtils; |
|  |  |  |
|  |  | import io.onedev.server.event.project.RefUpdated; |
|  |  | import io.onedev.server.event.project.build.BuildEvent; |
|  |  | import io.onedev.server.event.project.codecomment.CodeCommentEvent; |
|  |  | import io.onedev.server.event.project.issue.IssueEvent; |
|  |  | import io.onedev.server.event.project.pullrequest.PullRequestEvent; |
|  |  | import io.onedev.server.util.CryptoUtils; |
|  |  | import io.onedev.server.web.editable.annotation.Editable; |
|  |  |  |
|  |  | import javax.validation.constraints.NotEmpty; |
|  |  | import javax.validation.constraints.Size; |
|  |  | import java.io.Serializable; |
|  |  | import java.util.ArrayList; |
|  |  | import java.util.List; |
|  |  |  |
|  |  | @Editable |
|  |  | public class WebHook implements Serializable { |
|  |  |  |
| Expand Down  Expand Up | | @@ -70,7 +68,7 @@ public boolean includes(Object event) { |
|  |  |  |
|  |  | private List<EventType> eventTypes = new ArrayList<>(); |
|  |  |  |
|  |  | private String secret = RandomStringUtils.randomAlphanumeric(20); |
|  |  | private String secret = CryptoUtils.generateSecret(); |
|  |  |  |
|  |  | @Editable(order=100, description="The URL of the server endpoint that will receive the webhook POST requests") |
|  |  | @NotEmpty |
| Expand Down | |  |

31 changes: 21 additions & 10 deletions

31
[server-core/src/main/java/io/onedev/server/util/CryptoUtils.java](#diff-fb28fcb2fcee996ea898bfc3702224e56cdacc9c927910760bdb8e6dbca9cf67 "server-core/src/main/java/io/onedev/server/util/CryptoUtils.java")

Show comments

[View file](/theonedev/onedev/blob/d67dd9686897fe5e4ab881d749464aa7c06a68e5/server-core/src/main/java/io/onedev/server/util/CryptoUtils.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,22 +1,24 @@ |
|  |  | package io.onedev.server.util; |
|  |  |  |
|  |  | import java.security.NoSuchAlgorithmException; |
|  |  | import java.security.spec.InvalidKeySpecException; |
|  |  | import java.security.spec.KeySpec; |
|  |  |  |
|  |  | import javax.crypto.SecretKeyFactory; |
|  |  | import javax.crypto.spec.PBEKeySpec; |
|  |  |  |
|  |  | import io.onedev.server.OneDev; |
|  |  | import io.onedev.server.entitymanager.SettingManager; |
|  |  | import org.apache.commons.codec.binary.Base64; |
|  |  | import org.apache.commons.lang3.RandomStringUtils; |
|  |  | import org.apache.shiro.crypto.AesCipherService; |
|  |  | import org.apache.sshd.common.digest.BaseDigest; |
|  |  | import org.apache.sshd.common.digest.Digest; |
|  |  |  |
|  |  | import io.onedev.server.OneDev; |
|  |  | import io.onedev.server.entitymanager.SettingManager; |
|  |  | import javax.crypto.SecretKeyFactory; |
|  |  | import javax.crypto.spec.PBEKeySpec; |
|  |  | import java.security.NoSuchAlgorithmException; |
|  |  | import java.security.SecureRandom; |
|  |  | import java.security.spec.InvalidKeySpecException; |
|  |  | import java.security.spec.KeySpec; |
|  |  |  |
|  |  | public class CryptoUtils { |
|  |  |  |
|  |  |  |
|  |  | private static final int DEFAULT\_SECRET\_LEN = 40; |
|  |  |  |
|  |  | public static final Digest DIGEST\_FORMAT = new BaseDigest("MD5", 512); |
|  |  |  |
|  |  | private static volatile KeyPair keyPair; |
| Expand All | | @@ -40,7 +42,16 @@ public static byte[] getCipherKey() { |
|  |  | } |
|  |  | return keyPair.getCipherKey(); |
|  |  | } |
|  |  |  |
|  |  | public static String generateSecret(int count) { |
|  |  | return RandomStringUtils.random(count, 0, 0, true, true, null, |
|  |  | new SecureRandom()); |
|  |  | } |
|  |  |  |
|  |  | public static String generateSecret() { |
|  |  | return generateSecret(DEFAULT\_SECRET\_LEN); |
|  |  | } |
|  |  |  |
|  |  | public static byte[] encrypt(byte[] data) { |
|  |  | return cipherService.encrypt(data, getCipherKey()).getBytes(); |
|  |  | } |
| Expand Down | |  |

15 changes: 7 additions & 8 deletions

15
[...-core/src/main/java/io/onedev/server/web/component/user/accesstoken/AccessTokenPanel.java](#diff-b2a4439def8e22abcae771180ea31de78cea8c60a21a714a288270a6e6d0250f "server-core/src/main/java/io/onedev/server/web/component/user/accesstoken/AccessTokenPanel.java")

Show comments

[View file](/theonedev/onedev/blob/d67dd9686897fe5e4ab881d749464aa7c06a68e5/server-core/src/main/java/io/onedev/server/web/component/user/accesstoken/AccessTokenPanel.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,19 +1,18 @@ |
|  |  | package io.onedev.server.web.component.user.accesstoken; |
|  |  |  |
|  |  | import org.apache.commons.lang3.RandomStringUtils; |
|  |  | import io.onedev.server.OneDev; |
|  |  | import io.onedev.server.entitymanager.UserManager; |
|  |  | import io.onedev.server.model.User; |
|  |  | import io.onedev.server.util.CryptoUtils; |
|  |  | import io.onedev.server.web.component.link.copytoclipboard.CopyToClipboardLink; |
|  |  | import io.onedev.server.web.util.ConfirmClickModifier; |
|  |  | import org.apache.wicket.Session; |
|  |  | import org.apache.wicket.markup.html.form.TextField; |
|  |  | import org.apache.wicket.markup.html.link.Link; |
|  |  | import org.apache.wicket.markup.html.panel.Panel; |
|  |  | import org.apache.wicket.model.AbstractReadOnlyModel; |
|  |  | import org.apache.wicket.model.IModel; |
|  |  |  |
|  |  | import io.onedev.server.OneDev; |
|  |  | import io.onedev.server.entitymanager.UserManager; |
|  |  | import io.onedev.server.model.User; |
|  |  | import io.onedev.server.web.component.link.copytoclipboard.CopyToClipboardLink; |
|  |  | import io.onedev.server.web.util.ConfirmClickModifier; |
|  |  |  |
|  |  | @SuppressWarnings("serial") |
|  |  | public abstract class AccessTokenPanel extends Panel { |
|  |  |  |
| Expand Down  Expand Up | | @@ -50,7 +49,7 @@ protected String[] getInputTypes() { |
|  |  |  |
|  |  | @Override |
|  |  | public void onClick() { |
|  |  | getUser().setAccessToken(RandomStringUtils.randomAlphanumeric(User.ACCESS\_TOKEN\_LEN)); |
|  |  | getUser().setAccessToken(CryptoUtils.generateSecret()); |
|  |  | OneDev.getInstance(UserManager.class).save(getUser()); |
|  |  | Session.get().success("Access token regenerated"); |
|  |  | setResponsePage(getPage()); |
| Expand Down | |  |

5 changes: 1 addition & 4 deletions

5
[.../server/web/component/user/twofactorauthentication/TwoFactorAuthenticationSetupPanel.html](#diff-7ac833a61622e924cac9fbeb365f24c30ed1f4511f3c35dd113864b38ed3d9ce "server-core/src/main/java/io/onedev/server/web/component/user/twofactorauthentication/TwoFactorAuthenticationSetupPanel.html")

Show comments

[View file](/theonedev/onedev/blob/d67dd9686897fe5e4ab881d749464aa7c06a68e5/server-core/src/main/java/io/onedev/server/web/component/user/twofactorauthentication/TwoFactorAuthenticationSetupPanel.html)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -46,10 +46,7 @@ <h5 id="modal-title" class="modal-title">Set Up Two-factor Authentication</h5> |
|  |  | can not access the authentication application. They will <b>NOT</b> be displayed again |
|  |  | </div> |
|  |  | <div> |
|  |  | <div wicket:id="recoveryCodes" class="d-flex justify-content-between text-monospace font-size-lg font-weight-bold"> |
|  |  | <div wicket:id="left"></div> |
|  |  | <div wicket:id="right"></div> |
|  |  | </div> |
|  |  | <div wicket:id="recoveryCodes" class="d-flex justify-content-center text-monospace font-size-sm font-weight-bold"></div> |
|  |  | </div> |
|  |  | </div> |
|  |  | <div class="modal-footer d-flex justify-content-center"> |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `d67dd96`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheonedev%2Fonedev%2Fcommit%2Fd67dd9686897fe5e4ab881d749464aa7c06a68e5) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


