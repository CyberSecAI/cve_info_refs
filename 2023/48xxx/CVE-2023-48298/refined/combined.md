=== Content from github.com_acc5d4f8_20250114_202802.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FClickHouse%2FClickHouse%2Fpull%2F56795)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FClickHouse%2FClickHouse%2Fpull%2F56795)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=ClickHouse%2FClickHouse)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ClickHouse](/ClickHouse)
/
**[ClickHouse](/ClickHouse/ClickHouse)**
Public

* [Notifications](/login?return_to=%2FClickHouse%2FClickHouse) You must be signed in to change notification settings
* [Fork
  7k](/login?return_to=%2FClickHouse%2FClickHouse)
* [Star
   38.4k](/login?return_to=%2FClickHouse%2FClickHouse)

* [Code](/ClickHouse/ClickHouse)
* [Issues
  3.7k](/ClickHouse/ClickHouse/issues)
* [Pull requests
  406](/ClickHouse/ClickHouse/pulls)
* [Discussions](/ClickHouse/ClickHouse/discussions)
* [Actions](/ClickHouse/ClickHouse/actions)
* [Projects
  0](/ClickHouse/ClickHouse/projects)
* [Wiki](/ClickHouse/ClickHouse/wiki)
* [Security](/ClickHouse/ClickHouse/security)
* [Insights](/ClickHouse/ClickHouse/pulse)

Additional navigation options

* [Code](/ClickHouse/ClickHouse)
* [Issues](/ClickHouse/ClickHouse/issues)
* [Pull requests](/ClickHouse/ClickHouse/pulls)
* [Discussions](/ClickHouse/ClickHouse/discussions)
* [Actions](/ClickHouse/ClickHouse/actions)
* [Projects](/ClickHouse/ClickHouse/projects)
* [Wiki](/ClickHouse/ClickHouse/wiki)
* [Security](/ClickHouse/ClickHouse/security)
* [Insights](/ClickHouse/ClickHouse/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FClickHouse%2FClickHouse%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FClickHouse%2FClickHouse%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Fix crash in FPC codec #56795

 Merged

[alexey-milovidov](/alexey-milovidov)
merged 2 commits into
[master](/ClickHouse/ClickHouse/tree/master "ClickHouse/ClickHouse:master")
from
[fix-fpc](/ClickHouse/ClickHouse/tree/fix-fpc "ClickHouse/ClickHouse:fix-fpc")

Nov 16, 2023

 Merged

# [Fix crash in FPC codec](#top) #56795

[alexey-milovidov](/alexey-milovidov)
merged 2 commits into
[master](/ClickHouse/ClickHouse/tree/master "ClickHouse/ClickHouse:master")
from
[fix-fpc](/ClickHouse/ClickHouse/tree/fix-fpc "ClickHouse/ClickHouse:fix-fpc")

Nov 16, 2023

[Conversation
3](/ClickHouse/ClickHouse/pull/56795)
[Commits
2](/ClickHouse/ClickHouse/pull/56795/commits)
[Checks
215](/ClickHouse/ClickHouse/pull/56795/checks)
[Files changed](/ClickHouse/ClickHouse/pull/56795/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![alexey-milovidov](https://avatars.githubusercontent.com/u/18581488?s=60&v=4)](/alexey-milovidov)

Copy link

Member

### @alexey-milovidov **[alexey-milovidov](/alexey-milovidov)** commented [Nov 15, 2023](#issue-1994947597) • edited Loading

### Changelog category (leave one):

* Bug Fix (user-visible misbehavior in an official stable release)

### Changelog entry (a user-readable short description of the changes that goes to CHANGELOG.md):

The server crashed when decompressing malformed data using the `FPC` codec. This issue was found with [ClickHouse Bug Bounty Program](https://github.com/ClickHouse/ClickHouse/issues/38986) by <https://twitter.com/malacupa>

Sorry, something went wrong.

All reactions

[![@alexey-milovidov](https://avatars.githubusercontent.com/u/18581488?s=40&v=4)](/alexey-milovidov)

`[Fix crash in FPC codec](/ClickHouse/ClickHouse/pull/56795/commits/a089e6181024a8f48e2e415de8033cca2fa98f50 "Fix crash in FPC codec")`

`[a089e61](/ClickHouse/ClickHouse/pull/56795/commits/a089e6181024a8f48e2e415de8033cca2fa98f50)`

[![@alexey-milovidov](https://avatars.githubusercontent.com/u/18581488?s=40&v=4)](/alexey-milovidov)
[alexey-milovidov](/alexey-milovidov)
added
[pr-must-backport](/ClickHouse/ClickHouse/labels/pr-must-backport)
Pull request should be backported intentionally. Use this label with great care!
[pr-must-backport-cloud](/ClickHouse/ClickHouse/labels/pr-must-backport-cloud)
labels
[Nov 15, 2023](#event-10968506033)

[![@robot-clickhouse-ci-2](https://avatars.githubusercontent.com/u/118811860?s=40&v=4)](/robot-clickhouse-ci-2)
[robot-clickhouse-ci-2](/robot-clickhouse-ci-2)
added
the
[pr-bugfix](/ClickHouse/ClickHouse/labels/pr-bugfix)
Pull request with bugfix, not backported by default
label
[Nov 15, 2023](#event-10968526860)

[![@robot-clickhouse-ci-2](https://avatars.githubusercontent.com/u/118811860?s=80&v=4)](/robot-clickhouse-ci-2)

Copy link

Contributor

### **[robot-clickhouse-ci-2](/robot-clickhouse-ci-2)** commented [Nov 15, 2023](#issuecomment-1812696383) • edited by robot-ch-test-poll3 Loading

|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| *This is an automated comment for commit [fc6a25f](https://github.com/ClickHouse/ClickHouse/commit/fc6a25fad562ccfcec76e83aa040b3d3ba2b9039) with description of existing statuses. It's updated for the latest CI running*  [❌ Click here](https://s3.amazonaws.com/clickhouse-test-reports/56795/fc6a25fad562ccfcec76e83aa040b3d3ba2b9039/ci_running.html) to open a full report in a separate page Successful checks  | Check name | Description | Status | | --- | --- | --- | | AST fuzzer | Runs randomly generated queries to catch program errors. The build type is optionally given in parenthesis. If it fails, ask a maintainer for help | [✅ success](https://s3.amazonaws.com/clickhouse-test-reports/56795/fc6a25fad562ccfcec76e83aa040b3d3ba2b9039/fuzzer_astfuzzerasan/report.html) | | Bugfix validate check | Checks that either a new test (functional or integration) or there some changed tests that fail with the binary built on master branch | [✅ success](https://s3.amazonaws.com/clickhouse-test-reports/56795/fc6a25fad562ccfcec76e83aa040b3d3ba2b9039/bugfix_validate_check.html) | | ClickHouse build check | Builds ClickHouse in various configurations for use in further steps. You have to fix the builds that fail. Build logs often has enough information to fix the error, but you might have to reproduce the failure locally. The **cmake** options can be found in the build log, grepping for **cmake**. Use these options and follow the [general build process](https://clickhouse.com/docs/en/development/build) | [✅ success](https://s3.amazonaws.com/clickhouse-test-reports/56795/fc6a25fad562ccfcec76e83aa040b3d3ba2b9039/clickhouse_build_check/report.html) | | Compatibility check | Checks that **clickhouse** binary runs on distributions with old libc versions. If it fails, ask a maintainer for help | [✅ success](https://s3.amazonaws.com/clickhouse-test-reports/56795/fc6a25fad562ccfcec76e83aa040b3d3ba2b9039/compatibility_check__aarch64_.html) | | Docker image for servers | The check to build and optionally push the mentioned image to docker hub | [✅ success](https://s3.amazonaws.com/clickhouse-test-reports/56795/fc6a25fad562ccfcec76e83aa040b3d3ba2b9039/docker_image_clickhouse_clickhouse-keeper_building_check.html) | | Fast test | Normally this is the first check that is ran for a PR. It builds ClickHouse and runs most of [stateless functional tests](https://clickhouse.com/docs/en/development/tests#functional-tests), omitting some. If it fails, further checks are not started until it is fixed. Look at the report to see which tests fail, then reproduce the failure locally as described [here](https://clickhouse.com/docs/en/development/tests#functional-test-locally) | [✅ success](https://s3.amazonaws.com/clickhouse-test-reports/56795/fc6a25fad562ccfcec76e83aa040b3d3ba2b9039/fast_test.html) | | Flaky tests | Checks if new added or modified tests are flaky by running them repeatedly, in parallel, with more randomization. Functional tests are run 100 times with address sanitizer, and additional randomization of thread scheduling. Integrational tests are run up to 10 times. If at least once a new test has failed, or was too long, this check will be red. We don't allow flaky tests, read [the doc](https://clickhouse.com/blog/decorating-a-christmas-tree-with-the-help-of-flaky-tests/) | [✅ success](https://s3.amazonaws.com/clickhouse-test-reports/56795/fc6a25fad562ccfcec76e83aa040b3d3ba2b9039/integration_tests_flaky_check__asan_.html) | | Install packages | Checks that the built packages are installable in a clear environment | [✅ success](https://s3.amazonaws.com/clickhouse-test-reports/56795/fc6a25fad562ccfcec76e83aa040b3d3ba2b9039/install_packages__amd64_.html) | | Push to Dockerhub | The check for building and pushing the CI related docker images to docker hub | [✅ success](https://s3.amazonaws.com/clickhouse-test-reports/56795/fc6a25fad562ccfcec76e83aa040b3d3ba2b9039/push_multi-arch_images_to_dockerhub.html) | | SQLTest | There's no description for the check yet, please add it to tests/ci/ci\_config.py:CHECK\_DESCRIPTIONS | [✅ success](https://s3.amazonaws.com/clickhouse-test-reports/56795/fc6a25fad562ccfcec76e83aa040b3d3ba2b9039/sqltest_sqltest/report.html) | | SQLancer | Fuzzing tests that detect logical bugs with [SQLancer](https://github.com/sqlancer/sqlancer) tool | [✅ success](https://s3.amazonaws.com/clickhouse-test-reports/56795/fc6a25fad562ccfcec76e83aa040b3d3ba2b9039/sqlancer__debug_.html) | | Sqllogic | Run clickhouse on the [sqllogic](https://www.sqlite.org/sqllogictest) test set against sqlite and checks that all statements are passed | [✅ success](https://s3.amazonaws.com/clickhouse-test-reports/56795/fc6a25fad562ccfcec76e83aa040b3d3ba2b9039/sqllogic_test__release_.html) | | Stateful tests | Runs stateful functional tests for ClickHouse binaries built in various configurations -- release, debug, with sanitizers, etc | [✅ success](https://s3.amazonaws.com/clickhouse-test-reports/56795/fc6a25fad562ccfcec76e83aa040b3d3ba2b9039/stateful_tests__aarch64_.html) | | Stress test | Runs stateless functional tests concurrently from several clients to detect concurrency-related errors | [✅ success](https://s3.amazonaws.com/clickhouse-test-reports/56795/fc6a25fad562ccfcec76e83aa040b3d3ba2b9039/stress_test__asan_.html) | | Style Check | Runs a set of checks to keep the code style clean. If some of tests failed, see the related log from the report | [✅ success](https://s3.amazonaws.com/clickhouse-test-reports/56795/fc6a25fad562ccfcec76e83aa040b3d3ba2b9039/style_check.html) | | Unit tests | Runs the unit tests for different release types | [✅ success](https://s3.amazonaws.com/clickhouse-test-reports/56795/fc6a25fad562ccfcec76e83aa040b3d3ba2b9039/unit_tests__asan_.html) | | Upgrade check | Runs stress tests on server version from last release and then tries to upgrade it to the version from the PR. It checks if the new server can successfully startup without any errors, crashes or sanitizer asserts | [✅ success](https://s3.amazonaws.com/clickhouse-test-reports/56795/fc6a25fad562ccfcec76e83aa040b3d3ba2b9039/upgrade_check__asan_.html) |    | Check name | Description | Status | | --- | --- | --- | | CI running | A meta-check that indicates the running CI. Normally, it's in **success** or **pending** state. The failed status indicates some problems with the PR | [⏳ pending](https://s3.amazonaws.com/clickhouse-test-reports/56795/fc6a25fad562ccfcec76e83aa040b3d3ba2b9039/ci_running.html) | | Integration tests | The integration tests report. In parenthesis the package type is given, and in square brackets are the optional part/total tests | [❌ failure](https://s3.amazonaws.com/clickhouse-test-reports/56795/fc6a25fad562ccfcec76e83aa040b3d3ba2b9039/integration_tests__release__%5B4_4%5D.html) | | Mergeable Check | Checks if all other necessary checks are successful | [❌ failure](https://github.com/ClickHouse/ClickHouse/actions/runs/6881661943) | | Performance Comparison | Measure changes in query performance. The performance test report is described in detail [here](https://github.com/ClickHouse/ClickHouse/tree/master/docker/test/performance-comparison#how-to-read-the-report). In square brackets are the optional part/total tests | [❌ failure](https://s3.amazonaws.com/clickhouse-test-reports/56795/fc6a25fad562ccfcec76e83aa040b3d3ba2b9039/performance_comparison_%5B3_4%5D/output.7z) | | Stateless tests | Runs stateless functional tests for ClickHouse binaries built in various configurations -- release, debug, with sanitizers, etc | [❌ failure](https://s3.amazonaws.com/clickhouse-test-reports/56795/fc6a25fad562ccfcec76e83aa040b3d3ba2b9039/stateless_tests__asan__%5B3_4%5D.html) | |

All reactions

Sorry, something went wrong.

[![@vdimir](https://avatars.githubusercontent.com/u/7023786?s=40&v=4)](/vdimir)
[vdimir](/vdimir)
self-assigned this
[Nov 15, 2023](#event-10970153099)

[![vdimir](https://avatars.githubusercontent.com/u/7023786?s=60&v=4)](/vdimir)

**[vdimir](/vdimir)**
approved these changes
[Nov 15, 2023](#pullrequestreview-1732541961)

 [View reviewed changes](/ClickHouse/ClickHouse/pull/56795/files/a089e6181024a8f48e2e415de8033cca2fa98f50)

[src/Compression/CompressionCodecFPC.cpp](/ClickHouse/ClickHouse/pull/56795/files/a089e6181024a8f48e2e415de8033cca2fa98f50#diff-efc823ffaac6e53cbb69f641ab627c9f3ed7b3a0c2d933d15cbea20715cc0fde)
Outdated

Show resolved

Hide resolved

[![@alexey-milovidov](https://avatars.githubusercontent.com/u/18581488?s=40&v=4)](/alexey-milovidov) [![@vdimir](https://avatars.githubusercontent.com/u/7023786?s=40&v=4)](/vdimir)

`[Update src/Compression/CompressionCodecFPC.cpp](/ClickHouse/ClickHouse/pull/56795/commits/fc6a25fad562ccfcec76e83aa040b3d3ba2b9039 "Update src/Compression/CompressionCodecFPC.cpp

Co-authored-by: vdimir <vdimir@clickhouse.com>")`
 …

`[fc6a25f](/ClickHouse/ClickHouse/pull/56795/commits/fc6a25fad562ccfcec76e83aa040b3d3ba2b9039)`

```
Co-authored-by: vdimir <vdimir@clickhouse.com>
```

 Hide details
View details

[![@alexey-milovidov](https://avatars.githubusercontent.com/u/18581488?s=40&v=4)](/alexey-milovidov)
[alexey-milovidov](/alexey-milovidov)
merged commit [`9401b90`](/ClickHouse/ClickHouse/commit/9401b904173d7b4a3deb5fce173e87a33ecc64e8)
into
master

[Nov 16, 2023](https://github.com/ClickHouse/ClickHouse/pull/56795#event-10977605056)
217 of 218 checks passed

 [![@alexey-milovidov](https://avatars.githubusercontent.com/u/18581488?s=40&v=4)](/alexey-milovidov)
[alexey-milovidov](/alexey-milovidov)
deleted the
fix-fpc

branch
[November 16, 2023 08:48](#event-10977605281)

[![@robot-ch-test-poll4](https://avatars.githubusercontent.com/u/69306974?s=40&v=4)](/robot-ch-test-poll4)
[robot-ch-test-poll4](/robot-ch-test-poll4)
mentioned this pull request
[Nov 16, 2023](#ref-pullrequest-1996391047)

[Cherry pick #56795 to 23.3: Fix crash in FPC codec
#56836](/ClickHouse/ClickHouse/pull/56836)
 Merged

[![@robot-ch-test-poll4](https://avatars.githubusercontent.com/u/69306974?s=40&v=4)](/robot-ch-test-poll4)
[robot-ch-test-poll4](/robot-ch-test-poll4)
mentioned this pull request
[Nov 16, 2023](#ref-pullrequest-1996391449)

[Backport #56795 to 23.3: Fix crash in FPC codec
#56837](/ClickHouse/ClickHouse/pull/56837)
 Merged

[robot-clickhouse](/robot-clickhouse)
added a commit
that referenced
this pull request
[Nov 16, 2023](#ref-commit-a597b2f)
[![@robot-clickhouse](https://avatars.githubusercontent.com/u/41385210?s=40&v=4)](/robot-clickhouse)

`[Backport](/ClickHouse/ClickHouse/commit/a597b2f2dd0595b1c292fe0d64f02fd8121d68ae "Backport #56795 to 23.3: Fix crash in FPC codec") [#56795](https://github.com/ClickHouse/ClickHouse/pull/56795) [to 23.3: Fix crash in FPC codec](/ClickHouse/ClickHouse/commit/a597b2f2dd0595b1c292fe0d64f02fd8121d68ae "Backport #56795 to 23.3: Fix crash in FPC codec")`

`[a597b2f](/ClickHouse/ClickHouse/commit/a597b2f2dd0595b1c292fe0d64f02fd8121d68ae)`

[![@robot-ch-test-poll4](https://avatars.githubusercontent.com/u/69306974?s=40&v=4)](/robot-ch-test-poll4)
[robot-ch-test-poll4](/robot-ch-test-poll4)
mentioned this pull request
[Nov 16, 2023](#ref-pullrequest-1996391730)

[Cherry pick #56795 to 23.8: Fix crash in FPC codec
#56838](/ClickHouse/ClickHouse/pull/56838)
 Merged

[![@robot-ch-test-poll4](https://avatars.githubusercontent.com/u/69306974?s=40&v=4)](/robot-ch-test-poll4)
[robot-ch-test-poll4](/robot-ch-test-poll4)
mentioned this pull request
[Nov 16, 2023](#ref-pullrequest-1996392183)

[Backport #56795 to 23.8: Fix crash in FPC codec
#56839](/ClickHouse/ClickHouse/pull/56839)
 Merged

[robot-clickhouse](/robot-clickhouse)
added a commit
that referenced
this pull request
[Nov 16, 2023](#ref-commit-27b8a1b)
[![@robot-clickhouse](https://avatars.githubusercontent.com/u/41385210?s=40&v=4)](/robot-clickhouse)

`[Backport](/ClickHouse/ClickHouse/commit/27b8a1b49be378d67d5699f211a9d4c9b88e230b "Backport #56795 to 23.8: Fix crash in FPC codec") [#56795](https://github.com/ClickHouse/ClickHouse/pull/56795) [to 23.8: Fix crash in FPC codec](/ClickHouse/ClickHouse/commit/27b8a1b49be378d67d5699f211a9d4c9b88e230b "Backport #56795 to 23.8: Fix crash in FPC codec")`

`[27b8a1b](/ClickHouse/ClickHouse/commit/27b8a1b49be378d67d5699f211a9d4c9b88e230b)`

[![@robot-ch-test-poll4](https://avatars.githubusercontent.com/u/69306974?s=40&v=4)](/robot-ch-test-poll4)
[robot-ch-test-poll4](/robot-ch-test-poll4)
mentioned this pull request
[Nov 16, 2023](#ref-pullrequest-1996392614)

[Cherry pick #56795 to 23.9: Fix crash in FPC codec
#56840](/ClickHouse/ClickHouse/pull/56840)
 Merged

[![@robot-ch-test-poll4](https://avatars.githubusercontent.com/u/69306974?s=40&v=4)](/robot-ch-test-poll4)
[robot-ch-test-poll4](/robot-ch-test-poll4)
mentioned this pull request
[Nov 16, 2023](#ref-pullrequest-1996393031)

[Backport #56795 to 23.9: Fix crash in FPC codec
#56841](/ClickHouse/ClickHouse/pull/56841)
 Merged

[robot-clickhouse](/robot-clickhouse)
added a commit
that referenced
this pull request
[Nov 16, 2023](#ref-commit-82e72ec)
[![@robot-clickhouse](https://avatars.githubusercontent.com/u/41385210?s=40&v=4)](/robot-clickhouse)

`[Backport](/ClickHouse/ClickHouse/commit/82e72ec420c25664b7670ab8d9013a15741c7b79 "Backport #56795 to 23.9: Fix crash in FPC codec") [#56795](https://github.com/ClickHouse/ClickHouse/pull/56795) [to 23.9: Fix crash in FPC codec](/ClickHouse/ClickHouse/commit/82e72ec420c25664b7670ab8d9013a15741c7b79 "Backport #56795 to 23.9: Fix crash in FPC codec")`

`[82e72ec](/ClickHouse/ClickHouse/commit/82e72ec420c25664b7670ab8d9013a15741c7b79)`

[![@robot-ch-test-poll4](https://avatars.githubusercontent.com/u/69306974?s=40&v=4)](/robot-ch-test-poll4)
[robot-ch-test-poll4](/robot-ch-test-poll4)
mentioned this pull request
[Nov 16, 2023](#ref-pullrequest-1996393291)

[Cherry pick #56795 to 23.10: Fix crash in FPC codec
#56842](/ClickHouse/ClickHouse/pull/56842)
 Merged

[![@robot-ch-test-poll4](https://avatars.githubusercontent.com/u/69306974?s=40&v=4)](/robot-ch-test-poll4)
[robot-ch-test-poll4](/robot-ch-test-poll4)
mentioned this pull request
[Nov 16, 2023](#ref-pullrequest-1996393703)

[Backport #56795 to 23.10: Fix crash in FPC codec
#56843](/ClickHouse/ClickHouse/pull/56843)
 Merged

[robot-clickhouse](/robot-clickhouse)
added a commit
that referenced
this pull request
[Nov 16, 2023](#ref-commit-15bdbfe)
[![@robot-clickhouse](https://avatars.githubusercontent.com/u/41385210?s=40&v=4)](/robot-clickhouse)

`[Backport](/ClickHouse/ClickHouse/commit/15bdbfea0e0a6b5a02c28b59eacc54f2fdaf9c41 "Backport #56795 to 23.10: Fix crash in FPC codec") [#56795](https://github.com/ClickHouse/ClickHouse/pull/56795) [to 23.10: Fix crash in FPC codec](/ClickHouse/ClickHouse/commit/15bdbfea0e0a6b5a02c28b59eacc54f2fdaf9c41 "Backport #56795 to 23.10: Fix crash in FPC codec")`

`[15bdbfe](/ClickHouse/ClickHouse/commit/15bdbfea0e0a6b5a02c28b59eacc54f2fdaf9c41)`

[![@robot-ch-test-poll4](https://avatars.githubusercontent.com/u/69306974?s=40&v=4)](/robot-ch-test-poll4)
[robot-ch-test-poll4](/robot-ch-test-poll4)
added
the
[pr-backports-created](/ClickHouse/ClickHouse/labels/pr-backports-created)
Backport PRs are successfully created, it won't be processed by CI script anymore
label
[Nov 16, 2023](#event-10977804400)

[![@robot-ch-test-poll1](https://avatars.githubusercontent.com/u/47390204?s=40&v=4)](/robot-ch-test-poll1)
[robot-ch-test-poll1](/robot-ch-test-poll1)
added
the
[pr-backports-created-cloud](/ClickHouse/ClickHouse/labels/pr-backports-created-cloud)
label
[Nov 16, 2023](#event-10977814631)

[![antonio2368](https://avatars.githubusercontent.com/u/17751307?s=60&v=4)](/antonio2368)

**[antonio2368](/antonio2368)**
reviewed
[Nov 16, 2023](#pullrequestreview-1734150725)

 [View reviewed changes](/ClickHouse/ClickHouse/pull/56795/files/fc6a25fad562ccfcec76e83aa040b3d3ba2b9039)

[src/Compression/CompressionCodecFPC.cpp](/ClickHouse/ClickHouse/pull/56795/files/fc6a25fad562ccfcec76e83aa040b3d3ba2b9039#diff-efc823ffaac6e53cbb69f641ab627c9f3ed7b3a0c2d933d15cbea20715cc0fde)

|  |  | auto tail\_size1 = VALUE\_SIZE - zero\_byte\_count1; |
| --- | --- | --- |
|  |  | auto tail\_size2 = VALUE\_SIZE - zero\_byte\_count2; |
|  |  | if (zero\_byte\_count1 > VALUE\_SIZE || zero\_byte\_count2 > VALUE\_SIZE) [[unlikely]] |
|  |  | throw Exception(ErrorCodes::CANNOT\_DECOMPRESS, "Invalid compressed data"); |

Copy link

Member

### @antonio2368 **[antonio2368](/antonio2368)** [Nov 16, 2023](#discussion_r1395557156)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

This causes `00002_log_and_exception_messages_formatting` to fail because of `exceptions shorter than 30` check

Sorry, something went wrong.

All reactions

[alexey-milovidov](/alexey-milovidov)
added a commit
that referenced
this pull request
[Nov 16, 2023](#ref-commit-2c8f62c)
[![@alexey-milovidov](https://avatars.githubusercontent.com/u/18581488?s=40&v=4)](/alexey-milovidov)

`[Merge pull request](/ClickHouse/ClickHouse/commit/2c8f62c258a6d72bcf8a20bed60a2b36d696741e "Merge pull request #56839 from ClickHouse/backport/23.8/56795

Backport #56795 to 23.8: Fix crash in FPC codec") [#56839](https://github.com/ClickHouse/ClickHouse/pull/56839) [from ClickHouse/backport/23.8/56795](/ClickHouse/ClickHouse/commit/2c8f62c258a6d72bcf8a20bed60a2b36d696741e "Merge pull request #56839 from ClickHouse/backport/23.8/56795

Backport #56795 to 23.8: Fix crash in FPC codec")`
…

`[2c8f62c](/ClickHouse/ClickHouse/commit/2c8f62c258a6d72bcf8a20bed60a2b36d696741e)`

```
Backport [#56795](https://github.com/ClickHouse/ClickHouse/pull/56795) to 23.8: Fix crash in FPC codec
```

[alexey-milovidov](/alexey-milovidov)
added a commit
that referenced
this pull request
[Nov 16, 2023](#ref-commit-047231d)
[![@alexey-milovidov](https://avatars.githubusercontent.com/u/18581488?s=40&v=4)](/alexey-milovidov)

`[Merge pull request](/ClickHouse/ClickHouse/commit/047231de1e4c8f4f39b39fa4e188bf15710cfe6e "Merge pull request #56841 from ClickHouse/backport/23.9/56795

Backport #56795 to 23.9: Fix crash in FPC codec") [#56841](https://github.com/ClickHouse/ClickHouse/pull/56841) [from ClickHouse/backport/23.9/56795](/ClickHouse/ClickHouse/commit/047231de1e4c8f4f39b39fa4e188bf15710cfe6e "Merge pull request #56841 from ClickHouse/backport/23.9/56795

Backport #56795 to 23.9: Fix crash in FPC codec")`
…

`[047231d](/ClickHouse/ClickHouse/commit/047231de1e4c8f4f39b39fa4e188bf15710cfe6e)`

```
Backport [#56795](https://github.com/ClickHouse/ClickHouse/pull/56795) to 23.9: Fix crash in FPC codec
```

[alexey-milovidov](/alexey-milovidov)
added a commit
that referenced
this pull request
[Nov 16, 2023](#ref-commit-c2775ac)
[![@alexey-milovidov](https://avatars.githubusercontent.com/u/18581488?s=40&v=4)](/alexey-milovidov)

`[Merge pull request](/ClickHouse/ClickHouse/commit/c2775acca556c52352666ef09bc27ad1d88f083b "Merge pull request #56843 from ClickHouse/backport/23.10/56795

Backport #56795 to 23.10: Fix crash in FPC codec") [#56843](https://github.com/ClickHouse/ClickHouse/pull/56843) [from ClickHouse/backport/23.10/56795](/ClickHouse/ClickHouse/commit/c2775acca556c52352666ef09bc27ad1d88f083b "Merge pull request #56843 from ClickHouse/backport/23.10/56795

Backport #56795 to 23.10: Fix crash in FPC codec")`
…

`[c2775ac](/ClickHouse/ClickHouse/commit/c2775acca556c52352666ef09bc27ad1d88f083b)`

```
Backport [#56795](https://github.com/ClickHouse/ClickHouse/pull/56795) to 23.10: Fix crash in FPC codec
```

[alexey-milovidov](/alexey-milovidov)
added a commit
that referenced
this pull request
[Nov 16, 2023](#ref-commit-abc5fe0)
[![@alexey-milovidov](https://avatars.githubusercontent.com/u/18581488?s=40&v=4)](/alexey-milovidov)

`[Merge pull request](/ClickHouse/ClickHouse/commit/abc5fe0e7fa5cde5b3312b335c6e5e9dc3834ef8 "Merge pull request #56837 from ClickHouse/backport/23.3/56795

Backport #56795 to 23.3: Fix crash in FPC codec") [#56837](https://github.com/ClickHouse/ClickHouse/pull/56837) [from ClickHouse/backport/23.3/56795](/ClickHouse/ClickHouse/commit/abc5fe0e7fa5cde5b3312b335c6e5e9dc3834ef8 "Merge pull request #56837 from ClickHouse/backport/23.3/56795

Backport #56795 to 23.3: Fix crash in FPC codec")`
…

`[abc5fe0](/ClickHouse/ClickHouse/commit/abc5fe0e7fa5cde5b3312b335c6e5e9dc3834ef8)`

```
Backport [#56795](https://github.com/ClickHouse/ClickHouse/pull/56795) to 23.3: Fix crash in FPC codec
```

[![@GoVulnBot](https://avatars.githubusercontent.com/u/96493708?s=40&v=4)](/GoVulnBot)
[GoVulnBot](/GoVulnBot)
mentioned this pull request
[Dec 22, 2023](#ref-issue-2053227034)

[x/vulndb: potential Go vuln in github.com/ClickHouse/ClickHouse: CVE-2023-48298
golang/vulndb#2418](/golang/vulndb/issues/2418)

Closed

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FClickHouse%2FClickHouse%2Fpull%2F56795)

Reviewers

[![@antonio2368](https://avatars.githubusercontent.com/u/17751307?s=40&v=4)](/antonio2368) [antonio2368](/antonio2368)

antonio2368 left review comments

[![@vdimir](https://avatars.githubusercontent.com/u/7023786?s=40&v=4)](/vdimir) [vdimir](/vdimir)

vdimir approved these changes

Assignees

[![@vdimir](https://avatars.githubusercontent.com/u/7023786?s=40&v=4)](/vdimir) [vdimir](/vdimir)

Labels

[pr-backports-created](/ClickHouse/ClickHouse/labels/pr-backports-created)
Backport PRs are successfully created, it won't be processed by CI script anymore
[pr-backports-created-cloud](/ClickHouse/ClickHouse/labels/pr-backports-created-cloud)
[pr-bugfix](/ClickHouse/ClickHouse/labels/pr-bugfix)
Pull request with bugfix, not backported by default
[pr-must-backport](/ClickHouse/ClickHouse/labels/pr-must-backport)
Pull request should be backported intentionally. Use this label with great care!
[pr-must-backport-cloud](/ClickHouse/ClickHouse/labels/pr-must-backport-cloud)

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

6 participants

[![@alexey-milovidov](https://avatars.githubusercontent.com/u/18581488?s=52&v=4)](/alexey-milovidov) [![@robot-clickhouse-ci-2](https://avatars.githubusercontent.com/u/118811860?s=52&v=4)](/robot-clickhouse-ci-2) [![@vdimir](https://avatars.githubusercontent.com/u/7023786?s=52&v=4)](/vdimir) [![@antonio2368](https://avatars.githubusercontent.com/u/17751307?s=52&v=4)](/antonio2368) [![@robot-ch-test-poll1](https://avatars.githubusercontent.com/u/47390204?s=52&v=4)](/robot-ch-test-poll1) [![@robot-ch-test-poll4](https://avatars.githubusercontent.com/u/69306974?s=52&v=4)](/robot-ch-test-poll4)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_e58fd452_20250114_202803.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FClickHouse%2FClickHouse%2Fsecurity%2Fadvisories%2FGHSA-qw9f-qv29-8938)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FClickHouse%2FClickHouse%2Fsecurity%2Fadvisories%2FGHSA-qw9f-qv29-8938)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=ClickHouse%2FClickHouse)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ClickHouse](/ClickHouse)
/
**[ClickHouse](/ClickHouse/ClickHouse)**
Public

* [Notifications](/login?return_to=%2FClickHouse%2FClickHouse) You must be signed in to change notification settings
* [Fork
  7k](/login?return_to=%2FClickHouse%2FClickHouse)
* [Star
   38.4k](/login?return_to=%2FClickHouse%2FClickHouse)

* [Code](/ClickHouse/ClickHouse)
* [Issues
  3.7k](/ClickHouse/ClickHouse/issues)
* [Pull requests
  406](/ClickHouse/ClickHouse/pulls)
* [Discussions](/ClickHouse/ClickHouse/discussions)
* [Actions](/ClickHouse/ClickHouse/actions)
* [Projects
  0](/ClickHouse/ClickHouse/projects)
* [Wiki](/ClickHouse/ClickHouse/wiki)
* [Security](/ClickHouse/ClickHouse/security)
* [Insights](/ClickHouse/ClickHouse/pulse)

Additional navigation options

* [Code](/ClickHouse/ClickHouse)
* [Issues](/ClickHouse/ClickHouse/issues)
* [Pull requests](/ClickHouse/ClickHouse/pulls)
* [Discussions](/ClickHouse/ClickHouse/discussions)
* [Actions](/ClickHouse/ClickHouse/actions)
* [Projects](/ClickHouse/ClickHouse/projects)
* [Wiki](/ClickHouse/ClickHouse/wiki)
* [Security](/ClickHouse/ClickHouse/security)
* [Insights](/ClickHouse/ClickHouse/pulse)

# Unauthenticated Integer underflow leading to stack overflow in FPC codec decompression

Moderate

[santrancisco](/santrancisco)
published
GHSA-qw9f-qv29-8938
Dec 18, 2023

## Package

ClickHouse Cloud
(ClickHouse Cloud)

## Affected versions

< 23.9.2.47475

## Patched versions

v23.9.2.47475

ClickHouse v23.10
(ClickHouse v23.10)

< v23.10.4.25

v23.10.4.25

ClickHouse v23.3
(ClickHouse v23.3)

< 23.3.17.13

v23.3.17.13

ClickHouse v23.8
(ClickHouse v23.8)

< 23.8.7.24

v23.8.7.24

ClickHouse v23.9
(ClickHouse v23.9)

< v23.9.5.29

v23.9.5.29

## Description

### Impact

This vulnerability is an integer underflow resulting in crash due to stack buffer overflow in decompression of FPC codec. It can be triggered and exploited by an unauthenticated attacker.

The vulnerability is very similar to CVE-2023-47118 with how the vulnerable function can be exploited.

### Patches

The issue have been addressed in ClickHouse starting from the following versions: v23.10.4.25, v23.9.5.29, v23.8.7.24, v23.3.17.13

### Workarounds

Affected users are advised to block native port access and temporary switch to HTTP protocol to reduce the exposure before they can upgrade to supported versions. This attack, however, can still be exploited by authenticated user.

### Backport

If you are maintaining your own forked version of ClickHouse. The fix for this vulnerability can be found in [this pull request](https://github.com/ClickHouse/ClickHouse/pull/56795).

### Severity

Moderate

5.9

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
High

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
None

Integrity
None

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:N/A:H

### CVE ID

CVE-2023-48298

### Weaknesses

No CWEs

### Credits

* [![@malacupa](https://avatars.githubusercontent.com/u/44790129?s=40&v=4)](/malacupa)
  [malacupa](/malacupa)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


