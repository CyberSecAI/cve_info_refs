=== Content from github.com_0c0d4105_20250115_095456.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxwiki%2Fxwiki-platform%2Fsecurity%2Fadvisories%2FGHSA-7rfg-6273-f5wp)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxwiki%2Fxwiki-platform%2Fsecurity%2Fadvisories%2FGHSA-7rfg-6273-f5wp)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=xwiki%2Fxwiki-platform)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[xwiki](/xwiki)
/
**[xwiki-platform](/xwiki/xwiki-platform)**
Public

* [Notifications](/login?return_to=%2Fxwiki%2Fxwiki-platform) You must be signed in to change notification settings
* [Fork
  554](/login?return_to=%2Fxwiki%2Fxwiki-platform)
* [Star
   1k](/login?return_to=%2Fxwiki%2Fxwiki-platform)

* [Code](/xwiki/xwiki-platform)
* [Pull requests
  139](/xwiki/xwiki-platform/pulls)
* [Actions](/xwiki/xwiki-platform/actions)
* [Projects
  0](/xwiki/xwiki-platform/projects)
* [Security](/xwiki/xwiki-platform/security)
* [Insights](/xwiki/xwiki-platform/pulse)

Additional navigation options

* [Code](/xwiki/xwiki-platform)
* [Pull requests](/xwiki/xwiki-platform/pulls)
* [Actions](/xwiki/xwiki-platform/actions)
* [Projects](/xwiki/xwiki-platform/projects)
* [Security](/xwiki/xwiki-platform/security)
* [Insights](/xwiki/xwiki-platform/pulse)

# Cookies are sent to external images in rendered diff (and server side request forgery)

Critical

[michitux](/michitux)
published
GHSA-7rfg-6273-f5wp
Nov 20, 2023

## Package

maven

org.xwiki.platform:xwiki-platform-diff-xml
([Maven](/advisories?query=ecosystem%3Amaven))

## Affected versions

>= 11.10.1, < 14.10.15
>= 15.0-rc-1, < 15.5.1
>= 15.6-rc-1, < 15.6

## Patched versions

14.10.15
15.5.1
15.6

## Description

### Impact

The rendered diff in XWiki embeds images to be able to compare the contents and not display a difference for an actually unchanged image. For this, XWiki requests all embedded images on the server side. These requests are also sent for images from other domains and include all cookies that were sent in the original request to ensure that images with restricted view right can be compared. This allows an attacker to steal login and session cookies that allow impersonating the current user who views the diff. The attack can be triggered with an image that references the rendered diff, thus making it easy to trigger.

More concretely, to reproduce, add 101 different images with references to the attacker's server. In any place add an image with a reference to `/xwiki/bin/view/Image%20Cookie%20Test/?xpage=changes&rev1=1.1&rev2=2.1&include=renderedChanges` where `Image%20Cookie%20Test` needs to be replaced by the path to the document with the images and the two revisions should match the revision before/after adding the images. Whenever a user views that image, the user's login cookies should be sent to the attacker's server. The 101 images are to circumvent the cache that has a default maximum size of 100 entries.

Apart from stealing login cookies, this also allows server-side request forgery (the result of any successful request is returned in the image's source) and viewing protected content as once a resource is cached, it is returned for all users. As only successful requests are cached, the cache will be filled by the first user who is allowed to access the resource.

### Patches

This has been patched in XWiki 14.10.15, 15.5.1 and 15.6. The rendered diff now only downloads images from trusted domains. Further, cookies are only sent when the image's domain is the same the requested domain. The cache has been changed to be specific for each user.

### Workarounds

As a workaround, the image embedding feature can be disabled by deleting `xwiki-platform-diff-xml-<version>.jar` in `WEB-INF/lib/`.

### References

* <https://jira.xwiki.org/browse/XWIKI-20818>
* [bff0203](https://github.com/xwiki/xwiki-platform/commit/bff0203e739b6e3eb90af5736f04278c73c2a8bb)

### Severity

Critical

9.1

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
Low

User interaction
Required

Scope
Changed

Confidentiality
High

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:H/I:H/A:H

### CVE ID

CVE-2023-48240

### Weaknesses

[CWE-201](/advisories?query=cwe%3A201) [CWE-281](/advisories?query=cwe%3A281) [CWE-918](/advisories?query=cwe%3A918)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from jira.xwiki.org_4513be5e_20250115_095456.html ===


[Log in](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-20818)[Skip to main content](#main)[Skip to sidebar](#sidebar)Linked ApplicationsLoading…[![XWiki.org JIRA](/s/-65z3d2/930000/8ws80b/_/jira-logo-scaled.png)](https://jira.xwiki.org/secure/MyJiraHome.jspa)

* [Dashboards](/secure/Dashboard.jspa "View and manage your dashboards")
* [Projects](/secure/BrowseProjects.jspa "View recent projects and browse a list of projects")
* [Issues](/issues/ "Search for issues and view recent issues")

* Give feedback to Atlassian
* [Help](https://docs.atlassian.com/jira/jcore-docs-093/ "Help")
  + [Jira Core help](https://docs.atlassian.com/jira/jcore-docs-093/ "Go to the online documentation for Jira Core")
  + [Keyboard Shortcuts](/secure/ViewKeyboardShortcuts%21default.jspa "Get more information about Jira's Keyboard Shortcuts")
  + [About Jira](/secure/AboutPage.jspa "Get more information about Jira")
  + [Jira Credits](/secure/credits/AroundTheWorld%21default.jspa "See who did what")
* [Log In](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-20818)

![Uploaded image for project: 'XWiki Platform'](https://jira.xwiki.org/secure/projectavatar?pid=10010&avatarId=13602)

1. [XWiki Platform](/browse/XWIKI)
2. [XWIKI-20818](/browse/XWIKI-20818)

# Cookies are sent to external images in rendered diff (and server side request forgery)

[Log In](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-20818 "Log In")ClosedExportnull

XMLWordPrintable
#### Details

* **Type:**
  ![](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.") Bug
* **Resolution:**
  Fixed
* **Priority:**
  ![](/images/icons/priorities/blocker.svg "Blocker - Blocks development and/or testing work, production could not run.") Blocker
* **Fix Version/s:**
  [15.5.1](/issues/?jql=project+%3D+XWIKI+AND+fixVersion+%3D+15.5.1 "15.5.1 "), [14.10.15](/issues/?jql=project+%3D+XWIKI+AND+fixVersion+%3D+14.10.15 "14.10.15 "), [15.6](/issues/?jql=project+%3D+XWIKI+AND+fixVersion+%3D+15.6 "15.6 ")
* **Affects Version/s:**
  11.10.1, 12.0-rc-1
* **Component/s:**
  [Diff](/issues/?jql=project+%3D+XWIKI+AND+component+%3D+Diff "Diff ")
* **Labels:**
  + [attack\_impersonation](/issues/?jql=labels+%3D+attack_impersonation "attack_impersonation")
  + [attacker\_account](/issues/?jql=labels+%3D+attacker_account "attacker_account")
  + [security](/issues/?jql=labels+%3D+security "security")

* **Tests:**
  Unit, Integration
* **Difficulty:**
  Unknown
* **Documentation:**
  <https://extensions.xwiki.org/xwiki/bin/view/Extension/Diff%20Module#HConfigurationofImageEmbedding>
* **Documentation in Release Notes:**
  <https://www.xwiki.org/xwiki/bin/view/ReleaseNotes/Data/XWiki/14.10.15/#HIssuesspecificto> <https://www.xwiki.org/xwiki/bin/view/ReleaseNotes/Data/XWiki/15.6/#HIssuesspecificto> <https://www.xwiki.org/xwiki/bin/view/ReleaseNotes/Data/XWiki/15.5.1/#HIssuessp>
* **Similar issues:**

#### Description

**Steps to reproduce:**

1. Edit a document to add 101 different images with references to the attacker's server (could be the user profile).
2. In any place add an image with a reference to /xwiki/bin/view/Image%20Cookie%20Test/?xpage=changes&rev1=1.1&rev2=2.1&include=renderedChanges where Image%20Cookie%20Test needs to be replaced by the path to the document with the images and the two revisions should match the revision before/after adding the images.

**Expected result:**

Regardless who visits the document with the image with the revision URL, no cookies (and in fact no requests at all) are sent to the attackers server.

**Actual result:**

Requests with cookies of any user who views the image with the revision URL are sent to the attackers server. This allows stealing the cookies of any user. Due to XWIKI-5406 this potentially allows recovering the username and password of any user (including admin users). Further, with the session id cookie alone, the user can be impersonated for a limited period of time.

While stealing cookies is the more severe attack, this also allows server-side request forgery.

The vulnerable code is here: <https://github.com/xwiki/xwiki-platform/blob/dd9f58e04afe45d8a8b96af9e98b824b9f5070f5/xwiki-platform-core/xwiki-platform-diff/xwiki-platform-diff-xml/src/main/java/org/xwiki/diff/xml/internal/DefaultDataURIConverter.java#L139>

The 101 images are used because the requested images are cached in a cache with a maximum size of 100 items.

I think the code should be changed to not create data URIs for external images.

#### Attachments

#### Issue Links

links to

![Web Link](https://github.com/favicon.ico "Web Link")
[Security Advisory](https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-7rfg-6273-f5wp)

#### Activity

#### People

Assignee:

![MichaelHamann](https://jira.xwiki.org/secure/useravatar?size=small&avatarId=10222)
Michael Hamann

Reporter:

![MichaelHamann](https://jira.xwiki.org/secure/useravatar?size=small&avatarId=10222)
Michael Hamann

Votes:
0
Vote for this issue

Watchers:
1
Start watching this issue

#### Dates

Created:

04/Apr/23 18:35

Updated:

17/Nov/23 13:01

Resolved:

26/Jul/23 16:33

* Atlassian Jira [Project Management Software](https://www.atlassian.com/software/jira)
* [About Jira](/secure/AboutPage.jspa/secure/AboutPage.jspa)
* [Report a problem](/secure/CreateIssue%21default.jspa)

Powered by a free Atlassian [Jira](http://www.atlassian.com/software/jira) open source license for XWiki.org. Try Jira - [bug tracking software](http://www.atlassian.com/software/jira) for *your* team.

[Atlassian](http://www.atlassian.com/)



=== Content from github.com_2919c23c_20250115_095455.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxwiki%2Fxwiki-platform%2Fcommit%2Fbff0203e739b6e3eb90af5736f04278c73c2a8bb)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxwiki%2Fxwiki-platform%2Fcommit%2Fbff0203e739b6e3eb90af5736f04278c73c2a8bb)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=xwiki%2Fxwiki-platform)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[xwiki](/xwiki)
/
**[xwiki-platform](/xwiki/xwiki-platform)**
Public

* [Notifications](/login?return_to=%2Fxwiki%2Fxwiki-platform) You must be signed in to change notification settings
* [Fork
  554](/login?return_to=%2Fxwiki%2Fxwiki-platform)
* [Star
   1k](/login?return_to=%2Fxwiki%2Fxwiki-platform)

* [Code](/xwiki/xwiki-platform)
* [Pull requests
  139](/xwiki/xwiki-platform/pulls)
* [Actions](/xwiki/xwiki-platform/actions)
* [Projects
  0](/xwiki/xwiki-platform/projects)
* [Security](/xwiki/xwiki-platform/security)
* [Insights](/xwiki/xwiki-platform/pulse)

Additional navigation options

* [Code](/xwiki/xwiki-platform)
* [Pull requests](/xwiki/xwiki-platform/pulls)
* [Actions](/xwiki/xwiki-platform/actions)
* [Projects](/xwiki/xwiki-platform/projects)
* [Security](/xwiki/xwiki-platform/security)
* [Insights](/xwiki/xwiki-platform/pulse)

## Commit

[Permalink](/xwiki/xwiki-platform/commit/bff0203e739b6e3eb90af5736f04278c73c2a8bb)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

XWIKI-20818: Improve data URI converter

[Browse files](/xwiki/xwiki-platform/tree/bff0203e739b6e3eb90af5736f04278c73c2a8bb)
Browse the repository at this point in the history

```
* Cache failures
* Properly dispose the caches
* Only send requests to trusted domains
* Only embed actual images
* Limit responses to 1MB
* Introduce configuration options for timeout, maximum size and if the
  feature is enabled at all
* Add a UI test that checks that attachment embedding is working in
  general
* Move to httpclient5
* Expose the cookie domains configuration in AuthenticationConfiguration
```

* Loading branch information

[![@michitux](https://avatars.githubusercontent.com/u/198317?s=40&v=4)](/michitux)

[michitux](/xwiki/xwiki-platform/commits?author=michitux "View all commits by michitux")
committed
Jul 26, 2023

1 parent
[18c079f](/xwiki/xwiki-platform/commit/18c079fc4495db6b68393579342863595dfd4e6b)

commit bff0203

 Show file tree

 Hide file tree

Showing
**16 changed files**
with
**1,305 additions**
and
**57 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* xwiki-platform-core

  + xwiki-platform-diff/xwiki-platform-diff-xml

    - xwiki-platform-core/xwiki-platform-diff/xwiki-platform-diff-xml/pom.xml
      [pom.xml](#diff-8878df14625d360046d4ffc5820327ff59aaba3dbd5803e6516acaa4afbb389a)
    - src

      * main

        + java/org/xwiki/diff/xml

          - xwiki-platform-core/xwiki-platform-diff/xwiki-platform-diff-xml/src/main/java/org/xwiki/diff/xml/XMLDiffDataURIConverterConfiguration.java
            [XMLDiffDataURIConverterConfiguration.java](#diff-a8e1fc096f93b69fb521276c11c161fa51bf9b8c6d59a757e306b246c0e121d1)
          - internal

            * xwiki-platform-core/xwiki-platform-diff/xwiki-platform-diff-xml/src/main/java/org/xwiki/diff/xml/internal/DefaultDataURIConverter.java
              [DefaultDataURIConverter.java](#diff-d34f20843a931e29059d2ae1d263503fb0c7d8b3bf29b54fc2b5cdf8e156e23b)
            * xwiki-platform-core/xwiki-platform-diff/xwiki-platform-diff-xml/src/main/java/org/xwiki/diff/xml/internal/DefaultXMLDiffDataURIConverterConfiguration.java
              [DefaultXMLDiffDataURIConverterConfiguration.java](#diff-1a645c37c08e176f5776ec40dd4a0469b82751d44f79ae1df2507a96dfe81d25)
            * xwiki-platform-core/xwiki-platform-diff/xwiki-platform-diff-xml/src/main/java/org/xwiki/diff/xml/internal/HttpClientBuilderFactory.java
              [HttpClientBuilderFactory.java](#diff-0d7212256cc5eb1a74d4b232da2b08be21c3ccae878890ac62ff95db40d1b17a)
            * xwiki-platform-core/xwiki-platform-diff/xwiki-platform-diff-xml/src/main/java/org/xwiki/diff/xml/internal/ImageDownloader.java
              [ImageDownloader.java](#diff-26c63020a6cd3990900c24702467a04fa0104554e8dd877798c64b67f615a087)
        + resources/META-INF

          - xwiki-platform-core/xwiki-platform-diff/xwiki-platform-diff-xml/src/main/resources/META-INF/components.txt
            [components.txt](#diff-0520c64f35b1fa989a7e121585bbc18596ad6aa2d5f2cad0ef5287d82525955a)
      * test/java/org/xwiki/diff/xml/internal

        + xwiki-platform-core/xwiki-platform-diff/xwiki-platform-diff-xml/src/test/java/org/xwiki/diff/xml/internal/DefaultDataURIConverterTest.java
          [DefaultDataURIConverterTest.java](#diff-20e4b276e784143da79cce1fe1ee7de5cc809672068f6135bd87631c1c949f7e)
        + xwiki-platform-core/xwiki-platform-diff/xwiki-platform-diff-xml/src/test/java/org/xwiki/diff/xml/internal/ImageDownloaderTest.java
          [ImageDownloaderTest.java](#diff-a43207dace2aafd39f20a24561ade29ac7cd3b2e2886e3c140952d86bddc0883)
  + xwiki-platform-flamingo/xwiki-platform-flamingo-skin/xwiki-platform-flamingo-skin-test/xwiki-platform-flamingo-skin-test-docker

    - xwiki-platform-core/xwiki-platform-flamingo/xwiki-platform-flamingo-skin/xwiki-platform-flamingo-skin-test/xwiki-platform-flamingo-skin-test-docker/pom.xml
      [pom.xml](#diff-6523fcc9a1667a22e90f86d22b273f7d12d596991f43381a44eead74ce291840)
    - src/test/it/org/xwiki/flamingo/test/docker

      * xwiki-platform-core/xwiki-platform-flamingo/xwiki-platform-flamingo-skin/xwiki-platform-flamingo-skin-test/xwiki-platform-flamingo-skin-test-docker/src/test/it/org/xwiki/flamingo/test/docker/AllIT.java
        [AllIT.java](#diff-021be550d12f9a762260c87c784e5b0e515e9a7cd7769f976f4cee36aaeb6f84)
      * xwiki-platform-core/xwiki-platform-flamingo/xwiki-platform-flamingo-skin/xwiki-platform-flamingo-skin-test/xwiki-platform-flamingo-skin-test-docker/src/test/it/org/xwiki/flamingo/test/docker/CompareIT.java
        [CompareIT.java](#diff-e3bdc175c2a4f4873ae8f70a374817aea2381c08305c51c638cce7b623b761be)
  + xwiki-platform-security/xwiki-platform-security-authentication

    - xwiki-platform-security-authentication-api/src/main/java/org/xwiki/security/authentication

      * xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-api/src/main/java/org/xwiki/security/authentication/AuthenticationConfiguration.java
        [AuthenticationConfiguration.java](#diff-0df872ac0a55efc8b81c965e18eb904e9bd0b2e80847a78129fd0227712edfcc)
    - xwiki-platform-security-authentication-default/src

      * main/java/org/xwiki/security/authentication/internal

        + xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/DefaultAuthenticationConfiguration.java
          [DefaultAuthenticationConfiguration.java](#diff-6f17b80530beb187cc6a90c987bd642b7baee5829b3d75206daafc0f0186260f)
      * test/java/org/xwiki/security/authentication/internal

        + xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/DefaultAuthenticationConfigurationTest.java
          [DefaultAuthenticationConfigurationTest.java](#diff-2cb932cb755e3bc6ccc6163827d7d5d96df5448a7702f12f98c47ca627d11fc2)
* xwiki-platform-tools/xwiki-platform-tool-configuration-resources/src/main/resources

  + xwiki-platform-tools/xwiki-platform-tool-configuration-resources/src/main/resources/xwiki.properties.vm
    [xwiki.properties.vm](#diff-dcbdc74dfba4049080f6ecbf5b078d266e04d4c7c48cd9cc1d266ad4590bb969)

## There are no files selected for viewing

24 changes: 23 additions & 1 deletion

24
[xwiki-platform-core/xwiki-platform-diff/xwiki-platform-diff-xml/pom.xml](#diff-8878df14625d360046d4ffc5820327ff59aaba3dbd5803e6516acaa4afbb389a "xwiki-platform-core/xwiki-platform-diff/xwiki-platform-diff-xml/pom.xml")

Show comments

[View file](/xwiki/xwiki-platform/blob/bff0203e739b6e3eb90af5736f04278c73c2a8bb/xwiki-platform-core/xwiki-platform-diff/xwiki-platform-diff-xml/pom.xml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -31,9 +31,13 @@ |
|  |  | <name>XWiki Platform - Diff - XML</name> |
|  |  | <description>XWiki Platform - Diff - XML</description> |
|  |  | <properties> |
|  |  | <xwiki.jacoco.instructionRatio>0.00</xwiki.jacoco.instructionRatio> |
|  |  | <xwiki.jacoco.instructionRatio>0.77</xwiki.jacoco.instructionRatio> |
|  |  | </properties> |
|  |  | <dependencies> |
|  |  | <dependency> |
|  |  | <groupId>org.apache.httpcomponents.client5</groupId> |
|  |  | <artifactId>httpclient5</artifactId> |
|  |  | </dependency> |
|  |  | <dependency> |
|  |  | <groupId>org.xwiki.commons</groupId> |
|  |  | <artifactId>xwiki-commons-diff-xml</artifactId> |
| Expand All | | @@ -44,9 +48,27 @@ |
|  |  | <artifactId>xwiki-platform-oldcore</artifactId> |
|  |  | <version>${project.version}</version> |
|  |  | </dependency> |
|  |  | <dependency> |
|  |  | <groupId>org.xwiki.platform</groupId> |
|  |  | <artifactId>xwiki-platform-security-authentication-api</artifactId> |
|  |  | <version>${project.version}</version> |
|  |  | </dependency> |
|  |  | <dependency> |
|  |  | <groupId>javax.servlet</groupId> |
|  |  | <artifactId>javax.servlet-api</artifactId> |
|  |  | </dependency> |
|  |  | <dependency> |
|  |  | <groupId>org.xwiki.commons</groupId> |
|  |  | <artifactId>xwiki-commons-tool-test-component</artifactId> |
|  |  | <version>${commons.version}</version> |
|  |  | <scope>test</scope> |
|  |  | </dependency> |
|  |  | <dependency> |
|  |  | <groupId>org.xwiki.platform</groupId> |
|  |  | <artifactId>xwiki-platform-oldcore</artifactId> |
|  |  | <version>${project.version}</version> |
|  |  | <scope>test</scope> |
|  |  | <type>test-jar</type> |
|  |  | </dependency> |
|  |  | </dependencies> |
|  |  | </project> |

51 changes: 51 additions & 0 deletions

51
[...tform-diff-xml/src/main/java/org/xwiki/diff/xml/XMLDiffDataURIConverterConfiguration.java](#diff-a8e1fc096f93b69fb521276c11c161fa51bf9b8c6d59a757e306b246c0e121d1 "xwiki-platform-core/xwiki-platform-diff/xwiki-platform-diff-xml/src/main/java/org/xwiki/diff/xml/XMLDiffDataURIConverterConfiguration.java")

Show comments

[View file](/xwiki/xwiki-platform/blob/bff0203e739b6e3eb90af5736f04278c73c2a8bb/xwiki-platform-core/xwiki-platform-diff/xwiki-platform-diff-xml/src/main/java/org/xwiki/diff/xml/XMLDiffDataURIConverterConfiguration.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,51 @@ |
|  |  | /\* |
|  |  | \* See the NOTICE file distributed with this work for additional |
|  |  | \* information regarding copyright ownership. |
|  |  | \* |
|  |  | \* This is free software; you can redistribute it and/or modify it |
|  |  | \* under the terms of the GNU Lesser General Public License as |
|  |  | \* published by the Free Software Foundation; either version 2.1 of |
|  |  | \* the License, or (at your option) any later version. |
|  |  | \* |
|  |  | \* This software is distributed in the hope that it will be useful, |
|  |  | \* but WITHOUT ANY WARRANTY; without even the implied warranty of |
|  |  | \* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU |
|  |  | \* Lesser General Public License for more details. |
|  |  | \* |
|  |  | \* You should have received a copy of the GNU Lesser General Public |
|  |  | \* License along with this software; if not, write to the Free |
|  |  | \* Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA |
|  |  | \* 02110-1301 USA, or see the FSF site: http://www.fsf.org. |
|  |  | \*/ |
|  |  | package org.xwiki.diff.xml; |
|  |  |  |
|  |  | import org.xwiki.component.annotation.Role; |
|  |  | import org.xwiki.stability.Unstable; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Configuration for the data URI converter in the XML diff module. |
|  |  | \* |
|  |  | \* @since 14.10.15 |
|  |  | \* @since 15.5.1 |
|  |  | \* @since 15.6 |
|  |  | \* @version $Id$ |
|  |  | \*/ |
|  |  | @Unstable |
|  |  | @Role |
|  |  | public interface XMLDiffDataURIConverterConfiguration |
|  |  | { |
|  |  | /\*\* |
|  |  | \* @return the timeout to use when fetching data from the web to embed as data URI |
|  |  | \*/ |
|  |  | int getHTTPTimeout(); |
|  |  |  |
|  |  | /\*\* |
|  |  | \* @return the maximum size of the data to embed as data URI |
|  |  | \*/ |
|  |  | long getMaximumContentSize(); |
|  |  |  |
|  |  | /\*\* |
|  |  | \* @return true if the data URI converter is enabled |
|  |  | \*/ |
|  |  | boolean isEnabled(); |
|  |  | } |

186 changes: 130 additions & 56 deletions

186
[...-platform-diff-xml/src/main/java/org/xwiki/diff/xml/internal/DefaultDataURIConverter.java](#diff-d34f20843a931e29059d2ae1d263503fb0c7d8b3bf29b54fc2b5cdf8e156e23b "xwiki-platform-core/xwiki-platform-diff/xwiki-platform-diff-xml/src/main/java/org/xwiki/diff/xml/internal/DefaultDataURIConverter.java")

Show comments

[View file](/xwiki/xwiki-platform/blob/bff0203e739b6e3eb90af5736f04278c73c2a8bb/xwiki-platform-core/xwiki-platform-diff/xwiki-platform-diff-xml/src/main/java/org/xwiki/diff/xml/internal/DefaultDataURIConverter.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -21,7 +21,6 @@ |
|  |  |  |
|  |  | import java.io.IOException; |
|  |  | import java.net.MalformedURLException; |
|  |  | import java.net.URI; |
|  |  | import java.net.URISyntaxException; |
|  |  | import java.net.URL; |
|  |  | import java.util.Base64; |
| Expand All | | @@ -30,121 +29,196 @@ |
|  |  | import javax.inject.Provider; |
|  |  | import javax.inject.Singleton; |
|  |  |  |
|  |  | import org.apache.commons.io.IOUtils; |
|  |  | import org.apache.commons.lang3.StringUtils; |
|  |  | import org.apache.http.HttpEntity; |
|  |  | import org.apache.http.HttpStatus; |
|  |  | import org.apache.http.StatusLine; |
|  |  | import org.apache.http.client.methods.CloseableHttpResponse; |
|  |  | import org.apache.http.client.methods.HttpGet; |
|  |  | import org.apache.http.impl.client.CloseableHttpClient; |
|  |  | import org.apache.http.impl.client.HttpClientBuilder; |
|  |  | import org.xwiki.cache.Cache; |
|  |  | import org.xwiki.cache.CacheManager; |
|  |  | import org.xwiki.cache.config.CacheConfiguration; |
|  |  | import org.xwiki.cache.eviction.EntryEvictionConfiguration; |
|  |  | import org.xwiki.cache.eviction.LRUEvictionConfiguration; |
|  |  | import org.xwiki.component.annotation.Component; |
|  |  | import org.xwiki.component.phase.Disposable; |
|  |  | import org.xwiki.component.phase.Initializable; |
|  |  | import org.xwiki.component.phase.InitializationException; |
|  |  | import org.xwiki.diff.DiffException; |
|  |  | import org.xwiki.diff.xml.XMLDiffDataURIConverterConfiguration; |
|  |  | import org.xwiki.url.URLSecurityManager; |
|  |  | import org.xwiki.user.CurrentUserReference; |
|  |  | import org.xwiki.user.UserReferenceSerializer; |
|  |  |  |
|  |  | import com.xpn.xwiki.XWiki; |
|  |  | import com.xpn.xwiki.XWikiContext; |
|  |  | import com.xpn.xwiki.web.XWikiRequest; |
|  |  | import com.xpn.xwiki.XWikiException; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Default implementation of {@link DataURIConverter}. |
|  |  | \* |
|  |  | \* Default Implementation of {@link DataURIConverter} that uses an HTTP client to embed images. |
|  |  | \* |
|  |  | \* @version $Id$ |
|  |  | \* @since 11.10.1 |
|  |  | \* @since 12.0RC1 |
|  |  | \*/ |
|  |  | @Component |
|  |  | @Singleton |
|  |  | public class DefaultDataURIConverter implements DataURIConverter, Initializable |
|  |  | public class DefaultDataURIConverter implements Initializable, Disposable, DataURIConverter |
|  |  | { |
|  |  | private static final String HEADER\_COOKIE = "Cookie"; |
|  |  |  |
|  |  | @Inject |
|  |  | private Provider<XWikiContext> xcontextProvider; |
|  |  |  |
|  |  | @Inject |
|  |  | private CacheManager cacheManager; |
|  |  |  |
|  |  | @Inject |
|  |  | private URLSecurityManager urlSecurityManager; |
|  |  |  |
|  |  | @Inject |
|  |  | private UserReferenceSerializer<String> userReferenceSerializer; |
|  |  |  |
|  |  | @Inject |
|  |  | private ImageDownloader imageDownloader; |
|  |  |  |
|  |  | @Inject |
|  |  | private XMLDiffDataURIConverterConfiguration configuration; |
|  |  |  |
|  |  | private Cache<String> cache; |
|  |  |  |
|  |  | private Cache<DiffException> failureCache; |
|  |  |  |
|  |  | @Override |
|  |  | public void initialize() throws InitializationException |
|  |  | { |
|  |  | if (!this.configuration.isEnabled()) { |
|  |  | return; |
|  |  | } |
|  |  |  |
|  |  | CacheConfiguration cacheConfig = new CacheConfiguration(); |
|  |  | cacheConfig.setConfigurationId("diff.html.dataURI"); |
|  |  | LRUEvictionConfiguration lru = new LRUEvictionConfiguration(); |
|  |  | lru.setMaxEntries(100); |
|  |  | cacheConfig.put(LRUEvictionConfiguration.CONFIGURATIONID, lru); |
|  |  | cacheConfig.put(EntryEvictionConfiguration.CONFIGURATIONID, lru); |
|  |  |  |
|  |  | CacheConfiguration failureCacheConfiguration = new CacheConfiguration(); |
|  |  | failureCacheConfiguration.setConfigurationId("diff.html.dataURIFailureCache"); |
|  |  | LRUEvictionConfiguration failureLRU = new LRUEvictionConfiguration(); |
|  |  | failureLRU.setMaxEntries(1000); |
|  |  | // Cache failures for an hour. This is to avoid hammering the server with requests for images that don't |
|  |  | // exist or are inaccessible or too large. |
|  |  | failureLRU.setLifespan(3600); |
|  |  | failureCacheConfiguration.put(EntryEvictionConfiguration.CONFIGURATIONID, failureLRU); |
|  |  |  |
|  |  | try { |
|  |  | this.cache = this.cacheManager.createNewCache(cacheConfig); |
|  |  | this.failureCache = this.cacheManager.createNewCache(failureCacheConfiguration); |
|  |  | } catch (Exception e) { |
|  |  | // Dispose the cache if it has been created. |
|  |  | if (this.cache != null) { |
|  |  | this.cache.dispose(); |
|  |  | } |
|  |  | throw new InitializationException("Failed to create the Data URI cache.", e); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | @Override |
|  |  | public String convert(String url) throws DiffException |
|  |  | public void dispose() |
|  |  | { |
|  |  | if (url.startsWith("data:")) { |
|  |  | // Already data URI. |
|  |  | return url; |
|  |  | if (this.cache != null) { |
|  |  | this.cache.dispose(); |
|  |  | } |
|  |  | if (this.failureCache != null) { |
|  |  | this.failureCache.dispose(); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | String cachedDataURI = this.cache.get(url); |
|  |  | if (cachedDataURI == null) { |
|  |  | try { |
|  |  | cachedDataURI = convert(getAbsoluteURI(url)); |
|  |  | this.cache.set(url, cachedDataURI); |
|  |  | } catch (IOException | URISyntaxException e) { |
|  |  | throw new DiffException("Failed to convert [" + url + "] to data URI.", e); |
|  |  | /\*\* |
|  |  | \* Convert the given URL to an absolute URL using the request URL from the given context. |
|  |  | \* |
|  |  | \* @param url the URL to convert |
|  |  | \* @param xcontext the XWiki context |
|  |  | \* @return the absolute URL |
|  |  | \* @throws DiffException if the URL cannot be converted due to being malformed |
|  |  | \*/ |
|  |  | protected URL getAbsoluteURL(String url, XWikiContext xcontext) throws DiffException |
|  |  | { |
|  |  | URL absoluteURL; |
|  |  | try { |
|  |  | if (xcontext.getRequest() != null) { |
|  |  | URL requestURL = XWiki.getRequestURL(xcontext.getRequest()); |
|  |  | absoluteURL = new URL(requestURL, url); |
|  |  | } else { |
|  |  | absoluteURL = new URL(url); |
|  |  | } |
|  |  | } catch (MalformedURLException | XWikiException e) { |
|  |  | throw new DiffException(String.format("Failed to resolve [%s] to an absolute URL.", url), e); |
|  |  | } |
|  |  |  |
|  |  | return cachedDataURI; |
|  |  | return absoluteURL; |
|  |  | } |
|  |  |  |
|  |  | private URL getAbsoluteURI(String relativeURL) throws MalformedURLException |
|  |  | /\*\* |
|  |  | \* Get a data URI for the given content and content type. |
|  |  | \* |
|  |  | \* @param contentType the content type |
|  |  | \* @param content the content |
|  |  | \* @return the data URI |
|  |  | \*/ |
|  |  | protected static String getDataURI(String contentType, byte[] content) |
|  |  | { |
|  |  | XWikiContext xcontext = this.xcontextProvider.get(); |
|  |  | URL baseURL = xcontext.getURLFactory().getServerURL(xcontext); |
|  |  | return new URL(baseURL, relativeURL); |
|  |  | return String.format("data:%s;base64,%s", contentType, Base64.getEncoder().encodeToString(content)); |
|  |  | } |
|  |  |  |
|  |  | private String convert(URL url) throws IOException, URISyntaxException |
|  |  | /\*\* |
|  |  | \* Compute a cache key based on the current user and the URL. |
|  |  | \* |
|  |  | \* @param url the url |
|  |  | \* @return the cache key |
|  |  | \*/ |
|  |  | private String getCacheKey(URL url) |
|  |  | { |
|  |  | HttpEntity entity = fetch(url.toURI()); |
|  |  | // Remove the content type parameters, such as the charset, so they don't influence the diff. |
|  |  | String contentType = StringUtils.substringBefore(entity.getContentType().getValue(), ";"); |
|  |  | byte[] content = IOUtils.toByteArray(entity.getContent()); |
|  |  | return String.format("data:%s;base64,%s", contentType, Base64.getEncoder().encodeToString(content)); |
|  |  | String userPart = this.userReferenceSerializer.serialize(CurrentUserReference.INSTANCE); |
|  |  | // Prepend the length of the user part to avoid any kind of confusion between user and URL. |
|  |  | return String.format("%d:%s:%s", userPart.length(), userPart, url.toString()); |
|  |  | } |
|  |  |  |
|  |  | private HttpEntity fetch(URI uri) throws IOException |
|  |  | @Override |
|  |  | public String convert(String url) throws DiffException |
|  |  | { |
|  |  | HttpClientBuilder httpClientBuilder = HttpClientBuilder.create(); |
|  |  | httpClientBuilder.useSystemProperties(); |
|  |  | httpClientBuilder.setUserAgent("XWikiHTMLDiff"); |
|  |  | if (url.startsWith("data:") || !this.configuration.isEnabled()) { |
|  |  | // Already data URI. |
|  |  | return url; |
|  |  | } |
|  |  |  |
|  |  | // Convert URL to absolute URL to avoid issues with relative URLs that might reference different images |
|  |  | // in different subwikis. |
|  |  | URL absoluteURL = getAbsoluteURL(url, this.xcontextProvider.get()); |
|  |  |  |
|  |  | CloseableHttpClient httpClient = httpClientBuilder.build(); |
|  |  | HttpGet getMethod = new HttpGet(uri); |
|  |  | String cacheKey = getCacheKey(absoluteURL); |
|  |  |  |
|  |  | XWikiRequest request = this.xcontextProvider.get().getRequest(); |
|  |  | if (request != null) { |
|  |  | // Copy the cookies from the current request. |
|  |  | getMethod.setHeader(HEADER\_COOKIE, request.getHeader(HEADER\_COOKIE)); |
|  |  | try { |
|  |  | String dataURI = this.cache.get(cacheKey); |
|  |  |  |
|  |  | if (dataURI == null) { |
|  |  | DiffException failure = this.failureCache.get(cacheKey); |
|  |  |  |
|  |  | if (failure != null) { |
|  |  | throw failure; |
|  |  | } |
|  |  |  |
|  |  | dataURI = convert(absoluteURL); |
|  |  | this.cache.set(cacheKey, dataURI); |
|  |  | } |
|  |  |  |
|  |  | return dataURI; |
|  |  | } catch (IOException | URISyntaxException e) { |
|  |  | DiffException diffException = new DiffException("Failed to convert [" + url + "] to data URI.", e); |
|  |  | this.failureCache.set(cacheKey, diffException); |
|  |  | throw diffException; |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | CloseableHttpResponse response = httpClient.execute(getMethod); |
|  |  | StatusLine statusLine = response.getStatusLine(); |
|  |  | if (statusLine.getStatusCode() == HttpStatus.SC\_OK) { |
|  |  | return response.getEntity(); |
|  |  | } else { |
|  |  | throw new IOException(statusLine.getStatusCode() + " " + statusLine.getReasonPhrase()); |
|  |  | private String convert(URL url) throws IOException, URISyntaxException |
|  |  | { |
|  |  | if (!this.urlSecurityManager.isDomainTrusted(url)) { |
|  |  | throw new IOException(String.format("The URL [%s] is not trusted.", url)); |
|  |  | } |
|  |  |  |
|  |  | ImageDownloader.DownloadResult downloadResult = this.imageDownloader.download(url.toURI()); |
|  |  |  |
|  |  | return getDataURI(downloadResult.getContentType(), downloadResult.getData()); |
|  |  | } |
|  |  | } |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `bff0203`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxwiki%2Fxwiki-platform%2Fcommit%2Fbff0203e739b6e3eb90af5736f04278c73c2a8bb) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


