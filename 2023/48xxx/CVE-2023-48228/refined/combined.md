=== Content from github.com_fbe7b968_20250115_113815.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoauthentik%2Fauthentik%2Fpull%2F7666)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoauthentik%2Fauthentik%2Fpull%2F7666)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=goauthentik%2Fauthentik)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[goauthentik](/goauthentik)
/
**[authentik](/goauthentik/authentik)**
Public

* [Notifications](/login?return_to=%2Fgoauthentik%2Fauthentik) You must be signed in to change notification settings
* [Fork
  986](/login?return_to=%2Fgoauthentik%2Fauthentik)
* [Star
   14.5k](/login?return_to=%2Fgoauthentik%2Fauthentik)

* [Code](/goauthentik/authentik)
* [Issues
  614](/goauthentik/authentik/issues)
* [Pull requests
  116](/goauthentik/authentik/pulls)
* [Discussions](/goauthentik/authentik/discussions)
* [Actions](/goauthentik/authentik/actions)
* [Security](/goauthentik/authentik/security)
* [Insights](/goauthentik/authentik/pulse)

Additional navigation options

* [Code](/goauthentik/authentik)
* [Issues](/goauthentik/authentik/issues)
* [Pull requests](/goauthentik/authentik/pulls)
* [Discussions](/goauthentik/authentik/discussions)
* [Actions](/goauthentik/authentik/actions)
* [Security](/goauthentik/authentik/security)
* [Insights](/goauthentik/authentik/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fgoauthentik%2Fauthentik%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fgoauthentik%2Fauthentik%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# security: fix CVE-2023-48228 #7666

 Merged

[BeryJu](/BeryJu)
merged 1 commit into
[main](/goauthentik/authentik/tree/main "goauthentik/authentik:main")
from
[security/CVE-2023-48228](/goauthentik/authentik/tree/security/CVE-2023-48228 "goauthentik/authentik:security/CVE-2023-48228")

Nov 21, 2023

 Merged

# [security: fix CVE-2023-48228](#top) #7666

[BeryJu](/BeryJu)
merged 1 commit into
[main](/goauthentik/authentik/tree/main "goauthentik/authentik:main")
from
[security/CVE-2023-48228](/goauthentik/authentik/tree/security/CVE-2023-48228 "goauthentik/authentik:security/CVE-2023-48228")

Nov 21, 2023

[Conversation
4](/goauthentik/authentik/pull/7666)
[Commits
1](/goauthentik/authentik/pull/7666/commits)
[Checks
61](/goauthentik/authentik/pull/7666/checks)
[Files changed](/goauthentik/authentik/pull/7666/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![BeryJu](https://avatars.githubusercontent.com/u/1932513?s=60&v=4)](/BeryJu)

Copy link

Member

### @BeryJu **[BeryJu](/BeryJu)** commented [Nov 21, 2023](#issue-2004758532)

## Details

REPLACE ME

---

## Checklist

* Local tests pass (`ak test authentik/`)
* The code has been formatted (`make lint-fix`)

If an API change has been made

* The API schema has been updated (`make gen-build`)

If changes to the frontend have been made

* The code has been formatted (`make web`)
* The translation files have been updated (`make i18n-extract`)

If applicable

* The documentation has been updated
* The documentation has been formatted (`make website`)

Sorry, something went wrong.

All reactions

[![@BeryJu](https://avatars.githubusercontent.com/u/1932513?s=40&v=4)](/BeryJu)

`[security: fix CVE-2023-48228](/goauthentik/authentik/pull/7666/commits/cdb36b420a8520cad2377733e070a8756290758f "security: fix CVE-2023-48228

Signed-off-by: Jens Langhammer <jens@goauthentik.io>")`
 ‚Ä¶

`[cdb36b4](/goauthentik/authentik/pull/7666/commits/cdb36b420a8520cad2377733e070a8756290758f)`

```
Signed-off-by: Jens Langhammer <jens@goauthentik.io>
```

 [![@BeryJu](https://avatars.githubusercontent.com/u/1932513?s=40&u=935e6da8ed83fd57020599b716e1f17591a6d3c0&v=4)](/BeryJu)
[BeryJu](/BeryJu)
requested review from
a team
as [code owners](/goauthentik/authentik/blob/b7055c583842f69f46f31a53c6b2fbc1fba17905/CODEOWNERS#L26)
[November 21, 2023 17:00](#event-11027055512)

[![@netlify](https://avatars.githubusercontent.com/in/13473?s=80&v=4)](/apps/netlify)
[![Netlify](https://avatars.githubusercontent.com/in/13473?s=40&u=a8c6e35a15f833f7487d4a6abdbab66ce52041b0&v=4)](https://github.com/apps/netlify)

Copy link

### **[netlify](/apps/netlify) bot** commented [Nov 21, 2023](#issuecomment-1821313533) ‚Ä¢ edited Loading

|  |  |  |  |  |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| ‚úÖ Deploy Preview for *authentik-storybook* ready!  | Name | Link | | --- | --- | | üî® Latest commit | [cdb36b4](https://github.com/goauthentik/authentik/commit/cdb36b420a8520cad2377733e070a8756290758f) | | üîç Latest deploy log | <https://app.netlify.com/sites/authentik-storybook/deploys/655ce24d2c970900087aa555> | | üòé Deploy Preview | <https://deploy-preview-7666--authentik-storybook.netlify.app> | | üì± Preview on mobile | Toggle QR Code... [QR Code](https://camo.githubusercontent.com/cff90ab9b936a3cf63d873d36bef6838d7a5c8042e58f63fde2072070965205a/68747470733a2f2f6170702e6e65746c6966792e636f6d2f71722d636f64652f65794a30655841694f694a4b563151694c434a68624763694f694a49557a49314e694a392e65794a31636d77694f694a6f64485277637a6f764c32526c6347787665533177636d5632615756334c5463324e6a59744c5746316447686c626e52706179317a6447397965574a7662327375626d563062476c6d655335686348416966512e3150664f4b3178614e48706676496f6753506659586e74414356465438467a477250584a63654c6d534b49)*Use your smartphone camera to open QR code link.* |   ---   *To edit notification comments on pull requests, go to your [Netlify site configuration](https://app.netlify.com/sites/authentik-storybook/configuration/deploys#deploy-notifications).* |

All reactions

Sorry, something went wrong.

[![@BeryJu](https://avatars.githubusercontent.com/u/1932513?s=80&u=935e6da8ed83fd57020599b716e1f17591a6d3c0&v=4)](/BeryJu)

Copy link

Member

Author

### **[BeryJu](/BeryJu)** commented [Nov 21, 2023](#issuecomment-1821313702)

| /cherry-pick version-2023.10 |
| --- |

All reactions

Sorry, something went wrong.

[![@BeryJu](https://avatars.githubusercontent.com/u/1932513?s=80&u=935e6da8ed83fd57020599b716e1f17591a6d3c0&v=4)](/BeryJu)

Copy link

Member

Author

### **[BeryJu](/BeryJu)** commented [Nov 21, 2023](#issuecomment-1821313819)

| /cherry-pick version-2023.8 |
| --- |

All reactions

Sorry, something went wrong.

[![@netlify](https://avatars.githubusercontent.com/in/13473?s=80&v=4)](/apps/netlify)
[![Netlify](https://avatars.githubusercontent.com/in/13473?s=40&u=a8c6e35a15f833f7487d4a6abdbab66ce52041b0&v=4)](https://github.com/apps/netlify)

Copy link

### **[netlify](/apps/netlify) bot** commented [Nov 21, 2023](#issuecomment-1821316145) ‚Ä¢ edited Loading

|  |  |  |  |  |  |  |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| ‚úÖ Deploy Preview for *authentik* ready!  | Name | Link | | --- | --- | | üî® Latest commit | [cdb36b4](https://github.com/goauthentik/authentik/commit/cdb36b420a8520cad2377733e070a8756290758f) | | üîç Latest deploy log | <https://app.netlify.com/sites/authentik/deploys/655ce24d2c970900087aa551> | | üòé Deploy Preview | <https://deploy-preview-7666--authentik.netlify.app> | | üì± Preview on mobile | Toggle QR Code... [QR Code](https://camo.githubusercontent.com/c658054d101870275828d38411b09c5960107665d262037839429570b0030665/68747470733a2f2f6170702e6e65746c6966792e636f6d2f71722d636f64652f65794a30655841694f694a4b563151694c434a68624763694f694a49557a49314e694a392e65794a31636d77694f694a6f64485277637a6f764c32526c6347787665533177636d5632615756334c5463324e6a59744c5746316447686c626e5270617935755a58527361575a354c6d467763434a392e304855636262703745654d56797a4c3578384d6b395f5263554b3672504b715f563378464c3947516b2d63)*Use your smartphone camera to open QR code link.* | | [Lighthouse](https://camo.githubusercontent.com/a36ef52f7d003dab029310c75ff13031bb287d1ca4081f8edfc360253c8be2b3/68747470733a2f2f6170702e6e65746c6966792e636f6d2f7075626c69632f65787465726e616c2d75736167652f6769742d636f6d6d656e74732f6c69676874686f7573652d736d2e706e67)Lighthouse | 1 paths audited**Performance**: 95 (üî¥ down 1 from production)**Accessibility**: 90 (no change from production)**Best Practices**: 100 (no change from production)**SEO**: 80 (no change from production)**PWA**: -[View the detailed breakdown and full score reports](https://app.netlify.com/sites/authentik/deploys/655ce24d2c970900087aa551) |   ---   *To edit notification comments on pull requests, go to your [Netlify site configuration](https://app.netlify.com/sites/authentik/configuration/deploys#deploy-notifications).* |

All reactions

Sorry, something went wrong.

 Hide details
View details

[![@BeryJu](https://avatars.githubusercontent.com/u/1932513?s=40&u=935e6da8ed83fd57020599b716e1f17591a6d3c0&v=4)](/BeryJu)
[BeryJu](/BeryJu)
merged commit [`b88e394`](/goauthentik/authentik/commit/b88e39411c12e3f9e04125a7887f12354f760a14)
into
main

[Nov 21, 2023](https://github.com/goauthentik/authentik/pull/7666#event-11027138850)
56 of 60 checks passed

 [![@BeryJu](https://avatars.githubusercontent.com/u/1932513?s=40&u=935e6da8ed83fd57020599b716e1f17591a6d3c0&v=4)](/BeryJu)
[BeryJu](/BeryJu)
deleted the
security/CVE-2023-48228

branch
[November 21, 2023 17:10](#event-11027139350)

This was referenced Nov 21, 2023

[security: fix CVE-2023-48228 (cherry-pick #7666)
#7668](/goauthentik/authentik/pull/7668)
 Merged

[security: fix CVE-2023-48228 (cherry-pick #7666)
#7669](/goauthentik/authentik/pull/7669)
 Merged

[gcp-cherry-pick-bot](/apps/gcp-cherry-pick-bot) bot
pushed a commit
that referenced
this pull request
[Nov 21, 2023](#ref-commit-7a2110e)
[![@BeryJu](https://avatars.githubusercontent.com/u/1932513?s=40&u=935e6da8ed83fd57020599b716e1f17591a6d3c0&v=4)](/BeryJu)

`[security: fix CVE-2023-48228 (](/goauthentik/authentik/commit/7a2110e455a00a66eac860df2a37151952ea8fe2 "security: fix CVE-2023-48228 (#7666)

Signed-off-by: Jens Langhammer <jens@goauthentik.io>")[#7666](https://github.com/goauthentik/authentik/pull/7666)[)](/goauthentik/authentik/commit/7a2110e455a00a66eac860df2a37151952ea8fe2 "security: fix CVE-2023-48228 (#7666)

Signed-off-by: Jens Langhammer <jens@goauthentik.io>")`
‚Ä¶

`[7a2110e](/goauthentik/authentik/commit/7a2110e455a00a66eac860df2a37151952ea8fe2)`

```
Signed-off-by: Jens Langhammer <jens@goauthentik.io>
```

[gcp-cherry-pick-bot](/apps/gcp-cherry-pick-bot) bot
pushed a commit
that referenced
this pull request
[Nov 21, 2023](#ref-commit-8fe02b2)
[![@BeryJu](https://avatars.githubusercontent.com/u/1932513?s=40&u=935e6da8ed83fd57020599b716e1f17591a6d3c0&v=4)](/BeryJu)

`[security: fix CVE-2023-48228 (](/goauthentik/authentik/commit/8fe02b2aafb54aae12fb135d65eceeebc4dfc8e9 "security: fix CVE-2023-48228 (#7666)

Signed-off-by: Jens Langhammer <jens@goauthentik.io>")[#7666](https://github.com/goauthentik/authentik/pull/7666)[)](/goauthentik/authentik/commit/8fe02b2aafb54aae12fb135d65eceeebc4dfc8e9 "security: fix CVE-2023-48228 (#7666)

Signed-off-by: Jens Langhammer <jens@goauthentik.io>")`
‚Ä¶

`[8fe02b2](/goauthentik/authentik/commit/8fe02b2aafb54aae12fb135d65eceeebc4dfc8e9)`

```
Signed-off-by: Jens Langhammer <jens@goauthentik.io>
```

[kensternberg-authentik](/kensternberg-authentik)
added a commit
that referenced
this pull request
[Nov 21, 2023](#ref-commit-bf079e1)
[![@kensternberg-authentik](https://avatars.githubusercontent.com/u/133134217?s=40&u=7172ecc4e42a89bbdc9ff0ddaf2be0b1cc5e423b&v=4)](/kensternberg-authentik)

`[Merge branch 'main' into web/playground/the-big-context](/goauthentik/authentik/commit/bf079e1972551f49b5486fd4be12f7da885deac4 "Merge branch 'main' into web/playground/the-big-context

* main:
  website/docs: add CVE-2023-48228 to release notes
  security: fix CVE-2023-48228 (#7666)
  website/docs: prepare 2023.10.4 release notes (#7641)
  web/admin: fix admins not able to delete MFA devices (#7660)
  web/flows: use aria-invalid attribute to better show invalid input fields (#7661)
  web: bump the esbuild group in /web with 2 updates (#7650)
  web: bump the eslint group in /tests/wdio with 2 updates (#7654)
  website: bump @types/react from 18.2.37 to 18.2.38 in /website (#7645)
  web: bump the sentry group in /web with 2 updates (#7647)
  web: bump the eslint group in /web with 2 updates (#7649)
  web: bump @types/codemirror from 5.60.13 to 5.60.14 in /web (#7651)
  web: bump typescript from 5.2.2 to 5.3.2 in /tests/wdio (#7656)
  web: bump the babel group in /web with 2 updates (#7648)
  core: bump django-filter from 23.3 to 23.4 (#7646)
  website: bump typescript from 5.2.2 to 5.3.2 in /website (#7644)
  web: bump @types/chart.js from 2.9.40 to 2.9.41 in /web (#7652)
  web: bump typescript from 5.2.2 to 5.3.2 in /web (#7653)
  web: bump the wdio group in /tests/wdio with 2 updates (#7655)
  web: bump wdio-wait-for from 3.0.8 to 3.0.9 in /tests/wdio (#7657)")`
‚Ä¶

`[bf079e1](/goauthentik/authentik/commit/bf079e1972551f49b5486fd4be12f7da885deac4)`

```
* main:
  website/docs: add CVE-2023-48228 to release notes
  security: fix CVE-2023-48228 ([#7666](https://github.com/goauthentik/authentik/pull/7666))
  website/docs: prepare 2023.10.4 release notes ([#7641](https://github.com/goauthentik/authentik/pull/7641))
  web/admin: fix admins not able to delete MFA devices ([#7660](https://github.com/goauthentik/authentik/pull/7660))
  web/flows: use aria-invalid attribute to better show invalid input fields ([#7661](https://github.com/goauthentik/authentik/pull/7661))
  web: bump the esbuild group in /web with 2 updates ([#7650](https://github.com/goauthentik/authentik/pull/7650))
  web: bump the eslint group in /tests/wdio with 2 updates ([#7654](https://github.com/goauthentik/authentik/pull/7654))
  website: bump @types/react from 18.2.37 to 18.2.38 in /website ([#7645](https://github.com/goauthentik/authentik/pull/7645))
  web: bump the sentry group in /web with 2 updates ([#7647](https://github.com/goauthentik/authentik/pull/7647))
  web: bump the eslint group in /web with 2 updates ([#7649](https://github.com/goauthentik/authentik/pull/7649))
  web: bump @types/codemirror from 5.60.13 to 5.60.14 in /web ([#7651](https://github.com/goauthentik/authentik/pull/7651))
  web: bump typescript from 5.2.2 to 5.3.2 in /tests/wdio ([#7656](https://github.com/goauthentik/authentik/pull/7656))
  web: bump the babel group in /web with 2 updates ([#7648](https://github.com/goauthentik/authentik/pull/7648))
  core: bump django-filter from 23.3 to 23.4 ([#7646](https://github.com/goauthentik/authentik/pull/7646))
  website: bump typescript from 5.2.2 to 5.3.2 in /website ([#7644](https://github.com/goauthentik/authentik/pull/7644))
  web: bump @types/chart.js from 2.9.40 to 2.9.41 in /web ([#7652](https://github.com/goauthentik/authentik/pull/7652))
  web: bump typescript from 5.2.2 to 5.3.2 in /web ([#7653](https://github.com/goauthentik/authentik/pull/7653))
  web: bump the wdio group in /tests/wdio with 2 updates ([#7655](https://github.com/goauthentik/authentik/pull/7655))
  web: bump wdio-wait-for from 3.0.8 to 3.0.9 in /tests/wdio ([#7657](https://github.com/goauthentik/authentik/pull/7657))
```

[kensternberg-authentik](/kensternberg-authentik)
added a commit
that referenced
this pull request
[Nov 21, 2023](#ref-commit-5d19819)
[![@kensternberg-authentik](https://avatars.githubusercontent.com/u/133134217?s=40&u=7172ecc4e42a89bbdc9ff0ddaf2be0b1cc5e423b&v=4)](/kensternberg-authentik)

`[Merge branch 'main' into dev](/goauthentik/authentik/commit/5d19819d1caddef9d5f689bf54e160d5a2a61b44 "Merge branch 'main' into dev

* main:
  website/docs: add CVE-2023-48228 to release notes
  security: fix CVE-2023-48228 (#7666)
  website/docs: prepare 2023.10.4 release notes (#7641)
  web/admin: fix admins not able to delete MFA devices (#7660)
  web/flows: use aria-invalid attribute to better show invalid input fields (#7661)
  web: bump the esbuild group in /web with 2 updates (#7650)
  web: bump the eslint group in /tests/wdio with 2 updates (#7654)
  website: bump @types/react from 18.2.37 to 18.2.38 in /website (#7645)
  web: bump the sentry group in /web with 2 updates (#7647)
  web: bump the eslint group in /web with 2 updates (#7649)
  web: bump @types/codemirror from 5.60.13 to 5.60.14 in /web (#7651)
  web: bump typescript from 5.2.2 to 5.3.2 in /tests/wdio (#7656)
  web: bump the babel group in /web with 2 updates (#7648)
  core: bump django-filter from 23.3 to 23.4 (#7646)
  website: bump typescript from 5.2.2 to 5.3.2 in /website (#7644)
  web: bump @types/chart.js from 2.9.40 to 2.9.41 in /web (#7652)
  web: bump typescript from 5.2.2 to 5.3.2 in /web (#7653)
  web: bump the wdio group in /tests/wdio with 2 updates (#7655)
  web: bump wdio-wait-for from 3.0.8 to 3.0.9 in /tests/wdio (#7657)")`
‚Ä¶

`[5d19819](/goauthentik/authentik/commit/5d19819d1caddef9d5f689bf54e160d5a2a61b44)`

```
* main:
  website/docs: add CVE-2023-48228 to release notes
  security: fix CVE-2023-48228 ([#7666](https://github.com/goauthentik/authentik/pull/7666))
  website/docs: prepare 2023.10.4 release notes ([#7641](https://github.com/goauthentik/authentik/pull/7641))
  web/admin: fix admins not able to delete MFA devices ([#7660](https://github.com/goauthentik/authentik/pull/7660))
  web/flows: use aria-invalid attribute to better show invalid input fields ([#7661](https://github.com/goauthentik/authentik/pull/7661))
  web: bump the esbuild group in /web with 2 updates ([#7650](https://github.com/goauthentik/authentik/pull/7650))
  web: bump the eslint group in /tests/wdio with 2 updates ([#7654](https://github.com/goauthentik/authentik/pull/7654))
  website: bump @types/react from 18.2.37 to 18.2.38 in /website ([#7645](https://github.com/goauthentik/authentik/pull/7645))
  web: bump the sentry group in /web with 2 updates ([#7647](https://github.com/goauthentik/authentik/pull/7647))
  web: bump the eslint group in /web with 2 updates ([#7649](https://github.com/goauthentik/authentik/pull/7649))
  web: bump @types/codemirror from 5.60.13 to 5.60.14 in /web ([#7651](https://github.com/goauthentik/authentik/pull/7651))
  web: bump typescript from 5.2.2 to 5.3.2 in /tests/wdio ([#7656](https://github.com/goauthentik/authentik/pull/7656))
  web: bump the babel group in /web with 2 updates ([#7648](https://github.com/goauthentik/authentik/pull/7648))
  core: bump django-filter from 23.3 to 23.4 ([#7646](https://github.com/goauthentik/authentik/pull/7646))
  website: bump typescript from 5.2.2 to 5.3.2 in /website ([#7644](https://github.com/goauthentik/authentik/pull/7644))
  web: bump @types/chart.js from 2.9.40 to 2.9.41 in /web ([#7652](https://github.com/goauthentik/authentik/pull/7652))
  web: bump typescript from 5.2.2 to 5.3.2 in /web ([#7653](https://github.com/goauthentik/authentik/pull/7653))
  web: bump the wdio group in /tests/wdio with 2 updates ([#7655](https://github.com/goauthentik/authentik/pull/7655))
  web: bump wdio-wait-for from 3.0.8 to 3.0.9 in /tests/wdio ([#7657](https://github.com/goauthentik/authentik/pull/7657))
```

[globin](/globin)
pushed a commit
to mayflower/authentik
that referenced
this pull request
[Nov 22, 2023](#ref-commit-6b9afed)
[![@gcp-cherry-pick-bot](https://avatars.githubusercontent.com/in/169664?s=40&v=4)](/apps/gcp-cherry-pick-bot) [![@BeryJu](https://avatars.githubusercontent.com/u/1932513?s=40&u=935e6da8ed83fd57020599b716e1f17591a6d3c0&v=4)](/BeryJu)

`[security: fix CVE-2023-48228 (cherry-pick](/mayflower/authentik/commit/6b9afed21f7c39f171a4a445654cfe415bba37d5 "security: fix CVE-2023-48228 (cherry-pick #7666) (#7668)

security: fix CVE-2023-48228 (#7666)

Signed-off-by: Jens Langhammer <jens@goauthentik.io>
Co-authored-by: Jens L <jens@goauthentik.io>") [goauthentik#7666](https://github.com/goauthentik/authentik/pull/7666)[) (](/mayflower/authentik/commit/6b9afed21f7c39f171a4a445654cfe415bba37d5 "security: fix CVE-2023-48228 (cherry-pick #7666) (#7668)

security: fix CVE-2023-48228 (#7666)

Signed-off-by: Jens Langhammer <jens@goauthentik.io>
Co-authored-by: Jens L <jens@goauthentik.io>")[goauthen‚Ä¶](https://github.com/goauthentik/authentik/pull/7668)`
‚Ä¶

`[6b9afed](/mayflower/authentik/commit/6b9afed21f7c39f171a4a445654cfe415bba37d5)`

```
[‚Ä¶tik#7668](https://github.com/goauthentik/authentik/pull/7668))

security: fix CVE-2023-48228 ([goauthentik#7666](https://github.com/goauthentik/authentik/pull/7666))

Signed-off-by: Jens Langhammer <jens@goauthentik.io>
Co-authored-by: Jens L <jens@goauthentik.io>
```

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoauthentik%2Fauthentik%2Fpull%2F7666)

Reviewers

No reviews

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

1 participant

[![@BeryJu](https://avatars.githubusercontent.com/u/1932513?s=52&v=4)](/BeryJu)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_08879c19_20250114_190517.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoauthentik%2Fauthentik%2Fcommit%2Fb88e39411c12e3f9e04125a7887f12354f760a14)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoauthentik%2Fauthentik%2Fcommit%2Fb88e39411c12e3f9e04125a7887f12354f760a14)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=goauthentik%2Fauthentik)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[goauthentik](/goauthentik)
/
**[authentik](/goauthentik/authentik)**
Public

* [Notifications](/login?return_to=%2Fgoauthentik%2Fauthentik) You must be signed in to change notification settings
* [Fork
  984](/login?return_to=%2Fgoauthentik%2Fauthentik)
* [Star
   14.5k](/login?return_to=%2Fgoauthentik%2Fauthentik)

* [Code](/goauthentik/authentik)
* [Issues
  614](/goauthentik/authentik/issues)
* [Pull requests
  114](/goauthentik/authentik/pulls)
* [Discussions](/goauthentik/authentik/discussions)
* [Actions](/goauthentik/authentik/actions)
* [Security](/goauthentik/authentik/security)
* [Insights](/goauthentik/authentik/pulse)

Additional navigation options

* [Code](/goauthentik/authentik)
* [Issues](/goauthentik/authentik/issues)
* [Pull requests](/goauthentik/authentik/pulls)
* [Discussions](/goauthentik/authentik/discussions)
* [Actions](/goauthentik/authentik/actions)
* [Security](/goauthentik/authentik/security)
* [Insights](/goauthentik/authentik/pulse)

## Commit

[Permalink](/goauthentik/authentik/commit/b88e39411c12e3f9e04125a7887f12354f760a14)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

security: fix CVE-2023-48228 ([#7666](https://github.com/goauthentik/authentik/pull/7666))

[Browse files](/goauthentik/authentik/tree/b88e39411c12e3f9e04125a7887f12354f760a14)
Browse the repository at this point in the history

```
Signed-off-by: Jens Langhammer <jens@goauthentik.io>
```

* Loading branch information

[![@BeryJu](https://avatars.githubusercontent.com/u/1932513?s=40&v=4)](/BeryJu)

[BeryJu](/goauthentik/authentik/commits?author=BeryJu "View all commits by BeryJu")
authored
Nov 21, 2023

1 parent
[6a43721](/goauthentik/authentik/commit/6a437215245c80dc8fe1445876c7deaeaaf1c1e5)

commit b88e394

 Show file tree

 Hide file tree

Showing
**4 changed files**
with
**253 additions**
and
**1 deletion**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* authentik/providers/oauth2

  + tests

    - authentik/providers/oauth2/tests/test\_token\_pkce.py
      [test\_token\_pkce.py](#diff-c03534356f3bf7a63ea9643bd138218f8f212c98b8bd030ba92ad4e292d3c738)
  + views

    - authentik/providers/oauth2/views/token.py
      [token.py](#diff-cfa6353328ef6a4968d1a52e936b3d57f8293aad3aca5c0384ad9511be1a40ec)
* website

  + docs/security

    - website/docs/security/CVE-2023-48228.md
      [CVE-2023-48228.md](#diff-38a68bbd99d4a929fc53d23f7b7b1b82d054a4c827f88d6b573857a9413b347f)
  + website/sidebars.js
    [sidebars.js](#diff-4caaf3187919c98f42856c140e32964b0829fc19165f3c989a6cd4ea088a7164)

## There are no files selected for viewing

187 changes: 187 additions & 0 deletions

187
[authentik/providers/oauth2/tests/test\_token\_pkce.py](#diff-c03534356f3bf7a63ea9643bd138218f8f212c98b8bd030ba92ad4e292d3c738 "authentik/providers/oauth2/tests/test_token_pkce.py")

Show comments

[View file](/goauthentik/authentik/blob/b88e39411c12e3f9e04125a7887f12354f760a14/authentik/providers/oauth2/tests/test_token_pkce.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,187 @@ |
|  |  | """Test token view""" |
|  |  | from base64 import b64encode, urlsafe\_b64encode |
|  |  | from hashlib import sha256 |
|  |  |  |
|  |  | from django.test import RequestFactory |
|  |  | from django.urls import reverse |
|  |  |  |
|  |  | from authentik.core.models import Application |
|  |  | from authentik.core.tests.utils import create\_test\_admin\_user, create\_test\_flow |
|  |  | from authentik.flows.challenge import ChallengeTypes |
|  |  | from authentik.lib.generators import generate\_id |
|  |  | from authentik.providers.oauth2.constants import GRANT\_TYPE\_AUTHORIZATION\_CODE |
|  |  | from authentik.providers.oauth2.models import AuthorizationCode, OAuth2Provider |
|  |  | from authentik.providers.oauth2.tests.utils import OAuthTestCase |
|  |  |  |
|  |  |  |
|  |  | class TestTokenPKCE(OAuthTestCase): |
|  |  | """Test token view""" |
|  |  |  |
|  |  | def setUp(self) -> None: |
|  |  | super().setUp() |
|  |  | self.factory = RequestFactory() |
|  |  | self.app = Application.objects.create(name=generate\_id(), slug="test") |
|  |  |  |
|  |  | def test\_pkce\_missing\_in\_token(self): |
|  |  | """Test full with pkce""" |
|  |  | flow = create\_test\_flow() |
|  |  | provider = OAuth2Provider.objects.create( |
|  |  | name=generate\_id(), |
|  |  | client\_id="test", |
|  |  | authorization\_flow=flow, |
|  |  | redirect\_uris="foo://localhost", |
|  |  | access\_code\_validity="seconds=100", |
|  |  | ) |
|  |  | Application.objects.create(name="app", slug="app", provider=provider) |
|  |  | state = generate\_id() |
|  |  | user = create\_test\_admin\_user() |
|  |  | self.client.force\_login(user) |
|  |  | challenge = generate\_id() |
|  |  | header = b64encode(f"{provider.client\_id}:{provider.client\_secret}".encode()).decode() |
|  |  | # Step 1, initiate params and get redirect to flow |
|  |  | self.client.get( |
|  |  | reverse("authentik\_providers\_oauth2:authorize"), |
|  |  | data={ |
|  |  | "response\_type": "code", |
|  |  | "client\_id": "test", |
|  |  | "state": state, |
|  |  | "redirect\_uri": "foo://localhost", |
|  |  | "code\_challenge": challenge, |
|  |  | "code\_challenge\_method": "S256", |
|  |  | }, |
|  |  | ) |
|  |  | response = self.client.get( |
|  |  | reverse("authentik\_api:flow-executor", kwargs={"flow\_slug": flow.slug}), |
|  |  | ) |
|  |  | code: AuthorizationCode = AuthorizationCode.objects.filter(user=user).first() |
|  |  | self.assertJSONEqual( |
|  |  | response.content.decode(), |
|  |  | { |
|  |  | "component": "xak-flow-redirect", |
|  |  | "type": ChallengeTypes.REDIRECT.value, |
|  |  | "to": f"foo://localhost?code={code.code}&state={state}", |
|  |  | }, |
|  |  | ) |
|  |  | response = self.client.post( |
|  |  | reverse("authentik\_providers\_oauth2:token"), |
|  |  | data={ |
|  |  | "grant\_type": GRANT\_TYPE\_AUTHORIZATION\_CODE, |
|  |  | "code": code.code, |
|  |  | # Missing the code\_verifier here |
|  |  | "redirect\_uri": "foo://localhost", |
|  |  | }, |
|  |  | HTTP\_AUTHORIZATION=f"Basic {header}", |
|  |  | ) |
|  |  | self.assertJSONEqual( |
|  |  | response.content, |
|  |  | {"error": "invalid\_request", "error\_description": "The request is otherwise malformed"}, |
|  |  | ) |
|  |  | self.assertEqual(response.status\_code, 400) |
|  |  |  |
|  |  | def test\_pkce\_correct\_s256(self): |
|  |  | """Test full with pkce""" |
|  |  | flow = create\_test\_flow() |
|  |  | provider = OAuth2Provider.objects.create( |
|  |  | name=generate\_id(), |
|  |  | client\_id="test", |
|  |  | authorization\_flow=flow, |
|  |  | redirect\_uris="foo://localhost", |
|  |  | access\_code\_validity="seconds=100", |
|  |  | ) |
|  |  | Application.objects.create(name="app", slug="app", provider=provider) |
|  |  | state = generate\_id() |
|  |  | user = create\_test\_admin\_user() |
|  |  | self.client.force\_login(user) |
|  |  | verifier = generate\_id() |
|  |  | challenge = ( |
|  |  | urlsafe\_b64encode(sha256(verifier.encode("ascii")).digest()) |
|  |  | .decode("utf-8") |
|  |  | .replace("=", "") |
|  |  | ) |
|  |  | header = b64encode(f"{provider.client\_id}:{provider.client\_secret}".encode()).decode() |
|  |  | # Step 1, initiate params and get redirect to flow |
|  |  | self.client.get( |
|  |  | reverse("authentik\_providers\_oauth2:authorize"), |
|  |  | data={ |
|  |  | "response\_type": "code", |
|  |  | "client\_id": "test", |
|  |  | "state": state, |
|  |  | "redirect\_uri": "foo://localhost", |
|  |  | "code\_challenge": challenge, |
|  |  | "code\_challenge\_method": "S256", |
|  |  | }, |
|  |  | ) |
|  |  | response = self.client.get( |
|  |  | reverse("authentik\_api:flow-executor", kwargs={"flow\_slug": flow.slug}), |
|  |  | ) |
|  |  | code: AuthorizationCode = AuthorizationCode.objects.filter(user=user).first() |
|  |  | self.assertJSONEqual( |
|  |  | response.content.decode(), |
|  |  | { |
|  |  | "component": "xak-flow-redirect", |
|  |  | "type": ChallengeTypes.REDIRECT.value, |
|  |  | "to": f"foo://localhost?code={code.code}&state={state}", |
|  |  | }, |
|  |  | ) |
|  |  | response = self.client.post( |
|  |  | reverse("authentik\_providers\_oauth2:token"), |
|  |  | data={ |
|  |  | "grant\_type": GRANT\_TYPE\_AUTHORIZATION\_CODE, |
|  |  | "code": code.code, |
|  |  | "code\_verifier": verifier, |
|  |  | "redirect\_uri": "foo://localhost", |
|  |  | }, |
|  |  | HTTP\_AUTHORIZATION=f"Basic {header}", |
|  |  | ) |
|  |  | self.assertEqual(response.status\_code, 200) |
|  |  |  |
|  |  | def test\_pkce\_correct\_plain(self): |
|  |  | """Test full with pkce""" |
|  |  | flow = create\_test\_flow() |
|  |  | provider = OAuth2Provider.objects.create( |
|  |  | name=generate\_id(), |
|  |  | client\_id="test", |
|  |  | authorization\_flow=flow, |
|  |  | redirect\_uris="foo://localhost", |
|  |  | access\_code\_validity="seconds=100", |
|  |  | ) |
|  |  | Application.objects.create(name="app", slug="app", provider=provider) |
|  |  | state = generate\_id() |
|  |  | user = create\_test\_admin\_user() |
|  |  | self.client.force\_login(user) |
|  |  | verifier = generate\_id() |
|  |  | header = b64encode(f"{provider.client\_id}:{provider.client\_secret}".encode()).decode() |
|  |  | # Step 1, initiate params and get redirect to flow |
|  |  | self.client.get( |
|  |  | reverse("authentik\_providers\_oauth2:authorize"), |
|  |  | data={ |
|  |  | "response\_type": "code", |
|  |  | "client\_id": "test", |
|  |  | "state": state, |
|  |  | "redirect\_uri": "foo://localhost", |
|  |  | "code\_challenge": verifier, |
|  |  | }, |
|  |  | ) |
|  |  | response = self.client.get( |
|  |  | reverse("authentik\_api:flow-executor", kwargs={"flow\_slug": flow.slug}), |
|  |  | ) |
|  |  | code: AuthorizationCode = AuthorizationCode.objects.filter(user=user).first() |
|  |  | self.assertJSONEqual( |
|  |  | response.content.decode(), |
|  |  | { |
|  |  | "component": "xak-flow-redirect", |
|  |  | "type": ChallengeTypes.REDIRECT.value, |
|  |  | "to": f"foo://localhost?code={code.code}&state={state}", |
|  |  | }, |
|  |  | ) |
|  |  | response = self.client.post( |
|  |  | reverse("authentik\_providers\_oauth2:token"), |
|  |  | data={ |
|  |  | "grant\_type": GRANT\_TYPE\_AUTHORIZATION\_CODE, |
|  |  | "code": code.code, |
|  |  | "code\_verifier": verifier, |
|  |  | "redirect\_uri": "foo://localhost", |
|  |  | }, |
|  |  | HTTP\_AUTHORIZATION=f"Basic {header}", |
|  |  | ) |
|  |  | self.assertEqual(response.status\_code, 200) |

5 changes: 4 additions & 1 deletion

5
[authentik/providers/oauth2/views/token.py](#diff-cfa6353328ef6a4968d1a52e936b3d57f8293aad3aca5c0384ad9511be1a40ec "authentik/providers/oauth2/views/token.py")

Show comments

[View file](/goauthentik/authentik/blob/b88e39411c12e3f9e04125a7887f12354f760a14/authentik/providers/oauth2/views/token.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -222,7 +222,10 @@ def \_\_post\_init\_code(self, raw\_code: str, request: HttpRequest): |
|  |  | raise TokenError("invalid\_grant") |
|  |  |  |
|  |  | # Validate PKCE parameters. |
|  |  | if self.code\_verifier: |
|  |  | if self.authorization\_code.code\_challenge: |
|  |  | # Authorization code had PKCE but we didn't get one |
|  |  | if not self.code\_verifier: |
|  |  | raise TokenError("invalid\_request") |
|  |  | if self.authorization\_code.code\_challenge\_method == PKCE\_METHOD\_S256: |
|  |  | new\_code\_challenge = ( |
|  |  | urlsafe\_b64encode(sha256(self.code\_verifier.encode("ascii")).digest()) |
| Expand Down | |  |

61 changes: 61 additions & 0 deletions

61
[website/docs/security/CVE-2023-48228.md](#diff-38a68bbd99d4a929fc53d23f7b7b1b82d054a4c827f88d6b573857a9413b347f "website/docs/security/CVE-2023-48228.md")

Show comments

[View file](/goauthentik/authentik/blob/b88e39411c12e3f9e04125a7887f12354f760a14/website/docs/security/CVE-2023-48228.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1,61 @@ |
|  |  | # CVE-2023-48228 |
|  |  |  |
|  |  | \_Reported by [@Sapd](https://github.com/Sapd)\_ |
|  |  |  |
|  |  | ## OAuth2: Insufficient PKCE check |
|  |  |  |
|  |  | ### Summary |
|  |  |  |
|  |  | When initialising a OAuth2 flow with a `code\_challenge` and `code\_method` (thus requesting PKCE), the SSO provider (authentik) \*\*must\*\* check if there is a matching \*\*and\*\* existing `code\_verifier` during the token step. |
|  |  |  |
|  |  | authentik checks if the contents of code\*verifier is matching \\*\\*\\_ONLY\*\\*\\* when it is provided. When it is left out completely, authentik simply accepts the token request with out it; even when the flow was started with a `code\_challenge`. |
|  |  |  |
|  |  | ### Patches |
|  |  |  |
|  |  | authentik 2023.8.5 and 2023.10.4 fix this issue. |
|  |  |  |
|  |  | ### Details |
|  |  |  |
|  |  | The `code\_verifier` is only checked when the user provides it. Note that in line 209 there is a check if the code\_parameter is left out. But there is no check if the PKCE parameter simply was omitted WHEN the request was started with a `code\_challenge\_method`. |
|  |  |  |
|  |  | This oversight likely did not stem from a coding error but from a misinterpretation of the RFC, where the backward compatibility section may be somewhat confusing. |
|  |  | https://datatracker.ietf.org/doc/html/rfc7636#section-4.5 |
|  |  | RFC7636 explicitly says in Section 4.5: |
|  |  |  |
|  |  | > The "code\_challenge\_method" is bound to the Authorization Code when |
|  |  | > the Authorization Code is issued. That is the method that the token |
|  |  | > endpoint MUST use to verify the "code\_verifier". |
|  |  |  |
|  |  | Section 5, Compatibility |
|  |  |  |
|  |  | > Server implementations of this specification MAY accept OAuth2.0 |
|  |  | > clients that do not implement this extension. If the "code\_verifier" |
|  |  | > is not received from the client in the Authorization Request, servers |
|  |  | > supporting backwards compatibility revert to the OAuth 2.0 [[RFC6749](https://datatracker.ietf.org/doc/html/rfc6749)] |
|  |  | > protocol without this extension. |
|  |  |  |
|  |  | Section 5, Compatibility, allows server implementations of this specification to accept OAuth 2.0 clients that do not implement this extension. However, if a `code\_verifier` is not received from the client in the Authorization Request, servers that support backward compatibility should revert to the standard OAuth 2.0 protocol sans this extension (including all steps). |
|  |  |  |
|  |  | It should be noted that this does not mean that the `code\_verifier` check can be disregarded at any point if the initial request included `code\_challenge` or `code\_challenge\_method`. Since Authentik supports PKCE, it \*\*MUST\*\* verify the code\_verifier as described in Section 4.5 \*\*AND\*\* fail if it was not provided. |
|  |  |  |
|  |  | Ofc verification can be skipped if the original authorization request did not invoke PKCE (no `code\_challenge\_method` and no `code\_challenge`). |
|  |  |  |
|  |  | Failure to check the `code\_verifier` renders the PKCE flow ineffective. This vulnerability particularly endangers public or hybrid clients, as their `code` is deemed non-confidential. |
|  |  |  |
|  |  | While not explicitly stated in the standard, it is generally recommended that OAuth2 flows accepting public clients should enforce PKCE - at least when redirecting to a non HTTPS URL (like http or an app link). |
|  |  |  |
|  |  | ### Impact |
|  |  |  |
|  |  | The vulnerability poses a high risk to both public and hybrid clients. |
|  |  | When for example a mobile app implements oauth2, a malicious app can simply also register the same in-app-link (e.g. `mycoolapp://oauth2`) for the redirect callback URL, possibly receiving `code` during callback. With PKCE working, a malicious app would still receive a `code` but the `code` would not work without the correct unhashed code-challenge. |
|  |  | This is especially problematic, because authentik claims to support PKCE, and a developer can expect that the proper checks are in place. Note that app-links cannot be protected by HTTPS or similar mechanisms. |
|  |  |  |
|  |  | Note also that this vulnerability poses a threat to confidential clients. Many confidential clients act as a proxy for OAuth2 API requests, typically from mobile apps or single-page applications. These proxies relay `code\_challenge`, `code\_challenge\_method` (in auth request, which most libraries force and provide on default settings) and `code\_verifier` in the token request unchanged and supplement the CLIENT\_SECRET which only the relay knows. The relay can but does not have to check for an existing `code\_verifier` as the standard does not define that PKCE can be ignored on confidential clients during the token request when the client requested PKCE during the authorization request. |
|  |  |  |
|  |  | An attacker could potentially gain full access to the application. If the code grants access to an admin account, the confidentiality, integrity, and availability of that application are compromised. |
|  |  |  |
|  |  | ### For more information |
|  |  |  |
|  |  | If you have any questions or comments about this advisory: |
|  |  |  |
|  |  | - Email us at [security@goauthentik.io](mailto:security@goauthentik.io) |

1 change: 1 addition & 0 deletions

1
[website/sidebars.js](#diff-4caaf3187919c98f42856c140e32964b0829fc19165f3c989a6cd4ea088a7164 "website/sidebars.js")

Show comments

[View file](/goauthentik/authentik/blob/b88e39411c12e3f9e04125a7887f12354f760a14/website/sidebars.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -407,6 +407,7 @@ const docsSidebar = { |
|  |  | }, |
|  |  | items: [ |
|  |  | "security/policy", |
|  |  | "security/CVE-2023-48228", |
|  |  | "security/GHSA-rjvp-29xq-f62w", |
|  |  | "security/CVE-2023-39522", |
|  |  | "security/CVE-2023-36456", |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `b88e394`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoauthentik%2Fauthentik%2Fcommit%2Fb88e39411c12e3f9e04125a7887f12354f760a14) to comment.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_2f34ffb2_20250115_113812.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoauthentik%2Fauthentik%2Fpull%2F7668)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoauthentik%2Fauthentik%2Fpull%2F7668)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=goauthentik%2Fauthentik)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[goauthentik](/goauthentik)
/
**[authentik](/goauthentik/authentik)**
Public

* [Notifications](/login?return_to=%2Fgoauthentik%2Fauthentik) You must be signed in to change notification settings
* [Fork
  986](/login?return_to=%2Fgoauthentik%2Fauthentik)
* [Star
   14.5k](/login?return_to=%2Fgoauthentik%2Fauthentik)

* [Code](/goauthentik/authentik)
* [Issues
  614](/goauthentik/authentik/issues)
* [Pull requests
  116](/goauthentik/authentik/pulls)
* [Discussions](/goauthentik/authentik/discussions)
* [Actions](/goauthentik/authentik/actions)
* [Security](/goauthentik/authentik/security)
* [Insights](/goauthentik/authentik/pulse)

Additional navigation options

* [Code](/goauthentik/authentik)
* [Issues](/goauthentik/authentik/issues)
* [Pull requests](/goauthentik/authentik/pulls)
* [Discussions](/goauthentik/authentik/discussions)
* [Actions](/goauthentik/authentik/actions)
* [Security](/goauthentik/authentik/security)
* [Insights](/goauthentik/authentik/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fgoauthentik%2Fauthentik%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fgoauthentik%2Fauthentik%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# security: fix CVE-2023-48228 (cherry-pick #7666) #7668

 Merged

[BeryJu](/BeryJu)
merged 1 commit into
[version-2023.10](/goauthentik/authentik/tree/version-2023.10 "goauthentik/authentik:version-2023.10")
from
[cherry-pick-1f6da3-version-2023.10](/goauthentik/authentik/tree/cherry-pick-1f6da3-version-2023.10 "goauthentik/authentik:cherry-pick-1f6da3-version-2023.10")

Nov 21, 2023

 Merged

# [security: fix CVE-2023-48228 (cherry-pick #7666)](#top) #7668

[BeryJu](/BeryJu)
merged 1 commit into
[version-2023.10](/goauthentik/authentik/tree/version-2023.10 "goauthentik/authentik:version-2023.10")
from
[cherry-pick-1f6da3-version-2023.10](/goauthentik/authentik/tree/cherry-pick-1f6da3-version-2023.10 "goauthentik/authentik:cherry-pick-1f6da3-version-2023.10")

Nov 21, 2023

[Conversation
1](/goauthentik/authentik/pull/7668)
[Commits
1](/goauthentik/authentik/pull/7668/commits)
[Checks
60](/goauthentik/authentik/pull/7668/checks)
[Files changed](/goauthentik/authentik/pull/7668/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![gcp-cherry-pick-bot[bot]](https://avatars.githubusercontent.com/in/169664?s=60&v=4)](/apps/gcp-cherry-pick-bot)

Copy link

Contributor

### @gcp-cherry-pick-bot **[gcp-cherry-pick-bot](/apps/gcp-cherry-pick-bot) bot** commented [Nov 21, 2023](#issue-2004773140)

Cherry-picked security: fix CVE-2023-48228 ([#7666](https://github.com/goauthentik/authentik/pull/7666))

Signed-off-by: Jens Langhammer jens@goauthentik.io

Sorry, something went wrong.

All reactions

[![@BeryJu](https://avatars.githubusercontent.com/u/1932513?s=40&v=4)](/BeryJu)

`[security: fix CVE-2023-48228 (](/goauthentik/authentik/pull/7668/commits/7a2110e455a00a66eac860df2a37151952ea8fe2 "security: fix CVE-2023-48228 (#7666)

Signed-off-by: Jens Langhammer <jens@goauthentik.io>")[#7666](https://github.com/goauthentik/authentik/pull/7666)[)](/goauthentik/authentik/pull/7668/commits/7a2110e455a00a66eac860df2a37151952ea8fe2 "security: fix CVE-2023-48228 (#7666)

Signed-off-by: Jens Langhammer <jens@goauthentik.io>")`
 ‚Ä¶

`[7a2110e](/goauthentik/authentik/pull/7668/commits/7a2110e455a00a66eac860df2a37151952ea8fe2)`

```
Signed-off-by: Jens Langhammer <jens@goauthentik.io>
```

 [![@gcp-cherry-pick-bot](https://avatars.githubusercontent.com/in/169664?s=40&v=4)](/apps/gcp-cherry-pick-bot)
[gcp-cherry-pick-bot](/apps/gcp-cherry-pick-bot)
bot
requested review from
a team
as [code owners](/goauthentik/authentik/blob/1eb1f4e0b89711b125d6891dc40d39d7178afd94/CODEOWNERS#L26)
[November 21, 2023 17:10](#event-11027144295)

 Hide details
View details

[![@BeryJu](https://avatars.githubusercontent.com/u/1932513?s=40&u=935e6da8ed83fd57020599b716e1f17591a6d3c0&v=4)](/BeryJu)
[BeryJu](/BeryJu)
merged commit [`6b9afed`](/goauthentik/authentik/commit/6b9afed21f7c39f171a4a445654cfe415bba37d5)
into
version-2023.10

[Nov 21, 2023](https://github.com/goauthentik/authentik/pull/7668#event-11027183175)
27 of 43 checks passed

 [![@BeryJu](https://avatars.githubusercontent.com/u/1932513?s=40&u=935e6da8ed83fd57020599b716e1f17591a6d3c0&v=4)](/BeryJu)
[BeryJu](/BeryJu)
deleted the
cherry-pick-1f6da3-version-2023.10

branch
[November 21, 2023 17:13](#event-11027183343)

[![@netlify](https://avatars.githubusercontent.com/in/13473?s=80&v=4)](/apps/netlify)
[![Netlify](https://avatars.githubusercontent.com/in/13473?s=40&u=a8c6e35a15f833f7487d4a6abdbab66ce52041b0&v=4)](https://github.com/apps/netlify)

Copy link

### **[netlify](/apps/netlify) bot** commented [Nov 21, 2023](#issuecomment-1821339999) ‚Ä¢ edited Loading

|  |  |  |  |  |  |  |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| ‚úÖ Deploy Preview for *authentik* ready!  | Name | Link | | --- | --- | | üî® Latest commit | [7a2110e](https://github.com/goauthentik/authentik/commit/7a2110e455a00a66eac860df2a37151952ea8fe2) | | üîç Latest deploy log | <https://app.netlify.com/sites/authentik/deploys/655ce4ac313a1400087124db> | | üòé Deploy Preview | <https://deploy-preview-7668--authentik.netlify.app> | | üì± Preview on mobile | Toggle QR Code... [QR Code](https://camo.githubusercontent.com/907e64c00ff01bdf0a93ae6728d7805f815a50a3b6983102558e570e3c28355e/68747470733a2f2f6170702e6e65746c6966792e636f6d2f71722d636f64652f65794a30655841694f694a4b563151694c434a68624763694f694a49557a49314e694a392e65794a31636d77694f694a6f64485277637a6f764c32526c6347787665533177636d5632615756334c5463324e6a67744c5746316447686c626e5270617935755a58527361575a354c6d467763434a392e747649414c4b5675384e54765553413451627431796b654f5f504278575134725a426d326c345652416649)*Use your smartphone camera to open QR code link.* | | [Lighthouse](https://camo.githubusercontent.com/a36ef52f7d003dab029310c75ff13031bb287d1ca4081f8edfc360253c8be2b3/68747470733a2f2f6170702e6e65746c6966792e636f6d2f7075626c69632f65787465726e616c2d75736167652f6769742d636f6d6d656e74732f6c69676874686f7573652d736d2e706e67)Lighthouse | 1 paths audited**Performance**: 92 (üî¥ down 4 from production)**Accessibility**: 90 (no change from production)**Best Practices**: 100 (no change from production)**SEO**: 80 (no change from production)**PWA**: -[View the detailed breakdown and full score reports](https://app.netlify.com/sites/authentik/deploys/655ce4ac313a1400087124db) |   ---   *To edit notification comments on pull requests, go to your [Netlify site configuration](https://app.netlify.com/sites/authentik/configuration/deploys#deploy-notifications).* |

All reactions

Sorry, something went wrong.

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoauthentik%2Fauthentik%2Fpull%2F7668)

Reviewers

No reviews

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

1 participant

[![@BeryJu](https://avatars.githubusercontent.com/u/1932513?s=52&v=4)](/BeryJu)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_fb54fa20_20250114_190523.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoauthentik%2Fauthentik%2Freleases%2Ftag%2Fversion%252F2023.8.5)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoauthentik%2Fauthentik%2Freleases%2Ftag%2Fversion%252F2023.8.5)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=goauthentik%2Fauthentik)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[goauthentik](/goauthentik)
/
**[authentik](/goauthentik/authentik)**
Public

* [Notifications](/login?return_to=%2Fgoauthentik%2Fauthentik) You must be signed in to change notification settings
* [Fork
  984](/login?return_to=%2Fgoauthentik%2Fauthentik)
* [Star
   14.5k](/login?return_to=%2Fgoauthentik%2Fauthentik)

* [Code](/goauthentik/authentik/tree/version/2023.8.5)
* [Issues
  614](/goauthentik/authentik/issues)
* [Pull requests
  114](/goauthentik/authentik/pulls)
* [Discussions](/goauthentik/authentik/discussions)
* [Actions](/goauthentik/authentik/actions)
* [Security](/goauthentik/authentik/security)
* [Insights](/goauthentik/authentik/pulse)

Additional navigation options

* [Code](/goauthentik/authentik/tree/version/2023.8.5)
* [Issues](/goauthentik/authentik/issues)
* [Pull requests](/goauthentik/authentik/pulls)
* [Discussions](/goauthentik/authentik/discussions)
* [Actions](/goauthentik/authentik/actions)
* [Security](/goauthentik/authentik/security)
* [Insights](/goauthentik/authentik/pulse)

1. [Releases](/goauthentik/authentik/releases)
2. [version/2023.8.5](/goauthentik/authentik/releases/tag/version/2023.8.5)

# Release 2023.8.5

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/goauthentik/authentik/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...version/2023.8.5)

 Loading

[View all tags](/goauthentik/authentik/tags)

![@authentik-automation](https://avatars.githubusercontent.com/in/340695?s=40&v=4)
[authentik-automation](/apps/authentik-automation)
released this
21 Nov 19:09

[version/2023.8.5](/goauthentik/authentik/tree/version/2023.8.5)

[`1516fe8`](/goauthentik/authentik/commit/1516fe86dab2f62754a9c37679e0488dcf829c77)

This commit was signed with the committer‚Äôs **verified signature**.

[![](https://avatars.githubusercontent.com/u/1932513?s=64&v=4)](/BeryJu)
[BeryJu](/BeryJu)
Jens L.

SSH Key Fingerprint: qXKR3cmH8k8srI6xUmY1NxTLnR9kcz5QnC4qGjbfhDM
[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

See <https://goauthentik.io/docs/releases/2023.8#fixed-in-202385>

## What's Changed

* security: fix CVE-2023-48228 (cherry-pick [#7666](https://github.com/goauthentik/authentik/pull/7666)) by @gcp-cherry-pick-bot in [#7669](https://github.com/goauthentik/authentik/pull/7669)

**Full Changelog**: [version/2023.8.4...version/2023.8.5](https://github.com/goauthentik/authentik/compare/version/2023.8.4...version/2023.8.5)

 Assets
14

 Loading

 üëç
1
 stevleibelt reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

 1 person reacted

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_a145c5c5_20250114_190515.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoauthentik%2Fauthentik%2Fcommit%2F6b9afed21f7c39f171a4a445654cfe415bba37d5)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoauthentik%2Fauthentik%2Fcommit%2F6b9afed21f7c39f171a4a445654cfe415bba37d5)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=goauthentik%2Fauthentik)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[goauthentik](/goauthentik)
/
**[authentik](/goauthentik/authentik)**
Public

* [Notifications](/login?return_to=%2Fgoauthentik%2Fauthentik) You must be signed in to change notification settings
* [Fork
  984](/login?return_to=%2Fgoauthentik%2Fauthentik)
* [Star
   14.5k](/login?return_to=%2Fgoauthentik%2Fauthentik)

* [Code](/goauthentik/authentik)
* [Issues
  614](/goauthentik/authentik/issues)
* [Pull requests
  114](/goauthentik/authentik/pulls)
* [Discussions](/goauthentik/authentik/discussions)
* [Actions](/goauthentik/authentik/actions)
* [Security](/goauthentik/authentik/security)
* [Insights](/goauthentik/authentik/pulse)

Additional navigation options

* [Code](/goauthentik/authentik)
* [Issues](/goauthentik/authentik/issues)
* [Pull requests](/goauthentik/authentik/pulls)
* [Discussions](/goauthentik/authentik/discussions)
* [Actions](/goauthentik/authentik/actions)
* [Security](/goauthentik/authentik/security)
* [Insights](/goauthentik/authentik/pulse)

## Commit

[Permalink](/goauthentik/authentik/commit/6b9afed21f7c39f171a4a445654cfe415bba37d5)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

security: fix CVE-2023-48228 (cherry-pick [#7666](https://github.com/goauthentik/authentik/pull/7666)) ([#7668](https://github.com/goauthentik/authentik/pull/7668))

[Browse files](/goauthentik/authentik/tree/6b9afed21f7c39f171a4a445654cfe415bba37d5)
Browse the repository at this point in the history

```
security: fix CVE-2023-48228 ([#7666](https://github.com/goauthentik/authentik/pull/7666))

Signed-off-by: Jens Langhammer <jens@goauthentik.io>
Co-authored-by: Jens L <jens@goauthentik.io>
```

* Loading branch information

[![@gcp-cherry-pick-bot](https://avatars.githubusercontent.com/in/169664?s=40&v=4)](/apps/gcp-cherry-pick-bot) [![@BeryJu](https://avatars.githubusercontent.com/u/1932513?s=40&v=4)](/BeryJu)

[gcp-cherry-pick-bot[bot]](/goauthentik/authentik/commits?author=gcp-cherry-pick-bot%5Bbot%5D "View all commits by gcp-cherry-pick-bot[bot]")
and
[BeryJu](/goauthentik/authentik/commits?author=BeryJu "View all commits by BeryJu")
authored
Nov 21, 2023

1 parent
[1eb1f4e](/goauthentik/authentik/commit/1eb1f4e0b89711b125d6891dc40d39d7178afd94)

commit 6b9afed

 Show file tree

 Hide file tree

Showing
**4 changed files**
with
**253 additions**
and
**1 deletion**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* authentik/providers/oauth2

  + tests

    - authentik/providers/oauth2/tests/test\_token\_pkce.py
      [test\_token\_pkce.py](#diff-c03534356f3bf7a63ea9643bd138218f8f212c98b8bd030ba92ad4e292d3c738)
  + views

    - authentik/providers/oauth2/views/token.py
      [token.py](#diff-cfa6353328ef6a4968d1a52e936b3d57f8293aad3aca5c0384ad9511be1a40ec)
* website

  + docs/security

    - website/docs/security/CVE-2023-48228.md
      [CVE-2023-48228.md](#diff-38a68bbd99d4a929fc53d23f7b7b1b82d054a4c827f88d6b573857a9413b347f)
  + website/sidebars.js
    [sidebars.js](#diff-4caaf3187919c98f42856c140e32964b0829fc19165f3c989a6cd4ea088a7164)

## There are no files selected for viewing

187 changes: 187 additions & 0 deletions

187
[authentik/providers/oauth2/tests/test\_token\_pkce.py](#diff-c03534356f3bf7a63ea9643bd138218f8f212c98b8bd030ba92ad4e292d3c738 "authentik/providers/oauth2/tests/test_token_pkce.py")

Show comments

[View file](/goauthentik/authentik/blob/6b9afed21f7c39f171a4a445654cfe415bba37d5/authentik/providers/oauth2/tests/test_token_pkce.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,187 @@ |
|  |  | """Test token view""" |
|  |  | from base64 import b64encode, urlsafe\_b64encode |
|  |  | from hashlib import sha256 |
|  |  |  |
|  |  | from django.test import RequestFactory |
|  |  | from django.urls import reverse |
|  |  |  |
|  |  | from authentik.core.models import Application |
|  |  | from authentik.core.tests.utils import create\_test\_admin\_user, create\_test\_flow |
|  |  | from authentik.flows.challenge import ChallengeTypes |
|  |  | from authentik.lib.generators import generate\_id |
|  |  | from authentik.providers.oauth2.constants import GRANT\_TYPE\_AUTHORIZATION\_CODE |
|  |  | from authentik.providers.oauth2.models import AuthorizationCode, OAuth2Provider |
|  |  | from authentik.providers.oauth2.tests.utils import OAuthTestCase |
|  |  |  |
|  |  |  |
|  |  | class TestTokenPKCE(OAuthTestCase): |
|  |  | """Test token view""" |
|  |  |  |
|  |  | def setUp(self) -> None: |
|  |  | super().setUp() |
|  |  | self.factory = RequestFactory() |
|  |  | self.app = Application.objects.create(name=generate\_id(), slug="test") |
|  |  |  |
|  |  | def test\_pkce\_missing\_in\_token(self): |
|  |  | """Test full with pkce""" |
|  |  | flow = create\_test\_flow() |
|  |  | provider = OAuth2Provider.objects.create( |
|  |  | name=generate\_id(), |
|  |  | client\_id="test", |
|  |  | authorization\_flow=flow, |
|  |  | redirect\_uris="foo://localhost", |
|  |  | access\_code\_validity="seconds=100", |
|  |  | ) |
|  |  | Application.objects.create(name="app", slug="app", provider=provider) |
|  |  | state = generate\_id() |
|  |  | user = create\_test\_admin\_user() |
|  |  | self.client.force\_login(user) |
|  |  | challenge = generate\_id() |
|  |  | header = b64encode(f"{provider.client\_id}:{provider.client\_secret}".encode()).decode() |
|  |  | # Step 1, initiate params and get redirect to flow |
|  |  | self.client.get( |
|  |  | reverse("authentik\_providers\_oauth2:authorize"), |
|  |  | data={ |
|  |  | "response\_type": "code", |
|  |  | "client\_id": "test", |
|  |  | "state": state, |
|  |  | "redirect\_uri": "foo://localhost", |
|  |  | "code\_challenge": challenge, |
|  |  | "code\_challenge\_method": "S256", |
|  |  | }, |
|  |  | ) |
|  |  | response = self.client.get( |
|  |  | reverse("authentik\_api:flow-executor", kwargs={"flow\_slug": flow.slug}), |
|  |  | ) |
|  |  | code: AuthorizationCode = AuthorizationCode.objects.filter(user=user).first() |
|  |  | self.assertJSONEqual( |
|  |  | response.content.decode(), |
|  |  | { |
|  |  | "component": "xak-flow-redirect", |
|  |  | "type": ChallengeTypes.REDIRECT.value, |
|  |  | "to": f"foo://localhost?code={code.code}&state={state}", |
|  |  | }, |
|  |  | ) |
|  |  | response = self.client.post( |
|  |  | reverse("authentik\_providers\_oauth2:token"), |
|  |  | data={ |
|  |  | "grant\_type": GRANT\_TYPE\_AUTHORIZATION\_CODE, |
|  |  | "code": code.code, |
|  |  | # Missing the code\_verifier here |
|  |  | "redirect\_uri": "foo://localhost", |
|  |  | }, |
|  |  | HTTP\_AUTHORIZATION=f"Basic {header}", |
|  |  | ) |
|  |  | self.assertJSONEqual( |
|  |  | response.content, |
|  |  | {"error": "invalid\_request", "error\_description": "The request is otherwise malformed"}, |
|  |  | ) |
|  |  | self.assertEqual(response.status\_code, 400) |
|  |  |  |
|  |  | def test\_pkce\_correct\_s256(self): |
|  |  | """Test full with pkce""" |
|  |  | flow = create\_test\_flow() |
|  |  | provider = OAuth2Provider.objects.create( |
|  |  | name=generate\_id(), |
|  |  | client\_id="test", |
|  |  | authorization\_flow=flow, |
|  |  | redirect\_uris="foo://localhost", |
|  |  | access\_code\_validity="seconds=100", |
|  |  | ) |
|  |  | Application.objects.create(name="app", slug="app", provider=provider) |
|  |  | state = generate\_id() |
|  |  | user = create\_test\_admin\_user() |
|  |  | self.client.force\_login(user) |
|  |  | verifier = generate\_id() |
|  |  | challenge = ( |
|  |  | urlsafe\_b64encode(sha256(verifier.encode("ascii")).digest()) |
|  |  | .decode("utf-8") |
|  |  | .replace("=", "") |
|  |  | ) |
|  |  | header = b64encode(f"{provider.client\_id}:{provider.client\_secret}".encode()).decode() |
|  |  | # Step 1, initiate params and get redirect to flow |
|  |  | self.client.get( |
|  |  | reverse("authentik\_providers\_oauth2:authorize"), |
|  |  | data={ |
|  |  | "response\_type": "code", |
|  |  | "client\_id": "test", |
|  |  | "state": state, |
|  |  | "redirect\_uri": "foo://localhost", |
|  |  | "code\_challenge": challenge, |
|  |  | "code\_challenge\_method": "S256", |
|  |  | }, |
|  |  | ) |
|  |  | response = self.client.get( |
|  |  | reverse("authentik\_api:flow-executor", kwargs={"flow\_slug": flow.slug}), |
|  |  | ) |
|  |  | code: AuthorizationCode = AuthorizationCode.objects.filter(user=user).first() |
|  |  | self.assertJSONEqual( |
|  |  | response.content.decode(), |
|  |  | { |
|  |  | "component": "xak-flow-redirect", |
|  |  | "type": ChallengeTypes.REDIRECT.value, |
|  |  | "to": f"foo://localhost?code={code.code}&state={state}", |
|  |  | }, |
|  |  | ) |
|  |  | response = self.client.post( |
|  |  | reverse("authentik\_providers\_oauth2:token"), |
|  |  | data={ |
|  |  | "grant\_type": GRANT\_TYPE\_AUTHORIZATION\_CODE, |
|  |  | "code": code.code, |
|  |  | "code\_verifier": verifier, |
|  |  | "redirect\_uri": "foo://localhost", |
|  |  | }, |
|  |  | HTTP\_AUTHORIZATION=f"Basic {header}", |
|  |  | ) |
|  |  | self.assertEqual(response.status\_code, 200) |
|  |  |  |
|  |  | def test\_pkce\_correct\_plain(self): |
|  |  | """Test full with pkce""" |
|  |  | flow = create\_test\_flow() |
|  |  | provider = OAuth2Provider.objects.create( |
|  |  | name=generate\_id(), |
|  |  | client\_id="test", |
|  |  | authorization\_flow=flow, |
|  |  | redirect\_uris="foo://localhost", |
|  |  | access\_code\_validity="seconds=100", |
|  |  | ) |
|  |  | Application.objects.create(name="app", slug="app", provider=provider) |
|  |  | state = generate\_id() |
|  |  | user = create\_test\_admin\_user() |
|  |  | self.client.force\_login(user) |
|  |  | verifier = generate\_id() |
|  |  | header = b64encode(f"{provider.client\_id}:{provider.client\_secret}".encode()).decode() |
|  |  | # Step 1, initiate params and get redirect to flow |
|  |  | self.client.get( |
|  |  | reverse("authentik\_providers\_oauth2:authorize"), |
|  |  | data={ |
|  |  | "response\_type": "code", |
|  |  | "client\_id": "test", |
|  |  | "state": state, |
|  |  | "redirect\_uri": "foo://localhost", |
|  |  | "code\_challenge": verifier, |
|  |  | }, |
|  |  | ) |
|  |  | response = self.client.get( |
|  |  | reverse("authentik\_api:flow-executor", kwargs={"flow\_slug": flow.slug}), |
|  |  | ) |
|  |  | code: AuthorizationCode = AuthorizationCode.objects.filter(user=user).first() |
|  |  | self.assertJSONEqual( |
|  |  | response.content.decode(), |
|  |  | { |
|  |  | "component": "xak-flow-redirect", |
|  |  | "type": ChallengeTypes.REDIRECT.value, |
|  |  | "to": f"foo://localhost?code={code.code}&state={state}", |
|  |  | }, |
|  |  | ) |
|  |  | response = self.client.post( |
|  |  | reverse("authentik\_providers\_oauth2:token"), |
|  |  | data={ |
|  |  | "grant\_type": GRANT\_TYPE\_AUTHORIZATION\_CODE, |
|  |  | "code": code.code, |
|  |  | "code\_verifier": verifier, |
|  |  | "redirect\_uri": "foo://localhost", |
|  |  | }, |
|  |  | HTTP\_AUTHORIZATION=f"Basic {header}", |
|  |  | ) |
|  |  | self.assertEqual(response.status\_code, 200) |

5 changes: 4 additions & 1 deletion

5
[authentik/providers/oauth2/views/token.py](#diff-cfa6353328ef6a4968d1a52e936b3d57f8293aad3aca5c0384ad9511be1a40ec "authentik/providers/oauth2/views/token.py")

Show comments

[View file](/goauthentik/authentik/blob/6b9afed21f7c39f171a4a445654cfe415bba37d5/authentik/providers/oauth2/views/token.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -222,7 +222,10 @@ def \_\_post\_init\_code(self, raw\_code: str, request: HttpRequest): |
|  |  | raise TokenError("invalid\_grant") |
|  |  |  |
|  |  | # Validate PKCE parameters. |
|  |  | if self.code\_verifier: |
|  |  | if self.authorization\_code.code\_challenge: |
|  |  | # Authorization code had PKCE but we didn't get one |
|  |  | if not self.code\_verifier: |
|  |  | raise TokenError("invalid\_request") |
|  |  | if self.authorization\_code.code\_challenge\_method == PKCE\_METHOD\_S256: |
|  |  | new\_code\_challenge = ( |
|  |  | urlsafe\_b64encode(sha256(self.code\_verifier.encode("ascii")).digest()) |
| Expand Down | |  |

61 changes: 61 additions & 0 deletions

61
[website/docs/security/CVE-2023-48228.md](#diff-38a68bbd99d4a929fc53d23f7b7b1b82d054a4c827f88d6b573857a9413b347f "website/docs/security/CVE-2023-48228.md")

Show comments

[View file](/goauthentik/authentik/blob/6b9afed21f7c39f171a4a445654cfe415bba37d5/website/docs/security/CVE-2023-48228.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1,61 @@ |
|  |  | # CVE-2023-48228 |
|  |  |  |
|  |  | \_Reported by [@Sapd](https://github.com/Sapd)\_ |
|  |  |  |
|  |  | ## OAuth2: Insufficient PKCE check |
|  |  |  |
|  |  | ### Summary |
|  |  |  |
|  |  | When initialising a OAuth2 flow with a `code\_challenge` and `code\_method` (thus requesting PKCE), the SSO provider (authentik) \*\*must\*\* check if there is a matching \*\*and\*\* existing `code\_verifier` during the token step. |
|  |  |  |
|  |  | authentik checks if the contents of code\*verifier is matching \\*\\*\\_ONLY\*\\*\\* when it is provided. When it is left out completely, authentik simply accepts the token request with out it; even when the flow was started with a `code\_challenge`. |
|  |  |  |
|  |  | ### Patches |
|  |  |  |
|  |  | authentik 2023.8.5 and 2023.10.4 fix this issue. |
|  |  |  |
|  |  | ### Details |
|  |  |  |
|  |  | The `code\_verifier` is only checked when the user provides it. Note that in line 209 there is a check if the code\_parameter is left out. But there is no check if the PKCE parameter simply was omitted WHEN the request was started with a `code\_challenge\_method`. |
|  |  |  |
|  |  | This oversight likely did not stem from a coding error but from a misinterpretation of the RFC, where the backward compatibility section may be somewhat confusing. |
|  |  | https://datatracker.ietf.org/doc/html/rfc7636#section-4.5 |
|  |  | RFC7636 explicitly says in Section 4.5: |
|  |  |  |
|  |  | > The "code\_challenge\_method" is bound to the Authorization Code when |
|  |  | > the Authorization Code is issued. That is the method that the token |
|  |  | > endpoint MUST use to verify the "code\_verifier". |
|  |  |  |
|  |  | Section 5, Compatibility |
|  |  |  |
|  |  | > Server implementations of this specification MAY accept OAuth2.0 |
|  |  | > clients that do not implement this extension. If the "code\_verifier" |
|  |  | > is not received from the client in the Authorization Request, servers |
|  |  | > supporting backwards compatibility revert to the OAuth 2.0 [[RFC6749](https://datatracker.ietf.org/doc/html/rfc6749)] |
|  |  | > protocol without this extension. |
|  |  |  |
|  |  | Section 5, Compatibility, allows server implementations of this specification to accept OAuth 2.0 clients that do not implement this extension. However, if a `code\_verifier` is not received from the client in the Authorization Request, servers that support backward compatibility should revert to the standard OAuth 2.0 protocol sans this extension (including all steps). |
|  |  |  |
|  |  | It should be noted that this does not mean that the `code\_verifier` check can be disregarded at any point if the initial request included `code\_challenge` or `code\_challenge\_method`. Since Authentik supports PKCE, it \*\*MUST\*\* verify the code\_verifier as described in Section 4.5 \*\*AND\*\* fail if it was not provided. |
|  |  |  |
|  |  | Ofc verification can be skipped if the original authorization request did not invoke PKCE (no `code\_challenge\_method` and no `code\_challenge`). |
|  |  |  |
|  |  | Failure to check the `code\_verifier` renders the PKCE flow ineffective. This vulnerability particularly endangers public or hybrid clients, as their `code` is deemed non-confidential. |
|  |  |  |
|  |  | While not explicitly stated in the standard, it is generally recommended that OAuth2 flows accepting public clients should enforce PKCE - at least when redirecting to a non HTTPS URL (like http or an app link). |
|  |  |  |
|  |  | ### Impact |
|  |  |  |
|  |  | The vulnerability poses a high risk to both public and hybrid clients. |
|  |  | When for example a mobile app implements oauth2, a malicious app can simply also register the same in-app-link (e.g. `mycoolapp://oauth2`) for the redirect callback URL, possibly receiving `code` during callback. With PKCE working, a malicious app would still receive a `code` but the `code` would not work without the correct unhashed code-challenge. |
|  |  | This is especially problematic, because authentik claims to support PKCE, and a developer can expect that the proper checks are in place. Note that app-links cannot be protected by HTTPS or similar mechanisms. |
|  |  |  |
|  |  | Note also that this vulnerability poses a threat to confidential clients. Many confidential clients act as a proxy for OAuth2 API requests, typically from mobile apps or single-page applications. These proxies relay `code\_challenge`, `code\_challenge\_method` (in auth request, which most libraries force and provide on default settings) and `code\_verifier` in the token request unchanged and supplement the CLIENT\_SECRET which only the relay knows. The relay can but does not have to check for an existing `code\_verifier` as the standard does not define that PKCE can be ignored on confidential clients during the token request when the client requested PKCE during the authorization request. |
|  |  |  |
|  |  | An attacker could potentially gain full access to the application. If the code grants access to an admin account, the confidentiality, integrity, and availability of that application are compromised. |
|  |  |  |
|  |  | ### For more information |
|  |  |  |
|  |  | If you have any questions or comments about this advisory: |
|  |  |  |
|  |  | - Email us at [security@goauthentik.io](mailto:security@goauthentik.io) |

1 change: 1 addition & 0 deletions

1
[website/sidebars.js](#diff-4caaf3187919c98f42856c140e32964b0829fc19165f3c989a6cd4ea088a7164 "website/sidebars.js")

Show comments

[View file](/goauthentik/authentik/blob/6b9afed21f7c39f171a4a445654cfe415bba37d5/website/sidebars.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -407,6 +407,7 @@ const docsSidebar = { |
|  |  | }, |
|  |  | items: [ |
|  |  | "security/policy", |
|  |  | "security/CVE-2023-48228", |
|  |  | "security/GHSA-rjvp-29xq-f62w", |
|  |  | "security/CVE-2023-39522", |
|  |  | "security/CVE-2023-36456", |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `6b9afed`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoauthentik%2Fauthentik%2Fcommit%2F6b9afed21f7c39f171a4a445654cfe415bba37d5) to comment.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_17f4190b_20250114_190511.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoauthentik%2Fauthentik%2Fblob%2Fdd4e9030b4e667d3720be2feda24c08972602274%2Fauthentik%2Fproviders%2Foauth2%2Fviews%2Ftoken.py)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoauthentik%2Fauthentik%2Fblob%2Fdd4e9030b4e667d3720be2feda24c08972602274%2Fauthentik%2Fproviders%2Foauth2%2Fviews%2Ftoken.py)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=goauthentik%2Fauthentik)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[goauthentik](/goauthentik)
/
**[authentik](/goauthentik/authentik)**
Public

* [Notifications](/login?return_to=%2Fgoauthentik%2Fauthentik) You must be signed in to change notification settings
* [Fork
  984](/login?return_to=%2Fgoauthentik%2Fauthentik)
* [Star
   14.5k](/login?return_to=%2Fgoauthentik%2Fauthentik)

* [Code](/goauthentik/authentik)
* [Issues
  614](/goauthentik/authentik/issues)
* [Pull requests
  114](/goauthentik/authentik/pulls)
* [Discussions](/goauthentik/authentik/discussions)
* [Actions](/goauthentik/authentik/actions)
* [Security](/goauthentik/authentik/security)
* [Insights](/goauthentik/authentik/pulse)

Additional navigation options

* [Code](/goauthentik/authentik)
* [Issues](/goauthentik/authentik/issues)
* [Pull requests](/goauthentik/authentik/pulls)
* [Discussions](/goauthentik/authentik/discussions)
* [Actions](/goauthentik/authentik/actions)
* [Security](/goauthentik/authentik/security)
* [Insights](/goauthentik/authentik/pulse)

## Files

¬†dd4e903
## Breadcrumbs

1. [authentik](/goauthentik/authentik/tree/dd4e9030b4e667d3720be2feda24c08972602274)
2. /[authentik](/goauthentik/authentik/tree/dd4e9030b4e667d3720be2feda24c08972602274/authentik)
3. /[providers](/goauthentik/authentik/tree/dd4e9030b4e667d3720be2feda24c08972602274/authentik/providers)
4. /[oauth2](/goauthentik/authentik/tree/dd4e9030b4e667d3720be2feda24c08972602274/authentik/providers/oauth2)
5. /[views](/goauthentik/authentik/tree/dd4e9030b4e667d3720be2feda24c08972602274/authentik/providers/oauth2/views)
/
# token.py

Copy path Blame  Blame
## Latest commit

## History

[History](/goauthentik/authentik/commits/dd4e9030b4e667d3720be2feda24c08972602274/authentik/providers/oauth2/views/token.py)653 lines (597 loc) ¬∑ 26 KB¬†dd4e903
## Breadcrumbs

1. [authentik](/goauthentik/authentik/tree/dd4e9030b4e667d3720be2feda24c08972602274)
2. /[authentik](/goauthentik/authentik/tree/dd4e9030b4e667d3720be2feda24c08972602274/authentik)
3. /[providers](/goauthentik/authentik/tree/dd4e9030b4e667d3720be2feda24c08972602274/authentik/providers)
4. /[oauth2](/goauthentik/authentik/tree/dd4e9030b4e667d3720be2feda24c08972602274/authentik/providers/oauth2)
5. /[views](/goauthentik/authentik/tree/dd4e9030b4e667d3720be2feda24c08972602274/authentik/providers/oauth2/views)
/
# token.py

Top
## File metadata and controls

* Code
* Blame

653 lines (597 loc) ¬∑ 26 KB[Raw](https://github.com/goauthentik/authentik/raw/dd4e9030b4e667d3720be2feda24c08972602274/authentik/providers/oauth2/views/token.py)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653"""authentik OAuth2 Token views"""from base64 import urlsafe\_b64encodefrom dataclasses import InitVar, dataclassfrom datetime import datetimefrom hashlib import sha256from re import error as RegexErrorfrom re import fullmatchfrom typing import Any, Optional
from django.http import HttpRequest, HttpResponsefrom django.utils import timezonefrom django.utils.decorators import method\_decoratorfrom django.views import Viewfrom django.views.decorators.csrf import csrf\_exemptfrom guardian.shortcuts import get\_anonymous\_userfrom jwt import PyJWK, PyJWT, PyJWTError, decodefrom sentry\_sdk.hub import Hubfrom structlog.stdlib import get\_logger
from authentik.core.middleware import CTX\_AUTH\_VIAfrom authentik.core.models import ( USER\_ATTRIBUTE\_EXPIRES, USER\_ATTRIBUTE\_GENERATED, Application, Token, TokenIntents, User,)from authentik.events.models import Event, EventActionfrom authentik.events.signals import get\_login\_eventfrom authentik.flows.planner import PLAN\_CONTEXT\_APPLICATIONfrom authentik.lib.utils.time import timedelta\_from\_stringfrom authentik.policies.engine import PolicyEnginefrom authentik.providers.oauth2.constants import ( CLIENT\_ASSERTION, CLIENT\_ASSERTION\_TYPE, CLIENT\_ASSERTION\_TYPE\_JWT, GRANT\_TYPE\_AUTHORIZATION\_CODE, GRANT\_TYPE\_CLIENT\_CREDENTIALS, GRANT\_TYPE\_DEVICE\_CODE, GRANT\_TYPE\_PASSWORD, GRANT\_TYPE\_REFRESH\_TOKEN, PKCE\_METHOD\_S256, TOKEN\_TYPE,)from authentik.providers.oauth2.errors import DeviceCodeError, TokenError, UserAuthErrorfrom authentik.providers.oauth2.id\_token import IDTokenfrom authentik.providers.oauth2.models import ( AccessToken, AuthorizationCode, ClientTypes, DeviceToken, OAuth2Provider, RefreshToken,)from authentik.providers.oauth2.utils import TokenResponse, cors\_allow, extract\_client\_authfrom authentik.sources.oauth.models import OAuthSourcefrom authentik.stages.password.stage import PLAN\_CONTEXT\_METHOD, PLAN\_CONTEXT\_METHOD\_ARGS
LOGGER = get\_logger()
@dataclass(slots=True)# pylint: disable=too-many-instance-attributesclass TokenParams: """Token params"""
 client\_id: str client\_secret: str redirect\_uri: str grant\_type: str state: str scope: list[str]
 provider: OAuth2Provider
 authorization\_code: Optional[AuthorizationCode] = None refresh\_token: Optional[RefreshToken] = None device\_code: Optional[DeviceToken] = None user: Optional[User] = None
 code\_verifier: Optional[str] = None
 raw\_code: InitVar[str] = "" raw\_token: InitVar[str] = "" request: InitVar[Optional[HttpRequest]] = None
 @staticmethod def parse( request: HttpRequest, provider: OAuth2Provider, client\_id: str, client\_secret: str, ) -> "TokenParams": """Parse params for request""" return TokenParams( # Init vars raw\_code=request.POST.get("code", ""), raw\_token=request.POST.get("refresh\_token", ""), request=request, # Regular params provider=provider, client\_id=client\_id, client\_secret=client\_secret, redirect\_uri=request.POST.get("redirect\_uri", ""), grant\_type=request.POST.get("grant\_type", ""), state=request.POST.get("state", ""), scope=request.POST.get("scope", "").split(), # PKCE parameter. code\_verifier=request.POST.get("code\_verifier"), )
 def \_\_check\_policy\_access(self, app: Application, request: HttpRequest, \*\*kwargs): with Hub.current.start\_span( op="authentik.providers.oauth2.token.policy", ): user = self.user if self.user else get\_anonymous\_user() engine = PolicyEngine(app, user, request) # Don't cache as for client\_credentials flows the user will not be set # so we'll get generic cache results engine.use\_cache = False engine.request.context["oauth\_scopes"] = self.scope engine.request.context["oauth\_grant\_type"] = self.grant\_type engine.request.context["oauth\_code\_verifier"] = self.code\_verifier engine.request.context.update(kwargs) engine.build() result = engine.result if not result.passing: LOGGER.info( "User not authenticated for application", user=self.user, app\_slug=app.slug ) raise TokenError("invalid\_grant")
 def \_\_post\_init\_\_(self, raw\_code: str, raw\_token: str, request: HttpRequest): if self.grant\_type in [GRANT\_TYPE\_AUTHORIZATION\_CODE, GRANT\_TYPE\_REFRESH\_TOKEN]: if ( self.provider.client\_type == ClientTypes.CONFIDENTIAL and self.provider.client\_secret != self.client\_secret ): LOGGER.warning( "Invalid client secret", client\_id=self.provider.client\_id, ) raise TokenError("invalid\_client")
 if self.grant\_type == GRANT\_TYPE\_AUTHORIZATION\_CODE: with Hub.current.start\_span( op="authentik.providers.oauth2.post.parse.code", ): self.\_\_post\_init\_code(raw\_code, request) elif self.grant\_type == GRANT\_TYPE\_REFRESH\_TOKEN: with Hub.current.start\_span( op="authentik.providers.oauth2.post.parse.refresh", ): self.\_\_post\_init\_refresh(raw\_token, request) elif self.grant\_type in [GRANT\_TYPE\_CLIENT\_CREDENTIALS, GRANT\_TYPE\_PASSWORD]: with Hub.current.start\_span( op="authentik.providers.oauth2.post.parse.client\_credentials", ): self.\_\_post\_init\_client\_credentials(request) elif self.grant\_type == GRANT\_TYPE\_DEVICE\_CODE: with Hub.current.start\_span( op="authentik.providers.oauth2.post.parse.device\_code", ): self.\_\_post\_init\_device\_code(request) else: LOGGER.warning("Invalid grant type", grant\_type=self.grant\_type) raise TokenError("unsupported\_grant\_type")
 def \_\_post\_init\_code(self, raw\_code: str, request: HttpRequest): if not raw\_code: LOGGER.warning("Missing authorization code") raise TokenError("invalid\_grant")
 allowed\_redirect\_urls = self.provider.redirect\_uris.split() # At this point, no provider should have a blank redirect\_uri, in case they do # this will check an empty array and raise an error try: if not any(fullmatch(x, self.redirect\_uri) for x in allowed\_redirect\_urls): LOGGER.warning( "Invalid redirect uri (regex comparison)", redirect\_uri=self.redirect\_uri, expected=allowed\_redirect\_urls, ) Event.new( EventAction.CONFIGURATION\_ERROR, message="Invalid redirect URI used by provider", provider=self.provider, redirect\_uri=self.redirect\_uri, expected=allowed\_redirect\_urls, ).from\_http(request) raise TokenError("invalid\_client") except RegexError as exc: LOGGER.info("Failed to parse regular expression, checking directly", exc=exc) if not any(x == self.redirect\_uri for x in allowed\_redirect\_urls): LOGGER.warning( "Invalid redirect uri (strict comparison)", redirect\_uri=self.redirect\_uri, expected=allowed\_redirect\_urls, ) Event.new( EventAction.CONFIGURATION\_ERROR, message="Invalid redirect\_uri configured", provider=self.provider, ).from\_http(request) raise TokenError("invalid\_client")
 self.authorization\_code = AuthorizationCode.objects.filter(code=raw\_code).first() if not self.authorization\_code: LOGGER.warning("Code does not exist", code=raw\_code) raise TokenError("invalid\_grant")
 if self.authorization\_code.is\_expired: LOGGER.warning( "Code is expired", token=raw\_code, ) raise TokenError("invalid\_grant")
 if self.authorization\_code.provider != self.provider or self.authorization\_code.is\_expired: LOGGER.warning("Invalid code: invalid client or code has expired") raise TokenError("invalid\_grant")
 # Validate PKCE parameters. if self.code\_verifier: if self.authorization\_code.code\_challenge\_method == PKCE\_METHOD\_S256: new\_code\_challenge = ( urlsafe\_b64encode(sha256(self.code\_verifier.encode("ascii")).digest()) .decode("utf-8") .replace("=", "") ) else: new\_code\_challenge = self.code\_verifier
 if new\_code\_challenge != self.authorization\_code.code\_challenge: LOGGER.warning("Code challenge not matching") raise TokenError("invalid\_grant")
 def \_\_post\_init\_refresh(self, raw\_token: str, request: HttpRequest): if not raw\_token: LOGGER.warning("Missing refresh token") raise TokenError("invalid\_grant")
 self.refresh\_token = RefreshToken.objects.filter( token=raw\_token, provider=self.provider ).first() if not self.refresh\_token: LOGGER.warning( "Refresh token does not exist", token=raw\_token, ) raise TokenError("invalid\_grant") if self.refresh\_token.is\_expired: LOGGER.warning( "Refresh token is expired", token=raw\_token, ) raise TokenError("invalid\_grant") # https://datatracker.ietf.org/doc/html/rfc6749#section-6 # Fallback to original token's scopes when none are given if not self.scope: self.scope = self.refresh\_token.scope if self.refresh\_token.revoked: LOGGER.warning("Refresh token is revoked", token=raw\_token) Event.new( action=EventAction.SUSPICIOUS\_REQUEST, message="Revoked refresh token was used", token=self.refresh\_token, provider=self.refresh\_token.provider, ).from\_http(request, user=self.refresh\_token.user) raise TokenError("invalid\_grant")
 def \_\_post\_init\_client\_credentials(self, request: HttpRequest): if request.POST.get(CLIENT\_ASSERTION\_TYPE, "") != "": return self.\_\_post\_init\_client\_credentials\_jwt(request) # Authenticate user based on credentials username = request.POST.get("username") password = request.POST.get("password") user = User.objects.filter(username=username).first() if not user: raise TokenError("invalid\_grant") token: Token = Token.filter\_not\_expired( key=password, intent=TokenIntents.INTENT\_APP\_PASSWORD ).first() if not token or token.user.uid != user.uid: raise TokenError("invalid\_grant") self.user = user # Authorize user access app = Application.objects.filter(provider=self.provider).first() if not app or not app.provider: raise TokenError("invalid\_grant") self.\_\_check\_policy\_access(app, request)
 Event.new( action=EventAction.LOGIN, \*\*{ PLAN\_CONTEXT\_METHOD: "token", PLAN\_CONTEXT\_METHOD\_ARGS: { "identifier": token.identifier, }, PLAN\_CONTEXT\_APPLICATION: app, }, ).from\_http(request, user=user) return None
 # pylint: disable=too-many-locals def \_\_post\_init\_client\_credentials\_jwt(self, request: HttpRequest): assertion\_type = request.POST.get(CLIENT\_ASSERTION\_TYPE, "") if assertion\_type != CLIENT\_ASSERTION\_TYPE\_JWT: LOGGER.warning("Invalid assertion type", assertion\_type=assertion\_type) raise TokenError("invalid\_grant")
 client\_secret = request.POST.get("client\_secret", None) assertion = request.POST.get(CLIENT\_ASSERTION, client\_secret) if not assertion: LOGGER.warning("Missing client assertion") raise TokenError("invalid\_grant")
 token = None
 source: Optional[OAuthSource] = None parsed\_key: Optional[PyJWK] = None
 # Fully decode the JWT without verifying the signature, so we can get access to # the header. # Get the Key ID from the header, and use that to optimise our source query to only find # sources that have a JWK for that Key ID # The Key ID doesn't have a fixed format, but must match between an issued JWT # and whatever is returned by the JWKS endpoint try: decode\_unvalidated = PyJWT().decode\_complete( assertion, options={"verify\_signature": False} ) except (PyJWTError, ValueError, TypeError, AttributeError) as exc: LOGGER.warning("failed to parse JWT for kid lookup", exc=exc) raise TokenError("invalid\_grant") expected\_kid = decode\_unvalidated["header"]["kid"] for source in self.provider.jwks\_sources.filter( oidc\_jwks\_\_keys\_\_contains=[{"kid": expected\_kid}] ): LOGGER.debug("verifying JWT with source", source=source.slug) keys = source.oidc\_jwks.get("keys", []) for key in keys: LOGGER.debug("verifying JWT with key", source=source.slug, key=key.get("kid")) try: parsed\_key = PyJWK.from\_dict(key) token = decode( assertion, parsed\_key.key, algorithms=[key.get("alg")], options={ "verify\_aud": False, }, ) # AttributeError is raised when the configured JWK is a private key # and not a public key except (PyJWTError, ValueError, TypeError, AttributeError) as exc: LOGGER.warning("failed to verify JWT", exc=exc, source=source.slug)
 if not token: LOGGER.warning("No token could be verified") raise TokenError("invalid\_grant")
 LOGGER.info("successfully verified JWT with source", source=source.slug)
 if "exp" in token: exp = datetime.fromtimestamp(token["exp"]) # Non-timezone aware check since we assume `exp` is in UTC if datetime.now() >= exp: LOGGER.info("JWT token expired") raise TokenError("invalid\_grant")
 app = Application.objects.filter(provider=self.provider).first() if not app or not app.provider: LOGGER.info("client\_credentials grant for provider without application") raise TokenError("invalid\_grant")
 self.\_\_check\_policy\_access(app, request, oauth\_jwt=token) self.\_\_create\_user\_from\_jwt(token, app, source)
 method\_args = { "jwt": token, } if source: method\_args["source"] = source if parsed\_key: method\_args["jwk\_id"] = parsed\_key.key\_id Event.new( action=EventAction.LOGIN, \*\*{ PLAN\_CONTEXT\_METHOD: "jwt", PLAN\_CONTEXT\_METHOD\_ARGS: method\_args, PLAN\_CONTEXT\_APPLICATION: app, }, ).from\_http(request, user=self.user)
 def \_\_post\_init\_device\_code(self, request: HttpRequest): device\_code = request.POST.get("device\_code", "") code = DeviceToken.objects.filter(device\_code=device\_code, provider=self.provider).first() if not code: raise TokenError("invalid\_grant") self.device\_code = code
 def \_\_create\_user\_from\_jwt(self, token: dict[str, Any], app: Application, source: OAuthSource): """Create user from JWT""" exp = token.get("exp") self.user, created = User.objects.update\_or\_create( username=f"{self.provider.name}-{token.get('sub')}", defaults={ "attributes": { USER\_ATTRIBUTE\_GENERATED: True, }, "last\_login": timezone.now(), "name": f"Autogenerated user from application {app.name} (client credentials JWT)", "path": source.get\_user\_path(), }, ) if created and exp: self.user.attributes[USER\_ATTRIBUTE\_EXPIRES] = exp self.user.save()
@method\_decorator(csrf\_exempt, name="dispatch")class TokenView(View): """Generate tokens for clients"""
 provider: Optional[OAuth2Provider] = None params: Optional[TokenParams] = None
 def dispatch(self, request: HttpRequest, \*args: Any, \*\*kwargs: Any) -> HttpResponse: response = super().dispatch(request, \*args, \*\*kwargs) allowed\_origins = [] if self.provider: allowed\_origins = self.provider.redirect\_uris.split("\n") cors\_allow(self.request, response, \*allowed\_origins) return response
 def options(self, request: HttpRequest) -> HttpResponse: return TokenResponse({})
 def post(self, request: HttpRequest) -> HttpResponse: """Generate tokens for clients""" try: with Hub.current.start\_span( op="authentik.providers.oauth2.post.parse", ): client\_id, client\_secret = extract\_client\_auth(request) self.provider = OAuth2Provider.objects.filter(client\_id=client\_id).first() if not self.provider: LOGGER.warning("OAuth2Provider does not exist", client\_id=client\_id) raise TokenError("invalid\_client") CTX\_AUTH\_VIA.set("oauth\_client\_secret") self.params = TokenParams.parse(request, self.provider, client\_id, client\_secret)
 with Hub.current.start\_span( op="authentik.providers.oauth2.post.response", ): if self.params.grant\_type == GRANT\_TYPE\_AUTHORIZATION\_CODE: LOGGER.debug("Converting authorization code to refresh token") return TokenResponse(self.create\_code\_response()) if self.params.grant\_type == GRANT\_TYPE\_REFRESH\_TOKEN: LOGGER.debug("Refreshing refresh token") return TokenResponse(self.create\_refresh\_response()) if self.params.grant\_type in [GRANT\_TYPE\_CLIENT\_CREDENTIALS, GRANT\_TYPE\_PASSWORD]: LOGGER.debug("Client credentials/password grant") return TokenResponse(self.create\_client\_credentials\_response()) if self.params.grant\_type == GRANT\_TYPE\_DEVICE\_CODE: LOGGER.debug("Device code grant") return TokenResponse(self.create\_device\_code\_response()) raise TokenError("unsupported\_grant\_type") except (TokenError, DeviceCodeError) as error: return TokenResponse(error.create\_dict(), status=400) except UserAuthError as error: return TokenResponse(error.create\_dict(), status=403)
 def create\_code\_response(self) -> dict[str, Any]: """See https://datatracker.ietf.org/doc/html/rfc6749#section-4.1""" now = timezone.now() access\_token\_expiry = now + timedelta\_from\_string(self.provider.access\_token\_validity) access\_token = AccessToken( provider=self.provider, user=self.params.authorization\_code.user, expires=access\_token\_expiry, # Keep same scopes as previous token scope=self.params.authorization\_code.scope, auth\_time=self.params.authorization\_code.auth\_time, ) access\_token.id\_token = IDToken.new( self.provider, access\_token, self.request, ) access\_token.save()
 refresh\_token\_expiry = now + timedelta\_from\_string(self.provider.refresh\_token\_validity) refresh\_token = RefreshToken( user=self.params.authorization\_code.user, scope=self.params.authorization\_code.scope, expires=refresh\_token\_expiry, provider=self.provider, auth\_time=self.params.authorization\_code.auth\_time, ) id\_token = IDToken.new( self.provider, refresh\_token, self.request, ) id\_token.nonce = self.params.authorization\_code.nonce id\_token.at\_hash = access\_token.at\_hash refresh\_token.id\_token = id\_token refresh\_token.save()
 # Delete old code self.params.authorization\_code.delete() return { "access\_token": access\_token.token, "refresh\_token": refresh\_token.token, "token\_type": TOKEN\_TYPE, "expires\_in": int( timedelta\_from\_string(self.provider.access\_token\_validity).total\_seconds() ), "id\_token": id\_token.to\_jwt(self.provider), }
 def create\_refresh\_response(self) -> dict[str, Any]: """See https://datatracker.ietf.org/doc/html/rfc6749#section-6""" unauthorized\_scopes = set(self.params.scope) - set(self.params.refresh\_token.scope) if unauthorized\_scopes: raise TokenError("invalid\_scope") now = timezone.now() access\_token\_expiry = now + timedelta\_from\_string(self.provider.access\_token\_validity) access\_token = AccessToken( provider=self.provider, user=self.params.refresh\_token.user, expires=access\_token\_expiry, # Keep same scopes as previous token scope=self.params.refresh\_token.scope, auth\_time=self.params.refresh\_token.auth\_time, ) access\_token.id\_token = IDToken.new( self.provider, access\_token, self.request, ) access\_token.save()
 refresh\_token\_expiry = now + timedelta\_from\_string(self.provider.refresh\_token\_validity) refresh\_token = RefreshToken( user=self.params.refresh\_token.user, scope=self.params.refresh\_token.scope, expires=refresh\_token\_expiry, provider=self.provider, auth\_time=self.params.refresh\_token.auth\_time, ) id\_token = IDToken.new( self.provider, refresh\_token, self.request, ) id\_token.nonce = self.params.refresh\_token.id\_token.nonce id\_token.at\_hash = access\_token.at\_hash refresh\_token.id\_token = id\_token refresh\_token.save()
 # Mark old token as revoked self.params.refresh\_token.revoked = True self.params.refresh\_token.save()
 return { "access\_token": access\_token.token, "refresh\_token": refresh\_token.token, "token\_type": TOKEN\_TYPE, "expires\_in": int( timedelta\_from\_string(self.provider.access\_token\_validity).total\_seconds() ), "id\_token": id\_token.to\_jwt(self.provider), }
 def create\_client\_credentials\_response(self) -> dict[str, Any]: """See https://datatracker.ietf.org/doc/html/rfc6749#section-4.4""" now = timezone.now() access\_token\_expiry = now + timedelta\_from\_string(self.provider.access\_token\_validity) access\_token = AccessToken( provider=self.provider, user=self.params.user, expires=access\_token\_expiry, scope=self.params.scope, auth\_time=now, ) access\_token.id\_token = IDToken.new( self.provider, access\_token, self.request, ) access\_token.save() return { "access\_token": access\_token.token, "token\_type": TOKEN\_TYPE, "expires\_in": int( timedelta\_from\_string(self.provider.access\_token\_validity).total\_seconds() ), "id\_token": access\_token.id\_token.to\_jwt(self.provider), }
 def create\_device\_code\_response(self) -> dict[str, Any]: """See https://datatracker.ietf.org/doc/html/rfc8628""" if not self.params.device\_code.user: raise DeviceCodeError("authorization\_pending") now = timezone.now() access\_token\_expiry = now + timedelta\_from\_string(self.provider.access\_token\_validity) auth\_event = get\_login\_event(self.request) access\_token = AccessToken( provider=self.provider, user=self.params.device\_code.user, expires=access\_token\_expiry, scope=self.params.device\_code.scope, auth\_time=auth\_event.created if auth\_event else now, ) access\_token.id\_token = IDToken.new( self.provider, access\_token, self.request, ) access\_token.save()
 refresh\_token\_expiry = now + timedelta\_from\_string(self.provider.refresh\_token\_validity) refresh\_token = RefreshToken( user=self.params.device\_code.user, scope=self.params.device\_code.scope, expires=refresh\_token\_expiry, provider=self.provider, auth\_time=auth\_event.created if auth\_event else now, ) id\_token = IDToken.new( self.provider, refresh\_token, self.request, ) id\_token.at\_hash = access\_token.at\_hash refresh\_token.id\_token = id\_token refresh\_token.save()
 # Delete device code self.params.device\_code.delete() return { "access\_token": access\_token.token, "refresh\_token": refresh\_token.token, "token\_type": TOKEN\_TYPE, "expires\_in": int( timedelta\_from\_string(self.provider.access\_token\_validity).total\_seconds() ), "id\_token": id\_token.to\_jwt(self.provider), }

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_943b4b75_20250114_190522.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoauthentik%2Fauthentik%2Freleases%2Ftag%2Fversion%252F2023.10.4)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoauthentik%2Fauthentik%2Freleases%2Ftag%2Fversion%252F2023.10.4)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=goauthentik%2Fauthentik)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[goauthentik](/goauthentik)
/
**[authentik](/goauthentik/authentik)**
Public

* [Notifications](/login?return_to=%2Fgoauthentik%2Fauthentik) You must be signed in to change notification settings
* [Fork
  984](/login?return_to=%2Fgoauthentik%2Fauthentik)
* [Star
   14.5k](/login?return_to=%2Fgoauthentik%2Fauthentik)

* [Code](/goauthentik/authentik/tree/version/2023.10.4)
* [Issues
  614](/goauthentik/authentik/issues)
* [Pull requests
  114](/goauthentik/authentik/pulls)
* [Discussions](/goauthentik/authentik/discussions)
* [Actions](/goauthentik/authentik/actions)
* [Security](/goauthentik/authentik/security)
* [Insights](/goauthentik/authentik/pulse)

Additional navigation options

* [Code](/goauthentik/authentik/tree/version/2023.10.4)
* [Issues](/goauthentik/authentik/issues)
* [Pull requests](/goauthentik/authentik/pulls)
* [Discussions](/goauthentik/authentik/discussions)
* [Actions](/goauthentik/authentik/actions)
* [Security](/goauthentik/authentik/security)
* [Insights](/goauthentik/authentik/pulse)

1. [Releases](/goauthentik/authentik/releases)
2. [version/2023.10.4](/goauthentik/authentik/releases/tag/version/2023.10.4)

# Release 2023.10.4

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/goauthentik/authentik/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...version/2023.10.4)

 Loading

[View all tags](/goauthentik/authentik/tags)

![@authentik-automation](https://avatars.githubusercontent.com/in/340695?s=40&v=4)
[authentik-automation](/apps/authentik-automation)
released this
21 Nov 17:56

[version/2023.10.4](/goauthentik/authentik/tree/version/2023.10.4)

[`a2a6716`](/goauthentik/authentik/commit/a2a67161ac8b840d63cbaacdfbebb60fd48e901b)

This commit was signed with the committer‚Äôs **verified signature**.

[![](https://avatars.githubusercontent.com/u/1932513?s=64&v=4)](/BeryJu)
[BeryJu](/BeryJu)
Jens L.

SSH Key Fingerprint: qXKR3cmH8k8srI6xUmY1NxTLnR9kcz5QnC4qGjbfhDM
[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

See <https://goauthentik.io/docs/releases/2023.10#fixed-in-2023104>

## What's Changed

* providers/proxy: Fix duplicate cookies when using file system store. (cherry-pick [#7541](https://github.com/goauthentik/authentik/pull/7541)) by @gcp-cherry-pick-bot in [#7544](https://github.com/goauthentik/authentik/pull/7544)
* stages/email: use uuid for email confirmation token instead of username (cherry-pick [#7581](https://github.com/goauthentik/authentik/pull/7581)) by @gcp-cherry-pick-bot in [#7584](https://github.com/goauthentik/authentik/pull/7584)
* events: sanitize functions (cherry-pick [#7587](https://github.com/goauthentik/authentik/pull/7587)) by @gcp-cherry-pick-bot in [#7589](https://github.com/goauthentik/authentik/pull/7589)
* providers/scim: fix missing schemas attribute for User and Group (cherry-pick [#7477](https://github.com/goauthentik/authentik/pull/7477)) by @gcp-cherry-pick-bot in [#7596](https://github.com/goauthentik/authentik/pull/7596)
* events: fix missing model\_\* events when not directly authenticated (cherry-pick [#7588](https://github.com/goauthentik/authentik/pull/7588)) by @gcp-cherry-pick-bot in [#7597](https://github.com/goauthentik/authentik/pull/7597)
* ci: fix permissions for release pipeline to publish binaries (cherry-pick [#7512](https://github.com/goauthentik/authentik/pull/7512)) by @gcp-cherry-pick-bot in [#7621](https://github.com/goauthentik/authentik/pull/7621)
* core: bump golang from 1.21.3-bookworm to 1.21.4-bookworm (cherry-pick [#7483](https://github.com/goauthentik/authentik/pull/7483)) by @gcp-cherry-pick-bot in [#7622](https://github.com/goauthentik/authentik/pull/7622)
* events: don't update internal service accounts unless needed (cherry-pick [#7611](https://github.com/goauthentik/authentik/pull/7611)) by @gcp-cherry-pick-bot in [#7640](https://github.com/goauthentik/authentik/pull/7640)
* security: fix CVE-2023-48228 (cherry-pick [#7666](https://github.com/goauthentik/authentik/pull/7666)) by @gcp-cherry-pick-bot in [#7668](https://github.com/goauthentik/authentik/pull/7668)

**Full Changelog**: [version/2023.10.3...version/2023.10.4](https://github.com/goauthentik/authentik/compare/version/2023.10.3...version/2023.10.4)

 Assets
14

 Loading

 üëç
5
 Dual-0, benedikt-bartscher, masterwishx, tigerwill90, and olsenlid reacted with thumbs up emoji

All reactions

* üëç
  5 reactions

 5 people reacted

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_985d9f5e_20250114_190524.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoauthentik%2Fauthentik%2Fsecurity%2Fadvisories%2FGHSA-fm34-v8xq-f2c3)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoauthentik%2Fauthentik%2Fsecurity%2Fadvisories%2FGHSA-fm34-v8xq-f2c3)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=goauthentik%2Fauthentik)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[goauthentik](/goauthentik)
/
**[authentik](/goauthentik/authentik)**
Public

* [Notifications](/login?return_to=%2Fgoauthentik%2Fauthentik) You must be signed in to change notification settings
* [Fork
  984](/login?return_to=%2Fgoauthentik%2Fauthentik)
* [Star
   14.5k](/login?return_to=%2Fgoauthentik%2Fauthentik)

* [Code](/goauthentik/authentik)
* [Issues
  614](/goauthentik/authentik/issues)
* [Pull requests
  114](/goauthentik/authentik/pulls)
* [Discussions](/goauthentik/authentik/discussions)
* [Actions](/goauthentik/authentik/actions)
* [Security](/goauthentik/authentik/security)
* [Insights](/goauthentik/authentik/pulse)

Additional navigation options

* [Code](/goauthentik/authentik)
* [Issues](/goauthentik/authentik/issues)
* [Pull requests](/goauthentik/authentik/pulls)
* [Discussions](/goauthentik/authentik/discussions)
* [Actions](/goauthentik/authentik/actions)
* [Security](/goauthentik/authentik/security)
* [Insights](/goauthentik/authentik/pulse)

# OAuth2: Insufficient PKCE check

High

[BeryJu](/BeryJu)
published
GHSA-fm34-v8xq-f2c3
Nov 21, 2023

## Package

authentik

## Affected versions

<= 2023.10.3
<= 2023.8.4

## Patched versions

2023.10.4
2023.8.5

## Description

### Summary

When initialising a OAuth2 flow with a `code_challenge` and `code_method` (thus requesting PKCE), the SSO provider (authentik) **must** check if there is a matching **and** existing `code_verifier` during the token step.

authentik checks if the contents of code\_verifier is matching ***ONLY*** when it is provided. When it is left out completely, authentik simply accepts the token request with out it; even when the flow was started with a `code_challenge`.

### Patches

authentik 2023.8.5 and 2023.10.4 fix this issue.

### Details

The `code_verifier` is only checked when the user provides it. Note that in line 209 there is a check if the code\_parameter is left out. But there is no check if the PKCE parameter simply was omitted WHEN the request was started with a `code_challenge_method`.

This oversight likely did not stem from a coding error but from a misinterpretation of the RFC, where the backward compatibility section may be somewhat confusing.

<https://datatracker.ietf.org/doc/html/rfc7636#section-4.5>

RFC7636 explicitly says in Section 4.5:

> The "code\_challenge\_method" is bound to the Authorization Code when
>
> the Authorization Code is issued. That is the method that the token
>
> endpoint MUST use to verify the "code\_verifier".

Section 5, Compatibility

> Server implementations of this specification MAY accept OAuth2.0
>
> clients that do not implement this extension. If the "code\_verifier"
>
> is not received from the client in the Authorization Request, servers
>
> supporting backwards compatibility revert to the OAuth 2.0 [[RFC6749](https://datatracker.ietf.org/doc/html/rfc6749)]
>
> protocol without this extension.

Section 5, Compatibility, allows server implementations of this specification to accept OAuth 2.0 clients that do not implement this extension. However, if a `code_verifier` is not received from the client in the Authorization Request, servers that support backward compatibility should revert to the standard OAuth 2.0 protocol sans this extension (including all steps).

It should be noted that this does not mean that the `code_verifier` check can be disregarded at any point if the initial request included `code_challenge` or `code_challenge_method`. Since Authentik supports PKCE, it **MUST** verify the code\_verifier as described in Section 4.5 **AND** fail if it was not provided.

Ofc verification can be skipped if the original authorization request did not invoke PKCE (no `code_challenge_method` and no `code_challenge`).

Failure to check the `code_verifier` renders the PKCE flow ineffective. This vulnerability particularly endangers public or hybrid clients, as their `code` is deemed non-confidential.

While not explicitly stated in the standard, it is generally recommended that OAuth2 flows accepting public clients should enforce PKCE - at least when redirecting to a non HTTPS URL (like http or an app link).

### Impact

The vulnerability poses a high risk to both public and hybrid clients.

When for example a mobile app implements oauth2, a malicious app can simply also register the same in-app-link (e.g. `mycoolapp://oauth2`) for the redirect callback URL, possibly receiving `code` during callback. With PKCE working, a malicious app would still receive a `code` but the `code` would not work without the correct unhashed code-challenge.

This is especially problematic, because authentik claims to support PKCE, and a developer can expect that the proper checks are in place. Note that app-links cannot be protected by HTTPS or similar mechanisms.

Note also that this vulnerability poses a threat to confidential clients. Many confidential clients act as a proxy for OAuth2 API requests, typically from mobile apps or single-page applications. These proxies relay `code_challenge`, `code_challenge_method` (in auth request, which most libraries force and provide on default settings) and `code_verifier` in the token request unchanged and supplement the CLIENT\_SECRET which only the relay knows. The relay can but does not have to check for an existing `code_verifier` as the standard does not define that PKCE can be ignored on confidential clients during the token request when the client requested PKCE during the authorization request.

An attacker could potentially gain full access to the application. If the code grants access to an admin account, the confidentiality, integrity, and availability of that application are compromised.

### For more information

If you have any questions or comments about this advisory:

* Email us at security@goauthentik.io

### Severity

High

### CVE ID

CVE-2023-48228

### Weaknesses

No CWEs

### Credits

* [![@Sapd](https://avatars.githubusercontent.com/u/671752?s=40&v=4)](/Sapd)
  [Sapd](/Sapd)
  Finder

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_6582d8fa_20250115_113814.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoauthentik%2Fauthentik%2Fpull%2F7669)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoauthentik%2Fauthentik%2Fpull%2F7669)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=goauthentik%2Fauthentik)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[goauthentik](/goauthentik)
/
**[authentik](/goauthentik/authentik)**
Public

* [Notifications](/login?return_to=%2Fgoauthentik%2Fauthentik) You must be signed in to change notification settings
* [Fork
  986](/login?return_to=%2Fgoauthentik%2Fauthentik)
* [Star
   14.5k](/login?return_to=%2Fgoauthentik%2Fauthentik)

* [Code](/goauthentik/authentik)
* [Issues
  614](/goauthentik/authentik/issues)
* [Pull requests
  116](/goauthentik/authentik/pulls)
* [Discussions](/goauthentik/authentik/discussions)
* [Actions](/goauthentik/authentik/actions)
* [Security](/goauthentik/authentik/security)
* [Insights](/goauthentik/authentik/pulse)

Additional navigation options

* [Code](/goauthentik/authentik)
* [Issues](/goauthentik/authentik/issues)
* [Pull requests](/goauthentik/authentik/pulls)
* [Discussions](/goauthentik/authentik/discussions)
* [Actions](/goauthentik/authentik/actions)
* [Security](/goauthentik/authentik/security)
* [Insights](/goauthentik/authentik/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fgoauthentik%2Fauthentik%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fgoauthentik%2Fauthentik%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# security: fix CVE-2023-48228 (cherry-pick #7666) #7669

 Merged

[BeryJu](/BeryJu)
merged 1 commit into
[version-2023.8](/goauthentik/authentik/tree/version-2023.8 "goauthentik/authentik:version-2023.8")
from
[cherry-pick-1f6da3-version-2023.8](/goauthentik/authentik/tree/cherry-pick-1f6da3-version-2023.8 "goauthentik/authentik:cherry-pick-1f6da3-version-2023.8")

Nov 21, 2023

 Merged

# [security: fix CVE-2023-48228 (cherry-pick #7666)](#top) #7669

[BeryJu](/BeryJu)
merged 1 commit into
[version-2023.8](/goauthentik/authentik/tree/version-2023.8 "goauthentik/authentik:version-2023.8")
from
[cherry-pick-1f6da3-version-2023.8](/goauthentik/authentik/tree/cherry-pick-1f6da3-version-2023.8 "goauthentik/authentik:cherry-pick-1f6da3-version-2023.8")

Nov 21, 2023

[Conversation
1](/goauthentik/authentik/pull/7669)
[Commits
1](/goauthentik/authentik/pull/7669/commits)
[Checks
11](/goauthentik/authentik/pull/7669/checks)
[Files changed](/goauthentik/authentik/pull/7669/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![gcp-cherry-pick-bot[bot]](https://avatars.githubusercontent.com/in/169664?s=60&v=4)](/apps/gcp-cherry-pick-bot)

Copy link

Contributor

### @gcp-cherry-pick-bot **[gcp-cherry-pick-bot](/apps/gcp-cherry-pick-bot) bot** commented [Nov 21, 2023](#issue-2004773367)

Cherry-picked security: fix CVE-2023-48228 ([#7666](https://github.com/goauthentik/authentik/pull/7666))

Signed-off-by: Jens Langhammer jens@goauthentik.io

Sorry, something went wrong.

All reactions

[![@BeryJu](https://avatars.githubusercontent.com/u/1932513?s=40&v=4)](/BeryJu)

`[security: fix CVE-2023-48228 (](/goauthentik/authentik/pull/7669/commits/8fe02b2aafb54aae12fb135d65eceeebc4dfc8e9 "security: fix CVE-2023-48228 (#7666)

Signed-off-by: Jens Langhammer <jens@goauthentik.io>")[#7666](https://github.com/goauthentik/authentik/pull/7666)[)](/goauthentik/authentik/pull/7669/commits/8fe02b2aafb54aae12fb135d65eceeebc4dfc8e9 "security: fix CVE-2023-48228 (#7666)

Signed-off-by: Jens Langhammer <jens@goauthentik.io>")`
 ‚Ä¶

`[8fe02b2](/goauthentik/authentik/pull/7669/commits/8fe02b2aafb54aae12fb135d65eceeebc4dfc8e9)`

```
Signed-off-by: Jens Langhammer <jens@goauthentik.io>
```

 [![@gcp-cherry-pick-bot](https://avatars.githubusercontent.com/in/169664?s=40&v=4)](/apps/gcp-cherry-pick-bot)
[gcp-cherry-pick-bot](/apps/gcp-cherry-pick-bot)
bot
requested review from
a team
as [code owners](/goauthentik/authentik/blob/72d67f65e5070f14aacb01fab9376cfc4534c446/CODEOWNERS#L2)
[November 21, 2023 17:10](#event-11027145873)

 [![@gcp-cherry-pick-bot](https://avatars.githubusercontent.com/in/169664?s=40&v=4)](/apps/gcp-cherry-pick-bot)
[gcp-cherry-pick-bot](/apps/gcp-cherry-pick-bot)
bot
requested review from
[smusali](/smusali)
and removed request for
a team
[November 21, 2023 17:10](#event-11027146181)

 Hide details
View details

[![@BeryJu](https://avatars.githubusercontent.com/u/1932513?s=40&u=935e6da8ed83fd57020599b716e1f17591a6d3c0&v=4)](/BeryJu)
[BeryJu](/BeryJu)
merged commit [`3af77ab`](/goauthentik/authentik/commit/3af77ab3821fe9c7df8055ba5eade3d1ecea03a6)
into
version-2023.8

[Nov 21, 2023](https://github.com/goauthentik/authentik/pull/7669#event-11027182553)
1 of 7 checks passed

 [![@BeryJu](https://avatars.githubusercontent.com/u/1932513?s=40&u=935e6da8ed83fd57020599b716e1f17591a6d3c0&v=4)](/BeryJu)
[BeryJu](/BeryJu)
deleted the
cherry-pick-1f6da3-version-2023.8

branch
[November 21, 2023 17:13](#event-11027182736)

[![@netlify](https://avatars.githubusercontent.com/in/13473?s=80&v=4)](/apps/netlify)
[![Netlify](https://avatars.githubusercontent.com/in/13473?s=40&u=a8c6e35a15f833f7487d4a6abdbab66ce52041b0&v=4)](https://github.com/apps/netlify)

Copy link

### **[netlify](/apps/netlify) bot** commented [Nov 21, 2023](#issuecomment-1821336457) ‚Ä¢ edited Loading

|  |  |  |  |  |  |  |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| ‚úÖ Deploy Preview for *authentik* ready!  | Name | Link | | --- | --- | | üî® Latest commit | [8fe02b2](https://github.com/goauthentik/authentik/commit/8fe02b2aafb54aae12fb135d65eceeebc4dfc8e9) | | üîç Latest deploy log | <https://app.netlify.com/sites/authentik/deploys/655ce4a50010a80008ebe6b0> | | üòé Deploy Preview | <https://deploy-preview-7669--authentik.netlify.app> | | üì± Preview on mobile | Toggle QR Code... [QR Code](https://camo.githubusercontent.com/c503349e61c5f00c23ad5345189b92d623a90eb80c65ef0772027451119a8fd6/68747470733a2f2f6170702e6e65746c6966792e636f6d2f71722d636f64652f65794a30655841694f694a4b563151694c434a68624763694f694a49557a49314e694a392e65794a31636d77694f694a6f64485277637a6f764c32526c6347787665533177636d5632615756334c5463324e6a6b744c5746316447686c626e5270617935755a58527361575a354c6d467763434a392e4b314663484b4e507873425f346f344d624954452d4f372d474a32506959546272384d6c503966326d7145)*Use your smartphone camera to open QR code link.* | | [Lighthouse](https://camo.githubusercontent.com/a36ef52f7d003dab029310c75ff13031bb287d1ca4081f8edfc360253c8be2b3/68747470733a2f2f6170702e6e65746c6966792e636f6d2f7075626c69632f65787465726e616c2d75736167652f6769742d636f6d6d656e74732f6c69676874686f7573652d736d2e706e67)Lighthouse | 1 paths audited**Performance**: 92 (üî¥ down 5 from production)**Accessibility**: 90 (no change from production)**Best Practices**: 100 (no change from production)**SEO**: 80 (no change from production)**PWA**: -[View the detailed breakdown and full score reports](https://app.netlify.com/sites/authentik/deploys/655ce4a50010a80008ebe6b0) |   ---   *To edit notification comments on pull requests, go to your [Netlify site configuration](https://app.netlify.com/sites/authentik/configuration/deploys#deploy-notifications).* |

All reactions

Sorry, something went wrong.

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoauthentik%2Fauthentik%2Fpull%2F7669)

Reviewers

[![@smusali](https://avatars.githubusercontent.com/u/34287490?s=40&v=4)](/smusali) [smusali](/smusali)

 Awaiting requested review from smusali

 smusali is a code owner automatically assigned from goauthentik/core

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

1 participant

[![@BeryJu](https://avatars.githubusercontent.com/u/1932513?s=52&v=4)](/BeryJu)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_76e79748_20250114_190513.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoauthentik%2Fauthentik%2Fcommit%2F3af77ab3821fe9c7df8055ba5eade3d1ecea03a6)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoauthentik%2Fauthentik%2Fcommit%2F3af77ab3821fe9c7df8055ba5eade3d1ecea03a6)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=goauthentik%2Fauthentik)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[goauthentik](/goauthentik)
/
**[authentik](/goauthentik/authentik)**
Public

* [Notifications](/login?return_to=%2Fgoauthentik%2Fauthentik) You must be signed in to change notification settings
* [Fork
  984](/login?return_to=%2Fgoauthentik%2Fauthentik)
* [Star
   14.5k](/login?return_to=%2Fgoauthentik%2Fauthentik)

* [Code](/goauthentik/authentik)
* [Issues
  614](/goauthentik/authentik/issues)
* [Pull requests
  114](/goauthentik/authentik/pulls)
* [Discussions](/goauthentik/authentik/discussions)
* [Actions](/goauthentik/authentik/actions)
* [Security](/goauthentik/authentik/security)
* [Insights](/goauthentik/authentik/pulse)

Additional navigation options

* [Code](/goauthentik/authentik)
* [Issues](/goauthentik/authentik/issues)
* [Pull requests](/goauthentik/authentik/pulls)
* [Discussions](/goauthentik/authentik/discussions)
* [Actions](/goauthentik/authentik/actions)
* [Security](/goauthentik/authentik/security)
* [Insights](/goauthentik/authentik/pulse)

## Commit

[Permalink](/goauthentik/authentik/commit/3af77ab3821fe9c7df8055ba5eade3d1ecea03a6)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

security: fix CVE-2023-48228 (cherry-pick [#7666](https://github.com/goauthentik/authentik/pull/7666)) ([#7669](https://github.com/goauthentik/authentik/pull/7669))

[Browse files](/goauthentik/authentik/tree/3af77ab3821fe9c7df8055ba5eade3d1ecea03a6)
Browse the repository at this point in the history

```
security: fix CVE-2023-48228 ([#7666](https://github.com/goauthentik/authentik/pull/7666))

Signed-off-by: Jens Langhammer <jens@goauthentik.io>
Co-authored-by: Jens L <jens@goauthentik.io>
```

* Loading branch information

[![@gcp-cherry-pick-bot](https://avatars.githubusercontent.com/in/169664?s=40&v=4)](/apps/gcp-cherry-pick-bot) [![@BeryJu](https://avatars.githubusercontent.com/u/1932513?s=40&v=4)](/BeryJu)

[gcp-cherry-pick-bot[bot]](/goauthentik/authentik/commits?author=gcp-cherry-pick-bot%5Bbot%5D "View all commits by gcp-cherry-pick-bot[bot]")
and
[BeryJu](/goauthentik/authentik/commits?author=BeryJu "View all commits by BeryJu")
authored
Nov 21, 2023

1 parent
[72d67f6](/goauthentik/authentik/commit/72d67f65e5070f14aacb01fab9376cfc4534c446)

commit 3af77ab

 Show file tree

 Hide file tree

Showing
**4 changed files**
with
**253 additions**
and
**1 deletion**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* authentik/providers/oauth2

  + tests

    - authentik/providers/oauth2/tests/test\_token\_pkce.py
      [test\_token\_pkce.py](#diff-c03534356f3bf7a63ea9643bd138218f8f212c98b8bd030ba92ad4e292d3c738)
  + views

    - authentik/providers/oauth2/views/token.py
      [token.py](#diff-cfa6353328ef6a4968d1a52e936b3d57f8293aad3aca5c0384ad9511be1a40ec)
* website

  + docs/security

    - website/docs/security/CVE-2023-48228.md
      [CVE-2023-48228.md](#diff-38a68bbd99d4a929fc53d23f7b7b1b82d054a4c827f88d6b573857a9413b347f)
  + website/sidebars.js
    [sidebars.js](#diff-4caaf3187919c98f42856c140e32964b0829fc19165f3c989a6cd4ea088a7164)

## There are no files selected for viewing

187 changes: 187 additions & 0 deletions

187
[authentik/providers/oauth2/tests/test\_token\_pkce.py](#diff-c03534356f3bf7a63ea9643bd138218f8f212c98b8bd030ba92ad4e292d3c738 "authentik/providers/oauth2/tests/test_token_pkce.py")

Show comments

[View file](/goauthentik/authentik/blob/3af77ab3821fe9c7df8055ba5eade3d1ecea03a6/authentik/providers/oauth2/tests/test_token_pkce.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,187 @@ |
|  |  | """Test token view""" |
|  |  | from base64 import b64encode, urlsafe\_b64encode |
|  |  | from hashlib import sha256 |
|  |  |  |
|  |  | from django.test import RequestFactory |
|  |  | from django.urls import reverse |
|  |  |  |
|  |  | from authentik.core.models import Application |
|  |  | from authentik.core.tests.utils import create\_test\_admin\_user, create\_test\_flow |
|  |  | from authentik.flows.challenge import ChallengeTypes |
|  |  | from authentik.lib.generators import generate\_id |
|  |  | from authentik.providers.oauth2.constants import GRANT\_TYPE\_AUTHORIZATION\_CODE |
|  |  | from authentik.providers.oauth2.models import AuthorizationCode, OAuth2Provider |
|  |  | from authentik.providers.oauth2.tests.utils import OAuthTestCase |
|  |  |  |
|  |  |  |
|  |  | class TestTokenPKCE(OAuthTestCase): |
|  |  | """Test token view""" |
|  |  |  |
|  |  | def setUp(self) -> None: |
|  |  | super().setUp() |
|  |  | self.factory = RequestFactory() |
|  |  | self.app = Application.objects.create(name=generate\_id(), slug="test") |
|  |  |  |
|  |  | def test\_pkce\_missing\_in\_token(self): |
|  |  | """Test full with pkce""" |
|  |  | flow = create\_test\_flow() |
|  |  | provider = OAuth2Provider.objects.create( |
|  |  | name=generate\_id(), |
|  |  | client\_id="test", |
|  |  | authorization\_flow=flow, |
|  |  | redirect\_uris="foo://localhost", |
|  |  | access\_code\_validity="seconds=100", |
|  |  | ) |
|  |  | Application.objects.create(name="app", slug="app", provider=provider) |
|  |  | state = generate\_id() |
|  |  | user = create\_test\_admin\_user() |
|  |  | self.client.force\_login(user) |
|  |  | challenge = generate\_id() |
|  |  | header = b64encode(f"{provider.client\_id}:{provider.client\_secret}".encode()).decode() |
|  |  | # Step 1, initiate params and get redirect to flow |
|  |  | self.client.get( |
|  |  | reverse("authentik\_providers\_oauth2:authorize"), |
|  |  | data={ |
|  |  | "response\_type": "code", |
|  |  | "client\_id": "test", |
|  |  | "state": state, |
|  |  | "redirect\_uri": "foo://localhost", |
|  |  | "code\_challenge": challenge, |
|  |  | "code\_challenge\_method": "S256", |
|  |  | }, |
|  |  | ) |
|  |  | response = self.client.get( |
|  |  | reverse("authentik\_api:flow-executor", kwargs={"flow\_slug": flow.slug}), |
|  |  | ) |
|  |  | code: AuthorizationCode = AuthorizationCode.objects.filter(user=user).first() |
|  |  | self.assertJSONEqual( |
|  |  | response.content.decode(), |
|  |  | { |
|  |  | "component": "xak-flow-redirect", |
|  |  | "type": ChallengeTypes.REDIRECT.value, |
|  |  | "to": f"foo://localhost?code={code.code}&state={state}", |
|  |  | }, |
|  |  | ) |
|  |  | response = self.client.post( |
|  |  | reverse("authentik\_providers\_oauth2:token"), |
|  |  | data={ |
|  |  | "grant\_type": GRANT\_TYPE\_AUTHORIZATION\_CODE, |
|  |  | "code": code.code, |
|  |  | # Missing the code\_verifier here |
|  |  | "redirect\_uri": "foo://localhost", |
|  |  | }, |
|  |  | HTTP\_AUTHORIZATION=f"Basic {header}", |
|  |  | ) |
|  |  | self.assertJSONEqual( |
|  |  | response.content, |
|  |  | {"error": "invalid\_request", "error\_description": "The request is otherwise malformed"}, |
|  |  | ) |
|  |  | self.assertEqual(response.status\_code, 400) |
|  |  |  |
|  |  | def test\_pkce\_correct\_s256(self): |
|  |  | """Test full with pkce""" |
|  |  | flow = create\_test\_flow() |
|  |  | provider = OAuth2Provider.objects.create( |
|  |  | name=generate\_id(), |
|  |  | client\_id="test", |
|  |  | authorization\_flow=flow, |
|  |  | redirect\_uris="foo://localhost", |
|  |  | access\_code\_validity="seconds=100", |
|  |  | ) |
|  |  | Application.objects.create(name="app", slug="app", provider=provider) |
|  |  | state = generate\_id() |
|  |  | user = create\_test\_admin\_user() |
|  |  | self.client.force\_login(user) |
|  |  | verifier = generate\_id() |
|  |  | challenge = ( |
|  |  | urlsafe\_b64encode(sha256(verifier.encode("ascii")).digest()) |
|  |  | .decode("utf-8") |
|  |  | .replace("=", "") |
|  |  | ) |
|  |  | header = b64encode(f"{provider.client\_id}:{provider.client\_secret}".encode()).decode() |
|  |  | # Step 1, initiate params and get redirect to flow |
|  |  | self.client.get( |
|  |  | reverse("authentik\_providers\_oauth2:authorize"), |
|  |  | data={ |
|  |  | "response\_type": "code", |
|  |  | "client\_id": "test", |
|  |  | "state": state, |
|  |  | "redirect\_uri": "foo://localhost", |
|  |  | "code\_challenge": challenge, |
|  |  | "code\_challenge\_method": "S256", |
|  |  | }, |
|  |  | ) |
|  |  | response = self.client.get( |
|  |  | reverse("authentik\_api:flow-executor", kwargs={"flow\_slug": flow.slug}), |
|  |  | ) |
|  |  | code: AuthorizationCode = AuthorizationCode.objects.filter(user=user).first() |
|  |  | self.assertJSONEqual( |
|  |  | response.content.decode(), |
|  |  | { |
|  |  | "component": "xak-flow-redirect", |
|  |  | "type": ChallengeTypes.REDIRECT.value, |
|  |  | "to": f"foo://localhost?code={code.code}&state={state}", |
|  |  | }, |
|  |  | ) |
|  |  | response = self.client.post( |
|  |  | reverse("authentik\_providers\_oauth2:token"), |
|  |  | data={ |
|  |  | "grant\_type": GRANT\_TYPE\_AUTHORIZATION\_CODE, |
|  |  | "code": code.code, |
|  |  | "code\_verifier": verifier, |
|  |  | "redirect\_uri": "foo://localhost", |
|  |  | }, |
|  |  | HTTP\_AUTHORIZATION=f"Basic {header}", |
|  |  | ) |
|  |  | self.assertEqual(response.status\_code, 200) |
|  |  |  |
|  |  | def test\_pkce\_correct\_plain(self): |
|  |  | """Test full with pkce""" |
|  |  | flow = create\_test\_flow() |
|  |  | provider = OAuth2Provider.objects.create( |
|  |  | name=generate\_id(), |
|  |  | client\_id="test", |
|  |  | authorization\_flow=flow, |
|  |  | redirect\_uris="foo://localhost", |
|  |  | access\_code\_validity="seconds=100", |
|  |  | ) |
|  |  | Application.objects.create(name="app", slug="app", provider=provider) |
|  |  | state = generate\_id() |
|  |  | user = create\_test\_admin\_user() |
|  |  | self.client.force\_login(user) |
|  |  | verifier = generate\_id() |
|  |  | header = b64encode(f"{provider.client\_id}:{provider.client\_secret}".encode()).decode() |
|  |  | # Step 1, initiate params and get redirect to flow |
|  |  | self.client.get( |
|  |  | reverse("authentik\_providers\_oauth2:authorize"), |
|  |  | data={ |
|  |  | "response\_type": "code", |
|  |  | "client\_id": "test", |
|  |  | "state": state, |
|  |  | "redirect\_uri": "foo://localhost", |
|  |  | "code\_challenge": verifier, |
|  |  | }, |
|  |  | ) |
|  |  | response = self.client.get( |
|  |  | reverse("authentik\_api:flow-executor", kwargs={"flow\_slug": flow.slug}), |
|  |  | ) |
|  |  | code: AuthorizationCode = AuthorizationCode.objects.filter(user=user).first() |
|  |  | self.assertJSONEqual( |
|  |  | response.content.decode(), |
|  |  | { |
|  |  | "component": "xak-flow-redirect", |
|  |  | "type": ChallengeTypes.REDIRECT.value, |
|  |  | "to": f"foo://localhost?code={code.code}&state={state}", |
|  |  | }, |
|  |  | ) |
|  |  | response = self.client.post( |
|  |  | reverse("authentik\_providers\_oauth2:token"), |
|  |  | data={ |
|  |  | "grant\_type": GRANT\_TYPE\_AUTHORIZATION\_CODE, |
|  |  | "code": code.code, |
|  |  | "code\_verifier": verifier, |
|  |  | "redirect\_uri": "foo://localhost", |
|  |  | }, |
|  |  | HTTP\_AUTHORIZATION=f"Basic {header}", |
|  |  | ) |
|  |  | self.assertEqual(response.status\_code, 200) |

5 changes: 4 additions & 1 deletion

5
[authentik/providers/oauth2/views/token.py](#diff-cfa6353328ef6a4968d1a52e936b3d57f8293aad3aca5c0384ad9511be1a40ec "authentik/providers/oauth2/views/token.py")

Show comments

[View file](/goauthentik/authentik/blob/3af77ab3821fe9c7df8055ba5eade3d1ecea03a6/authentik/providers/oauth2/views/token.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -221,7 +221,10 @@ def \_\_post\_init\_code(self, raw\_code: str, request: HttpRequest): |
|  |  | raise TokenError("invalid\_grant") |
|  |  |  |
|  |  | # Validate PKCE parameters. |
|  |  | if self.code\_verifier: |
|  |  | if self.authorization\_code.code\_challenge: |
|  |  | # Authorization code had PKCE but we didn't get one |
|  |  | if not self.code\_verifier: |
|  |  | raise TokenError("invalid\_request") |
|  |  | if self.authorization\_code.code\_challenge\_method == PKCE\_METHOD\_S256: |
|  |  | new\_code\_challenge = ( |
|  |  | urlsafe\_b64encode(sha256(self.code\_verifier.encode("ascii")).digest()) |
| Expand Down | |  |

61 changes: 61 additions & 0 deletions

61
[website/docs/security/CVE-2023-48228.md](#diff-38a68bbd99d4a929fc53d23f7b7b1b82d054a4c827f88d6b573857a9413b347f "website/docs/security/CVE-2023-48228.md")

Show comments

[View file](/goauthentik/authentik/blob/3af77ab3821fe9c7df8055ba5eade3d1ecea03a6/website/docs/security/CVE-2023-48228.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1,61 @@ |
|  |  | # CVE-2023-48228 |
|  |  |  |
|  |  | \_Reported by [@Sapd](https://github.com/Sapd)\_ |
|  |  |  |
|  |  | ## OAuth2: Insufficient PKCE check |
|  |  |  |
|  |  | ### Summary |
|  |  |  |
|  |  | When initialising a OAuth2 flow with a `code\_challenge` and `code\_method` (thus requesting PKCE), the SSO provider (authentik) \*\*must\*\* check if there is a matching \*\*and\*\* existing `code\_verifier` during the token step. |
|  |  |  |
|  |  | authentik checks if the contents of code\*verifier is matching \\*\\*\\_ONLY\*\\*\\* when it is provided. When it is left out completely, authentik simply accepts the token request with out it; even when the flow was started with a `code\_challenge`. |
|  |  |  |
|  |  | ### Patches |
|  |  |  |
|  |  | authentik 2023.8.5 and 2023.10.4 fix this issue. |
|  |  |  |
|  |  | ### Details |
|  |  |  |
|  |  | The `code\_verifier` is only checked when the user provides it. Note that in line 209 there is a check if the code\_parameter is left out. But there is no check if the PKCE parameter simply was omitted WHEN the request was started with a `code\_challenge\_method`. |
|  |  |  |
|  |  | This oversight likely did not stem from a coding error but from a misinterpretation of the RFC, where the backward compatibility section may be somewhat confusing. |
|  |  | https://datatracker.ietf.org/doc/html/rfc7636#section-4.5 |
|  |  | RFC7636 explicitly says in Section 4.5: |
|  |  |  |
|  |  | > The "code\_challenge\_method" is bound to the Authorization Code when |
|  |  | > the Authorization Code is issued. That is the method that the token |
|  |  | > endpoint MUST use to verify the "code\_verifier". |
|  |  |  |
|  |  | Section 5, Compatibility |
|  |  |  |
|  |  | > Server implementations of this specification MAY accept OAuth2.0 |
|  |  | > clients that do not implement this extension. If the "code\_verifier" |
|  |  | > is not received from the client in the Authorization Request, servers |
|  |  | > supporting backwards compatibility revert to the OAuth 2.0 [[RFC6749](https://datatracker.ietf.org/doc/html/rfc6749)] |
|  |  | > protocol without this extension. |
|  |  |  |
|  |  | Section 5, Compatibility, allows server implementations of this specification to accept OAuth 2.0 clients that do not implement this extension. However, if a `code\_verifier` is not received from the client in the Authorization Request, servers that support backward compatibility should revert to the standard OAuth 2.0 protocol sans this extension (including all steps). |
|  |  |  |
|  |  | It should be noted that this does not mean that the `code\_verifier` check can be disregarded at any point if the initial request included `code\_challenge` or `code\_challenge\_method`. Since Authentik supports PKCE, it \*\*MUST\*\* verify the code\_verifier as described in Section 4.5 \*\*AND\*\* fail if it was not provided. |
|  |  |  |
|  |  | Ofc verification can be skipped if the original authorization request did not invoke PKCE (no `code\_challenge\_method` and no `code\_challenge`). |
|  |  |  |
|  |  | Failure to check the `code\_verifier` renders the PKCE flow ineffective. This vulnerability particularly endangers public or hybrid clients, as their `code` is deemed non-confidential. |
|  |  |  |
|  |  | While not explicitly stated in the standard, it is generally recommended that OAuth2 flows accepting public clients should enforce PKCE - at least when redirecting to a non HTTPS URL (like http or an app link). |
|  |  |  |
|  |  | ### Impact |
|  |  |  |
|  |  | The vulnerability poses a high risk to both public and hybrid clients. |
|  |  | When for example a mobile app implements oauth2, a malicious app can simply also register the same in-app-link (e.g. `mycoolapp://oauth2`) for the redirect callback URL, possibly receiving `code` during callback. With PKCE working, a malicious app would still receive a `code` but the `code` would not work without the correct unhashed code-challenge. |
|  |  | This is especially problematic, because authentik claims to support PKCE, and a developer can expect that the proper checks are in place. Note that app-links cannot be protected by HTTPS or similar mechanisms. |
|  |  |  |
|  |  | Note also that this vulnerability poses a threat to confidential clients. Many confidential clients act as a proxy for OAuth2 API requests, typically from mobile apps or single-page applications. These proxies relay `code\_challenge`, `code\_challenge\_method` (in auth request, which most libraries force and provide on default settings) and `code\_verifier` in the token request unchanged and supplement the CLIENT\_SECRET which only the relay knows. The relay can but does not have to check for an existing `code\_verifier` as the standard does not define that PKCE can be ignored on confidential clients during the token request when the client requested PKCE during the authorization request. |
|  |  |  |
|  |  | An attacker could potentially gain full access to the application. If the code grants access to an admin account, the confidentiality, integrity, and availability of that application are compromised. |
|  |  |  |
|  |  | ### For more information |
|  |  |  |
|  |  | If you have any questions or comments about this advisory: |
|  |  |  |
|  |  | - Email us at [security@goauthentik.io](mailto:security@goauthentik.io) |

1 change: 1 addition & 0 deletions

1
[website/sidebars.js](#diff-4caaf3187919c98f42856c140e32964b0829fc19165f3c989a6cd4ea088a7164 "website/sidebars.js")

Show comments

[View file](/goauthentik/authentik/blob/3af77ab3821fe9c7df8055ba5eade3d1ecea03a6/website/sidebars.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -362,6 +362,7 @@ const docsSidebar = { |
|  |  | }, |
|  |  | items: [ |
|  |  | "security/policy", |
|  |  | "security/CVE-2023-48228", |
|  |  | "security/GHSA-rjvp-29xq-f62w", |
|  |  | "security/CVE-2023-39522", |
|  |  | "security/CVE-2023-36456", |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `3af77ab`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoauthentik%2Fauthentik%2Fcommit%2F3af77ab3821fe9c7df8055ba5eade3d1ecea03a6) to comment.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.


