=== Content from docs.netgate.com_8d2538a6_20250115_090203.html ===
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512
=============================================================================
pfSense-SA-23\_11.webgui Security Advisory
pfSense
Topic: Authenticated Command Execution in the WebGUI
Category: pfSense Base System
Module: webgui
Announced: 2023-10-31
Credits: Joint researchers (Byeongcheol Choi, Jinyong Lee, PWNLAB@KHU)
Affects: pfSense Plus software versions <= 23.05.1
pfSense CE software versions <= 2.7.0
Corrected: 2023-09-25 14:59:01 UTC (pfSense Plus master, 23.09)
2023-09-25 14:59:01 UTC (pfSense CE master, 2.7.1)
0. Revision History
v1.1 2023-11-16 Updated with CE 2.7.1 release information
v1.0 2023-10-31 Initial SA draft
I. Background
pfSense® software is a free network firewall distribution based on the
FreeBSD operating system. The pfSense software distribution includes third-
party free software packages for additional functionality, and provides most of
the functionality of common commercial firewalls.
pfSense® Plus is the productized version of pfSense software from Netgate®,
previously referred to as pfSense Factory Edition (FE). It is available to
Netgate appliance and CSP customers.
The majority of users of pfSense software have never installed or used a stock
FreeBSD system. Unlike similar GNU/Linux-based firewall distributions, there
is no need for any UNIX knowledge. The command line is never used, and there
is no need to ever manually edit any rule sets. Instead, pfSense software
includes a web interface for the configuration of all included components.
Users familiar with commercial firewalls will quickly understand the web
interface, while those unfamiliar with commercial-grade firewalls may encounter
a short learning curve.
II. Problem Description
A potential authenticated arbitrary command execution vulnerability was found in
packet\_capture.php, a component of the pfSense Plus and pfSense CE software GUI.
When performing a packet capture on packet\_capture.php, the submitted POST
"count" or "length" values are not validated. Subsequently, the submitted values
are used in shell commands.
This problem is present on pfSense Plus version 23.05.1, pfSense CE version
2.7.0, and earlier versions of both.
III. Impact
Due to a lack of escaping on commands in the functions being called, it is
possible to execute arbitrary commands with a properly formatted submission
value for "count" or "length" in POST operations.
The user must be logged in and have sufficient privileges to access
either packet\_capture.php.
IV. Workaround
To help mitigate the problem on older releases, use one or more of the
following:
\* Limit access to the affected pages to trusted administrators only.
\* Do not log into the firewall with the same browser used for non-
administrative web browsing.
V. Solution
Users can upgrade to pfSense Plus software version 23.09 or later, or pfSense CE
software version 2.7.1 or later. This upgrade may be performed in the web
interface or from the console.
See https://docs.netgate.com/pfsense/en/latest/install/upgrade-guide.html
Users on pfSense Plus version 23.05.1 and pfSense CE version 2.7.0 may apply the
fix from the recommended patches list in the System Patches package.
Users may also manually apply the relevant revisions below using the System
Patches package on earlier versions, or by manually making similar changes to
the affected files if the patches do not apply directly.
See https://docs.netgate.com/pfsense/en/latest/development/system-patches.html
VI. Correction details
The following list contains the correction revision commit ID for each
affected item.
Branch/path Revision
- - -------------------------------------------------------------------------
plus/plus-master f72618c4abb61ea6346938d0c93df9078736b775
pfSense/master f72618c4abb61ea6346938d0c93df9078736b775
- - -------------------------------------------------------------------------
VII. References
The latest revision of this advisory is available at
-----BEGIN PGP SIGNATURE-----
iQIzBAEBCgAdFiEE40XvjEU56XSUPIMdE7mH/ZIU+NoFAmVWgnEACgkQE7mH/ZIU
+NpF3BAA1dmzScj6U5R3+GFp8SuxLD4oSnLw9choSK6du8VNZiCyEgtZjEH1+x6K
HGXGs6gYsg/1703fOP3l+mHtEYpkLRuYaYylVNISTMT4n8ttVkNXGr2yGkYWbkvY
Hku5Q4j4AeR4MtY76MSoCrV7F4jkCYjGBNQ2ATR2AO7y1+wJDShcSUI2xLhwRE9l
Pni9aT78/J15405ybB8tddboW6vvDMQyXomXWJ31Oy8JbU9sQ0yv4YIJNU6RwTD9
iUCuDFzaD6/zSQYJOGa76iZYOdC++/RPXpvc/AuwrkUgYK2RN5/b6DpyfPqk1Afj
hhHa4IvuqF/H8JCVtwFhjanO08zuv4VWnefZ7kqnEqNTHoZDXj8JVpk5oVNRJymH
LZ1wCU/MJE1N1sLWh3B8K8TWCLylZzYUEG7yIX9Vjy6B3Ay2itmw2/kWQCG7P70k
aj4HqqiJUeekBWtzRNABs5Kxk70NwQlExNLUB8hxLVEcNQl1f2QT3nqmt2ADG5oL
x/iTp9QHmY51rFYJ4V08ImeKJNpOQRes3Wm1hAEmqCdibCXagXEWIgemAGVg+QQR
SQBCE5ajbRwP8uZ7I7nRyTaocwh8RCoiuPTMP49sSfz4beOWC91ozRX/GRGbbvd1
LqMLWXsqYc0chjay4Y+yxUnzP1BlRUPPQb4aD99g9wb3o1+Y6eY=
=Yzy9
-----END PGP SIGNATURE-----


=== Content from redmine.pfsense.org_621f0672_20250115_090205.html ===


⚲

### Project

### General

### Profile

* [Sign in](/login)
* [Register](/account/register)

* [Home](/)
* [Projects](/projects)
* [Help](https://www.redmine.org/guide)

[Search](/projects/pfsense/search?scope=subprojects):

 pfSense[All Projects](/projects?jump=issues)
# pfSense

* [Overview](/projects/pfsense)
* [Activity](/projects/pfsense/activity)
* [Roadmap](/projects/pfsense/roadmap)
* [Issues](/projects/pfsense/issues)
* [Gantt](/projects/pfsense/issues/gantt)
* [Calendar](/projects/pfsense/issues/calendar)
* [News](/projects/pfsense/news)
* [Documents](/projects/pfsense/documents)
* [Repository](/projects/pfsense/repository)

### Custom queries

* [2.7.0 - Resolved/Closed](/projects/pfsense/issues?query_id=218)
* [2.7.1 - All Open Issues](/projects/pfsense/issues?query_id=250)
* [2.7.1 - Resolved/Closed](/projects/pfsense/issues?query_id=249)
* [2.7.2 - Resolved/Closed](/projects/pfsense/issues?query_id=254)
* [2.8.0 - All Open Bugs](/projects/pfsense/issues?query_id=164)
* [2.8.0 - All Open Features](/projects/pfsense/issues?query_id=161)
* [2.8.0 - All Open Issues](/projects/pfsense/issues?query_id=165)
* [2.8.0 - All Open Regressions](/projects/pfsense/issues?query_id=108)
* [2.8.0 - Feedback](/projects/pfsense/issues?query_id=105)
* [2.8.0 - Needs Attention](/projects/pfsense/issues?query_id=244)
* [2.8.0 - New/Confirmed](/projects/pfsense/issues?query_id=106)
* [2.8.0 - Pull Requests](/projects/pfsense/issues?query_id=142)
* [2.8.0 - Regressions affecting 2.7.0](/projects/pfsense/issues?query_id=202)
* [2.8.0 - Resolved/Closed](/projects/pfsense/issues?query_id=245)
* [23.01 Plus - All Closed Issues](/projects/pfsense/issues?query_id=224)
* [23.01 Target - All Closed Issues](/projects/pfsense/issues?query_id=223)
* [23.05 Plus - All Closed Issues](/projects/pfsense/issues?query_id=232)
* [23.05 Target - All Closed Issues](/projects/pfsense/issues?query_id=233)
* [23.05.1 Plus - All Closed Issues](/projects/pfsense/issues?query_id=240)
* [23.05.1 Target - All Closed Issues](/projects/pfsense/issues?query_id=239)
* [23.09 Plus - All Closed Issues](/projects/pfsense/issues?query_id=236)
* [23.09 Target - All Closed Issues](/projects/pfsense/issues?query_id=235)
* [23.09.1 Plus - All Closed Issues](/projects/pfsense/issues?query_id=255)
* [23.09.1 Target - All Closed Issues](/projects/pfsense/issues?query_id=257)
* [24.03 Plus - All Closed Issues](/projects/pfsense/issues?query_id=251)
* [24.03 Target - All Closed Issues](/projects/pfsense/issues?query_id=252)
* [24.11 Plus - All Closed Issues](/projects/pfsense/issues?query_id=259)
* [24.11 Target - All Closed Issues](/projects/pfsense/issues?query_id=260)
* [25.03 Plus - All Closed Issues](/projects/pfsense/issues?query_id=262)
* [25.03 Plus - All Open Issues](/projects/pfsense/issues?query_id=263)
* [25.03 Plus - Feedback Issues](/projects/pfsense/issues?query_id=264)
* [25.03 Plus - Needs Attention/Work](/projects/pfsense/issues?query_id=265)
* [25.03 Plus - New/Confirmed/In Progress Issues](/projects/pfsense/issues?query_id=266)
* [25.03 Plus - Pull Request Review](/projects/pfsense/issues?query_id=190)
* [25.03 Plus - Waiting on Merge](/projects/pfsense/issues?query_id=189)
* [25.03 Target - All Closed Issues](/projects/pfsense/issues?query_id=267)
* [25.03 Target - All Open Issues](/projects/pfsense/issues?query_id=268)
* [All Open Issues assigned to Me](/projects/pfsense/issues?query_id=57)
* [All Open Pull Requests](/projects/pfsense/issues?query_id=143)
* [Any Target - All Open Regressions](/projects/pfsense/issues?query_id=170)
* [Any Target - Feedback Issues](/projects/pfsense/issues?query_id=100)
* [CE-Next - All Closed Issues (Move to specific target)](/projects/pfsense/issues?query_id=171)
* [CE-Next - All Open Issues](/projects/pfsense/issues?query_id=167)
* [CE-Next - Feedback (Likely needs target changed)](/projects/pfsense/issues?query_id=181)
* [New Issues by Category - Future Target](/projects/pfsense/issues?query_id=137)
* [New Issues by Category - No Target](/projects/pfsense/issues?query_id=134)
* [New Issues by Category - No Target+Future](/projects/pfsense/issues?query_id=138)
* [No Target - All Open Issues (Base Only)](/projects/pfsense/issues?query_id=34)
* [No Target - New Issues (Base Only)](/projects/pfsense/issues?query_id=33)
* [No Target - New Issues (Base and Packages)](/projects/pfsense/issues?query_id=27)
* [Release Notes - Plus Target Version (DO NOT EDIT)](/projects/pfsense/issues?query_id=191)
* [Release Notes - Target Version (DO NOT EDIT)](/projects/pfsense/issues?query_id=169)

Actions
Copy link
## Bug #14809

closed
![](https://www.gravatar.com/avatar/a2838b99a49c651ce36cd2b4307a50ba?rating=PG&size=50&default=identicon "Author: Jim Pingle")
![](https://www.gravatar.com/avatar/a2838b99a49c651ce36cd2b4307a50ba?rating=PG&size=22&default=identicon "Assignee: Jim Pingle")

### ``packet\_capture.php`` uses ``count`` and ``length`` values in command execution without validation or encoding

Added by [Jim Pingle](/users/10) [over 1 year](/projects/pfsense/activity?from=2023-09-25 "09/25/2023 02:53 PM") ago.
Updated [about 1 year](/projects/pfsense/activity?from=2023-11-06 "11/06/2023 04:12 PM") ago.

Status:ResolvedPriority:UrgentAssignee:[Jim Pingle](/users/10)Category:Packet CaptureTarget version:[2.7.1](/versions/78)Start date:Due date:% Done:

|  |
| --- |

100%

Estimated time:
Plus Target Version:23.09Release Notes:DefaultAffected Version:Affected Architecture:

---

**Description**

The `packet_capture.php` page uses the values of `count` and `length` when executing `tcpdump` and it doesn't validate that these parameters are the intended type or encode them before use.

The form type is set to 'number' but that client-side validation does not prevent clients from submitting invalid data.

Due to a lack of escaping on commands in the functions being called, it is possible to execute arbitrary commands with a properly formatted submission value for `$_POST['count']` or `$_POST['length']`.

* [History](/issues/14809?tab=history)
* [Notes](/issues/14809?tab=notes)
* [Property changes](/issues/14809?tab=properties)
* [Associated revisions](/issues/14809?tab=changesets)

ActionsCopy link
[#1](#note-1)
#### Updated by [Jim Pingle](/users/10) [over 1 year](/projects/pfsense/activity?from=2023-09-25 "09/25/2023 03:05 PM") ago

* **Status** changed from *Confirmed* to *Feedback*
* **% Done** changed from *0* to *100*

Applied in changeset [f72618c4abb61ea6346938d0c93df9078736b775](/projects/pfsense/repository/2/revisions/f72618c4abb61ea6346938d0c93df9078736b775 "Pcap: Validate+Encode count & length. Fixes #14809").

ActionsCopy link
[#2](#note-2)
#### Updated by [Marcos M](/users/31968) [about 1 year](/projects/pfsense/activity?from=2023-10-17 "10/17/2023 12:43 AM") ago

* **Status** changed from *Feedback* to *Resolved*

ActionsCopy link
[#3](#note-3)
#### Updated by [Jim Pingle](/users/10) [about 1 year](/projects/pfsense/activity?from=2023-11-06 "11/06/2023 03:22 PM") ago

* **Target version** changed from *2.8.0* to *2.7.1*

ActionsCopy link
[#4](#note-4)
#### Updated by [Jim Pingle](/users/10) [about 1 year](/projects/pfsense/activity?from=2023-11-06 "11/06/2023 04:12 PM") ago

* **Category** changed from *Diagnostics* to *Packet Capture*
* **Private** changed from *Yes* to *No*

Actions
Copy link

Also available in: [Atom](/issues/14809.atom)
[PDF](/issues/14809.pdf)

Powered by [Redmine](https://www.redmine.org/) © 2006-2023 Jean-Philippe Lang

Loading...



=== Content from github.com_9d4de12c_20250115_090204.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpfsense%2Fpfsense%2Fcommit%2Ff72618c4abb61ea6346938d0c93df9078736b775)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpfsense%2Fpfsense%2Fcommit%2Ff72618c4abb61ea6346938d0c93df9078736b775)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=pfsense%2Fpfsense)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[pfsense](/pfsense)
/
**[pfsense](/pfsense/pfsense)**
Public

* [Notifications](/login?return_to=%2Fpfsense%2Fpfsense) You must be signed in to change notification settings
* [Fork
  1.5k](/login?return_to=%2Fpfsense%2Fpfsense)
* [Star
   5k](/login?return_to=%2Fpfsense%2Fpfsense)

* [Code](/pfsense/pfsense)
* [Pull requests
  39](/pfsense/pfsense/pulls)
* [Actions](/pfsense/pfsense/actions)
* [Projects
  0](/pfsense/pfsense/projects)
* [Security](/pfsense/pfsense/security)
* [Insights](/pfsense/pfsense/pulse)

Additional navigation options

* [Code](/pfsense/pfsense)
* [Pull requests](/pfsense/pfsense/pulls)
* [Actions](/pfsense/pfsense/actions)
* [Projects](/pfsense/pfsense/projects)
* [Security](/pfsense/pfsense/security)
* [Insights](/pfsense/pfsense/pulse)

## Commit

[Permalink](/pfsense/pfsense/commit/f72618c4abb61ea6346938d0c93df9078736b775)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Pcap: Validate+Encode count & length. Fixes #14809

[Browse files](/pfsense/pfsense/tree/f72618c4abb61ea6346938d0c93df9078736b775)
Browse the repository at this point in the history

* Loading branch information

[![@jim-p](https://avatars.githubusercontent.com/u/174434?s=40&v=4)](/jim-p)

[jim-p](/pfsense/pfsense/commits?author=jim-p "View all commits by jim-p")
committed
Sep 25, 2023

1 parent
[c81ecaf](/pfsense/pfsense/commit/c81ecafefa53aab27143fce4022cd8b01c9fd072)

commit f72618c

Showing
**1 changed file**
with
**14 additions**
and
**4 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

18 changes: 14 additions & 4 deletions

18
[src/usr/local/www/diag\_packet\_capture.php](#diff-01f5340c4ed0716a346c56c8ee9d3c2b953a99d373bec09117399cee10f23edc "src/usr/local/www/diag_packet_capture.php")

Show comments

[View file](/pfsense/pfsense/blob/f72618c4abb61ea6346938d0c93df9078736b775/src/usr/local/www/diag_packet_capture.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -119,10 +119,20 @@ |
|  |  | $input\_filter = ($\_POST['filter'] !== null) ? intval($\_POST['filter']) : null; |
|  |  | if ($\_POST['count'] == '0') { |
|  |  | $input\_count = 0; |
|  |  | } elseif (empty($\_POST['count'])) { |
|  |  | $input\_count = 1000; |
|  |  | } elseif (!is\_numericint($\_POST['count'])) { |
|  |  | $input\_error[] = 'Invalid Packet Count.'; |
|  |  | } else { |
|  |  | $input\_count = empty($\_POST['count']) ? 1000 : $\_POST['count']; |
|  |  | $input\_count = intval($\_POST['count']); |
|  |  | } |
|  |  | if (empty($\_POST['length'])) { |
|  |  | $input\_length = 0; |
|  |  | } elseif (!is\_numericint($\_POST['length'])) { |
|  |  | $input\_error[] = 'Invalid Packet Length.'; |
|  |  | } else { |
|  |  | $input\_length = intval($\_POST['length']); |
|  |  | } |
|  |  | $input\_length = empty($\_POST['length']) ? 0 : $\_POST['length']; |
|  |  | $input\_promiscuous = empty($\_POST['promiscuous']) ? false : $\_POST['promiscuous']; |
|  |  | // view options |
|  |  | $input\_viewdetail = empty($\_POST['viewdetail']) ? 'normal' : $\_POST['viewdetail']; |
| Expand Down  Expand Up | | @@ -759,8 +769,8 @@ |
|  |  |  |
|  |  | // Handle capture options |
|  |  | $cmd\_part\_promiscuous = $input\_promiscuous ? '' : ' -p'; |
|  |  | $cmd\_part\_count = empty($input\_count) ? '' : " -c {$input\_count}"; |
|  |  | $cmd\_part\_length = empty($input\_length) ? '' : " -s {$input\_length}"; |
|  |  | $cmd\_part\_count = empty($input\_count) ? '' : " -c " . escapeshellarg($input\_count); |
|  |  | $cmd\_part\_length = empty($input\_length) ? '' : " -s " . escapeshellarg($input\_length); |
|  |  | $cmd\_expression\_string = $expression\_string ? escapeshellarg($expression\_string) : ''; |
|  |  |  |
|  |  | /\* Output in binary format (use packet-buffered to avoid missing packets) to stdout, |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `f72618c`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpfsense%2Fpfsense%2Fcommit%2Ff72618c4abb61ea6346938d0c93df9078736b775) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


