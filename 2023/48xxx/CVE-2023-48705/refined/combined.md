=== Content from github.com_c3038cca_20250114_223842.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fcommit%2F54abe23331b6c3d0d82bf1b028c679b1d200920d)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fcommit%2F54abe23331b6c3d0d82bf1b028c679b1d200920d)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=nautobot%2Fnautobot)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[nautobot](/nautobot)
/
**[nautobot](/nautobot/nautobot)**
Public

* [Notifications](/login?return_to=%2Fnautobot%2Fnautobot) You must be signed in to change notification settings
* [Fork
  298](/login?return_to=%2Fnautobot%2Fnautobot)
* [Star
   1.1k](/login?return_to=%2Fnautobot%2Fnautobot)

* [Code](/nautobot/nautobot)
* [Issues
  863](/nautobot/nautobot/issues)
* [Pull requests
  24](/nautobot/nautobot/pulls)
* [Discussions](/nautobot/nautobot/discussions)
* [Actions](/nautobot/nautobot/actions)
* [Projects
  0](/nautobot/nautobot/projects)
* [Wiki](/nautobot/nautobot/wiki)
* [Security](/nautobot/nautobot/security)
* [Insights](/nautobot/nautobot/pulse)

Additional navigation options

* [Code](/nautobot/nautobot)
* [Issues](/nautobot/nautobot/issues)
* [Pull requests](/nautobot/nautobot/pulls)
* [Discussions](/nautobot/nautobot/discussions)
* [Actions](/nautobot/nautobot/actions)
* [Projects](/nautobot/nautobot/projects)
* [Wiki](/nautobot/nautobot/wiki)
* [Security](/nautobot/nautobot/security)
* [Insights](/nautobot/nautobot/pulse)

## Commit

[Permalink](/nautobot/nautobot/commit/54abe23331b6c3d0d82bf1b028c679b1d200920d)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[2.0] Fix unsafe `mark_safe` use in various features ([#4832](https://github.com/nautobot/nautobot/pull/4832))

[Browse files](/nautobot/nautobot/tree/54abe23331b6c3d0d82bf1b028c679b1d200920d)
Browse the repository at this point in the history

```
* Audit all uses of mark_safe() and change to format_html() where appropriate

* Test updates and change fragment

* Add ruff for linting, add S308 disables to audited code

* Test fixes

* Update change fragments

* One more change fragment

---------
```

* Loading branch information

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

[glennmatthews](/nautobot/nautobot/commits?author=glennmatthews "View all commits by glennmatthews")
authored
Nov 21, 2023

1 parent
[d151929](/nautobot/nautobot/commit/d1519295f0abd840e38c7dd8ec481e4ccf2264fe)

commit 54abe23

 Show file tree

 Hide file tree

Showing
**31 changed files**
with
**542 additions**
and
**228 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* .github/workflows

  + .github/workflows/ci\_pullrequest.yml
    [ci\_pullrequest.yml](#diff-755f5eaf4b3876800d7e11ae9753a8cacf8d1b6ae7ff6f18619fa4030e4d25e5)
* changes

  + changes/4832.changed
    [4832.changed](#diff-2e3cf7bb45c7ebbf366c3671567f33e6995bc88dec1e8ee6edec486af620a638)
  + changes/4832.housekeeping
    [4832.housekeeping](#diff-45b95e1c34fa6409e6cfc2de96cd85cabefff845999904bf9299a33e18f340b5)
  + changes/4832.security
    [4832.security](#diff-da053936bd44774a998b9fadb2a208962298901e07621d0594b0c296e91ce114)
* nautobot

  + core

    - nautobot/core/settings.py
      [settings.py](#diff-6c6cc147c8188d94be8fd3b11345aa4bfef52a760e0961643b6b84d0c26da43a)
    - nautobot/core/tables.py
      [tables.py](#diff-beaf93ca10d047aa03ff73b83b869568163963f57fb65edb09ce777447a8d476)
    - templatetags

      * nautobot/core/templatetags/helpers.py
        [helpers.py](#diff-e2d6debf2c7892bab088f1ac872e538b659b456f37081f1d41bdbc739b17f265)
    - utils

      * nautobot/core/utils/data.py
        [data.py](#diff-7396fcbe9612074e76906018a34dde1e5b08b36690f5a49b2d9aae7fe947d225)
    - views

      * nautobot/core/views/generic.py
        [generic.py](#diff-6d6d85115c2145f877fca192b072690e4d8945d576ca00bff5ad903cce84c2bc)
      * nautobot/core/views/mixins.py
        [mixins.py](#diff-4932b9507690a60fb07d0e2a2dbb48547dfe5c78dc55985ff4dfddb31c84a5bd)
      * nautobot/core/views/utils.py
        [utils.py](#diff-926d1d2e78d4acf2d2079289e364fdf2a858fb0ebd38017af7619821d386ba09)
  + dcim

    - models

      * nautobot/dcim/models/devices.py
        [devices.py](#diff-2c74010b539b5fc10880ede3276b50f7af7309db6161e970293b265eebc83a47)
    - nautobot/dcim/views.py
      [views.py](#diff-292c4e491fa8d2a6b999f52af45f55576703202fa9bd731438c815c0af769af5)
  + extras

    - models

      * nautobot/extras/models/customfields.py
        [customfields.py](#diff-8d1c47fce517d61985f7f5a7ae57a557cfd35f185221ff4fd5a73bececcad429)
      * nautobot/extras/models/models.py
        [models.py](#diff-843f33404e733176805c25c9171af4af6152b4d06d09c5d214c3e75aaed81d9b)
      * nautobot/extras/models/relationships.py
        [relationships.py](#diff-615dda0e4c9f976e01dc9a484d722a229fc9755d0d6c0197f9aef3285d70db20)
    - nautobot/extras/tables.py
      [tables.py](#diff-f807218a521768366c9dea654100684163410328fd1493f6110f0aa35cb1c401)
    - templatetags

      * nautobot/extras/templatetags/computed\_fields.py
        [computed\_fields.py](#diff-015a814fade1055e106fde4d4d9166b8998bb4c547c775965a327c0fa568fa78)
      * nautobot/extras/templatetags/custom\_links.py
        [custom\_links.py](#diff-04c88c8818dd15f9ad5cfa92af258f45356b9b7b119a730c991936160a3d5fe6)
      * nautobot/extras/templatetags/job\_buttons.py
        [job\_buttons.py](#diff-666d45365d47ee0a33a96a8e0279b8b9baac487b3f9ee8dd9ebb05add5e1d090)
      * nautobot/extras/templatetags/plugins.py
        [plugins.py](#diff-264c777d80696692772a446da3907fa637904e2b2a237a09a8e1f504b5dc861a)
    - tests

      * nautobot/extras/tests/test\_customfields.py
        [test\_customfields.py](#diff-8bd6d9808e1f0ae1ceb512f17c5431c2c2ab9ed78661648d683a2952bb1b0423)
      * nautobot/extras/tests/test\_relationships.py
        [test\_relationships.py](#diff-642a4ecf9a4811dd933b3b3d0270926848a6d063cbd3544288908ddd547d8f6e)
      * nautobot/extras/tests/test\_views.py
        [test\_views.py](#diff-63390a9316fbabcd9c87d7ea0980d9ff2738d5da7d7def31e8f152d5fcf92996)
    - nautobot/extras/views.py
      [views.py](#diff-6dd19ea99cb9defb4b43f5c663a2d2e13821f93e1429b6b372452c1ec3eb06c4)
  + ipam

    - nautobot/ipam/tables.py
      [tables.py](#diff-021d8b804e061261cd8b357ff540dd4730b04eef1ca56f0247ca38adcf6c0cd1)
    - nautobot/ipam/views.py
      [views.py](#diff-caf8a412a9f30295cacfae888c0fbc1bdc2a7cd2643df55f444414f363113a7b)
* poetry.lock
  [poetry.lock](#diff-f53a023eedfa3fbf2925ec7dc76eecdc954ea94b7e47065393dbad519613dc89)
* pyproject.toml
  [pyproject.toml](#diff-50c86b7ed8ac2cf95bd48334961bf0530cdc77b5a56f852c5c61b89d735fd711)
* scripts/git-hooks

  + scripts/git-hooks/pre-commit
    [pre-commit](#diff-da4be731d6349b2a4095c9ae97de522ca4c10df6c5a9e7b73ffb3559b0ced959)
* tasks.py
  [tasks.py](#diff-2e746c9eacad6e2c2fdefdc6a665b5ce4607ea384ebf97a729044b79acc778d6)

## There are no files selected for viewing

17 changes: 17 additions & 0 deletions

17
[.github/workflows/ci\_pullrequest.yml](#diff-755f5eaf4b3876800d7e11ae9753a8cacf8d1b6ae7ff6f18619fa4030e4d25e5 ".github/workflows/ci_pullrequest.yml")

Show comments

[View file](/nautobot/nautobot/blob/54abe23331b6c3d0d82bf1b028c679b1d200920d/.github/workflows/ci_pullrequest.yml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -31,6 +31,17 @@ jobs: |
|  |  | uses: "networktocode/gh-action-setup-poetry-environment@v2" |
|  |  | - name: "Linting: flake8" |
|  |  | run: "poetry run invoke flake8" |
|  |  | ruff: |
|  |  | runs-on: "ubuntu-20.04" |
|  |  | env: |
|  |  | INVOKE\_NAUTOBOT\_LOCAL: "True" |
|  |  | steps: |
|  |  | - name: "Check out repository code" |
|  |  | uses: "actions/checkout@v2" |
|  |  | - name: "Setup environment" |
|  |  | uses: "networktocode/gh-action-setup-poetry-environment@v2" |
|  |  | - name: "Linting: ruff" |
|  |  | run: "poetry run invoke ruff --output-format github" |
|  |  | prettier: |
|  |  | runs-on: "ubuntu-20.04" |
|  |  | env: |
| Expand Down  Expand Up | | @@ -212,6 +223,7 @@ jobs: |
|  |  | - "flake8" |
|  |  | - "hadolint" |
|  |  | - "markdownlint" |
|  |  | - "ruff" |
|  |  | - "yamllint" |
|  |  | tests-mysql: |
|  |  | name: "Unit tests (MySQL and Python 3.11)" |
| Expand Down  Expand Up | | @@ -262,6 +274,7 @@ jobs: |
|  |  | - "flake8" |
|  |  | - "hadolint" |
|  |  | - "markdownlint" |
|  |  | - "ruff" |
|  |  | - "yamllint" |
|  |  | tests-ui: |
|  |  | runs-on: "ubuntu-20.04" |
| Expand Down  Expand Up | | @@ -332,6 +345,7 @@ jobs: |
|  |  | - "flake8" |
|  |  | - "hadolint" |
|  |  | - "markdownlint" |
|  |  | - "ruff" |
|  |  | - "yamllint" |
|  |  | migration-tests-postgres: |
|  |  | name: "Run migrations against test dataset (PostgreSQL and Python 3.11)" |
| Expand Down  Expand Up | | @@ -373,6 +387,7 @@ jobs: |
|  |  | - "flake8" |
|  |  | - "hadolint" |
|  |  | - "markdownlint" |
|  |  | - "ruff" |
|  |  | - "yamllint" |
|  |  | integration-test: |
|  |  | runs-on: "ubuntu-20.04" |
| Expand Down  Expand Up | | @@ -420,6 +435,7 @@ jobs: |
|  |  | - "flake8" |
|  |  | - "hadolint" |
|  |  | - "markdownlint" |
|  |  | - "ruff" |
|  |  | - "yamllint" |
|  |  | changelog: |
|  |  | if: contains(fromJson('["develop","next","develop-1.6"]'), github.base\_ref) |
| Expand All | | @@ -445,6 +461,7 @@ jobs: |
|  |  | - "flake8" |
|  |  | - "hadolint" |
|  |  | - "markdownlint" |
|  |  | - "ruff" |
|  |  | - "yamllint" |
|  |  | steps: |
|  |  | - name: "Check out repository code" |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[changes/4832.changed](#diff-2e3cf7bb45c7ebbf366c3671567f33e6995bc88dec1e8ee6edec486af620a638 "changes/4832.changed")

Show comments

[View file](/nautobot/nautobot/blob/54abe23331b6c3d0d82bf1b028c679b1d200920d/changes/4832.changed)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1 @@ |
|  |  | Changed the `render\_jinja2()` API to no longer automatically call `mark\_safe()` on the output. |

1 change: 1 addition & 0 deletions

1
[changes/4832.housekeeping](#diff-45b95e1c34fa6409e6cfc2de96cd85cabefff845999904bf9299a33e18f340b5 "changes/4832.housekeeping")

Show comments

[View file](/nautobot/nautobot/blob/54abe23331b6c3d0d82bf1b028c679b1d200920d/changes/4832.housekeeping)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1 @@ |
|  |  | Added `ruff` to invoke tasks and CI. |

1 change: 1 addition & 0 deletions

1
[changes/4832.security](#diff-da053936bd44774a998b9fadb2a208962298901e07621d0594b0c296e91ce114 "changes/4832.security")

Show comments

[View file](/nautobot/nautobot/blob/54abe23331b6c3d0d82bf1b028c679b1d200920d/changes/4832.security)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1 @@ |
|  |  | Fixed cross-site-scripting (XSS) potential with maliciously crafted Custom Links, Computed Fields, and Job Buttons (GHSA-cf9f-wmhp-v4pr). |

2 changes: 1 addition & 1 deletion

2
[nautobot/core/settings.py](#diff-6c6cc147c8188d94be8fd3b11345aa4bfef52a760e0961643b6b84d0c26da43a "nautobot/core/settings.py")

Show comments

[View file](/nautobot/nautobot/blob/54abe23331b6c3d0d82bf1b028c679b1d200920d/nautobot/core/settings.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -645,7 +645,7 @@ |
|  |  | ), |
|  |  | "NETWORK\_DRIVERS": ConstanceConfigItem( |
|  |  | default={}, |
|  |  | help\_text=mark\_safe( |
|  |  | help\_text=mark\_safe( # noqa: S308 |
|  |  | "Extend or override default Platform.network\_driver translations provided by " |
|  |  | '<a href="https://netutils.readthedocs.io/en/latest/user/lib\_use\_cases\_lib\_mapper/">netutils</a>. ' |
|  |  | "Enter a dictionary in JSON format, for example:\n" |
| Expand Down | |  |

57 changes: 26 additions & 31 deletions

57
[nautobot/core/tables.py](#diff-beaf93ca10d047aa03ff73b83b869568163963f57fb65edb09ce777447a8d476 "nautobot/core/tables.py")

Show comments

[View file](/nautobot/nautobot/blob/54abe23331b6c3d0d82bf1b028c679b1d200920d/nautobot/core/tables.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -4,7 +4,7 @@ |
|  |  | from django.core.exceptions import FieldDoesNotExist |
|  |  | from django.db.models.fields.related import RelatedField |
|  |  | from django.urls import reverse |
|  |  | from django.utils.html import escape, format\_html |
|  |  | from django.utils.html import escape, format\_html, format\_html\_join |
|  |  | from django.utils.safestring import mark\_safe |
|  |  | from django.utils.text import Truncator |
|  |  | import django\_tables2 |
| Expand Down  Expand Up | | @@ -162,7 +162,7 @@ def \_\_init\_\_(self, \*args, \*\*kwargs): |
|  |  |  |
|  |  | @property |
|  |  | def header(self): |
|  |  | return mark\_safe('<input type="checkbox" class="toggle" title="Toggle all" />') |
|  |  | return mark\_safe('<input type="checkbox" class="toggle" title="Toggle all" />') # noqa: S308 |
|  |  |  |
|  |  |  |
|  |  | class BooleanColumn(django\_tables2.Column): |
| Expand Down  Expand Up | | @@ -259,7 +259,7 @@ def render(self, record, bound\_column, value): # pylint: disable=arguments-diff |
|  |  | name = bound\_column.name |
|  |  | css\_class = getattr(record, f"get\_{name}\_class")() |
|  |  | label = getattr(record, f"get\_{name}\_display")() |
|  |  | return mark\_safe(f'<span class="label label-{css\_class}">{label}</span>') |
|  |  | return format\_html('<span class="label label-{}">{}</span>', css\_class, label) |
|  |  | return self.default |
|  |  |  |
|  |  |  |
| Expand All | | @@ -269,7 +269,7 @@ class ColorColumn(django\_tables2.Column): |
|  |  | """ |
|  |  |  |
|  |  | def render(self, value): |
|  |  | return mark\_safe(f'<span class="label color-block" style="background-color: #{value}">&nbsp;</span>') |
|  |  | return format\_html('<span class="label color-block" style="background-color: #{}">&nbsp;</span>', value) |
|  |  |  |
|  |  |  |
|  |  | class ColoredLabelColumn(django\_tables2.TemplateColumn): |
| Expand Down  Expand Up | | @@ -306,7 +306,7 @@ def render(self, record, value): # pylint: disable=arguments-differ |
|  |  | url = reverse(self.viewname, kwargs=self.view\_kwargs) |
|  |  | if self.url\_params: |
|  |  | url += "?" + "&".join([f"{k}={getattr(record, v)}" for k, v in self.url\_params.items()]) |
|  |  | return mark\_safe(f'<a href="{url}">{value}</a>') |
|  |  | return format\_html('<a href="{}">{}</a>', url, value) |
|  |  | return value |
|  |  |  |
|  |  |  |
| Expand Down  Expand Up | | @@ -393,20 +393,18 @@ def \_\_init\_\_(self, customfield, \*args, \*\*kwargs): |
|  |  | super().\_\_init\_\_(\*args, \*\*kwargs) |
|  |  |  |
|  |  | def render(self, record, bound\_column, value): # pylint: disable=arguments-differ |
|  |  | template = "" |
|  |  | if self.customfield.type == choices.CustomFieldTypeChoices.TYPE\_BOOLEAN: |
|  |  | template = helpers.render\_boolean(value) |
|  |  | elif self.customfield.type == choices.CustomFieldTypeChoices.TYPE\_MULTISELECT: |
|  |  | for v in value: |
|  |  | template += format\_html('<span class="label label-default">{}</span> ', v) |
|  |  | template = format\_html\_join(" ", '<span class="label label-default">{}</span>', ((v,) for v in value)) |
|  |  | elif self.customfield.type == choices.CustomFieldTypeChoices.TYPE\_SELECT: |
|  |  | template = format\_html('<span class="label label-default">{}</span>', value) |
|  |  | elif self.customfield.type == choices.CustomFieldTypeChoices.TYPE\_URL: |
|  |  | template = format\_html('<a href="{}">{}</a>', value, value) |
|  |  | else: |
|  |  | template = escape(value) |
|  |  |  |
|  |  | return mark\_safe(template) |
|  |  | return template |
|  |  |  |
|  |  |  |
|  |  | class RelationshipColumn(django\_tables2.Column): |
| Expand Down  Expand Up | | @@ -435,30 +433,27 @@ def render(self, record, value): # pylint: disable=arguments-differ |
|  |  | else: |
|  |  | value = [v for v in value if v.destination\_id == record.id] |
|  |  |  |
|  |  | template = "" |
|  |  | # Handle Symmetric Relationships |
|  |  | # List `value` could be empty here [] after the filtering from above |
|  |  | if len(value) < 1: |
|  |  | return "—" |
|  |  | else: |
|  |  | # Handle Relationships on the many side. |
|  |  | if self.relationship.has\_many(self.peer\_side): |
|  |  | v = value[0] |
|  |  | meta = type(v.get\_peer(record)).\_meta |
|  |  | name = meta.verbose\_name\_plural if len(value) > 1 else meta.verbose\_name |
|  |  | template += format\_html( |
|  |  | '<a href="{}?relationship={}&{}\_id={}">{} {}</a>', |
|  |  | reverse("extras:relationshipassociation\_list"), |
|  |  | self.relationship.key, |
|  |  | self.side, |
|  |  | record.id, |
|  |  | len(value), |
|  |  | name, |
|  |  | ) |
|  |  | # Handle Relationships on the one side. |
|  |  | else: |
|  |  | v = value[0] |
|  |  | peer = v.get\_peer(record) |
|  |  | template += format\_html('<a href="{}">{}</a>', peer.get\_absolute\_url(), peer) |
|  |  |  |
|  |  | return mark\_safe(template) |
|  |  | # Handle Relationships on the many side. |
|  |  | if self.relationship.has\_many(self.peer\_side): |
|  |  | v = value[0] |
|  |  | meta = type(v.get\_peer(record)).\_meta |
|  |  | name = meta.verbose\_name\_plural if len(value) > 1 else meta.verbose\_name |
|  |  | return format\_html( |
|  |  | '<a href="{}?relationship={}&{}\_id={}">{} {}</a>', |
|  |  | reverse("extras:relationshipassociation\_list"), |
|  |  | self.relationship.key, |
|  |  | self.side, |
|  |  | record.id, |
|  |  | len(value), |
|  |  | name, |
|  |  | ) |
|  |  | # Handle Relationships on the one side. |
|  |  | else: |
|  |  | v = value[0] |
|  |  | peer = v.get\_peer(record) |
|  |  | return format\_html('<a href="{}">{}</a>', peer.get\_absolute\_url(), peer) |

18 changes: 9 additions & 9 deletions

18
[nautobot/core/templatetags/helpers.py](#diff-e2d6debf2c7892bab088f1ac872e538b659b456f37081f1d41bdbc739b17f265 "nautobot/core/templatetags/helpers.py")

Show comments

[View file](/nautobot/nautobot/blob/54abe23331b6c3d0d82bf1b028c679b1d200920d/nautobot/core/templatetags/helpers.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -20,9 +20,9 @@ |
|  |  | from nautobot.core.utils import color, config, data, lookup |
|  |  | from nautobot.core.utils.navigation import is\_route\_new\_ui\_ready |
|  |  |  |
|  |  | HTML\_TRUE = '<span class="text-success"><i class="mdi mdi-check-bold" title="Yes"></i></span>' |
|  |  | HTML\_FALSE = '<span class="text-danger"><i class="mdi mdi-close-thick" title="No"></i></span>' |
|  |  | HTML\_NONE = '<span class="text-muted">&mdash;</span>' |
|  |  | HTML\_TRUE = mark\_safe('<span class="text-success"><i class="mdi mdi-check-bold" title="Yes"></i></span>') # noqa: S308 |
|  |  | HTML\_FALSE = mark\_safe('<span class="text-danger"><i class="mdi mdi-close-thick" title="No"></i></span>') # noqa: S308 |
|  |  | HTML\_NONE = mark\_safe('<span class="text-muted">&mdash;</span>') # noqa: S308 |
|  |  |  |
|  |  | DEFAULT\_SUPPORT\_MESSAGE = ( |
|  |  | "If further assistance is required, please join the `#nautobot` channel " |
| Expand Down  Expand Up | | @@ -99,7 +99,7 @@ def placeholder(value): |
|  |  | """ |
|  |  | if value: |
|  |  | return value |
|  |  | return mark\_safe(HTML\_NONE) |
|  |  | return HTML\_NONE |
|  |  |  |
|  |  |  |
|  |  | @library.filter() |
| Expand All | | @@ -123,7 +123,7 @@ def add\_html\_id(element\_str, id\_str): |
|  |  | match = re.match(r"^(.\*?<\w+) ?(.\*)$", element\_str, flags=re.DOTALL) |
|  |  | if not match: |
|  |  | return element\_str |
|  |  | return mark\_safe(match.group(1) + format\_html(' id="{}" ', id\_str) + match.group(2)) |
|  |  | return mark\_safe(match.group(1) + format\_html(' id="{}" ', id\_str) + match.group(2)) # noqa: S308 |
|  |  |  |
|  |  |  |
|  |  | @library.filter() |
| Expand Down  Expand Up | | @@ -154,10 +154,10 @@ def render\_boolean(value): |
|  |  | '<span class="text-danger"><i class="mdi mdi-close-thick" title="No"></i></span>' |
|  |  | """ |
|  |  | if value is None: |
|  |  | return mark\_safe(HTML\_NONE) |
|  |  | return HTML\_NONE |
|  |  | if bool(value): |
|  |  | return mark\_safe(HTML\_TRUE) |
|  |  | return mark\_safe(HTML\_FALSE) |
|  |  | return HTML\_TRUE |
|  |  | return HTML\_FALSE |
|  |  |  |
|  |  |  |
|  |  | @library.filter() |
| Expand All | | @@ -180,7 +180,7 @@ def render\_markdown(value): |
|  |  | # Render Markdown |
|  |  | html = markdown(value, extensions=["fenced\_code", "tables"]) |
|  |  |  |
|  |  | return mark\_safe(html) |
|  |  | return mark\_safe(html) # noqa: S308 |
|  |  |  |
|  |  |  |
|  |  | @library.filter() |
| Expand Down | |  |

6 changes: 5 additions & 1 deletion

6
[nautobot/core/utils/data.py](#diff-7396fcbe9612074e76906018a34dde1e5b08b36690f5a49b2d9aae7fe947d225 "nautobot/core/utils/data.py")

Show comments

[View file](/nautobot/nautobot/blob/54abe23331b6c3d0d82bf1b028c679b1d200920d/nautobot/core/utils/data.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -100,7 +100,11 @@ def render\_jinja2(template\_code, context): |
|  |  | """ |
|  |  | rendering\_engine = engines["jinja"] |
|  |  | template = rendering\_engine.from\_string(template\_code) |
|  |  | return template.render(context=context) |
|  |  | # For reasons unknown to me, django-jinja2 `template.render()` implicitly calls `mark\_safe()` on the rendered text. |
|  |  | # This is a security risk in general, especially so in our case because we're often using this function to render |
|  |  | # a user-provided template and don't want to open ourselves up to script injection or similar issues. |
|  |  | # There's no `mark\_unsafe()` function, but concatenating a SafeString to an ordinary string (even "") suffices. |
|  |  | return "" + template.render(context=context) |
|  |  |  |
|  |  |  |
|  |  | def shallow\_compare\_dict(source\_dict, destination\_dict, exclude=None): |
| Expand Down | |  |

13 changes: 6 additions & 7 deletions

13
[nautobot/core/views/generic.py](#diff-6d6d85115c2145f877fca192b072690e4d8945d576ca00bff5ad903cce84c2bc "nautobot/core/views/generic.py")

Show comments

[View file](/nautobot/nautobot/blob/54abe23331b6c3d0d82bf1b028c679b1d200920d/nautobot/core/views/generic.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -16,9 +16,8 @@ |
|  |  | from django.forms import Form, ModelMultipleChoiceField, MultipleHiddenInput |
|  |  | from django.http import HttpResponse, JsonResponse |
|  |  | from django.shortcuts import get\_object\_or\_404, redirect, render |
|  |  | from django.utils.html import escape |
|  |  | from django.utils.html import format\_html |
|  |  | from django.utils.http import is\_safe\_url |
|  |  | from django.utils.safestring import mark\_safe |
|  |  | from django.views.generic import View |
|  |  | from django\_tables2 import RequestConfig |
|  |  | from rest\_framework.exceptions import ParseError |
| Expand Down  Expand Up | | @@ -209,7 +208,7 @@ def get(self, request): |
|  |  | if not filterset.is\_valid(): |
|  |  | messages.error( |
|  |  | request, |
|  |  | mark\_safe(f"Invalid filters were specified: {filterset.errors}"), |
|  |  | format\_html("Invalid filters were specified: {}", filterset.errors), |
|  |  | ) |
|  |  | self.queryset = self.queryset.none() |
|  |  |  |
| Expand Down  Expand Up | | @@ -397,10 +396,10 @@ def successful\_post(self, request, obj, created, logger): |
|  |  | msg = f"{verb} {self.queryset.model.\_meta.verbose\_name}" |
|  |  | logger.info(f"{msg} {obj} (PK: {obj.pk})") |
|  |  | if hasattr(obj, "get\_absolute\_url"): |
|  |  | msg = f'{msg} <a href="{obj.get\_absolute\_url()}">{escape(obj)}</a>' |
|  |  | msg = format\_html('{} <a href="{}">{}</a>', msg, obj.get\_absolute\_url(), obj) |
|  |  | else: |
|  |  | msg = f"{msg} {escape(obj)}" |
|  |  | messages.success(request, mark\_safe(msg)) |
|  |  | msg = format\_html("{} {}", msg, obj) |
|  |  | messages.success(request, msg) |
|  |  |  |
|  |  | def post(self, request, \*args, \*\*kwargs): |
|  |  | logger = logging.getLogger(\_\_name\_\_ + ".ObjectEditView") |
| Expand Down  Expand Up | | @@ -752,7 +751,7 @@ def post(self, request): |
|  |  | logger.info(f"Import object {obj} (PK: {obj.pk})") |
|  |  | messages.success( |
|  |  | request, |
|  |  | mark\_safe(f'Imported object: <a href="{obj.get\_absolute\_url()}">{obj}</a>'), |
|  |  | format\_html('Imported object: <a href="{}">{}</a>', obj.get\_absolute\_url(), obj), |
|  |  | ) |
|  |  |  |
|  |  | if "\_addanother" in request.POST: |
| Expand Down | |  |

11 changes: 5 additions & 6 deletions

11
[nautobot/core/views/mixins.py](#diff-4932b9507690a60fb07d0e2a2dbb48547dfe5c78dc55985ff4dfddb31c84a5bd "nautobot/core/views/mixins.py")

Show comments

[View file](/nautobot/nautobot/blob/54abe23331b6c3d0d82bf1b028c679b1d200920d/nautobot/core/views/mixins.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -19,8 +19,7 @@ |
|  |  | from django.urls import reverse |
|  |  | from django.urls.exceptions import NoReverseMatch |
|  |  | from django.utils.http import is\_safe\_url |
|  |  | from django.utils.html import escape |
|  |  | from django.utils.safestring import mark\_safe |
|  |  | from django.utils.html import format\_html |
|  |  | from django.views.generic.edit import FormView |
|  |  |  |
|  |  | from rest\_framework import mixins, exceptions |
| Expand Down  Expand Up | | @@ -622,7 +621,7 @@ def filter\_queryset(self, queryset): |
|  |  | if not self.filterset.is\_valid(): |
|  |  | messages.error( |
|  |  | self.request, |
|  |  | mark\_safe(f"Invalid filters were specified: {self.filterset.errors}"), |
|  |  | format\_html("Invalid filters were specified: {}", self.filterset.errors), |
|  |  | ) |
|  |  | queryset = queryset.none() |
|  |  | return queryset |
| Expand Down  Expand Up | | @@ -748,10 +747,10 @@ def \_process\_create\_or\_update\_form(self, form): |
|  |  | msg = f'{"Created" if object\_created else "Modified"} {queryset.model.\_meta.verbose\_name}' |
|  |  | self.logger.info(f"{msg} {obj} (PK: {obj.pk})") |
|  |  | if hasattr(obj, "get\_absolute\_url"): |
|  |  | msg = f'{msg} <a href="{obj.get\_absolute\_url()}">{escape(obj)}</a>' |
|  |  | msg = format\_html('{} <a href="{}">{}</a>', msg, obj.get\_absolute\_url(), obj) |
|  |  | else: |
|  |  | msg = f"{msg} { escape(obj)}" |
|  |  | messages.success(request, mark\_safe(msg)) |
|  |  | msg = format\_html("{} {}", msg, obj) |
|  |  | messages.success(request, msg) |
|  |  | if "\_addanother" in request.POST: |
|  |  | # If the object has clone\_fields, pre-populate a new instance of the form |
|  |  | if hasattr(obj, "clone\_fields"): |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `54abe23`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fcommit%2F54abe23331b6c3d0d82bf1b028c679b1d200920d) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_75884502_20250114_223837.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fcommit%2F362850f5a94689a4c75e3188bf6de826c3b012b2)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fcommit%2F362850f5a94689a4c75e3188bf6de826c3b012b2)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=nautobot%2Fnautobot)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[nautobot](/nautobot)
/
**[nautobot](/nautobot/nautobot)**
Public

* [Notifications](/login?return_to=%2Fnautobot%2Fnautobot) You must be signed in to change notification settings
* [Fork
  298](/login?return_to=%2Fnautobot%2Fnautobot)
* [Star
   1.1k](/login?return_to=%2Fnautobot%2Fnautobot)

* [Code](/nautobot/nautobot)
* [Issues
  863](/nautobot/nautobot/issues)
* [Pull requests
  24](/nautobot/nautobot/pulls)
* [Discussions](/nautobot/nautobot/discussions)
* [Actions](/nautobot/nautobot/actions)
* [Projects
  0](/nautobot/nautobot/projects)
* [Wiki](/nautobot/nautobot/wiki)
* [Security](/nautobot/nautobot/security)
* [Insights](/nautobot/nautobot/pulse)

Additional navigation options

* [Code](/nautobot/nautobot)
* [Issues](/nautobot/nautobot/issues)
* [Pull requests](/nautobot/nautobot/pulls)
* [Discussions](/nautobot/nautobot/discussions)
* [Actions](/nautobot/nautobot/actions)
* [Projects](/nautobot/nautobot/projects)
* [Wiki](/nautobot/nautobot/wiki)
* [Security](/nautobot/nautobot/security)
* [Insights](/nautobot/nautobot/pulse)

## Commit

[Permalink](/nautobot/nautobot/commit/362850f5a94689a4c75e3188bf6de826c3b012b2)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[1.6] Fix unsafe `mark_safe` use in various features ([#4833](https://github.com/nautobot/nautobot/pull/4833))

[Browse files](/nautobot/nautobot/tree/362850f5a94689a4c75e3188bf6de826c3b012b2)
Browse the repository at this point in the history

```
* Audit all uses of mark_safe() and change to format_html() where appropriate

* Test updates and change fragment

* Add ruff for linting, add S308 disables to audited code

* Test fixes

* Update change fragments

* One more change fragment

* add get_absolute_url check back to handle_protectederror

* fix ruff

---------
```

* Loading branch information

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

[glennmatthews](/nautobot/nautobot/commits?author=glennmatthews "View all commits by glennmatthews")
authored
Nov 21, 2023

1 parent
[ea3da53](/nautobot/nautobot/commit/ea3da53f88ad31115c13e78073d664d54f57f5b0)

commit 362850f

 Show file tree

 Hide file tree

Showing
**32 changed files**
with
**441 additions**
and
**163 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* .github/workflows

  + .github/workflows/ci\_pullrequest.yml
    [ci\_pullrequest.yml](#diff-755f5eaf4b3876800d7e11ae9753a8cacf8d1b6ae7ff6f18619fa4030e4d25e5)
* changes

  + changes/4833.changed
    [4833.changed](#diff-b074796a0d23425753af0cf5181e35fb8b5d1fbf065fd963fd1e20b661e8aad4)
  + changes/4833.housekeeping
    [4833.housekeeping](#diff-9999bdc6d4fddb9540dc3d237b1d7b89a437f219c5f7073bf5640dd001fe8ed2)
  + changes/4833.security
    [4833.security](#diff-0e88e0caafda5cb14a5b830dfc109f3adb1f6ec504255b73def6809be283331f)
* nautobot

  + core

    - nautobot/core/settings.py
      [settings.py](#diff-6c6cc147c8188d94be8fd3b11345aa4bfef52a760e0961643b6b84d0c26da43a)
    - views

      * nautobot/core/views/generic.py
        [generic.py](#diff-6d6d85115c2145f877fca192b072690e4d8945d576ca00bff5ad903cce84c2bc)
      * nautobot/core/views/mixins.py
        [mixins.py](#diff-4932b9507690a60fb07d0e2a2dbb48547dfe5c78dc55985ff4dfddb31c84a5bd)
  + dcim

    - nautobot/dcim/forms.py
      [forms.py](#diff-7f9497e709291d40988eaf60afaddbed036bd537dd1c4532d8fce6b20081968e)
    - models

      * nautobot/dcim/models/devices.py
        [devices.py](#diff-2c74010b539b5fc10880ede3276b50f7af7309db6161e970293b265eebc83a47)
    - nautobot/dcim/views.py
      [views.py](#diff-292c4e491fa8d2a6b999f52af45f55576703202fa9bd731438c815c0af769af5)
  + extras

    - forms

      * nautobot/extras/forms/forms.py
        [forms.py](#diff-a37c20d31f5341e2feb9acf32cbe495b0531e32c18ff72eac461c26d259450bd)
    - models

      * nautobot/extras/models/customfields.py
        [customfields.py](#diff-8d1c47fce517d61985f7f5a7ae57a557cfd35f185221ff4fd5a73bececcad429)
      * nautobot/extras/models/models.py
        [models.py](#diff-843f33404e733176805c25c9171af4af6152b4d06d09c5d214c3e75aaed81d9b)
      * nautobot/extras/models/relationships.py
        [relationships.py](#diff-615dda0e4c9f976e01dc9a484d722a229fc9755d0d6c0197f9aef3285d70db20)
    - nautobot/extras/tables.py
      [tables.py](#diff-f807218a521768366c9dea654100684163410328fd1493f6110f0aa35cb1c401)
    - templatetags

      * nautobot/extras/templatetags/computed\_fields.py
        [computed\_fields.py](#diff-015a814fade1055e106fde4d4d9166b8998bb4c547c775965a327c0fa568fa78)
      * nautobot/extras/templatetags/custom\_links.py
        [custom\_links.py](#diff-04c88c8818dd15f9ad5cfa92af258f45356b9b7b119a730c991936160a3d5fe6)
      * nautobot/extras/templatetags/job\_buttons.py
        [job\_buttons.py](#diff-666d45365d47ee0a33a96a8e0279b8b9baac487b3f9ee8dd9ebb05add5e1d090)
      * nautobot/extras/templatetags/plugins.py
        [plugins.py](#diff-264c777d80696692772a446da3907fa637904e2b2a237a09a8e1f504b5dc861a)
    - tests

      * nautobot/extras/tests/test\_customfields.py
        [test\_customfields.py](#diff-8bd6d9808e1f0ae1ceb512f17c5431c2c2ab9ed78661648d683a2952bb1b0423)
      * nautobot/extras/tests/test\_relationships.py
        [test\_relationships.py](#diff-642a4ecf9a4811dd933b3b3d0270926848a6d063cbd3544288908ddd547d8f6e)
      * nautobot/extras/tests/test\_views.py
        [test\_views.py](#diff-63390a9316fbabcd9c87d7ea0980d9ff2738d5da7d7def31e8f152d5fcf92996)
    - nautobot/extras/views.py
      [views.py](#diff-6dd19ea99cb9defb4b43f5c663a2d2e13821f93e1429b6b372452c1ec3eb06c4)
  + ipam

    - nautobot/ipam/tables.py
      [tables.py](#diff-021d8b804e061261cd8b357ff540dd4730b04eef1ca56f0247ca38adcf6c0cd1)
  + utilities

    - nautobot/utilities/error\_handlers.py
      [error\_handlers.py](#diff-f72be4b6352a2dca3c45e007d36023db1462ada75184f8e69f60b394f19bf210)
    - nautobot/utilities/tables.py
      [tables.py](#diff-aa402d7c22d1679f240aeb613a6527ec4a41391d1c31699f09f02e7a4d26c29b)
    - templatetags

      * nautobot/utilities/templatetags/helpers.py
        [helpers.py](#diff-473815e5582260e6201f0daf0083d69561ecd6fa9290dd6ae5a361078b2cfa31)
    - nautobot/utilities/utils.py
      [utils.py](#diff-1163f5bad3157eeb8af809244f6b84ad3b27580d2ba6ba4907e4c32525025a2c)
* poetry.lock
  [poetry.lock](#diff-f53a023eedfa3fbf2925ec7dc76eecdc954ea94b7e47065393dbad519613dc89)
* pyproject.toml
  [pyproject.toml](#diff-50c86b7ed8ac2cf95bd48334961bf0530cdc77b5a56f852c5c61b89d735fd711)
* scripts/git-hooks

  + scripts/git-hooks/pre-commit
    [pre-commit](#diff-da4be731d6349b2a4095c9ae97de522ca4c10df6c5a9e7b73ffb3559b0ced959)
* tasks.py
  [tasks.py](#diff-2e746c9eacad6e2c2fdefdc6a665b5ce4607ea384ebf97a729044b79acc778d6)

## There are no files selected for viewing

13 changes: 13 additions & 0 deletions

13
[.github/workflows/ci\_pullrequest.yml](#diff-755f5eaf4b3876800d7e11ae9753a8cacf8d1b6ae7ff6f18619fa4030e4d25e5 ".github/workflows/ci_pullrequest.yml")

Show comments

[View file](/nautobot/nautobot/blob/362850f5a94689a4c75e3188bf6de826c3b012b2/.github/workflows/ci_pullrequest.yml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -31,6 +31,17 @@ jobs: |
|  |  | uses: "networktocode/gh-action-setup-poetry-environment@v2" |
|  |  | - name: "Linting: flake8" |
|  |  | run: "poetry run invoke flake8" |
|  |  | ruff: |
|  |  | runs-on: "ubuntu-20.04" |
|  |  | env: |
|  |  | INVOKE\_NAUTOBOT\_LOCAL: "True" |
|  |  | steps: |
|  |  | - name: "Check out repository code" |
|  |  | uses: "actions/checkout@v2" |
|  |  | - name: "Setup environment" |
|  |  | uses: "networktocode/gh-action-setup-poetry-environment@v2" |
|  |  | - name: "Linting: ruff" |
|  |  | run: "poetry run invoke ruff --output-format github" |
|  |  | markdownlint: |
|  |  | runs-on: "ubuntu-20.04" |
|  |  | env: |
| Expand Down  Expand Up | | @@ -83,6 +94,7 @@ jobs: |
|  |  | - "black" |
|  |  | - "flake8" |
|  |  | - "markdownlint" |
|  |  | - "ruff" |
|  |  | - "hadolint" |
|  |  | check-schema: |
|  |  | runs-on: "ubuntu-20.04" |
| Expand Down  Expand Up | | @@ -113,6 +125,7 @@ jobs: |
|  |  | - "black" |
|  |  | - "flake8" |
|  |  | - "markdownlint" |
|  |  | - "ruff" |
|  |  | - "hadolint" |
|  |  |  |
|  |  | pylint: |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[changes/4833.changed](#diff-b074796a0d23425753af0cf5181e35fb8b5d1fbf065fd963fd1e20b661e8aad4 "changes/4833.changed")

Show comments

[View file](/nautobot/nautobot/blob/362850f5a94689a4c75e3188bf6de826c3b012b2/changes/4833.changed)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1 @@ |
|  |  | Changed the `render\_jinja2()` API to no longer automatically call `mark\_safe()` on the output. |

1 change: 1 addition & 0 deletions

1
[changes/4833.housekeeping](#diff-9999bdc6d4fddb9540dc3d237b1d7b89a437f219c5f7073bf5640dd001fe8ed2 "changes/4833.housekeeping")

Show comments

[View file](/nautobot/nautobot/blob/362850f5a94689a4c75e3188bf6de826c3b012b2/changes/4833.housekeeping)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1 @@ |
|  |  | Added `ruff` to invoke tasks and CI. |

1 change: 1 addition & 0 deletions

1
[changes/4833.security](#diff-0e88e0caafda5cb14a5b830dfc109f3adb1f6ec504255b73def6809be283331f "changes/4833.security")

Show comments

[View file](/nautobot/nautobot/blob/362850f5a94689a4c75e3188bf6de826c3b012b2/changes/4833.security)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1 @@ |
|  |  | Fixed cross-site-scripting (XSS) potential with maliciously crafted Custom Links, Computed Fields, and Job Buttons (GHSA-cf9f-wmhp-v4pr). |

2 changes: 1 addition & 1 deletion

2
[nautobot/core/settings.py](#diff-6c6cc147c8188d94be8fd3b11345aa4bfef52a760e0961643b6b84d0c26da43a "nautobot/core/settings.py")

Show comments

[View file](/nautobot/nautobot/blob/362850f5a94689a4c75e3188bf6de826c3b012b2/nautobot/core/settings.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -619,7 +619,7 @@ |
|  |  | ], |
|  |  | "NETWORK\_DRIVERS": [ |
|  |  | {}, |
|  |  | mark\_safe( |
|  |  | mark\_safe( # noqa: S308 |
|  |  | "Extend or override default Platform.network\_driver translations provided by " |
|  |  | '<a href="https://netutils.readthedocs.io/en/latest/user/lib\_use\_cases\_lib\_mapper/">netutils</a>. ' |
|  |  | "Enter a dictionary in JSON format, for example:\n" |
| Expand Down | |  |

13 changes: 6 additions & 7 deletions

13
[nautobot/core/views/generic.py](#diff-6d6d85115c2145f877fca192b072690e4d8945d576ca00bff5ad903cce84c2bc "nautobot/core/views/generic.py")

Show comments

[View file](/nautobot/nautobot/blob/362850f5a94689a4c75e3188bf6de826c3b012b2/nautobot/core/views/generic.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -16,9 +16,8 @@ |
|  |  | from django.http import HttpResponse |
|  |  | from django.shortcuts import get\_object\_or\_404, redirect, render |
|  |  | from django.urls import NoReverseMatch, reverse |
|  |  | from django.utils.html import escape |
|  |  | from django.utils.html import format\_html |
|  |  | from django.utils.http import is\_safe\_url |
|  |  | from django.utils.safestring import mark\_safe |
|  |  | from django.views.generic import View |
|  |  | from django\_tables2 import RequestConfig |
|  |  |  |
| Expand Down  Expand Up | | @@ -249,7 +248,7 @@ def get(self, request): |
|  |  | if not filterset.is\_valid(): |
|  |  | messages.error( |
|  |  | request, |
|  |  | mark\_safe(f"Invalid filters were specified: {filterset.errors}"), |
|  |  | format\_html("Invalid filters were specified: {}", filterset.errors), |
|  |  | ) |
|  |  | self.queryset = self.queryset.none() |
|  |  |  |
| Expand Down  Expand Up | | @@ -461,10 +460,10 @@ def post(self, request, \*args, \*\*kwargs): |
|  |  | msg = f"{verb} {self.queryset.model.\_meta.verbose\_name}" |
|  |  | logger.info(f"{msg} {obj} (PK: {obj.pk})") |
|  |  | if hasattr(obj, "get\_absolute\_url"): |
|  |  | msg = f'{msg} <a href="{obj.get\_absolute\_url()}">{escape(obj)}</a>' |
|  |  | msg = format\_html('{} <a href="{}">{}</a>', msg, obj.get\_absolute\_url(), obj) |
|  |  | else: |
|  |  | msg = f"{msg} {escape(obj)}" |
|  |  | messages.success(request, mark\_safe(msg)) |
|  |  | msg = format\_html("{} {}", msg, obj) |
|  |  | messages.success(request, msg) |
|  |  |  |
|  |  | if "\_addanother" in request.POST: |
|  |  | # If the object has clone\_fields, pre-populate a new instance of the form |
| Expand Down  Expand Up | | @@ -794,7 +793,7 @@ def post(self, request): |
|  |  | logger.info(f"Import object {obj} (PK: {obj.pk})") |
|  |  | messages.success( |
|  |  | request, |
|  |  | mark\_safe(f'Imported object: <a href="{obj.get\_absolute\_url()}">{obj}</a>'), |
|  |  | format\_html('Imported object: <a href="{}">{}</a>', obj.get\_absolute\_url(), obj), |
|  |  | ) |
|  |  |  |
|  |  | if "\_addanother" in request.POST: |
| Expand Down | |  |

11 changes: 5 additions & 6 deletions

11
[nautobot/core/views/mixins.py](#diff-4932b9507690a60fb07d0e2a2dbb48547dfe5c78dc55985ff4dfddb31c84a5bd "nautobot/core/views/mixins.py")

Show comments

[View file](/nautobot/nautobot/blob/362850f5a94689a4c75e3188bf6de826c3b012b2/nautobot/core/views/mixins.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -15,8 +15,7 @@ |
|  |  | from django.shortcuts import get\_object\_or\_404, redirect |
|  |  | from django.template.loader import select\_template, TemplateDoesNotExist |
|  |  | from django.utils.http import is\_safe\_url |
|  |  | from django.utils.html import escape |
|  |  | from django.utils.safestring import mark\_safe |
|  |  | from django.utils.html import format\_html |
|  |  | from django.views.generic.edit import FormView |
|  |  |  |
|  |  | from rest\_framework import mixins, exceptions |
| Expand Down  Expand Up | | @@ -462,7 +461,7 @@ def filter\_queryset(self, queryset): |
|  |  | if not self.filterset.is\_valid(): |
|  |  | messages.error( |
|  |  | self.request, |
|  |  | mark\_safe(f"Invalid filters were specified: {self.filterset.errors}"), |
|  |  | format\_html("Invalid filters were specified: {}", self.filterset.errors), |
|  |  | ) |
|  |  | queryset = queryset.none() |
|  |  | return queryset |
| Expand Down  Expand Up | | @@ -624,10 +623,10 @@ def \_process\_create\_or\_update\_form(self, form): |
|  |  | msg = f'{"Created" if object\_created else "Modified"} {queryset.model.\_meta.verbose\_name}' |
|  |  | self.logger.info(f"{msg} {obj} (PK: {obj.pk})") |
|  |  | if hasattr(obj, "get\_absolute\_url"): |
|  |  | msg = f'{msg} <a href="{obj.get\_absolute\_url()}">{escape(obj)}</a>' |
|  |  | msg = format\_html('{} <a href="{}">{}</a>', msg, obj.get\_absolute\_url(), obj) |
|  |  | else: |
|  |  | msg = f"{msg} { escape(obj)}" |
|  |  | messages.success(request, mark\_safe(msg)) |
|  |  | msg = format\_html("{} {}", msg, obj) |
|  |  | messages.success(request, msg) |
|  |  | if "\_addanother" in request.POST: |
|  |  | # If the object has clone\_fields, pre-populate a new instance of the form |
|  |  | if hasattr(obj, "clone\_fields"): |
| Expand Down | |  |

10 changes: 5 additions & 5 deletions

10
[nautobot/dcim/forms.py](#diff-7f9497e709291d40988eaf60afaddbed036bd537dd1c4532d8fce6b20081968e "nautobot/dcim/forms.py")

Show comments

[View file](/nautobot/nautobot/blob/362850f5a94689a4c75e3188bf6de826c3b012b2/nautobot/dcim/forms.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -381,7 +381,7 @@ class Meta: |
|  |  | model = Site |
|  |  | fields = Site.csv\_headers |
|  |  | help\_texts = { |
|  |  | "time\_zone": mark\_safe( |
|  |  | "time\_zone": mark\_safe( # noqa: S308 |
|  |  | 'Time zone (<a href="https://en.wikipedia.org/wiki/List\_of\_tz\_database\_time\_zones">available options</a>)' |
|  |  | ) |
|  |  | } |
| Expand Down  Expand Up | | @@ -447,7 +447,7 @@ class LocationTypeCSVForm(CustomFieldModelCSVForm): |
|  |  | feature="locations", |
|  |  | required=False, |
|  |  | choices\_as\_strings=True, |
|  |  | help\_text=mark\_safe( |
|  |  | help\_text=mark\_safe( # noqa: S308 |
|  |  | "The object types to which this status applies. Multiple values " |
|  |  | "must be comma-separated and wrapped in double quotes. (e.g. " |
|  |  | '<code>"dcim.device,dcim.rack"</code>)' |
| Expand Down  Expand Up | | @@ -636,7 +636,7 @@ class Meta: |
|  |  | model = RackRole |
|  |  | fields = RackRole.csv\_headers |
|  |  | help\_texts = { |
|  |  | "color": mark\_safe("RGB color in hexadecimal (e.g. <code>00ff00</code>)"), |
|  |  | "color": mark\_safe("RGB color in hexadecimal (e.g. <code>00ff00</code>)"), # noqa: S308 |
|  |  | } |
|  |  |  |
|  |  |  |
| Expand Down  Expand Up | | @@ -1768,7 +1768,7 @@ class Meta: |
|  |  | model = DeviceRole |
|  |  | fields = DeviceRole.csv\_headers |
|  |  | help\_texts = { |
|  |  | "color": mark\_safe("RGB color in hexadecimal (e.g. <code>00ff00</code>)"), |
|  |  | "color": mark\_safe("RGB color in hexadecimal (e.g. <code>00ff00</code>)"), # noqa: S308 |
|  |  | } |
|  |  |  |
|  |  |  |
| Expand Down  Expand Up | | @@ -3855,7 +3855,7 @@ class Meta: |
|  |  | "length\_unit", |
|  |  | ] |
|  |  | help\_texts = { |
|  |  | "color": mark\_safe("RGB color in hexadecimal (e.g. <code>00ff00</code>)"), |
|  |  | "color": mark\_safe("RGB color in hexadecimal (e.g. <code>00ff00</code>)"), # noqa: S308 |
|  |  | "status": "Connection status", |
|  |  | } |
|  |  |  |
| Expand Down | |  |

12 changes: 7 additions & 5 deletions

12
[nautobot/dcim/models/devices.py](#diff-2c74010b539b5fc10880ede3276b50f7af7309db6161e970293b265eebc83a47 "nautobot/dcim/models/devices.py")

Show comments

[View file](/nautobot/nautobot/blob/362850f5a94689a4c75e3188bf6de826c3b012b2/nautobot/dcim/models/devices.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -8,9 +8,9 @@ |
|  |  | from django.core.validators import MaxValueValidator, MinValueValidator |
|  |  | from django.db import models |
|  |  | from django.db.models import F, ProtectedError, Q |
|  |  | from django.utils.functional import cached\_property |
|  |  | from django.urls import reverse |
|  |  | from django.utils.safestring import mark\_safe |
|  |  | from django.utils.functional import cached\_property |
|  |  | from django.utils.html import format\_html |
|  |  |  |
|  |  | from nautobot.dcim.choices import DeviceFaceChoices, DeviceRedundancyGroupFailoverStrategyChoices, SubdeviceRoleChoices |
|  |  | from nautobot.dcim.models.device\_components import ( |
| Expand Down  Expand Up | | @@ -279,9 +279,11 @@ def clean(self): |
|  |  | url = f"{reverse('dcim:device\_list')}?manufacturer\_id={self.manufacturer\_id}&device\_type\_id={self.pk}" |
|  |  | raise ValidationError( |
|  |  | { |
|  |  | "u\_height": mark\_safe( |
|  |  | f'Unable to set 0U height: Found <a href="{url}">{racked\_instance\_count} instances</a> already ' |
|  |  | f"mounted within racks." |
|  |  | "u\_height": format\_html( |
|  |  | "Unable to set 0U height: " |
|  |  | 'Found <a href="{}">{} instances</a> already mounted within racks.', |
|  |  | url, |
|  |  | racked\_instance\_count, |
|  |  | ) |
|  |  | } |
|  |  | ) |
| Expand Down | |  |

11 changes: 5 additions & 6 deletions

11
[nautobot/dcim/views.py](#diff-292c4e491fa8d2a6b999f52af45f55576703202fa9bd731438c815c0af769af5 "nautobot/dcim/views.py")

Show comments

[View file](/nautobot/nautobot/blob/362850f5a94689a4c75e3188bf6de826c3b012b2/nautobot/dcim/views.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -12,8 +12,7 @@ |
|  |  | modelformset\_factory, |
|  |  | ) |
|  |  | from django.shortcuts import get\_object\_or\_404, redirect, render |
|  |  | from django.utils.html import escape |
|  |  | from django.utils.safestring import mark\_safe |
|  |  | from django.utils.html import format\_html |
|  |  | from django.views.generic import View |
|  |  | from django\_tables2 import RequestConfig |
|  |  |  |
| Expand Down  Expand Up | | @@ -2961,8 +2960,8 @@ def post(self, request, pk): |
|  |  |  |
|  |  | if membership\_form.is\_valid(): |
|  |  | membership\_form.save() |
|  |  | msg = f'Added member <a href="{device.get\_absolute\_url()}">{escape(device)}</a>' |
|  |  | messages.success(request, mark\_safe(msg)) |
|  |  | msg = format\_html('Added member <a href="{}">{}</a>', device.get\_absolute\_url(), device) |
|  |  | messages.success(request, msg) |
|  |  |  |
|  |  | if "\_addanother" in request.POST: |
|  |  | return redirect(request.get\_full\_path()) |
| Expand Down  Expand Up | | @@ -3011,8 +3010,8 @@ def post(self, request, pk): |
|  |  | # Protect master device from being removed |
|  |  | virtual\_chassis = VirtualChassis.objects.filter(master=device).first() |
|  |  | if virtual\_chassis is not None: |
|  |  | msg = f"Unable to remove master device {escape(device)} from the virtual chassis." |
|  |  | messages.error(request, mark\_safe(msg)) |
|  |  | msg = format\_html("Unable to remove master device {} from the virtual chassis.", device) |
|  |  | messages.error(request, msg) |
|  |  | return redirect(device.get\_absolute\_url()) |
|  |  |  |
|  |  | if form.is\_valid(): |
| Expand Down | |  |

8 changes: 4 additions & 4 deletions

8
[nautobot/extras/forms/forms.py](#diff-a37c20d31f5341e2feb9acf32cbe495b0531e32c18ff72eac461c26d259450bd "nautobot/extras/forms/forms.py")

Show comments

[View file](/nautobot/nautobot/blob/362850f5a94689a4c75e3188bf6de826c3b012b2/nautobot/extras/forms/forms.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -648,7 +648,7 @@ def \_\_init\_\_(self, \*args, \*\*kwargs): |
|  |  | self.fields["provided\_contents"] = CSVMultipleChoiceField( |
|  |  | choices=get\_git\_datasource\_content\_choices(), |
|  |  | required=False, |
|  |  | help\_text=mark\_safe( |
|  |  | help\_text=mark\_safe( # noqa: S308 |
|  |  | "The data types this repository provides. Multiple values must be comma-separated and wrapped in " |
|  |  | 'double quotes (e.g. <code>"extras.job,extras.configcontext"</code>).' |
|  |  | ), |
| Expand Down  Expand Up | | @@ -1352,7 +1352,7 @@ class StatusCSVForm(CustomFieldModelCSVForm): |
|  |  | content\_types = CSVMultipleContentTypeField( |
|  |  | feature="statuses", |
|  |  | choices\_as\_strings=True, |
|  |  | help\_text=mark\_safe( |
|  |  | help\_text=mark\_safe( # noqa: S308 |
|  |  | "The object types to which this status applies. Multiple values " |
|  |  | "must be comma-separated and wrapped in double quotes. (e.g. " |
|  |  | '<code>"dcim.device,dcim.rack"</code>)' |
| Expand All | | @@ -1364,7 +1364,7 @@ class Meta: |
|  |  | model = Status |
|  |  | fields = Status.csv\_headers |
|  |  | help\_texts = { |
|  |  | "color": mark\_safe("RGB color in hexadecimal (e.g. <code>00ff00</code>)"), |
|  |  | "color": mark\_safe("RGB color in hexadecimal (e.g. <code>00ff00</code>)"), # noqa: S308 |
|  |  | } |
|  |  |  |
|  |  |  |
| Expand Down  Expand Up | | @@ -1427,7 +1427,7 @@ class Meta: |
|  |  | model = Tag |
|  |  | fields = Tag.csv\_headers |
|  |  | help\_texts = { |
|  |  | "color": mark\_safe("RGB color in hexadecimal (e.g. <code>00ff00</code>)"), |
|  |  | "color": mark\_safe("RGB color in hexadecimal (e.g. <code>00ff00</code>)"), # noqa: S308 |
|  |  | } |
|  |  |  |
|  |  |  |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[nautobot/extras/models/customfields.py](#diff-8d1c47fce517d61985f7f5a7ae57a557cfd35f185221ff4fd5a73bececcad429 "nautobot/extras/models/customfields.py")

Show comments

[View file](/nautobot/nautobot/blob/362850f5a94689a4c75e3188bf6de826c3b012b2/nautobot/extras/models/customfields.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -12,7 +12,7 @@ |
|  |  | from django.db import models |
|  |  | from django.forms.widgets import TextInput |
|  |  | from django.urls import reverse |
|  |  | from django.utils.safestring import mark\_safe |
|  |  | from django.utils.html import format\_html |
|  |  |  |
|  |  | from nautobot.extras.choices import CustomFieldFilterLogicChoices, CustomFieldTypeChoices |
|  |  | from nautobot.extras.models import ChangeLoggedModel |
| Expand Down  Expand Up | | @@ -546,7 +546,7 @@ def to\_form\_field( |
|  |  | field.validators = [ |
|  |  | RegexValidator( |
|  |  | regex=self.validation\_regex, |
|  |  | message=mark\_safe(f"Values must match this regex: <code>{self.validation\_regex}</code>"), |
|  |  | message=format\_html("Values must match this regex: <code>{}</code>", self.validation\_regex), |
|  |  | ) |
|  |  | ] |
|  |  |  |
| Expand Down | |  |

7 changes: 5 additions & 2 deletions

7
[nautobot/extras/models/models.py](#diff-843f33404e733176805c25c9171af4af6152b4d06d09c5d214c3e75aaed81d9b "nautobot/extras/models/models.py")

Show comments

[View file](/nautobot/nautobot/blob/362850f5a94689a4c75e3188bf6de826c3b012b2/nautobot/extras/models/models.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -326,12 +326,15 @@ class CustomLink(BaseModel, ChangeLoggedModel, NotesMixin): |
|  |  | name = models.CharField(max\_length=100, unique=True) |
|  |  | text = models.CharField( |
|  |  | max\_length=500, |
|  |  | help\_text="Jinja2 template code for link text. Reference the object as <code>{{ obj }}</code> such as <code>{{ obj.platform.slug }}</code>. Links which render as empty text will not be displayed.", |
|  |  | help\_text="Jinja2 template code for link text. " |
|  |  | "Reference the object as <code>{{ obj }}</code> such as <code>{{ obj.platform.slug }}</code>. " |
|  |  | "Links which render as empty text will not be displayed.", |
|  |  | ) |
|  |  | target\_url = models.CharField( |
|  |  | max\_length=500, |
|  |  | verbose\_name="URL", |
|  |  | help\_text="Jinja2 template code for link URL. Reference the object as <code>{{ obj }}</code> such as <code>{{ obj.platform.slug }}</code>.", |
|  |  | help\_text="Jinja2 template code for link URL. " |
|  |  | "Reference the object as <code>{{ obj }}</code> such as <code>{{ obj.platform.slug }}</code>.", |
|  |  | ) |
|  |  | weight = models.PositiveSmallIntegerField(default=100) |
|  |  | group\_name = models.CharField( |
| Expand Down | |  |

21 changes: 13 additions & 8 deletions

21
[nautobot/extras/models/relationships.py](#diff-615dda0e4c9f976e01dc9a484d722a229fc9755d0d6c0197f9aef3285d70db20 "nautobot/extras/models/relationships.py")

Show comments

[View file](/nautobot/nautobot/blob/362850f5a94689a4c75e3188bf6de826c3b012b2/nautobot/extras/models/relationships.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -9,7 +9,7 @@ |
|  |  | from django.db.models import Q |
|  |  | from django.urls import reverse |
|  |  | from django.urls.exceptions import NoReverseMatch |
|  |  | from django.utils.safestring import mark\_safe |
|  |  | from django.utils.html import format\_html |
|  |  |  |
|  |  | from nautobot.core.fields import AutoSlugField |
|  |  | from nautobot.core.models import BaseModel |
| Expand All | | @@ -24,6 +24,7 @@ |
|  |  | widgets, |
|  |  | ) |
|  |  | from nautobot.utilities.querysets import RestrictedQuerySet |
|  |  | from nautobot.utilities.templatetags.helpers import bettertitle |
|  |  |  |
|  |  |  |
|  |  | logger = logging.getLogger(\_\_name\_\_) |
| Expand Down  Expand Up | | @@ -275,9 +276,10 @@ def required\_related\_objects\_errors( |
|  |  | if output\_for == "ui": |
|  |  | try: |
|  |  | add\_url = reverse(get\_route\_for\_model(required\_model\_class, "add")) |
|  |  | hint = ( |
|  |  | f"<a target='\_blank' href='{add\_url}'>Click here</a> to create " |
|  |  | f"a {required\_model\_meta.verbose\_name}." |
|  |  | hint = format\_html( |
|  |  | '<a target="\_blank" href="{}">Click here</a> to create a {}.', |
|  |  | add\_url, |
|  |  | required\_model\_meta.verbose\_name, |
|  |  | ) |
|  |  | except NoReverseMatch: |
|  |  | pass |
| Expand All | | @@ -289,11 +291,14 @@ def required\_related\_objects\_errors( |
|  |  | except NoReverseMatch: |
|  |  | pass |
|  |  |  |
|  |  | error\_message = mark\_safe( |
|  |  | f"{name\_plural[0].upper()}{name\_plural[1:]} require " |
|  |  | f"{num\_required\_verbose} {required\_model\_meta.verbose\_name}, but no " |
|  |  | f"{required\_model\_meta.verbose\_name\_plural} exist yet. {hint}" |
|  |  | error\_message = format\_html( |
|  |  | "{} require {} {}, but no {} exist yet. ", |
|  |  | bettertitle(name\_plural), |
|  |  | num\_required\_verbose, |
|  |  | required\_model\_meta.verbose\_name, |
|  |  | required\_model\_meta.verbose\_name\_plural, |
|  |  | ) |
|  |  | error\_message += hint |
|  |  | field\_errors[field\_key].append(error\_message) |
|  |  |  |
|  |  | if initial\_data is not None: |
| Expand Down | |  |

3 changes: 1 addition & 2 deletions

3
[nautobot/extras/tables.py](#diff-f807218a521768366c9dea654100684163410328fd1493f6110f0aa35cb1c401 "nautobot/extras/tables.py")

Show comments

[View file](/nautobot/nautobot/blob/362850f5a94689a4c75e3188bf6de826c3b012b2/nautobot/extras/tables.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,7 +1,6 @@ |
|  |  | import django\_tables2 as tables |
|  |  | from django.conf import settings |
|  |  | from django.utils.html import format\_html |
|  |  | from django.utils.safestring import mark\_safe |
|  |  | from django\_tables2.utils import Accessor |
|  |  | from jsonschema.exceptions import ValidationError as JSONSchemaValidationError |
|  |  |  |
| Expand Down  Expand Up | | @@ -255,7 +254,7 @@ class Meta(BaseTable.Meta): |
|  |  |  |
|  |  | def render\_description(self, record): |
|  |  | if record.description: |
|  |  | return mark\_safe(render\_markdown(record.description)) |
|  |  | return render\_markdown(record.description) |
|  |  | return self.default |
|  |  |  |
|  |  |  |
| Expand Down | |  |

19 changes: 6 additions & 13 deletions

19
[nautobot/extras/templatetags/computed\_fields.py](#diff-015a814fade1055e106fde4d4d9166b8998bb4c547c775965a327c0fa568fa78 "nautobot/extras/templatetags/computed_fields.py")

Show comments

[View file](/nautobot/nautobot/blob/362850f5a94689a4c75e3188bf6de826c3b012b2/nautobot/extras/templatetags/computed_fields.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,7 +1,6 @@ |
|  |  | from django import template |
|  |  | from django.contrib.contenttypes.models import ContentType |
|  |  | from django.utils.html import escape |
|  |  | from django.utils.safestring import mark\_safe |
|  |  | from django.utils.html import format\_html\_join |
|  |  |  |
|  |  | from nautobot.extras.models import ComputedField |
|  |  |  |
| Expand All | | @@ -27,14 +26,8 @@ def computed\_fields(context, obj, advanced\_ui=None): |
|  |  | if not computed\_fields: |
|  |  | return "" |
|  |  |  |
|  |  | template\_code = "" |
|  |  |  |
|  |  | for label, value in fields.items(): |
|  |  | escaped\_label = escape(label) |
|  |  | template\_code += f""" |
|  |  | <tr> |
|  |  | <td><span title="{escaped\_label}">{escaped\_label}</span></td> |
|  |  | <td>{escape(value)}</td> |
|  |  | <tr> |
|  |  | """ |
|  |  | return mark\_safe(template\_code) |
|  |  | return format\_html\_join( |
|  |  | "\n", |
|  |  | '<tr><td><span title="{}">{}</span></td><td>{}</td></tr>', |
|  |  | ((label, label, value) for label, value in fields.items()), |
|  |  | ) |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `362850f`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fcommit%2F362850f5a94689a4c75e3188bf6de826c3b012b2) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_7cefef83_20250114_223845.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fpull%2F4832)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fpull%2F4832)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=nautobot%2Fnautobot)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[nautobot](/nautobot)
/
**[nautobot](/nautobot/nautobot)**
Public

* [Notifications](/login?return_to=%2Fnautobot%2Fnautobot) You must be signed in to change notification settings
* [Fork
  298](/login?return_to=%2Fnautobot%2Fnautobot)
* [Star
   1.1k](/login?return_to=%2Fnautobot%2Fnautobot)

* [Code](/nautobot/nautobot)
* [Issues
  863](/nautobot/nautobot/issues)
* [Pull requests
  24](/nautobot/nautobot/pulls)
* [Discussions](/nautobot/nautobot/discussions)
* [Actions](/nautobot/nautobot/actions)
* [Projects
  0](/nautobot/nautobot/projects)
* [Wiki](/nautobot/nautobot/wiki)
* [Security](/nautobot/nautobot/security)
* [Insights](/nautobot/nautobot/pulse)

Additional navigation options

* [Code](/nautobot/nautobot)
* [Issues](/nautobot/nautobot/issues)
* [Pull requests](/nautobot/nautobot/pulls)
* [Discussions](/nautobot/nautobot/discussions)
* [Actions](/nautobot/nautobot/actions)
* [Projects](/nautobot/nautobot/projects)
* [Wiki](/nautobot/nautobot/wiki)
* [Security](/nautobot/nautobot/security)
* [Insights](/nautobot/nautobot/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fnautobot%2Fnautobot%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fnautobot%2Fnautobot%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# [2.0] Fix unsafe `mark_safe` use in various features #4832

 Merged

[gsnider2195](/gsnider2195)
merged 8 commits into
[develop](/nautobot/nautobot/tree/develop "nautobot/nautobot:develop")
from
[u/glennmatthews-render\_jinja2-unsafe](/nautobot/nautobot/tree/u/glennmatthews-render_jinja2-unsafe "nautobot/nautobot:u/glennmatthews-render_jinja2-unsafe")

Nov 21, 2023

 Merged

# [[2.0] Fix unsafe `mark_safe` use in various features](#top) #4832

[gsnider2195](/gsnider2195)
merged 8 commits into
[develop](/nautobot/nautobot/tree/develop "nautobot/nautobot:develop")
from
[u/glennmatthews-render\_jinja2-unsafe](/nautobot/nautobot/tree/u/glennmatthews-render_jinja2-unsafe "nautobot/nautobot:u/glennmatthews-render_jinja2-unsafe")

Nov 21, 2023

[Conversation
6](/nautobot/nautobot/pull/4832)
[Commits
8](/nautobot/nautobot/pull/4832/commits)
[Checks
20](/nautobot/nautobot/pull/4832/checks)
[Files changed](/nautobot/nautobot/pull/4832/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=60&v=4)](/glennmatthews)

Copy link

Contributor

### @glennmatthews **[glennmatthews](/glennmatthews)** commented [Nov 21, 2023](#issue-2004291232)

# Closes: [GHSA-cf9f-wmhp-v4pr](https://github.com/advisories/GHSA-cf9f-wmhp-v4pr "GHSA-cf9f-wmhp-v4pr") (for 2.0.x)

# What's Changed

* Audit all uses of `mark_safe` in our code base and change to `format_html` where appropriate for security and integrity.
  + This fixes several cases where `CustomLink`, `ComputedField`, and `JobButton` were provably vulnerable to XSS
  + This also hardens a number of other cases that I wasn't able to trivially exploit but should be considered insecure as previously implemented.
* Add test cases for CustomLink, ComputedField, and JobButton rendering. These are not exhaustive but provide at least some automated validation of the fixes and protection against regression.
* As I originally discovered this issue by experimenting with using `ruff` for linting, I've added `ruff` to the invoke tasks and also to the CI (not yet validated).
  + I've enabled a few basic categories of lint rules (mostly redundant with `flake8`, but inexpensive to cover with `ruff` as well and laying groundwork for eventually removing `flake8` less urgently)
  + I've enabled the `S308` security rule that specifically flags usage of `mark_safe` (there are a lot of other rules in the S category that we should plan to enable and audit over time)
  + I've added `# noqa: S308` to the remaining cases of `mark_safe` in our code that I believe to be in fact safe. *I'D STRONGLY APPRECIATE A SANITY CHECK ON ALL OF THESE!*

# TODO

* Explanation of Change(s)
* Added change log fragment(s) (for more information see [the documentation](https://docs.nautobot.com/projects/core/en/stable/development/#creating-changelog-fragments))
* n/a Attached Screenshots, Payload Example
* Unit, Integration Tests
* n/a Documentation Updates (when adding/changing features)
* n/a Example Plugin Updates (when adding/changing features)
* Outline Remaining Work, Constraints from Design

Sorry, something went wrong.

All reactions

 [glennmatthews](/glennmatthews)
added 7 commits
[November 17, 2023 10:34](#commits-pushed-126f4ed)

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

`[Audit all uses of mark_safe() and change to format_html() where appro…](/nautobot/nautobot/pull/4832/commits/126f4ed40cb3113c5769ac934ccc71317c3438ed "Audit all uses of mark_safe() and change to format_html() where appropriate")`
 …

`[126f4ed](/nautobot/nautobot/pull/4832/commits/126f4ed40cb3113c5769ac934ccc71317c3438ed)`

```
…priate
```

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

`[Test updates and change fragment](/nautobot/nautobot/pull/4832/commits/100a7afbcb4d1758202808f6688a729a41f673c6 "Test updates and change fragment")`

`[100a7af](/nautobot/nautobot/pull/4832/commits/100a7afbcb4d1758202808f6688a729a41f673c6)`

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

`[Add ruff for linting, add S308 disables to audited code](/nautobot/nautobot/pull/4832/commits/98b5af8afafe7629ad2b38a5c07b4de1a0449cdb "Add ruff for linting, add S308 disables to audited code")`

`[98b5af8](/nautobot/nautobot/pull/4832/commits/98b5af8afafe7629ad2b38a5c07b4de1a0449cdb)`

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

`[Test fixes](/nautobot/nautobot/pull/4832/commits/675536013f6a2f578a9c83c3d81520b8483cacc8 "Test fixes")`

`[6755360](/nautobot/nautobot/pull/4832/commits/675536013f6a2f578a9c83c3d81520b8483cacc8)`

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

`[Merge branch 'develop' into u/glennmatthews-render_jinja2-unsafe](/nautobot/nautobot/pull/4832/commits/b53b7b05087111e38aa99d0e7b9b62f635d4405c "Merge branch 'develop' into u/glennmatthews-render_jinja2-unsafe")`

`[b53b7b0](/nautobot/nautobot/pull/4832/commits/b53b7b05087111e38aa99d0e7b9b62f635d4405c)`

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

`[Update change fragments](/nautobot/nautobot/pull/4832/commits/209947f22f14f3b65da9ee619ead6b1cbaa3d498 "Update change fragments")`

`[209947f](/nautobot/nautobot/pull/4832/commits/209947f22f14f3b65da9ee619ead6b1cbaa3d498)`

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

`[One more change fragment](/nautobot/nautobot/pull/4832/commits/400b80071099fa5ca7f3dfdef8a6bc919ddd2002 "One more change fragment")`

`[400b800](/nautobot/nautobot/pull/4832/commits/400b80071099fa5ca7f3dfdef8a6bc919ddd2002)`

 [![@HanlinMiao](https://avatars.githubusercontent.com/u/46973263?s=40&u=ef6e6c194c0d07f6a0837f33ec4e95c49ab0082d&v=4)](/HanlinMiao)
[HanlinMiao](/HanlinMiao)
self-requested a review
[November 21, 2023 15:38](#event-11026079139)

[![@gsnider2195](https://avatars.githubusercontent.com/u/75227981?s=40&v=4)](/gsnider2195)

`[Merge branch 'develop' into u/glennmatthews-render_jinja2-unsafe](/nautobot/nautobot/pull/4832/commits/22900745d5fe93fa2c1dcd57654e472738745f3c "Merge branch 'develop' into u/glennmatthews-render_jinja2-unsafe")`

`[2290074](/nautobot/nautobot/pull/4832/commits/22900745d5fe93fa2c1dcd57654e472738745f3c)`

[![HanlinMiao](https://avatars.githubusercontent.com/u/46973263?s=60&v=4)](/HanlinMiao)

**[HanlinMiao](/HanlinMiao)**
approved these changes
[Nov 21, 2023](#pullrequestreview-1742778068)

 [View reviewed changes](/nautobot/nautobot/pull/4832/files/22900745d5fe93fa2c1dcd57654e472738745f3c)

[![gsnider2195](https://avatars.githubusercontent.com/u/75227981?s=60&v=4)](/gsnider2195)

**[gsnider2195](/gsnider2195)**
reviewed
[Nov 21, 2023](#pullrequestreview-1742779076)

 [View reviewed changes](/nautobot/nautobot/pull/4832/files/22900745d5fe93fa2c1dcd57654e472738745f3c)

[nautobot/core/utils/data.py](/nautobot/nautobot/pull/4832/files/22900745d5fe93fa2c1dcd57654e472738745f3c#diff-7396fcbe9612074e76906018a34dde1e5b08b36690f5a49b2d9aae7fe947d225)

Show resolved

Hide resolved

[![gsnider2195](https://avatars.githubusercontent.com/u/75227981?s=60&v=4)](/gsnider2195)

**[gsnider2195](/gsnider2195)**
reviewed
[Nov 21, 2023](#pullrequestreview-1742809181)

 [View reviewed changes](/nautobot/nautobot/pull/4832/files/22900745d5fe93fa2c1dcd57654e472738745f3c)

[nautobot/extras/templatetags/job\_buttons.py](/nautobot/nautobot/pull/4832/files/22900745d5fe93fa2c1dcd57654e472738745f3c#diff-666d45365d47ee0a33a96a8e0279b8b9baac487b3f9ee8dd9ebb05add5e1d090)

Comment on lines
+161
 to
+165

|  |  | buttons\_rendered += ( |
| --- | --- | --- |
|  |  | mark\_safe("<li>") # noqa: S308 |
|  |  | + format\_html(CONFIRM\_BUTTON, \*\*template\_args) |
|  |  | + mark\_safe("</li>") # noqa: S308 |
|  |  | ) |

Copy link

Contributor

### @gsnider2195 **[gsnider2195](/gsnider2195)** [Nov 21, 2023](#discussion_r1401010670)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Suggested change

|  | buttons\_rendered += ( |
| --- | --- |
|  | mark\_safe("<li>") # noqa: S308 |
|  | + format\_html(CONFIRM\_BUTTON, \*\*template\_args) |
|  | + mark\_safe("</li>") # noqa: S308 |
|  | ) |
|  | buttons\_rendered += format\_html(f"<li>{CONFIRM\_BUTTON}</li>", \*\*template\_args) |

Not blocking, just more concise and accomplishes the same thing?

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @glennmatthews **[glennmatthews](/glennmatthews)** [Nov 27, 2023](#discussion_r1406329926)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Probably so, good thought.

Sorry, something went wrong.

All reactions

[![gsnider2195](https://avatars.githubusercontent.com/u/75227981?s=60&v=4)](/gsnider2195)

**[gsnider2195](/gsnider2195)**
reviewed
[Nov 21, 2023](#pullrequestreview-1742809766)

 [View reviewed changes](/nautobot/nautobot/pull/4832/files/22900745d5fe93fa2c1dcd57654e472738745f3c)

[nautobot/extras/templatetags/job\_buttons.py](/nautobot/nautobot/pull/4832/files/22900745d5fe93fa2c1dcd57654e472738745f3c#diff-666d45365d47ee0a33a96a8e0279b8b9baac487b3f9ee8dd9ebb05add5e1d090)

|  |  | else: |
| --- | --- | --- |
|  |  | buttons\_rendered += "<li>" + NO\_CONFIRM\_BUTTON.format(\*\*template\_args) + "</li>" |
|  |  | forms\_html += NO\_CONFIRM\_FORM.format(\*\*template\_args) |
|  |  | buttons\_rendered += ( |

Copy link

Contributor

### @gsnider2195 **[gsnider2195](/gsnider2195)** [Nov 21, 2023](#discussion_r1401011044)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

same comment as above

Sorry, something went wrong.

All reactions

[![gsnider2195](https://avatars.githubusercontent.com/u/75227981?s=60&v=4)](/gsnider2195)

**[gsnider2195](/gsnider2195)**
reviewed
[Nov 21, 2023](#pullrequestreview-1742872235)

 [View reviewed changes](/nautobot/nautobot/pull/4832/files/22900745d5fe93fa2c1dcd57654e472738745f3c)

[nautobot/extras/tests/test\_views.py](/nautobot/nautobot/pull/4832/files/22900745d5fe93fa2c1dcd57654e472738745f3c#diff-63390a9316fbabcd9c87d7ea0980d9ff2738d5da7d7def31e8f152d5fcf92996)

|  |  | @@ -130,6 +131,63 @@ def setUpTestData(cls): | |
| --- | --- | --- | --- |
|  |  | cls.slug\_test\_object = "Computed Field Five" |
|  |  |  |
|  |  |  |
|  |  | class ComputedFieldRenderingTestCase(TestCase): |

Copy link

Contributor

### @gsnider2195 **[gsnider2195](/gsnider2195)** [Nov 21, 2023](#discussion_r1401040223)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Great tests!

Sorry, something went wrong.

All reactions

[![gsnider2195](https://avatars.githubusercontent.com/u/75227981?s=60&v=4)](/gsnider2195)

**[gsnider2195](/gsnider2195)**
approved these changes
[Nov 21, 2023](#pullrequestreview-1742887292)

 [View reviewed changes](/nautobot/nautobot/pull/4832/files/22900745d5fe93fa2c1dcd57654e472738745f3c)

 Hide details
View details

[![@gsnider2195](https://avatars.githubusercontent.com/u/75227981?s=40&u=556af7718766ec60d0c51aae5de914385d2da776&v=4)](/gsnider2195)
[gsnider2195](/gsnider2195)
merged commit [`54abe23`](/nautobot/nautobot/commit/54abe23331b6c3d0d82bf1b028c679b1d200920d)
into
develop

[Nov 21, 2023](https://github.com/nautobot/nautobot/pull/4832#event-11029319804)
20 checks passed

 [![@gsnider2195](https://avatars.githubusercontent.com/u/75227981?s=40&u=556af7718766ec60d0c51aae5de914385d2da776&v=4)](/gsnider2195)
[gsnider2195](/gsnider2195)
deleted the
u/glennmatthews-render\_jinja2-unsafe

branch
[November 21, 2023 21:16](#event-11029319939)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fpull%2F4832)

Reviewers

[![@gsnider2195](https://avatars.githubusercontent.com/u/75227981?s=40&v=4)](/gsnider2195) [gsnider2195](/gsnider2195)

gsnider2195 approved these changes

[![@HanlinMiao](https://avatars.githubusercontent.com/u/46973263?s=40&v=4)](/HanlinMiao) [HanlinMiao](/HanlinMiao)

HanlinMiao approved these changes

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

3 participants

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=52&v=4)](/glennmatthews) [![@HanlinMiao](https://avatars.githubusercontent.com/u/46973263?s=52&v=4)](/HanlinMiao) [![@gsnider2195](https://avatars.githubusercontent.com/u/75227981?s=52&v=4)](/gsnider2195)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_5308378d_20250114_223848.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fpull%2F4833)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fpull%2F4833)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=nautobot%2Fnautobot)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[nautobot](/nautobot)
/
**[nautobot](/nautobot/nautobot)**
Public

* [Notifications](/login?return_to=%2Fnautobot%2Fnautobot) You must be signed in to change notification settings
* [Fork
  298](/login?return_to=%2Fnautobot%2Fnautobot)
* [Star
   1.1k](/login?return_to=%2Fnautobot%2Fnautobot)

* [Code](/nautobot/nautobot)
* [Issues
  863](/nautobot/nautobot/issues)
* [Pull requests
  24](/nautobot/nautobot/pulls)
* [Discussions](/nautobot/nautobot/discussions)
* [Actions](/nautobot/nautobot/actions)
* [Projects
  0](/nautobot/nautobot/projects)
* [Wiki](/nautobot/nautobot/wiki)
* [Security](/nautobot/nautobot/security)
* [Insights](/nautobot/nautobot/pulse)

Additional navigation options

* [Code](/nautobot/nautobot)
* [Issues](/nautobot/nautobot/issues)
* [Pull requests](/nautobot/nautobot/pulls)
* [Discussions](/nautobot/nautobot/discussions)
* [Actions](/nautobot/nautobot/actions)
* [Projects](/nautobot/nautobot/projects)
* [Wiki](/nautobot/nautobot/wiki)
* [Security](/nautobot/nautobot/security)
* [Insights](/nautobot/nautobot/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fnautobot%2Fnautobot%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fnautobot%2Fnautobot%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# [1.6] Fix unsafe `mark_safe` use in various features #4833

 Merged

[gsnider2195](/gsnider2195)
merged 9 commits into
[ltm-1.6](/nautobot/nautobot/tree/ltm-1.6 "nautobot/nautobot:ltm-1.6")
from
[u/glennmatthews-render\_jinja2-unsafe-1.6](/nautobot/nautobot/tree/u/glennmatthews-render_jinja2-unsafe-1.6 "nautobot/nautobot:u/glennmatthews-render_jinja2-unsafe-1.6")

Nov 21, 2023

 Merged

# [[1.6] Fix unsafe `mark_safe` use in various features](#top) #4833

[gsnider2195](/gsnider2195)
merged 9 commits into
[ltm-1.6](/nautobot/nautobot/tree/ltm-1.6 "nautobot/nautobot:ltm-1.6")
from
[u/glennmatthews-render\_jinja2-unsafe-1.6](/nautobot/nautobot/tree/u/glennmatthews-render_jinja2-unsafe-1.6 "nautobot/nautobot:u/glennmatthews-render_jinja2-unsafe-1.6")

Nov 21, 2023

[Conversation
2](/nautobot/nautobot/pull/4833)
[Commits
9](/nautobot/nautobot/pull/4833/commits)
[Checks
16](/nautobot/nautobot/pull/4833/checks)
[Files changed](/nautobot/nautobot/pull/4833/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=60&v=4)](/glennmatthews)

Copy link

Contributor

### @glennmatthews **[glennmatthews](/glennmatthews)** commented [Nov 21, 2023](#issue-2004294652)

# Closes: [GHSA-cf9f-wmhp-v4pr](https://github.com/advisories/GHSA-cf9f-wmhp-v4pr "GHSA-cf9f-wmhp-v4pr") (for 1.6.x)

# What's Changed

* Audit all uses of `mark_safe` in our code base and change to `format_html` where appropriate for security and integrity.
  + This fixes several cases where `CustomLink`, `ComputedField`, and `JobButton` were provably vulnerable to XSS
  + This also hardens a number of other cases that I wasn't able to trivially exploit but should be considered insecure as previously implemented.
* Add test cases for CustomLink, ComputedField, and JobButton rendering. These are not exhaustive but provide at least some automated validation of the fixes and protection against regression.
* As I originally discovered this issue by experimenting with using `ruff` for linting, I've added `ruff` to the invoke tasks and also to the CI (not yet validated).
  + I've enabled a few basic categories of lint rules (mostly redundant with `flake8`, but inexpensive to cover with `ruff` as well and laying groundwork for eventually removing `flake8` less urgently)
  + I've enabled the `S308` security rule that specifically flags usage of `mark_safe` (there are a lot of other rules in the S category that we should plan to enable and audit over time)
  + I've added `# noqa: S308` to the remaining cases of `mark_safe` in our code that I believe to be in fact safe. *I'D STRONGLY APPRECIATE A SANITY CHECK ON ALL OF THESE!*

# TODO

* Explanation of Change(s)
* Added change log fragment(s) (for more information see [the documentation](https://docs.nautobot.com/projects/core/en/stable/development/#creating-changelog-fragments))
* n/a Attached Screenshots, Payload Example
* Unit, Integration Tests
* n/a Documentation Updates (when adding/changing features)
* n/a Example Plugin Updates (when adding/changing features)
* Outline Remaining Work, Constraints from Design

Sorry, something went wrong.

All reactions

 [glennmatthews](/glennmatthews)
added 4 commits
[November 20, 2023 09:43](#commits-pushed-0d91884)

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

`[Audit all uses of mark_safe() and change to format_html() where appro…](/nautobot/nautobot/pull/4833/commits/0d91884b70dcfca9099fb170280bcad99e0d136d "Audit all uses of mark_safe() and change to format_html() where appropriate")`
 …

`[0d91884](/nautobot/nautobot/pull/4833/commits/0d91884b70dcfca9099fb170280bcad99e0d136d)`

```
…priate
```

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

`[Test updates and change fragment](/nautobot/nautobot/pull/4833/commits/e9cb9b56640541a7a931210d36415ac66f916e21 "Test updates and change fragment")`

`[e9cb9b5](/nautobot/nautobot/pull/4833/commits/e9cb9b56640541a7a931210d36415ac66f916e21)`

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

`[Add ruff for linting, add S308 disables to audited code](/nautobot/nautobot/pull/4833/commits/fc8528ecf993ccf86778c249c03ea8f68d3680aa "Add ruff for linting, add S308 disables to audited code")`

`[fc8528e](/nautobot/nautobot/pull/4833/commits/fc8528ecf993ccf86778c249c03ea8f68d3680aa)`

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

`[Test fixes](/nautobot/nautobot/pull/4833/commits/040ec563b7f7a68e2729e59b1291ddfe0fb92e82 "Test fixes")`

`[040ec56](/nautobot/nautobot/pull/4833/commits/040ec563b7f7a68e2729e59b1291ddfe0fb92e82)`

[![glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=60&v=4)](/glennmatthews)

**[glennmatthews](/glennmatthews)**
commented
[Nov 21, 2023](#pullrequestreview-1742034322)

 [View reviewed changes](/nautobot/nautobot/pull/4833/files/040ec563b7f7a68e2729e59b1291ddfe0fb92e82)

[nautobot/utilities/error\_handlers.py](/nautobot/nautobot/pull/4833/files/040ec563b7f7a68e2729e59b1291ddfe0fb92e82#diff-f72be4b6352a2dca3c45e007d36023db1462ada75184f8e69f60b394f19bf210)
Outdated

Comment on lines
18
 to
22

|  |  | dependent\_objects = [] |
| --- | --- | --- |
|  |  | for dependent in protected\_objects[:50]: |
|  |  | if hasattr(dependent, "get\_absolute\_url"): |
|  |  | dependent\_objects.append(f'<a href="{dependent.get\_absolute\_url()}">{escape(dependent)}</a>') |
|  |  | else: |
|  |  | dependent\_objects.append(str(dependent)) |
|  |  | err\_message += ", ".join(dependent\_objects) |
|  |  | err\_message += format\_html\_join( |
|  |  | ", ", |
|  |  | '<a href="{}">{}</a>', |
|  |  | ((dependent.get\_absolute\_url(), dependent) for dependent in protected\_objects[:50]), |
|  |  | ) |

Copy link

Contributor

Author

### @glennmatthews **[glennmatthews](/glennmatthews)** [Nov 21, 2023](#discussion_r1400605505)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

As [@HanlinMiao](https://github.com/HanlinMiao) pointed out, this *might* be problematic in 1.6 as not all models may have a `get_absolute_url()` implementation. (Should be fine in 2.0 since there `BaseModel` provides a default implementation of this method).

Sorry, something went wrong.

 👍
1
 HanlinMiao reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Copy link

Contributor

### @gsnider2195 **[gsnider2195](/gsnider2195)** [Nov 21, 2023](#discussion_r1401201511)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I added the `get_absolute_url` check back to this branch

Sorry, something went wrong.

All reactions

 [glennmatthews](/glennmatthews)
added 3 commits
[November 21, 2023 08:37](#commits-pushed-8abffe3)

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

`[Merge branch 'ltm-1.6' into u/glennmatthews-render_jinja2-unsafe-1.6](/nautobot/nautobot/pull/4833/commits/8abffe3230c8e9e94d9b92eea8801b8ac07bec40 "Merge branch 'ltm-1.6' into u/glennmatthews-render_jinja2-unsafe-1.6")`

`[8abffe3](/nautobot/nautobot/pull/4833/commits/8abffe3230c8e9e94d9b92eea8801b8ac07bec40)`

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

`[Update change fragments](/nautobot/nautobot/pull/4833/commits/45e625d64a3b7487ab06a978a3d51c7ae5710d94 "Update change fragments")`

`[45e625d](/nautobot/nautobot/pull/4833/commits/45e625d64a3b7487ab06a978a3d51c7ae5710d94)`

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

`[One more change fragment](/nautobot/nautobot/pull/4833/commits/b9142c6b8e1870423146b8a3bab6728a7ec34376 "One more change fragment")`

`[b9142c6](/nautobot/nautobot/pull/4833/commits/b9142c6b8e1870423146b8a3bab6728a7ec34376)`

 [![@HanlinMiao](https://avatars.githubusercontent.com/u/46973263?s=40&u=ef6e6c194c0d07f6a0837f33ec4e95c49ab0082d&v=4)](/HanlinMiao)
[HanlinMiao](/HanlinMiao)
self-requested a review
[November 21, 2023 15:38](#event-11026081003)

[![timizuoebideri1](https://avatars.githubusercontent.com/u/94907097?s=60&v=4)](/timizuoebideri1)

**[timizuoebideri1](/timizuoebideri1)**
approved these changes
[Nov 21, 2023](#pullrequestreview-1742509113)

 [View reviewed changes](/nautobot/nautobot/pull/4833/files/b9142c6b8e1870423146b8a3bab6728a7ec34376)

[![HanlinMiao](https://avatars.githubusercontent.com/u/46973263?s=60&v=4)](/HanlinMiao)

**[HanlinMiao](/HanlinMiao)**
approved these changes
[Nov 21, 2023](#pullrequestreview-1742723510)

 [View reviewed changes](/nautobot/nautobot/pull/4833/files/b9142c6b8e1870423146b8a3bab6728a7ec34376)

[![@gsnider2195](https://avatars.githubusercontent.com/u/75227981?s=40&v=4)](/gsnider2195)

`[add get_absolute_url check back to handle_protectederror](/nautobot/nautobot/pull/4833/commits/984c617e5ebccbc0ead2ed70289f4d869082dc64 "add get_absolute_url check back to handle_protectederror")`

`[984c617](/nautobot/nautobot/pull/4833/commits/984c617e5ebccbc0ead2ed70289f4d869082dc64)`

[![gsnider2195](https://avatars.githubusercontent.com/u/75227981?s=60&v=4)](/gsnider2195)

**[gsnider2195](/gsnider2195)**
approved these changes
[Nov 21, 2023](#pullrequestreview-1743120068)

 [View reviewed changes](/nautobot/nautobot/pull/4833/files/984c617e5ebccbc0ead2ed70289f4d869082dc64)

[![@gsnider2195](https://avatars.githubusercontent.com/u/75227981?s=40&v=4)](/gsnider2195)

`[fix ruff](/nautobot/nautobot/pull/4833/commits/701a5e8f8898275edb1bc52a8c6fbaea51dafbd2 "fix ruff")`

`[701a5e8](/nautobot/nautobot/pull/4833/commits/701a5e8f8898275edb1bc52a8c6fbaea51dafbd2)`

 Hide details
View details

[![@gsnider2195](https://avatars.githubusercontent.com/u/75227981?s=40&u=556af7718766ec60d0c51aae5de914385d2da776&v=4)](/gsnider2195)
[gsnider2195](/gsnider2195)
merged commit [`362850f`](/nautobot/nautobot/commit/362850f5a94689a4c75e3188bf6de826c3b012b2)
into
ltm-1.6

[Nov 21, 2023](https://github.com/nautobot/nautobot/pull/4833#event-11029886300)
16 checks passed

 [![@gsnider2195](https://avatars.githubusercontent.com/u/75227981?s=40&u=556af7718766ec60d0c51aae5de914385d2da776&v=4)](/gsnider2195)
[gsnider2195](/gsnider2195)
deleted the
u/glennmatthews-render\_jinja2-unsafe-1.6

branch
[November 21, 2023 22:25](#event-11029886409)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fpull%2F4833)

Reviewers

[![@gsnider2195](https://avatars.githubusercontent.com/u/75227981?s=40&v=4)](/gsnider2195) [gsnider2195](/gsnider2195)

gsnider2195 approved these changes

[![@timizuoebideri1](https://avatars.githubusercontent.com/u/94907097?s=40&v=4)](/timizuoebideri1) [timizuoebideri1](/timizuoebideri1)

timizuoebideri1 approved these changes

[![@HanlinMiao](https://avatars.githubusercontent.com/u/46973263?s=40&v=4)](/HanlinMiao) [HanlinMiao](/HanlinMiao)

HanlinMiao approved these changes

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

4 participants

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=52&v=4)](/glennmatthews) [![@HanlinMiao](https://avatars.githubusercontent.com/u/46973263?s=52&v=4)](/HanlinMiao) [![@gsnider2195](https://avatars.githubusercontent.com/u/75227981?s=52&v=4)](/gsnider2195) [![@timizuoebideri1](https://avatars.githubusercontent.com/u/94907097?s=52&v=4)](/timizuoebideri1)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from docs.djangoproject.com_64001c04_20250114_223827.html ===

[Django](https://www.djangoproject.com/)

The web framework for perfectionists with deadlines.

Toggle theme (current theme: auto)
Toggle theme (current theme: light)
Toggle theme (current theme: dark)
Toggle Light / Dark / Auto color theme

Menu

* [Overview](https://www.djangoproject.com/start/overview/)
* [Download](https://www.djangoproject.com/download/)
* [Documentation](https://docs.djangoproject.com/)
* [News](https://www.djangoproject.com/weblog/)
* [Community](https://www.djangoproject.com/community/)
* [Code](https://github.com/django/django)
* [Issues](https://code.djangoproject.com/)
* [About](https://www.djangoproject.com/foundation/)
* [♥ Donate](https://www.djangoproject.com/fundraising/)
* Toggle theme (current theme: auto)
  Toggle theme (current theme: light)
  Toggle theme (current theme: dark)
  Toggle Light / Dark / Auto color theme

# [Documentation](https://docs.djangoproject.com/en/3.2/)

Search:

Search

* [Getting Help](https://docs.djangoproject.com/en/3.2/faq/help/)

* [el](https://docs.djangoproject.com/el/3.2/ref/utils/)
* [es](https://docs.djangoproject.com/es/3.2/ref/utils/)
* [fr](https://docs.djangoproject.com/fr/3.2/ref/utils/)
* [id](https://docs.djangoproject.com/id/3.2/ref/utils/)
* [it](https://docs.djangoproject.com/it/3.2/ref/utils/)
* [ja](https://docs.djangoproject.com/ja/3.2/ref/utils/)
* [ko](https://docs.djangoproject.com/ko/3.2/ref/utils/)
* [pl](https://docs.djangoproject.com/pl/3.2/ref/utils/)
* [pt-br](https://docs.djangoproject.com/pt-br/3.2/ref/utils/)
* [zh-hans](https://docs.djangoproject.com/zh-hans/3.2/ref/utils/)
* Language: **en**

* [1.8](https://docs.djangoproject.com/en/1.8/ref/utils/)
* [1.10](https://docs.djangoproject.com/en/1.10/ref/utils/)
* [1.11](https://docs.djangoproject.com/en/1.11/ref/utils/)
* [2.0](https://docs.djangoproject.com/en/2.0/ref/utils/)
* [2.1](https://docs.djangoproject.com/en/2.1/ref/utils/)
* [2.2](https://docs.djangoproject.com/en/2.2/ref/utils/)
* [3.0](https://docs.djangoproject.com/en/3.0/ref/utils/)
* [3.1](https://docs.djangoproject.com/en/3.1/ref/utils/)
* [4.0](https://docs.djangoproject.com/en/4.0/ref/utils/)
* [4.1](https://docs.djangoproject.com/en/4.1/ref/utils/)
* [4.2](https://docs.djangoproject.com/en/4.2/ref/utils/)
* [5.0](https://docs.djangoproject.com/en/5.0/ref/utils/)
* [5.1](https://docs.djangoproject.com/en/5.1/ref/utils/)
* [dev](https://docs.djangoproject.com/en/dev/ref/utils/)
* Documentation version:
  **3.2**

# Django Utils[¶](#module-django.utils "Permalink to this headline")

This document covers all stable modules in `django.utils`. Most of the
modules in `django.utils` are designed for internal use and only the
following parts can be considered stable and thus backwards compatible as per
the [internal release deprecation policy](../../internals/release-process/#internal-release-deprecation-policy).

## `django.utils.cache`[¶](#module-django.utils.cache "Permalink to this headline")

This module contains helper functions for controlling HTTP caching. It does so
by managing the `Vary` header of responses. It includes functions to patch
the header of response objects directly and decorators that change functions to
do that header-patching themselves.

For information on the `Vary` header, see [**RFC 7231#section-7.1.4**](https://datatracker.ietf.org/doc/html/rfc7231.html#section-7.1.4).

Essentially, the `Vary` HTTP header defines which headers a cache should take
into account when building its cache key. Requests with the same path but
different header content for headers named in `Vary` need to get different
cache keys to prevent delivery of wrong content.

For example, [internationalization](../../topics/i18n/) middleware would
need to distinguish caches by the `Accept-language` header.

`patch_cache_control`(*response*, *\*\*kwargs*)[[source]](../../_modules/django/utils/cache/#patch_cache_control)[¶](#django.utils.cache.patch_cache_control "Permalink to this definition")

This function patches the `Cache-Control` header by adding all keyword
arguments to it. The transformation is as follows:

* All keyword parameter names are turned to lowercase, and underscores
  are converted to hyphens.
* If the value of a parameter is `True` (exactly `True`, not just a
  true value), only the parameter name is added to the header.
* All other parameters are added with their value, after applying
  `str()` to it.

Changed in Django 3.1:

Support for multiple field names in the `no-cache` directive was
added.

`get_max_age`(*response*)[[source]](../../_modules/django/utils/cache/#get_max_age)[¶](#django.utils.cache.get_max_age "Permalink to this definition")

Returns the max-age from the response Cache-Control header as an integer
(or `None` if it wasn’t found or wasn’t an integer).

`patch_response_headers`(*response*, *cache\_timeout=None*)[[source]](../../_modules/django/utils/cache/#patch_response_headers)[¶](#django.utils.cache.patch_response_headers "Permalink to this definition")

Adds some useful headers to the given `HttpResponse` object:

* `Expires`
* `Cache-Control`

Each header is only added if it isn’t already set.

`cache_timeout` is in seconds. The [`CACHE_MIDDLEWARE_SECONDS`](../settings/#std-setting-CACHE_MIDDLEWARE_SECONDS)
setting is used by default.

`add_never_cache_headers`(*response*)[[source]](../../_modules/django/utils/cache/#add_never_cache_headers)[¶](#django.utils.cache.add_never_cache_headers "Permalink to this definition")

Adds a `Cache-Control: max-age=0, no-cache, no-store, must-revalidate,
private` header to a response to indicate that a page should never be
cached.

`patch_vary_headers`(*response*, *newheaders*)[[source]](../../_modules/django/utils/cache/#patch_vary_headers)[¶](#django.utils.cache.patch_vary_headers "Permalink to this definition")

Adds (or updates) the `Vary` header in the given `HttpResponse` object.
`newheaders` is a list of header names that should be in `Vary`. If
headers contains an asterisk, then `Vary` header will consist of a single
asterisk `'*'`, according to [**RFC 7231#section-7.1.4**](https://datatracker.ietf.org/doc/html/rfc7231.html#section-7.1.4). Otherwise,
existing headers in `Vary` aren’t removed.

`get_cache_key`(*request*, *key\_prefix=None*, *method='GET'*, *cache=None*)[[source]](../../_modules/django/utils/cache/#get_cache_key)[¶](#django.utils.cache.get_cache_key "Permalink to this definition")

Returns a cache key based on the request path. It can be used in the
request phase because it pulls the list of headers to take into account
from the global path registry and uses those to build a cache key to
check against.

If there is no headerlist stored, the page needs to be rebuilt, so this
function returns `None`.

`learn_cache_key`(*request*, *response*, *cache\_timeout=None*, *key\_prefix=None*, *cache=None*)[[source]](../../_modules/django/utils/cache/#learn_cache_key)[¶](#django.utils.cache.learn_cache_key "Permalink to this definition")

Learns what headers to take into account for some request path from the
response object. It stores those headers in a global path registry so that
later access to that path will know what headers to take into account
without building the response object itself. The headers are named in
the `Vary` header of the response, but we want to prevent response
generation.

The list of headers to use for cache key generation is stored in the same
cache as the pages themselves. If the cache ages some data out of the
cache, this means that we have to build the response once to get at the
Vary header and so at the list of headers to use for the cache key.

## `django.utils.dateparse`[¶](#module-django.utils.dateparse "Permalink to this headline")

The functions defined in this module share the following properties:

* They accept strings in ISO 8601 date/time formats (or some close
  alternatives) and return objects from the corresponding classes in Python’s
  [`datetime`](https://docs.python.org/3/library/datetime.html#module-datetime "(in Python v3.12)") module.
* They raise [`ValueError`](https://docs.python.org/3/library/exceptions.html#ValueError "(in Python v3.12)") if their input is well formatted but isn’t a
  valid date or time.
* They return `None` if it isn’t well formatted at all.
* They accept up to picosecond resolution in input, but they truncate it to
  microseconds, since that’s what Python supports.

`parse_date`(*value*)[[source]](../../_modules/django/utils/dateparse/#parse_date)[¶](#django.utils.dateparse.parse_date "Permalink to this definition")

Parses a string and returns a [`datetime.date`](https://docs.python.org/3/library/datetime.html#datetime.date "(in Python v3.12)").

`parse_time`(*value*)[[source]](../../_modules/django/utils/dateparse/#parse_time)[¶](#django.utils.dateparse.parse_time "Permalink to this definition")

Parses a string and returns a [`datetime.time`](https://docs.python.org/3/library/datetime.html#datetime.time "(in Python v3.12)").

UTC offsets aren’t supported; if `value` describes one, the result is
`None`.

Changed in Django 3.1:

Support for comma separators for milliseconds was added.

`parse_datetime`(*value*)[[source]](../../_modules/django/utils/dateparse/#parse_datetime)[¶](#django.utils.dateparse.parse_datetime "Permalink to this definition")

Parses a string and returns a [`datetime.datetime`](https://docs.python.org/3/library/datetime.html#datetime.datetime "(in Python v3.12)").

UTC offsets are supported; if `value` describes one, the result’s
`tzinfo` attribute is a [`datetime.timezone`](https://docs.python.org/3/library/datetime.html#datetime.timezone "(in Python v3.12)") instance.

Changed in Django 3.1:

Support for comma separators for milliseconds was added.

`parse_duration`(*value*)[[source]](../../_modules/django/utils/dateparse/#parse_duration)[¶](#django.utils.dateparse.parse_duration "Permalink to this definition")

Parses a string and returns a [`datetime.timedelta`](https://docs.python.org/3/library/datetime.html#datetime.timedelta "(in Python v3.12)").

Expects data in the format `"DD HH:MM:SS.uuuuuu"`,
`"DD HH:MM:SS,uuuuuu"`, or as specified by ISO 8601 (e.g.
`P4DT1H15M20S` which is equivalent to `4 1:15:20`) or PostgreSQL’s
day-time interval format (e.g. `3 days 04:05:06`).

Changed in Django 3.1:

Support for comma separators for decimal fractions in the ISO 8601
format and for the format `"DD HH:MM:SS,uuuuuu"` was added.

## `django.utils.decorators`[¶](#module-django.utils.decorators "Permalink to this headline")

`method_decorator`(*decorator*, *name=''*)[[source]](../../_modules/django/utils/decorators/#method_decorator)[¶](#django.utils.decorators.method_decorator "Permalink to this definition")

Converts a function decorator into a method decorator. It can be used to
decorate methods or classes; in the latter case, `name` is the name
of the method to be decorated and is required.

`decorator` may also be a list or tuple of functions. They are wrapped
in reverse order so that the call order is the order in which the functions
appear in the list/tuple.

See [decorating class based views](../../topics/class-based-views/intro/#id1) for
example usage.

`decorator_from_middleware`(*middleware\_class*)[[source]](../../_modules/django/utils/decorators/#decorator_from_middleware)[¶](#django.utils.decorators.decorator_from_middleware "Permalink to this definition")

Given a middleware class, returns a view decorator. This lets you use
middleware functionality on a per-view basis. The middleware is created
with no params passed.

It assumes middleware that’s compatible with the old style of Django 1.9
and earlier (having methods like `process_request()`,
`process_exception()`, and `process_response()`).

`decorator_from_middleware_with_args`(*middleware\_class*)[[source]](../../_modules/django/utils/decorators/#decorator_from_middleware_with_args)[¶](#django.utils.decorators.decorator_from_middleware_with_args "Permalink to this definition")

Like `decorator_from_middleware`, but returns a function
that accepts the arguments to be passed to the middleware\_class.
For example, the [`cache_page()`](../../topics/cache/#django.views.decorators.cache.cache_page "django.views.decorators.cache.cache_page")
decorator is created from the `CacheMiddleware` like this:

```
cache_page = decorator_from_middleware_with_args(CacheMiddleware)

@cache_page(3600)
def my_view(request):
    pass

```

`sync_only_middleware`(*middleware*)[[source]](../../_modules/django/utils/decorators/#sync_only_middleware)[¶](#django.utils.decorators.sync_only_middleware "Permalink to this definition")
New in Django 3.1.

Marks a middleware as [synchronous-only](../../topics/http/middleware/#async-middleware). (The
default in Django, but this allows you to future-proof if the default ever
changes in a future release.)

`async_only_middleware`(*middleware*)[[source]](../../_modules/django/utils/decorators/#async_only_middleware)[¶](#django.utils.decorators.async_only_middleware "Permalink to this definition")
New in Django 3.1.

Marks a middleware as [asynchronous-only](../../topics/http/middleware/#async-middleware). Django
will wrap it in an asynchronous event loop when it is called from the WSGI
request path.

`sync_and_async_middleware`(*middleware*)[[source]](../../_modules/django/utils/decorators/#sync_and_async_middleware)[¶](#django.utils.decorators.sync_and_async_middleware "Permalink to this definition")
New in Django 3.1.

Marks a middleware as [sync and async compatible](../../topics/http/middleware/#async-middleware),
this allows to avoid converting requests. You must implement detection of
the current request type to use this decorator. See [asynchronous
middleware documentation](../../topics/http/middleware/#async-middleware) for details.

## `django.utils.encoding`[¶](#module-django.utils.encoding "Permalink to this headline")

`smart_str`(*s*, *encoding='utf-8'*, *strings\_only=False*, *errors='strict'*)[[source]](../../_modules/django/utils/encoding/#smart_str)[¶](#django.utils.encoding.smart_str "Permalink to this definition")

Returns a `str` object representing arbitrary object `s`. Treats
bytestrings using the `encoding` codec.

If `strings_only` is `True`, don’t convert (some) non-string-like
objects.

`is_protected_type`(*obj*)[[source]](../../_modules/django/utils/encoding/#is_protected_type)[¶](#django.utils.encoding.is_protected_type "Permalink to this definition")

Determine if the object instance is of a protected type.

Objects of protected types are preserved as-is when passed to
`force_str(strings_only=True)`.

`force_str`(*s*, *encoding='utf-8'*, *strings\_only=False*, *errors='strict'*)[[source]](../../_modules/django/utils/encoding/#force_str)[¶](#django.utils.encoding.force_str "Permalink to this definition")

Similar to `smart_str()`, except that lazy instances are resolved to
strings, rather than kept as lazy objects.

If `strings_only` is `True`, don’t convert (some) non-string-like
objects.

`smart_bytes`(*s*, *encoding='utf-8'*, *strings\_only=False*, *errors='strict'*)[[source]](../../_modules/django/utils/encoding/#smart_bytes)[¶](#django.utils.encoding.smart_bytes "Permalink to this definition")

Returns a bytestring version of arbitrary object `s`, encoded as
specified in `encoding`.

If `strings_only` is `True`, don’t convert (some) non-string-like
objects.

`force_bytes`(*s*, *encoding='utf-8'*, *strings\_only=False*, *errors='strict'*)[[source]](../../_modules/django/utils/encoding/#force_bytes)[¶](#django.utils.encoding.force_bytes "Permalink to this definition")

Similar to `smart_bytes`, except that lazy instances are resolved to
bytestrings, rather than kept as lazy objects.

If `strings_only` is `True`, don’t convert (some) non-string-like
objects.

`smart_text`(*s*, *encoding='utf-8'*, *strings\_only=False*, *errors='strict'*)[[source]](../../_modules/django/utils/encoding/#smart_text)[¶](#django.utils.encoding.smart_text "Permalink to this definition")

Deprecated since version 3.0.

Alias of [`smart_str()`](#django.utils.encoding.smart_str "django.utils.encoding.smart_str") for backwards compatibility, especially in code
that supports Python 2.

`force_text`(*s*, *encoding='utf-8'*, *strings\_only=False*, *errors='strict'*)[[source]](../../_modules/django/utils/encoding/#force_text)[¶](#django.utils.encoding.force_text "Permalink to this definition")

Deprecated since version 3.0.

Alias of [`force_str()`](#django.utils.encoding.force_str "django.utils.encoding.force_str") for backwards compatibility, especially in code
that supports Python 2.

`iri_to_uri`(*iri*)[[source]](../../_modules/django/utils/encoding/#iri_to_uri)[¶](#django.utils.encoding.iri_to_uri "Permalink to this definition")

Convert an Internationalized Resource Identifier (IRI) portion to a URI
portion that is suitable for inclusion in a URL.

This is the algorithm from section 3.1 of [**RFC 3987#section-3.1**](https://datatracker.ietf.org/doc/html/rfc3987.html#section-3.1), slightly
simplified since the input is assumed to be a string rather than an
arbitrary byte stream.

Takes an IRI (string or UTF-8 bytes) and returns a string containing the
encoded result.

`uri_to_iri`(*uri*)[[source]](../../_modules/django/utils/encoding/#uri_to_iri)[¶](#django.utils.encoding.uri_to_iri "Permalink to this definition")

Converts a Uniform Resource Identifier into an Internationalized Resource
Identifier.

This is an algorithm from section 3.2 of [**RFC 3987#section-3.2**](https://datatracker.ietf.org/doc/html/rfc3987.html#section-3.2).

Takes a URI in ASCII bytes and returns a string containing the encoded
result.

`filepath_to_uri`(*path*)[[source]](../../_modules/django/utils/encoding/#filepath_to_uri)[¶](#django.utils.encoding.filepath_to_uri "Permalink to this definition")

Convert a file system path to a URI portion that is suitable for inclusion
in a URL. The path is assumed to be either UTF-8 bytes, string, or a
[`Path`](https://docs.python.org/3/library/pathlib.html#pathlib.Path "(in Python v3.12)").

This method will encode certain characters that would normally be
recognized as special characters for URIs. Note that this method does not
encode the ‘ character, as it is a valid character within URIs. See
`encodeURIComponent()` JavaScript function for more details.

Returns an ASCII string containing the encoded result.

Changed in Django 3.1:

Support for [`pathlib.Path`](https://docs.python.org/3/library/pathlib.html#pathlib.Path "(in Python v3.12)") `path` was added.

`escape_uri_path`(*path*)[[source]](../../_modules/django/utils/encoding/#escape_uri_path)[¶](#django.utils.encoding.escape_uri_path "Permalink to this definition")

Escapes the unsafe characters from the path portion of a Uniform Resource
Identifier (URI).

## `django.utils.feedgenerator`[¶](#module-django.utils.feedgenerator "Permalink to this headline")

Sample usage:

```
>>> from django.utils import feedgenerator
>>> feed = feedgenerator.Rss201rev2Feed(
...     title="Poynter E-Media Tidbits",
...     link="http://www.poynter.org/column.asp?id=31",
...     description="A group Weblog by the sharpest minds in online media/journalism/publishing.",
...     language="en",
... )
>>> feed.add_item(
...     title="Hello",
...     link="http://www.holovaty.com/test/",
...     description="Testing.",
... )
>>> with open('test.rss', 'w') as fp:
...     feed.write(fp, 'utf-8')

```

For simplifying the selection of a generator use `feedgenerator.DefaultFeed`
which is currently `Rss201rev2Feed`

For definitions of the different versions of RSS, see:
[https://web.archive.org/web/20110718035220/http://diveintomark.org/archives/2004/02/04/incompatible-rss](https://web.archive.org/web/20110718035220/http%3A//diveintomark.org/archives/2004/02/04/incompatible-rss)

`get_tag_uri`(*url*, *date*)[[source]](../../_modules/django/utils/feedgenerator/#get_tag_uri)[¶](#django.utils.feedgenerator.get_tag_uri "Permalink to this definition")

Creates a TagURI.

See [https://web.archive.org/web/20110514113830/http://diveintomark.org/archives/2004/05/28/howto-atom-id](https://web.archive.org/web/20110514113830/http%3A//diveintomark.org/archives/2004/05/28/howto-atom-id)

### `SyndicationFeed`[¶](#syndicationfeed "Permalink to this headline")

*class* `SyndicationFeed`[[source]](../../_modules/django/utils/feedgenerator/#SyndicationFeed)[¶](#django.utils.feedgenerator.SyndicationFeed "Permalink to this definition")

Base class for all syndication feeds. Subclasses should provide write().

`__init__`(*title*, *link*, *description*, *language=None*, *author\_email=None*, *author\_name=None*, *author\_link=None*, *subtitle=None*, *categories=None*, *feed\_url=None*, *feed\_copyright=None*, *feed\_guid=None*, *ttl=None*, *\*\*kwargs*)[[source]](../../_modules/django/utils/feedgenerator/#SyndicationFeed.__init__)[¶](#django.utils.feedgenerator.SyndicationFeed.__init__ "Permalink to this definition")

Initialize the feed with the given dictionary of metadata, which applies
to the entire feed.

Any extra keyword arguments you pass to `__init__` will be stored in
`self.feed`.

All parameters should be strings, except `categories`, which should
be a sequence of strings.

`add_item`(*title*, *link*, *description*, *author\_email=None*, *author\_name=None*, *author\_link=None*, *pubdate=None*, *comments=None*, *unique\_id=None*, *categories=()*, *item\_copyright=None*, *ttl=None*, *updateddate=None*, *enclosures=None*, *\*\*kwargs*)[[source]](../../_modules/django/utils/feedgenerator/#SyndicationFeed.add_item)[¶](#django.utils.feedgenerator.SyndicationFeed.add_item "Permalink to this definition")

Adds an item to the feed. All args are expected to be strings except
`pubdate` and `updateddate`, which are `datetime.datetime`
objects, and `enclosures`, which is a list of `Enclosure` instances.

`num_items`()[[source]](../../_modules/django/utils/feedgenerator/#SyndicationFeed.num_items)[¶](#django.utils.feedgenerator.SyndicationFeed.num_items "Permalink to this definition")

`root_attributes`()[[source]](../../_modules/django/utils/feedgenerator/#SyndicationFeed.root_attributes)[¶](#django.utils.feedgenerator.SyndicationFeed.root_attributes "Permalink to this definition")

Return extra attributes to place on the root (i.e. feed/channel)
element. Called from `write()`.

`add_root_elements`(*handler*)[[source]](../../_modules/django/utils/feedgenerator/#SyndicationFeed.add_root_elements)[¶](#django.utils.feedgenerator.SyndicationFeed.add_root_elements "Permalink to this definition")

Add elements in the root (i.e. feed/channel) element.
Called from `write()`.

`item_attributes`(*item*)[[source]](../../_modules/django/utils/feedgenerator/#SyndicationFeed.item_attributes)[¶](#django.utils.feedgenerator.SyndicationFeed.item_attributes "Permalink to this definition")

Return extra attributes to place on each item (i.e. item/entry)
element.

`add_item_elements`(*handler*, *item*)[[source]](../../_modules/django/utils/feedgenerator/#SyndicationFeed.add_item_elements)[¶](#django.utils.feedgenerator.SyndicationFeed.add_item_elements "Permalink to this definition")

Add elements on each item (i.e. item/entry) element.

`write`(*outfile*, *encoding*)[[source]](../../_modules/django/utils/feedgenerator/#SyndicationFeed.write)[¶](#django.utils.feedgenerator.SyndicationFeed.write "Permalink to this definition")

Outputs the feed in the given encoding to `outfile`, which is a
file-like object. Subclasses should override this.

`writeString`(*encoding*)[[source]](../../_modules/django/utils/feedgenerator/#SyndicationFeed.writeString)[¶](#django.utils.feedgenerator.SyndicationFeed.writeString "Permalink to this definition")

Returns the feed in the given encoding as a string.

`latest_post_date`()[[source]](../../_modules/django/utils/feedgenerator/#SyndicationFeed.latest_post_date)[¶](#django.utils.feedgenerator.SyndicationFeed.latest_post_date "Permalink to this definition")

Returns the latest `pubdate` or `updateddate` for all items in the
feed. If no items have either of these attributes this returns the
current UTC date/time.

### `Enclosure`[¶](#enclosure "Permalink to this headline")

*class* `Enclosure`[[source]](../../_modules/django/utils/feedgenerator/#Enclosure)[¶](#django.utils.feedgenerator.Enclosure "Permalink to this definition")

Represents an RSS enclosure

### `RssFeed`[¶](#rssfeed "Permalink to this headline")

*class* `RssFeed`(*SyndicationFeed*)[[source]](../../_modules/django/utils/feedgenerator/#RssFeed)[¶](#django.utils.feedgenerator.RssFeed "Permalink to this definition")

### `Rss201rev2Feed`[¶](#rss201rev2feed "Permalink to this headline")

*class* `Rss201rev2Feed`(*RssFeed*)[[source]](../../_modules/django/utils/feedgenerator/#Rss201rev2Feed)[¶](#django.utils.feedgenerator.Rss201rev2Feed "Permalink to this definition")

Spec: <https://cyber.harvard.edu/rss/rss.html>

### `RssUserland091Feed`[¶](#rssuserland091feed "Permalink to this headline")

*class* `RssUserland091Feed`(*RssFeed*)[[source]](../../_modules/django/utils/feedgenerator/#RssUserland091Feed)[¶](#django.utils.feedgenerator.RssUserland091Feed "Permalink to this definition")

Spec: <http://backend.userland.com/rss091>

### `Atom1Feed`[¶](#atom1feed "Permalink to this headline")

*class* `Atom1Feed`(*SyndicationFeed*)[[source]](../../_modules/django/utils/feedgenerator/#Atom1Feed)[¶](#django.utils.feedgenerator.Atom1Feed "Permalink to this definition")

Spec: [**RFC 4287**](https://datatracker.ietf.org/doc/html/rfc4287.html)

## `django.utils.functional`[¶](#module-django.utils.functional "Permalink to this headline")

*class* `cached_property`(*func*, *name=None*)[[source]](../../_modules/django/utils/functional/#cached_property)[¶](#django.utils.functional.cached_property "Permalink to this definition")

The `@cached_property` decorator caches the result of a method with a
single `self` argument as a property. The cached result will persist
as long as the instance does, so if the instance is passed around and the
function subsequently invoked, the cached result will be returned.

Consider a typical case, where a view might need to call a model’s method
to perform some computation, before placing the model instance into the
context, where the template might invoke the method once more:

```
# the model
class Person(models.Model):

    def friends(self):
        # expensive computation
        ...
        return friends

# in the view:
if person.friends():
    ...

```

And in the template you would have:

```
{% for friend in person.friends %}

```

Here, `friends()` will be called twice. Since the instance `person` in
the view and the template are the same, decorating the `friends()` method
with `@cached_property` can avoid that:

```
from django.utils.functional import cached_property

class Person(models.Model):

    @cached_property
    def friends(self):
        ...

```

Note that as the method is now a property, in Python code it will need to
be accessed appropriately:

```
# in the view:
if person.friends:
    ...

```

The cached value can be treated like an ordinary attribute of the instance:

```
# clear it, requiring re-computation next time it's called
del person.friends # or delattr(person, "friends")

# set a value manually, that will persist on the instance until cleared
person.friends = ["Huckleberry Finn", "Tom Sawyer"]

```

Because of the way the [descriptor protocol](https://docs.python.org/3/reference/datamodel.html#descriptor-invocation "(in Python v3.12)") works, using `del` (or `delattr`) on a
`cached_property` that hasn’t been accessed raises `AttributeError`.

As well as offering potential performance advantages, `@cached_property`
can ensure that an attribute’s value does not change unexpectedly over the
life of an instance. This could occur with a method whose computation is
based on `datetime.now()`, or if a change were saved to the database by
some other process in the brief interval between subsequent invocations of
a method on the same instance.

You can make cached properties of methods. For example, if you had an
expensive `get_friends()` method and wanted to allow calling it without
retrieving the cached value, you could write:

```
friends = cached_property(get_friends, name='friends')

```

You only need the `name` argument for Python < 3.6 support.

While `person.get_friends()` will recompute the friends on each call, the
value of the cached property will persist until you delete it as described
above:

```
x = person.friends         # calls first time
y = person.get_friends()   # calls again
z = person.friends         # does not call
x is z                     # is True

```

*class* `classproperty`(*method=None*)[[source]](../../_modules/django/utils/functional/#classproperty)[¶](#django.utils.functional.classproperty "Permalink to this definition")
New in Django 3.1.

Similar to [`@classmethod`](https://docs.python.org/3/library/functions.html#classmethod "(in Python v3.12)"), the `@classproperty`
decorator converts the result of a method with a single `cls` argument
into a property that can be accessed directly from the class.

`keep_lazy`(*func*, *\*resultclasses*)[[source]](../../_modules/django/utils/functional/#keep_lazy)[¶](#django.utils.functional.keep_lazy "Permalink to this definition")

Django offers many utility functions (particularly in `django.utils`)
that take a string as their first argument and do something to that string.
These functions are used by template filters as well as directly in other
code.

If you write your own similar functions and deal with translations, you’ll
face the problem of what to do when the first argument is a lazy
translation object. You don’t want to convert it to a string immediately,
because you might be using this function outside of a view (and hence the
current thread’s locale setting will not be correct).

For cases like this, use the `django.utils.functional.keep_lazy()`
decorator. It modifies the function so that *if* it’s called with a lazy
translation as one of its arguments, the function evaluation is delayed
until it needs to be converted to a string.

For example:

```
from django.utils.functional import keep_lazy, keep_lazy_text

def fancy_utility_function(s, ...):
    # Do some conversion on string 's'
    ...
fancy_utility_function = keep_lazy(str)(fancy_utility_function)

# Or more succinctly:
@keep_lazy(str)
def fancy_utility_function(s, ...):
    ...

```

The `keep_lazy()` decorator takes a number of extra arguments (`*args`)
specifying the type(s) that the original function can return. A common
use case is to have functions that return text. For these, you can pass the
`str` type to `keep_lazy` (or use the [`keep_lazy_text()`](#django.utils.functional.keep_lazy_text "django.utils.functional.keep_lazy_text") decorator
described in the next section).

Using this decorator means you can write your function and assume that the
input is a proper string, then add support for lazy translation objects at
the end.

`keep_lazy_text`(*func*)[[source]](../../_modules/django/utils/functional/#keep_lazy_text)[¶](#django.utils.functional.keep_lazy_text "Permalink to this definition")

A shortcut for `keep_lazy(str)(func)`.

If you have a function that returns text and you want to be able to take
lazy arguments while delaying their evaluation, you can use this
decorator:

```
from django.utils.functional import keep_lazy, keep_lazy_text

# Our previous example was:
@keep_lazy(str)
def fancy_utility_function(s, ...):
    ...

# Which can be rewritten as:
@keep_lazy_text
def fancy_utility_function(s, ...):
    ...

```

## `django.utils.html`[¶](#module-django.utils.html "Permalink to this headline")

Usually you should build up HTML using Django’s templates to make use of its
autoescape mechanism, using the utilities in [`django.utils.safestring`](#module-django.utils.safestring "django.utils.safestring: Functions and classes for working with strings that can be displayed safely without further escaping in HTML.")
where appropriate. This module provides some additional low level utilities for
escaping HTML.

`escape`(*text*)[[source]](../../_modules/django/utils/html/#escape)[¶](#django.utils.html.escape "Permalink to this definition")

Returns the given text with ampersands, quotes and angle brackets encoded
for use in HTML. The input is first coerced to a string and the output has
[`mark_safe()`](#django.utils.safestring.mark_safe "django.utils.safestring.mark_safe") applied.

`conditional_escape`(*text*)[[source]](../../_modules/django/utils/html/#conditional_escape)[¶](#django.utils.html.conditional_escape "Permalink to this definition")

Similar to `escape()`, except that it doesn’t operate on pre-escaped
strings, so it will not double escape.

`format_html`(*format\_string*, *\*args*, *\*\*kwargs*)[[source]](../../_modules/django/utils/html/#format_html)[¶](#django.utils.html.format_html "Permalink to this definition")

This is similar to [`str.format()`](https://docs.python.org/3/library/stdtypes.html#str.format "(in Python v3.12)"), except that it is appropriate for
building up HTML fragments. All args and kwargs are passed through
[`conditional_escape()`](#django.utils.html.conditional_escape "django.utils.html.conditional_escape") before being passed to `str.format()`.

For the case of building up small HTML fragments, this function is to be
preferred over string interpolation using `%` or `str.format()`
directly, because it applies escaping to all arguments - just like the
template system applies escaping by default.

So, instead of writing:

```
mark_safe("%s <b>%s</b> %s" % (
    some_html,
    escape(some_text),
    escape(some_other_text),
))

```

You should instead use:

```
format_html("{} <b>{}</b> {}",
    mark_safe(some_html),
    some_text,
    some_other_text,
)

```

This has the advantage that you don’t need to apply [`escape()`](#django.utils.html.escape "django.utils.html.escape") to each
argument and risk a bug and an XSS vulnerability if you forget one.

Note that although this function uses `str.format()` to do the
interpolation, some of the formatting options provided by `str.format()`
(e.g. number formatting) will not work, since all arguments are passed
through [`conditional_escape()`](#django.utils.html.conditional_escape "django.utils.html.conditional_escape") which (ultimately) calls
[`force_str()`](#django.utils.encoding.force_str "django.utils.encoding.force_str") on the values.

`format_html_join`(*sep*, *format\_string*, *args\_generator*)[[source]](../../_modules/django/utils/html/#format_html_join)[¶](#django.utils.html.format_html_join "Permalink to this definition")

A wrapper of [`format_html()`](#django.utils.html.format_html "django.utils.html.format_html"), for the common case of a group of
arguments that need to be formatted using the same format string, and then
joined using `sep`. `sep` is also passed through
[`conditional_escape()`](#django.utils.html.conditional_escape "django.utils.html.conditional_escape").

`args_generator` should be an iterator that returns the sequence of
`args` that will be passed to [`format_html()`](#django.utils.html.format_html "django.utils.html.format_html"). For example:

```
format_html_join(
    '\n', "<li>{} {}</li>",
    ((u.first_name, u.last_name) for u in users)
)

```

`strip_tags`(*value*)[[source]](../../_modules/django/utils/html/#strip_tags)[¶](#django.utils.html.strip_tags "Permalink to this definition")

Tries to remove anything that looks like an HTML tag from the string, that
is anything contained within `<>`.

Absolutely NO guarantee is provided about the resulting string being
HTML safe. So NEVER mark safe the result of a `strip_tag` call without
escaping it first, for example with [`escape()`](#django.utils.html.escape "django.utils.html.escape").

For example:

```
strip_tags(value)

```

If `value` is `"<b>Joel</b> <button>is</button> a <span>slug</span>"`
the return value will be `"Joel is a slug"`.

If you are looking for a more robust solution, take a look at the [bleach](https://pypi.org/project/bleach/) Python library.

`html_safe`()[[source]](../../_modules/django/utils/html/#html_safe)[¶](#django.utils.html.html_safe "Permalink to this definition")

The `__html__()` method on a class helps non-Django templates detect
classes whose output doesn’t require HTML escaping.

This decorator defines the `__html__()` method on the decorated class
by wrapping `__str__()` in [`mark_safe()`](#django.utils.safestring.mark_safe "django.utils.safestring.mark_safe").
Ensure the `__str__()` method does indeed return text that doesn’t
require HTML escaping.

## `django.utils.http`[¶](#module-django.utils.http "Permalink to this headline")

`urlencode`(*query*, *doseq=False*)[[source]](../../_modules/django/utils/http/#urlencode)[¶](#django.utils.http.urlencode "Permalink to this definition")

A version of Python’s [`urllib.parse.urlencode()`](https://docs.python.org/3/library/urllib.parse.html#urllib.parse.urlencode "(in Python v3.12)") function that can
operate on `MultiValueDict` and non-string values.

`http_date`(*epoch\_seconds=None*)[[source]](../../_modules/django/utils/http/#http_date)[¶](#django.utils.http.http_date "Permalink to this definition")

Formats the time to match the [**RFC 1123#section-5.2.14**](https://datatracker.ietf.org/doc/html/rfc1123.html#section-5.2.14) date format as
specified by HTTP [**RFC 7231#section-7.1.1.1**](https://datatracker.ietf.org/doc/html/rfc7231.html#section-7.1.1.1).

Accepts a floating point number expressed in seconds since the epoch in
UTC–such as that outputted by `time.time()`. If set to `None`,
defaults to the current time.

Outputs a string in the format `Wdy, DD Mon YYYY HH:MM:SS GMT`.

`base36_to_int`(*s*)[[source]](../../_modules/django/utils/http/#base36_to_int)[¶](#django.utils.http.base36_to_int "Permalink to this definition")

Converts a base 36 string to an integer.

`int_to_base36`(*i*)[[source]](../../_modules/django/utils/http/#int_to_base36)[¶](#django.utils.http.int_to_base36 "Permalink to this definition")

Converts a positive integer to a base 36 string.

`urlsafe_base64_encode`(*s*)[[source]](../../_modules/django/utils/http/#urlsafe_base64_encode)[¶](#django.utils.http.urlsafe_base64_encode "Permalink to this definition")

Encodes a bytestring to a base64 string for use in URLs, stripping any
trailing equal signs.

`urlsafe_base64_decode`(*s*)[[source]](../../_modules/django/utils/http/#urlsafe_base64_decode)[¶](#django.utils.http.urlsafe_base64_decode "Permalink to this definition")

Decodes a base64 encoded string, adding back any trailing equal signs that
might have been stripped.

## `django.utils.module_loading`[¶](#module-django.utils.module_loading "Permalink to this headline")

Functions for working with Python modules.

`import_string`(*dotted\_path*)[[source]](../../_modules/django/utils/module_loading/#import_string)[¶](#django.utils.module_loading.import_string "Permalink to this definition")

Imports a dotted module path and returns the attribute/class designated by
the last name in the path. Raises `ImportError` if the import failed. For
example:

```
from django.utils.module_loading import import_string
ValidationError = import_string('django.core.exceptions.ValidationError')

```

is equivalent to:

```
from django.core.exceptions import ValidationError

```

## `django.utils.safestring`[¶](#module-django.utils.safestring "Permalink to this headline")

Functions and classes for working with “safe strings”: strings that can be
displayed safely without further escaping in HTML. Marking something as a “safe
string” means that the producer of the string has already turned characters
that should not be interpreted by the HTML engine (e.g. ‘<’) into the
appropriate entities.

*class* `SafeString`[[source]](../../_modules/django/utils/safestring/#SafeString)[¶](#django.utils.safestring.SafeString "Permalink to this definition")

A `str` subclass that has been specifically marked as “safe” (requires no
further escaping) for HTML output purposes.

`mark_safe`(*s*)[[source]](../../_modules/django/utils/safestring/#mark_safe)[¶](#django.utils.safestring.mark_safe "Permalink to this definition")

Explicitly mark a string as safe for (HTML) output purposes. The returned
object can be used everywhere a string is appropriate.

Can be called multiple times on a single string.

Can also be used as a decorator.

For building up fragments of HTML, you should normally be using
[`django.utils.html.format_html()`](#django.utils.html.format_html "django.utils.html.format_html") instead.

String marked safe will become unsafe again if modified. For example:

```
>>> mystr = '<b>Hello World</b>   '
>>> mystr = mark_safe(mystr)
>>> type(mystr)
<class 'django.utils.safestring.SafeString'>

>>> mystr = mystr.strip()  # removing whitespace
>>> type(mystr)
<type 'str'>

```

## `django.utils.text`[¶](#module-django.utils.text "Permalink to this headline")

`format_lazy`(*format\_string*, *\*args*, *\*\*kwargs*)[¶](#django.utils.text.format_lazy "Permalink to this definition")

A version of [`str.format()`](https://docs.python.org/3/library/stdtypes.html#str.format "(in Python v3.12)") for when `format_string`, `args`,
and/or `kwargs` contain lazy objects. The first argument is the string to
be formatted. For example:

```
from django.utils.text import format_lazy
from django.utils.translation import pgettext_lazy

urlpatterns = [
    path(format_lazy('{person}/<int:pk>/', person=pgettext_lazy('URL', 'person')),
         PersonDetailView.as_view()),
]

```

This example allows translators to translate part of the URL. If “person”
is translated to “persona”, the regular expression will match
`persona/(?P<pk>\d+)/$`, e.g. `persona/5/`.

`slugify`(*value*, *allow\_unicode=False*)[[source]](../../_modules/django/utils/text/#slugify)[¶](#django.utils.text.slugify "Permalink to this definition")

Converts a string to a URL slug by:

1. Converting to ASCII if `allow_unicode` is `False` (the default).
2. Converting to lowercase.
3. Removing characters that aren’t alphanumerics, underscores, hyphens, or
   whitespace.
4. Replacing any whitespace or repeated dashes with single dashes.
5. Removing leading and trailing whitespace, dashes, and underscores.

For example:

```
>>> slugify(' Joel is a slug ')
'joel-is-a-slug'

```

If you want to allow Unicode characters, pass `allow_unicode=True`. For
example:

```
>>> slugify('你好 World', allow_unicode=True)
'你好-world'

```

Changed in Django 3.2:

In older versions, leading and trailing dashes and underscores are not
removed.

## `django.utils.timezone`[¶](#module-django.utils.timezone "Permalink to this headline")

`utc`[¶](#django.utils.timezone.utc "Permalink to this definition")

[`tzinfo`](https://docs.python.org/3/library/datetime.html#datetime.tzinfo "(in Python v3.12)") instance that represents UTC.

`get_fixed_timezone`(*offset*)[[source]](../../_modules/django/utils/timezone/#get_fixed_timezone)[¶](#django.utils.timezone.get_fixed_timezone "Permalink to this definition")

Returns a [`tzinfo`](https://docs.python.org/3/library/datetime.html#datetime.tzinfo "(in Python v3.12)") instance that represents a time zone
with a fixed offset from UTC.

`offset` is a [`datetime.timedelta`](https://docs.python.org/3/library/datetime.html#datetime.timedelta "(in Python v3.12)") or an integer number of
minutes. Use positive values for time zones east of UTC and negative
values for west of UTC.

`get_default_timezone`()[[source]](../../_modules/django/utils/timezone/#get_default_timezone)[¶](#django.utils.timezone.get_default_timezone "Permalink to this definition")

Returns a [`tzinfo`](https://docs.python.org/3/library/datetime.html#datetime.tzinfo "(in Python v3.12)") instance that represents the
[default time zone](../../topics/i18n/timezones/#default-current-time-zone).

`get_default_timezone_name`()[[source]](../../_modules/django/utils/timezone/#get_default_timezone_name)[¶](#django.utils.timezone.get_default_timezone_name "Permalink to this definition")

Returns the name of the [default time zone](../../topics/i18n/timezones/#default-current-time-zone).

`get_current_timezone`()[[source]](../../_modules/django/utils/timezone/#get_current_timezone)[¶](#django.utils.timezone.get_current_timezone "Permalink to this definition")

Returns a [`tzinfo`](https://docs.python.org/3/library/datetime.html#datetime.tzinfo "(in Python v3.12)") instance that represents the
[current time zone](../../topics/i18n/timezones/#default-current-time-zone).

`get_current_timezone_name`()[[source]](../../_modules/django/utils/timezone/#get_current_timezone_name)[¶](#django.utils.timezone.get_current_timezone_name "Permalink to this definition")

Returns the name of the [current time zone](../../topics/i18n/timezones/#default-current-time-zone).

`activate`(*timezone*)[[source]](../../_modules/django/utils/timezone/#activate)[¶](#django.utils.timezone.activate "Permalink to this definition")

Sets the [current time zone](../../topics/i18n/timezones/#default-current-time-zone). The
`timezone` argument must be an instance of a [`tzinfo`](https://docs.python.org/3/library/datetime.html#datetime.tzinfo "(in Python v3.12)")
subclass or a time zone name.

`deactivate`()[[source]](../../_modules/django/utils/timezone/#deactivate)[¶](#django.utils.timezone.deactivate "Permalink to this definition")

Unsets the [current time zone](../../topics/i18n/timezones/#default-current-time-zone).

`override`(*timezone*)[[source]](../../_modules/django/utils/timezone/#override)[¶](#django.utils.timezone.override "Permalink to this definition")

This is a Python context manager that sets the [current time zone](../../topics/i18n/timezones/#default-current-time-zone) on entry with [`activate()`](#django.utils.timezone.activate "django.utils.timezone.activate"), and restores
the previously active time zone on exit. If the `timezone` argument is
`None`, the [current time zone](../../topics/i18n/timezones/#default-current-time-zone) is unset
on entry with [`deactivate()`](#django.utils.timezone.deactivate "django.utils.timezone.deactivate") instead.

`override` is also usable as a function decorator.

`localtime`(*value=None*, *timezone=None*)[[source]](../../_modules/django/utils/timezone/#localtime)[¶](#django.utils.timezone.localtime "Permalink to this definition")

Converts an aware [`datetime`](https://docs.python.org/3/library/datetime.html#datetime.datetime "(in Python v3.12)") to a different time zone,
by default the [current time zone](../../topics/i18n/timezones/#default-current-time-zone).

When `value` is omitted, it defaults to [`now()`](#django.utils.timezone.now "django.utils.timezone.now").

This function doesn’t work on naive datetimes; use [`make_aware()`](#django.utils.timezone.make_aware "django.utils.timezone.make_aware")
instead.

`localdate`(*value=None*, *timezone=None*)[[source]](../../_modules/django/utils/timezone/#localdate)[¶](#django.utils.timezone.localdate "Permalink to this definition")

Uses [`localtime()`](#django.utils.timezone.localtime "django.utils.timezone.localtime") to convert an aware [`datetime`](https://docs.python.org/3/library/datetime.html#datetime.datetime "(in Python v3.12)") to a
[`date()`](https://docs.python.org/3/library/datetime.html#datetime.datetime.date "(in Python v3.12)") in a different time zone, by default the
[current time zone](../../topics/i18n/timezones/#default-current-time-zone).

When `value` is omitted, it defaults to [`now()`](#django.utils.timezone.now "django.utils.timezone.now").

This function doesn’t work on naive datetimes.

`now`()[[source]](../../_modules/django/utils/timezone/#now)[¶](#django.utils.timezone.now "Permalink to this definition")

Returns a [`datetime`](https://docs.python.org/3/library/datetime.html#datetime.datetime "(in Python v3.12)") that represents the
current point in time. Exactly what’s returned depends on the value of
[`USE_TZ`](../settings/#std-setting-USE_TZ):

* If [`USE_TZ`](../settings/#std-setting-USE_TZ) is `False`, this will be a
  [naive](../../topics/i18n/timezones/#naive-vs-aware-datetimes) datetime (i.e. a datetime
  without an associated timezone) that represents the current time
  in the system’s local timezone.
* If [`USE_TZ`](../settings/#std-setting-USE_TZ) is `True`, this will be an
  [aware](../../topics/i18n/timezones/#naive-vs-aware-datetimes) datetime representing the
  current time in UTC. Note that [`now()`](#django.utils.timezone.now "django.utils.timezone.now") will always return
  times in UTC regardless of the value of [`TIME_ZONE`](../settings/#std-setting-TIME_ZONE);
  you can use [`localtime()`](#django.utils.timezone.localtime "django.utils.timezone.localtime") to get the time in the current time zone.

`is_aware`(*value*)[[source]](../../_modules/django/utils/timezone/#is_aware)[¶](#django.utils.timezone.is_aware "Permalink to this definition")

Returns `True` if `value` is aware, `False` if it is naive. This
function assumes that `value` is a [`datetime`](https://docs.python.org/3/library/datetime.html#datetime.datetime "(in Python v3.12)").

`is_naive`(*value*)[[source]](../../_modules/django/utils/timezone/#is_naive)[¶](#django.utils.timezone.is_naive "Permalink to this definition")

Returns `True` if `value` is naive, `False` if it is aware. This
function assumes that `value` is a [`datetime`](https://docs.python.org/3/library/datetime.html#datetime.datetime "(in Python v3.12)").

`make_aware`(*value*, *timezone=None*, *is\_dst=None*)[[source]](../../_modules/django/utils/timezone/#make_aware)[¶](#django.utils.timezone.make_aware "Permalink to this definition")

Returns an aware [`datetime`](https://docs.python.org/3/library/datetime.html#datetime.datetime "(in Python v3.12)") that represents the same
point in time as `value` in `timezone`, `value` being a naive
[`datetime`](https://docs.python.org/3/library/datetime.html#datetime.datetime "(in Python v3.12)"). If `timezone` is set to `None`, it
defaults to the [current time zone](../../topics/i18n/timezones/#default-current-time-zone).

When using `pytz`, the `pytz.AmbiguousTimeError` exception is raised if
you try to make `value` aware during a DST transition where the same time
occurs twice (when reverting from DST). Setting `is_dst` to `True` or
`False` will avoid the exception by choosing if the time is
pre-transition or post-transition respectively.

When using `pytz`, the `pytz.NonExistentTimeError` exception is raised
if you try to make `value` aware during a DST transition such that the
time never occurred. For example, if the 2:00 hour is skipped during a DST
transition, trying to make 2:30 aware in that time zone will raise an
exception. To avoid that you can use `is_dst` to specify how
`make_aware()` should interpret such a nonexistent time. If
`is_dst=True` then the above time would be interpreted as 2:30 DST time
(equivalent to 1:30 local time). Conversely, if `is_dst=False` the time
would be interpreted as 2:30 standard time (equivalent to 3:30 local time).

The `is_dst` parameter has no effect when using non-`pytz` timezone
implementations.

`make_naive`(*value*, *timezone=None*)[[source]](../../_modules/django/utils/timezone/#make_naive)[¶](#django.utils.timezone.make_naive "Permalink to this definition")

Returns a naive [`datetime`](https://docs.python.org/3/library/datetime.html#datetime.datetime "(in Python v3.12)") that represents in
`timezone` the same point in time as `value`, `value` being an
aware [`datetime`](https://docs.python.org/3/library/datetime.html#datetime.datetime "(in Python v3.12)"). If `timezone` is set to `None`, it
defaults to the [current time zone](../../topics/i18n/timezones/#default-current-time-zone).

## `django.utils.translation`[¶](#module-django.utils.translation "Permalink to this headline")

For a complete discussion on the usage of the following see the
[translation documentation](../../topics/i18n/translation/).

`gettext`(*message*)[[source]](../../_modules/django/utils/translation/#gettext)[¶](#django.utils.translation.gettext "Permalink to this definition")

Translates `message` and returns it as a string.

`pgettext`(*context*, *message*)[[source]](../../_modules/django/utils/translation/#pgettext)[¶](#django.utils.translation.pgettext "Permalink to this definition")

Translates `message` given the `context` and returns it as a string.

For more information, see [Contextual markers](../../topics/i18n/translation/#contextual-markers).

`gettext_lazy`(*message*)[¶](#django.utils.translation.gettext_lazy "Permalink to this definition")

`pgettext_lazy`(*context*, *message*)[¶](#django.utils.translation.pgettext_lazy "Permalink to this definition")

Same as the non-lazy versions above, but using lazy execution.

See [lazy translations documentation](../../topics/i18n/translation/#lazy-translations).

`gettext_noop`(*message*)[[source]](../../_modules/django/utils/translation/#gettext_noop)[¶](#django.utils.translation.gettext_noop "Permalink to this definition")

Marks strings for translation but doesn’t translate them now. This can be
used to store strings in global variables that should stay in the base
language (because they might be used externally) and will be translated
later.

`ngettext`(*singular*, *plural*, *number*)[[source]](../../_modules/django/utils/translation/#ngettext)[¶](#django.utils.translation.ngettext "Permalink to this definition")

Translates `singular` and `plural` and returns the appropriate string
based on `number`.

`npgettext`(*context*, *singular*, *plural*, *number*)[[source]](../../_modules/django/utils/translation/#npgettext)[¶](#django.utils.translation.npgettext "Permalink to this definition")

Translates `singular` and `plural` and returns the appropriate string
based on `number` and the `context`.

`ngettext_lazy`(*singular*, *plural*, *number*)[[source]](../../_modules/django/utils/translation/#ngettext_lazy)[¶](#django.utils.translation.ngettext_lazy "Permalink to this definition")

`npgettext_lazy`(*context*, *singular*, *plural*, *number*)[[source]](../../_modules/django/utils/translation/#npgettext_lazy)[¶](#django.utils.translation.npgettext_lazy "Permalink to this definition")

Same as the non-lazy versions above, but using lazy execution.

See [lazy translations documentation](../../topics/i18n/translation/#lazy-translations).

`activate`(*language*)[[source]](../../_modules/django/utils/translation/#activate)[¶](#django.utils.translation.activate "Permalink to this definition")

Fetches the translation object for a given language and activates it as
the current translation object for the current thread.

`deactivate`()[[source]](../../_modules/django/utils/translation/#deactivate)[¶](#django.utils.translation.deactivate "Permalink to this definition")

Deactivates the currently active translation object so that further \_ calls
will resolve against the default translation object, again.

`deactivate_all`()[[source]](../../_modules/django/utils/translation/#deactivate_all)[¶](#django.utils.translation.deactivate_all "Permalink to this definition")

Makes the active translation object a `NullTranslations()` instance.
This is useful when we want delayed translations to appear as the original
string for some reason.

`override`(*language*, *deactivate=False*)[[source]](../../_modules/django/utils/translation/#override)[¶](#django.utils.translation.override "Permalink to this definition")

A Python context manager that uses
[`django.utils.translation.activate()`](#django.utils.translation.activate "django.utils.translation.activate") to fetch the translation object
for a given language, activates it as the translation object for the
current thread and reactivates the previous active language on exit.
Optionally, it can deactivate the temporary translation on exit with
[`django.utils.translation.deactivate()`](#django.utils.translation.deactivate "django.utils.translation.deactivate") if the `deactivate` argument
is `True`. If you pass `None` as the language argument, a
`NullTranslations()` instance is activated within the context.

`override` is also usable as a function decorator.

`check_for_language`(*lang\_code*)[[source]](../../_modules/django/utils/translation/#check_for_language)[¶](#django.utils.translation.check_for_language "Permalink to this definition")

Checks whether there is a global language file for the given language
code (e.g. ‘fr’, ‘pt\_BR’). This is used to decide whether a user-provided
language is available.

`get_language`()[[source]](../../_modules/django/utils/translation/#get_language)[¶](#django.utils.translation.get_language "Permalink to this definition")

Returns the currently selected language code. Returns `None` if
translations are temporarily deactivated (by [`deactivate_all()`](#django.utils.translation.deactivate_all "django.utils.translation.deactivate_all") or
when `None` is passed to [`override()`](#django.utils.translation.override "django.utils.translation.override")).

`get_language_bidi`()[[source]](../../_modules/django/utils/translation/#get_language_bidi)[¶](#django.utils.translation.get_language_bidi "Permalink to this definition")

Returns selected language’s BiDi layout:

* `False` = left-to-right layout
* `True` = right-to-left layout

`get_language_from_request`(*request*, *check\_path=False*)[[source]](../../_modules/django/utils/translation/#get_language_from_request)[¶](#django.utils.translation.get_language_from_request "Permalink to this definition")

Analyzes the request to find what language the user wants the system to
show. Only languages listed in settings.LANGUAGES are taken into account.
If the user requests a sublanguage where we have a main language, we send
out the main language.

If `check_path` is `True`, the function first checks the requested URL
for whether its path begins with a language code listed in the
[`LANGUAGES`](../settings/#std-setting-LANGUAGES) setting.

`get_supported_language_variant`(*lang\_code*, *strict=False*)[[source]](../../_modules/django/utils/translation/#get_supported_language_variant)[¶](#django.utils.translation.get_supported_language_variant "Permalink to this definition")

Returns `lang_code` if it’s in the [`LANGUAGES`](../settings/#std-setting-LANGUAGES) setting, possibly
selecting a more generic variant. For example, `'es'` is returned if
`lang_code` is `'es-ar'` and `'es'` is in [`LANGUAGES`](../settings/#std-setting-LANGUAGES) but
`'es-ar'` isn’t.

If `strict` is `False` (the default), a country-specific variant may
be returned when neither the language code nor its generic variant is found.
For example, if only `'es-co'` is in [`LANGUAGES`](../settings/#std-setting-LANGUAGES), that’s
returned for `lang_code`s like `'es'` and `'es-ar'`. Those matches
aren’t returned if `strict=True`.

Raises [`LookupError`](https://docs.python.org/3/library/exceptions.html#LookupError "(in Python v3.12)") if nothing is found.

`to_locale`(*language*)[[source]](../../_modules/django/utils/translation/#to_locale)[¶](#django.utils.translation.to_locale "Permalink to this definition")

Turns a language name (en-us) into a locale name (en\_US).

`templatize`(*src*)[[source]](../../_modules/django/utils/translation/#templatize)[¶](#django.utils.translation.templatize "Permalink to this definition")

Turns a Django template into something that is understood by `xgettext`.
It does so by translating the Django translation tags into standard
`gettext` function invocations.

`LANGUAGE_SESSION_KEY`[¶](#django.utils.translation.LANGUAGE_SESSION_KEY "Permalink to this definition")

Session key under which the active language for the current session is
stored.

Deprecated since version 3.0: The language won’t be stored in the session in Django 4.0. Use the
[`LANGUAGE_COOKIE_NAME`](../settings/#std-setting-LANGUAGE_COOKIE_NAME) cookie instead.

 [`django.urls` functions for use in URLconfs](../urls/)
[Validators](../validators/)

 [Back to Top](#top)
# Additional Information

## Support Django!

![Support Django!](https://static.djangoproject.com/img/fundraising-heart.cd6bb84ffd33.svg)

* [MyBook donated to the Django Software Foundation to support Django development. Donate today!](https://www.djangoproject.com/fundraising/)

## Contents

* Django Utils
  + [`django.utils.cache`](#module-django.utils.cache)
  + [`django.utils.dateparse`](#module-django.utils.dateparse)
  + [`django.utils.decorators`](#module-django.utils.decorators)
  + [`django.utils.encoding`](#module-django.utils.encoding)
  + [`django.utils.feedgenerator`](#module-django.utils.feedgenerator)
    - [`SyndicationFeed`](#syndicationfeed)
    - [`Enclosure`](#enclosure)
    - [`RssFeed`](#rssfeed)
    - [`Rss201rev2Feed`](#rss201rev2feed)
    - [`RssUserland091Feed`](#rssuserland091feed)
    - [`Atom1Feed`](#atom1feed)
  + [`django.utils.functional`](#module-django.utils.functional)
  + [`django.utils.html`](#module-django.utils.html)
  + [`django.utils.http`](#module-django.utils.http)
  + [`django.utils.module_loading`](#module-django.utils.module_loading)
  + [`django.utils.safestring`](#module-django.utils.safestring)
  + [`django.utils.text`](#module-django.utils.text)
  + [`django.utils.timezone`](#module-django.utils.timezone)
  + [`django.utils.translation`](#module-django.utils.translation)

## Browse

* Prev: [`django.urls` functions for use in URLconfs](../urls/)
* Next: [Validators](../validators/)
* [Table of contents](https://docs.djangoproject.com/en/3.2/contents/)
* [General Index](https://docs.djangoproject.com/en/3.2/genindex/)
* [Python Module Index](https://docs.djangoproject.com/en/3.2/py-modindex/)

## You are here:

* [Django 3.2 documentation](https://docs.djangoproject.com/en/3.2/)
  + [API Reference](../)
    - Django Utils

## Getting help

[FAQ](https://docs.djangoproject.com/en/3.2/faq/)
Try the FAQ — it's got answers to many common questions.
[Index](/en/stable/genindex/), [Module Index](/en/stable/py-modindex/), or [Table of Contents](/en/stable/contents/)
Handy when looking for specific information.
#django IRC channel
Ask a question in the #django IRC channel, or search the IRC logs to see if it’s been asked before.
[Django Discord Server](https://discord.gg/xcRH6mN4fa)
Join the Django Discord Community.
[Official Django Forum](https://forum.djangoproject.com/)
Join the community on the Django Forum.
[Ticket tracker](https://code.djangoproject.com/)
Report bugs with Django or Django documentation in our ticket tracker.
## Download:

Offline (Django 3.2):
[HTML](https://media.djangoproject.com/docs/django-docs-3.2-en.zip) |
[PDF](https://media.readthedocs.org/pdf/django/3.2.x/django.pdf) |
[ePub](https://media.readthedocs.org/epub/django/3.2.x/django.epub)

Provided by [Read the Docs](https://readthedocs.org/).

# Django Links

## Learn More

* [About Django](https://www.djangoproject.com/start/overview/)
* [Getting Started with Django](https://www.djangoproject.com/start/)
* [Team
  Organization](https://docs.djangoproject.com/en/dev/internals/organization/)
* [Django Software Foundation](https://www.djangoproject.com/foundation/)
* [Code of Conduct](https://www.djangoproject.com/conduct/)
* [Diversity Statement](https://www.djangoproject.com/diversity/)

## Get Involved

* [Join a Group](https://www.djangoproject.com/community/)
* [Contribute
  to Django](https://docs.djangoproject.com/en/dev/internals/contributing/)
* [Submit
  a Bug](https://docs.djangoproject.com/en/dev/internals/contributing/bugs-and-features/)
* [Report
  a Security Issue](https://docs.djangoproject.com/en/dev/internals/security/#reporting-security-issues)
* [Individual membership](https://www.djangoproject.com/foundation/individual-members/)

## Get Help

* [Getting Help FAQ](https://docs.djangoproject.com/en/stable/faq/)
* #django IRC channel
* [Django Discord](https://discord.gg/xcRH6mN4fa)
* [Official Django Forum](https://forum.djangoproject.com/)

## Follow Us

* [GitHub](https://github.com/django)
* [Twitter](https://twitter.com/djangoproject)
* [Fediverse (Mastodon)](https://fosstodon.org/%40django)
* [News RSS](https://www.djangoproject.com/rss/weblog/)

## Support Us

* [Sponsor Django](https://www.djangoproject.com/fundraising/)
* [Corporate membership](/foundation/corporate-membership/)
* [Official merchandise store](https://django.threadless.com/)
* [Benevity Workplace Giving Program](/foundation/donate/#benevity-giving)

[Django](https://www.djangoproject.com/)

* Hosting by [In-kind
  donors](https://www.djangoproject.com/fundraising/#in-kind-donors)
* Design by [Threespot](https://www.threespot.com)
  & [andrevv](http://andrevv.com/)

© 2005-2025
 [Django Software
Foundation](https://www.djangoproject.com/foundation/) and individual contributors. Django is a
[registered
trademark](https://www.djangoproject.com/trademarks/) of the Django Software Foundation.

This document is for an insecure version of Django that is no longer supported. Please upgrade to a newer release!



=== Content from docs.djangoproject.com_a7657286_20250114_223830.html ===

[Django](https://www.djangoproject.com/)

The web framework for perfectionists with deadlines.

Toggle theme (current theme: auto)
Toggle theme (current theme: light)
Toggle theme (current theme: dark)
Toggle Light / Dark / Auto color theme

Menu

* [Overview](https://www.djangoproject.com/start/overview/)
* [Download](https://www.djangoproject.com/download/)
* [Documentation](https://docs.djangoproject.com/)
* [News](https://www.djangoproject.com/weblog/)
* [Community](https://www.djangoproject.com/community/)
* [Code](https://github.com/django/django)
* [Issues](https://code.djangoproject.com/)
* [About](https://www.djangoproject.com/foundation/)
* [♥ Donate](https://www.djangoproject.com/fundraising/)
* Toggle theme (current theme: auto)
  Toggle theme (current theme: light)
  Toggle theme (current theme: dark)
  Toggle Light / Dark / Auto color theme

# [Documentation](https://docs.djangoproject.com/en/3.2/)

Search:

Search

* [Getting Help](https://docs.djangoproject.com/en/3.2/faq/help/)

* [el](https://docs.djangoproject.com/el/3.2/ref/utils/)
* [es](https://docs.djangoproject.com/es/3.2/ref/utils/)
* [fr](https://docs.djangoproject.com/fr/3.2/ref/utils/)
* [id](https://docs.djangoproject.com/id/3.2/ref/utils/)
* [it](https://docs.djangoproject.com/it/3.2/ref/utils/)
* [ja](https://docs.djangoproject.com/ja/3.2/ref/utils/)
* [ko](https://docs.djangoproject.com/ko/3.2/ref/utils/)
* [pl](https://docs.djangoproject.com/pl/3.2/ref/utils/)
* [pt-br](https://docs.djangoproject.com/pt-br/3.2/ref/utils/)
* [zh-hans](https://docs.djangoproject.com/zh-hans/3.2/ref/utils/)
* Language: **en**

* [1.8](https://docs.djangoproject.com/en/1.8/ref/utils/)
* [1.10](https://docs.djangoproject.com/en/1.10/ref/utils/)
* [1.11](https://docs.djangoproject.com/en/1.11/ref/utils/)
* [2.0](https://docs.djangoproject.com/en/2.0/ref/utils/)
* [2.1](https://docs.djangoproject.com/en/2.1/ref/utils/)
* [2.2](https://docs.djangoproject.com/en/2.2/ref/utils/)
* [3.0](https://docs.djangoproject.com/en/3.0/ref/utils/)
* [3.1](https://docs.djangoproject.com/en/3.1/ref/utils/)
* [4.0](https://docs.djangoproject.com/en/4.0/ref/utils/)
* [4.1](https://docs.djangoproject.com/en/4.1/ref/utils/)
* [4.2](https://docs.djangoproject.com/en/4.2/ref/utils/)
* [5.0](https://docs.djangoproject.com/en/5.0/ref/utils/)
* [5.1](https://docs.djangoproject.com/en/5.1/ref/utils/)
* [dev](https://docs.djangoproject.com/en/dev/ref/utils/)
* Documentation version:
  **3.2**

# Django Utils[¶](#module-django.utils "Permalink to this headline")

This document covers all stable modules in `django.utils`. Most of the
modules in `django.utils` are designed for internal use and only the
following parts can be considered stable and thus backwards compatible as per
the [internal release deprecation policy](../../internals/release-process/#internal-release-deprecation-policy).

## `django.utils.cache`[¶](#module-django.utils.cache "Permalink to this headline")

This module contains helper functions for controlling HTTP caching. It does so
by managing the `Vary` header of responses. It includes functions to patch
the header of response objects directly and decorators that change functions to
do that header-patching themselves.

For information on the `Vary` header, see [**RFC 7231#section-7.1.4**](https://datatracker.ietf.org/doc/html/rfc7231.html#section-7.1.4).

Essentially, the `Vary` HTTP header defines which headers a cache should take
into account when building its cache key. Requests with the same path but
different header content for headers named in `Vary` need to get different
cache keys to prevent delivery of wrong content.

For example, [internationalization](../../topics/i18n/) middleware would
need to distinguish caches by the `Accept-language` header.

`patch_cache_control`(*response*, *\*\*kwargs*)[[source]](../../_modules/django/utils/cache/#patch_cache_control)[¶](#django.utils.cache.patch_cache_control "Permalink to this definition")

This function patches the `Cache-Control` header by adding all keyword
arguments to it. The transformation is as follows:

* All keyword parameter names are turned to lowercase, and underscores
  are converted to hyphens.
* If the value of a parameter is `True` (exactly `True`, not just a
  true value), only the parameter name is added to the header.
* All other parameters are added with their value, after applying
  `str()` to it.

Changed in Django 3.1:

Support for multiple field names in the `no-cache` directive was
added.

`get_max_age`(*response*)[[source]](../../_modules/django/utils/cache/#get_max_age)[¶](#django.utils.cache.get_max_age "Permalink to this definition")

Returns the max-age from the response Cache-Control header as an integer
(or `None` if it wasn’t found or wasn’t an integer).

`patch_response_headers`(*response*, *cache\_timeout=None*)[[source]](../../_modules/django/utils/cache/#patch_response_headers)[¶](#django.utils.cache.patch_response_headers "Permalink to this definition")

Adds some useful headers to the given `HttpResponse` object:

* `Expires`
* `Cache-Control`

Each header is only added if it isn’t already set.

`cache_timeout` is in seconds. The [`CACHE_MIDDLEWARE_SECONDS`](../settings/#std-setting-CACHE_MIDDLEWARE_SECONDS)
setting is used by default.

`add_never_cache_headers`(*response*)[[source]](../../_modules/django/utils/cache/#add_never_cache_headers)[¶](#django.utils.cache.add_never_cache_headers "Permalink to this definition")

Adds a `Cache-Control: max-age=0, no-cache, no-store, must-revalidate,
private` header to a response to indicate that a page should never be
cached.

`patch_vary_headers`(*response*, *newheaders*)[[source]](../../_modules/django/utils/cache/#patch_vary_headers)[¶](#django.utils.cache.patch_vary_headers "Permalink to this definition")

Adds (or updates) the `Vary` header in the given `HttpResponse` object.
`newheaders` is a list of header names that should be in `Vary`. If
headers contains an asterisk, then `Vary` header will consist of a single
asterisk `'*'`, according to [**RFC 7231#section-7.1.4**](https://datatracker.ietf.org/doc/html/rfc7231.html#section-7.1.4). Otherwise,
existing headers in `Vary` aren’t removed.

`get_cache_key`(*request*, *key\_prefix=None*, *method='GET'*, *cache=None*)[[source]](../../_modules/django/utils/cache/#get_cache_key)[¶](#django.utils.cache.get_cache_key "Permalink to this definition")

Returns a cache key based on the request path. It can be used in the
request phase because it pulls the list of headers to take into account
from the global path registry and uses those to build a cache key to
check against.

If there is no headerlist stored, the page needs to be rebuilt, so this
function returns `None`.

`learn_cache_key`(*request*, *response*, *cache\_timeout=None*, *key\_prefix=None*, *cache=None*)[[source]](../../_modules/django/utils/cache/#learn_cache_key)[¶](#django.utils.cache.learn_cache_key "Permalink to this definition")

Learns what headers to take into account for some request path from the
response object. It stores those headers in a global path registry so that
later access to that path will know what headers to take into account
without building the response object itself. The headers are named in
the `Vary` header of the response, but we want to prevent response
generation.

The list of headers to use for cache key generation is stored in the same
cache as the pages themselves. If the cache ages some data out of the
cache, this means that we have to build the response once to get at the
Vary header and so at the list of headers to use for the cache key.

## `django.utils.dateparse`[¶](#module-django.utils.dateparse "Permalink to this headline")

The functions defined in this module share the following properties:

* They accept strings in ISO 8601 date/time formats (or some close
  alternatives) and return objects from the corresponding classes in Python’s
  [`datetime`](https://docs.python.org/3/library/datetime.html#module-datetime "(in Python v3.12)") module.
* They raise [`ValueError`](https://docs.python.org/3/library/exceptions.html#ValueError "(in Python v3.12)") if their input is well formatted but isn’t a
  valid date or time.
* They return `None` if it isn’t well formatted at all.
* They accept up to picosecond resolution in input, but they truncate it to
  microseconds, since that’s what Python supports.

`parse_date`(*value*)[[source]](../../_modules/django/utils/dateparse/#parse_date)[¶](#django.utils.dateparse.parse_date "Permalink to this definition")

Parses a string and returns a [`datetime.date`](https://docs.python.org/3/library/datetime.html#datetime.date "(in Python v3.12)").

`parse_time`(*value*)[[source]](../../_modules/django/utils/dateparse/#parse_time)[¶](#django.utils.dateparse.parse_time "Permalink to this definition")

Parses a string and returns a [`datetime.time`](https://docs.python.org/3/library/datetime.html#datetime.time "(in Python v3.12)").

UTC offsets aren’t supported; if `value` describes one, the result is
`None`.

Changed in Django 3.1:

Support for comma separators for milliseconds was added.

`parse_datetime`(*value*)[[source]](../../_modules/django/utils/dateparse/#parse_datetime)[¶](#django.utils.dateparse.parse_datetime "Permalink to this definition")

Parses a string and returns a [`datetime.datetime`](https://docs.python.org/3/library/datetime.html#datetime.datetime "(in Python v3.12)").

UTC offsets are supported; if `value` describes one, the result’s
`tzinfo` attribute is a [`datetime.timezone`](https://docs.python.org/3/library/datetime.html#datetime.timezone "(in Python v3.12)") instance.

Changed in Django 3.1:

Support for comma separators for milliseconds was added.

`parse_duration`(*value*)[[source]](../../_modules/django/utils/dateparse/#parse_duration)[¶](#django.utils.dateparse.parse_duration "Permalink to this definition")

Parses a string and returns a [`datetime.timedelta`](https://docs.python.org/3/library/datetime.html#datetime.timedelta "(in Python v3.12)").

Expects data in the format `"DD HH:MM:SS.uuuuuu"`,
`"DD HH:MM:SS,uuuuuu"`, or as specified by ISO 8601 (e.g.
`P4DT1H15M20S` which is equivalent to `4 1:15:20`) or PostgreSQL’s
day-time interval format (e.g. `3 days 04:05:06`).

Changed in Django 3.1:

Support for comma separators for decimal fractions in the ISO 8601
format and for the format `"DD HH:MM:SS,uuuuuu"` was added.

## `django.utils.decorators`[¶](#module-django.utils.decorators "Permalink to this headline")

`method_decorator`(*decorator*, *name=''*)[[source]](../../_modules/django/utils/decorators/#method_decorator)[¶](#django.utils.decorators.method_decorator "Permalink to this definition")

Converts a function decorator into a method decorator. It can be used to
decorate methods or classes; in the latter case, `name` is the name
of the method to be decorated and is required.

`decorator` may also be a list or tuple of functions. They are wrapped
in reverse order so that the call order is the order in which the functions
appear in the list/tuple.

See [decorating class based views](../../topics/class-based-views/intro/#id1) for
example usage.

`decorator_from_middleware`(*middleware\_class*)[[source]](../../_modules/django/utils/decorators/#decorator_from_middleware)[¶](#django.utils.decorators.decorator_from_middleware "Permalink to this definition")

Given a middleware class, returns a view decorator. This lets you use
middleware functionality on a per-view basis. The middleware is created
with no params passed.

It assumes middleware that’s compatible with the old style of Django 1.9
and earlier (having methods like `process_request()`,
`process_exception()`, and `process_response()`).

`decorator_from_middleware_with_args`(*middleware\_class*)[[source]](../../_modules/django/utils/decorators/#decorator_from_middleware_with_args)[¶](#django.utils.decorators.decorator_from_middleware_with_args "Permalink to this definition")

Like `decorator_from_middleware`, but returns a function
that accepts the arguments to be passed to the middleware\_class.
For example, the [`cache_page()`](../../topics/cache/#django.views.decorators.cache.cache_page "django.views.decorators.cache.cache_page")
decorator is created from the `CacheMiddleware` like this:

```
cache_page = decorator_from_middleware_with_args(CacheMiddleware)

@cache_page(3600)
def my_view(request):
    pass

```

`sync_only_middleware`(*middleware*)[[source]](../../_modules/django/utils/decorators/#sync_only_middleware)[¶](#django.utils.decorators.sync_only_middleware "Permalink to this definition")
New in Django 3.1.

Marks a middleware as [synchronous-only](../../topics/http/middleware/#async-middleware). (The
default in Django, but this allows you to future-proof if the default ever
changes in a future release.)

`async_only_middleware`(*middleware*)[[source]](../../_modules/django/utils/decorators/#async_only_middleware)[¶](#django.utils.decorators.async_only_middleware "Permalink to this definition")
New in Django 3.1.

Marks a middleware as [asynchronous-only](../../topics/http/middleware/#async-middleware). Django
will wrap it in an asynchronous event loop when it is called from the WSGI
request path.

`sync_and_async_middleware`(*middleware*)[[source]](../../_modules/django/utils/decorators/#sync_and_async_middleware)[¶](#django.utils.decorators.sync_and_async_middleware "Permalink to this definition")
New in Django 3.1.

Marks a middleware as [sync and async compatible](../../topics/http/middleware/#async-middleware),
this allows to avoid converting requests. You must implement detection of
the current request type to use this decorator. See [asynchronous
middleware documentation](../../topics/http/middleware/#async-middleware) for details.

## `django.utils.encoding`[¶](#module-django.utils.encoding "Permalink to this headline")

`smart_str`(*s*, *encoding='utf-8'*, *strings\_only=False*, *errors='strict'*)[[source]](../../_modules/django/utils/encoding/#smart_str)[¶](#django.utils.encoding.smart_str "Permalink to this definition")

Returns a `str` object representing arbitrary object `s`. Treats
bytestrings using the `encoding` codec.

If `strings_only` is `True`, don’t convert (some) non-string-like
objects.

`is_protected_type`(*obj*)[[source]](../../_modules/django/utils/encoding/#is_protected_type)[¶](#django.utils.encoding.is_protected_type "Permalink to this definition")

Determine if the object instance is of a protected type.

Objects of protected types are preserved as-is when passed to
`force_str(strings_only=True)`.

`force_str`(*s*, *encoding='utf-8'*, *strings\_only=False*, *errors='strict'*)[[source]](../../_modules/django/utils/encoding/#force_str)[¶](#django.utils.encoding.force_str "Permalink to this definition")

Similar to `smart_str()`, except that lazy instances are resolved to
strings, rather than kept as lazy objects.

If `strings_only` is `True`, don’t convert (some) non-string-like
objects.

`smart_bytes`(*s*, *encoding='utf-8'*, *strings\_only=False*, *errors='strict'*)[[source]](../../_modules/django/utils/encoding/#smart_bytes)[¶](#django.utils.encoding.smart_bytes "Permalink to this definition")

Returns a bytestring version of arbitrary object `s`, encoded as
specified in `encoding`.

If `strings_only` is `True`, don’t convert (some) non-string-like
objects.

`force_bytes`(*s*, *encoding='utf-8'*, *strings\_only=False*, *errors='strict'*)[[source]](../../_modules/django/utils/encoding/#force_bytes)[¶](#django.utils.encoding.force_bytes "Permalink to this definition")

Similar to `smart_bytes`, except that lazy instances are resolved to
bytestrings, rather than kept as lazy objects.

If `strings_only` is `True`, don’t convert (some) non-string-like
objects.

`smart_text`(*s*, *encoding='utf-8'*, *strings\_only=False*, *errors='strict'*)[[source]](../../_modules/django/utils/encoding/#smart_text)[¶](#django.utils.encoding.smart_text "Permalink to this definition")

Deprecated since version 3.0.

Alias of [`smart_str()`](#django.utils.encoding.smart_str "django.utils.encoding.smart_str") for backwards compatibility, especially in code
that supports Python 2.

`force_text`(*s*, *encoding='utf-8'*, *strings\_only=False*, *errors='strict'*)[[source]](../../_modules/django/utils/encoding/#force_text)[¶](#django.utils.encoding.force_text "Permalink to this definition")

Deprecated since version 3.0.

Alias of [`force_str()`](#django.utils.encoding.force_str "django.utils.encoding.force_str") for backwards compatibility, especially in code
that supports Python 2.

`iri_to_uri`(*iri*)[[source]](../../_modules/django/utils/encoding/#iri_to_uri)[¶](#django.utils.encoding.iri_to_uri "Permalink to this definition")

Convert an Internationalized Resource Identifier (IRI) portion to a URI
portion that is suitable for inclusion in a URL.

This is the algorithm from section 3.1 of [**RFC 3987#section-3.1**](https://datatracker.ietf.org/doc/html/rfc3987.html#section-3.1), slightly
simplified since the input is assumed to be a string rather than an
arbitrary byte stream.

Takes an IRI (string or UTF-8 bytes) and returns a string containing the
encoded result.

`uri_to_iri`(*uri*)[[source]](../../_modules/django/utils/encoding/#uri_to_iri)[¶](#django.utils.encoding.uri_to_iri "Permalink to this definition")

Converts a Uniform Resource Identifier into an Internationalized Resource
Identifier.

This is an algorithm from section 3.2 of [**RFC 3987#section-3.2**](https://datatracker.ietf.org/doc/html/rfc3987.html#section-3.2).

Takes a URI in ASCII bytes and returns a string containing the encoded
result.

`filepath_to_uri`(*path*)[[source]](../../_modules/django/utils/encoding/#filepath_to_uri)[¶](#django.utils.encoding.filepath_to_uri "Permalink to this definition")

Convert a file system path to a URI portion that is suitable for inclusion
in a URL. The path is assumed to be either UTF-8 bytes, string, or a
[`Path`](https://docs.python.org/3/library/pathlib.html#pathlib.Path "(in Python v3.12)").

This method will encode certain characters that would normally be
recognized as special characters for URIs. Note that this method does not
encode the ‘ character, as it is a valid character within URIs. See
`encodeURIComponent()` JavaScript function for more details.

Returns an ASCII string containing the encoded result.

Changed in Django 3.1:

Support for [`pathlib.Path`](https://docs.python.org/3/library/pathlib.html#pathlib.Path "(in Python v3.12)") `path` was added.

`escape_uri_path`(*path*)[[source]](../../_modules/django/utils/encoding/#escape_uri_path)[¶](#django.utils.encoding.escape_uri_path "Permalink to this definition")

Escapes the unsafe characters from the path portion of a Uniform Resource
Identifier (URI).

## `django.utils.feedgenerator`[¶](#module-django.utils.feedgenerator "Permalink to this headline")

Sample usage:

```
>>> from django.utils import feedgenerator
>>> feed = feedgenerator.Rss201rev2Feed(
...     title="Poynter E-Media Tidbits",
...     link="http://www.poynter.org/column.asp?id=31",
...     description="A group Weblog by the sharpest minds in online media/journalism/publishing.",
...     language="en",
... )
>>> feed.add_item(
...     title="Hello",
...     link="http://www.holovaty.com/test/",
...     description="Testing.",
... )
>>> with open('test.rss', 'w') as fp:
...     feed.write(fp, 'utf-8')

```

For simplifying the selection of a generator use `feedgenerator.DefaultFeed`
which is currently `Rss201rev2Feed`

For definitions of the different versions of RSS, see:
[https://web.archive.org/web/20110718035220/http://diveintomark.org/archives/2004/02/04/incompatible-rss](https://web.archive.org/web/20110718035220/http%3A//diveintomark.org/archives/2004/02/04/incompatible-rss)

`get_tag_uri`(*url*, *date*)[[source]](../../_modules/django/utils/feedgenerator/#get_tag_uri)[¶](#django.utils.feedgenerator.get_tag_uri "Permalink to this definition")

Creates a TagURI.

See [https://web.archive.org/web/20110514113830/http://diveintomark.org/archives/2004/05/28/howto-atom-id](https://web.archive.org/web/20110514113830/http%3A//diveintomark.org/archives/2004/05/28/howto-atom-id)

### `SyndicationFeed`[¶](#syndicationfeed "Permalink to this headline")

*class* `SyndicationFeed`[[source]](../../_modules/django/utils/feedgenerator/#SyndicationFeed)[¶](#django.utils.feedgenerator.SyndicationFeed "Permalink to this definition")

Base class for all syndication feeds. Subclasses should provide write().

`__init__`(*title*, *link*, *description*, *language=None*, *author\_email=None*, *author\_name=None*, *author\_link=None*, *subtitle=None*, *categories=None*, *feed\_url=None*, *feed\_copyright=None*, *feed\_guid=None*, *ttl=None*, *\*\*kwargs*)[[source]](../../_modules/django/utils/feedgenerator/#SyndicationFeed.__init__)[¶](#django.utils.feedgenerator.SyndicationFeed.__init__ "Permalink to this definition")

Initialize the feed with the given dictionary of metadata, which applies
to the entire feed.

Any extra keyword arguments you pass to `__init__` will be stored in
`self.feed`.

All parameters should be strings, except `categories`, which should
be a sequence of strings.

`add_item`(*title*, *link*, *description*, *author\_email=None*, *author\_name=None*, *author\_link=None*, *pubdate=None*, *comments=None*, *unique\_id=None*, *categories=()*, *item\_copyright=None*, *ttl=None*, *updateddate=None*, *enclosures=None*, *\*\*kwargs*)[[source]](../../_modules/django/utils/feedgenerator/#SyndicationFeed.add_item)[¶](#django.utils.feedgenerator.SyndicationFeed.add_item "Permalink to this definition")

Adds an item to the feed. All args are expected to be strings except
`pubdate` and `updateddate`, which are `datetime.datetime`
objects, and `enclosures`, which is a list of `Enclosure` instances.

`num_items`()[[source]](../../_modules/django/utils/feedgenerator/#SyndicationFeed.num_items)[¶](#django.utils.feedgenerator.SyndicationFeed.num_items "Permalink to this definition")

`root_attributes`()[[source]](../../_modules/django/utils/feedgenerator/#SyndicationFeed.root_attributes)[¶](#django.utils.feedgenerator.SyndicationFeed.root_attributes "Permalink to this definition")

Return extra attributes to place on the root (i.e. feed/channel)
element. Called from `write()`.

`add_root_elements`(*handler*)[[source]](../../_modules/django/utils/feedgenerator/#SyndicationFeed.add_root_elements)[¶](#django.utils.feedgenerator.SyndicationFeed.add_root_elements "Permalink to this definition")

Add elements in the root (i.e. feed/channel) element.
Called from `write()`.

`item_attributes`(*item*)[[source]](../../_modules/django/utils/feedgenerator/#SyndicationFeed.item_attributes)[¶](#django.utils.feedgenerator.SyndicationFeed.item_attributes "Permalink to this definition")

Return extra attributes to place on each item (i.e. item/entry)
element.

`add_item_elements`(*handler*, *item*)[[source]](../../_modules/django/utils/feedgenerator/#SyndicationFeed.add_item_elements)[¶](#django.utils.feedgenerator.SyndicationFeed.add_item_elements "Permalink to this definition")

Add elements on each item (i.e. item/entry) element.

`write`(*outfile*, *encoding*)[[source]](../../_modules/django/utils/feedgenerator/#SyndicationFeed.write)[¶](#django.utils.feedgenerator.SyndicationFeed.write "Permalink to this definition")

Outputs the feed in the given encoding to `outfile`, which is a
file-like object. Subclasses should override this.

`writeString`(*encoding*)[[source]](../../_modules/django/utils/feedgenerator/#SyndicationFeed.writeString)[¶](#django.utils.feedgenerator.SyndicationFeed.writeString "Permalink to this definition")

Returns the feed in the given encoding as a string.

`latest_post_date`()[[source]](../../_modules/django/utils/feedgenerator/#SyndicationFeed.latest_post_date)[¶](#django.utils.feedgenerator.SyndicationFeed.latest_post_date "Permalink to this definition")

Returns the latest `pubdate` or `updateddate` for all items in the
feed. If no items have either of these attributes this returns the
current UTC date/time.

### `Enclosure`[¶](#enclosure "Permalink to this headline")

*class* `Enclosure`[[source]](../../_modules/django/utils/feedgenerator/#Enclosure)[¶](#django.utils.feedgenerator.Enclosure "Permalink to this definition")

Represents an RSS enclosure

### `RssFeed`[¶](#rssfeed "Permalink to this headline")

*class* `RssFeed`(*SyndicationFeed*)[[source]](../../_modules/django/utils/feedgenerator/#RssFeed)[¶](#django.utils.feedgenerator.RssFeed "Permalink to this definition")

### `Rss201rev2Feed`[¶](#rss201rev2feed "Permalink to this headline")

*class* `Rss201rev2Feed`(*RssFeed*)[[source]](../../_modules/django/utils/feedgenerator/#Rss201rev2Feed)[¶](#django.utils.feedgenerator.Rss201rev2Feed "Permalink to this definition")

Spec: <https://cyber.harvard.edu/rss/rss.html>

### `RssUserland091Feed`[¶](#rssuserland091feed "Permalink to this headline")

*class* `RssUserland091Feed`(*RssFeed*)[[source]](../../_modules/django/utils/feedgenerator/#RssUserland091Feed)[¶](#django.utils.feedgenerator.RssUserland091Feed "Permalink to this definition")

Spec: <http://backend.userland.com/rss091>

### `Atom1Feed`[¶](#atom1feed "Permalink to this headline")

*class* `Atom1Feed`(*SyndicationFeed*)[[source]](../../_modules/django/utils/feedgenerator/#Atom1Feed)[¶](#django.utils.feedgenerator.Atom1Feed "Permalink to this definition")

Spec: [**RFC 4287**](https://datatracker.ietf.org/doc/html/rfc4287.html)

## `django.utils.functional`[¶](#module-django.utils.functional "Permalink to this headline")

*class* `cached_property`(*func*, *name=None*)[[source]](../../_modules/django/utils/functional/#cached_property)[¶](#django.utils.functional.cached_property "Permalink to this definition")

The `@cached_property` decorator caches the result of a method with a
single `self` argument as a property. The cached result will persist
as long as the instance does, so if the instance is passed around and the
function subsequently invoked, the cached result will be returned.

Consider a typical case, where a view might need to call a model’s method
to perform some computation, before placing the model instance into the
context, where the template might invoke the method once more:

```
# the model
class Person(models.Model):

    def friends(self):
        # expensive computation
        ...
        return friends

# in the view:
if person.friends():
    ...

```

And in the template you would have:

```
{% for friend in person.friends %}

```

Here, `friends()` will be called twice. Since the instance `person` in
the view and the template are the same, decorating the `friends()` method
with `@cached_property` can avoid that:

```
from django.utils.functional import cached_property

class Person(models.Model):

    @cached_property
    def friends(self):
        ...

```

Note that as the method is now a property, in Python code it will need to
be accessed appropriately:

```
# in the view:
if person.friends:
    ...

```

The cached value can be treated like an ordinary attribute of the instance:

```
# clear it, requiring re-computation next time it's called
del person.friends # or delattr(person, "friends")

# set a value manually, that will persist on the instance until cleared
person.friends = ["Huckleberry Finn", "Tom Sawyer"]

```

Because of the way the [descriptor protocol](https://docs.python.org/3/reference/datamodel.html#descriptor-invocation "(in Python v3.12)") works, using `del` (or `delattr`) on a
`cached_property` that hasn’t been accessed raises `AttributeError`.

As well as offering potential performance advantages, `@cached_property`
can ensure that an attribute’s value does not change unexpectedly over the
life of an instance. This could occur with a method whose computation is
based on `datetime.now()`, or if a change were saved to the database by
some other process in the brief interval between subsequent invocations of
a method on the same instance.

You can make cached properties of methods. For example, if you had an
expensive `get_friends()` method and wanted to allow calling it without
retrieving the cached value, you could write:

```
friends = cached_property(get_friends, name='friends')

```

You only need the `name` argument for Python < 3.6 support.

While `person.get_friends()` will recompute the friends on each call, the
value of the cached property will persist until you delete it as described
above:

```
x = person.friends         # calls first time
y = person.get_friends()   # calls again
z = person.friends         # does not call
x is z                     # is True

```

*class* `classproperty`(*method=None*)[[source]](../../_modules/django/utils/functional/#classproperty)[¶](#django.utils.functional.classproperty "Permalink to this definition")
New in Django 3.1.

Similar to [`@classmethod`](https://docs.python.org/3/library/functions.html#classmethod "(in Python v3.12)"), the `@classproperty`
decorator converts the result of a method with a single `cls` argument
into a property that can be accessed directly from the class.

`keep_lazy`(*func*, *\*resultclasses*)[[source]](../../_modules/django/utils/functional/#keep_lazy)[¶](#django.utils.functional.keep_lazy "Permalink to this definition")

Django offers many utility functions (particularly in `django.utils`)
that take a string as their first argument and do something to that string.
These functions are used by template filters as well as directly in other
code.

If you write your own similar functions and deal with translations, you’ll
face the problem of what to do when the first argument is a lazy
translation object. You don’t want to convert it to a string immediately,
because you might be using this function outside of a view (and hence the
current thread’s locale setting will not be correct).

For cases like this, use the `django.utils.functional.keep_lazy()`
decorator. It modifies the function so that *if* it’s called with a lazy
translation as one of its arguments, the function evaluation is delayed
until it needs to be converted to a string.

For example:

```
from django.utils.functional import keep_lazy, keep_lazy_text

def fancy_utility_function(s, ...):
    # Do some conversion on string 's'
    ...
fancy_utility_function = keep_lazy(str)(fancy_utility_function)

# Or more succinctly:
@keep_lazy(str)
def fancy_utility_function(s, ...):
    ...

```

The `keep_lazy()` decorator takes a number of extra arguments (`*args`)
specifying the type(s) that the original function can return. A common
use case is to have functions that return text. For these, you can pass the
`str` type to `keep_lazy` (or use the [`keep_lazy_text()`](#django.utils.functional.keep_lazy_text "django.utils.functional.keep_lazy_text") decorator
described in the next section).

Using this decorator means you can write your function and assume that the
input is a proper string, then add support for lazy translation objects at
the end.

`keep_lazy_text`(*func*)[[source]](../../_modules/django/utils/functional/#keep_lazy_text)[¶](#django.utils.functional.keep_lazy_text "Permalink to this definition")

A shortcut for `keep_lazy(str)(func)`.

If you have a function that returns text and you want to be able to take
lazy arguments while delaying their evaluation, you can use this
decorator:

```
from django.utils.functional import keep_lazy, keep_lazy_text

# Our previous example was:
@keep_lazy(str)
def fancy_utility_function(s, ...):
    ...

# Which can be rewritten as:
@keep_lazy_text
def fancy_utility_function(s, ...):
    ...

```

## `django.utils.html`[¶](#module-django.utils.html "Permalink to this headline")

Usually you should build up HTML using Django’s templates to make use of its
autoescape mechanism, using the utilities in [`django.utils.safestring`](#module-django.utils.safestring "django.utils.safestring: Functions and classes for working with strings that can be displayed safely without further escaping in HTML.")
where appropriate. This module provides some additional low level utilities for
escaping HTML.

`escape`(*text*)[[source]](../../_modules/django/utils/html/#escape)[¶](#django.utils.html.escape "Permalink to this definition")

Returns the given text with ampersands, quotes and angle brackets encoded
for use in HTML. The input is first coerced to a string and the output has
[`mark_safe()`](#django.utils.safestring.mark_safe "django.utils.safestring.mark_safe") applied.

`conditional_escape`(*text*)[[source]](../../_modules/django/utils/html/#conditional_escape)[¶](#django.utils.html.conditional_escape "Permalink to this definition")

Similar to `escape()`, except that it doesn’t operate on pre-escaped
strings, so it will not double escape.

`format_html`(*format\_string*, *\*args*, *\*\*kwargs*)[[source]](../../_modules/django/utils/html/#format_html)[¶](#django.utils.html.format_html "Permalink to this definition")

This is similar to [`str.format()`](https://docs.python.org/3/library/stdtypes.html#str.format "(in Python v3.12)"), except that it is appropriate for
building up HTML fragments. All args and kwargs are passed through
[`conditional_escape()`](#django.utils.html.conditional_escape "django.utils.html.conditional_escape") before being passed to `str.format()`.

For the case of building up small HTML fragments, this function is to be
preferred over string interpolation using `%` or `str.format()`
directly, because it applies escaping to all arguments - just like the
template system applies escaping by default.

So, instead of writing:

```
mark_safe("%s <b>%s</b> %s" % (
    some_html,
    escape(some_text),
    escape(some_other_text),
))

```

You should instead use:

```
format_html("{} <b>{}</b> {}",
    mark_safe(some_html),
    some_text,
    some_other_text,
)

```

This has the advantage that you don’t need to apply [`escape()`](#django.utils.html.escape "django.utils.html.escape") to each
argument and risk a bug and an XSS vulnerability if you forget one.

Note that although this function uses `str.format()` to do the
interpolation, some of the formatting options provided by `str.format()`
(e.g. number formatting) will not work, since all arguments are passed
through [`conditional_escape()`](#django.utils.html.conditional_escape "django.utils.html.conditional_escape") which (ultimately) calls
[`force_str()`](#django.utils.encoding.force_str "django.utils.encoding.force_str") on the values.

`format_html_join`(*sep*, *format\_string*, *args\_generator*)[[source]](../../_modules/django/utils/html/#format_html_join)[¶](#django.utils.html.format_html_join "Permalink to this definition")

A wrapper of [`format_html()`](#django.utils.html.format_html "django.utils.html.format_html"), for the common case of a group of
arguments that need to be formatted using the same format string, and then
joined using `sep`. `sep` is also passed through
[`conditional_escape()`](#django.utils.html.conditional_escape "django.utils.html.conditional_escape").

`args_generator` should be an iterator that returns the sequence of
`args` that will be passed to [`format_html()`](#django.utils.html.format_html "django.utils.html.format_html"). For example:

```
format_html_join(
    '\n', "<li>{} {}</li>",
    ((u.first_name, u.last_name) for u in users)
)

```

`strip_tags`(*value*)[[source]](../../_modules/django/utils/html/#strip_tags)[¶](#django.utils.html.strip_tags "Permalink to this definition")

Tries to remove anything that looks like an HTML tag from the string, that
is anything contained within `<>`.

Absolutely NO guarantee is provided about the resulting string being
HTML safe. So NEVER mark safe the result of a `strip_tag` call without
escaping it first, for example with [`escape()`](#django.utils.html.escape "django.utils.html.escape").

For example:

```
strip_tags(value)

```

If `value` is `"<b>Joel</b> <button>is</button> a <span>slug</span>"`
the return value will be `"Joel is a slug"`.

If you are looking for a more robust solution, take a look at the [bleach](https://pypi.org/project/bleach/) Python library.

`html_safe`()[[source]](../../_modules/django/utils/html/#html_safe)[¶](#django.utils.html.html_safe "Permalink to this definition")

The `__html__()` method on a class helps non-Django templates detect
classes whose output doesn’t require HTML escaping.

This decorator defines the `__html__()` method on the decorated class
by wrapping `__str__()` in [`mark_safe()`](#django.utils.safestring.mark_safe "django.utils.safestring.mark_safe").
Ensure the `__str__()` method does indeed return text that doesn’t
require HTML escaping.

## `django.utils.http`[¶](#module-django.utils.http "Permalink to this headline")

`urlencode`(*query*, *doseq=False*)[[source]](../../_modules/django/utils/http/#urlencode)[¶](#django.utils.http.urlencode "Permalink to this definition")

A version of Python’s [`urllib.parse.urlencode()`](https://docs.python.org/3/library/urllib.parse.html#urllib.parse.urlencode "(in Python v3.12)") function that can
operate on `MultiValueDict` and non-string values.

`http_date`(*epoch\_seconds=None*)[[source]](../../_modules/django/utils/http/#http_date)[¶](#django.utils.http.http_date "Permalink to this definition")

Formats the time to match the [**RFC 1123#section-5.2.14**](https://datatracker.ietf.org/doc/html/rfc1123.html#section-5.2.14) date format as
specified by HTTP [**RFC 7231#section-7.1.1.1**](https://datatracker.ietf.org/doc/html/rfc7231.html#section-7.1.1.1).

Accepts a floating point number expressed in seconds since the epoch in
UTC–such as that outputted by `time.time()`. If set to `None`,
defaults to the current time.

Outputs a string in the format `Wdy, DD Mon YYYY HH:MM:SS GMT`.

`base36_to_int`(*s*)[[source]](../../_modules/django/utils/http/#base36_to_int)[¶](#django.utils.http.base36_to_int "Permalink to this definition")

Converts a base 36 string to an integer.

`int_to_base36`(*i*)[[source]](../../_modules/django/utils/http/#int_to_base36)[¶](#django.utils.http.int_to_base36 "Permalink to this definition")

Converts a positive integer to a base 36 string.

`urlsafe_base64_encode`(*s*)[[source]](../../_modules/django/utils/http/#urlsafe_base64_encode)[¶](#django.utils.http.urlsafe_base64_encode "Permalink to this definition")

Encodes a bytestring to a base64 string for use in URLs, stripping any
trailing equal signs.

`urlsafe_base64_decode`(*s*)[[source]](../../_modules/django/utils/http/#urlsafe_base64_decode)[¶](#django.utils.http.urlsafe_base64_decode "Permalink to this definition")

Decodes a base64 encoded string, adding back any trailing equal signs that
might have been stripped.

## `django.utils.module_loading`[¶](#module-django.utils.module_loading "Permalink to this headline")

Functions for working with Python modules.

`import_string`(*dotted\_path*)[[source]](../../_modules/django/utils/module_loading/#import_string)[¶](#django.utils.module_loading.import_string "Permalink to this definition")

Imports a dotted module path and returns the attribute/class designated by
the last name in the path. Raises `ImportError` if the import failed. For
example:

```
from django.utils.module_loading import import_string
ValidationError = import_string('django.core.exceptions.ValidationError')

```

is equivalent to:

```
from django.core.exceptions import ValidationError

```

## `django.utils.safestring`[¶](#module-django.utils.safestring "Permalink to this headline")

Functions and classes for working with “safe strings”: strings that can be
displayed safely without further escaping in HTML. Marking something as a “safe
string” means that the producer of the string has already turned characters
that should not be interpreted by the HTML engine (e.g. ‘<’) into the
appropriate entities.

*class* `SafeString`[[source]](../../_modules/django/utils/safestring/#SafeString)[¶](#django.utils.safestring.SafeString "Permalink to this definition")

A `str` subclass that has been specifically marked as “safe” (requires no
further escaping) for HTML output purposes.

`mark_safe`(*s*)[[source]](../../_modules/django/utils/safestring/#mark_safe)[¶](#django.utils.safestring.mark_safe "Permalink to this definition")

Explicitly mark a string as safe for (HTML) output purposes. The returned
object can be used everywhere a string is appropriate.

Can be called multiple times on a single string.

Can also be used as a decorator.

For building up fragments of HTML, you should normally be using
[`django.utils.html.format_html()`](#django.utils.html.format_html "django.utils.html.format_html") instead.

String marked safe will become unsafe again if modified. For example:

```
>>> mystr = '<b>Hello World</b>   '
>>> mystr = mark_safe(mystr)
>>> type(mystr)
<class 'django.utils.safestring.SafeString'>

>>> mystr = mystr.strip()  # removing whitespace
>>> type(mystr)
<type 'str'>

```

## `django.utils.text`[¶](#module-django.utils.text "Permalink to this headline")

`format_lazy`(*format\_string*, *\*args*, *\*\*kwargs*)[¶](#django.utils.text.format_lazy "Permalink to this definition")

A version of [`str.format()`](https://docs.python.org/3/library/stdtypes.html#str.format "(in Python v3.12)") for when `format_string`, `args`,
and/or `kwargs` contain lazy objects. The first argument is the string to
be formatted. For example:

```
from django.utils.text import format_lazy
from django.utils.translation import pgettext_lazy

urlpatterns = [
    path(format_lazy('{person}/<int:pk>/', person=pgettext_lazy('URL', 'person')),
         PersonDetailView.as_view()),
]

```

This example allows translators to translate part of the URL. If “person”
is translated to “persona”, the regular expression will match
`persona/(?P<pk>\d+)/$`, e.g. `persona/5/`.

`slugify`(*value*, *allow\_unicode=False*)[[source]](../../_modules/django/utils/text/#slugify)[¶](#django.utils.text.slugify "Permalink to this definition")

Converts a string to a URL slug by:

1. Converting to ASCII if `allow_unicode` is `False` (the default).
2. Converting to lowercase.
3. Removing characters that aren’t alphanumerics, underscores, hyphens, or
   whitespace.
4. Replacing any whitespace or repeated dashes with single dashes.
5. Removing leading and trailing whitespace, dashes, and underscores.

For example:

```
>>> slugify(' Joel is a slug ')
'joel-is-a-slug'

```

If you want to allow Unicode characters, pass `allow_unicode=True`. For
example:

```
>>> slugify('你好 World', allow_unicode=True)
'你好-world'

```

Changed in Django 3.2:

In older versions, leading and trailing dashes and underscores are not
removed.

## `django.utils.timezone`[¶](#module-django.utils.timezone "Permalink to this headline")

`utc`[¶](#django.utils.timezone.utc "Permalink to this definition")

[`tzinfo`](https://docs.python.org/3/library/datetime.html#datetime.tzinfo "(in Python v3.12)") instance that represents UTC.

`get_fixed_timezone`(*offset*)[[source]](../../_modules/django/utils/timezone/#get_fixed_timezone)[¶](#django.utils.timezone.get_fixed_timezone "Permalink to this definition")

Returns a [`tzinfo`](https://docs.python.org/3/library/datetime.html#datetime.tzinfo "(in Python v3.12)") instance that represents a time zone
with a fixed offset from UTC.

`offset` is a [`datetime.timedelta`](https://docs.python.org/3/library/datetime.html#datetime.timedelta "(in Python v3.12)") or an integer number of
minutes. Use positive values for time zones east of UTC and negative
values for west of UTC.

`get_default_timezone`()[[source]](../../_modules/django/utils/timezone/#get_default_timezone)[¶](#django.utils.timezone.get_default_timezone "Permalink to this definition")

Returns a [`tzinfo`](https://docs.python.org/3/library/datetime.html#datetime.tzinfo "(in Python v3.12)") instance that represents the
[default time zone](../../topics/i18n/timezones/#default-current-time-zone).

`get_default_timezone_name`()[[source]](../../_modules/django/utils/timezone/#get_default_timezone_name)[¶](#django.utils.timezone.get_default_timezone_name "Permalink to this definition")

Returns the name of the [default time zone](../../topics/i18n/timezones/#default-current-time-zone).

`get_current_timezone`()[[source]](../../_modules/django/utils/timezone/#get_current_timezone)[¶](#django.utils.timezone.get_current_timezone "Permalink to this definition")

Returns a [`tzinfo`](https://docs.python.org/3/library/datetime.html#datetime.tzinfo "(in Python v3.12)") instance that represents the
[current time zone](../../topics/i18n/timezones/#default-current-time-zone).

`get_current_timezone_name`()[[source]](../../_modules/django/utils/timezone/#get_current_timezone_name)[¶](#django.utils.timezone.get_current_timezone_name "Permalink to this definition")

Returns the name of the [current time zone](../../topics/i18n/timezones/#default-current-time-zone).

`activate`(*timezone*)[[source]](../../_modules/django/utils/timezone/#activate)[¶](#django.utils.timezone.activate "Permalink to this definition")

Sets the [current time zone](../../topics/i18n/timezones/#default-current-time-zone). The
`timezone` argument must be an instance of a [`tzinfo`](https://docs.python.org/3/library/datetime.html#datetime.tzinfo "(in Python v3.12)")
subclass or a time zone name.

`deactivate`()[[source]](../../_modules/django/utils/timezone/#deactivate)[¶](#django.utils.timezone.deactivate "Permalink to this definition")

Unsets the [current time zone](../../topics/i18n/timezones/#default-current-time-zone).

`override`(*timezone*)[[source]](../../_modules/django/utils/timezone/#override)[¶](#django.utils.timezone.override "Permalink to this definition")

This is a Python context manager that sets the [current time zone](../../topics/i18n/timezones/#default-current-time-zone) on entry with [`activate()`](#django.utils.timezone.activate "django.utils.timezone.activate"), and restores
the previously active time zone on exit. If the `timezone` argument is
`None`, the [current time zone](../../topics/i18n/timezones/#default-current-time-zone) is unset
on entry with [`deactivate()`](#django.utils.timezone.deactivate "django.utils.timezone.deactivate") instead.

`override` is also usable as a function decorator.

`localtime`(*value=None*, *timezone=None*)[[source]](../../_modules/django/utils/timezone/#localtime)[¶](#django.utils.timezone.localtime "Permalink to this definition")

Converts an aware [`datetime`](https://docs.python.org/3/library/datetime.html#datetime.datetime "(in Python v3.12)") to a different time zone,
by default the [current time zone](../../topics/i18n/timezones/#default-current-time-zone).

When `value` is omitted, it defaults to [`now()`](#django.utils.timezone.now "django.utils.timezone.now").

This function doesn’t work on naive datetimes; use [`make_aware()`](#django.utils.timezone.make_aware "django.utils.timezone.make_aware")
instead.

`localdate`(*value=None*, *timezone=None*)[[source]](../../_modules/django/utils/timezone/#localdate)[¶](#django.utils.timezone.localdate "Permalink to this definition")

Uses [`localtime()`](#django.utils.timezone.localtime "django.utils.timezone.localtime") to convert an aware [`datetime`](https://docs.python.org/3/library/datetime.html#datetime.datetime "(in Python v3.12)") to a
[`date()`](https://docs.python.org/3/library/datetime.html#datetime.datetime.date "(in Python v3.12)") in a different time zone, by default the
[current time zone](../../topics/i18n/timezones/#default-current-time-zone).

When `value` is omitted, it defaults to [`now()`](#django.utils.timezone.now "django.utils.timezone.now").

This function doesn’t work on naive datetimes.

`now`()[[source]](../../_modules/django/utils/timezone/#now)[¶](#django.utils.timezone.now "Permalink to this definition")

Returns a [`datetime`](https://docs.python.org/3/library/datetime.html#datetime.datetime "(in Python v3.12)") that represents the
current point in time. Exactly what’s returned depends on the value of
[`USE_TZ`](../settings/#std-setting-USE_TZ):

* If [`USE_TZ`](../settings/#std-setting-USE_TZ) is `False`, this will be a
  [naive](../../topics/i18n/timezones/#naive-vs-aware-datetimes) datetime (i.e. a datetime
  without an associated timezone) that represents the current time
  in the system’s local timezone.
* If [`USE_TZ`](../settings/#std-setting-USE_TZ) is `True`, this will be an
  [aware](../../topics/i18n/timezones/#naive-vs-aware-datetimes) datetime representing the
  current time in UTC. Note that [`now()`](#django.utils.timezone.now "django.utils.timezone.now") will always return
  times in UTC regardless of the value of [`TIME_ZONE`](../settings/#std-setting-TIME_ZONE);
  you can use [`localtime()`](#django.utils.timezone.localtime "django.utils.timezone.localtime") to get the time in the current time zone.

`is_aware`(*value*)[[source]](../../_modules/django/utils/timezone/#is_aware)[¶](#django.utils.timezone.is_aware "Permalink to this definition")

Returns `True` if `value` is aware, `False` if it is naive. This
function assumes that `value` is a [`datetime`](https://docs.python.org/3/library/datetime.html#datetime.datetime "(in Python v3.12)").

`is_naive`(*value*)[[source]](../../_modules/django/utils/timezone/#is_naive)[¶](#django.utils.timezone.is_naive "Permalink to this definition")

Returns `True` if `value` is naive, `False` if it is aware. This
function assumes that `value` is a [`datetime`](https://docs.python.org/3/library/datetime.html#datetime.datetime "(in Python v3.12)").

`make_aware`(*value*, *timezone=None*, *is\_dst=None*)[[source]](../../_modules/django/utils/timezone/#make_aware)[¶](#django.utils.timezone.make_aware "Permalink to this definition")

Returns an aware [`datetime`](https://docs.python.org/3/library/datetime.html#datetime.datetime "(in Python v3.12)") that represents the same
point in time as `value` in `timezone`, `value` being a naive
[`datetime`](https://docs.python.org/3/library/datetime.html#datetime.datetime "(in Python v3.12)"). If `timezone` is set to `None`, it
defaults to the [current time zone](../../topics/i18n/timezones/#default-current-time-zone).

When using `pytz`, the `pytz.AmbiguousTimeError` exception is raised if
you try to make `value` aware during a DST transition where the same time
occurs twice (when reverting from DST). Setting `is_dst` to `True` or
`False` will avoid the exception by choosing if the time is
pre-transition or post-transition respectively.

When using `pytz`, the `pytz.NonExistentTimeError` exception is raised
if you try to make `value` aware during a DST transition such that the
time never occurred. For example, if the 2:00 hour is skipped during a DST
transition, trying to make 2:30 aware in that time zone will raise an
exception. To avoid that you can use `is_dst` to specify how
`make_aware()` should interpret such a nonexistent time. If
`is_dst=True` then the above time would be interpreted as 2:30 DST time
(equivalent to 1:30 local time). Conversely, if `is_dst=False` the time
would be interpreted as 2:30 standard time (equivalent to 3:30 local time).

The `is_dst` parameter has no effect when using non-`pytz` timezone
implementations.

`make_naive`(*value*, *timezone=None*)[[source]](../../_modules/django/utils/timezone/#make_naive)[¶](#django.utils.timezone.make_naive "Permalink to this definition")

Returns a naive [`datetime`](https://docs.python.org/3/library/datetime.html#datetime.datetime "(in Python v3.12)") that represents in
`timezone` the same point in time as `value`, `value` being an
aware [`datetime`](https://docs.python.org/3/library/datetime.html#datetime.datetime "(in Python v3.12)"). If `timezone` is set to `None`, it
defaults to the [current time zone](../../topics/i18n/timezones/#default-current-time-zone).

## `django.utils.translation`[¶](#module-django.utils.translation "Permalink to this headline")

For a complete discussion on the usage of the following see the
[translation documentation](../../topics/i18n/translation/).

`gettext`(*message*)[[source]](../../_modules/django/utils/translation/#gettext)[¶](#django.utils.translation.gettext "Permalink to this definition")

Translates `message` and returns it as a string.

`pgettext`(*context*, *message*)[[source]](../../_modules/django/utils/translation/#pgettext)[¶](#django.utils.translation.pgettext "Permalink to this definition")

Translates `message` given the `context` and returns it as a string.

For more information, see [Contextual markers](../../topics/i18n/translation/#contextual-markers).

`gettext_lazy`(*message*)[¶](#django.utils.translation.gettext_lazy "Permalink to this definition")

`pgettext_lazy`(*context*, *message*)[¶](#django.utils.translation.pgettext_lazy "Permalink to this definition")

Same as the non-lazy versions above, but using lazy execution.

See [lazy translations documentation](../../topics/i18n/translation/#lazy-translations).

`gettext_noop`(*message*)[[source]](../../_modules/django/utils/translation/#gettext_noop)[¶](#django.utils.translation.gettext_noop "Permalink to this definition")

Marks strings for translation but doesn’t translate them now. This can be
used to store strings in global variables that should stay in the base
language (because they might be used externally) and will be translated
later.

`ngettext`(*singular*, *plural*, *number*)[[source]](../../_modules/django/utils/translation/#ngettext)[¶](#django.utils.translation.ngettext "Permalink to this definition")

Translates `singular` and `plural` and returns the appropriate string
based on `number`.

`npgettext`(*context*, *singular*, *plural*, *number*)[[source]](../../_modules/django/utils/translation/#npgettext)[¶](#django.utils.translation.npgettext "Permalink to this definition")

Translates `singular` and `plural` and returns the appropriate string
based on `number` and the `context`.

`ngettext_lazy`(*singular*, *plural*, *number*)[[source]](../../_modules/django/utils/translation/#ngettext_lazy)[¶](#django.utils.translation.ngettext_lazy "Permalink to this definition")

`npgettext_lazy`(*context*, *singular*, *plural*, *number*)[[source]](../../_modules/django/utils/translation/#npgettext_lazy)[¶](#django.utils.translation.npgettext_lazy "Permalink to this definition")

Same as the non-lazy versions above, but using lazy execution.

See [lazy translations documentation](../../topics/i18n/translation/#lazy-translations).

`activate`(*language*)[[source]](../../_modules/django/utils/translation/#activate)[¶](#django.utils.translation.activate "Permalink to this definition")

Fetches the translation object for a given language and activates it as
the current translation object for the current thread.

`deactivate`()[[source]](../../_modules/django/utils/translation/#deactivate)[¶](#django.utils.translation.deactivate "Permalink to this definition")

Deactivates the currently active translation object so that further \_ calls
will resolve against the default translation object, again.

`deactivate_all`()[[source]](../../_modules/django/utils/translation/#deactivate_all)[¶](#django.utils.translation.deactivate_all "Permalink to this definition")

Makes the active translation object a `NullTranslations()` instance.
This is useful when we want delayed translations to appear as the original
string for some reason.

`override`(*language*, *deactivate=False*)[[source]](../../_modules/django/utils/translation/#override)[¶](#django.utils.translation.override "Permalink to this definition")

A Python context manager that uses
[`django.utils.translation.activate()`](#django.utils.translation.activate "django.utils.translation.activate") to fetch the translation object
for a given language, activates it as the translation object for the
current thread and reactivates the previous active language on exit.
Optionally, it can deactivate the temporary translation on exit with
[`django.utils.translation.deactivate()`](#django.utils.translation.deactivate "django.utils.translation.deactivate") if the `deactivate` argument
is `True`. If you pass `None` as the language argument, a
`NullTranslations()` instance is activated within the context.

`override` is also usable as a function decorator.

`check_for_language`(*lang\_code*)[[source]](../../_modules/django/utils/translation/#check_for_language)[¶](#django.utils.translation.check_for_language "Permalink to this definition")

Checks whether there is a global language file for the given language
code (e.g. ‘fr’, ‘pt\_BR’). This is used to decide whether a user-provided
language is available.

`get_language`()[[source]](../../_modules/django/utils/translation/#get_language)[¶](#django.utils.translation.get_language "Permalink to this definition")

Returns the currently selected language code. Returns `None` if
translations are temporarily deactivated (by [`deactivate_all()`](#django.utils.translation.deactivate_all "django.utils.translation.deactivate_all") or
when `None` is passed to [`override()`](#django.utils.translation.override "django.utils.translation.override")).

`get_language_bidi`()[[source]](../../_modules/django/utils/translation/#get_language_bidi)[¶](#django.utils.translation.get_language_bidi "Permalink to this definition")

Returns selected language’s BiDi layout:

* `False` = left-to-right layout
* `True` = right-to-left layout

`get_language_from_request`(*request*, *check\_path=False*)[[source]](../../_modules/django/utils/translation/#get_language_from_request)[¶](#django.utils.translation.get_language_from_request "Permalink to this definition")

Analyzes the request to find what language the user wants the system to
show. Only languages listed in settings.LANGUAGES are taken into account.
If the user requests a sublanguage where we have a main language, we send
out the main language.

If `check_path` is `True`, the function first checks the requested URL
for whether its path begins with a language code listed in the
[`LANGUAGES`](../settings/#std-setting-LANGUAGES) setting.

`get_supported_language_variant`(*lang\_code*, *strict=False*)[[source]](../../_modules/django/utils/translation/#get_supported_language_variant)[¶](#django.utils.translation.get_supported_language_variant "Permalink to this definition")

Returns `lang_code` if it’s in the [`LANGUAGES`](../settings/#std-setting-LANGUAGES) setting, possibly
selecting a more generic variant. For example, `'es'` is returned if
`lang_code` is `'es-ar'` and `'es'` is in [`LANGUAGES`](../settings/#std-setting-LANGUAGES) but
`'es-ar'` isn’t.

If `strict` is `False` (the default), a country-specific variant may
be returned when neither the language code nor its generic variant is found.
For example, if only `'es-co'` is in [`LANGUAGES`](../settings/#std-setting-LANGUAGES), that’s
returned for `lang_code`s like `'es'` and `'es-ar'`. Those matches
aren’t returned if `strict=True`.

Raises [`LookupError`](https://docs.python.org/3/library/exceptions.html#LookupError "(in Python v3.12)") if nothing is found.

`to_locale`(*language*)[[source]](../../_modules/django/utils/translation/#to_locale)[¶](#django.utils.translation.to_locale "Permalink to this definition")

Turns a language name (en-us) into a locale name (en\_US).

`templatize`(*src*)[[source]](../../_modules/django/utils/translation/#templatize)[¶](#django.utils.translation.templatize "Permalink to this definition")

Turns a Django template into something that is understood by `xgettext`.
It does so by translating the Django translation tags into standard
`gettext` function invocations.

`LANGUAGE_SESSION_KEY`[¶](#django.utils.translation.LANGUAGE_SESSION_KEY "Permalink to this definition")

Session key under which the active language for the current session is
stored.

Deprecated since version 3.0: The language won’t be stored in the session in Django 4.0. Use the
[`LANGUAGE_COOKIE_NAME`](../settings/#std-setting-LANGUAGE_COOKIE_NAME) cookie instead.

 [`django.urls` functions for use in URLconfs](../urls/)
[Validators](../validators/)

 [Back to Top](#top)
# Additional Information

## Support Django!

![Support Django!](https://static.djangoproject.com/img/fundraising-heart.cd6bb84ffd33.svg)

* [MyBook donated to the Django Software Foundation to support Django development. Donate today!](https://www.djangoproject.com/fundraising/)

## Contents

* Django Utils
  + [`django.utils.cache`](#module-django.utils.cache)
  + [`django.utils.dateparse`](#module-django.utils.dateparse)
  + [`django.utils.decorators`](#module-django.utils.decorators)
  + [`django.utils.encoding`](#module-django.utils.encoding)
  + [`django.utils.feedgenerator`](#module-django.utils.feedgenerator)
    - [`SyndicationFeed`](#syndicationfeed)
    - [`Enclosure`](#enclosure)
    - [`RssFeed`](#rssfeed)
    - [`Rss201rev2Feed`](#rss201rev2feed)
    - [`RssUserland091Feed`](#rssuserland091feed)
    - [`Atom1Feed`](#atom1feed)
  + [`django.utils.functional`](#module-django.utils.functional)
  + [`django.utils.html`](#module-django.utils.html)
  + [`django.utils.http`](#module-django.utils.http)
  + [`django.utils.module_loading`](#module-django.utils.module_loading)
  + [`django.utils.safestring`](#module-django.utils.safestring)
  + [`django.utils.text`](#module-django.utils.text)
  + [`django.utils.timezone`](#module-django.utils.timezone)
  + [`django.utils.translation`](#module-django.utils.translation)

## Browse

* Prev: [`django.urls` functions for use in URLconfs](../urls/)
* Next: [Validators](../validators/)
* [Table of contents](https://docs.djangoproject.com/en/3.2/contents/)
* [General Index](https://docs.djangoproject.com/en/3.2/genindex/)
* [Python Module Index](https://docs.djangoproject.com/en/3.2/py-modindex/)

## You are here:

* [Django 3.2 documentation](https://docs.djangoproject.com/en/3.2/)
  + [API Reference](../)
    - Django Utils

## Getting help

[FAQ](https://docs.djangoproject.com/en/3.2/faq/)
Try the FAQ — it's got answers to many common questions.
[Index](/en/stable/genindex/), [Module Index](/en/stable/py-modindex/), or [Table of Contents](/en/stable/contents/)
Handy when looking for specific information.
#django IRC channel
Ask a question in the #django IRC channel, or search the IRC logs to see if it’s been asked before.
[Django Discord Server](https://discord.gg/xcRH6mN4fa)
Join the Django Discord Community.
[Official Django Forum](https://forum.djangoproject.com/)
Join the community on the Django Forum.
[Ticket tracker](https://code.djangoproject.com/)
Report bugs with Django or Django documentation in our ticket tracker.
## Download:

Offline (Django 3.2):
[HTML](https://media.djangoproject.com/docs/django-docs-3.2-en.zip) |
[PDF](https://media.readthedocs.org/pdf/django/3.2.x/django.pdf) |
[ePub](https://media.readthedocs.org/epub/django/3.2.x/django.epub)

Provided by [Read the Docs](https://readthedocs.org/).

# Django Links

## Learn More

* [About Django](https://www.djangoproject.com/start/overview/)
* [Getting Started with Django](https://www.djangoproject.com/start/)
* [Team
  Organization](https://docs.djangoproject.com/en/dev/internals/organization/)
* [Django Software Foundation](https://www.djangoproject.com/foundation/)
* [Code of Conduct](https://www.djangoproject.com/conduct/)
* [Diversity Statement](https://www.djangoproject.com/diversity/)

## Get Involved

* [Join a Group](https://www.djangoproject.com/community/)
* [Contribute
  to Django](https://docs.djangoproject.com/en/dev/internals/contributing/)
* [Submit
  a Bug](https://docs.djangoproject.com/en/dev/internals/contributing/bugs-and-features/)
* [Report
  a Security Issue](https://docs.djangoproject.com/en/dev/internals/security/#reporting-security-issues)
* [Individual membership](https://www.djangoproject.com/foundation/individual-members/)

## Get Help

* [Getting Help FAQ](https://docs.djangoproject.com/en/stable/faq/)
* #django IRC channel
* [Django Discord](https://discord.gg/xcRH6mN4fa)
* [Official Django Forum](https://forum.djangoproject.com/)

## Follow Us

* [GitHub](https://github.com/django)
* [Twitter](https://twitter.com/djangoproject)
* [Fediverse (Mastodon)](https://fosstodon.org/%40django)
* [News RSS](https://www.djangoproject.com/rss/weblog/)

## Support Us

* [Sponsor Django](https://www.djangoproject.com/fundraising/)
* [Corporate membership](/foundation/corporate-membership/)
* [Official merchandise store](https://django.threadless.com/)
* [Benevity Workplace Giving Program](/foundation/donate/#benevity-giving)

[Django](https://www.djangoproject.com/)

* Hosting by [In-kind
  donors](https://www.djangoproject.com/fundraising/#in-kind-donors)
* Design by [Threespot](https://www.threespot.com)
  & [andrevv](http://andrevv.com/)

© 2005-2025
 [Django Software
Foundation](https://www.djangoproject.com/foundation/) and individual contributors. Django is a
[registered
trademark](https://www.djangoproject.com/trademarks/) of the Django Software Foundation.

This document is for an insecure version of Django that is no longer supported. Please upgrade to a newer release!



=== Content from github.com_c881c807_20250114_223848.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fsecurity%2Fadvisories%2FGHSA-cf9f-wmhp-v4pr)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fsecurity%2Fadvisories%2FGHSA-cf9f-wmhp-v4pr)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=nautobot%2Fnautobot)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[nautobot](/nautobot)
/
**[nautobot](/nautobot/nautobot)**
Public

* [Notifications](/login?return_to=%2Fnautobot%2Fnautobot) You must be signed in to change notification settings
* [Fork
  298](/login?return_to=%2Fnautobot%2Fnautobot)
* [Star
   1.1k](/login?return_to=%2Fnautobot%2Fnautobot)

* [Code](/nautobot/nautobot)
* [Issues
  863](/nautobot/nautobot/issues)
* [Pull requests
  24](/nautobot/nautobot/pulls)
* [Discussions](/nautobot/nautobot/discussions)
* [Actions](/nautobot/nautobot/actions)
* [Projects
  0](/nautobot/nautobot/projects)
* [Wiki](/nautobot/nautobot/wiki)
* [Security](/nautobot/nautobot/security)
* [Insights](/nautobot/nautobot/pulse)

Additional navigation options

* [Code](/nautobot/nautobot)
* [Issues](/nautobot/nautobot/issues)
* [Pull requests](/nautobot/nautobot/pulls)
* [Discussions](/nautobot/nautobot/discussions)
* [Actions](/nautobot/nautobot/actions)
* [Projects](/nautobot/nautobot/projects)
* [Wiki](/nautobot/nautobot/wiki)
* [Security](/nautobot/nautobot/security)
* [Insights](/nautobot/nautobot/pulse)

# XSS potential in custom links, job buttons, and computed fields

High

[gsnider2195](/gsnider2195)
published
GHSA-cf9f-wmhp-v4pr
Nov 22, 2023

## Package

pip

nautobot
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

<1.6.6,<2.0.5

## Patched versions

1.6.6,2.0.5

## Description

### Impact

*What kind of vulnerability is it? Who is impacted?*

All users of Nautobot versions earlier than 1.6.6 or 2.0.5 are potentially affected.

Due to incorrect usage of Django's `mark_safe()` API when rendering certain types of user-authored content, including:

* custom links
* job buttons
* computed fields

it is possible that users with permission to create or edit these types of content could craft a malicious payload (such as JavaScript code) that would be executed when rendering pages containing this content.

### Patches

*Has the problem been patched? What versions should users upgrade to?*

We have fixed the incorrect uses of `mark_safe()` (generally by replacing them with appropriate use of `format_html()` instead) to prevent such malicious data from being executed.

Users on Nautobot 1.6.x LTM should upgrade to v1.6.6 and users on Nautobot 2.0.x should upgrade to v2.0.5.

### Workarounds

*Is there a way for users to fix or remediate the vulnerability without upgrading?*

Appropriate object permissions can and should be applied to restrict which users are permitted to create or edit the aforementioned types of user-authored content. Other than that, there is no direct fix available.

### References

*Are there any links users can visit to find out more?*

* [#4832](https://github.com/nautobot/nautobot/pull/4832)
* [#4833](https://github.com/nautobot/nautobot/pull/4833)
* <https://docs.djangoproject.com/en/3.2/ref/utils/#django.utils.html.format_html>
* <https://docs.djangoproject.com/en/3.2/ref/utils/#django.utils.safestring.mark_safe>

### Severity

High

7.1

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
High

Privileges required
Low

User interaction
Required

Scope
Changed

Confidentiality
Low

Integrity
High

Availability
Low

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:H/PR:L/UI:R/S:C/C:L/I:H/A:L

### CVE ID

CVE-2023-48705

### Weaknesses

[CWE-80](/advisories?query=cwe%3A80)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


