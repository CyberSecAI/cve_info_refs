=== Content from plugins.trac.wordpress.org_9a7a0e42_20250114_203705.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F2896729%2Fpowerpress)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/2895048/powerpress "Changeset 2895048 for powerpress")
* [Next Change](/changeset/2896730/powerpress "Changeset 2896730 for powerpress") →

---

# Changeset [2896729](/changeset/2896729 "Show full changeset") for [powerpress](/browser/powerpress?rev=2896729 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
04/10/2023 06:16:11 PM
([22 months](/timeline?from=2023-04-10T18%3A16%3A11Z&precision=second "See timeline at 04/10/2023 06:16:11 PM") ago)

Author:
benbeecroft
Message:

PowerPress 10.0.1

Location:
[powerpress/trunk](/browser/powerpress/trunk?rev=2896729)
Files:

6 edited

* [class.powerpress-subscribe-widget.php](/browser/powerpress/trunk/class.powerpress-subscribe-widget.php?rev=2896729 "Show entry in browser")
  (modified)
  ([2 diffs](#file0 "Show differences"))
* [powerpress-player.php](/browser/powerpress/trunk/powerpress-player.php?rev=2896729 "Show entry in browser")
  (modified)
  ([17 diffs](#file1 "Show differences"))
* [powerpress-subscribe.php](/browser/powerpress/trunk/powerpress-subscribe.php?rev=2896729 "Show entry in browser")
  (modified)
  ([8 diffs](#file2 "Show differences"))
* [powerpress.php](/browser/powerpress/trunk/powerpress.php?rev=2896729 "Show entry in browser")
  (modified)
  ([2 diffs](#file3 "Show differences"))
* [powerpressadmin.php](/browser/powerpress/trunk/powerpressadmin.php?rev=2896729 "Show entry in browser")
  (modified)
  ([1 diff](#file4 "Show differences"))
* [readme.txt](/browser/powerpress/trunk/readme.txt?rev=2896729 "Show entry in browser")
  (modified)
  ([2 diffs](#file5 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [powerpress/trunk/class.powerpress-subscribe-widget.php](/changeset/2896729/powerpress/trunk/class.powerpress-subscribe-widget.php "Show the changeset 2896729 restricted to powerpress/trunk/class.powerpress-subscribe-widget.php")

  | [r2808231](/browser/powerpress/trunk/class.powerpress-subscribe-widget.php?rev=2808231#L128 "Show revision 2808231 of this file in browser") | [r2896729](/browser/powerpress/trunk/class.powerpress-subscribe-widget.php?rev=2896729#L128 "Show revision 2896729 of this file in browser") |  |
  | --- | --- | --- |
  | 128 | 128 | <option value=""><?php echo \_\_('Select Post Type', 'powerpress'); ?></option> |
  | 129 | 129 | <?php |
  | 130 |  | $post\_types = powerpress\_admin\_get\_post\_types(false); |
  |  | 130 | $post\_types = $this->powerpress\_admin\_get\_post\_types(false); |
  | 131 | 131 | foreach( $post\_types as $index => $label ) { |
  | 132 | 132 | echo '<option value="' . $label . '"' |
  | […](/browser/powerpress/trunk/class.powerpress-subscribe-widget.php?rev=2808231#L251) | […](/browser/powerpress/trunk/class.powerpress-subscribe-widget.php?rev=2896729#L251) |  |
  | 251 | 251 | return; |
  | 252 | 252 | } |
  |  | 253 |  |
  |  | 254 | function powerpress\_admin\_get\_post\_types($capability\_type = 'post') |
  |  | 255 | { |
  |  | 256 | if( !function\_exists('get\_post\_types') || !function\_exists('get\_post\_type\_object') ) |
  |  | 257 | return array($capability\_type); |
  |  | 258 |  |
  |  | 259 | $return = array(); |
  |  | 260 | $post\_types = get\_post\_types(); |
  |  | 261 | if (!empty($post\_types)) { |
  |  | 262 | foreach ($post\_types as $index => $post\_type) { |
  |  | 263 | if ($post\_type == 'redirect\_rule' || $post\_type == 'attachment' || $post\_type == 'nav\_menu\_item' || $post\_type == 'revision' || $post\_type == 'action') |
  |  | 264 | continue; |
  |  | 265 | if ($capability\_type !== false) { |
  |  | 266 | $object = get\_post\_type\_object($post\_type); |
  |  | 267 | if ($object && $object->capability\_type == $capability\_type) |
  |  | 268 | $return[] = $post\_type; |
  |  | 269 | } else { |
  |  | 270 | $return[] = $post\_type; |
  |  | 271 | } |
  |  | 272 | } |
  |  | 273 | } |
  |  | 274 | return $return; |
  |  | 275 | } |
  | 253 | 276 | } |
  | 254 | 277 |  |
* ## [powerpress/trunk/powerpress-player.php](/changeset/2896729/powerpress/trunk/powerpress-player.php "Show the changeset 2896729 restricted to powerpress/trunk/powerpress-player.php")

  | [r2880730](/browser/powerpress/trunk/powerpress-player.php?rev=2880730#L358 "Show revision 2880730 of this file in browser") | [r2896729](/browser/powerpress/trunk/powerpress-player.php?rev=2896729#L358 "Show revision 2896729 of this file in browser") |  |
  | --- | --- | --- |
  | 358 | 358 | $embed .= '<iframe'; |
  | 359 | 359 | //$embed .= ' class="powerpress-player-embed"'; |
  | 360 |  | $embed .= ' width="'. ~~$width~~ .'"'; |
  | 361 |  | $embed .= ' height="'. ~~$height~~ .'"'; |
  | 362 |  | $embed .= ' src="'. ~~$url~~ .'"'; |
  | 363 |  | $embed .= ' title="'. ~~$iframeTitle~~ .'"'; |
  |  | 360 | $embed .= ' width="'. htmlspecialchars($width) .'"'; |
  |  | 361 | $embed .= ' height="'. htmlspecialchars($height) .'"'; |
  |  | 362 | $embed .= ' src="'. htmlspecialchars($url) .'"'; |
  |  | 363 | $embed .= ' title="'. htmlspecialchars($iframeTitle) .'"'; |
  | 364 | 364 | $embed .= ' frameborder="0" scrolling="no"'; |
  | 365 | 365 | if($extension != 'mp3' && $extension != 'm4a' && $extension != 'oga') |
  | […](/browser/powerpress/trunk/powerpress-player.php?rev=2880730#L1138) | […](/browser/powerpress/trunk/powerpress-player.php?rev=2896729#L1138) |  |
  | 1138 | 1138 | { |
  | 1139 | 1139 | $content .= '<div class="powerpress\_player" id="powerpress\_player\_'. $player\_id .'">'.PHP\_EOL\_WEB; |
  | 1140 |  | $content .= '<video width="'. ~~$player\_width .'" height="'. $player\_height~~ .'" controls="controls"'; |
  |  | 1140 | $content .= '<video width="'. htmlspecialchars($player\_width) .'" height="'. htmlspecialchars($player\_height) .'" controls="controls"'; |
  | 1141 | 1141 | if( $cover\_image ) |
  | 1142 |  | $content .= ' poster="'. ~~$cover\_image~~ .'"'; |
  |  | 1142 | $content .= ' poster="'. htmlspecialchars($cover\_image) .'"'; |
  | 1143 | 1143 | if( $autoplay ) |
  | 1144 | 1144 | $content .= ' autoplay="autoplay"'; |
  | […](/browser/powerpress/trunk/powerpress-player.php?rev=2880730#L1148) | […](/browser/powerpress/trunk/powerpress-player.php?rev=2896729#L1148) |  |
  | 1148 | 1148 | $content .= '>'.PHP\_EOL\_WEB; |
  | 1149 | 1149 | $content\_type = powerpress\_get\_contenttype($media\_url); |
  | 1150 |  | $content .='<source src="'. ~~$media\_url~~ .'" type="'. $content\_type .'" />'; |
  |  | 1150 | $content .='<source src="'. htmlspecialchars($media\_url) .'" type="'. $content\_type .'" />'; |
  | 1151 | 1151 |  |
  | 1152 | 1152 | if( !empty($EpisodeData['webm\_src']) ) |
  | 1153 | 1153 | { |
  | 1154 | 1154 | $EpisodeData['webm\_src'] = powerpress\_add\_flag\_to\_redirect\_url($EpisodeData['webm\_src'], 'p'); |
  | 1155 |  | $content .='<source src="'. ~~$EpisodeData['webm\_src']~~ .'" type="video/webm" />'; |
  |  | 1155 | $content .='<source src="'. htmlspecialchars($EpisodeData['webm\_src']) .'" type="video/webm" />'; |
  | 1156 | 1156 | } |
  | 1157 | 1157 |  |
  | […](/browser/powerpress/trunk/powerpress-player.php?rev=2880730#L1169) | […](/browser/powerpress/trunk/powerpress-player.php?rev=2896729#L1169) |  |
  | 1169 | 1169 | $webm\_src = powerpress\_add\_flag\_to\_redirect\_url($EpisodeData['webm\_src'], 'p'); |
  | 1170 | 1170 | $content .= '<div class="powerpress\_player" id="powerpress\_player\_'. $player\_id .'">'; |
  | 1171 |  | $content .= '<a href="'. ~~$media\_url .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" onclick="return powerpress\_embed\_html5v(\''.$player\_id.'\',\''.$media\_url.'\',\''. $player\_width .'\',\''. $player\_height .'\', \''. $webm\_src~~ .'\');" target="\_blank" style="position: relative;">'; |
  |  | 1171 | $content .= '<a href="'. htmlspecialchars($media\_url) .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" onclick="return powerpress\_embed\_html5v(\''.$player\_id.'\',\''.htmlspecialchars($media\_url).'\',\''. htmlspecialchars($player\_width) .'\',\''. htmlspecialchars($player\_height) .'\', \''. htmlspecialchars($webm\_src) .'\');" target="\_blank" style="position: relative;">'; |
  | 1172 | 1172 | if( !empty($EpisodeData['custom\_play\_button']) ) // This currently does not apply |
  | 1173 | 1173 | { |
  | 1174 | 1174 | $cover\_image = $EpisodeData['custom\_play\_button']; |
  | 1175 | 1175 | $Settings['poster\_play\_image'] = false; |
  | 1176 |  | $content .= '<img class="powerpress-player-poster" src="'. ~~$cover\_image~~ .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" alt="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" />'; |
  |  | 1176 | $content .= '<img class="powerpress-player-poster" src="'. htmlspecialchars($cover\_image) .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" alt="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" />'; |
  | 1177 | 1177 | } |
  | 1178 | 1178 | else |
  | 1179 | 1179 | { |
  | 1180 |  | $content .= '<img class="powerpress-player-poster" src="'. ~~$cover\_image .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" alt="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" style="width: '. $player\_width .'px; height: '. $player\_height~~ .'px;" />'; |
  |  | 1180 | $content .= '<img class="powerpress-player-poster" src="'. htmlspecialchars($cover\_image) .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" alt="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" style="width: '. htmlspecialchars($player\_width) .'px; height: '. htmlspecialchars($player\_height) .'px;" />'; |
  | 1181 | 1181 | } |
  | 1182 | 1182 |  |
  | […](/browser/powerpress/trunk/powerpress-player.php?rev=2880730#L1193) | […](/browser/powerpress/trunk/powerpress-player.php?rev=2896729#L1193) |  |
  | 1193 | 1193 | if( $left < 0 ) |
  | 1194 | 1194 | $left = 0; |
  | 1195 |  | $content .= '<img class="powerpress-player-play-image" src="'. ~~$play\_image\_button\_url~~ .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" alt="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" style="position: absolute; bottom: '. $bottom .'px; left: '. $left .'px; border:0;" />'; |
  |  | 1195 | $content .= '<img class="powerpress-player-play-image" src="'. htmlspecialchars($play\_image\_button\_url) .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" alt="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" style="position: absolute; bottom: '. $bottom .'px; left: '. $left .'px; border:0;" />'; |
  | 1196 | 1196 | } |
  | 1197 | 1197 | $content .= '</a>'; |
  | […](/browser/powerpress/trunk/powerpress-player.php?rev=2880730#L1201) | […](/browser/powerpress/trunk/powerpress-player.php?rev=2896729#L1201) |  |
  | 1201 | 1201 | { |
  | 1202 | 1202 | $content .= '<script type="text/javascript"><!--'.PHP\_EOL; |
  | 1203 |  | $content .= "powerpress\_embed\_html5v('{$player\_id}','~~{$media\_url}',{$player\_width},{$player\_height},'{$webm\_src}~~');\n"; |
  |  | 1203 | $content .= "powerpress\_embed\_html5v('{$player\_id}','" . htmlspecialchars($media\_url) . "'," . htmlspecialchars($player\_width) . "," . htmlspecialchars($player\_height) . ",'" . htmlspecialchars($webm\_src) . "');\n"; |
  | 1204 | 1204 | $content .= "//-->\n"; |
  | 1205 | 1205 | $content .= "</script>\n"; |
  | […](/browser/powerpress/trunk/powerpress-player.php?rev=2880730#L1303) | […](/browser/powerpress/trunk/powerpress-player.php?rev=2896729#L1303) |  |
  | 1303 | 1303 | $content .= '<div class="powerpress\_player" id="powerpress\_player\_'. $player\_id .'">'.PHP\_EOL\_WEB; |
  | 1304 | 1304 | $content .= '<audio controls="controls"'; |
  | 1305 |  | $content .=' src="'. ~~$media\_url~~ .'"'; |
  |  | 1305 | $content .=' src="'. htmlspecialchars($media\_url) .'"'; |
  | 1306 | 1306 | if( $autoplay ) |
  | 1307 | 1307 | $content .= ' autoplay="autoplay"'; |
  | […](/browser/powerpress/trunk/powerpress-player.php?rev=2880730#L1329) | […](/browser/powerpress/trunk/powerpress-player.php?rev=2896729#L1329) |  |
  | 1329 | 1329 |  |
  | 1330 | 1330 | $content .= '<div class="powerpress\_player" id="powerpress\_player\_'. $player\_id .'">'; |
  | 1331 |  | $content .= '<a href="'. ~~$media\_url .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" onclick="return powerpress\_embed\_html5a(\''.$player\_id.'\',\''.$media\_url~~.'\');" target="\_blank">'; |
  |  | 1331 | $content .= '<a href="'. htmlspecialchars($media\_url) .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" onclick="return powerpress\_embed\_html5a(\''.$player\_id.'\',\''.htmlspecialchars($media\_url).'\');" target="\_blank">'; |
  | 1332 | 1332 | if( $cover\_image\_default == $cover\_image ) |
  | 1333 |  | $content .= '<img src="'. ~~$cover\_image~~ .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" alt="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" style="border:0;" width="23px" height="24px" />'; |
  |  | 1333 | $content .= '<img src="'. htmlspecialchars($cover\_image) .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" alt="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" style="border:0;" width="23px" height="24px" />'; |
  | 1334 | 1334 | else |
  | 1335 |  | $content .= '<img src="'. ~~$cover\_image~~ .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" alt="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" style="border:0;" />'; |
  |  | 1335 | $content .= '<img src="'. htmlspecialchars($cover\_image) .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" alt="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" style="border:0;" />'; |
  | 1336 | 1336 | $content .= '</a>'; |
  | 1337 | 1337 | $content .= "</div>\n"; |
  | […](/browser/powerpress/trunk/powerpress-player.php?rev=2880730#L1340) | […](/browser/powerpress/trunk/powerpress-player.php?rev=2896729#L1340) |  |
  | 1340 | 1340 | { |
  | 1341 | 1341 | $content .= '<script type="text/javascript"><!--'.PHP\_EOL; |
  | 1342 |  | $content .= "powerpress\_embed\_html5a('{$player\_id}','~~{$media\_url}~~');\n"; |
  |  | 1342 | $content .= "powerpress\_embed\_html5a('{$player\_id}','" . htmlspecialchars($media\_url) . "');\n"; |
  | 1343 | 1343 | $content .= "//-->\n"; |
  | 1344 | 1344 | $content .= "</script>\n"; |
  | […](/browser/powerpress/trunk/powerpress-player.php?rev=2880730#L1419) | […](/browser/powerpress/trunk/powerpress-player.php?rev=2896729#L1419) |  |
  | 1419 | 1419 | $playerSettings['transcriptspacing'] = '230px'; |
  | 1420 | 1420 |  |
  | 1421 |  | return '<iframe src="' . ~~$url . '" scrolling="yes" width="100%" height="'.$playerSettings['transcriptspacing']~~.'" frameborder="0" id="' . $playerID . '" class="blubrryplayer" title="' . $iframeTitle . '"></iframe>'; |
  |  | 1421 | return '<iframe src="' . htmlspecialchars($url) . '" scrolling="yes" width="100%" height="'. htmlspecialchars($playerSettings['transcriptspacing']).'" frameborder="0" id="' . $playerID . '" class="blubrryplayer" title="' . $iframeTitle . '"></iframe>'; |
  | 1422 | 1422 | } else { |
  | 1423 |  | return '<iframe src="' . ~~$url~~ . '" scrolling="no" width="100%" height="138px" frameborder="0" id="' . $playerID . '" class="blubrryplayer" title="' . $iframeTitle . '"></iframe>'; |
  |  | 1423 | return '<iframe src="' . htmlspecialchars($url) . '" scrolling="no" width="100%" height="138px" frameborder="0" id="' . $playerID . '" class="blubrryplayer" title="' . $iframeTitle . '"></iframe>'; |
  | 1424 | 1424 | } |
  | 1425 | 1425 | } |
  | […](/browser/powerpress/trunk/powerpress-player.php?rev=2880730#L1524) | […](/browser/powerpress/trunk/powerpress-player.php?rev=2896729#L1524) |  |
  | 1524 | 1524 | if( $include\_div ) |
  | 1525 | 1525 | $content .= '<div class="powerpress\_player" id="powerpress\_player\_'. powerpressplayer\_get\_next\_id() .'">'; |
  | 1526 |  | $content .= '<a href="'. ~~$media\_url~~ .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" target="\_blank" style="position: relative;">'; |
  | 1527 |  | $content .= '<img src="'. ~~$cover\_image .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" alt="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" style="width: '. $player\_width .'px; height: '. $player\_height~~ .'px;" />'; |
  |  | 1526 | $content .= '<a href="'. htmlspecialchars($media\_url) .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" target="\_blank" style="position: relative;">'; |
  |  | 1527 | $content .= '<img src="'. htmlspecialchars($cover\_image) .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" alt="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" style="width: '. htmlspecialchars($player\_width) .'px; height: '. htmlspecialchars($player\_height) .'px;" />'; |
  | 1528 | 1528 | if(!isset($Settings['poster\_play\_image']) || $Settings['poster\_play\_image'] ) |
  | 1529 | 1529 | { |
  | […](/browser/powerpress/trunk/powerpress-player.php?rev=2880730#L1538) | […](/browser/powerpress/trunk/powerpress-player.php?rev=2896729#L1538) |  |
  | 1538 | 1538 | if( $left < 0 ) |
  | 1539 | 1539 | $left = 0; |
  | 1540 |  | $content .= '<img src="'. ~~$play\_image\_button\_url~~ .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" alt="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" style="position: absolute; bottom:'. $bottom .'px; left:'. $left .'px; border:0;" />'; |
  |  | 1540 | $content .= '<img src="'. htmlspecialchars($play\_image\_button\_url) .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" alt="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" style="position: absolute; bottom:'. $bottom .'px; left:'. $left .'px; border:0;" />'; |
  | 1541 | 1541 | } |
  | 1542 | 1542 | $content .= '</a>'; |
  | […](/browser/powerpress/trunk/powerpress-player.php?rev=2880730#L1556) | […](/browser/powerpress/trunk/powerpress-player.php?rev=2896729#L1556) |  |
  | 1556 | 1556 | if( $include\_div ) |
  | 1557 | 1557 | $content .= '<div class="powerpress\_player" id="powerpress\_player\_'. powerpressplayer\_get\_next\_id() .'">'; |
  | 1558 |  | $content .= '<a href="'. ~~$media\_url~~ .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" target="\_blank">'; |
  | 1559 |  | $content .= '<img src="'. ~~$cover\_image~~ .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" alt="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" style="border:0;" />'; |
  |  | 1558 | $content .= '<a href="'. htmlspecialchars($media\_url) .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" target="\_blank">'; |
  |  | 1559 | $content .= '<img src="'. htmlspecialchars($cover\_image) .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" alt="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" style="border:0;" />'; |
  | 1560 | 1560 | $content .= '</a>'; |
  | 1561 | 1561 | if( $include\_div ) |
  | […](/browser/powerpress/trunk/powerpress-player.php?rev=2880730#L1574) | […](/browser/powerpress/trunk/powerpress-player.php?rev=2896729#L1574) |  |
  | 1574 | 1574 | if( $include\_div ) |
  | 1575 | 1575 | $content .= '<div class="powerpress\_player" id="powerpress\_player\_'. powerpressplayer\_get\_next\_id() .'">'; |
  | 1576 |  | $content .= '<a href="'. ~~$media\_url~~ .'" title="'. htmlspecialchars(POWERPRESS\_READ\_TEXT) .'" target="\_blank">'; |
  | 1577 |  | $content .= '<img src="'. ~~$cover\_image~~ .'" title="'. htmlspecialchars(POWERPRESS\_READ\_TEXT) .'" alt="'. htmlspecialchars(POWERPRESS\_READ\_TEXT) .'" style="border:0;" />'; |
  |  | 1576 | $content .= '<a href="'. htmlspecialchars($media\_url) .'" title="'. htmlspecialchars(POWERPRESS\_READ\_TEXT) .'" target="\_blank">'; |
  |  | 1577 | $content .= '<img src="'. htmlspecialchars($cover\_image) .'" title="'. htmlspecialchars(POWERPRESS\_READ\_TEXT) .'" alt="'. htmlspecialchars(POWERPRESS\_READ\_TEXT) .'" style="border:0;" />'; |
  | 1578 | 1578 | $content .= '</a>'; |
  | 1579 | 1579 | if( $include\_div ) |
  | […](/browser/powerpress/trunk/powerpress-player.php?rev=2880730#L1592) | […](/browser/powerpress/trunk/powerpress-player.php?rev=2896729#L1592) |  |
  | 1592 | 1592 | if( $include\_div ) |
  | 1593 | 1593 | $content .= '<div class="powerpress\_player" id="powerpress\_player\_'. powerpressplayer\_get\_next\_id() .'">'; |
  | 1594 |  | $content .= '<a href="'. ~~$media\_url~~ .'" title="'. htmlspecialchars(POWERPRESS\_READ\_TEXT) .'" target="\_blank">'; |
  | 1595 |  | $content .= '<img src="'. ~~$cover\_image~~ .'" title="'. htmlspecialchars(POWERPRESS\_READ\_TEXT) .'" alt="'. htmlspecialchars(POWERPRESS\_READ\_TEXT) .'" style="border:0;" />'; |
  |  | 1594 | $content .= '<a href="'. htmlspecialchars($media\_url) .'" title="'. htmlspecialchars(POWERPRESS\_READ\_TEXT) .'" target="\_blank">'; |
  |  | 1595 | $content .= '<img src="'. htmlspecialchars($cover\_image) .'" title="'. htmlspecialchars(POWERPRESS\_READ\_TEXT) .'" alt="'. htmlspecialchars(POWERPRESS\_READ\_TEXT) .'" style="border:0;" />'; |
  | 1596 | 1596 | $content .= '</a>'; |
  | 1597 | 1597 | if( $include\_div ) |
  | […](/browser/powerpress/trunk/powerpress-player.php?rev=2880730#L1637) | […](/browser/powerpress/trunk/powerpress-player.php?rev=2896729#L1637) |  |
  | 1637 | 1637 | $poster\_attribute = ''; |
  | 1638 | 1638 | if ($cover\_image) |
  | 1639 |  | $poster\_attribute = ' poster="'.~~$cover\_image~~.'"'; |
  |  | 1639 | $poster\_attribute = ' poster="'.htmlspecialchars($cover\_image).'"'; |
  | 1640 | 1640 |  |
  | 1641 | 1641 | // Autoplay the video? |
  | […](/browser/powerpress/trunk/powerpress-player.php?rev=2880730#L1649) | […](/browser/powerpress/trunk/powerpress-player.php?rev=2896729#L1649) |  |
  | 1649 | 1649 | $class = ''; |
  | 1650 | 1650 | if ( !empty($Settings['videojs\_css\_class']) ) |
  | 1651 |  | $class = ' '. ~~$Settings['videojs\_css\_class']~~; |
  |  | 1651 | $class = ' '. htmlspecialchars($Settings['videojs\_css\_class']); |
  | 1652 | 1652 |  |
  | 1653 | 1653 | $content .= '<div class="powerpress\_player" id="powerpress\_player\_'. $player\_id .'">'; |
  | 1654 | 1654 |  |
  | 1655 |  | $content .= '<video id="videojs\_player\_'. $player\_id .'" class="video-js vjs-default-skin'. $class .'" width="'. ~~$player\_width .'" height="'. $player\_height~~ .'"'. $poster\_attribute .' controls '. $autoplay\_attribute .' data-setup="{}">'; |
  |  | 1655 | $content .= '<video id="videojs\_player\_'. $player\_id .'" class="video-js vjs-default-skin'. $class .'" width="'. htmlspecialchars($player\_width) .'" height="'. htmlspecialchars($player\_height) .'"'. $poster\_attribute .' controls '. $autoplay\_attribute .' data-setup="{}">'; |
  | 1656 | 1656 |  |
  | 1657 | 1657 | $content\_type = powerpress\_get\_contenttype($media\_url); |
  | 1658 | 1658 | if( $content\_type == 'video/x-m4v' ) |
  | 1659 | 1659 | $content\_type = 'video/mp4'; // Mp4 |
  | 1660 |  | $content .='<source src="'. ~~$media\_url~~ .'" type="'. $content\_type .'" />'; |
  |  | 1660 | $content .='<source src="'. htmlspecialchars($media\_url) .'" type="'. $content\_type .'" />'; |
  | 1661 | 1661 |  |
  | 1662 | 1662 | if( !empty($EpisodeData['webm\_src']) ) |
  | 1663 | 1663 | { |
  | 1664 | 1664 | $EpisodeData['webm\_src'] = powerpress\_add\_flag\_to\_redirect\_url($EpisodeData['webm\_src'], 'p'); |
  | 1665 |  | $content .='<source src="'. ~~$EpisodeData['webm\_src']~~ .'" type="video/webm; codecs="vp8, vorbis" />'; |
  |  | 1665 | $content .='<source src="'. htmlspecialchars($EpisodeData['webm\_src']) .'" type="video/webm; codecs="vp8, vorbis" />'; |
  | 1666 | 1666 | } |
  | 1667 | 1667 |  |
* ## [powerpress/trunk/powerpress-subscribe.php](/changeset/2896729/powerpress/trunk/powerpress-subscribe.php "Show the changeset 2896729 restricted to powerpress/trunk/powerpress-subscribe.php")

  | [r2820035](/browser/powerpress/trunk/powerpress-subscribe.php?rev=2820035#L947 "Show revision 2820035 of this file in browser") | [r2896729](/browser/powerpress/trunk/powerpress-subscribe.php?rev=2896729#L947 "Show revision 2896729 of this file in browser") |  |
  | --- | --- | --- |
  | 947 | 947 | if( !empty($settings['itunes\_url']) &&  !empty($settings['subscribe\_feature\_apple\_shortcode']) ) { |
  | 948 | 948 | $link\_counter++; |
  | 949 |  | $html .= '<a href="'.  esc\_url( $settings['itunes\_url'] ) .'" class="pp-sub-btn'.~~$settings['subscribe\_widget\_shape']~~.' pp-sub-itunes" target="\_blank" title="'.  esc\_attr( \_\_('Subscribe on Apple Podcasts', 'powerpress') ) .'"><span class="pp-sub-ic"></span>'.  esc\_html( \_\_('Apple Podcasts', 'powerpress') ) .'</a>'; |
  |  | 949 | $html .= '<a href="'.  esc\_url( $settings['itunes\_url'] ) .'" class="pp-sub-btn'. htmlspecialchars($settings['subscribe\_widget\_shape']) .' pp-sub-itunes" target="\_blank" title="'.  esc\_attr( \_\_('Subscribe on Apple Podcasts', 'powerpress') ) .'"><span class="pp-sub-ic"></span>'.  esc\_html( \_\_('Apple Podcasts', 'powerpress') ) .'</a>'; |
  | 950 | 950 | } |
  | 951 | 951 | // Google Podcasts |
  | […](/browser/powerpress/trunk/powerpress-subscribe.php?rev=2820035#L957) | […](/browser/powerpress/trunk/powerpress-subscribe.php?rev=2896729#L957) |  |
  | 957 | 957 | if (!empty($settings['subscribe\_feature\_gp\_shortcode'])) { |
  | 958 | 958 | $link\_counter++; |
  | 959 |  | $html .= '<a href="' . esc\_url($googleUrl) . '" class="pp-sub-btn' . ~~$settings['subscribe\_widget\_shape']~~ . ' pp-sub-gp" target="\_blank" title="' . esc\_attr(\_\_('Subscribe on Google Podcasts', 'powerpress')) . '"><span class="pp-sub-ic"></span>' . esc\_html(\_\_('Google Podcasts', 'powerpress')) . '</a>'; |
  |  | 959 | $html .= '<a href="' . esc\_url($googleUrl) . '" class="pp-sub-btn' . htmlspecialchars($settings['subscribe\_widget\_shape']) . ' pp-sub-gp" target="\_blank" title="' . esc\_attr(\_\_('Subscribe on Google Podcasts', 'powerpress')) . '"><span class="pp-sub-ic"></span>' . esc\_html(\_\_('Google Podcasts', 'powerpress')) . '</a>'; |
  | 960 | 960 | } |
  | 961 | 961 |  |
  | […](/browser/powerpress/trunk/powerpress-subscribe.php?rev=2820035#L963) | […](/browser/powerpress/trunk/powerpress-subscribe.php?rev=2896729#L963) |  |
  | 963 | 963 | { |
  | 964 | 964 | $link\_counter++; |
  | 965 |  | $html .= '<a href="'.  esc\_url( $settings['spotify\_url'] ) .'" class="pp-sub-btn'.~~$settings['subscribe\_widget\_shape']~~.' pp-sub-spotify" target="\_blank" title="'.  esc\_attr( \_\_('Subscribe on Spotify', 'powerpress') ) .'"><span class="pp-sub-ic"></span>'.  esc\_html( \_\_('Spotify', 'powerpress') ) .'</a>'; |
  |  | 965 | $html .= '<a href="'.  esc\_url( $settings['spotify\_url'] ) .'" class="pp-sub-btn'. htmlspecialchars($settings['subscribe\_widget\_shape']) .' pp-sub-spotify" target="\_blank" title="'.  esc\_attr( \_\_('Subscribe on Spotify', 'powerpress') ) .'"><span class="pp-sub-ic"></span>'.  esc\_html( \_\_('Spotify', 'powerpress') ) .'</a>'; |
  | 966 | 966 | } |
  | 967 | 967 |  |
  | 968 | 968 | if( !empty($settings['subscribe\_feature\_amazon\_shortcode']) &&  !empty($settings['amazon\_url']) ) { |
  | 969 | 969 | $link\_counter++; |
  | 970 |  | $html .= '<a href="'.  esc\_url( $settings['amazon\_url'] ) .'" class="pp-sub-btn'.~~$settings['subscribe\_widget\_shape']~~.' pp-sub-amazon" target="\_blank" title="'.  esc\_attr( \_\_('Subscribe on Amazon Music', 'powerpress') ) .'"><span class="pp-sub-ic"></span>'.  esc\_html( \_\_('Amazon Music', 'powerpress') ) .'</a>'; |
  |  | 970 | $html .= '<a href="'.  esc\_url( $settings['amazon\_url'] ) .'" class="pp-sub-btn'. htmlspecialchars($settings['subscribe\_widget\_shape']) .' pp-sub-amazon" target="\_blank" title="'.  esc\_attr( \_\_('Subscribe on Amazon Music', 'powerpress') ) .'"><span class="pp-sub-ic"></span>'.  esc\_html( \_\_('Amazon Music', 'powerpress') ) .'</a>'; |
  | 971 | 971 | } |
  | 972 | 972 |  |
  | […](/browser/powerpress/trunk/powerpress-subscribe.php?rev=2820035#L974) | […](/browser/powerpress/trunk/powerpress-subscribe.php?rev=2896729#L974) |  |
  | 974 | 974 | $android\_url =  $matches[1] . 'subscribeonandroid.com/' . $matches[2]; |
  | 975 | 975 | $link\_counter++; |
  | 976 |  | $html .= '<a href="'.  esc\_url( $android\_url ) .'" class="pp-sub-btn'.~~$settings['subscribe\_widget\_shape']~~.' pp-sub-android" target="\_blank" title="'.  esc\_attr( \_\_('Subscribe on Android', 'powerpress') ) .'"><span class="pp-sub-ic"></span>'.  esc\_html( \_\_('Android', 'powerpress') ) .'</a>'; |
  |  | 976 | $html .= '<a href="'.  esc\_url( $android\_url ) .'" class="pp-sub-btn'. htmlspecialchars($settings['subscribe\_widget\_shape']) .' pp-sub-android" target="\_blank" title="'.  esc\_attr( \_\_('Subscribe on Android', 'powerpress') ) .'"><span class="pp-sub-ic"></span>'.  esc\_html( \_\_('Android', 'powerpress') ) .'</a>'; |
  | 977 | 977 | } |
  | 978 | 978 |  |
  | 979 | 979 | if( !empty($settings['subscribe\_feature\_pandora\_shortcode']) &&  !empty($settings['pandora\_url']) ) { |
  | 980 | 980 | $link\_counter++; |
  | 981 |  | $html .= '<a href="'.  esc\_url( $settings['pandora\_url'] ) .'" class="pp-sub-btn'.~~$settings['subscribe\_widget\_shape']~~.' pp-sub-pandora" target="\_blank" title="'.  esc\_attr( \_\_('Subscribe on Pandora', 'powerpress') ) .'"><span class="pp-sub-ic"></span>'.  esc\_html( \_\_('Pandora', 'powerpress') ) .'</a>'; |
  |  | 981 | $html .= '<a href="'.  esc\_url( $settings['pandora\_url'] ) .'" class="pp-sub-btn'. htmlspecialchars($settings['subscribe\_widget\_shape']) .' pp-sub-pandora" target="\_blank" title="'.  esc\_attr( \_\_('Subscribe on Pandora', 'powerpress') ) .'"><span class="pp-sub-ic"></span>'.  esc\_html( \_\_('Pandora', 'powerpress') ) .'</a>'; |
  | 982 | 982 | } |
  | 983 | 983 |  |
  | 984 | 984 | if( !empty($settings['subscribe\_feature\_iheart\_shortcode']) &&  !empty($settings['iheart\_url']) ) { |
  | 985 | 985 | $link\_counter++; |
  | 986 |  | $html .= '<a href="'.  esc\_url( $settings['iheart\_url'] ) .'" class="pp-sub-btn'.~~$settings['subscribe\_widget\_shape']~~.' pp-sub-iheartradio" target="\_blank" title="'.  esc\_attr( \_\_('Subscribe on iHeartRadio', 'powerpress') ) .'"><span class="pp-sub-ic"></span>'.  esc\_html( \_\_('iHeartRadio', 'powerpress') ) .'</a>'; |
  |  | 986 | $html .= '<a href="'.  esc\_url( $settings['iheart\_url'] ) .'" class="pp-sub-btn'. htmlspecialchars($settings['subscribe\_widget\_shape']) .' pp-sub-iheartradio" target="\_blank" title="'.  esc\_attr( \_\_('Subscribe on iHeartRadio', 'powerpress') ) .'"><span class="pp-sub-ic"></span>'.  esc\_html( \_\_('iHeartRadio', 'powerpress') ) .'</a>'; |
  | 987 | 987 | } |
  | 988 | 988 |  |
  | […](/browser/powerpress/trunk/powerpress-subscribe.php?rev=2820035#L990) | […](/browser/powerpress/trunk/powerpress-subscribe.php?rev=2896729#L990) |  |
  | 990 | 990 | { |
  | 991 | 991 | $link\_counter++; |
  | 992 |  | $html .= '<a href="'.  esc\_url( $settings['stitcher\_url'] ) .'" class="pp-sub-btn'.~~$settings['subscribe\_widget\_shape']~~.' pp-sub-stitcher" target="\_blank" title="'.  esc\_attr( \_\_('Subscribe on Stitcher', 'powerpress') ) .'"><span class="pp-sub-ic"></span>'.  esc\_html( \_\_('Stitcher', 'powerpress') ) .'</a>'; |
  |  | 992 | $html .= '<a href="'.  esc\_url( $settings['stitcher\_url'] ) .'" class="pp-sub-btn'. htmlspecialchars($settings['subscribe\_widget\_shape']) .' pp-sub-stitcher" target="\_blank" title="'.  esc\_attr( \_\_('Subscribe on Stitcher', 'powerpress') ) .'"><span class="pp-sub-ic"></span>'.  esc\_html( \_\_('Stitcher', 'powerpress') ) .'</a>'; |
  | 993 | 993 | } |
  | 994 | 994 |  |
  | 995 | 995 | if( !empty($settings['subscribe\_feature\_blubrry\_shortcode']) &&  !empty($settings['blubrry\_url']) ) { |
  | 996 | 996 | $link\_counter++; |
  | 997 |  | $html .= '<a href="'.  esc\_url( $settings['blubrry\_url'] ) .'" class="pp-sub-btn'.~~$settings['subscribe\_widget\_shape']~~.' pp-sub-blubrry" target="\_blank" title="'.  esc\_attr( \_\_('Subscribe on Blubrry', 'powerpress') ) .'"><span class="pp-sub-ic"></span>'.  esc\_html( \_\_('Blubrry', 'powerpress') ) .'</a>'; |
  |  | 997 | $html .= '<a href="'.  esc\_url( $settings['blubrry\_url'] ) .'" class="pp-sub-btn'. htmlspecialchars($settings['subscribe\_widget\_shape']) .' pp-sub-blubrry" target="\_blank" title="'.  esc\_attr( \_\_('Subscribe on Blubrry', 'powerpress') ) .'"><span class="pp-sub-ic"></span>'.  esc\_html( \_\_('Blubrry', 'powerpress') ) .'</a>'; |
  | 998 | 998 | } |
  | 999 | 999 |  |
  | 1000 | 1000 | if( !empty($settings['subscribe\_feature\_jiosaavn\_shortcode']) &&  !empty($settings['jiosaavn\_url']) ) { |
  | 1001 | 1001 | $link\_counter++; |
  | 1002 |  | $html .= '<a href="'.  esc\_url( $settings['jiosaavn\_url'] ) .'" class="pp-sub-btn'.~~$settings['subscribe\_widget\_shape']~~.' pp-sub-jiosaavn" target="\_blank" title="'.  esc\_attr( \_\_('Subscribe on JioSaavn', 'powerpress') ) .'"><span class="pp-sub-ic"></span>'.  esc\_html( \_\_('JioSaavn', 'powerpress') ) .'</a>'; |
  |  | 1002 | $html .= '<a href="'.  esc\_url( $settings['jiosaavn\_url'] ) .'" class="pp-sub-btn'. htmlspecialchars($settings['subscribe\_widget\_shape']) .' pp-sub-jiosaavn" target="\_blank" title="'.  esc\_attr( \_\_('Subscribe on JioSaavn', 'powerpress') ) .'"><span class="pp-sub-ic"></span>'.  esc\_html( \_\_('JioSaavn', 'powerpress') ) .'</a>'; |
  | 1003 | 1003 | } |
  | 1004 | 1004 |  |
  | 1005 | 1005 | if( !empty($settings['subscribe\_feature\_podchaser\_shortcode']) &&  !empty($settings['podchaser\_url']) ) { |
  | 1006 | 1006 | $link\_counter++; |
  | 1007 |  | $html .= '<a href="'.  esc\_url( $settings['podchaser\_url'] ) .'" class="pp-sub-btn'.~~$settings['subscribe\_widget\_shape']~~.' pp-sub-podchaser" target="\_blank" title="'.  esc\_attr( \_\_('Subscribe on Podchaser', 'powerpress') ) .'"><span class="pp-sub-ic"></span>'.  esc\_html( \_\_('Podchaser', 'powerpress') ) .'</a>'; |
  |  | 1007 | $html .= '<a href="'.  esc\_url( $settings['podchaser\_url'] ) .'" class="pp-sub-btn'. htmlspecialchars($settings['subscribe\_widget\_shape']) .' pp-sub-podchaser" target="\_blank" title="'.  esc\_attr( \_\_('Subscribe on Podchaser', 'powerpress') ) .'"><span class="pp-sub-ic"></span>'.  esc\_html( \_\_('Podchaser', 'powerpress') ) .'</a>'; |
  | 1008 | 1008 | } |
  | 1009 | 1009 |  |
  | 1010 | 1010 | if( !empty($settings['subscribe\_feature\_gaana\_shortcode']) &&  !empty($settings['gaana\_url']) ) { |
  | 1011 | 1011 | $link\_counter++; |
  | 1012 |  | $html .= '<a href="'.  esc\_url( $settings['gaana\_url'] ) .'" class="pp-sub-btn'.~~$settings['subscribe\_widget\_shape']~~.' pp-sub-gaana" target="\_blank" title="'.  esc\_attr( \_\_('Subscribe on Gaana', 'powerpress') ) .'"><span class="pp-sub-ic"></span>'.  esc\_html( \_\_('Gaana', 'powerpress') ) .'</a>'; |
  |  | 1012 | $html .= '<a href="'.  esc\_url( $settings['gaana\_url'] ) .'" class="pp-sub-btn'. htmlspecialchars($settings['subscribe\_widget\_shape']) .' pp-sub-gaana" target="\_blank" title="'.  esc\_attr( \_\_('Subscribe on Gaana', 'powerpress') ) .'"><span class="pp-sub-ic"></span>'.  esc\_html( \_\_('Gaana', 'powerpress') ) .'</a>'; |
  | 1013 | 1013 | } |
  | 1014 | 1014 |  |
  | 1015 | 1015 | if( !empty($settings['subscribe\_feature\_pcindex\_shortcode']) &&  !empty($settings['pcindex\_url']) ) { |
  | 1016 | 1016 | $link\_counter++; |
  | 1017 |  | $html .= '<a href="'.  esc\_url( $settings['pcindex\_url'] ) .'" class="pp-sub-btn'.~~$settings['subscribe\_widget\_shape']~~.' pp-sub-pcindex" target="\_blank" title="'.  esc\_attr( \_\_('Subscribe on Podcast Index', 'powerpress') ) .'"><span class="pp-sub-ic"></span>'.  esc\_html( \_\_('Podcast Index', 'powerpress') ) .'</a>'; |
  |  | 1017 | $html .= '<a href="'.  esc\_url( $settings['pcindex\_url'] ) .'" class="pp-sub-btn'. htmlspecialchars($settings['subscribe\_widget\_shape']) .' pp-sub-pcindex" target="\_blank" title="'.  esc\_attr( \_\_('Subscribe on Podcast Index', 'powerpress') ) .'"><span class="pp-sub-ic"></span>'.  esc\_html( \_\_('Podcast Index', 'powerpress') ) .'</a>'; |
  | 1018 | 1018 | } |
  | 1019 | 1019 |  |
  | […](/browser/powerpress/trunk/powerpress-subscribe.php?rev=2820035#L1021) | […](/browser/powerpress/trunk/powerpress-subscribe.php?rev=2896729#L1021) |  |
  | 1021 | 1021 | $link\_counter++; |
  | 1022 | 1022 | $email\_url =  $matches[1] . 'subscribebyemail.com/' . $matches[2]; |
  | 1023 |  | $html .= '<a href="'.  esc\_url( $email\_url ) .'" class="pp-sub-btn'.~~$settings['subscribe\_widget\_shape']~~.' pp-sub-email" target="\_blank" title="'.  esc\_attr( \_\_('Subscribe by Email', 'powerpress') ) .'"><span class="pp-sub-ic"></span>'.  esc\_html( \_\_('by Email', 'powerpress') ) .'</a>'; |
  |  | 1023 | $html .= '<a href="'.  esc\_url( $email\_url ) .'" class="pp-sub-btn'. htmlspecialchars($settings['subscribe\_widget\_shape']) .' pp-sub-email" target="\_blank" title="'.  esc\_attr( \_\_('Subscribe by Email', 'powerpress') ) .'"><span class="pp-sub-ic"></span>'.  esc\_html( \_\_('by Email', 'powerpress') ) .'</a>'; |
  | 1024 | 1024 | } |
  | 1025 | 1025 |  |
  | […](/browser/powerpress/trunk/powerpress-subscribe.php?rev=2820035#L1027) | […](/browser/powerpress/trunk/powerpress-subscribe.php?rev=2896729#L1027) |  |
  | 1027 | 1027 | { |
  | 1028 | 1028 | $link\_counter++; |
  | 1029 |  | $html .= '<a href="'.  esc\_url( $settings['tunein\_url'] ) .'" class="pp-sub-btn'.~~$settings['subscribe\_widget\_shape']~~.' pp-sub-tunein" target="\_blank" title="'.  esc\_attr( \_\_('Subscribe on TuneIn', 'powerpress') ) .'"><span class="pp-sub-ic"></span>'.  esc\_html( \_\_('TuneIn', 'powerpress') ) .'</a>'; |
  |  | 1029 | $html .= '<a href="'.  esc\_url( $settings['tunein\_url'] ) .'" class="pp-sub-btn'. htmlspecialchars($settings['subscribe\_widget\_shape']) .' pp-sub-tunein" target="\_blank" title="'.  esc\_attr( \_\_('Subscribe on TuneIn', 'powerpress') ) .'"><span class="pp-sub-ic"></span>'.  esc\_html( \_\_('TuneIn', 'powerpress') ) .'</a>'; |
  | 1030 | 1030 | } |
  | 1031 | 1031 |  |
  | 1032 | 1032 | if( !empty($settings['subscribe\_feature\_deezer\_shortcode']) &&  !empty($settings['deezer\_url']) ) { |
  | 1033 | 1033 | $link\_counter++; |
  | 1034 |  | $html .= '<a href="'.  esc\_url( $settings['deezer\_url'] ) .'" class="pp-sub-btn'.~~$settings['subscribe\_widget\_shape']~~.' pp-sub-deezer" target="\_blank" title="'.  esc\_attr( \_\_('Subscribe on Deezer', 'powerpress') ) .'"><span class="pp-sub-ic"></span>'.  esc\_html( \_\_('Deezer', 'powerpress') ) .'</a>'; |
  |  | 1034 | $html .= '<a href="'.  esc\_url( $settings['deezer\_url'] ) .'" class="pp-sub-btn'. htmlspecialchars($settings['subscribe\_widget\_shape']) .' pp-sub-deezer" target="\_blank" title="'.  esc\_attr( \_\_('Subscribe on Deezer', 'powerpress') ) .'"><span class="pp-sub-ic"></span>'.  esc\_html( \_\_('Deezer', 'powerpress') ) .'</a>'; |
  | 1035 | 1035 | } |
  | 1036 | 1036 |  |
  | 1037 | 1037 | if( !empty($settings['subscribe\_feature\_anghami\_shortcode']) &&  !empty($settings['anghami\_url']) ) { |
  | 1038 | 1038 | $link\_counter++; |
  | 1039 |  | $html .= '<a href="'.  esc\_url( $settings['anghami\_url'] ) .'" class="pp-sub-btn'.~~$settings['subscribe\_widget\_shape']~~.' pp-sub-anghami" target="\_blank" title="'.  esc\_attr( \_\_('Subscribe on Anghami', 'powerpress') ) .'"><span class="pp-sub-ic"></span>'.  esc\_html( \_\_('Anghami', 'powerpress') ) .'</a>'; |
  |  | 1039 | $html .= '<a href="'.  esc\_url( $settings['anghami\_url'] ) .'" class="pp-sub-btn'. htmlspecialchars($settings['subscribe\_widget\_shape']) .' pp-sub-anghami" target="\_blank" title="'.  esc\_attr( \_\_('Subscribe on Anghami', 'powerpress') ) .'"><span class="pp-sub-ic"></span>'.  esc\_html( \_\_('Anghami', 'powerpress') ) .'</a>'; |
  | 1040 | 1040 | } |
  | 1041 | 1041 |  |
  | […](/browser/powerpress/trunk/powerpress-subscribe.php?rev=2820035#L1045) | […](/browser/powerpress/trunk/powerpress-subscribe.php?rev=2896729#L1045) |  |
  | 1045 | 1045 | if (!empty($settings['subscribe\_feature\_rss\_shortcode'])) { |
  | 1046 | 1046 | $link\_counter++; |
  | 1047 |  | $html .= '<a href="'.  esc\_url( $settings['feed\_url'] ) .'" class="pp-sub-btn'.~~$settings['subscribe\_widget\_shape']~~.' pp-sub-rss" target="\_blank" title="'.  esc\_attr( \_\_('Subscribe via RSS', 'powerpress') ) .'"><span class="pp-sub-ic"></span>'.  esc\_html( \_\_('RSS', 'powerpress') ) .'</a>'; |
  |  | 1047 | $html .= '<a href="'.  esc\_url( $settings['feed\_url'] ) .'" class="pp-sub-btn'. htmlspecialchars($settings['subscribe\_widget\_shape']) .' pp-sub-rss" target="\_blank" title="'.  esc\_attr( \_\_('Subscribe via RSS', 'powerpress') ) .'"><span class="pp-sub-ic"></span>'.  esc\_html( \_\_('RSS', 'powerpress') ) .'</a>'; |
  | 1048 | 1048 | } |
  | 1049 | 1049 |  |
* ## [powerpress/trunk/powerpress.php](/changeset/2896729/powerpress/trunk/powerpress.php "Show the changeset 2896729 restricted to powerpress/trunk/powerpress.php")

  | [r2895047](/browser/powerpress/trunk/powerpress.php?rev=2895047#L4 "Show revision 2895047 of this file in browser") | [r2896729](/browser/powerpress/trunk/powerpress.php?rev=2896729#L4 "Show revision 2896729 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Plugin URI: http://create.blubrry.com/resources/powerpress/ |
  | 5 | 5 | Description: <a href="https://create.blubrry.com/resources/powerpress/" target="\_blank">Blubrry PowerPress</a> is the No. 1 Podcasting plugin for WordPress. Developed by podcasters for podcasters; features include Simple and Advanced modes, multiple audio/video player options, subscribe to podcast tools, podcast SEO features, and more! Fully supports Apple Podcasts (previously iTunes), Google Podcasts, Spotify, Stitcher, and Blubrry Podcasting directories, as well as all podcast applications and clients. |
  | 6 |  | Version: 10.0 |
  |  | 6 | Version: 10.0.1 |
  | 7 | 7 | Author: Blubrry |
  | 8 | 8 | Author URI: https://blubrry.com/ |
  | […](/browser/powerpress/trunk/powerpress.php?rev=2895047#L36) | […](/browser/powerpress/trunk/powerpress.php?rev=2896729#L36) |  |
  | 36 | 36 |  |
  | 37 | 37 | // WP\_PLUGIN\_DIR (REMEMBER TO USE THIS DEFINE IF NEEDED) |
  | 38 |  | define('POWERPRESS\_VERSION', '10.0' ); |
  |  | 38 | define('POWERPRESS\_VERSION', '10.0.1' ); |
  | 39 | 39 |  |
  | 40 | 40 | // Translation support: |
* ## [powerpress/trunk/powerpressadmin.php](/changeset/2896729/powerpress/trunk/powerpressadmin.php "Show the changeset 2896729 restricted to powerpress/trunk/powerpressadmin.php")

  | [r2895047](/browser/powerpress/trunk/powerpressadmin.php?rev=2895047#L3629 "Show revision 2895047 of this file in browser") | [r2896729](/browser/powerpress/trunk/powerpressadmin.php?rev=2896729#L3629 "Show revision 2896729 of this file in browser") |  |
  | --- | --- | --- |
  | 3629 | 3629 | add\_action('admin\_head', 'powerpress\_admin\_head'); |
  | 3630 | 3630 |  |
  | 3631 |  | ~~// our sidebar widget throws an error in the block widget editor~~ |
  | 3632 |  | ~~function example\_theme\_support() {~~ |
  | 3633 |  | ~~remove\_theme\_support( 'widgets-block-editor' );~~ |
  | 3634 |  | ~~}~~ |
  | 3635 |  | ~~add\_action( 'after\_setup\_theme', 'example\_theme\_support' );~~ |
  | 3636 |  |  |
  | 3637 | 3631 | function powerpress\_check\_account\_verified\_popup($no\_signout\_link = false) { |
  | 3638 | 3632 | $link\_action\_url = admin\_url('admin.php?action=powerpress-jquery-account-verify'); |
* ## [powerpress/trunk/readme.txt](/changeset/2896729/powerpress/trunk/readme.txt "Show the changeset 2896729 restricted to powerpress/trunk/readme.txt")

  | [r2895047](/browser/powerpress/trunk/readme.txt?rev=2895047#L5 "Show revision 2895047 of this file in browser") | [r2896729](/browser/powerpress/trunk/readme.txt?rev=2896729#L5 "Show revision 2896729 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | Requires PHP: 5.2 |
  | 6 | 6 | Tested up to: 6.1.1 |
  | 7 |  | <<<<<<< HEAD |
  | 8 |  | Stable tag: 10.0 |
  | 9 |  | ======= |
  | 10 |  | Stable tag: 9.10.5 |
  | 11 |  | >>>>>>> 0299d7b62ee2e8bccfaced78b21d5895cc48006e |
  |  | 7 | Stable tag: 10.0.1 |
  | 12 | 8 | Donate link: https://create.blubrry.com/resources/podcast-media-hosting/ |
  | 13 | 9 | License: GPLv2 or later |
  | […](/browser/powerpress/trunk/readme.txt?rev=2895047#L190) | […](/browser/powerpress/trunk/readme.txt?rev=2896729#L186) |  |
  | 190 | 186 |  |
  | 191 | 187 | == Changelog == |
  |  | 188 | = 10.0.1 = |
  |  | 189 | \* Released on 04/10/2023 |
  |  | 190 | \* Bugfix in suscribe widget |
  |  | 191 | \* Stop disabling widget block editor |
  |  | 192 | \* Security updates for shortcodes |
  |  | 193 |  |
  | 192 | 194 | = 10.0 = |
  | 193 |  | \* Released on 0~~3/29~~/2023 |
  |  | 195 | \* Released on 04/06/2023 |
  | 194 | 196 | \* Network section redesign |
  | 195 | 197 | \* New features: Add program to list, undo applicant status, delete rejected applicant |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=2896729)
* [Zip Archive](?format=zip&new=2896729)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_82163f52_20250114_203702.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fpowerpress%2Ftrunk%2Fpowerpress-player.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/powerpress/trunk/powerpress-player.php?rev=3115881 "Revision 3115881")
* Next Revision →
* [Blame](/browser/powerpress/trunk/powerpress-player.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/powerpress/trunk/powerpress-player.php)

---

# [source:](/browser?order=name "Go to repository root") [powerpress](/browser/powerpress?order=name "View powerpress")/[trunk](/browser/powerpress/trunk?order=name "View trunk")/[powerpress-player.php](/browser/powerpress/trunk/powerpress-player.php?order=name "View powerpress-player.php")

View diff against:

View revision:

| [Last change](/changeset/3166085/powerpress/trunk/powerpress-player.php "View differences") on this file was [3166085](/changeset/3166085/ "View changeset 3166085"), checked in by benbeecroft, [3 months ago](/timeline?from=2024-10-09T18%3A04%3A23Z&precision=second "See timeline at 10/09/2024 06:04:23 PM") |
| --- |
| PowerPress 11.9.19 |
| **File size:** 63.1 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\* |
| [3](#L3) | PowerPress player options |
| [4](#L4) | \*/ |
| [5](#L5) |  |
| [6](#L6) |  |
| [7](#L7) | function powerpressplayer\_get\_next\_id() |
| [8](#L8) | { |
| [9](#L9) | if( !isset($GLOBALS['g\_powerpress\_player\_id']) ) // Use the global unique player id variable for the surrounding div |
| [10](#L10) | $GLOBALS['g\_powerpress\_player\_id'] = rand(0, 10000); |
| [11](#L11) | else |
| [12](#L12) | $GLOBALS['g\_powerpress\_player\_id']++; // increment the player id for the next div so it is unique |
| [13](#L13) | return $GLOBALS['g\_powerpress\_player\_id']; |
| [14](#L14) | } |
| [15](#L15) |  |
| [16](#L16) | function powerpressplayer\_get\_extension($media\_url, $EpisodeData = array() ) |
| [17](#L17) | { |
| [18](#L18) | $qpos = strpos($media\_url, "?"); |
| [19](#L19) | if ($qpos!==false) { |
| [20](#L20) | $ext = powerpressplayer\_get\_extension(substr($media\_url, 0, $qpos)); |
| [21](#L21) | if ($ext != 'unknown') { |
| [22](#L22) | return $ext; |
| [23](#L23) | } |
| [24](#L24) | } |
| [25](#L25) |  |
| [26](#L26) | $extension = 'unknown'; |
| [27](#L27) | $parts = pathinfo($media\_url); |
| [28](#L28) | if( !empty($parts['extension']) ) |
| [29](#L29) | $extension = strtolower($parts['extension']); |
| [30](#L30) |  |
| [31](#L31) | $qpos = strpos($extension, "?"); |
| [32](#L32) | if ($qpos!==false) { |
| [33](#L33) | $extension = substr($extension, 0, $qpos); |
| [34](#L34) | } |
| [35](#L35) |  |
| [36](#L36) | // Hack to use the audio/mp3 content type to set extension to mp3, some folks use tinyurl.com to mp3 files which remove the file extension... |
| [37](#L37) | if( isset($EpisodeData['type']) && $EpisodeData['type'] == 'audio/mpeg' && $extension != 'mp3' ) |
| [38](#L38) | $extension = 'mp3'; |
| [39](#L39) |  |
| [40](#L40) | return $extension; |
| [41](#L41) | } |
| [42](#L42) |  |
| [43](#L43) | /\* |
| [44](#L44) | Initialize powerpress player handling |
| [45](#L45) | \*/ |
| [46](#L46) | function powerpressplayer\_init($GeneralSettings) |
| [47](#L47) | { |
| [48](#L48) | add\_shortcode('skipto', 'powerpress\_shortcode\_skipto'); // skipto shortcode |
| [49](#L49) |  |
| [50](#L50) | if( !empty($GeneralSettings['seo\_video\_objects']) ) |
| [51](#L51) | add\_filter('powerpress\_player', 'powerpressplayer\_mediaobjects\_video', 1, 3); // Before everythign is added |
| [52](#L52) | if( !empty($GeneralSettings['seo\_audio\_objects']) ) |
| [53](#L53) | add\_filter('powerpress\_player', 'powerpressplayer\_mediaobjects\_audio', 1, 3); // Before everythign is added |
| [54](#L54) | if( !empty($GeneralSettings['seo\_audio\_objects']) || !empty($GeneralSettings['seo\_video\_objects']) ) |
| [55](#L55) | add\_filter('powerpress\_player', 'powerpressplayer\_mediaobjects\_post', 1000, 3); // After everythign is added |
| [56](#L56) |  |
| [57](#L57) | if( isset($\_GET['powerpress\_pinw']) ) |
| [58](#L58) | powerpress\_do\_pinw(htmlspecialchars($\_GET['powerpress\_pinw']), !empty($GeneralSettings['process\_podpress']) ); |
| [59](#L59) |  |
| [60](#L60) | if( isset($\_GET['powerpress\_embed']) ) |
| [61](#L61) | { |
| [62](#L62) | $player = ( !empty($\_GET['powerpress\_player']) ? $\_GET['powerpress\_player'] : 'mejs-v' ); |
| [63](#L63) | powerpress\_do\_embed($player, htmlspecialchars($\_GET['powerpress\_embed']), !empty($GeneralSettings['process\_podpress']) ); |
| [64](#L64) | } |
| [65](#L65) |  |
| [66](#L66) | // If we are to process podpress data.. |
| [67](#L67) | if( !empty($GeneralSettings['process\_podpress']) ) |
| [68](#L68) | { |
| [69](#L69) | add\_shortcode('display\_podcast', 'powerpress\_shortcode\_handler'); |
| [70](#L70) | } |
| [71](#L71) | /\* |
| [72](#L72) | // include what's needed for each plaer |
| [73](#L73) | if( defined('POWERPRESS\_JS\_DEBUG') ) |
| [74](#L74) | wp\_enqueue\_script( 'powerpress-player', powerpress\_get\_root\_url() .'player.js'); |
| [75](#L75) | else |
| [76](#L76) | wp\_enqueue\_script( 'powerpress-player', powerpress\_get\_root\_url() .'player.min.js'); |
| [77](#L77) |  |
| [78](#L78) |  |
| [79](#L79) | $enqueue\_mejs = false; |
| [80](#L80) | if( !isset($GeneralSettings['player']) || !isset($GeneralSettings['video\_player']) ) |
| [81](#L81) | { |
| [82](#L82) | $enqueue\_mejs = true; |
| [83](#L83) | } |
| [84](#L84) | else if( !empty($GeneralSettings['player']) && $GeneralSettings['player'] == 'mediaelement-audio' ) |
| [85](#L85) | { |
| [86](#L86) | $enqueue\_mejs = true; |
| [87](#L87) | } |
| [88](#L88) | else if( !empty($GeneralSettings['video\_player']) && $GeneralSettings['video\_player'] == 'mediaelement-video' ) |
| [89](#L89) | { |
| [90](#L90) | $enqueue\_mejs = true; |
| [91](#L91) | } |
| [92](#L92) |  |
| [93](#L93) | if( $enqueue\_mejs ) |
| [94](#L94) | { |
| [95](#L95) | wp\_enqueue\_style('wp-mediaelement'); |
| [96](#L96) | wp\_enqueue\_script('wp-mediaelement'); |
| [97](#L97) | } |
| [98](#L98) | \*/ |
| [99](#L99) | } |
| [100](#L100) |  |
| [101](#L101) |  |
| [102](#L102) | function powerpress\_shortcode\_handler( $attributes, $content = null ) |
| [103](#L103) | { |
| [104](#L104) | global $post, $g\_powerpress\_player\_added; |
| [105](#L105) |  |
| [106](#L106) | // We can't add flash players to feeds |
| [107](#L107) | if( is\_feed() ) |
| [108](#L108) | return ''; |
| [109](#L109) |  |
| [110](#L110) | $return = ''; |
| [111](#L111) | $feed = ''; |
| [112](#L112) | $channel = ''; |
| [113](#L113) | $slug = ''; // latest and preferred way to specify the feed slug |
| [114](#L114) | $url = ''; |
| [115](#L115) | $image = ''; |
| [116](#L116) | $width = ''; |
| [117](#L117) | $height = ''; |
| [118](#L118) | $sample = ''; |
| [119](#L119) |  |
| [120](#L120) | if (is\_array($attributes)) { |
| [121](#L121) | $attributes = array\_filter($attributes, function ($var) { |
| [122](#L122) | if (strpos($var, 'javascript:') === 0) { |
| [123](#L123) | return ''; |
| [124](#L124) | } else { |
| [125](#L125) | return $var; |
| [126](#L126) | } |
| [127](#L127) | }); |
| [128](#L128) | } |
| [129](#L129) |  |
| [130](#L130) | extract( shortcode\_atts( array( |
| [131](#L131) | 'url' => '', |
| [132](#L132) | 'feed' => '', |
| [133](#L133) | 'channel' => '', |
| [134](#L134) | 'slug' => '', |
| [135](#L135) | 'image' => '', |
| [136](#L136) | 'width' => '', |
| [137](#L137) | 'height' => '', |
| [138](#L138) | 'sample' => '' |
| [139](#L139) | ), $attributes ) ); |
| [140](#L140) |  |
| [141](#L141) | if( empty($channel) && !empty($feed) ) // Feed for backward compat. |
| [142](#L142) | $channel = $feed; |
| [143](#L143) | if( !empty($slug) ) // Foward compatibility |
| [144](#L144) | $channel = $slug; |
| [145](#L145) |  |
| [146](#L146) | if( !$url && $content ) |
| [147](#L147) | { |
| [148](#L148) | $content\_url = trim($content); |
| [149](#L149) | if( @parse\_url($content\_url) ) |
| [150](#L150) | $url = $content\_url; |
| [151](#L151) | } |
| [152](#L152) |  |
| [153](#L153) | if( $url && !$sample ) |
| [154](#L154) | { |
| [155](#L155) | $url = powerpress\_add\_redirect\_url($url); |
| [156](#L156) | $content\_type = ''; |
| [157](#L157) | // Handle the URL differently... |
| [158](#L158) | do\_action('wp\_powerpress\_player\_scripts'); |
| [159](#L159) | $return = apply\_filters('powerpress\_player', '', powerpress\_add\_flag\_to\_redirect\_url($url, 'p'), array('image'=>$image, 'type'=>$content\_type,'width'=>$width, 'height'=>$height) ); |
| [160](#L160) | } |
| [161](#L161) | else if( $channel ) |
| [162](#L162) | { |
| [163](#L163) | if (!empty($post)) { |
| [164](#L164) | $post\_id = $post->ID; |
| [165](#L165) | } else { |
| [166](#L166) | $post\_id = -1; |
| [167](#L167) | } |
| [168](#L168) | $EpisodeData = powerpress\_get\_enclosure\_data($post\_id, $channel); |
| [169](#L169) | if( !empty($EpisodeData['embed']) ) |
| [170](#L170) | $return = $EpisodeData['embed']; |
| [171](#L171) |  |
| [172](#L172) | // Shortcode over-ride settings: |
| [173](#L173) | if( !empty($image) ) |
| [174](#L174) | $EpisodeData['image'] = $image; |
| [175](#L175) | if( !empty($width) ) |
| [176](#L176) | $EpisodeData['width'] = $width; |
| [177](#L177) | if( !empty($height) ) |
| [178](#L178) | $EpisodeData['height'] = $height; |
| [179](#L179) | if (!empty($url)) { |
| [180](#L180) | $EpisodeData['url'] = $url; |
| [181](#L181) | } |
| [182](#L182) | if ($sample && empty($EpisodeData['url'])) { |
| [183](#L183) | // sample player for edit screen block pre-publish |
| [184](#L184) | $return .= "<p>This is a placeholder. Upon publishing, it will be replaced with the actual audio or video player.</p>"; |
| [185](#L185) | $EpisodeData['url'] = "https://media.blubrry.com/blubrrypreview/content.blubrry.com/blubrrypreview/transcript\_test\_episode.mp3"; |
| [186](#L186) | } |
| [187](#L187) | if (empty($EpisodeData['feed']) && !empty($channel)) { |
| [188](#L188) | $EpisodeData['feed'] = $channel; |
| [189](#L189) | } |
| [190](#L190) | if (empty($EpisodeData['type'])) { |
| [191](#L191) | $EpisodeData['type'] = ''; |
| [192](#L192) | } |
| [193](#L193) |  |
| [194](#L194) |  |
| [195](#L195) | $GeneralSettings = get\_option('powerpress\_general'); |
| [196](#L196) | if( isset($GeneralSettings['premium\_caps']) && $GeneralSettings['premium\_caps'] && !powerpress\_premium\_content\_authorized($channel) ) |
| [197](#L197) | { |
| [198](#L198) | $return .= powerpress\_premium\_content\_message($post\_id, $channel, $EpisodeData); |
| [199](#L199) | } |
| [200](#L200) | else |
| [201](#L201) | { |
| [202](#L202) | // If the shortcode specifies a channel, than we definitely want to include the player even if $EpisodeData['no\_player'] is true... |
| [203](#L203) | if( !isset($EpisodeData['no\_player']) && !empty($EpisodeData['url']) ) { |
| [204](#L204) | do\_action('wp\_powerpress\_player\_scripts'); |
| [205](#L205) | $return .= apply\_filters('powerpress\_player', '', powerpress\_add\_flag\_to\_redirect\_url($EpisodeData['url'], 'p'), array('id'=>$post\_id,'feed'=>$channel, 'channel'=>$channel, 'image'=>$image, 'type'=>$EpisodeData['type'],'width'=>$width, 'height'=>$height) ); |
| [206](#L206) | } |
| [207](#L207) | if( empty($EpisodeData['no\_links']) && !empty($EpisodeData['url']) ) { |
| [208](#L208) | do\_action('wp\_powerpress\_player\_scripts'); |
| [209](#L209) | $return .= apply\_filters('powerpress\_player\_links', '',  powerpress\_add\_flag\_to\_redirect\_url($EpisodeData['url'], 'p'), $EpisodeData ); |
| [210](#L210) | $return .= apply\_filters('powerpress\_player\_subscribe\_links', '',  powerpress\_add\_flag\_to\_redirect\_url($EpisodeData['url'], 'p'), $EpisodeData ); |
| [211](#L211) | } |
| [212](#L212) | } |
| [213](#L213) | } |
| [214](#L214) | else |
| [215](#L215) | { |
| [216](#L216) | $GeneralSettings = get\_option('powerpress\_general'); |
| [217](#L217) | if( !isset($GeneralSettings['custom\_feeds']['podcast']) ) |
| [218](#L218) | $GeneralSettings['custom\_feeds']['podcast'] = 'Podcast Feed'; // Fixes scenario where the user never configured the custom default podcast feed. |
| [219](#L219) |  |
| [220](#L220) | // If we have post type podcasting enabled, then we need to use the podcast post type feeds instead here... |
| [221](#L221) | if( !empty($GeneralSettings['posttype\_podcasting']) ) |
| [222](#L222) | { |
| [223](#L223) | $post\_type = get\_query\_var('post\_type'); |
| [224](#L224) | if ( is\_array( $post\_type ) ) { |
| [225](#L225) | $post\_type = reset( $post\_type ); // get first element in array |
| [226](#L226) | } |
| [227](#L227) |  |
| [228](#L228) | // Get the feed slugs and titles for this post type |
| [229](#L229) | $PostTypeSettingsArray = get\_option('powerpress\_posttype\_'.$post\_type); |
| [230](#L230) | // Loop through this array... |
| [231](#L231) | if( !empty($PostTypeSettingsArray) ) |
| [232](#L232) | { |
| [233](#L233) | switch($post\_type) |
| [234](#L234) | { |
| [235](#L235) | case 'post': |
| [236](#L236) | case 'page': { |
| [237](#L237) | // Do nothing!, we want the default podcast and channels to appear in these post types |
| [238](#L238) | }; break; |
| [239](#L239) | default: { |
| [240](#L240) | $GeneralSettings['custom\_feeds'] = array(); // reset this array since we're working with  a custom post type |
| [241](#L241) | }; |
| [242](#L242) | } |
| [243](#L243) |  |
| [244](#L244) | if (is\_array($PostTypeSettingsArray)) { |
| [245](#L245) | foreach ($PostTypeSettingsArray as $feed\_slug => $postTypeSettings) { |
| [246](#L246) | if (!empty($postTypeSettings['title'])) |
| [247](#L247) | $GeneralSettings['custom\_feeds'][$feed\_slug] = $postTypeSettings['title']; |
| [248](#L248) | else |
| [249](#L249) | $GeneralSettings['custom\_feeds'][$feed\_slug] = $feed\_slug; |
| [250](#L250) | } |
| [251](#L251) | } |
| [252](#L252) | } |
| [253](#L253) | } |
| [254](#L254) |  |
| [255](#L255) | if (is\_array($GeneralSettings['custom\_feeds'])) { |
| [256](#L256) | foreach ($GeneralSettings['custom\_feeds'] as $feed\_slug => $feed\_title) { |
| [257](#L257) | if (isset($GeneralSettings['disable\_player']) && isset($GeneralSettings['disable\_player'][$feed\_slug])) |
| [258](#L258) | continue; |
| [259](#L259) |  |
| [260](#L260) | $EpisodeData = powerpress\_get\_enclosure\_data($post->ID, $feed\_slug); |
| [261](#L261) | if (!$EpisodeData && !empty($GeneralSettings['process\_podpress']) && $feed\_slug == 'podcast') |
| [262](#L262) | $EpisodeData = powerpress\_get\_enclosure\_data\_podpress($post->ID); |
| [263](#L263) |  |
| [264](#L264) | if (!$EpisodeData) |
| [265](#L265) | continue; |
| [266](#L266) |  |
| [267](#L267) | if (!empty($EpisodeData['embed'])) |
| [268](#L268) | $return .= $EpisodeData['embed']; |
| [269](#L269) |  |
| [270](#L270) | // Shortcode over-ride settings: |
| [271](#L271) | if (!empty($image)) |
| [272](#L272) | $EpisodeData['image'] = $image; |
| [273](#L273) | if (!empty($width)) |
| [274](#L274) | $EpisodeData['width'] = $width; |
| [275](#L275) | if (!empty($height)) |
| [276](#L276) | $EpisodeData['height'] = $height; |
| [277](#L277) |  |
| [278](#L278) | if (isset($GeneralSettings['premium\_caps']) && $GeneralSettings['premium\_caps'] && !powerpress\_premium\_content\_authorized($feed\_slug)) { |
| [279](#L279) | $return .= powerpress\_premium\_content\_message($post->ID, $feed\_slug, $EpisodeData); |
| [280](#L280) | continue; |
| [281](#L281) | } |
| [282](#L282) |  |
| [283](#L283) | if (!isset($EpisodeData['no\_player'])) { |
| [284](#L284) | do\_action('wp\_powerpress\_player\_scripts'); |
| [285](#L285) | $return .= apply\_filters('powerpress\_player', '', powerpress\_add\_flag\_to\_redirect\_url($EpisodeData['url'], 'p'), $EpisodeData); |
| [286](#L286) | } |
| [287](#L287) | if (!isset($EpisodeData['no\_links'])) { |
| [288](#L288) | do\_action('wp\_powerpress\_player\_scripts'); |
| [289](#L289) | $return .= apply\_filters('powerpress\_player\_links', '', powerpress\_add\_flag\_to\_redirect\_url($EpisodeData['url'], 'p'), $EpisodeData); |
| [290](#L290) | $return .= apply\_filters('powerpress\_player\_subscribe\_links', '', powerpress\_add\_flag\_to\_redirect\_url($EpisodeData['url'], 'p'), $EpisodeData); |
| [291](#L291) | } |
| [292](#L292) | } |
| [293](#L293) | } |
| [294](#L294) | } |
| [295](#L295) |  |
| [296](#L296) | return $return; |
| [297](#L297) | } |
| [298](#L298) |  |
| [299](#L299) | add\_shortcode('powerpress', 'powerpress\_shortcode\_handler'); |
| [300](#L300) | if( !defined('PODCASTING\_VERSION') ) |
| [301](#L301) | { |
| [302](#L302) | add\_shortcode('podcast', 'powerpress\_shortcode\_handler'); |
| [303](#L303) | } |
| [304](#L304) |  |
| [305](#L305) | function wp\_powerpress\_player\_scripts() |
| [306](#L306) | { |
| [307](#L307) | // include what's needed for each plaer |
| [308](#L308) | if( defined('POWERPRESS\_JS\_DEBUG') ) |
| [309](#L309) | wp\_enqueue\_script( 'powerpress-player', powerpress\_get\_root\_url() .'player.js'); |
| [310](#L310) | else |
| [311](#L311) | wp\_enqueue\_script( 'powerpress-player', powerpress\_get\_root\_url() .'player.min.js'); |
| [312](#L312) | } |
| [313](#L313) | add\_action( 'wp\_powerpress\_player\_scripts', 'wp\_powerpress\_player\_scripts' ); |
| [314](#L314) |  |
| [315](#L315) |  |
| [316](#L316) | /\* |
| [317](#L317) | // Everything in $ExtraData except post\_id |
| [318](#L318) | \*/ |
| [319](#L319) | function powerpress\_generate\_embed($player, $EpisodeData) // $post\_id, $feed\_slug, $width=false, $height=false, $media\_url = false, $autoplay = false) |
| [320](#L320) | { |
| [321](#L321) | if( empty($EpisodeData['id']) && empty($EpisodeData['feed']) ) |
| [322](#L322) | return ''; |
| [323](#L323) |  |
| [324](#L324) | if( $player == 'blubrryaudio' || $player == 'blubrrymodern') |
| [325](#L325) | { |
| [326](#L326) | $extension = powerpressplayer\_get\_extension($EpisodeData['url']); |
| [327](#L327) | if( $extension == 'mp3' || $extension == 'm4a' ) |
| [328](#L328) | { |
| [329](#L329) | return powerpressplayer\_build\_blubrryaudio($EpisodeData['url'], $EpisodeData); |
| [330](#L330) | } |
| [331](#L331) | return ''; |
| [332](#L332) | } |
| [333](#L333) |  |
| [334](#L334) | $width = 0; |
| [335](#L335) | $height = 0; |
| [336](#L336) | if( !empty($EpisodeData['width']) && is\_numeric($EpisodeData['width']) ) |
| [337](#L337) | $width = $EpisodeData['width']; |
| [338](#L338) | if( !empty($EpisodeData['height']) && is\_numeric($EpisodeData['height']) ) |
| [339](#L339) | $height = $EpisodeData['height']; |
| [340](#L340) |  |
| [341](#L341) | // More efficient, only pull the general settings if necessary |
| [342](#L342) | if( $height == 0 || $width == 0 ) |
| [343](#L343) | { |
| [344](#L344) | $GeneralSettings = get\_option('powerpress\_general'); |
| [345](#L345) | if( $width == 0 ) |
| [346](#L346) | { |
| [347](#L347) | $width = 400; |
| [348](#L348) | if( !empty($GeneralSettings['player\_width']) ) |
| [349](#L349) | $width = $GeneralSettings['player\_width']; |
| [350](#L350) | } |
| [351](#L351) |  |
| [352](#L352) | if( $height == 0 ) |
| [353](#L353) | { |
| [354](#L354) | $height = 400; |
| [355](#L355) | if( !empty($GeneralSettings['player\_height']) ) |
| [356](#L356) | $height = $GeneralSettings['player\_height']; |
| [357](#L357) | } |
| [358](#L358) |  |
| [359](#L359) | $extension = powerpressplayer\_get\_extension($EpisodeData['url']); |
| [360](#L360) | if( $player == 'mediaelement-audio' ) |
| [361](#L361) | { |
| [362](#L362) | if( $extension == 'mp3' || $extension == 'm4a' || $extension == 'oga') |
| [363](#L363) | { |
| [364](#L364) | $height = 30; // Hack for audio to only include the player without the poster art |
| [365](#L365) | $width = 320; |
| [366](#L366) | if( !empty($GeneralSettings['player\_width\_audio']) ) |
| [367](#L367) | $width = $GeneralSettings['player\_width\_audio']; |
| [368](#L368) | } |
| [369](#L369) | } |
| [370](#L370) | else if ( $player == 'default' ) |
| [371](#L371) | { |
| [372](#L372) | if(  ($extension == 'mp3' || $extension == 'm4a' ) && empty($Settings['poster\_image\_audio']) ) |
| [373](#L373) | { |
| [374](#L374) | $height = 24; // Hack for audio to only include the player without the poster art |
| [375](#L375) | $width = 320; |
| [376](#L376) | if( !empty($GeneralSettings['player\_width\_audio']) ) |
| [377](#L377) | $width = $GeneralSettings['player\_width\_audio']; |
| [378](#L378) | } |
| [379](#L379) | } |
| [380](#L380) | } |
| [381](#L381) |  |
| [382](#L382) | $embed = ''; |
| [383](#L383) | $url = get\_bloginfo('url') .'/?powerpress\_embed=' . $EpisodeData['id'] .'-'. $EpisodeData['feed']; |
| [384](#L384) | if( isset($EpisodeData['autoplay']) && $EpisodeData['autoplay'] ) |
| [385](#L385) | $url .= '&amp;autoplay=true'; |
| [386](#L386) |  |
| [387](#L387) | $url .= '&amp;powerpress\_player='.$player; |
| [388](#L388) | $iframeTitle = esc\_attr( \_\_('Blubrry Podcast Player', 'powerpress') ); |
| [389](#L389) | $embed .= '<iframe'; |
| [390](#L390) | //$embed .= ' class="powerpress-player-embed"'; |
| [391](#L391) | $embed .= ' width="'. htmlspecialchars($width) .'"'; |
| [392](#L392) | $embed .= ' height="'. htmlspecialchars($height) .'"'; |
| [393](#L393) | $embed .= ' src="'. htmlspecialchars($url) .'"'; |
| [394](#L394) | $embed .= ' title="'. htmlspecialchars($iframeTitle) .'"'; |
| [395](#L395) | $embed .= ' frameborder="0" scrolling="no"'; |
| [396](#L396) | if($extension != 'mp3' && $extension != 'm4a' && $extension != 'oga') |
| [397](#L397) | $embed .= ' webkitAllowFullScreen mozallowfullscreen allowFullScreen'; |
| [398](#L398) | $embed .= '></iframe>'; |
| [399](#L399) | return $embed; |
| [400](#L400) | } |
| [401](#L401) |  |
| [402](#L402) | function do\_powerpressplayer\_embed($player, $media\_url, $EpisodeData = array()) |
| [403](#L403) | { |
| [404](#L404) | // Includde the stuff we need... |
| [405](#L405) | wp\_enqueue\_style('wp-mediaelement'); |
| [406](#L406) | wp\_enqueue\_script('wp-mediaelement'); |
| [407](#L407) |  |
| [408](#L408) | $mejs\_video = false; |
| [409](#L409) | $mejs\_audio = false; |
| [410](#L410) | $content\_type = powerpress\_get\_contenttype($media\_url); |
| [411](#L411) | if( preg\_match('/audio\/(mpeg|x-m4a|ogg)/i', $content\_type ) ) |
| [412](#L412) | $mejs\_audio = true; |
| [413](#L413) | else if( preg\_match('/video\/(mpeg|mp4|x-m4v|ogg)/i', $content\_type ) ) |
| [414](#L414) | $mejs\_video = true; |
| [415](#L415) |  |
| [416](#L416) | $content = ''; |
| [417](#L417) | $content .= '<!DOCTYPE html>'. PHP\_EOL; |
| [418](#L418) | $content .= '<html xmlns="http://www.w3.org/1999/xhtml">'. PHP\_EOL; |
| [419](#L419) | $content .= '<head>'. PHP\_EOL; |
| [420](#L420) | $content .= '<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />'. PHP\_EOL; |
| [421](#L421) | $content .= '<title>'. \_\_('Blubrry PowerPress Player', 'powerpress') .'</title>'. PHP\_EOL; |
| [422](#L422) | $content .= '<meta name="robots" content="noindex" />'. PHP\_EOL; |
| [423](#L423) | echo $content; |
| [424](#L424) |  |
| [425](#L425) | wp\_print\_styles(); |
| [426](#L426) | wp\_print\_scripts(); |
| [427](#L427) |  |
| [428](#L428) | $content = ''; |
| [429](#L429) | $content .= '<script type="text/javascript"><!--'. PHP\_EOL; |
| [430](#L430) | $content .= 'jQuery(document).ready(function($) {'. PHP\_EOL; |
| [431](#L431) | $content .= '  powerpress\_load\_player();'. PHP\_EOL; |
| [432](#L432) | $content .= '  jQuery(window).resize(function() {'. PHP\_EOL; |
| [433](#L433) | $content .= '    powerpress\_resize\_player();'. PHP\_EOL; |
| [434](#L434) | $content .= '  });'. PHP\_EOL; |
| [435](#L435) | $content .= '});'. PHP\_EOL; |
| [436](#L436) |  |
| [437](#L437) | $content .= 'function powerpress\_load\_player() {'. PHP\_EOL; |
| [438](#L438) | $content .= '  powerpress\_resize\_player();'.PHP\_EOL; |
| [439](#L439) | $content .= '}'. PHP\_EOL; |
| [440](#L440) |  |
| [441](#L441) | $content .= 'function powerpress\_resize\_player() { '. PHP\_EOL; |
| [442](#L442) | if( $mejs\_video ) |
| [443](#L443) | { |
| [444](#L444) | $content .= '  if( ( parseInt(jQuery(window).width()) \* 0.5625) >= parseInt(jQuery(window).height() ) ) {'. PHP\_EOL; |
| [445](#L445) | $content .= '   var height = parseInt(jQuery(window).height())-10;'. PHP\_EOL; |
| [446](#L446) | $content .= '   var width = Math.round((height\*16) / 9)+\'px\';'. PHP\_EOL; |
| [447](#L447) | $content .= '   jQuery(\'.powerpress\_player\').css(\'width\', width );'. PHP\_EOL; |
| [448](#L448) | $content .= '   jQuery(\'.powerpress\_player\').css(\'height\', height+\'px\' );'. PHP\_EOL; |
| [449](#L449) | $content .= '  } else {'. PHP\_EOL; |
| [450](#L450) | $content .= '   jQuery(\'.powerpress\_player\').css(\'width\', \'100%\' );'. PHP\_EOL; |
| [451](#L451) | $content .= '   jQuery(\'.powerpress\_player\').css(\'height\', \'100%\' );'. PHP\_EOL; |
| [452](#L452) | $content .= '  }'. PHP\_EOL; |
| [453](#L453) | } |
| [454](#L454) | $content .= '}'. PHP\_EOL; |
| [455](#L455) | $content .= "//-->\n"; |
| [456](#L456) | $content .= '</script>'. PHP\_EOL; |
| [457](#L457) | $content .= '<style type="text/css" media="screen">' . PHP\_EOL; |
| [458](#L458) | $content .= '   body { font-size: 13px; font-family: Arial, Helvetica, sans-serif; margin: 0; padding: 0; background-color:transparent; } img { border: 0; } ' . PHP\_EOL; |
| [459](#L459) |  |
| [460](#L460) | if( $mejs\_video ) |
| [461](#L461) | { |
| [462](#L462) | $content .= ' |
| [463](#L463) | .powerpress\_player { margin: 0 auto; } |
| [464](#L464) | .mejs-container { |
| [465](#L465) | width: 100% !important; |
| [466](#L466) | height: auto !important; |
| [467](#L467) | max-height: 500px  !important; |
| [468](#L468) | padding-top: 57%; |
| [469](#L469) | } |
| [470](#L470) | .mejs-overlay, .mejs-poster { |
| [471](#L471) | width: 100% !important; |
| [472](#L472) | height: 100% !important; |
| [473](#L473) | } |
| [474](#L474) | .mejs-mediaelement video { |
| [475](#L475) | position: absolute; |
| [476](#L476) | top: 0; left: 0; right: 0; bottom: 0; |
| [477](#L477) | width: 100% !important; |
| [478](#L478) | height: 100% !important; |
| [479](#L479) | } |
| [480](#L480) | '; |
| [481](#L481) | } |
| [482](#L482) | else |
| [483](#L483) | { |
| [484](#L484) | $content .= '.powerpress\_player  .wp-audio-shortcode { |
| [485](#L485) | max-width: 100% !important; |
| [486](#L486) | }'; |
| [487](#L487) | } |
| [488](#L488) | $content .= '</style>' . PHP\_EOL; |
| [489](#L489) | $content .= '</head>'. PHP\_EOL; |
| [490](#L490) | $content .= '<body>'. PHP\_EOL; |
| [491](#L491) |  |
| [492](#L492) | // Body specific content for player |
| [493](#L493) | if( $mejs\_audio ) |
| [494](#L494) | $content .= powerpressplayer\_build\_mediaelementaudio($media\_url, $EpisodeData, true); |
| [495](#L495) | else if( $mejs\_video ) |
| [496](#L496) | $content .= powerpressplayer\_build\_mediaelementvideo($media\_url, $EpisodeData, true); |
| [497](#L497) | else |
| [498](#L498) | $content .= '<strong>'. \_\_('Player Not Available', 'powerpress') .'</strong>'; |
| [499](#L499) |  |
| [500](#L500) | $content .= '</body>'. PHP\_EOL; |
| [501](#L501) | $content .= '</html>'. PHP\_EOL; |
| [502](#L502) | echo $content; |
| [503](#L503) | } |
| [504](#L504) |  |
| [505](#L505) |  |
| [506](#L506) | /\* |
| [507](#L507) | Audio Players - Flash/HTML5 compliant mp3 audio |
| [508](#L508) |  |
| [509](#L509) | @since 2.0 |
| [510](#L510) | @content - |
| [511](#L511) | @param string $content Content of post or page to add player to |
| [512](#L512) | @param string $media\_url Media URL to add player for |
| [513](#L513) | @param array $EpisodeData Array of key/value settings that optionally can contribute to player being added |
| [514](#L514) | @return string $content The content, possibly modified wih player added |
| [515](#L515) | \*/ |
| [516](#L516) | function powerpressplayer\_player\_audio($content, $media\_url, $EpisodeData = array() ) |
| [517](#L517) | { |
| [518](#L518) | $extension = powerpressplayer\_get\_extension($media\_url); |
| [519](#L519) | switch( $extension ) |
| [520](#L520) | { |
| [521](#L521) | // MP3 |
| [522](#L522) | case 'mp3': |
| [523](#L523) | { |
| [524](#L524) | $Settings = get\_option('powerpress\_general'); |
| [525](#L525) | if( !isset($Settings['player']) ) |
| [526](#L526) | $Settings['player'] = 'mediaelement-audio'; |
| [527](#L527) |  |
| [528](#L528) | switch( $Settings['player'] ) |
| [529](#L529) | { |
| [530](#L530) | case 'blubrryaudio': |
| [531](#L531) | case 'blubrrymodern': { |
| [532](#L532) | $content .= powerpressplayer\_build\_blubrryaudio($media\_url, $EpisodeData); |
| [533](#L533) | }; break; |
| [534](#L534) | case 'html5audio': { |
| [535](#L535) | $content .= powerpressplayer\_build\_html5audio($media\_url, $EpisodeData); |
| [536](#L536) | }; break; |
| [537](#L537) | case 'mediaelement-audio': |
| [538](#L538) | default: { |
| [539](#L539) | $content .= powerpressplayer\_build\_mediaelementaudio($media\_url, $EpisodeData); |
| [540](#L540) | }; break; |
| [541](#L541) | } |
| [542](#L542) |  |
| [543](#L543) | }; break; |
| [544](#L544) | case 'm4a': { |
| [545](#L545) |  |
| [546](#L546) | $Settings = get\_option('powerpress\_general'); |
| [547](#L547) | if( !isset($Settings['player']) ) |
| [548](#L548) | $Settings['player'] = 'mediaelement-audio'; |
| [549](#L549) |  |
| [550](#L550) | switch( $Settings['player'] ) |
| [551](#L551) | { |
| [552](#L552) | case 'blubrryaudio': |
| [553](#L553) | case 'blubrrymodern': { |
| [554](#L554) | $content .= powerpressplayer\_build\_blubrryaudio($media\_url, $EpisodeData); |
| [555](#L555) | }; break; |
| [556](#L556) | case 'html5audio': { |
| [557](#L557) | $content .= powerpressplayer\_build\_html5audio($media\_url, $EpisodeData); |
| [558](#L558) | }; break; |
| [559](#L559) | case 'mediaelement-audio': { |
| [560](#L560) | $content .= powerpressplayer\_build\_mediaelementaudio($media\_url, $EpisodeData); |
| [561](#L561) | }; break; |
| [562](#L562) | default: { |
| [563](#L563) | $content .= powerpressplayer\_build\_playimageaudio($media\_url, true); |
| [564](#L564) | }; |
| [565](#L565) | } |
| [566](#L566) |  |
| [567](#L567) | // Use Flow player if configured |
| [568](#L568) | }; break; |
| [569](#L569) | case 'ogg': { |
| [570](#L570) | if( defined('POWERPRESS\_OGG\_VIDEO') && POWERPRESS\_OGG\_VIDEO ) |
| [571](#L571) | return $content; // Ogg is handled as video |
| [572](#L572) | } |
| [573](#L573) | case 'oga': { |
| [574](#L574) |  |
| [575](#L575) | $Settings = get\_option('powerpress\_general'); |
| [576](#L576) | if( !isset($Settings['player']) ) |
| [577](#L577) | $Settings['player'] = 'mediaelement-audio'; |
| [578](#L578) |  |
| [579](#L579) | switch( $Settings['player'] ) |
| [580](#L580) | { |
| [581](#L581) | case 'mediaelement-audio': { |
| [582](#L582) | $content .= powerpressplayer\_build\_mediaelementaudio($media\_url, $EpisodeData); |
| [583](#L583) | }; break; |
| [584](#L584) | case 'html5audio': |
| [585](#L585) | default: { |
| [586](#L586) | $content .= powerpressplayer\_build\_html5audio($media\_url, $EpisodeData); |
| [587](#L587) | } |
| [588](#L588) | } |
| [589](#L589) | }; break; |
| [590](#L590) | } |
| [591](#L591) |  |
| [592](#L592) | return $content; |
| [593](#L593) | } |
| [594](#L594) |  |
| [595](#L595) | /\* |
| [596](#L596) | Video Players - HTML5/Flash compliant video formats |
| [597](#L597) | \*/ |
| [598](#L598) | function powerpressplayer\_player\_video($content, $media\_url, $EpisodeData = array() ) |
| [599](#L599) | { |
| [600](#L600) | $extension = powerpressplayer\_get\_extension($media\_url); |
| [601](#L601) | switch( $extension ) |
| [602](#L602) | { |
| [603](#L603) | // OGG (audio or video) |
| [604](#L604) | case 'ogg': { |
| [605](#L605) | // Ogg special case, we treat as audio unless specified otherwise |
| [606](#L606) | if( !defined('POWERPRESS\_OGG\_VIDEO') || POWERPRESS\_OGG\_VIDEO == false ) |
| [607](#L607) | return $content; |
| [608](#L608) | } |
| [609](#L609) | // OGG Video / WebM |
| [610](#L610) | case 'webm': |
| [611](#L611) | case 'ogv': { // Use native player when possible |
| [612](#L612) | $Settings = get\_option('powerpress\_general'); |
| [613](#L613) | if( !isset($Settings['video\_player']) ) |
| [614](#L614) | $Settings['video\_player'] = 'mediaelement-video'; |
| [615](#L615) | else if( !isset($Settings['video\_player']) ) |
| [616](#L616) | $Settings['video\_player'] = 'html5video'; |
| [617](#L617) |  |
| [618](#L618) | // HTML5 Video as an embed |
| [619](#L619) | switch( $Settings['video\_player'] ) |
| [620](#L620) | { |
| [621](#L621) | case 'videojs-html5-video-player-for-wordpress': { |
| [622](#L622) | $content .= powerpressplayer\_build\_videojs($media\_url, $EpisodeData); |
| [623](#L623) | }; break; |
| [624](#L624) | case 'mediaelement-video': { |
| [625](#L625) | $content .= powerpressplayer\_build\_mediaelementvideo($media\_url, $EpisodeData); |
| [626](#L626) | }; break; |
| [627](#L627) | default: { |
| [628](#L628) | $content .= powerpressplayer\_build\_html5video($media\_url, $EpisodeData); |
| [629](#L629) | }; break; |
| [630](#L630) | } |
| [631](#L631) | }; break; |
| [632](#L632) | // H.264 |
| [633](#L633) | case 'm4v': |
| [634](#L634) | case 'mp4': |
| [635](#L635) | // Okay, lets see if we we have a player setup to handle this |
| [636](#L636) | { |
| [637](#L637) | $Settings = get\_option('powerpress\_general'); |
| [638](#L638) | if( !isset($Settings['video\_player']) ) |
| [639](#L639) | $Settings['video\_player'] = 'mediaelement-video'; |
| [640](#L640) |  |
| [641](#L641) | switch( $Settings['video\_player'] ) |
| [642](#L642) | { |
| [643](#L643) | case 'videojs-html5-video-player-for-wordpress': { |
| [644](#L644) | $content .= powerpressplayer\_build\_videojs($media\_url, $EpisodeData); |
| [645](#L645) | }; break; |
| [646](#L646) | case 'html5video': { |
| [647](#L647) | // HTML5 Video as an embed |
| [648](#L648) | $content .= powerpressplayer\_build\_html5video($media\_url, $EpisodeData); |
| [649](#L649) | }; break; |
| [650](#L650) | case 'mediaelement-video': |
| [651](#L651) | default: { |
| [652](#L652) | $content .= powerpressplayer\_build\_mediaelementvideo($media\_url, $EpisodeData); |
| [653](#L653) | }; break; |
| [654](#L654) | } |
| [655](#L655) | }; break; |
| [656](#L656) | } |
| [657](#L657) |  |
| [658](#L658) | return $content; |
| [659](#L659) | } |
| [660](#L660) |  |
| [661](#L661) | function powerpressplayer\_player\_other($content, $media\_url, $EpisodeData = array() ) |
| [662](#L662) | { |
| [663](#L663) | // Very important setting, we need to know if the media should auto play or not... |
| [664](#L664) | $autoplay = false; // (default) |
| [665](#L665) | if( isset($EpisodeData['autoplay']) && $EpisodeData['autoplay'] ) |
| [666](#L666) | $autoplay = true; |
| [667](#L667) | $cover\_image = ''; |
| [668](#L668) | if( !empty($EpisodeData['image']) ) |
| [669](#L669) | $cover\_image = $EpisodeData['image']; |
| [670](#L670) |  |
| [671](#L671) | $extension = powerpressplayer\_get\_extension($media\_url); |
| [672](#L672) |  |
| [673](#L673) | switch( $extension ) |
| [674](#L674) | { |
| [675](#L675) | // Common formats, we already handle them separately |
| [676](#L676) | case 'mp3': |
| [677](#L677) | case 'mp4': |
| [678](#L678) | case 'm4v': |
| [679](#L679) | case 'webm'; |
| [680](#L680) | case 'ogg': |
| [681](#L681) | case 'ogv': |
| [682](#L682) | case 'oga': |
| [683](#L683) | case 'flv': |
| [684](#L684) | case 'm4a': { |
| [685](#L685) |  |
| [686](#L686) | return $content; |
| [687](#L687) | }; break; |
| [688](#L688) | case 'swf': // No more support for flash swf files |
| [689](#L689) | case 'avi': |
| [690](#L690) | case 'mpg': |
| [691](#L691) | case 'mpeg': |
| [692](#L692) | case 'm4b': |
| [693](#L693) | case 'm4r': |
| [694](#L694) | case 'qt': |
| [695](#L695) | case 'mov': |
| [696](#L696) | // Windows Media: |
| [697](#L697) | case 'wma': |
| [698](#L698) | case 'wmv': |
| [699](#L699) | case 'asf': { // No more quicktime on multiple platforms, lets display an image with a link and hope for the best |
| [700](#L700) |  |
| [701](#L701) | $content .= powerpressplayer\_build\_playimage($media\_url, $EpisodeData, true); |
| [702](#L702) |  |
| [703](#L703) | }; break; |
| [704](#L704) | case 'pdf': { |
| [705](#L705) | $content .= powerpressplayer\_build\_playimagepdf($media\_url, true); |
| [706](#L706) | }; break; |
| [707](#L707) | case 'epub': { |
| [708](#L708) | $content .= powerpressplayer\_build\_playimageepub($media\_url, true); |
| [709](#L709) | }; break; |
| [710](#L710) |  |
| [711](#L711) | // Default, just display the play image. |
| [712](#L712) | default: { |
| [713](#L713) |  |
| [714](#L714) | $content .= powerpressplayer\_build\_playimage($media\_url, $EpisodeData, true); |
| [715](#L715) |  |
| [716](#L716) | }; break; |
| [717](#L717) | } |
| [718](#L718) |  |
| [719](#L719) | return $content; |
| [720](#L720) | } |
| [721](#L721) |  |
| [722](#L722) | function powerpressplayer\_mediaobjects\_video($content, $media\_url, $EpisodeData = array()) |
| [723](#L723) | { |
| [724](#L724) | $extension = powerpressplayer\_get\_extension($media\_url); |
| [725](#L725) | switch( $extension ) |
| [726](#L726) | { |
| [727](#L727) | // OGG (audio or video) |
| [728](#L728) | case 'ogg': { |
| [729](#L729) | // Ogg special case, we treat as audio unless specified otherwise |
| [730](#L730) | if( !defined('POWERPRESS\_OGG\_VIDEO') || POWERPRESS\_OGG\_VIDEO == false ) |
| [731](#L731) | { |
| [732](#L732) | return $content; |
| [733](#L733) | } |
| [734](#L734) | } // let fall through and handle as video... |
| [735](#L735) | case 'mp4': |
| [736](#L736) | case 'm4v': |
| [737](#L737) | case 'webm': |
| [738](#L738) | case 'ogv': { |
| [739](#L739) | $VideoObject = true; |
| [740](#L740) | }; break; |
| [741](#L741) | default: return $content; |
| [742](#L742) | } |
| [743](#L743) |  |
| [744](#L744) | return powerpressplayer\_mediaobjects('video', $content, $media\_url, $EpisodeData); |
| [745](#L745) | } |
| [746](#L746) |  |
| [747](#L747) | function powerpressplayer\_mediaobjects\_audio($content, $media\_url, $EpisodeData = array()) |
| [748](#L748) | { |
| [749](#L749) | $extension = powerpressplayer\_get\_extension($media\_url); |
| [750](#L750) | switch( $extension ) |
| [751](#L751) | { |
| [752](#L752) | // OGG (audio or video) |
| [753](#L753) | case 'ogg': { |
| [754](#L754) | // Ogg special case, we treat as audio unless specified otherwise |
| [755](#L755) | if( defined('POWERPRESS\_OGG\_VIDEO') && POWERPRESS\_OGG\_VIDEO ) |
| [756](#L756) | { |
| [757](#L757) | return $content; |
| [758](#L758) | } |
| [759](#L759) | } // let fall through and handle as video... |
| [760](#L760) | case 'mp3': |
| [761](#L761) | case 'm4a': |
| [762](#L762) | case 'oga': { |
| [763](#L763) | $AudioObject = true; |
| [764](#L764) | }; break; |
| [765](#L765) | default: return $content; |
| [766](#L766) | } |
| [767](#L767) |  |
| [768](#L768) | return powerpressplayer\_mediaobjects('audio', $content, $media\_url, $EpisodeData); |
| [769](#L769) | } |
| [770](#L770) |  |
| [771](#L771) | function powerpressplayer\_mediaobjects($type, $content, $media\_url, $EpisodeData = array()) |
| [772](#L772) | { |
| [773](#L773) | $GLOBALS['g\_powerpress\_complete\_mediaobject'] = true; |
| [774](#L774) | $addhtml = ''; |
| [775](#L775) | $addhtml .= '<div itemscope itemtype="http://schema.org/'. ($type=='video'?'VideoObject':'AudioObject') .'">'.PHP\_EOL\_WEB; |
| [776](#L776) |  |
| [777](#L777) | if( !empty($EpisodeData['title']) ) |
| [778](#L778) | { |
| [779](#L779) | // We want to use the post title so ignore this for now |
| [780](#L780) | } |
| [781](#L781) |  |
| [782](#L782) | $media\_url = powerpress\_add\_flag\_to\_redirect\_url($media\_url, 's'); // Search tag |
| [783](#L783) |  |
| [784](#L784) | //var\_dump($EpisodeData); |
| [785](#L785) | $post\_title = get\_the\_title(); |
| [786](#L786) | if( !empty($post\_title) ) { |
| [787](#L787) | $addhtml .= '<meta itemprop="name" content="'.  htmlspecialchars($post\_title) .'" />'.PHP\_EOL\_WEB; |
| [788](#L788) | } |
| [789](#L789) |  |
| [790](#L790) | $addhtml .= '<meta itemprop="uploadDate" content="'. esc\_attr( get\_the\_date('c') ) .'" />'.PHP\_EOL\_WEB; |
| [791](#L791) | $addhtml .= '<meta itemprop="encodingFormat" content="'. powerpress\_get\_contenttype($media\_url) .'" />'.PHP\_EOL\_WEB; |
| [792](#L792) | if( !empty($EpisodeData['duration']) ) { |
| [793](#L793) | $addhtml .= '<meta itemprop="duration" content="'. powerpress\_iso8601\_duration($EpisodeData['duration']) .'" />'.PHP\_EOL\_WEB; // http://en.wikipedia.org/wiki/ISO\_8601#Durations |
| [794](#L794) | } |
| [795](#L795) |  |
| [796](#L796) | if( !empty($EpisodeData['subtitle']) ) { |
| [797](#L797) | $addhtml .= '<meta itemprop="description" content="'.  htmlspecialchars($EpisodeData['subtitle']) .'" />'.PHP\_EOL\_WEB; |
| [798](#L798) | } |
| [799](#L799) | else |
| [800](#L800) | {       // Get the current post object... |
| [801](#L801) | $post = get\_post( ); |
| [802](#L802) | if (!empty($post)) { |
| [803](#L803) | // Get a subtitle from the post content or excerpt... |
| [804](#L804) | $subtitle = strip\_tags($post->post\_excerpt); |
| [805](#L805) | if (empty($subtitle)) { |
| [806](#L806) | $subtitle = $post->post\_content; |
| [807](#L807) | $subtitle = strip\_shortcodes($subtitle); |
| [808](#L808) | $subtitle = str\_replace(']]>', ']]&gt;', $subtitle); |
| [809](#L809) | $subtitle = strip\_tags($subtitle); |
| [810](#L810) |  |
| [811](#L811) | $length = (function\_exists('mb\_strlen') ? mb\_strlen($subtitle) : strlen($subtitle)); |
| [812](#L812) | if ($length > 250) { |
| [813](#L813) | $subtitle = (function\_exists('mb\_substr') ? mb\_substr($subtitle, 0, 250) : substr($subtitle, 0, 250)) . '...'; |
| [814](#L814) | } |
| [815](#L815) | } |
| [816](#L816) |  |
| [817](#L817) | if (empty($subtitle)) |
| [818](#L818) | $subtitle = $post\_title; |
| [819](#L819) |  |
| [820](#L820) | $addhtml .= '<meta itemprop="description" content="' . htmlspecialchars($subtitle) . '" />' . PHP\_EOL\_WEB; |
| [821](#L821) | } |
| [822](#L822) | } |
| [823](#L823) | $addhtml .= '<meta itemprop="contentUrl" content="'. htmlspecialchars($media\_url) .'" />'.PHP\_EOL\_WEB; |
| [824](#L824) |  |
| [825](#L825) | // For thumbnail image, use the podcast artwork |
| [826](#L826) | if( !empty($EpisodeData['image']) ) |
| [827](#L827) | { |
| [828](#L828) | $addhtml .= '<meta itemprop="thumbnailURL" content="'.$EpisodeData['image'] .'" />'.PHP\_EOL\_WEB; |
| [829](#L829) | } |
| [830](#L830) |  |
| [831](#L831) | if( !empty($EpisodeData['size']) ) |
| [832](#L832) | { |
| [833](#L833) | $addhtml .= '<meta itemprop="contentSize" content="'. number\_format($EpisodeData['size'] / (1024 \* 1024), 1) .'" />'.PHP\_EOL\_WEB; |
| [834](#L834) | } |
| [835](#L835) |  |
| [836](#L836) | // <meta itemprop="videoQuality" content="HD"/> |
| [837](#L837) | if( !empty($EpisodeData['height']) && is\_numeric($EpisodeData['height']) ) |
| [838](#L838) | { |
| [839](#L839) | $addhtml .= '<meta itemprop="height" content="'.$EpisodeData['height'] .'" />'.PHP\_EOL\_WEB; |
| [840](#L840) | } |
| [841](#L841) |  |
| [842](#L842) | if( !empty($EpisodeData['width']) && is\_numeric($EpisodeData['width']) ) |
| [843](#L843) | { |
| [844](#L844) | $addhtml .= '<meta itemprop="width" content="'.$EpisodeData['width'] .'" />'.PHP\_EOL\_WEB; |
| [845](#L845) | } |
| [846](#L846) |  |
| [847](#L847) | return $content . $addhtml; |
| [848](#L848) | } |
| [849](#L849) |  |
| [850](#L850) | function powerpress\_iso8601\_duration($duration) |
| [851](#L851) | { |
| [852](#L852) | $seconds = 0; |
| [853](#L853) | $parts = explode(':', $duration); |
| [854](#L854) | if( count($parts) == 3 ) |
| [855](#L855) | $seconds = $parts[2] + ($parts[1]\*60) + ($parts[0]\*60\*60); |
| [856](#L856) | else if ( count($parts) == 2 ) |
| [857](#L857) | $seconds = $parts[1] + ($parts[0]\*60); |
| [858](#L858) | else |
| [859](#L859) | $seconds = $parts[0]; |
| [860](#L860) |  |
| [861](#L861) | $hours = 0; |
| [862](#L862) | $minutes = 0; |
| [863](#L863) | if( $seconds >= (60\*60) ) |
| [864](#L864) | { |
| [865](#L865) | $hours = floor( $seconds /(60\*60) ); |
| [866](#L866) | $seconds -= (60\*60\*$hours); |
| [867](#L867) | } |
| [868](#L868) | if( $seconds >= (60) ) |
| [869](#L869) | { |
| [870](#L870) | $minutes = floor( $seconds /(60) ); |
| [871](#L871) | $seconds -= (60\*$minutes); |
| [872](#L872) | } |
| [873](#L873) |  |
| [874](#L874) | if( $hours ) // X:XX:XX (readable) |
| [875](#L875) | return sprintf('PT%dH%02dM%02dS', $hours, $minutes, $seconds); |
| [876](#L876) |  |
| [877](#L877) | return sprintf('PT%dM%02dS', $minutes, $seconds); // X:XX or 0:XX (readable) |
| [878](#L878) | } |
| [879](#L879) |  |
| [880](#L880) | function powerpressplayer\_mediaobjects\_post($content, $media\_url, $EpisodeData = array()) |
| [881](#L881) | { |
| [882](#L882) | if( !empty($GLOBALS['g\_powerpress\_complete\_mediaobject']) ) |
| [883](#L883) | { |
| [884](#L884) | $content .= '</div>'; |
| [885](#L885) | unset($GLOBALS['g\_powerpress\_complete\_mediaobject']); |
| [886](#L886) | } |
| [887](#L887) | return $content; |
| [888](#L888) | } |
| [889](#L889) |  |
| [890](#L890) |  |
| [891](#L891) | add\_filter('powerpress\_player', 'powerpressplayer\_player\_audio', 10, 3); // Audio players (mp3) |
| [892](#L892) | add\_filter('powerpress\_player', 'powerpressplayer\_player\_video', 10, 3); // Video players (mp4/m4v, webm, ogv) |
| [893](#L893) | add\_filter('powerpress\_player', 'powerpressplayer\_player\_other', 10, 3); // Audio/Video flv, wmv, wma, oga, m4a and other non-standard media files |
| [894](#L894) |  |
| [895](#L895) |  |
| [896](#L896) | /\* |
| [897](#L897) | Filters for media links, appear below the selected player |
| [898](#L898) | \*/ |
| [899](#L899) | function powerpressplayer\_link\_download($content, $media\_url, $ExtraData = array() ) |
| [900](#L900) | { |
| [901](#L901) | $media\_url = esc\_url(powerpress\_add\_flag\_to\_redirect\_url($media\_url,'s')); |
| [902](#L902) | $GeneralSettings = get\_option('powerpress\_general'); |
| [903](#L903) | if( !isset($GeneralSettings['podcast\_link']) ) |
| [904](#L904) | $GeneralSettings['podcast\_link'] = 1; |
| [905](#L905) |  |
| [906](#L906) | $player\_links = ''; |
| [907](#L907) | if( $GeneralSettings['podcast\_link'] == 1 ) |
| [908](#L908) | { |
| [909](#L909) | $player\_links .= "<a href=\"{$media\_url}\" class=\"powerpress\_link\_d\" title=\"". POWERPRESS\_DOWNLOAD\_TEXT ."\" rel=\"nofollow\" download=\"". htmlspecialchars(basename($media\_url)) ."\">". POWERPRESS\_DOWNLOAD\_TEXT ."</a>".PHP\_EOL\_WEB; |
| [910](#L910) | } |
| [911](#L911) | else if( $GeneralSettings['podcast\_link'] == 2 ) |
| [912](#L912) | { |
| [913](#L913) | $player\_links .= "<a href=\"{$media\_url}\" class=\"powerpress\_link\_d\" title=\"". POWERPRESS\_DOWNLOAD\_TEXT ."\" rel=\"nofollow\" download=\"". htmlspecialchars(basename($media\_url)) ."\">". POWERPRESS\_DOWNLOAD\_TEXT ."</a> (".powerpress\_byte\_size($ExtraData['size']).") ".PHP\_EOL\_WEB; |
| [914](#L914) | } |
| [915](#L915) | else if( $GeneralSettings['podcast\_link'] == 3 ) |
| [916](#L916) | { |
| [917](#L917) | if( !empty($ExtraData['duration']) && ltrim($ExtraData['duration'], '0:') != '' ) |
| [918](#L918) | $player\_links .= "<a href=\"{$media\_url}\" class=\"powerpress\_link\_d\" title=\"". POWERPRESS\_DOWNLOAD\_TEXT ."\" rel=\"nofollow\" download=\"". htmlspecialchars(basename($media\_url)) ."\">". POWERPRESS\_DOWNLOAD\_TEXT ."</a> (". htmlspecialchars(POWERPRESS\_DURATION\_TEXT) .": " . powerpress\_readable\_duration($ExtraData['duration']) ." &#8212; ".powerpress\_byte\_size($ExtraData['size']).")".PHP\_EOL\_WEB; |
| [919](#L919) | else |
| [920](#L920) | $player\_links .= "<a href=\"{$media\_url}\" class=\"powerpress\_link\_d\" title=\"". POWERPRESS\_DOWNLOAD\_TEXT ."\" rel=\"nofollow\" download=\"". htmlspecialchars(basename($media\_url)) ."\">". POWERPRESS\_DOWNLOAD\_TEXT ."</a> (".powerpress\_byte\_size($ExtraData['size']).")".PHP\_EOL\_WEB; |
| [921](#L921) | } |
| [922](#L922) |  |
| [923](#L923) | if( $player\_links && !empty($content) ) |
| [924](#L924) | $content .= ' '.POWERPRESS\_LINK\_SEPARATOR .' '; |
| [925](#L925) |  |
| [926](#L926) | return $content . $player\_links; |
| [927](#L927) | } |
| [928](#L928) |  |
| [929](#L929) | function powerpressplayer\_link\_pinw($content, $media\_url, $ExtraData = array() ) |
| [930](#L930) | { |
| [931](#L931) | $GeneralSettings = get\_option('powerpress\_general'); |
| [932](#L932) | if( !isset($GeneralSettings['player\_function']) ) |
| [933](#L933) | $GeneralSettings['player\_function'] = 1; |
| [934](#L934) | $is\_pdf = (strtolower( substr($media\_url, -3) ) == 'pdf' ); |
| [935](#L935) |  |
| [936](#L936) | $player\_links = ''; |
| [937](#L937) | $media\_url = htmlspecialchars($media\_url); |
| [938](#L938) | switch( $GeneralSettings['player\_function'] ) |
| [939](#L939) | { |
| [940](#L940) | case 1: // Play on page and new window |
| [941](#L941) | case 3: // Play in new window only |
| [942](#L942) | case 5: { // Play in page and new window |
| [943](#L943) | if( $is\_pdf ) |
| [944](#L944) | $player\_links .= "<a href=\"{$media\_url}\" class=\"powerpress\_link\_pinw\" target=\"\_blank\" title=\"". \_\_('Open in New Window', 'powerpress') ."\" rel=\"nofollow\">". \_\_('Open in New Window', 'powerpress') ."</a>".PHP\_EOL\_WEB; |
| [945](#L945) | else if( !empty($ExtraData['id']) && !empty($ExtraData['feed']) ) { |
| [946](#L946) | $pinw\_url = get\_bloginfo('url') ."/?powerpress\_pinw={$ExtraData['id']}-{$ExtraData['feed']}"; |
| [947](#L947) | $player\_links .= "<a href=\"{$media\_url}\" class=\"powerpress\_link\_pinw\" target=\"\_blank\" title=\"". POWERPRESS\_PLAY\_IN\_NEW\_WINDOW\_TEXT ."\" onclick=\"return powerpress\_pinw('". esc\_js($pinw\_url) ."');\" rel=\"nofollow\">". POWERPRESS\_PLAY\_IN\_NEW\_WINDOW\_TEXT ."</a>".PHP\_EOL\_WEB; |
| [948](#L948) | } |
| [949](#L949) | else |
| [950](#L950) | $player\_links .= "<a href=\"{$media\_url}\" class=\"powerpress\_link\_pinw\" target=\"\_blank\" title=\"". POWERPRESS\_PLAY\_IN\_NEW\_WINDOW\_TEXT ."\" rel=\"nofollow\">". POWERPRESS\_PLAY\_IN\_NEW\_WINDOW\_TEXT ."</a>".PHP\_EOL\_WEB; |
| [951](#L951) | }; break; |
| [952](#L952) | }//end switch |
| [953](#L953) |  |
| [954](#L954) | if( $player\_links && !empty($content) ) |
| [955](#L955) | $content .= ' '.POWERPRESS\_LINK\_SEPARATOR .' '; |
| [956](#L956) |  |
| [957](#L957) | return $content . $player\_links; |
| [958](#L958) | } |
| [959](#L959) |  |
| [960](#L960) | function powerpressplayer\_embedable($media\_url, $ExtraData = array()) |
| [961](#L961) | { |
| [962](#L962) | if( empty($ExtraData['id']) || empty($ExtraData['feed']) ) |
| [963](#L963) | return false; |
| [964](#L964) |  |
| [965](#L965) | $extension = powerpressplayer\_get\_extension($media\_url); |
| [966](#L966) | $player = false; |
| [967](#L967) | if( preg\_match('/(mp3|m4a|oga|mp4|m4v|webm|ogg|ogv)/i', $extension ) ) |
| [968](#L968) | { |
| [969](#L969) | $GeneralSettings = get\_option('powerpress\_general'); |
| [970](#L970) | if( empty($GeneralSettings['podcast\_embed']) ) |
| [971](#L971) | return false; |
| [972](#L972) | if( empty($GeneralSettings['player']) || $GeneralSettings['player'] == 'flow-player-classic' ) |
| [973](#L973) | $GeneralSettings['player'] = 'mediaelement-audio'; |
| [974](#L974) |  |
| [975](#L975) |  |
| [976](#L976) | if( empty($GeneralSettings['video\_player']) || $GeneralSettings['video\_player'] == 'flow-player-classic' ) |
| [977](#L977) | $GeneralSettings['video\_player'] = 'mediaelement-video'; |
| [978](#L978) |  |
| [979](#L979) | switch( $extension ) |
| [980](#L980) | { |
| [981](#L981) | case 'mp3': |
| [982](#L982) | case 'oga': |
| [983](#L983) | case 'm4a': { |
| [984](#L984) | if( in\_array( $GeneralSettings['player'], array('mediaelement-audio', 'default', 'blubrryaudio', 'blubrrymodern') ) ) |
| [985](#L985) | $player = $GeneralSettings['player']; |
| [986](#L986) | }; break; |
| [987](#L987) | case 'mp4': |
| [988](#L988) | case 'm4v': |
| [989](#L989) | case 'webm': |
| [990](#L990) | case 'ogg': |
| [991](#L991) | case 'ogv': { |
| [992](#L992) | if( in\_array( $GeneralSettings['video\_player'], array('mediaelement-video', 'html5video') ) ) |
| [993](#L993) | $player = $GeneralSettings['video\_player']; |
| [994](#L994) | }; break; |
| [995](#L995) | } |
| [996](#L996) | } |
| [997](#L997) |  |
| [998](#L998) | return $player; |
| [999](#L999) | } |
| [1000](#L1000) |  |
| [1001](#L1001) | function powerpressplayer\_link\_embed($content, $media\_url, $ExtraData = array() ) |
| [1002](#L1002) | { |
| [1003](#L1003) | $player\_links = ''; |
| [1004](#L1004) |  |
| [1005](#L1005) | $player = powerpressplayer\_embedable($media\_url, $ExtraData); |
| [1006](#L1006) | if( $player ) |
| [1007](#L1007) | { |
| [1008](#L1008) | $player\_links .= "<a href=\"#\" class=\"powerpress\_link\_e\" title=\"". htmlspecialchars(POWERPRESS\_EMBED\_TEXT) ."\" onclick=\"return powerpress\_show\_embed('{$ExtraData['id']}-{$ExtraData['feed']}');\" rel=\"nofollow\">". htmlspecialchars(POWERPRESS\_EMBED\_TEXT) ."</a>"; |
| [1009](#L1009) | } |
| [1010](#L1010) |  |
| [1011](#L1011) | if( $player\_links && !empty($content) ) |
| [1012](#L1012) | $content .= ' '.POWERPRESS\_LINK\_SEPARATOR .' '; |
| [1013](#L1013) | return $content . $player\_links; |
| [1014](#L1014) | } |
| [1015](#L1015) |  |
| [1016](#L1016) | function powerpressplayer\_link\_title($content, $media\_url, $ExtraData = array() ) |
| [1017](#L1017) | { |
| [1018](#L1018) | if( $content ) |
| [1019](#L1019) | { |
| [1020](#L1020) | $extension = 'unknown'; |
| [1021](#L1021) | $parts = pathinfo($media\_url); |
| [1022](#L1022) | if( $parts && isset($parts['extension']) ) |
| [1023](#L1023) | $extension  = strtolower($parts['extension']); |
| [1024](#L1024) |  |
| [1025](#L1025) | $prefix = ''; |
| [1026](#L1026) | if( $extension == 'pdf' ) |
| [1027](#L1027) | $prefix .= \_\_('E-Book PDF', 'powerpress') . ( $ExtraData['feed']=='pdf'||$ExtraData['feed']=='podcast'?'':" ({$ExtraData['feed']})") .POWERPRESS\_TEXT\_SEPARATOR; |
| [1028](#L1028) | else if( $ExtraData['feed'] != 'podcast' ) |
| [1029](#L1029) | $prefix .= htmlspecialchars(POWERPRESS\_LINKS\_TEXT) .' ('. htmlspecialchars($ExtraData['feed']) .')'. POWERPRESS\_TEXT\_SEPARATOR; |
| [1030](#L1030) | else |
| [1031](#L1031) | $prefix .= htmlspecialchars(POWERPRESS\_LINKS\_TEXT) . POWERPRESS\_TEXT\_SEPARATOR; |
| [1032](#L1032) | if( !empty($prefix) ) |
| [1033](#L1033) | $prefix .= ' '; |
| [1034](#L1034) |  |
| [1035](#L1035) | $return = '<p class="powerpress\_links powerpress\_links\_'. $extension .'" style="margin-bottom: 1px !important;">'. $prefix . $content . '</p>'; |
| [1036](#L1036) | $player = powerpressplayer\_embedable($media\_url, $ExtraData); |
| [1037](#L1037) | if( $player ) |
| [1038](#L1038) | { |
| [1039](#L1039) | if( !empty($ExtraData['embed']) ) |
| [1040](#L1040) | $iframe\_src = $ExtraData['embed']; |
| [1041](#L1041) | else |
| [1042](#L1042) | $iframe\_src = powerpress\_generate\_embed($player, $ExtraData); |
| [1043](#L1043) | $return .= '<p class="powerpress\_embed\_box" id="powerpress\_embed\_'. "{$ExtraData['id']}-{$ExtraData['feed']}" .'" style="display: none;">'; |
| [1044](#L1044) | $return .= '<input id="powerpress\_embed\_'. "{$ExtraData['id']}-{$ExtraData['feed']}" .'\_t" type="text" value="'. htmlspecialchars(str\_replace("&amp;", "&", $iframe\_src)) .'" onclick="javascript: this.select();" onfocus="javascript: this.select();" style="width: 70%;" readOnly>'; |
| [1045](#L1045) | $return .= '</p>'; |
| [1046](#L1046) | } |
| [1047](#L1047) | return $return; |
| [1048](#L1048) | } |
| [1049](#L1049) | return ''; |
| [1050](#L1050) | } |
| [1051](#L1051) |  |
| [1052](#L1052) | add\_filter('powerpress\_player\_links', 'powerpressplayer\_link\_pinw', 30, 3); |
| [1053](#L1053) | add\_filter('powerpress\_player\_links', 'powerpressplayer\_link\_download', 50, 3); |
| [1054](#L1054) | add\_filter('powerpress\_player\_links', 'powerpressplayer\_link\_embed', 50, 3); |
| [1055](#L1055) | add\_filter('powerpress\_player\_links', 'powerpressplayer\_link\_title', 1000, 3); |
| [1056](#L1056) |  |
| [1057](#L1057) | /\* |
| [1058](#L1058) | Do Play in new Window |
| [1059](#L1059) | \*/ |
| [1060](#L1060) | function powerpress\_do\_pinw($pinw, $process\_podpress) |
| [1061](#L1061) | { |
| [1062](#L1062) | if( !WP\_DEBUG && defined('POWERPRESS\_FIX\_WARNINGS') ) |
| [1063](#L1063) | { |
| [1064](#L1064) | @error\_reporting( E\_ALL | E\_CORE\_ERROR | E\_COMPILE\_ERROR  | E\_PARSE ); |
| [1065](#L1065) | } |
| [1066](#L1066) |  |
| [1067](#L1067) | list($post\_id, $feed\_slug) = explode('-', $pinw, 2); |
| [1068](#L1068) | $EpisodeData = powerpress\_get\_enclosure\_data($post\_id, $feed\_slug); |
| [1069](#L1069) |  |
| [1070](#L1070) | if( $EpisodeData == false && $process\_podpress && $feed\_slug == 'podcast' ) |
| [1071](#L1071) | { |
| [1072](#L1072) | $EpisodeData = powerpress\_get\_enclosure\_data\_podpress($post\_id); |
| [1073](#L1073) | } |
| [1074](#L1074) |  |
| [1075](#L1075) | $GeneralSettings = get\_option('powerpress\_general'); |
| [1076](#L1076) |  |
| [1077](#L1077) | echo '<!DOCTYPE html>'; // HTML5! |
| [1078](#L1078) | ?> |
| [1079](#L1079) | <html xmlns="http://www.w3.org/1999/xhtml"> |
| [1080](#L1080) | <head> |
| [1081](#L1081) | <meta http-equiv="Content-Type" content="<?php bloginfo('html\_type'); ?>; charset=<?php bloginfo('charset'); ?>" /> |
| [1082](#L1082) | <title><?php echo \_\_('Blubrry PowerPress Player', 'powerpress'); ?></title> |
| [1083](#L1083) | <meta name="robots" content="noindex" /> |
| [1084](#L1084) | <?php |
| [1085](#L1085) | do\_action('wp\_powerpress\_player\_scripts'); |
| [1086](#L1086) | ?> |
| [1087](#L1087) | <style type="text/css"> |
| [1088](#L1088) | body { font-size: 13px; font-family: Arial, Helvetica, sans-serif; /\* width: 100%; min-height: 100%; } html { height: 100%; \*/ } |
| [1089](#L1089) | </style> |
| [1090](#L1090) | </head> |
| [1091](#L1091) | <body> |
| [1092](#L1092) | <div style="margin: 5px;"> |
| [1093](#L1093) | <?php |
| [1094](#L1094) |  |
| [1095](#L1095) | if( !$EpisodeData ) |
| [1096](#L1096) | { |
| [1097](#L1097) | echo '<p>'.  \_\_('Unable to retrieve media information.', 'powerpress') .'</p>'; |
| [1098](#L1098) | } |
| [1099](#L1099) | else if( !empty($GeneralSettings['premium\_caps']) && !powerpress\_premium\_content\_authorized($feed\_slug) ) |
| [1100](#L1100) | { |
| [1101](#L1101) | echo powerpress\_premium\_content\_message($post\_id, $feed\_slug, $EpisodeData); |
| [1102](#L1102) | } |
| [1103](#L1103) | else if( !empty($EpisodeData['embed']) ) |
| [1104](#L1104) | { |
| [1105](#L1105) | echo $EpisodeData['embed']; |
| [1106](#L1106) | } |
| [1107](#L1107) | else //  if( !isset($EpisodeData['no\_player']) ) // Even if there is no player set, if the play in new window option is enabled then it should play here... |
| [1108](#L1108) | { |
| [1109](#L1109) | echo apply\_filters('powerpress\_player', '', powerpress\_add\_flag\_to\_redirect\_url($EpisodeData['url'], 'p'), array('feed'=>$feed\_slug, 'autoplay'=>true, 'type'=>$EpisodeData['type']) ); |
| [1110](#L1110) | } |
| [1111](#L1111) |  |
| [1112](#L1112) | wp\_print\_styles(); |
| [1113](#L1113) | wp\_print\_scripts(); |
| [1114](#L1114) | ?> |
| [1115](#L1115) | </div> |
| [1116](#L1116) | </body> |
| [1117](#L1117) | </html> |
| [1118](#L1118) | <?php |
| [1119](#L1119) | exit; |
| [1120](#L1120) | } |
| [1121](#L1121) |  |
| [1122](#L1122) | /\* |
| [1123](#L1123) | Do embed |
| [1124](#L1124) | \*/ |
| [1125](#L1125) | function powerpress\_do\_embed($player, $embed, $process\_podpress) |
| [1126](#L1126) | { |
| [1127](#L1127) | list($post\_id, $feed\_slug) = explode('-', $embed, 2); |
| [1128](#L1128) | $EpisodeData = powerpress\_get\_enclosure\_data($post\_id, $feed\_slug); |
| [1129](#L1129) |  |
| [1130](#L1130) | if( $EpisodeData == false && $process\_podpress && $feed\_slug == 'podcast' ) |
| [1131](#L1131) | { |
| [1132](#L1132) | $EpisodeData = powerpress\_get\_enclosure\_data\_podpress($post\_id); |
| [1133](#L1133) | } |
| [1134](#L1134) |  |
| [1135](#L1135) | // Embeds are only available for the following players |
| [1136](#L1136) | do\_powerpressplayer\_embed($player, htmlspecialchars($EpisodeData['url']), $EpisodeData); |
| [1137](#L1137) | exit; |
| [1138](#L1138) | } |
| [1139](#L1139) |  |
| [1140](#L1140) | /\* |
| [1141](#L1141) | HTTML 5 Video Player |
| [1142](#L1142) | \*/ |
| [1143](#L1143) | function powerpressplayer\_build\_html5video($media\_url, $EpisodeData=array(), $embed = false ) |
| [1144](#L1144) | { |
| [1145](#L1145) | $player\_id = powerpressplayer\_get\_next\_id(); |
| [1146](#L1146) | $cover\_image = ''; |
| [1147](#L1147) | $player\_width = 400; |
| [1148](#L1148) | $player\_height = 225; |
| [1149](#L1149) | $autoplay = false; |
| [1150](#L1150) | // Global Settings |
| [1151](#L1151) | $Settings = get\_option('powerpress\_general'); |
| [1152](#L1152) | if( !empty($Settings['player\_width']) ) |
| [1153](#L1153) | $player\_width = $Settings['player\_width']; |
| [1154](#L1154) | if( !empty($Settings['player\_height']) ) |
| [1155](#L1155) | $player\_height = $Settings['player\_height']; |
| [1156](#L1156) | if( !empty($Settings['poster\_image']) ) |
| [1157](#L1157) | $cover\_image = $Settings['poster\_image']; |
| [1158](#L1158) | // Episode Settings |
| [1159](#L1159) | if( !empty($EpisodeData['image']) ) |
| [1160](#L1160) | $cover\_image = $EpisodeData['image']; |
| [1161](#L1161) | if( !empty($EpisodeData['width']) ) |
| [1162](#L1162) | $player\_width = $EpisodeData['width']; |
| [1163](#L1163) | if( !empty($EpisodeData['height']) ) |
| [1164](#L1164) | $player\_height = $EpisodeData['height']; |
| [1165](#L1165) | if( !empty($EpisodeData['autoplay']) ) |
| [1166](#L1166) | $autoplay = true; |
| [1167](#L1167) |  |
| [1168](#L1168) | $content = ''; |
| [1169](#L1169) | if( $embed ) |
| [1170](#L1170) | { |
| [1171](#L1171) | $content .= '<div class="powerpress\_player" id="powerpress\_player\_'. $player\_id .'">'.PHP\_EOL\_WEB; |
| [1172](#L1172) | $content .= '<video width="'. htmlspecialchars($player\_width) .'" height="'. htmlspecialchars($player\_height) .'" controls="controls"'; |
| [1173](#L1173) | if( $cover\_image ) |
| [1174](#L1174) | $content .= ' poster="'. htmlspecialchars($cover\_image) .'"'; |
| [1175](#L1175) | if( $autoplay ) |
| [1176](#L1176) | $content .= ' autoplay="autoplay"'; |
| [1177](#L1177) | else |
| [1178](#L1178) | $content .= ' preload="none"'; |
| [1179](#L1179) |  |
| [1180](#L1180) | $content .= '>'.PHP\_EOL\_WEB; |
| [1181](#L1181) | $content\_type = powerpress\_get\_contenttype($media\_url); |
| [1182](#L1182) | $content .='<source src="'. htmlspecialchars($media\_url) .'" type="'. $content\_type .'" />'; |
| [1183](#L1183) |  |
| [1184](#L1184) | if( !empty($EpisodeData['webm\_src']) ) |
| [1185](#L1185) | { |
| [1186](#L1186) | $EpisodeData['webm\_src'] = powerpress\_add\_flag\_to\_redirect\_url($EpisodeData['webm\_src'], 'p'); |
| [1187](#L1187) | $content .='<source src="'. htmlspecialchars($EpisodeData['webm\_src']) .'" type="video/webm" />'; |
| [1188](#L1188) | } |
| [1189](#L1189) |  |
| [1190](#L1190) | $content .= powerpressplayer\_build\_playimage($media\_url, $EpisodeData); |
| [1191](#L1191) | $content .= '</video>'.PHP\_EOL\_WEB; |
| [1192](#L1192) | $content .= '</div>'.PHP\_EOL\_WEB; |
| [1193](#L1193) | } |
| [1194](#L1194) | else |
| [1195](#L1195) | { |
| [1196](#L1196) |  |
| [1197](#L1197) | if( !$cover\_image ) |
| [1198](#L1198) | $cover\_image = powerpress\_get\_root\_url() . 'black.png'; |
| [1199](#L1199) | $webm\_src = ''; |
| [1200](#L1200) | if( !empty($EpisodeData['webm\_src']) ) |
| [1201](#L1201) | $webm\_src = powerpress\_add\_flag\_to\_redirect\_url($EpisodeData['webm\_src'], 'p'); |
| [1202](#L1202) | $content .= '<div class="powerpress\_player" id="powerpress\_player\_'. $player\_id .'">'; |
| [1203](#L1203) | $content .= '<a href="'. htmlspecialchars($media\_url) .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" onclick="return powerpress\_embed\_html5v(\''.$player\_id.'\',\''.htmlspecialchars($media\_url).'\',\''. htmlspecialchars($player\_width) .'\',\''. htmlspecialchars($player\_height) .'\', \''. htmlspecialchars($webm\_src) .'\');" target="\_blank" style="position: relative;">'; |
| [1204](#L1204) | if( !empty($EpisodeData['custom\_play\_button']) ) // This currently does not apply |
| [1205](#L1205) | { |
| [1206](#L1206) | $cover\_image = $EpisodeData['custom\_play\_button']; |
| [1207](#L1207) | $Settings['poster\_play\_image'] = false; |
| [1208](#L1208) | $content .= '<img class="powerpress-player-poster" src="'. htmlspecialchars($cover\_image) .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" alt="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" />'; |
| [1209](#L1209) | } |
| [1210](#L1210) | else |
| [1211](#L1211) | { |
| [1212](#L1212) | $content .= '<img class="powerpress-player-poster" src="'. htmlspecialchars($cover\_image) .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" alt="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" style="width: '. htmlspecialchars($player\_width) .'px; height: '. htmlspecialchars($player\_height) .'px;" />'; |
| [1213](#L1213) | } |
| [1214](#L1214) |  |
| [1215](#L1215) | if(!isset($Settings['poster\_play\_image']) || $Settings['poster\_play\_image'] ) |
| [1216](#L1216) | { |
| [1217](#L1217) | $play\_image\_button\_url = powerpress\_get\_root\_url() .'play\_video.png'; |
| [1218](#L1218) | if( !empty($Settings['video\_custom\_play\_button']) ) |
| [1219](#L1219) | $play\_image\_button\_url = $Settings['video\_custom\_play\_button']; |
| [1220](#L1220) |  |
| [1221](#L1221) | $bottom = floor(($player\_height/2)-30); |
| [1222](#L1222) | if( $bottom < 0 ) |
| [1223](#L1223) | $bottom = 0; |
| [1224](#L1224) | $left = floor(($player\_width/2)-30); |
| [1225](#L1225) | if( $left < 0 ) |
| [1226](#L1226) | $left = 0; |
| [1227](#L1227) | $content .= '<img class="powerpress-player-play-image" src="'. htmlspecialchars($play\_image\_button\_url) .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" alt="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" style="position: absolute; bottom: '. $bottom .'px; left: '. $left .'px; border:0;" />'; |
| [1228](#L1228) | } |
| [1229](#L1229) | $content .= '</a>'; |
| [1230](#L1230) | $content .= "</div>\n"; |
| [1231](#L1231) |  |
| [1232](#L1232) | if( $autoplay ) |
| [1233](#L1233) | { |
| [1234](#L1234) | $content .= '<script type="text/javascript"><!--'.PHP\_EOL; |
| [1235](#L1235) | $content .= "powerpress\_embed\_html5v('{$player\_id}','" . htmlspecialchars($media\_url) . "'," . htmlspecialchars($player\_width) . "," . htmlspecialchars($player\_height) . ",'" . htmlspecialchars($webm\_src) . "');\n"; |
| [1236](#L1236) | $content .= "//-->\n"; |
| [1237](#L1237) | $content .= "</script>\n"; |
| [1238](#L1238) | } |
| [1239](#L1239) | } |
| [1240](#L1240) | return $content; |
| [1241](#L1241) | } |
| [1242](#L1242) |  |
| [1243](#L1243) | /\* |
| [1244](#L1244) | MediaElement.js Video Player |
| [1245](#L1245) | \*/ |
| [1246](#L1246) | function powerpressplayer\_build\_mediaelementvideo($media\_url, $EpisodeData=array(), $embed = false ) |
| [1247](#L1247) | { |
| [1248](#L1248) | if( !function\_exists('wp\_video\_shortcode') ) |
| [1249](#L1249) | { |
| [1250](#L1250) | // Return the HTML5 video shortcode instead |
| [1251](#L1251) | return powerpressplayer\_build\_html5video($media\_url, $EpisodeData, $embed); |
| [1252](#L1252) | } |
| [1253](#L1253) |  |
| [1254](#L1254) | $player\_id = powerpressplayer\_get\_next\_id(); |
| [1255](#L1255) | $cover\_image = ''; |
| [1256](#L1256) | $player\_width = ''; |
| [1257](#L1257) | $player\_height = ''; |
| [1258](#L1258) | $autoplay = false; |
| [1259](#L1259) | // Global Settings |
| [1260](#L1260) | $Settings = get\_option('powerpress\_general'); |
| [1261](#L1261) | if( !empty($Settings['player\_width']) ) |
| [1262](#L1262) | $player\_width = $Settings['player\_width']; |
| [1263](#L1263) | if( !empty($Settings['player\_height']) ) |
| [1264](#L1264) | $player\_height = $Settings['player\_height']; |
| [1265](#L1265) | if( !empty($Settings['poster\_image']) ) |
| [1266](#L1266) | $cover\_image = $Settings['poster\_image']; |
| [1267](#L1267) | // Episode Settings |
| [1268](#L1268) | if( !empty($EpisodeData['image']) ) |
| [1269](#L1269) | $cover\_image = $EpisodeData['image']; |
| [1270](#L1270) | if( !empty($EpisodeData['width']) ) |
| [1271](#L1271) | $player\_width = $EpisodeData['width']; |
| [1272](#L1272) | if( !empty($EpisodeData['height']) ) |
| [1273](#L1273) | $player\_height = $EpisodeData['height']; |
| [1274](#L1274) | if( !empty($EpisodeData['autoplay']) ) |
| [1275](#L1275) | $autoplay = true; |
| [1276](#L1276) |  |
| [1277](#L1277) | if( $embed ) |
| [1278](#L1278) | { |
| [1279](#L1279) | $player\_height = '123'; |
| [1280](#L1280) | $player\_width = '456'; |
| [1281](#L1281) | } |
| [1282](#L1282) |  |
| [1283](#L1283) |  |
| [1284](#L1284) | $content = ''; |
| [1285](#L1285) |  |
| [1286](#L1286) | $content .= '<div class="powerpress\_player" id="powerpress\_player\_'. $player\_id .'">'.PHP\_EOL\_WEB; |
| [1287](#L1287) | $attr = array('src'=>htmlspecialchars($media\_url), 'poster'=>'', 'loop'=>'', 'autoplay'=>'', 'preload'=>'none'); // , 'width'=>'', 'height'=>''); |
| [1288](#L1288) | if( !empty($player\_width) ) |
| [1289](#L1289) | $attr['width'] = $player\_width; |
| [1290](#L1290) | if( !empty($player\_height) ) |
| [1291](#L1291) | $attr['height'] = $player\_height; |
| [1292](#L1292) | if( !empty($cover\_image) ) |
| [1293](#L1293) | $attr['poster'] = htmlspecialchars($cover\_image); |
| [1294](#L1294) | if( !empty($autoplay) ) |
| [1295](#L1295) | $attr['autoplay'] = 'on'; |
| [1296](#L1296) | if( !empty($EpisodeData['webm\_src']) ) |
| [1297](#L1297) | $attr['webm'] = powerpress\_add\_flag\_to\_redirect\_url($EpisodeData['webm\_src'], 'p'); |
| [1298](#L1298) |  |
| [1299](#L1299) | // Double check that WordPress is providing the shortcode... |
| [1300](#L1300) | global $shortcode\_tags; |
| [1301](#L1301) | if( !defined('POWERPRESS\_DO\_SHORTCODE') ) { |
| [1302](#L1302) | $shortcode = wp\_video\_shortcode( $attr ); |
| [1303](#L1303) | } else { |
| [1304](#L1304) | $shortcode\_value = '[video '; |
| [1305](#L1305) | foreach( $attr as $tag\_name => $tag\_value ) { |
| [1306](#L1306) | $shortcode\_value .= ' '.esc\_attr($tag\_name).'="'. esc\_attr($tag\_value) .'"'; |
| [1307](#L1307) | } |
| [1308](#L1308) | $shortcode\_value .= ']'; |
| [1309](#L1309) | $shortcode .= do\_shortcode($shortcode\_value); |
| [1310](#L1310) | } |
| [1311](#L1311) |  |
| [1312](#L1312) |  |
| [1313](#L1313) | if( $embed ) |
| [1314](#L1314) | { |
| [1315](#L1315) | $shortcode = str\_replace( array('"123"', '"456"', '456px;'), array('"100%"', '"100%"', '100%;'), $shortcode); |
| [1316](#L1316) | } |
| [1317](#L1317) | $content .= $shortcode; |
| [1318](#L1318) | $content .= '</div>'.PHP\_EOL\_WEB; |
| [1319](#L1319) | return $content; |
| [1320](#L1320) | } |
| [1321](#L1321) |  |
| [1322](#L1322) | /\* |
| [1323](#L1323) | HTTML 5 Audio Player |
| [1324](#L1324) | \*/ |
| [1325](#L1325) | function powerpressplayer\_build\_html5audio($media\_url, $EpisodeData=array(), $embed = false ) |
| [1326](#L1326) | { |
| [1327](#L1327) | $player\_id = powerpressplayer\_get\_next\_id(); |
| [1328](#L1328) | $autoplay = false; |
| [1329](#L1329) | // Episode Settings |
| [1330](#L1330) | if( !empty($EpisodeData['autoplay']) ) |
| [1331](#L1331) | $autoplay = true; |
| [1332](#L1332) | $content = ''; |
| [1333](#L1333) | if( $embed ) |
| [1334](#L1334) | { |
| [1335](#L1335) | $content .= '<div class="powerpress\_player" id="powerpress\_player\_'. $player\_id .'">'.PHP\_EOL\_WEB; |
| [1336](#L1336) | $content .= '<audio controls="controls"'; |
| [1337](#L1337) | $content .=' src="'. htmlspecialchars($media\_url) .'"'; |
| [1338](#L1338) | if( $autoplay ) |
| [1339](#L1339) | $content .= ' autoplay="autoplay"'; |
| [1340](#L1340) | else |
| [1341](#L1341) | $content .= ' preload="none"'; |
| [1342](#L1342) | $content .= '>'.PHP\_EOL\_WEB; |
| [1343](#L1343) |  |
| [1344](#L1344) | $content .= powerpressplayer\_build\_playimageaudio($media\_url); |
| [1345](#L1345) | $content .= '</audio>'.PHP\_EOL\_WEB; |
| [1346](#L1346) | $content .= '</div>'.PHP\_EOL\_WEB; |
| [1347](#L1347) | } |
| [1348](#L1348) | else |
| [1349](#L1349) | { |
| [1350](#L1350) | $GeneralSettings = get\_option('powerpress\_general'); |
| [1351](#L1351) | $cover\_image = powerpress\_get\_root\_url() . 'play\_audio.png'; |
| [1352](#L1352) | $cover\_image\_default = $cover\_image; |
| [1353](#L1353) | if( !empty($EpisodeData['custom\_play\_button']) ) |
| [1354](#L1354) | { |
| [1355](#L1355) | $cover\_image = $EpisodeData['custom\_play\_button']; |
| [1356](#L1356) | } |
| [1357](#L1357) | else if( !empty($GeneralSettings['audio\_custom\_play\_button']) ) |
| [1358](#L1358) | { |
| [1359](#L1359) | $cover\_image = $GeneralSettings['audio\_custom\_play\_button']; |
| [1360](#L1360) | } |
| [1361](#L1361) |  |
| [1362](#L1362) | $content .= '<div class="powerpress\_player" id="powerpress\_player\_'. $player\_id .'">'; |
| [1363](#L1363) | $content .= '<a href="'. htmlspecialchars($media\_url) .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" onclick="return powerpress\_embed\_html5a(\''.$player\_id.'\',\''.htmlspecialchars($media\_url).'\');" target="\_blank">'; |
| [1364](#L1364) | if( $cover\_image\_default == $cover\_image ) |
| [1365](#L1365) | $content .= '<img src="'. htmlspecialchars($cover\_image) .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" alt="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" style="border:0;" width="23px" height="24px" />'; |
| [1366](#L1366) | else |
| [1367](#L1367) | $content .= '<img src="'. htmlspecialchars($cover\_image) .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" alt="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" style="border:0;" />'; |
| [1368](#L1368) | $content .= '</a>'; |
| [1369](#L1369) | $content .= "</div>\n"; |
| [1370](#L1370) |  |
| [1371](#L1371) | if( $autoplay ) |
| [1372](#L1372) | { |
| [1373](#L1373) | $content .= '<script type="text/javascript"><!--'.PHP\_EOL; |
| [1374](#L1374) | $content .= "powerpress\_embed\_html5a('{$player\_id}','" . htmlspecialchars($media\_url) . "');\n"; |
| [1375](#L1375) | $content .= "//-->\n"; |
| [1376](#L1376) | $content .= "</script>\n"; |
| [1377](#L1377) | } |
| [1378](#L1378) | } |
| [1379](#L1379) |  |
| [1380](#L1380) | return $content; |
| [1381](#L1381) | } |
| [1382](#L1382) |  |
| [1383](#L1383) |  |
| [1384](#L1384) | /\* |
| [1385](#L1385) | \*/ |
| [1386](#L1386) | function powerpressplayer\_build\_blubrryaudio($media\_url, $EpisodeData=array(), $embed = false ) |
| [1387](#L1387) | { |
| [1388](#L1388) | static $instance = 0; |
| [1389](#L1389) | $instance++; |
| [1390](#L1390) |  |
| [1391](#L1391) | // media URL is all we need., as long as it's hosted at blubrry.com... |
| [1392](#L1392) | if( preg\_match('/(content|protected|ins|mc)\.blubrry\.com/', $media\_url) ) |
| [1393](#L1393) | { |
| [1394](#L1394) | $GeneralSettings = get\_option('powerpress\_general'); |
| [1395](#L1395) | $playerSettings = get\_option('powerpress\_bplayer'); |
| [1396](#L1396) | $hash = ''; |
| [1397](#L1397) | if(!empty($playerSettings)){ |
| [1398](#L1398) | if(is\_string($playerSettings)){ |
| [1399](#L1399) | $decodedSettings = json\_decode($playerSettings); |
| [1400](#L1400) |  |
| [1401](#L1401) | if($decodedSettings && isset($decodedSettings->mode) && isset($decodedSettings->border) && isset($decodedSettings->progress)){ |
| [1402](#L1402) | $hash = 'mode-' . $decodedSettings->mode . '&border-' . $decodedSettings->border . '&progress-' . $decodedSettings->progress; |
| [1403](#L1403) | $hash = str\_replace('#', '', $hash);  // remove # symbol from hex colors |
| [1404](#L1404) | $hash = '#' . $hash; |
| [1405](#L1405) |  |
| [1406](#L1406) | } else { |
| [1407](#L1407) | $hash = '#mode-Light&border-000000&progress-000000'; |
| [1408](#L1408) | } |
| [1409](#L1409) | } else { |
| [1410](#L1410) | $hash = '#mode-Light&border-000000&progress-000000'; |
| [1411](#L1411) | } |
| [1412](#L1412) | } |
| [1413](#L1413) |  |
| [1414](#L1414) | if( !empty($EpisodeData['podcast\_id']) ) { |
| [1415](#L1415) | $url = 'https://player.blubrry.com/?podcast\_id='. intval($EpisodeData['podcast\_id']) . '&amp;media\_url='. urlencode($media\_url); |
| [1416](#L1416) | if ($GeneralSettings['player'] == 'blubrrymodern') { |
| [1417](#L1417) | $url .= '&amp;modern=1'; |
| [1418](#L1418) | } |
| [1419](#L1419) | } else { |
| [1420](#L1420) | $url = 'https://player.blubrry.com/?media\_url='. urlencode($media\_url); |
| [1421](#L1421) | if ($GeneralSettings['player'] == 'blubrrymodern') { |
| [1422](#L1422) | $url .= '&amp;modern=1'; |
| [1423](#L1423) | } |
| [1424](#L1424) | if( !empty($EpisodeData['id']) ) { |
| [1425](#L1425) | // Get permalink URL |
| [1426](#L1426) | $permalink = get\_permalink( $EpisodeData['id'] ); |
| [1427](#L1427) | if( !empty($permalink) ) |
| [1428](#L1428) | $url.= '&amp;podcast\_link='. urlencode($permalink); |
| [1429](#L1429) | } |
| [1430](#L1430) | if( !empty($EpisodeData['itunes\_image']) ) { |
| [1431](#L1431) | if(isset($GeneralSettings['bp\_episode\_image']) && $GeneralSettings['bp\_episode\_image'] != false) |
| [1432](#L1432) | $url.= '&amp;artwork\_url='. urlencode($EpisodeData['itunes\_image']); |
| [1433](#L1433) | } |
| [1434](#L1434) |  |
| [1435](#L1435) | } |
| [1436](#L1436) | $url = $url.$hash; |
| [1437](#L1437) | $playerID = sprintf('blubrryplayer-%d', $instance); |
| [1438](#L1438) |  |
| [1439](#L1439) | $feedSlug = 'podcast'; |
| [1440](#L1440) | if( !empty($EpisodeData['feed']) ) |
| [1441](#L1441) | $feedSlug = $EpisodeData['feed']; |
| [1442](#L1442) |  |
| [1443](#L1443) | if( empty($GLOBALS['powerpress\_skipto\_player'][ get\_the\_ID() ][ $feedSlug ] ) ) |
| [1444](#L1444) | $GLOBALS['powerpress\_skipto\_player'][ get\_the\_ID() ][ $feedSlug ] = $playerID; |
| [1445](#L1445) |  |
| [1446](#L1446) | $iframeTitle = esc\_attr( \_\_('Blubrry Podcast Player', 'powerpress') ); |
| [1447](#L1447) |  |
| [1448](#L1448) | // 'sample' signifies that this player is appearing inside the block editor and therefore requires the sandbox attribute to render |
| [1449](#L1449) | if (!empty($EpisodeData['sample'])) { |
| [1450](#L1450) | return '<iframe sandbox="allow-scripts allow-popups allow-forms" src="' . $url . '" scrolling="no" width="100%" height="165" frameborder="0" id="' . $playerID . '" class="blubrryplayer" title="' . $iframeTitle . '"></iframe>'; |
| [1451](#L1451) | } else { |
| [1452](#L1452) | return '<iframe src="' . $url . '" scrolling="no" width="100%" height="165" frameborder="0" id="' . $playerID . '" class="blubrryplayer" title="' . $iframeTitle . '"></iframe>'; |
| [1453](#L1453) | } |
| [1454](#L1454) | } |
| [1455](#L1455) |  |
| [1456](#L1456) | return powerpressplayer\_build\_mediaelementaudio($media\_url, $EpisodeData, $embed); |
| [1457](#L1457) | } |
| [1458](#L1458) |  |
| [1459](#L1459) | function powerpressplayer\_build\_blubrryaudio\_by\_id($playerSettings = false){ |
| [1460](#L1460) | $local = (strpos($\_SERVER['HTTP\_HOST'], '.local') !== false); |
| [1461](#L1461) | $playerUrl = ($local ? 'http://player.blubrry.local' : 'https://player.blubrry.com'); |
| [1462](#L1462) | $directory\_episode\_id = ($local ? 12559710 : 80155910); |
| [1463](#L1463) | $playerUrlSrc = $playerUrl . '/?id=' . $directory\_episode\_id . '&preview=1&cache=' . time(); |
| [1464](#L1464) | if(!empty($playerSettings)){ |
| [1465](#L1465) | $playerUrlSrc .= '#mode-' . str\_replace('#', '', $playerSettings->mode) . '&border-' . str\_replace('#', '', $playerSettings->border) . '&progress-' . str\_replace('#', '', $playerSettings->progress); |
| [1466](#L1466) | } |
| [1467](#L1467) |  |
| [1468](#L1468) | $iframeTitle = esc\_attr(\_\_('Modern Blubrry Player', 'powerpress')); |
| [1469](#L1469) | return '<iframe src="' . $playerUrlSrc . '" id="playeriframe" class="" scrolling="yes" width="100%" height="165px" frameborder="0" title="' . $iframeTitle . '"></iframe>'; |
| [1470](#L1470) | } |
| [1471](#L1471) |  |
| [1472](#L1472) | /\* |
| [1473](#L1473) | MediaElement.js Audio Player |
| [1474](#L1474) | \*/ |
| [1475](#L1475) | function powerpressplayer\_build\_mediaelementaudio($media\_url, $EpisodeData=array(), $embed = false ) |
| [1476](#L1476) | { |
| [1477](#L1477) | if( !function\_exists('wp\_audio\_shortcode') ) |
| [1478](#L1478) | { |
| [1479](#L1479) | // Return the HTML5 audio shortcode instead |
| [1480](#L1480) | return powerpressplayer\_build\_html5audio($media\_url, $EpisodeData, $embed); |
| [1481](#L1481) | } |
| [1482](#L1482) |  |
| [1483](#L1483) | $player\_id = powerpressplayer\_get\_next\_id(); |
| [1484](#L1484) | $autoplay = false; |
| [1485](#L1485) | // Episode Settings |
| [1486](#L1486) | if( !empty($EpisodeData['autoplay']) ) |
| [1487](#L1487) | $autoplay = true; |
| [1488](#L1488) | $content = ''; |
| [1489](#L1489) |  |
| [1490](#L1490) |  |
| [1491](#L1491) | $content .= '<div class="powerpress\_player" id="powerpress\_player\_'. $player\_id .'">'.PHP\_EOL\_WEB; |
| [1492](#L1492) |  |
| [1493](#L1493) | $attr = array( |
| [1494](#L1494) | 'src'      => htmlspecialchars($media\_url), |
| [1495](#L1495) | 'loop'     => '', // off |
| [1496](#L1496) | 'autoplay' => ( $autoplay ?'on':''), |
| [1497](#L1497) | 'preload'  => 'none' |
| [1498](#L1498) | ); |
| [1499](#L1499) |  |
| [1500](#L1500) | // Double check that WordPress is providing the shortcode... |
| [1501](#L1501) | global $shortcode\_tags; |
| [1502](#L1502) | $player = ''; |
| [1503](#L1503) | if( !defined('POWERPRESS\_DO\_SHORTCODE') ) { // && !empty($shortcode\_tags['audio']) && is\_string($shortcode\_tags['audio']) && $shortcode\_tags['audio'] == 'wp\_audio\_shortcode' ) { |
| [1504](#L1504) | $player .= wp\_audio\_shortcode( $attr ); |
| [1505](#L1505) | } else { |
| [1506](#L1506) | $player .= do\_shortcode( '[audio src="'.  esc\_attr($media\_url) .'" autoplay="'. ( $autoplay ?'on':'') .'" loop="" preload="none"]'); |
| [1507](#L1507) | } |
| [1508](#L1508) |  |
| [1509](#L1509) | // Get the DIV id for this element |
| [1510](#L1510) | $feedSlug = 'podcast'; |
| [1511](#L1511) | if( !empty($EpisodeData['feed']) ) |
| [1512](#L1512) | $feedSlug = $EpisodeData['feed']; |
| [1513](#L1513) |  |
| [1514](#L1514) | if( empty($GLOBALS['powerpress\_skipto\_player'][ get\_the\_ID() ][ $feedSlug ]) && preg\_match('/\<audio.\*id="([^"]\*)"/i', $player, $matches) ) { |
| [1515](#L1515) | $GLOBALS['powerpress\_skipto\_player'][ get\_the\_ID() ][ $feedSlug ] = $matches[1]; |
| [1516](#L1516) | } |
| [1517](#L1517) |  |
| [1518](#L1518) | $content .= $player .'</div>'.PHP\_EOL\_WEB; |
| [1519](#L1519) | return $content; |
| [1520](#L1520) | } |
| [1521](#L1521) |  |
| [1522](#L1522) |  |
| [1523](#L1523) | function powerpressplayer\_build\_playimage($media\_url, $EpisodeData = array(), $include\_div = false) |
| [1524](#L1524) | { |
| [1525](#L1525) | $content = ''; |
| [1526](#L1526) | $autoplay = false; |
| [1527](#L1527) | if( !empty($EpisodeData['autoplay']) && $EpisodeData['autoplay'] ) |
| [1528](#L1528) | $autoplay = true; |
| [1529](#L1529) | $player\_width = 400; |
| [1530](#L1530) | $player\_height = 225; |
| [1531](#L1531) | $cover\_image = ''; |
| [1532](#L1532) | // Global settings |
| [1533](#L1533) | $Settings = get\_option('powerpress\_general'); |
| [1534](#L1534) | if( !empty($Settings['player\_width']) ) |
| [1535](#L1535) | $player\_width = $Settings['player\_width']; |
| [1536](#L1536) | if( !empty($Settings['player\_height']) ) |
| [1537](#L1537) | $player\_height = $Settings['player\_height']; |
| [1538](#L1538) | if( !empty($Settings['poster\_image']) ) |
| [1539](#L1539) | $cover\_image = $Settings['poster\_image']; |
| [1540](#L1540) | // episode settings |
| [1541](#L1541) | if( !empty($EpisodeData['width']) ) |
| [1542](#L1542) | $player\_width = $EpisodeData['width']; |
| [1543](#L1543) | if( !empty($EpisodeData['height']) ) |
| [1544](#L1544) | $player\_height = $EpisodeData['height']; |
| [1545](#L1545) | if( !empty($EpisodeData['image']) ) |
| [1546](#L1546) | $cover\_image = $EpisodeData['image']; |
| [1547](#L1547) |  |
| [1548](#L1548) | if( !$cover\_image ) |
| [1549](#L1549) | $cover\_image = powerpress\_get\_root\_url() . 'black.png'; |
| [1550](#L1550) |  |
| [1551](#L1551) | if( $include\_div ) |
| [1552](#L1552) | $content .= '<div class="powerpress\_player" id="powerpress\_player\_'. powerpressplayer\_get\_next\_id() .'">'; |
| [1553](#L1553) | $content .= '<a href="'. htmlspecialchars($media\_url) .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" target="\_blank" style="position: relative;">'; |
| [1554](#L1554) | $content .= '<img src="'. htmlspecialchars($cover\_image) .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" alt="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" style="width: '. htmlspecialchars($player\_width) .'px; height: '. htmlspecialchars($player\_height) .'px;" />'; |
| [1555](#L1555) | if(!isset($Settings['poster\_play\_image']) || $Settings['poster\_play\_image'] ) |
| [1556](#L1556) | { |
| [1557](#L1557) | $play\_image\_button\_url = powerpress\_get\_root\_url() .'play\_video.png'; |
| [1558](#L1558) | if( !empty($Settings['video\_custom\_play\_button']) ) |
| [1559](#L1559) | $play\_image\_button\_url = $Settings['video\_custom\_play\_button']; |
| [1560](#L1560) |  |
| [1561](#L1561) | $bottom = floor(($player\_height/2)-30); |
| [1562](#L1562) | if( $bottom < 0 ) |
| [1563](#L1563) | $bottom = 0; |
| [1564](#L1564) | $left = floor(($player\_width/2)-30); |
| [1565](#L1565) | if( $left < 0 ) |
| [1566](#L1566) | $left = 0; |
| [1567](#L1567) | $content .= '<img src="'. htmlspecialchars($play\_image\_button\_url) .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" alt="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" style="position: absolute; bottom:'. $bottom .'px; left:'. $left .'px; border:0;" />'; |
| [1568](#L1568) | } |
| [1569](#L1569) | $content .= '</a>'; |
| [1570](#L1570) | if( $include\_div ) |
| [1571](#L1571) | $content .= "</div>\n"; |
| [1572](#L1572) | return $content; |
| [1573](#L1573) | } |
| [1574](#L1574) |  |
| [1575](#L1575) | function powerpressplayer\_build\_playimageaudio($media\_url, $include\_div = false) |
| [1576](#L1576) | { |
| [1577](#L1577) | $content = ''; |
| [1578](#L1578) | $cover\_image = powerpress\_get\_root\_url() . 'play\_audio.png'; |
| [1579](#L1579) | $GeneralSettings = get\_option('powerpress\_general'); |
| [1580](#L1580) | if( !empty($GeneralSettings['custom\_play\_button']) ) |
| [1581](#L1581) | $cover\_image = $GeneralSettings['custom\_play\_button']; |
| [1582](#L1582) |  |
| [1583](#L1583) | if( $include\_div ) |
| [1584](#L1584) | $content .= '<div class="powerpress\_player" id="powerpress\_player\_'. powerpressplayer\_get\_next\_id() .'">'; |
| [1585](#L1585) | $content .= '<a href="'. htmlspecialchars($media\_url) .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" target="\_blank">'; |
| [1586](#L1586) | $content .= '<img src="'. htmlspecialchars($cover\_image) .'" title="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" alt="'. htmlspecialchars(POWERPRESS\_PLAY\_TEXT) .'" style="border:0;" />'; |
| [1587](#L1587) | $content .= '</a>'; |
| [1588](#L1588) | if( $include\_div ) |
| [1589](#L1589) | $content .= "</div>\n"; |
| [1590](#L1590) | return $content; |
| [1591](#L1591) | } |
| [1592](#L1592) |  |
| [1593](#L1593) | function powerpressplayer\_build\_playimagepdf($media\_url, $include\_div = false) |
| [1594](#L1594) | { |
| [1595](#L1595) | $content = ''; |
| [1596](#L1596) | $cover\_image = powerpress\_get\_root\_url() . 'play\_pdf.png'; |
| [1597](#L1597) | $GeneralSettings = get\_option('powerpress\_general'); |
| [1598](#L1598) | if( !empty($GeneralSettings['pdf\_custom\_play\_button']) ) |
| [1599](#L1599) | $cover\_image = $GeneralSettings['pdf\_custom\_play\_button']; |
| [1600](#L1600) |  |
| [1601](#L1601) | if( $include\_div ) |
| [1602](#L1602) | $content .= '<div class="powerpress\_player" id="powerpress\_player\_'. powerpressplayer\_get\_next\_id() .'">'; |
| [1603](#L1603) | $content .= '<a href="'. htmlspecialchars($media\_url) .'" title="'. htmlspecialchars(POWERPRESS\_READ\_TEXT) .'" target="\_blank">'; |
| [1604](#L1604) | $content .= '<img src="'. htmlspecialchars($cover\_image) .'" title="'. htmlspecialchars(POWERPRESS\_READ\_TEXT) .'" alt="'. htmlspecialchars(POWERPRESS\_READ\_TEXT) .'" style="border:0;" />'; |
| [1605](#L1605) | $content .= '</a>'; |
| [1606](#L1606) | if( $include\_div ) |
| [1607](#L1607) | $content .= "</div>\n"; |
| [1608](#L1608) | return $content; |
| [1609](#L1609) | } |
| [1610](#L1610) |  |
| [1611](#L1611) | function powerpressplayer\_build\_playimageepub($media\_url, $include\_div = false) |
| [1612](#L1612) | { |
| [1613](#L1613) | $content = ''; |
| [1614](#L1614) | $cover\_image = powerpress\_get\_root\_url() . 'play\_epub.png'; |
| [1615](#L1615) | $GeneralSettings = get\_option('powerpress\_general'); |
| [1616](#L1616) | if( !empty($GeneralSettings['epub\_custom\_play\_button']) ) |
| [1617](#L1617) | $cover\_image = $GeneralSettings['epub\_custom\_play\_button']; |
| [1618](#L1618) |  |
| [1619](#L1619) | if( $include\_div ) |
| [1620](#L1620) | $content .= '<div class="powerpress\_player" id="powerpress\_player\_'. powerpressplayer\_get\_next\_id() .'">'; |
| [1621](#L1621) | $content .= '<a href="'. htmlspecialchars($media\_url) .'" title="'. htmlspecialchars(POWERPRESS\_READ\_TEXT) .'" target="\_blank">'; |
| [1622](#L1622) | $content .= '<img src="'. htmlspecialchars($cover\_image) .'" title="'. htmlspecialchars(POWERPRESS\_READ\_TEXT) .'" alt="'. htmlspecialchars(POWERPRESS\_READ\_TEXT) .'" style="border:0;" />'; |
| [1623](#L1623) | $content .= '</a>'; |
| [1624](#L1624) | if( $include\_div ) |
| [1625](#L1625) | $content .= "</div>\n"; |
| [1626](#L1626) | return $content; |
| [1627](#L1627) | } |
| [1628](#L1628) |  |
| [1629](#L1629) | /\* |
| [1630](#L1630) | VideoJS for PowerPress 4.0 |
| [1631](#L1631) | \*/ |
| [1632](#L1632) | function powerpressplayer\_build\_videojs($media\_url, $EpisodeData = array()) |
| [1633](#L1633) | { |
| [1634](#L1634) | $content = ''; |
| [1635](#L1635) | if( function\_exists('add\_videojs\_header') ) |
| [1636](#L1636) | { |
| [1637](#L1637) | // Global Settings |
| [1638](#L1638) | $Settings = get\_option('powerpress\_general'); |
| [1639](#L1639) |  |
| [1640](#L1640) | $player\_id = powerpressplayer\_get\_next\_id(); |
| [1641](#L1641) | $cover\_image = ''; |
| [1642](#L1642) | $player\_width = 400; |
| [1643](#L1643) | $player\_height = 225; |
| [1644](#L1644) | $autoplay = false; |
| [1645](#L1645) |  |
| [1646](#L1646) | if( !empty($Settings['player\_width']) ) |
| [1647](#L1647) | $player\_width = $Settings['player\_width']; |
| [1648](#L1648) | if( !empty($Settings['player\_height']) ) |
| [1649](#L1649) | $player\_height = $Settings['player\_height']; |
| [1650](#L1650) | if( !empty($Settings['poster\_image']) ) |
| [1651](#L1651) | $cover\_image = $Settings['poster\_image']; |
| [1652](#L1652) |  |
| [1653](#L1653) | // Episode Settings |
| [1654](#L1654) | if( !empty($EpisodeData['image']) ) |
| [1655](#L1655) | $cover\_image = $EpisodeData['image']; |
| [1656](#L1656) | if( !empty($EpisodeData['width']) ) |
| [1657](#L1657) | $player\_width = $EpisodeData['width']; |
| [1658](#L1658) | if( !empty($EpisodeData['height']) ) |
| [1659](#L1659) | $player\_height = $EpisodeData['height']; |
| [1660](#L1660) | if( !empty($EpisodeData['autoplay']) ) |
| [1661](#L1661) | $autoplay = true; |
| [1662](#L1662) |  |
| [1663](#L1663) | // Poster image supplied |
| [1664](#L1664) | $poster\_attribute = ''; |
| [1665](#L1665) | if ($cover\_image) |
| [1666](#L1666) | $poster\_attribute = ' poster="'.htmlspecialchars($cover\_image).'"'; |
| [1667](#L1667) |  |
| [1668](#L1668) | // Autoplay the video? |
| [1669](#L1669) | $autoplay\_attribute = ''; |
| [1670](#L1670) | if ( $autoplay ) |
| [1671](#L1671) | $autoplay\_attribute = ' autoplay'; |
| [1672](#L1672) |  |
| [1673](#L1673) | // We never do pre-poading for podcasting as it inflates statistics |
| [1674](#L1674) |  |
| [1675](#L1675) | // Is there a custom class? |
| [1676](#L1676) | $class = ''; |
| [1677](#L1677) | if ( !empty($Settings['videojs\_css\_class']) ) |
| [1678](#L1678) | $class = ' '. htmlspecialchars($Settings['videojs\_css\_class']); |
| [1679](#L1679) |  |
| [1680](#L1680) | $content .= '<div class="powerpress\_player" id="powerpress\_player\_'. $player\_id .'">'; |
| [1681](#L1681) |  |
| [1682](#L1682) | $content .= '<video id="videojs\_player\_'. $player\_id .'" class="video-js vjs-default-skin'. $class .'" width="'. htmlspecialchars($player\_width) .'" height="'. htmlspecialchars($player\_height) .'"'. $poster\_attribute .' controls '. $autoplay\_attribute .' data-setup="{}">'; |
| [1683](#L1683) |  |
| [1684](#L1684) | $content\_type = powerpress\_get\_contenttype($media\_url); |
| [1685](#L1685) | if( $content\_type == 'video/x-m4v' ) |
| [1686](#L1686) | $content\_type = 'video/mp4'; // Mp4 |
| [1687](#L1687) | $content .='<source src="'. htmlspecialchars($media\_url) .'" type="'. $content\_type .'" />'; |
| [1688](#L1688) |  |
| [1689](#L1689) | if( !empty($EpisodeData['webm\_src']) ) |
| [1690](#L1690) | { |
| [1691](#L1691) | $EpisodeData['webm\_src'] = powerpress\_add\_flag\_to\_redirect\_url($EpisodeData['webm\_src'], 'p'); |
| [1692](#L1692) | $content .='<source src="'. htmlspecialchars($EpisodeData['webm\_src']) .'" type="video/webm; codecs="vp8, vorbis" />'; |
| [1693](#L1693) | } |
| [1694](#L1694) |  |
| [1695](#L1695) | $content .= '</video>'; |
| [1696](#L1696) | $content .= "</div>\n"; |
| [1697](#L1697) | } |
| [1698](#L1698) | else |
| [1699](#L1699) | { |
| [1700](#L1700) | $content .= powerpressplayer\_build\_html5video($media\_url, $EpisodeData); |
| [1701](#L1701) | } |
| [1702](#L1702) |  |
| [1703](#L1703) | return $content; |
| [1704](#L1704) | } |
| [1705](#L1705) |  |
| [1706](#L1706) | function powerpress\_shortcode\_skipto($attributes, $content = null) |
| [1707](#L1707) | { |
| [1708](#L1708) | $pos = ''; |
| [1709](#L1709) | if( isset($attributes['time']) ) { |
| [1710](#L1710) | $pos = $attributes['time']; |
| [1711](#L1711) | } else if (isset($attributes['timestamp'])) { |
| [1712](#L1712) | $pos = $attributes['timestamp']; |
| [1713](#L1713) | } else if (isset($attributes['ts'])) { |
| [1714](#L1714) | $pos = $attributes['ts']; |
| [1715](#L1715) | } |
| [1716](#L1716) |  |
| [1717](#L1717) | // only allow digits and colons to prevent XSS |
| [1718](#L1718) | if (!preg\_match('/^[\d:]+$/', $pos)) { |
| [1719](#L1719) | $pos = ''; |
| [1720](#L1720) | } |
| [1721](#L1721) |  |
| [1722](#L1722) | if( empty($pos) ) |
| [1723](#L1723) | return $content; |
| [1724](#L1724) |  |
| [1725](#L1725) | // Prepare data |
| [1726](#L1726) | $timeInSeconds = powerpress\_raw\_duration($pos); |
| [1727](#L1727) | $readableTime = $pos; |
| [1728](#L1728) | if( strpos($readableTime, ':') === false ) // If the time they entered is not in colon format, lets use a readable format with the colons... |
| [1729](#L1729) | $readableTime = powerpress\_readable\_duration($timeInSeconds); |
| [1730](#L1730) | if( empty($content) ) |
| [1731](#L1731) | $content = $readableTime; |
| [1732](#L1732) |  |
| [1733](#L1733) | // We can't add players to feeds |
| [1734](#L1734) | if( is\_feed() ) { |
| [1735](#L1735) | if( empty($content) ) // If no custom label is set, lets use this timestamp in a readable format with colons |
| [1736](#L1736) | return $readableTime; |
| [1737](#L1737) | return $content; |
| [1738](#L1738) | } |
| [1739](#L1739) |  |
| [1740](#L1740) | $feedSlug = 'podcast'; |
| [1741](#L1741) | if( !empty($attributes['channel']) ) |
| [1742](#L1742) | $feedSlug = $attributes['channel']; |
| [1743](#L1743) |  |
| [1744](#L1744) | if( empty($GLOBALS['powerpress\_skipto\_player'][ get\_the\_ID() ][ $feedSlug ]) ) { |
| [1745](#L1745) | if( function\_exists('qed\_stt\_shortcode') ) { // If using the skip to timestamp plugin, we will fall back to it since we are not handling the player... |
| [1746](#L1746) | return qed\_stt\_shortcode($attributes, $content); |
| [1747](#L1747) | } |
| [1748](#L1748) |  |
| [1749](#L1749) | return $content; |
| [1750](#L1750) | } |
| [1751](#L1751) |  |
| [1752](#L1752) | $playerID = $GLOBALS['powerpress\_skipto\_player'][ get\_the\_ID() ][ $feedSlug ]; |
| [1753](#L1753) | return '<a title="'. esc\_attr(sprintf(\_\_('Skip to %s', 'powerpress'), $readableTime)) .'" href="'. get\_permalink() .'#" onclick="return powerpress\_stp(event);" class="powerpress-skip-a" data-pp-stp="'. $timeInSeconds .'" data-pp-player="'. $playerID .'">'. $content .'</a>'; |
| [1754](#L1754) | } |
| [1755](#L1755) |  |
| [1756](#L1756) |  |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/powerpress/trunk/powerpress-player.php?format=txt)
* [Original Format](/export/3222468/powerpress/trunk/powerpress-player.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_44fb74e8_20250114_203705.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F2899207%2Fpowerpress)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/2896730/powerpress "Changeset 2896730 for powerpress")
* [Next Change](/changeset/2899209/powerpress "Changeset 2899209 for powerpress") →

---

# Changeset [2899207](/changeset/2899207 "Show full changeset") for [powerpress](/browser/powerpress?rev=2899207 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
04/14/2023 03:17:54 PM
([21 months](/timeline?from=2023-04-14T15%3A17%3A54Z&precision=second "See timeline at 04/14/2023 03:17:54 PM") ago)

Author:
benbeecroft
Message:

PowerPress 10.0.2

Location:
[powerpress/trunk](/browser/powerpress/trunk?rev=2899207)
Files:

3 edited

* [powerpress-player.php](/browser/powerpress/trunk/powerpress-player.php?rev=2899207 "Show entry in browser")
  (modified)
  ([2 diffs](#file0 "Show differences"))
* [powerpress.php](/browser/powerpress/trunk/powerpress.php?rev=2899207 "Show entry in browser")
  (modified)
  ([2 diffs](#file1 "Show differences"))
* [readme.txt](/browser/powerpress/trunk/readme.txt?rev=2899207 "Show entry in browser")
  (modified)
  ([2 diffs](#file2 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [powerpress/trunk/powerpress-player.php](/changeset/2899207/powerpress/trunk/powerpress-player.php "Show the changeset 2899207 restricted to powerpress/trunk/powerpress-player.php")

  | [r2896729](/browser/powerpress/trunk/powerpress-player.php?rev=2896729#L116 "Show revision 2896729 of this file in browser") | [r2899207](/browser/powerpress/trunk/powerpress-player.php?rev=2899207#L116 "Show revision 2899207 of this file in browser") |  |
  | --- | --- | --- |
  | 116 | 116 | $width = ''; |
  | 117 | 117 | $height = ''; |
  |  | 118 |  |
  |  | 119 | $attributes = array\_filter($attributes, function($var) { |
  |  | 120 | if (strpos($var, 'javascript:') === 0) { |
  |  | 121 | return ''; |
  |  | 122 | } else { |
  |  | 123 | return $var; |
  |  | 124 | } |
  |  | 125 | }); |
  | 118 | 126 |  |
  | 119 | 127 | extract( shortcode\_atts( array( |
  | […](/browser/powerpress/trunk/powerpress-player.php?rev=2896729#L1419) | […](/browser/powerpress/trunk/powerpress-player.php?rev=2899207#L1427) |  |
  | 1419 | 1427 | $playerSettings['transcriptspacing'] = '230px'; |
  | 1420 | 1428 |  |
  | 1421 |  | return '<iframe src="' . ~~htmlspecialchars($url)~~ . '" scrolling="yes" width="100%" height="'. htmlspecialchars($playerSettings['transcriptspacing']).'" frameborder="0" id="' . $playerID . '" class="blubrryplayer" title="' . $iframeTitle . '"></iframe>'; |
  |  | 1429 | return '<iframe src="' . $url . '" scrolling="yes" width="100%" height="'. htmlspecialchars($playerSettings['transcriptspacing']).'" frameborder="0" id="' . $playerID . '" class="blubrryplayer" title="' . $iframeTitle . '"></iframe>'; |
  | 1422 | 1430 | } else { |
  | 1423 |  | return '<iframe src="' . ~~htmlspecialchars($url)~~ . '" scrolling="no" width="100%" height="138px" frameborder="0" id="' . $playerID . '" class="blubrryplayer" title="' . $iframeTitle . '"></iframe>'; |
  |  | 1431 | return '<iframe src="' . $url . '" scrolling="no" width="100%" height="138px" frameborder="0" id="' . $playerID . '" class="blubrryplayer" title="' . $iframeTitle . '"></iframe>'; |
  | 1424 | 1432 | } |
  | 1425 | 1433 | } |
* ## [powerpress/trunk/powerpress.php](/changeset/2899207/powerpress/trunk/powerpress.php "Show the changeset 2899207 restricted to powerpress/trunk/powerpress.php")

  | [r2896729](/browser/powerpress/trunk/powerpress.php?rev=2896729#L4 "Show revision 2896729 of this file in browser") | [r2899207](/browser/powerpress/trunk/powerpress.php?rev=2899207#L4 "Show revision 2899207 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Plugin URI: http://create.blubrry.com/resources/powerpress/ |
  | 5 | 5 | Description: <a href="https://create.blubrry.com/resources/powerpress/" target="\_blank">Blubrry PowerPress</a> is the No. 1 Podcasting plugin for WordPress. Developed by podcasters for podcasters; features include Simple and Advanced modes, multiple audio/video player options, subscribe to podcast tools, podcast SEO features, and more! Fully supports Apple Podcasts (previously iTunes), Google Podcasts, Spotify, Stitcher, and Blubrry Podcasting directories, as well as all podcast applications and clients. |
  | 6 |  | Version: 10.0.~~1~~ |
  |  | 6 | Version: 10.0.2 |
  | 7 | 7 | Author: Blubrry |
  | 8 | 8 | Author URI: https://blubrry.com/ |
  | […](/browser/powerpress/trunk/powerpress.php?rev=2896729#L36) | […](/browser/powerpress/trunk/powerpress.php?rev=2899207#L36) |  |
  | 36 | 36 |  |
  | 37 | 37 | // WP\_PLUGIN\_DIR (REMEMBER TO USE THIS DEFINE IF NEEDED) |
  | 38 |  | define('POWERPRESS\_VERSION', '10.0.~~1~~' ); |
  |  | 38 | define('POWERPRESS\_VERSION', '10.0.2' ); |
  | 39 | 39 |  |
  | 40 | 40 | // Translation support: |
* ## [powerpress/trunk/readme.txt](/changeset/2899207/powerpress/trunk/readme.txt "Show the changeset 2899207 restricted to powerpress/trunk/readme.txt")

  | [r2896729](/browser/powerpress/trunk/readme.txt?rev=2896729#L5 "Show revision 2896729 of this file in browser") | [r2899207](/browser/powerpress/trunk/readme.txt?rev=2899207#L5 "Show revision 2899207 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | Requires PHP: 5.2 |
  | 6 | 6 | Tested up to: 6.1.1 |
  | 7 |  | Stable tag: 10.0.~~1~~ |
  |  | 7 | Stable tag: 10.0.2 |
  | 8 | 8 | Donate link: https://create.blubrry.com/resources/podcast-media-hosting/ |
  | 9 | 9 | License: GPLv2 or later |
  | […](/browser/powerpress/trunk/readme.txt?rev=2896729#L186) | […](/browser/powerpress/trunk/readme.txt?rev=2899207#L186) |  |
  | 186 | 186 |  |
  | 187 | 187 | == Changelog == |
  |  | 188 | = 10.0.2 = |
  |  | 189 | \* Released on 04/14/2023 |
  |  | 190 | \* Bugfix in shortcodes |
  |  | 191 | \* Another security update for shortcodes |
  |  | 192 |  |
  | 188 | 193 | = 10.0.1 = |
  | 189 | 194 | \* Released on 04/10/2023 |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=2899207)
* [Zip Archive](?format=zip&new=2899207)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_65c0fd09_20250114_203707.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# PowerPress <= 10.0 - Authenticated (Contributor+) Stored Cross-Site Scripting via Shortcode

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   PowerPress <= 10.0 - Authenticated (Contributor+) Stored Cross-Site Scripting via Shortcode

5.4

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:N)

| CVE | [CVE-2023-1917](https://www.cve.org/CVERecord?id=CVE-2023-1917) |
| --- | --- |
| CVSS | 5.4 (Medium) |
| Publicly Published | April 11, 2023 |
| Last Updated | January 22, 2024 |
| Researcher | [Alex Thomas - Wordfence](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/alex-thomas) |

### Description

The PowerPress plugin for WordPress is vulnerable to Stored Cross-Site Scripting via the plugin's shortcode(s) in versions up to, and including, 10.0 due to insufficient input sanitization and output escaping on user supplied attributes. This makes it possible for authenticated attackers with contributor-level and above permissions to inject arbitrary web scripts in pages that will execute whenever a user accesses an injected page. NOTE: A partial fix for the issue was introduced in version 10.0.1, and an additional patch (version 10.0.2) was released to address a workaround.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/powerpress/trunk/powerpress-player.php#L102)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/2896729/powerpress)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/2899207/powerpress)
* [www.wordfence.com](https://www.wordfence.com/blog/2023/04/blubrry-addresses-authenticated-stored-xss-vulnerability-in-powerpress-wordpress-plugin/)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fpowerpress%2Fpowerpress-100-authenticated-contributor-stored-cross-site-scripting-via-shortcode&t=PowerPress%20%3C%3D%2010.0%20-%20Authenticated%20%28Contributor%2B%29%20Stored%20Cross-Site%20Scripting%20via%20Shortcode "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fpowerpress%2Fpowerpress-100-authenticated-contributor-stored-cross-site-scripting-via-shortcode&text=PowerPress%20%3C%3D%2010.0%20-%20Authenticated%20%28Contributor%2B%29%20Stored%20Cross-Site%20Scripting%20via%20Shortcode "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fpowerpress%2Fpowerpress-100-authenticated-contributor-stored-cross-site-scripting-via-shortcode "LinkedIn")
Email

## Vulnerability Details for PowerPress Podcasting plugin by Blubrry

#### [PowerPress Podcasting plugin by Blubrry](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/powerpress)

| Software Type | Plugin |
| --- | --- |
| Software Slug | powerpress [(view on wordpress.org)](https://wordpress.org/plugins/powerpress) |
| Patched? | Yes |
| Remediation | Update to version 10.0.2, or a newer patched version |
| Affected Version | * <= 10.0 |
| Patched Version | * 10.0.2 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation


