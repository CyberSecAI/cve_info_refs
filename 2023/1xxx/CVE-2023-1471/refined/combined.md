=== Content from www.wordfence.com_b9ef57df_20250115_080149.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# WP Popup Banners <= 1.2.5 - Authenticated (Subscriber+) SQL Injection

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   WP Popup Banners <= 1.2.5 - Authenticated (Subscriber+) SQL Injection

8.8

**Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

| CVE | [CVE-2023-1471](https://www.cve.org/CVERecord?id=CVE-2023-1471) |
| --- | --- |
| CVSS | 8.8 (High) |
| Publicly Published | March 17, 2023 |
| Last Updated | March 29, 2023 |
| Researcher | [Etan Imanol Castro Aldrete](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/etan-imanol-castro-aldrete) |

### Description

The WP Popup Banners plugin for WordPress is vulnerable to SQL Injection via the 'banner\_id' parameter in versions up to, and including, 1.2.5 due to insufficient escaping on the user supplied parameter and lack of sufficient preparation on the existing SQL query. This makes it possible for authenticated attackers with minimal permissions, such as a subscriber, to append additional SQL queries into already existing queries that can be used to extract sensitive information from the database.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/wp-popup-banners/trunk/wp-popup-banners.php#L243)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/wp-popup-banners/trunk/wp-popup-banners.php#L246)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwp-popup-banners%2Fwp-popup-banners-125-authenticated-subscriber-sql-injection&t=WP%20Popup%20Banners%20%3C%3D%201.2.5%20-%20Authenticated%20%28Subscriber%2B%29%20SQL%20Injection "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwp-popup-banners%2Fwp-popup-banners-125-authenticated-subscriber-sql-injection&text=WP%20Popup%20Banners%20%3C%3D%201.2.5%20-%20Authenticated%20%28Subscriber%2B%29%20SQL%20Injection "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwp-popup-banners%2Fwp-popup-banners-125-authenticated-subscriber-sql-injection "LinkedIn")
Email

## Vulnerability Details for WP Popup Banners

#### [WP Popup Banners](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/wp-popup-banners)

| Software Type | Plugin |
| --- | --- |
| Software Slug | wp-popup-banners [(view on wordpress.org)](https://wordpress.org/plugins/wp-popup-banners) |
| Patched? | No |
| Remediation | No known patch available. Please review the vulnerability's details in depth and employ mitigations based on your organization's risk tolerance. It may be best to uninstall the affected software and find a replacement. |
| Affected Version | * <= 1.2.5 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_345f6752_20250115_080143.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fwp-popup-banners%2Ftrunk%2Fwp-popup-banners.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/wp-popup-banners/trunk/wp-popup-banners.php?rev=2641035 "Revision 2641035")
* Next Revision →
* [Blame](/browser/wp-popup-banners/trunk/wp-popup-banners.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/wp-popup-banners/trunk/wp-popup-banners.php)

---

# [source:](/browser?order=name "Go to repository root") [wp-popup-banners](/browser/wp-popup-banners?order=name "View wp-popup-banners")/[trunk](/browser/wp-popup-banners/trunk?order=name "View trunk")/[wp-popup-banners.php](/browser/wp-popup-banners/trunk/wp-popup-banners.php?order=name "View wp-popup-banners.php")

View diff against:

View revision:

| [Last change](/changeset/2733950/wp-popup-banners/trunk/wp-popup-banners.php "View differences") on this file was [2733950](/changeset/2733950/ "View changeset 2733950"), checked in by Access Keys, [3 years ago](/timeline?from=2022-05-30T10%3A43%3A14Z&precision=second "See timeline at 05/30/2022 10:43:14 AM") |
| --- |
| Checked compatibility with WP version 6.0. |
| **File size:** 15.3 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | defined('ABSPATH') or die("No direct script allowed!!!"); |
| [4](#L4) | /\* |
| [5](#L5) | Plugin Name: WP Popup Banners |
| [6](#L6) | Plugin URI:  https://accesspressthemes.com/wordpress-plugins/wp-popup-banners/ |
| [7](#L7) | Description: Popup Banners plugin helps to add popups to your site with custom messages and effects |
| [8](#L8) | Version:     1.2.5 |
| [9](#L9) | Author:      AccessPress Themes |
| [10](#L10) | Author URI:  http://accesspressthemes.com |
| [11](#L11) | License:     GPL2 |
| [12](#L12) | License URI: https://www.gnu.org/licenses/gpl-2.0.html |
| [13](#L13) | Domain Path: /languages/ |
| [14](#L14) | Text Domain: wp-popup-banners |
| [15](#L15) | \*/ |
| [16](#L16) |  |
| [17](#L17) | /\*\* |
| [18](#L18) | \* Declaration of necessary constants for plugin |
| [19](#L19) | \*/ |
| [20](#L20) | defined('WPB\_IMAGE\_DIR') or define('WPB\_IMAGE\_DIR', plugin\_dir\_url(\_\_FILE\_\_) . 'images'); |
| [21](#L21) | defined('WPB\_BACKEND\_DIR') or define('WPB\_BACKEND\_DIR', plugin\_dir\_url(\_\_FILE\_\_) . 'inc/backend'); |
| [22](#L22) | defined('WPB\_JS\_DIR') or define('WPB\_JS\_DIR', plugin\_dir\_url(\_\_FILE\_\_) . 'js'); |
| [23](#L23) | defined('WPB\_CSS\_DIR') or define('WPB\_CSS\_DIR', plugin\_dir\_url(\_\_FILE\_\_) . 'css\_files'); |
| [24](#L24) | defined('WPB\_VERSION') or define('WPB\_VERSION', '1.2.5'); |
| [25](#L25) | defined('WPB\_DEFAULT\_VARIABLE') or define('WPB\_DEFAULT\_VARIABLE', 'wpb\_default\_settings'); |
| [26](#L26) | defined('WPB\_ABSPATH') or define('WPB\_ABSPATH', plugin\_dir\_path(\_\_FILE\_\_)); |
| [27](#L27) |  |
| [28](#L28) | if (!class\_exists('WPB\_Class')) { |
| [29](#L29) |  |
| [30](#L30) | /\*\* |
| [31](#L31) | \* Declaration of plugin main class |
| [32](#L32) | \*/ |
| [33](#L33) | class WPB\_Class { |
| [34](#L34) |  |
| [35](#L35) | var $wpb\_settings; |
| [36](#L36) |  |
| [37](#L37) | /\*\* |
| [38](#L38) | \* Constructor |
| [39](#L39) | \*/ |
| [40](#L40) | function \_\_construct() { |
| [41](#L41) |  |
| [42](#L42) | $this->wpb\_settings = get\_option('wpb\_default\_settings'); |
| [43](#L43) | register\_activation\_hook(\_\_FILE\_\_, array($this, 'activation\_function')); //load the function on plugin Activation |
| [44](#L44) | add\_action('admin\_init', array($this, 'plugin\_init')); //session start and load the text domain on plugin initialization |
| [45](#L45) | add\_action('admin\_menu', array($this, 'add\_wpb\_menu')); //add the plugin menu on menu bar |
| [46](#L46) | add\_action('admin\_enqueue\_scripts', array($this, 'enqueue\_admin\_script')); //register admin scripts and css |
| [47](#L47) | add\_action('admin\_post\_wpb\_save\_options', array($this, 'wpb\_save\_options')); //save the form data to the database |
| [48](#L48) | add\_action('admin\_post\_wpb\_delete', array($this, 'delete\_wpb')); //delete popup data from database |
| [49](#L49) | add\_action('wp\_ajax\_get\_popup\_data', array($this, 'wpb\_get\_popup\_data')); //get the popup data from database on ajax call |
| [50](#L50) | add\_action('wp\_ajax\_nopriv\_get\_popup\_data', array($this, 'no\_perminission')); //restrict the ajax call for other users except admin login |
| [51](#L51) |  |
| [52](#L52) | /\* Frontend Script \*/ |
| [53](#L53) | add\_action('wp\_enqueue\_scripts', array($this, 'wpb\_register\_frontend\_assets')); //register the front end scripts and css |
| [54](#L54) | add\_action('wp\_footer', array($this, 'wpb\_appendto\_footer'), 100); //append the popup div on the footer of page |
| [55](#L55) | add\_filter( 'admin\_footer\_text', array( $this, 'wppb\_admin\_footer\_text' ) ); |
| [56](#L56) | add\_filter( 'plugin\_row\_meta', array( $this, 'wppb\_plugin\_row\_meta' ), 10, 2 ); |
| [57](#L57) | } |
| [58](#L58) |  |
| [59](#L59) | function wppb\_admin\_footer\_text( $text ){ |
| [60](#L60) | global $post; |
| [61](#L61) | if ( (isset( $\_GET[ 'page' ] ) && $\_GET[ 'page' ] == 'wpb' ) ) { |
| [62](#L62) | $link = 'https://wordpress.org/support/plugin/wp-popup-banners/reviews/#new-post'; |
| [63](#L63) | $pro\_link = 'https://accesspressthemes.com/wordpress-plugins/wp-popup-banners-pro'; |
| [64](#L64) | $text = 'Enjoyed WP Popup Banners? <a href="' . $link . '" target="\_blank">Please leave us a ★★★★★ rating</a> We really appreciate your support! | Try premium version of <a href="' . $pro\_link . '" target="\_blank">WP Popup Banners Pro</a> - more features, more power!'; |
| [65](#L65) | return $text; |
| [66](#L66) | } else { |
| [67](#L67) | return $text; |
| [68](#L68) | } |
| [69](#L69) | } |
| [70](#L70) |  |
| [71](#L71) | function wppb\_plugin\_row\_meta( $links, $file ){ |
| [72](#L72) |  |
| [73](#L73) | if ( strpos( $file, 'wp-popup-banners.php' ) !== false ) { |
| [74](#L74) | $new\_links = array( |
| [75](#L75) | 'demo' => '<a href="http://demo.accesspressthemes.com/wordpress-plugins/wp-popup-banner" target="\_blank"><span class="dashicons dashicons-welcome-view-site"></span>Live Demo</a>', |
| [76](#L76) | 'doc' => '<a href="https://accesspressthemes.com/documentation/wp-popup-banners/" target="\_blank"><span class="dashicons dashicons-media-document"></span>Documentation</a>', |
| [77](#L77) | 'support' => '<a href="http://accesspressthemes.com/support" target="\_blank"><span class="dashicons dashicons-admin-users"></span>Support</a>', |
| [78](#L78) | 'pro' => '<a href="https://accesspressthemes.com/wordpress-plugins/wp-popup-banners-pro" target="\_blank"><span class="dashicons dashicons-cart"></span>Premium version</a>' |
| [79](#L79) | ); |
| [80](#L80) |  |
| [81](#L81) | $links = array\_merge( $links, $new\_links ); |
| [82](#L82) | } |
| [83](#L83) |  |
| [84](#L84) | return $links; |
| [85](#L85) | } |
| [86](#L86) | /\* |
| [87](#L87) | \* Plugin Activation |
| [88](#L88) | \*/ |
| [89](#L89) |  |
| [90](#L90) | function activation\_function() { |
| [91](#L91) | include('inc/activation.php'); |
| [92](#L92) | } |
| [93](#L93) |  |
| [94](#L94) | /\*\* |
| [95](#L95) | \* Starts session on admin\_init hook |
| [96](#L96) | \*/ |
| [97](#L97) | function plugin\_init() { |
| [98](#L98) | if (!session\_id() && !headers\_sent()) { |
| [99](#L99) | session\_start(); |
| [100](#L100) | } |
| [101](#L101) | load\_plugin\_textdomain('wp-popup-banners', false, dirname(plugin\_basename(\_\_FILE\_\_)) . '/languages'); |
| [102](#L102) | } |
| [103](#L103) |  |
| [104](#L104) | /\*\* |
| [105](#L105) | \* Returns Default Settings |
| [106](#L106) | \*/ |
| [107](#L107) | function get\_default\_settings() { |
| [108](#L108) | $default\_settings = array( |
| [109](#L109) | 'check\_enable' => '1', |
| [110](#L110) | 'default\_popup\_id' => '' |
| [111](#L111) | ); |
| [112](#L112) |  |
| [113](#L113) | return $default\_settings; |
| [114](#L114) | } |
| [115](#L115) |  |
| [116](#L116) | /\*\* |
| [117](#L117) | \* Plugin Admin Menu |
| [118](#L118) | \*/ |
| [119](#L119) | function add\_wpb\_menu() { |
| [120](#L120) | $menu = add\_menu\_page( |
| [121](#L121) | \_\_('WP Popup Banners', 'wp-popup-banners'), \_\_('WP Popup Banners', 'wp-popup-banners'), 'manage\_options', 'wpb', array($this, 'wpb\_settings'), WPB\_IMAGE\_DIR . '/wpb1.png' |
| [122](#L122) | ); |
| [123](#L123) | } |
| [124](#L124) |  |
| [125](#L125) | /\*\* |
| [126](#L126) | \* Plugin Main Settings Page |
| [127](#L127) | \*/ |
| [128](#L128) | function wpb\_settings() { |
| [129](#L129) | include('inc/backend/main-page.php'); |
| [130](#L130) | } |
| [131](#L131) |  |
| [132](#L132) | /\*\* |
| [133](#L133) | \* Registers Admin Assets |
| [134](#L134) | \*/ |
| [135](#L135) | function enqueue\_admin\_script($hook) { |
| [136](#L136) | if (isset($\_GET['page']) && $\_GET['page'] == 'wpb') { |
| [137](#L137) | wp\_enqueue\_style('wp-color-picker'); |
| [138](#L138) | wp\_enqueue\_style('wpb-fontawesome', WPB\_CSS\_DIR . '/font-awesome/font-awesome.min.css'); |
| [139](#L139) | wp\_enqueue\_style('wpb-admin-css', WPB\_CSS\_DIR . '/backend.css', array(), WPB\_VERSION); |
| [140](#L140) | wp\_enqueue\_style('wpb-popup-css', WPB\_CSS\_DIR . '/wpb\_popup.css', array(), WPB\_VERSION); |
| [141](#L141) | wp\_enqueue\_script('wpb-popup-js', WPB\_JS\_DIR . '/backend\_popup.js', array('jquery', 'wp-color-picker'), WPB\_VERSION, false); |
| [142](#L142) | wp\_enqueue\_script('wpb-popup-colorpicker-alpha', WPB\_JS\_DIR . '/wp-color-picker-alpha.js', array('wp-color-picker'), WPB\_VERSION ); |
| [143](#L143) | /\*\* |
| [144](#L144) | \* localize the variable with javascript |
| [145](#L145) | \*/ |
| [146](#L146) | wp\_localize\_script( |
| [147](#L147) | 'wpb-popup-js', 'wpb\_admin\_js', array( |
| [148](#L148) | 'wpb\_ajaxurl' => admin\_url('admin-ajax.php'), |
| [149](#L149) | 'wpb\_ajax\_nonce' => wp\_create\_nonce('wpb\_ajax\_nonce') |
| [150](#L150) | ) |
| [151](#L151) | ); |
| [152](#L152) | } |
| [153](#L153) | } |
| [154](#L154) |  |
| [155](#L155) | /\*\* |
| [156](#L156) | \* Save popup parameters to the database |
| [157](#L157) | \* |
| [158](#L158) | \*/ |
| [159](#L159) | function wpb\_save\_options() { |
| [160](#L160) | if (isset($\_POST['wpb\_add\_nonce\_save\_settings'], $\_POST['wpb\_save\_settings']) && wp\_verify\_nonce($\_POST['wpb\_add\_nonce\_save\_settings'], 'wpb\_nonce\_save\_settings')) { |
| [161](#L161) | /\*\* |
| [162](#L162) | \* include to add/update popup if condition matched |
| [163](#L163) | \*/ |
| [164](#L164) | include( 'inc/backend/save\_new\_popup.php' ); |
| [165](#L165) | } else { |
| [166](#L166) | die('No script kiddies please!!'); |
| [167](#L167) | } |
| [168](#L168) | } |
| [169](#L169) |  |
| [170](#L170) | /\*\* |
| [171](#L171) | \* |
| [172](#L172) | \* Delete banner from database |
| [173](#L173) | \*/ |
| [174](#L174) | function delete\_wpb() { |
| [175](#L175) | if (!empty($\_GET) && wp\_verify\_nonce($\_GET['\_wpnonce'], 'wpb\_delete\_nonce')) { |
| [176](#L176) | $log\_id = $\_GET['wpb\_id']; |
| [177](#L177) | global $wpdb; |
| [178](#L178) | $table\_name = $wpdb->prefix . 'popup\_banners'; |
| [179](#L179) | $delete = $wpdb->delete($table\_name, array('id' => $log\_id), array('%d')); |
| [180](#L180) |  |
| [181](#L181) | if ($delete) { |
| [182](#L182) | $\_SESSION['wpb\_db\_success'] = \_\_('Banner deleted Successfully', 'wp-popup-banners'); |
| [183](#L183) | } else { |
| [184](#L184) | $\_SESSION['wpb\_db\_fail'] = \_\_('Failed to delete Banner.', 'wp-popup-banners'); |
| [185](#L185) | } |
| [186](#L186) |  |
| [187](#L187) | wp\_redirect(admin\_url('admin.php?page=wpb')); |
| [188](#L188) | } else { |
| [189](#L189) | die('No script kiddies please!!'); |
| [190](#L190) | } |
| [191](#L191) | } |
| [192](#L192) |  |
| [193](#L193) | /\*\* |
| [194](#L194) | \* Get popup parameters from database |
| [195](#L195) | \*/ |
| [196](#L196) | function wpb\_get\_popup\_data() { |
| [197](#L197) | return (include('inc/get\_db\_data.php')); |
| [198](#L198) | } |
| [199](#L199) |  |
| [200](#L200) | /\*\* |
| [201](#L201) | \* restrict the Ajax call to the unauthorized users |
| [202](#L202) | \*/ |
| [203](#L203) | function no\_perminission() { |
| [204](#L204) | die('No script kiddies please!!'); |
| [205](#L205) | } |
| [206](#L206) |  |
| [207](#L207) | /\*\* |
| [208](#L208) | \* Registers frontend Assets |
| [209](#L209) | \*/ |
| [210](#L210) | function wpb\_register\_frontend\_assets() { |
| [211](#L211) | /\*\* |
| [212](#L212) | \* check the conditions such as if the popup option is enabled or not |
| [213](#L213) | \* and check the active popup. And also check where to display the popup such |
| [214](#L214) | \* as only on home page or all page or only on specific pages and enque the scripts |
| [215](#L215) | \* and css on that pages. |
| [216](#L216) | \*/ |
| [217](#L217) | $condition = $this->check\_popup\_condition(); |
| [218](#L218) | if ($condition == 1) {//if the condition is true |
| [219](#L219) | $arr\_data = $this->wpb\_get\_popup\_data(); |
| [220](#L220) |  |
| [221](#L221) | wp\_enqueue\_style('wpb-admin-css', WPB\_CSS\_DIR . '/wpb\_popup.css', array(), WPB\_VERSION); |
| [222](#L222) | wp\_enqueue\_script('wpb-nicescroll-js-script', WPB\_JS\_DIR . '/jquery.nicescroll.js', array('jquery'), true, WPB\_VERSION); //registering nice scroll js |
| [223](#L223) | wp\_enqueue\_script('wpb-frontend-js-script', WPB\_JS\_DIR . '/frontend\_popup.js', array('jquery', 'wpb-nicescroll-js-script'), true, WPB\_VERSION); //registering frontend js |
| [224](#L224) | wp\_localize\_script( |
| [225](#L225) | 'wpb-frontend-js-script', 'wpb\_frontend\_js', array( |
| [226](#L226) | 'popup\_delay\_enable' => $arr\_data['popup\_delay\_enable'], |
| [227](#L227) | 'popup\_delay' => $arr\_data['popup\_delay'], |
| [228](#L228) | 'popup\_close\_countdown' => $arr\_data['popup\_close\_countdown'], |
| [229](#L229) | 'show\_popup\_cookie' => $arr\_data['show\_popup'], |
| [230](#L230) | 'show\_countdown\_message' => $arr\_data['show\_countdown\_message'], |
| [231](#L231) | 'popup\_type' => $arr\_data['popup\_type'], |
| [232](#L232) | 'autoclose\_enable' => $arr\_data['autoclose\_enable'], |
| [233](#L233) | ) |
| [234](#L234) | ); |
| [235](#L235) | }//end of if condition |
| [236](#L236) | } |
| [237](#L237) |  |
| [238](#L238) | /\*\* |
| [239](#L239) | \* append the hidden popup div on the footer of page |
| [240](#L240) | \*/ |
| [241](#L241) | function wpb\_appendto\_footer() { |
| [242](#L242) | if (isset($\_GET['wpb\_preview']) && $\_GET['wpb\_preview'] && is\_user\_logged\_in()) { |
| [243](#L243) | $default\_wpb\_id = $popup\_banner\_id = $\_GET['banner\_id']; |
| [244](#L244) | global $wpdb; |
| [245](#L245) | $table\_name = $wpdb->prefix . "popup\_banners"; |
| [246](#L246) | $popup\_details = $wpdb->get\_results("SELECT \* FROM $table\_name where id=$popup\_banner\_id"); |
| [247](#L247) | if (!empty($popup\_details)) { |
| [248](#L248) | $arr\_data = $this->wpb\_get\_popup\_data(); |
| [249](#L249) | $show\_popup = $arr\_data['show\_popup']; //show popup once, every time |
| [250](#L250) | $display\_on = $arr\_data['display\_on']; |
| [251](#L251) | $page\_list = $arr\_data['page\_list']; |
| [252](#L252) |  |
| [253](#L253) | include('inc/frontend\_main\_popup.php'); //include the popup div for front end pages |
| [254](#L254) | } |
| [255](#L255) | } else { |
| [256](#L256) | $condition = $this->check\_popup\_condition(); //check the popup condition |
| [257](#L257) |  |
| [258](#L258) | if ($condition == 1) {//if the condition is true |
| [259](#L259) | if (!isset($\_COOKIE['wp\_popup\_once'])) { |
| [260](#L260) | $wpb\_default\_settings = get\_option('wpb\_default\_settings'); |
| [261](#L261) | $default\_wpb\_id = $wpb\_default\_settings['default\_popup\_id']; |
| [262](#L262) | global $wpdb; |
| [263](#L263) | $table\_name = $wpdb->prefix . "popup\_banners"; |
| [264](#L264) | $popup\_details = $wpdb->get\_results("SELECT \* FROM $table\_name where id=$default\_wpb\_id"); |
| [265](#L265) | if (!empty($popup\_details)) { |
| [266](#L266) | $arr\_data = $this->wpb\_get\_popup\_data(); |
| [267](#L267) | $show\_popup = $arr\_data['show\_popup']; //show popup once, every time |
| [268](#L268) | $display\_on = $arr\_data['display\_on']; |
| [269](#L269) | $page\_list = $arr\_data['page\_list']; |
| [270](#L270) |  |
| [271](#L271) | include('inc/frontend\_main\_popup.php'); //include the popup div for front end pages |
| [272](#L272) | } |
| [273](#L273) | } |
| [274](#L274) | }//end of if condition |
| [275](#L275) | } |
| [276](#L276) | } |
| [277](#L277) |  |
| [278](#L278) | /\*\* |
| [279](#L279) | \* check the conditions to display the popup |
| [280](#L280) | \* and if true, reutrn 1 and if false, return 0 |
| [281](#L281) | \*/ |
| [282](#L282) | function check\_popup\_condition() { |
| [283](#L283) | $wpb\_default\_settings = get\_option('wpb\_default\_settings'); |
| [284](#L284) | if (isset($\_GET['wpb\_preview']) && $\_GET['wpb\_preview'] && is\_user\_logged\_in()) { |
| [285](#L285) | $wpb\_default\_settings['check\_enable'] = 1; |
| [286](#L286) | $wpb\_default\_settings['default\_popup\_id'] = sanitize\_text\_field($\_GET['banner\_id']); |
| [287](#L287) | } |
| [288](#L288) | if (($wpb\_default\_settings['check\_enable'] == 1 && $wpb\_default\_settings['default\_popup\_id'] != '')) { |
| [289](#L289) | global $post; |
| [290](#L290) | if (is\_404()) { |
| [291](#L291) | $post\_id = ''; |
| [292](#L292) | } else { |
| [293](#L293) | $post\_id = $post->ID; //check the current page id |
| [294](#L294) | } |
| [295](#L295) | $arr\_data = $this->wpb\_get\_popup\_data(); |
| [296](#L296) | if (is\_home() && $arr\_data['display\_on'] != '3') {//check if the current page is home page |
| [297](#L297) | return 1; |
| [298](#L298) | } else if ($arr\_data['display\_on'] == '3' && !empty($arr\_data['page\_list']) && $post->post\_type == 'page') { |
| [299](#L299) | /\*\* |
| [300](#L300) | \* check if the popup to display on only specific pages and |
| [301](#L301) | \* and if the current page belongs on the pages list |
| [302](#L302) | \*/ |
| [303](#L303) | if (in\_array($post\_id, $arr\_data['page\_list'])) { |
| [304](#L304) | return 1; |
| [305](#L305) | } |
| [306](#L306) | if (is\_home()) { |
| [307](#L307) | return 0; |
| [308](#L308) | } |
| [309](#L309) | } else if ($arr\_data['display\_on'] == '2') { |
| [310](#L310) | /\*\* |
| [311](#L311) | \* check if the popup to display on all pages and |
| [312](#L312) | \* current page is of 'page' type |
| [313](#L313) | \*/ |
| [314](#L314) | return 1; |
| [315](#L315) | } else { |
| [316](#L316) | return 0; //return false if all conditions does not match |
| [317](#L317) | } |
| [318](#L318) | } |
| [319](#L319) | } |
| [320](#L320) |  |
| [321](#L321) | function print\_array($array) { |
| [322](#L322) | echo "<pre style=\"background:#fff;\">"; |
| [323](#L323) | print\_r($array); |
| [324](#L324) | echo "</pre>"; |
| [325](#L325) | } |
| [326](#L326) |  |
| [327](#L327) | function output\_converting\_br($text) { |
| [328](#L328) | $text = implode("\n", explode("<br />", $text)); |
| [329](#L329) | return $text; |
| [330](#L330) | } |
| [331](#L331) |  |
| [332](#L332) | function sanitize\_escaping\_linebreaks($text) { |
| [333](#L333) | $text = implode("<br />", explode("\n", $text)); |
| [334](#L334) | return $text; |
| [335](#L335) | } |
| [336](#L336) |  |
| [337](#L337) | } |
| [338](#L338) |  |
| [339](#L339) | $wpb\_object = new WPB\_Class(); //initialization of plugin |
| [340](#L340) | } |
| [341](#L341) |  |
| [342](#L342) | // end of plugin |
| [343](#L343) |  |
| [344](#L344) |  |
| [345](#L345) |  |
| [346](#L346) |  |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/wp-popup-banners/trunk/wp-popup-banners.php?format=txt)
* [Original Format](/export/3222666/wp-popup-banners/trunk/wp-popup-banners.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_90ecd396_20250115_080142.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fwp-popup-banners%2Ftrunk%2Fwp-popup-banners.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/wp-popup-banners/trunk/wp-popup-banners.php?rev=2641035 "Revision 2641035")
* Next Revision →
* [Blame](/browser/wp-popup-banners/trunk/wp-popup-banners.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/wp-popup-banners/trunk/wp-popup-banners.php)

---

# [source:](/browser?order=name "Go to repository root") [wp-popup-banners](/browser/wp-popup-banners?order=name "View wp-popup-banners")/[trunk](/browser/wp-popup-banners/trunk?order=name "View trunk")/[wp-popup-banners.php](/browser/wp-popup-banners/trunk/wp-popup-banners.php?order=name "View wp-popup-banners.php")

View diff against:

View revision:

| [Last change](/changeset/2733950/wp-popup-banners/trunk/wp-popup-banners.php "View differences") on this file was [2733950](/changeset/2733950/ "View changeset 2733950"), checked in by Access Keys, [3 years ago](/timeline?from=2022-05-30T10%3A43%3A14Z&precision=second "See timeline at 05/30/2022 10:43:14 AM") |
| --- |
| Checked compatibility with WP version 6.0. |
| **File size:** 15.3 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | defined('ABSPATH') or die("No direct script allowed!!!"); |
| [4](#L4) | /\* |
| [5](#L5) | Plugin Name: WP Popup Banners |
| [6](#L6) | Plugin URI:  https://accesspressthemes.com/wordpress-plugins/wp-popup-banners/ |
| [7](#L7) | Description: Popup Banners plugin helps to add popups to your site with custom messages and effects |
| [8](#L8) | Version:     1.2.5 |
| [9](#L9) | Author:      AccessPress Themes |
| [10](#L10) | Author URI:  http://accesspressthemes.com |
| [11](#L11) | License:     GPL2 |
| [12](#L12) | License URI: https://www.gnu.org/licenses/gpl-2.0.html |
| [13](#L13) | Domain Path: /languages/ |
| [14](#L14) | Text Domain: wp-popup-banners |
| [15](#L15) | \*/ |
| [16](#L16) |  |
| [17](#L17) | /\*\* |
| [18](#L18) | \* Declaration of necessary constants for plugin |
| [19](#L19) | \*/ |
| [20](#L20) | defined('WPB\_IMAGE\_DIR') or define('WPB\_IMAGE\_DIR', plugin\_dir\_url(\_\_FILE\_\_) . 'images'); |
| [21](#L21) | defined('WPB\_BACKEND\_DIR') or define('WPB\_BACKEND\_DIR', plugin\_dir\_url(\_\_FILE\_\_) . 'inc/backend'); |
| [22](#L22) | defined('WPB\_JS\_DIR') or define('WPB\_JS\_DIR', plugin\_dir\_url(\_\_FILE\_\_) . 'js'); |
| [23](#L23) | defined('WPB\_CSS\_DIR') or define('WPB\_CSS\_DIR', plugin\_dir\_url(\_\_FILE\_\_) . 'css\_files'); |
| [24](#L24) | defined('WPB\_VERSION') or define('WPB\_VERSION', '1.2.5'); |
| [25](#L25) | defined('WPB\_DEFAULT\_VARIABLE') or define('WPB\_DEFAULT\_VARIABLE', 'wpb\_default\_settings'); |
| [26](#L26) | defined('WPB\_ABSPATH') or define('WPB\_ABSPATH', plugin\_dir\_path(\_\_FILE\_\_)); |
| [27](#L27) |  |
| [28](#L28) | if (!class\_exists('WPB\_Class')) { |
| [29](#L29) |  |
| [30](#L30) | /\*\* |
| [31](#L31) | \* Declaration of plugin main class |
| [32](#L32) | \*/ |
| [33](#L33) | class WPB\_Class { |
| [34](#L34) |  |
| [35](#L35) | var $wpb\_settings; |
| [36](#L36) |  |
| [37](#L37) | /\*\* |
| [38](#L38) | \* Constructor |
| [39](#L39) | \*/ |
| [40](#L40) | function \_\_construct() { |
| [41](#L41) |  |
| [42](#L42) | $this->wpb\_settings = get\_option('wpb\_default\_settings'); |
| [43](#L43) | register\_activation\_hook(\_\_FILE\_\_, array($this, 'activation\_function')); //load the function on plugin Activation |
| [44](#L44) | add\_action('admin\_init', array($this, 'plugin\_init')); //session start and load the text domain on plugin initialization |
| [45](#L45) | add\_action('admin\_menu', array($this, 'add\_wpb\_menu')); //add the plugin menu on menu bar |
| [46](#L46) | add\_action('admin\_enqueue\_scripts', array($this, 'enqueue\_admin\_script')); //register admin scripts and css |
| [47](#L47) | add\_action('admin\_post\_wpb\_save\_options', array($this, 'wpb\_save\_options')); //save the form data to the database |
| [48](#L48) | add\_action('admin\_post\_wpb\_delete', array($this, 'delete\_wpb')); //delete popup data from database |
| [49](#L49) | add\_action('wp\_ajax\_get\_popup\_data', array($this, 'wpb\_get\_popup\_data')); //get the popup data from database on ajax call |
| [50](#L50) | add\_action('wp\_ajax\_nopriv\_get\_popup\_data', array($this, 'no\_perminission')); //restrict the ajax call for other users except admin login |
| [51](#L51) |  |
| [52](#L52) | /\* Frontend Script \*/ |
| [53](#L53) | add\_action('wp\_enqueue\_scripts', array($this, 'wpb\_register\_frontend\_assets')); //register the front end scripts and css |
| [54](#L54) | add\_action('wp\_footer', array($this, 'wpb\_appendto\_footer'), 100); //append the popup div on the footer of page |
| [55](#L55) | add\_filter( 'admin\_footer\_text', array( $this, 'wppb\_admin\_footer\_text' ) ); |
| [56](#L56) | add\_filter( 'plugin\_row\_meta', array( $this, 'wppb\_plugin\_row\_meta' ), 10, 2 ); |
| [57](#L57) | } |
| [58](#L58) |  |
| [59](#L59) | function wppb\_admin\_footer\_text( $text ){ |
| [60](#L60) | global $post; |
| [61](#L61) | if ( (isset( $\_GET[ 'page' ] ) && $\_GET[ 'page' ] == 'wpb' ) ) { |
| [62](#L62) | $link = 'https://wordpress.org/support/plugin/wp-popup-banners/reviews/#new-post'; |
| [63](#L63) | $pro\_link = 'https://accesspressthemes.com/wordpress-plugins/wp-popup-banners-pro'; |
| [64](#L64) | $text = 'Enjoyed WP Popup Banners? <a href="' . $link . '" target="\_blank">Please leave us a ★★★★★ rating</a> We really appreciate your support! | Try premium version of <a href="' . $pro\_link . '" target="\_blank">WP Popup Banners Pro</a> - more features, more power!'; |
| [65](#L65) | return $text; |
| [66](#L66) | } else { |
| [67](#L67) | return $text; |
| [68](#L68) | } |
| [69](#L69) | } |
| [70](#L70) |  |
| [71](#L71) | function wppb\_plugin\_row\_meta( $links, $file ){ |
| [72](#L72) |  |
| [73](#L73) | if ( strpos( $file, 'wp-popup-banners.php' ) !== false ) { |
| [74](#L74) | $new\_links = array( |
| [75](#L75) | 'demo' => '<a href="http://demo.accesspressthemes.com/wordpress-plugins/wp-popup-banner" target="\_blank"><span class="dashicons dashicons-welcome-view-site"></span>Live Demo</a>', |
| [76](#L76) | 'doc' => '<a href="https://accesspressthemes.com/documentation/wp-popup-banners/" target="\_blank"><span class="dashicons dashicons-media-document"></span>Documentation</a>', |
| [77](#L77) | 'support' => '<a href="http://accesspressthemes.com/support" target="\_blank"><span class="dashicons dashicons-admin-users"></span>Support</a>', |
| [78](#L78) | 'pro' => '<a href="https://accesspressthemes.com/wordpress-plugins/wp-popup-banners-pro" target="\_blank"><span class="dashicons dashicons-cart"></span>Premium version</a>' |
| [79](#L79) | ); |
| [80](#L80) |  |
| [81](#L81) | $links = array\_merge( $links, $new\_links ); |
| [82](#L82) | } |
| [83](#L83) |  |
| [84](#L84) | return $links; |
| [85](#L85) | } |
| [86](#L86) | /\* |
| [87](#L87) | \* Plugin Activation |
| [88](#L88) | \*/ |
| [89](#L89) |  |
| [90](#L90) | function activation\_function() { |
| [91](#L91) | include('inc/activation.php'); |
| [92](#L92) | } |
| [93](#L93) |  |
| [94](#L94) | /\*\* |
| [95](#L95) | \* Starts session on admin\_init hook |
| [96](#L96) | \*/ |
| [97](#L97) | function plugin\_init() { |
| [98](#L98) | if (!session\_id() && !headers\_sent()) { |
| [99](#L99) | session\_start(); |
| [100](#L100) | } |
| [101](#L101) | load\_plugin\_textdomain('wp-popup-banners', false, dirname(plugin\_basename(\_\_FILE\_\_)) . '/languages'); |
| [102](#L102) | } |
| [103](#L103) |  |
| [104](#L104) | /\*\* |
| [105](#L105) | \* Returns Default Settings |
| [106](#L106) | \*/ |
| [107](#L107) | function get\_default\_settings() { |
| [108](#L108) | $default\_settings = array( |
| [109](#L109) | 'check\_enable' => '1', |
| [110](#L110) | 'default\_popup\_id' => '' |
| [111](#L111) | ); |
| [112](#L112) |  |
| [113](#L113) | return $default\_settings; |
| [114](#L114) | } |
| [115](#L115) |  |
| [116](#L116) | /\*\* |
| [117](#L117) | \* Plugin Admin Menu |
| [118](#L118) | \*/ |
| [119](#L119) | function add\_wpb\_menu() { |
| [120](#L120) | $menu = add\_menu\_page( |
| [121](#L121) | \_\_('WP Popup Banners', 'wp-popup-banners'), \_\_('WP Popup Banners', 'wp-popup-banners'), 'manage\_options', 'wpb', array($this, 'wpb\_settings'), WPB\_IMAGE\_DIR . '/wpb1.png' |
| [122](#L122) | ); |
| [123](#L123) | } |
| [124](#L124) |  |
| [125](#L125) | /\*\* |
| [126](#L126) | \* Plugin Main Settings Page |
| [127](#L127) | \*/ |
| [128](#L128) | function wpb\_settings() { |
| [129](#L129) | include('inc/backend/main-page.php'); |
| [130](#L130) | } |
| [131](#L131) |  |
| [132](#L132) | /\*\* |
| [133](#L133) | \* Registers Admin Assets |
| [134](#L134) | \*/ |
| [135](#L135) | function enqueue\_admin\_script($hook) { |
| [136](#L136) | if (isset($\_GET['page']) && $\_GET['page'] == 'wpb') { |
| [137](#L137) | wp\_enqueue\_style('wp-color-picker'); |
| [138](#L138) | wp\_enqueue\_style('wpb-fontawesome', WPB\_CSS\_DIR . '/font-awesome/font-awesome.min.css'); |
| [139](#L139) | wp\_enqueue\_style('wpb-admin-css', WPB\_CSS\_DIR . '/backend.css', array(), WPB\_VERSION); |
| [140](#L140) | wp\_enqueue\_style('wpb-popup-css', WPB\_CSS\_DIR . '/wpb\_popup.css', array(), WPB\_VERSION); |
| [141](#L141) | wp\_enqueue\_script('wpb-popup-js', WPB\_JS\_DIR . '/backend\_popup.js', array('jquery', 'wp-color-picker'), WPB\_VERSION, false); |
| [142](#L142) | wp\_enqueue\_script('wpb-popup-colorpicker-alpha', WPB\_JS\_DIR . '/wp-color-picker-alpha.js', array('wp-color-picker'), WPB\_VERSION ); |
| [143](#L143) | /\*\* |
| [144](#L144) | \* localize the variable with javascript |
| [145](#L145) | \*/ |
| [146](#L146) | wp\_localize\_script( |
| [147](#L147) | 'wpb-popup-js', 'wpb\_admin\_js', array( |
| [148](#L148) | 'wpb\_ajaxurl' => admin\_url('admin-ajax.php'), |
| [149](#L149) | 'wpb\_ajax\_nonce' => wp\_create\_nonce('wpb\_ajax\_nonce') |
| [150](#L150) | ) |
| [151](#L151) | ); |
| [152](#L152) | } |
| [153](#L153) | } |
| [154](#L154) |  |
| [155](#L155) | /\*\* |
| [156](#L156) | \* Save popup parameters to the database |
| [157](#L157) | \* |
| [158](#L158) | \*/ |
| [159](#L159) | function wpb\_save\_options() { |
| [160](#L160) | if (isset($\_POST['wpb\_add\_nonce\_save\_settings'], $\_POST['wpb\_save\_settings']) && wp\_verify\_nonce($\_POST['wpb\_add\_nonce\_save\_settings'], 'wpb\_nonce\_save\_settings')) { |
| [161](#L161) | /\*\* |
| [162](#L162) | \* include to add/update popup if condition matched |
| [163](#L163) | \*/ |
| [164](#L164) | include( 'inc/backend/save\_new\_popup.php' ); |
| [165](#L165) | } else { |
| [166](#L166) | die('No script kiddies please!!'); |
| [167](#L167) | } |
| [168](#L168) | } |
| [169](#L169) |  |
| [170](#L170) | /\*\* |
| [171](#L171) | \* |
| [172](#L172) | \* Delete banner from database |
| [173](#L173) | \*/ |
| [174](#L174) | function delete\_wpb() { |
| [175](#L175) | if (!empty($\_GET) && wp\_verify\_nonce($\_GET['\_wpnonce'], 'wpb\_delete\_nonce')) { |
| [176](#L176) | $log\_id = $\_GET['wpb\_id']; |
| [177](#L177) | global $wpdb; |
| [178](#L178) | $table\_name = $wpdb->prefix . 'popup\_banners'; |
| [179](#L179) | $delete = $wpdb->delete($table\_name, array('id' => $log\_id), array('%d')); |
| [180](#L180) |  |
| [181](#L181) | if ($delete) { |
| [182](#L182) | $\_SESSION['wpb\_db\_success'] = \_\_('Banner deleted Successfully', 'wp-popup-banners'); |
| [183](#L183) | } else { |
| [184](#L184) | $\_SESSION['wpb\_db\_fail'] = \_\_('Failed to delete Banner.', 'wp-popup-banners'); |
| [185](#L185) | } |
| [186](#L186) |  |
| [187](#L187) | wp\_redirect(admin\_url('admin.php?page=wpb')); |
| [188](#L188) | } else { |
| [189](#L189) | die('No script kiddies please!!'); |
| [190](#L190) | } |
| [191](#L191) | } |
| [192](#L192) |  |
| [193](#L193) | /\*\* |
| [194](#L194) | \* Get popup parameters from database |
| [195](#L195) | \*/ |
| [196](#L196) | function wpb\_get\_popup\_data() { |
| [197](#L197) | return (include('inc/get\_db\_data.php')); |
| [198](#L198) | } |
| [199](#L199) |  |
| [200](#L200) | /\*\* |
| [201](#L201) | \* restrict the Ajax call to the unauthorized users |
| [202](#L202) | \*/ |
| [203](#L203) | function no\_perminission() { |
| [204](#L204) | die('No script kiddies please!!'); |
| [205](#L205) | } |
| [206](#L206) |  |
| [207](#L207) | /\*\* |
| [208](#L208) | \* Registers frontend Assets |
| [209](#L209) | \*/ |
| [210](#L210) | function wpb\_register\_frontend\_assets() { |
| [211](#L211) | /\*\* |
| [212](#L212) | \* check the conditions such as if the popup option is enabled or not |
| [213](#L213) | \* and check the active popup. And also check where to display the popup such |
| [214](#L214) | \* as only on home page or all page or only on specific pages and enque the scripts |
| [215](#L215) | \* and css on that pages. |
| [216](#L216) | \*/ |
| [217](#L217) | $condition = $this->check\_popup\_condition(); |
| [218](#L218) | if ($condition == 1) {//if the condition is true |
| [219](#L219) | $arr\_data = $this->wpb\_get\_popup\_data(); |
| [220](#L220) |  |
| [221](#L221) | wp\_enqueue\_style('wpb-admin-css', WPB\_CSS\_DIR . '/wpb\_popup.css', array(), WPB\_VERSION); |
| [222](#L222) | wp\_enqueue\_script('wpb-nicescroll-js-script', WPB\_JS\_DIR . '/jquery.nicescroll.js', array('jquery'), true, WPB\_VERSION); //registering nice scroll js |
| [223](#L223) | wp\_enqueue\_script('wpb-frontend-js-script', WPB\_JS\_DIR . '/frontend\_popup.js', array('jquery', 'wpb-nicescroll-js-script'), true, WPB\_VERSION); //registering frontend js |
| [224](#L224) | wp\_localize\_script( |
| [225](#L225) | 'wpb-frontend-js-script', 'wpb\_frontend\_js', array( |
| [226](#L226) | 'popup\_delay\_enable' => $arr\_data['popup\_delay\_enable'], |
| [227](#L227) | 'popup\_delay' => $arr\_data['popup\_delay'], |
| [228](#L228) | 'popup\_close\_countdown' => $arr\_data['popup\_close\_countdown'], |
| [229](#L229) | 'show\_popup\_cookie' => $arr\_data['show\_popup'], |
| [230](#L230) | 'show\_countdown\_message' => $arr\_data['show\_countdown\_message'], |
| [231](#L231) | 'popup\_type' => $arr\_data['popup\_type'], |
| [232](#L232) | 'autoclose\_enable' => $arr\_data['autoclose\_enable'], |
| [233](#L233) | ) |
| [234](#L234) | ); |
| [235](#L235) | }//end of if condition |
| [236](#L236) | } |
| [237](#L237) |  |
| [238](#L238) | /\*\* |
| [239](#L239) | \* append the hidden popup div on the footer of page |
| [240](#L240) | \*/ |
| [241](#L241) | function wpb\_appendto\_footer() { |
| [242](#L242) | if (isset($\_GET['wpb\_preview']) && $\_GET['wpb\_preview'] && is\_user\_logged\_in()) { |
| [243](#L243) | $default\_wpb\_id = $popup\_banner\_id = $\_GET['banner\_id']; |
| [244](#L244) | global $wpdb; |
| [245](#L245) | $table\_name = $wpdb->prefix . "popup\_banners"; |
| [246](#L246) | $popup\_details = $wpdb->get\_results("SELECT \* FROM $table\_name where id=$popup\_banner\_id"); |
| [247](#L247) | if (!empty($popup\_details)) { |
| [248](#L248) | $arr\_data = $this->wpb\_get\_popup\_data(); |
| [249](#L249) | $show\_popup = $arr\_data['show\_popup']; //show popup once, every time |
| [250](#L250) | $display\_on = $arr\_data['display\_on']; |
| [251](#L251) | $page\_list = $arr\_data['page\_list']; |
| [252](#L252) |  |
| [253](#L253) | include('inc/frontend\_main\_popup.php'); //include the popup div for front end pages |
| [254](#L254) | } |
| [255](#L255) | } else { |
| [256](#L256) | $condition = $this->check\_popup\_condition(); //check the popup condition |
| [257](#L257) |  |
| [258](#L258) | if ($condition == 1) {//if the condition is true |
| [259](#L259) | if (!isset($\_COOKIE['wp\_popup\_once'])) { |
| [260](#L260) | $wpb\_default\_settings = get\_option('wpb\_default\_settings'); |
| [261](#L261) | $default\_wpb\_id = $wpb\_default\_settings['default\_popup\_id']; |
| [262](#L262) | global $wpdb; |
| [263](#L263) | $table\_name = $wpdb->prefix . "popup\_banners"; |
| [264](#L264) | $popup\_details = $wpdb->get\_results("SELECT \* FROM $table\_name where id=$default\_wpb\_id"); |
| [265](#L265) | if (!empty($popup\_details)) { |
| [266](#L266) | $arr\_data = $this->wpb\_get\_popup\_data(); |
| [267](#L267) | $show\_popup = $arr\_data['show\_popup']; //show popup once, every time |
| [268](#L268) | $display\_on = $arr\_data['display\_on']; |
| [269](#L269) | $page\_list = $arr\_data['page\_list']; |
| [270](#L270) |  |
| [271](#L271) | include('inc/frontend\_main\_popup.php'); //include the popup div for front end pages |
| [272](#L272) | } |
| [273](#L273) | } |
| [274](#L274) | }//end of if condition |
| [275](#L275) | } |
| [276](#L276) | } |
| [277](#L277) |  |
| [278](#L278) | /\*\* |
| [279](#L279) | \* check the conditions to display the popup |
| [280](#L280) | \* and if true, reutrn 1 and if false, return 0 |
| [281](#L281) | \*/ |
| [282](#L282) | function check\_popup\_condition() { |
| [283](#L283) | $wpb\_default\_settings = get\_option('wpb\_default\_settings'); |
| [284](#L284) | if (isset($\_GET['wpb\_preview']) && $\_GET['wpb\_preview'] && is\_user\_logged\_in()) { |
| [285](#L285) | $wpb\_default\_settings['check\_enable'] = 1; |
| [286](#L286) | $wpb\_default\_settings['default\_popup\_id'] = sanitize\_text\_field($\_GET['banner\_id']); |
| [287](#L287) | } |
| [288](#L288) | if (($wpb\_default\_settings['check\_enable'] == 1 && $wpb\_default\_settings['default\_popup\_id'] != '')) { |
| [289](#L289) | global $post; |
| [290](#L290) | if (is\_404()) { |
| [291](#L291) | $post\_id = ''; |
| [292](#L292) | } else { |
| [293](#L293) | $post\_id = $post->ID; //check the current page id |
| [294](#L294) | } |
| [295](#L295) | $arr\_data = $this->wpb\_get\_popup\_data(); |
| [296](#L296) | if (is\_home() && $arr\_data['display\_on'] != '3') {//check if the current page is home page |
| [297](#L297) | return 1; |
| [298](#L298) | } else if ($arr\_data['display\_on'] == '3' && !empty($arr\_data['page\_list']) && $post->post\_type == 'page') { |
| [299](#L299) | /\*\* |
| [300](#L300) | \* check if the popup to display on only specific pages and |
| [301](#L301) | \* and if the current page belongs on the pages list |
| [302](#L302) | \*/ |
| [303](#L303) | if (in\_array($post\_id, $arr\_data['page\_list'])) { |
| [304](#L304) | return 1; |
| [305](#L305) | } |
| [306](#L306) | if (is\_home()) { |
| [307](#L307) | return 0; |
| [308](#L308) | } |
| [309](#L309) | } else if ($arr\_data['display\_on'] == '2') { |
| [310](#L310) | /\*\* |
| [311](#L311) | \* check if the popup to display on all pages and |
| [312](#L312) | \* current page is of 'page' type |
| [313](#L313) | \*/ |
| [314](#L314) | return 1; |
| [315](#L315) | } else { |
| [316](#L316) | return 0; //return false if all conditions does not match |
| [317](#L317) | } |
| [318](#L318) | } |
| [319](#L319) | } |
| [320](#L320) |  |
| [321](#L321) | function print\_array($array) { |
| [322](#L322) | echo "<pre style=\"background:#fff;\">"; |
| [323](#L323) | print\_r($array); |
| [324](#L324) | echo "</pre>"; |
| [325](#L325) | } |
| [326](#L326) |  |
| [327](#L327) | function output\_converting\_br($text) { |
| [328](#L328) | $text = implode("\n", explode("<br />", $text)); |
| [329](#L329) | return $text; |
| [330](#L330) | } |
| [331](#L331) |  |
| [332](#L332) | function sanitize\_escaping\_linebreaks($text) { |
| [333](#L333) | $text = implode("<br />", explode("\n", $text)); |
| [334](#L334) | return $text; |
| [335](#L335) | } |
| [336](#L336) |  |
| [337](#L337) | } |
| [338](#L338) |  |
| [339](#L339) | $wpb\_object = new WPB\_Class(); //initialization of plugin |
| [340](#L340) | } |
| [341](#L341) |  |
| [342](#L342) | // end of plugin |
| [343](#L343) |  |
| [344](#L344) |  |
| [345](#L345) |  |
| [346](#L346) |  |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/wp-popup-banners/trunk/wp-popup-banners.php?format=txt)
* [Original Format](/export/3222666/wp-popup-banners/trunk/wp-popup-banners.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


