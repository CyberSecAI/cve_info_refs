=== Content from gitlab.com_8e3314d2_20250114_230810.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Private email address of service desk issue creator disclosed via /api/v4/projects/{project\_id}/issues?iids[]={issue\_id}

âš  **Please read [the process](https://gitlab.com/gitlab-org/release/docs/-/blob/master/general/security/developer.md) on how to fix security issues before starting to work on the issue. Vulnerabilities must be fixed in a security mirror.**

**[HackerOne report #1933829](https://hackerone.com/reports/1933829)** by `ricardobrito` on 2023-04-04, assigned to `GitLab Team`:

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

##### Background

Service Desk allows non members of a project to create issues on a project by sending an email address to the service desk email assigned to a particular project.

Recently in Gitlab 15.9, the following was introduced:

`Redact Service Desk email addresses in issues: GitLab Service Desk makes it easy to interact with customers and provide support. To ensure that customer email addresses are kept private, you now need to have at least the Reporter role in a project or group to see the sender address of a Service Desk issue. This applies to both public and private projects.`

The [documentation](https://docs.gitlab.com/ee/user/project/service_desk.html?_gl=1*fhvh6p*_ga*MTAzNjE3NDQ2OC4xNjcyMTY5Nzgx*_ga_ENFH3X7M5Y*MTY4MDYxMDY5Mi4xNTQuMC4xNjgwNjEwNjkyLjAuMC4w#privacy-considerations) says that only signed-in users with at least reporter role for the project are allowed to view the email of the creator of the service desk issue.

##### Summary

I have found that a user with `guest` role on a project, is capable of leaking the redacted email address of the sender (creator of the issue), through the following api endpoint: `http://your-instance.com/api/v4/projects/:id/issues`

The user email is leaked in the field `service_desk_reply_to`.

##### Pre-requisites

In order to test this functionality, you need to set up service desk for your instance, such that your projects can have a service desk email. The instructions to set this up can be found in the Gitlab [documentation](https://docs.gitlab.com/ee/user/project/service_desk.html#configuring-service-desk)

##### Steps to reproduce

1. As user A, create a project, and inside the project go to settings->general->service desk and enable it for this project.
2. Still inside step 1, take note of the email which users will use to create confidential issues on your project, e.g. in my poc the email is `gitlabhackerone+admin-group-admin-project-31-issue-[@]gmail.com`.
3. Invide a guest user, say user B to your project with the `guest` role.
4. Now send an email to `gitlabhackerone+admin-group-admin-project-31-issue-[@]gmail.com`.
5. If you reload the issues of the projects, you will see that a new issue was created with the title set as the subject of the email sent in step 5 and the description set with the body of the email from step 5.
6. This issue is confidential by default. Change it to public (according to the documentation, even public issues CANNOT have the sender's email leaked).
7. Access the issue as user B, you will be able to see the issue, however the email will be redacted:

[![Screenshot_2023-04-04_at_8.44.16_PM.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/897b15f69c56b4480038f3c72fe5b3230bfb4b7c/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f63393835613237322d393832632d346263352d623137332d3835376338303932316561642f53637265656e73686f745f323032332d30342d30345f61745f382e34342e31365f504d2e706e67)

8. So far so good, but now as the guest user, generate an api access token and make the following request (I use postman), but the curl command would be:

`curl -sk -H "PRIVATE-TOKEN: YOUR-TOKEN" http://127.0.0.1:3000/api/v4/projects/:ID/issues`

In which `YOUR-TOKEN` would be the guest user's token and `ID` would be the project id and the result will contain the email of the user who sent the email that automatically created the issue leaked in the `service_desk_reply_to` field.

POC video:

[user-email.leaked.mov](https://user-content.gitlab-static.net/d5029de78f6463de7e4ff9325325aebcd150716b/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f38306336386365322d636466622d343230652d386464362d3234346637646463336366352f757365722d656d61696c2e6c65616b65642e6d6f76 "Download 'user-email.leaked.mov'")

##### Instance details

This bug happens on your-gitlab-instance, and it was tested on the latest Gitlab version.

#### Impact

A guest user can leak the email address of the creator of a confidential service desk issue .

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [Screenshot\_2023-04-04\_at\_8.44.16\_PM.png](https://h1.sec.gitlab.net/a/c985a272-982c-4bc5-b173-857c80921ead/Screenshot_2023-04-04_at_8.44.16_PM.png)
* [user-email.leaked.mov](https://h1.sec.gitlab.net/a/80c68ce2-cdfb-420e-8dd6-244f7ddc3cf5/user-email.leaked.mov)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


