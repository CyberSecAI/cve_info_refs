Based on the provided content, here's a breakdown of the vulnerability:

**Root Cause:**

The vulnerability stems from insufficient validation of uploaded image thumbnails in the Yoga Class Registration System. Specifically, the application does not properly sanitize the filename of the uploaded image, allowing an attacker to control the file extension and path where the image will be stored on the server.

**Weaknesses/Vulnerabilities:**

*   **Unvalidated Filename:** The application uses the user-provided filename from the uploaded image to construct the final storage path without proper sanitization.
*   **Image Processing Bypass:** While the application uses `imagecreatefromjpeg` and `imagecreatefrompng` functions to process uploaded images, which removes most image fragments, it is possible to bypass this restriction by uploading a small image, that will not be scaled by the `imagescale` function, and retain a `PLTE` fragment that can be used for exploitation.

**Impact of Exploitation:**

*   **Remote Command Execution (RCE):** By crafting a malicious image with an embedded PHP payload, an attacker can achieve RCE by uploading the malicious image which will be stored with a `.php` extension, which can be requested and executed. This grants the attacker the ability to execute arbitrary code on the server.
*   **Full system compromise:** Through RCE, an attacker can fully compromise the server.

**Attack Vectors:**

*   **File Upload:** The primary attack vector is the file upload functionality for class thumbnails, accessible to administrators.
*   **Malicious Image:** An attacker uploads a specially crafted image with an embedded PHP payload, manipulating the file name to have a `.php` extension, bypassing the image processing and resizing.

**Required Attacker Capabilities/Position:**

*   **Administrator Access:** The attacker needs to be an administrator on the system to upload class thumbnails. This can be achieved by exploiting [CVE-2023-1722](https://fluidattacks.com/advisories/wyckoff/).
*   **Ability to Craft Malicious Image:** The attacker needs to be able to create a specially crafted image file that bypasses server-side image processing.

**Additional Details:**

*   The provided exploit code (`exploit.php`) demonstrates how to craft such a malicious image with a PHP payload embedded within.
*   The vulnerability is present in version 1.0 of the Yoga Class Registration System.
*   There is currently no patch available for this vulnerability.
*   The vulnerability has a CVSS v3.1 base score of 9.1.