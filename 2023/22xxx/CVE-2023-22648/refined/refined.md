Based on the provided content, here's an analysis of CVE-2023-22648:

**Root Cause of Vulnerability:**

*   The vulnerability stems from a bug in Rancher's Azure AD integration. Specifically, permission changes made in Azure AD are not being reflected in active Rancher sessions. This means a user's permissions within Rancher may not update when their group memberships or permissions change in Azure AD.

**Weaknesses/Vulnerabilities Present:**

*   **Insufficient Permission Refresh:** Rancher is not properly refreshing user permissions based on changes in Azure AD. This results in users retaining their previous permissions, even after those permissions have been revoked or altered in Azure AD.
*   **Permission Caching:** Rancher caches user permissions and this cache is not invalidated when Azure AD changes occur, even after a Rancher pod restart.

**Impact of Exploitation:**

*   **Privilege Escalation/Persistence:** Users who have had their permissions reduced or revoked in Azure AD will retain their previous, potentially higher level of access within Rancher, until they log out and log back in. This can lead to unauthorized access to resources.
*   **Data Exposure:** If users are removed from a group, they should lose access to the resources previously allowed by that group, if their permissions are not updated they could continue to access restricted resources.

**Attack Vectors:**

*   **Network:** The attack vector is network-based, as it involves users accessing Rancher through the network.
*   Users who obtain a token or kubeconfig to access Rancher are affected, specifically:
    1.  Users using the Rancher UI.
    2.  Users using `kubectl` with a `kubeconfig` downloaded through the Rancher UI.
    3.  Users using tokens created via the Rancher UI "Create API Key" feature.

**Required Attacker Capabilities/Position:**

*   **Low Privileges:** An attacker needs to be an authenticated Rancher user who has had their permissions changed in Azure AD.
*   **User interaction:** The user needs to remain logged in to maintain the permissions obtained before the changes in Azure AD.
*   **Network Access:** The attacker needs network access to the Rancher instance.
*   No special attacker capabilities required other than having a Rancher account and having their Azure AD groups changed.

**Additional details:**

*   The vulnerability affects Rancher instances with Azure AD integration enabled.
*   The issue is present in Rancher versions >= 2.6.7 and < 2.6.13, as well as >= 2.7.0 and < 2.7.4.
*   The vulnerability has been assigned a CVSS v3 base score of 8.0 (High) with metrics: AV:N/AC:L/PR:L/UI:R/S:U/C:H/I:H/A:H.
*   The vulnerability is tracked as CWE-285 (Improper Authorization).
*   The issue was responsibly disclosed by @yvespp.