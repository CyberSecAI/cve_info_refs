=== Content from github.com_9f4a61ea_20250114_190338.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnektos%2Fact%2Fblob%2Fv0.2.35%2Fpkg%2Fartifacts%2Fserver.go)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnektos%2Fact%2Fblob%2Fv0.2.35%2Fpkg%2Fartifacts%2Fserver.go)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=nektos%2Fact)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[nektos](/nektos)
/
**[act](/nektos/act)**
Public

* [Notifications](/login?return_to=%2Fnektos%2Fact) You must be signed in to change notification settings
* [Fork
  1.4k](/login?return_to=%2Fnektos%2Fact)
* [Star
   56.8k](/login?return_to=%2Fnektos%2Fact)

* [Code](/nektos/act/tree/v0.2.35)
* [Issues
  194](/nektos/act/issues)
* [Pull requests
  24](/nektos/act/pulls)
* [Discussions](/nektos/act/discussions)
* [Actions](/nektos/act/actions)
* [Projects
  0](/nektos/act/projects)
* [Security](/nektos/act/security)
* [Insights](/nektos/act/pulse)

Additional navigation options

* [Code](/nektos/act/tree/v0.2.35)
* [Issues](/nektos/act/issues)
* [Pull requests](/nektos/act/pulls)
* [Discussions](/nektos/act/discussions)
* [Actions](/nektos/act/actions)
* [Projects](/nektos/act/projects)
* [Security](/nektos/act/security)
* [Insights](/nektos/act/pulse)

## Files

 v0.2.35
## Breadcrumbs

1. [act](/nektos/act/tree/v0.2.35)
2. /[pkg](/nektos/act/tree/v0.2.35/pkg)
3. /[artifacts](/nektos/act/tree/v0.2.35/pkg/artifacts)
/
# server.go

Copy path Blame  Blame
## Latest commit

## History

[History](/nektos/act/commits/v0.2.35/pkg/artifacts/server.go)306 lines (250 loc) · 6.79 KB v0.2.35
## Breadcrumbs

1. [act](/nektos/act/tree/v0.2.35)
2. /[pkg](/nektos/act/tree/v0.2.35/pkg)
3. /[artifacts](/nektos/act/tree/v0.2.35/pkg/artifacts)
/
# server.go

Top
## File metadata and controls

* Code
* Blame

306 lines (250 loc) · 6.79 KB[Raw](https://github.com/nektos/act/raw/refs/tags/v0.2.35/pkg/artifacts/server.go)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306package artifacts
import ( "context" "encoding/json" "errors" "fmt" "io" "io/fs" "net/http" "os" "path" "path/filepath" "strings" "time"
 "github.com/julienschmidt/httprouter" "github.com/nektos/act/pkg/common")
type FileContainerResourceURL struct { FileContainerResourceURL string `json:"fileContainerResourceUrl"`}
type NamedFileContainerResourceURL struct { Name string `json:"name"` FileContainerResourceURL string `json:"fileContainerResourceUrl"`}
type NamedFileContainerResourceURLResponse struct { Count int `json:"count"` Value []NamedFileContainerResourceURL `json:"value"`}
type ContainerItem struct { Path string `json:"path"` ItemType string `json:"itemType"` ContentLocation string `json:"contentLocation"`}
type ContainerItemResponse struct { Value []ContainerItem `json:"value"`}
type ResponseMessage struct { Message string `json:"message"`}
type MkdirFS interface { fs.FS MkdirAll(path string, perm fs.FileMode) error Open(name string) (fs.File, error) OpenAtEnd(name string) (fs.File, error)}
type MkdirFsImpl struct { dir string fs.FS}
func (fsys MkdirFsImpl) MkdirAll(path string, perm fs.FileMode) error { return os.MkdirAll(fsys.dir+"/"+path, perm)}
func (fsys MkdirFsImpl) Open(name string) (fs.File, error) { return os.OpenFile(fsys.dir+"/"+name, os.O\_CREATE|os.O\_RDWR|os.O\_TRUNC, 0644)}
func (fsys MkdirFsImpl) OpenAtEnd(name string) (fs.File, error) { file, err := os.OpenFile(fsys.dir+"/"+name, os.O\_CREATE|os.O\_RDWR, 0644)
 if err != nil { return nil, err }
 \_, err = file.Seek(0, os.SEEK\_END) if err != nil { return nil, err }
 return file, nil}
var gzipExtension = ".gz\_\_"
func uploads(router \*httprouter.Router, fsys MkdirFS) { router.POST("/\_apis/pipelines/workflows/:runId/artifacts", func(w http.ResponseWriter, req \*http.Request, params httprouter.Params) { runID := params.ByName("runId")
 json, err := json.Marshal(FileContainerResourceURL{ FileContainerResourceURL: fmt.Sprintf("http://%s/upload/%s", req.Host, runID), }) if err != nil { panic(err) }
 \_, err = w.Write(json) if err != nil { panic(err) } })
 router.PUT("/upload/:runId", func(w http.ResponseWriter, req \*http.Request, params httprouter.Params) { itemPath := req.URL.Query().Get("itemPath") runID := params.ByName("runId")
 if req.Header.Get("Content-Encoding") == "gzip" { itemPath += gzipExtension }
 filePath := fmt.Sprintf("%s/%s", runID, itemPath)
 err := fsys.MkdirAll(path.Dir(filePath), os.ModePerm) if err != nil { panic(err) }
 file, err := func() (fs.File, error) { contentRange := req.Header.Get("Content-Range") if contentRange != "" && !strings.HasPrefix(contentRange, "bytes 0-") { return fsys.OpenAtEnd(filePath) } return fsys.Open(filePath) }()
 if err != nil { panic(err) } defer file.Close()
 writer, ok := file.(io.Writer) if !ok { panic(errors.New("File is not writable")) }
 if req.Body == nil { panic(errors.New("No body given")) }
 \_, err = io.Copy(writer, req.Body) if err != nil { panic(err) }
 json, err := json.Marshal(ResponseMessage{ Message: "success", }) if err != nil { panic(err) }
 \_, err = w.Write(json) if err != nil { panic(err) } })
 router.PATCH("/\_apis/pipelines/workflows/:runId/artifacts", func(w http.ResponseWriter, req \*http.Request, params httprouter.Params) { json, err := json.Marshal(ResponseMessage{ Message: "success", }) if err != nil { panic(err) }
 \_, err = w.Write(json) if err != nil { panic(err) } })}
func downloads(router \*httprouter.Router, fsys fs.FS) { router.GET("/\_apis/pipelines/workflows/:runId/artifacts", func(w http.ResponseWriter, req \*http.Request, params httprouter.Params) { runID := params.ByName("runId")
 entries, err := fs.ReadDir(fsys, runID) if err != nil { panic(err) }
 var list []NamedFileContainerResourceURL for \_, entry := range entries { list = append(list, NamedFileContainerResourceURL{ Name: entry.Name(), FileContainerResourceURL: fmt.Sprintf("http://%s/download/%s", req.Host, runID), }) }
 json, err := json.Marshal(NamedFileContainerResourceURLResponse{ Count: len(list), Value: list, }) if err != nil { panic(err) }
 \_, err = w.Write(json) if err != nil { panic(err) } })
 router.GET("/download/:container", func(w http.ResponseWriter, req \*http.Request, params httprouter.Params) { container := params.ByName("container") itemPath := req.URL.Query().Get("itemPath") dirPath := fmt.Sprintf("%s/%s", container, itemPath)
 var files []ContainerItem err := fs.WalkDir(fsys, dirPath, func(path string, entry fs.DirEntry, err error) error { if !entry.IsDir() { rel, err := filepath.Rel(dirPath, path) if err != nil { panic(err) }
 // if it was upload as gzip rel = strings.TrimSuffix(rel, gzipExtension)
 files = append(files, ContainerItem{ Path: fmt.Sprintf("%s/%s", itemPath, rel), ItemType: "file", ContentLocation: fmt.Sprintf("http://%s/artifact/%s/%s/%s", req.Host, container, itemPath, rel), }) } return nil }) if err != nil { panic(err) }
 json, err := json.Marshal(ContainerItemResponse{ Value: files, }) if err != nil { panic(err) }
 \_, err = w.Write(json) if err != nil { panic(err) } })
 router.GET("/artifact/\*path", func(w http.ResponseWriter, req \*http.Request, params httprouter.Params) { path := params.ByName("path")[1:]
 file, err := fsys.Open(path) if err != nil { // try gzip file file, err = fsys.Open(path + gzipExtension) if err != nil { panic(err) } w.Header().Add("Content-Encoding", "gzip") }
 \_, err = io.Copy(w, file) if err != nil { panic(err) } })}
func Serve(ctx context.Context, artifactPath string, port string) context.CancelFunc { serverContext, cancel := context.WithCancel(ctx) logger := common.Logger(serverContext)
 if artifactPath == "" { return cancel }
 router := httprouter.New()
 logger.Debugf("Artifacts base path '%s'", artifactPath) fs := os.DirFS(artifactPath) uploads(router, MkdirFsImpl{artifactPath, fs}) downloads(router, fs) ip := common.GetOutboundIP().String()
 server := &http.Server{ Addr: fmt.Sprintf("%s:%s", ip, port), ReadHeaderTimeout: 2 \* time.Second, Handler: router, }
 // run server go func() { logger.Infof("Start server on http://%s:%s", ip, port) if err := server.ListenAndServe(); err != nil && err != http.ErrServerClosed { logger.Fatal(err) } }()
 // wait for cancel to gracefully shutdown server go func() { <-serverContext.Done()
 if err := server.Shutdown(ctx); err != nil { logger.Errorf("Failed shutdown gracefully - force shutdown: %v", err) server.Close() } }()
 return cancel}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_895a6dec_20250114_190335.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnektos%2Fact%2Fblob%2Fmaster%2Fpkg%2Fartifacts%2Fserver.go)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnektos%2Fact%2Fblob%2Fmaster%2Fpkg%2Fartifacts%2Fserver.go)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=nektos%2Fact)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[nektos](/nektos)
/
**[act](/nektos/act)**
Public

* [Notifications](/login?return_to=%2Fnektos%2Fact) You must be signed in to change notification settings
* [Fork
  1.4k](/login?return_to=%2Fnektos%2Fact)
* [Star
   56.8k](/login?return_to=%2Fnektos%2Fact)

* [Code](/nektos/act)
* [Issues
  194](/nektos/act/issues)
* [Pull requests
  24](/nektos/act/pulls)
* [Discussions](/nektos/act/discussions)
* [Actions](/nektos/act/actions)
* [Projects
  0](/nektos/act/projects)
* [Security](/nektos/act/security)
* [Insights](/nektos/act/pulse)

Additional navigation options

* [Code](/nektos/act)
* [Issues](/nektos/act/issues)
* [Pull requests](/nektos/act/pulls)
* [Discussions](/nektos/act/discussions)
* [Actions](/nektos/act/actions)
* [Projects](/nektos/act/projects)
* [Security](/nektos/act/security)
* [Insights](/nektos/act/pulse)

## Files

 master
## Breadcrumbs

1. [act](/nektos/act/tree/master)
2. /[pkg](/nektos/act/tree/master/pkg)
3. /[artifacts](/nektos/act/tree/master/pkg/artifacts)
/
# server.go

Copy path Blame  Blame
## Latest commit

## History

[History](/nektos/act/commits/master/pkg/artifacts/server.go)319 lines (259 loc) · 7.29 KB master
## Breadcrumbs

1. [act](/nektos/act/tree/master)
2. /[pkg](/nektos/act/tree/master/pkg)
3. /[artifacts](/nektos/act/tree/master/pkg/artifacts)
/
# server.go

Top
## File metadata and controls

* Code
* Blame

319 lines (259 loc) · 7.29 KB[Raw](https://github.com/nektos/act/raw/refs/heads/master/pkg/artifacts/server.go)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319package artifacts
import ( "context" "encoding/json" "errors" "fmt" "io" "io/fs" "net/http" "os" "path/filepath" "strings" "time"
 "github.com/julienschmidt/httprouter"
 "github.com/nektos/act/pkg/common")
type FileContainerResourceURL struct { FileContainerResourceURL string `json:"fileContainerResourceUrl"`}
type NamedFileContainerResourceURL struct { Name string `json:"name"` FileContainerResourceURL string `json:"fileContainerResourceUrl"`}
type NamedFileContainerResourceURLResponse struct { Count int `json:"count"` Value []NamedFileContainerResourceURL `json:"value"`}
type ContainerItem struct { Path string `json:"path"` ItemType string `json:"itemType"` ContentLocation string `json:"contentLocation"`}
type ContainerItemResponse struct { Value []ContainerItem `json:"value"`}
type ResponseMessage struct { Message string `json:"message"`}
type WritableFile interface { io.WriteCloser}
type WriteFS interface { OpenWritable(name string) (WritableFile, error) OpenAppendable(name string) (WritableFile, error)}
type readWriteFSImpl struct {}
func (fwfs readWriteFSImpl) Open(name string) (fs.File, error) { return os.Open(name)}
func (fwfs readWriteFSImpl) OpenWritable(name string) (WritableFile, error) { if err := os.MkdirAll(filepath.Dir(name), os.ModePerm); err != nil { return nil, err } return os.OpenFile(name, os.O\_CREATE|os.O\_RDWR|os.O\_TRUNC, 0o644)}
func (fwfs readWriteFSImpl) OpenAppendable(name string) (WritableFile, error) { if err := os.MkdirAll(filepath.Dir(name), os.ModePerm); err != nil { return nil, err } file, err := os.OpenFile(name, os.O\_CREATE|os.O\_RDWR, 0o644)
 if err != nil { return nil, err }
 \_, err = file.Seek(0, io.SeekEnd) if err != nil { return nil, err } return file, nil}
var gzipExtension = ".gz\_\_"
func safeResolve(baseDir string, relPath string) string { return filepath.Join(baseDir, filepath.Clean(filepath.Join(string(os.PathSeparator), relPath)))}
func uploads(router \*httprouter.Router, baseDir string, fsys WriteFS) { router.POST("/\_apis/pipelines/workflows/:runId/artifacts", func(w http.ResponseWriter, req \*http.Request, params httprouter.Params) { runID := params.ByName("runId")
 json, err := json.Marshal(FileContainerResourceURL{ FileContainerResourceURL: fmt.Sprintf("http://%s/upload/%s", req.Host, runID), }) if err != nil { panic(err) }
 \_, err = w.Write(json) if err != nil { panic(err) } })
 router.PUT("/upload/:runId", func(w http.ResponseWriter, req \*http.Request, params httprouter.Params) { itemPath := req.URL.Query().Get("itemPath") runID := params.ByName("runId")
 if req.Header.Get("Content-Encoding") == "gzip" { itemPath += gzipExtension }
 safeRunPath := safeResolve(baseDir, runID) safePath := safeResolve(safeRunPath, itemPath)
 file, err := func() (WritableFile, error) { contentRange := req.Header.Get("Content-Range") if contentRange != "" && !strings.HasPrefix(contentRange, "bytes 0-") { return fsys.OpenAppendable(safePath) } return fsys.OpenWritable(safePath) }()
 if err != nil { panic(err) } defer file.Close()
 writer, ok := file.(io.Writer) if !ok { panic(errors.New("File is not writable")) }
 if req.Body == nil { panic(errors.New("No body given")) }
 \_, err = io.Copy(writer, req.Body) if err != nil { panic(err) }
 json, err := json.Marshal(ResponseMessage{ Message: "success", }) if err != nil { panic(err) }
 \_, err = w.Write(json) if err != nil { panic(err) } })
 router.PATCH("/\_apis/pipelines/workflows/:runId/artifacts", func(w http.ResponseWriter, \_ \*http.Request, \_ httprouter.Params) { json, err := json.Marshal(ResponseMessage{ Message: "success", }) if err != nil { panic(err) }
 \_, err = w.Write(json) if err != nil { panic(err) } })}
func downloads(router \*httprouter.Router, baseDir string, fsys fs.FS) { router.GET("/\_apis/pipelines/workflows/:runId/artifacts", func(w http.ResponseWriter, req \*http.Request, params httprouter.Params) { runID := params.ByName("runId")
 safePath := safeResolve(baseDir, runID)
 entries, err := fs.ReadDir(fsys, safePath) if err != nil { panic(err) }
 var list []NamedFileContainerResourceURL for \_, entry := range entries { list = append(list, NamedFileContainerResourceURL{ Name: entry.Name(), FileContainerResourceURL: fmt.Sprintf("http://%s/download/%s", req.Host, runID), }) }
 json, err := json.Marshal(NamedFileContainerResourceURLResponse{ Count: len(list), Value: list, }) if err != nil { panic(err) }
 \_, err = w.Write(json) if err != nil { panic(err) } })
 router.GET("/download/:container", func(w http.ResponseWriter, req \*http.Request, params httprouter.Params) { container := params.ByName("container") itemPath := req.URL.Query().Get("itemPath") safePath := safeResolve(baseDir, filepath.Join(container, itemPath))
 var files []ContainerItem err := fs.WalkDir(fsys, safePath, func(path string, entry fs.DirEntry, \_ error) error { if !entry.IsDir() { rel, err := filepath.Rel(safePath, path) if err != nil { panic(err) }
 // if it was upload as gzip rel = strings.TrimSuffix(rel, gzipExtension) path := filepath.Join(itemPath, rel)
 rel = filepath.ToSlash(rel) path = filepath.ToSlash(path)
 files = append(files, ContainerItem{ Path: path, ItemType: "file", ContentLocation: fmt.Sprintf("http://%s/artifact/%s/%s/%s", req.Host, container, itemPath, rel), }) } return nil }) if err != nil { panic(err) }
 json, err := json.Marshal(ContainerItemResponse{ Value: files, }) if err != nil { panic(err) }
 \_, err = w.Write(json) if err != nil { panic(err) } })
 router.GET("/artifact/\*path", func(w http.ResponseWriter, \_ \*http.Request, params httprouter.Params) { path := params.ByName("path")[1:]
 safePath := safeResolve(baseDir, path)
 file, err := fsys.Open(safePath) if err != nil { // try gzip file file, err = fsys.Open(safePath + gzipExtension) if err != nil { panic(err) } w.Header().Add("Content-Encoding", "gzip") }
 \_, err = io.Copy(w, file) if err != nil { panic(err) } })}
func Serve(ctx context.Context, artifactPath string, addr string, port string) context.CancelFunc { serverContext, cancel := context.WithCancel(ctx) logger := common.Logger(serverContext)
 if artifactPath == "" { return cancel }
 router := httprouter.New()
 logger.Debugf("Artifacts base path '%s'", artifactPath) fsys := readWriteFSImpl{} uploads(router, artifactPath, fsys) downloads(router, artifactPath, fsys) RoutesV4(router, artifactPath, fsys, fsys)
 server := &http.Server{ Addr: fmt.Sprintf("%s:%s", addr, port), ReadHeaderTimeout: 2 \* time.Second, Handler: router, }
 // run server go func() { logger.Infof("Start server on http://%s:%s", addr, port) if err := server.ListenAndServe(); err != nil && err != http.ErrServerClosed { logger.Fatal(err) } }()
 // wait for cancel to gracefully shutdown server go func() { <-serverContext.Done()
 if err := server.Shutdown(ctx); err != nil { logger.Errorf("Failed shutdown gracefully - force shutdown: %v", err) server.Close() } }()
 return cancel}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_9415ccc0_20250114_190341.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnektos%2Fact%2Fcommit%2F63ae215071f94569d910964bdee866d91d6e3a10)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnektos%2Fact%2Fcommit%2F63ae215071f94569d910964bdee866d91d6e3a10)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=nektos%2Fact)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[nektos](/nektos)
/
**[act](/nektos/act)**
Public

* [Notifications](/login?return_to=%2Fnektos%2Fact) You must be signed in to change notification settings
* [Fork
  1.4k](/login?return_to=%2Fnektos%2Fact)
* [Star
   56.8k](/login?return_to=%2Fnektos%2Fact)

* [Code](/nektos/act)
* [Issues
  194](/nektos/act/issues)
* [Pull requests
  24](/nektos/act/pulls)
* [Discussions](/nektos/act/discussions)
* [Actions](/nektos/act/actions)
* [Projects
  0](/nektos/act/projects)
* [Security](/nektos/act/security)
* [Insights](/nektos/act/pulse)

Additional navigation options

* [Code](/nektos/act)
* [Issues](/nektos/act/issues)
* [Pull requests](/nektos/act/pulls)
* [Discussions](/nektos/act/discussions)
* [Actions](/nektos/act/actions)
* [Projects](/nektos/act/projects)
* [Security](/nektos/act/security)
* [Insights](/nektos/act/pulse)

## Commit

[Permalink](/nektos/act/commit/63ae215071f94569d910964bdee866d91d6e3a10)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

fix: update artifact server to address GHSL-2023-004 ([#1565](https://github.com/nektos/act/pull/1565))

[Browse files](/nektos/act/tree/63ae215071f94569d910964bdee866d91d6e3a10)
Browse the repository at this point in the history

* Loading branch information

[![@cplee](https://avatars.githubusercontent.com/u/2239057?s=40&v=4)](/cplee)

[cplee](/nektos/act/commits?author=cplee "View all commits by cplee")
authored
Jan 16, 2023

1 parent
[efb12b7](/nektos/act/commit/efb12b7f122e1daa3fce410a0808098a23dad910)

commit 63ae215

 Show file tree

 Hide file tree

Showing
**4 changed files**
with
**202 additions**
and
**73 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* .vscode

  + .vscode/settings.json
    [settings.json](#diff-a5de3e5871ffcc383a2294845bd3df25d3eeff6c29ad46e3a396577c413bf357)
* pkg/artifacts

  + pkg/artifacts/server.go
    [server.go](#diff-ca22c034c5d5037434b4d92a81fde09a075fb6cfb89294b4f83e8d530dd3eb9f)
  + pkg/artifacts/server\_test.go
    [server\_test.go](#diff-4dc8e0084d048f44f984c5875832577dbeb959e36a0a193ed2b12ffc04d396b4)
  + testdata/GHSL-2023-004

    - pkg/artifacts/testdata/GHSL-2023-004/artifacts.yml
      [artifacts.yml](#diff-250a787574ff7225d946bd92c2dff3ab7fba4b794fdb01c195dfccedc00394c2)

## There are no files selected for viewing

1 change: 1 addition & 0 deletions

1
[.vscode/settings.json](#diff-a5de3e5871ffcc383a2294845bd3df25d3eeff6c29ad46e3a396577c413bf357 ".vscode/settings.json")

Show comments

[View file](/nektos/act/blob/63ae215071f94569d910964bdee866d91d6e3a10/.vscode/settings.json)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,6 +1,7 @@ |
|  |  | { |
|  |  | "go.lintTool": "golangci-lint", |
|  |  | "go.lintFlags": ["--fix"], |
|  |  | "go.testTimeout": "300s", |
|  |  | "[json]": { |
|  |  | "editor.defaultFormatter": "esbenp.prettier-vscode" |
|  |  | }, |
| Expand Down | |  |

82 changes: 45 additions & 37 deletions

82
[pkg/artifacts/server.go](#diff-ca22c034c5d5037434b4d92a81fde09a075fb6cfb89294b4f83e8d530dd3eb9f "pkg/artifacts/server.go")

Show comments

[View file](/nektos/act/blob/63ae215071f94569d910964bdee866d91d6e3a10/pkg/artifacts/server.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -9,7 +9,6 @@ import ( |
|  |  | "io/fs" |
|  |  | "net/http" |
|  |  | "os" |
|  |  | "path" |
|  |  | "path/filepath" |
|  |  | "strings" |
|  |  | "time" |
| Expand Down  Expand Up | | @@ -46,28 +45,34 @@ type ResponseMessage struct { |
|  |  | Message string `json:"message"` |
|  |  | } |
|  |  |  |
|  |  | type MkdirFS interface { |
|  |  | fs.FS |
|  |  | MkdirAll(path string, perm fs.FileMode) error |
|  |  | Open(name string) (fs.File, error) |
|  |  | OpenAtEnd(name string) (fs.File, error) |
|  |  | type WritableFile interface { |
|  |  | io.WriteCloser |
|  |  | } |
|  |  |  |
|  |  | type MkdirFsImpl struct { |
|  |  | dir string |
|  |  | fs.FS |
|  |  | type WriteFS interface { |
|  |  | OpenWritable(name string) (WritableFile, error) |
|  |  | OpenAppendable(name string) (WritableFile, error) |
|  |  | } |
|  |  |  |
|  |  | func (fsys MkdirFsImpl) MkdirAll(path string, perm fs.FileMode) error { |
|  |  | return os.MkdirAll(fsys.dir+"/"+path, perm) |
|  |  | type readWriteFSImpl struct { |
|  |  | } |
|  |  |  |
|  |  | func (fsys MkdirFsImpl) Open(name string) (fs.File, error) { |
|  |  | return os.OpenFile(fsys.dir+"/"+name, os.O\_CREATE|os.O\_RDWR|os.O\_TRUNC, 0644) |
|  |  | func (fwfs readWriteFSImpl) Open(name string) (fs.File, error) { |
|  |  | return os.Open(name) |
|  |  | } |
|  |  |  |
|  |  | func (fsys MkdirFsImpl) OpenAtEnd(name string) (fs.File, error) { |
|  |  | file, err := os.OpenFile(fsys.dir+"/"+name, os.O\_CREATE|os.O\_RDWR, 0644) |
|  |  | func (fwfs readWriteFSImpl) OpenWritable(name string) (WritableFile, error) { |
|  |  | if err := os.MkdirAll(filepath.Dir(name), os.ModePerm); err != nil { |
|  |  | return nil, err |
|  |  | } |
|  |  | return os.OpenFile(name, os.O\_CREATE|os.O\_RDWR|os.O\_TRUNC, 0644) |
|  |  | } |
|  |  |  |
|  |  | func (fwfs readWriteFSImpl) OpenAppendable(name string) (WritableFile, error) { |
|  |  | if err := os.MkdirAll(filepath.Dir(name), os.ModePerm); err != nil { |
|  |  | return nil, err |
|  |  | } |
|  |  | file, err := os.OpenFile(name, os.O\_CREATE|os.O\_RDWR, 0644) |
|  |  |  |
|  |  | if err != nil { |
|  |  | return nil, err |
| Expand All | | @@ -77,13 +82,16 @@ func (fsys MkdirFsImpl) OpenAtEnd(name string) (fs.File, error) { |
|  |  | if err != nil { |
|  |  | return nil, err |
|  |  | } |
|  |  |  |
|  |  | return file, nil |
|  |  | } |
|  |  |  |
|  |  | var gzipExtension = ".gz\_\_" |
|  |  |  |
|  |  | func uploads(router \*httprouter.Router, fsys MkdirFS) { |
|  |  | func safeResolve(baseDir string, relPath string) string { |
|  |  | return filepath.Join(baseDir, filepath.Clean(filepath.Join(string(os.PathSeparator), relPath))) |
|  |  | } |
|  |  |  |
|  |  | func uploads(router \*httprouter.Router, baseDir string, fsys WriteFS) { |
|  |  | router.POST("/\_apis/pipelines/workflows/:runId/artifacts", func(w http.ResponseWriter, req \*http.Request, params httprouter.Params) { |
|  |  | runID := params.ByName("runId") |
|  |  |  |
| Expand All | | @@ -108,19 +116,15 @@ func uploads(router \*httprouter.Router, fsys MkdirFS) { |
|  |  | itemPath += gzipExtension |
|  |  | } |
|  |  |  |
|  |  | filePath := fmt.Sprintf("%s/%s", runID, itemPath) |
|  |  | safeRunPath := safeResolve(baseDir, runID) |
|  |  | safePath := safeResolve(safeRunPath, itemPath) |
|  |  |  |
|  |  | err := fsys.MkdirAll(path.Dir(filePath), os.ModePerm) |
|  |  | if err != nil { |
|  |  | panic(err) |
|  |  | } |
|  |  |  |
|  |  | file, err := func() (fs.File, error) { |
|  |  | file, err := func() (WritableFile, error) { |
|  |  | contentRange := req.Header.Get("Content-Range") |
|  |  | if contentRange != "" && !strings.HasPrefix(contentRange, "bytes 0-") { |
|  |  | return fsys.OpenAtEnd(filePath) |
|  |  | return fsys.OpenAppendable(safePath) |
|  |  | } |
|  |  | return fsys.Open(filePath) |
|  |  | return fsys.OpenWritable(safePath) |
|  |  | }() |
|  |  |  |
|  |  | if err != nil { |
| Expand Down  Expand Up | | @@ -170,11 +174,13 @@ func uploads(router \*httprouter.Router, fsys MkdirFS) { |
|  |  | }) |
|  |  | } |
|  |  |  |
|  |  | func downloads(router \*httprouter.Router, fsys fs.FS) { |
|  |  | func downloads(router \*httprouter.Router, baseDir string, fsys fs.FS) { |
|  |  | router.GET("/\_apis/pipelines/workflows/:runId/artifacts", func(w http.ResponseWriter, req \*http.Request, params httprouter.Params) { |
|  |  | runID := params.ByName("runId") |
|  |  |  |
|  |  | entries, err := fs.ReadDir(fsys, runID) |
|  |  | safePath := safeResolve(baseDir, runID) |
|  |  |  |
|  |  | entries, err := fs.ReadDir(fsys, safePath) |
|  |  | if err != nil { |
|  |  | panic(err) |
|  |  | } |
| Expand Down  Expand Up | | @@ -204,12 +210,12 @@ func downloads(router \*httprouter.Router, fsys fs.FS) { |
|  |  | router.GET("/download/:container", func(w http.ResponseWriter, req \*http.Request, params httprouter.Params) { |
|  |  | container := params.ByName("container") |
|  |  | itemPath := req.URL.Query().Get("itemPath") |
|  |  | dirPath := fmt.Sprintf("%s/%s", container, itemPath) |
|  |  | safePath := safeResolve(baseDir, filepath.Join(container, itemPath)) |
|  |  |  |
|  |  | var files []ContainerItem |
|  |  | err := fs.WalkDir(fsys, dirPath, func(path string, entry fs.DirEntry, err error) error { |
|  |  | err := fs.WalkDir(fsys, safePath, func(path string, entry fs.DirEntry, err error) error { |
|  |  | if !entry.IsDir() { |
|  |  | rel, err := filepath.Rel(dirPath, path) |
|  |  | rel, err := filepath.Rel(safePath, path) |
|  |  | if err != nil { |
|  |  | panic(err) |
|  |  | } |
| Expand All | | @@ -218,7 +224,7 @@ func downloads(router \*httprouter.Router, fsys fs.FS) { |
|  |  | rel = strings.TrimSuffix(rel, gzipExtension) |
|  |  |  |
|  |  | files = append(files, ContainerItem{ |
|  |  | Path: fmt.Sprintf("%s/%s", itemPath, rel), |
|  |  | Path: filepath.Join(itemPath, rel), |
|  |  | ItemType: "file", |
|  |  | ContentLocation: fmt.Sprintf("http://%s/artifact/%s/%s/%s", req.Host, container, itemPath, rel), |
|  |  | }) |
| Expand All | | @@ -245,10 +251,12 @@ func downloads(router \*httprouter.Router, fsys fs.FS) { |
|  |  | router.GET("/artifact/\*path", func(w http.ResponseWriter, req \*http.Request, params httprouter.Params) { |
|  |  | path := params.ByName("path")[1:] |
|  |  |  |
|  |  | file, err := fsys.Open(path) |
|  |  | safePath := safeResolve(baseDir, path) |
|  |  |  |
|  |  | file, err := fsys.Open(safePath) |
|  |  | if err != nil { |
|  |  | // try gzip file |
|  |  | file, err = fsys.Open(path + gzipExtension) |
|  |  | file, err = fsys.Open(safePath + gzipExtension) |
|  |  | if err != nil { |
|  |  | panic(err) |
|  |  | } |
| Expand All | | @@ -273,9 +281,9 @@ func Serve(ctx context.Context, artifactPath string, addr string, port string) c |
|  |  | router := httprouter.New() |
|  |  |  |
|  |  | logger.Debugf("Artifacts base path '%s'", artifactPath) |
|  |  | fs := os.DirFS(artifactPath) |
|  |  | uploads(router, MkdirFsImpl{artifactPath, fs}) |
|  |  | downloads(router, fs) |
|  |  | fsys := readWriteFSImpl{} |
|  |  | uploads(router, artifactPath, fsys) |
|  |  | downloads(router, artifactPath, fsys) |
|  |  |  |
|  |  | server := &http.Server{ |
|  |  | Addr: fmt.Sprintf("%s:%s", addr, port), |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `63ae215`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnektos%2Fact%2Fcommit%2F63ae215071f94569d910964bdee866d91d6e3a10) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from securitylab.github.com_11a584b5_20250114_190343.html ===

[skip to content](#content)

 /
[Security Lab](/ "Security Lab")
[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Events](/events/ "Events")

[Get Involved](/get-involved/)

* Resources
* [Open Source Community](/open-source "Home")
* [Enterprise](/enterprise "Home")

 /
[Security Lab](/ "Security Lab")

[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Open Source Community](/open-source "Open Source Community")
[Enterprise](/enterprise "Enterprise")

[Events](/events/ "Events")
[Get Involved](/get-involved/ "Events")

January 20, 2023
# GHSL-2023-004: Arbitrary file upload and download in act - CVE-2023-22726

[![Author avatar](https://avatars.githubusercontent.com/u/11400619)
Kevin Stubbings](https://github.com/Kwstubbs)

## Coordinated Disclosure Timeline

* 09-01-23: Vulnerability report sent to Casey Lee.
* 10-01-23: Vulnerability acknowledged.
* 16-01-23: Patch Applied and Advisory Opened On Repo

## Summary

The artifact server that stores artifacts from GitHub Action runs does not sanitize path inputs. This allows an attacker to download and overwrite arbitrary files on the host from a GitHub Action.

## Product

act

## Tested Version

[v0.2.35](https://github.com/nektos/act/releases/tag/v0.2.35)

## Details

### Issue 1: Arbitrary file upload in artifact server (`GHSL-2023-004`)

The [/upload endpoint](https://github.com/nektos/act/blob/v0.2.35/pkg/artifacts/server.go#LL103C2-L103C2) is vulnerable to path traversal as `filepath` is user controlled, and ultimately flows into `os.Mkdir` and `os.Open`.

```
router.PUT("/upload/:runId", func(w http.ResponseWriter, req *http.Request, params httprouter.Params) {
		itemPath := req.URL.Query().Get("itemPath")
		runID := params.ByName("runId")

		if req.Header.Get("Content-Encoding") == "gzip" {
			itemPath += gzipExtension
		}

		filePath := fmt.Sprintf("%s/%s", runID, itemPath)

```
### Issue 2: Arbitrary file download affecting the artifact server (`GHSL-2023-004`)

The [`/artifact` endpoint](https://github.com/nektos/act/blob/v0.2.35/pkg/artifacts/server.go#L245) is vulnerable to path traversal as the `path` variable is user-controlled, and the specified file is ultimately returned by the server.

```
router.GET("/artifact/*path", func(w http.ResponseWriter, req *http.Request, params httprouter.Params) {
		path := params.ByName("path")[1:]

		file, err := fsys.Open(path)

```
#### Impact

This issue may lead to privilege escalation.

#### Proof of Concept

* Below I have written a GitHub Action that will upload `secret.txt` into the folder above the specified artifact directory. The first call to `curl` will create the directory named `1` if it does not already exist, and the second call to `curl` will upload the `secret.txt` file to the directory above the specified artifact directory.
* When testing this POC, the `--artifact-server-path` parameter must be passed to act in order to enable the artifact server.

```
name: CI
on: push

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - run: echo "Here are some secrets" > secret.txt
    - run: curl http://<yourIPandPort>/upload/1?itemPath=secret.txt --upload-file secret.txt
    - run: curl http://<yourIPandPort>/upload/1?itemPath=../../secret.txt --upload-file secret.txt

```
## CVE

* CVE-2023-22726

## Credit

This issue was discovered and reported by GHSL team member [@Kwstubbs (Kevin Stubbings)](https://github.com/Kwstubbs).

## Contact

You can contact the GHSL team at `securitylab@github.com`, please include a reference to `GHSL-2023-004` in any communication regarding this issue.

## Product

* [Features](https://github.com/features)
* [Security](https://github.com/security)
* [Team](https://github.com/team)
* [Enterprise](https://github.com/enterprise)
* [Customer stories](https://github.com/customer-stories?type=enterprise)
* [The ReadME Project](https://github.com/readme)
* [Pricing](https://github.com/pricing)
* [Resources](https://resources.github.com)
* [Roadmap](https://github.com/github/roadmap)
* [Compare GitHub](https://resources.github.com/devops/tools/compare/)

## Platform

* [Developer API](https://developer.github.com)
* [Partners](http://partner.github.com/)
* [Atom](https://atom.io)
* [Electron](http://electron.atom.io/)
* [GitHub Desktop](https://desktop.github.com/)

## Support

* [Docs](https://docs.github.com)
* [Community Forum](https://github.community)
* [Professional Services](https://services.github.com/)
* [GitHub Skills](https://skills.github.com/)
* [Status](https://githubstatus.com/)
* [Contact GitHub](https://support.github.com)

## Company

* [About](https://github.com/about)
* [Blog](https://github.blog)
* [Careers](https://github.com/about/careers)
* [Press](https://github.com/about/press)
* [Inclusion](https://github.com/about/careers)
* [Social Impact](https://github.com/about/press)
* [Shop](https://shop.github.com)

* GitHub Inc. ©
  2024
* [Terms](https://docs.github.com/en/github/site-policy/github-terms-of-service)
* [Privacy](https://docs.github.com/en/github/site-policy/github-privacy-statement)
* Sitemap
* [What is Git?](https://github.com/git-guides)
* Manage Cookies
* Do not share my personal information



=== Content from github.com_052d302d_20250114_190342.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnektos%2Fact%2Fissues%2F1553)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnektos%2Fact%2Fissues%2F1553)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=nektos%2Fact)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[nektos](/nektos)
/
**[act](/nektos/act)**
Public

* [Notifications](/login?return_to=%2Fnektos%2Fact) You must be signed in to change notification settings
* [Fork
  1.4k](/login?return_to=%2Fnektos%2Fact)
* [Star
   56.8k](/login?return_to=%2Fnektos%2Fact)

* [Code](/nektos/act)
* [Issues
  194](/nektos/act/issues)
* [Pull requests
  24](/nektos/act/pulls)
* [Discussions](/nektos/act/discussions)
* [Actions](/nektos/act/actions)
* [Projects
  0](/nektos/act/projects)
* [Security](/nektos/act/security)
* [Insights](/nektos/act/pulse)

Additional navigation options

* [Code](/nektos/act)
* [Issues](/nektos/act/issues)
* [Pull requests](/nektos/act/pulls)
* [Discussions](/nektos/act/discussions)
* [Actions](/nektos/act/actions)
* [Projects](/nektos/act/projects)
* [Security](/nektos/act/security)
* [Insights](/nektos/act/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fnektos%2Fact%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fnektos%2Fact%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Github Security Lab: GHSL-2023-004 #1553

Closed

[Kwstubbs](/Kwstubbs) opened this issue
Jan 10, 2023
· 2 comments

Closed

# [Github Security Lab: GHSL-2023-004](#top) #1553

[Kwstubbs](/Kwstubbs) opened this issue
Jan 10, 2023
· 2 comments

Labels
[kind/bug](/nektos/act/labels/kind/bug)
Something isn't working

## Comments

[![@Kwstubbs](https://avatars.githubusercontent.com/u/11400619?s=80&u=192eb72d5b3fdf21aee803bc0c81e249e2a4a996&v=4)](/Kwstubbs)

Copy link

### **[Kwstubbs](/Kwstubbs)** commented [Jan 10, 2023](#issue-1527839406) • edited Loading

| Bug report info The GitHub Security Lab team has identified a potential security vulnerability in act. We have sent a security report to cplee@nektos.com on January 9, 2023 as there was no published security contact. Please let us know if there is a better point of contact for security issues. We highly recommend sending security reports over a private communication channel. Command used with act ``` Private ``` Describe issue Private Link to GitHub repository *No response* Workflow content ``` Private ``` Relevant log output ``` Private ``` Additional information *No response* |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@Kwstubbs](https://avatars.githubusercontent.com/u/11400619?s=40&u=192eb72d5b3fdf21aee803bc0c81e249e2a4a996&v=4)](/Kwstubbs)
[Kwstubbs](/Kwstubbs)
added
the
[kind/bug](/nektos/act/labels/kind/bug)
Something isn't working
label
[Jan 10, 2023](#event-8194862554)

[![@cplee](https://avatars.githubusercontent.com/u/2239057?s=80&u=6dc7fe22515b5cc4bcea1bef676718acf1f1944c&v=4)](/cplee)

Copy link

Contributor

### **[cplee](/cplee)** commented [Jan 10, 2023](#issuecomment-1377808868)

| [@Kwstubbs](https://github.com/Kwstubbs) - i received your email and will follow up over private channel. |
| --- |

All reactions

Sorry, something went wrong.

[![@cplee](https://avatars.githubusercontent.com/u/2239057?s=80&u=6dc7fe22515b5cc4bcea1bef676718acf1f1944c&v=4)](/cplee)

Copy link

Contributor

### **[cplee](/cplee)** commented [Jan 16, 2023](#issuecomment-1384577842)

| Fixed in [#1565](https://github.com/nektos/act/pull/1565) |
| --- |

All reactions

Sorry, something went wrong.

[![@cplee](https://avatars.githubusercontent.com/u/2239057?s=40&u=6dc7fe22515b5cc4bcea1bef676718acf1f1944c&v=4)](/cplee)
[cplee](/cplee)
closed this as [completed](/nektos/act/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Jan 16, 2023](#event-8240203199)

[![@GoVulnBot](https://avatars.githubusercontent.com/u/96493708?s=40&v=4)](/GoVulnBot)
[GoVulnBot](/GoVulnBot)
mentioned this issue
[Jan 20, 2023](#ref-issue-1551555293)

[x/vulndb: potential Go vuln in github.com/nektos/act: CVE-2023-22726
golang/vulndb#1506](/golang/vulndb/issues/1506)

Closed

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fnektos%2Fact%2Fissues%2F1553)

Assignees

No one assigned

Labels

[kind/bug](/nektos/act/labels/kind/bug)
Something isn't working

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

2 participants

[![@cplee](https://avatars.githubusercontent.com/u/2239057?s=52&v=4)](/cplee) [![@Kwstubbs](https://avatars.githubusercontent.com/u/11400619?s=52&v=4)](/Kwstubbs)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_7d1e0619_20250114_190343.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnektos%2Fact%2Fsecurity%2Fadvisories%2FGHSA-pc99-qmg4-rcff)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnektos%2Fact%2Fsecurity%2Fadvisories%2FGHSA-pc99-qmg4-rcff)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=nektos%2Fact)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[nektos](/nektos)
/
**[act](/nektos/act)**
Public

* [Notifications](/login?return_to=%2Fnektos%2Fact) You must be signed in to change notification settings
* [Fork
  1.4k](/login?return_to=%2Fnektos%2Fact)
* [Star
   56.8k](/login?return_to=%2Fnektos%2Fact)

* [Code](/nektos/act)
* [Issues
  194](/nektos/act/issues)
* [Pull requests
  24](/nektos/act/pulls)
* [Discussions](/nektos/act/discussions)
* [Actions](/nektos/act/actions)
* [Projects
  0](/nektos/act/projects)
* [Security](/nektos/act/security)
* [Insights](/nektos/act/pulse)

Additional navigation options

* [Code](/nektos/act)
* [Issues](/nektos/act/issues)
* [Pull requests](/nektos/act/pulls)
* [Discussions](/nektos/act/discussions)
* [Actions](/nektos/act/actions)
* [Projects](/nektos/act/projects)
* [Security](/nektos/act/security)
* [Insights](/nektos/act/pulse)

# Github Security Lab: GHSL-2023-004

High

[cplee](/cplee)
published
GHSA-pc99-qmg4-rcff
Jan 16, 2023

## Package

gomod

act
([Go](/advisories?query=ecosystem%3Ago))

## Affected versions

<=0.2.39

## Patched versions

0.2.40

## Description

### Impact

The artifact server that stores artifacts from Github Action runs does not sanitize path inputs. This allows an attacker to download and overwrite arbitrary files on the host from a Github Action. This issue may lead to privilege escalation.

#### Issue 1: Arbitrary file upload in artifact server (GHSL-2023-004)

The [/upload endpoint](https://github.com/nektos/act/blob/v0.2.35/pkg/artifacts/server.go#LL103C2-L103C2) is vulnerable to path traversal as filepath is user controlled, and ultimately flows into os.Mkdir and os.Open.

```
router.PUT("/upload/:runId", func(w http.ResponseWriter, req *http.Request, params httprouter.Params) {
		itemPath := req.URL.Query().Get("itemPath")
		runID := params.ByName("runId")

		if req.Header.Get("Content-Encoding") == "gzip" {
			itemPath += gzipExtension
		}

		filePath := fmt.Sprintf("%s/%s", runID, itemPath)

```
#### Issue 2: Arbitrary file download in artifact server (GHSL-2023-004)

The [/artifact endpoint](https://github.com/nektos/act/blob/v0.2.35/pkg/artifacts/server.go#L245) is vulnerable to path traversal as the path is variable is user controlled, and the specified file is ultimately returned by the server.

```
router.GET("/artifact/*path", func(w http.ResponseWriter, req *http.Request, params httprouter.Params) {
		path := params.ByName("path")[1:]

		file, err := fsys.Open(path)

```
#### Proof of Concept

Below I have written a Github Action that will upload secret.txt into the folder above the specified artifact directory. The first call to curl will create the directory named 1 if it does not already exist, and the second call to curl will upload the secret.txt file to the directory above the specified artifact directory.

When testing this POC, the `--artifact-server-path` parameter must be passed to act in order to enable the artifact server.

Replace yourIPandPort with the IP and port of the server. An attacker can enumerate /proc/net/tcp in order to find the artifact server IP and port, but this is out of the scope of this report. Please let me know if you would like a copy of this script.

```
name: CI
on: push

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - run: echo "Here are some secrets" > secret.txt
    - run: curl http://<yourIPandPort>/upload/1?itemPath=secret.txt --upload-file secret.txt
    - run: curl http://<yourIPandPort>/upload/1?itemPath=../../secret.txt --upload-file secret.txt

```
### Remediation

1. During implementation of [Open and OpenAtEnd for FS](https://github.com/nektos/act/blob/master/pkg/artifacts/server.go#L65), please ensure to use ValidPath() to check against path traversal. See more here: <https://pkg.go.dev/io/fs#FS>
2. Clean the user-provided paths manually

### Patches

No patch yet.

### Workarounds

Avoid use of artifact server with `--artifact-server-path`

### References

This issue was discovered and reported by GHSL team member [@Kwstubbs (Kevin Stubbings)](https://github.com/Kwstubbs).

### Severity

High

### CVE ID

CVE-2023-22726

### Weaknesses

No CWEs

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_11401cbe_20250114_190339.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnektos%2Fact%2Fblob%2Fv0.2.35%2Fpkg%2Fartifacts%2Fserver.go)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnektos%2Fact%2Fblob%2Fv0.2.35%2Fpkg%2Fartifacts%2Fserver.go)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=nektos%2Fact)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[nektos](/nektos)
/
**[act](/nektos/act)**
Public

* [Notifications](/login?return_to=%2Fnektos%2Fact) You must be signed in to change notification settings
* [Fork
  1.4k](/login?return_to=%2Fnektos%2Fact)
* [Star
   56.8k](/login?return_to=%2Fnektos%2Fact)

* [Code](/nektos/act/tree/v0.2.35)
* [Issues
  194](/nektos/act/issues)
* [Pull requests
  24](/nektos/act/pulls)
* [Discussions](/nektos/act/discussions)
* [Actions](/nektos/act/actions)
* [Projects
  0](/nektos/act/projects)
* [Security](/nektos/act/security)
* [Insights](/nektos/act/pulse)

Additional navigation options

* [Code](/nektos/act/tree/v0.2.35)
* [Issues](/nektos/act/issues)
* [Pull requests](/nektos/act/pulls)
* [Discussions](/nektos/act/discussions)
* [Actions](/nektos/act/actions)
* [Projects](/nektos/act/projects)
* [Security](/nektos/act/security)
* [Insights](/nektos/act/pulse)

## Files

 v0.2.35
## Breadcrumbs

1. [act](/nektos/act/tree/v0.2.35)
2. /[pkg](/nektos/act/tree/v0.2.35/pkg)
3. /[artifacts](/nektos/act/tree/v0.2.35/pkg/artifacts)
/
# server.go

Copy path Blame  Blame
## Latest commit

## History

[History](/nektos/act/commits/v0.2.35/pkg/artifacts/server.go)306 lines (250 loc) · 6.79 KB v0.2.35
## Breadcrumbs

1. [act](/nektos/act/tree/v0.2.35)
2. /[pkg](/nektos/act/tree/v0.2.35/pkg)
3. /[artifacts](/nektos/act/tree/v0.2.35/pkg/artifacts)
/
# server.go

Top
## File metadata and controls

* Code
* Blame

306 lines (250 loc) · 6.79 KB[Raw](https://github.com/nektos/act/raw/refs/tags/v0.2.35/pkg/artifacts/server.go)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306package artifacts
import ( "context" "encoding/json" "errors" "fmt" "io" "io/fs" "net/http" "os" "path" "path/filepath" "strings" "time"
 "github.com/julienschmidt/httprouter" "github.com/nektos/act/pkg/common")
type FileContainerResourceURL struct { FileContainerResourceURL string `json:"fileContainerResourceUrl"`}
type NamedFileContainerResourceURL struct { Name string `json:"name"` FileContainerResourceURL string `json:"fileContainerResourceUrl"`}
type NamedFileContainerResourceURLResponse struct { Count int `json:"count"` Value []NamedFileContainerResourceURL `json:"value"`}
type ContainerItem struct { Path string `json:"path"` ItemType string `json:"itemType"` ContentLocation string `json:"contentLocation"`}
type ContainerItemResponse struct { Value []ContainerItem `json:"value"`}
type ResponseMessage struct { Message string `json:"message"`}
type MkdirFS interface { fs.FS MkdirAll(path string, perm fs.FileMode) error Open(name string) (fs.File, error) OpenAtEnd(name string) (fs.File, error)}
type MkdirFsImpl struct { dir string fs.FS}
func (fsys MkdirFsImpl) MkdirAll(path string, perm fs.FileMode) error { return os.MkdirAll(fsys.dir+"/"+path, perm)}
func (fsys MkdirFsImpl) Open(name string) (fs.File, error) { return os.OpenFile(fsys.dir+"/"+name, os.O\_CREATE|os.O\_RDWR|os.O\_TRUNC, 0644)}
func (fsys MkdirFsImpl) OpenAtEnd(name string) (fs.File, error) { file, err := os.OpenFile(fsys.dir+"/"+name, os.O\_CREATE|os.O\_RDWR, 0644)
 if err != nil { return nil, err }
 \_, err = file.Seek(0, os.SEEK\_END) if err != nil { return nil, err }
 return file, nil}
var gzipExtension = ".gz\_\_"
func uploads(router \*httprouter.Router, fsys MkdirFS) { router.POST("/\_apis/pipelines/workflows/:runId/artifacts", func(w http.ResponseWriter, req \*http.Request, params httprouter.Params) { runID := params.ByName("runId")
 json, err := json.Marshal(FileContainerResourceURL{ FileContainerResourceURL: fmt.Sprintf("http://%s/upload/%s", req.Host, runID), }) if err != nil { panic(err) }
 \_, err = w.Write(json) if err != nil { panic(err) } })
 router.PUT("/upload/:runId", func(w http.ResponseWriter, req \*http.Request, params httprouter.Params) { itemPath := req.URL.Query().Get("itemPath") runID := params.ByName("runId")
 if req.Header.Get("Content-Encoding") == "gzip" { itemPath += gzipExtension }
 filePath := fmt.Sprintf("%s/%s", runID, itemPath)
 err := fsys.MkdirAll(path.Dir(filePath), os.ModePerm) if err != nil { panic(err) }
 file, err := func() (fs.File, error) { contentRange := req.Header.Get("Content-Range") if contentRange != "" && !strings.HasPrefix(contentRange, "bytes 0-") { return fsys.OpenAtEnd(filePath) } return fsys.Open(filePath) }()
 if err != nil { panic(err) } defer file.Close()
 writer, ok := file.(io.Writer) if !ok { panic(errors.New("File is not writable")) }
 if req.Body == nil { panic(errors.New("No body given")) }
 \_, err = io.Copy(writer, req.Body) if err != nil { panic(err) }
 json, err := json.Marshal(ResponseMessage{ Message: "success", }) if err != nil { panic(err) }
 \_, err = w.Write(json) if err != nil { panic(err) } })
 router.PATCH("/\_apis/pipelines/workflows/:runId/artifacts", func(w http.ResponseWriter, req \*http.Request, params httprouter.Params) { json, err := json.Marshal(ResponseMessage{ Message: "success", }) if err != nil { panic(err) }
 \_, err = w.Write(json) if err != nil { panic(err) } })}
func downloads(router \*httprouter.Router, fsys fs.FS) { router.GET("/\_apis/pipelines/workflows/:runId/artifacts", func(w http.ResponseWriter, req \*http.Request, params httprouter.Params) { runID := params.ByName("runId")
 entries, err := fs.ReadDir(fsys, runID) if err != nil { panic(err) }
 var list []NamedFileContainerResourceURL for \_, entry := range entries { list = append(list, NamedFileContainerResourceURL{ Name: entry.Name(), FileContainerResourceURL: fmt.Sprintf("http://%s/download/%s", req.Host, runID), }) }
 json, err := json.Marshal(NamedFileContainerResourceURLResponse{ Count: len(list), Value: list, }) if err != nil { panic(err) }
 \_, err = w.Write(json) if err != nil { panic(err) } })
 router.GET("/download/:container", func(w http.ResponseWriter, req \*http.Request, params httprouter.Params) { container := params.ByName("container") itemPath := req.URL.Query().Get("itemPath") dirPath := fmt.Sprintf("%s/%s", container, itemPath)
 var files []ContainerItem err := fs.WalkDir(fsys, dirPath, func(path string, entry fs.DirEntry, err error) error { if !entry.IsDir() { rel, err := filepath.Rel(dirPath, path) if err != nil { panic(err) }
 // if it was upload as gzip rel = strings.TrimSuffix(rel, gzipExtension)
 files = append(files, ContainerItem{ Path: fmt.Sprintf("%s/%s", itemPath, rel), ItemType: "file", ContentLocation: fmt.Sprintf("http://%s/artifact/%s/%s/%s", req.Host, container, itemPath, rel), }) } return nil }) if err != nil { panic(err) }
 json, err := json.Marshal(ContainerItemResponse{ Value: files, }) if err != nil { panic(err) }
 \_, err = w.Write(json) if err != nil { panic(err) } })
 router.GET("/artifact/\*path", func(w http.ResponseWriter, req \*http.Request, params httprouter.Params) { path := params.ByName("path")[1:]
 file, err := fsys.Open(path) if err != nil { // try gzip file file, err = fsys.Open(path + gzipExtension) if err != nil { panic(err) } w.Header().Add("Content-Encoding", "gzip") }
 \_, err = io.Copy(w, file) if err != nil { panic(err) } })}
func Serve(ctx context.Context, artifactPath string, port string) context.CancelFunc { serverContext, cancel := context.WithCancel(ctx) logger := common.Logger(serverContext)
 if artifactPath == "" { return cancel }
 router := httprouter.New()
 logger.Debugf("Artifacts base path '%s'", artifactPath) fs := os.DirFS(artifactPath) uploads(router, MkdirFsImpl{artifactPath, fs}) downloads(router, fs) ip := common.GetOutboundIP().String()
 server := &http.Server{ Addr: fmt.Sprintf("%s:%s", ip, port), ReadHeaderTimeout: 2 \* time.Second, Handler: router, }
 // run server go func() { logger.Infof("Start server on http://%s:%s", ip, port) if err := server.ListenAndServe(); err != nil && err != http.ErrServerClosed { logger.Fatal(err) } }()
 // wait for cancel to gracefully shutdown server go func() { <-serverContext.Done()
 if err := server.Shutdown(ctx); err != nil { logger.Errorf("Failed shutdown gracefully - force shutdown: %v", err) server.Close() } }()
 return cancel}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


