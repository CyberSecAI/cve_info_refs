```
commit 5c6baf808f409b69ad0799a551a704177b5a7ec1
Author: Eric W. Biederman <ebiederm@xmission.com>
Date:   Tue Mar 8 13:04:19 2022 -0600

    coredump: Use the vma snapshot in fill_files_note

    commit 390031c942116d4733310f0684beb8db19885fe6 upstream.

    Matthew Wilcox reported that there is a missing mmap_lock in
    file_files_note that could possibly lead to a user after free.

    Solve this by using the existing vma snapshot for consistency
    and to avoid the need to take the mmap_lock anywhere in the
    coredump code except for dump_vma_snapshot.

    Update the dump_vma_snapshot to capture vm_pgoff and vm_file
    that are neeeded by fill_files_note.

    Add free_vma_snapshot to free the captured values of vm_file.
```

- **Root cause of vulnerability**: A missing `mmap_lock` in `file_files_note` could lead to a use-after-free vulnerability.
- **Weaknesses/vulnerabilities present**: Use-after-free vulnerability due to missing lock.
- **Impact of exploitation**: A user after free could be triggered.
- **Attack vectors**: The coredump code is triggered and can reach the vulnerable code path.
- **Required attacker capabilities/position**: User-level access capable of triggering a coredump.