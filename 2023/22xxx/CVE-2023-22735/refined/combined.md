=== Content from zulip.readthedocs.io_b242aa2a_20250114_230139.html ===

[![Logo](../_static/zulip-logo.svg)](../index.html)

* [Zulip homepage](https://zulip.com/)
* [Overview](../overview/index.html)
  + [Zulip overview](../overview/readme.html)
    - [Getting started](../overview/readme.html#getting-started)
  + [Zulip architectural overview](../overview/architecture-overview.html)
    - [Key codebases](../overview/architecture-overview.html#key-codebases)
    - [Usage assumptions and concepts](../overview/architecture-overview.html#usage-assumptions-and-concepts)
    - [Components](../overview/architecture-overview.html#components)
      * [Django and Tornado](../overview/architecture-overview.html#django-and-tornado)
      * [nginx](../overview/architecture-overview.html#nginx)
      * [Supervisor](../overview/architecture-overview.html#supervisor)
      * [memcached](../overview/architecture-overview.html#memcached)
      * [Redis](../overview/architecture-overview.html#redis)
      * [RabbitMQ](../overview/architecture-overview.html#rabbitmq)
      * [PostgreSQL](../overview/architecture-overview.html#postgresql)
      * [Nagios](../overview/architecture-overview.html#nagios)
    - [Glossary](../overview/architecture-overview.html#glossary)
  + [Directory structure](../overview/directory-structure.html)
    - [Core Python files](../overview/directory-structure.html#core-python-files)
    - [HTML templates](../overview/directory-structure.html#html-templates)
    - [JavaScript, TypeScript, and other frontend assets](../overview/directory-structure.html#javascript-typescript-and-other-frontend-assets)
    - [Tests](../overview/directory-structure.html#tests)
    - [Management commands](../overview/directory-structure.html#management-commands)
    - [Scripts](../overview/directory-structure.html#scripts)
    - [API and bots](../overview/directory-structure.html#api-and-bots)
    - [Production Puppet configuration](../overview/directory-structure.html#production-puppet-configuration)
    - [Additional Django apps](../overview/directory-structure.html#additional-django-apps)
    - [Jinja2 compatibility files](../overview/directory-structure.html#jinja2-compatibility-files)
    - [Translation files](../overview/directory-structure.html#translation-files)
    - [Documentation](../overview/directory-structure.html#documentation)
  + [Release lifecycle](../overview/release-lifecycle.html)
    - [Server and web app](../overview/release-lifecycle.html#server-and-web-app)
      * [Stable releases](../overview/release-lifecycle.html#stable-releases)
      * [Git versions](../overview/release-lifecycle.html#git-versions)
      * [Compatibility and upgrading](../overview/release-lifecycle.html#compatibility-and-upgrading)
      * [Security releases](../overview/release-lifecycle.html#security-releases)
      * [Upgrade nag](../overview/release-lifecycle.html#upgrade-nag)
      * [Operating system support](../overview/release-lifecycle.html#operating-system-support)
      * [Server roadmap](../overview/release-lifecycle.html#server-roadmap)
    - [Client apps](../overview/release-lifecycle.html#client-apps)
    - [API bindings](../overview/release-lifecycle.html#api-bindings)
  + [Version history](../overview/changelog.html)
    - [Zulip Server 10.x series (development)](../overview/changelog.html#zulip-server-10-x-series-development)
      * [Zulip Server 10.0](../overview/changelog.html#zulip-server-10-0)
    - [Zulip Server 9.x series](../overview/changelog.html#zulip-server-9-x-series)
      * [Zulip Server 9.3](../overview/changelog.html#zulip-server-9-3)
      * [Zulip Server 9.2](../overview/changelog.html#zulip-server-9-2)
      * [Zulip Server 9.1](../overview/changelog.html#zulip-server-9-1)
      * [Zulip Server 9.0](../overview/changelog.html#zulip-server-9-0)
    - [Zulip Server 8.x series](../overview/changelog.html#zulip-server-8-x-series)
      * [Zulip Server 8.5](../overview/changelog.html#zulip-server-8-5)
      * [Zulip Server 8.4](../overview/changelog.html#zulip-server-8-4)
      * [Zulip Server 8.3](../overview/changelog.html#zulip-server-8-3)
      * [Zulip Server 8.2](../overview/changelog.html#zulip-server-8-2)
      * [Zulip Server 8.1](../overview/changelog.html#zulip-server-8-1)
      * [Zulip Server 8.0](../overview/changelog.html#zulip-server-8-0)
    - [Zulip Server 7.x series](../overview/changelog.html#zulip-server-7-x-series)
      * [Zulip Server 7.5](../overview/changelog.html#zulip-server-7-5)
      * [Zulip Server 7.4](../overview/changelog.html#zulip-server-7-4)
      * [Zulip Server 7.3](../overview/changelog.html#zulip-server-7-3)
      * [Zulip Server 7.2](../overview/changelog.html#zulip-server-7-2)
      * [Zulip Server 7.1](../overview/changelog.html#zulip-server-7-1)
      * [Zulip Server 7.0](../overview/changelog.html#zulip-server-7-0)
    - [Zulip Server 6.x series](../overview/changelog.html#zulip-server-6-x-series)
      * [Zulip Server 6.2](../overview/changelog.html#zulip-server-6-2)
      * [Zulip Server 6.1](../overview/changelog.html#zulip-server-6-1)
      * [Zulip Server 6.0](../overview/changelog.html#zulip-server-6-0)
    - [Zulip Server 5.x series](../overview/changelog.html#zulip-server-5-x-series)
      * [Zulip Server 5.7](../overview/changelog.html#zulip-server-5-7)
      * [Zulip Server 5.6](../overview/changelog.html#zulip-server-5-6)
      * [Zulip Server 5.5](../overview/changelog.html#zulip-server-5-5)
      * [Zulip Server 5.4](../overview/changelog.html#zulip-server-5-4)
      * [Zulip Server 5.3](../overview/changelog.html#zulip-server-5-3)
      * [Zulip Server 5.2](../overview/changelog.html#zulip-server-5-2)
      * [Zulip Server 5.1](../overview/changelog.html#zulip-server-5-1)
      * [Zulip Server 5.0](../overview/changelog.html#zulip-server-5-0)
    - [Zulip Server 4.x series](../overview/changelog.html#zulip-server-4-x-series)
      * [Zulip Server 4.11](../overview/changelog.html#zulip-server-4-11)
      * [Zulip Server 4.10](../overview/changelog.html#zulip-server-4-10)
      * [Zulip Server 4.9](../overview/changelog.html#zulip-server-4-9)
      * [Zulip Server 4.8](../overview/changelog.html#zulip-server-4-8)
      * [Zulip Server 4.7](../overview/changelog.html#zulip-server-4-7)
      * [Zulip Server 4.6](../overview/changelog.html#zulip-server-4-6)
      * [Zulip Server 4.5](../overview/changelog.html#zulip-server-4-5)
      * [Zulip Server 4.4](../overview/changelog.html#zulip-server-4-4)
      * [Zulip Server 4.3](../overview/changelog.html#zulip-server-4-3)
      * [Zulip Server 4.2](../overview/changelog.html#zulip-server-4-2)
      * [Zulip Server 4.1](../overview/changelog.html#zulip-server-4-1)
      * [Zulip Server 4.0](../overview/changelog.html#zulip-server-4-0)
    - [Zulip Server 3.x series](../overview/changelog.html#zulip-server-3-x-series)
      * [Zulip Server 3.4](../overview/changelog.html#zulip-server-3-4)
      * [Zulip Server 3.3](../overview/changelog.html#zulip-server-3-3)
      * [Zulip Server 3.2](../overview/changelog.html#zulip-server-3-2)
      * [Zulip Server 3.1](../overview/changelog.html#zulip-server-3-1)
      * [Zulip Server 3.0](../overview/changelog.html#zulip-server-3-0)
    - [Zulip Server 2.1.x series](../overview/changelog.html#zulip-server-2-1-x-series)
      * [Zulip Server 2.1.8](../overview/changelog.html#zulip-server-2-1-8)
      * [Zulip Server 2.1.7](../overview/changelog.html#zulip-server-2-1-7)
      * [Zulip Server 2.1.6](../overview/changelog.html#zulip-server-2-1-6)
      * [Zulip Server 2.1.5](../overview/changelog.html#zulip-server-2-1-5)
      * [Zulip Server 2.1.4](../overview/changelog.html#zulip-server-2-1-4)
      * [Zulip Server 2.1.3](../overview/changelog.html#zulip-server-2-1-3)
      * [Zulip Server 2.1.2](../overview/changelog.html#zulip-server-2-1-2)
      * [Zulip Server 2.1.1](../overview/changelog.html#zulip-server-2-1-1)
      * [Zulip Server 2.1.0](../overview/changelog.html#zulip-server-2-1-0)
    - [Zulip Server 2.0.x series](../overview/changelog.html#zulip-server-2-0-x-series)
      * [Zulip Server 2.0.8](../overview/changelog.html#zulip-server-2-0-8)
      * [Zulip Server 2.0.7](../overview/changelog.html#zulip-server-2-0-7)
      * [Zulip Server 2.0.6](../overview/changelog.html#zulip-server-2-0-6)
      * [Zulip Server 2.0.5](../overview/changelog.html#zulip-server-2-0-5)
      * [Zulip Server 2.0.4](../overview/changelog.html#zulip-server-2-0-4)
      * [Zulip Server 2.0.3](../overview/changelog.html#zulip-server-2-0-3)
      * [Zulip Server 2.0.2](../overview/changelog.html#zulip-server-2-0-2)
      * [Zulip Server 2.0.1](../overview/changelog.html#zulip-server-2-0-1)
      * [Zulip Server 2.0.0](../overview/changelog.html#zulip-server-2-0-0)
    - [Zulip Server 1.9.x series](../overview/changelog.html#zulip-server-1-9-x-series)
      * [Zulip Server 1.9.2](../overview/changelog.html#zulip-server-1-9-2)
      * [Zulip Server 1.9.1](../overview/changelog.html#zulip-server-1-9-1)
      * [Zulip Server 1.9.0](../overview/changelog.html#zulip-server-1-9-0)
    - [Zulip Server 1.8.x series](../overview/changelog.html#zulip-server-1-8-x-series)
      * [Zulip Server 1.8.1](../overview/changelog.html#zulip-server-1-8-1)
      * [Zulip Server 1.8.0](../overview/changelog.html#zulip-server-1-8-0)
    - [Zulip Server 1.7.x series](../overview/changelog.html#zulip-server-1-7-x-series)
      * [Zulip Server 1.7.2](../overview/changelog.html#zulip-server-1-7-2)
      * [Zulip Server 1.7.1](../overview/changelog.html#zulip-server-1-7-1)
      * [Zulip Server 1.7.0](../overview/changelog.html#zulip-server-1-7-0)
    - [Zulip Server 1.6.x and older](../overview/changelog.html#zulip-server-1-6-x-and-older)
      * [Zulip Server 1.6.0](../overview/changelog.html#zulip-server-1-6-0)
      * [Zulip Server 1.5.2](../overview/changelog.html#zulip-server-1-5-2)
      * [Zulip Server 1.5.1](../overview/changelog.html#zulip-server-1-5-1)
      * [Zulip Server 1.5.0](../overview/changelog.html#zulip-server-1-5-0)
      * [Zulip Server 1.4.3](../overview/changelog.html#zulip-server-1-4-3)
      * [Zulip Server 1.4.2](../overview/changelog.html#zulip-server-1-4-2)
      * [Zulip Server 1.4.1](../overview/changelog.html#zulip-server-1-4-1)
      * [Zulip Server 1.4.0](../overview/changelog.html#zulip-server-1-4-0)
      * [Zulip Server 1.3.13](../overview/changelog.html#zulip-server-1-3-13)
      * [Zulip Server 1.3.12](../overview/changelog.html#zulip-server-1-3-12)
      * [Zulip Server 1.3.11](../overview/changelog.html#zulip-server-1-3-11)
      * [Zulip Server 1.3.10](../overview/changelog.html#zulip-server-1-3-10)
      * [Zulip Server 1.3.9](../overview/changelog.html#zulip-server-1-3-9)
      * [Zulip Server 1.3.8](../overview/changelog.html#zulip-server-1-3-8)
      * [Zulip Server 1.3.7](../overview/changelog.html#zulip-server-1-3-7)
    - [Upgrade notes](../overview/changelog.html#upgrade-notes)

* [Zulip in production](index.html)
  + [Requirements and scalability](requirements.html)
    - [Server](requirements.html#server)
      * [General](requirements.html#general)
      * [Operating system](requirements.html#operating-system)
      * [Hardware specifications](requirements.html#hardware-specifications)
      * [Network and security specifications](requirements.html#network-and-security-specifications)
    - [Credentials needed](requirements.html#credentials-needed)
      * [SSL certificate](requirements.html#ssl-certificate)
      * [Outgoing email](requirements.html#outgoing-email)
    - [Scalability](requirements.html#scalability)
  + [Install a Zulip server](install.html)
    - [Installation process overview](install.html#installation-process-overview)
    - [Step 0: Set up a base server](install.html#step-0-set-up-a-base-server)
    - [Step 1: Download the latest release](install.html#step-1-download-the-latest-release)
    - [Step 2: Install Zulip](install.html#step-2-install-zulip)
      * [Installer options](install.html#installer-options)
    - [Step 3: Create a Zulip organization, and log in](install.html#step-3-create-a-zulip-organization-and-log-in)
    - [Getting started with Zulip](install.html#getting-started-with-zulip)
  + [Troubleshooting and monitoring](troubleshooting.html)
    - [Overview and resources](troubleshooting.html#overview-and-resources)
    - [Using supervisorctl](troubleshooting.html#using-supervisorctl)
      * [Checking status with `supervisorctl status`](troubleshooting.html#checking-status-with-supervisorctl-status)
      * [Restarting services with `supervisorctl restart`](troubleshooting.html#restarting-services-with-supervisorctl-restart)
      * [Stopping services with `supervisorctl stop`](troubleshooting.html#stopping-services-with-supervisorctl-stop)
    - [Troubleshooting services](troubleshooting.html#troubleshooting-services)
      * [Restrict unattended upgrades](troubleshooting.html#restrict-unattended-upgrades)
    - [Monitoring](troubleshooting.html#monitoring)
      * [Nagios configuration](troubleshooting.html#nagios-configuration)
    - [Memory leak mitigation](troubleshooting.html#memory-leak-mitigation)
    - [Troubleshooting the Zulip installer](troubleshooting.html#troubleshooting-the-zulip-installer)
      * [The `zulip` user’s password.](troubleshooting.html#the-zulip-user-s-password)
  + [Management commands](management-commands.html)
    - [Running management commands](management-commands.html#running-management-commands)
      * [Accessing an organization’s `string_id`](management-commands.html#accessing-an-organization-s-string-id)
    - [manage.py shell](management-commands.html#manage-py-shell)
    - [Other useful manage.py commands](management-commands.html#other-useful-manage-py-commands)
    - [Custom management commands](management-commands.html#custom-management-commands)
  + [Server configuration](settings.html)
    - [Making changes](settings.html#making-changes)
    - [Specific settings](settings.html#specific-settings)
      * [Domain and email settings](settings.html#domain-and-email-settings)
      * [Authentication backends](settings.html#authentication-backends)
      * [Mobile and desktop apps](settings.html#mobile-and-desktop-apps)
      * [Terms of Service and Privacy policy](settings.html#terms-of-service-and-privacy-policy)
      * [Miscellaneous server settings](settings.html#miscellaneous-server-settings)
    - [Zulip announcement list](settings.html#zulip-announcement-list)
    - [Enjoy your Zulip installation!](settings.html#enjoy-your-zulip-installation)
  + [System configuration](system-configuration.html)
    - [Truthy values](system-configuration.html#truthy-values)
    - [`[machine]`](system-configuration.html#machine)
      * [`puppet_classes`](system-configuration.html#puppet-classes)
      * [`pgroonga`](system-configuration.html#pgroonga)
      * [`timesync`](system-configuration.html#timesync)
    - [`[deployment]`](system-configuration.html#deployment)
      * [`deploy_options`](system-configuration.html#deploy-options)
      * [`git_repo_url`](system-configuration.html#git-repo-url)
    - [`[application_server]`](system-configuration.html#application-server)
      * [`http_only`](system-configuration.html#http-only)
      * [`nginx_listen_port`](system-configuration.html#nginx-listen-port)
      * [`nginx_worker_connections`](system-configuration.html#nginx-worker-connections)
      * [`queue_workers_multiprocess`](system-configuration.html#queue-workers-multiprocess)
      * [`rolling_restart`](system-configuration.html#rolling-restart)
      * [`service_file_descriptor_limit`](system-configuration.html#service-file-descriptor-limit)
      * [`s3_memory_cache_size`](system-configuration.html#s3-memory-cache-size)
      * [`s3_disk_cache_size`](system-configuration.html#s3-disk-cache-size)
      * [`s3_cache_inactive_time`](system-configuration.html#s3-cache-inactive-time)
      * [`thumbnail_workers`](system-configuration.html#thumbnail-workers)
      * [`nameserver`](system-configuration.html#nameserver)
      * [`uwsgi_listen_backlog_limit`](system-configuration.html#uwsgi-listen-backlog-limit)
      * [`uwsgi_processes`](system-configuration.html#uwsgi-processes)
      * [`access_log_retention_days`](system-configuration.html#access-log-retention-days)
      * [`katex_server`](system-configuration.html#katex-server)
      * [`katex_server_port`](system-configuration.html#katex-server-port)
    - [`[postfix]`](system-configuration.html#postfix)
      * [`mailname`](system-configuration.html#mailname)
    - [`[postgresql]`](system-configuration.html#postgresql)
      * [`effective_io_concurrency`](system-configuration.html#effective-io-concurrency)
      * [`listen_addresses`](system-configuration.html#listen-addresses)
      * [`random_page_cost`](system-configuration.html#random-page-cost)
      * [`replication_primary`](system-configuration.html#replication-primary)
      * [`replication_user`](system-configuration.html#replication-user)
      * [`skip_backups`](system-configuration.html#skip-backups)
      * [`backups_disk_concurrency`](system-configuration.html#backups-disk-concurrency)
      * [`backups_directory`](system-configuration.html#backups-directory)
      * [`backups_incremental`](system-configuration.html#backups-incremental)
      * [`backups_storage_class`](system-configuration.html#backups-storage-class)
      * [`backups_compression_method`](system-configuration.html#backups-compression-method)
      * [`missing_dictionaries`](system-configuration.html#missing-dictionaries)
      * [`ssl_ca_file`](system-configuration.html#ssl-ca-file)
      * [`ssl_cert_file`](system-configuration.html#ssl-cert-file)
      * [`ssl_key_file`](system-configuration.html#ssl-key-file)
      * [`ssl_mode`](system-configuration.html#ssl-mode)
      * [`version`](system-configuration.html#version)
    - [`[memcached]`](system-configuration.html#memcached)
      * [`memory`](system-configuration.html#memory)
      * [`max_item_size`](system-configuration.html#max-item-size)
      * [`size_reporting`](system-configuration.html#size-reporting)
    - [`[loadbalancer]`](system-configuration.html#loadbalancer)
      * [`ips`](system-configuration.html#ips)
    - [`[http_proxy]`](system-configuration.html#http-proxy)
      * [`host`](system-configuration.html#host)
      * [`port`](system-configuration.html#port)
      * [`listen_address`](system-configuration.html#listen-address)
      * [`enable_for_camo`](system-configuration.html#enable-for-camo)
    - [`[sentry]`](system-configuration.html#sentry)
      * [`organization`](system-configuration.html#organization)
      * [`project`](system-configuration.html#project)
  + [Mobile push notification service](mobile-push-notifications.html)
    - [Signing up](mobile-push-notifications.html#signing-up)
    - [Plan management](mobile-push-notifications.html#plan-management)
      * [Plan management for a Zulip organization](mobile-push-notifications.html#plan-management-for-a-zulip-organization)
      * [Plan management for an entire Zulip server](mobile-push-notifications.html#plan-management-for-an-entire-zulip-server)
    - [Why a push notification service is necessary](mobile-push-notifications.html#why-a-push-notification-service-is-necessary)
    - [Security and privacy](mobile-push-notifications.html#security-and-privacy)
      * [Uploading basic metadata](mobile-push-notifications.html#uploading-basic-metadata)
      * [Uploading usage statistics](mobile-push-notifications.html#uploading-usage-statistics)
    - [Rate limits](mobile-push-notifications.html#rate-limits)
    - [Updating your server’s registration](mobile-push-notifications.html#updating-your-server-s-registration)
    - [Deactivating your server’s registration](mobile-push-notifications.html#deactivating-your-server-s-registration)
      * [Pausing use of the Mobile Push Notification Service](mobile-push-notifications.html#pausing-use-of-the-mobile-push-notification-service)
    - [Sending push notifications directly from your server](mobile-push-notifications.html#sending-push-notifications-directly-from-your-server)
  + Upgrade Zulip
    - [Upgrading to a release](#upgrading-to-a-release)
    - [Upgrading from a Git repository](#upgrading-from-a-git-repository)
    - [Updating `settings.py` inline documentation](#updating-settings-py-inline-documentation)
    - [Troubleshooting and rollback](#troubleshooting-and-rollback)
      * [Rolling back to a prior version](#rolling-back-to-a-prior-version)
    - [Deployment hooks](#deployment-hooks)
    - [Preserving local changes to service configuration files](#preserving-local-changes-to-service-configuration-files)
      * [nginx configuration changes](#nginx-configuration-changes)
    - [Upgrading the operating system](#upgrading-the-operating-system)
      * [Upgrading from Ubuntu 22.04 Jammy to 24.04 Noble](#upgrading-from-ubuntu-22-04-jammy-to-24-04-noble)
      * [Upgrading from Ubuntu 20.04 Focal to 22.04 Jammy](#upgrading-from-ubuntu-20-04-focal-to-22-04-jammy)
      * [Upgrading from Ubuntu 18.04 Bionic to 20.04 Focal](#upgrading-from-ubuntu-18-04-bionic-to-20-04-focal)
      * [Upgrading from Ubuntu 16.04 Xenial to 18.04 Bionic](#upgrading-from-ubuntu-16-04-xenial-to-18-04-bionic)
      * [Upgrading from Ubuntu 14.04 Trusty to 16.04 Xenial](#upgrading-from-ubuntu-14-04-trusty-to-16-04-xenial)
      * [Upgrading from Debian 11 to 12](#upgrading-from-debian-11-to-12)
      * [Upgrading from Debian 10 to 11](#upgrading-from-debian-10-to-11)
      * [Upgrading from Debian 9 to 10](#upgrading-from-debian-9-to-10)
    - [Upgrading PostgreSQL](#upgrading-postgresql)
  + [Modify Zulip](modify.html)
    - [Making changes](modify.html#making-changes)
      * [Upgrading to future releases](modify.html#upgrading-to-future-releases)
      * [Making changes with docker-zulip](modify.html#making-changes-with-docker-zulip)
    - [Applying changes from `main`](modify.html#applying-changes-from-main)
      * [Applying a small change](modify.html#applying-a-small-change)
      * [Upgrading to `main`](modify.html#upgrading-to-main)
    - [Contributing patches](modify.html#contributing-patches)
  + [Security model](security-model.html)
    - [Secure your Zulip server like your email server](security-model.html#secure-your-zulip-server-like-your-email-server)
    - [Encryption and authentication](security-model.html#encryption-and-authentication)
      * [Passwords](security-model.html#passwords)
    - [Messages and history](security-model.html#messages-and-history)
    - [Users and bots](security-model.html#users-and-bots)
    - [User-uploaded content and user-generated requests](security-model.html#user-uploaded-content-and-user-generated-requests)
    - [Rate limiting](security-model.html#rate-limiting)
    - [Final notes and security response](security-model.html#final-notes-and-security-response)
  + [Authentication methods](authentication-methods.html)
    - [Email and password](authentication-methods.html#email-and-password)
    - [Plug-and-play SSO (Google, GitHub, GitLab)](authentication-methods.html#plug-and-play-sso-google-github-gitlab)
    - [LDAP (including Active Directory)](authentication-methods.html#ldap-including-active-directory)
      * [Synchronizing data](authentication-methods.html#synchronizing-data)
      * [Multiple LDAP searches](authentication-methods.html#multiple-ldap-searches)
      * [Restricting access to an LDAP group](authentication-methods.html#restricting-access-to-an-ldap-group)
      * [Restricting LDAP user access to specific organizations](authentication-methods.html#restricting-ldap-user-access-to-specific-organizations)
      * [Troubleshooting](authentication-methods.html#troubleshooting)
    - [SAML](authentication-methods.html#saml)
      * [IdP-initiated SSO](authentication-methods.html#idp-initiated-sso)
      * [Restricting access to specific organizations](authentication-methods.html#restricting-access-to-specific-organizations)
      * [Synchronizing user role or custom profile fields during login](authentication-methods.html#synchronizing-user-role-or-custom-profile-fields-during-login)
      * [SCIM](authentication-methods.html#scim)
      * [Using Keycloak as a SAML IdP](authentication-methods.html#using-keycloak-as-a-saml-idp)
      * [Using Authentik as a SAML IdP](authentication-methods.html#using-authentik-as-a-saml-idp)
      * [SAML Single Logout](authentication-methods.html#saml-single-logout)
    - [Apache-based SSO with `REMOTE_USER`](authentication-methods.html#apache-based-sso-with-remote-user)
      * [Setup instructions for Apache-based SSO](authentication-methods.html#setup-instructions-for-apache-based-sso)
      * [Troubleshooting Apache-based SSO](authentication-methods.html#troubleshooting-apache-based-sso)
      * [Life of an Apache-based SSO login attempt](authentication-methods.html#life-of-an-apache-based-sso-login-attempt)
    - [Sign in with Apple](authentication-methods.html#sign-in-with-apple)
    - [OpenID Connect](authentication-methods.html#openid-connect)
    - [JWT](authentication-methods.html#jwt)
    - [Configuring a custom Python wrapper around the `authenticate` mechanism](authentication-methods.html#configuring-a-custom-python-wrapper-around-the-authenticate-mechanism)
    - [Adding more authentication backends](authentication-methods.html#adding-more-authentication-backends)
    - [Development only](authentication-methods.html#development-only)
  + [Backups, export and import](export-and-import.html)
    - [Backups](export-and-import.html#backups)
      * [Restoring backups](export-and-import.html#restoring-backups)
      * [What is included](export-and-import.html#what-is-included)
      * [Restore from manual backups](export-and-import.html#restore-from-manual-backups)
    - [Data export](export-and-import.html#data-export)
      * [Consider upgrading](export-and-import.html#consider-upgrading)
      * [Preventing changes during the export](export-and-import.html#preventing-changes-during-the-export)
      * [Export your Zulip data](export-and-import.html#export-your-zulip-data)
    - [Import into a new Zulip server](export-and-import.html#import-into-a-new-zulip-server)
      * [Import options](export-and-import.html#import-options)
      * [Logging in](export-and-import.html#logging-in)
      * [Deleting and re-importing](export-and-import.html#deleting-and-re-importing)
    - [Compliance exports](export-and-import.html#compliance-exports)
    - [Database-only backup tools](export-and-import.html#database-only-backup-tools)
      * [Streaming backups to S3](export-and-import.html#streaming-backups-to-s3)
      * [Streaming backups to local disk](export-and-import.html#streaming-backups-to-local-disk)
  + [PostgreSQL database details](postgresql.html)
    - [Separate PostgreSQL database](postgresql.html#separate-postgresql-database)
      * [Cloud-provider-managed PostgreSQL (e.g., Amazon RDS)](postgresql.html#cloud-provider-managed-postgresql-e-g-amazon-rds)
      * [Remote PostgreSQL database](postgresql.html#remote-postgresql-database)
    - [PostgreSQL warm standby](postgresql.html#postgresql-warm-standby)
    - [PostgreSQL vacuuming alerts](postgresql.html#postgresql-vacuuming-alerts)
  + [File upload backends](upload-backends.html)
    - [S3 backend configuration](upload-backends.html#s3-backend-configuration)
    - [S3 local caching](upload-backends.html#s3-local-caching)
    - [nginx DNS nameserver configuration](upload-backends.html#nginx-dns-nameserver-configuration)
    - [S3 bucket policy](upload-backends.html#s3-bucket-policy)
    - [Migrating from local uploads to Amazon S3 backend](upload-backends.html#migrating-from-local-uploads-to-amazon-s3-backend)
    - [S3 data storage class](upload-backends.html#s3-data-storage-class)
    - [Data export bucket](upload-backends.html#data-export-bucket)
  + [Installing SSL certificates](ssl-certificates.html)
    - [Manual install](ssl-certificates.html#manual-install)
      * [Testing](ssl-certificates.html#testing)
    - [Certbot (recommended)](ssl-certificates.html#certbot-recommended)
      * [At initial Zulip install](ssl-certificates.html#at-initial-zulip-install)
      * [After Zulip is already installed](ssl-certificates.html#after-zulip-is-already-installed)
      * [How it works](ssl-certificates.html#how-it-works)
      * [Renewal](ssl-certificates.html#renewal)
    - [Self-signed certificate](ssl-certificates.html#self-signed-certificate)
    - [Troubleshooting](ssl-certificates.html#id1)
      * [The Android app can’t connect to the server](ssl-certificates.html#the-android-app-can-t-connect-to-the-server)
      * [The iOS app can’t connect to the server](ssl-certificates.html#the-ios-app-can-t-connect-to-the-server)
      * [The Android app connects to the server on some devices but not others](ssl-certificates.html#the-android-app-connects-to-the-server-on-some-devices-but-not-others)
  + [Outgoing email](email.html)
    - [How to configure](email.html#how-to-configure)
    - [Email services](email.html#email-services)
      * [Free outgoing email services](email.html#free-outgoing-email-services)
      * [Using system email](email.html#using-system-email)
      * [Using Gmail for outgoing email](email.html#using-gmail-for-outgoing-email)
      * [Logging outgoing email to a file for prototyping](email.html#logging-outgoing-email-to-a-file-for-prototyping)
    - [Troubleshooting](email.html#troubleshooting)
      * [Advanced troubleshooting](email.html#advanced-troubleshooting)
  + [Deployment options](deployment.html)
    - [Installing Zulip from Git](deployment.html#installing-zulip-from-git)
    - [Zulip in Docker](deployment.html#zulip-in-docker)
    - [Zulip installer details](deployment.html#zulip-installer-details)
      * [Advanced installer options](deployment.html#advanced-installer-options)
    - [Installing on an existing server](deployment.html#installing-on-an-existing-server)
    - [Deployment hooks](deployment.html#deployment-hooks)
      * [Zulip message deploy hook](deployment.html#zulip-message-deploy-hook)
      * [Sentry deploy hook](deployment.html#sentry-deploy-hook)
    - [Running Zulip’s service dependencies on different machines](deployment.html#running-zulip-s-service-dependencies-on-different-machines)
    - [Using an alternate port](deployment.html#using-an-alternate-port)
    - [Customizing the outgoing HTTP proxy](deployment.html#customizing-the-outgoing-http-proxy)
      * [S3 file storage requests and outgoing proxies](deployment.html#s3-file-storage-requests-and-outgoing-proxies)
  + [Reverse proxies](reverse-proxies.html)
    - [Installer options](reverse-proxies.html#installer-options)
      * [Configuring Zulip to allow HTTP](reverse-proxies.html#configuring-zulip-to-allow-http)
      * [Configuring Zulip to trust proxies](reverse-proxies.html#configuring-zulip-to-trust-proxies)
    - [nginx configuration](reverse-proxies.html#nginx-configuration)
    - [Apache2 configuration](reverse-proxies.html#apache2-configuration)
    - [HAProxy configuration](reverse-proxies.html#haproxy-configuration)
    - [Other proxies](reverse-proxies.html#other-proxies)
  + [Hosting multiple organizations](multiple-organizations.html)
    - [Subdomains](multiple-organizations.html#subdomains)
      * [SSL certificates](multiple-organizations.html#ssl-certificates)
      * [Other hostnames](multiple-organizations.html#other-hostnames)
      * [The root domain](multiple-organizations.html#the-root-domain)
      * [Changing subdomains](multiple-organizations.html#changing-subdomains)
      * [Authentication](multiple-organizations.html#authentication)
      * [The system bot realm](multiple-organizations.html#the-system-bot-realm)
      * [Migrating / troubleshooting](multiple-organizations.html#migrating-troubleshooting)
    - [Open realm creation](multiple-organizations.html#open-realm-creation)
  + [Incoming email integration](email-gateway.html)
    - [Local delivery setup](email-gateway.html#local-delivery-setup)
    - [Polling setup](email-gateway.html#polling-setup)
  + [Video call providers](video-calls.html)
    - [Jitsi](video-calls.html#jitsi)
    - [Zoom](video-calls.html#zoom)
    - [BigBlueButton](video-calls.html#bigbluebutton)
  + [GIPHY GIF integration](giphy-gif-integration.html)
    - [Apply for API key](giphy-gif-integration.html#apply-for-api-key)
  + [SCIM provisioning](scim.html)
    - [Server configuration](scim.html#server-configuration)
    - [Additional options](scim.html#additional-options)

* [Contributing to Zulip](../contributing/index.html)
  + [Contributing guide](../contributing/contributing.html)
    - [Zulip development community](../contributing/contributing.html#zulip-development-community)
    - [Ways to contribute](../contributing/contributing.html#ways-to-contribute)
    - [Your first codebase contribution](../contributing/contributing.html#your-first-codebase-contribution)
      * [Where to look for an issue](../contributing/contributing.html#where-to-look-for-an-issue)
      * [Picking an issue to work on](../contributing/contributing.html#picking-an-issue-to-work-on)
      * [Claiming an issue](../contributing/contributing.html#claiming-an-issue)
      * [Getting help](../contributing/contributing.html#getting-help)
      * [Submitting a pull request](../contributing/contributing.html#submitting-a-pull-request)
      * [Beyond the first issue](../contributing/contributing.html#beyond-the-first-issue)
      * [Common questions](../contributing/contributing.html#common-questions)
    - [What makes a great Zulip contributor?](../contributing/contributing.html#what-makes-a-great-zulip-contributor)
    - [User feedback](../contributing/contributing.html#user-feedback)
    - [Outreach programs](../contributing/contributing.html#outreach-programs)
    - [Stay connected](../contributing/contributing.html#stay-connected)
    - [Help others find Zulip](../contributing/contributing.html#help-others-find-zulip)
  + [Zulip Code of Conduct](../code-of-conduct.html)
    - [Expected behavior](../code-of-conduct.html#expected-behavior)
    - [Unacceptable behavior](../code-of-conduct.html#unacceptable-behavior)
    - [Reporting and enforcement](../code-of-conduct.html#reporting-and-enforcement)
    - [Scope](../code-of-conduct.html#scope)
    - [License and attribution](../code-of-conduct.html#license-and-attribution)
    - [Moderating the Zulip community](../code-of-conduct.html#moderating-the-zulip-community)
  + [How we communicate](../contributing/how-we-communicate.html)
    - [Providing suggestions and feedback](../contributing/how-we-communicate.html#providing-suggestions-and-feedback)
    - [Handling disagreements](../contributing/how-we-communicate.html#handling-disagreements)
    - [Expressing your appreciation](../contributing/how-we-communicate.html#expressing-your-appreciation)
  + [Asking great questions](../contributing/asking-great-questions.html)
    - [Where to ask your question](../contributing/asking-great-questions.html#where-to-ask-your-question)
    - [How to ask a great question](../contributing/asking-great-questions.html#how-to-ask-a-great-question)
    - [Follow the community guidelines](../contributing/asking-great-questions.html#follow-the-community-guidelines)
  + [Design discussions](../contributing/design-discussions.html)
    - [Guidelines for all participants](../contributing/design-discussions.html#guidelines-for-all-participants)
    - [Participant roles](../contributing/design-discussions.html#participant-roles)
    - [Guidelines for code contributors](../contributing/design-discussions.html#guidelines-for-code-contributors)
      * [When to post](../contributing/design-discussions.html#when-to-post)
      * [Guidelines for requesting design feedback](../contributing/design-discussions.html#guidelines-for-requesting-design-feedback)
    - [Guidelines for community moderators](../contributing/design-discussions.html#guidelines-for-community-moderators)
      * [Improving the quality of discussions](../contributing/design-discussions.html#improving-the-quality-of-discussions)
      * [Moving threads to the most appropriate channel](../contributing/design-discussions.html#moving-threads-to-the-most-appropriate-channel)
    - [Guidelines for decision makers](../contributing/design-discussions.html#guidelines-for-decision-makers)
      * [Managing the discussion](../contributing/design-discussions.html#managing-the-discussion)
      * [From discussion to decision](../contributing/design-discussions.html#from-discussion-to-decision)
  + [Commit discipline](../contributing/commit-discipline.html)
    - [Each commit must be coherent](../contributing/commit-discipline.html#each-commit-must-be-coherent)
    - [Commits should generally be minimal](../contributing/commit-discipline.html#commits-should-generally-be-minimal)
      * [When not to be overly minimal](../contributing/commit-discipline.html#when-not-to-be-overly-minimal)
    - [Write a clean commit history](../contributing/commit-discipline.html#write-a-clean-commit-history)
    - [Commit messages](../contributing/commit-discipline.html#commit-messages)
      * [Commit summary, part 1](../contributing/commit-discipline.html#commit-summary-part-1)
      * [Commit summary, part 2](../contributing/commit-discipline.html#commit-summary-part-2)
      * [Examples of good commit summaries](../contributing/commit-discipline.html#examples-of-good-commit-summaries)
      * [Commit description](../contributing/commit-discipline.html#commit-description)
      * [Examples of good commit messages](../contributing/commit-discipline.html#examples-of-good-commit-messages)
  + [Code style and conventions](../contributing/code-style.html)
    - [Be consistent with existing code](../contributing/code-style.html#be-consistent-with-existing-code)
      * [Use the linters](../contributing/code-style.html#use-the-linters)
      * [Use tests to verify your logic](../contributing/code-style.html#use-tests-to-verify-your-logic)
    - [Follow Zulip conventions and practices](../contributing/code-style.html#follow-zulip-conventions-and-practices)
      * [Observe a reasonable line length](../contributing/code-style.html#observe-a-reasonable-line-length)
      * [Tag user-facing strings for translation](../contributing/code-style.html#tag-user-facing-strings-for-translation)
      * [Correctly prepare paths destined for state or log files](../contributing/code-style.html#correctly-prepare-paths-destined-for-state-or-log-files)
      * [Never include secrets inline with code](../contributing/code-style.html#never-include-secrets-inline-with-code)
      * [Familiarize yourself with rules about third-party code](../contributing/code-style.html#familiarize-yourself-with-rules-about-third-party-code)
    - [Python-specific conventions and practices](../contributing/code-style.html#python-specific-conventions-and-practices)
    - [JavaScript and TypeScript conventions and practices](../contributing/code-style.html#javascript-and-typescript-conventions-and-practices)
      * [Build DOM elements in Handlebars](../contributing/code-style.html#build-dom-elements-in-handlebars)
      * [Attach behaviors to event listeners](../contributing/code-style.html#attach-behaviors-to-event-listeners)
      * [Declare variables using `const` and `let`](../contributing/code-style.html#declare-variables-using-const-and-let)
      * [Manipulate objects and arrays with modern methods](../contributing/code-style.html#manipulate-objects-and-arrays-with-modern-methods)
    - [HTML and CSS](../contributing/code-style.html#html-and-css)
    - [Dangerous constructs in Django](../contributing/code-style.html#dangerous-constructs-in-django)
      * [Avoid excessive database queries](../contributing/code-style.html#avoid-excessive-database-queries)
      * [Never do direct database queries (`UserProfile.objects.get()`, `Client.objects.get()`, etc.)](../contributing/code-style.html#never-do-direct-database-queries-userprofile-objects-get-client-objects-get-etc)
      * [Don’t use Django model objects as keys in sets/dicts](../contributing/code-style.html#don-t-use-django-model-objects-as-keys-in-sets-dicts)
      * [Don’t call user\_profile.save() without `update_fields`](../contributing/code-style.html#don-t-call-user-profile-save-without-update-fields)
      * [Don’t update important model objects with raw saves](../contributing/code-style.html#don-t-update-important-model-objects-with-raw-saves)
      * [Don’t use naive datetime objects](../contributing/code-style.html#don-t-use-naive-datetime-objects)
    - [Dangerous constructs in JavaScript and TypeScript](../contributing/code-style.html#dangerous-constructs-in-javascript-and-typescript)
      * [Do not use `for...in` statements to traverse arrays](../contributing/code-style.html#do-not-use-for-in-statements-to-traverse-arrays)
  + [Reviewing Zulip code](../contributing/code-reviewing.html)
    - [Principles of code review](../contributing/code-reviewing.html#principles-of-code-review)
      * [Reviewing your own code](../contributing/code-reviewing.html#reviewing-your-own-code)
      * [Reviewing other contributors’ code](../contributing/code-reviewing.html#reviewing-other-contributors-code)
    - [How to review code](../contributing/code-reviewing.html#how-to-review-code)
      * [Code review checklist](../contributing/code-reviewing.html#code-review-checklist)
      * [Automated testing](../contributing/code-reviewing.html#automated-testing)
      * [Manual testing](../contributing/code-reviewing.html#manual-testing)
    - [Review process and communication](../contributing/code-reviewing.html#review-process-and-communication)
      * [Asking for a code review](../contributing/code-reviewing.html#asking-for-a-code-review)
      * [Reviewing someone else’s code](../contributing/code-reviewing.html#reviewing-someone-else-s-code)
      * [Responding to review feedback](../contributing/code-reviewing.html#responding-to-review-feedback)
    - [Additional resources](../contributing/code-reviewing.html#additional-resources)
  + [Submitting a pull request](../contributing/reviewable-prs.html)
    - [Write clear code](../contributing/reviewable-prs.html#write-clear-code)
    - [Organize your proposed changes](../contributing/reviewable-prs.html#organize-your-proposed-changes)
    - [Explain your changes](../contributing/reviewable-prs.html#explain-your-changes)
      * [Discussions in the development community](../contributing/reviewable-prs.html#discussions-in-the-development-community)
    - [Review your own work](../contributing/reviewable-prs.html#review-your-own-work)
    - [Submit your pull request for review](../contributing/reviewable-prs.html#submit-your-pull-request-for-review)
    - [Draft pull requests](../contributing/reviewable-prs.html#draft-pull-requests)
    - [Demonstrating visual changes](../contributing/reviewable-prs.html#demonstrating-visual-changes)
  + [Pull request review process](../contributing/review-process.html)
    - [Labels for managing the stages of pull request review](../contributing/review-process.html#labels-for-managing-the-stages-of-pull-request-review)
    - [Stages of a pull request review](../contributing/review-process.html#stages-of-a-pull-request-review)
    - [How to help move the review process forward](../contributing/review-process.html#how-to-help-move-the-review-process-forward)
  + [Continuing unfinished work](../contributing/continuing-unfinished-work.html)
    - [Find work to be completed](../contributing/continuing-unfinished-work.html#find-work-to-be-completed)
    - [Review existing work and feedback](../contributing/continuing-unfinished-work.html#review-existing-work-and-feedback)
    - [Decide how to use prior work](../contributing/continuing-unfinished-work.html#decide-how-to-use-prior-work)
    - [Credit prior work in your commit history](../contributing/continuing-unfinished-work.html#credit-prior-work-in-your-commit-history)
    - [Present your pull request](../contributing/continuing-unfinished-work.html#present-your-pull-request)
  + [Using zulipbot](../contributing/zulipbot-usage.html)
    - [Usage](../contributing/zulipbot-usage.html#usage)
      * [Contributing](../contributing/zulipbot-usage.html#contributing)
  + [Reporting bugs](../contributing/reporting-bugs.html)
    - [What to include in a bug report](../contributing/reporting-bugs.html#what-to-include-in-a-bug-report)
    - [Filing a GitHub issue](../contributing/reporting-bugs.html#filing-a-github-issue)
    - [Starting a conversation about a possible bug](../contributing/reporting-bugs.html#starting-a-conversation-about-a-possible-bug)
    - [Managing bug reports](../contributing/reporting-bugs.html#managing-bug-reports)
  + [Suggesting features and improvements](../contributing/suggesting-features.html)
    - [What to include in your proposal](../contributing/suggesting-features.html#what-to-include-in-your-proposal)
    - [Starting a conversation about a suggested feature or improvement](../contributing/suggesting-features.html#starting-a-conversation-about-a-suggested-feature-or-improvement)
    - [Filing a GitHub issue](../contributing/suggesting-features.html#filing-a-github-issue)
  + [Counting contributions](../contributing/counting-contributions.html)
    - [How the contribution stats are calculated](../contributing/counting-contributions.html#how-the-contribution-stats-are-calculated)
    - [Old email addresses](../contributing/counting-contributions.html#old-email-addresses)
    - [Relevant source code](../contributing/counting-contributions.html#relevant-source-code)
  + [Licensing](../contributing/licensing.html)
    - [Contributing your own work](../contributing/licensing.html#contributing-your-own-work)
    - [Contributing someone else’s work](../contributing/licensing.html#contributing-someone-else-s-work)

* [Development environment](../development/index.html)
  + [Development environment installation](../development/overview.html)
    - [Requirements](../development/overview.html#requirements)
    - [Recommended setup](../development/overview.html#recommended-setup)
    - [Vagrant setup](../development/overview.html#vagrant-setup)
    - [Advanced setup](../development/overview.html#advanced-setup)
    - [Slow internet connections](../development/overview.html#slow-internet-connections)
    - [Installing remotely](../development/overview.html#installing-remotely)
    - [Next steps](../development/overview.html#next-steps)
  + [Recommended setup](../development/setup-recommended.html)
    - [Requirements](../development/setup-recommended.html#requirements)
    - [Step 0: Set up Git & GitHub](../development/setup-recommended.html#step-0-set-up-git-github)
    - [Step 1: Install prerequisites](../development/setup-recommended.html#step-1-install-prerequisites)
    - [Step 2: Get Zulip code](../development/setup-recommended.html#step-2-get-zulip-code)
    - [Step 3: Start the development environment](../development/setup-recommended.html#step-3-start-the-development-environment)
    - [Step 4: Developing](../development/setup-recommended.html#step-4-developing)
      * [Where to edit files](../development/setup-recommended.html#where-to-edit-files)
      * [VSCode setup (optional)](../development/setup-recommended.html#vscode-setup-optional)
      * [Understanding run-dev debugging output](../development/setup-recommended.html#understanding-run-dev-debugging-output)
      * [Committing and pushing changes with Git](../development/setup-recommended.html#committing-and-pushing-changes-with-git)
      * [Maintaining the development environment](../development/setup-recommended.html#maintaining-the-development-environment)
      * [Rebuilding the development environment](../development/setup-recommended.html#rebuilding-the-development-environment)
      * [Shutting down the development environment for use later](../development/setup-recommended.html#shutting-down-the-development-environment-for-use-later)
      * [Resuming the development environment](../development/setup-recommended.html#resuming-the-development-environment)
    - [Next steps](../development/setup-recommended.html#next-steps)
    - [Troubleshooting and common errors](../development/setup-recommended.html#troubleshooting-and-common-errors)
      * [Vagrant guest doesn’t show (zulip-py3-venv) at start of prompt](../development/setup-recommended.html#vagrant-guest-doesn-t-show-zulip-py3-venv-at-start-of-prompt)
      * [Vagrant was unable to mount VirtualBox shared folders](../development/setup-recommended.html#vagrant-was-unable-to-mount-virtualbox-shared-folders)
      * [ssl read error](../development/setup-recommended.html#ssl-read-error)
      * [Unmet dependencies error](../development/setup-recommended.html#unmet-dependencies-error)
      * [ssh connection closed by remote host](../development/setup-recommended.html#ssh-connection-closed-by-remote-host)
      * [os.symlink error](../development/setup-recommended.html#os-symlink-error)
      * [Hyper-V error messages](../development/setup-recommended.html#hyper-v-error-messages)
      * [Connection timeout on `vagrant up`](../development/setup-recommended.html#connection-timeout-on-vagrant-up)
      * [Vagrant was unable to communicate with the guest machine](../development/setup-recommended.html#vagrant-was-unable-to-communicate-with-the-guest-machine)
      * [Vagrant up fails with subprocess.CalledProcessError](../development/setup-recommended.html#vagrant-up-fails-with-subprocess-calledprocesserror)
      * [VBoxManage errors related to VT-x or WHvSetupPartition](../development/setup-recommended.html#vboxmanage-errors-related-to-vt-x-or-whvsetuppartition)
      * [OSError: [Errno 26] Text file busy](../development/setup-recommended.html#oserror-errno-26-text-file-busy)
    - [Specifying an Ubuntu mirror](../development/setup-recommended.html#specifying-an-ubuntu-mirror)
    - [Specifying a proxy](../development/setup-recommended.html#specifying-a-proxy)
    - [Using a different port for Vagrant](../development/setup-recommended.html#using-a-different-port-for-vagrant)
    - [Customizing CPU and RAM allocation](../development/setup-recommended.html#customizing-cpu-and-ram-allocation)
  + [Advanced setup](../development/setup-advanced.html)
    - [Installing directly on Ubuntu, Debian, CentOS, or Fedora](../development/setup-advanced.html#installing-directly-on-ubuntu-debian-centos-or-fedora)
    - [Installing using Vagrant with VirtualBox on Windows 10](../development/setup-advanced.html#installing-using-vagrant-with-virtualbox-on-windows-10)
      * [Running Git BASH as an administrator](../development/setup-advanced.html#running-git-bash-as-an-administrator)
    - [Using the Vagrant Hyper-V provider on Windows (beta)](../development/setup-advanced.html#using-the-vagrant-hyper-v-provider-on-windows-beta)
      * [Problems you may encounter](../development/setup-advanced.html#problems-you-may-encounter)
    - [Newer versions of supported platforms](../development/setup-advanced.html#newer-versions-of-supported-platforms)
  + [Using the development environment](../development/using.html)
    - [Common](../development/using.html#common)
    - [Server](../development/using.html#server)
    - [Web](../development/using.html#web)
    - [Mobile](../development/using.html#mobile)
  + [Developing remotely](../development/remote.html)
    - [Connecting to the remote environment](../development/remote.html#connecting-to-the-remote-environment)
    - [Setting up user accounts](../development/remote.html#setting-up-user-accounts)
    - [Setting up the development environment](../development/remote.html#setting-up-the-development-environment)
    - [Running the development server](../development/remote.html#running-the-development-server)
    - [Making changes to code on your remote development server](../development/remote.html#making-changes-to-code-on-your-remote-development-server)
      * [Editing locally](../development/remote.html#editing-locally)
      * [Editing remotely](../development/remote.html#editing-remotely)
      * [Next steps](../development/remote.html#next-steps)
    - [Using an nginx reverse proxy](../development/remote.html#using-an-nginx-reverse-proxy)
  + [Authentication in the development environment](../development/authentication.html)
    - [Email and password](../development/authentication.html#email-and-password)
    - [Google](../development/authentication.html#google)
    - [GitHub](../development/authentication.html#github)
    - [GitLab](../development/authentication.html#gitlab)
    - [Apple](../development/authentication.html#apple)
    - [SAML](../development/authentication.html#saml)
    - [When SSL is required](../development/authentication.html#when-ssl-is-required)
    - [Testing LDAP in development](../development/authentication.html#testing-ldap-in-development)
      * [Testing avatar and custom profile field synchronization](../development/authentication.html#testing-avatar-and-custom-profile-field-synchronization)
      * [Automated testing](../development/authentication.html#automated-testing)
    - [Two factor authentication](../development/authentication.html#two-factor-authentication)
    - [Password form implementation](../development/authentication.html#password-form-implementation)
  + [Testing the installer](../development/test-install.html)
    - [Configuring](../development/test-install.html#configuring)
    - [Running a test install](../development/test-install.html#running-a-test-install)
      * [Build and unpack a release tarball](../development/test-install.html#build-and-unpack-a-release-tarball)
      * [Test an install](../development/test-install.html#test-an-install)
      * [See running containers after installation](../development/test-install.html#see-running-containers-after-installation)
      * [Connect to a running container](../development/test-install.html#connect-to-a-running-container)
      * [Stopping and destroying containers](../development/test-install.html#stopping-and-destroying-containers)
      * [Iterating on the installer](../development/test-install.html#iterating-on-the-installer)

* [Developer tutorials](../tutorials/index.html)
  + [Writing a new application feature](../tutorials/new-feature-tutorial.html)
    - [General process](../tutorials/new-feature-tutorial.html#general-process)
      * [Files impacted](../tutorials/new-feature-tutorial.html#files-impacted)
      * [Adding a field to the database](../tutorials/new-feature-tutorial.html#adding-a-field-to-the-database)
      * [Backend changes](../tutorials/new-feature-tutorial.html#backend-changes)
      * [Frontend changes](../tutorials/new-feature-tutorial.html#frontend-changes)
      * [Documentation changes](../tutorials/new-feature-tutorial.html#documentation-changes)
    - [Example feature](../tutorials/new-feature-tutorial.html#example-feature)
      * [Update the model](../tutorials/new-feature-tutorial.html#update-the-model)
      * [Create the migration](../tutorials/new-feature-tutorial.html#create-the-migration)
      * [Test your migration changes](../tutorials/new-feature-tutorial.html#test-your-migration-changes)
      * [Handle database interactions](../tutorials/new-feature-tutorial.html#handle-database-interactions)
      * [Update application state](../tutorials/new-feature-tutorial.html#update-application-state)
      * [Add a new view](../tutorials/new-feature-tutorial.html#add-a-new-view)
      * [Backend tests](../tutorials/new-feature-tutorial.html#backend-tests)
      * [Update the frontend](../tutorials/new-feature-tutorial.html#update-the-frontend)
      * [Frontend tests](../tutorials/new-feature-tutorial.html#frontend-tests)
      * [Update documentation](../tutorials/new-feature-tutorial.html#update-documentation)
  + [Writing views in Zulip](../tutorials/writing-views.html)
    - [What this covers](../tutorials/writing-views.html#what-this-covers)
    - [What is a view?](../tutorials/writing-views.html#what-is-a-view)
    - [Modifying urls.py](../tutorials/writing-views.html#modifying-urls-py)
    - [Writing human-readable views](../tutorials/writing-views.html#writing-human-readable-views)
      * [Decorators used for webpage views](../tutorials/writing-views.html#decorators-used-for-webpage-views)
      * [Writing a template](../tutorials/writing-views.html#writing-a-template)
    - [Writing API REST endpoints](../tutorials/writing-views.html#writing-api-rest-endpoints)
      * [Request variables](../tutorials/writing-views.html#request-variables)
      * [Deciding which HTTP verb to use](../tutorials/writing-views.html#deciding-which-http-verb-to-use)
      * [Idempotency](../tutorials/writing-views.html#idempotency)
      * [Making changes to the database](../tutorials/writing-views.html#making-changes-to-the-database)
      * [Calling from the web application](../tutorials/writing-views.html#calling-from-the-web-application)
      * [Calling from an API client](../tutorials/writing-views.html#calling-from-an-api-client)
    - [Legacy endpoints used by the web client](../tutorials/writing-views.html#legacy-endpoints-used-by-the-web-client)
    - [Incoming webhook integrations](../tutorials/writing-views.html#incoming-webhook-integrations)
  + [Life of a request](../tutorials/life-of-a-request.html)
    - [A request is sent to the server, and handled by nginx](../tutorials/life-of-a-request.html#a-request-is-sent-to-the-server-and-handled-by-nginx)
    - [Static files are served directly by nginx](../tutorials/life-of-a-request.html#static-files-are-served-directly-by-nginx)
    - [nginx routes other requests between Django and Tornado](../tutorials/life-of-a-request.html#nginx-routes-other-requests-between-django-and-tornado)
    - [Django routes the request to a view in urls.py files](../tutorials/life-of-a-request.html#django-routes-the-request-to-a-view-in-urls-py-files)
    - [Views serving HTML are internationalized by server path](../tutorials/life-of-a-request.html#views-serving-html-are-internationalized-by-server-path)
    - [API endpoints use REST](../tutorials/life-of-a-request.html#api-endpoints-use-rest)
      * [PUT is only for creating new things](../tutorials/life-of-a-request.html#put-is-only-for-creating-new-things)
      * [OPTIONS](../tutorials/life-of-a-request.html#options)
      * [Incoming webhook integrations may not be RESTful](../tutorials/life-of-a-request.html#incoming-webhook-integrations-may-not-be-restful)
    - [Django calls rest\_dispatch for REST endpoints, and authenticates](../tutorials/life-of-a-request.html#django-calls-rest-dispatch-for-rest-endpoints-and-authenticates)
    - [The view will authorize the user, extract request variables, and validate them](../tutorials/life-of-a-request.html#the-view-will-authorize-the-user-extract-request-variables-and-validate-them)
    - [Results are given as JSON](../tutorials/life-of-a-request.html#results-are-given-as-json)
  + [Reading list](../tutorials/reading-list.html)
    - [General programming/IT](../tutorials/reading-list.html#general-programming-it)
    - [Python](../tutorials/reading-list.html#python)
    - [Java/Android](../tutorials/reading-list.html#java-android)
    - [JavaScript/ECMAScript](../tutorials/reading-list.html#javascript-ecmascript)
    - [TypeScript](../tutorials/reading-list.html#typescript)
    - [Git/version control systems (VCS)](../tutorials/reading-list.html#git-version-control-systems-vcs)
    - [Computer science/algorithms](../tutorials/reading-list.html#computer-science-algorithms)
    - [Community experience](../tutorials/reading-list.html#community-experience)
    - [Competitions/camps](../tutorials/reading-list.html#competitions-camps)
    - [Massive open online courses (MOOC) platforms](../tutorials/reading-list.html#massive-open-online-courses-mooc-platforms)
  + [Screenshot and GIF software](../tutorials/screenshot-and-gif-software.html)
    - [Screenshot tools by platform](../tutorials/screenshot-and-gif-software.html#screenshot-tools-by-platform)
      * [Browser](../tutorials/screenshot-and-gif-software.html#browser)
      * [macOS](../tutorials/screenshot-and-gif-software.html#macos)
      * [Windows](../tutorials/screenshot-and-gif-software.html#windows)
      * [Linux](../tutorials/screenshot-and-gif-software.html#linux)
    - [GIF tools by platform](../tutorials/screenshot-and-gif-software.html#gif-tools-by-platform)
      * [Browser](../tutorials/screenshot-and-gif-software.html#id1)
      * [macOS](../tutorials/screenshot-and-gif-software.html#id2)
      * [Windows](../tutorials/screenshot-and-gif-software.html#id3)
      * [Linux](../tutorials/screenshot-and-gif-software.html#id4)
  + [Shell tips](../tutorials/shell-tips.html)
    - [The prompt (`$`)](../tutorials/shell-tips.html#the-prompt)
    - [Tilde character (`~`)](../tutorials/shell-tips.html#tilde-character)
    - [Change directory (`cd`)](../tutorials/shell-tips.html#change-directory-cd)
    - [Running commands as root (`sudo`)](../tutorials/shell-tips.html#running-commands-as-root-sudo)
    - [Escaping characters](../tutorials/shell-tips.html#escaping-characters)
    - [Sequencing commands](../tutorials/shell-tips.html#sequencing-commands)
    - [Splitting commands into multiple lines](../tutorials/shell-tips.html#splitting-commands-into-multiple-lines)
    - [Arguments](../tutorials/shell-tips.html#arguments)
    - [Shebang](../tutorials/shell-tips.html#shebang)
    - [Understanding commands](../tutorials/shell-tips.html#understanding-commands)
    - [Cheatsheet](../tutorials/shell-tips.html#cheatsheet)
    - [Git](../tutorials/shell-tips.html#git)

* [Git guide](../git/index.html)
  + [Quick start](../git/overview.html)
  + [Set up Git](../git/setup.html)
    - [Install and configure Git, join GitHub](../git/setup.html#install-and-configure-git-join-github)
    - [Get a graphical client](../git/setup.html#get-a-graphical-client)
  + [Zulip-specific tools](../git/zulip-tools.html)
    - [Set up Git repo script](../git/zulip-tools.html#set-up-git-repo-script)
    - [Configure continuous integration for your Zulip fork](../git/zulip-tools.html#configure-continuous-integration-for-your-zulip-fork)
    - [Reset to pull request](../git/zulip-tools.html#reset-to-pull-request)
    - [Fetch a pull request and rebase](../git/zulip-tools.html#fetch-a-pull-request-and-rebase)
    - [Fetch a pull request without rebasing](../git/zulip-tools.html#fetch-a-pull-request-without-rebasing)
    - [Push to a pull request](../git/zulip-tools.html#push-to-a-pull-request)
    - [Delete unimportant branches](../git/zulip-tools.html#delete-unimportant-branches)
    - [Merge conflict on `pnpm-lock.yaml` file](../git/zulip-tools.html#merge-conflict-on-pnpm-lock-yaml-file)
  + [How Git is different](../git/the-git-difference.html)
  + [Important Git terms](../git/terminology.html)
    - [branch](../git/terminology.html#branch)
    - [cache](../git/terminology.html#cache)
    - [checkout](../git/terminology.html#checkout)
    - [commit](../git/terminology.html#commit)
    - [fast-forward](../git/terminology.html#fast-forward)
    - [fetch](../git/terminology.html#fetch)
    - [hash](../git/terminology.html#hash)
    - [head](../git/terminology.html#head)
    - [HEAD](../git/terminology.html#id1)
    - [index](../git/terminology.html#index)
    - [pull](../git/terminology.html#pull)
    - [push](../git/terminology.html#push)
    - [rebase](../git/terminology.html#rebase)
  + [Get Zulip code](../git/cloning.html)
    - [Step 1a: Create your fork](../git/cloning.html#step-1a-create-your-fork)
    - [Step 1b: Clone to your machine](../git/cloning.html#step-1b-clone-to-your-machine)
    - [Step 1c: Connect your fork to Zulip upstream](../git/cloning.html#step-1c-connect-your-fork-to-zulip-upstream)
    - [Step 2: Set up the Zulip development environment](../git/cloning.html#step-2-set-up-the-zulip-development-environment)
    - [Step 3: Configure continuous integration for your fork](../git/cloning.html#step-3-configure-continuous-integration-for-your-fork)
  + [Working copies](../git/working-copies.html)
    - [Workflows](../git/working-copies.html#workflows)
    - [Relevant Git commands](../git/working-copies.html#relevant-git-commands)
  + [Using Git as you work](../git/using.html)
    - [Know what branch you’re working on](../git/using.html#know-what-branch-you-re-working-on)
    - [Keep your fork up to date](../git/using.html#keep-your-fork-up-to-date)
    - [Work on a feature branch](../git/using.html#work-on-a-feature-branch)
    - [Run linters and tests locally](../git/using.html#run-linters-and-tests-locally)
    - [Stage changes](../git/using.html#stage-changes)
      * [Get status of working directory](../git/using.html#get-status-of-working-directory)
      * [Stage additions with `git add`](../git/using.html#stage-additions-with-git-add)
      * [Stage deletions with `git rm`](../git/using.html#stage-deletions-with-git-rm)
    - [Commit changes](../git/using.html#commit-changes)
    - [Push your commits to GitHub](../git/using.html#push-your-commits-to-github)
    - [Examine and tidy your commit history](../git/using.html#examine-and-tidy-your-commit-history)
    - [Force-push changes to GitHub after you’ve altered your history](../git/using.html#force-push-changes-to-github-after-you-ve-altered-your-history)
  + [Pull requests](../git/pull-requests.html)
    - [Draft pull requests](../git/pull-requests.html#draft-pull-requests)
    - [Create a pull request](../git/pull-requests.html#id1)
      * [Step 0: Make sure you’re on a feature branch (not `main`)](../git/pull-requests.html#step-0-make-sure-you-re-on-a-feature-branch-not-main)
      * [Step 1: Update your branch with git rebase](../git/pull-requests.html#step-1-update-your-branch-with-git-rebase)
      * [Step 2: Push your updated branch to your remote fork](../git/pull-requests.html#step-2-push-your-updated-branch-to-your-remote-fork)
      * [Step 3: Open the pull request](../git/pull-requests.html#step-3-open-the-pull-request)
    - [Update a pull request](../git/pull-requests.html#update-a-pull-request)
  + [Collaborate](../git/collaborate.html)
    - [Fetch another contributor’s branch](../git/collaborate.html#fetch-another-contributor-s-branch)
    - [Check out a pull request locally](../git/collaborate.html#check-out-a-pull-request-locally)
  + [Fixing commits](../git/fixing-commits.html)
    - [Fixing the last commit](../git/fixing-commits.html#fixing-the-last-commit)
      * [Changing the last commit message](../git/fixing-commits.html#changing-the-last-commit-message)
      * [Changing the last commit](../git/fixing-commits.html#changing-the-last-commit)
    - [Fixing older commits](../git/fixing-commits.html#fixing-older-commits)
      * [Changing commit messages](../git/fixing-commits.html#changing-commit-messages)
      * [Deleting old commits](../git/fixing-commits.html#deleting-old-commits)
    - [Squashing commits](../git/fixing-commits.html#squashing-commits)
    - [Reordering commits](../git/fixing-commits.html#reordering-commits)
    - [Pushing commits after tidying them](../git/fixing-commits.html#pushing-commits-after-tidying-them)
  + [Reviewing changes](../git/reviewing.html)
    - [Changes on (local) working tree](../git/reviewing.html#changes-on-local-working-tree)
    - [Changes within branches](../git/reviewing.html#changes-within-branches)
    - [Changes between branches](../git/reviewing.html#changes-between-branches)
  + [Get and stay out of trouble](../git/troubleshooting.html)
    - [Undo a merge commit](../git/troubleshooting.html#undo-a-merge-commit)
    - [Restore a lost commit](../git/troubleshooting.html#restore-a-lost-commit)
    - [Recover from a `git rebase` failure](../git/troubleshooting.html#recover-from-a-git-rebase-failure)
    - [Working from multiple computers](../git/troubleshooting.html#working-from-multiple-computers)
  + [Git cheat sheet](../git/cheat-sheet.html)
    - [Common commands](../git/cheat-sheet.html#common-commands)
    - [Detailed cheat sheet](../git/cheat-sheet.html#detailed-cheat-sheet)

* [Code testing](../testing/index.html)
  + [Testing overview](../testing/testing.html)
    - [Running tests](../testing/testing.html#running-tests)
    - [Major test suites](../testing/testing.html#major-test-suites)
    - [Other test suites](../testing/testing.html#other-test-suites)
    - [Internet access inside test suites](../testing/testing.html#internet-access-inside-test-suites)
      * [Documentation tests](../testing/testing.html#documentation-tests)
  + [Linters](../testing/linters.html)
    - [Overview](../testing/linters.html#overview)
    - [Running the linters](../testing/linters.html#running-the-linters)
    - [General considerations](../testing/linters.html#general-considerations)
    - [Lint checks](../testing/linters.html#lint-checks)
    - [lint](../testing/linters.html#lint)
      * [Special options](../testing/linters.html#special-options)
      * [Lint checks](../testing/linters.html#id1)
    - [Philosophy](../testing/linters.html#philosophy)
      * [Speed](../testing/linters.html#speed)
      * [Accuracy](../testing/linters.html#accuracy)
      * [Completeness](../testing/linters.html#completeness)
  + [Backend Django tests](../testing/testing-with-django.html)
    - [Overview](../testing/testing-with-django.html#overview)
    - [Running tests](../testing/testing-with-django.html#running-tests)
    - [Writing tests](../testing/testing-with-django.html#writing-tests)
      * [Setting up data for tests](../testing/testing-with-django.html#setting-up-data-for-tests)
      * [Testing code that accesses the filesystem](../testing/testing-with-django.html#testing-code-that-accesses-the-filesystem)
      * [Testing with mocks](../testing/testing-with-django.html#testing-with-mocks)
    - [Zulip testing philosophy](../testing/testing-with-django.html#zulip-testing-philosophy)
      * [Endpoint tests](../testing/testing-with-django.html#endpoint-tests)
      * [Library tests](../testing/testing-with-django.html#library-tests)
      * [Fixture-driven tests](../testing/testing-with-django.html#fixture-driven-tests)
      * [Mocks and stubs](../testing/testing-with-django.html#mocks-and-stubs)
      * [Template tests](../testing/testing-with-django.html#template-tests)
      * [SQL performance tests](../testing/testing-with-django.html#sql-performance-tests)
      * [Event-based tests](../testing/testing-with-django.html#event-based-tests)
      * [Negative tests](../testing/testing-with-django.html#negative-tests)
    - [Testing considerations](../testing/testing-with-django.html#testing-considerations)
  + [JavaScript/TypeScript unit tests](../testing/testing-with-node.html)
    - [How the node tests work](../testing/testing-with-node.html#how-the-node-tests-work)
    - [Handling dependencies in unit tests](../testing/testing-with-node.html#handling-dependencies-in-unit-tests)
    - [Creating new test modules](../testing/testing-with-node.html#creating-new-test-modules)
    - [Verifying HTML templates with `mock_template`](../testing/testing-with-node.html#verifying-html-templates-with-mock-template)
    - [Coverage reports](../testing/testing-with-node.html#coverage-reports)
    - [Editor debugger integration](../testing/testing-with-node.html#editor-debugger-integration)
    - [Webstorm integration setup](../testing/testing-with-node.html#webstorm-integration-setup)
    - [Running tests with the debugger](../testing/testing-with-node.html#running-tests-with-the-debugger)
  + [Web frontend black-box Puppeteer tests](../testing/testing-with-puppeteer.html)
    - [Running tests](../testing/testing-with-puppeteer.html#running-tests)
    - [How Puppeteer tests work](../testing/testing-with-puppeteer.html#how-puppeteer-tests-work)
    - [Debugging Puppeteer tests](../testing/testing-with-puppeteer.html#debugging-puppeteer-tests)
    - [Writing Puppeteer tests](../testing/testing-with-puppeteer.html#writing-puppeteer-tests)
  + [Python static type checker (mypy)](../testing/mypy.html)
    - [Installing mypy](../testing/mypy.html#installing-mypy)
    - [Running mypy on Zulip’s code locally](../testing/mypy.html#running-mypy-on-zulip-s-code-locally)
    - [Mypy is there to find bugs in Zulip before they impact users](../testing/mypy.html#mypy-is-there-to-find-bugs-in-zulip-before-they-impact-users)
    - [Mypy stubs for third-party modules](../testing/mypy.html#mypy-stubs-for-third-party-modules)
    - [Working with types from django-stubs](../testing/mypy.html#working-with-types-from-django-stubs)
    - [Using @overload to accurately describe variations](../testing/mypy.html#using-overload-to-accurately-describe-variations)
    - [Best practices](../testing/mypy.html#best-practices)
      * [When is a type annotation justified?](../testing/mypy.html#when-is-a-type-annotation-justified)
      * [Avoid the `Any` type](../testing/mypy.html#avoid-the-any-type)
      * [Avoid `cast()`](../testing/mypy.html#avoid-cast)
      * [Avoid `# type: ignore` comments](../testing/mypy.html#avoid-type-ignore-comments)
      * [Avoid other unchecked constructs](../testing/mypy.html#avoid-other-unchecked-constructs)
      * [Use `Optional` and `None` correctly](../testing/mypy.html#use-optional-and-none-correctly)
      * [Read-only types](../testing/mypy.html#read-only-types)
      * [Typing decorators](../testing/mypy.html#typing-decorators)
    - [Troubleshooting advice](../testing/mypy.html#troubleshooting-advice)
  + [TypeScript static types](../testing/typescript.html)
    - [Type checking](../testing/typescript.html#type-checking)
    - [Linting and style](../testing/typescript.html#linting-and-style)
    - [Migration strategy](../testing/typescript.html#migration-strategy)
  + [Continuous integration (CI)](../testing/continuous-integration.html)
    - [Goals](../testing/continuous-integration.html#goals)
    - [GitHub Actions](../testing/continuous-integration.html#github-actions)
      * [Useful debugging tips and tools](../testing/continuous-integration.html#useful-debugging-tips-and-tools)
      * [Suites](../testing/continuous-integration.html#suites)
      * [Configuration](../testing/continuous-integration.html#configuration)
      * [Images](../testing/continuous-integration.html#images)
      * [Performance optimizations](../testing/continuous-integration.html#performance-optimizations)
  + [Manual testing](../testing/manual-testing.html)
    - [Basic stuff](../testing/manual-testing.html#basic-stuff)
      * [Message view](../testing/manual-testing.html#message-view)
      * [Messagebox](../testing/manual-testing.html#messagebox)
      * [Message editing](../testing/manual-testing.html#message-editing)
      * [Narrowing](../testing/manual-testing.html#narrowing)
      * [Composing messages](../testing/manual-testing.html#composing-messages)
      * [Popover menus](../testing/manual-testing.html#popover-menus)
      * [Sidebar filtering](../testing/manual-testing.html#sidebar-filtering)
      * [Channel permissions](../testing/manual-testing.html#channel-permissions)
      * [Search](../testing/manual-testing.html#search)
      * [Channel settings](../testing/manual-testing.html#channel-settings)
      * [User settings](../testing/manual-testing.html#user-settings)
      * [Keyboard shortcuts](../testing/manual-testing.html#keyboard-shortcuts)
      * [Miscellaneous menu options](../testing/manual-testing.html#miscellaneous-menu-options)
      * [Inviting users/tutorial](../testing/manual-testing.html#inviting-users-tutorial)
      * [To be continued…](../testing/manual-testing.html#to-be-continued)
  + [Testing philosophy](../testing/philosophy.html)
    - [Effective testing allows us to move quickly](../testing/philosophy.html#effective-testing-allows-us-to-move-quickly)
    - [Test suite performance and reliability are critical](../testing/philosophy.html#test-suite-performance-and-reliability-are-critical)
    - [Integration testing or unit testing?](../testing/philosophy.html#integration-testing-or-unit-testing)
    - [Avoid duplicating code with security impact](../testing/philosophy.html#avoid-duplicating-code-with-security-impact)
    - [Share test setup code](../testing/philosophy.html#share-test-setup-code)
    - [What isn’t tested probably doesn’t work](../testing/philosophy.html#what-isn-t-tested-probably-doesn-t-work)

* [Subsystems documentation](../subsystems/index.html)
  + [Provisioning and third-party dependencies](../subsystems/dependencies.html)
    - [Provisioning](../subsystems/dependencies.html#provisioning)
      * [PROVISION\_VERSION](../subsystems/dependencies.html#provision-version)
    - [Philosophy on adding third-party dependencies](../subsystems/dependencies.html#philosophy-on-adding-third-party-dependencies)
    - [System packages](../subsystems/dependencies.html#system-packages)
    - [Python packages](../subsystems/dependencies.html#python-packages)
      * [Upgrading packages](../subsystems/dependencies.html#upgrading-packages)
    - [JavaScript and other frontend packages](../subsystems/dependencies.html#javascript-and-other-frontend-packages)
    - [Node.js and pnpm](../subsystems/dependencies.html#node-js-and-pnpm)
    - [ShellCheck and shfmt](../subsystems/dependencies.html#shellcheck-and-shfmt)
    - [Puppet packages](../subsystems/dependencies.html#puppet-packages)
    - [Other third-party and generated files](../subsystems/dependencies.html#other-third-party-and-generated-files)
      * [Emoji](../subsystems/dependencies.html#emoji)
      * [Translations data](../subsystems/dependencies.html#translations-data)
      * [Pygments data](../subsystems/dependencies.html#pygments-data)
    - [Modifying provisioning](../subsystems/dependencies.html#modifying-provisioning)
  + [Settings system](../subsystems/settings.html)
    - [Server settings](../subsystems/settings.html#server-settings)
      * [Testing non-default settings](../subsystems/settings.html#testing-non-default-settings)
    - [Realm settings](../subsystems/settings.html#realm-settings)
  + [HTML and CSS](../subsystems/html-css.html)
    - [Zulip CSS organization](../subsystems/html-css.html#zulip-css-organization)
    - [Editing Zulip CSS](../subsystems/html-css.html#editing-zulip-css)
    - [CSS style guidelines](../subsystems/html-css.html#css-style-guidelines)
      * [Avoid duplicated code](../subsystems/html-css.html#avoid-duplicated-code)
      * [Be consistent with existing similar UI](../subsystems/html-css.html#be-consistent-with-existing-similar-ui)
      * [Use clear, unique names for classes and object IDs](../subsystems/html-css.html#use-clear-unique-names-for-classes-and-object-ids)
    - [Validating CSS](../subsystems/html-css.html#validating-css)
    - [HTML templates](../subsystems/html-css.html#html-templates)
      * [Behavior](../subsystems/html-css.html#behavior)
      * [Backend templates](../subsystems/html-css.html#backend-templates)
      * [Frontend templates](../subsystems/html-css.html#frontend-templates)
      * [Toolchain](../subsystems/html-css.html#toolchain)
      * [Translation](../subsystems/html-css.html#translation)
      * [Tooltips](../subsystems/html-css.html#tooltips)
    - [Static asset pipeline](../subsystems/html-css.html#static-asset-pipeline)
      * [Primary build process](../subsystems/html-css.html#primary-build-process)
      * [Adding static files](../subsystems/html-css.html#adding-static-files)
      * [How it works in production](../subsystems/html-css.html#how-it-works-in-production)
      * [ES6/TypeScript modules](../subsystems/html-css.html#es6-typescript-modules)
  + [Accessibility](../subsystems/accessibility.html)
    - [Guidelines](../subsystems/accessibility.html#guidelines)
    - [Tools](../subsystems/accessibility.html#tools)
    - [GitHub issues](../subsystems/accessibility.html#github-issues)
    - [Additional resources](../subsystems/accessibility.html#additional-resources)
  + [Real-time push and events](../subsystems/events-system.html)
    - [Generation system](../subsystems/events-system.html#generation-system)
    - [Delivery system](../subsystems/events-system.html#delivery-system)
    - [The initial data fetch](../subsystems/events-system.html#the-initial-data-fetch)
      * [Testing](../subsystems/events-system.html#testing)
      * [Messages](../subsystems/events-system.html#messages)
    - [Schema changes](../subsystems/events-system.html#schema-changes)
  + [Sending messages](../subsystems/sending-messages.html)
    - [Message lists](../subsystems/sending-messages.html#message-lists)
    - [Compose area](../subsystems/sending-messages.html#compose-area)
    - [Backend implementation](../subsystems/sending-messages.html#backend-implementation)
    - [Local echo](../subsystems/sending-messages.html#local-echo)
      * [Local echo in message editing](../subsystems/sending-messages.html#local-echo-in-message-editing)
    - [Putting it all together](../subsystems/sending-messages.html#putting-it-all-together)
    - [Message editing](../subsystems/sending-messages.html#message-editing)
      * [Inline URL previews](../subsystems/sending-messages.html#inline-url-previews)
    - [Soft deactivation](../subsystems/sending-messages.html#soft-deactivation)
  + [Notifications in Zulip](../subsystems/notifications.html)
    - [Important corner cases](../subsystems/notifications.html#important-corner-cases)
    - [The mobile/email notifications flow](../subsystems/notifications.html#the-mobile-email-notifications-flow)
  + [Queue processors](../subsystems/queuing.html)
    - [Adding a new queue processor](../subsystems/queuing.html#adding-a-new-queue-processor)
    - [Publishing events into a queue](../subsystems/queuing.html#publishing-events-into-a-queue)
    - [Clearing a RabbitMQ queue](../subsystems/queuing.html#clearing-a-rabbitmq-queue)
  + [Unread counts and the pointer](../subsystems/pointer.html)
    - [Pointer logic](../subsystems/pointer.html#pointer-logic)
      * [Recipient bar: message you clicked](../subsystems/pointer.html#recipient-bar-message-you-clicked)
      * [Search, sidebar click, or new tab: unread/recent matching narrow](../subsystems/pointer.html#search-sidebar-click-or-new-tab-unread-recent-matching-narrow)
      * [Unnarrow: previous sequence](../subsystems/pointer.html#unnarrow-previous-sequence)
      * [Forced reload: state preservation](../subsystems/pointer.html#forced-reload-state-preservation)
    - [Unread count logic](../subsystems/pointer.html#unread-count-logic)
    - [Testing and development](../subsystems/pointer.html#testing-and-development)
  + [Markdown implementation](../subsystems/markdown.html)
    - [Testing](../subsystems/markdown.html#testing)
    - [Changing Zulip’s Markdown processor](../subsystems/markdown.html#changing-zulip-s-markdown-processor)
    - [Per-realm features](../subsystems/markdown.html#per-realm-features)
    - [Zulip’s Markdown philosophy](../subsystems/markdown.html#zulip-s-markdown-philosophy)
    - [Zulip’s changes to Markdown](../subsystems/markdown.html#zulip-s-changes-to-markdown)
      * [Basic syntax](../subsystems/markdown.html#basic-syntax)
      * [Lists](../subsystems/markdown.html#lists)
      * [Links](../subsystems/markdown.html#links)
      * [Code](../subsystems/markdown.html#code)
      * [Other](../subsystems/markdown.html#other)
  + [Caching in Zulip](../subsystems/caching.html)
    - [Backend caching with memcached](../subsystems/caching.html#backend-caching-with-memcached)
      * [The core implementation](../subsystems/caching.html#the-core-implementation)
      * [Cautions](../subsystems/caching.html#cautions)
      * [Cache invalidation after writes](../subsystems/caching.html#cache-invalidation-after-writes)
      * [Production deployments and database migrations](../subsystems/caching.html#production-deployments-and-database-migrations)
      * [Automated testing and memcached](../subsystems/caching.html#automated-testing-and-memcached)
      * [Manual testing and memcached](../subsystems/caching.html#manual-testing-and-memcached)
      * [Performance](../subsystems/caching.html#performance)
    - [In-process caching in Django](../subsystems/caching.html#in-process-caching-in-django)
    - [Browser caching of state](../subsystems/caching.html#browser-caching-of-state)
  + [Performance and scalability](../subsystems/performance.html)
    - [Load profiles](../subsystems/performance.html#load-profiles)
    - [Major Zulip endpoints](../subsystems/performance.html#major-zulip-endpoints)
      * [Tornado](../subsystems/performance.html#tornado)
      * [Presence](../subsystems/performance.html#presence)
      * [Fetching page\_params](../subsystems/performance.html#fetching-page-params)
      * [Fetching message history](../subsystems/performance.html#fetching-message-history)
      * [User uploads](../subsystems/performance.html#user-uploads)
      * [Sending and editing messages](../subsystems/performance.html#sending-and-editing-messages)
      * [Other endpoints](../subsystems/performance.html#other-endpoints)
    - [Queue processors and cron jobs](../subsystems/performance.html#queue-processors-and-cron-jobs)
    - [Service scalability](../subsystems/performance.html#service-scalability)
  + [Realms in Zulip](../subsystems/realms.html)
    - [Creating realms](../subsystems/realms.html#creating-realms)
      * [Using unique link generator](../subsystems/realms.html#using-unique-link-generator)
    - [Subdomains](../subsystems/realms.html#subdomains)
      * [Working with subdomains in development environment](../subsystems/realms.html#working-with-subdomains-in-development-environment)
  + [Management commands](../subsystems/management-commands.html)
    - [Writing management commands](../subsystems/management-commands.html#writing-management-commands)
  + [Schema migrations](../subsystems/schema-migrations.html)
    - [Automated testing for migrations](../subsystems/schema-migrations.html#automated-testing-for-migrations)
    - [Schema and initial data changes](../subsystems/schema-migrations.html#schema-and-initial-data-changes)
  + [URL hashes and deep linking](../subsystems/hashchange-system.html)
    - [Hashchange](../subsystems/hashchange-system.html#hashchange)
    - [Server-initiated reloads](../subsystems/hashchange-system.html#server-initiated-reloads)
    - [All reloads](../subsystems/hashchange-system.html#all-reloads)
  + [Emoji](../subsystems/emoji.html)
    - [Emoji codes](../subsystems/emoji.html#emoji-codes)
      * [Custom emoji](../subsystems/emoji.html#custom-emoji)
    - [Tooling](../subsystems/emoji.html#tooling)
    - [Picking emoji names](../subsystems/emoji.html#picking-emoji-names)
  + [Onboarding Steps](../subsystems/onboarding-steps.html)
    - [Configuring a New Onboarding Step](../subsystems/onboarding-steps.html#configuring-a-new-onboarding-step)
      * [Step 1: Add the Onboarding Step Name](../subsystems/onboarding-steps.html#step-1-add-the-onboarding-step-name)
      * [Step 2: Display the Onboarding Step](../subsystems/onboarding-steps.html#step-2-display-the-onboarding-step)
      * [Step 3: Mark the Onboarding Step as Read](../subsystems/onboarding-steps.html#step-3-mark-the-onboarding-step-as-read)
  + [Full-text search](../subsystems/full-text-search.html)
    - [The default full-text search implementation](../subsystems/full-text-search.html#the-default-full-text-search-implementation)
    - [Multi-language full-text search](../subsystems/full-text-search.html#multi-language-full-text-search)
      * [Enabling PGroonga](../subsystems/full-text-search.html#enabling-pgroonga)
      * [Disabling PGroonga](../subsystems/full-text-search.html#disabling-pgroonga)
  + [Email](../subsystems/email.html)
    - [Development and testing](../subsystems/email.html#development-and-testing)
      * [Testing in a real email client](../subsystems/email.html#testing-in-a-real-email-client)
      * [Notes](../subsystems/email.html#notes)
    - [Email templates](../subsystems/email.html#email-templates)
  + [Analytics](../subsystems/analytics.html)
    - [Analytics backend overview](../subsystems/analytics.html#analytics-backend-overview)
    - [The `*Count` database tables](../subsystems/analytics.html#the-count-database-tables)
    - [CountStats](../subsystems/analytics.html#countstats)
    - [The FillState table](../subsystems/analytics.html#the-fillstate-table)
    - [Performance strategy](../subsystems/analytics.html#performance-strategy)
    - [Backend testing](../subsystems/analytics.html#backend-testing)
    - [LoggingCountStats](../subsystems/analytics.html#loggingcountstats)
    - [Analytics UI development and testing](../subsystems/analytics.html#analytics-ui-development-and-testing)
      * [Setup and testing](../subsystems/analytics.html#setup-and-testing)
      * [Adding or editing /stats graphs](../subsystems/analytics.html#adding-or-editing-stats-graphs)
      * [/activity page](../subsystems/analytics.html#activity-page)
  + [Clients in Zulip](../subsystems/client.html)
    - [Analytics](../subsystems/client.html#analytics)
    - [Integrations](../subsystems/client.html#integrations)
  + [Logging and error reporting](../subsystems/logging.html)
    - [Backend error reporting](../subsystems/logging.html#backend-error-reporting)
      * [Sentry error logging](../subsystems/logging.html#sentry-error-logging)
      * [Backend logging](../subsystems/logging.html#backend-logging)
    - [Blueslip frontend error reporting](../subsystems/logging.html#blueslip-frontend-error-reporting)
      * [Sentry JavaScript error logging](../subsystems/logging.html#sentry-javascript-error-logging)
    - [Frontend performance reporting](../subsystems/logging.html#frontend-performance-reporting)
  + [Typing indicators](../subsystems/typing-indicators.html)
    - [Privacy settings](../subsystems/typing-indicators.html#privacy-settings)
    - [Writing user](../subsystems/typing-indicators.html#writing-user)
    - [Server](../subsystems/typing-indicators.html#server)
    - [Receiving user](../subsystems/typing-indicators.html#receiving-user)
    - [Ecosystem](../subsystems/typing-indicators.html#ecosystem)
    - [Roadmap](../subsystems/typing-indicators.html#roadmap)
  + [Upgrading Django](../subsystems/django-upgrades.html)
  + [Zulip server release checklist](../subsystems/release-checklist.html)
    - [A week before the release](../subsystems/release-checklist.html#a-week-before-the-release)
    - [Final release preparation](../subsystems/release-checklist.html#final-release-preparation)
    - [Executing the release](../subsystems/release-checklist.html#executing-the-release)
    - [Post-release](../subsystems/release-checklist.html#post-release)
  + [Zulip PyPI packages release checklist](../subsystems/api-release-checklist.html)
    - [Other PyPI packages maintained by Zulip](../subsystems/api-release-checklist.html#other-pypi-packages-maintained-by-zulip)
  + [UI: input pills](../subsystems/input-pills.html)
    - [Setup](../subsystems/input-pills.html#setup)
    - [Basic usage](../subsystems/input-pills.html#basic-usage)
    - [Typeahead](../subsystems/input-pills.html#typeahead)
      * [`onPillCreate` and `onPillRemove` methods](../subsystems/input-pills.html#onpillcreate-and-onpillremove-methods)
  + [Presence](../subsystems/presence.html)
  + [Unread message synchronization](../subsystems/unread_messages.html)
  + [Billing (Development)](../subsystems/billing.html)
    - [Common setup](../subsystems/billing.html#common-setup)
    - [Manual testing](../subsystems/billing.html#manual-testing)
      * [Setup](../subsystems/billing.html#setup)
      * [Test card numbers](../subsystems/billing.html#test-card-numbers)
      * [Flows to test](../subsystems/billing.html#flows-to-test)
    - [Upgrading Stripe API versions](../subsystems/billing.html#upgrading-stripe-api-versions)
    - [Writing tests](../subsystems/billing.html#writing-tests)
  + [Widgets](../subsystems/widgets.html)
    - [What is a widget?](../subsystems/widgets.html#what-is-a-widget)
    - [`/me` messages](../subsystems/widgets.html#me-messages)
    - [Polls, todo lists, and games](../subsystems/widgets.html#polls-todo-lists-and-games)
      * [Data flow](../subsystems/widgets.html#data-flow)
      * [Backward compatibility](../subsystems/widgets.html#backward-compatibility)
      * [Adding widgets](../subsystems/widgets.html#adding-widgets)
    - [zform (trivia quiz bot)](../subsystems/widgets.html#zform-trivia-quiz-bot)
    - [Data flow](../subsystems/widgets.html#id1)
  + [Slash commands](../subsystems/slash-commands.html)
    - [Data flow](../subsystems/slash-commands.html#data-flow)
    - [Typeahead](../subsystems/slash-commands.html#typeahead)
  + [Thumbnailing](../subsystems/thumbnailing.html)
    - [libvips](../subsystems/thumbnailing.html#libvips)
    - [Avatars](../subsystems/thumbnailing.html#avatars)
    - [Emoji](../subsystems/thumbnailing.html#emoji)
    - [Realm logos](../subsystems/thumbnailing.html#realm-logos)
    - [Realm icons](../subsystems/thumbnailing.html#realm-icons)
    - [File uploads](../subsystems/thumbnailing.html#file-uploads)
      * [Images](../subsystems/thumbnailing.html#images)
      * [Migrations](../subsystems/thumbnailing.html#migrations)
      * [Videos and PDFs](../subsystems/thumbnailing.html#videos-and-pdfs)

* [Writing documentation](../documentation/index.html)
  + [Documentation systems](../documentation/overview.html)
    - [Developer and sysadmin documentation](../documentation/overview.html#developer-and-sysadmin-documentation)
    - [Core website documentation](../documentation/overview.html#core-website-documentation)
    - [User-facing documentation](../documentation/overview.html#user-facing-documentation)
      * [Help center documentation](../documentation/overview.html#help-center-documentation)
      * [Integrations documentation](../documentation/overview.html#integrations-documentation)
      * [API documentation](../documentation/overview.html#api-documentation)
    - [Automated testing](../documentation/overview.html#automated-testing)
  + [Writing help center articles](../documentation/helpcenter.html)
    - [Guide to writing help center articles](../documentation/helpcenter.html#guide-to-writing-help-center-articles)
      * [Getting started](../documentation/helpcenter.html#getting-started)
      * [Updating an existing article](../documentation/helpcenter.html#updating-an-existing-article)
      * [Adding a new article](../documentation/helpcenter.html#adding-a-new-article)
      * [Redirecting an existing article](../documentation/helpcenter.html#redirecting-an-existing-article)
    - [Writing style](../documentation/helpcenter.html#writing-style)
      * [User interface](../documentation/helpcenter.html#user-interface)
      * [Voice](../documentation/helpcenter.html#voice)
      * [Keyboard shortcuts](../documentation/helpcenter.html#keyboard-shortcuts)
    - [Markdown features](../documentation/helpcenter.html#markdown-features)
      * [Images](../documentation/helpcenter.html#images)
      * [Icons](../documentation/helpcenter.html#icons)
      * [Macros](../documentation/helpcenter.html#macros)
      * [Tips and warnings](../documentation/helpcenter.html#tips-and-warnings)
      * [Tab switcher](../documentation/helpcenter.html#tab-switcher)
  + [Documenting an integration](../documentation/integrations.html)
    - [Markdown macros](../documentation/integrations.html#markdown-macros)
    - [Writing guidelines](../documentation/integrations.html#writing-guidelines)
      * [General writing guidelines](../documentation/integrations.html#general-writing-guidelines)
      * [Guidelines for specific steps](../documentation/integrations.html#guidelines-for-specific-steps)
      * [Screenshots](../documentation/integrations.html#screenshots)
  + [Documenting REST API endpoints](../documentation/api.html)
    - [How it works](../documentation/api.html#how-it-works)
      * [Title and description](../documentation/api.html#title-and-description)
      * [Usage examples](../documentation/api.html#usage-examples)
      * [Parameters](../documentation/api.html#parameters)
      * [Response with examples](../documentation/api.html#response-with-examples)
    - [Step by step guide](../documentation/api.html#step-by-step-guide)
    - [Why a custom system?](../documentation/api.html#why-a-custom-system)
    - [Debugging schema validation errors](../documentation/api.html#debugging-schema-validation-errors)
      * [Deconstructing the error output](../documentation/api.html#deconstructing-the-error-output)
      * [Adding a realm setting](../documentation/api.html#adding-a-realm-setting)
  + [OpenAPI configuration](../documentation/openapi.html)
    - [Working with the `zulip.yaml` file](../documentation/openapi.html#working-with-the-zulip-yaml-file)
      * [Configuration](../documentation/openapi.html#configuration)
      * [Endpoint definitions](../documentation/openapi.html#endpoint-definitions)
      * [Schemas](../documentation/openapi.html#schemas)
    - [Zulip Swagger YAML style:](../documentation/openapi.html#zulip-swagger-yaml-style)
    - [Tips for working with YAML:](../documentation/openapi.html#tips-for-working-with-yaml)
      * [Formatting help:](../documentation/openapi.html#formatting-help)
      * [Examples:](../documentation/openapi.html#examples)

* [Translating Zulip](../translating/index.html)
  + [Translation guidelines](../translating/translating.html)
    - [Translators’ workflow](../translating/translating.html#translators-workflow)
      * [Testing translations](../translating/translating.html#testing-translations)
      * [Machine translation](../translating/translating.html#machine-translation)
      * [Translation style guides](../translating/translating.html#translation-style-guides)
      * [Capitalization](../translating/translating.html#capitalization)
  + [Internationalization for developers](../translating/internationalization.html)
    - [Key details about human language](../translating/internationalization.html#key-details-about-human-language)
    - [Translation process](../translating/internationalization.html#translation-process)
    - [Translation resource files](../translating/internationalization.html#translation-resource-files)
    - [HTML Templates](../translating/internationalization.html#html-templates)
    - [Backend translations](../translating/internationalization.html#backend-translations)
      * [Jinja2 templates](../translating/internationalization.html#jinja2-templates)
      * [Python](../translating/internationalization.html#python)
    - [Frontend translations](../translating/internationalization.html#frontend-translations)
      * [Handlebars templates](../translating/internationalization.html#handlebars-templates)
    - [Transifex config](../translating/internationalization.html#transifex-config)
    - [Transifex CLI setup](../translating/internationalization.html#transifex-cli-setup)
  + [Chinese translation style guide(中文翻译指南)](../translating/chinese.html)
    - [Note(题记)](../translating/chinese.html#note)
    - [Terms(术语)](../translating/chinese.html#terms)
    - [Phrases(习惯用语)](../translating/chinese.html#phrases)
    - [Others(其它)](../translating/chinese.html#others)
  + [Finnish translation style guide](../translating/finnish.html)
    - [Guidelines](../translating/finnish.html#guidelines)
      * [Word order](../translating/finnish.html#word-order)
      * [Grammatical case (Sijamuodot)](../translating/finnish.html#grammatical-case-sijamuodot)
      * [Loan word (Lainasanat)](../translating/finnish.html#loan-word-lainasanat)
      * [***Please***, in error messages](../translating/finnish.html#please-in-error-messages)
      * [Zulip word inflection](../translating/finnish.html#zulip-word-inflection)
      * [Your -expression](../translating/finnish.html#your-expression)
      * [Comma](../translating/finnish.html#comma)
    - [Terms](../translating/finnish.html#terms)
    - [Other](../translating/finnish.html#other)
  + [French translation style guide](../translating/french.html)
    - [Community](../translating/french.html#community)
    - [Rules](../translating/french.html#rules)
    - [Terms](../translating/french.html#terms)
  + [German translation style guide (Richtlinien für die deutsche Übersetzung)](../translating/german.html)
    - [Rules](../translating/german.html#rules)
      * [Formal or informal?](../translating/german.html#formal-or-informal)
      * [Gender-inclusive language](../translating/german.html#gender-inclusive-language)
      * [Form of address](../translating/german.html#form-of-address)
      * [Form of instruction](../translating/german.html#form-of-instruction)
      * [Rules for labels](../translating/german.html#rules-for-labels)
      * [Concatenation of words](../translating/german.html#concatenation-of-words)
      * [Anglicisms](../translating/german.html#anglicisms)
      * [Special characters](../translating/german.html#special-characters)
      * [False friends](../translating/german.html#false-friends)
      * [Other](../translating/german.html#other)
    - [Terms (Begriffe)](../translating/german.html#terms-begriffe)
    - [Phrases (Ausdrücke)](../translating/german.html#phrases-ausdrucke)
    - [Other (Verschiedenes)](../translating/german.html#other-verschiedenes)
  + [Hindi translation style guide (हिन्दी अनुवाद शैली मार्गदर्शक)](../translating/hindi.html)
    - [Terms (शर्तें)](../translating/hindi.html#terms)
    - [Phrases (वाक्यांश)](../translating/hindi.html#phrases)
    - [Others (अन्य)](../translating/hindi.html#others)
  + [Japanese translation style guide](../translating/japanese.html)
    - [Rules](../translating/japanese.html#rules)
    - [Terms](../translating/japanese.html#terms)
  + [Polish translation style guide](../translating/polish.html)
    - [Special terms used in Zulip](../translating/polish.html#special-terms-used-in-zulip)
  + [Russian translation style guide](../translating/russian.html)
    - [Перевод некоторых терминов](../translating/russian.html#id1)
  + [Spanish translation style guide](../translating/spanish.html)
    - [Términos](../translating/spanish.html#terminos)
    - [Frases](../translating/spanish.html#frases)
    - [Otros](../translating/spanish.html#otros)
  + [Urdu translation style guide(انداذِ ترجمہ کا رہنما)](../translating/urdu.html)
    - [Terms(اصطلاحات)](../translating/urdu.html#terms)
    - [Phrases (فِقْرے)](../translating/urdu.html#phrases)
    - [Others(مختلف دیگر)](../translating/urdu.html#others)

* [Outreach programs](../outreach/index.html)
  + [Outreach programs overview](../outreach/overview.html)
    - [About Zulip](../outreach/overview.html#about-zulip)
    - [Outreach program experience](../outreach/overview.html#outreach-program-experience)
  + [How to apply](../outreach/apply.html)
    - [Application criteria](../outreach/apply.html#application-criteria)
    - [Getting started](../outreach/apply.html#getting-started)
    - [Putting together your application](../outreach/apply.html#putting-together-your-application)
      * [What to include](../outreach/apply.html#what-to-include)
      * [Project proposals](../outreach/apply.html#project-proposals)
      * [Circulating your application for feedback](../outreach/apply.html#circulating-your-application-for-feedback)
  + [How to have an amazing experience](../outreach/experience.html)
    - [Your goals](../outreach/experience.html#your-goals)
    - [You and your mentor](../outreach/experience.html#you-and-your-mentor)
    - [Communication and check-ins](../outreach/experience.html#communication-and-check-ins)
      * [Getting feedback and advice](../outreach/experience.html#getting-feedback-and-advice)
      * [How to post your check-ins](../outreach/experience.html#how-to-post-your-check-ins)
    - [Peer reviews](../outreach/experience.html#peer-reviews)
    - [How do I figure out what to work on?](../outreach/experience.html#how-do-i-figure-out-what-to-work-on)
      * [Prioritization](../outreach/experience.html#prioritization)
      * [What about my proposal?](../outreach/experience.html#what-about-my-proposal)
      * [Tips for finding issues to pick up](../outreach/experience.html#tips-for-finding-issues-to-pick-up)
      * [Staying productive](../outreach/experience.html#staying-productive)
    - [How else can I contribute?](../outreach/experience.html#how-else-can-i-contribute)
    - [Timeline extensions for GSoC](../outreach/experience.html#timeline-extensions-for-gsoc)
  + [GSoC project ideas](../outreach/gsoc.html)
    - [Project size](../outreach/gsoc.html#project-size)
    - [Focus areas](../outreach/gsoc.html#focus-areas)
    - [Project ideas by area](../outreach/gsoc.html#project-ideas-by-area)
      * [Full stack and web frontend focused projects](../outreach/gsoc.html#full-stack-and-web-frontend-focused-projects)
      * [Terminal app](../outreach/gsoc.html#terminal-app)
      * [Desktop app](../outreach/gsoc.html#desktop-app)
      * [Mobile app](../outreach/gsoc.html#mobile-app)
  + [Mentoring](../outreach/mentoring.html)
    - [Who can mentor](../outreach/mentoring.html#who-can-mentor)
    - [Supporting your mentee](../outreach/mentoring.html#supporting-your-mentee)
      * [Establishing communication patterns](../outreach/mentoring.html#establishing-communication-patterns)
    - [Managing challenges](../outreach/mentoring.html#managing-challenges)
* [Index](https://zulip.readthedocs.io/en/latest/)

[Zulip](../index.html)

* [Zulip in production](index.html)
* Upgrade Zulip
* [View page source](../_sources/production/upgrade.md.txt)

---

# Upgrade Zulip[](#upgrade-zulip "Link to this heading")

This page explains how to upgrade a Zulip server, including:

* [Upgrading to a release](#upgrading-to-a-release)
* [Upgrading from a Git repository](#upgrading-from-a-git-repository)
* [Updating `settings.py` inline documentation](#updating-settings-py-inline-documentation)
* [Troubleshooting and rollback](#troubleshooting-and-rollback)
* [Preserving local changes to service configuration files](#preserving-local-changes-to-service-configuration-files)
* [Upgrading the operating system](#upgrading-the-operating-system)
* [Upgrading PostgreSQL](#upgrading-postgresql)

## Upgrading to a release[](#upgrading-to-a-release "Link to this heading")

Note that there are additional instructions if you’re [using
docker-zulip](https://github.com/zulip/docker-zulip#upgrading-the-zulip-container), have [patched Zulip](modify.html),
or have [modified Zulip-managed configuration
files](#preserving-local-changes-to-service-configuration-files). To upgrade
to a new Zulip release:

1. Read the [upgrade notes](../overview/changelog.html#upgrade-notes)
   for all releases newer than what is currently installed.
2. Download the appropriate release tarball from
   <https://download.zulip.com/server/>. You can get the latest
   release (**Zulip Server 9.3**) with the
   following command:

   ```
   curl -fLO https://download.zulip.com/server/zulip-server-latest.tar.gz

   ```

   You also have the option of upgrading Zulip [to a version in a Git
   repository directly](#upgrading-from-a-git-repository) or creating
   your own release tarballs from a copy of the [zulip.git
   repository](https://github.com/zulip/zulip) using
   `tools/build-release-tarball`.
3. Log in to your Zulip and run as root:

   ```
   /home/zulip/deployments/current/scripts/upgrade-zulip zulip-server-latest.tar.gz

   ```

   The upgrade process will:

   * Run `apt-get upgrade`
   * Install new versions of Zulip’s dependencies (mainly Python packages).
   * (`upgrade-zulip-from-git` only) Build Zulip’s frontend assets using `webpack`.
   * Shut down the Zulip service
   * Run a `puppet apply`
   * Run any database migrations
   * Bring the Zulip service back up on the new version.

Upgrading will result in brief downtime for the service, which should
be under 30 seconds unless there is an expensive database migration
involved (these will be documented in the [release
notes](../overview/changelog.html), and usually can be avoided with
some care). If downtime is problematic for your organization,
consider testing the upgrade on a
[backup](export-and-import.html#backups) in advance,
doing the final upgrade at off hours, or buying a support contract.

See the [troubleshooting guide](#troubleshooting-and-rollback) if you
run into any issues or need to roll back the upgrade.

After you have completed the Zulip upgrade, you may also wish to [upgrade the
version of PostgreSQL](#upgrading-postgresql).

## Upgrading from a Git repository[](#upgrading-from-a-git-repository "Link to this heading")

Zulip supports upgrading a production installation to any commit in a
Git repository, which is great for [running pre-release changes from
`main`](modify.html#applying-changes-from-main) or [maintaining a
fork](modify.html#making-changes). The process is simple:

```
# Upgrade to an official release
/home/zulip/deployments/current/scripts/upgrade-zulip-from-git 1.8.1
# Upgrade to a branch (or other Git ref)
/home/zulip/deployments/current/scripts/upgrade-zulip-from-git 2.1.x
/home/zulip/deployments/current/scripts/upgrade-zulip-from-git main

```

Zulip will automatically fetch the relevant Git commit and upgrade to
that version of Zulip.

Branches with names like `2.1.x` are stable release branches,
containing the changes planned for the next minor release
(e.g., 2.1.5); we support these stable release branches as though they
were a published release.

The `main` branch contains changes planned for the next major
release (e.g., 3.0); see our documentation on [running
`main`](modify.html#upgrading-to-main) before upgrading to it.

By default, this uses the main upstream Zulip server repository, but
you can configure any other Git repository by adding a section like
this to `/etc/zulip/zulip.conf`:

```
[deployment]
git_repo_url = https://github.com/zulip/zulip.git

```

See also our documentation on [upgrading
docker-zulip](https://github.com/zulip/docker-zulip#upgrading-from-a-git-repository).

## Updating `settings.py` inline documentation[](#updating-settings-py-inline-documentation "Link to this heading")

Zulip installations often upgrade many times over their lifetime, and
we strive to keep all configuration files backwards-compatible.
However, our practice of leaving the `/etc/zulip/settings.py`
unchanged during upgrades means that there may be new features which
are not documented in that file, since it was based on a template
provided by an earlier version of Zulip, during the initial install.

After upgrading across major versions of Zulip Server, we recommend
comparing your `/etc/zulip/settings.py` file to the current settings
template, which can be found in
`/home/zulip/deployments/current/zproject/prod_settings_template.py`. We
suggest using that updated template to update
`/etc/zulip/settings.py`:

1. Copy the current `settings.py` to make a backup (especially if you
   do not have a recent [complete backup](export-and-import.html#backups)), and make a copy
   of the current template:

   ```
   cp -a /etc/zulip/settings.py ~/zulip-settings-backup.py
   cp -a /home/zulip/deployments/current/zproject/prod_settings_template.py /etc/zulip/settings-new.py

   ```
2. Open both `/etc/zulip/settings.py` and `/etc/zulip/settings-new.py`
   files in an editor; for each setting set in `settings.py`, find its
   section in `/etc/zulip/settings-new.py` and copy the setting from
   `settings.py` into there.

   The following tool may help, by finding the most likely version of
   the template that your `/etc/zulip/settings.py` was installed
   using, and the differences that your file has from that:

   ```
   /home/zulip/deployments/current/scripts/setup/compare-settings-to-template

   ```

   If there are settings which you cannot find documented in
   `/etc/zulip/settings-new.py`, check the [changelog](../overview/changelog.html) to see
   if they have been removed.
3. Overwrite the configuration with the updated file, and restart the
   server to pick up the updates; this should be a no-op, but it is
   much better to discover immediately if it is not:

   ```
   cp -a /etc/zulip/settings-new.py /etc/zulip/settings.py
   su zulip -c '/home/zulip/deployments/current/scripts/restart-server'

   ```

## Troubleshooting and rollback[](#troubleshooting-and-rollback "Link to this heading")

See also the general Zulip server [troubleshooting
guide](troubleshooting.html).

The upgrade scripts are idempotent, so there’s no harm in trying again
after resolving an issue. The most common causes of errors are:

* Networking issues (e.g., your Zulip server doesn’t have reliable
  Internet access or needs a proxy set up). Fix the networking issue
  and try again.
* Especially when using `upgrade-zulip-from-git`, systems with the
  minimal RAM for running Zulip can run into out-of-memory issues
  during the upgrade process (generally `tools/webpack` is the step
  that fails). You can get past this by shutting down the Zulip
  server with `./scripts/stop-server` to free up RAM before running
  the upgrade process.

Useful logs are available in a few places:

* The Zulip upgrade scripts log all output to
  `/var/log/zulip/upgrade.log`.
* The Zulip server logs all Internal Server Errors to
  `/var/log/zulip/errors.log`.

If you need help and don’t have a support contract, you can visit
[#production
help](https://chat.zulip.org/#narrow/channel/31-production-help) in the
[Zulip development community
server](https://zulip.com/development-community/) for best-effort help.
Please include the relevant error output from the above logs in a
[Markdown code
block](https://zulip.com/help/code-blocks)
in any reports.

### Rolling back to a prior version[](#rolling-back-to-a-prior-version "Link to this heading")

This rollback process is intended for minor releases (e.g., `2.0.3` to
`2.0.6`); a more complicated process is required to roll back database
migrations before downgrading to an older major release.

The Zulip upgrade process works by creating a new deployment under
`/home/zulip/deployments/` containing a complete copy of the Zulip server code,
and then moving the symlinks at `/home/zulip/deployments/{current,last,next}`
as part of the upgrade process.

This means that if the new version isn’t working,
you can quickly downgrade to the old version by running
`/home/zulip/deployments/last/scripts/restart-server`, or to an
earlier previous version by running
`/home/zulip/deployments/DATE/scripts/restart-server`. The
`restart-server` script stops any running Zulip server, and starts
the version corresponding to the `restart-server` path you call.

## Deployment hooks[](#deployment-hooks "Link to this heading")

Zulip’s upgrades have a hook system which allows for arbitrary
user-configured actions to run before and after an upgrade.

Files in the `/etc/zulip/pre-deploy.d` and `/etc/zulip/post-deploy.d`
directories are inspected for files ending with `.hook`, just before and after
the critical period when the server is restarted. Each file is called, sorted in
alphabetical order, from the working directory of the new version, with
environment variables as described below. If any of them exit with non-0 exit
code, the upgrade will abort.

The hook is run with the following environment variables set:

* `ZULIP_OLD_VERSION`: The version being upgraded from, which may either be a
  release name (e.g., `7.0` or `7.0-beta3`) or the output from `git describe`
  (e.g., `7.0-beta3-2-gdc158b18f2`).
* `ZULIP_NEW_VERSION`: The version being upgraded to, in the same format as
  `ZULIP_OLD_VERSION`.

If the upgrade is upgrading between [versions in `git`](#upgrading-from-a-git-repository), then
the following environment variables will also be present:

* `ZULIP_OLD_COMMIT`: The full commit hash of the version being upgraded from
* `ZULIP_NEW_COMMIT`: The full commit hash of the version being upgraded to
* `ZULIP_OLD_MERGE_BASE_COMMIT`: The full commit hash of the merge-base of the
  version being upgraded from, and the public branch in
  [`zulip/zulip`](https://github.com/zulip/zulip/). This will be the closest commit in standard
  Zulip Server to the version being upgraded from.
* `ZULIP_NEW_MERGE_BASE_COMMIT`: The full commit hash of the merge-base of the
  version being upgraded to, and the public branch in
  [`zulip/zulip`](https://github.com/zulip/zulip/). This will be the closest commit in standard
  Zulip Server to the version being upgraded to.

See the [deploy documentation](deployment.html#deployment-hooks) for
hooks included with Zulip.

## Preserving local changes to service configuration files[](#preserving-local-changes-to-service-configuration-files "Link to this heading")

Warning

If you have modified service configuration files installed by
Zulip (e.g., the nginx configuration), the Zulip upgrade process will
overwrite your configuration when it does the `puppet apply`.

You can test whether this will happen assuming no upstream changes to
the configuration using `scripts/zulip-puppet-apply` (without the
`-f` option), which will do a test Puppet run and output and changes
it would make. Using this list, you can save a copy of any files
that you’ve modified, do the upgrade, and then restore your
configuration.

That said, Zulip’s configuration files are designed to be flexible
enough for a wide range of installations, from a small self-hosted
system to Zulip Cloud. Before making local changes to a configuration
file, first check whether there’s an option supported by
`/etc/zulip/zulip.conf` for the customization you need. And if you
need to make local modifications, please report the issue so that we
can make the Zulip Puppet configuration flexible enough to handle your
setup.

### nginx configuration changes[](#nginx-configuration-changes "Link to this heading")

If you need to modify Zulip’s `nginx` configuration, we recommend
first attempting to add configuration to `/etc/nginx/conf.d` or
`/etc/nginx/zulip-include/app.d`; those directories are designed for
custom configuration, and are not overridden during upgrades. The
former is useful for directives with the `http` [context](http://nginx.org/en/docs/beginners_guide.html#conf_structure),
and the latter for `server` contexts.

## Upgrading the operating system[](#upgrading-the-operating-system "Link to this heading")

When you upgrade the operating system on which Zulip is installed
(e.g., Ubuntu 20.04 Focal to Ubuntu 22.04 Jammy), you need to take
some additional steps to update your Zulip installation, documented
below.

The steps are largely the same for the various OS upgrades aside from
the versions of PostgreSQL, so you should be able to adapt these
instructions for other supported platforms.

### Upgrading from Ubuntu 22.04 Jammy to 24.04 Noble[](#upgrading-from-ubuntu-22-04-jammy-to-24-04-noble "Link to this heading")

1. Upgrade your server to the latest Zulip `8.x` release (at
   least 8.3, which adds support for Ubuntu 24.04).
2. As the Zulip user, stop the Zulip server and run the following
   to back up the system:

   ```
   /home/zulip/deployments/current/scripts/stop-server
   /home/zulip/deployments/current/manage.py backup --output=/home/zulip/release-upgrade.backup.tar.gz

   ```
3. One of Zulip’s dependencies, RabbitMQ, is used to store deferred work
   in queues. RabbitMQ’s Ubuntu packaging has [problems](https://bugs.launchpad.net/ubuntu/%2Bsource/rabbitmq-server/%2Bbug/2074309)
   upgrading from version 3.9 in Ubuntu 22.04 to 3.12 in Ubuntu
   24.04. To work around this bug, you’ll need to uninstall
   `rabbitmq-server`, purging its database, before upgrading the OS;
   the steps after the OS upgrade will reinstall the new version and
   configure it properly. You can do this uninstallation process
   safely via the following process:

   1. As root, run:

      ```
      rabbitmqctl list_queues

      ```

      to check whether any of Zulip’s RabbitMQ queues contain
      unprocessed events.
   2. If any queues contain events, you can run as the `zulip` user

      ```
      /home/zulip/deployments/current/manage.py process_queue --all

      ```

      to process any events still in the queues. You can also decide
      to skip this step if you’re OK losing a bit of data of the
      relevant type.
   3. As root, run `apt purge rabbitmq-server` to remove the RabbitMQ
      package, including, critically, its database and configuration
      state, which would otherwise cause installation of the Ubuntu
      24.04 package to crash.
4. Switch to the root user and upgrade the operating system, following
   the prompts until it completes successfully:

   ```
   sudo -i # Or otherwise get a root shell
   do-release-upgrade

   ```

   When `do-release-upgrade` asks you how to upgrade configuration
   files for services that Zulip manages like Redis, PostgreSQL,
   nginx, and memcached, the best choice is `N` to keep the
   currently installed version. But it’s not important; the next
   step will re-install Zulip’s configuration in any case.

   The `do-release-upgrade` tool will complete by prompting you to
   restart the system; press `N`, as we will do so later.
5. Next, we need to reinstall the current version of Zulip, which
   among other things will recompile Zulip’s Python module
   dependencies for your new version of Python and rewrite Zulip’s
   full-text search indexes to work with the upgraded dictionary
   packages. This will also take care of re-installing and re-configuring
   RabbitMQ which we removed earlier.

   ```
   rm -rf /srv/zulip-venv-cache/*
   /home/zulip/deployments/current/scripts/lib/upgrade-zulip-stage-2 \
       /home/zulip/deployments/current/ --ignore-static-assets --audit-fts-indexes

   ```

   This process may show a dialog about a “pending kernel upgrade”,
   which can safely be ignored. It may also prompt about “daemons
   using outdated libraries”; you should select “cancel”.
6. As root, upgrade the database to the latest version of PostgreSQL:

   ```
   /home/zulip/deployments/current/scripts/setup/upgrade-postgresql

   ```
7. As root, restart the server:

   ```
   reboot

   ```

You should now be able to navigate to your Zulip server’s URL and
confirm everything is working correctly.

### Upgrading from Ubuntu 20.04 Focal to 22.04 Jammy[](#upgrading-from-ubuntu-20-04-focal-to-22-04-jammy "Link to this heading")

1. Upgrade your server to the latest Zulip `5.x` release (at
   least 5.3, which adds support for Ubuntu 22.04 and above).
2. As the Zulip user, stop the Zulip server and run the following
   to back up the system:

   ```
   supervisorctl stop all
   /home/zulip/deployments/current/manage.py backup --output=/home/zulip/release-upgrade.backup.tar.gz

   ```
3. Switch to the root user and upgrade the operating system, following
   the prompts until it completes successfully:

   ```
   sudo -i # Or otherwise get a root shell
   do-release-upgrade

   ```

   When `do-release-upgrade` asks you how to upgrade configuration
   files for services that Zulip manages like Redis, PostgreSQL,
   nginx, and memcached, the best choice is `N` to keep the
   currently installed version. But it’s not important; the next
   step will re-install Zulip’s configuration in any case.

   The `do-release-upgrade` tool will complete by prompting you to
   restart the system; press `N`, as we will do so later.
4. Next, we need to reinstall the current version of Zulip, which
   among other things will recompile Zulip’s Python module
   dependencies for your new version of Python and rewrite Zulip’s
   full-text search indexes to work with the upgraded dictionary
   packages:

   ```
   rm -rf /srv/zulip-venv-cache/*
   /home/zulip/deployments/current/scripts/lib/upgrade-zulip-stage-2 \
       /home/zulip/deployments/current/ --ignore-static-assets --audit-fts-indexes

   ```

   This process may show a dialog about a “pending kernel upgrade”,
   which can safely be ignored. It may also prompt about “daemons
   using outdated libraries”; you should select “cancel”.
5. As root, upgrade the database to the latest version of PostgreSQL:

   ```
   /home/zulip/deployments/current/scripts/setup/upgrade-postgresql

   ```
6. As root, restart the server:

   ```
   reboot

   ```

You should now be able to navigate to your Zulip server’s URL and
confirm everything is working correctly.

### Upgrading from Ubuntu 18.04 Bionic to 20.04 Focal[](#upgrading-from-ubuntu-18-04-bionic-to-20-04-focal "Link to this heading")

1. Upgrade your server to the latest Zulip `3.x` or `4.x` release (at
   least 3.0, which adds support for Ubuntu 20.04). You can only
   upgrade to Zulip 5.0 and newer after completing this process, since
   newer releases don’t support Ubuntu 18.04.
2. As the Zulip user, stop the Zulip server and run the following
   to back up the system:

   ```
   supervisorctl stop all
   /home/zulip/deployments/current/manage.py backup --output=/home/zulip/release-upgrade.backup.tar.gz

   ```
3. Switch to the root user and upgrade the operating system, following
   the prompts until it completes successfully:

   ```
   sudo -i # Or otherwise get a root shell
   do-release-upgrade

   ```

   When `do-release-upgrade` asks you how to upgrade configuration
   files for services that Zulip manages like Redis, PostgreSQL,
   nginx, and memcached, the best choice is `N` to keep the
   currently installed version. But it’s not important; the next
   step will re-install Zulip’s configuration in any case.

   The `do-release-upgrade` tool will complete by prompting you to
   restart the system; press `N`, as we will do so later.
4. Next, we need to reinstall the current version of Zulip, which
   among other things will recompile Zulip’s Python module
   dependencies for your new version of Python and rewrite Zulip’s
   full-text search indexes to work with the upgraded dictionary
   packages:

   ```
   rm -rf /srv/zulip-venv-cache/*
   /home/zulip/deployments/current/scripts/lib/upgrade-zulip-stage-2 \
       /home/zulip/deployments/current/ --ignore-static-assets --audit-fts-indexes

   ```
5. As root, upgrade the database to the latest version of PostgreSQL:

   ```
   /home/zulip/deployments/current/scripts/setup/upgrade-postgresql

   ```
6. Finally, Ubuntu 20.04 has a different version of the low-level
   glibc library, which affects how PostgreSQL orders text data (known
   as “collations”); this corrupts database indexes that rely on
   collations. Regenerate the affected indexes by running:

   ```
   /home/zulip/deployments/current/scripts/setup/reindex-textual-data --force

   ```
7. As root, restart the server:

   ```
   reboot

   ```
8. [Upgrade from Ubuntu 20.04 to
   22.04](#upgrading-from-ubuntu-20-04-focal-to-22-04-jammy), so that
   you are running a supported operating system.

### Upgrading from Ubuntu 16.04 Xenial to 18.04 Bionic[](#upgrading-from-ubuntu-16-04-xenial-to-18-04-bionic "Link to this heading")

1. Upgrade your server to the latest Zulip `2.1.x` release. You can
   only upgrade to Zulip 3.0 and newer after completing this process,
   since newer releases don’t support Ubuntu 16.04 Xenial.
2. Same as for Ubuntu 18.04 to 20.04.
3. Same as for Ubuntu 18.04 to 20.04.
4. As root, upgrade the database installation and OS configuration to
   match the new OS version:

   ```
   touch /usr/share/postgresql/10/pgroonga_setup.sql.applied
   /home/zulip/deployments/current/scripts/zulip-puppet-apply -f
   pg_dropcluster 10 main --stop
   systemctl stop postgresql
   pg_upgradecluster 9.5 main
   pg_dropcluster 9.5 main
   apt remove postgresql-9.5
   systemctl start postgresql
   systemctl restart memcached

   ```
5. Finally, we need to reinstall the current version of Zulip, which
   among other things will recompile Zulip’s Python module
   dependencies for your new version of Python:

   ```
   rm -rf /srv/zulip-venv-cache/*
   /home/zulip/deployments/current/scripts/lib/upgrade-zulip-stage-2 \
       /home/zulip/deployments/current/ --ignore-static-assets

   ```

   This will finish by restarting your Zulip server; you should now
   be able to navigate to its URL and confirm everything is working
   correctly.
6. [Upgrade to the latest `4.x` release](#upgrading-to-a-release).
7. As root, verify the contents of the full-text indexes:

   ```
   /home/zulip/deployments/current/manage.py audit_fts_indexes

   ```
8. [Upgrade from Ubuntu 18.04 to
   20.04](#upgrading-from-ubuntu-18-04-bionic-to-20-04-focal), the next
   in chain of upgrades leading to a supported operating system.

### Upgrading from Ubuntu 14.04 Trusty to 16.04 Xenial[](#upgrading-from-ubuntu-14-04-trusty-to-16-04-xenial "Link to this heading")

1. Upgrade your server to the latest Zulip `2.0.x` release. You can
   only upgrade to Zulip `2.1.x` and newer after completing this
   process, since newer releases don’t support Ubuntu 14.04 Trusty.
2. Same as for Ubuntu 18.04 to 20.04.
3. Same as for Ubuntu 18.04 to 20.04.
4. As root, upgrade the database installation and OS configuration to
   match the new OS version:

   ```
   apt remove upstart -y
   /home/zulip/deployments/current/scripts/zulip-puppet-apply -f
   pg_dropcluster 9.5 main --stop
   systemctl stop postgresql
   pg_upgradecluster -m upgrade 9.3 main
   pg_dropcluster 9.3 main
   apt remove postgresql-9.3
   systemctl start postgresql
   service memcached restart

   ```
5. Finally, we need to reinstall the current version of Zulip, which
   among other things will recompile Zulip’s Python module
   dependencies for your new version of Python:

   ```
   rm -rf /srv/zulip-venv-cache/*
   /home/zulip/deployments/current/scripts/lib/upgrade-zulip-stage-2 \
       /home/zulip/deployments/current/ --ignore-static-assets

   ```

   This will finish by restarting your Zulip server; you should now be
   able to navigate to its URL and confirm everything is working
   correctly.
6. [Upgrade from Ubuntu 16.04 to
   18.04](#upgrading-from-ubuntu-16-04-xenial-to-18-04-bionic), the next
   in chain of upgrades leading to a supported operating system.

### Upgrading from Debian 11 to 12[](#upgrading-from-debian-11-to-12 "Link to this heading")

1. Upgrade your server to the latest `7.x` release.
2. As the Zulip user, stop the Zulip server and run the following
   to back up the system:

   ```
   /home/zulip/deployments/current/scripts/stop-server
   /home/zulip/deployments/current/manage.py backup --output=/home/zulip/release-upgrade.backup.tar.gz

   ```
3. Follow [Debian’s instructions to upgrade the OS](https://www.debian.org/releases/bookworm/amd64/release-notes/ch-upgrading.html).

   When prompted for you how to upgrade configuration
   files for services that Zulip manages like Redis, PostgreSQL,
   nginx, and memcached, the best choice is `N` to keep the
   currently installed version. But it’s not important; the next
   step will re-install Zulip’s configuration in any case.
4. As root, run the following steps to regenerate configurations
   for services used by Zulip:

   ```
   apt remove upstart -y
   /home/zulip/deployments/current/scripts/zulip-puppet-apply -f

   ```
5. Reinstall the current version of Zulip, which among other things
   will recompile Zulip’s Python module dependencies for your new
   version of Python:

   ```
   rm -rf /srv/zulip-venv-cache/*
   /home/zulip/deployments/current/scripts/lib/upgrade-zulip-stage-2 \
       /home/zulip/deployments/current/ --ignore-static-assets --audit-fts-indexes

   ```

   This will finish by restarting your Zulip server; you should now
   be able to navigate to its URL and confirm everything is working
   correctly.
6. As an additional step, you can also [upgrade the PostgreSQL version](#upgrading-postgresql).

### Upgrading from Debian 10 to 11[](#upgrading-from-debian-10-to-11 "Link to this heading")

1. Upgrade your server to the latest `5.x` release. You can only
   upgrade to Zulip Server 6.0 and newer after completing this
   process, since newer releases don’t support Debian 10.
2. As the Zulip user, stop the Zulip server and run the following
   to back up the system:

   ```
   /home/zulip/deployments/current/scripts/stop-server
   /home/zulip/deployments/current/manage.py backup --output=/home/zulip/release-upgrade.backup.tar.gz

   ```
3. Follow [Debian’s instructions to upgrade the OS](https://www.debian.org/releases/bullseye/amd64/release-notes/ch-upgrading.html).

   When prompted for you how to upgrade configuration
   files for services that Zulip manages like Redis, PostgreSQL,
   nginx, and memcached, the best choice is `N` to keep the
   currently installed version. But it’s not important; the next
   step will re-install Zulip’s configuration in any case.
4. As root, run the following steps to regenerate configurations
   for services used by Zulip:

   ```
   apt remove upstart -y
   /home/zulip/deployments/current/scripts/zulip-puppet-apply -f

   ```
5. Reinstall the current version of Zulip, which among other things
   will recompile Zulip’s Python module dependencies for your new
   version of Python:

   ```
   rm -rf /srv/zulip-venv-cache/*
   /home/zulip/deployments/current/scripts/lib/upgrade-zulip-stage-2 \
       /home/zulip/deployments/current/ --ignore-static-assets --audit-fts-indexes

   ```

   This will finish by restarting your Zulip server; you should now
   be able to navigate to its URL and confirm everything is working
   correctly.
6. Debian 11 has a different version of the low-level glibc
   library, which affects how PostgreSQL orders text data (known as
   “collations”); this corrupts database indexes that rely on
   collations. Regenerate the affected indexes by running:

   ```
   /home/zulip/deployments/current/scripts/setup/reindex-textual-data --force

   ```
7. As an additional step, you can also [upgrade the PostgreSQL version](#upgrading-postgresql).
8. [Upgrade from Debian 11 to 12](#upgrading-from-debian-11-to-12),
   so that you are running a supported operating system.

### Upgrading from Debian 9 to 10[](#upgrading-from-debian-9-to-10 "Link to this heading")

1. Upgrade your server to the latest Zulip `2.1.x` release. You can
   only upgrade to Zulip 3.0 and newer after completing this process,
   since newer releases don’t support Debian 9.
2. As the Zulip user, stop the Zulip server and run the following
   to back up the system:

   ```
   supervisorctl stop all
   /home/zulip/deployments/current/manage.py backup --output=/home/zulip/release-upgrade.backup.tar.gz

   ```
3. Follow [Debian’s instructions to upgrade the OS](https://www.debian.org/releases/buster/amd64/release-notes/ch-upgrading.html).

   When prompted for you how to upgrade configuration
   files for services that Zulip manages like Redis, PostgreSQL,
   nginx, and memcached, the best choice is `N` to keep the
   currently installed version. But it’s not important; the next
   step will re-install Zulip’s configuration in any case.
4. As root, upgrade the database installation and OS configuration to
   match the new OS version:

   ```
   apt remove upstart -y
   /home/zulip/deployments/current/scripts/zulip-puppet-apply -f
   pg_dropcluster 11 main --stop
   systemctl stop postgresql
   pg_upgradecluster -m upgrade 9.6 main
   pg_dropcluster 9.6 main
   apt remove postgresql-9.6
   systemctl start postgresql
   service memcached restart

   ```
5. Finally, we need to reinstall the current version of Zulip, which
   among other things will recompile Zulip’s Python module
   dependencies for your new version of Python:

   ```
   rm -rf /srv/zulip-venv-cache/*
   /home/zulip/deployments/current/scripts/lib/upgrade-zulip-stage-2 \
       /home/zulip/deployments/current/ --ignore-static-assets

   ```

   This will finish by restarting your Zulip server; you should now
   be able to navigate to its URL and confirm everything is working
   correctly.
6. [Upgrade to the latest `5.x` release](#upgrading-to-a-release), now
   that your server is running a supported operating system.
7. Debian 10 has a different version of the low-level glibc
   library, which affects how PostgreSQL orders text data (known as
   “collations”); this corrupts database indexes that rely on
   collations. Regenerate the affected indexes by running:

   ```
   /home/zulip/deployments/current/scripts/setup/reindex-textual-data --force

   ```
8. As root, finish by verifying the contents of the full-text indexes:

   ```
   /home/zulip/deployments/current/manage.py audit_fts_indexes

   ```
9. [Upgrade from Debian 10 to 11](#upgrading-from-debian-10-to-11),
   the next in chain of upgrades leading to a supported operating
   system.

## Upgrading PostgreSQL[](#upgrading-postgresql "Link to this heading")

Starting with Zulip 3.0, we use the latest available version of
PostgreSQL at installation time (currently version 16). Upgrades to
the version of PostgreSQL are no longer linked to upgrades of the
distribution; that is, you may opt to upgrade to PostgreSQL 16 while
running Ubuntu 22.04.

Not all versions of Zulip Server support all versions of PostgreSQL, however:

| Zulip Server version | Supported versions of PostgreSQL |
| --- | --- |
| 3.x | 9.3, 9.5, 9.6, 10, 11, 12 |
| 4.x | 9.3, 9.5, 9.6, 10, 11, 12, 13 |
| 5.x | 10, 11, 12, 13, 14 |
| 6.x | 11, 12, 13, 14 |
| 7.x | 12, 13, 14, 15 |
| 8.x | 12, 13, 14, 15, 16 |
| 9.x | 12, 13, 14, 15, 16 |
| 10.x (unreleased) | 13, 14, 15, 16 |

To upgrade the version of PostgreSQL on the Zulip server:

1. Upgrade your server to the latest Zulip release (at least 3.0).
2. Stop the server, as the `zulip` user:

   ```
   # On Zulip before 4.0, use `supervisor stop all` instead
   /home/zulip/deployments/current/scripts/stop-server

   ```
3. Take a backup, in case of any problems:

   ```
   /home/zulip/deployments/current/manage.py backup --output=/home/zulip/postgresql-upgrade.backup.tar.gz

   ```
4. As root, run the database upgrade tool:

   ```
   /home/zulip/deployments/current/scripts/setup/upgrade-postgresql

   ```
5. As the `zulip` user, start the server again:

   ```
   # On Zulip before 4.0, use `restart-server` instead of `start-server` instead
   /home/zulip/deployments/current/scripts/start-server

   ```

You should now be able to navigate to the Zulip server’s URL and
confirm everything is working correctly.

 [Previous](mobile-push-notifications.html "Mobile push notification service")
[Next](modify.html "Modify Zulip")

---

© Copyright 2012–2015 Dropbox, Inc., 2015–2021 Kandra Labs, Inc., and contributors.

Built with [Sphinx](https://www.sphinx-doc.org/) using a
[theme](https://github.com/readthedocs/sphinx_rtd_theme)
provided by [Read the Docs](https://readthedocs.org).



=== Content from github.com_3d0bf1b1_20250114_230136.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fzulip%2Fzulip%2Fcommit%2F04cf68b45ebb5c03247a0d6453e35ffc175d55da)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fzulip%2Fzulip%2Fcommit%2F04cf68b45ebb5c03247a0d6453e35ffc175d55da)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=zulip%2Fzulip)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[zulip](/zulip)
/
**[zulip](/zulip/zulip)**
Public

* [Notifications](/login?return_to=%2Fzulip%2Fzulip) You must be signed in to change notification settings
* [Fork
  8.1k](/login?return_to=%2Fzulip%2Fzulip)
* [Star
   22k](/login?return_to=%2Fzulip%2Fzulip)

* [Code](/zulip/zulip)
* [Issues
  1.6k](/zulip/zulip/issues)
* [Pull requests
  890](/zulip/zulip/pulls)
* [Actions](/zulip/zulip/actions)
* [Projects
  2](/zulip/zulip/projects)
* [Security](/zulip/zulip/security)
* [Insights](/zulip/zulip/pulse)

Additional navigation options

* [Code](/zulip/zulip)
* [Issues](/zulip/zulip/issues)
* [Pull requests](/zulip/zulip/pulls)
* [Actions](/zulip/zulip/actions)
* [Projects](/zulip/zulip/projects)
* [Security](/zulip/zulip/security)
* [Insights](/zulip/zulip/pulse)

## Commit

[Permalink](/zulip/zulip/commit/04cf68b45ebb5c03247a0d6453e35ffc175d55da)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

uploads: Serve S3 uploads directly from nginx.

[Browse files](/zulip/zulip/tree/04cf68b45ebb5c03247a0d6453e35ffc175d55da)
Browse the repository at this point in the history

```
When file uploads are stored in S3, this means that Zulip serves as a
302 to S3.  Because browsers do not cache redirects, this means that
no image contents can be cached -- and upon every page load or reload,
every recently-posted image must be re-fetched.  This incurs extra
load on the Zulip server, as well as potentially excessive bandwidth
usage from S3, and on the client's connection.

Switch to fetching the content from S3 in nginx, and serving the
content from nginx.  These have `Cache-control: private, immutable`
headers set on the response, allowing browsers to cache them locally.

Because nginx fetching from S3 can be slow, and requests for uploads
will generally be bunched around when a message containing them are
first posted, we instruct nginx to cache the contents locally.  This
is safe because uploaded file contents are immutable; access control
is still mediated by Django.  The nginx cache key is the URL without
query parameters, as those parameters include a time-limited signed
authentication parameter which lets nginx fetch the non-public file.

This adds a number of nginx-level configuration parameters to control
the caching which nginx performs, including the amount of in-memory
index for he cache, the maximum storage of the cache on disk, and how
long data is retained in the cache.  The currently-chosen figures are
reasonable for small to medium deployments.

The most notable effect of this change is in allowing browsers to
cache uploaded image content; however, while there will be many fewer
requests, it also has an improvement on request latency.  The
following tests were done with a non-AWS client in SFO, a server and
S3 storage in us-east-1, and with 100 requests after 10 requests of
warm-up (to fill the nginx cache).  The mean and standard deviation
are shown.

|                   | Redirect to S3      | Caching proxy, hot  | Caching proxy, cold |
| ----------------- | ------------------- | ------------------- | ------------------- |
| Time in Django    | 263.0 ms ±  28.3 ms | 258.0 ms ±  12.3 ms | 258.0 ms ±  12.3 ms |
| Small file (842b) | 586.1 ms ±  21.1 ms | 266.1 ms ±  67.4 ms | 288.6 ms ±  17.7 ms |
| Large file (660k) | 959.6 ms ± 137.9 ms | 609.5 ms ±  13.0 ms | 648.1 ms ±  43.2 ms |

The hot-cache performance is faster for both large and small files,
since it saves the client the time having to make a second request to
a separate host.  This performance improvement remains at least 100ms
even if the client is on the same coast as the server.

Cold nginx caches are only slightly slower than hot caches, because
VPC access to S3 endpoints is extremely fast (assuming it is in the
same region as the host), and nginx can pool connections to S3 and
reuse them.

However, all of the 648ms taken to serve a cold-cache large file is
occupied in nginx, as opposed to the only 263ms which was spent in
nginx when using redirects to S3.  This means that to overall spend
less time responding to uploaded-file requests in nginx, clients will
need to find files in their local cache, and skip making an
uploaded-file request, at least 60% of the time.  Modeling shows a
reduction in the number of client requests by about 70% - 80%.

The `Content-Disposition` header logic can now also be entirely shared
with the local-file codepath, as can the `url_only` path used by
mobile clients.  While we could provide the direct-to-S3 temporary
signed URL to mobile clients, we choose to provide the
served-from-Zulip signed URL, to better control caching headers on it,
and greater consistency.  In doing so, we adjust the salt used for the
URL; since these URLs are only valid for 60s, the effect of this salt
change is minimal.
```

* Loading branch information

[![@alexmv](https://avatars.githubusercontent.com/u/28347?s=40&v=4)](/alexmv)

[alexmv](/zulip/zulip/commits?author=alexmv "View all commits by alexmv")
committed
Jan 9, 2023

1 parent
[58dc105](/zulip/zulip/commit/58dc1059f32c698718f7f0ac88c4728519b9ad79)

commit 04cf68b

 Show file tree

 Hide file tree

Showing
**12 changed files**
with
**211 additions**
and
**59 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* docs/production

  + docs/production/deployment.md
    [deployment.md](#diff-5ac11c9b0d80f70a510fbd59566268368f1c8dd96f280eee4827514fd312f068)
  + docs/production/upload-backends.md
    [upload-backends.md](#diff-55de3a2b127d675b840a163c125dff60d64f452ee434c14b0bce5893eae04a96)
* puppet

  + zulip

    - files/nginx/zulip-include-frontend

      * puppet/zulip/files/nginx/zulip-include-frontend/uploads-internal.conf
        [uploads-internal.conf](#diff-99154b4418e9ae2ef5baab1ff92d7d5b806d91dacca2d6cf5e2ceb0b43f2c167)
    - manifests

      * puppet/zulip/manifests/app\_frontend\_base.pp
        [app\_frontend\_base.pp](#diff-d6992a29a92ae98c3a3478e86d1c152fada3d12cdc52fc62b89f48f8e92df076)
    - templates/nginx

      * puppet/zulip/templates/nginx/s3-cache.template.erb
        [s3-cache.template.erb](#diff-282a5fc8ada550cdd85f108c8ba5bd1bf924ef4e361864c9b9328b8bfa7c9d24)
      * puppet/zulip/templates/nginx/zulip-enterprise.template.erb
        [zulip-enterprise.template.erb](#diff-f4d312519339939501aea7f94eb3b608d461429814198bf81f9282a9469f88bb)
  + zulip\_ops/files/nginx/sites-available

    - puppet/zulip\_ops/files/nginx/sites-available/zulip
      [zulip](#diff-fa1b13790b11facab10629ac20bbaa572ea8e7454d6e71878cdb99d744db94aa)
    - puppet/zulip\_ops/files/nginx/sites-available/zulip-staging
      [zulip-staging](#diff-8d37fb5c6a7edaa962167bf0e45c7eb605f5e0d6e5e088cf88181c88aa39fd66)
* zerver

  + lib/upload

    - zerver/lib/upload/s3.py
      [s3.py](#diff-d8cf7c1051fbadcbcb8d681fa9e24c07cfb1741e562678e043fc6de028cd13a4)
  + tests

    - zerver/tests/test\_upload.py
      [test\_upload.py](#diff-308811dc59fdaa872c76d0da2fd5f4e116015ee15dba19778c6b356c2363b51b)
  + views

    - zerver/views/upload.py
      [upload.py](#diff-ead268ee946e40414634e23ae30b3e796c15b7dbafd8373968eb203f342b5d9a)
* zproject

  + zproject/urls.py
    [urls.py](#diff-3d2a8322b0ee987dc05f991c59594bb00881e8879a320ba1e1e4444ce87a2cef)

## There are no files selected for viewing

23 changes: 23 additions & 0 deletions

23
[docs/production/deployment.md](#diff-5ac11c9b0d80f70a510fbd59566268368f1c8dd96f280eee4827514fd312f068 "docs/production/deployment.md")

Show comments

[View file](/zulip/zulip/blob/04cf68b45ebb5c03247a0d6453e35ffc175d55da/docs/production/deployment.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -684,6 +684,29 @@ all at once. This decreases the number of 502's served to clients, at |
|  |  | the cost of slightly increased memory usage, and the possibility that |
|  |  | different requests will be served by different versions of the code. |
|  |  |  |
|  |  | #### `s3\_memory\_cache\_size` |
|  |  |  |
|  |  | Used only when the [S3 storage backend][s3-backend] is in use. |
|  |  | Controls the in-memory size of the cache \_index\_; the default is 1MB, |
|  |  | which is enough to store about 8 thousand entries. |
|  |  |  |
|  |  | #### `s3\_disk\_cache\_size` |
|  |  |  |
|  |  | Used only when the [S3 storage backend][s3-backend] is in use. |
|  |  | Controls the on-disk size of the cache \_contents\_; the default is |
|  |  | 200MB. |
|  |  |  |
|  |  | #### `s3\_cache\_inactive\_time` |
|  |  |  |
|  |  | Used only when the [S3 storage backend][s3-backend] is in use. |
|  |  | Controls the longest amount of time an entry will be cached since last |
|  |  | use; the default is 30 days. Since the contents of the cache are |
|  |  | immutable, this serves only as a potential additional limit on the |
|  |  | size of the contents on disk; `s3\_disk\_cache\_size` is expected to be |
|  |  | the primary control for cache sizing. |
|  |  |  |
|  |  | [s3-backend]: upload-backends.md |
|  |  |  |
|  |  | #### `uwsgi\_listen\_backlog\_limit` |
|  |  |  |
|  |  | Override the default uwsgi backlog of 128 connections. |
| Expand Down | |  |

30 changes: 30 additions & 0 deletions

30
[docs/production/upload-backends.md](#diff-55de3a2b127d675b840a163c125dff60d64f452ee434c14b0bce5893eae04a96 "docs/production/upload-backends.md")

Show comments

[View file](/zulip/zulip/blob/04cf68b45ebb5c03247a0d6453e35ffc175d55da/docs/production/upload-backends.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -55,6 +55,36 @@ uploading files, this process does not upload them to Amazon S3; see |
|  |  | [migration instructions](#migrating-from-local-uploads-to-amazon-s3-backend) |
|  |  | below for those steps. |
|  |  |  |
|  |  | ## S3 local caching |
|  |  |  |
|  |  | For performance reasons, Zulip stores a cache of recently served user |
|  |  | uploads on disk locally, even though the durable storage is kept in |
|  |  | S3. There are a number of parameters which control the size and usage |
|  |  | of this cache, which is maintained by nginx: |
|  |  |  |
|  |  | - `s3\_memory\_cache\_size` controls the in-memory size of the cache |
|  |  | \_index\_; the default is 1MB, which is enough to store about 8 thousand |
|  |  | entries. |
|  |  | - `s3\_disk\_cache\_size` controls the on-disk size of the cache |
|  |  | \_contents\_; the default is 200MB. |
|  |  | - `s3\_cache\_inactive\_time` controls the longest amount of time an |
|  |  | entry will be cached since last use; the default is 30 days. Since |
|  |  | the contents of the cache are immutable, this serves only as a |
|  |  | potential additional limit on the size of the contents on disk; |
|  |  | `s3\_disk\_cache\_size` is expected to be the primary control for cache |
|  |  | sizing. |
|  |  |  |
|  |  | These defaults are likely sufficient for small-to-medium deployments. |
|  |  | Large deployments, or deployments with image-heavy use cases, will |
|  |  | want to increase `s3\_disk\_cache\_size`, potentially to be several |
|  |  | gigabytes. `s3\_memory\_cache\_size` should potentially be increased, |
|  |  | based on estimating the number of files that the larger disk cache |
|  |  | will hold. |
|  |  |  |
|  |  | You may also wish to increase the cache sizes if the S3 storage (or |
|  |  | S3-compatible equivalent) is not closely located to your Zulip server, |
|  |  | as cache misses will be more expensive. |
|  |  |  |
|  |  | ## S3 bucket policy |
|  |  |  |
|  |  | The best way to do the S3 integration with Amazon is to create a new IAM user |
| Expand Down | |  |

44 changes: 42 additions & 2 deletions

44
[puppet/zulip/files/nginx/zulip-include-frontend/uploads-internal.conf](#diff-99154b4418e9ae2ef5baab1ff92d7d5b806d91dacca2d6cf5e2ceb0b43f2c167 "puppet/zulip/files/nginx/zulip-include-frontend/uploads-internal.conf")

Show comments

[View file](/zulip/zulip/blob/04cf68b45ebb5c03247a0d6453e35ffc175d55da/puppet/zulip/files/nginx/zulip-include-frontend/uploads-internal.conf)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,12 +1,52 @@ |
|  |  | location /internal/uploads { |
|  |  | # Handle redirects to S3 |
|  |  | location ~ ^/internal/s3/([^/]+)/(.\*) { |
|  |  | internal; |
|  |  | include /etc/nginx/zulip-include/headers; |
|  |  |  |
|  |  | set $download\_url https://$1/$2; |
|  |  | proxy\_set\_header Host $1; |
|  |  |  |
|  |  | # Ensure that we only get \_one\_ of these headers: the one that |
|  |  | # Django added, not the one from S3. |
|  |  | proxy\_hide\_header Content-Disposition; |
|  |  | proxy\_hide\_header Cache-Control; |
|  |  | proxy\_hide\_header Expires; |
|  |  | proxy\_hide\_header Set-Cookie; |
|  |  | # We are \_leaving\_ S3 to provide Content-Type and Accept-Ranges |
|  |  | # headers, which are the two remaining headers which nginx would |
|  |  | # also pass through from the first response. Django explicitly |
|  |  | # unsets the former, and does not set the latter. |
|  |  |  |
|  |  | # nginx does its own DNS resolution, which is necessary here to |
|  |  | # resolve the IP of the S3 server. Point it at the local caching |
|  |  | # systemd resolved service. The validity duration is set to match |
|  |  | # S3's DNS validity. |
|  |  | resolver 127.0.0.53 valid=300s; |
|  |  | resolver\_timeout 10s; |
|  |  |  |
|  |  | proxy\_pass $download\_url$is\_args$args; |
|  |  | proxy\_cache uploads; |
|  |  | # If the S3 response doesn't contain Cache-Control headers (which |
|  |  | # we don't expect it to) then we assume they are valid for a very |
|  |  | # long time. The size of the cache is controlled by |
|  |  | # `s3\_disk\_cache\_size` and read frequency, set via |
|  |  | # `s3\_cache\_inactive\_time`. |
|  |  | proxy\_cache\_valid 200 1y; |
|  |  | # Don't include query parameters in the cache key, since those |
|  |  | # include a time-based auth token |
|  |  | proxy\_cache\_key $download\_url; |
|  |  | } |
|  |  |  |
|  |  | # Internal file-serving |
|  |  | location /internal/local/uploads { |
|  |  | internal; |
|  |  | include /etc/nginx/zulip-include/api\_headers; |
|  |  | add\_header Content-Security-Policy "default-src 'none'; style-src 'self' 'unsafe-inline'; img-src 'self'; object-src 'self'; plugin-types application/pdf;"; |
|  |  | include /etc/nginx/zulip-include/uploads.types; |
|  |  | alias /home/zulip/uploads/files; |
|  |  | } |
|  |  |  |
|  |  | location /internal/user\_avatars { |
|  |  | location /internal/local/user\_avatars { |
|  |  | internal; |
|  |  | include /etc/nginx/zulip-include/headers; |
|  |  | add\_header Content-Security-Policy "default-src 'none' img-src 'self'"; |
| Expand Down | |  |

19 changes: 18 additions & 1 deletion

19
[puppet/zulip/manifests/app\_frontend\_base.pp](#diff-d6992a29a92ae98c3a3478e86d1c152fada3d12cdc52fc62b89f48f8e92df076 "puppet/zulip/manifests/app_frontend_base.pp")

Show comments

[View file](/zulip/zulip/blob/04cf68b45ebb5c03247a0d6453e35ffc175d55da/puppet/zulip/manifests/app_frontend_base.pp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -69,6 +69,18 @@ |
|  |  | notify => Service['nginx'], |
|  |  | } |
|  |  |  |
|  |  | $s3\_memory\_cache\_size = zulipconf('application\_server', 's3\_memory\_cache\_size', '1M') |
|  |  | $s3\_disk\_cache\_size = zulipconf('application\_server', 's3\_disk\_cache\_size', '200M') |
|  |  | $s3\_cache\_inactive\_time = zulipconf('application\_server', 's3\_cache\_inactive\_time', '30d') |
|  |  | file { '/etc/nginx/zulip-include/s3-cache': |
|  |  | require => [Package[$zulip::common::nginx], File['/srv/zulip-uploaded-files-cache']], |
|  |  | owner => 'root', |
|  |  | group => 'root', |
|  |  | mode => '0644', |
|  |  | content => template('zulip/nginx/s3-cache.template.erb'), |
|  |  | notify => Service['nginx'], |
|  |  | } |
|  |  |  |
|  |  | file { '/etc/nginx/zulip-include/app.d/uploads-internal.conf': |
|  |  | ensure => file, |
|  |  | require => Package[$zulip::common::nginx], |
| Expand Down  Expand Up | | @@ -200,7 +212,12 @@ |
|  |  | group => 'zulip', |
|  |  | mode => '0755', |
|  |  | } |
|  |  |  |
|  |  | file { '/srv/zulip-uploaded-files-cache': |
|  |  | ensure => directory, |
|  |  | owner => 'zulip', |
|  |  | group => 'zulip', |
|  |  | mode => '0755', |
|  |  | } |
|  |  | file { '/var/log/zulip/queue\_error': |
|  |  | ensure => directory, |
|  |  | owner => 'zulip', |
| Expand Down | |  |

6 changes: 6 additions & 0 deletions

6
[puppet/zulip/templates/nginx/s3-cache.template.erb](#diff-282a5fc8ada550cdd85f108c8ba5bd1bf924ef4e361864c9b9328b8bfa7c9d24 "puppet/zulip/templates/nginx/s3-cache.template.erb")

Show comments

[View file](/zulip/zulip/blob/04cf68b45ebb5c03247a0d6453e35ffc175d55da/puppet/zulip/templates/nginx/s3-cache.template.erb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,6 @@ |
|  |  | # This cache is only used if S3 file storage is configured. |
|  |  | proxy\_cache\_path /srv/zulip-uploaded-files-cache |
|  |  | levels=1:2 |
|  |  | keys\_zone=uploads:<%= @s3\_memory\_cache\_size %> |
|  |  | inactive=<%= @s3\_cache\_inactive\_time %> |
|  |  | max\_size=<%= @s3\_disk\_cache\_size %>; |

2 changes: 2 additions & 0 deletions

2
[puppet/zulip/templates/nginx/zulip-enterprise.template.erb](#diff-f4d312519339939501aea7f94eb3b608d461429814198bf81f9282a9469f88bb "puppet/zulip/templates/nginx/zulip-enterprise.template.erb")

Show comments

[View file](/zulip/zulip/blob/04cf68b45ebb5c03247a0d6453e35ffc175d55da/puppet/zulip/templates/nginx/zulip-enterprise.template.erb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -12,9 +12,11 @@ server { |
|  |  | } |
|  |  | <% end -%> |
|  |  |  |
|  |  | include /etc/nginx/zulip-include/s3-cache; |
|  |  | include /etc/nginx/zulip-include/upstreams; |
|  |  | include /etc/zulip/nginx\_sharding\_map.conf; |
|  |  |  |
|  |  |  |
|  |  | server { |
|  |  | <% if @nginx\_http\_only -%> |
|  |  | listen <%= @nginx\_listen\_port %>; |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[puppet/zulip\_ops/files/nginx/sites-available/zulip](#diff-fa1b13790b11facab10629ac20bbaa572ea8e7454d6e71878cdb99d744db94aa "puppet/zulip_ops/files/nginx/sites-available/zulip")

Show comments

[View file](/zulip/zulip/blob/04cf68b45ebb5c03247a0d6453e35ffc175d55da/puppet/zulip_ops/files/nginx/sites-available/zulip)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,3 +1,4 @@ |
|  |  | include /etc/nginx/zulip-include/s3-cache; |
|  |  | include /etc/nginx/zulip-include/upstreams; |
|  |  | include /etc/zulip/nginx\_sharding\_map.conf; |
|  |  |  |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[puppet/zulip\_ops/files/nginx/sites-available/zulip-staging](#diff-8d37fb5c6a7edaa962167bf0e45c7eb605f5e0d6e5e088cf88181c88aa39fd66 "puppet/zulip_ops/files/nginx/sites-available/zulip-staging")

Show comments

[View file](/zulip/zulip/blob/04cf68b45ebb5c03247a0d6453e35ffc175d55da/puppet/zulip_ops/files/nginx/sites-available/zulip-staging)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -5,6 +5,7 @@ server { |
|  |  | return 301 https://$server\_name$request\_uri; |
|  |  | } |
|  |  |  |
|  |  | include /etc/nginx/zulip-include/s3-cache; |
|  |  | include /etc/nginx/zulip-include/upstreams; |
|  |  | include /etc/zulip/nginx\_sharding\_map.conf; |
|  |  |  |
| Expand Down | |  |

13 changes: 5 additions & 8 deletions

13
[zerver/lib/upload/s3.py](#diff-d8cf7c1051fbadcbcb8d681fa9e24c07cfb1741e562678e043fc6de028cd13a4 "zerver/lib/upload/s3.py")

Show comments

[View file](/zulip/zulip/blob/04cf68b45ebb5c03247a0d6453e35ffc175d55da/zerver/lib/upload/s3.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -91,24 +91,21 @@ def upload\_image\_to\_s3( |
|  |  | ) |
|  |  |  |
|  |  |  |
|  |  | def get\_signed\_upload\_url(path: str, download: bool = False) -> str: |
|  |  | def get\_signed\_upload\_url(path: str) -> str: |
|  |  | client = boto3.client( |
|  |  | "s3", |
|  |  | aws\_access\_key\_id=settings.S3\_KEY, |
|  |  | aws\_secret\_access\_key=settings.S3\_SECRET\_KEY, |
|  |  | region\_name=settings.S3\_REGION, |
|  |  | endpoint\_url=settings.S3\_ENDPOINT\_URL, |
|  |  | ) |
|  |  | params = { |
|  |  | "Bucket": settings.S3\_AUTH\_UPLOADS\_BUCKET, |
|  |  | "Key": path, |
|  |  | } |
|  |  | if download: |
|  |  | params["ResponseContentDisposition"] = "attachment" |
|  |  |  |
|  |  | return client.generate\_presigned\_url( |
|  |  | ClientMethod="get\_object", |
|  |  | Params=params, |
|  |  | Params={ |
|  |  | "Bucket": settings.S3\_AUTH\_UPLOADS\_BUCKET, |
|  |  | "Key": path, |
|  |  | }, |
|  |  | ExpiresIn=SIGNED\_UPLOAD\_URL\_DURATION, |
|  |  | HttpMethod="GET", |
|  |  | ) |
| Expand Down | |  |

48 changes: 35 additions & 13 deletions

48
[zerver/tests/test\_upload.py](#diff-308811dc59fdaa872c76d0da2fd5f4e116015ee15dba19778c6b356c2363b51b "zerver/tests/test_upload.py")

Show comments

[View file](/zulip/zulip/blob/04cf68b45ebb5c03247a0d6453e35ffc175d55da/zerver/tests/test_upload.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -949,7 +949,7 @@ def check\_xsend\_links( |
|  |  | test\_run, worker = os.path.split(os.path.dirname(settings.LOCAL\_UPLOADS\_DIR)) |
|  |  | self.assertEqual( |
|  |  | response["X-Accel-Redirect"], |
|  |  | "/internal/uploads/" + fp\_path + "/" + name\_str\_for\_test, |
|  |  | "/internal/local/uploads/" + fp\_path + "/" + name\_str\_for\_test, |
|  |  | ) |
|  |  | if content\_disposition != "": |
|  |  | self.assertIn("attachment;", response["Content-disposition"]) |
| Expand Down  Expand Up | | @@ -1882,7 +1882,7 @@ def test\_avatar\_url\_local(self) -> None: |
|  |  | result = self.client\_get(url) |
|  |  | self.assertEqual(result.status\_code, 200) |
|  |  | internal\_redirect\_path = urlparse(url).path.replace( |
|  |  | "/user\_avatars/", "/internal/user\_avatars/" |
|  |  | "/user\_avatars/", "/internal/local/user\_avatars/" |
|  |  | ) |
|  |  | self.assertEqual(result["X-Accel-Redirect"], internal\_redirect\_path) |
|  |  | self.assertEqual(b"", result.content) |
| Expand Down  Expand Up | | @@ -2098,35 +2098,57 @@ def test\_file\_upload\_authed(self) -> None: |
|  |  | uri = response\_dict["uri"] |
|  |  | self.assertEqual(base, uri[: len(base)]) |
|  |  |  |
|  |  | # In development, this is just a redirect |
|  |  | response = self.client\_get(uri) |
|  |  | redirect\_url = response["Location"] |
|  |  | path = urllib.parse.urlparse(redirect\_url).path |
|  |  | assert path.startswith("/") |
|  |  | key = path[1:] |
|  |  | key = path[len("/") :] |
|  |  | self.assertEqual(b"zulip!", bucket.Object(key).get()["Body"].read()) |
|  |  |  |
|  |  | prefix = f"/internal/s3/{settings.S3\_AUTH\_UPLOADS\_BUCKET}.s3.amazonaws.com/" |
|  |  | with self.settings(DEVELOPMENT=False): |
|  |  | response = self.client\_get(uri) |
|  |  | redirect\_url = response["X-Accel-Redirect"] |
|  |  | path = urllib.parse.urlparse(redirect\_url).path |
|  |  | assert path.startswith(prefix) |
|  |  | key = path[len(prefix) :] |
|  |  | self.assertEqual(b"zulip!", bucket.Object(key).get()["Body"].read()) |
|  |  |  |
|  |  | # Check the download endpoint |
|  |  | download\_uri = uri.replace("/user\_uploads/", "/user\_uploads/download/") |
|  |  | response = self.client\_get(download\_uri) |
|  |  | redirect\_url = response["Location"] |
|  |  | with self.settings(DEVELOPMENT=False): |
|  |  | response = self.client\_get(download\_uri) |
|  |  | redirect\_url = response["X-Accel-Redirect"] |
|  |  | path = urllib.parse.urlparse(redirect\_url).path |
|  |  | assert path.startswith("/") |
|  |  | key = path[1:] |
|  |  | assert path.startswith(prefix) |
|  |  | key = path[len(prefix) :] |
|  |  | self.assertEqual(b"zulip!", bucket.Object(key).get()["Body"].read()) |
|  |  |  |
|  |  | # Now try the endpoint that's supposed to return a temporary URL for access |
|  |  | # to the file. |
|  |  | result = self.client\_get("/json" + uri) |
|  |  | data = self.assert\_json\_success(result) |
|  |  | url\_only\_url = data["url"] |
|  |  | path = urllib.parse.urlparse(url\_only\_url).path |
|  |  | assert path.startswith("/") |
|  |  | key = path[1:] |
|  |  |  |
|  |  | self.assertNotEqual(url\_only\_url, uri) |
|  |  | self.assertIn("user\_uploads/temporary/", url\_only\_url) |
|  |  | self.assertTrue(url\_only\_url.endswith("zulip.txt")) |
|  |  | # The generated URL has a token authorizing the requestor to access the file |
|  |  | # without being logged in. |
|  |  | self.logout() |
|  |  | with self.settings(DEVELOPMENT=False): |
|  |  | self.client\_get(url\_only\_url) |
|  |  | redirect\_url = response["X-Accel-Redirect"] |
|  |  | path = urllib.parse.urlparse(redirect\_url).path |
|  |  | assert path.startswith(prefix) |
|  |  | key = path[len(prefix) :] |
|  |  | self.assertEqual(b"zulip!", bucket.Object(key).get()["Body"].read()) |
|  |  |  |
|  |  | # Note: Depending on whether the calls happened in the same |
|  |  | # second (resulting in the same timestamp+signature), |
|  |  | # url\_only\_url may or may not equal redirect\_url. |
|  |  | # The original uri shouldn't work when logged out: |
|  |  | with self.settings(DEVELOPMENT=False): |
|  |  | result = self.client\_get(uri) |
|  |  | self.assertEqual(result.status\_code, 403) |
|  |  |  |
|  |  | hamlet = self.example\_user("hamlet") |
|  |  | self.subscribe(hamlet, "Denmark") |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `04cf68b`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fzulip%2Fzulip%2Fcommit%2F04cf68b45ebb5c03247a0d6453e35ffc175d55da) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_2530b501_20250114_230137.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fzulip%2Fzulip%2Fcommit%2F2f6c5a883e106aa82a570d3d1f243993284b70f3)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fzulip%2Fzulip%2Fcommit%2F2f6c5a883e106aa82a570d3d1f243993284b70f3)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=zulip%2Fzulip)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[zulip](/zulip)
/
**[zulip](/zulip/zulip)**
Public

* [Notifications](/login?return_to=%2Fzulip%2Fzulip) You must be signed in to change notification settings
* [Fork
  8.1k](/login?return_to=%2Fzulip%2Fzulip)
* [Star
   22k](/login?return_to=%2Fzulip%2Fzulip)

* [Code](/zulip/zulip)
* [Issues
  1.6k](/zulip/zulip/issues)
* [Pull requests
  890](/zulip/zulip/pulls)
* [Actions](/zulip/zulip/actions)
* [Projects
  2](/zulip/zulip/projects)
* [Security](/zulip/zulip/security)
* [Insights](/zulip/zulip/pulse)

Additional navigation options

* [Code](/zulip/zulip)
* [Issues](/zulip/zulip/issues)
* [Pull requests](/zulip/zulip/pulls)
* [Actions](/zulip/zulip/actions)
* [Projects](/zulip/zulip/projects)
* [Security](/zulip/zulip/security)
* [Insights](/zulip/zulip/pulse)

## Commit

[Permalink](/zulip/zulip/commit/2f6c5a883e106aa82a570d3d1f243993284b70f3)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

CVE-2023-22735: Provide the Content-Disposition header from S3.

[Browse files](/zulip/zulip/tree/2f6c5a883e106aa82a570d3d1f243993284b70f3)
Browse the repository at this point in the history

```
The Content-Type of user-provided uploads was provided by the browser
at initial upload time, and stored in S3; however, [04cf68b](https://github.com/zulip/zulip/commit/04cf68b45ebb5c03247a0d6453e35ffc175d55da)
switched to determining the Content-Disposition merely from the
filename.  This makes uploads vulnerable to a stored XSS, wherein a
file uploaded with a content-type of `text/html` and an extension of
`.png` would be served to browsers as `Content-Disposition: inline`,
which is unsafe.

The `Content-Security-Policy` headers in the previous commit mitigate
this, but only for browsers which support them.

Revert parts of [04cf68b](https://github.com/zulip/zulip/commit/04cf68b45ebb5c03247a0d6453e35ffc175d55da), specifically by allowing S3 to provide
the Content-Disposition header, and using the
`ResponseContentDisposition` argument when necessary to override it to
`attachment`.  Because we expect S3 responses to vary based on this
argument, we include it in the cache key; since the query parameter
has dashes in it, we can't use use the helper `$arg_` variables, and
must parse it from the query parameters manually.

Adding the disposition may decrease the cache hit rate somewhat, but
downloads are infrequent enough that it is unlikely to have a
noticeable effect.  We take care to not adjust the cache key for
requests which do not specify the disposition.
```

* Loading branch information

[![@alexmv](https://avatars.githubusercontent.com/u/28347?s=40&v=4)](/alexmv)

[alexmv](/zulip/zulip/commits?author=alexmv "View all commits by alexmv")
committed
Feb 7, 2023

1 parent
[36e97f8](/zulip/zulip/commit/36e97f8121a19a7955e666d24a80ea2cf3d0b75a)

commit 2f6c5a8

 Show file tree

 Hide file tree

Showing
**4 changed files**
with
**55 additions**
and
**29 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* puppet/zulip

  + files/nginx/zulip-include-frontend

    - puppet/zulip/files/nginx/zulip-include-frontend/uploads-internal.conf
      [uploads-internal.conf](#diff-99154b4418e9ae2ef5baab1ff92d7d5b806d91dacca2d6cf5e2ceb0b43f2c167)
  + templates/nginx

    - puppet/zulip/templates/nginx/s3-cache.template.erb
      [s3-cache.template.erb](#diff-282a5fc8ada550cdd85f108c8ba5bd1bf924ef4e361864c9b9328b8bfa7c9d24)
* zerver

  + lib/upload

    - zerver/lib/upload/s3.py
      [s3.py](#diff-d8cf7c1051fbadcbcb8d681fa9e24c07cfb1741e562678e043fc6de028cd13a4)
  + views

    - zerver/views/upload.py
      [upload.py](#diff-ead268ee946e40414634e23ae30b3e796c15b7dbafd8373968eb203f342b5d9a)

## There are no files selected for viewing

18 changes: 10 additions & 8 deletions

18
[puppet/zulip/files/nginx/zulip-include-frontend/uploads-internal.conf](#diff-99154b4418e9ae2ef5baab1ff92d7d5b806d91dacca2d6cf5e2ceb0b43f2c167 "puppet/zulip/files/nginx/zulip-include-frontend/uploads-internal.conf")

Show comments

[View file](/zulip/zulip/blob/2f6c5a883e106aa82a570d3d1f243993284b70f3/puppet/zulip/files/nginx/zulip-include-frontend/uploads-internal.conf)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -14,14 +14,14 @@ location ~ ^/internal/s3/(?<s3\_hostname>[^/]+)/(?<s3\_path>.\*) { |
|  |  |  |
|  |  | # Ensure that we only get \_one\_ of these headers: the one that |
|  |  | # Django added, not the one from S3. |
|  |  | proxy\_hide\_header Content-Disposition; |
|  |  | proxy\_hide\_header Cache-Control; |
|  |  | proxy\_hide\_header Expires; |
|  |  | proxy\_hide\_header Set-Cookie; |
|  |  | # We are \_leaving\_ S3 to provide Content-Type and Accept-Ranges |
|  |  | # headers, which are the two remaining headers which nginx would |
|  |  | # also pass through from the first response. Django explicitly |
|  |  | # unsets the former, and does not set the latter. |
|  |  | # We are \_leaving\_ S3 to provide Content-Type, |
|  |  | # Content-Disposition, and Accept-Ranges headers, which are the |
|  |  | # three remaining headers which nginx would also pass through from |
|  |  | # the first response. Django explicitly unsets the first, and |
|  |  | # does not set the latter two. |
|  |  |  |
|  |  | # nginx does its own DNS resolution, which is necessary here to |
|  |  | # resolve the IP of the S3 server. Point it at the local caching |
| Expand All | | @@ -38,9 +38,11 @@ location ~ ^/internal/s3/(?<s3\_hostname>[^/]+)/(?<s3\_path>.\*) { |
|  |  | # `s3\_disk\_cache\_size` and read frequency, set via |
|  |  | # `s3\_cache\_inactive\_time`. |
|  |  | proxy\_cache\_valid 200 1y; |
|  |  | # Don't include query parameters in the cache key, since those |
|  |  | # include a time-based auth token |
|  |  | proxy\_cache\_key $download\_url; |
|  |  |  |
|  |  | # We only include the requested content-disposition in the cache |
|  |  | # key, so that we cache "Content-Disposition: attachment" |
|  |  | # separately from the inline version. |
|  |  | proxy\_cache\_key $download\_url$s3\_disposition\_cache\_key; |
|  |  | } |
|  |  |  |
|  |  | # Internal file-serving |
| Expand Down | |  |

13 changes: 13 additions & 0 deletions

13
[puppet/zulip/templates/nginx/s3-cache.template.erb](#diff-282a5fc8ada550cdd85f108c8ba5bd1bf924ef4e361864c9b9328b8bfa7c9d24 "puppet/zulip/templates/nginx/s3-cache.template.erb")

Show comments

[View file](/zulip/zulip/blob/2f6c5a883e106aa82a570d3d1f243993284b70f3/puppet/zulip/templates/nginx/s3-cache.template.erb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -4,3 +4,16 @@ proxy\_cache\_path /srv/zulip-uploaded-files-cache |
|  |  | keys\_zone=uploads:<%= @s3\_memory\_cache\_size %> |
|  |  | inactive=<%= @s3\_cache\_inactive\_time %> |
|  |  | max\_size=<%= @s3\_disk\_cache\_size %>; |
|  |  |  |
|  |  | # This is used when proxying requests to S3; we wish to know if the |
|  |  | # proxied request is asking to override the Content-Disposition in its |
|  |  | # response, so we can adjust our cache key. Unfortunately, $arg\_foo |
|  |  | # style variables pre-parsed from query parameters don't work with |
|  |  | # query parameters with dashes, so we parse it out by hand. Despite |
|  |  | # needing to be declared at the 'http' level,. nginx applies maps like |
|  |  | # this lazily, so this only affects internal S3 proxied requests. |
|  |  |  |
|  |  | map $args $s3\_disposition\_cache\_key { |
|  |  | default ""; |
|  |  | "~(^|&)(?<param>response-content-disposition=[^&]+)" "?$param"; |
|  |  | } |

13 changes: 8 additions & 5 deletions

13
[zerver/lib/upload/s3.py](#diff-d8cf7c1051fbadcbcb8d681fa9e24c07cfb1741e562678e043fc6de028cd13a4 "zerver/lib/upload/s3.py")

Show comments

[View file](/zulip/zulip/blob/2f6c5a883e106aa82a570d3d1f243993284b70f3/zerver/lib/upload/s3.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -91,21 +91,24 @@ def upload\_image\_to\_s3( |
|  |  | ) |
|  |  |  |
|  |  |  |
|  |  | def get\_signed\_upload\_url(path: str) -> str: |
|  |  | def get\_signed\_upload\_url(path: str, force\_download: bool = False) -> str: |
|  |  | client = boto3.client( |
|  |  | "s3", |
|  |  | aws\_access\_key\_id=settings.S3\_KEY, |
|  |  | aws\_secret\_access\_key=settings.S3\_SECRET\_KEY, |
|  |  | region\_name=settings.S3\_REGION, |
|  |  | endpoint\_url=settings.S3\_ENDPOINT\_URL, |
|  |  | ) |
|  |  | params = { |
|  |  | "Bucket": settings.S3\_AUTH\_UPLOADS\_BUCKET, |
|  |  | "Key": path, |
|  |  | } |
|  |  | if force\_download: |
|  |  | params["ResponseContentDisposition"] = "attachment" |
|  |  |  |
|  |  | return client.generate\_presigned\_url( |
|  |  | ClientMethod="get\_object", |
|  |  | Params={ |
|  |  | "Bucket": settings.S3\_AUTH\_UPLOADS\_BUCKET, |
|  |  | "Key": path, |
|  |  | }, |
|  |  | Params=params, |
|  |  | ExpiresIn=SIGNED\_UPLOAD\_URL\_DURATION, |
|  |  | HttpMethod="GET", |
|  |  | ) |
| Expand Down | |  |

40 changes: 24 additions & 16 deletions

40
[zerver/views/upload.py](#diff-ead268ee946e40414634e23ae30b3e796c15b7dbafd8373968eb203f342b5d9a "zerver/views/upload.py")

Show comments

[View file](/zulip/zulip/blob/2f6c5a883e106aa82a570d3d1f243993284b70f3/zerver/views/upload.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -88,8 +88,8 @@ def internal\_nginx\_redirect(internal\_path: str) -> HttpResponse: |
|  |  | return response |
|  |  |  |
|  |  |  |
|  |  | def serve\_s3(request: HttpRequest, path\_id: str, download: bool = False) -> HttpResponse: |
|  |  | url = get\_signed\_upload\_url(path\_id) |
|  |  | def serve\_s3(request: HttpRequest, path\_id: str, force\_download: bool = False) -> HttpResponse: |
|  |  | url = get\_signed\_upload\_url(path\_id, force\_download=force\_download) |
|  |  | assert url.startswith("https://") |
|  |  |  |
|  |  | if settings.DEVELOPMENT: |
| Expand All | | @@ -107,18 +107,30 @@ def serve\_s3(request: HttpRequest, path\_id: str, download: bool = False) -> Http |
|  |  | assert parsed\_url.query is not None |
|  |  | escaped\_path\_parts = parsed\_url.hostname + quote(parsed\_url.path) + "?" + parsed\_url.query |
|  |  | response = internal\_nginx\_redirect("/internal/s3/" + escaped\_path\_parts) |
|  |  | patch\_disposition\_header(response, path\_id, download) |
|  |  |  |
|  |  | # It is important that S3 generate both the Content-Type and |
|  |  | # Content-Disposition headers; when the file was uploaded, we |
|  |  | # stored the browser-provided value for the former, and set |
|  |  | # Content-Disposition according to if that was safe. As such, |
|  |  | # only S3 knows if a given attachment is safe to inline; we only |
|  |  | # override Content-Disposition to "attachment", and do so by |
|  |  | # telling S3 that is what we want in the signed URL. |
|  |  | patch\_cache\_control(response, private=True, immutable=True) |
|  |  | return response |
|  |  |  |
|  |  |  |
|  |  | def serve\_local(request: HttpRequest, path\_id: str, download: bool = False) -> HttpResponseBase: |
|  |  | def serve\_local( |
|  |  | request: HttpRequest, path\_id: str, force\_download: bool = False |
|  |  | ) -> HttpResponseBase: |
|  |  | assert settings.LOCAL\_FILES\_DIR is not None |
|  |  | local\_path = os.path.join(settings.LOCAL\_FILES\_DIR, path\_id) |
|  |  | assert\_is\_local\_storage\_path("files", local\_path) |
|  |  | if not os.path.isfile(local\_path): |
|  |  | return HttpResponseNotFound("<p>File not found</p>") |
|  |  |  |
|  |  | mimetype, encoding = guess\_type(path\_id) |
|  |  | download = force\_download or mimetype not in INLINE\_MIME\_TYPES |
|  |  |  |
|  |  | if settings.DEVELOPMENT: |
|  |  | # In development, we do not have the nginx server to offload |
|  |  | # the response to; serve it directly ourselves. |
| Expand All | | @@ -138,7 +150,9 @@ def serve\_local(request: HttpRequest, path\_id: str, download: bool = False) -> H |
|  |  | def serve\_file\_download\_backend( |
|  |  | request: HttpRequest, user\_profile: UserProfile, realm\_id\_str: str, filename: str |
|  |  | ) -> HttpResponseBase: |
|  |  | return serve\_file(request, user\_profile, realm\_id\_str, filename, url\_only=False, download=True) |
|  |  | return serve\_file( |
|  |  | request, user\_profile, realm\_id\_str, filename, url\_only=False, force\_download=True |
|  |  | ) |
|  |  |  |
|  |  |  |
|  |  | def serve\_file\_backend( |
| Expand Down  Expand Up | | @@ -167,7 +181,7 @@ def serve\_file( |
|  |  | realm\_id\_str: str, |
|  |  | filename: str, |
|  |  | url\_only: bool = False, |
|  |  | download: bool = False, |
|  |  | force\_download: bool = False, |
|  |  | ) -> HttpResponseBase: |
|  |  | path\_id = f"{realm\_id\_str}/{filename}" |
|  |  | realm = get\_valid\_realm\_from\_request(request) |
| Expand All | | @@ -181,13 +195,10 @@ def serve\_file( |
|  |  | url = generate\_unauthed\_file\_access\_url(path\_id) |
|  |  | return json\_success(request, data=dict(url=url)) |
|  |  |  |
|  |  | mimetype, encoding = guess\_type(path\_id) |
|  |  | download = download or mimetype not in INLINE\_MIME\_TYPES |
|  |  |  |
|  |  | if settings.LOCAL\_UPLOADS\_DIR is not None: |
|  |  | return serve\_local(request, path\_id, download=download) |
|  |  | return serve\_local(request, path\_id, force\_download=force\_download) |
|  |  | else: |
|  |  | return serve\_s3(request, path\_id, download=download) |
|  |  | return serve\_s3(request, path\_id, force\_download=force\_download) |
|  |  |  |
|  |  |  |
|  |  | USER\_UPLOADS\_ACCESS\_TOKEN\_SALT = "user\_uploads\_" |
| Expand Down  Expand Up | | @@ -221,13 +232,10 @@ def serve\_file\_unauthed\_from\_token( |
|  |  | if path\_id.split("/")[-1] != filename: |
|  |  | raise JsonableError(\_("Invalid filename")) |
|  |  |  |
|  |  | mimetype, encoding = guess\_type(path\_id) |
|  |  | download = mimetype not in INLINE\_MIME\_TYPES |
|  |  |  |
|  |  | if settings.LOCAL\_UPLOADS\_DIR is not None: |
|  |  | return serve\_local(request, path\_id, download=download) |
|  |  | return serve\_local(request, path\_id) |
|  |  | else: |
|  |  | return serve\_s3(request, path\_id, download=download) |
|  |  | return serve\_s3(request, path\_id) |
|  |  |  |
|  |  |  |
|  |  | def serve\_local\_avatar\_unauthed(request: HttpRequest, path: str) -> HttpResponseBase: |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `2f6c5a8`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fzulip%2Fzulip%2Fcommit%2F2f6c5a883e106aa82a570d3d1f243993284b70f3) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_a929d584_20250114_230137.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fzulip%2Fzulip%2Fsecurity%2Fadvisories%2FGHSA-wm83-3764-5wqh)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fzulip%2Fzulip%2Fsecurity%2Fadvisories%2FGHSA-wm83-3764-5wqh)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=zulip%2Fzulip)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[zulip](/zulip)
/
**[zulip](/zulip/zulip)**
Public

* [Notifications](/login?return_to=%2Fzulip%2Fzulip) You must be signed in to change notification settings
* [Fork
  8.1k](/login?return_to=%2Fzulip%2Fzulip)
* [Star
   22k](/login?return_to=%2Fzulip%2Fzulip)

* [Code](/zulip/zulip)
* [Issues
  1.6k](/zulip/zulip/issues)
* [Pull requests
  890](/zulip/zulip/pulls)
* [Actions](/zulip/zulip/actions)
* [Projects
  2](/zulip/zulip/projects)
* [Security](/zulip/zulip/security)
* [Insights](/zulip/zulip/pulse)

Additional navigation options

* [Code](/zulip/zulip)
* [Issues](/zulip/zulip/issues)
* [Pull requests](/zulip/zulip/pulls)
* [Actions](/zulip/zulip/actions)
* [Projects](/zulip/zulip/projects)
* [Security](/zulip/zulip/security)
* [Insights](/zulip/zulip/pulse)

# User uploads proxied from S3 lack `Content-Security-Policy` headers, may be served with `Content-Disposition: inline`

Moderate

[alexmv](/alexmv)
published
GHSA-wm83-3764-5wqh
Feb 7, 2023

## Package

Zulip Server
(Application)

## Affected versions

main branch (2023-01-09)

## Patched versions

main branch (2023-02-07)

## Description

### Impact

Users could upload files with arbitrary `Content-Type` which would be served from the Zulip hostname with `Content-Disposition: inline` and no `Content-Security-Policy` header, allowing them to trick other users into executing arbitrary Javascript in the context of the Zulip application. Among other things, this enables session theft.

Only deployments which use the S3 storage (not the local-disk storage) are affected, and only deployments which deployed [04cf68b](https://github.com/zulip/zulip/commit/04cf68b45ebb5c03247a0d6453e35ffc175d55da) (merged on January 9th), which has only been in `main`. This vulnerability does not affect any numbered release.

### Workarounds

Switching from S3 storage to the local-disk storage would nominally mitigate this, but is likely more involved than upgrading to the latest `main` which addresses the issue.

### Patches

The vulnerability was fixed in the `main` branch with commit [2f6c5a8](https://github.com/zulip/zulip/commit/2f6c5a883e106aa82a570d3d1f243993284b70f3). Users running a Zulip server from the `main` branch should [upgrade from `main`](https://zulip.readthedocs.io/en/latest/production/upgrade-or-modify.html#upgrading-from-a-git-repository) again to deploy this fix.

### Severity

Moderate

5.4

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
Low

User interaction
Required

Scope
Changed

Confidentiality
Low

Integrity
Low

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N

### CVE ID

CVE-2023-22735

### Weaknesses

[CWE-436](/advisories?query=cwe%3A436)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


