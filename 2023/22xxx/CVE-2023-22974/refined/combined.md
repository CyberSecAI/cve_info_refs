=== Content from www.open-emr.org_e9c486b9_20250114_192940.html ===

[![](/wiki/skins/Openemr/images/openemr-logo-wiki.svg)](/)

* [Features](/wiki/index.php/OpenEMR_Features)
* [Demo](/demo)
* [Download](/wiki/index.php/OpenEMR_Downloads)
* [Modules](/modules)
* [Blog](/blog)
* [Docs](/wiki)
* [Forum](https://community.open-emr.org/)
* [Chat](/chat)
* Support
  [Professional Support Vendors](/wiki/index.php/Professional_Support)
  [Costs and Support Options](/support)
  [Community Support](https://community.open-emr.org/)
  [Free Basic Live Chat Support](/chat)

# OpenEMR Patches

From OpenEMR Project Wiki

## Contents

* [1 7.0.3 Patch (11/24/24)](#7.0.3_Patch_.2811.2F24.2F24.29)
  + [1.1 Download link](#Download_link)
  + [1.2 Description](#Description)
  + [1.3 Installation instructions](#Installation_instructions)
    - [1.3.1 Windows](#Windows)
    - [1.3.2 Linux](#Linux)
  + [1.4 Fixes and New Features](#Fixes_and_New_Features)
  + [1.5 List of files (7.0.2) Patch 3](#List_of_files_.287.0.2.29_Patch_3)
* [2 Previous Patches](#Previous_Patches)
# 7.0.3 Patch (11/24/24)

### Download link

[7-0-2-Patch-3.zip](https://www.open-emr.org/patch/7-0-2-Patch-3.zip "https://www.open-emr.org/patch/7-0-2-Patch-3.zip") (MD5 sum: e59f19bc90c5a1459ddbd415916f2a0d)

### Description

This is the 3rd patch and also includes changes from prior patch.

### Installation instructions

#### Windows

1. Extract the zipped file into the openemr web directory, and say yes to copying over files
2. Open web browser and go to http://your\_server\_name\_or\_ip/openemr/sql\_patch.php
(this script will run automatically and patch the database)
(if you are using the [Multisite Module](/wiki/index.php/OpenEMR_Multiple_Sites_Module "OpenEMR Multiple Sites Module"), then skip step 2 and [follow these instructions](/wiki/index.php/OpenEMR_Multiple_Sites_Module#Patches "OpenEMR Multiple Sites Module"))
3. Delete the sql\_patch.php file from the openemr web directory
#### Linux

1. Move the patch file to the openemr web directory, then type 'unzip 7-0-2-Patch-3.zip', and confirm ok to copy over files.
2. Open web browser and go to http://your\_server\_name\_or\_ip/openemr/sql\_patch.php
(this script will run automatically and patch the database)
(if you are using the [Multisite Module](/wiki/index.php/OpenEMR_Multiple_Sites_Module "OpenEMR Multiple Sites Module"), then skip step 2 and [follow these instructions](/wiki/index.php/OpenEMR_Multiple_Sites_Module#Patches "OpenEMR Multiple Sites Module"))
3. Delete the sql\_patch.php file from the openemr web directory

### Fixes and New Features

* [Click here to see CHANGELOG for detailed listing of new features and fixes.](https://github.com/openemr/openemr/blob/master/CHANGELOG.md#7023---2024-11-24)
* Some highlights include ( \*\* are highlights from most recent patch):

* ONC b11 Decision Support Interventions (DSI)\*\*
* Miscellaneous -> New Documents select patient fix.\*\*
* Miscellaneous -> New restyled Office Notes with edit and delete.\*\*
* Two new Radio Group keys of any size for use with portal Document Templates.\*\*
* Major Patient Portal styling refactor and bug fixes. Must see!
* Completed Patient Document Template Forms from Dashboard Demographics Patient Documents.
* Updated Weno eRX module for better logging and new feature in widget to allow any registered Weno Location selection for ePrescribe.
* Update, fix and tested OfficeAlly Insurance Eligibility.
* Improved insurances handling.
* Added RingCentral vendor back to FaxSMS module.
* New Email client in FaxSMS module for appointment notifications.
* Many bug fixes in FaxSMS module.
* Fax disposition feature update.
* Upgraded FHIR and encounter Questionnaires LForms with new release and optional original, light and dark themes. See Config.
* Many Billing fixes e.g. Patient and Insurance edit redirects fixed in Billing Manager.
* SMART on FHIR and FHIR API bug fixes.
* [New Weno EZ eRx module](https://community.open-emr.org/t/new-weno-module-install-and-setup/21995)
* Updated etherFax module with new TIFF capabilities. [Click here for upgrade information.](https://community.open-emr.org/t/openemr-fax-and-or-sms-module-guide/20273#using-etherfax-4)
* Added Real World Testing Report for 2024
* Billing Manager.
* [Modules Manager overhaul with new features including MM action listener class.](https://github.com/openemr/openemr/issues/7247)
* UB04 837i Institutional billing fixes and updates.
* Clinical Decision Rules engine fixes.
* Security fixes (Reported by Roger Meyer, Vinicius Ribeiro and A3h1nt).
* Upgrading from older versions

### List of files (7.0.2) Patch 3

Since there are quite a few files please list them on the command line with `unzip -l 7-0-2-Patch-3.zip` or open up the zip archive with your favorite utility.

# Previous Patches

[Previous OpenEMR version patches](/wiki/index.php/Old_Outdated_OpenEMR_Patches "Old Outdated OpenEMR Patches")

Retrieved from "<https://www.open-emr.org/wiki/index.php?title=OpenEMR_Patches&oldid=36101>"

[Categories](/wiki/index.php/Special%3ACategories "Special:Categories"):

* [Download](/wiki/index.php/Category%3ADownload "Category:Download")
* [Patch](/wiki/index.php/Category%3APatch "Category:Patch")

## Navigation menu

[# OpenEMR Project Wiki](/wiki/index.php/OpenEMR_Wiki_Home_Page)

### Search

### Personal tools

* [Log in](/wiki/index.php?title=Special:UserLogin&returnto=OpenEMR+Patches "You are encouraged to log in; however, it is not mandatory [o]")

### Namespaces

* [Page](/wiki/index.php/OpenEMR_Patches "View the content page [c]")
* [Discussion](/wiki/index.php?title=Talk:OpenEMR_Patches&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

### Variants

### Views

* [View](/wiki/index.php/OpenEMR_Patches)
* [View source](/wiki/index.php?title=OpenEMR_Patches&action=edit "This page is protected.
  You can view its source [e]")
* [History](/wiki/index.php?title=OpenEMR_Patches&action=history "Past revisions of this page [h]")

### More

### wiki navigation

* [Main wiki page](/wiki/index.php/OpenEMR_Wiki_Home_Page)
* [Categories](/wiki/index.php/Special%3ACategories)
* [Recent changes](/wiki/index.php/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Random page](/wiki/index.php/Special%3ARandom "Load a random page [x]")
* [Help](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Help%3AContents "The place to find out")

### Tools

* [What links here](/wiki/index.php/Special%3AWhatLinksHere/OpenEMR_Patches "A list of all wiki pages that link here [j]")
* [Related changes](/wiki/index.php/Special%3ARecentChangesLinked/OpenEMR_Patches "Recent changes in pages linked from this page [k]")
* [Special pages](/wiki/index.php/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/wiki/index.php?title=OpenEMR_Patches&oldid=36101 "Permanent link to this revision of the page")
* [Page information](/wiki/index.php?title=OpenEMR_Patches&action=info "More information about this page")

* [![GNU Free Documentation License 1.3](/wiki/resources/assets/licenses/gnu-fdl.png)](http://www.gnu.org/copyleft/fdl.html)
* [![Powered by MediaWiki](/wiki/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)

* This page was last edited on 25 November 2024, at 06:04.
* Content is available under [GNU Free Documentation License 1.3](http://www.gnu.org/copyleft/fdl.html) unless otherwise noted.

* [Privacy policy](/wiki/index.php/OpenEMR_Project_Wiki%3APrivacy_policy "OpenEMR Project Wiki:Privacy policy")
* [About OpenEMR Project Wiki](/wiki/index.php/OpenEMR_Project_Wiki%3AAbout "OpenEMR Project Wiki:About")
* [Disclaimers](/wiki/index.php/OpenEMR_Project_Wiki%3AGeneral_disclaimer "OpenEMR Project Wiki:General disclaimer")



=== Content from www.sonarsource.com_47fc1e50_20250114_192941.html ===
NEW![Sonar has entered a definitive agreement to acquire Tidelift! Read the press release.](/company/press-releases/sonar-to-acquire-tidelift/) [![](data:image/svg+xml;charset=utf-8...)![sonar logo ](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/8e59bcad-6e39-41dc-abd9-a0e251e8d63f/Sonar%20%282%29.svg?w=128&h=32&auto=format&fit=clip)![sonar logo ](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/8e59bcad-6e39-41dc-abd9-a0e251e8d63f/Sonar%20%282%29.svg?w=128&h=32&auto=format&fit=clip)](/ "Home")

* Solutions

  Use Cases

  [AI-assisted & quality-assured codeEnsure code generated by AI assistants is of the highest quality](/solutions/ai/)[DevOps transformationHarness the full potential of DevOps by reducing roll backs and improving quality of releases](/solutions/devops-transformation/)[Code coverageEnsure code quality and security by facilitating faster debugging through clear visibility of coverage gaps.](/solutions/code-coverage/) [Reduce & manage technical debtMaximize innovation by proactively managing technical debt](/solutions/reduce-technical-debt/)[Secure by designIntegrate code security in compliance with NIST Secure Software Development Framework](/solutions/secure-by-design-code/)[All Use CasesRead more about Sonar Use cases with blog articles, technical articles and developer guides](/solutions/use-cases/)

  Clean Code

  [What is clean codeA detailed definition of Clean Code](/solutions/clean-code/)[Power of clean codeBusiness success built on Clean Code](/solutions/power-of-clean-code/)[Security starts with Clean CodeStatic Application Security Testing with Sonar](/solutions/security/)[Clean as You CodeOur unique approach to Clean Code](/solutions/our-unique-approach/)

  Something For Everyone

  [For DevelopersFind and fix issues as you code](/solutions/for-developers/)[For DevOpsBuild your apps on Clean Code foundations](/solutions/infrastructure-as-code/)[For EnterpriseClean Code delivery from development to production](/solutions/for-enterprise/)[For the Public SectorClean Code for the public sector](/solutions/public-sector/)
* Products

  Industry Leading Products

  [![]()![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/aa3b1f02-f1b0-448f-a3f2-a1bd32923a08/SQ_Logo_Cloud_Light%20Backgrounds.svg?w=176&h=48&auto=format&fit=crop)Formerly SonarCloudCloud-based static analysis tool for your CI/CD workflows](/products/sonarcloud/)[![]()![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/bdac1871-464e-4051-88db-7df20c3bfffa/SQ_Logo_Server_Light%20Backgrounds.svg?w=176&h=48&auto=format&fit=crop)Formerly SonarQubeSelf-managed static analysis tool for continuous codebase inspection](/products/sonarqube/)[![]()![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/49f23af2-a29b-4d0f-95d7-ffd361f375e1/SQ_Logo_IDE_Light%20Backgrounds.svg?w=176&h=48&auto=format&fit=crop)Formerly SonarLintFree IDE extension that provides on-the-fly analysis and coding guidance](/products/sonarlint/)

  Languages and Frameworks

  [Java](/knowledge/languages/java/)[JavaScript](/knowledge/languages/js/)[TypeScript](/knowledge/languages/ts/)[Python](/knowledge/languages/python/)[C#](/knowledge/languages/csharp/)[C++](/knowledge/languages/cpp/)[C](/knowledge/languages/c/)[PHP](/knowledge/languages/php/)[Kotlin](/knowledge/languages/kotlin/)[See All](/lp/knowledge/languages/)
* Resources

  Learn About Clean Code

  [BlogStay connected with our latest development news and articles](/blog/)[Events hubLet's meet up online or in person - browse our conferences and webinars, or watch previous talks](/resources/events/)[Customer StoriesCheck out Sonar implementation success stories](/resources/customer-stories/)[White PapersFind in-depth articles on clean code](/resources/white-papers/)[LearnDeveloper learning hub - covering essential topics](/learn/)[Solution BriefsOur library of solution briefs](/resources/solution-briefs/)

  Go In Depth

  [SonarQube Server DocumentationFind more information on the technical details of SonarQube Server](https://docs.sonarsource.com/sonarqube/latest/)[SonarQube Cloud DocumentationFind more information on the technical details of SonarQube Cloud](https://docs.sonarsource.com/sonarcloud/)[SonarQube for IDE DocumentationFind more information on the technical details of SonarQube IDE](https://docs.sonarsource.com/sonarlint/)[Explore SonarpediaExplore our publicly available multi-language rules database](https://rules.sonarsource.com/)[LanguagesSee our multi-language coverage](/knowledge/languages/)
* Company

  Deliver Better Software

  [About UsSonar’s industry leading solution enables developers to write clean code and remediate existing code organically](/company/about/)[CareersJoin our growing team](/company/careers/)[Commitment to open sourceOur commitment to transparency, security, and continuous improvement](/solutions/commitment-to-open-source/)[CommunityGet latest updates, suggest features, and share your knowledge](https://community.sonarsource.com/)[PartnersSonar partners with the best resellers to bring Clean Code closer to you](/company/partners/)[Contact usHave questions? Get in touch](/company/contact/)

  Media

  [NewsroomNews announcements, media coverage, and more](/company/newsroom/)[CoverageFind articles about Sonar in the news](/company/coverage/)[Press ReleasesThe latest Sonar updates](/company/press-releases/)[CustomersAn overview of customers using Sonar by industry](/company/customers/)[Press KitExecutive headshots, quick stats, customer logos, and more](/company/press-kit/)
[Start for free](/open-source-editions/)[Explore pricing](/plans-and-pricing/)
Search modal toggle button[Start for free](/open-source-editions/)[Explore pricing](/plans-and-pricing/)Mobile menu toggle button

Blog post

# OpenEMR - Remote Code Execution in your Healthcare System

![](data:image/svg+xml;charset=utf-8...)![Dennis Brinkrolf photo]()![Dennis Brinkrolf photo](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/4e33a3d4-6781-4fe3-aaa3-0ec178d00386/d118d723-bccb-4102-9d5c-ccf1a2a99e5f_dennis_brinkrolf.png?w=400&h=400&auto=format&fit=crop)

Dennis Brinkrolf

Security Researcher

January 25, 2023

8 min read

* [Security](/blog/tag/security/)
![](data:image/svg+xml;charset=utf-8...)![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/6de6bf70-0216-4289-adc6-488e80c6d1e1/OpenEMR_blog-index-image.webp?w=2400&h=1254&auto=format&fit=crop)![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/6de6bf70-0216-4289-adc6-488e80c6d1e1/OpenEMR_blog-index-image.webp?w=2400&h=1254&auto=format&fit=crop)

OpenEMR is the most popular open-source software for electronic health records and medical practice management. It is used worldwide to manage sensitive patient data, including information about medications, laboratory values, and diseases. Patients use OpenEMR to schedule appointments, communicate with physicians, and pay online invoices. Specifically, in these tumultuous times of an ongoing pandemic, this is highly sensitive data, and protecting it is a concern for everyone.

During our security research of popular web applications, we discovered several code vulnerabilities in OpenEMR. A combination of these vulnerabilities allows remote attackers to execute arbitrary system commands on any OpenEMR server and to steal sensitive patient data. In the worst case, they can compromise the entire critical infrastructure.

Our SAST engine discovered two code vulnerabilities that, in combination, led to unauthenticated remote code execution. This blog post analyzes the technical causes of the vulnerabilities, their impact, and how you can prevent them in your code.

## Impact

We discovered the following vulnerabilities in OpenEMR:

* Unauthenticated File Read
* Authenticated Local File Inclusion
* Authenticated Reflected XSS

An unauthenticated, remote attacker can chain these vulnerabilities to gain code execution on a server running OpenEMR version lower than 7.0.0.

We reported all issues responsibly to the OpenEMR maintainers, who immediately released a [patch](https://www.open-emr.org/wiki/index.php/OpenEMR_Patches#7.0.0_Patch_.2811.2F30.2F22.29 "patch") to version 7.0.0 to protect all users.

## Technical Details

In this section, we dive deep into the technical details of three vulnerabilities. First, we show how a rogue MySQL server can read arbitrary files from an OpenEMR instance. Then we discuss two other vulnerabilities and show how their combination allows unauthenticated, remote code execution.

### Unauthenticated Arbitrary File Read

In OpenEMR, the installer does not delete itself after a successful installation. Furthermore, the setup is divided into several steps, and an unauthenticated user can perform some of these via the user-controlled parameter `$state`**.**

A complete reinstallation is impossible, but attackers can specify a configuration during the setup steps by setting the properties of the `Installer` class (`$_REQUEST`). Afterward, the method `displayNewThemeDiv` is called:

**setup.php**

```
<?php
// ...
$state = isset($_POST["state"]) ? ($_POST["state"]) : '';
$installer = new Installer($_REQUEST);
// ...
if ($state == 7) {
// ...
$installer->displayNewThemeDiv();
```

The `displayNewThemeDiv` method invokes the `getCurrentTheme` method. During this call, a MySQL query is executed, which reads the current theme from the database. Since no database connection is established yet, a new one is created with the attacker-controlled properties set via the `Installer` constructor:

**library/classes/Installer.class.php**

```
<?php
// ...
class Installer
{
 public function __construct($cgi_variables)
 {
   $this->server = $cgi_variables['server'];
   $this->port = $cgi_variables['port'];
   $this->login = $cgi_variables['login'];
   $this->pass = $cgi_variables['pass'];
   $this->dbname = $cgi_variables['dbname'];
   // ...
 }
 // ...

 private function connect_to_database($server, $user, $password, $port, $dbname = '')
 {
   $ok = mysqli_real_connect($mysqli, $server, $user, $password, $dbname,   $port);
   // ...
 }

 public function user_database_connection()
 {
   $this->dbh = $this->connect_to_database($this->server, $this->login, $this->pass, $this->port, $this->dbname);
   // ...
 }
 // ...

 public function getCurrentTheme()
 {
   $current_theme =  $this->execute_sql("SELECT gl_value FROM globals WHERE gl_name LIKE '%css_header%'");
   // ...
 }
```

To conclude, an unauthenticated attacker can perform a database query on their own server. But how does that lead to an arbitrary file read?

The MySQL statement `LOAD DATA` can be used to load the contents of a file into a database table. If the modifier `LOCAL` is given, the file is read from the client instead of the server. The MySQL packets exchanged during this command look like this:

![](data:image/svg+xml;charset=utf-8...)![]()![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/3fa38690-5701-4cbe-88e3-12facbffec3b/OpenEMR%20graphics.png?w=1610&h=924&auto=format&fit=crop)

As the image shows, the server actively requests the contents of the specified file. A malicious server can request the content of another file, even in response to a totally different query from the client.

Since this feature is insecure, it has been disabled by default for the PHP MySQL client.  However, OpenEMR uses the `LOAD DATA` statements to load, e.g., definitions of diseases, into the database. For this reason, it is expected that the directive `mysqli.allow_local_infile=On` is set via `php.ini`.

In other words, if OpenEMR is set up correctly, an unauthenticated attacker can read files like certificates, passwords, tokens, and backups from an OpenEMR instance via a rogue MySQL server.

### Unauthenticated Remote Code Execution using an Exploit Chain

This section demonstrates how we can achieve unauthenticated remote code execution using two different vulnerabilities discovered by our SAST engine. As an entry point, a reflected Cross-Site-Scripting (XSS) is used to execute arbitrary JavaScript in the victim's browser. Since an attacker can issue requests on behalf of the victim, they have the same privileges as the victim. As a first step, the attacker can upload a PHP file. However, the uploaded PHP file is located in a folder where a `.htaccess` file blocks direct access, preventing the PHP file from being executed. Therefore, a second vulnerability, which allows attackers to include local files (LFI), is used to achieve remote code execution.

Let's take a look at the root cause of the reflected XSS. The attacker-controlled `REQUEST_URI` is passed as a string to the JavaScript function `dopopup`. Furthermore, the `dopopup` function is the target of the `onclick` event handler inside the HTML `<a>` Tag. The event handlers in the browser have a unique behavior that we will discuss briefly, but first, we need to look at the `REQUEST_URI`:

**interface/forms/eye\_mag/php/eye\_mag\_functions.php**

```
<a onclick="dopopup('<?php echo $_SERVER['REQUEST_URI'] . '&display=fullscreen&encounter=' . $encounter; ?>');"
href="JavaScript:void(0);"></a>
```

[**XSS: Try it by yourself on SonarQube Cloud!**](https://sonarcloud.io/project/issues?resolved=false&sonarsourceSecurity=xss&types=VULNERABILITY&id=SonarSourceResearch_openemr-blogpost&open=AYXtQ1qyDgoxwr2lUbaj "XSS: Try it by yourself on SonarQube Cloud!")

The user-controlled input `REQUEST_URI` contains the entire URI that the browser uses to request the PHP file. In all modern browsers, single and double quotes are URL-encoded inside an HTTP query string. That's why an attacker can't easily break out a quoted context. However, this is where an attacker can take advantage of the unique behavior of event handlers in the browser.

A browser has different orders of how each component is rendered. In our case, the HTML is rendered first, followed by the JavaScript context. As a result, HTML entities can be used within an event handler since the browser decodes them. An `&apos;` thus becomes a single quote. Note that the two characters needed to represent an HTML entity: `&` and `;` are not URL-encoded by the browser.

In the following table, the individual steps are shown. The first column of the table represents the request by the browser, while the second column shows the HTTP response. In the third step, the browser "normalizes" the HTML entity `&apos;` leading to a reflected XSS.

| **1. Request URI** | **2. HTTP Response** | **3. Browser rendering** |
| --- | --- | --- |
| index.php?a=1&apos;);alert(1);// | < a onlick=”dopopup(‘/index.php?a=1&apos;);alert(1);// ’)”> | < a onlick=”dopopup(‘/index.php?a=1’);alert(1);// ’)”> |

The second vulnerability is a straightforward Local File Inclusion (LFI) vulnerability. As the following code snippet shows, the user-controlled variable `$formname` is concatenated to a path. If the file exists, it is included:

**interface/forms/LBF/new.php**

```
<?php
// ...
$formname = isset($_GET['formname']) ? $_GET['formname'] : '';
// ...
if (!$from_trend_form) {
  $fname = $GLOBALS['OE_SITE_DIR'] . "/LBF/$formname.plugin.php";
  if (file_exists($fname)) {
    include_once($fname);
  }
}
```

[**LFI: Try it by yourself on SonarQube Cloud!**](https://sonarcloud.io/project/issues?resolved=false&sonarsourceSecurity=file-manipulation&id=SonarSourceResearch_openemr-blogpost&open=AYXtQ1vlDgoxwr2lUbcp "LFI: Try it by yourself on SonarQube Cloud!")

Since the user-controlled variable `$formname` is not sanitized, an attacker can select other folders on the server via a path traversal payload like `a/LBF/../../var/www/`. However, the filename is restricted to files with the suffix `.plugin.php`.

In order to upload such a file, an attacker can leverage the file upload functionality shown in the following code snippet. The name of uploaded files is composed of the PHP function `time` and the attacker-controlled name of the uploaded file `$_FILES['uploaded']['name']`. Since there is no file extension check, files with the suffix `.plugin.php` can be uploaded. Note that the `time` function returns the current Unix timestamp and provides no security:

**interface/billing/edi\_271.php**

```
<?php
// ...
if (isset($_FILES) && !empty($_FILES)) {
  $target = time() . basename($_FILES['uploaded']['name']);
  // ...
  $file_moved = move_uploaded_file($_FILES['uploaded']['tmp_name'], $target);
  // ...
}

```

In summary, an attacker can use the reflected XSS, upload a PHP file named `payload.plugin.php` and then use the path traversal via the Local File Inclusion to execute the PHP file. It takes a few tries to figure out the appropriate Unix timestamp but eventually leads to remote code execution.

## Patch

The OpenEMR maintainers addressed all vulnerabilities and hardened the application further:

* A combination of sessions and CSRF checks are used to patch the arbitrary file read vulnerability and to restrict the installation process more. An unauthenticated attacker must go through the installation steps in the correct order. When a config file already exists in an installed OpenEMR instance, the setup process fails in the first step. In the future, it is planned to remove the need for `mysqli.allow_local_infile=On` ([0ea6e580](https://github.com/openemr/openemr/commit/0ea6e5802566fbd6cf1c7a4f279654f34a7f9d36 "0ea6e580")).
* The function `attr_js,` which calls the PHP function `htmlspecialchars` encodes the important character `&` for an HTML entity into an entity. As a result, escaping the context is no longer possible, which prevents the XSS vulnerability ([4b915404](https://github.com/openemr/openemr/commit/4b915404cc7bfd4f4e90d1f34fbf74cff5c143a3 "4b915404")).
* To prevent the Local File Inclusion vulnerability, the user-controlled parameter is sanitized by a regex, allowing only alphanumeric chars, to prevent path traversal. The file upload feature now checks for PHP extensions ([10b3cb3b](https://github.com/openemr/openemr/commit/10b3cb3bccfb21db8a79c959c9ba968012133064 "10b3cb3b")).

OpenEMR cannot always guarantee that the setup process will completely delete the installation files. If you develop an application with a built-in setup flow, you must decide whether you deliberately keep them (in the case of OpenEMR) or try to delete them. In any case, you should always check if the application is already installed first. If so, the execution should be terminated as soon as possible. Moreover, always try to sanitize every user input and apply the respective sanitizer in the specific context.

## Timeline

| **Date** | **Action** |
| --- | --- |
| 2022-10-24 | We report all issues to the vendor. |
| 2022-10-30 | Vendor confirms the issues and sends us patches. |
| 2022-11-30 | Vendor releases version 7.0.0. |

## Summary

In this blog post, we analyzed three code vulnerabilities found in OpenEMR, the most popular open-source software for electronic health records and medical practice management.

We outlined how an attacker-controlled MySQL configuration could lead to an arbitrary file read. We also demonstrated how combining two code vulnerabilities, Cross-Site Scripting, and Local File Inclusion both detected by our SAST engine, can lead to a takeover of any OpenEMR instance. Furthermore, we discussed the patches and showed how to prevent such issues in your PHP code.

If you are using OpenEMR, we strongly recommend updating to the fixed versions mentioned above. Finally, we want to thank the OpenEMR team for their professional and fast responses and patches!

## Related Blog Posts

* [Code vulnerabilities put health records at risk](https://www.sonarsource.com/blog/openemr-5-0-2-1-command-injection-vulnerability/ "Code vulnerabilities put health records at risk")
* [Pandora FMS 742: Critical Code Vulnerabilities Explained](https://www.sonarsource.com/blog/pandora-fms-742-critical-code-vulnerabilities-explained/ "Pandora FMS 742: Critical Code Vulnerabilities Explained")
* [Remote Code Execution in Melis Platform](https://www.sonarsource.com/blog/remote-code-execution-in-melis-platform/ "Remote Code Execution in Melis Platform")
#### SHARE

[twitter](https://twitter.com/share?text=undefined)[facebook](https://www.facebook.com/sharer/sharer.php?u=undefined)[linkedin](https://www.linkedin.com/sharing/share-offsite/?url=undefined)mail[Go to SonarSource homepage![](data:image/svg+xml;charset=utf-8...)![sonar logo ]()![sonar logo ](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/8e59bcad-6e39-41dc-abd9-a0e251e8d63f/Sonar%20%282%29.svg?w=160&h=40&auto=format&fit=crop)](/)

* **Sonar Solutions**
  + [SAST](/solutions/security/)
  + [What is clean code](/solutions/clean-code/)
  + [Power of clean code](/solutions/power-of-clean-code/)
  + [Clean as you code](/solutions/our-unique-approach/)
  + [AI-assisted & quality-assured code](/solutions/ai/)
  + [DevOps transformation](/solutions/devops-transformation/)
  + [Outsourcing software development](/solutions/reduce-outsourcing-software-development-risk/)
  + [Reduce & manage technical debt](/solutions/reduce-technical-debt/)
  + [Secure by design](/solutions/secure-by-design-code/)
  + [Code coverage](/solutions/code-coverage/)
  + [Code review](/solutions/code-review/)
  + [For developers](/solutions/for-developers/)
  + [For enterprise](/solutions/for-enterprise/)
  + [Infrastructure as code](/solutions/infrastructure-as-code/)
  + [Public sector](/solutions/public-sector/)
* **Products**
  + [SonarQube for IDE](/products/sonarlint/)
  + [SonarQube Server](/products/sonarqube/)
  + [SonarQube Cloud](/products/sonarcloud/)**Pricing**
  + [Start for free](/open-source-editions/)
  + [Explore pricing](/plans-and-pricing/)
* **Company**
  + [About](/company/about/)
  + [Careers](/company/careers/)
  + [Commitment to open source](/solutions/commitment-to-open-source/)
  + [Customers](/company/customers/)
  + [Partners](/company/partners/)
  + [Contact us](/company/contact/)
  + [Accessibility](/accessibility/)
  + [NEW! Brand identity](/brand-identity/)**Media**
  + [Coverage](/company/coverage/)
  + [Press releases](/company/press-releases/)
* **Resources**
  + [Events hub](/resources/events/)
  + [Customer stories](/resources/customer-stories/)
  + [White papers](/resources/white-papers/)
  + [Learn](/learn/guide/)
  + [Community](https://community.sonarsource.com/)
  + [Support](/support/)
* **Knowledge**
  + [Explore Sonarpedia](https://rules.sonarsource.com/)
  + [Blog](/blog/)
  + [Languages](/knowledge/languages/)
  + [SonarQube Server Documentation](https://docs.sonarsource.com/sonarqube/latest/)
  + [SonarQube Cloud Documentation](https://docs.sonarsource.com/sonarcloud/)
  + [SonarQube for IDE Documentation](https://docs.sonarsource.com/sonarlint/)

* [Legal documentation](/legal/)
* [Trust center](/trust-center/)

* [Follow SonarSource on Twitter](https://twitter.com/sonarsource)
* [Follow SonarSource on Linkedin](https://www.linkedin.com/company/sonarsource/)

© 2008-2025 SonarSource SA. All rights reserved. SONAR, SONARSOURCE, SONARQUBE, and CLEAN AS YOU CODE are trademarks of SonarSource SA.


