- **Root cause of vulnerability**: The Checkmk agent uses `unixcat` to monitor livestatus from running sites. The `unixcat` binary is linked to libraries that are part of Checkmk, and these libraries may differ from those of the operating system. To ensure correct library usage, the agent adds the libraries from the site to the `unixcat` call. However, the `lib` folder within a site is writable by the site itself, allowing a rogue site to inject malicious libraries into the `unixcat` call. This `unixcat` call executes as root, leading to a privilege escalation.
- **Weaknesses/vulnerabilities present**: The vulnerability is due to the fact that a site can write to the `lib` folder, and the agent uses the site-specific libraries in a root context. This is an insecure library loading scheme.
- **Impact of exploitation**: A rogue site can inject malicious libraries into the `unixcat` call which executes with root privileges and escalate their privileges to root. This enables an attacker to perform arbitrary actions on the affected host.
- **Attack vectors**: The attack vector is through a rogue site injecting malicious libraries into its `lib` folder. The Checkmk agent, running as root, then executes `unixcat` using these malicious libraries.
- **Required attacker capabilities/position**: The attacker needs to have control over a Checkmk site, specifically the ability to write to the site's `lib` folder.