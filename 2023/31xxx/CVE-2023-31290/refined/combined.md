=== Content from twitter.com_88b19ff5_20250114_194210.html ===



=== Content from community.trustwallet.com_47524406_20250114_194206.html ===


![Trust Wallet](data:image/svg;base64...)
Loading

[Trust Wallet](/)

# [Browser Extension WASM Vulnerability Postmortem](/t/browser-extension-wasm-vulnerability-postmortem/750787)

[Announcements](/c/announcements/5)

[John.TrustWallet](https://community.trustwallet.com/u/John.TrustWallet)

April 22, 2023, 7:28am

1

This postmortem provides an in-depth account of the vulnerability and the assertive steps we undertook to protect our users’ wallets. [For a summary of the incident and FAQ, please refer to our disclosure statement.](https://community.trustwallet.com/t/wasm-vulnerability-incident-update-and-recommended-actions/750786)

### **The Vulnerability**

In November 2022, a vulnerability was discovered in the back-end module WebAssembly (WASM) located in the open source repository wallet core, which affected new wallets generated by versions 0.0.172 and 0.0.182 of the Browser Extension. Only the private keys of the limited new wallets created in these versions are affected. Since the vulnerability was fixed on November 22, 2022, all other Browser Extension versions, including the existing version, are safe to use. Imported wallets and mobile wallets are not affected by this issue.

The version of WASM that was affected utilized MT19937, a Mersenne Twister pseudo-random number generator (PRNG) with a state size of 19937 bits to produce mnemonics. This PRNG requires a single 32-bit seed value to begin the generation process. However, due to the limited size of the seed, the WASM version could only produce approximately 4 billion possible mnemonics. Additionally, because the MT19937 is based on a linear recursion method, the resulting pseudo-random sequence is not secure enough for cryptographic purposes. A long sub-sequence of output numbers could be used to predict subsequent outputs, which poses a security risk.

Please note that this issue is not yet registered as a Common Vulnerabilities and Exposures (CVE). However, another team discovered a similar issue in the Intel Paillier Cryptosystem Library, which can be found here: [Insecure PRNG in key generation · Issue #2 · intel/pailliercryptolib · GitHub](https://github.com/intel/pailliercryptolib/issues/2).

The problem lies in the fact that the MT19937 pseudo-random number generator does not provide a sufficient level of randomness. When this generator was used to create private keys, a skilled individual (potentially a bad actor) could monitor enough iterations to predict future iterations. If that individual knows that a specific wallet address was created using MT19937, they could access the private key of a wallet associated with a given public address with medium to high computational power. Alternatively, a malicious actor could create a massive database that contains all possible 2^32 outputs generated by MT19937, and by reverse engineering, could match private keys to a large set of vulnerable addresses across different chains.

During our impact analysis process, we identified a few other wallet addresses (less than 100) that were created with the same MT19937 issue. Some of these wallets were created several years ago, and most of them were not being actively used.

**Trust Wallet’s Response to the Vulnerability**

The code that caused the vulnerability was promptly fixed within 1 day of the verification of the bug bounty. This ensured that any wallet addresses created after the fix were not susceptible to the vulnerability. However, the vulnerability existed in the addresses that were created between version 0.0.172 and version 0.0.182 themselves. The Trust Wallet development team could not eliminate the vulnerability for the wallets created using vulnerable versions without the involvement of affected address owners. To be free from the vulnerability, users must migrate their assets from the affected wallet addresses to new, non-affected wallet addresses. For clarity, this action must be performed by the wallet address owners themselves. Under these circumstances, we undertook every possible measure to inform users and assist them in mitigating the risk of potential attacks.

The Trust Wallet team has been working hard to ensure the safety of our users’ assets on the affected wallet addresses. To make sure that we reach as many affected users as possible, we have used all the available means to notify them and encourage them to transfer their assets from the affected wallet addresses. We have used a multi-channel notification strategy which has included 1-1 in-app warnings that appear every 1 minute and mobile push notifications.

Affected users would have seen a warning message on their Browser Extension, in which we provided clear instructions on how to transfer their assets into a non-custodial wallet or a centralized exchange. In addition, to ensure our users that the warning banner was not a scam, a [Trust Wallet security overview blog post](https://community.trustwallet.com/t/a-complete-overview-of-trust-wallet-security/628739) was published on December 7, 2022, where the “Extension warning banner” was illustrated as the official and legitimate warning message from Trust Wallet.

Additionally, when we discovered that the upstream funding of the wallet addresses came from Binance based on public on-chain data, we contacted Binance to assist in notifying the users while maintaining their privacy. It’s important to note that we take the protection of our users’ privacy seriously. No personally identifiable information has ever been shared between Binance and Trust Wallet, and we appreciate Binance’s customer support team helped to reach the affected users that they could reach.

We deliberated whether to disclose the vulnerability once all feasible fixes were implemented. However, after thorough evaluation, we determined that an early public disclosure might have exposed the majority of affected users’ funds to an immediate, near-certain risk of hacking. Our primary objective was to help users preserve as much of their assets as possible and prevent potential losses. We believed that confidential, one-on-one communication with users would enable users to take the necessary actions without sacrificing their assets’ sole ownership.

We also provided assistance to customers affected by this vulnerability by offering customer support and reimbursing them for their gas fees. As of today, in total we reimbursed ~23.6 BNB in gas fees to multiple users who transferred their assets to a secure location.

With our extensive notification efforts in the last five months, the majority of the assets in the affected wallet addresses have been moved to safe locations by the users.

While some risk persists in disclosing this information at this time, the majority of funds have been transferred and secured by users over the past few months. Consequently, the operational cost for a bad actor to exploit the vulnerability has increased, relative to the potential gains from the remaining affected wallets; currently, these wallets hold approximately $88,300 USD across ~500 affected wallets with a balance higher than $10 USD worth of tokens. Additionally, the vulnerability has now been expressly pinpointed and patched.

**The Reimbursement Process**

Despite our best efforts, two exploits occurred, resulting in a total loss of approximately $170,000 USD at the time of the attack.

We will continue to support our users and encourage any remaining affected users to take the [steps to secure their wallets](https://community.trustwallet.com/t/how-to-transfer-assets-from-your-existing-trust-wallet-browser-extension-address-to-a-new-wallet-address/606873) and/or claim their reimbursement.

We know the exact list of affected wallets. Please check your Browser Extension to see if you have received a notification and carefully read through [the reimbursement process](https://community.trustwallet.com/t/reimbursement-process-for-lost-funds-due-to-hacks-from-browser-extension-wasm-vulnerability/750788) to see if you are relevant as a victim to claim the reimbursement.

If you haven’t received a notification in your Trust Wallet browser extension, your wallet address was not affected by the vulnerability at all and is safe to use.

**Timeline**

November 2022

1. On November 17, a security researcher identified and reported a vulnerability to us via the Trust Wallet bug bounty program.
2. The vulnerability was verified and confirmed to be critical for the team to take immediate actions.
3. Within 1 day of verifying the vulnerability, we applied a patch to the back-end module (WAS) located in the open-source repository wallet core, to fix the issue.
4. Within 2 days, Browser Extension v0.0.183 was released. New wallets created from this version are no longer vulnerable. Users with the affected versions were automatically updated to the new secure version.
5. Browser Extension v0.0.187 was released, adding the ability to display a warning banner to impacted wallet owners. The warning said about the existing wallet addresses’ risk and urged the owners to move their assets to other secure wallet addresses, following a step-by-step guide.
6. In addition to the In-app browser warning for the affected users, Trust Wallet security scanner started to warn users to not transfer assets into the affected wallets, to prevent increasing risk exposure for the users.
7. We delivered multiple push notifications on Trust Wallet mobile applications that identified to be associated with the affected wallet addresses.
8. We provided gas fee reimbursements for users who moved their assets because of the incident, and continue to do so.
9. We prepared a public disclosure statement. However, we considered that once the disclosure was made, a bad actor could exploit the remaining wallets and take ownership of the funds left. Therefore, we gave affected users more time to secure their fund instead of making an premature disclosure.

December 2022

1. Browser Extension v0.0.200 went live. Added a warning icon badge to the affected wallets.
2. Sent another round of mobile push notifications.
3. Published Trust Wallet security overview blog post to help our users understand that the in-app warning banner is not a scam.
4. 1st exploit observed. Received Customer Service tickets from the affected users. Started the reimbursement processes.

February 2023

1. Reassessed the disclosure timeline. Decided to give more time for the affected wallet users to secure the funds.

March 2023

1. Bug Bounty was paid out to the security researcher.
2. 2nd exploit observed. Received Customer Service tickets from the victims who were affected by the exploit. Started the reimbursement processes.
3. Met with the Ledger team to analyze the industry precedents to handle similar situations.

April 2023

1. The majority of assets on the vulnerable wallet addresses have already been secured by the wallet owners.
2. Display an updated warning message to the affected wallet. Provide additional information related to the reimbursement guide.
3. The vulnerability disclosure and postmortem were published.

### **Moving Forward**

We want to assure our users that we are taking this matter seriously and are actively working to recover the stolen assets in the exploits. Our team is collaborating with security experts to conduct a thorough investigation to identify the culprits and hold them accountable. To further incentivize anyone with information on the matter, we are offering a [bounty](https://bugcrowd.com/binance) for information that directly leads to the identification of the responsible parties.

Providing a secure wallet for our users’ to safeguard their funds is a top priority at Trust Wallet. We have made significant investments in improving our security measures to better protect our users and their funds. Let’s have a look at some of the things we do to keep our user’s secure.

**Security audits**

We have increased our security audits and audit coverage over the last few months to five times more. These include code review, design review, and penetration testing. These increased efforts will help us identify vulnerabilities before they are exploited and prevent future incidents.

**Internal security review**

Our internal security team performs regular security reviews, covering both application and infrastructure security. This ongoing process ensures that we maintain a high level of security and are always improving our security posture.

**External auditors**

We have engaged multiple top-tier, third-party external auditors to assess our application security. This due diligence ensures that we have an independent assessment of our security protocols and measures and identifies any improvement opportunities that we may need to address. [You can read the latest security audit reports here](https://community.trustwallet.com/t/a-complete-overview-of-trust-wallet-security/628739#security-audits-2).

**Internal security training**

We have company wide security training for employees to heightened security awareness and improve security practices.

**User security**

Not directly due to this incident, but we have always been making progress on features to support users keep themselves from harm.

The Trust Wallet Browser Extension integrated with hardware wallet Ledger in January, 2023. This adds another layer of security to protect users’ private keys.

Our Security Scanner feature warns users whenever they interact with a known risky address or the smart contract of a malicious dApp. This helps our users to make informed decisions about their transactions.

By implementing these measures, we are confident that we are taking all the necessary steps to enhance our security, ensuring that users’ wallets are protected and prevent similar incidents occurring in the future.

We will continue to work with the community to proactively identify and resolve any vulnerabilities and are constantly looking for ways to improve our processes to ensure that we are identifying and mitigating security risks as early as possible.

We would like to sincerely thank the community for the support to make Trust Wallet a safe platform. We’re deeply sorry this incident occurred and apologise for any distress it may have caused our users. Fortunately, none of our users will be negatively impacted. Please continue to let us know how we can better improve security, reduce risk, and improve our support so that we can continue to earn your trust.

### **Special Thanks**

We would like to express our sincere appreciation to the security researcher Jean-Baptiste Bédrune, who discovered and reported the vulnerability to us. His contribution has been invaluable in helping us ensure the security of users’ wallets. As a token of our gratitude, we have already awarded the security researcher with the highest level of our [bounty reward](https://bugcrowd.com/binance).

We would like to thank the Ledger security team, especially their CTO Charles Guillemet, for working diligently with us to provide feedback and suggestions on how to approach this situation to produce the best outcome for our users and the community.

Finally, we would also like to extend our gratitude to the Binance security team for their exceptional handling of the bug bounty process. Their expertise in triaging the issue, conducting risk assessments, escalating the matter, conducting impact analysis, and communicating with the security researcher was vital in minimizing the overall impact of the vulnerability.

6 Likes

[WASM Vulnerability, Incident Update, at Recommended Actions](https://community.trustwallet.com/t/wasm-vulnerability-incident-update-at-recommended-actions/750789)

* [Home](/)
* [Categories](/categories)
* [FAQ/Guidelines](/guidelines)
* [Terms of Service](https://trustwallet.com/terms-of-services)
* [Privacy Policy](https://trustwallet.com/privacy-policy)

Powered by [Discourse](https://www.discourse.org), best viewed with JavaScript enabled



=== Content from community.trustwallet.com_4d01b415_20250114_194207.html ===


![Trust Wallet](data:image/svg;base64...)
Loading

[Trust Wallet](/)

# [WASM Vulnerability, Incident Update, and Recommended Actions](/t/wasm-vulnerability-incident-update-and-recommended-actions/750786)

[Announcements](/c/announcements/5)

[John.TrustWallet](https://community.trustwallet.com/u/John.TrustWallet)

July 27, 2023, 4:00am

1

[![wasm-vulnerability-trustwallet](https://community.trustwallet.com/uploads/default/optimized/3X/d/c/dcd57880521b5301aef8c8051df30defc3ecce0f_2_690x388.jpeg)wasm-vulnerability-trustwallet1600×901 222 KB](https://community.trustwallet.com/uploads/default/original/3X/d/c/dcd57880521b5301aef8c8051df30defc3ecce0f.jpeg "wasm-vulnerability-trustwallet")

> **Update July 27, 2023**

Dear Trust Wallet users,

We’d like to share a final update on the claims process for the Trust Wallet Browser Extension issue related to the November 2022 WASM vulnerability, which came to a close on June 30, 2023.

Prior to opening up our claims process, our proactive communication to users resulted in over 90% of affected funds being moved to new addresses which mitigated further losses. Trust Wallet also worked with impacted users to return additional funds throughout the sixty-day claims period.

Choosing to compensate users set a precedent for a free, self-custodial wallet like Trust Wallet which came with a number of challenges unique to the DeFi space. That said, we want to express our deep appreciation for the unwavering support of our dedicated user base and the entire community. A special thank you goes out to the Binance Security and Ledger Donjon teams for their invaluable contributions during this process.

To learn more about the WASM issue and our subsequent response, please view our initial announcement below and postmortem: [Browser Extension WASM Vulnerability Postmortem](https://community.trustwallet.com/t/browser-extension-wasm-vulnerability-postmortem/750787)

=====

> **Posted April 22, 2023**

Dear Trust Wallet Community,

Security is the foundation of what we do at Trust Wallet. We are committed to providing secure wallet software and actively collaborate with industry experts to identify, mitigate, and resolve any vulnerabilities quickly. Although we diligently work to prevent vulnerabilities, they may occasionally arise.

In November 2022, a security researcher reported a WebAssembly (WASM) vulnerability in our open-source library, Wallet Core, through our bug bounty program. Our Trust Wallet Browser Extension uses WASM in Wallet Core, and new wallet addresses generated between November 14 and 23, 2022 by Browser Extension contain this vulnerability. We quickly patched the vulnerability, and all addresses created after those dates are safe.

Despite our best efforts, we proactively detected two potential exploits, resulting in a total loss of approximately $170,000 USD at the time of the attack. As a commitment to transparency and user protection, we want to assure users that we will reimburse eligible losses from hacks due to the vulnerability and have created a reimbursement process for the affected users. And we urged affected users move the remaining ~$88,000 USD balance on all the vulnerable addresses as soon as possible.

**Recommended Actions for Users**

The latest versions of Trust Wallet mobile app and Browser Extension remain safe and secure to use.

**WHO** **IS** **NOT AFFECTED?**

Your wallet addresses are not affected by this vulnerability in the following scenarios:

* If you only use Trust Wallet mobile apps.
* If you only imported wallet addresses into Browser Extension.
* If you only used the Browser Extension to create a new wallet before November 14, 2022 or after November 23, 2022.

**WHO** **IS** **AFFECTED?**

If your wallet addresses are vulnerable, you will see a notification in the Browser Extension. Please open your TW Browser Extension and see whether you received such warning notification.

**WHAT ACTIONS TO TAKE?**

* If you don’t see the warning notification, your wallet addresses are safe to use, and this vulnerability does not affect you.
* **If you received a push notification in your Trust Wallet App or Browser Extension, your private key is affected by a previous exploit and is not safe to use**. Move your funds to a newly created wallet in Trust Wallet to avoid risk of fund loss. Please follow [this guide](https://community.trustwallet.com/t/how-to-transfer-assets-from-your-existing-trust-wallet-browser-extension-address-to-a-new-wallet-address/606873).

For users who saw abnormal fund movement late December 2022 and late March 2023, you may be one of the few victims suffering from the two exploits. Please carefully read the [reimbursement process to understand the next steps](https://community.trustwallet.com/t/reimbursement-process-for-lost-funds-due-to-hacks-from-browser-extension-wasm-vulnerability/750788). This is our best effort to verify ownership of the affected addresses and we will reimburse funds to each victim. We have an exact list of all affected wallets.

**Recommended Actions** **for wallet developers using Wallet Core**

If you utilized Wallet Core library for developing Browser Extension wallets in 2022, ensure you have implemented the latest version of Wallet Core to prevent your Browser Extension app from being affected by this vulnerability, which may result in losses for your users. We swiftly notified wallet developers known to use Wallet Core for Browser Extension wallets upon discovering the vulnerability.

The postmortem ([link](https://community.trustwallet.com/t/browser-extension-wasm-vulnerability-postmortem/750787)) details the incident, what we did, and what we learned for improving and mitigating security handling, and future steps. We apologize for the loss and inconvenience caused to users and assume responsibility for our mistakes while working towards rectifying the situation for affected users. As valid claims come in, we will process as quickly as possible and periodically provide updates. To maintain transparency in the reimbursement process, we will provide regular updates here below.

> ***Victim*** ***wallet claims processed:*** ***47*** (as of 30 June 2023)

We would like to express our sincere appreciation to the security researcher who discovered and reported the vulnerability to us. His contribution has been invaluable in helping us ensure the security of users’ wallets. We sought guidance from prominent industry professionals to optimize best results for our users. In particular, the Ledger Team and Binance Security team, with their extensive expertise in security best practices, provided invaluable insights throughout the entire process. We would like to express our gratitude for their assistance in addressing this matter. We are honored to be a part of this community.

Sincerely,

*The* *Trust Wallet team*

———————————

**Frequently Asked Questions** **(FAQ)**

**Is it safe to use** **the Browser Extension?**

* Yes. Both the Browser Extension and the mobile app are safe to use. We also recently published a security audits of Browser Extension performed by Certik and Cure53. [View the details here](https://community.trustwallet.com/t/a-complete-overview-of-trust-wallet-security/628739#security-audits-2).

**Is this vulnerability related to** **the massive wallet drain mentioned in this Twitter post** [**https://twitter.com/tayvano\_/status/1648187031468781568**](https://twitter.com/tayvano_/status/1648187031468781568)?

* No. They are two completely unrelated events. None of the wallet addresses affected by this vulnerability are found in this massive wallet drain mentioned in the Twitter post.

**Are any wallets still affected?**

* Yes, the vulnerable wallet addresses are vulnerable regardless of the wallet applications or hardware used. The Trust Wallet app and Browser Extension remain safe and secure to use. Affected owners should create a new wallet and transfer funds this newly created wallet (not wallet addresses provided by anyone else) and stop using the tainted addresses.
* Any affected users with the vulnerable addresses will see a notification in their Trust Wallet Browser Extension. We will help you to [transfer the funds in your affected wallet to a new wallet address](https://community.trustwallet.com/t/how-to-transfer-assets-from-your-existing-trust-wallet-browser-extension-address-to-a-new-wallet-address/606873), or reimburse any losses caused by hacks according to [the reimbursement process](https://community.trustwallet.com/t/reimbursement-process-for-lost-funds-due-to-hacks-from-browser-extension-wasm-vulnerability/750788).
* If you haven’t received a notification, your wallet **was not affected** and no further action is needed.

**How did you notify and instruct the affected addresses’ users to move the funds to another secure wallet?**

* We informed users immediately via push notifications, warnings, and guides on the actions required for affected users to secure their funds. We also provided dedicated customer support and gas fee assistance to cover the costs of users’ transferring funds. Additionally, when we discovered that the upstream funding of the affected wallet addresses came from Binance, based on public on-chain data, we contacted Binance to assist in notifying the users while maintaining their privacy. It’s important to note that we take the protection of our users’ privacy seriously. No personally identifiable information has ever been shared between Binance and Trust Wallet.

**I’m seeing** **the warning message on my Browser Extension meaning that my wallet address is subject to this vulnerability. If I import that wallet address to somewhere else, will the** **vulnerability** **be** **mitigated** **and my wallet become safe?**

* No, because importing/recovering a vulnerable wallet still leaves the wallet vulnerable. Please follow the [guide to transfer your assets to a new wallet address](https://community.trustwallet.com/t/how-to-transfer-assets-from-your-existing-trust-wallet-browser-extension-address-to-a-new-wallet-address/606873). And stop using the affected wallet address.

[![](https://assets-cdn.trustwallet.com/community/security_notification.png)](https://assets-cdn.trustwallet.com/community/security_notification.png)

**How long did it take to fix the vulnerability?**

* We fixed the vulnerability **within 1 day of verifying the bounty report**.

**What platforms did this vulnerability affect?**

* The vulnerability impacted wallets created in the Browser Extension between November 14 and 23, 2022. This vulnerability was specifically related to the WebAssembly (Wasm) implementation in our open source project Wallet Core and did not originate from the Browser Extension itself.

**What was the location of the vulnerability?**

* The vulnerability occurred in the back-end module WebAssembly (WASM) located in the open source repository Wallet Core, which affected new wallets generated by versions 0.0.172 and 0.0.182 of the Browser Extension.

**What are you doing to ensure security in the Trust Wallet ecosystem?**

* We are 100% committed to providing a secure wallet for our users’ to safeguard their funds. In the past few months we’ve taken significant additional steps to enhance our security to keep users funds safe, including:
* Increasing our security audits and audit coverage to x5 times more.
* Engaged multiple top-tier, third-party external auditors to assess our security. [View the latest reports here](https://community.trustwallet.com/t/a-complete-overview-of-trust-wallet-security/628739#security-audits-2).
* Launched security features including a Security Scanner to warn users of risk.
* For more information, please read our [postmortem here](https://community.trustwallet.com/t/browser-extension-wasm-vulnerability-postmortem/750787).

**Was this vulnerability exploited?**

* Yes. We fixed the vulnerability within a day, however two exploits occurred within a small window of time, resulting in a total loss of $170,000 USD.

**Why are you only communicating about this vulnerability now?**

* Securing users’ wallets and preventing/reducing any potential losses was our top priority – and an early public disclosure of the vulnerability would have put users’ at risk of an almost immediate hacks and at a larger scope of loss. We focused on patching the vulnerability, and helping users’ to move their funds utilizing various channels to communicate the situation without drawing the attention of potential bad actors. Over the past few months, we have observed consistent momentum of users moving funds away, and we did not want to deprive them of the time and opportunity to take action. Now the majority of the funds in the affected wallet addresses have been moved to a safe location by users, the momentum of fund movement has been slowing down, and the cost of hack operations is economically not reasonable, so we think it’s a good time to do public disclosure at a much lower risk of user fund loss.

**Will Trust Wallet reach out to me directly?**

* No, Trust Wallet will not reach out to you directly on this matter. You should only follow the official [claim process available here](https://community.trustwallet.com/t/reimbursement-process-for-lost-funds-due-to-hacks-from-browser-extension-wasm-vulnerability/750788), if you see the Browser Extension warning notification.
* NEVER share your secret phrase with anyone, ever. No legitimate member of the Trust Wallet team will ask you for this. This is for your eyes only.

**Does this mean Trust Wallet was exploited?**

This was an industry impact, anything built using the MT19937 pseudo-random number generator produce vulnerable wallets. It’s not exclusive to Trust Wallet

**Is there a Trust Wallet airdrop for impacted users?**

Trust Wallet is not hosting any airdrop for impacted users. Impacted users can submit a claim through our claims process for a 1-1 disbursement.

10 Likes

[Анализ уязвимости WASM расширения браузера - Постмортем](https://community.trustwallet.com/t/wasm/750791)

* [Home](/)
* [Categories](/categories)
* [FAQ/Guidelines](/guidelines)
* [Terms of Service](https://trustwallet.com/terms-of-services)
* [Privacy Policy](https://trustwallet.com/privacy-policy)

Powered by [Discourse](https://www.discourse.org), best viewed with JavaScript enabled



=== Content from github.com_7293d814_20250114_194210.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftrustwallet%2Fwallet-core%2Fcompare%2F3.1.0...3.1.1)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftrustwallet%2Fwallet-core%2Fcompare%2F3.1.0...3.1.1)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fcompare%2Fshow&source=header-repo&source_repo=trustwallet%2Fwallet-core)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[trustwallet](/trustwallet)
/
**[wallet-core](/trustwallet/wallet-core)**
Public

* [Notifications](/login?return_to=%2Ftrustwallet%2Fwallet-core) You must be signed in to change notification settings
* [Fork
  1.7k](/login?return_to=%2Ftrustwallet%2Fwallet-core)
* [Star
   3k](/login?return_to=%2Ftrustwallet%2Fwallet-core)

* [Code](/trustwallet/wallet-core)
* [Issues
  30](/trustwallet/wallet-core/issues)
* [Pull requests
  7](/trustwallet/wallet-core/pulls)
* [Discussions](/trustwallet/wallet-core/discussions)
* [Actions](/trustwallet/wallet-core/actions)
* [Security](/trustwallet/wallet-core/security)
* [Insights](/trustwallet/wallet-core/pulse)

Additional navigation options

* [Code](/trustwallet/wallet-core)
* [Issues](/trustwallet/wallet-core/issues)
* [Pull requests](/trustwallet/wallet-core/pulls)
* [Discussions](/trustwallet/wallet-core/discussions)
* [Actions](/trustwallet/wallet-core/actions)
* [Security](/trustwallet/wallet-core/security)
* [Insights](/trustwallet/wallet-core/pulse)

[Permalink](https://github.com/trustwallet/wallet-core/compare/trustwallet%3Aefca5ee...trustwallet%3Ad3c2eee)
# Comparing changes

 Choose two branches to see what’s changed or to start a new pull request.
If you need to, you can also  compare across forks
 or
[learn more about diff comparisons](https://docs.github.com/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-comparing-branches-in-pull-requests#three-dot-and-two-dot-git-diff-comparisons).

# Open a pull request

 Create a new pull request by comparing changes across two branches. If you need to, you can also  compare across forks
.
[Learn more about diff comparisons here](https://docs.github.com/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-comparing-branches-in-pull-requests#three-dot-and-two-dot-git-diff-comparisons).

*base repository:*
trustwallet/wallet-core

Failed to load repositories. Confirm that selected base ref is valid, then try again.

 Loading

*base:*
3.1.0

Choose a base ref

Branches
Tags

Could not load branches

Nothing to show

 Loading

[{{ refName }}
default](/trustwallet/wallet-core/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...3.1.1)

Could not load tags

Nothing to show

[{{ refName }}
default](/trustwallet/wallet-core/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...3.1.1)

 Loading

...

*head repository:*
trustwallet/wallet-core

Failed to load repositories. Confirm that selected head ref is valid, then try again.

 Loading

*compare:*
3.1.1

Choose a head ref

Branches
Tags

Could not load branches

Nothing to show

 Loading

[{{ refName }}
default](/trustwallet/wallet-core/compare/3.1.0...%7B%7B%20urlEncodedRefName%20%7D%7D)

Could not load tags

Nothing to show

[{{ refName }}
default](/trustwallet/wallet-core/compare/3.1.0...%7B%7B%20urlEncodedRefName%20%7D%7D)

 Loading

* 5

  commits
* 39

  files changed
* 3

  contributors

### Commits on Nov 18, 2022

1. [BitcoinScript/ThorSwap: Treat as error cases when memo is too long (d…](/trustwallet/wallet-core/commit/9378130d26ec263abb2403920750f1a55f154a10)
    …

   ```
   …o not truncate) ([#2741](https://github.com/trustwallet/wallet-core/pull/2741))
   ```

   [![@optout21](https://avatars.githubusercontent.com/u/13562139?s=40&v=4)](/optout21)

   [optout21](/trustwallet/wallet-core/commits?author=optout21 "View all commits by optout21")
   authored
   Nov 18, 2022

   Configuration menu

   * [View commit details](/trustwallet/wallet-core/commit/9378130d26ec263abb2403920750f1a55f154a10)
   * Copy full SHA for 9378130
   * [Browse repository at this point](/trustwallet/wallet-core/tree/9378130d26ec263abb2403920750f1a55f154a10)

   Copy the full SHA

    [9378130](/trustwallet/wallet-core/commit/9378130d26ec263abb2403920750f1a55f154a10)View commit details

   Browse the repository at this point in the history
2. [feat(ios): update Package.swift (](/trustwallet/wallet-core/commit/984fed1b212123b760c283d5f7181516310ccf83)[#2733](https://github.com/trustwallet/wallet-core/pull/2733)[)](/trustwallet/wallet-core/commit/984fed1b212123b760c283d5f7181516310ccf83)

   [![@Milerius](https://avatars.githubusercontent.com/u/21139416?s=40&v=4)](/Milerius)

   [Milerius](/trustwallet/wallet-core/commits?author=Milerius "View all commits by Milerius")
   authored
   Nov 18, 2022

   Configuration menu

   * [View commit details](/trustwallet/wallet-core/commit/984fed1b212123b760c283d5f7181516310ccf83)
   * Copy full SHA for 984fed1
   * [Browse repository at this point](/trustwallet/wallet-core/tree/984fed1b212123b760c283d5f7181516310ccf83)

   Copy the full SHA

    [984fed1](/trustwallet/wallet-core/commit/984fed1b212123b760c283d5f7181516310ccf83)View commit details

   Browse the repository at this point in the history
3. [[Breaking Change] Add Ripple token and NFT support (](/trustwallet/wallet-core/commit/e3398f63c2970426ef56b4bb8ba226a634ccfa14)[#2696](https://github.com/trustwallet/wallet-core/pull/2696)[)](/trustwallet/wallet-core/commit/e3398f63c2970426ef56b4bb8ba226a634ccfa14)
    …

   ```
   * Add Ripple token and NFT support
   ```

   [![@joterway](https://avatars.githubusercontent.com/u/5936322?s=40&v=4)](/joterway)

   [joterway](/trustwallet/wallet-core/commits?author=joterway "View all commits by joterway")
   authored
   Nov 18, 2022

   Configuration menu

   * [View commit details](/trustwallet/wallet-core/commit/e3398f63c2970426ef56b4bb8ba226a634ccfa14)
   * Copy full SHA for e3398f6
   * [Browse repository at this point](/trustwallet/wallet-core/tree/e3398f63c2970426ef56b4bb8ba226a634ccfa14)

   Copy the full SHA

    [e3398f6](/trustwallet/wallet-core/commit/e3398f63c2970426ef56b4bb8ba226a634ccfa14)View commit details

   Browse the repository at this point in the history

### Commits on Nov 21, 2022

1. [[Encryption]: add support for aes-256-ctr (](/trustwallet/wallet-core/commit/69b2da9826dfdeb8116be1e5a3747b3e9418592d)[#2726](https://github.com/trustwallet/wallet-core/pull/2726)[)](/trustwallet/wallet-core/commit/69b2da9826dfdeb8116be1e5a3747b3e9418592d)

   [![@Milerius](https://avatars.githubusercontent.com/u/21139416?s=40&v=4)](/Milerius)

   [Milerius](/trustwallet/wallet-core/commits?author=Milerius "View all commits by Milerius")
   authored
   Nov 21, 2022

   Configuration menu

   * [View commit details](/trustwallet/wallet-core/commit/69b2da9826dfdeb8116be1e5a3747b3e9418592d)
   * Copy full SHA for 69b2da9
   * [Browse repository at this point](/trustwallet/wallet-core/tree/69b2da9826dfdeb8116be1e5a3747b3e9418592d)

   Copy the full SHA

    [69b2da9](/trustwallet/wallet-core/commit/69b2da9826dfdeb8116be1e5a3747b3e9418592d)View commit details

   Browse the repository at this point in the history
2. [[emscripten]: use javascript for random generation (](/trustwallet/wallet-core/commit/d3c2eee16b154cbb69e8959b01e5e71fbabb1212)[#2750](https://github.com/trustwallet/wallet-core/pull/2750)[)](/trustwallet/wallet-core/commit/d3c2eee16b154cbb69e8959b01e5e71fbabb1212)
    …

   ```
   * feat(wasm): use javascript for random generation
   * feat(wasm): fix per review
   * add link to libsodium
   ```

   [![@Milerius](https://avatars.githubusercontent.com/u/21139416?s=40&v=4)](/Milerius)

   [Milerius](/trustwallet/wallet-core/commits?author=Milerius "View all commits by Milerius")
   authored
   Nov 21, 2022

   Configuration menu

   * [View commit details](/trustwallet/wallet-core/commit/d3c2eee16b154cbb69e8959b01e5e71fbabb1212)
   * Copy full SHA for d3c2eee
   * [Browse repository at this point](/trustwallet/wallet-core/tree/d3c2eee16b154cbb69e8959b01e5e71fbabb1212)

   Copy the full SHA

    [d3c2eee](/trustwallet/wallet-core/commit/d3c2eee16b154cbb69e8959b01e5e71fbabb1212)View commit details

   Browse the repository at this point in the history

 Loading

### This comparison is taking too long to generate.

Unfortunately it looks like we can’t render this comparison for you right now. It might be too big, or there might be something weird with your repository.

You can try running this command locally to see the comparison on your machine:

`git diff 3.1.0...3.1.1`

  Retry

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from blog.ledger.com_5772a490_20250114_194205.html ===


[Review and sign transactions from a single secure screen with Ledger Flex™

Discover now](https://shop.ledger.com/pages/ledger-flex)

Do you want to change language to ?

Yes, please
No, thanks

[![Ledger](https://www.ledger.com/wp-content/themes/ledger-v2/public/images/ledger-logo-long.svg)](https://www.ledger.com "Ledger")

* Products
  + [Ledger Flex
    New](https://shop.ledger.com/pages/ledger-flex "Ledger Flex")
  + [Ledger Stax](https://shop.ledger.com/pages/ledger-stax "Ledger Stax")
  + [Ledger Nano X](https://shop.ledger.com/pages/ledger-nano-x "Ledger Nano X")
  + [Ledger Nano S Plus](https://shop.ledger.com/pages/ledger-nano-s-plus "Ledger Nano S Plus")
  + [Compare our devices](https://shop.ledger.com/pages/hardware-wallets-comparison "Compare our devices")
  + [Hardware Wallet](https://shop.ledger.com/pages/hardware-wallet "Hardware Wallet")
  + [Gift Cards](https://shop.ledger.com/products/gift-card "Gift Cards")
  + [Packs](https://shop.ledger.com/#category-bundle "Packs")
  + [Accessories](https://shop.ledger.com/#category-accessories "Accessories")
  + [Collaborations](https://www.ledger.com/collaborations "Collaborations")
  + [See all products](https://shop.ledger.com "See all products")
  + [Download Ledger Live](https://www.ledger.com/ledger-live "Download Ledger Live")
  + [Supported crypto](https://www.ledger.com/supported-crypto-assets "Supported crypto")
* App and services
  + [Ledger Live](https://www.ledger.com/ledger-live "Ledger Live")
  + [Ledger Recover](https://shop.ledger.com/pages/ledger-recover "Ledger Recover")
  + [CL Card](https://www.ledger.com/cl-card "CL Card")
  + [Supported Services](https://www.ledger.com/supported-services "Supported Services")
  + [Crypto Prices](https://www.ledger.com/coin/price "Crypto Prices")
* Learn
  + [Ledger Academy](https://www.ledger.com/academy "Ledger Academy")
  + [Learn and Earn](https://quest.ledger.com/ "Learn and Earn")
  + [Classroom](https://www.ledger.com/academy/what-is-web-30-everything-you-need-to-know "Classroom")
  + [Blog](/blog "Blog")
  + [What is a crypto wallet](https://www.ledger.com/academy/basic-basics/2-how-to-own-crypto/what-is-a-crypto-wallet "What is a crypto wallet")
  + [How to Buy](https://www.ledger.com/buy "How to Buy")
  + [How to Swap](https://www.ledger.com/swap "How to Swap")
  + [How to Stake](https://www.ledger.com/staking "How to Stake")
* For Business
  + [Ledger Enterprise Solutions](https://enterprise.ledger.com?utm_source=mainsite&utm_medium=header "Ledger Enterprise Solutions")
  + [Ledger Partners](/partners "Ledger Partners")
  + [Ledger Co-branded Partnership](https://ledger.com/co-branded "Ledger Co-branded Partnership")
* [For Developers](https://developers.ledger.com/ "For Developers")
* [Support](https://support.ledger.com/hc "Support")
* English
  + This page is available in English only

[Blog](https://www.ledger.com/blog/funds-of-every-wallet-created-with-the-trust-wallet-browser-extension-could-have-been-stolen)

[Blog posts](https://www.ledger.com/category/blog-posts "Blog posts")

[Donjon](https://www.ledger.com/blog/category/donjon "Donjon") | 04/25/2023

# Funds of Every Wallet Created With The Trust Wallet Browser Extension Could Have Been Stolen Without Any User Interaction

[Blog](https://www.ledger.com/blog)

[Donjon](https://www.ledger.com/blog/category/donjon "Donjon")

| Things to know: |
| --- |
| – Seed generation of Trust Wallet was flawed, the total entropy was only 32 bits. We have created a file containing all possible seeds.– Fortunately, the Ledger Donjon discovered the vulnerability very quickly and likely avoided one of the biggest hack in the crypto ecosystem. |

On November 14th 2022, Trust Wallet, a widely used software wallet, announced the release of its browser extension. It allows access to digital assets on several blockchains directly from the browser, and is a long-awaited addition to the existing iOS and Android apps.

The Ledger Donjon has recently discovered a critical vulnerability in this browser extension, allowing an attacker to steal all the assets of any wallet created with this extension, without any user interaction. By knowing the address of an account, it is possible to immediately compute its private key, then access all its funds. Below are details of the vulnerability, how the Ledger Donjon discovered it, its impact over time, an estimation of the vulnerable assets, and how Trust Wallet responded to fix it. But let’s start with recalling the basics.

##### How wallets are created

Entropy generation is tricky. As scientists, we like reproducibility and being able to explain phenomena with cause-and-effect principles. So, generally speaking it’s hard to generate randomness. Moreover, it’s tough to demonstrate that random numbers are correct, and a bad but not terminally flawed random number generator can easily fool the observer. For good randomness, we need uniform distribution of bits and bytes (and even all chunks size), and unpredictability. For an observer of a sequence, it must be impossible to have any information on the next part of the sequence to be generated.

As these properties are incredibly difficult to achieve, the cryptocurrency space tries to avoid relying on randomness as much as possible – but we still need it at one stage: when we create a new wallet.

You’re probably already familiar with your mnemonic, the 12 to 24 english words that allow you to backup your wallet (if not, you can check [Ledger Academy](https://www.ledger.com/academy/bip-39-the-low-key-guardian-of-your-crypto-freedom) article on this very topic).

This mnemonic encodes 16 to 32 bytes of entropy, according to the [BIP 39 standard](https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki) – the quality of this entropy is critical, since it’ll be the seed of all keys used by your wallet on all chains, following a deterministic derivation process defined by the [BIP 32](https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki) and [BIP 44](https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki) standards.

![](https://www.ledger.com/wp-content/uploads/2023/05/derivation.png)

This Hierarchical Deterministic scheme is pretty much ubiquitous today, considering how easy it makes it for users to create a backup of an infinity of keys and its portability (despite BIP 39 being “unanimously discouraged for implementation”). Signer roaming is a powerful feature – when your favorite wallet fails or disappoints, you can just take your mnemonic with you (or even better, your Ledger device), switch to another one, keep your financial freedom and limit any impact of its downtime.

But again, it requires a flawless entropy source.

##### Overview of the Vulnerability

Trust Wallet relies on [Trust Wallet Core](https://github.com/trustwallet/wallet-core), a cross-platform library that implements low-level cryptographic wallet functionality for many blockchains. It was mobile-focused, but it also targets Wasm since April 2022 (see [#2132](https://github.com/trustwallet/wallet-core/pull/2132)).

While most of the Trust Wallet Core is portable, a few modules and functions are very specific to  a target. This is notably the case for the secure random generation part, used to create cryptographic material such as private keys, and mnemonic for HD wallets. Each implementation leverages the pseudorandom number generator (PRNG) offered by the operating system:

* For iOS, `SecRandomCopyBytes` is used.
* For Android, the entropy is provided by an instance of `java.security.SecureRandom`.

This is usually a good practice, as such primitives are supposed to be safe.

##### Wasm backend

There is a difference with the Wasm target. This module can run on several environments, like any browser supporting Wasm, or Node.js. These platforms do not provide a common strong PRNG, and one cannot get access to the “classic” system interfaces from these environments. For example, a Wasm module running in Chrome for Linux could not directly read `/dev/urandom`.

To tackle this, a dedicated so-called “secure random generator” has been implemented in [#2240](https://github.com/trustwallet/wallet-core/pull/2240). It is based on a PR made in emscripten (see PR [#12240](https://github.com/emscripten-core/emscripten/pull/12240) in emscripten) written precisely to avoid reading `/dev/urandom`.

According to the author:

*What we do here is simple, we wrap*`std::random_device`*with*`std::mt19937`*and return a random uint32 value, inspired by*[emscripten-core/emscripten#12240](https://github.com/emscripten-core/emscripten/pull/12240)*.*

**There is an important problem here, which leads to a critical vulnerability for wallet-core for Wasm and for any product relying on it: the PRNG used is a Mersenne Twister, and it should not be used for cryptographic purposes. Moreover, the specialized version mt19937 takes a single 32-bit value as input seed.**

What are the consequences here? The custom Random module for Wasm implements two functions: `random32` which outputs a 32-bit random value, and `random_buffer` which fills a buffer of arbitrary size with random data. In the Wallet Core project, these functions are exclusively used by trezor-crypto, the cryptographic library developed by Trezor to ensure secure cryptography on their hardware wallets.

Now, let’s see how are generated HD wallets:

* Entrypoint is HDWallet. It takes a strength, and a passphrase to protect it later:

C++
```
HDWallet::HDWallet(int strength, const std::string& passphrase)
    : passphrase(passphrase) {
    char buf[MnemonicBufLength];
    const char* mnemonic_chars = mnemonic_generate(strength, buf, MnemonicBufLength);
    if (mnemonic_chars == nullptr) {
        throw std::invalid_argument("Invalid strength");
    }
    mnemonic = mnemonic_chars;
    TW::memzero(buf, MnemonicBufLength);
    updateSeedAndEntropy();
}
```

<https://github.com/trustwallet/wallet-core/blob/3.1.0/src/HDWallet.cpp#L45>

This functions then calls `mnemonic_generate` to create a BIP-39 mnemonic:

C++
```
const char *mnemonic_generate(int strength, char *buf, int buflen) {
  if (strength % 32 || strength < 128 || strength > 256) {
    return 0;
  }
  uint8_t data[32] = {0};
  random_buffer(data, 32);
  const char *r = mnemonic_from_data(data, strength / 8, buf, buflen);
  memzero(data, sizeof(data));
  return r;
}
```

<https://github.com/trustwallet/wallet-core/blob/3.1.0/trezor-crypto/crypto/bip39.c#L55>

`mnemonic_generate` calls `random_buffer`, which outputs a random buffer filled using a Mersenne twister PRNG, whose instance has just been seeded:

C++
```
void random_buffer(uint8_t* buf, size_t len) {
    std::mt19937 rng(std::random_device{}());
    std::generate_n(buf, len, [&rng]() -> uint8_t { return rng() & 0x000000ff; });
    return;
}
```

<https://github.com/trustwallet/wallet-core/blob/3.1.0/wasm/src/Random.cpp#L19>

As the seed is just 32 bits, the Wasm version of wallet-core allows to create only 2^32 (~4 billion) possible mnemonics. All these mnemonics can be generated in a couple of hours in a single computer.

From there, an attacker is able to:

* Compute all the seeds, private keys, then addresses of every cryptocurrency handled by Trust Wallet.
* Scan the related blockchains to extract all the used addresses.
* Compute the intersection to get all the addresses of wallets created by Trust Wallet for Wasm, and steal their funds.

Running such attack takes much more than a couple of hours, but is doable with a few GPUs in less than a day (see [medium.com/@johncantrell97/how-i-checked-over-1-trillion-mnemonics-in-30-hours-to-win-a-bitcoin](https://medium.com/%40johncantrell97/how-i-checked-over-1-trillion-mnemonics-in-30-hours-to-win-a-bitcoin-635fe051a752) for a cost estimation. Attack is 256 times easier here).

##### Application to Trust Wallet browser extension

The [Trust Wallet browser extension](https://trustwallet.com/browser-extension/) is an extension for Chromium-based browsers. It is clearly a MetaMask competitor, and is branded as a “secure multi-chain crypto wallet and gateway to thousands of Web3 decentralized applications (dApps).”

Extension is closed-source, but its code can be easily analyzed. It relies on the vulnerable Wasm implementation of Trust Wallet Core.

When a wallet is created, extension creates a 12-word mnemonic from a random 128-bit seed. Mnemonic is generated this way:

C++
```
generateMnemonicWallet(e){
return e||ct.error("Trying to generate wallet without password"),
this.walletCore.HDWallet.create(Js.DEFAULT_STRENGTH,e)
}
```

`HDWallet.create` is the auto-generated Wasm wrapper for the HDWallet constructor described above. That means the vulnerable `random_buffer` function is used, so mnemonics can be retrieved from the user address with a brute force attack.

This extension handles the following assets: AVAX, BNB, ETH, MATIC, SOL and TWT.

* Addresses are identical for ETH, BNB, MATIC, AVAX and TWT. These are standard Ethereum addresses, sharing the same derivation path (m/44’/60’/0’/0/0).
* Solana uses a different derivation path: m/44’/501’/0’/0’.

To drain the funds of all the Trust Wallet extension users, attacker can:

* Compute and store every possible mnemonic, then Ethereum private key and Ethereum address, that can be generated by this extension.
* Gather all the used Ethereum addresses created since the first release of the Trust Wallet browser extension, and store them locally.
* Perform a lookup in the address database.
* Empty wallet with the private key, if the address has been used.

These steps can be reproduced for every chain. We detail now how the Ledger Donjon implemented this attack on Ethereum and Binance Smart Chain, without, of course, draining the wallets.

##### Attacking Trust Wallet

The vulnerability allows an attacker to compute mnemonic from any address of a wallet created by the browser extension. For that, one needs to compute a mapping between the possible mnemonics and the resulting address.

###### Generating all the addresses the Trust Wallet extension can create

Based on the vulnerability in the PRNG previously explained, it is possible to enumerate all the addresses (and the related private keys) the Trust Wallet extension can create. My idea was to store every possible address in a big table. Then, from a list of addresses extracted from the Ethereum blockchain, one can check if some addresses are present in this table. If so, its private key can be computed.

Derivation from entropy to mnemonic then to Ethereum address uses the standard derivation mechanism [BIP-32](https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki), [BIP-39](https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki), and the [BIP-44](https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki) account hierarchy.

First difficulty was to enumerate all these addresses. Transformation from PRNG seed to address requires the following steps:

* **Entropy generation**: initialize the Mersenne Twister with the seed, and  call it 16 times to gather the initial entropy.
* **Entropy to mnemonic**: one SHA-256 to compute the final checksum embedded in the last word.
* **Mnemonic to seed**: mnemonic are converted into a 512-bit seed using PKBDF2-HMAC-SHA512 with 2048 iterations. There are 2 SHA-512 computations per iteration, so total cost is 4096 SHA-512 computations.
* **Seed to BIP-32 master key**: 1 HMAC SHA-512 costing 2 SHA-512 computations.
* **Master key to Ethereum private key**: master key is derived on m/44’/60’/0’/0/0. This requires 3 hardened child private key derivations and 2 normal child key derivations.
  + Each hardened child private key derivation requires one HMAC SHA-512 (2 SHA-512) calculation and one addition on secp256k1.
  + Each normal child private key derivation requires a child private key derivation, and a scalar multiplication on secp256k1 to convert the private key provided in input to a public key.
* **Ethereum private key to address**: this last step requires a private to public key conversion, so another scalar multiplication, and one Keccak-256 hash.

Total cost for all these steps is then:

* Initialization and 16 calls to Mersenne Twister
* 1 SHA-256
* 4108 SHA-512
* 5 point additions
* 2 scalar multiplications on secp256k1

The most expensive steps are the SHA-512 computations and the scalar multiplications. To make it short, the overall process to transform the PRNG seed to an Ethereum address is slow. Running such computation on a single CPU would take months, and probably several weeks on the CPUs that were available in the Donjon. So, we implemented it using OpenCL (based on [BIP39 Solver GPU](https://github.com/johncantrell97/bip39-solver-gpu)) and ran it on 2 NVIDIA GeForce GTX 1080 Ti GPUs.

The output of this tool is a big file containing all the Ethereum addresses that the extension can generate. As there are 2^32 possible seeds, and each address is 20-bytes long, this table takes 80 Gb.

From there, table lookups are slow: to match an address, it would require iterating through all this big table.

To speed up these lookups, we split the table into 256 smaller tables, according to the first byte of the Ethereum address. Each table contains pairs of PRNG seeds, and their resulting Ethereum address.

Finally, to be able to perform fast lookups in each table, we sorted them according to the Ethereum address. It is now possible to do binary searches on these tables: lookups on these sorted tables are very cheap.

To save some disk space, we stored PRNG seed and only the first 8 bytes of each Ethereum address. The last 12 bytes are not necessary, as collisions are negligible in my use-case. Each entry takes then 12 bytes. Whole tables then take 48 Gb.

Here are the timings for each step:

![](https://www.ledger.com/wp-content/uploads/2023/05/Capture-decran-2023-05-15-a-15.15.51-1024x246.png)

Using these tables, it is possible to immediately retrieve the mnemonics used to generate an address. To assess the impact of the vulnerability, Binance asked me the mnemonic of 3 test addresses they provided. Here is the result:

Python
```
$ time ./crack_address.py --table-dir /mnt/traces/tw/ 0xdf6D9547e163D5E7eafBe2FeB24Bfa12A4C913C0 0xE1E0580cb5eA0c0FD034FF2cdfc872ce4493676C 0x02b2Ae981b138F066344774A2AD75225A046c377

Address: 0xdf6D9547e163D5E7eafBe2FeB24Bfa12A4C913C0
RNG seed: 0xc92b023d
Mnemonic: stick bench smart report motor arrive enter river scale manage viable squeeze
Private key: 84117778e20a98f488234c89b6386b4175bb66ccf2fc77d14203f72a5a22686a

Address: 0xE1E0580cb5eA0c0FD034FF2cdfc872ce4493676C
RNG seed: 0x1ae841e9
Mnemonic: install issue guilt rescue slight barrel gasp vendor glimpse avocado cart frequent
Private key: 3b0df65fe03a210661101172ca2a3e38fd75fdcc580248a2f28587c2ece0bba8

Address: 0x02b2Ae981b138F066344774A2AD75225A046c377
RNG seed: 0x2ed51a57
Mnemonic: ginger pave slight million pencil flame monkey detect power protect soft derive
Private key: 95a3be70efe04a7c06df98d68c4ccd7d453b0f39f6a097b24f2f2ac48d02494e

real    0m0,207s
user    0m0,179s
sys     0m0,028s
```

Retrieving the 3 mnemonics and private keys took a few hundred milliseconds. According to our tests, **the process is actually fast enough to process in real time all the transactions on the Ethereum blockchain and to break all the vulnerable addresses as soon as they are used**. By caching addresses already tested, the same applies for other blockchains such as BSC. In this attack scenario, one could monitor transactions when they reach the mempool, and compute sender or recipient private keys in real time.

##### Listing all the used Ethereum addresses

What we would like is to estimate the real number of vulnerable wallets, and their balance. This sounds easy, as all the transactions are public, hence all the addresses are available on the blockchain. However, there is no way to directly retrieve the list of the used addresses.

We implemented a method that iterates through every block of the Ethereum blockchain. We extracted the sender and recipient addresses of all the transactions, and the address parameters of every call to ERC-20 contracts.

Note that with this method, only used wallets can be detected: some vulnerable wallets that did not receive assets have never interacted with the blockchain.

We scanned the Ethereum blockchain between blocks 14820000 and 16096000. Block 14820000 was created on May 21 2022, hence just before the pull request that added the vulnerable code in Trust Wallet Core. 16096000 was the latest block when I wrote this post.

Public nodes seem to have a rate limit, so I queried several public nodes in parallel to gather a total of 147,910,120 addresses during several dozen hours. After duplicates are removed, we obtain a list of 32,613,317 unique addresses.

The same method has been used for Binance Smart Chain. Public BSC nodes have been scanned.

##### Estimating the number of vulnerable accounts

Finally, a tool to test if an address has been created by the Trust Wallet extension has been written. It makes a lookup in the generated tables, gets the PRNG seed, and from there compute the mnemonic, the Ethereum private key and the associated address.

Computation is very fast. Candidate addresses were sorted beforehand to minimize I/O and to perform a nested binary search. Lookups on the 32 million of addresses take a few minutes using a simple Python script.

Here is an example with an address taken from a [public tweet](https://twitter.com/NajmulHafej/status/1592316198834036738) replying to the announcement of the Trust Wallet extension. I took this one as an example as this address has [never been used](https://etherscan.io/address/0xE17282BBbD0f32cA98683933382633ab6d9778B0), so user funds are not at risk.

Python
```
$ time python3 pwn_address.py 0xE17282BBbD0f32cA98683933382633ab6d9778B0
RNG seed: 0x8ec170a8
Mnemonic: sorry slush already pass garden decade grid drip machine cradle call put
Private key: b9168c1fab55f840a5e04d96f7a38cb8803b67ec7c41f720fb6c487c08f3d536
​
real   0m0,194s
user   0m0,170s
sys     0m0,024s
```

Tool has been run on the dataset of 1,873,720 detailed above. Testing all the addresses and computing the private keys of vulnerable accounts took 4 min 22s, so it is very cheap.

With this list of vulnerable private keys, it’s possible to list all the corresponding addresses, their balances and obviously to drain them… During our investigations, around $30 millions were at risk at some point, but we didn’t monitor all chains and tokens overtime.

##### Remediation

### 2022, November the 17th

Vulnerability has been reported to Binance using their [bug bounty program](https://bugcrowd.com/binance) on 2022, November the 17th.

To confirm the vulnerability, Binance sent us 3 addresses and asked them to provide mnemonics:

> Can you please try to run your tool and provide mnemonics for these 3 addresses?
> Wallet 1 – 0xdf6D9547e163D5E7eafBe2FeB24Bfa12A4C913C0
> Wallet 2 – 0xE1E0580cb5eA0c0FD034FF2cdfc872ce4493676C
> Wallet 3 – 0x02b2Ae981b138F066344774A2AD75225A046c377
> Thanks!
> Best regards.

Once all the possible addresses have been precomputed, retrieving the mnemonic from an address is as simple as a lookup in a 4-billion entries table. The three mnemonics have been retrieved in 0.2s:

Python
```
$ time ./pwn_address.py 0xdf6D9547e163D5E7eafBe2FeB24Bfa12A4C913C0 0xE1E0580cb5eA0c0FD034FF2cdfc872ce4493676C 0x02b2Ae981b138F066344774A2AD75225A046c377
Address: 0xdf6D9547e163D5E7eafBe2FeB24Bfa12A4C913C0
RNG seed: 0xc92b023d
Mnemonic: stick bench smart report motor arrive enter river scale manage viable squeeze
Private key: 84117778e20a98f488234c89b6386b4175bb66ccf2fc77d14203f72a5a22686a
​
Address: 0xE1E0580cb5eA0c0FD034FF2cdfc872ce4493676C
RNG seed: 0x1ae841e9
Mnemonic: install issue guilt rescue slight barrel gasp vendor glimpse avocado cart frequent
Private key: 3b0df65fe03a210661101172ca2a3e38fd75fdcc580248a2f28587c2ece0bba8
​
Address: 0x02b2Ae981b138F066344774A2AD75225A046c377
RNG seed: 0x2ed51a57
Mnemonic: ginger pave slight million pencil flame monkey detect power protect soft derive
Private key: 95a3be70efe04a7c06df98d68c4ccd7d453b0f39f6a097b24f2f2ac48d02494e
​
real    0m0,229s
user    0m0,194s
sys     0m0,021s
```
### 2022, November the 21st

A few days after, on November the 21st, Trustwallet team [publicly committed](https://github.com/trustwallet/wallet-core/commit/d3c2eee16b154cbb69e8959b01e5e71fbabb1212) on Github the fix avoiding the generation of new flawed seeds. We were quite worried someone would notice it and exploit the vulnerability.

### 2022, November

Trustwallet team updated the app to warn their users, prevent them from generating new flawed seeds and removed the receiving flows.

From there, we monitored the situation and the funds at risk. Only a few days after the release of this vulnerable wallets, around $30 millions were at risk.

### 2023, March

Trustwallet team granted us the highest bounty they offer : $100k

### 2023, April the 22nd

After months waiting for users to migrate their funds, Trustwallet team disclosed the vulnerability and wrote a [postmortem](https://community.trustwallet.com/t/browser-extension-wasm-vulnerability-postmortem/750787). As of now, there are still  wallets with remaining funds that can be stolen (~$100k). Trust Wallet promised the reimbursement of stolen funds.

![](https://www.ledger.com/wp-content/uploads/2023/05/tweet.png)
##### Conclusion

This vulnerability illustrates the worst case scenario of a crypto bug – compromised accounts forever.

Creating good randomness is a daunting task – Ledger devices rely on dedicated silicon logic in our certified smartcard chips that have been the gold standard of secure industries for the past 40 years to guarantee high quality randomness and tamper resistance.

Given the complexity of contacting the owners of those accounts and the possibility to use those compromised accounts on all kinds of different software and hardware wallets, TrustWallet did a pretty fine job reducing the risk for their users.

In the (very) (near) future it’s likely that bots will fight to be the first to steal funds deposited to those addresses, similar to [what happened with brain wallets in the past](https://github.com/ryancdotorg/brainflayer).

Special thanks to Jean-Baptiste Bédrune for saving the world. Only a few days after the release of the Trust Wallet extension, almost $30 millions were at risk. A nightmare scenario could have occurred if an attacker found the vulnerability after a couple of months.

During our investigations, we also noticed that a few addresses were vulnerable while they had been generated a long time before the Trust Wallet release. That probably means this vulnerability exists in some other wallet implementations which is concerning…

More articles

[Donjon](https://www.ledger.com/blog/category/donjon "Donjon") | 01/14/2025

TEE: When “Trusted” Doesn’t Mean “Secure&...

[Read more](https://www.ledger.com/tee-when-trusted-doesnt-mean-secure "TEE: When “Trusted” Doesn’t Mean “Secure”")

[Tech](https://www.ledger.com/blog/category/tech "Tech") | 12/18/2024

ETHGlobal Bangkok: Ledger features security-focused projects...

[Read more](https://www.ledger.com/blog/ethglobal-bangkok-ledger-features-security-focused-projects "ETHGlobal Bangkok: Ledger features security-focused projects")

[Donjon](https://www.ledger.com/blog/category/donjon "Donjon") | 12/16/2024

SCADL: A new side-channel attack tool using deep learning...

[Read more](https://www.ledger.com/blog/scadl-a-new-side-channel-attack-tool-using-deep-learning "SCADL: A new side-channel attack tool using deep learning")

### Stay in touch

Announcements can be found in our blog. Press contact:
 [[email protected]](/cdn-cgi/l/email-protection#1d707879747c5d7178797a786f337e7270)

### Subscribe to our

New coins supported, blog updates and exclusive offers directly in your inbox

Enter your email

Register to newsletter

Your email address will only be used to send you our newsletter, as well as updates and offers. You can unsubscribe at any time using the link included in the newsletter.

[Learn more about how we manage your data and your rights.](https://shop.ledger.com/pages/privacy-notice#ledger-newsletter)

[![](https://www.ledger.com/wp-content/themes/ledger-v2/public/images/ledger-logo-long.svg)](https://www.ledger.com "Ledger")

* English
  + This page is available in English only

Payment methods

![](https://www.ledger.com/wp-content/themes/ledger-v2/public/images/payment-methods-logos.webp)

* Products
  + [Hardware Wallet](https://shop.ledger.com/pages/hardware-wallet)
  + [Ledger Stax](https://shop.ledger.com/pages/ledger-stax)
  + [Ledger Flex](https://shop.ledger.com/pages/ledger-flex)
  + [Ledger Nano X](https://shop.ledger.com/pages/ledger-nano-x)
  + [Ledger Nano S Plus](https://shop.ledger.com/pages/ledger-nano-s-plus)
  + [Compare our devices](https://shop.ledger.com/pages/hardware-wallets-comparison)
  + [Bundles](https://shop.ledger.com/#category-bundle)
  + [Accessories](https://shop.ledger.com/#category-accessories)
  + [All products](https://shop.ledger.com)
  + [Downloads](https://www.ledger.com/ledger-live)

* Crypto Assets
  + [Bitcoin wallet](https://www.ledger.com/coin/wallet/bitcoin)
  + [Ethereum wallet](https://www.ledger.com/coin/wallet/ethereum)
  + [Solana wallet](https://www.ledger.com/coin/wallet/solana)
  + [Cardano wallet](https://www.ledger.com/coin/wallet/cardano)
  + [XRP wallet](https://www.ledger.com/coin/wallet/ripple)
  + [Monero wallet](https://www.ledger.com/coin/wallet/monero)
  + [USDT wallet](https://www.ledger.com/coin/wallet/tether)
  + [See all assets](https://www.ledger.com/supported-crypto-assets)

* Crypto Services
  + [Crypto Prices](https://www.ledger.com/coin/price)
  + [Buying crypto](https://www.ledger.com/buy)
  + [Staking crypto](https://www.ledger.com/staking)
  + [Swapping crypto](https://www.ledger.com/swap)

* For Business
  + [Ledger Enterprise Solutions](https://enterprise.ledger.com/)

* For Startups
  + [Funding from Ledger Cathay Capital](https://www.ledger.com/cathay-ledger-fund)

* For Developers
  + [The Developer Portal](https://developers.ledger.com/)

* Get started
  + [Start using your Ledger device](https://www.ledger.com/start)
  + [Compatible wallets and services](https://www.ledger.com/ledger-wallets-and-services)
  + [How to buy Bitcoin](https://www.ledger.com/buy-bitcoin)
  + [Guide before buying bitcoin](https://www.ledger.com/buy-bitcoin/how)
  + [Bitcoin Hardware Wallet](https://shop.ledger.com/pages/bitcoin-hardware-wallet)

* See also
  + [Support](https://support.ledger.com/hc)
  + [Bounty program](https://donjon.ledger.com/bounty/)
  + [Resellers](/reseller)
  + [Ledger Press Kit](https://www.ledger.com/press)
  + [Affiliates](https://www.ledgerwallet.com/affiliates/)
  + [Status](https://status.ledger.com/)
  + [Developers](https://developers.ledger.com/)
  + [Partners](/partners)

* Careers
  + [Join us](https://careers.ledger.com/homepage)
  + [All jobs](https://careers.ledger.com/jobs/search)

* About
  + [Our vision](https://www.ledger.com/blog/we-are-ledger-a-brand-vision)
  + [Ledger Academy](https://www.ledger.com/academy)
  + [The company](/the-company)
  + [The people](/the-people-behind-ledger)
  + [Diversity](https://www.ledger.com/diversity)
  + [Blog](/blog)

* Legal
  + [Legal Center](https://www.ledger.com/legal-center)
  + [Sales Terms and Conditions](https://shop.ledger.com/pages/terms-and-conditions)
  + [Privacy Policy](https://www.ledger.com/privacy-policy)
  + [Cookie Policy](https://shop.ledger.com/pages/cookie-policy)
  + [Disclaimers](https://shop.ledger.com/pages/disclaimers)


