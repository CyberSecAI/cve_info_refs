=== Content from git.kernel.org_93bde5e3_20250115_100347.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=dfd0aa26e9a07f2ce546ccf8304ead6a2914e8a7)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=dfd0aa26e9a07f2ce546ccf8304ead6a2914e8a7)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=dfd0aa26e9a07f2ce546ccf8304ead6a2914e8a7)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=dfd0aa26e9a07f2ce546ccf8304ead6a2914e8a7)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | YueHaibing <yuehaibing@huawei.com> | 2023-07-15 17:25:43 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-07-27 08:56:36 +0200 |
| commit | [dfd0aa26e9a07f2ce546ccf8304ead6a2914e8a7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=dfd0aa26e9a07f2ce546ccf8304ead6a2914e8a7) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=dfd0aa26e9a07f2ce546ccf8304ead6a2914e8a7)) | |
| tree | [b1bc5e656bb099c1ac87195c964622921ccfa0b6](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=dfd0aa26e9a07f2ce546ccf8304ead6a2914e8a7) | |
| parent | [6f615640f6b23523714d9a17535ff0fe7a3c9a14](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6f615640f6b23523714d9a17535ff0fe7a3c9a14) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=dfd0aa26e9a07f2ce546ccf8304ead6a2914e8a7&id2=6f615640f6b23523714d9a17535ff0fe7a3c9a14)) | |
| download | [linux-dfd0aa26e9a07f2ce546ccf8304ead6a2914e8a7.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-dfd0aa26e9a07f2ce546ccf8304ead6a2914e8a7.tar.gz) | |

can: bcm: Fix UAF in bcm\_proc\_show()commit 55c3b96074f3f9b0aee19bf93cd71af7516582bb upstream.
BUG: KASAN: slab-use-after-free in bcm\_proc\_show+0x969/0xa80
Read of size 8 at addr ffff888155846230 by task cat/7862
CPU: 1 PID: 7862 Comm: cat Not tainted 6.5.0-rc1-00153-gc8746099c197 #230
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
Call Trace:
<TASK>
dump\_stack\_lvl+0xd5/0x150
print\_report+0xc1/0x5e0
kasan\_report+0xba/0xf0
bcm\_proc\_show+0x969/0xa80
seq\_read\_iter+0x4f6/0x1260
seq\_read+0x165/0x210
proc\_reg\_read+0x227/0x300
vfs\_read+0x1d5/0x8d0
ksys\_read+0x11e/0x240
do\_syscall\_64+0x35/0xb0
entry\_SYSCALL\_64\_after\_hwframe+0x63/0xcd
Allocated by task 7846:
kasan\_save\_stack+0x1e/0x40
kasan\_set\_track+0x21/0x30
\_\_kasan\_kmalloc+0x9e/0xa0
bcm\_sendmsg+0x264b/0x44e0
sock\_sendmsg+0xda/0x180
\_\_\_\_sys\_sendmsg+0x735/0x920
\_\_\_sys\_sendmsg+0x11d/0x1b0
\_\_sys\_sendmsg+0xfa/0x1d0
do\_syscall\_64+0x35/0xb0
entry\_SYSCALL\_64\_after\_hwframe+0x63/0xcd
Freed by task 7846:
kasan\_save\_stack+0x1e/0x40
kasan\_set\_track+0x21/0x30
kasan\_save\_free\_info+0x27/0x40
\_\_\_\_kasan\_slab\_free+0x161/0x1c0
slab\_free\_freelist\_hook+0x119/0x220
\_\_kmem\_cache\_free+0xb4/0x2e0
rcu\_core+0x809/0x1bd0
bcm\_op is freed before procfs entry be removed in bcm\_release(),
this lead to bcm\_proc\_show() may read the freed bcm\_op.
Fixes: ffd980f976e7 ("[CAN]: Add broadcast manager (bcm) protocol")
Signed-off-by: YueHaibing <yuehaibing@huawei.com>
Reviewed-by: Oliver Hartkopp <socketcan@hartkopp.net>
Acked-by: Oliver Hartkopp <socketcan@hartkopp.net>
Link: [https://lore.kernel.org/all/20230715092543.15548-1-yuehaibing@huawei.com](https://lore.kernel.org/all/20230715092543.15548-1-yuehaibing%40huawei.com)
Cc: stable@vger.kernel.org
Signed-off-by: Marc Kleine-Budde <mkl@pengutronix.de>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=dfd0aa26e9a07f2ce546ccf8304ead6a2914e8a7)

| -rw-r--r-- | [net/can/bcm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/can/bcm.c?id=dfd0aa26e9a07f2ce546ccf8304ead6a2914e8a7) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 6 deletions

| diff --git a/net/can/bcm.c b/net/can/bcm.cindex a962ec2b8ba5b3..925d48cc50f812 100644--- a/[net/can/bcm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/can/bcm.c?id=6f615640f6b23523714d9a17535ff0fe7a3c9a14)+++ b/[net/can/bcm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/can/bcm.c?id=dfd0aa26e9a07f2ce546ccf8304ead6a2914e8a7)@@ -1526,6 +1526,12 @@ static int bcm\_release(struct socket \*sock)  lock\_sock(sk); +#if IS\_ENABLED(CONFIG\_PROC\_FS)+ /\* remove procfs entry \*/+ if (net->can.bcmproc\_dir && bo->bcm\_proc\_read)+ remove\_proc\_entry(bo->procname, net->can.bcmproc\_dir);+#endif /\* CONFIG\_PROC\_FS \*/+ list\_for\_each\_entry\_safe(op, next, &bo->tx\_ops, list) bcm\_remove\_op(op); @@ -1561,12 +1567,6 @@ static int bcm\_release(struct socket \*sock) list\_for\_each\_entry\_safe(op, next, &bo->rx\_ops, list) bcm\_remove\_op(op); -#if IS\_ENABLED(CONFIG\_PROC\_FS)- /\* remove procfs entry \*/- if (net->can.bcmproc\_dir && bo->bcm\_proc\_read)- remove\_proc\_entry(bo->procname, net->can.bcmproc\_dir);-#endif /\* CONFIG\_PROC\_FS \*/- /\* remove device reference \*/ if (bo->bound) { bo->bound = 0; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 10:02:25 +0000



=== Content from git.kernel.org_7faf8f58_20250115_100347.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=cf254b4f68e480e73dab055014e002b77aed30ed)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=cf254b4f68e480e73dab055014e002b77aed30ed)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cf254b4f68e480e73dab055014e002b77aed30ed)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cf254b4f68e480e73dab055014e002b77aed30ed)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | YueHaibing <yuehaibing@huawei.com> | 2023-07-15 17:25:43 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-07-27 08:44:35 +0200 |
| commit | [cf254b4f68e480e73dab055014e002b77aed30ed](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cf254b4f68e480e73dab055014e002b77aed30ed) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=cf254b4f68e480e73dab055014e002b77aed30ed)) | |
| tree | [90aa2db579b0247446cb42d94f47665931933adb](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=cf254b4f68e480e73dab055014e002b77aed30ed) | |
| parent | [3e412b6e2b57658905b1c89ddec05504f4342232](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3e412b6e2b57658905b1c89ddec05504f4342232) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cf254b4f68e480e73dab055014e002b77aed30ed&id2=3e412b6e2b57658905b1c89ddec05504f4342232)) | |
| download | [linux-cf254b4f68e480e73dab055014e002b77aed30ed.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-cf254b4f68e480e73dab055014e002b77aed30ed.tar.gz) | |

can: bcm: Fix UAF in bcm\_proc\_show()commit 55c3b96074f3f9b0aee19bf93cd71af7516582bb upstream.
BUG: KASAN: slab-use-after-free in bcm\_proc\_show+0x969/0xa80
Read of size 8 at addr ffff888155846230 by task cat/7862
CPU: 1 PID: 7862 Comm: cat Not tainted 6.5.0-rc1-00153-gc8746099c197 #230
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
Call Trace:
<TASK>
dump\_stack\_lvl+0xd5/0x150
print\_report+0xc1/0x5e0
kasan\_report+0xba/0xf0
bcm\_proc\_show+0x969/0xa80
seq\_read\_iter+0x4f6/0x1260
seq\_read+0x165/0x210
proc\_reg\_read+0x227/0x300
vfs\_read+0x1d5/0x8d0
ksys\_read+0x11e/0x240
do\_syscall\_64+0x35/0xb0
entry\_SYSCALL\_64\_after\_hwframe+0x63/0xcd
Allocated by task 7846:
kasan\_save\_stack+0x1e/0x40
kasan\_set\_track+0x21/0x30
\_\_kasan\_kmalloc+0x9e/0xa0
bcm\_sendmsg+0x264b/0x44e0
sock\_sendmsg+0xda/0x180
\_\_\_\_sys\_sendmsg+0x735/0x920
\_\_\_sys\_sendmsg+0x11d/0x1b0
\_\_sys\_sendmsg+0xfa/0x1d0
do\_syscall\_64+0x35/0xb0
entry\_SYSCALL\_64\_after\_hwframe+0x63/0xcd
Freed by task 7846:
kasan\_save\_stack+0x1e/0x40
kasan\_set\_track+0x21/0x30
kasan\_save\_free\_info+0x27/0x40
\_\_\_\_kasan\_slab\_free+0x161/0x1c0
slab\_free\_freelist\_hook+0x119/0x220
\_\_kmem\_cache\_free+0xb4/0x2e0
rcu\_core+0x809/0x1bd0
bcm\_op is freed before procfs entry be removed in bcm\_release(),
this lead to bcm\_proc\_show() may read the freed bcm\_op.
Fixes: ffd980f976e7 ("[CAN]: Add broadcast manager (bcm) protocol")
Signed-off-by: YueHaibing <yuehaibing@huawei.com>
Reviewed-by: Oliver Hartkopp <socketcan@hartkopp.net>
Acked-by: Oliver Hartkopp <socketcan@hartkopp.net>
Link: [https://lore.kernel.org/all/20230715092543.15548-1-yuehaibing@huawei.com](https://lore.kernel.org/all/20230715092543.15548-1-yuehaibing%40huawei.com)
Cc: stable@vger.kernel.org
Signed-off-by: Marc Kleine-Budde <mkl@pengutronix.de>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cf254b4f68e480e73dab055014e002b77aed30ed)

| -rw-r--r-- | [net/can/bcm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/can/bcm.c?id=cf254b4f68e480e73dab055014e002b77aed30ed) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 6 deletions

| diff --git a/net/can/bcm.c b/net/can/bcm.cindex ddba4e12da7834..2388c619f29ca8 100644--- a/[net/can/bcm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/can/bcm.c?id=3e412b6e2b57658905b1c89ddec05504f4342232)+++ b/[net/can/bcm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/can/bcm.c?id=cf254b4f68e480e73dab055014e002b77aed30ed)@@ -1521,6 +1521,12 @@ static int bcm\_release(struct socket \*sock)  lock\_sock(sk); +#if IS\_ENABLED(CONFIG\_PROC\_FS)+ /\* remove procfs entry \*/+ if (net->can.bcmproc\_dir && bo->bcm\_proc\_read)+ remove\_proc\_entry(bo->procname, net->can.bcmproc\_dir);+#endif /\* CONFIG\_PROC\_FS \*/+ list\_for\_each\_entry\_safe(op, next, &bo->tx\_ops, list) bcm\_remove\_op(op); @@ -1556,12 +1562,6 @@ static int bcm\_release(struct socket \*sock) list\_for\_each\_entry\_safe(op, next, &bo->rx\_ops, list) bcm\_remove\_op(op); -#if IS\_ENABLED(CONFIG\_PROC\_FS)- /\* remove procfs entry \*/- if (net->can.bcmproc\_dir && bo->bcm\_proc\_read)- remove\_proc\_entry(bo->procname, net->can.bcmproc\_dir);-#endif /\* CONFIG\_PROC\_FS \*/- /\* remove device reference \*/ if (bo->bound) { bo->bound = 0; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 10:02:24 +0000



=== Content from git.kernel.org_e1ec3226_20250115_100344.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=9533dbfac0ff7edd77a5fa2c24974b1d66c8b0a6)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9533dbfac0ff7edd77a5fa2c24974b1d66c8b0a6)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9533dbfac0ff7edd77a5fa2c24974b1d66c8b0a6)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9533dbfac0ff7edd77a5fa2c24974b1d66c8b0a6)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | YueHaibing <yuehaibing@huawei.com> | 2023-07-15 17:25:43 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-07-27 08:37:40 +0200 |
| commit | [9533dbfac0ff7edd77a5fa2c24974b1d66c8b0a6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9533dbfac0ff7edd77a5fa2c24974b1d66c8b0a6) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=9533dbfac0ff7edd77a5fa2c24974b1d66c8b0a6)) | |
| tree | [6995febce5051db09af8be8b06207818e4b5a108](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9533dbfac0ff7edd77a5fa2c24974b1d66c8b0a6) | |
| parent | [5dd838be69e4c217cce2bfd40b41290256ee721a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5dd838be69e4c217cce2bfd40b41290256ee721a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9533dbfac0ff7edd77a5fa2c24974b1d66c8b0a6&id2=5dd838be69e4c217cce2bfd40b41290256ee721a)) | |
| download | [linux-9533dbfac0ff7edd77a5fa2c24974b1d66c8b0a6.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-9533dbfac0ff7edd77a5fa2c24974b1d66c8b0a6.tar.gz) | |

can: bcm: Fix UAF in bcm\_proc\_show()commit 55c3b96074f3f9b0aee19bf93cd71af7516582bb upstream.
BUG: KASAN: slab-use-after-free in bcm\_proc\_show+0x969/0xa80
Read of size 8 at addr ffff888155846230 by task cat/7862
CPU: 1 PID: 7862 Comm: cat Not tainted 6.5.0-rc1-00153-gc8746099c197 #230
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
Call Trace:
<TASK>
dump\_stack\_lvl+0xd5/0x150
print\_report+0xc1/0x5e0
kasan\_report+0xba/0xf0
bcm\_proc\_show+0x969/0xa80
seq\_read\_iter+0x4f6/0x1260
seq\_read+0x165/0x210
proc\_reg\_read+0x227/0x300
vfs\_read+0x1d5/0x8d0
ksys\_read+0x11e/0x240
do\_syscall\_64+0x35/0xb0
entry\_SYSCALL\_64\_after\_hwframe+0x63/0xcd
Allocated by task 7846:
kasan\_save\_stack+0x1e/0x40
kasan\_set\_track+0x21/0x30
\_\_kasan\_kmalloc+0x9e/0xa0
bcm\_sendmsg+0x264b/0x44e0
sock\_sendmsg+0xda/0x180
\_\_\_\_sys\_sendmsg+0x735/0x920
\_\_\_sys\_sendmsg+0x11d/0x1b0
\_\_sys\_sendmsg+0xfa/0x1d0
do\_syscall\_64+0x35/0xb0
entry\_SYSCALL\_64\_after\_hwframe+0x63/0xcd
Freed by task 7846:
kasan\_save\_stack+0x1e/0x40
kasan\_set\_track+0x21/0x30
kasan\_save\_free\_info+0x27/0x40
\_\_\_\_kasan\_slab\_free+0x161/0x1c0
slab\_free\_freelist\_hook+0x119/0x220
\_\_kmem\_cache\_free+0xb4/0x2e0
rcu\_core+0x809/0x1bd0
bcm\_op is freed before procfs entry be removed in bcm\_release(),
this lead to bcm\_proc\_show() may read the freed bcm\_op.
Fixes: ffd980f976e7 ("[CAN]: Add broadcast manager (bcm) protocol")
Signed-off-by: YueHaibing <yuehaibing@huawei.com>
Reviewed-by: Oliver Hartkopp <socketcan@hartkopp.net>
Acked-by: Oliver Hartkopp <socketcan@hartkopp.net>
Link: [https://lore.kernel.org/all/20230715092543.15548-1-yuehaibing@huawei.com](https://lore.kernel.org/all/20230715092543.15548-1-yuehaibing%40huawei.com)
Cc: stable@vger.kernel.org
Signed-off-by: Marc Kleine-Budde <mkl@pengutronix.de>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9533dbfac0ff7edd77a5fa2c24974b1d66c8b0a6)

| -rw-r--r-- | [net/can/bcm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/can/bcm.c?id=9533dbfac0ff7edd77a5fa2c24974b1d66c8b0a6) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 6 deletions

| diff --git a/net/can/bcm.c b/net/can/bcm.cindex 23c7d5f896bd2e..5cb4b6129263c5 100644--- a/[net/can/bcm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/can/bcm.c?id=5dd838be69e4c217cce2bfd40b41290256ee721a)+++ b/[net/can/bcm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/can/bcm.c?id=9533dbfac0ff7edd77a5fa2c24974b1d66c8b0a6)@@ -1523,6 +1523,12 @@ static int bcm\_release(struct socket \*sock)  lock\_sock(sk); +#if IS\_ENABLED(CONFIG\_PROC\_FS)+ /\* remove procfs entry \*/+ if (net->can.bcmproc\_dir && bo->bcm\_proc\_read)+ remove\_proc\_entry(bo->procname, net->can.bcmproc\_dir);+#endif /\* CONFIG\_PROC\_FS \*/+ list\_for\_each\_entry\_safe(op, next, &bo->tx\_ops, list) bcm\_remove\_op(op); @@ -1558,12 +1564,6 @@ static int bcm\_release(struct socket \*sock) list\_for\_each\_entry\_safe(op, next, &bo->rx\_ops, list) bcm\_remove\_op(op); -#if IS\_ENABLED(CONFIG\_PROC\_FS)- /\* remove procfs entry \*/- if (net->can.bcmproc\_dir && bo->bcm\_proc\_read)- remove\_proc\_entry(bo->procname, net->can.bcmproc\_dir);-#endif /\* CONFIG\_PROC\_FS \*/- /\* remove device reference \*/ if (bo->bound) { bo->bound = 0; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 10:02:22 +0000



=== Content from git.kernel.org_69c2a30a_20250115_100346.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=9b58d36d0c1ea29a9571e0222a9c29df0ccfb7ff)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9b58d36d0c1ea29a9571e0222a9c29df0ccfb7ff)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9b58d36d0c1ea29a9571e0222a9c29df0ccfb7ff)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9b58d36d0c1ea29a9571e0222a9c29df0ccfb7ff)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | YueHaibing <yuehaibing@huawei.com> | 2023-07-15 17:25:43 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-08-11 11:45:24 +0200 |
| commit | [9b58d36d0c1ea29a9571e0222a9c29df0ccfb7ff](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9b58d36d0c1ea29a9571e0222a9c29df0ccfb7ff) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=9b58d36d0c1ea29a9571e0222a9c29df0ccfb7ff)) | |
| tree | [10fb2932896f81fb26dc0c963041590e45ab6268](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9b58d36d0c1ea29a9571e0222a9c29df0ccfb7ff) | |
| parent | [00260209e140aae7f1a274b27e29fa6b4e986f95](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=00260209e140aae7f1a274b27e29fa6b4e986f95) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9b58d36d0c1ea29a9571e0222a9c29df0ccfb7ff&id2=00260209e140aae7f1a274b27e29fa6b4e986f95)) | |
| download | [linux-9b58d36d0c1ea29a9571e0222a9c29df0ccfb7ff.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-9b58d36d0c1ea29a9571e0222a9c29df0ccfb7ff.tar.gz) | |

can: bcm: Fix UAF in bcm\_proc\_show()commit 55c3b96074f3f9b0aee19bf93cd71af7516582bb upstream.
BUG: KASAN: slab-use-after-free in bcm\_proc\_show+0x969/0xa80
Read of size 8 at addr ffff888155846230 by task cat/7862
CPU: 1 PID: 7862 Comm: cat Not tainted 6.5.0-rc1-00153-gc8746099c197 #230
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
Call Trace:
<TASK>
dump\_stack\_lvl+0xd5/0x150
print\_report+0xc1/0x5e0
kasan\_report+0xba/0xf0
bcm\_proc\_show+0x969/0xa80
seq\_read\_iter+0x4f6/0x1260
seq\_read+0x165/0x210
proc\_reg\_read+0x227/0x300
vfs\_read+0x1d5/0x8d0
ksys\_read+0x11e/0x240
do\_syscall\_64+0x35/0xb0
entry\_SYSCALL\_64\_after\_hwframe+0x63/0xcd
Allocated by task 7846:
kasan\_save\_stack+0x1e/0x40
kasan\_set\_track+0x21/0x30
\_\_kasan\_kmalloc+0x9e/0xa0
bcm\_sendmsg+0x264b/0x44e0
sock\_sendmsg+0xda/0x180
\_\_\_\_sys\_sendmsg+0x735/0x920
\_\_\_sys\_sendmsg+0x11d/0x1b0
\_\_sys\_sendmsg+0xfa/0x1d0
do\_syscall\_64+0x35/0xb0
entry\_SYSCALL\_64\_after\_hwframe+0x63/0xcd
Freed by task 7846:
kasan\_save\_stack+0x1e/0x40
kasan\_set\_track+0x21/0x30
kasan\_save\_free\_info+0x27/0x40
\_\_\_\_kasan\_slab\_free+0x161/0x1c0
slab\_free\_freelist\_hook+0x119/0x220
\_\_kmem\_cache\_free+0xb4/0x2e0
rcu\_core+0x809/0x1bd0
bcm\_op is freed before procfs entry be removed in bcm\_release(),
this lead to bcm\_proc\_show() may read the freed bcm\_op.
Fixes: ffd980f976e7 ("[CAN]: Add broadcast manager (bcm) protocol")
Signed-off-by: YueHaibing <yuehaibing@huawei.com>
Reviewed-by: Oliver Hartkopp <socketcan@hartkopp.net>
Acked-by: Oliver Hartkopp <socketcan@hartkopp.net>
Link: [https://lore.kernel.org/all/20230715092543.15548-1-yuehaibing@huawei.com](https://lore.kernel.org/all/20230715092543.15548-1-yuehaibing%40huawei.com)
Cc: stable@vger.kernel.org
Signed-off-by: Marc Kleine-Budde <mkl@pengutronix.de>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9b58d36d0c1ea29a9571e0222a9c29df0ccfb7ff)

| -rw-r--r-- | [net/can/bcm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/can/bcm.c?id=9b58d36d0c1ea29a9571e0222a9c29df0ccfb7ff) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 6 deletions

| diff --git a/net/can/bcm.c b/net/can/bcm.cindex 61269cc2fa8283..1c9953c68f095c 100644--- a/[net/can/bcm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/can/bcm.c?id=00260209e140aae7f1a274b27e29fa6b4e986f95)+++ b/[net/can/bcm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/can/bcm.c?id=9b58d36d0c1ea29a9571e0222a9c29df0ccfb7ff)@@ -1520,6 +1520,12 @@ static int bcm\_release(struct socket \*sock)  lock\_sock(sk); +#if IS\_ENABLED(CONFIG\_PROC\_FS)+ /\* remove procfs entry \*/+ if (net->can.bcmproc\_dir && bo->bcm\_proc\_read)+ remove\_proc\_entry(bo->procname, net->can.bcmproc\_dir);+#endif /\* CONFIG\_PROC\_FS \*/+ list\_for\_each\_entry\_safe(op, next, &bo->tx\_ops, list) bcm\_remove\_op(op); @@ -1555,12 +1561,6 @@ static int bcm\_release(struct socket \*sock) list\_for\_each\_entry\_safe(op, next, &bo->rx\_ops, list) bcm\_remove\_op(op); -#if IS\_ENABLED(CONFIG\_PROC\_FS)- /\* remove procfs entry \*/- if (net->can.bcmproc\_dir && bo->bcm\_proc\_read)- remove\_proc\_entry(bo->procname, net->can.bcmproc\_dir);-#endif /\* CONFIG\_PROC\_FS \*/- /\* remove device reference \*/ if (bo->bound) { bo->bound = 0; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 10:02:23 +0000



=== Content from git.kernel.org_a8935e67_20250115_100341.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=11b8e27ed448baa385d90154a141466bd5e92f18)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=11b8e27ed448baa385d90154a141466bd5e92f18)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=11b8e27ed448baa385d90154a141466bd5e92f18)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=11b8e27ed448baa385d90154a141466bd5e92f18)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | YueHaibing <yuehaibing@huawei.com> | 2023-07-15 17:25:43 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-08-11 11:33:47 +0200 |
| commit | [11b8e27ed448baa385d90154a141466bd5e92f18](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=11b8e27ed448baa385d90154a141466bd5e92f18) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=11b8e27ed448baa385d90154a141466bd5e92f18)) | |
| tree | [49b0201b4c35bfd28cfdeb6967b8fc5479d32882](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=11b8e27ed448baa385d90154a141466bd5e92f18) | |
| parent | [5f2b320834a2efa56c46a4c07543b93644a92d0e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5f2b320834a2efa56c46a4c07543b93644a92d0e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=11b8e27ed448baa385d90154a141466bd5e92f18&id2=5f2b320834a2efa56c46a4c07543b93644a92d0e)) | |
| download | [linux-11b8e27ed448baa385d90154a141466bd5e92f18.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-11b8e27ed448baa385d90154a141466bd5e92f18.tar.gz) | |

can: bcm: Fix UAF in bcm\_proc\_show()commit 55c3b96074f3f9b0aee19bf93cd71af7516582bb upstream.
BUG: KASAN: slab-use-after-free in bcm\_proc\_show+0x969/0xa80
Read of size 8 at addr ffff888155846230 by task cat/7862
CPU: 1 PID: 7862 Comm: cat Not tainted 6.5.0-rc1-00153-gc8746099c197 #230
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
Call Trace:
<TASK>
dump\_stack\_lvl+0xd5/0x150
print\_report+0xc1/0x5e0
kasan\_report+0xba/0xf0
bcm\_proc\_show+0x969/0xa80
seq\_read\_iter+0x4f6/0x1260
seq\_read+0x165/0x210
proc\_reg\_read+0x227/0x300
vfs\_read+0x1d5/0x8d0
ksys\_read+0x11e/0x240
do\_syscall\_64+0x35/0xb0
entry\_SYSCALL\_64\_after\_hwframe+0x63/0xcd
Allocated by task 7846:
kasan\_save\_stack+0x1e/0x40
kasan\_set\_track+0x21/0x30
\_\_kasan\_kmalloc+0x9e/0xa0
bcm\_sendmsg+0x264b/0x44e0
sock\_sendmsg+0xda/0x180
\_\_\_\_sys\_sendmsg+0x735/0x920
\_\_\_sys\_sendmsg+0x11d/0x1b0
\_\_sys\_sendmsg+0xfa/0x1d0
do\_syscall\_64+0x35/0xb0
entry\_SYSCALL\_64\_after\_hwframe+0x63/0xcd
Freed by task 7846:
kasan\_save\_stack+0x1e/0x40
kasan\_set\_track+0x21/0x30
kasan\_save\_free\_info+0x27/0x40
\_\_\_\_kasan\_slab\_free+0x161/0x1c0
slab\_free\_freelist\_hook+0x119/0x220
\_\_kmem\_cache\_free+0xb4/0x2e0
rcu\_core+0x809/0x1bd0
bcm\_op is freed before procfs entry be removed in bcm\_release(),
this lead to bcm\_proc\_show() may read the freed bcm\_op.
Fixes: ffd980f976e7 ("[CAN]: Add broadcast manager (bcm) protocol")
Signed-off-by: YueHaibing <yuehaibing@huawei.com>
Reviewed-by: Oliver Hartkopp <socketcan@hartkopp.net>
Acked-by: Oliver Hartkopp <socketcan@hartkopp.net>
Link: [https://lore.kernel.org/all/20230715092543.15548-1-yuehaibing@huawei.com](https://lore.kernel.org/all/20230715092543.15548-1-yuehaibing%40huawei.com)
Cc: stable@vger.kernel.org
Signed-off-by: Marc Kleine-Budde <mkl@pengutronix.de>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=11b8e27ed448baa385d90154a141466bd5e92f18)

| -rw-r--r-- | [net/can/bcm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/can/bcm.c?id=11b8e27ed448baa385d90154a141466bd5e92f18) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 6 deletions

| diff --git a/net/can/bcm.c b/net/can/bcm.cindex 32db244ba2c012..0a082726395af3 100644--- a/[net/can/bcm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/can/bcm.c?id=5f2b320834a2efa56c46a4c07543b93644a92d0e)+++ b/[net/can/bcm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/can/bcm.c?id=11b8e27ed448baa385d90154a141466bd5e92f18)@@ -1572,6 +1572,12 @@ static int bcm\_release(struct socket \*sock)  lock\_sock(sk); +#if IS\_ENABLED(CONFIG\_PROC\_FS)+ /\* remove procfs entry \*/+ if (net->can.bcmproc\_dir && bo->bcm\_proc\_read)+ remove\_proc\_entry(bo->procname, net->can.bcmproc\_dir);+#endif /\* CONFIG\_PROC\_FS \*/+ list\_for\_each\_entry\_safe(op, next, &bo->tx\_ops, list) bcm\_remove\_op(op); @@ -1607,12 +1613,6 @@ static int bcm\_release(struct socket \*sock) list\_for\_each\_entry\_safe(op, next, &bo->rx\_ops, list) bcm\_remove\_op(op); -#if IS\_ENABLED(CONFIG\_PROC\_FS)- /\* remove procfs entry \*/- if (net->can.bcmproc\_dir && bo->bcm\_proc\_read)- remove\_proc\_entry(bo->procname, net->can.bcmproc\_dir);-#endif /\* CONFIG\_PROC\_FS \*/- /\* remove device reference \*/ if (bo->bound) { bo->bound = 0; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 10:02:18 +0000



=== Content from git.kernel.org_49709b17_20250115_100344.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=55c3b96074f3f9b0aee19bf93cd71af7516582bb)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=55c3b96074f3f9b0aee19bf93cd71af7516582bb)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=55c3b96074f3f9b0aee19bf93cd71af7516582bb)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=55c3b96074f3f9b0aee19bf93cd71af7516582bb)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | YueHaibing <yuehaibing@huawei.com> | 2023-07-15 17:25:43 +0800 |
| --- | --- | --- |
| committer | Marc Kleine-Budde <mkl@pengutronix.de> | 2023-07-17 09:46:26 +0200 |
| commit | [55c3b96074f3f9b0aee19bf93cd71af7516582bb](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=55c3b96074f3f9b0aee19bf93cd71af7516582bb) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=55c3b96074f3f9b0aee19bf93cd71af7516582bb)) | |
| tree | [e9a1cecd0f980f79e85d0754ed3925268f780209](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=55c3b96074f3f9b0aee19bf93cd71af7516582bb) | |
| parent | [ee8b94c8510ce64afe0b87ef548d23e00915fb10](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ee8b94c8510ce64afe0b87ef548d23e00915fb10) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=55c3b96074f3f9b0aee19bf93cd71af7516582bb&id2=ee8b94c8510ce64afe0b87ef548d23e00915fb10)) | |
| download | [linux-55c3b96074f3f9b0aee19bf93cd71af7516582bb.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-55c3b96074f3f9b0aee19bf93cd71af7516582bb.tar.gz) | |

can: bcm: Fix UAF in bcm\_proc\_show()BUG: KASAN: slab-use-after-free in bcm\_proc\_show+0x969/0xa80
Read of size 8 at addr ffff888155846230 by task cat/7862
CPU: 1 PID: 7862 Comm: cat Not tainted 6.5.0-rc1-00153-gc8746099c197 #230
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
Call Trace:
<TASK>
dump\_stack\_lvl+0xd5/0x150
print\_report+0xc1/0x5e0
kasan\_report+0xba/0xf0
bcm\_proc\_show+0x969/0xa80
seq\_read\_iter+0x4f6/0x1260
seq\_read+0x165/0x210
proc\_reg\_read+0x227/0x300
vfs\_read+0x1d5/0x8d0
ksys\_read+0x11e/0x240
do\_syscall\_64+0x35/0xb0
entry\_SYSCALL\_64\_after\_hwframe+0x63/0xcd
Allocated by task 7846:
kasan\_save\_stack+0x1e/0x40
kasan\_set\_track+0x21/0x30
\_\_kasan\_kmalloc+0x9e/0xa0
bcm\_sendmsg+0x264b/0x44e0
sock\_sendmsg+0xda/0x180
\_\_\_\_sys\_sendmsg+0x735/0x920
\_\_\_sys\_sendmsg+0x11d/0x1b0
\_\_sys\_sendmsg+0xfa/0x1d0
do\_syscall\_64+0x35/0xb0
entry\_SYSCALL\_64\_after\_hwframe+0x63/0xcd
Freed by task 7846:
kasan\_save\_stack+0x1e/0x40
kasan\_set\_track+0x21/0x30
kasan\_save\_free\_info+0x27/0x40
\_\_\_\_kasan\_slab\_free+0x161/0x1c0
slab\_free\_freelist\_hook+0x119/0x220
\_\_kmem\_cache\_free+0xb4/0x2e0
rcu\_core+0x809/0x1bd0
bcm\_op is freed before procfs entry be removed in bcm\_release(),
this lead to bcm\_proc\_show() may read the freed bcm\_op.
Fixes: ffd980f976e7 ("[CAN]: Add broadcast manager (bcm) protocol")
Signed-off-by: YueHaibing <yuehaibing@huawei.com>
Reviewed-by: Oliver Hartkopp <socketcan@hartkopp.net>
Acked-by: Oliver Hartkopp <socketcan@hartkopp.net>
Link: [https://lore.kernel.org/all/20230715092543.15548-1-yuehaibing@huawei.com](https://lore.kernel.org/all/20230715092543.15548-1-yuehaibing%40huawei.com)
Cc: stable@vger.kernel.org
Signed-off-by: Marc Kleine-Budde <mkl@pengutronix.de>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=55c3b96074f3f9b0aee19bf93cd71af7516582bb)

| -rw-r--r-- | [net/can/bcm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/can/bcm.c?id=55c3b96074f3f9b0aee19bf93cd71af7516582bb) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 6 deletions

| diff --git a/net/can/bcm.c b/net/can/bcm.cindex 9ba35685b04305..9168114fc87f7b 100644--- a/[net/can/bcm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/can/bcm.c?id=ee8b94c8510ce64afe0b87ef548d23e00915fb10)+++ b/[net/can/bcm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/can/bcm.c?id=55c3b96074f3f9b0aee19bf93cd71af7516582bb)@@ -1526,6 +1526,12 @@ static int bcm\_release(struct socket \*sock)  lock\_sock(sk); +#if IS\_ENABLED(CONFIG\_PROC\_FS)+ /\* remove procfs entry \*/+ if (net->can.bcmproc\_dir && bo->bcm\_proc\_read)+ remove\_proc\_entry(bo->procname, net->can.bcmproc\_dir);+#endif /\* CONFIG\_PROC\_FS \*/+ list\_for\_each\_entry\_safe(op, next, &bo->tx\_ops, list) bcm\_remove\_op(op); @@ -1561,12 +1567,6 @@ static int bcm\_release(struct socket \*sock) list\_for\_each\_entry\_safe(op, next, &bo->rx\_ops, list) bcm\_remove\_op(op); -#if IS\_ENABLED(CONFIG\_PROC\_FS)- /\* remove procfs entry \*/- if (net->can.bcmproc\_dir && bo->bcm\_proc\_read)- remove\_proc\_entry(bo->procname, net->can.bcmproc\_dir);-#endif /\* CONFIG\_PROC\_FS \*/- /\* remove device reference \*/ if (bo->bound) { bo->bound = 0; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 10:02:21 +0000



=== Content from git.kernel.org_2a6eda51_20250115_100345.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=995f47d76647708ec26c6e388663ad4f3f264787)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=995f47d76647708ec26c6e388663ad4f3f264787)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=995f47d76647708ec26c6e388663ad4f3f264787)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=995f47d76647708ec26c6e388663ad4f3f264787)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | YueHaibing <yuehaibing@huawei.com> | 2023-07-15 17:25:43 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-07-27 08:50:27 +0200 |
| commit | [995f47d76647708ec26c6e388663ad4f3f264787](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=995f47d76647708ec26c6e388663ad4f3f264787) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=995f47d76647708ec26c6e388663ad4f3f264787)) | |
| tree | [b0787971fff307c6a7847810bf7e7314b3ee5646](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=995f47d76647708ec26c6e388663ad4f3f264787) | |
| parent | [a2d31762d73b7f65118a6b94074403070a870951](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a2d31762d73b7f65118a6b94074403070a870951) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=995f47d76647708ec26c6e388663ad4f3f264787&id2=a2d31762d73b7f65118a6b94074403070a870951)) | |
| download | [linux-995f47d76647708ec26c6e388663ad4f3f264787.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-995f47d76647708ec26c6e388663ad4f3f264787.tar.gz) | |

can: bcm: Fix UAF in bcm\_proc\_show()commit 55c3b96074f3f9b0aee19bf93cd71af7516582bb upstream.
BUG: KASAN: slab-use-after-free in bcm\_proc\_show+0x969/0xa80
Read of size 8 at addr ffff888155846230 by task cat/7862
CPU: 1 PID: 7862 Comm: cat Not tainted 6.5.0-rc1-00153-gc8746099c197 #230
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
Call Trace:
<TASK>
dump\_stack\_lvl+0xd5/0x150
print\_report+0xc1/0x5e0
kasan\_report+0xba/0xf0
bcm\_proc\_show+0x969/0xa80
seq\_read\_iter+0x4f6/0x1260
seq\_read+0x165/0x210
proc\_reg\_read+0x227/0x300
vfs\_read+0x1d5/0x8d0
ksys\_read+0x11e/0x240
do\_syscall\_64+0x35/0xb0
entry\_SYSCALL\_64\_after\_hwframe+0x63/0xcd
Allocated by task 7846:
kasan\_save\_stack+0x1e/0x40
kasan\_set\_track+0x21/0x30
\_\_kasan\_kmalloc+0x9e/0xa0
bcm\_sendmsg+0x264b/0x44e0
sock\_sendmsg+0xda/0x180
\_\_\_\_sys\_sendmsg+0x735/0x920
\_\_\_sys\_sendmsg+0x11d/0x1b0
\_\_sys\_sendmsg+0xfa/0x1d0
do\_syscall\_64+0x35/0xb0
entry\_SYSCALL\_64\_after\_hwframe+0x63/0xcd
Freed by task 7846:
kasan\_save\_stack+0x1e/0x40
kasan\_set\_track+0x21/0x30
kasan\_save\_free\_info+0x27/0x40
\_\_\_\_kasan\_slab\_free+0x161/0x1c0
slab\_free\_freelist\_hook+0x119/0x220
\_\_kmem\_cache\_free+0xb4/0x2e0
rcu\_core+0x809/0x1bd0
bcm\_op is freed before procfs entry be removed in bcm\_release(),
this lead to bcm\_proc\_show() may read the freed bcm\_op.
Fixes: ffd980f976e7 ("[CAN]: Add broadcast manager (bcm) protocol")
Signed-off-by: YueHaibing <yuehaibing@huawei.com>
Reviewed-by: Oliver Hartkopp <socketcan@hartkopp.net>
Acked-by: Oliver Hartkopp <socketcan@hartkopp.net>
Link: [https://lore.kernel.org/all/20230715092543.15548-1-yuehaibing@huawei.com](https://lore.kernel.org/all/20230715092543.15548-1-yuehaibing%40huawei.com)
Cc: stable@vger.kernel.org
Signed-off-by: Marc Kleine-Budde <mkl@pengutronix.de>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=995f47d76647708ec26c6e388663ad4f3f264787)

| -rw-r--r-- | [net/can/bcm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/can/bcm.c?id=995f47d76647708ec26c6e388663ad4f3f264787) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 6 deletions

| diff --git a/net/can/bcm.c b/net/can/bcm.cindex a962ec2b8ba5b3..925d48cc50f812 100644--- a/[net/can/bcm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/can/bcm.c?id=a2d31762d73b7f65118a6b94074403070a870951)+++ b/[net/can/bcm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/can/bcm.c?id=995f47d76647708ec26c6e388663ad4f3f264787)@@ -1526,6 +1526,12 @@ static int bcm\_release(struct socket \*sock)  lock\_sock(sk); +#if IS\_ENABLED(CONFIG\_PROC\_FS)+ /\* remove procfs entry \*/+ if (net->can.bcmproc\_dir && bo->bcm\_proc\_read)+ remove\_proc\_entry(bo->procname, net->can.bcmproc\_dir);+#endif /\* CONFIG\_PROC\_FS \*/+ list\_for\_each\_entry\_safe(op, next, &bo->tx\_ops, list) bcm\_remove\_op(op); @@ -1561,12 +1567,6 @@ static int bcm\_release(struct socket \*sock) list\_for\_each\_entry\_safe(op, next, &bo->rx\_ops, list) bcm\_remove\_op(op); -#if IS\_ENABLED(CONFIG\_PROC\_FS)- /\* remove procfs entry \*/- if (net->can.bcmproc\_dir && bo->bcm\_proc\_read)- remove\_proc\_entry(bo->procname, net->can.bcmproc\_dir);-#endif /\* CONFIG\_PROC\_FS \*/- /\* remove device reference \*/ if (bo->bound) { bo->bound = 0; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 10:02:22 +0000



=== Content from git.kernel.org_3a0bcb85_20250115_100342.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=3c3941bb1eb53abe7d640ffee5c4d6b559829ab3)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3c3941bb1eb53abe7d640ffee5c4d6b559829ab3)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3c3941bb1eb53abe7d640ffee5c4d6b559829ab3)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3c3941bb1eb53abe7d640ffee5c4d6b559829ab3)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | YueHaibing <yuehaibing@huawei.com> | 2023-07-15 17:25:43 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-07-27 08:46:55 +0200 |
| commit | [3c3941bb1eb53abe7d640ffee5c4d6b559829ab3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3c3941bb1eb53abe7d640ffee5c4d6b559829ab3) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=3c3941bb1eb53abe7d640ffee5c4d6b559829ab3)) | |
| tree | [9cba331972a476d47cc0900957d66f6c9fced80c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3c3941bb1eb53abe7d640ffee5c4d6b559829ab3) | |
| parent | [14845378763697bd5097e155e4a4fe4e17a7df00](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=14845378763697bd5097e155e4a4fe4e17a7df00) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3c3941bb1eb53abe7d640ffee5c4d6b559829ab3&id2=14845378763697bd5097e155e4a4fe4e17a7df00)) | |
| download | [linux-3c3941bb1eb53abe7d640ffee5c4d6b559829ab3.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-3c3941bb1eb53abe7d640ffee5c4d6b559829ab3.tar.gz) | |

can: bcm: Fix UAF in bcm\_proc\_show()commit 55c3b96074f3f9b0aee19bf93cd71af7516582bb upstream.
BUG: KASAN: slab-use-after-free in bcm\_proc\_show+0x969/0xa80
Read of size 8 at addr ffff888155846230 by task cat/7862
CPU: 1 PID: 7862 Comm: cat Not tainted 6.5.0-rc1-00153-gc8746099c197 #230
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
Call Trace:
<TASK>
dump\_stack\_lvl+0xd5/0x150
print\_report+0xc1/0x5e0
kasan\_report+0xba/0xf0
bcm\_proc\_show+0x969/0xa80
seq\_read\_iter+0x4f6/0x1260
seq\_read+0x165/0x210
proc\_reg\_read+0x227/0x300
vfs\_read+0x1d5/0x8d0
ksys\_read+0x11e/0x240
do\_syscall\_64+0x35/0xb0
entry\_SYSCALL\_64\_after\_hwframe+0x63/0xcd
Allocated by task 7846:
kasan\_save\_stack+0x1e/0x40
kasan\_set\_track+0x21/0x30
\_\_kasan\_kmalloc+0x9e/0xa0
bcm\_sendmsg+0x264b/0x44e0
sock\_sendmsg+0xda/0x180
\_\_\_\_sys\_sendmsg+0x735/0x920
\_\_\_sys\_sendmsg+0x11d/0x1b0
\_\_sys\_sendmsg+0xfa/0x1d0
do\_syscall\_64+0x35/0xb0
entry\_SYSCALL\_64\_after\_hwframe+0x63/0xcd
Freed by task 7846:
kasan\_save\_stack+0x1e/0x40
kasan\_set\_track+0x21/0x30
kasan\_save\_free\_info+0x27/0x40
\_\_\_\_kasan\_slab\_free+0x161/0x1c0
slab\_free\_freelist\_hook+0x119/0x220
\_\_kmem\_cache\_free+0xb4/0x2e0
rcu\_core+0x809/0x1bd0
bcm\_op is freed before procfs entry be removed in bcm\_release(),
this lead to bcm\_proc\_show() may read the freed bcm\_op.
Fixes: ffd980f976e7 ("[CAN]: Add broadcast manager (bcm) protocol")
Signed-off-by: YueHaibing <yuehaibing@huawei.com>
Reviewed-by: Oliver Hartkopp <socketcan@hartkopp.net>
Acked-by: Oliver Hartkopp <socketcan@hartkopp.net>
Link: [https://lore.kernel.org/all/20230715092543.15548-1-yuehaibing@huawei.com](https://lore.kernel.org/all/20230715092543.15548-1-yuehaibing%40huawei.com)
Cc: stable@vger.kernel.org
Signed-off-by: Marc Kleine-Budde <mkl@pengutronix.de>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3c3941bb1eb53abe7d640ffee5c4d6b559829ab3)

| -rw-r--r-- | [net/can/bcm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/can/bcm.c?id=3c3941bb1eb53abe7d640ffee5c4d6b559829ab3) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 6 deletions

| diff --git a/net/can/bcm.c b/net/can/bcm.cindex 5727a073189b24..a2fd68d1149b16 100644--- a/[net/can/bcm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/can/bcm.c?id=14845378763697bd5097e155e4a4fe4e17a7df00)+++ b/[net/can/bcm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/can/bcm.c?id=3c3941bb1eb53abe7d640ffee5c4d6b559829ab3)@@ -1521,6 +1521,12 @@ static int bcm\_release(struct socket \*sock)  lock\_sock(sk); +#if IS\_ENABLED(CONFIG\_PROC\_FS)+ /\* remove procfs entry \*/+ if (net->can.bcmproc\_dir && bo->bcm\_proc\_read)+ remove\_proc\_entry(bo->procname, net->can.bcmproc\_dir);+#endif /\* CONFIG\_PROC\_FS \*/+ list\_for\_each\_entry\_safe(op, next, &bo->tx\_ops, list) bcm\_remove\_op(op); @@ -1556,12 +1562,6 @@ static int bcm\_release(struct socket \*sock) list\_for\_each\_entry\_safe(op, next, &bo->rx\_ops, list) bcm\_remove\_op(op); -#if IS\_ENABLED(CONFIG\_PROC\_FS)- /\* remove procfs entry \*/- if (net->can.bcmproc\_dir && bo->bcm\_proc\_read)- remove\_proc\_entry(bo->procname, net->can.bcmproc\_dir);-#endif /\* CONFIG\_PROC\_FS \*/- /\* remove device reference \*/ if (bo->bound) { bo->bound = 0; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 10:02:19 +0000


