=== Content from bugs.chromium.org_e4b3fa8a_20250119_131047.html ===



=== Content from www.gerritcodereview.com_5ed05b7e_20250119_111534.html ===


Toggle navigation

[Gerrit Code Review](/index.html)

* [About](/about.html)
* [News](/news.html)
* [Support](/support.html)

* Community
  + [Code of Conduct](/codeofconduct.html)
  + [Forums, Mailing lists etc.](/contact.html)
  + [Members](/members.html)
  + [Contributing](/contributing.html)
  + [Fixing a bug](/bug-fixing.html)
  + [Presentations](/presentations.html)
  + [Kudos](/kudos.html)
  + [User Stories](/userStories.html)
  + [Trademarks](/trademarks.html)
* Code
  + [Source](https://gerrit.googlesource.com/gerrit/)
  + [Releases](/releases-readme.html)
  + [Plugins](/plugins.html)
  + [Roadmap](/roadmap.html)
  + [Builds](https://gerrit-ci.gerritforge.com/)
  + [Reviews](https://gerrit-review.googlesource.com/q/status%3Aopen%2Bproject%3Agerrit)
* Docs
  + [Latest](https://gerrit-documentation.storage.googleapis.com/Documentation/3.11.1/index.html)
  + [Designs](/design-docs-index.html)
  + [Wiki](https://gerrit.googlesource.com/homepage/%2B/master/pages/site/docs/)
* Feedback

# Gerrit 3.1.x

Download: **[3.1.16](https://gerrit-releases.storage.googleapis.com/gerrit-3.1.16.war)**
| [3.1.15](https://gerrit-releases.storage.googleapis.com/gerrit-3.1.15.war)
| [3.1.14](https://gerrit-releases.storage.googleapis.com/gerrit-3.1.14.war)
| [3.1.13](https://gerrit-releases.storage.googleapis.com/gerrit-3.1.13.war)
| [3.1.12](https://gerrit-releases.storage.googleapis.com/gerrit-3.1.12.war)
| [3.1.11](https://gerrit-releases.storage.googleapis.com/gerrit-3.1.11.war)
| [3.1.10](https://gerrit-releases.storage.googleapis.com/gerrit-3.1.10.war)
| [3.1.8](https://gerrit-releases.storage.googleapis.com/gerrit-3.1.8.war)
| [3.1.7](https://gerrit-releases.storage.googleapis.com/gerrit-3.1.7.war)
| [3.1.6](https://gerrit-releases.storage.googleapis.com/gerrit-3.1.6.war)
| [3.1.5](https://gerrit-releases.storage.googleapis.com/gerrit-3.1.5.war)
| [3.1.4](https://gerrit-releases.storage.googleapis.com/gerrit-3.1.4.war)
| [3.1.3](https://gerrit-releases.storage.googleapis.com/gerrit-3.1.3.war)
| [3.1.2](https://gerrit-releases.storage.googleapis.com/gerrit-3.1.2.war)
| [3.1.1](https://gerrit-releases.storage.googleapis.com/gerrit-3.1.1.war)
| [3.1.0](https://gerrit-releases.storage.googleapis.com/gerrit-3.1.0.war)

Documentation: **[3.1.16](https://gerrit-documentation.storage.googleapis.com/Documentation/3.1.16/index.html)**
| [3.1.15](https://gerrit-documentation.storage.googleapis.com/Documentation/3.1.15/index.html)
| [3.1.14](https://gerrit-documentation.storage.googleapis.com/Documentation/3.1.14/index.html)
| [3.1.13](https://gerrit-documentation.storage.googleapis.com/Documentation/3.1.13/index.html)
| [3.1.12](https://gerrit-documentation.storage.googleapis.com/Documentation/3.1.12/index.html)
| [3.1.11](https://gerrit-documentation.storage.googleapis.com/Documentation/3.1.11/index.html)
| [3.1.10](https://gerrit-documentation.storage.googleapis.com/Documentation/3.1.10/index.html)
| [3.1.8](https://gerrit-documentation.storage.googleapis.com/Documentation/3.1.8/index.html)
| [3.1.7](https://gerrit-documentation.storage.googleapis.com/Documentation/3.1.7/index.html)
| [3.1.6](https://gerrit-documentation.storage.googleapis.com/Documentation/3.1.6/index.html)
| [3.1.5](https://gerrit-documentation.storage.googleapis.com/Documentation/3.1.5/index.html)
| [3.1.4](https://gerrit-documentation.storage.googleapis.com/Documentation/3.1.4/index.html)
| [3.1.3](https://gerrit-documentation.storage.googleapis.com/Documentation/3.1.3/index.html)
| [3.1.2](https://gerrit-documentation.storage.googleapis.com/Documentation/3.1.2/index.html)
| [3.1.1](https://gerrit-documentation.storage.googleapis.com/Documentation/3.1.1/index.html)
| [3.1.0](https://gerrit-documentation.storage.googleapis.com/Documentation/3.1.0/index.html)

## Release Highlights

* Support for git protocol v2
* Polymer 2
* Mandatory plugins
* Performance logging and tracing

See the [New Features](#new-features) section for further details.

## Important Notes

### Schema Changes

This release does not contain any schema changes. To upgrade:

```
  java -jar gerrit.war init -d site_path

```

The accounts, changes and groups index versions have been increased. To run
off-line reindexing (optional):

```
  java -jar gerrit.war reindex -d site_path

```

By default indexes are automatically rebuilt upon the Gerrit startup after the
upgrade.

### Breaking Changes

#### The `reviewdb.client` package is renamed to `entities`

Plugins or extensions that import classes from the `com.google.gerrit.reviewdb.client`
package must change the imports to `com.google.gerrit.entities`.

#### Changed APIs for `Id` and `NameKey` classes

Plugins and extensions that instantiate and use classes such as `Account.Id`,
`Change.Id`, `Project.NameKey`, `Branch.NameKey`, etc, must adapt to the following
changes.

* The classes can no longer be instantiated with the `new` operator. Instead they
  must be created with static factory methods.

  + `new Account.Id(...)` –> `Account.id(...)`
  + `new AccountGroup.Id(...)` –> `AccountGroup.id(...)`
  + `new AccountGroup.UUID(...)` –> `AccountGroup.uuid(...)`
  + `new Branch.NameKey(...)` –> `BranchNameKey.create(...)`
  + `new Project.NameKey(...)` –> `Project.nameKey(...)`
* ‘Getter’ methods are now generated by the auto-value library and no longer have
  the `get` prefix.

  + `Account.getName()` -> `Account.name()`
  + …etc

#### REST API endpoint implementations must return `Response<T>`

REST API endpoint implementations must now return a `Response` object that
explicitly sets a status code. Plugins that currently only return an `Object`
must be adapted to the new interface.

#### Powermock and Easymock are removed

The Powermock and Easymock libraries are no longer exported in the `acceptance-framework`
artifact, and are replaced by Mockito. Plugins that use Powermock and/or Easymock in their
tests should either add explicit dependencies, or migrate the tests to Mockito.

#### Polymer 2 and Shadow DOM may break JavaScript plugins

The Gerrit frontend has been migrated from Polymer 1 to
[Polymer 2](https://polymer-library.polymer-project.org/2.0/docs/upgrade) and to using
[Shadow DOM](https://polymer-library.polymer-project.org/2.0/docs/devguide/shadow-dom).
This may break JavaScript plugins, e.g. if they use `document.getElementById()` to reach
into the DOM. Instead, plugins will have to use dedicated plugin endpoints together
with calling
[`plugin.registerCustomComponent`](https://gerrit-review.googlesource.com/Documentation/js-api.html#self_registerCustomComponent).

#### Browser Support

Internet Explorer is not supported. Major browsers are supported for the following
versions and newer: Firefox 68, Chrome 76, Safari 12.1.

#### Legacy support for pushing to `refs/drafts/` is removed

The `change.allowDrafts` configuration option is removed, and it is no longer
possible to push new changes or patch sets to `refs/drafts/<branch-name>`.

#### Support for pushing to `refs/changes/` is removed

The `receive.allowPushToRefsChanges` configuration option is removed, and it is
no longer possible to add a new patch set to a change by pushing to
`refs/changes/<change number>`.

#### JGit Configuration is no longer read from system level `.gitconfig`

JGit’s configuration options are now read from the `$site/etc/jgit.config`
file rather than the system level `.gitconfig`.

#### New limit on the number of change meta updates

Many NoteDb operations require walking the entire change meta ref and loading
its contents into memory, so changes with arbitrarily many updates may cause
high CPU usage, memory pressure, persistent cache bloat, and other problems.

A new configuration option
[`change.maxUpdates`](http://gerrit-documentation.storage.googleapis.com/Documentation/3.1.0/config-gerrit.html#change.maxUpdates)
allows to set the maximum number of updates that are allowed.

#### `container.slave` is renamed to `container.replica`

The `container.slave` option is still recognized as an alias of `container.replica`
but is deprecated and will be removed in a future release.

#### The `MessageOfTheDay` extension point is removed.

The `MessageOfTheDay` functionality was not ported to the PolyGerrit-UI and
the `MessageOfTheDay` extension point was removed with the 3.1.3 release.
However, the JS API provides the `banner` entrypoint for plugins to add messages
to the UI. Plugins that were previously using the `MessageOfTheDay` extension
point have to be adapted accordingly.

#### The `test.submit_rule` and `test.submit_type` REST APIs now require input

In previous versions of Gerrit it was possible to omit the rule from the input
and the project’s default submit rule would be tested. Now the rule is required,
and the request will fail with ‘400 bad request’ if the rule is not provided.

## New Features

### Git Protocol V2

Git protocol V2 is now enabled by default. A new permission-aware ref database
ensures that Gerrit only ever returns refs that the calling user has access to.

### Mandatory Plugins

It is possible to
[configure which plugins are mandatory](http://gerrit-documentation.storage.googleapis.com/Documentation/3.1.0/config-gerrit.html#plugins.mandatory).
Gerrit will fail to start if a mandatory plugin cannot be loaded.

Disabling and restarting of a mandatory plugin is rejected, but reloading of a
mandatory plugin is still possible.

### Replication plugin

* [Issue 11196](https://bugs.chromium.org/p/gerrit/issues/detail?id=11196):
  Latency metric is now recorded also at a project level, only when
  the latency was greater than a configured threshold, configurable in
  `replication.config`

### New option to limit options used when rendering internal events.

The new option
[`event.payload.listChangeOptions`](http://gerrit-documentation.storage.googleapis.com/Documentation/3.1.0/config-gerrit.html#event.payload.listChangeOptions)
allows to configure which options are used when rendering internal
events. This can be used to reduce performance impact of rendering
many options.

### Performance logging and tracing

See the [documentation](http://gerrit-documentation.storage.googleapis.com/Documentation/3.1.0/config-gerrit.html#tracing)
for full details.

### REST APIs

* Accounts

  + The `DETAILS` query option on the
    [query accounts](http://gerrit-documentation.storage.googleapis.com/Documentation/3.1.0/rest-api-accounts.html#query-account)
    endpoint now includes the `status` and `state` fields in the response.
* Changes

  + New [`SKIP_DIFFSTAT`](http://gerrit-documentation.storage.googleapis.com/Documentation/3.1.0/rest-api-changes.html#skip_diffstat)
    option for the query changes endpoint.

    Computation of the `insertions` and `deletions` fields may be expensive for
    large trees. The new `SKIP_DIFFSTAT` option allows to omit it from the result.
  + New `exclude-groups` option on the
    [Suggest Reviewers](http://gerrit-documentation.storage.googleapis.com/Documentation/3.1.0/rest-api-changes.html#suggest-reviewers)
    endpoint.
  + New optional `commit-message` field on the
    [input for cherry-pick endpoints](http://gerrit-documentation.storage.googleapis.com/Documentation/3.1.0/rest-api-changes.html#cherrypick-input).

    If the optional message is provided, it is used, otherwise the message from
    the cherry-picked change is used.
  + New optional `topic` field on the
    [input for the revert endpoint](http://gerrit-documentation.storage.googleapis.com/Documentation/3.1.0/rest-api-changes.html#revert-input).

    If the optional topic is provided, it is used, otherwise the topic from the
    reverted change is used.
* Config

  + The value of
    [`change.api.excludeMergeableInChangeInfo`](http://gerrit-documentation.storage.googleapis.com/Documentation/3.1.0/config-gerrit.html#change.api.excludeMergeableInChangeInfo)
    is now included in the response from the
    [Get Server Info endpoint](http://gerrit-documentation.storage.googleapis.com/Documentation/3.1.0/rest-api-config.html#get-info).
* Projects

  + New endpoint: [Update dashboard](http://gerrit-documentation.storage.googleapis.com/Documentation/3.1.0/rest-api-projects.html#update-dashboard).

    The new endpoint currently only works for the default dashboard.

## Bug Fixes

* [Issue 5082](https://bugs.chromium.org/p/gerrit/issues/detail?id=5082):
  Fix internal server error when getting blame for removed/replaced file.
* [Issue 11918](https://bugs.chromium.org/p/gerrit/issues/detail?id=11918):
  Fix internal server error when deleting a ref by git push.
* [Issue 12246](https://bugs.chromium.org/p/gerrit/issues/detail?id=12246):
  Fix generation of duplicate `Change-Id`s when creating a new change via REST.

  The `Change-Id` was computed from the commit content and the timestamp,
  which resulted in the possibility for two changes to get the same `Change-Id`
  when two empty changes were created by REST at the same time.

  The `Change-Id` is now generated randomly.

## Dependency Updates

* Remove easymock, powermock and javassist from the acceptance framework
* Remove promise-polyfill
* Add mockito in the acceptance framework
* Upgrade Apache sshd and mina-core to 2.3.0
* Upgrade auto-value to 1.7
* Upgrade bouncycastle to 1.61
* Upgrade commons-compress to 1.18
* Upgrade gitiles-servlet and blame-cache to 0.3-6
* Upgrade jetty to 9.4.18.v20190429
* Upgrade JGit to v5.5.1.201910021850-r-152-g63fc6970c
* Upgrade polymer to 2.7.2

  + Upgrade polymerelements/iron-autogrow-textarea to 2.2.0
  + Upgrade polymerelements/iron-dropdown to 2.2.1
  + Upgrade polymerelements/iron-icon to 2.1.0
  + Upgrade polymerelements/iron-iconset-svg to 2.2.1
  + Upgrade polymerelements/iron-input to 2.1.3
  + Upgrade polymerelements/iron-overlay-behavior to 2.3.4
  + Upgrade polymerelements/iron-selector to 2.1.0
  + Upgrade polymerelements/iron-test-helpers to 2.0.1
  + Upgrade polymerelements/test-fixture to 3.0.0
  + Upgrade polymerelements/paper-button to 2.1.3
  + Upgrade polymerelements/paper-input to 2.2.3
  + Upgrade polymerelements/paper-item to 2.1.1
  + Upgrade polymerelements/paper-listbox to 2.1.1
  + Upgrade polymerelements/paper-tabs to 2.1.1
  + Upgrade polymerelements/paper-toggle-button to 2.1.1
  + Upgrade visionmedia/page.js to 1.11.4
* Upgrade truth to 1.0

## Bugfix Releases

### 3.1.16

* Security Fixes

  + [Issue 14732](https://crbug.com/gerrit/14732):
    Commits/IncludedIn exposes branch names without respecting the ACLs on branches

    When calling the REST endpoint for listing all branches that a commit SHA1
    is part of, the commit is properly checked for visibility against the ACLs
    (it is a REST resource) but the branches were not checked.

    The included-in may have exposed the list of non-visible branches to a user
    that had visibility purely on the SHA1.
  + [Issue 7282](https://crbug.com/gerrit/7282):
    Hide repository name and description when user has no access

    Gitiles did not respect Gerrit’s permission and would show the repo name
    and description to any user who could guess the name.
    The repositories list as well as the content APIs were not affected.
* Bug Fixes

  + [Issue 14639](https://crbug.com/gerrit/14639):
    Searching repositories by name is case-sensitive

    Restore the correct project search that was case-insensitive in 2.16.27,
    3.1.3 and 3.3.2.
  + [Change 307602](https://gerrit-review.googlesource.com/c/gerrit/%2B/307602):
    Fix NPE while accessing draft refs
  + [Change 307482](https://gerrit-review.googlesource.com/c/gerrit/%2B/307482):
    EqualsLabelPredicate: fix bug that prevents matching owner votes

### 3.1.15

* Bug Fixes

  + [Issue 14553](https://crbug.com/gerrit/14553):
    Gerrit REST-API fails when using /a/ prefix and cookies

    Recent fix to support GerritAccount Cookie authentication for Git/HTTP
    broke existing Python (or other) scripting when performing automation with
    Gerrit REST-API. That is due to the generation of the GerritAccount cookie
    in the HTTP response, which Python automatically manages to reuse in
    subsequent calls.
  + [Issue 13721](https://crbug.com/gerrit/13721):
    Don’t serve polygerrit assets for git requests

    After migration to Polymer UI, PolyGerrit static resources are mounted at
    the root of the gerrit URL, and would collide with project namespaces, so that
    the project with these prefixes cannot be served with Git over HTTP protocol.

### 3.1.14

* Bug Fixes

  + Fix registration redirect on OpenID
  + Log when a new SSH connection is rejected due to exceeded limit

    When the `sshd.maxConnectionsPerUser` got exceeded for a user, new
    connections from that user were rejected but no log entry was reported.
  + [Issue 14127](https://crbug.com/gerrit/14127):
    Fix binding of DELETE REST calls from plugins.

    The processing of the DELETE request actually never reached the
    delete-project plugin due to bug in the RestApiServlet which wrongly
    delegated the request to a child collection in Gerrit core.
  + [Issue 13140](https://crbug.com/gerrit/13140):
    OpenID: Remove support for Yahoo! OpenID provider.

    Yahoo! discontinued support for OpenID provider:
    “OpenID2 will be EOLed on 6/30/20”
  + [Issue 14246](https://crbug.com/gerrit/14246):
    Creation of internal account does not respect `auth.userNameToLowerCase`.

    The CreateAccount SSH command and REST API was able to create accounts
    with usernames that contained uppercase letters even if
    `auth.userNameToLowerCase` was set to true.
  + [Issue 14490](https://crbug.com/gerrit/14490):
    Missing LDAP metrics for authentication.

    Expose the LDAP metrics in terms of latency and call rates so that any
    problem can be highlighted early on and potentially alerted to the Gerrit
    admin.
  + [Issue 14497](https://crbug.com/gerrit/14497):
    Git/HTTP traffic overloads LDAP with duplicate authentication requests.

    When authenticating incoming Git calls over HTTP the BasicAuth filter was
    called 3 times per call triggering multiple authentications against the
    backend.
  + [Issue 14508](https://crbug.com/gerrit/14508):
    Allow GerritAccount Cookie authentication for Git/HTTP.

    Allow to create a Gerrit session from the GerritAccount cookie set on the
    Git client, so that only the first HTTP call will actually authenticate
    and create a session whilst all the others would just reuse the existing
    cookie.
  + [Issue 11142](https://crbug.com/gerrit/11142):
    ssh to gerrit with no args requires standard input to terminate.
  + [JGit Issue 552173](https://bugs.eclipse.org/bugs/show_bug.cgi?id=552173)
    Too many open files when fetching repos with lots of refs

    JGit update fixes “Too many open files” errors.
* Dependency Updates

  + Update JGit to 00386272264f65c41e36406f7c2e9ea6e901276e.

### 3.1.13

* New Features

  + [Issue 14091](https://bugs.chromium.org/p/gerrit/issues/detail?id=14091):
    Support the highlighting of LaTeX files with .tex extension.
* Breaking Changes

  + Elasticsearch: Support for [EOL versions](https://www.elastic.co/support/eol)
    7.2 and 7.3 is discontinued. Both elasticsearch versions became EOL recently.
  + [Issue 13931](https://bugs.chromium.org/p/gerrit/issues/detail?id=13931):
    Disallow editing the Change-Id during inline edits.
* Bug Fixes

  + [Issue 12443](https://bugs.chromium.org/p/gerrit/issues/detail?id=12443):
    Stop generating continuous “logging context is not empty” in error\_log.
  + [Issue 14097](https://bugs.chromium.org/p/gerrit/issues/detail?id=14097):
    Allow enabling of Git GC button for non-local Git repository managers, such
    as multi-site repositories.
  + [Issue 14118](https://bugs.chromium.org/p/gerrit/issues/detail?id=14118):
    Quota management: enforce repository size on pack rather than on object.
* PolyGerrit Fixes

  + [Issue 14257](https://bugs.chromium.org/p/gerrit/issues/detail?id=14257):
    Fix empty TopMenu drop down list.
* Replication plugin fixes

  + [Issue 12754](https://bugs.chromium.org/p/gerrit/issues/detail?id=12754):
    Remove replication plugin running tasks after their completion.
* Documentation updates

  + Align the recommended buildifier version to v4.0, the same used in the CI.
  + Development guidelines: mention that Optional in arguments is discouraged
    (use @Nullable instead) but may be used as return type.
* Dependency Updates

  + Update highlight.js to 10.6.0.

### 3.1.12

* New Features

  + Add change query option allowing administrators to skip visibility filtering.

    Add a new REST-API change query option “skip-visibility” to allow administrators
    to skip visibility filtering.
* Security Fixes

  + [Issue 13858](https://bugs.chromium.org/p/gerrit/issues/detail?id=13858)
    [CVE-2021-22553](https://nvd.nist.gov/vuln/detail/CVE-2021-22553):
    Fixed memory leak in Git-over-HTTP requests.

    Unauthenticated users could exploit this problem in a Denial of Service attack,
    causing the server to go out-of-memory.
* PolyGerrit Fixes

  + [Issue 11811](https://bugs.chromium.org/p/gerrit/issues/detail?id=11811):
    Fix comments on partial text selection on Safari.
* Replication plugin fixes

  + Don’t check read permission when authgroup isn’t set.

    Do not check for read permission when authGroup is not set since
    the user is a RemoteSiteUser that is-an InternalUser having
    read access to everything. This fixes a regression introduced in v3.1.10
    that prevented the All-Users.git repository to be fully replicated to
    Gerrit replicas.
* Bug Fixes

  + [Issue 13803](https://bugs.chromium.org/p/gerrit/issues/detail?id=13803):
    Limit number of ambiguous accounts in error message.

    Don’t list more than 3 ambiguous accounts in error message of
    UnresolvableAccountException in order to prevent flooding the log and
    displaying a lot of sensitive account data in an error dialog.
  + [Issue 13936](https://bugs.chromium.org/p/gerrit/issues/detail?id=13936):
    Fix badly formatted error message shown in error dialog.
  + [Issue 13884](https://bugs.chromium.org/p/gerrit/issues/detail?id=13884):
    Fix ‘is:submittable’ query on multiple submit records.
* Dependency Updates

  + Update highlight.js to 10.5.0.
  + Update Jetty to 9.4.35.v20201120.
  + Downgrade soy-template to 2019-10-08.

### 3.1.11

* Breaking Changes

  + Elasticsearch: Support for [EOL version](https://www.elastic.co/support/eol)
    6.8 is discontinued. This was the last supported minor version of
    Elasticsearch 6 in Gerrit. From this release, Gerrit no longer supports V6
    but only the already supported versions 7.x of Elasticsearch.

    - Speaking of which, support for 7.0 and 7.1 is discontinued too, as both
      elasticsearch versions also became [EOL](https://www.elastic.co/support/eol)
      recently.
* Security Fixes

  + [Issue 12629](https://bugs.chromium.org/p/gerrit/issues/detail?id=12629):
    Verify hostname when sending emails via SMTP server with SMTPSClient.

    The SMTP server’s certificate and hostname must be verified if
    encryption is enabled with SSL verification in the host settings
    (`sendemail.smtpEncryption` and `sendemail.sslVerify`).
* PolyGerrit Fixes

  + Add a warning if submitting a change with an open change edit.
* Bug Fixes

  + [Issue 13781](https://bugs.chromium.org/p/gerrit/issues/detail?id=13781)
    Compact the REST-API output JSON unconditionally.

    The output JSON was initially compacted only when
    the Accept header was set to `application/json`: the compation is now
    done unconditionally, unless the `pp=1` query parameter is specified.
  + [Issue 13786](https://bugs.chromium.org/p/gerrit/issues/detail?id=13786)
    ForRef#check should permit internal users to read all refs:

    [Make `PermissionBackend#ForRef` authoritative change](https://gerrit-review.googlesource.com/c/gerrit/%2B/288925)
    introduced a regression where gerrit `internal users` (e.g. plugins) were
    not taken into consideration when checking READ permission. As consequence
    the `All-Users.git` repository did not get any of the user’s refs replicated
    to the slaves. After the upgrade it is required to trigger a forced replication
    of the `All-Users.git` repository manually.
* Documentation Updates

  + Clarify that ‘m’ push option sets patch set description.
  + Clarify that disk cache metrics require `cache.enableDiskStatMetrics`.
* Dependency Updates

  + Upgrade testcontainers to 1.15.1.
  + Upgrade Jetty to 9.4.33.v20201020.

### 3.1.10

* Breaking Changes

  + Elasticsearch: Support for [EOL versions](https://www.elastic.co/support/eol)
    6.6 and 6.7 is discontinued.
  + Logging: `--console-log`-flag of `gerrit.war daemon` respects `log.textLogging`
    and `log.jsonLogging` options

    Change in the default behaviour of the `--console-log` flag. Since
    `log.textLogging` in the `gerrit.config` is `true` by default, using the
    `--console-log`-flag now writes logs to the `error_log`-file in addition
    to stderr by default. This can be avoided by setting `log.textLogging = false`.
* Security Fixes

  + [Issue 13621](https://bugs.chromium.org/p/gerrit/issues/detail?id=13621)
    [CVE-2020-8919](https://nvd.nist.gov/vuln/detail/CVE-2020-8919):
    Make `PermissionBackend#ForRef` authoritative.

    Fixes a misconception that leads to data being accessible through Gerrit
    APIs that should be locked down.

    Gerrit had two components for determining if a Git ref is visible to a
    user: `(Default)RefFilter` and `PermissionBackend#ForRef` (e.g.,
    `RefControl`). The former was always capable of providing correct results
    for all refs. The latter only had logic to decide if a Git ref is visible
    according to the Gerrit `READ` permissions. This includes all refs under
    `refs/heads` as well as any other ref that isn’t a database ref or a Git
    tag. This component was unaware of Git tags and notedb-related refs. Hence,
    when asked for a database reference such as `refs/changes/xx/yyyyxx/meta`,
    the logic would allow access if the user has `READ` permissions on any of
    the ref prefixes (such as the default “read refs/\* Anonymous Users”).

    That was problematic, because it bypassed
    [documented behavior](http://gerrit-documentation.storage.googleapis.com/Documentation/3.1.10/access-control.html)
    where a user should only have access to a change if he can see the
    destination ref. The same goes for other database references.
  + [Issue 13514](https://bugs.chromium.org/p/gerrit/issues/detail?id=13514)
    [CVE-2020-8920](https://nvd.nist.gov/vuln/detail/CVE-2020-8920):
    Work around Gitiles bug on `All-Users` visibility.

    Gitiles has a special `FilteredRepository` wrapper that allows carefully
    hiding refs based on the project’s ACLs. There is however an optimization
    that skips the filtering in case a user has `READ` permissions on every ACL
    pattern(s). When the target repository is `All-Users`, the optimization
    turns into a security issue because it allows seeing all personal information
    associated with all accounts, i.e.:

    - draft comments
    - draft edits
    - personally identifiable information (PII) of all users
    - external ids

    This fix now blocks Gitiles or any other part of Gerrit to abuse this power
    when the target repository is `All-Users`, where nobody can be authorized
    to skip the ACLs evaluation anyway.

### 3.1.9

This minor release has been withdrawn.

### 3.1.8

* Security Fixes

  + [Issue 12846](https://bugs.chromium.org/p/gerrit/issues/detail?id=12846):
    BadMessageException: 500: Response header too large.

    [CVE-2019-17638](https://nvd.nist.gov/vuln/detail/CVE-2019-17638)

    Bump Jetty version to 9.4.30.v20200611 to fix regression introduced in Jetty
    version: 9.4.27.v20200227.

    Response header overflow leads to buffer corruptions Jetty server always
    allocates maximum response header size.

    For more details see also upstream issues:

    [Issue 4936](https://github.com/eclipse/jetty.project/issues/4936)
    [Issue 4541](https://github.com/eclipse/jetty.project/issues/4541)
* Bug Fixes

  + [Issue 12959](https://bugs.chromium.org/p/gerrit/issues/detail?id=12959):
    Submit: Use updated change for response

    The response was sent with the change instance from before it
    got submitted, rather than the updated change. As a result, the
    response contained the status “NEW” rather than “MERGED”.
  + [Issue 13166](https://bugs.chromium.org/p/gerrit/issues/detail?id=13166):
    Include request latency in httpd\_log.json

    The latency field was missing in the entries of JSON-formatted http logs.
  + [Issue 12917](https://bugs.chromium.org/p/gerrit/issues/detail?id=12917):
    Switching between changes fails and in-line edit returns HTTP status 404.

    Switching between changes in a change series randomly fails.
    Also, when adding a file to a change using in-line edit fails constantly
    with an HTTP status 404.

### 3.1.7

* Security Fixes

  + [Issue 12926](https://bugs.chromium.org/p/gerrit/issues/detail?id=12926):
    Allow setting X-Frame-Options response header for preventing
    [clickjacking attacks](https://owasp.org/www-community/attacks/Clickjacking).
* Bug Fixes

  + [Issue 12680](https://bugs.chromium.org/p/gerrit/issues/detail?id=12680):
    Run projects reindex after Gerrit init only when needed, speeding up the upgrade process.
  + [Issue 12778](https://bugs.chromium.org/p/gerrit/issues/detail?id=12778):
    Fix `Included In` filter not working in the search box.
  + [Issue 12909](https://bugs.chromium.org/p/gerrit/issues/detail?id=12909):
    Fx missing index creation after Gerrit init.
  + [Issue 12918](https://bugs.chromium.org/p/gerrit/issues/detail?id=12918):
    Fix missing email notifications for project watches for changes created via cherry-pick.
* PolyGerrit Fixes

  + [Issue 11368](https://bugs.chromium.org/p/gerrit/issues/detail?id=11368):
    Fix Javascript error if project has incorrect access configuration in `Global Capabilities`.
  + [Issue 12899](https://bugs.chromium.org/p/gerrit/issues/detail?id=12899):
    Speedup the rendering of changes with large number of comments by lazy loading them when expanded.
* Documentation Updates

  + [Issue 12869](https://bugs.chromium.org/p/gerrit/issues/detail?id=12869):
    Add documentation on how to move a change across branches.

### 3.1.6

* New Features

  + Support for [rolling upgrade](http://gerrit-documentation.storage.googleapis.com/Documentation/3.1.6/config-gerrit.html#gerrit.experimentalRollingUpgrade)
    to Gerrit v3.2.0.
  + New interface `AccountActivationListener` available to plugins for listening
    to accounts activation status changes.
* Security Fixes

  + [Issue 12717](https://bugs.chromium.org/p/gerrit/issues/detail?id=12717):
    Deny access over HTTP for disabled accounts.

    A disabled account was still able to access over HTTP until the existing
    session expired.
  + Close active SSH connections associated to an account that has been disabled.
* Bug Fixes

  + [Issue 12844](https://bugs.chromium.org/p/gerrit/issues/detail?id=12844):
    Update account full name when it changes in LDAP.
  + [Issue 12850](https://bugs.chromium.org/p/gerrit/issues/detail?id=12850):
    Ignore WIP changes in “CCed on” dashboard section.
* Replication plugin fixes

  + [Issue 12806](https://bugs.chromium.org/p/gerrit/issues/detail?id=12806):
    Fix replication of the project deletions to remote replicas.
* PolyGerrit Fixes

  + [Issue 11706](https://bugs.chromium.org/p/gerrit/issues/detail?id=11706):
    Support commit message modification as part of the inline edit session.
* Documentation Updates

  + Added missing documentation of
    [notedb.changes.sequenceBatchSize](http://gerrit-documentation.storage.googleapis.com/Documentation/3.1.6/config-gerrit.html#notedb.changes.sequenceBatchSize)

### 3.1.5

* New Features

  + Add a new metric for monitoring Java deadlocks.

    The metric `proc/jvm/thread/num_deadlocked_threads` monitors the number of
    threads that are deadlocked waiting for object monitors or ownable synchronizers.
  + Add support for Elasticsearch 7.7.
* Breaking Changes

  + Metrics: Cache disk stat metric computation is disabled by default

    Calculation of the cache disks stat metrics for persistent caches is disabled
    by default because it is a very expensive operation that can block a thread for
    several minutes on larger installations.

    Installations that still want to use this metric must explicitly enable it with the
    [cache.enableDiskStatMetrics](http://gerrit-documentation.storage.googleapis.com/Documentation/3.1.5/config-gerrit.html#cache.enableDiskStatMetrics)
    configuration option.
  + Plugin API: Deprecated methods related to the draft workflow and change edits are removed

    - `ChangeApi.getEdit()`
    - `ChangeApi.publish()`
    - `RevisionApi.delete()`
    - `RevisionApi.publish()`
  + [Issue 12527](https://bugs.chromium.org/p/gerrit/issues/detail?id=12527):
    Elasticsearch: Support for [EOL versions](https://www.elastic.co/support/eol)
    v5.6 and v6.0 to v6.5 is discontinued
* End-to-end Tests Improvements

  + Allow end-to-end tests to proportionally scale on their expected execution times.

    A `power_factor` [environment property](http://gerrit-documentation.storage.googleapis.com/Documentation/3.1.5/dev-e2e-tests.html#_environment_properties)
    was added to the end-to-end tests core framework. Using that optional property,
    scenario steps can take some more (or less) time prior to expecting proper completion.

    The way to set that property locally then depends on the target runtime environment,
    or SUT latency. The property may be used for either core or plugin scenarios.
  + `FlushProjectsCache` related scenarios added to core (and the `high-availability` plugin).
  + Support for relative runtime weights in scenarios.

    Each scenario can now either weight like any other by default, or override that default
    with a greater weight value, compared to siblings that are lighter on execution times.

    Beside core, make the `high-availability` and `multi-site` plugin scenarios reuse this.
  + Allow scenarios to create and delete Gerrit changes alongside projects.

    Add the corresponding core support for an optional `http` request body to every such
    `GerritSimulation`. Either automate or allow [environment properties](http://gerrit-documentation.storage.googleapis.com/Documentation/3.1.5/dev-e2e-tests.html#_environment_properties)
    to feed the related input test data.

    Beside core, make the `high-availability` and `multi-site` plugin scenarios test changes
    that way. The latter currently has [Issue 12693](https://bugs.chromium.org/p/gerrit/issues/detail?id=12693)
    as a known limitation.
* Bug Fixes

  + [Issue 12606](https://bugs.chromium.org/p/gerrit/issues/detail?id=12606):
    Fix `visibleto` predicate for groups.

    If a group name was used in the `visibleto` predicate, changes were
    not returned even if the group had permission to see them.
  + [Issue 12747](https://bugs.chromium.org/p/gerrit/issues/detail?id=12747):
    Fix change query visibility for internal user.
  + [Issue 12755](https://bugs.chromium.org/p/gerrit/issues/detail?id=12755):
    Block the removal of the Realm primary external ids.

    It was possible to remove the email address associated with the primary
    id of a Realm, effectively resulting in the account being removed.
  + [Isssue 12786](https://bugs.chromium.org/p/gerrit/issues/detail?id=12786):
    Fix wrong status returned when auth backend couldn’t be reached.

    The response 401 was returned when the auth backend could not be
    reached, instead of the response 503.
  + [Issue 14242](https://bugs.chromium.org/p/gerrit/issues/detail?id=12424):
    Fix email token verification failures caused by non-URL-encoded characters.
  + [Issue 11625](https://bugs.chromium.org/p/gerrit/issues/detail?id=11625):
    Avoid multiple notifications for existing reviewers.
  + Fix internal server error on parsing commit message during receive commits.
  + Add `autocomplete="off"` to LDAP login form.

    Some security tools will flag the absence of the autocomplete flag as a
    possible security issue, as it could allow for passwords to be saved and
    automatically filled in on shared computers.
  + Accept `--ownedby` as an alias of `--owned-by` in the groups REST API.

    The option was incorrectly documented as `--ownedBy` which resulted in an
    error “not a valid option” if anyone tried to use it.

    The documentation is fixed, and `--ownedby` is added as an alias so that it
    also works for anyone still referring to the old documentation.
  + Fix various misuses of the Flogger API causing exception details to be omitted
    in the log output.

    Exceptions were not properly passed to the logger which would cause the
    details to be omitted, or in some cases the message “ERROR: UNUSED LOG ARGUMENTS”
    to be emitted.

    - When an invalid PAPE response is received during OpenID authentication
    - When a plugin config is invalid and cannot be loaded
    - When an error occurs while migrating a change metadata entry to JSON
    - When there is an unsupported charset in a patch text
  + [Issue 12673](https://bugs.chromium.org/p/gerrit/issues/detail?id=12673):
    Fix emitting debug logs while running tests.
* PolyGerrit UI Fixes

  + [Issue 12707](https://bugs.chromium.org/p/gerrit/issues/detail?id=12707):
    Apply diff preferences immediately after pressing “Save”.
  + [Issue 12690](https://bugs.chromium.org/p/gerrit/issues/detail?id=12690):
    Only show the “Edit” button for open changes in the diff view.
  + [Issue 12726](https://bugs.chromium.org/p/gerrit/issues/detail?id=12726):
    Fix incorrect highlighting after `/` character in Javascript.
  + [Issue 12775](https://bugs.chromium.org/p/gerrit/issues/detail?id=12775):
    Fix parent of previous patch sets not being available.
  + [Issue 12385](https://bugs.chromium.org/p/gerrit/issues/detail?id=12385):
    Fix memory leak in `gr-plugin-endpoints`.
* Replication Plugin Fixes

  + [Issue 12678](https://bugs.chromium.org/p/gerrit/issues/detail?id=12678):
    Fix missing replication Id in replication logs.

    The migration to use Flogger in 2.16.17 caused a regression in the logging,
    where the replication Id was omitted from the logs. This is fixed by reverting
    back to slf4j logging for the replication log.
  + [Issue 12719](https://bugs.chromium.org/p/gerrit/issues/detail?id=12719):
    Fix `replication start --wait` to track in-flight collisions and to not fail.
  + [Issue 12731](https://bugs.chromium.org/p/gerrit/issues/detail?id=12731):
    Don’t lose state when there’s a pending push to the same ref.

    If there was already a pending push (not an in-flight push) to the same endpoint,
    the start for the push would be dropped when adding the push to the Destination.
    This meant that a `replication start --wait` command would never complete when
    one of its pushes was pending since its state would never receive the completion
    notification for that push.
  + [Issue 11745](https://bugs.chromium.org/p/gerrit/issues/detail?id=11745):
    Fix firing pending “..all..” events on startup.
  + [Issue 11760](https://bugs.chromium.org/p/gerrit/issues/detail?id=11760):
    Make persistent task keys stable.
  + Fix URL matching to match real URLs in addition to templated URLs.
  + Log when skipping deletion of a ref when pushing to a remote in mirror mode.
  + Improve logging of push failures caused by a lock failure on the remote.
  + Improve logging of refs to be pushed.
* Library Upgrades

  + Upgrade rules\_closure to forked version

    This fixes the “-parameters is not supported for target value 1.7. Use 1.8 or later.”
    warning when building. See [PR 478](https://github.com/bazelbuild/rules_closure/pull/478).
  + [Issue 12448](https://bugs.chromium.org/p/gerrit/issues/detail?id=12448):
    Upgrade Guice to 4.2.3 and switch to using no-AOP Guice distribution

    This allows to more easily support newer JDK versions.
  + Upgrade asm to 7.2
  + Upgrade jackson-core to 2.11.0
  + Upgrade jetty to 9.4.27.v20200227

### 3.1.4

* Breaking Changes

  + The `LogThreshold` annotation is removed.

    The default log level for tests has been changed from DEBUG to INFO,
    and this annotation is no longer needed. It was originally introduced
    to allow classes to explicitly set their log level at level other than
    DEBUG.

    Plugins that use this annotation must be adjusted.
* New Features

  + Add support for Elasticsearch 7.6.x.
  + Include `upload-pack` metrics in the sshd log.

    In order to enable detailed performance and problem analysis,
    `upload-pack` metrics are now included in the sshd log.
  + Add new configuration setting `core.packedGitUseStrongRefs`.

    When set to true, this option enables using strong references to reference
    packfile pages cached in the WindowCache. If this option is set Java gc can
    no longer flush the WindowCache to free memory if the used heap comes close
    to the maximum heap size. On the other hand this provides more predictable
    performance.
  + Add new configuration setting `sendemail.denyrcpt`.

    This new setting works alongside the existing `sendemail.allowrcpt`, and
    allows to configure email addresses or domains that Gerrit may not send to.
  + Allow to format HTTP and SSH logs in JSON format.

    When `log.jsonLogging` is enabled, the HTTP and SSH logs are formatted
    as JSON, making it easier for them to be parsed. Note that the error log
    was already formatted in JSON when this option was enabled.
  + Add new metrics.

    Metrics are added for:

    - Jetty connections
    - JGit WindowCache and total load time for block cache entries
    - Available number of cores
    - Average system load for the last minute

    Refer to the metrics documentation for full details.
  + [Issue 11493](https://bugs.chromium.org/p/gerrit/issues/detail?id=11493):
    Add an “Edit” button to the diff view in the PolyGerrit UI.
  + Add support for fsharp in highlighting syntax in the PolyGerrit UI.
  + [Issue 12364](https://bugs.chromium.org/p/gerrit/issues/detail?id=12364):
    Add support for going to a specific line number in the inline editor.
  + Add prolog predicate to determine number of parents.

    The new predicate `commit_parent_count` can be used to detect merge
    commits.
  + Add `NamedFluentLogger`.

    `NamedFluentLogger` is an extension to Flogger that allows to create
    a logger with a given name rather than the name of the enclosing class.
  + [Issue 12444](https://bugs.chromium.org/p/gerrit/issues/detail?id=12444):
    Add support for `max_result_window` in Elasticsearch index configuration.
  + Add a Code Coverage layer and plugin API in the PolyGerrit UI.

    See [Chromium issue 939904](https://bugs.chromium.org/p/chromium/issues/detail?id=939904)
    for details.
  + Allow customizing the Gerrit httpd.listenUrl configuration in Docker using
    the HTTPD\_LISTEN\_URL environment variable.
* Library Upgrades

  + Upgrade jackson-core to 2.10.3
  + Upgrade Jetty to 9.4.24.v20191120, including a fix for supporting IPv6.
  + Upgrade JGit to v5.6.1.202002131546-r-15-g241557137
  + Upgrade rules\_closure to forked version.

    This fixes the “-parameters is not supported for target value 1.7. Use 1.8 or later.”
    warning when building. See [PR 478](https://github.com/bazelbuild/rules_closure/pull/478).
* Security Fixes

  + [Issue 12440](https://bugs.chromium.org/p/gerrit/issues/detail?id=12440):
    Fix the access-path for AbstractGitCommand subclasses.

    The access path for the Receive.currentUser in the receive-pack command
    was wrongly set to SSH\_COMMAND instead of to GIT.
    This allowed project owners to force-update a ref using git-over-SSH
    without having en explicit permission for that.
* Bug Fixes

  + Fix size explosion of `All-Users` caused by draft comment removal.

    Modify draft comments generation so that, when removed, they to point to an
    empty parent.
  + [Issue 11772](https://bugs.chromium.org/p/gerrit/issues/detail?id=11772):
    Cancel deprecation of change identifiers that was planned since 2.16.

    Since 2.16 the documentation of change identifiers states that the
    identifiers other than `<project>~<numericid>` are deprecated and will
    be removed in a future release. Since then the identifiers have still
    not been removed and there is no clear plan to do so.

    It is likely that “deprecated” identifiers are still used in links in
    places where they can’t be updated, for example in emails and forum
    posts. Due to this, and since continuing to support all of the types
    does not add any technical burden, ESC decided that the deprecation
    should be cancelled.

    The `change.api.allowedIdentifier` configuration setting is now
    obsolete and has been removed.
  + [Issue 3340](https://bugs.chromium.org/p/gerrit/issues/detail?id=3340):
    Fix internal server errors when setting project access permission with bad regex.
  + Fix removal of stale metrics from the metrics registry.
  + [Issue 12349](https://bugs.chromium.org/p/gerrit/issues/detail?id=12349):
    Fix time attribute of file entries in plugin artifacts.
  + Make assumption on number of query results explicit for change Id arguments.

    When a change Id passed as argument was resolved to multiple changes,
    the first returned change was arbitrarily used. Now an error will be raised
    and logged.
  + download-commands plugin: Set SSH default port to 22.
  + Document dependency from account deactivator to autoUpdateAccountActiveStatus
    and log a warning if the account deactivation task is configured but will not
    be scheduled.
  + Fix handling of ambiguous name in `visibleto` search predicate.

    If the `visibleto` search predicate was used with a display name that
    resolved to more than one account, the first account in the result was
    arbitrarily used. Now, this case will result in an error.
  + Fix a dependency injection runtime error in DeleteZombieDrafts program.
  + [Issue 12473](https://bugs.chromium.org/p/gerrit/issues/detail?id=12473):
    Fix broken links in Elasticsearch configuration documentation.
* PolyGerrit UI Fixes

  + [Issue 4616](https://bugs.chromium.org/p/gerrit/issues/detail?id=4616):
    Open commentlinks to changes on the same server in the same tab.
  + [Issue 12031](https://bugs.chromium.org/p/gerrit/issues/detail?id=12031):
    Fix issues with caching edited commit message.
  + Remove `target=_self` from commentlinks.
* Replication Plugin Fixes

  + Check nulls in firePendingEvents at startup.

    After a sudden reboot (for unknown reason) Gerrit at startup couldn’t
    load because of NullPointerException.
  + Change default for the `replicateOnStartup` to false.
  + [Issue 12559](https://bugs.chromium.org/p/gerrit/issues/detail?id=12559):
    replicateOnStartup not loaded and always considered as false.

### 3.1.3

* New Features

  + Include request description in HTTP thread names.

    The HTTP worker threads had generic names like `HTTP-100`, `HTTP-101`,
    etc. While we could conclude from the stack trace what this thread was
    doing, we missed some important information like repository name, user name,
    etc.

    The HTTP threads now have descriptive names. For example, if there is an
    ongoing git-fetch operation we will see a thread named like:
    `HTTP POST /a/myProject/git-upload-pack (johndoe from 10.87.75.169)`.

    This makes the naming consistent with SSHD threads, which are named like:
    `SSH git-upload-pack /myProject (johndoe)`.
  + New metrics for Jetty threadpool.

    The new metrics are exposed under `http/server/jetty/*`.
  + Utility program to delete zombie draft comment refs.

    Deletion of draft comment refs was broken until 2.16.14, resulting in
    draft comment refs not getting deleted properly. Although it has been fixed,
    it’s still possible that zombie refs exist from previous versions. The
    new site program `DeleteZombieCommentsRefs` can be used to remove them.
  + Highlight `WORKSPACE` and `BUILD.bazel` files as Python in the PolyGerrit UI.
* Breaking Changes

  + The `MessageOfTheDay` extension point is removed.

    The `MessageOfTheDay` functionality was not ported to the PolyGerrit-UI and
    the `MessageOfTheDay` extension point was removed with the 3.1.3 release.
    However, the JS API provides the `banner` entrypoint for plugins to add messages
    to the UI. Plugins that were previously using the `MessageOfTheDay` extension
    point have to be adapted accordingly.
* Bug Fixes

  + [Issue 12097](https://bugs.chromium.org/p/gerrit/issues/detail?id=12097):
    Fix migration to NoteDb when orphan changes exist.

    In the case where a change belonged to a repository that did not exist,
    the migration failed.
  + [Issue 9296](https://bugs.chromium.org/p/gerrit/issues/detail?id=9296):
    Fix wrong diff of commit message between different patch sets of a merge commit.
  + [Issue 7969](https://bugs.chromium.org/p/gerrit/issues/detail?id=7969):
    Fix internal server error when diffing `MERGE_LIST` between different patch sets
    of a merge commit.
  + [Issue 10397](https://bugs.chromium.org/p/gerrit/issues/detail?id=10397):
    Don’t send notification email when publishing a change edit on a WIP change.
  + [Issue 12243](https://bugs.chromium.org/p/gerrit/issues/detail?id=12243):
    Fix unexpected deactivation of service user accounts.
  + Fix editing name and email for service user accounts.
  + Fix internal server error when a change edit includes an invalid file path.

    Invalid file paths are now rejected as ‘400 Bad Request’.
  + Fix internal server error when giving an invalid merge strategy to the
    ‘Create Merge Patch Set’ REST endpoint.
  + Fix a resource leak in the ‘Get Patch’ REST endpoint.
  + Don’t check for conflicting refs when deleting a ref; improve performance of
    migration to schema 167.

    The migration to schema 167 involves deletion of refs. The performance was
    poor for large installations (for example 30k user refs and 20k groups)
    because the ref deletion implementation was doing an unnecessary check for
    conflicting refs.
  + Fix setting `_moreChanges` to the wrong value in change query REST results.
  + Upgrade highlight-js to get various fixes in source code highlighting:

    - fix(makefile) fix double relevance for assignments
    - (xml) expand and improve document type highlighting
    - fix(kotlin): fix termination of “”” string literals
    - (cpp) Add additional keywords
    - Backslash is not used to escape in strings in standard SQL
    - (javascript) fix jsx self-closing tag issues
    - enh(ini) support arrays and much cleaner grammar
    - (javascript) support jsx fragments
* PolyGerrit UI Fixes

  + [Issue 11980](https://bugs.chromium.org/p/gerrit/issues/detail?id=11980):
    Fix handling of LDAP groups containing a dot in the PolyGerrit permissions screen.
  + [Issue 12197](https://bugs.chromium.org/p/gerrit/issues/detail?id=12197):
    Fix rendering of commentlinks using `link`.
  + [Issue 11697](https://bugs.chromium.org/p/gerrit/issues/detail?id=11697):
    Fix rendering of commentlinks without leading whitespace.
  + [Issue 12224](https://bugs.chromium.org/p/gerrit/issues/detail?id=12224):
    Honor the date format preference when displaying dates.
  + [Issue 12184](https://bugs.chromium.org/p/gerrit/issues/detail?id=12184):
    Fix link in blame annotation to link directly to the commit.
  + [Issue 12108](https://bugs.chromium.org/p/gerrit/issues/detail?id=12108):
    Add missing ‘Page …’ on pagination links in the repository list.
  + Fix the size of the commit message box.
  + Fix a parse error on the repository list.
  + Fix multiple triggers when `shift-r` is held.
  + Wrap filenames onto two lines in the file list if the filename is too long.
  + Add a right margin to the search bar.

    This creates some space between the search bar and the `header-browse-source`
    endpoint where you often see a ‘Repositories’ link.
  + Replace ‘Menlo’ font with ‘SF Mono’.

    ‘Menlo’ was replaced by ‘SF Mono’ from Mac OS 10.11, and ‘Menlo’ does not render
    symbols and characters correctly.
* Other Changes

  + Upgrade JGit to v5.6.0.201912101111-r-31-g3d59d1b80.
  + Upgrade jackson-core dependency to 2.10.2
  + Improve logging when a metadata update fails.
  + Update [external Ids documentation](http://gerrit-documentation.storage.googleapis.com/Documentation/3.1.3/config-accounts.html#external-ids)
    with information on how to find the sha1 of an external Id and how to show the
    corresponding change note.

### 3.1.2

* New Features

  + Include thread name in the HTTPD and SSHD logs.

    Having thread name in the HTTPD and SSHD logs makes it easier to match entries
    from the error log. The error log entries already contain the thread name, so
    with the thread name included in each entry in the HTTPD and SSHD logs, we have
    more data to match an error to a request than just the timestamp.
* PolyGerrit UI Fixes

  + [Issue 12067](https://bugs.chromium.org/p/gerrit/issues/detail?id=12067):
    Fix blank screen after upgrading.
* Other Fixes

  + [Issue 12070](https://bugs.chromium.org/p/gerrit/issues/detail?id=12070):
    Fix internal server error on git over HTTP calls when SSHD is enabled.

    Double cleanup of the request context caused an internal server error on
    push or fetch via git over HTTP.
  + Fix generation of SSH keys with empty passphrase.

    The `-N` option of `ssh-keygen` was correctly used for generation of RSA keys,
    but for other types `-P` was used.
  + Extend documentation of external Ids to include examples of how to generate
    the sha1 of an external Id and how to show the git note of the Id.

### 3.1.1

* New Features

  + [Issue 11973](https://bugs.chromium.org/p/gerrit/issues/detail?id=11973):
    Add copy-to-clipboard for generated HTTP password.
  + Add support for doctag in PolyGerrit UI syntax highlighter.
  + Add an event interface in the PolyGerrit API.
  + Add support for Elasticsearch 7.5.
  + Add documentation of how to perform backups of Gerrit.
* PolyGerrit UI Fixes

  + [Issue 12024](https://bugs.chromium.org/p/gerrit/issues/detail?id=12024):
    Fix undefined branch in create-destination-dialog.
  + [Issue 11969](https://bugs.chromium.org/p/gerrit/issues/detail?id=11969):
    Fix tab index in reply dialog.
  + [Issue 11993](https://bugs.chromium.org/p/gerrit/issues/detail?id=11993):
    Stop loading fonts from external resources.
  + [Issue 11984](https://bugs.chromium.org/p/gerrit/issues/detail?id=11984):
    Fix top menu bar on iOS.
  + [Issue 8282](https://bugs.chromium.org/p/gerrit/issues/detail?id=8282):
    Avoid browser caching for diff on edit patch.
  + [Issue 9444](https://bugs.chromium.org/p/gerrit/issues/detail?id=9444):
    Fix syntax highlighting for multi-char char constants.
  + [Issue 12020](https://bugs.chromium.org/p/gerrit/issues/detail?id=12020):
    Fix ‘New Contributor Agreement’ screen.
  + Fix `gr-syntax-params` css class.
  + Fix overflow of branch name in change list.
* Other Fixes

  + [Issue 11989](https://bugs.chromium.org/p/gerrit/issues/detail?id=11989):
    Fix internal server error when pushing over SSH with git protocol v2.
  + [Issue 11962](https://bugs.chromium.org/p/gerrit/issues/detail?id=11962):
    Fix advertisement of `refs/meta/config` in git protocol v2 when client does
    not have access to it.
  + [Issue 11986](https://bugs.chromium.org/p/gerrit/issues/detail?id=11986):
    Fix fetching individual ref with git protocol v2.
  + [Issue 7645](https://bugs.chromium.org/p/gerrit/issues/detail?id=7645):
    Fix thread deadlock when loading accounts from the account cache.

    Replacing Guava caches with Caffeine reduces the chances of having the
    deadlocks and improves the cache performance.
  + [Issue 11918](https://bugs.chromium.org/p/gerrit/issues/detail?id=11918):
    Fix internal server error when deleting a tag or branch by git push.
  + [Issue 11650](https://bugs.chromium.org/p/gerrit/issues/detail?id=11650):
    Fix reindexing of changes after project is deleted in the `delete-project` plugin.
  + Disallow deleting the `refs/meta/config` branch via the ‘Delete Branches’
    REST API.
  + Disallow deleting the `HEAD` ref via the ‘Delete Branches’ REST API.
  + Allow empty base revision in the ‘Create Branch’ and ‘Create Tag’
    REST APIs.
  + Fix deletion of draft comment refs.

    In some situations, draft comment refs were not properly deleted
    but left empty. This resulted in unused draft refs persisting in
    the `All-Users` repository, polluting the namespace. Published draft
    comments as well as deleted draft comments were kept in the history
    of the draft ref, keeping them alive for GC, and causing a steady
    increase of repository size.
  + Use correct content type `text/plain` instead of `plain/text` in ‘Create SSH Key’
    REST API.
  + Fix handling of interactive/batch users in the QoS filter.

    For the git-over-http requests this filter didn’t work properly because the
    basic authentication happened later in the filter chain and at the moment when
    the QoS filter was invoked the current user was not yet set.
  + Add project name to headers of outgoing change emails.
  + Fix and expand documentation of `ref-update` and `commit-received` hooks
    in the hooks plugin.
  + Upgrade JGit to v5.6.0.201912041214-rc1

---

©2025 Gerrit. All rights reserved.

Site last generated: Jan 19, 2025

![Diffy](/images/diffy_logo.png)

[Privacy Notice](https://www.google.com/policies/privacy/)



=== Content from www.gerritcodereview.com_a14b5992_20250119_111532.html ===


Toggle navigation

[Gerrit Code Review](/index.html)

* [About](/about.html)
* [News](/news.html)
* [Support](/support.html)

* Community
  + [Code of Conduct](/codeofconduct.html)
  + [Forums, Mailing lists etc.](/contact.html)
  + [Members](/members.html)
  + [Contributing](/contributing.html)
  + [Fixing a bug](/bug-fixing.html)
  + [Presentations](/presentations.html)
  + [Kudos](/kudos.html)
  + [User Stories](/userStories.html)
  + [Trademarks](/trademarks.html)
* Code
  + [Source](https://gerrit.googlesource.com/gerrit/)
  + [Releases](/releases-readme.html)
  + [Plugins](/plugins.html)
  + [Roadmap](/roadmap.html)
  + [Builds](https://gerrit-ci.gerritforge.com/)
  + [Reviews](https://gerrit-review.googlesource.com/q/status%3Aopen%2Bproject%3Agerrit)
* Docs
  + [Latest](https://gerrit-documentation.storage.googleapis.com/Documentation/3.11.1/index.html)
  + [Designs](/design-docs-index.html)
  + [Wiki](https://gerrit.googlesource.com/homepage/%2B/master/pages/site/docs/)
* Feedback

# Gerrit 3.0.x

Download: **[3.0.16](https://gerrit-releases.storage.googleapis.com/gerrit-3.0.16.war)**
| [3.0.15](https://gerrit-releases.storage.googleapis.com/gerrit-3.0.15.war)
| [3.0.13](https://gerrit-releases.storage.googleapis.com/gerrit-3.0.13.war)
| [3.0.12](https://gerrit-releases.storage.googleapis.com/gerrit-3.0.12.war)
| [3.0.11](https://gerrit-releases.storage.googleapis.com/gerrit-3.0.11.war)
| [3.0.10](https://gerrit-releases.storage.googleapis.com/gerrit-3.0.10.war)
| [3.0.9](https://gerrit-releases.storage.googleapis.com/gerrit-3.0.9.war)
| [3.0.8](https://gerrit-releases.storage.googleapis.com/gerrit-3.0.8.war)
| [3.0.7](https://gerrit-releases.storage.googleapis.com/gerrit-3.0.7.war)
| [3.0.6](https://gerrit-releases.storage.googleapis.com/gerrit-3.0.6.war)
| [3.0.5](https://gerrit-releases.storage.googleapis.com/gerrit-3.0.5.war)
| [3.0.4](https://gerrit-releases.storage.googleapis.com/gerrit-3.0.4.war)
| [3.0.3](https://gerrit-releases.storage.googleapis.com/gerrit-3.0.3.war)
| [3.0.2](https://gerrit-releases.storage.googleapis.com/gerrit-3.0.2.war)
| [3.0.1](https://gerrit-releases.storage.googleapis.com/gerrit-3.0.1.war)
| [3.0.0](https://gerrit-releases.storage.googleapis.com/gerrit-3.0.0.war)

Documentation: **[3.0.16](https://gerrit-documentation.storage.googleapis.com/Documentation/3.0.16/index.html)**
| [3.0.15](https://gerrit-documentation.storage.googleapis.com/Documentation/3.0.15/index.html)
| [3.0.13](https://gerrit-documentation.storage.googleapis.com/Documentation/3.0.13/index.html)
| [3.0.12](https://gerrit-documentation.storage.googleapis.com/Documentation/3.0.12/index.html)
| [3.0.11](https://gerrit-documentation.storage.googleapis.com/Documentation/3.0.11/index.html)
| [3.0.10](https://gerrit-documentation.storage.googleapis.com/Documentation/3.0.10/index.html)
| [3.0.9](https://gerrit-documentation.storage.googleapis.com/Documentation/3.0.9/index.html)
| [3.0.8](https://gerrit-documentation.storage.googleapis.com/Documentation/3.0.8/index.html)
| [3.0.7](https://gerrit-documentation.storage.googleapis.com/Documentation/3.0.7/index.html)
| [3.0.6](https://gerrit-documentation.storage.googleapis.com/Documentation/3.0.6/index.html)
| [3.0.5](https://gerrit-documentation.storage.googleapis.com/Documentation/3.0.5/index.html)
| [3.0.4](https://gerrit-documentation.storage.googleapis.com/Documentation/3.0.4/index.html)
| [3.0.3](https://gerrit-documentation.storage.googleapis.com/Documentation/3.0.3/index.html)
| [3.0.2](https://gerrit-documentation.storage.googleapis.com/Documentation/3.0.2/index.html)
| [3.0.1](https://gerrit-documentation.storage.googleapis.com/Documentation/3.0.1/index.html)
| [3.0.0](https://gerrit-documentation.storage.googleapis.com/Documentation/3.0.0/index.html)

## Release Highlights

* Removal of GWT UI

  The GWT UI is removed and PolyGerrit is now the only UI.
* Removal of ReviewDb

  The database backend for changes, accounts, groups and projects (“ReviewDb”) is
  removed and this metadata is now stored in git (“NoteDb”).

  A database is still needed for account patch reviews, which stores the ‘reviewed’
  flag for files in a review per user. The default backend is H2, but MySQL,
  PostgreSQL and MariaDb are also supported. See the
  [documentation](http://gerrit-documentation.storage.googleapis.com/Documentation/3.0.0/config-gerrit.html#accountPatchReviewDb)
  for details.

  It is also possible for plugins to provide another backend by implementing the
  [`AccountPatchReviewStore`](http://gerrit-documentation.storage.googleapis.com/Documentation/3.0.0/dev-plugins.html#account-patch-review-store)
  interface.
* New quota enforcer extension point.
* [Issue 4040](https://bugs.chromium.org/p/gerrit/issues/detail?id=4040):
  Support for signed push with GPG subkeys.
* New core plugins: `delete-project`, `gitiles`, `plugin-manager`, and `webhooks`.

## Important Notes

### Schema Changes

This release contains schema changes. To upgrade:

```
  java -jar gerrit.war init -d site_path

```

The changes index version has been increased. To run off-line reindexing of
the changes (optional):

```
  java -jar gerrit.war reindex --index changes -d site_path

```

By default the changes index is automatically rebuilt upon the Gerrit startup
after the upgrade.

### Breaking Changes

#### Reverse DNS lookup is now disabled by default

The `gerrit.disableReverseDnsLookup` option with default value false is replaced
by `gerrit.enableReverseDnsLookp` also with default value false. This means that
reverse DNS lookup is now disabled by default.

#### Private changes will be published (unmarked private) once merged

A warning dialog will be displayed to the user to confirm this on submission
using the UI. When submitted via push, this warning will not be shown. Already
merged changes cannot be marked private any longer.

#### The `urlAlias` configuration settings are removed

The URL rewriting feature introduced in 2.12 via the
[`urlAlias` configuration](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.12/config-gerrit.html#urlAlias)
was only supported in GWT, and thus removed with the 3.0 release.

See [issue 8054](https://bugs.chromium.org/p/gerrit/issues/detail?id=8054)
for details.

#### The `MessageOfTheDay` extension point is removed

The `MessageOfTheDay` functionality was not ported to the PolyGerrit-UI and
the `MessageOfTheDay` extension point was removed with the 3.0.7 release.
However, the JS API provides the `banner` entrypoint for plugins to add messages
to the UI. Plugins that were previously using the `MessageOfTheDay` extension
point have to be adapted accordingly.

## New Features

* New quota enforcer extension point.

  Plugins may implement the
  [QuotaEnforcer](http://gerrit-documentation.storage.googleapis.com/Documentation/3.0.0/dev-plugins.html#quota-enforcer)
  interface to enforce
  [quotas](http://gerrit-documentation.storage.googleapis.com/Documentation/3.0.0/dev-plugins.html#quota-enforcer).
* [Issue 4040](https://bugs.chromium.org/p/gerrit/issues/detail?id=4040):
  Support for signed push with GPG subkeys.

  It is now possible to use a GPG subkey when pushing commits with signed push.
* [Issue 6053](https://bugs.chromium.org/p/gerrit/issues/detail?id=6053):
  Support for searching on mobile devices.
* [Issue 8535](https://bugs.chromium.org/p/gerrit/issues/detail?id=8535):
  Support for plugin config entries in the PolyGerrit UI.

  Configuration entries defined by server-side plugins are now displayed
  in the UI.
* [Issue 10385](https://bugs.chromium.org/p/gerrit/issues/detail?id=10385):
  New [Toggle Work In Progress state](https://gerrit-documentation.storage.googleapis.com/Documentation/3.0.12/access-control.html#category_toggle_work_in_progress_state) permission.

  This allows for granting the “Toggle Work In Progress state” permission to
  arbitrary users. This permission controls who is able to flip the Work In
  Progress bit in addition to the three different groups that can do so already:
  change owner, server administrator and project owners.

  Note that the option was included in 3.0.0 but only documented since 3.0.12.
* New method to get UI top menus in the config API.
* New configuration option
  [`change.api.excludeMergeableInChangeInfo`](http://gerrit-documentation.storage.googleapis.com/Documentation/3.0.0/config-gerrit.html#change.api.excludeMergeableInChangeInfo).

  Computing mergeability of open changes becomes very expensive for hosts
  that have fast-moving branches and a lot of open changes. Setting this
  option to `true` disables it.
* New configuration option
  [`change.move`](http://gerrit-documentation.storage.googleapis.com/Documentation/3.0.3/config-gerrit.html#change.move).

  The `change.move` option allows to disable the “Move Change” REST API.

  Note that the option was included in 3.0.0 but only documented since 3.0.3.
* New core plugins.

  The `delete-project`, `gitiles`, `plugin-manager`, and `webhooks` plugins are
  now core plugins bundled with the release, and can be installed during site
  initialization.

## Dependency Updates

* Add dependency on resemblejs
* Remove dependency on apache derby
* Remove dependency on gwtjsonrpc
* Remove dependency on gwtorm
* Remove dependency on postgresql
* Upgrade asm to 7.0
* Upgrade auto-value to 1.6.5
* Upgrade codemirror-minified to 5.43.0
* Upgrade commons-lang3 to 3.8.1
* Upgrade gitiles-blame-cache and gitiles-servlet to 0.2-8
* Upgrade guava to 27.0.1-jre
* Upgrade guice to 4.2.2
* Upgrade prolog-cafe to 1.4.4
* Upgrade soy to 2019-03-11
* Upgrade truth to 0.43

## Native packaging

* Upgrade the Docker/Ubuntu image to Ubuntu 18.04
* Upgrade the Docker/CentOS image to CentOS 7.6.1810
* RPM/Deb: Remove Gerrit service start upon package setup.

  Gerrit service is no longer started automatically after the package installation,
  but requires manual invocation of the `/etc/init.d/gerrit start` command, or
  the configuration of the service for auto-start and the reboot of the machine.
* Docker: auto-init the Gerrit site during first start of the container.

  Simplify the configuration and management of Docker setups by automatically
  detecting if a `$GERRIT_SITE/git/All-Projects.git` exists and, if it doesn’t,
  invoke the Gerrit init step in batch mode.

## Bugfix Releases

### 3.0.16

* Security Fixes

  + [Issue 13858](https://bugs.chromium.org/p/gerrit/issues/detail?id=13858)
    [CVE-2021-22553](https://nvd.nist.gov/vuln/detail/CVE-2021-22553):
    Fixed memory leak in Git-over-HTTP requests.

    Unauthenticated users could exploit this problem in a Denial of Service attack,
    causing the server to go out-of-memory.
* Bug Fixes

  + [Issue 12287](https://bugs.chromium.org/p/gerrit/issues/detail?id=12287):
    Add a warning if submitting a change with an open change edit.
* Dependency Updates

  + Update JGit to 5.3.9.202012012026-r.
  + Update Jetty to 9.4.33.v20201020.

### 3.0.15

* Security Fixes

  + [Issue 13621](https://bugs.chromium.org/p/gerrit/issues/detail?id=13621)
    [CVE-2020-8919](https://nvd.nist.gov/vuln/detail/CVE-2020-8919):
    Make `PermissionBackend#ForRef` authoritative.

    Fixes a misconception that leads to data being accessible through Gerrit
    APIs that should be locked down.

    Gerrit had two components for determining if a Git ref is visible to a
    user: `(Default)RefFilter` and `PermissionBackend#ForRef` (e.g.,
    `RefControl`). The former was always capable of providing correct results
    for all refs. The latter only had logic to decide if a Git ref is visible
    according to the Gerrit `READ` permissions. This includes all refs under
    `refs/heads` as well as any other ref that isn’t a database ref or a Git
    tag. This component was unaware of Git tags and notedb-related refs. Hence,
    when asked for a database reference such as `refs/changes/xx/yyyyxx/meta`,
    the logic would allow access if the user has `READ` permissions on any of
    the ref prefixes (such as the default “read refs/\* Anonymous Users”).

    That was problematic, because it bypassed
    [documented behavior](http://gerrit-documentation.storage.googleapis.com/Documentation/3.0.15/access-control.html)
    where a user should only have access to a change if he can see the
    destination ref. The same goes for other database references.
  + [Issue 13514](https://bugs.chromium.org/p/gerrit/issues/detail?id=13514)
    [CVE-2020-8920](https://nvd.nist.gov/vuln/detail/CVE-2020-8920):
    Work around Gitiles bug on `All-Users` visibility.

    Gitiles has a special `FilteredRepository` wrapper that allows carefully
    hiding refs based on the project’s ACLs. There is however an optimization
    that skips the filtering in case a user has `READ` permissions on every ACL
    pattern(s). When the target repository is `All-Users`, the optimization
    turns into a security issue because it allows seeing all personal information
    associated with all accounts, i.e.:

    - draft comments
    - draft edits
    - personally identifiable information (PII) of all users
    - external ids

    This fix now blocks Gitiles or any other part of Gerrit to abuse this power
    when the target repository is `All-Users`, where nobody can be authorized
    to skip the ACLs evaluation anyway.

### 3.0.14

This minor release has been withdrawn.

### 3.0.13

* Breaking Changes

  + Elasticsearch: Support for [EOL versions](https://www.elastic.co/support/eol)
    6.6 and 6.7 is discontinued.
  + [Issue 13184](https://bugs.chromium.org/p/gerrit/issues/detail?id=13184):
    Logging: `--console-log`-flag of `gerrit.war daemon` respects `log.textLogging`
    and `log.jsonLogging` options.

    Change in the default behaviour of the `--console-log` flag. Since
    `log.textLogging` in the `gerrit.config` is `true` by default, using the
    `--console-log`-flag now writes logs to the `error_log`-file in addition
    to stderr by default. This can be avoided by setting `log.textLogging = false`.
* Bug Fixes

  + [Issue 11706](https://bugs.chromium.org/p/gerrit/issues/detail?id=11706):
    ChangeEdits: Don’t wrap `Response.none()` in `Response.ok()`.

    Wrapping of edit message modification `Response.none()` in `Response.ok()`
    was erroneously added. Revert that part, as it broke the handling of that
    specific request.
  + [Issue 13175](https://bugs.chromium.org/p/gerrit/issues/detail?id=13175):
    Fix `gr-hovercard-behavior` under Firefox.
  + [Issue 13328](https://bugs.chromium.org/p/gerrit/issues/detail?id=13328):
    Redirect GWT UI project dashboard links to Polygerrit endpoints.

    Add a route to the Polygerrit UI router, to redirect such legacy GWT UI
    endpoints, so that existing menu links are handled without any modifications.
    Otherwise, switching from GWT to Polygerrit resulted in broken links to
    project dashboards. This fix also handles bookmarked links.
  + [Issue 13350](https://bugs.chromium.org/p/gerrit/issues/detail?id=13350):
    Decode group id before using it to add cc-reviewers.

    When a group is being suggested for cc-reviewer, its UUID gets encoded
    by Gerrit prior to rendering it. That had no impact on Gerrit internal
    groups, however external groups were affected. UUID prefixes contained
    encoded characters where they shouldn’t have. Hitting the Reply button
    sent such encoded groups as is, leading to them not being found in Gerrit.

    Decoding the URI before sending the group back to the UI fixes the issue.
  + [Issue 13372](https://bugs.chromium.org/p/gerrit/issues/detail?id=13372):
    Remove obsolete GWT change-related screenshot.

    The GWT UI is not included anymore in Gerrit from v3.0 onwards.
* Replication Plugin Fixes

  + Fixed synopsis in replication start command documentation.

    `--url` is usable with `--all` or projects and on its own.
    Update the usage to reflect this.
  + [Issue 12769](https://bugs.chromium.org/p/gerrit/issues/detail?id=12769):
    Don’t wait for pending events to process on startup.

    Previously, on large Gerrit installations with many projects and/or many
    replication destinations, the replication plugin could take very long
    periods of time to startup. This was particularly a problem if the
    pending (persisted) event count was large as they all were rescheduled
    before the plugin finished initializing.

    Change this behavior so that startup merely begins the process of
    scheduling the pending events, but does not wait for them to complete.
* End-to-end Tests Improvements

  + Support an optional parent in the `CreateProject` scenario.
  + Rely on a released version of `gatling-git` in stable branch.
  + List of [plugins with scenarios](https://gerrit-documentation.storage.googleapis.com/Documentation/3.0.13/dev-e2e-tests.html#_plugin_scenarios)
    updated.
  + Documentation for
    [Environment properties](https://gerrit-documentation.storage.googleapis.com/Documentation/3.0.13/dev-e2e-tests.html#_environment_properties)
    was refactored and augmented with
    [replication\_delay](https://gerrit-documentation.storage.googleapis.com/Documentation/3.0.13/dev-e2e-tests.html#_replication_delay)
    information, as the new `CheckNewProjectReplica1` core scenario was added.
  + [Issue 12208](https://bugs.chromium.org/p/gerrit/issues/detail?id=12208):
    Add [presentation links](https://gerrit-documentation.storage.googleapis.com/Documentation/3.0.13/dev-e2e-tests.html#_what_is_gatling)
    to documentation.
  + [Issue 13082](https://bugs.chromium.org/p/gerrit/issues/detail?id=13082):
    Add [Eclipse support](https://gerrit-documentation.storage.googleapis.com/Documentation/3.0.13/dev-e2e-tests.html#_eclipse)
    for Gatling tests.
* Other Improvements

  + Introduced `sshd.gracefulStopTimeout`, documented
    [here](https://gerrit-documentation.storage.googleapis.com/Documentation/3.0.13/config-gerrit.html#sshd.gracefulStopTimeout).
  + Bumped the Bazel version to `3.5.0`.
  + `MigrateToNoteDb` and `NoteDbMigrator` logging improvements.
* Documentation Updates

  + Documented how to mitigate a broken
    [Eclipse project on macOS](https://gerrit-documentation.storage.googleapis.com/Documentation/3.0.13/dev-eclipse.html#_eclipse_project_on_macos).
  + Documented the `X-Forwarded-For` header under a new
    [Reverse proxy and client IPs](https://gerrit-documentation.storage.googleapis.com/Documentation/3.0.13/config-reverseproxy.html#_reverse_proxy_and_client_ips)
    section.
  + Gerrit
    [log files and their format](https://gerrit-documentation.storage.googleapis.com/Documentation/3.0.13/logs.html)
    added as a new documentation page.
  + Updated the
    [recommended buildifier version](https://gerrit-documentation.storage.googleapis.com/Documentation/3.0.13/dev-contributing.html)
    to `3.5.0`.
  + Improved parts of the
    [release process main documentation page](http://gerrit-documentation.storage.googleapis.com/Documentation/3.0.13/dev-release.html).
* Library Updates

  + Upgraded Elasticsearch 6 support to `6.8.12` and 7 (elasticsearch-rest-client) to `7.8.1`.
  + Upgraded jackson-core to version `2.11.2`.
  + Upgraded caffeine to version `2.8.5`.

### 3.0.12

* Security Fixes

  + [Issue 12846](https://bugs.chromium.org/p/gerrit/issues/detail?id=12846):
    BadMessageException: 500: Response header too large.

    [CVE-2019-17638](https://nvd.nist.gov/vuln/detail/CVE-2019-17638)

    Bump Jetty version to 9.4.30.v20200611 to fix regression introduced in Jetty
    version: 9.4.27.v20200227.

    Response header overflow leads to buffer corruptions Jetty server always
    allocates maximum response header size.

    For more details see also upstream issues:

    [Issue 4936](https://github.com/eclipse/jetty.project/issues/4936)
    [Issue 4541](https://github.com/eclipse/jetty.project/issues/4541)
* Bug Fixes

  + [Issue 13054](https://bugs.chromium.org/p/gerrit/issues/detail?id=13054):
    Restore keyboard shortcut for expand all diff context

    In gerrit 2.16 release the keyboard shortcuts system was redesigned, but
    the binding for Shift+x shortcut for expand all diffs was lost. Restore
    this binding and confirm that it is now listed in the help dialog and
    works as expected.
  + [Issue 12952](https://bugs.chromium.org/p/gerrit/issues/detail?id=12952):
    Handle duplicate label values on project load and push of config updates

    With the fix a validation error on load of the `project.config` file is
    generated, but let the loading succeed and the duplicate value is filtered
    out. Hence getting the project info of such a project no longer fails.
  + [Issue 13166](https://bugs.chromium.org/p/gerrit/issues/detail?id=13166):
    Include request latency in httpd\_log.json

    The latency field was missing in the entries of JSON-formatted http logs.

### 3.0.11

* Security Fixes

  + [Issue 12926](https://bugs.chromium.org/p/gerrit/issues/detail?id=12926):
    Allow setting X-Frame-Options response header for preventing
    [clickjacking attacks](https://owasp.org/www-community/attacks/Clickjacking).

    The setting [`gerrit.canLoadInIFrame`](http://gerrit-documentation.storage.googleapis.com/Documentation/3.0.11/config-gerrit.html#gerrit.canLoadInIFrame),
    previously used by the GWT UI, is now honoured by the PolyGerrit UI.
* Bug Fixes

  + [Issue 12680](https://bugs.chromium.org/p/gerrit/issues/detail?id=12680):
    Run projects reindex after Gerrit init only when needed, speeding up the upgrade process.
  + [Issue 12909](https://bugs.chromium.org/p/gerrit/issues/detail?id=12909):
    Fx missing index creation after Gerrit init.
  + [Issue 12918](https://bugs.chromium.org/p/gerrit/issues/detail?id=12918):
    Fix missing email notifications for project watches for changes created via cherry-pick.
  + [Issue 12935](https://bugs.chromium.org/p/gerrit/issues/detail?id=12935):
    Fix the output of the migrate-to-note-db program swallowing messaages after garbage collecting All-Users.
* PolyGerrit Fixes

  + [Issue 12899](https://bugs.chromium.org/p/gerrit/issues/detail?id=12899):
    Speedup the rendering of changes with large number of comments by lazy loading them when expanded.
* Documentation Updates

  + [Issue 12869](https://bugs.chromium.org/p/gerrit/issues/detail?id=12869):
    Add documentation on how to move a change across branches.

### 3.0.10

* Security Fixes

  + [Issue 12717](https://bugs.chromium.org/p/gerrit/issues/detail?id=12717):
    Deny access over HTTP for disabled accounts.

    A disabled account was still able to access over HTTP until the existing
    session expired.
* Bug Fixes

  + [Issue 12777](https://bugs.chromium.org/p/gerrit/issues/detail?id=12777):
    Hide “No Votes” notice for for labels added and approved by rules.
  + [Issue 12844](https://bugs.chromium.org/p/gerrit/issues/detail?id=12844):
    Update account full name when it changes in LDAP.
  + [Issue 12850](https://bugs.chromium.org/p/gerrit/issues/detail?id=12850):
    Ignore WIP changes in “CCed on” dashboard section.
  + [Issue 11707](https://bugs.chromium.org/p/gerrit/issues/detail?id=11706):
    Support `/COMMIT_MSG` for change edit REST endpoints.
  + Do not fail for invalid change refs in `DefaultRefFilter`.
* Library Updates

  + Upgrade elasticsearch-rest-client to 7.7.1.
* Documentation Updates

  + Added missing documentation of
    [notedb.changes.sequenceBatchSize](http://gerrit-documentation.storage.googleapis.com/Documentation/3.0.10/config-gerrit.html#notedb.changes.sequenceBatchSize)

### 3.0.9

* New Features

  + Add a new metric for monitoring Java deadlocks.

    The metric `proc/jvm/thread/num_deadlocked_threads` monitors the number of
    threads that are deadlocked waiting for object monitors or ownable synchronizers.
  + Add support for Elasticsearch 7.7.
* Breaking Changes

  + Metrics: Cache disk stat metric computation is disabled by default

    Calculation of the cache disks stat metrics for persistent caches is disabled
    by default because it is a very expensive operation that can block a thread for
    several minutes on larger installations.

    Installations that still want to use this metric must explicitly enable it with the
    [cache.enableDiskStatMetrics](http://gerrit-documentation.storage.googleapis.com/Documentation/3.0.9/config-gerrit.html#cache.enableDiskStatMetrics)
    configuration option.
  + Plugin API: Deprecated methods related to the draft workflow and change edits are removed

    - `ChangeApi.getEdit()`
    - `ChangeApi.publish()`
    - `RevisionApi.delete()`
    - `RevisionApi.publish()`
  + [Issue 12527](https://bugs.chromium.org/p/gerrit/issues/detail?id=12527):
    Elasticsearch: Support for [EOL versions](https://www.elastic.co/support/eol)
    v5.6 and v6.0 to v6.5 is discontinued
* End-to-end Tests Improvements

  + Allow end-to-end tests to proportionally scale on their expected execution times.

    A `power_factor` [environment property](http://gerrit-documentation.storage.googleapis.com/Documentation/3.0.9/dev-e2e-tests.html#_environment_properties)
    was added to the end-to-end tests core framework. Using that optional property,
    scenario steps can take some more (or less) time prior to expecting proper completion.

    The way to set that property locally then depends on the target runtime environment,
    or SUT latency. The property may be used for either core or plugin scenarios.
  + `FlushProjectsCache` related scenarios added to core (and the `high-availability` plugin).
  + Support for relative runtime weights in scenarios.

    Each scenario can now either weight like any other by default, or override that default
    with a greater weight value, compared to siblings that are lighter on execution times.

    Beside core, make the `high-availability` and `multi-site` plugin scenarios reuse this.
  + Allow scenarios to create and delete Gerrit changes alongside projects.

    Add the corresponding core support for an optional `http` request body to every such
    `GerritSimulation`. Either automate or allow [environment properties](http://gerrit-documentation.storage.googleapis.com/Documentation/3.0.9/dev-e2e-tests.html#_environment_properties)
    to feed the related input test data.

    Beside core, make the `high-availability` and `multi-site` plugin scenarios test changes
    that way. The latter currently has [Issue 12693](https://bugs.chromium.org/p/gerrit/issues/detail?id=12693)
    as a known limitation.
* Bug Fixes

  + [Issue 12606](https://bugs.chromium.org/p/gerrit/issues/detail?id=12606):
    Fix `visibleto` predicate for groups.

    If a group name was used in the `visibleto` predicate, changes were
    not returned even if the group had permission to see them.
  + [Issue 12747](https://bugs.chromium.org/p/gerrit/issues/detail?id=12747):
    Fix change query visibility for internal user.
  + [Issue 12755](https://bugs.chromium.org/p/gerrit/issues/detail?id=12755):
    Block the removal of the Realm primary external ids.

    It was possible to remove the email address associated with the primary
    id of a Realm, effectively resulting in the account being removed.
  + [Isssue 12786](https://bugs.chromium.org/p/gerrit/issues/detail?id=12786):
    Fix wrong status returned when auth backend couldn’t be reached.

    The response 401 was returned when the auth backend could not be
    reached, instead of the response 503.
  + [Issue 14242](https://bugs.chromium.org/p/gerrit/issues/detail?id=12424):
    Fix email token verification failures caused by non-URL-encoded characters.
  + [Issue 11625](https://bugs.chromium.org/p/gerrit/issues/detail?id=11625):
    Avoid multiple notifications for existing reviewers.
  + Fix internal server error on parsing commit message during receive commits.
  + Add `autocomplete="off"` to LDAP login form.

    Some security tools will flag the absence of the autocomplete flag as a
    possible security issue, as it could allow for passwords to be saved and
    automatically filled in on shared computers.
  + Accept `--ownedby` as an alias of `--owned-by` in the groups REST API.

    The option was incorrectly documented as `--ownedBy` which resulted in an
    error “not a valid option” if anyone tried to use it.

    The documentation is fixed, and `--ownedby` is added as an alias so that it
    also works for anyone still referring to the old documentation.
  + Fix various misuses of the Flogger API causing exception details to be omitted
    in the log output.

    Exceptions were not properly passed to the logger which would cause the
    details to be omitted, or in some cases the message “ERROR: UNUSED LOG ARGUMENTS”
    to be emitted.

    - When an invalid PAPE response is received during OpenID authentication
    - When a plugin config is invalid and cannot be loaded
    - When an error occurs while migrating a change metadata entry to JSON
    - When there is an unsupported charset in a patch text
  + [Issue 12673](https://bugs.chromium.org/p/gerrit/issues/detail?id=12673):
    Fix emitting debug logs while running tests.
* PolyGerrit UI Fixes

  + [Issue 12707](https://bugs.chromium.org/p/gerrit/issues/detail?id=12707):
    Apply diff preferences immediately after pressing “Save”.
  + [Issue 12690](https://bugs.chromium.org/p/gerrit/issues/detail?id=12690):
    Only show the “Edit” button for open changes in the diff view.
  + [Issue 12726](https://bugs.chromium.org/p/gerrit/issues/detail?id=12726):
    Fix incorrect highlighting after `/` character in Javascript.
  + [Issue 12775](https://bugs.chromium.org/p/gerrit/issues/detail?id=12775):
    Fix parent of previous patch sets not being available.
  + [Issue 12385](https://bugs.chromium.org/p/gerrit/issues/detail?id=12385):
    Fix memory leak in `gr-plugin-endpoints`.
* Replication Plugin Fixes

  + [Issue 12678](https://bugs.chromium.org/p/gerrit/issues/detail?id=12678):
    Fix missing replication Id in replication logs.

    The migration to use Flogger in 2.16.17 caused a regression in the logging,
    where the replication Id was omitted from the logs. This is fixed by reverting
    back to slf4j logging for the replication log.
  + [Issue 12719](https://bugs.chromium.org/p/gerrit/issues/detail?id=12719):
    Fix `replication start --wait` to track in-flight collisions and to not fail.
  + [Issue 12731](https://bugs.chromium.org/p/gerrit/issues/detail?id=12731):
    Don’t lose state when there’s a pending push to the same ref.

    If there was already a pending push (not an in-flight push) to the same endpoint,
    the start for the push would be dropped when adding the push to the Destination.
    This meant that a `replication start --wait` command would never complete when
    one of its pushes was pending since its state would never receive the completion
    notification for that push.
  + [Issue 11745](https://bugs.chromium.org/p/gerrit/issues/detail?id=11745):
    Fix firing pending “..all..” events on startup.
  + [Issue 11760](https://bugs.chromium.org/p/gerrit/issues/detail?id=11760):
    Make persistent task keys stable.
  + Fix URL matching to match real URLs in addition to templated URLs.
  + Log when skipping deletion of a ref when pushing to a remote in mirror mode.
  + Improve logging of push failures caused by a lock failure on the remote.
  + Improve logging of refs to be pushed.
* Library Upgrades

  + Upgrade rules\_closure to forked version

    This fixes the “-parameters is not supported for target value 1.7. Use 1.8 or later.”
    warning when building. See [PR 478](https://github.com/bazelbuild/rules_closure/pull/478).
  + [Issue 12448](https://bugs.chromium.org/p/gerrit/issues/detail?id=12448):
    Upgrade Guice to 4.2.3 and switch to using no-AOP Guice distribution

    This allows to more easily support newer JDK versions.
  + Upgrade asm to 7.2
  + Upgrade jackson-core to 2.11.0
  + Upgrade jetty to 9.4.27.v20200227

### 3.0.8

* Breaking Changes

  + The `LogThreshold` annotation is removed.

    The default log level for tests has been changed from DEBUG to INFO,
    and this annotation is no longer needed. It was originally introduced
    to allow classes to explicitly set their log level at level other than
    DEBUG.

    Plugins that use this annotation must be adjusted.
* New Features

  + Add support for Elasticsearch 7.6.x.
  + Include `upload-pack` metrics in the sshd log.

    In order to enable detailed performance and problem analysis,
    `upload-pack` metrics are now included in the sshd log.
  + Add new configuration setting `core.packedGitUseStrongRefs`.

    When set to true, this option enables using strong references to reference
    packfile pages cached in the WindowCache. If this option is set Java gc can
    no longer flush the WindowCache to free memory if the used heap comes close
    to the maximum heap size. On the other hand this provides more predictable
    performance.
  + Add new configuration setting `sendemail.denyrcpt`.

    This new setting works alongside the existing `sendemail.allowrcpt`, and
    allows to configure email addresses or domains that Gerrit may not send to.
  + Allow to format HTTP and SSH logs in JSON format.

    When `log.jsonLogging` is enabled, the HTTP and SSH logs are formatted
    as JSON, making it easier for them to be parsed. Note that the error log
    was already formatted in JSON when this option was enabled.
  + Add new metrics.

    Metrics are added for:

    - Jetty connections
    - JGit WindowCache and total load time for block cache entries
    - Available number of cores
    - Average system load for the last minute

    Refer to the metrics documentation for full details.
  + [Issue 11493](https://bugs.chromium.org/p/gerrit/issues/detail?id=11493):
    Add an “Edit” button to the diff view in the PolyGerrit UI.
  + Add support for fsharp in highlighting syntax in the PolyGerrit UI.
  + [Issue 12364](https://bugs.chromium.org/p/gerrit/issues/detail?id=12364):
    Add support for going to a specific line number in the inline editor.
  + Add prolog predicate to determine number of parents.

    The new predicate `commit_parent_count` can be used to detect merge
    commits.
  + Add `NamedFluentLogger`.

    `NamedFluentLogger` is an extension to Flogger that allows to create
    a logger with a given name rather than the name of the enclosing class.
  + [Issue 12444](https://bugs.chromium.org/p/gerrit/issues/detail?id=12444):
    Add support for `max_result_window` in Elasticsearch index configuration.
  + Add a Code Coverage layer and plugin API in the PolyGerrit UI.

    See [Chromium issue 939904](https://bugs.chromium.org/p/chromium/issues/detail?id=939904)
    for details.
* Library Upgrades

  + Upgrade gitiles-servlet and blame-cache to 0.2-12
  + Upgrade jackson-core to 2.10.3
  + Upgrade Jetty to 9.4.24.v20191120, including a fix for supporting IPv6.
  + Upgrade rules\_closure to forked version.

    This fixes the “-parameters is not supported for target value 1.7. Use 1.8 or later.”
    warning when building. See [PR 478](https://github.com/bazelbuild/rules_closure/pull/478).
* Security Fixes

  + [Issue 12440](https://bugs.chromium.org/p/gerrit/issues/detail?id=12440):
    Fix the access-path for AbstractGitCommand subclasses.

    The access path for the Receive.currentUser in the receive-pack command
    was wrongly set to SSH\_COMMAND instead of to GIT.
    This allowed project owners to force-update a ref using git-over-SSH
    without having en explicit permission for that.
* Bug Fixes

  + Fix size explosion of `All-Users` caused by draft comment removal.

    Modify draft comments generation so that, when removed, they to point to an
    empty parent.
  + [Issue 11772](https://bugs.chromium.org/p/gerrit/issues/detail?id=11772):
    Cancel deprecation of change identifiers that was planned since 2.16.

    Since 2.16 the documentation of change identifiers states that the
    identifiers other than `<project>~<numericid>` are deprecated and will
    be removed in a future release. Since then the identifiers have still
    not been removed and there is no clear plan to do so.

    It is likely that “deprecated” identifiers are still used in links in
    places where they can’t be updated, for example in emails and forum
    posts. Due to this, and since continuing to support all of the types
    does not add any technical burden, ESC decided that the deprecation
    should be cancelled.

    The `change.api.allowedIdentifier` configuration setting is now
    obsolete and has been removed.
  + [Issue 3340](https://bugs.chromium.org/p/gerrit/issues/detail?id=3340):
    Fix internal server errors when setting project access permission with bad regex.
  + Fix removal of stale metrics from the metrics registry.
  + [Issue 12349](https://bugs.chromium.org/p/gerrit/issues/detail?id=12349):
    Fix time attribute of file entries in plugin artifacts.
  + Make assumption on number of query results explicit for change Id arguments.

    When a change Id passed as argument was resolved to multiple changes,
    the first returned change was arbitrarily used. Now an error will be raised
    and logged.
  + download-commands plugin: Set SSH default port to 22.
  + Document dependency from account deactivator to autoUpdateAccountActiveStatus
    and log a warning if the account deactivation task is configured but will not
    be scheduled.
  + Fix handling of ambiguous name in `visibleto` search predicate.

    If the `visibleto` search predicate was used with a display name that
    resolved to more than one account, the first account in the result was
    arbitrarily used. Now, this case will result in an error.
  + Fix a dependency injection runtime error in DeleteZombieDrafts program.
  + [Issue 12473](https://bugs.chromium.org/p/gerrit/issues/detail?id=12473):
    Fix broken links in Elasticsearch configuration documentation.
* PolyGerrit UI Fixes

  + [Issue 4616](https://bugs.chromium.org/p/gerrit/issues/detail?id=4616):
    Open commentlinks to changes on the same server in the same tab.
  + [Issue 12031](https://bugs.chromium.org/p/gerrit/issues/detail?id=12031):
    Fix issues with caching edited commit message.
  + Remove `target=_self` from commentlinks.
* Replication Plugin Fixes

  + Add method to push changes directly to given replica; intended to be used
    by other plugins that extend the replication plugin.
  + Check nulls in firePendingEvents at startup.

    After a sudden reboot (for unknown reason) Gerrit at startup couldn’t
    load because of NullPointerException.
  + Change default for the `replicateOnStartup` to false.
  + Don’t lose `ref-updated` events on plugin restart.

    When a `ref-updated` event is received, persist the event in the directory
    defined by the `replication.eventsDirectory`. When the updated ref is
    replicated delete the persisted event.
* Packaging Fixes

  + [Issue 12355](https://bugs.chromium.org/p/gerrit/issues/detail?id=12355):
    Do not overwirte /etc/default/gerritcodereview upon upgrade.
* Other Fixes

  + Fix various minor coding issues reported by Error Prone and Sonar Lint.
  + Reduce log spam of ‘Repository not found’ stack traces.
  + [Issue 11953](https://bugs.chromium.org/p/gerrit/issues/detail?id=11953):
    Reduce log spam during tests by reducing the default log level to INFO.

    The log level can now be explicitly set by the `GERRIT_LOG_LEVEL` system
    variable.

    The `LogThreshold` annotation is removed.

### 3.0.7

* New Features

  + Include request description in HTTP thread names.

    The HTTP worker threads had generic names like `HTTP-100`, `HTTP-101`,
    etc. While we could conclude from the stack trace what this thread was
    doing, we missed some important information like repository name, user name,
    etc.

    The HTTP threads now have descriptive names. For example, if there is an
    ongoing git-fetch operation we will see a thread named like:
    `HTTP POST /a/myProject/git-upload-pack (johndoe from 10.87.75.169)`.

    This makes the naming consistent with SSHD threads, which are named like:
    `SSH git-upload-pack /myProject (johndoe)`.
  + New metrics for Jetty threadpool.

    The new metrics are exposed under `http/server/jetty/*`.
  + Utility program to delete zombie draft comment refs.

    Deletion of draft comment refs was broken until 2.16.14, resulting in
    draft comment refs not getting deleted properly. Although it has been fixed,
    it’s still possible that zombie refs exist from previous versions. The
    new site program `DeleteZombieCommentsRefs` can be used to remove them.
  + Highlight `WORKSPACE` and `BUILD.bazel` files as Python in the PolyGerrit UI.
* Breaking Changes

  + The `MessageOfTheDay` extension point was removed.

    The `MessageOfTheDay` functionality was not ported to the PolyGerrit-UI and
    the `MessageOfTheDay` extension point was removed with the 3.0.7 release.
    However, the JS API provides the `banner` entrypoint for plugins to add messages
    to the UI. Plugins that were previously using the `MessageOfTheDay` extension
    point have to be adapted accordingly.
* Bug Fixes

  + [Issue 12246](https://bugs.chromium.org/p/gerrit/issues/detail?id=12246):
    Fix generation of duplicate `Change-Id`s when creating a new change via REST.

    The `Change-Id` was computed from the commit content and the timestamp,
    which resulted in the possibility for two changes to get the same `Change-Id`
    when two empty changes were created by REST at the same time.

    The `Change-Id` is now generated randomly.
  + [Issue 12097](https://bugs.chromium.org/p/gerrit/issues/detail?id=12097):
    Fix migration to NoteDb when orphan changes exist.

    In the case where a change belonged to a repository that did not exist,
    the migration failed.
  + [Issue 9296](https://bugs.chromium.org/p/gerrit/issues/detail?id=9296):
    Fix wrong diff of commit message between different patch sets of a merge commit.
  + [Issue 7969](https://bugs.chromium.org/p/gerrit/issues/detail?id=7969):
    Fix internal server error when diffing `MERGE_LIST` between different patch sets
    of a merge commit.
  + [Issue 10397](https://bugs.chromium.org/p/gerrit/issues/detail?id=10397):
    Don’t send notification email when publishing a change edit on a WIP change.
  + [Issue 12243](https://bugs.chromium.org/p/gerrit/issues/detail?id=12243):
    Fix unexpected deactivation of service user accounts.
  + Fix editing name and email for service user accounts.
  + Fix internal server error when a change edit includes an invalid file path.

    Invalid file paths are now rejected as ‘400 Bad Request’.
  + Don’t check for conflicting refs when deleting a ref; improve performance of
    migration to schema 167.

    The migration to schema 167 involves deletion of refs. The performance was
    poor for large installations (for example 30k user refs and 20k groups)
    because the ref deletion implementation was doing an unnecessary check for
    conflicting refs.
  + Fix setting `_moreChanges` to the wrong value in change query REST results.
  + Upgrade highlight-js to get various fixes in source code highlighting:

    - fix(makefile) fix double relevance for assignments
    - (xml) expand and improve document type highlighting
    - fix(kotlin): fix termination of “”” string literals
    - (cpp) Add additional keywords
    - Backslash is not used to escape in strings in standard SQL
    - (javascript) fix jsx self-closing tag issues
    - enh(ini) support arrays and much cleaner grammar
    - (javascript) support jsx fragments
* PolyGerrit UI Fixes

  + [Issue 11980](https://bugs.chromium.org/p/gerrit/issues/detail?id=11980):
    Fix handling of LDAP groups containing a dot in the PolyGerrit permissions screen.
  + [Issue 12197](https://bugs.chromium.org/p/gerrit/issues/detail?id=12197):
    Fix rendering of commentlinks using `link`.
* Other Changes

  + Upgrade jackson-core dependency to 2.10.2
  + Improve logging when a metadata update fails.
  + Update [external Ids documentation](http://gerrit-documentation.storage.googleapis.com/Documentation/3.0.7/config-accounts.html#external-ids)
    with information on how to find the sha1 of an external Id and how to show the
    corresponding change note.

### 3.0.6

* New Features

  + Include thread name in the HTTPD and SSHD logs.

    Having thread name in the HTTPD and SSHD logs makes it easier to match entries
    from the error log. The error log entries already contain the thread name, so
    with the thread name included in each entry in the HTTPD and SSHD logs, we have
    more data to match an error to a request than just the timestamp.
* PolyGerrit UI Fixes

  + [Issue 12067](https://bugs.chromium.org/p/gerrit/issues/detail?id=12067):
    Fix blank screen after upgrading.
* Other Fixes

  + [Issue 12070](https://bugs.chromium.org/p/gerrit/issues/detail?id=12070):
    Fix internal server error on git over HTTP calls when SSHD is enabled.

    Double cleanup of the request context caused an internal server error on
    push or fetch via git over HTTP.
  + Fix generation of SSH keys with empty passphrase.

    The `-N` option of `ssh-keygen` was correctly used for generation of RSA keys,
    but for other types `-P` was used.
  + Extend documentation of external Ids to include examples of how to generate
    the sha1 of an external Id and how to show the git note of the Id.

### 3.0.5

* New Features

  + [Issue 11973](https://bugs.chromium.org/p/gerrit/issues/detail?id=11973):
    Add copy-to-clipboard for generated HTTP password.
  + Add support for doctag in PolyGerrit UI syntax highlighter.
  + Add an event interface in the PolyGerrit API.
  + Add support for Elasticsearch 7.5.
  + Add documentation of how to perform backups of Gerrit.
* Breaking Changes

  + The default and minimum value of `execution.defaultThreadPoolSize` is
    increased to 2.
* PolyGerrit UI Fixes

  + [Issue 11993](https://bugs.chromium.org/p/gerrit/issues/detail?id=11993):
    Stop loading fonts from external resources.
  + [Issue 11984](https://bugs.chromium.org/p/gerrit/issues/detail?id=11984):
    Fix top menu bar on iOS.
  + [Issue 8282](https://bugs.chromium.org/p/gerrit/issues/detail?id=8282):
    Avoid browser caching for diff on edit patch.
  + [Issue 9444](https://bugs.chromium.org/p/gerrit/issues/detail?id=9444):
    Fix syntax highlighting for multi-char char constants.
  + [Issue 12020](https://bugs.chromium.org/p/gerrit/issues/detail?id=12020):
    Fix ‘New Contributor Agreement’ screen.
  + Fix `gr-syntax-params` css class.
  + Fix overflow of branch name in change list.
* Other Fixes

  + [Issue 7645](https://bugs.chromium.org/p/gerrit/issues/detail?id=7645):
    Fix thread deadlock when loading accounts from the account cache.

    Replacing Guava caches with Caffeine reduces the chances of having the
    deadlocks and improves the cache performance.
  + [Issue 11918](https://bugs.chromium.org/p/gerrit/issues/detail?id=11918):
    Fix internal server error when deleting a tag or branch by git push.
  + [Issue 5082](https://bugs.chromium.org/p/gerrit/issues/detail?id=5082):
    Upgrade gitiles blame-cache to 0.2-11 to fix internal server error when getting
    blame for file.
  + [Issue 11650](https://bugs.chromium.org/p/gerrit/issues/detail?id=11650):
    Fix reindexing of changes after project is deleted in the `delete-project` plugin.
  + Disallow deleting the `refs/meta/config` branch via the ‘Delete Branches’
    REST API.
  + Disallow deleting the `HEAD` ref via the ‘Delete Branches’ REST API.
  + Allow empty base revision in the ‘Create Branch’ and ‘Create Tag’
    REST APIs.
  + Fix deletion of draft comment refs.

    In some situations, draft comment refs were not properly deleted
    but left empty. This resulted in unused draft refs persisting in
    the `All-Users` repository, polluting the namespace. Published draft
    comments as well as deleted draft comments were kept in the history
    of the draft ref, keeping them alive for GC, and causing a steady
    increase of repository size.
  + Use correct content type `text/plain` instead of `plain/text` in ‘Create SSH Key’
    REST API.
  + Fix handling of interactive/batch users in the QoS filter.

    For the git-over-http requests this filter didn’t work properly because the
    basic authentication happened later in the filter chain and at the moment when
    the QoS filter was invoked the current user was not yet set.
  + Add project name to headers of outgoing change emails.
  + Fix and expand documentation of `ref-update` and `commit-received` hooks
    in the hooks plugin.
  + Upgrade jackson-core to 2.10.1.

### 3.0.4

* New features:

  + Add a method on `ProjectConfig` to read from the repository.

    Add a method that allows to read the config from the repository without
    having to provide a `MetaDataUpdate` instance.
  + New syntax highlighting files format supported.

    Highlight handlebars, Jinja2, Jenkinsfile, Soy and VHDL formats;
    associate cproj, xaml and svg as xml.
  + New `getConfig()` method in the PolyGerrit Plugin RestApi interface.

    Make the PolyGerrit RestApi interface to retrieve the server config and to cache it,
    accessible to plugins.
  + Add “readOnly” endpoint parameter to repo-config endpoint in PolyGerrit Plugin RestApi.
* PolyGerrit UI Fixes:

  + Hide “HTTP Credentials” if auth is not `HTTP` or `HTTP_LDAP`.
  + [Issue 11782](https://bugs.chromium.org/p/gerrit/issues/detail?id=11782):
    Fix assignment of CSS style for CodeReview -1 labels within comments.
  + [Issue 7083](https://bugs.chromium.org/p/gerrit/issues/detail?id=7083):
    Stop query from executing if predicate is empty.
  + [Issue 8513](https://bugs.chromium.org/p/gerrit/issues/detail?id=8513):
    Add the SHA hash of each patchset in dropdown menu as it was in the old GWT UI.
  + [Issue 11715](https://bugs.chromium.org/p/gerrit/issues/detail?id=11715):
    Fix total additions/deletions counters when viewing diff against parent 1 on merge commit.
  + [Issue 11682](https://bugs.chromium.org/p/gerrit/issues/detail?id=11682):
    Fix some corner-cases in the diff view where the download file feature did not work for
    added, renamed and deleted files.
  + [Issue 10047](https://bugs.chromium.org/p/gerrit/issues/detail?id=10047):
    Add shortcut to copy ssh-rsa public key.
  + [Issue 7867](https://bugs.chromium.org/p/gerrit/issues/detail?id=7867):
    Allow downloading a regular file from the patch set, from both base version
    and specific patch set version. It is implemented as a dropdown.
* Elasticsearch Updates:

  + Add support for Elasticsearch 7.4.
  + Update elasticsearch-rest-client to 7.4.2.
* JGit Updates:

  + Upgrade JGit to 5.3.6.201910020505-r.

    This JGit version brings significant performance improvement in the case when
    Gerrit loads all external-ids from NoteDb. This happens whenever the
    external\_ids\_map cache gets invalidated or expires.
* Other fixes:

  + Fix internal server error when non-existing base revision is given in input
    to Cherry Pick Change REST API.
  + Remove error log when user tried to delete current branch with the Delete Branch
    REST API endpoint.
  + Fix the response status code when an error occurred in the Delete Branch/Tag REST API
    endpoint.

    The endpoint returned “409 Conflict” but should return “500 Internal Server Error”.
  + Fix the response status code then an error occurred in the Update/Delete GPG Keys
    REST API endpoint.

    The endpoint returned “409 Conflict” but should return “500 Internal Server Error”.
  + [Issue 9001](https://bugs.chromium.org/p/gerrit/issues/detail?id=9001):
    Fix external-id consistency checker e-mail validation.

    Do not enforce emails on external IDs to be globally unique but allow the same e-mail
    repeated multiple times as long as it associated to the same account id.
  + Fix change message when automatically abandoning a change for a project
    that has been deleted.

    The change message and the message tag were inverted.
  + Fix commit message subject when updating project description by REST API.

    The tense of the commit message subject was inconsistent with other similar
    messages.
  + Fix commit timestamp when updating project configurations.

    For some REST API operations that update the project configuration, the
    commit that does the update on `refs/meta/config` had the wrong timestamp.
    Rather than being the time of the actual commit, it was always the time
    of the server startup.

    This was the case for the following operations:

    - Updating the description.
    - Setting the parent project.
    - Updating group names while getting access settings.
  + Upgrade jackson-core to 2.10.0.

    This version includes a fix for [CVE-2019-12384](https://nvd.nist.gov/vuln/detail/CVE-2019-12384).
  + Add more detailed debug logging when not sending an outgoing email.

    There are several conditions that could cause sending of an outgoing
    email to be skipped. These are now logged at debug level.
  + Increase severity to error for logging of exceptions during site initialization.
  + [Issue 4824](https://bugs.chromium.org/p/gerrit/issues/detail?id=4824):
    Handle multiple `httpd.listenUrl` values.

    Per the [documentation](http://gerrit-documentation.storage.googleapis.com/Documentation/3.0.4/config-gerrit.html#httpd.listenUrl),
    multiple values are supported, but if multiple values were specified Gerrit
    would fail to start.
  + Do not overwrite `httpd.listenUrl` during init, until the input has been checked as valid.

    Fix a bug where during the Gerrit init in interactive mode the input was
    invalid for the HTTP daemon settings, but still written to the configuration file.
  + Add `adder` in the `reviewer-added` event.

### 3.0.3

* Breaking Changes

  + The `weblinksOnly` option is removed from the `Get Diff` REST API endpoint.

    This option was only used by the GWT UI which has been removed. This is a
    breaking change for any other clients that are using it.
* New Features

  + [Issue 6029](https://bugs.chromium.org/p/gerrit/issues/detail?id=6029):
    Add support for downloading binary files.
  + [Issue 11205](https://bugs.chromium.org/p/gerrit/issues/detail?id=11205):
    Allow Gerrit admins to reindex a change even when Read access is not allowed
    on its target branch.
  + Extend the [`addMenuLink` method](http://gerrit-documentation.storage.googleapis.com/Documentation/3.0.3/pg-plugin-admin-api.html#_addmenulink)
    in the PolyGerrit plugin API to allow plugins to specify a capability that
    users must have in order to view a top menu item provided by the plugin.
  + Utility script `remove-notedb-refs.sh` which can be used to remove all refs
    created for NoteDb in case of rollback to ReviewDb.
  + [Issue 11356](https://bugs.chromium.org/p/gerrit/issues/detail?id=11356):
    Allow to override auto-detected Lucene index configuration.

    The new settings
    [`index.name.maxMergeCount`](http://gerrit-documentation.storage.googleapis.com/Documentation/3.0.3/config-gerrit.html#index.name.maxMergeCount),
    [`index.name.maxThreadCount`](http://gerrit-documentation.storage.googleapis.com/Documentation/3.0.3/config-gerrit.html#index.name.maxThreadCount) and
    [`index.name.enableAutoIOThrottle`](http://gerrit-documentation.storage.googleapis.com/Documentation/3.0.3/config-gerrit.html#index.name.enableAutoIOThrottle)
    allow to manually configure the Lucene index, rather than using auto-detected
    values, to improve performance.
* PolyGerrit UI Fixes

  + [Issue 10166](https://bugs.chromium.org/p/gerrit/issues/detail?id=10166):
    Add shortcuts for dashboard and watched changes in PolyGerrit.
  + [Issue 11592](https://bugs.chromium.org/p/gerrit/issues/detail?id=11592):
    Replace `${project}` in a `foreach` query for project dashboards.
  + [Issue 10047](https://bugs.chromium.org/p/gerrit/issues/detail?id=10047):
    Add missing copy buttons for SSH and GPG keys.
  + [Issue 11623](https://bugs.chromium.org/p/gerrit/issues/detail?id=11623):
    Remove leftover handling of GWT’s change edit identifiers.
  + [Issue 11562](https://bugs.chromium.org/p/gerrit/issues/detail?id=11562):
    Fix handling of the “Send feedback” conditional display.
  + Fix regular expression in link text parsing.
  + [Issue 11682](https://bugs.chromium.org/p/gerrit/issues/detail?id=11682):
    Fix edge cases in the download dropdown.

    - Fix support for file addition, deletion and rename.
    - Fix left side content URL when diffing against non base revision, e.g. `2..3`.
  + Various improvements of the UX with colors in dark theme.

    See [issue 11224](https://bugs.chromium.org/p/gerrit/issues/detail?id=11224),
    [issue 11213](https://bugs.chromium.org/p/gerrit/issues/detail?id=11213), and
    [issue 11004](https://bugs.chromium.org/p/gerrit/issues/detail?id=11004).
  + Upgrade highlight.js to get various syntax highlighting improvements.

    - [Issue 11666](https://bugs.chromium.org/p/gerrit/issues/detail?id=11666):
      Improved support for dart keywords.
    - SVG is added as an alias to xml.js and highlighted as XML.
    - JavaScript supports big number syntax now.
    - cpp syntax highlighting improved.
    - JSON gains support for highlighting comments.
    - C++ gains more keywords.
    - YAML improves matching keys.
* Elasticsearch Updates

  + Add support for Elasticsearch 7.4.
  + Update elasticsearch-rest-client to 7.4.0.
* Other Fixes

  + Various fixes in the ‘Create Change’ REST API endpoint:

    - Fix internal server error when creating a merge commit fails with
      `NoMergeBaseException`.
    - Reject creation of a merge commit on a non-existing branch.
    - Fail with the correct error message when destination branch does not
      exist.
    - Fix internal server error when target branch does not exist and the
      parent option is given.
    - Fix internal server error when base commit does not exist.
  + [Issue 11644](https://bugs.chromium.org/p/gerrit/issues/detail?id=11644):
    Fix setting project description when creating a project by REST API and setting
    plugin configs at the same time.
  + [Issue 11374](https://bugs.chromium.org/p/gerrit/issues/detail?id=11374):
    Fix handling of plugin capabilities on modification of child collections.
  + Fix init to not overwrite `httpd.listenUrl` until the input has been validated.
  + [Issue 11246](https://bugs.chromium.org/p/gerrit/issues/detail?id=11246):
    Allow duplicate email addresses to be associated to the same user account.
  + [Issue 11367](https://bugs.chromium.org/p/gerrit/issues/detail?id=11367):
    Fix querying inactive user changes.
  + [Issue 11491](https://bugs.chromium.org/p/gerrit/issues/detail?id=11491):
    Fix git clone/fetch/pull over SSH in high-latency network ending with
    `SSH_MSG_CHANNEL_WINDOW_ADJUST` error.
  + [Issue 11442](https://bugs.chromium.org/p/gerrit/issues/detail?id=11442):
    Fix push failing with internal server error sporadically when
    `notedb.changes.read=True` is configured.
  + [Issue 11444](https://bugs.chromium.org/p/gerrit/issues/detail?id=11444):
    Fix the wrong progress output during online migration in error\_log and use
    the correct charset conversion.
  + Fix change message when automatically abandoning a change for a project
    that has been deleted.

    The change message and the message tag were inverted.
  + [Issue 11137](https://bugs.chromium.org/p/gerrit/issues/detail?id=11137):
    Remove the `gerrit.reportBugText` configuration option.

    This option was only used in GWT, which has been removed.
  + Upgrade JGit to 5.3.5.201909031855-r.

    This version includes a fix for racy atomic ref updates.
* Replication Plugin Fixes

  + [Issue 11145](https://bugs.chromium.org/p/gerrit/issues/detail?id=11145):
    Drain replication queue before stopping the plugin.
  + [Issue 11424](https://bugs.chromium.org/p/gerrit/issues/detail?id=11424):
    Fix ReplicationTasksStorage exceptions in error\_log when triggering replication
    of all refs.
  + [Issue 11573](https://bugs.chromium.org/p/gerrit/issues/detail?id=11573):
    Fix dropping events during plugin restart.
* Singleusergroup Plugin Fixes

  + [Issue 11498](https://bugs.chromium.org/p/gerrit/issues/detail?id=11498):
    Fix group resolution for all numeric usernames.

### 3.0.2

* **Breaking Changes**

  + Increase default number of SSHD threads to at least 4.

    The default value of the `sshd.threads` setting is changed to be either two
    times the number of available CPU cores, or 4, whichever is greater.
  + [Issue 11216](https://bugs.chromium.org/p/gerrit/issues/detail?id=11216):
    Remove hard-coded bug tracker URL and use configured value if present.
* New Features

  + [Issue 11201](https://bugs.chromium.org/p/gerrit/issues/detail?id=11201):
    Add ability to have custom label with a missing text value in PolyGerrit
  + Add a PolyGerrit extension point to show a small banner next to the search bar.

    A plugin or a site theme (gerrit-theme.html) may register a custom
    Element to be inserted into this endpoint.
  + Expose Gerrit’s GWT client library in the plugin API
  + [Issue 5791](https://bugs.chromium.org/p/gerrit/issues/detail?id=5791):
    Add an extension point to allow setting a site banner.
  + Add an extension point to allow custom site footers.
  + Extend QuotaBackend and QuotaEnforcer extension points.
  + Introduce repository size quota enforcer.

    Introduce “/repository:size” quota group that gets examined
    when commits get pushed to the repository.
  + [Issue 11028](https://bugs.chromium.org/p/gerrit/issues/detail?id=11028):
    Add support for “Link Another Identity” screen in PolyGerrit
  + CommitApi: Add method to get commit info
  + Allow to set content type in the PolyGerrit plugin REST API interface
  + Add `changeCleanup.cleanupAccountPatchReview` configuration parameter to
    wipe out AccountPatchReview data when change gets auto-abandoned.
* Elasticsearch Updates

  + [Issue 11266](https://bugs.chromium.org/p/gerrit/issues/detail?id=11266):
    Add support for Elasticsearch 6.8.
  + [Issue 11267](https://bugs.chromium.org/p/gerrit/issues/detail?id=11267):
    Add support for Elasticsearch 7.3.
  + Update elasticsearch-rest-client to 7.3.1.
* PolyGerrit UI Fixes

  + [Issue 11350](https://bugs.chromium.org/p/gerrit/issues/detail?id=11350):
    Upgrade highlight.js to latest master revision.
  + [Issue 11096](https://bugs.chromium.org/p/gerrit/issues/detail?id=11096):
    Fix page not opening after a couple of times switching between GWT and PolyGerrit UI.
  + Fix dialog popup when going to /admin/create-project.
  + Add support for /groups
  + Redirect /groups/self to /settings/#Groups
  + [Issue 10733](https://bugs.chromium.org/p/gerrit/issues/detail?id=10733):
    Fix anchors not working at page load on settings page
  + [Issue 10062](https://bugs.chromium.org/p/gerrit/issues/detail?id=10062):
    Fix Polygerrit converting plus (+) to space when calling email.confirm API,
    and then failing with “invalid token”
  + [Issue 11344](https://bugs.chromium.org/p/gerrit/issues/detail?id=11344):
    Fix commentlink URL and HTML links when canonical URL includes a base link.
* Other Fixes

  + [Issue 11348](https://bugs.chromium.org/p/gerrit/issues/detail?id=11348):
    Display on error\_log the progress of the online migration from ReviewDb to NoteDb.
  + [Issue 11235](https://bugs.chromium.org/p/gerrit/issues/detail?id=11235):

    Fix ls-user-refs reporting wrong results because it was not using the identity of the username
    given as parameter.
  + [Issue 11222](https://bugs.chromium.org/p/gerrit/issues/detail?id=11222):
    Skip receive.maxBatchCommits when skip-validation option is passed and a commit validator implements
    shouldValidateAllCommits
  + [Issue 11083](https://bugs.chromium.org/p/gerrit/issues/detail?id=11083):
    Set the correct new revision on change-merged events when submitting by push.

    When multiple changes are submitted at the same time by push, the new revision
    in all the change-merged events should be the revision of the head of the
    destination branch after all changes are submitted.
  + Adapt `gerrit.sh` script to work on Alpine Linux.
  + [Issue 10855](https://bugs.chromium.org/p/gerrit/issues/detail?id=10855):
    Fix standalone GWT plugin builds failing because of a broken transitive load of GWT\_PLUGIN\_DEPS for in-tree plugin builds
  + [Issue 11148](https://bugs.chromium.org/p/gerrit/issues/detail?id=11148):
    Speedup online reindex migration by skipping evaluation of submit rules for closed changes.
  + [Issue 11016](https://bugs.chromium.org/p/gerrit/issues/detail?id=11016):
    Fix Gerrit slave site init leads to update failure on system\_config caused by read-only transaction
  + [Issue 11106](https://bugs.chromium.org/p/gerrit/issues/detail?id=11106):
    Fix missing comment context for left side in email notifications.
  + [Issue 11110](https://bugs.chromium.org/p/gerrit/issues/detail?id=11110):
    Do not swallow the exceptions that caused REST-API to return with a status >= 400.
  + [Issue 11086](https://bugs.chromium.org/p/gerrit/issues/detail?id=11086):
    When a WIP change is implicitly merged by direct push to the branch, its WIP
    state is unset.
  + [Issue 11082](https://bugs.chromium.org/p/gerrit/issues/detail?id=11082):
    Close changes oldest first when submitting on push.
  + Submit: Fix wrong conflict resolution
  + Add methods on the change API to get comments and draft comments as lists.
  + Make DefaultChangeReportFormatter extendible by plugins.
  + Add back the oneByExternalId method on InternalAccountQuery.

    This was removed in 2.16 but is added back so it can be used by plugins
    and extensions.
  + Fix and expand documentation of REST API to get revision files
  + Fix detecting changes of parent trees when computing change kind for merge
    commit.

    A new patch set of a merge change is considered as NO\_CHANGE if the
    commits have the same delta and trees. For merge commits this includes
    comparing the trees of the parent commits.
  + Reduce log spam of “setting reductionLimit” debug messages of the Prolog
    engine.
  + [Issue 11325](https://bugs.chromium.org/p/gerrit/issues/detail?id=11325):
    Do not update change set modified date on ReviewDb when a user delete all its
    draft changes.
  + Fix rebase change REST API returned status code.

    The rebase change REST API return 422 Unprocessable Entity, instead of 500
    Internal Server Error, If the specified base change is missing
  + Catch all exceptions for reporting on Schema\_130 migration and display the
    name of the project that failed the migration.
  + [Issue 11271](https://bugs.chromium.org/p/gerrit/issues/detail?id=11271)
    Update rules\_go to 0.18.6 for compatibility with Bazel 0.27.0
  + [Issue 11248](https://bugs.chromium.org/p/gerrit/issues/detail?id=11248):
    Ensures that a newly added label in a parent project is available in the ACL
    configuration of a child project.
* Replication Plugin Fixes

  + [Issue 10852](https://bugs.chromium.org/p/gerrit/issues/detail?id=10852):
    Fix stale replications caused by in-flight pushes not properly removed when failed.
  + [Issue 11204](https://bugs.chromium.org/p/gerrit/issues/detail?id=11204):
    Fix creation of missing repository when replicating to a Gerrit server over HTTP.
  + [Issue 11175](https://bugs.chromium.org/p/gerrit/issues/detail?id=11175):
    Introduce new ref-filtering extension point for preventing replication of outdated SHA1s,
    mostly useful in a multi-site scenario to prevent split-brain.
  + [Issue 11055](https://bugs.chromium.org/p/gerrit/issues/detail?id=11055):
    Fix failure to start when re-triggering persisted events
  + [Issue 11172](https://bugs.chromium.org/p/gerrit/issues/detail?id=11172):
    Fix persisted event is removed before all replications to all nodes are completed.
  + When replication plugin is stopped or reloaded, mark all the currently pending replications as cancelled.
  + Allow to configure timeout for SSH connections and SSH commands.

    The timeouts can be configured with `gerrit.sshConnectionTimeout` and
    `gerrit.sshCommandTimeout`, respectively.
  + Make more classes and fields public/protected to ease extensibility.
  + Improve handling of remote repository creation failures.
  + Reintroduce boolean return value of methods in AdminApi.
  + Refactor AdminApiFactory to an interface with a default implementation that
    gets bound as a dynamic item, which can be replaced by derived implementations.
  + When rescheduling due to in-flight push also log the in-flight task ID.
* Hooks Plugin Fixes

  + [Issue 10823](https://bugs.chromium.org/p/gerrit/issues/detail?id=10823):
    Allow to configure the number of hook execution workers.

    By setting `hooks.executorThreads` the number of workers can be configured.
    If not set, it defaults to 1 which was the previously fixed value.

### 3.0.1

* Upgrade JGit to 5.3.1.201904271842-r.
* [Issue 10858](https://bugs.chromium.org/p/gerrit/issues/detail?id=10858):
  Fix starting Gerrit under Tomcat 8.
* [Issue 10664](https://bugs.chromium.org/p/gerrit/issues/detail?id=10664):
  Fix duplicate key detection in MySQL patch review database.
* [Issue 11016](https://bugs.chromium.org/p/gerrit/issues/detail?id=11016):
  Fix failure to initialize on slave.
* [Issue 10763](https://bugs.chromium.org/p/gerrit/issues/detail?id=10763):
  Fix ACLs to allow regexes for tag and ref permissions.

  The documentation states that reference names can also be described with
  a regular expression by prefixing the reference name with `^`, but the UI
  only showed the creation field when a non-regex name was used.
* [Issue 11082](https://bugs.chromium.org/p/gerrit/issues/detail?id=11082):
  Close changes oldest first when submitting on push.
* [Issue 11059](https://bugs.chromium.org/p/gerrit/issues/detail?id=11059):
  Fix setting `BLOCK` on partial label range in permissions.
* [Issue 10790](https://bugs.chromium.org/p/gerrit/issues/detail?id=10790):
  Avoid evaluating submit rules twice for open changes.

  Prolog submit rules were evaluated twice per page view for an open change,
  which caused performance degradation on projects defining complex rules.
* [Issue 10943](https://bugs.chromium.org/p/gerrit/issues/detail?id=10943):
  Set `References:` header on new change notification mail.

  GMail changed the way
  [emails are grouped in conversation view](https://gsuiteupdates.googleblog.com/2019/03/threading-changes-in-gmail-conversation-view.html),
  which, combined with the fact that
  [Amazon SES changes the `Message-ID` header](https://forums.aws.amazon.com/message.jspa?messageID=262855),
  resulted in the new change notification email not being grouped with
  subsequent emails related to the same change.
* [Issue 10952](https://bugs.chromium.org/p/gerrit/issues/detail?id=10952):
  Fix definition of `PID` in `gerrit.sh`.
* [Issue 10852](https://bugs.chromium.org/p/gerrit/issues/detail?id=10852):
  Replication plugin: Fix scheduling starvation.
* [Issue 10896](https://bugs.chromium.org/p/gerrit/issues/detail?id=10896):
  Fix eliding project name without slash in notification emails.
* [Issue 10359](https://bugs.chromium.org/p/gerrit/issues/detail?id=10359):
  LDAP: support servers that do not allow anonymous browsing.

  Add `ldap.supportAnonymous` configuration setting in gerrit.config to support
  servers that do not allow anonymous browsing. Default is true per standard and
  best practice.
* Show submit button with tooltip when not allowed to submit.

  The submit button was hidden when the user did not have permission to submit,
  or other conditions prevented submit (for example the change being WIP).
* Don’t send “GPG keys added” notification when no GPG keys were added.

  A GPG key update can include both addition and removal of GPG keys. The
  notification email for addition of new keys was always sent, even if the
  update only removed keys.
* Update email notifications on changing security related settings.

  Email notifications are now sent when a GPG or SSH key is removed, and
  when the HTTP password is deleted or changed.

  An email notification is now always sent when an SSH key is added to an
  account, even when it was added by an administrator.

  These notifications allow to alert the user if their account is compromised
  and keys or password are altered by the attacker.
* Remove explicit dependency on protobuf\_java.

  The protobuf\_java library is now consumed from rules\_closure.
* Improve performance of migration of accounts to schema 146.

  + Migration of the accounts is parallelized. The default number of threads
    used is the number of available processors. This can be customized using
    the `threadcount` system property.
  + Before the migration, `gc --prune=now` is executed.
  + When hosted on `FileRepository`, refs are packed after migration of every
    1000 accounts.
  + A progress indicator counts every 100 accounts migrated.
* Allow commit validation listeners to ignore the `skip-validation` push option.

  Gerrit allows certain users to skip validation of new commits by passing
  the `skip-validation` push option.

  A new method `shouldValidateAllCommits` is added on the
  `CommitValidationListener`, to allow plugin implemented validators to
  override this option and always be invoked for new commits. The new
  method has a default implementation that returns `false` meaning that
  existing implementations don’t need to be modified and will behave the
  same as before.
* Optimize commit and ref operation validation for non-ff push.

  On a non-ff push all the commits were validated before the ref operation
  was validated. On a push with many commits, validating all the commits is
  wasteful in the case where the ref operation is rejected. The logic is
  changed so that the ref operation validation is performed before the commit
  validation.
* Disallow change index task duplication.

  It was possible for multiple index tasks to be queued for the same change.
* Fix formatting issues and inconsistencies in soy email templates.
* Use URL Formatter interface to generate URL in outgoing emails.
* Fix error message when JRE is not found when starting Gerrit.

  The error message recommended to check for a JRE “>= 1.7”, but Gerrit requires
  Java 8 minimum.
* Expose the `createProject` method of the `CreateProject` class to plugins.

  This allows plugins to directly invoke the project creation, avoiding the
  checks that are performed when invoking via the `apply` method.
* Expose the jsr305 library in the plugin API.
* Upgrade gitiles to 0.2-10.

  Includes a fix for rendering of metalinks in the navigation bar.
* Elasticsearch Fixes

  + [Issue 10499](https://bugs.chromium.org/p/gerrit/issues/detail?id=10499):
    Set default number of shards according to Elasticsearch version.

    In Elasticsearch version 7.0 the default number of shards was reduced from
    5 to 1.

    See the [Elasticsearch documentation](https://www.elastic.co/guide/en/elasticsearch/reference/current/getting-started-concepts.html#getting-started-shards-and-replicas)
    for details.
  + [Issue 10496](https://bugs.chromium.org/p/gerrit/issues/detail?id=10496) and
    [Issue 10844](https://bugs.chromium.org/p/gerrit/issues/detail?id=10884):
    Fix usage of `include_type_name` in index creation.
  + Add support for Elasticsearch 7.1.
  + Upgrade elasticsearch-rest-client to 7.1.1.
* PolyGerrit UI Fixes

  + Only display 404 page on initial load.
  + Don’t reload when viewing dashboard.
  + Fix hiding the HTTP password screen.

    It was possible for the HTTP password to be un-hidden using CSS.
  + Add an extension point to allow adding links to the user header.
* Documentation Updates

  + [Issue 10897](https://bugs.chromium.org/p/gerrit/issues/detail?id=10897):
    Update links to Google individual and corporate CLA pages.
  + Clarify that account must have a username to be able to set HTTP password.
  + Fix formatting in project config documentation.

---

©2025 Gerrit. All rights reserved.

Site last generated: Jan 19, 2025

![Diffy](/images/diffy_logo.png)

[Privacy Notice](https://www.google.com/policies/privacy/)



=== Content from www.gerritcodereview.com_21ca3bff_20250119_111534.html ===


Toggle navigation

[Gerrit Code Review](/index.html)

* [About](/about.html)
* [News](/news.html)
* [Support](/support.html)

* Community
  + [Code of Conduct](/codeofconduct.html)
  + [Forums, Mailing lists etc.](/contact.html)
  + [Members](/members.html)
  + [Contributing](/contributing.html)
  + [Fixing a bug](/bug-fixing.html)
  + [Presentations](/presentations.html)
  + [Kudos](/kudos.html)
  + [User Stories](/userStories.html)
  + [Trademarks](/trademarks.html)
* Code
  + [Source](https://gerrit.googlesource.com/gerrit/)
  + [Releases](/releases-readme.html)
  + [Plugins](/plugins.html)
  + [Roadmap](/roadmap.html)
  + [Builds](https://gerrit-ci.gerritforge.com/)
  + [Reviews](https://gerrit-review.googlesource.com/q/status%3Aopen%2Bproject%3Agerrit)
* Docs
  + [Latest](https://gerrit-documentation.storage.googleapis.com/Documentation/3.11.1/index.html)
  + [Designs](/design-docs-index.html)
  + [Wiki](https://gerrit.googlesource.com/homepage/%2B/master/pages/site/docs/)
* Feedback

# Gerrit 3.2.x

Download: **[3.2.14](https://gerrit-releases.storage.googleapis.com/gerrit-3.2.14.war)**
| [3.2.13](https://gerrit-releases.storage.googleapis.com/gerrit-3.2.13.war)
| [3.2.12](https://gerrit-releases.storage.googleapis.com/gerrit-3.2.12.war)
| [3.2.11](https://gerrit-releases.storage.googleapis.com/gerrit-3.2.11.war)
| [3.2.10](https://gerrit-releases.storage.googleapis.com/gerrit-3.2.10.war)
| [3.2.8](https://gerrit-releases.storage.googleapis.com/gerrit-3.2.8.war)
| [3.2.7](https://gerrit-releases.storage.googleapis.com/gerrit-3.2.7.war)
| [3.2.6](https://gerrit-releases.storage.googleapis.com/gerrit-3.2.6.war)
| [3.2.5.1](https://gerrit-releases.storage.googleapis.com/gerrit-3.2.5.1.war)
| [3.2.5](https://gerrit-releases.storage.googleapis.com/gerrit-3.2.5.war)
| [3.2.3](https://gerrit-releases.storage.googleapis.com/gerrit-3.2.3.war)
| [3.2.2](https://gerrit-releases.storage.googleapis.com/gerrit-3.2.2.war)
| [3.2.1](https://gerrit-releases.storage.googleapis.com/gerrit-3.2.1.war)
| [3.2.0](https://gerrit-releases.storage.googleapis.com/gerrit-3.2.0.war)

Documentation: **[3.2.14](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.14/index.html)**
| [3.2.13](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.13/index.html)
| [3.2.12](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.12/index.html)
| [3.2.11](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.11/index.html)
| [3.2.10](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.10/index.html)
| [3.2.8](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.8/index.html)
| [3.2.7](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.7/index.html)
| [3.2.6](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.6/index.html)
| [3.2.5.1](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.5.1/index.html)
| [3.2.5](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.5/index.html)
| [3.2.3](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.3/index.html)
| [3.2.2](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.2/index.html)
| [3.2.1](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.1/index.html)
| [3.2.0](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.0/index.html)

## Release Highlights

* Polymer 3
* File Uploads in frontend
* Performance improvements on mergeability check and accounts caching
* Support for Java 11

## Important Notes

### Support for Java 11

Gerrit is now officially supported on Java 11, in addition to Java 8.
Running on Java 11 was already possible from v2.16.13, v3.0.4 and v3.1.0, but not officially
supported because of the lack of a CI validation on Java 11 for stable-2.16, stable-3.0
and stable-3.1 branches.

Please note that Java 11 has a number of improvements and breaking changes compared to Java 8.
Refer to the [Java 11 release notes for more details](https://www.oracle.com/technetwork/java/javase/11-relnote-issues-5012449.html).

Gerrit v3.2 has been validated with Java 11, with the following known issues:

* [Issue 11567](https://bugs.chromium.org/p/gerrit/issues/detail?id=11567):
  Java 11 runtime & startTLS LDAP broken: ‘error code 8 - BindSimple: Transport encryption’.
* [Issue 12639](https://bugs.chromium.org/p/gerrit/issues/detail?id=12639):
  WARNING: An illegal reflective access operation has occurred, when starting Gerrit.

### Schema Changes

This release contains schema changes. To upgrade:

```
  java -jar gerrit.war init -d site_path

```

The changes index version has been increased. To run off-line reindexing of
the changes (optional):

```
  java -jar gerrit.war reindex --index changes -d site_path

```

By default the changes index is automatically rebuilt upon the Gerrit startup
after the upgrade.

**PERFORMANCE WARNING**: The migration process performs the cleanup of
the zombie draft comments in the All-Users.git repository that have been
left behind since the introduction of NoteDb. It is highly recommended
to perform a `git gc --aggressive` of the All-Users.git repository *BEFORE*
running the migration. Also the reindex of all the changes can take a
significant amount of time for large-scale installations.

Also, make sure that the All-Users.git resides on
a fast access local filesystem for minimizing the migration time.

## Native packaging

* Upgrade the Docker/Ubuntu image to Ubuntu 20.04
* Upgrade the Docker/CentOS image to CentOS 8.1.1911
* Move to OpenJDK 11

  Gerrit v3.2 supports both Java 8 and 11. However, Java 11 is the best choice for
  large production servers thanks to the introduction of more advanced Garbage Collection
  [strategies and associated tuning for large heaps](https://docs.oracle.com/en/java/javase/11/gctuning/introduction-garbage-collection-tuning.html).

### Zero-downtime Upgrade

Gerrit supports zero-downtime upgrade from Gerrit v3.1.6 (or later) when configured using
a [high-availability configuration](https://gerrit.googlesource.com/plugins/high-availability/%2B/refs/heads/master/README.md),
when the Git repositories are stored in a shared filesystem such as NFS or similar.

For upgrading with zero-downtime, you should enable the rolling upgrade migration
in `gerrit.config` on both Gerrit masters by setting the
[`gerrit.experimentalRollingUpgrade`](http://gerrit-documentation.storage.googleapis.com/Documentation/3.2.0/config-gerrit.html)
to `true`.

During the zero-downtime upgrade, Gerrit end-users would not notice any outage
or service disruption. They will be able to perform the normal Gerrit operations
on the GUI or using the Git protocol.

The zero-downtime upgrade consists of the following steps:

1. Have Gerrit masters upgraded to v3.1.6 (or later) in high-availability configuration,
   healthy and able to handle the incoming traffic properly.
2. Set `gerrit.experimentalRollingUpgrade` to `true` in `gerrit.config` on both Gerrit masters.
3. Set the first Gerrit master unhealthy.
4. Shutdown the first Gerrit master and then upgrade to v3.2.
5. Startup the first Gerrit master and wait for the on-line reindex to complete.
6. Verify that the first Gerrit master is working properly and then make it healthy again.
7. Wait for the first Gerrit master to start serving traffic normally.
8. Repeat steps 3. to 7. for the second Gerrit master.
9. Remove `gerrit.experimentalRollingUpgrade` from `gerrit.config` on both Gerrit masters.

**NOTE**: During the zero-downtime upgrade, the nodes may experience an increase of CPU and memory
utilisation due to the online reindexing activity. If testing reveals that the nodes
are not able to keep sustained load in conjunction with the online reindexing, then you have
to follow the standard migration path.

### Breaking Changes

* [Issue 12527](https://bugs.chromium.org/p/gerrit/issues/detail?id=12527):
  Elasticsearch: Support for [EOL versions](https://www.elastic.co/support/eol)
  v5.6 and v6.0 to v6.5 is discontinued
* [Issue 12858](https://bugs.chromium.org/p/gerrit/issues/detail?id=12858):
  ListGroups: the –query2 option in the groups query REST-API has been renamed to
  –query
* Gerrit metrics associated with H2 disk-statistics are now disabled by default.
  The disk-statistics can be enabled again by setting
  [`cache.enableDiskStatMetrics`](http://gerrit-documentation.storage.googleapis.com/Documentation/3.2.0/config-gerrit.html#cache.enableDiskStatMetrics)
  in gerrit.config.
* The number of comments per change are limited to 5000, and their size to 16k.
  The limits can be customized in `gerrit.config` using the
  [change.maxComments](http://gerrit-documentation.storage.googleapis.com/Documentation/3.2.0/config-gerrit.html#change.maxComments) and
  [change.commentSizeLimit](http://gerrit-documentation.storage.googleapis.com/Documentation/3.2.0/config-gerrit.html#change.commentSizeLimit) settings.

## New Features

### Mergeability behavior and performance

This release introduces a configuration setting `change.mergeabilityComputationBehavior`
that defines when Gerrit computes the mergability of a change .

Computing the mergability of changes is an expensive operation that can be
become a bottleneck for large Gerrit installations. The new setting allows
administrators to control this expense. Please refer to the
[Gerrit documentation](http://gerrit-documentation.storage.googleapis.com/Documentation/3.2.0/config-gerrit.html#change.mergeabilityComputationBehavior)
for more details about this setting.

The setting
[`change.api.excludeMergeableInChangeInfo`](https://gerrit-documentation.storage.googleapis.com/Documentation/3.1.5/config-gerrit.html#change.api.excludeMergeableInChangeInfo)
is no longer used and may be removed from `gerrit.config`.

### New accounts cache

Introduction of a brand-new AccountCache decomposed into smaller chunks that can be
cached individually:

* External IDs + user name (cached in ExternalIdCache)
* CachedAccountDetails (newly cached)
* Gerrit’s default settings CachedAccountDetails – a new class representing all
  information stored under the user’s ref (`refs/users/<sharded-id>`)

The new structure is cleverly designed to require a lot less I/O when an entry needs to be
reloaded and lowering the ratio of cache-miss in case of user’s details updates.

### New external groups cache

Gerrit can be linked to external user directories like LDAP, providing Gerrit with
external users and groups. External groups can be added to Gerrit to restrict access
to refs and repos and are mainly used for permissions evaluation.

The following new additional caches have been introduced and can be customized in
`gerrit.config`:

* `groups_external`: Caches all the external groups available to Gerrit.
* `groups_external_persisted`: Caches all external groups available to Gerrit at
  some point in history.

### File Uploads

File Uploads are now supported in the User Interface or through the REST API.

### New Revert permission

Introduce a new permission to allow/deny the ability to revert a change through
the Gerrit UI.

The permission is automatically added to the `Registered Users` as part of the
schema upgrade. To deny reverts, Gerrit administrators should remove this permission
from `All-Projects` ACL.

### New is:merge merge operator for searching changes

Introduce the new `is:merge` operator for allowing to find changes that are
merge commits. This change requires a full reindex of the changes, which may take
quite a long time to compute for large-sized installations.

When choosing the on-line reindexing option (default) Gerrit can still operate
with the old index version, disabling the `is:merge` operator until the new index
has been successfully rebuilt.

### New SSH commands

New SSH commands introduced:

* `gerrit set-topic`: set the topic of a change (existing REST-API surfaced via SSH)
* `gerrit sequence show`: show the current sequences value from All-Projects.git or All-Users.git
* `gerrit sequence set`: set the next value for sequences in All-Projects.git or All-Users.git

### Review labels stickiness

* [Issue 12025](https://bugs.chromium.org/p/gerrit/issues/detail?id=12025)
  Allow to configure individual votes as sticky by setting the
  [`label.Label-Name.copyValue`](http://gerrit-documentation.storage.googleapis.com/Documentation/3.2.0/config-labels#label_copyValue) on the `project.config` labels.

### New CherryPickOf field for a change

After a change is created or updated using the ‘cherry-pick’ functionality,
the cherry-picked change includes a new field in the change info returned from REST APIs
called `CherryPickOf` with the source change number and the patchset.

### New Gerrit configuration: `instanceId`

Introduce the `instanceId` configuration for multi-master Gerrit setups.
For more details check:

* [Design doc](../../design-docs/instance-id.html)
* [Configuration](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.0/config-gerrit.html#gerrit.instanceId)
* [Trace event origin](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.0/dev-plugins.html#_trace_event_origin)

### Other performance optimizations

* Ability to configure the number of relevant changes to consider when suggesting
  the reviewers on the changes screen, using the `gerrit.config` setting
  [`suggest.relevantChanges`](http://gerrit-documentation.storage.googleapis.com/Documentation/3.2.0/config-gerrit.html#suggest.relevantChanges)

### PolyGerrit UI

The Gerrit frontend has been migrated from Polymer 2 to
[Polymer 3](https://polymer-library.polymer-project.org/3.0/docs/upgrade).

* Users can now cherry pick entire topics.
* Gerrit supports adding display names. Hosts can configure first name or username as default.
* The reply dialog now shows the entire comment thread instead of the comment list.
* [Issue 6293](https://bugs.chromium.org/p/gerrit/issues/detail?id=6293):
  More self-evident transitions from WIP state. “Start Review” button added to change view.
* [Issue 8153](https://bugs.chromium.org/p/gerrit/issues/detail?id=8153):
  Improvements to rebase indicator: display a hover card instead of a tooltip with the icon
  including the possible rebase action.
* [Issue 10444](https://bugs.chromium.org/p/gerrit/issues/detail?id=10444):
  UI for deleting change messages for Gerrit Administrators.
* [Issue 10890](https://bugs.chromium.org/p/gerrit/issues/detail?id=10890):
  Repository list: Move “Repository Browser” column left of “Description” column.
* [Issue 11441](https://bugs.chromium.org/p/gerrit/issues/detail?id=11441):
  Add in-product reminder to keep discussions respectful.

  Some code review discussions can become a bit rough and some people perceived
  discussions as not always respectful.
  Add an in-product reminder to keep discussions respectful when a reply is typed,
  optionally with linking to the code of conduct.
* [Issue 11493](https://bugs.chromium.org/p/gerrit/issues/detail?id=11493):
  Add an “Edit” button to the diff view in the PolyGerrit UI.
* [Issue 11521](https://bugs.chromium.org/p/gerrit/issues/detail?id=11521):
  Display trace ID in error popup if request failed and server did a trace.
* [Issue 11522](https://bugs.chromium.org/p/gerrit/issues/detail?id=11522):
  REST API for review labels in the project configuration.
* [Issue 11705](https://bugs.chromium.org/p/gerrit/issues/detail?id=11705):
  Show count of changes in User Dashboard.
* [Issue 11706](https://bugs.chromium.org/p/gerrit/issues/detail?id=11706):
  Allow editing the commit message as part of a change edit.
* [Issue 11973](https://bugs.chromium.org/p/gerrit/issues/detail?id=11973):
  Add copy-to-clipboard for generated HTTP password.
* [Issue 12364](https://bugs.chromium.org/p/gerrit/issues/detail?id=12364):
  Add support for going to a specific line number in the inline editor.

### Download commands plugin

* [Issue 11594](https://bugs.chromium.org/p/gerrit/issues/detail?id=11594)
  Merge the repo-vs-git logic into GitDownloadCommand directly.

  Created separate “getRepoCommand” and “getCommand” methods for
  downstream classes to extend with the default “getRepoCommand”
  defaulting to null.
* [Issue 11609](https://bugs.chromium.org/p/gerrit/issues/detail?id=11609)
  “Download patch” UI includes an option for also creating a local branch.

  A very standard workflow is to download a change from Gerrit then want
  to make edits and then repo upload the changes back to Gerrit.
  Allow developers who are not familiar with the idiosyncrasies of repo,
  to easily create a local branch when checking out changes.

### End-to-end tests

* Allow end-to-end tests to proportionally scale on their expected execution times.

  A `power_factor` [environment property](https://gerrit-review.googlesource.com/Documentation/dev-e2e-tests.html#_environment_properties)
  was added to the end-to-end tests core framework. Using that optional property,
  scenario steps can take some more (or less) time prior to expecting proper completion.

  The way to set that property locally then depends on the target runtime environment,
  or SUT latency. The property may be used for either core or plugin scenarios.
* `FlushProjectsCache` related scenarios added to core (and the `high-availability` plugin).
* Support for relative runtime weights in scenarios.

  Each scenario can now either weight like any other by default, or override that default
  with a greater weight value, compared to siblings that are lighter on execution times.

  Beside core, make the `high-availability` and `multi-site` plugin scenarios reuse this.
* Allow scenarios to create and delete Gerrit changes alongside projects.

  Add the corresponding core support for an optional `http` request body to every such
  `GerritSimulation`. Either automate or allow [environment properties](https://gerrit-review.googlesource.com/Documentation/dev-e2e-tests.html#_environment_properties)
  to feed the related input test data.

  Beside core, make the `high-availability` and `multi-site` plugin scenarios test changes
  that way. The latter currently has [Issue 12693](https://bugs.chromium.org/p/gerrit/issues/detail?id=12693)
  as a known limitation.

### REST APIs

* Accounts

  + `display_name` field added to all the endpoints returning the account details.
  + [New Set Display Name](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.0/rest-api-accounts.html#set-display-name) API for updating the account display name.
  + New [Modify Account](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.0/access-control.html#capability_modifyAccount)
    global capability is now required for
    [List Accounts Emails](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.0/rest-api-accounts.html#list-account-emails),
    [Get Account External IDs](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.0/rest-api-accounts.html#get-account-external-ids) and
    [Delete Account External IDs](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.0/rest-api-accounts.html#delete-account-external-ids)
    when used to access information that belongs to accounts other than the caller.
* Changes

  + [Query Changes](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.0/rest-api-changes.html#list-changes)
    API now supports a new `no-limit` parameter to remove the default limit on queries and return
    all results. This might not be supported by all index backends.
    Also, the `SKIP_MERGEABLE` option for skipping the mergeability flag option is not supported anymore.
  + [Revert Change](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.0/rest-api-changes.html#revert-change)
    now truncates the revert message if it exceeds 63 characters, by cutting it down to 59 characters
    with the ellipsis (`…​`) in the end.
    Also, the API requires now the new revert permission, otherwise a `403 Forbidden` status code is returned.
  + [Revert Submission](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.0/rest-api-changes.html#revert-submission)
    API for creating a submission-id for grouping multiple changes that belong to the same submission
    (e.g. topic submission).
  + [Change file content in Change Edit](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.0/rest-api-changes.html#put-edit-file)
    API supports now uploading binary content.
  + New [Preview Fix](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.0/rest-api-changes.html#preview-fix)
    API for gettings the diffs of all files for a certain fix-id. This is intended to be used in conjunction
    with robot comments.
  + New `allow_conflicts` option in all REST-API that perform a server-side merge or cherry-pick.
* Groups

  + [Query Groups](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.0/rest-api-groups.html#query-groups)
    API accepts the `query` as parameter for groups filtering, instead of the `query2` which was
    a temporary name given to avoid clashes with an earlier deprecated parameter.
* Projects

  + Brand-new set of [Label Endpoints](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.0/rest-api-projects.html#label-endpoints)
    API for managing the project review labels in a programmatic way, without having
    to directly modify directly the `project.config` in the `refs/meta/config` of
    the repository.

## Bug Fixes

* Replication plugin fixes

  + [Issue 11672](https://bugs.chromium.org/p/gerrit/issues/detail?id=11672):
    Change the storage structure of the persisted replication tasks to avoid losing events.
  + [Issue 11745](https://bugs.chromium.org/p/gerrit/issues/detail?id=11745):
    Fix firing pending “..all..” events on startup.
  + [Issue 11760](https://bugs.chromium.org/p/gerrit/issues/detail?id=11760):
    Make persistent task keys stable.
  + [Issue 12678](https://bugs.chromium.org/p/gerrit/issues/detail?id=12678):
    Fix missing replication Id in replication logs.
  + [Issue 12719](https://bugs.chromium.org/p/gerrit/issues/detail?id=12719):
    Fix `replication start --wait` to track in-flight collisions and to not fail.
  + [Issue 12731](https://bugs.chromium.org/p/gerrit/issues/detail?id=12731):
    Don’t lose state when there’s a pending push to the same ref.
* PolyGerrit fixes

  + [Issue 4616](https://bugs.chromium.org/p/gerrit/issues/detail?id=4616):
    Open commentlinks to changes on the same server in the same tab.
  + [Issue 7083](https://bugs.chromium.org/p/gerrit/issues/detail?id=7083):
    Stop query from executing if predicate is empty.
  + [Issue 8068](https://bugs.chromium.org/p/gerrit/issues/detail?id=8068):
    Fix screenreader: In unified mode, stop showing “0 added/removed”.
  + [Issue 9296](https://bugs.chromium.org/p/gerrit/issues/detail?id=9296):
    Fix wrong diff of commit message between different patch sets of a merge commit.
  + [Issue 11515](https://bugs.chromium.org/p/gerrit/issues/detail?id=11515):
    Fix Ctrl-Enter on Move Change
  + [Issue 11552](https://bugs.chromium.org/p/gerrit/issues/detail?id=11552):
    Fix prev/next on diff screen with unchanged files containing only comments.
  + [Issue 11625](https://bugs.chromium.org/p/gerrit/issues/detail?id=11625):
    Avoid multiple notifications for existing reviewers.
  + [Issue 11697](https://bugs.chromium.org/p/gerrit/issues/detail?id=11697):
    Fix rendering of commentlinks without leading whitespace.
  + [Issue 11725](https://bugs.chromium.org/p/gerrit/issues/detail?id=11725):
    Fix diff view file name shown even when the file wasn’t changed, but only included because
    contains a comment.
  + [Issue 11727](https://bugs.chromium.org/p/gerrit/issues/detail?id=11727):
    Fix blue underline missing from active tabs.
  + [Issue 11782](https://bugs.chromium.org/p/gerrit/issues/detail?id=11782):
    Fix assignment of CSS style for CodeReview -1 labels within comments.
  + [Issue 11969](https://bugs.chromium.org/p/gerrit/issues/detail?id=11969):
    Fix tab index in reply dialog.
  + [Issue 11980](https://bugs.chromium.org/p/gerrit/issues/detail?id=11980):
    Fix handling of LDAP groups containing a dot in the PolyGerrit permissions screen.
  + [Issue 11984](https://bugs.chromium.org/p/gerrit/issues/detail?id=11984):
    Fix top menu bar on iOS.
  + [Issue 11993](https://bugs.chromium.org/p/gerrit/issues/detail?id=11993):
    Stop loading fonts from external resources.
  + [Issue 12020](https://bugs.chromium.org/p/gerrit/issues/detail?id=12020):
    Fix ‘New Contributor Agreement’ screen.
  + [Issue 12024](https://bugs.chromium.org/p/gerrit/issues/detail?id=12024):
    Fix undefined branch in create-destination-dialog.
  + [Issue 12031](https://bugs.chromium.org/p/gerrit/issues/detail?id=12031):
    Fix issues with caching edited commit message.
  + [Issue 12067](https://bugs.chromium.org/p/gerrit/issues/detail?id=12067):
    Fix blank screen after upgrading.
  + [Issue 12108](https://bugs.chromium.org/p/gerrit/issues/detail?id=12108):
    Add missing ‘Page …’ on pagination links in the repository list.
  + [Issue 12184](https://bugs.chromium.org/p/gerrit/issues/detail?id=12184):
    Fix link in blame annotation to link directly to the commit.
  + [Issue 12197](https://bugs.chromium.org/p/gerrit/issues/detail?id=12197):
    Fix rendering of commentlinks using `link` in PolyGerrit UI.
  + [Issue 12224](https://bugs.chromium.org/p/gerrit/issues/detail?id=12224):
    Honor the date format preference when displaying dates.
  + [Issue 12385](https://bugs.chromium.org/p/gerrit/issues/detail?id=12385):
    Fix memory leak in `gr-plugin-endpoints`.
  + [Issue 12707](https://bugs.chromium.org/p/gerrit/issues/detail?id=12707):
    Apply diff preferences immediately after pressing “Save”.
  + [Issue 12726](https://bugs.chromium.org/p/gerrit/issues/detail?id=12726):
    Fix incorrect highlighting after `/` character in Javascript.
  + [Issue 12775](https://bugs.chromium.org/p/gerrit/issues/detail?id=12775):
    Fix parent of previous patch sets not being available.
* Other fixes

  + [Issue 3340](https://bugs.chromium.org/p/gerrit/issues/detail?id=3340):
    Fix internal server errors when setting project access permission with bad regex.
  + [Issue 7645](https://bugs.chromium.org/p/gerrit/issues/detail?id=7645):
    Fix thread deadlock when loading accounts from the account cache.

    Replacing Guava caches with Caffeine reduces the chances of having the
    deadlocks and improves the cache performance.
  + [Issue 7969](https://bugs.chromium.org/p/gerrit/issues/detail?id=7969):
    Fix internal server error when diffing `MERGE_LIST` between different patch sets
    of a merge commit.
  + [Issue 8952](https://bugs.chromium.org/p/gerrit/issues/detail?id=8952):
    Do not require explicit “Push Tag” rights to `refs/tags/*` for pushing an
    annotated tag over HTTPS.
  + [Issue 10397](https://bugs.chromium.org/p/gerrit/issues/detail?id=10397):
    Don’t send notification email when publishing a change edit on a WIP change.
  + [Issue 11650](https://bugs.chromium.org/p/gerrit/issues/detail?id=11650):
    Fix reindexing of changes after project is deleted in the `delete-project` plugin.
  + [Issue 11962](https://bugs.chromium.org/p/gerrit/issues/detail?id=11962):
    Fix advertisement of `refs/meta/config` in git protocol v2 when client does
    not have access to it.
  + [Issue 11986](https://bugs.chromium.org/p/gerrit/issues/detail?id=11986):
    Fix fetching individual ref with git protocol v2.
  + [Issue 11989](https://bugs.chromium.org/p/gerrit/issues/detail?id=11989):
    Fix internal server error when pushing over SSH with git protocol v2.
  + [Issue 12070](https://bugs.chromium.org/p/gerrit/issues/detail?id=12070):
    Fix internal server error on git over HTTP calls when SSHD is enabled.
  + [Issue 12243](https://bugs.chromium.org/p/gerrit/issues/detail?id=12243):
    Fix unexpected deactivation of service user accounts.
  + [Issue 12246](https://bugs.chromium.org/p/gerrit/issues/detail?id=12246):
    Fix generation of duplicate ChangeIds when creating a new change via REST.
  + [Issue 12440](https://bugs.chromium.org/p/gerrit/issues/detail?id=12440):
    Fix the access-path for AbstractGitCommand subclasses.
  + [Issue 12444](https://bugs.chromium.org/p/gerrit/issues/detail?id=12444):
    Add support for `max_result_window` in Elasticsearch index configuration.
  + [Issue 12473](https://bugs.chromium.org/p/gerrit/issues/detail?id=12473):
    Fix broken links in Elasticsearch configuration documentation.
  + [Issue 12606](https://bugs.chromium.org/p/gerrit/issues/detail?id=12606):
    Fix `visibleto` predicate for groups.
  + [Issue 12747](https://bugs.chromium.org/p/gerrit/issues/detail?id=12747):
    Fix change query visibility for internal user.
  + [Issue 12755](https://bugs.chromium.org/p/gerrit/issues/detail?id=12755):
    Block the removal of the Realm primary external ids.

## Dependency Updates

* Upgrade flogger to 0.5.1
* Upgrade guava to 29.0
* Upgrade guice to 4.2.3
* Upgrade jgit to 5.8.0.202005061305-m2
* Upgrade mina-sshd to 2.4.0
* Upgrade ow2 to 7.2
* Upgrade truth to 1.0.1

## Documentation updates

* New [Gerrit walkthrough guide for GitHub users](https://gerrit-review.googlesource.com/Documentation/intro-gerrit-walkthrough-github.html)
  for allowing an easier transition for those who are coming from a Pull Request workflow.
* New guide on [how to backup Gerrit](https://gerrit-review.googlesource.com/Documentation/backup.html).
* Replace the term `slave` with `replica` in the Gerrit documentation, for alignment to the
  new term used in the configuration. The `slave` term is still supported but deprecated.
* [Issue 12573](https://bugs.chromium.org/p/gerrit/issues/detail?id=12573):
  Added documentation of the commit-container PolyGerrit extension endpoint.

## Bugfix Releases

### 3.2.14

* Breaking changes

  + [Change 323855](https://gerrit-review.googlesource.com/323855) [Change 324115](https://gerrit-review.googlesource.com/324115):
    ProjectCache#evict no longer triggers a reindex.

    During offline project reindexing evict() was triggering a duplicate reindex
    on the project when we only wanted to evict the project cache entry. This same
    issue occurred with the HA plugin and could be/been present in other plugins.

    If you have relied on a reindex being done on evict() you need to use
    evictAndReindex() instead. This behavior is now consistent with other evict()
    methods in Gerrit.
* New features

  + [Change 324095](https://gerrit-review.googlesource.com/324095):
    Display cache statistics after reindex operation.

    Help analyzing the cache utilization during reindex command
    and provide insight into sizing them for optimal performance.
  + Change 323786:
    Allow context-dependent group suggestions in gr-permission.
* Reindexing performance improvements

  + [Change 323297](https://gerrit-review.googlesource.com/323297):
    Avoid scanning for change refs for each project slices when reindexing all changes.

    Avoiding the duplicate work brings down the reindex time from 45 mins to 15 mins
    for a test-site with 160k changes across 4 repos on NFS.
  + [Change 323395](https://gerrit-review.googlesource.com/323395):
    Parallelize project slice creation when reindexing all changes.

    Slice creation can become an overhead for repositories on NFS with
    many loose refs. Bring down the overall reindexing time by
    creating projects slices in parallel.
  + [Change 323215](https://gerrit-review.googlesource.com/323215)
    [Change 322296](https://gerrit-review.googlesource.com/322296):
    Disable auto flushing during offline Lucene indexing.

    Flushing of Lucene index entries happens only based on
    [ramBufferSize](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.14/config-gerrit.html#index.name.ramBufferSize) and
    [maxBufferedDocs](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.14/config-gerrit.html#index.name.maxBufferedDocs)
    settings instead of every index call.
  + [Change 322835](https://gerrit-review.googlesource.com/322835):
    Use thread count specified on offline reindex command line.

    Honor the `--threads` command line option when provided instead of
    batchThreads property from `gerrit.config`.
  + [Change 323396](https://gerrit-review.googlesource.com/323396):
    Avoid lucene index deletes during offline reindexing.

    When running offline reindexing, the first operation is the removal
    of the index, hence the Lucene index updates are not needed: use the
    add document Lucene primitive, avoiding removals from the index during
    flushes. This reduces the number of Lucene flushes even if
    [ramBufferSize](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.14/config-gerrit.html#index.name.ramBufferSize)
    is not big enough.
  + [Change 324115](https://gerrit-review.googlesource.com/324115):
    Avoid double indexing work during project reindexing.
* Bug Fixes

  + [Issue 14963](https://crbug.com/gerrit/14963):
    Fix /access REST APIs returning incorrect rule when group is duplicated for same rule.
  + [Issue 14097](https://crbug.com/gerrit/14097):
    Fix GC action not shown in project commands with Gerrit in multi-site configuration.
  + [Issue 15293](https://crbug.com/gerrit/15293):
    Fix fetch of group suggestions for projects with a `/` in their name.
  + [Issue 15251](https://crbug.com/gerrit/15251):
    Ensure that user without edit permission can’t change plugin configuration.
  + [Change 313561](https://gerrit-review.googlesource.com/313561):
    Handle null account-ids when sending e-mails.
  + [Change 307602](https://gerrit-review.googlesource.com/307602):
    Fix NPE while accessing draft refs.
  + [Change 307482](https://gerrit-review.googlesource.com/307482):
    EqualsLabelPredicate: fix bug that prevents matching owner votes.
  + [Change 322935](https://gerrit-review.googlesource.com/322935):
    Fix buggy Index-Interactive Executor.

    Fix index.threads when set to a negative value which was not using a
    direct executor as mentioned in docs.
  + [Change 323255](https://gerrit-review.googlesource.com/323255):
    Skip creating slices for projects with no changes during changes off-line reindexing
    so that empty slices are no longer included in the slice count.
* Plugin API fixes

  + [Change 314962](https://gerrit-review.googlesource.com/314962):
    Fix DynamicOptions to invoke listeners registered to BeanParseListener.
* Dependency Updates

  + Update JGit to 5.1.16.202106041830-r, which contains the following
    improvements:

    - [Change 180697](https://git.eclipse.org/r/180697):
      BatchRefUpdate: Skip saving conflicting ref names and prefixes in memory.
    - [Change 180559](https://git.eclipse.org/r/180559):
      Avoid having to scan over ALL loose refs to determine if the name is nested
      within or is a container of an existing reference.

### 3.2.13

* New Features

  + [Issue 14930](https://bugs.chromium.org/p/gerrit/issues/detail?id=14930):
    Include `Command-Status` in the `httpd_log` and the `httpd_log.json`

    Indicates the overall result of the GIT *command* over HTTP.

    Refer to the [docs](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.13/logs.html#_httpd_log)
    for more details.
* Bug Fixes

  + [Issue 9812](https://crbug.com/gerrit/9812) [Issue 7338](https://crbug.com/gerrit/7338):
    Merge commit cannot be moved

    If a merge was targetting branch A, but then it was decided to create
    a new branch for this merge named B, which starts from A - The merge
    is still valid for B, and the user has no way to move it without amending
    and creating a new change.
  + [Issue 15024](https://crbug.com/gerrit/15024):
    Gerrit event json formatter produces inconsistent payload for different projects

    AllProjectsName and AllUsersName were serialised as: {“name”:”All-Projects”} and {“name”:”All-Users”}
    while all other projects were serialised as a JSON string. The different JSON
    payloads were causing issues with the HA configuration using the
    [high-availability plugin](https://gerrit.googlesource.com/plugins/high-availability).
  + [Issue 14968](https://crbug.com/gerrit/14968):
    PluginServletContext does not implement javax.servlet.ServletContext.getVirtualServerName()

    Remove the noise on error\_log of c.g.g.h.p.PluginServletContext does not implement
    j.s.ServletContext.getVirtualServerName(), when running Gerrit on Tomcat 8.5.69.

### 3.2.12

* Security Fixes

  + [Issue 14732](https://crbug.com/gerrit/14732):
    Commits/IncludedIn exposes branch names without respecting the ACLs on branches

    When calling the REST endpoint for listing all branches that a commit SHA1
    is part of, the commit is properly checked for visibility against the ACLs
    (it is a REST resource) but the branches are not checked.

    The included-in may expose the list of non-visible branches to a user that
    has visibility of the SHA1.
  + [Issue 7282](https://crbug.com/gerrit/7282):
    Hide repository name and description when user has no access

    Gitiles did not respect Gerrit’s permission and would show the repo name
    and description to any user who could guess the name.
    The repositories list as well as the content APIs were not affected.
* Bug Fixes

  + [Issue 14785](https://crbug.com/gerrit/14785):
    Limit returned changes for a triplet without Change-Id

    Fix a bug where invoking the REST-API /changes/repo~branch~ without
    mentioning the change-id resulted in the full scan of all changes
    on a repository/branch causing a high CPU overload and occupying
    the request threads for a long time.
  + [Issue 14776](https://crbug.com/gerrit/14776):
    Prevent removing e-mail associated with OpenID external IDs

    Gerrit prevents the user from removing the email address
    associated with their OpenId account.
  + [Change 312602](https://gerrit-review.googlesource.com/c/gerrit/%2B/312602):
    Fix Mariadb status matching for AccountPatchReview

    Mariadb connector uses SQLException.getSQLState() which returns the ANSI
    SQLSTATE value, not the MariaDB/mysql error code.
    Fix the removal of duplicate key detection when an already reviewed file
    opened up again returned 500 because of the incorrect handling of SQLSTATE
    value.
  + [Change 312382](https://gerrit-review.googlesource.com/c/gerrit/%2B/312382):
    Fix deleting edits when change is merged

    Fix the support of deleting a change edit after it has been merged or
    abandoned.

### 3.2.11

* Breaking Changes

  + Elasticsearch: Support for [EOL versions](https://www.elastic.co/support/eol)
    7.4 and 7.5 is discontinued, as they became EOL earlier this year.
* Bug Fixes

  + [Issue 14495](https://crbug.com/gerrit/14495):
    SSH thread leak with authentication exception

    A show-queue will show tasks in the Batch (or Interactive) queue hanging forever
    as a consequence of a Git/HTTP thread ended because of an error.
  + [Issue 14577](https://crbug.com/gerrit/14577):
    Dedicated mergeable endpoint shouldn’t be called if change.mergeabilityComputationBehavior
    is set to API\_REF\_UPDATED\_AND\_CHANGE\_REINDEX
  + [Issue 14600](https://crbug.com/gerrit/14600):
    Empty registered field on profile settings screen
  + [Issue 14613](https://crbug.com/gerrit/14613):
    Gerrit is killed before the gracefulStopTimeout

    Avoids gerrit.sh killing the in-flight Git/HTTP just after 30 seconds regardless of
    the `httpd.gracefulStopTimeout` configuration value.
  + [Issue 14639](https://crbug.com/gerrit/14639):
    Searching repositories by name is case-sensitive

    Restore the correct project search that was case-insensitive in 2.16.27,
    3.1.3 and 3.3.2.
  + [Issue 14645](https://crbug.com/gerrit/14645):
    Username to lowercase conversion fails with duplicates

    Duplicated accounts names associated with the same account id was making
    the conversion to lowercase fail.
  + [Change 307602](https://gerrit-review.googlesource.com/c/gerrit/%2B/307602):
    Fix NPE while accessing draft refs
  + [Change 307482](https://gerrit-review.googlesource.com/c/gerrit/%2B/307482):
    EqualsLabelPredicate: fix bug that prevents matching owner votes
* Dependency Updates

  + Update JGit to 73f8acdc5c97e068143c86765995c4fb6923ee91.

### 3.2.10

* Bug Fixes

  + [Issue 14553](https://crbug.com/gerrit/14553):
    Gerrit REST-API fails when using /a/ prefix and cookies

    Recent fix to support GerritAccount Cookie authentication for Git/HTTP
    broke existing Python (or other) scripting when performing automation with
    Gerrit REST-API. That is due to the generation of the GerritAccount cookie
    in the HTTP response, which Python automatically manages to reuse in
    subsequent calls.
  + [Issue 13721](https://crbug.com/gerrit/13721):
    Don’t serve polygerrit assets for git requests

    After migration to Polymer UI, PolyGerrit static resources are mounted at
    the root of the gerrit URL, and would collide with project namespaces, so that
    the project with these prefixes cannot be served with Git over HTTP protocol.

### 3.2.9 (withdrawn)

* Fix `EqualsLabelPredicate` to not fail when calling match() from a plugin

  Calling `match()` on the `EqualsLabelPredicate` returned from
  `ChangeQueryBuilder.parse()` in a plugin fails when in the context of an
  HTTP query.
* Fix registration redirect on OpenID
* Log when a new SSH connection is rejected due to exceeded limit

  When the `sshd.maxConnectionsPerUser` got exceeded for a user, new
  connections from that user were rejected but no log entry was reported.
* [Issue 14127](https://crbug.com/gerrit/14127):
  Fix binding of DELETE REST calls from plugins.

  The processing of the DELETE request actually never reached the
  delete-project plugin due to bug in the RestApiServlet which wrongly
  delegated the request to a child collection in Gerrit core.
* [Issue 13140](https://crbug.com/gerrit/13140):
  OpenID: Remove support for Yahoo! OpenID provider.

  Yahoo! discontinued support for OpenID provider:
  “OpenID2 will be EOLed on 6/30/20”
* [Issue 14246](https://crbug.com/gerrit/14246):
  Creation of internal account does not respect `auth.userNameToLowerCase`.

  The CreateAccount SSH command and REST API was able to create accounts
  with usernames that contained uppercase letters even if
  `auth.userNameToLowerCase` was set to true.
* [Issue 14490](https://crbug.com/gerrit/14490):
  Missing LDAP metrics for authentication.

  Expose the LDAP metrics in terms of latency and call rates so that any
  problem can be highlighted early on and potentially alerted to the Gerrit
  admin.
* [Issue 14497](https://crbug.com/gerrit/14497):
  Git/HTTP traffic overloads LDAP with duplicate authentication requests.

  When authenticating incoming Git calls over HTTP the BasicAuth filter was
  called 3 times per call triggering multiple authentications against the
  backend.
* [Issue 14508](https://crbug.com/gerrit/14508):
  Allow GerritAccount Cookie authentication for Git/HTTP.

  Allow to create a Gerrit session from the GerritAccount cookie set on the
  Git client, so that only the first HTTP call will actually authenticate
  and create a session whilst all the others would just reuse the existing
  cookie.
* [Issue 11142](https://crbug.com/gerrit/11142):
  ssh to gerrit with no args requires standard input to terminate.
* [JGit Issue 552173](https://bugs.eclipse.org/bugs/show_bug.cgi?id=552173)
  Too many open files when fetching repos with lots of refs

  JGit update fixes “Too many open files” errors.
* Dependency Updates

  + Update JGit to f2e5bace4841758927d47db7d20e4a6f7353ce57.

### 3.2.8

* New Features

  + [Issue 14091](https://bugs.chromium.org/p/gerrit/issues/detail?id=14091):
    Support the highlighting of LaTeX files with .tex extension.
* Breaking Changes

  + Elasticsearch: Support for [EOL versions](https://www.elastic.co/support/eol)
    7.2 and 7.3 is discontinued. Both elasticsearch versions became EOL recently.
  + [Issue 13931](https://bugs.chromium.org/p/gerrit/issues/detail?id=13931):
    Disallow editing the Change-Id during inline edits.
* Bug Fixes

  + [Issue 12443](https://bugs.chromium.org/p/gerrit/issues/detail?id=12443):
    Stop generating continuous “logging context is not empty” in error\_log.
  + [Issue 12847](https://bugs.chromium.org/p/gerrit/issues/detail?id=12847)
    [Issue 12862](https://bugs.chromium.org/p/gerrit/issues/detail?id=12862):
    Fix NPE on trying to send email for user without email address.
  + [Issue 14097](https://bugs.chromium.org/p/gerrit/issues/detail?id=14097):
    Allow enabling of Git GC button for non-local Git repository managers, such
    as multi-site repositories.
  + [Issue 14118](https://bugs.chromium.org/p/gerrit/issues/detail?id=14118):
    Quota management: enforce repository size on pack rather than on object.
  + [Issue 14193](https://bugs.chromium.org/p/gerrit/issues/detail?id=14193):
    Ensure InternalUser can parse groups.
* PolyGerrit Fixes

  + [Issue 14035](https://bugs.chromium.org/p/gerrit/issues/detail?id=14035):
    Change –gr-formatted-text-prose-max-width from 80ch to 120ch.
  + [Issue 14104](https://bugs.chromium.org/p/gerrit/issues/detail?id=14104):
    Decorate the number line element of a blank side, otherwise it won’t be affected
    by the “hide-left” action to hide one side of the diff
  + [Issue 14257](https://bugs.chromium.org/p/gerrit/issues/detail?id=14257):
    Fix empty TopMenu drop down list.
* Documentation updates

  + Align the recommended buildifier version to v4.0, the same used in the CI.
  + Development guidelines: mention that Optional in arguments is discouraged
    (use @Nullable instead) but may be used as return type.
* Dependency Updates

  + Update highlight.js to 10.6.0.

### 3.2.7

* New Features

  + Add change query option allowing administrators to skip visibility filtering.

    Add a new REST-API change query option “skip-visibility” to allow administrators
    to skip visibility filtering.
* Security Fixes

  + [Issue 13858](https://bugs.chromium.org/p/gerrit/issues/detail?id=13858)
    [CVE-2021-22553](https://nvd.nist.gov/vuln/detail/CVE-2021-22553):
    Fixed memory leak in Git-over-HTTP requests.

    Unauthenticated users could exploit this problem in a Denial of Service attack,
    causing the server to go out-of-memory.
* PolyGerrit Fixes

  + [Issue 11811](https://bugs.chromium.org/p/gerrit/issues/detail?id=11811):
    Fix comments on partial text selection on Safari.
  + [Issue 13870](https://bugs.chromium.org/p/gerrit/issues/detail?id=13870):
    Polygerrit: Remove license headers in minified gr-app.js.
* Replication plugin fixes

  + Don’t check read permission when authgroup isn’t set.

    Do not check for read permission when authGroup is not set since
    the user is a RemoteSiteUser that is-an InternalUser having
    read access to everything. This fixes a regression introduced in v3.1.10
    that prevented the All-Users.git repository to be fully replicated to
    Gerrit replicas.
* Bug Fixes

  + [Issue 13803](https://bugs.chromium.org/p/gerrit/issues/detail?id=13803):
    Limit number of ambiguous accounts in error message.

    Don’t list more than 3 ambiguous accounts in error message of
    UnresolvableAccountException in order to prevent flooding the log and
    displaying a lot of sensitive account data in an error dialog.
  + [Issue 13936](https://bugs.chromium.org/p/gerrit/issues/detail?id=13936):
    Fix badly formatted error message shown in error dialog.
  + [Issue 13884](https://bugs.chromium.org/p/gerrit/issues/detail?id=13884):
    Fix ‘is:submittable’ query on multiple submit records.
* Dependency Updates

  + Update highlight.js to 10.5.0.
  + Update Jetty to 9.4.35.v20201120.
  + Downgrade soy-template to 2019-10-08.

### 3.2.6

* Breaking Changes

  + Elasticsearch: Support for [EOL version](https://www.elastic.co/support/eol)
    6.8 is discontinued. This was the last supported minor version of
    Elasticsearch 6 in Gerrit. From this release, Gerrit no longer supports V6
    but only the already supported versions 7.x of Elasticsearch.

    - Speaking of which, support for 7.0 and 7.1 is discontinued too, as both
      elasticsearch versions also became [EOL](https://www.elastic.co/support/eol)
      recently.
* Security Fixes

  + [Issue 12629](https://bugs.chromium.org/p/gerrit/issues/detail?id=12629):
    Verify hostname when sending emails via SMTP server with SMTPSClient.

    The SMTP server’s certificate and hostname must be verified if
    encryption is enabled with SSL verification in the host settings
    (`sendemail.smtpEncryption` and `sendemail.sslVerify`).
* PolyGerrit Fixes

  + Add a warning if submitting a change with an open change edit.
* Bug Fixes

  + [Issue 13544](https://bugs.chromium.org/p/gerrit/issues/detail?id=13544)
    Ensure that GC#deleteOrphans respects pack lock:

    If pack or index files are guarded by a pack lock (.keep file)
    deleteOrphans() should not touch the respective files protected by the
    lock file.
  + [Issue 13775](https://bugs.chromium.org/p/gerrit/issues/detail?id=13775)
    Honor `toogleWipState` permission for `%ready` `%wip` push options:
  + [Issue 13781](https://bugs.chromium.org/p/gerrit/issues/detail?id=13781)
    Compact the REST-API output JSON unconditionally:

    The output JSON was initially compacted only when
    the Accept header was set to `application/json`: the compaction is now
    done unconditionally, unless the `pp=1` query parameter is specified.
  + [Issue 13786](https://bugs.chromium.org/p/gerrit/issues/detail?id=13786)
    ForRef#check should permit internal users to read all refs:

    [Make `PermissionBackend#ForRef` authoritative change](https://gerrit-review.googlesource.com/c/gerrit/%2B/288925)
    introduced a regression where gerrit `internal users` (e.g. plugins) were
    not taken into consideration when checking READ permission. As consequence
    the `All-Users.git` repository did not get any of the user’s refs replicated
    to the slaves. After the upgrade it is required to trigger a forced replication
    of the `All-Users.git` repository manually.
  + Avoid logging ssh exception for **stream is already closed** when length=0
    if present in the stacktrace.
* Documentation Updates

  + Clarify that ‘m’ push option sets patch set description.
  + Clarify that disk cache metrics require `cache.enableDiskStatMetrics`.
* Dependency Updates

  + Upgrade Bazel toolchain to 3.1.0.
  + Upgrade testcontainers to 1.15.1.
  + Upgrade Jetty to 9.4.33.v20201020.

### 3.2.5.1

* Bug Fixes

  + [Issue 13698](https://bugs.chromium.org/p/gerrit/issues/detail?id=13698):
    Java runtime mismatch on Java 8 since after upgrading to v3.2.5.

### 3.2.5

* Breaking Changes

  + Elasticsearch: Support for [EOL versions](https://www.elastic.co/support/eol)
    6.6 and 6.7 is discontinued.
  + [Issue 13184](https://bugs.chromium.org/p/gerrit/issues/detail?id=13184):
    Logging: `--console-log`-flag of `gerrit.war daemon` respects `log.textLogging`
    and `log.jsonLogging` options

    Change in the default behaviour of the `--console-log` flag. Since
    `log.textLogging` in the `gerrit.config` is `true` by default, using the
    `--console-log`-flag now writes logs to the `error_log`-file in addition
    to stderr by default. This can be avoided by setting `log.textLogging = false`.
  + [Issue 13701](https://bugs.chromium.org/p/gerrit/issues/detail?id=13701):
    X-Forwarded-Proto is now required because of underlying upgrade of the Jetty library,
    when Gerrit is accessed through an HTTP(/S) reverse-proxy.
* Security Fixes

  + [Issue 13621](https://bugs.chromium.org/p/gerrit/issues/detail?id=13621)
    [CVE-2020-8919](https://nvd.nist.gov/vuln/detail/CVE-2020-8919):
    Make `PermissionBackend#ForRef` authoritative.

    Fixes a misconception that leads to data being accessible through Gerrit
    APIs that should be locked down.

    Gerrit had two components for determining if a Git ref is visible to a
    user: `(Default)RefFilter` and `PermissionBackend#ForRef` (e.g.,
    `RefControl`). The former was always capable of providing correct results
    for all refs. The latter only had logic to decide if a Git ref is visible
    according to the Gerrit `READ` permissions. This includes all refs under
    `refs/heads` as well as any other ref that isn’t a database ref or a Git
    tag. This component was unaware of Git tags and notedb-related refs. Hence,
    when asked for a database reference such as `refs/changes/xx/yyyyxx/meta`,
    the logic would allow access if the user has `READ` permissions on any of
    the ref prefixes (such as the default “read refs/\* Anonymous Users”).

    That was problematic, because it bypassed
    [documented behavior](http://gerrit-documentation.storage.googleapis.com/Documentation/3.2.5/access-control.html)
    where a user should only have access to a change if he can see the
    destination ref. The same goes for other database references.
  + [Issue 13514](https://bugs.chromium.org/p/gerrit/issues/detail?id=13514)
    [CVE-2020-8920](https://nvd.nist.gov/vuln/detail/CVE-2020-8920):
    Work around Gitiles bug on `All-Users` visibility.

    Gitiles has a special `FilteredRepository` wrapper that allows carefully
    hiding refs based on the project’s ACLs. There is however an optimization
    that skips the filtering in case a user has `READ` permissions on every ACL
    pattern(s). When the target repository is `All-Users`, the optimization
    turns into a security issue because it allows seeing all personal information
    associated with all accounts, i.e.:

    - draft comments
    - draft edits
    - personally identifiable information (PII) of all users
    - external ids

    This fix now blocks Gitiles or any other part of Gerrit to abuse this power
    when the target repository is `All-Users`, where nobody can be authorized
    to skip the ACLs evaluation anyway.
* Bug Fixes

  + [Issue 13307](https://bugs.chromium.org/p/gerrit/issues/detail?id=13307):
    Do not forward events generated by multiple Gerrit servers in high-availability
    configuration.
  + [Issue 13349](https://bugs.chromium.org/p/gerrit/issues/detail?id=13349):
    Allow disabling SSH on Gerrit replica, when disabled in gerrit.config.
  + [Issue 13408](https://bugs.chromium.org/p/gerrit/issues/detail?id=13408):
    ReceiveCommits: potential NPE when auto-closing changes.
  + [Issue 13412](https://bugs.chromium.org/p/gerrit/issues/detail?id=13412):
    `gerrit test-submit` is not available when ssh download is disabled.
* PolyGerrit Fixes

  + [Issue 11706](https://bugs.chromium.org/p/gerrit/issues/detail?id=11706):
    Allow editing the commit message as part of change edit.
  + [Issue 13175](https://bugs.chromium.org/p/gerrit/issues/detail?id=13175):
    Fix `gr-hovercard-behavior` under Firefox.
  + [Issue 13328](https://bugs.chromium.org/p/gerrit/issues/detail?id=13328):
    Project dashboard links stored in ‘My’ menu (GWT) lead to ‘cannot load page’
    in PolyGerrit.
  + [Issue 13350](https://bugs.chromium.org/p/gerrit/issues/detail?id=13350):
    Cannot add group to (cc-)review if its UUID is not the internal one.
  + [Issue 13402](https://bugs.chromium.org/p/gerrit/issues/detail?id=13402):
    Errors not displayed by delete-project plugin, if project deletion fails.
* Replication plugin Fixes

  + [Issue 12769](https://bugs.chromium.org/p/gerrit/issues/detail?id=12769):
    Pending replication events can delay the Gerrit startup for too long.
* End-to-end Tests Improvements

  + [Issue 13082](https://bugs.chromium.org/p/gerrit/issues/detail?id=13082):
    Add Eclipse support for Gatling-based development of the end-to-end tests.
* Documentation Updates

  + New documentation for the GC section in
    [jgit.config](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.5.1/config-gerrit.html#jgit-gc)
    with the details of the relevant JGit settings for tuning the repositories GC.
  + New documentation for the receive section in
    [jgit.config](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.5.1/config-gerrit.html#jgit-receive)
    with the documentation of the `autogc` setting.
  + Documentation of how to enable Git protocol v2 on
    [jgit.config](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.5.1/config-gerrit.html#jgit-protocol).
  + Documentation of Gerrit [logs format](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.5.1/logs.html).
  + Documentation of the `X-Forwarded-For` header on HTTP/HTTPS reverse proxy configuration.
  + New [sshd.gracefulStopTimeout](https://gerrit-documentation.storage.googleapis.com/Documentation/3.2.5.1/config-gerrit.html#sshd.gracefulStopTimeout)
    setting for allowing incoming SSH connections to drain upon Gerrit shutdown.
* Dependency Updates

  + Caffeine 2.8.5
  + Jetty 9.4.32.v20200930
  + JGit v5.8.1.202007141445-r
  + Google Truth 1.1
  + Soy 2020-08-24

### 3.2.4

This minor release has been withdrawn.

### 3.2.3

* Security Fixes

  + [Issue 12846](https://bugs.chromium.org/p/gerrit/issues/detail?id=12846):
    BadMessageException: 500: Response header too large.

    [CVE-2019-17638](https://nvd.nist.gov/vuln/detail/CVE-2019-17638)

    Bump Jetty version to 9.4.30.v20200611 to fix regression introduced in Jetty
    version: 9.4.27.v20200227.

    Response header overflow leads to buffer corruptions Jetty server always
    allocates maximum response header size.

    For more details see also upstream issues:

    [Issue 4936](https://github.com/eclipse/jetty.project/issues/4936)
    [Issue 4541](https://github.com/eclipse/jetty.project/issues/4541)
* Bug Fixes

  + [Issue 12813](https://bugs.chromium.org/p/gerrit/issues/detail?id=12813):
    e2e-tests: Add CheckMasterBranchReplica1 scenarios
  + [Issue 12934](https://bugs.chromium.org/p/gerrit/issues/detail?id=12934):
    Fix selection on diff with range comments
  + [Issue 12952](https://bugs.chromium.org/p/gerrit/issues/detail?id=12952):
    Handle duplicate label values on project load and push of config updates
  + [Issue 12959](https://bugs.chromium.org/p/gerrit/issues/detail?id=12959):
    Submit: Use updated change for response

    The response was sent with the change instance from before it
    got submitted, rather than the updated change. As a result, the
    response contained the status “NEW” rather than “MERGED”.
  + [Issue 12988](https://bugs.chromium.org/p/gerrit/issues/detail?id=12988):
    Fix issue with auto registering ssh commands
  + [Issue 13166](https://bugs.chromium.org/p/gerrit/issues/detail?id=13166):
    Include request latency in httpd\_log.json

    The latency field was missing in the entries of JSON-formatted http logs.
* PolyGerrit Fixes

  + [Issue 12994](https://bugs.chromium.org/p/gerrit/issues/detail?id=12994):
    Fix toggle on iOS

    This works around an issue where by clicking on iOS causes the toggle
    to act like a double tap, thus switches back off.
  + [Issue 13080](https://bugs.chromium.org/p/gerrit/issues/detail?id=13080):
    Fix the position of the hovercard

    The desired position was ‘right’, but it appeared ‘bottom-right’,
    because the height of the hovercard was calculated as 2px at the time
    of updating the position.
  + [Issue 13054](https://bugs.chromium.org/p/gerrit/issues/detail?id=13054):
    Restore keyboard shortcut for expand all diff context

    In gerrit 2.16 release the keyboard shortcuts system was redesigned, but
    the binding for Shift+x shortcut for expand all diffs was lost. Restore
    this binding and confirm that it is now listed in the help dialog and
    works as expected.
* Documentation Updates

  + [Issue 10385](https://bugs.chromium.org/p/gerrit/issues/detail?id=10385):
    Document “Toggle Work In Progress state” permission
* Replication plugin fixes:

  + [Issue 12779](https://bugs.chromium.org/p/gerrit/issues/detail?id=12779):
    Only fire the specified pending event URI
  + [Issue 12940](https://bugs.chromium.org/p/gerrit/issues/detail?id=12940):
    Fix issue with URI lock release after replication task cancellation
  + [Issue 12986](https://bugs.chromium.org/p/gerrit/issues/detail?id=12986):
    Revert “Get a URI lock before running tasks.”

    May still be missing some lock release calls and caused the loss of
    replication events in queue when backed by the same task storage file.
* Dependency Updates

  + JGit v5.8.1.202007141445-r

### 3.2.2

* Security Fixes

  + [Issue 12926](https://bugs.chromium.org/p/gerrit/issues/detail?id=12926):
    Allow setting X-Frame-Options response header for preventing
    [clickjacking attacks](https://owasp.org/www-community/attacks/Clickjacking).
* Bug Fixes

  + [Issue 12680](https://bugs.chromium.org/p/gerrit/issues/detail?id=12680):
    Run projects reindex after Gerrit init only when needed, speeding up the upgrade process.
  + [Issue 12778](https://bugs.chromium.org/p/gerrit/issues/detail?id=12778):
    Fix `Included In` filter not working in the search box.
  + [Issue 12909](https://bugs.chromium.org/p/gerrit/issues/detail?id=12909):
    Fx missing index creation after Gerrit init.
  + [Issue 12918](https://bugs.chromium.org/p/gerrit/issues/detail?id=12918):
    Fix missing email notifications for project watches for changes created via cherry-pick.
  + [Issue 12884](https://bugs.chromium.org/p/gerrit/issues/detail?id=12884):
    DatabasePubKeyAuth: Exclude comment from peer key line if present
* PolyGerrit Fixes

  + [Issue 11368](https://bugs.chromium.org/p/gerrit/issues/detail?id=11368):
    Fix Javascript error if project has incorrect access configuration in `Global Capabilities`.
  + [Issue 12899](https://bugs.chromium.org/p/gerrit/issues/detail?id=12899):
    Speedup the rendering of changes with large number of comments by lazy loading them when expanded.
* Documentation Updates

  + [Issue 12869](https://bugs.chromium.org/p/gerrit/issues/detail?id=12869):
    Add documentation on how to move a change across branches.
  + [Issue 12870](https://bugs.chromium.org/p/gerrit/issues/detail?id=12870):
    Update WIP workflow user guide.

### 3.2.1

* New Features

  + Support for [rolling upgrade](http://gerrit-documentation.storage.googleapis.com/Documentation/3.1.6/config-gerrit.html#gerrit.experimentalRollingUpgrade).
  + New interface `AccountActivationListener` available to plugins for listening
    to accounts activation status changes.
* Security Fixes

  + [Issue 12717](https://bugs.chromium.org/p/gerrit/issues/detail?id=12717):
    Deny access over HTTP for disabled accounts.

    A disabled account was still able to access over HTTP until the existing
    session expired.
  + Close active SSH connections associated to an account that has been disabled.
* Bug Fixes

  + [Issue 12850](https://bugs.chromium.org/p/gerrit/issues/detail?id=12850):
    Ignore WIP changes in “CCed on” dashboard section.
* PolyGerrit Fixes

  + [Issue 11706](https://bugs.chromium.org/p/gerrit/issues/detail?id=11706):
    Support commit message modification as part of the inline edit session.
* Documentation Updates

  + Added missing documentation of
    [notedb.changes.sequenceBatchSize](http://gerrit-documentation.storage.googleapis.com/Documentation/3.2.1/config-gerrit.html#notedb.changes.sequenceBatchSize)

---

©2025 Gerrit. All rights reserved.

Site last generated: Jan 19, 2025

![Diffy](/images/diffy_logo.png)

[Privacy Notice](https://www.google.com/policies/privacy/)



=== Content from www.gerritcodereview.com_ea7f0a89_20250119_111532.html ===


Toggle navigation

[Gerrit Code Review](/index.html)

* [About](/about.html)
* [News](/news.html)
* [Support](/support.html)

* Community
  + [Code of Conduct](/codeofconduct.html)
  + [Forums, Mailing lists etc.](/contact.html)
  + [Members](/members.html)
  + [Contributing](/contributing.html)
  + [Fixing a bug](/bug-fixing.html)
  + [Presentations](/presentations.html)
  + [Kudos](/kudos.html)
  + [User Stories](/userStories.html)
  + [Trademarks](/trademarks.html)
* Code
  + [Source](https://gerrit.googlesource.com/gerrit/)
  + [Releases](/releases-readme.html)
  + [Plugins](/plugins.html)
  + [Roadmap](/roadmap.html)
  + [Builds](https://gerrit-ci.gerritforge.com/)
  + [Reviews](https://gerrit-review.googlesource.com/q/status%3Aopen%2Bproject%3Agerrit)
* Docs
  + [Latest](https://gerrit-documentation.storage.googleapis.com/Documentation/3.11.1/index.html)
  + [Designs](/design-docs-index.html)
  + [Wiki](https://gerrit.googlesource.com/homepage/%2B/master/pages/site/docs/)
* Feedback

# Gerrit 2.16 Release

Download: **[2.16.28](https://gerrit-releases.storage.googleapis.com/gerrit-2.16.28.war)**
| [2.16.27](https://gerrit-releases.storage.googleapis.com/gerrit-2.16.27.war)
| [2.16.26](https://gerrit-releases.storage.googleapis.com/gerrit-2.16.26.war)
| [2.16.25](https://gerrit-releases.storage.googleapis.com/gerrit-2.16.25.war)
| [2.16.23](https://gerrit-releases.storage.googleapis.com/gerrit-2.16.23.war)
| [2.16.22](https://gerrit-releases.storage.googleapis.com/gerrit-2.16.22.war)
| [2.16.21](https://gerrit-releases.storage.googleapis.com/gerrit-2.16.21.war)
| [2.16.20](https://gerrit-releases.storage.googleapis.com/gerrit-2.16.20.war)
| [2.16.19](https://gerrit-releases.storage.googleapis.com/gerrit-2.16.19.war)
| [2.16.18](https://gerrit-releases.storage.googleapis.com/gerrit-2.16.18.war)
| [2.16.17](https://gerrit-releases.storage.googleapis.com/gerrit-2.16.17.war)
| [2.16.16](https://gerrit-releases.storage.googleapis.com/gerrit-2.16.16.war)
| [2.16.15](https://gerrit-releases.storage.googleapis.com/gerrit-2.16.15.war)
| [2.16.14](https://gerrit-releases.storage.googleapis.com/gerrit-2.16.14.war)
| [2.16.13](https://gerrit-releases.storage.googleapis.com/gerrit-2.16.13.war)
| [2.16.12](https://gerrit-releases.storage.googleapis.com/gerrit-2.16.12.war)
| [2.16.11.1](https://gerrit-releases.storage.googleapis.com/gerrit-2.16.11.1.war)
| [2.16.10](https://gerrit-releases.storage.googleapis.com/gerrit-2.16.10.war)
| [2.16.9](https://gerrit-releases.storage.googleapis.com/gerrit-2.16.9.war)
| [2.16.8](https://gerrit-releases.storage.googleapis.com/gerrit-2.16.8.war)
| [2.16.7](https://gerrit-releases.storage.googleapis.com/gerrit-2.16.7.war)
| [2.16.6](https://gerrit-releases.storage.googleapis.com/gerrit-2.16.6.war)
| [2.16.5](https://gerrit-releases.storage.googleapis.com/gerrit-2.16.5.war)
| [2.16.4](https://gerrit-releases.storage.googleapis.com/gerrit-2.16.4.war)
| [2.16.3](https://gerrit-releases.storage.googleapis.com/gerrit-2.16.3.war)
| [2.16.2](https://gerrit-releases.storage.googleapis.com/gerrit-2.16.2.war)
| [2.16.1](https://gerrit-releases.storage.googleapis.com/gerrit-2.16.1.war)
| [2.16](https://gerrit-releases.storage.googleapis.com/gerrit-2.16.war)

Documentation: **[2.16.28](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.28/index.html)**
| [2.16.27](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.27/index.html)
| [2.16.26](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.26/index.html)
| [2.16.25](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.25/index.html)
| [2.16.23](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.23/index.html)
| [2.16.22](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.22/index.html)
| [2.16.21](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.21/index.html)
| [2.16.20](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.20/index.html)
| [2.16.19](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.19/index.html)
| [2.16.18](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.18/index.html)
| [2.16.17](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.17/index.html)
| [2.16.16](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.16/index.html)
| [2.16.15](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.15/index.html)
| [2.16.14](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.14/index.html)
| [2.16.13](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.13/index.html)
| [2.16.12](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.12/index.html)
| [2.16.11.1](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.11.1/index.html)
| [2.16.10](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.10/index.html)
| [2.16.9](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.9/index.html)
| [2.16.8](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.8/index.html)
| [2.16.7](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.7/index.html)
| [2.16.6](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.6/index.html)
| [2.16.5](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.5/index.html)
| [2.16.4](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.4/index.html)
| [2.16.3](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.3/index.html)
| [2.16.2](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.2/index.html)
| [2.16.1](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.1/index.html)
| [2.16](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/index.html)

## Release Highlights

* GWT UI is deprecated, and PolyGerrit is now the default UI.
* Experimental Dark Mode in PolyGerrit.
* Inline editing support in PolyGerrit UI.
* Redesigned UI for PolyGerrit based on material design.
* New configuration option to ignore self-approval on labels.
* New CommonMark/Markdown parser.

## Important Notes

### Known problem with schema upgrade

See the [schema changes](#schema-changes) section for more information.

### Known problem with plugins and index

Since 2.14.2 the plugins are loaded before online reindexing is started, so
that prolog rules provided by plugins can be invoked during indexing. See
[issue 6472](https://bugs.chromium.org/p/gerrit/issues/detail?id=6472) for
details.

This causes a problem for any plugins that access the index either directly
or indirectly (i.e. by accessing a cache), because the index is not yet
available when the plugin is loaded during server startup. An example of this
is in the replication plugin, which needs to use the group cache when
`authGroup` is used in a destination configuration.

A fix [issue 10082](https://bugs.chromium.org/p/gerrit/issues/detail?id=10082)
is available since 2.16.3 release.

### Other known issues

* [Issue 12546](https://bugs.chromium.org/p/gerrit/issues/detail?id=12546):
  The `Change-Id` footer is inserted at end of trailers instead of start.

  The `commit-msg` hook inserts the `Change-Id` at the end of the trailers,
  which could result in other trailers such as `Signed-off-by` being added
  multiple times.

### Migration to NoteDb

[NoteDb](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/note-db.html)
is now required for accounts (since 2.15) and groups (since 2.16), and is the preferred storage for changes.

In Gerrit 2.15:

* Account data (with the exception of Group data) was moved to NoteDB ([release notes](https://www.gerritcodereview.com/2.15.html#notedb-for-accounts)).
* Change data could be either moved to NoteDB ([migration process](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15/note-db.html#migration)), or left in ReviewDB.

In Gerrit 2.16:

* Group data is always moved to NoteDB (it is migrated automatically during the upgrade process, when you run `gerrit.war init`).

When upgrading to Gerrit v2.16, you are strongly advised to migrate fully (including changes) from ReviewDb to NoteDb.

You should review the documentation on [NoteDb](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/note-db.html),
including the information about the migration process:

* [On-line migration](https://gerrit-review.googlesource.com/Documentation/note-db.html#online-migration)
* [Off-line migration](https://gerrit-review.googlesource.com/Documentation/note-db.html#offline-migration)

Although ReviewDb is still technically available on Gerrit v2.16, the upgrade to NoteDb is strongly recommended, although not enforced.

Note that in the next version of Gerrit (v3.0), ReviewDb will not be available.

### Schema Changes

2.16.16 and earlier only support upgrading from 2.15.x. Use 2.16.17+ to
upgrade directly from 2.11.x or newer. Using the latest 2.16.x version is
recommended.

This release contains schema changes. To upgrade:

```
  java -jar gerrit.war init -d ${site_path}

```

On large sites, 2.16 schema migration might run for longer durations.
To optimize it, one may execute SQL commands to insert the following
columns for existing tables on a live running gerrit server at any
time before migration work for 2.16 is started (even on really old
2.7 installations).

* work\_in\_progress, review\_started and is\_private on changes table.
* post\_submit on patch\_set\_approvals table.
* unresolved on patch\_comments table.

To insert these columns run the following SQL:

```
ALTER TABLE changes ADD is_private CHAR(1) DEFAULT 'N' NOT NULL CHECK (is_private IN ('Y','N')),
                    ADD work_in_progress CHAR(1) DEFAULT 'N' NOT NULL  CHECK (work_in_progress IN ('Y','N')),
                    ADD review_started CHAR(1) DEFAULT 'N' NOT NULL  CHECK (review_started IN ('Y','N'));
ALTER TABLE patch_set_approvals ADD post_submit CHAR(1) DEFAULT 'N' NOT NULL CHECK (post_submit IN ('Y','N'));
ALTER TABLE patch_comments ADD unresolved CHAR(1) DEFAULT 'N' NOT NULL CHECK (unresolved IN ('Y','N'));

```
### Reindex for new projects index and changed group index

Gerrit 2.16 introduces a new secondary index for projects. The initial version
of this index must be created by running the offline reindex before starting
Gerrit:

```
  java -jar gerrit.war reindex --index projects -d ${site_path}

```

The group index gained two new fields, which Gerrit 2.16 depends on. For this
reason, the following command to offline reindex the group index must be
executed as well:

```
  java -jar gerrit.war reindex --index groups -d ${site_path}

```

The offline reindex for groups should also be run on Gerrit slave hosts.

Note that if you are migrating from v2.15, it is not necessary to reindex the changes and accounts indexes
offline. These will automatically be reindexed by the online reindexer after
starting Gerrit.

### Support for GWT UI is deprecated

From 2.16 GWT UI is deprecated and will be removed in a future version.

### Discontinued support for Internet Explorer

PolyGerrit no longer officially supports Internet Explorer. It never really worked.

### Support for Velocity templates removed

In [version 2.14](2.14.md) support for Soy templates was added. For backwards
compatibility, support for Velocity templates (VTL) was kept.

In version 2.16 support for VTL is completely removed. Site administrators must
replace any Velocity templates (`.vm` files in `$site/etc/mail/`) with the equivalent
Soy templates before upgrading to this version.

### Push to refs/changes is deprecated

The possibility to push to `refs/changes` is now disabled by default. It is
still possible to enable it in the gerrit config by setting
[receive.allowPushToRefsChanges](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/config-gerrit.html#receive.allowPushToRefsChanges)
to true.

### Legacy `/p/` prefix for Git/HTTP projects is removed

The `/p/` cannot be used anymore and the `/a/` prefix should be used for Git/HTTP
with basic authentication.

### DELETE requests with bodies are no longer recommended

Some proxies, which are not under client control, prohibit DELETE requests with
bodies. DELETE requests with bodies could work on a first attempt, but could
fail afterwards because a server they have no control over was updated. In this
case, client users could be in trouble if they were not notified.

Therefore, we have decided to no longer recommend sending DELETE requests with
bodies. They will continue to work in this release but should be considered as
deprecated and will be removed in the next release.

### Pegdown is replaced by Flexmark

[flexmark-java](https://github.com/vsch/flexmark-java) is a Java implementation of
CommonMark 0.28 spec parser using the blocks first, inlines after Markdown parsing
architecture.

Its strengths are speed, flexibility, Markdown source element based AST with details
of the source position down to individual characters of lexemes that make up the
element and extensibility, compared to Pegdown speed that was, in general, less than
ideal and for pathological input either hangs or practically hangs during parsing.

### SYSTEM\_CONFIG table is removed

This table was used to retrieve the `site_path` directory in unattended setup
mode. As a replacement, system property `gerrit.site_path` should be used.

### Git clients older than 2.x are not supported anymore

The Gerrit `commit-msg` hook script for adding the Change-Id in every local commit
has been simplified and is now using the `git-interpret-trailers` command.
The `interpret-trailers` command is available as of git v2.2.0, released
Dec 2014.

As of Gerrit 2.16.18, the `commit-msg` hook uses the `--where` option to the
`git-interpret-trailers` command. This was added in git v2.15.0, released Oct 2017.

Existing cloned repositories that have been cloned before the migration to v2.16
and thus having the old hook for generating the Change-Id will continue to work.
However, new clones and hook scripts will need to upgrade your local git client
to v2.2.0 or later.

If you have existing older git clients and cannot migrate to v2.2.0 or later, you need
to keep serving the old script, copying it to the Gerrit /static directory, and
then amend the Gerrit helper instructions to download it.

Example (assuming Gerrit installed on $GERRIT\_SITE and available at https://gerrit.mycompany.com):

```
$ curl 'https://gerrit.googlesource.com/gerrit/+/stable-2.15/gerrit-server/src/main/resources/com/google/gerrit/server/tools/root/hooks/commit-msg?format=TEXT' > $GERRIT_SITE/static/commit-msg
$ git config -f $GERRIT_SITE/etc/gerrit.config gerrit.installCommitMsgHookCommand 'gitdir=$(git rev-parse --git-dir); curl -o ${gitdir}/hooks/commit-msg https://gerrit.mycompany.com/static/commit-msg ; chmod +x ${gitdir}/hooks/commit-msg'

```

From Gerrit version 2.16.18, users may also download the older version of
the hook from the installed Gerrit site without the admin having to copy
it to the static folder:

```
$ scp -p -P 29418 john.doe@review.example.com:hooks/commit-msg-legacy ~/myproject/.git/hooks/commit-msg

```

Note, however, that with both workarounds mentioned above, the “Clone with
commit-msg hook” command in the project view still results in the new hook
being downloaded.

### `current_user` predicate is removed from the submit rule evaluator

As a consequence of this, the result of a submittability rule check can
no longer depend on the user who is requesting it.

For example, it is no longer possible to define a submit rule that would
enforce that only change owners can submit a change. A workaround is to
grant the ‘Submit’ permission to the ‘Change Owner’ group in project
access controls, although note that this can only be done at ref level
and cannot be dynamically applied in the same way that a prolog submit
rule could.

### `startTime` in schedule configuration now requires hours to be zero-padded

As a result of replacing JodaTime with the Java 8 Time API, times specified
in schedule configurations, for example for the GC schedule, must zero-pad
the hours. I.e. `06:00` rather than `6:00`.

## New Features

### ‘Read As’ capability

The new [‘Read As’ capability](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.3/access-control.html#capability_readAs)
allows users to impersonate any user to see which refs they can see.

Note: the capability was added in 2.16 but only documented since 2.16.1.

### Disable log file rotation and compression

On sites where log file rotation and compression is done by an external
service such as [logrotate](http://manpages.ubuntu.com/manpages/zesty/man8/logrotate.8.html),
administrators may wish to disable Gerrit’s default log rotation and
compression.

This can now be done by setting
[`log.rotate`](http://gerrit-documentation.storage.googleapis.com/Documentation/2.16/config-gerrit.html#log.rotate)
and [`log.compress`](http://gerrit-documentation.storage.googleapis.com/Documentation/2.16/config-gerrit.html#log.compress)
to `false`.

Both settings default to `true` when not set, to maintain consistent behavior
with previous releases.

### Support for reloading `gerrit.config`

The contents of the `gerrit.config` file are cached at startup by Gerrit. For most configuration
properties, if they are modified in this file, Gerrit needs to be restarted before it will use
the new values. Some properties now support being reloaded without restart.

A new SSH command [`reload-config`](http://gerrit-documentation.storage.googleapis.com/Documentation/2.16/cmd-reload-config.html)
and [REST API endpoint](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/rest-api-config.html#reload-config)
are provided to invoke the reloading.

Not all configuration properties support reloading. For those that do, it is mentioned
in the [documentation](http://gerrit-documentation.storage.googleapis.com/Documentation/2.16/config-gerrit.html).

### PolyGerrit enhancements

#### Repo access view

* [Issue 6569](https://bugs.chromium.org/p/gerrit/issues/detail?id=6569)
  Add repo access view.

PolyGerrit UI displays the repository access information and allows editing it.

#### Inline edit

* [Issue 4437](https://bugs.chromium.org/p/gerrit/issues/detail?id=4437)
  inline edit is fully implemented using the CodeMirror Editor plugin.

  A new core plugin, `codemirror-editor`, is available,
  which uses [CodeMirror](https://codemirror.net/) to provide a rich code editing
  experience in PolyGerrit.

  When you upgrade Gerrit using `init -d`, you are given the option to install the
  `codemirror-editor` plugin.

#### Change screen improvements

* [Issue 8213](https://bugs.chromium.org/p/gerrit/issues/detail?id=8213)
  Follow-Up button is missing on change screen
* [Issue 8218](https://bugs.chromium.org/p/gerrit/issues/detail?id=8218)
  Open inline diff when clicked on file list row
* [Issue 8241](https://bugs.chromium.org/p/gerrit/issues/detail?id=8241)
  Change comment threads are interleaved
* [Issue 8260](https://bugs.chromium.org/p/gerrit/issues/detail?id=8260)
  Submitted together section shows which change is the one currently displayed
* [Issue 8528](https://bugs.chromium.org/p/gerrit/issues/detail?id=8528)
  Show vote chips in change messages
* [Issue 9111](https://bugs.chromium.org/p/gerrit/issues/detail?id=9111)
  Add expander icons to messages
* [Issue 9532](https://bugs.chromium.org/p/gerrit/issues/detail?id=9532)
  Provide CLI assistance for updating Gerrit changes in the change view
* [Issue 9707](https://bugs.chromium.org/p/gerrit/issues/detail?id=9707)
  Assigned to you section on dashboard
* [Issue 2390](https://bugs.chromium.org/p/gerrit/issues/detail?id=2390)
  Allow to mark review as read/unread by clicking on some icon and/or button
* [Issue 4528](https://bugs.chromium.org/p/gerrit/issues/detail?id=4528)
  Indicate what labels a reviewer can vote on
* [Issue 5178](https://bugs.chromium.org/p/gerrit/issues/detail?id=5178)
  File name as header when viewing a change inline.
* [Issue 5329](https://bugs.chromium.org/p/gerrit/issues/detail?id=5329)
  Support for the find-owners plugin
* [Issue 5433](https://bugs.chromium.org/p/gerrit/issues/detail?id=5433)
  Make SHAs selectable in the UI
* [Issue 5452](https://bugs.chromium.org/p/gerrit/issues/detail?id=5452)
  Make shift-j jump to index if no files remain with comments.
* [Issue 6198](https://bugs.chromium.org/p/gerrit/issues/detail?id=6198)
  Allow control whitespace diff in the UI
* [Issue 6781](https://bugs.chromium.org/p/gerrit/issues/detail?id=6781)
  Change/patchset actions have tooltips describing their behavior
* [Issue 6984](https://bugs.chromium.org/p/gerrit/issues/detail?id=6984)
  “Discard” button on review comments requests confirmation prompt
* [Issue 7698](https://bugs.chromium.org/p/gerrit/issues/detail?id=7698)
  New popup for “This change has been merged”
* [Issue 7773](https://bugs.chromium.org/p/gerrit/issues/detail?id=7773)
  Ask for configuration on the submit button

#### General improvements

* [Issue 8983](https://bugs.chromium.org/p/gerrit/issues/detail?id=8983)
  Lazy-load gr-avatar images
* [Issue 4915](https://bugs.chromium.org/p/gerrit/issues/detail?id=4915)
  Support “Show Change Sizes As Colored Bars” setting
* [Issue 7886](https://bugs.chromium.org/p/gerrit/issues/detail?id=7886)
  TShirt sizing for changes in the dashboard and change-view
* [Issue 7961](https://bugs.chromium.org/p/gerrit/issues/detail?id=7961)
  Display dividing line for metadata
* [Issue 9000](https://bugs.chromium.org/p/gerrit/issues/detail?id=9000)
  Fix adding groups created by the singleusergroup plugin
* [Issue 9216](https://bugs.chromium.org/p/gerrit/issues/detail?id=9216)
  Close the groups editor after submitting

#### Differences from GWT

* Writing a cover message on a specific patch set is no longer possible.

  The cover message is always added on the current patch set. This means
  that any system that relies on notifications being sent for a specific
  patch set will no longer work.

### New logging framework

For logging Gerrit is now using [Flogger](https://github.com/google/flogger)
instead of SLF4J. The logging backend is still LOG4J.

The Flogger LOG4J backend is configured by a system property
(`flogger.backend_factory=com.google.common.flogger.backend.log4j.Log4jBackendFactory#getInstance`)
that must be set for logging to work. There is an init step that automatically
sets this system property in the `gerrit.config` file and in addition Gerrit
tries to set this system property automatically on startup if it isn’t set yet.
However for some setups you may need to do additional actions to make sure that
this system property is set.

In addition there is a system property that needs to be set for
[request tracing](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/user-request-tracing.html)
(`flogger.logging_context=com.google.gerrit.server.logging.LoggingContext#getInstance`).
Also this system property is automatically set in the `gerrit.config` file by an
init step and in addition Gerrit tries to set this system property automatically
on startup if it isn’t set yet. However for some setups you may need to do
additional actions to make sure that this system property is set.

SLF4J can still be used by plugins, but using SLF4J in plugins is deprecated and
with the next Gerrit release SLF4J will no longer be exported as part of the
Gerrit plugin API jar. This means from the next release onwards, plugins must either
migrate to Flogger or have an own dependency on SLF4J.

### REST API

There are several new REST endpoints and additions to existing endpoints, as described in the [REST API](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/rest-api.html) documentation.

See below an overview of the noteworthy changes.

#### [Access Rights Endpoints](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/rest-api-access.html)

* [`ProjectAccessInfo`](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/rest-api-access.html#project-access-info)
  has a new field `configWebLinks` containing a list of URLs that display the history
  of the configuration file governing this project’s access rights.

#### [Accounts Endpoints](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/rest-api-accounts.html)

* [Query accounts](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/rest-api-accounts.html#query-account)
  requires the [Modify Account](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/access-control.html#capability_modifyAccount)
  permission to return all the emails associated with the account.
* New endpoint [`/drafts.delete`](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/rest-api-accounts.html#_delete_draft_comments)
  to remove the drafts comments associated with an account.

#### [Changes Endpoints](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/rest-api-changes.html)

* New endpoints to [lists](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/rest-api-changes.html#list-change-messages),
  [get](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/rest-api-changes.html#get-change-message)
  and [delete](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/rest-api-changes.html#delete-change-message)
  the messages `/messages` of a change including the detailed
  account information associated.
* New endpoint [`/cherrypick`](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/rest-api-changes.html#cherry-pick)
  to cherry-pick a specific commit.

#### [Config Endpoints](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/rest-api-config.html)

* New endpoint [`/server/reload`](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/rest-api-config.html#reload-config)
  to reload Gerrit configuration.
* New endpoint [`/server/preferences.edit`](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/rest-api-config.html#get-edit-preferences)
  to retrieve and update the global edit preferences for the server.

#### [Groups Endpoints](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/rest-api-groups.html)

* New option [`?owned-by`](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/rest-api-groups.html#_find_groups_that_are_owned_by_another_group)
  to find groups that are owned by another group

#### [Project Endpoints](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/rest-api-projects.html)

* New option `?state` to get [all projects](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/rest-api-projects.html#suggest-projects)
  with the given state.
* New option [`?query`](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/rest-api-projects.html#query-projects)
  for querying projects limited to a maximum of `?limit` entries.
* New endpoint `/description` for [updating](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/rest-api-projects.html#set-project-description)
  and [deleting](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/rest-api-projects.html#delete-project-description) the project’s description.
* [Check project access](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/rest-api-projects.html#check-access)
  endpoint is now a GET API while the [POST is still supported by deprecated](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/rest-api-projects.html#check-access-post).
* New endpoint to index a project [`/index`](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/rest-api-projects.html#index)
  and all the changes [`/index.changes`](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/rest-api-projects.html#index.changes)
  associated to it.
* New endpoint [`/check`](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/rest-api-projects.html#check)
  to check project’s consistency.

#### [Commit Endpoints](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/rest-api-projects.html#commit-endpoints)

* New endpoint [`/files`](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/rest-api-projects.html#list-files)
  to list files associated with a commit.

### Request Tracing

If a request is traced the unique trace ID is attached to all logs that are triggered
by the request. In addition all logs are enforced regardless of the configured log level.
Given the trace ID an administrator can find the trace in the error log and debug issues more
easily.

Detailed information about request tracing can be found in the
[request tracing documentation](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/user-request-tracing.html).

### New configuration option to ignore self approval on labels

A new option for Review Labels,
[label.Label-Name.ignoreSelfApproval](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16/config-labels.html#label_ignoreSelfApproval),
is available.

If true, the label may be voted on by the uploader of the latest patch set, but their approval does not make a change submittable. Instead, a non-uploader who has the right to vote has to approve the change.

It defaults to `false`, but one possible use case is to set the value to `true` for the `Code-Review` label in the `All-Projects` project.
That value will then be inherited by all projects that do not override the `Code-Review` label settings.

## Bug Fixes

* [Issue 10106](https://bugs.chromium.org/p/gerrit/issues/detail?id=10106):
  Fix internal server error when updating project access via REST API
  without specifying ‘action’ entity.

## Dependency Updates

* Update args4j to 2.33
* Update Brics Automaton to 1.12-1
* Update BouncyCastle to 1.60
* Update commons-compress to 1.15
* Update commons-lang3 and commons-net to 3.6
* Update Dropwizard metrics-core to 3.2.5
* Update Elasticsearch to 6.4.3 (Updated to 6.5.4 in 2.16.3)
* Add dependency to flexmark-java 0.34.18

  [Flexmark](https://github.com/vsch/flexmark-java) is a CommonMark/Markdown
  parser for java.
* Add dependency to flogger 0.3.1

  [Flogger](https://github.com/google/flogger) is a fluent logging API for Java
  and Gerrit is using Flogger instead of SLF4J now.
* Update greenmail to 1.5.5
* Update gson to 2.8.5
* Update guice-\* to 4.2.1
* Update JGit to 5.1.3.201810200350-r (Updated to 5.1.7.201904200442-r in 2.16.8)
* Update Lucene to 6.6.5
* Update mime4j to 0.8.1
* Update OpenID4Java to 1.0.0
* Update Ow2.asm to 6.2.1
* Update javax.mail to 1.6.0
* Update Jetty to 9.4.12.v20180830
* Update protobuf-java to 3.4.0
* Update soy to 2018-03-14
* Update SSHD to 2.0.0 and Mina to 2.0.17
* Update tomcat-servlet-api to 8.5.23
* Update tukaani-xz to 1.6
* Remove dependency on Velocity
* Remove dependency on joda-time and joda-convert

  NOTE: joda-\* dependencies are no longer exported in the Gerrit plugin API.
  Existing plugins that still rely on them need to be amended to include the
  explicit dependency on joda-\* libraries.

## Plugin API changes

* [`ChangeInfo`](https://gerrit.googlesource.com/gerrit/%2B/stable-2.16/java/com/google/gerrit/extensions/common/ChangeInfo.java)
  and [`RevisionInfo`](https://gerrit.googlesource.com/gerrit/%2B/stable-2.16/java/com/google/gerrit/extensions/common/RevisionInfo.java):
  Update copy methods to copy fields that have been added recently
* Support allow\_conflicts option in cherry-pick input on [`CherryPickInput`](https://gerrit.googlesource.com/gerrit/%2B/stable-2.16/java/com/google/gerrit/extensions/api/changes/CherryPickInput.java)
* Have common class for entries in [DynamicMap/DynamicSet/DynamicItem](https://gerrit-review.googlesource.com/q/I4293795800771ef06eae6ec6d64be4b0a8fd72f4)
* New API for deleting draft comments of a user in [`AccountApi`](https://gerrit.googlesource.com/gerrit/%2B/stable-2.16/java/com/google/gerrit/extensions/api/accounts/AccountApi.java)
* New annotation [`RemoveAfter`](https://gerrit.googlesource.com/gerrit/%2B/stable-2.16/java/com/google/gerrit/extensions/annotations/RemoveAfter.java) for documenting features in Gerrit that can be deprecated
* [`DynamicSet`](https://gerrit.googlesource.com/gerrit/%2B/stable-2.16/java/com/google/gerrit/extensions/registration/DynamicSet.java) returns Iterable for entries instead of Iterator
* Support for deleting change message via REST API in [`ChangeMessageApi`](https://gerrit.googlesource.com/gerrit/%2B/stable-2.16/java/com/google/gerrit/extensions/api/changes/ChangeMessageApi.java)
* New common interface for all REST views on collections, [`RestCollectionModifyView`](https://gerrit.googlesource.com/gerrit/%2B/stable-2.16/java/com/google/gerrit/extensions/restapi/RestCollectionModifyView.java),
  removing duplicate code in the RestApiServlet. Rest{Create,DeleteMissing}View are renamed to RestCollection{Create,DeleteMissing}View.
  See the [relevant change for more details](https://gerrit-review.googlesource.com/q/Id2289a51c7d55bd61222ac132084e7f87328504c).
* Support binding a RestView to delete a missing resource through a brand-new [`DeleteViewBinder`](https://gerrit.googlesource.com/gerrit/%2B/stable-2.16/java/com/google/gerrit/extensions/restapi/RestApiModule.java).
  See the [relevant change for more details](https://gerrit-review.googlesource.com/q/If64224d502bbfe578133d1255b42902dd4fbe4fb)
* New Api and REST endpoint to reindex a project on [`ProjectApi`](https://gerrit.googlesource.com/gerrit/%2B/stable-2.16/java/com/google/gerrit/extensions/api/projects/ProjectApi.java).
* New [RestCollection{Create,Delete,Modify}View](https://gerrit.googlesource.com/gerrit/%2B/stable-2.16/java/com/google/gerrit/extensions/restapi/RestCollectionCreateView.java)
  that can be bound for POST and DELETE requests on collections
  via RestApiModule. The AcceptPost interface is not available anymore and existing code making use of it needs
  to be adapted to use the RestCollectionView.
* Support getting account details in [`AccountApi`](https://gerrit.googlesource.com/gerrit/%2B/stable-2.16/java/com/google/gerrit/extensions/api/accounts/AccountApi.java).
* New API and REST endpoint for accessing change messages in [`ChangeApi`](https://gerrit.googlesource.com/gerrit/%2B/stable-2.16/java/com/google/gerrit/extensions/api/changes/ChangeApi.java).
* Add extension API for emails and support setting an email as preferred in
  [`AccountApi`](https://gerrit.googlesource.com/gerrit/%2B/stable-2.16/java/com/google/gerrit/extensions/api/accounts/AccountApi.java)
  and [`EmailApi`](https://gerrit.googlesource.com/gerrit/%2B/stable-2.16/java/com/google/gerrit/extensions/api/accounts/EmailApi.java).
* Add API and REST endpoints to get/set default edit preferences in [`Server`](https://gerrit.googlesource.com/gerrit/%2B/stable-2.16/java/com/google/gerrit/extensions/api/config/Server.java).
* Allow to filter list by project state in [`Projects`](https://gerrit.googlesource.com/gerrit/%2B/stable-2.16/java/com/google/gerrit/extensions/api/projects/Projects.java).

## Bugfix Releases

### 2.16.28

* New features

  + [Change 314702](https://gerrit-review.googlesource.com/314702):
    Introduce flag `--migrate-draft-to` during `init` for Schema\_159 migration.
  + [Issue 14777](https://crbug.com/gerrit/14777):
    Allow per-project on-line notedb migration.
* Reindex performance improvements

  + [Change 322935](https://gerrit-review.googlesource.com/322935):
    Fix buggy Index-Interactive Executor.

    Fix `index.threads` when set to a negative value which was not using a
    direct executor as mentioned in docs.
  + [Change 323215](https://gerrit-review.googlesource.com/323215)
    [Change 322296](https://gerrit-review.googlesource.com/322296):
    Disable auto flushing during offline Lucene indexing.
  + [Change 322835](https://gerrit-review.googlesource.com/322835):
    Use thread count specified on offline reindex command line.

    Honor the `--threads` command line option when provided instead of
    batchThreads property from `gerrit.config`.
* Gerrit migration performance improvements

  + [Change 322436](https://gerrit-review.googlesource.com/322436):
    Avoid creating loose objects in Schema 146.
  + [Change 322295](https://gerrit-review.googlesource.com/322295):
    Avoid creating loose objects in schema 167.
  + [Change 322435](https://gerrit-review.googlesource.com/322435):
    Fix schemas to use the appropriate ObjectInserter.
  + [Change 321115](https://gerrit-review.googlesource.com/321115):
    Update schemas 115,119 to create a desired initial commit.
  + [Change 321075](https://gerrit-review.googlesource.com/321075):
    Create initial commit in schema 146 only when necessary.
  + [Change 322115](https://gerrit-review.googlesource.com/322115)
    [Change 321496](https://gerrit-review.googlesource.com/321496)
    [Change 321495](https://gerrit-review.googlesource.com/321495)
    [Change 321135](https://gerrit-review.googlesource.com/321135)
    [Change 320178](https://gerrit-review.googlesource.com/320178):
    Avoid creating loose objects in schemas 115, 119, 124, 139, 144, and 154.
  + [Change 320179](https://gerrit-review.googlesource.com/320179):
    Parallelize inserts into accountPatchReviewDb in schema 127.

    Reduce the migration time on large sites by parallelizing inserts
    to accountPatchReviewDb. Default number of migration threads is equal
    to number of CPUs or can be manually configured through system property
    ‘schema127\_threadcount’.
  + [Change 320177](https://gerrit-review.googlesource.com/320177):
    Make schema migraitons more efficient by listing repositories only once.
  + [Change 321055](https://gerrit-review.googlesource.com/321055):
    Update schemas 115,139,144 to ignore entries not in the ‘accounts’ table.
  + [Change 302923](https://gerrit-review.googlesource.com/302923):
    Warm PostgreSQL DB before migration.
  + [Change 321635](https://gerrit-review.googlesource.com/c/gerrit/%2B/321635)
    [Change 319997](https://gerrit-review.googlesource.com/c/gerrit/%2B/319997):
    Parallelize schemas 108,130,131 which perform updates on each repository.
  + [Issue 14097](https://gerrit-review.googlesource.com/14097):
    Fix display the GC action on project commands for Gerrit in multi-site configuration.
* Bug Fixes

  + [Issue 15262](https://crbug.com/gerrit/15262):
    Prevent infinite loops with GWT UI and HTTP auth.

    Prevent the legacy HTTP form used for redirection
    with HTTP authentication from generating an invalid request
    ‘?polygerrit=0login/’ and going into an infinite login loop
    ‘?polygerrit=0login/login/’.
  + [Issue 14963](https://crbug.com/gerrit/14963):
    Fix /access REST APIs returning incorrect rule when group is duplicated for same rule.
  + [Change 323095](https://gerrit-review.googlesource.com/323095):
    Add `--migrate-draft-to` flag on init doc.
  + [Change 313561](https://gerrit-review.googlesource.com/313561):
    Handle null account-ids when sending e-mails.
  + [Change 313763](https://gerrit-review.googlesource.com/313763):
    Make shuffling project slices optional in notedb migrator.
  + [Change 302922](https://gerrit-review.googlesource.com/302922):
    Make GC on repositories optional in notedb migrator.
  + [Change 307602](https://gerrit-review.googlesource.com/c/gerrit/%2B/307602):
    Fix NPE while accessing draft refs.
  + [Change 307482](https://gerrit-review.googlesource.com/c/gerrit/%2B/307482):
    EqualsLabelPredicate: fix bug that prevents matching owner votes.
* Dependency Updates

  + Update JGit to 5.1.16.202106041830-r, which contains the following
    improvements:

    - [Change 180697](https://git.eclipse.org/r/180697):
      BatchRefUpdate: Skip saving conflicting ref names and prefixes in memory.
    - [Change 180559](https://git.eclipse.org/r/180559):
      Avoid having to scan over ALL loose refs to determine if the name is nested
      within or is a container of an existing reference.

### 2.16.27

* Bug Fixes

  + [Issue 13786](https://bugs.chromium.org/p/gerrit/issues/detail?id=13786):
    Update of user ssh key doesn’t get replicated to slave.
  + [Issue 13931](https://bugs.chromium.org/p/gerrit/issues/detail?id=13931):
    Inline edit allows the modification of Change-Id across patch-sets.
  + [Issue 14013](https://bugs.chromium.org/p/gerrit/issues/detail?id=14013):
    Gerrit uses ReviewDb even when migrated to NoteDb.

### 2.16.26

* Security Fixes

  + [Issue 13858](https://bugs.chromium.org/p/gerrit/issues/detail?id=13858)
    [CVE-2021-22553](https://nvd.nist.gov/vuln/detail/CVE-2021-22553):
    Fixed memory leak in Git-over-HTTP requests.

    Unauthenticated users could exploit this problem in a Denial of Service attack,
    causing the server to go out-of-memory.
* Dependency Updates

  + Update JGit to 5.1.15.202012011955-r.
  + Update testcontainers to 1.15.0.

### 2.16.25

* Security Fixes

  + [Issue 13621](https://bugs.chromium.org/p/gerrit/issues/detail?id=13621)
    [CVE-2020-8919](https://nvd.nist.gov/vuln/detail/CVE-2020-8919):
    Make `PermissionBackend#ForRef` authoritative.

    Fixes a misconception that leads to data being accessible through Gerrit
    APIs that should be locked down.

    Gerrit had two components for determining if a Git ref is visible to a
    user: `(Default)RefFilter` and `PermissionBackend#ForRef` (e.g.,
    `RefControl`). The former was always capable of providing correct results
    for all refs. The latter only had logic to decide if a Git ref is visible
    according to the Gerrit `READ` permissions. This includes all refs under
    `refs/heads` as well as any other ref that isn’t a database ref or a Git
    tag. This component was unaware of Git tags and notedb-related refs. Hence,
    when asked for a database reference such as `refs/changes/xx/yyyyxx/meta`,
    the logic would allow access if the user has `READ` permissions on any of
    the ref prefixes (such as the default “read refs/\* Anonymous Users”).

    That was problematic, because it bypassed
    [documented behavior](http://gerrit-documentation.storage.googleapis.com/Documentation/2.16.25/access-control.html)
    where a user should only have access to a change if he can see the
    destination ref. The same goes for other database references.
  + [Issue 13514](https://bugs.chromium.org/p/gerrit/issues/detail?id=13514)
    [CVE-2020-8920](https://nvd.nist.gov/vuln/detail/CVE-2020-8920):
    Work around Gitiles bug on `All-Users` visibility.

    Gitiles has a special `FilteredRepository` wrapper that allows carefully
    hiding refs based on the project’s ACLs. There is however an optimization
    that skips the filtering in case a user has `READ` permissions on every ACL
    pattern(s). When the target repository is `All-Users`, the optimization
    turns into a security issue because it allows seeing all personal information
    associated with all accounts, i.e.:

    - draft comments
    - draft edits
    - personally identifiable information (PII) of all users
    - external ids

    This fix now blocks Gitiles or any other part of Gerrit to abuse this power
    when the target repository is `All-Users`, where nobody can be authorized
    to skip the ACLs evaluation anyway.

### 2.16.24

This minor release has been withdrawn.

### 2.16.23

* NoteDb Migrator Fixes and Improvements

  + Introduce a new option `--force-state-change-with-skip` in the
    NoteDb migrator to force state change of the migration if projects are skipped.
  + Introduce a new option `--verbose` in the
    NoteDb migrator to display more information about the migration progress.
  + Log the NoteDb migration progress every 1000 changes.
  + Fix contention on single database connection which all migration threads were
    competing for. Instead use one database connection per thread.
  + Update noteDb status in chunks to avoid an excessive number of DB connections
    is used.
  + Use multiple threads per project for improving the performance when there are
    a lot of changes per project. The impact is negligible on projects with a limited
    number of changes.
  + Ensure that all exceptions happening during the migration are properly logged.
* PolyGerrit UI Fixes

  + [Issue 11706](https://bugs.chromium.org/p/gerrit/issues/detail?id=11706):
    Enable the ability to modify the commit message as part of change in-line edit.
  + [Issue 13328](https://bugs.chromium.org/p/gerrit/issues/detail?id=13328):
    Project dashboard links stored in ‘My’ menu (GWT) lead to ‘cannot load page’ when
    switched to PolyGerrit.
  + [Issue 13350](https://bugs.chromium.org/p/gerrit/issues/detail?id=13350):
    Cannot add group to (cc-)review if its UUID is not the internal one.
* Replication plugin Fixes

  + [Issue 12769](https://bugs.chromium.org/p/gerrit/issues/detail?id=12769):
    Pending replication events can delay the Gerrit startup for too long.
* Documentation Updates

  + Introduce the
    [documentation of Gerrit logs](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.23/logs.html)
    format and the meaning of each field.
  + Clarify [how to resolve common Bazel issues](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.23/dev-eclipse.html)
    with Eclipse project generation.
  + Document X-Forwarded-For header in the
    [Gerrit reverse-proxy section](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.23/config-reverseproxy.html).

### 2.16.22

* Security Fixes

  + [Issue 12846](https://bugs.chromium.org/p/gerrit/issues/detail?id=12846):
    BadMessageException: 500: Response header too large.

    [CVE-2019-17638](https://nvd.nist.gov/vuln/detail/CVE-2019-17638)

    Bump Jetty version to 9.4.30.v20200611 to fix regression introduced in Jetty
    version: 9.4.27.v20200227.

    Response header overflow leads to buffer corruptions Jetty server always
    allocates maximum response header size.

    For more details see also upstream issues:

    [Issue 4936](https://github.com/eclipse/jetty.project/issues/4936)
    [Issue 4541](https://github.com/eclipse/jetty.project/issues/4541)
* Bug Fixes

  + Use multiple threads per project when reindexing changes

    To avoid idling threads during reindex operation, split the big projects
    into smaller parts and let the thread pool index these parts.
  + [Issue 13105](https://bugs.chromium.org/p/gerrit/issues/detail?id=13105):
    Fix plugin builds on OSX

    This fixes plugin stamping by adding overwrite files without prompting
    option to unzip command.
  + [Issue 12988](https://bugs.chromium.org/p/gerrit/issues/detail?id=12988):
    Fix issue with auto registering ssh commands

    AutoRegisterModules and PluginGuiceEnvironment checks if
    ssh command implements org.apache.sshd.server.Command
    interface. Correct interface name is org.apache.sshd.server.command.Command.
  + [Issue 12935](https://bugs.chromium.org/p/gerrit/issues/detail?id=12935):
    Avoid closing System.out after All-Users GC in NoteDB migration

    By using try-with-resource wrappers around System.out for the garbage
    collection of the `All-Users` repo, System.out got closed when the
    wrappers got closed after the garbage collection. Due to the closed
    System.out, the final status messages of the migration got swallowed
    and did not make it to the screen.
  + [Issue 12918](https://bugs.chromium.org/p/gerrit/issues/detail?id=12918):
    Honor project watches also for changes created via cherry-pick

    When a change was cherry-picked and a project watch expression from a
    user matched the newly created change a notification email (because of
    the project watch) was often not sent.

    Change the default for the CherryPickInput.notify to ALL, the same like
    in the CreateChangeInput.
  + [Issue 12917](https://bugs.chromium.org/p/gerrit/issues/detail?id=12917):
    Switching between changes fails and in-line edit returns HTTP status 404.

    Switching between changes in a change series randomly fails.
    Also, when adding a file to a change using in-line edit fails constantly
    with an HTTP status 404.

### 2.16.21

* Security Fixes

  + [Issue 12717](https://bugs.chromium.org/p/gerrit/issues/detail?id=12717):
    Deny access over HTTP for disabled accounts.

    A disabled account was still able to access over HTTP until the existing
    session expired.
* Bug Fixes

  + [Issue 11707](https://bugs.chromium.org/p/gerrit/issues/detail?id=11706):
    Support `/COMMIT_MSG` for change edit REST endpoints.

### 2.16.20

* New Features

  + Bazel: Add //tools/bzl:always\_pass\_test rule to avoid boilerplate for running tests during build.
* Bug Fixes

  + [Issue 12844](https://bugs.chromium.org/p/gerrit/issues/detail?id=12844):
    Trim and update Gerrit full name from the one stored in LDAP during login.
* PolyGerrit UI Fixes

  + [Issue 12777](https://bugs.chromium.org/p/gerrit/issues/detail?id=12777):
    Hide the “No Votes” notice for labels created and approved by prolog rules.
* Replication Plugin Fixes

  + [Issue 12806](https://bugs.chromium.org/p/gerrit/issues/detail?id=12806):
    Fix a regression where the project deletion was not propagated to the remote nodes.

### 2.16.19

* Breaking Changes

  + Elasticsearch: Support for [EOL version 6.5](https://www.elastic.co/support/eol)
    is discontinued.
* New Features

  + Enable to run online noteDb migration using multiple threads.

    The new configuration option
    [`notedb.onlineMigrationThreads`](http://gerrit-documentation.storage.googleapis.com/Documentation/2.16.19/config-gerrit.html#notedb.onlineMigrationThreads)
    allows tuning the number of threads the migration can use.

    This helps to speed up online migration at the expense of imposing a
    higher load on the Gerrit server running at the same time.
  + Add a new metric for monitoring Java deadlocks.

    The metric `proc/jvm/thread/num_deadlocked_threads` monitors the number of
    threads that are deadlocked waiting for object monitors or ownable synchronizers.
  + Add support for Elasticsearch 7.7.
* End-to-end Tests Improvements

  + Allow end-to-end tests to proportionally scale on their expected execution times.

    A `power_factor` [environment property](http://gerrit-documentation.storage.googleapis.com/Documentation/2.16.19/dev-e2e-tests.html#_environment_properties)
    was added to the end-to-end tests core framework. Using that optional property,
    scenario steps can take some more (or less) time prior to expecting proper completion.

    The way to set that property locally then depends on the target runtime environment,
    or SUT latency. The property may be used for either core or plugin scenarios.
  + `FlushProjectsCache` related scenarios added to core (and the `high-availability` plugin).
  + Support for relative runtime weights in scenarios.

    Each scenario can now either weight like any other by default, or override that default
    with a greater weight value, compared to siblings that are lighter on execution times.

    Beside core, make the `high-availability` and `multi-site` plugin scenarios reuse this.
  + Allow scenarios to create and delete Gerrit changes alongside projects.

    Add the corresponding core support for an optional `http` request body to every such
    `GerritSimulation`. Either automate or allow [environment properties](http://gerrit-documentation.storage.googleapis.com/Documentation/2.16.19/dev-e2e-tests.html#_environment_properties)
    to feed the related input test data.

    Beside core, make the `high-availability` and `multi-site` plugin scenarios test changes
    that way. The latter currently has [Issue 12693](https://bugs.chromium.org/p/gerrit/issues/detail?id=12693)
    as a known limitation.
* Bug Fixes

  + [Issue 12637](https://bugs.chromium.org/p/gerrit/issues/detail?id=12637):
    Fix SQL connection timeout during migration to schema 146 and 154.

    A full GC is run at the beginning of the migration, after every 100k
    accounts, and at the end of the migration. Additionally, bitmap index
    generation is disabled during the migration.
  + [Issue 12606](https://bugs.chromium.org/p/gerrit/issues/detail?id=12606):
    Fix `visibleto` predicate for groups.

    If a group name was used in the `visibleto` predicate, changes were
    not returned even if the group had permission to see them.
  + [Issue 12747](https://bugs.chromium.org/p/gerrit/issues/detail?id=12747):
    Fix change query visibility for internal user.
  + [Issue 12755](https://bugs.chromium.org/p/gerrit/issues/detail?id=12755):
    Block the removal of the Realm primary external ids.

    It was possible to remove the email address associated with the primary
    id of a Realm, effectively resulting in the account being removed.
  + [Isssue 12786](https://bugs.chromium.org/p/gerrit/issues/detail?id=12786):
    Fix wrong status returned when auth backend couldn’t be reached.

    The response 401 was returned when the auth backend could not be
    reached, instead of the response 503.
  + Fix internal server error on parsing commit message during receive commits.
  + Add `autocomplete="off"` to LDAP login form.

    Some security tools will flag the absence of the autocomplete flag as a
    possible security issue, as it could allow for passwords to be saved and
    automatically filled in on shared computers.
  + [Issue 12646](https://bugs.chromium.org/p/gerrit/issues/detail?id=12646):
    Fix incorrect highlighting of diffs in the GWT UI.

    In some cases the highlighting was shown on an adjacent line rather than
    on the line that was actually changed. This happened in both the side-by-side
    and unified diff views in the GWT UI.
  + [Issue 12667](https://bugs.chromium.org/p/gerrit/issues/detail?id=12667):
    Fix unwanted expansion of common lines at the bottom of a diff in the GWT UI.
  + Accept `--ownedby` as an alias of `--owned-by` in the groups REST API.

    The option was incorrectly documented as `--ownedBy` which resulted in an
    error “not a valid option” if anyone tried to use it.

    The documentation is fixed, and `--ownedby` is added as an alias so that it
    also works for anyone still referring to the old documentation.
  + Fix various misuses of the Flogger API causing exception details to be omitted
    in the log output.

    Exceptions were not properly passed to the logger which would cause the
    details to be omitted, or in some cases the message “ERROR: UNUSED LOG ARGUMENTS”
    to be emitted.

    - When a project migration fails in the migration to schema 169
    - When an invalid PAPE response is received during OpenID authentication
    - When a plugin config is invalid and cannot be loaded
    - When an error occurs while migrating a change metadata entry to JSON
    - When there is an unsupported charset in a patch text
  + [Issue 12673](https://bugs.chromium.org/p/gerrit/issues/detail?id=12673):
    Fix emitting debug logs while running tests.
* PolyGerrit UI Fixes

  + [Issue 12707](https://bugs.chromium.org/p/gerrit/issues/detail?id=12707):
    Apply diff preferences immediately after pressing “Save”.
  + [Issue 12690](https://bugs.chromium.org/p/gerrit/issues/detail?id=12690):
    Only show the “Edit” button for open changes in the diff view.
  + [Issue 12726](https://bugs.chromium.org/p/gerrit/issues/detail?id=12726):
    Fix incorrect highlighting after `/` character in Javascript.
  + [Issue 12775](https://bugs.chromium.org/p/gerrit/issues/detail?id=12775):
    Fix parent of previous patch sets not being available.
* Replication Plugin Fixes

  + [Issue 12678](https://bugs.chromium.org/p/gerrit/issues/detail?id=12678):
    Fix missing replication Id in replication logs.

    The migration to use Flogger in 2.16.17 caused a regression in the logging,
    where the replication Id was omitted from the logs. This is fixed by reverting
    back to slf4j logging for the replication log.
  + [Issue 12719](https://bugs.chromium.org/p/gerrit/issues/detail?id=12719):
    Fix `replication start --wait` to track in-flight collisions and to not fail.
  + [Issue 12731](https://bugs.chromium.org/p/gerrit/issues/detail?id=12731):
    Don’t lose state when there’s a pending push to the same ref.

    If there was already a pending push (not an in-flight push) to the same endpoint,
    the start for the push would be dropped when adding the push to the Destination.
    This meant that a `replication start --wait` command would never complete when
    one of its pushes was pending since its state would never receive the completion
    notification for that push.
  + [Issue 11745](https://bugs.chromium.org/p/gerrit/issues/detail?id=11745):
    Fix firing pending “..all..” events on startup.
  + [Issue 11760](https://bugs.chromium.org/p/gerrit/issues/detail?id=11760):
    Make persistent task keys stable.
  + Fix URL matching to match real URLs in addition to templated URLs.
  + Log when skipping deletion of a ref when pushing to a remote in mirror mode.
  + Improve logging of push failures caused by a lock failure on the remote.
  + Improve logging of refs to be pushed.
* Library Upgrades

  + Upgrade jackson-core to 2.11.0
  + Upgrade jetty to 9.4.27.v20200227
  + Upgrade testcontainers to 1.14.2

### 2.16.18

* Breaking Changes

  + [Issue 12527](https://bugs.chromium.org/p/gerrit/issues/detail?id=12527):
    Elasticsearch: Support for EOL versions v5.6 and v6.0 to v6.4 is discontinued
  + Plugin API: Deprecated methods related to the draft workflow and change edits are removed

    - `ChangeApi.getEdit()`
    - `ChangeApi.publish()`
    - `RevisionApi.delete()`
    - `RevisionApi.publish()`
  + Metrics: Cache disk stat metric computation is disabled by default

    Calculation of the cache disks stat metrics for persistent caches is disabled
    by default because it is a very expensive operation that can block a thread for
    several minutes on larger installations.

    Installations that still want to use this metric must explicitly enable it with the
    [cache.enableDiskStatMetrics](http://gerrit-documentation.storage.googleapis.com/Documentation/2.16.18/config-gerrit.html#cache.enableDiskStatMetrics)
    configuration option.
* New Features

  + Make legacy version of the `commit-msg` hook available

    Make the older version of the `commit-msg` hook from gerrit 2.15.x,
    which does not use `git-intepret-trailers`, available from the site so that
    users who have an older client can download it.
* Bug Fixes

  + Fix handling of ambiguous name in `visibleto` search predicate

    If the `visibleto` search predicate was used with a display name that
    resolved to more than one account, the first account in the result was
    arbitrarily used. Now, this case will result in an error.
  + [Issue 11625](https://bugs.chromium.org/p/gerrit/issues/detail?id=11625):
    Avoid multiple notifications for existing reviewers.
* PolyGerrit UI Fixes

  + [Issue 12385](https://bugs.chromium.org/p/gerrit/issues/detail?id=12385):
    Fix memory leak in `gr-plugin-endpoints`.
* Library Upgrades

  + Upgrade rules\_closure to forked version

    This fixes the “-parameters is not supported for target value 1.7. Use 1.8 or later.”
    warning when building. See [PR 478](https://github.com/bazelbuild/rules_closure/pull/478).
  + [Issue 12448](https://bugs.chromium.org/p/gerrit/issues/detail?id=12448):
    Upgrade Guice to 4.2.3 and switch to using no-AOP Guice distribution

    This allows to more easily support newer JDK versions.
  + Upgrade asm to 7.2
  + [Issue 14242](https://bugs.chromium.org/p/gerrit/issues/detail?id=12424):
    Upgrade gwtjsonrpc to 1.12

    This fixes email token verification failures caused by non-URL-encoded characters.
* Security Fixes

  + [Issue 8952](https://bugs.chromium.org/p/gerrit/issues/detail?id=8952):
    Do not require explicit “Push Tag” rights to `refs/tags/*` for pushing an annotated tag over HTTPS.
* Replication Plugin Fixes

  + Improve logging of why a project or ref is not replicated.

### 2.16.17

* Breaking Changes

  + The `LogThreshold` annotation is removed.

    The default log level for tests has been changed from DEBUG to INFO,
    and this annotation is no longer needed. It was originally introduced
    to allow classes to explicitly set their log level at level other than
    DEBUG.

    Plugins that use this annotation must be adjusted.
  + `EnumSet` replaced with `Set` in all plugin API

    All the plugins API have been amended to avoid the use of concrete class
    `EnumSet` in their method signatures. Source-level compatibility is preserved
    because `Set` is a super-class of `EnumSet`. However, existing plugins would
    fail with NoSuchMethodException unless they are rebuilt against the new APIs.
* New Features

  + Add support for Elasticsearch 7.6.x.
  + Include `upload-pack` metrics in the sshd log.

    In order to enable detailed performance and problem analysis,
    `upload-pack` metrics are now included in the sshd log.
  + Add new configuration setting `core.packedGitUseStrongRefs`.

    When set to true, this option enables using strong references to reference
    packfile pages cached in the WindowCache. If this option is set Java gc can
    no longer flush the WindowCache to free memory if the used heap comes close
    to the maximum heap size. On the other hand this provides more predictable
    performance.
  + Add new configuration setting `sendemail.denyrcpt`.

    This new setting works alongside the existing `sendemail.allowrcpt`, and
    allows to configure email addresses or domains that Gerrit may not send to.
  + Allow to format HTTP and SSH logs in JSON format.

    When `log.jsonLogging` is enabled, the HTTP and SSH logs are formatted
    as JSON, making it easier for them to be parsed. Note that the error log
    was already formatted in JSON when this option was enabled.
  + Add new metrics.

    Metrics are added for:

    - Jetty connections
    - JGit WindowCache and total load time for block cache entries
    - Available number of cores
    - Average system load for the last minute

    Refer to the metrics documentation for full details.
  + [Issue 11493](https://bugs.chromium.org/p/gerrit/issues/detail?id=11493):
    Add an “Edit” button to the diff view in the PolyGerrit UI.
  + Add support for fsharp in highlighting syntax in the PolyGerrit UI.
  + [Issue 12364](https://bugs.chromium.org/p/gerrit/issues/detail?id=12364):
    Add support for going to a specific line number in the inline editor.
  + Add prolog predicate to determine number of parents.

    The new predicate `commit_parent_count` can be used to detect merge
    commits.
  + Add `NamedFluentLogger`

    `NamedFluentLogger` is an extension to Flogger that allows to create
    a logger with a given name rather than the name of the enclosing class.
  + [Issue 12444](https://bugs.chromium.org/p/gerrit/issues/detail?id=12444):
    Add support for `max_result_window` in Elasticsearch index configuration.
* Library Upgrades

  + Upgrade jackson-core to 2.10.3.
  + Upgrade Jetty to 9.4.24.v20191120, including a fix for supporting IPv6.
  + Upgrade JGit to 5.1.13.202002110435-r.
* Security Fixes

  + [Issue 12440](https://bugs.chromium.org/p/gerrit/issues/detail?id=12440):
    Fix the access-path for AbstractGitCommand subclasses.

    The access path for the Receive.currentUser in the receive-pack command
    was wrongly set to SSH\_COMMAND instead of to GIT.
    This allowed project owners to force-update a ref using git-over-SSH
    without having en explicit permission for that.
* Bug Fixes

  + [Issue 11772](https://bugs.chromium.org/p/gerrit/issues/detail?id=11772):
    Cancel deprecation of change identifiers that was planned since 2.16.

    Since 2.16 the documentation of change identifiers states that the
    identifiers other than `<project>~<numericid>` are deprecated and will
    be removed in a future release. Since then the identifiers have still
    not been removed and there is no clear plan to do so.

    It is likely that “deprecated” identifiers are still used in links in
    places where they can’t be updated, for example in emails and forum
    posts. Due to this, and since continuing to support all of the types
    does not add any technical burden, ESC decided that the deprecation
    should be cancelled.

    The `change.api.allowedIdentifier` configuration setting is now
    obsolete and has been removed.
  + [Issue 3340](https://bugs.chromium.org/p/gerrit/issues/detail?id=3340):
    Fix internal server errors when setting project access permission with bad regex.
  + [Issue 10397](https://bugs.chromium.org/p/gerrit/issues/detail?id=10397):
    Don’t send notification email when publishing a change edit on a WIP change.
  + Fix removal of stale metrics from the metrics registry.
  + [Issue 12349](https://bugs.chromium.org/p/gerrit/issues/detail?id=12349):
    Fix time attribute of file entries in plugin artifacts.
  + Make assumption on number of query results explicit for change Id arguments.

    When a change Id passed as argument was resolved to multiple changes,
    the first returned change was arbitrarily used. Now an error will be raised
    and logged.
  + download-commands plugin: Set SSH default port to 22.
  + [Issue 10248](https://bugs.chromium.org/p/gerrit/issues/detail?id=10248):
    Allow direct upgrade from v2.14, adding `created_on` column if it doesn’t exist.
  + Document dependency from account deactivator to autoUpdateAccountActiveStatus
    and log a warning if the account deactivation task is configured but will not
    be scheduled.
  + Modify draft comments generation so that, when removed, they to point to an
    empty parent, so that `All-Users` can avoid size explosion.
  + [Issue 12473](https://bugs.chromium.org/p/gerrit/issues/detail?id=12473):
    Fix broken links in Elasticsearch configuration documentation.
* PolyGerrit UI Fixes

  + [Issue 4616](https://bugs.chromium.org/p/gerrit/issues/detail?id=4616):
    Open commentlinks to changes on the same server in the same tab.
  + [Issue 12031](https://bugs.chromium.org/p/gerrit/issues/detail?id=12031):
    Fix issues with caching edited commit message.
  + Remove `target=_self` from commentlinks.
* Replication plugin fixes

  + Add method to push changes directly to given replica; intended to be used
    by other plugins that extend the replication plugin.
  + Check nulls in firePendingEvents at startup.

    After a sudden reboot (for unknown reason) Gerrit at startup couldn’t
    load because of NullPointerException.
  + Change default for the `replicateOnStartup` to false.
  + Don’t lose `ref-updated` events on plugin restart.

    When a `ref-updated` event is received, persist the event in the directory
    defined by the `replication.eventsDirectory`. When the updated ref is
    replicated delete the persisted event.
* Packaging Fixes

  + [Issue 12355](https://bugs.chromium.org/p/gerrit/issues/detail?id=12355):
    Do not overwirte /etc/default/gerritcodereview upon upgrade.
* Other Fixes

  + Fix various minor coding issues reported by Error Prone and Sonar Lint.
  + Reduce log spam of ‘Repository not found’ stack traces.
  + [Issue 11953](https://bugs.chromium.org/p/gerrit/issues/detail?id=11953):
    Reduce log spam during tests by reducing the default log level to INFO.

    The log level can now be explicitly set by the `GERRIT_LOG_LEVEL` system
    variable.

    The `LogThreshold` annotation is removed.

### 2.16.16

* New Features

  + Include request description in HTTP thread names.

    The HTTP worker threads had generic names like `HTTP-100`, `HTTP-101`,
    etc. While we could conclude from the stack trace what this thread was
    doing, we missed some important information like repository name, user name,
    etc.

    The HTTP threads now have descriptive names. For example, if there is an
    ongoing git-fetch operation we will see a thread named like:
    `HTTP POST /a/myProject/git-upload-pack (johndoe from 10.87.75.169)`.

    This makes the naming consistent with SSHD threads, which are named like:
    `SSH git-upload-pack /myProject (johndoe)`.
  + New metrics for Jetty threadpool.

    The new metrics are exposed under `http/server/jetty/*`.
  + Utility program to delete zombie draft comment refs.

    Deletion of draft comment refs was broken until 2.16.14, resulting in
    draft comment refs not getting deleted properly. Although it has been fixed,
    it’s still possible that zombie refs exist from previous versions. The
    new site program `DeleteZombieCommentsRefs` can be used to remove them.
  + Highlight `WORKSPACE` and `BUILD.bazel` files as Python in the PolyGerrit UI.
* Bug Fixes

  + [Issue 12246](https://bugs.chromium.org/p/gerrit/issues/detail?id=12246):
    Fix generation of duplicate ChangeIds when creating a new change via REST.

    The `Change-Id` was computed from the commit content and the timestamp,
    which resulted in the possibility for two changes to get the same `Change-Id`
    when two empty changes were created by REST at the same time.

    The `Change-Id` is now generated randomly.
  + [Issue 12097](https://bugs.chromium.org/p/gerrit/issues/detail?id=12097):
    Fix migration to NoteDb when orphan changes exist.

    In the case where a change belonged to a repository that did not exist,
    the migration failed.
  + [Issue 12171](https://bugs.chromium.org/p/gerrit/issues/detail?id=12171):
    Upgrade rules\_closure to the latest version to fix build breakage.

    [Maven Central now requires HTTPS](https://links.sonatype.com/central/501-https-required)
    when downloading artifacts and returns “501 HTTPS Required” when a request
    is done over plain HTTP. This caused the build of Gerrit to fail when done in
    a completely clean environment because the version of rules\_closure was still
    using HTTP.
  + [Issue 12243](https://bugs.chromium.org/p/gerrit/issues/detail?id=12243):
    Fix unexpected deactivation of service user accounts.
  + Fix editing name and email for service user accounts.
  + Don’t check for conflicting refs when deleting a ref; improve performance of
    migration to schema 167.

    The migration to schema 167 involves deletion of refs. The performance was
    poor for large installations (for example 30k user refs and 20k groups)
    because the ref deletion implementation was doing an unnecessary check for
    conflicting refs.
  + Fix setting `_moreChanges` to the wrong value in change query REST results.
  + Upgrade highlight-js to get various fixes in source code highlighting:

    - fix(makefile) fix double relevance for assignments
    - (xml) expand and improve document type highlighting
    - fix(kotlin): fix termination of “”” string literals
    - (cpp) Add additional keywords
    - Backslash is not used to escape in strings in standard SQL
    - (javascript) fix jsx self-closing tag issues
    - enh(ini) support arrays and much cleaner grammar
    - (javascript) support jsx fragments
* PolyGerrit UI Fixes

  + [Issue 11980](https://bugs.chromium.org/p/gerrit/issues/detail?id=11980):
    Fix handling of LDAP groups containing a dot in the PolyGerrit permissions screen.
  + [Issue 12197](https://bugs.chromium.org/p/gerrit/issues/detail?id=12197):
    Fix rendering of commentlinks using `link` in PolyGerrit UI.
  + Add `MessageOfTheDay` entries to `ServerInfo`.

    Messages registered to the `MessageOfTheDay` extension point are added to the
    `ServerInfo`, which is fetched via REST API and displayed in a PolyGerrit UI
    element.
* Other Changes

  + Upgrade jackson-core dependency to 2.10.2
  + Improve logging when a metadata update fails.
  + Replace documentation of `gerrit.ui` with `gerrit.enableGwtUi`.

    Since 2.16 the `gerrit.ui` setting is no longer recognized. PolyGerrit is the
    default UI and this cannot be changed. The GWT UI can be enabled by setting
    the `gerrit.enableGwtUi` flag; PolyGerrit is still the default but users may
    switch to GWT if they prefer.
  + Update [external Ids documentation](http://gerrit-documentation.storage.googleapis.com/Documentation/2.16.16/config-accounts.html#external-ids)
    with information on how to find the sha1 of an external Id and how to show the
    corresponding change note.

### 2.16.15

* New Features

  + Include thread name in the HTTPD and SSHD logs.

    Having thread name in the HTTPD and SSHD logs makes it easier to match entries
    from the error log. The error log entries already contain the thread name, so
    with the thread name included in each entry in the HTTPD and SSHD logs, we have
    more data to match an error to a request than just the timestamp.
* Bug Fixes

  + [Issue 12070](https://bugs.chromium.org/p/gerrit/issues/detail?id=12070):
    Fix internal server error on git over HTTP calls when SSHD is enabled.

    Double cleanup of the request context caused an internal server error on
    push or fetch via git over HTTP.

### 2.16.14

* New Features

  + [Issue 11973](https://bugs.chromium.org/p/gerrit/issues/detail?id=11973):
    Add copy-to-clipboard for generated HTTP password.
  + Add support for doctag in PolyGerrit UI syntax highlighter.
  + Add an event interface in the PolyGerrit API.
  + Add support for Elasticsearch 7.5.
  + Add documentation of how to perform backups of Gerrit.
* Breaking Changes

  + The default and minimum value of `execution.defaultThreadPoolSize` is
    increased to 2.
* PolyGerrit UI Fixes

  + [Issue 11993](https://bugs.chromium.org/p/gerrit/issues/detail?id=11993):
    Stop loading fonts from external resources.
  + [Issue 11984](https://bugs.chromium.org/p/gerrit/issues/detail?id=11984):
    Fix top menu bar on iOS.
  + [Issue 8282](https://bugs.chromium.org/p/gerrit/issues/detail?id=8282):
    Avoid browser caching for diff on edit patch.
  + [Issue 9444](https://bugs.chromium.org/p/gerrit/issues/detail?id=9444):
    Fix syntax highlighting for multi-char char constants.
  + [Issue 12020](https://bugs.chromium.org/p/gerrit/issues/detail?id=12020):
    Fix ‘New Contributor Agreement’ screen.
  + Fix `gr-syntax-params` css class.
  + Fix overflow of branch name in change list.
* Other Fixes

  + [Issue 7645](https://bugs.chromium.org/p/gerrit/issues/detail?id=7645):
    Fix thread deadlock when loading accounts from the account cache.

    Replacing Guava caches with Caffeine reduces the chances of having the
    deadlocks and improves the cache performance.
  + Disallow deleting the `refs/meta/config` branch via the ‘Delete Branches’
    REST API.
  + Disallow deleting the `HEAD` ref via the ‘Delete Branches’ REST API.
  + Allow empty base revision in the ‘Create Branch’ and ‘Create Tag’
    REST APIs.
  + Fix deletion of draft comment refs.

    In some situations, draft comment refs were not properly deleted
    but left empty. This resulted in unused draft refs persisting in
    the `All-Users` repository, polluting the namespace. Published draft
    comments as well as deleted draft comments were kept in the history
    of the draft ref, keeping them alive for GC, and causing a steady
    increase of repository size.
  + Use correct content type `text/plain` instead of `plain/text` in ‘Create SSH Key’
    REST API.
  + Fix handling of interactive/batch users in the QoS filter.

    For the git-over-http requests this filter didn’t work properly because the
    basic authentication happened later in the filter chain and at the moment when
    the QoS filter was invoked the current user was not yet set.
  + Add project name to headers of outgoing change emails.
  + Fix and expand documentation of `ref-update` and `commit-received` hooks
    in the hooks plugin.
  + Upgrade gitiles blame-cache to 0.2-7.1.
  + Upgrade jackson-core to 2.10.1.

### 2.16.13

* New features:

  + Add a method on `ProjectConfig` to read from the repository.

    Add a method that allows to read the config from the repository without
    having to provide a `MetaDataUpdate` instance.
  + New syntax highlighting files format supported.

    Highlight Jinja2, Jenkinsfile, Soy and VHDL formats; associate cproj, xaml and
    svg as xml.
  + New `getConfig()` method in the PolyGerrit Plugin RestApi interface.

    Make the PolyGerrit RestApi interface to retrieve the server config and to cache it,
    accessible to plugins.
  + Add “readOnly” endpoint parameter to repo-config endpoint in PolyGerrit Plugin RestApi.
* PolyGerrit UI Fixes

  + Hide “HTTP Credentials” if auth is not `HTTP` or `HTTP_LDAP`.
  + [Issue 11782](https://bugs.chromium.org/p/gerrit/issues/detail?id=11782):
    Fix assignment of CSS style for CodeReview -1 labels within comments.
  + [Issue 7083](https://bugs.chromium.org/p/gerrit/issues/detail?id=7083):
    Stop query from executing if predicate is empty.
  + [Issue 8513](https://bugs.chromium.org/p/gerrit/issues/detail?id=8513):
    Add the SHA hash of each patchset in dropdown menu as it was in the old GWT UI.
  + [Issue 11715](https://bugs.chromium.org/p/gerrit/issues/detail?id=11715):
    Fix total additions/deletions counters when viewing diff against parent 1 on merge commit.
  + [Issue 11682](https://bugs.chromium.org/p/gerrit/issues/detail?id=11682):
    Fix some corner-cases in the diff view where the download file feature did not work for
    added, renamed and deleted files.
  + [Issue 10047](https://bugs.chromium.org/p/gerrit/issues/detail?id=10047):
    Add shortcut to copy ssh-rsa public key.
  + [Issue 7867](https://bugs.chromium.org/p/gerrit/issues/detail?id=7867):
    Allow downloading the complete diff file as in the old GWT UI.
* Elasticsearch Updates:

  + Add support for Elasticsearch 7.4.
  + Update elasticsearch-rest-client to 7.4.2.
* Replication plugin Fixes

  + [Issue 11573](https://bugs.chromium.org/p/gerrit/issues/detail?id=11573):
    Fix dropping events during plugin restart.
* JGit Updates:

  + Upgrade JGit to 5.1.12.201910011832-r.

    This JGit version brings significant performance improvement in the case when
    Gerrit loads all external-ids from NoteDb. This happens whenever the
    external\_ids\_map cache gets invalidated or expires.
* Other Fixes

  + [Issue 11246](https://bugs.chromium.org/p/gerrit/issues/detail?id=11246):
    Fix login failures “email <> is already assigned to account <> …” after upgrading to v2.16.

    Fix a recurring issue after the migration of external ids from ReviewDb
    to NoteDb failing with the error ‘Email <> is already assigned to
    account <>’ and thus failing LDAP authentication.
  + [Issue 9001](https://bugs.chromium.org/p/gerrit/issues/detail?id=9001):
    Fix external-id consistency checker e-mail validation.

    Do not enforce emails on external IDs to be globally unique but allow the same e-mail
    repeated multiple times as long as it associated to the same account id.
  + Fix change message when automatically abandoning a change for a project
    that has been deleted.

    The change message and the message tag were inverted.
  + Fix commit message subject when updating project description by REST API.

    The tense of the commit message subject was inconsistent with other similar
    messages.
  + Fix commit timestamp when updating project configurations.

    For some REST API operations that update the project configuration, the
    commit that does the update on `refs/meta/config` had the wrong timestamp.
    Rather than being the time of the actual commit, it was always the time
    of the server startup.

    This was the case for the following operations:

    - Updating the description.
    - Setting the parent project.
    - Updating group names while getting access settings.
  + Upgrade jackson-core to 2.10.0.

    This version includes a fix for [CVE-2019-12384](https://nvd.nist.gov/vuln/detail/CVE-2019-12384).
  + Add more detailed debug logging when not sending an outgoing email.

    There are several conditions that could cause sending of an outgoing
    email to be skipped. These are now logged at debug level.
  + Increase severity to error for logging of exceptions during site initialization.
  + [Issue 4824](https://bugs.chromium.org/p/gerrit/issues/detail?id=4824):
    Handle multiple `httpd.listenUrl` values.

    Per the [documentation](http://gerrit-documentation.storage.googleapis.com/Documentation/2.16.13/config-gerrit.html#httpd.listenUrl),
    multiple values are supported, but if multiple values were specified Gerrit
    would fail to start.
  + Do not overwrite `httpd.listenUrl` during init, until the input has been checked as valid.

    Fix a bug where during the Gerrit init in interactive mode the input was
    invalid for the HTTP daemon settings, but still written to the configuration file.

### 2.16.12

* New features

  + [Issue 11356](https://bugs.chromium.org/p/gerrit/issues/detail?id=11356):
    Allow to override auto-detected Lucene index configuration.

    The new settings
    [`index.name.maxMergeCount`](http://gerrit-documentation.storage.googleapis.com/Documentation/2.16.12/config-gerrit.html#index.name.maxMergeCount),
    [`index.name.maxThreadCount`](http://gerrit-documentation.storage.googleapis.com/Documentation/2.16.12/config-gerrit.html#index.name.maxThreadCount) and
    [`index.name.enableAutoIOThrottle`](http://gerrit-documentation.storage.googleapis.com/Documentation/2.16.12/config-gerrit.html#index.name.enableAutoIOThrottle)
    allow to manually configure the Lucene index, rather than using auto-detected
    values, to improve performance.
* PolyGerrit UI Fixes

  + Add “Delete Changes” permission to the access editor.
  + Remove obsolete “Delete Drafts” and “View Drafts” permissions from the access editor.
  + Use –header-text-color css variable for some classes in gr-main-header
* Elasticsearch Updates:

  + Upgrade elasticsearch-rest-client to 7.3.2.
* Other fixes

  + [Issue 11491](https://bugs.chromium.org/p/gerrit/issues/detail?id=11491):
    Fix git clone/fetch/pull over SSH in high-latency network ending with SSH\_MSG\_CHANNEL\_WINDOW\_ADJUST error.
  + [Issue 11442](https://bugs.chromium.org/p/gerrit/issues/detail?id=11442):
    Fix push failing with internal server error sporadically when notedb.changes.read=True is configured.
  + [Issue 11205](https://bugs.chromium.org/p/gerrit/issues/detail?id=11205):
    Allow Gerrit admins to reindex a change even when Read access is not allowed on its target branch.
  + [Issue 11444](https://bugs.chromium.org/p/gerrit/issues/detail?id=11444):
    Fix the wrong progress output during online migration in error\_log and use the correct charset conversion.
  + Upgrade JGit to 5.1.11.201909031202-r.

    This version includes a fix for racy atomic ref updates.
* Replication plugin Fixes

  + [Issue 11145](https://bugs.chromium.org/p/gerrit/issues/detail?id=11145):
    Drain replication queue before stopping the plugin.
  + [Issue 11424](https://bugs.chromium.org/p/gerrit/issues/detail?id=11424):
    Fix ReplicationTasksStorage exceptions in error\_log when triggering replication of all refs.
* Singleusergroup plugin Fixes

  + [Issue 11498](https://bugs.chromium.org/p/gerrit/issues/detail?id=11498):
    Fix group resolution for all numeric usernames.

### 2.16.11.1

* **Breaking changes**

  + [Issue 11216](https://bugs.chromium.org/p/gerrit/issues/detail?id=11216):
    Remove hard-coded bug tracker URL and use configured value if present.
  + Increase default number of SSHD threads to at least 4.

    The default value of the `sshd.threads` setting is changed to be either two
    times the number of available CPU cores, or 4, whichever is greater.
* New Features

  + [Issue 11028](https://bugs.chromium.org/p/gerrit/issues/detail?id=11028):
    Add support for “Link Another Identity” screen in PolyGerrit
  + CommitApi: Add method to get commit info
  + [Issue 10166](https://bugs.chromium.org/p/gerrit/issues/detail?id=10166):
    Add shortcuts for dashboard and watched changes in PolyGerrit
  + [Issue 11201](https://bugs.chromium.org/p/gerrit/issues/detail?id=11201):
    Add ability to have custom label with a missing text value in PolyGerrit
  + Add a PolyGerrit extension point to show a small banner next to the search bar.

    A plugin or a site theme (gerrit-theme.html) may register a custom
    Element to be inserted into this endpoint.
  + Expose Gerrit’s GWT client library in the plugin API
  + [Issue 5791](https://bugs.chromium.org/p/gerrit/issues/detail?id=5791):
    Add an extension point to allow setting a site banner.
  + Add an extension point to allow custom site footers.
* Elasticsearch Updates:

  + [Issue 11266](https://bugs.chromium.org/p/gerrit/issues/detail?id=11266):
    Add support for Elasticsearch 6.8.
  + [Issue 11267](https://bugs.chromium.org/p/gerrit/issues/detail?id=11267):
    Add support for Elasticsearch 7.3.
  + Update elasticsearch-rest-client to 7.3.1.
* PolyGerrit fixes

  + [Issue 11350](https://bugs.chromium.org/p/gerrit/issues/detail?id=11350):
    Upgrade highlight.js to latest master revision.

    The upgrade solves a rendering bug of Kotlin nested substitutions.
  + [Issue 10733](https://bugs.chromium.org/p/gerrit/issues/detail?id=10733):
    Fix anchors not working at page load on settings page
  + [Issue 10062](https://bugs.chromium.org/p/gerrit/issues/detail?id=10062):
    Fix Polygerrit converting plus (+) to space when calling email.confirm API,
    and then failing with “invalid token”
  + [Issue 11096](https://bugs.chromium.org/p/gerrit/issues/detail?id=11096):
    Fix page not opening after a couple of times switching between GWT and PolyGerrit UI.
  + [Issue 11344](https://bugs.chromium.org/p/gerrit/issues/detail?id=11344):
    Fix commentlink URL and HTML links when canonical URL includes a base link.
* Other fixes

  + [Issue 11348](https://bugs.chromium.org/p/gerrit/issues/detail?id=11348):
    Display on error\_log the progress of the online migration from ReviewDb to NoteDb.
  + [Issue 11083](https://bugs.chromium.org/p/gerrit/issues/detail?id=11083):
    Set the correct new revision on change-merged events when submitting by push.

    When multiple changes are submitted at the same time by push, the new revision
    in all the change-merged events should be the revision of the head of the
    destination branch after all changes are submitted.
  + [Issue 11106](https://bugs.chromium.org/p/gerrit/issues/detail?id=11106):
    Fix missing comment context for left side in email notifications.
  + Adapt `gerrit.sh` script to work on Alpine Linux.
  + Expose Gerrit’s GWT client library in the plugin API.
  + Add a new method on the commit API to get “included in” information.
  + Add methods on the change API to get comments and draft comments as lists.
  + Add back the oneByExternalId method on InternalAccountQuery.

    This was removed in 2.16 but is added back so it can be used by plugins
    and extensions.
  + Make DefaultChangeReportFormatter extendible by plugins.
  + Make the wording of the “Change Merged” email templates consistent between the
    HTML and text versions.
  + Add a `.gitreview` file.

    For developers used to using the [git-review tool](https://pypi.org/project/git-review/)
    for interacting with gerrit servers, it’s necessary to have a `.gitreview` file
    in the repo in question pointing to where the gerrit is.
  + Reduce log spam of “setting reductionLimit” debug messages of the Prolog engine.
  + [Issue 11325](https://bugs.chromium.org/p/gerrit/issues/detail?id=11325):
    Do not update change set modified date on ReviewDb when a user delete all its draft changes.
  + Fix rebase change REST API returned status code.

    The rebase change REST API returned 422 Unprocessable Entity, instead of 500 Internal Server Error,
    if the specified base change is missing.
  + Fix detecting changes of parent trees when computing change kind for merge commit.

    A new patch set of a merge change is considered as NO\_CHANGE if the
    commits have the same delta and trees. For merge commits this includes
    comparing the trees of the parent commits.
  + Catch all exceptions for reporting on Schema\_130 migration and display the name of the project
    that failed the migration.
  + Fix and expand documentation of REST API to get revision files
  + [Issue 11235](https://bugs.chromium.org/p/gerrit/issues/detail?id=11235):
    Fix ls-user-refs reporting wrong results because it was not using the identity of the username given as parameter.
  + [Issue 11222](https://bugs.chromium.org/p/gerrit/issues/detail?id=11222):
    Skip receive.maxBatchCommits when skip-validation option is passed and a commit validator implements
    shouldValidateAllCommits
  + [Issue 10855](https://bugs.chromium.org/p/gerrit/issues/detail?id=10855):
    Fix standalone GWT plugin builds failing because of a broken transitive load of GWT\_PLUGIN\_DEPS for in-tree plugin builds
  + [Issue 11148](https://bugs.chromium.org/p/gerrit/issues/detail?id=11148):
    Speedup online reindex migration by skipping evaluation of submit rules for closed changes.
  + [Issue 11016](https://bugs.chromium.org/p/gerrit/issues/detail?id=11016):
    Fix Gerrit slave site init leads to update failure on system\_config caused by read-only transaction
  + [Issue 11271](https://bugs.chromium.org/p/gerrit/issues/detail?id=11271):
    Update rules\_go to 0.18.6 for compatibility with Bazel 0.27.0
* Replication plugin Fixes

  + [Issue 10852](https://bugs.chromium.org/p/gerrit/issues/detail?id=10852):
    Fix stale replications caused by in-flight pushes not properly removed when failed.
  + [Issue 11204](https://bugs.chromium.org/p/gerrit/issues/detail?id=11204):
    Fix creation of missing repository when replicating to a Gerrit server over HTTP.
  + [Issue 11175](https://bugs.chromium.org/p/gerrit/issues/detail?id=11175):
    Introduce new ref-filtering extension point for preventing replication of outdated SHA1s,
    mostly useful in a multi-site scenario to prevent split-brain.
  + [Issue 11055](https://bugs.chromium.org/p/gerrit/issues/detail?id=11055):
    Fix failure to start when re-triggering persisted events
  + [Issue 11172](https://bugs.chromium.org/p/gerrit/issues/detail?id=11172):
    Fix persisted event is removed before all replications to all nodes are completed.
  + When replication plugin is stopped or reloaded, mark all the currently pending replications as cancelled.
  + Allow to configure timeout for SSH connections and SSH commands.

    The timeouts can be configured with `gerrit.sshConnectionTimeout` and
    `gerrit.sshCommandTimeout`, respectively.
  + Make more classes and fields public/protected to ease extensibility.
  + Improve handling of remote repository creation failures.
  + Reintroduce boolean return value of methods in AdminApi.
  + Refactor AdminApiFactory to an interface with a default implementation that
    gets bound as a dynamic item, which can be replaced by derived implementations.
  + When rescheduling due to in-flight push also log the in-flight task ID.

### 2.16.10

* [Issue 11016](https://bugs.chromium.org/p/gerrit/issues/detail?id=11016):
  Fix failure to initialize on slave.
* [Issue 10763](https://bugs.chromium.org/p/gerrit/issues/detail?id=10763):
  Fix ACLs to allow regexes for tag and ref permissions.

  The documentation states that reference names can also be described with
  a regular expression by prefixing the reference name with `^`, but the UI
  only showed the creation field when a non-regex name was used.
* [Issue 11082](https://bugs.chromium.org/p/gerrit/issues/detail?id=11082):
  Close changes oldest first when submitting on push.
* [Issue 11059](https://bugs.chromium.org/p/gerrit/issues/detail?id=11059):
  Fix setting `BLOCK` on partial label range in permissions.
* [Issue 10852](https://bugs.chromium.org/p/gerrit/issues/detail?id=10852):
  Replication plugin: Fix scheduling starvation.
* [Issue 11110](https://bugs.chromium.org/p/gerrit/issues/detail?id=11110):
  Do not swallow the exceptions that caused REST-API to return with a status >= 400.
* [Issue 11086](https://bugs.chromium.org/p/gerrit/issues/detail?id=11086):
  When a WIP change is implicitly merged by direct push to the branch, its WIP
  state is unset.
* Show submit button with tooltip when not allowed to submit.

  The submit button was hidden when the user did not have permission to submit,
  or other conditions prevented submit (for example the change being WIP).
* Allow commit validation listeners to ignore the `skip-validation` push option.

  Gerrit allows certain users to skip validation of new commits by passing
  the `skip-validation` push option.

  A new method `shouldValidateAllCommits` is added on the
  `CommitValidationListener`, to allow plugin implemented validators to
  override this option and always be invoked for new commits. The new
  method has a default implementation that returns `false` meaning that
  existing implementations don’t need to be modified and will behave the
  same as before.
* Optimize commit and ref operation validation for non-ff push.

  On a non-ff push all the commits were validated before the ref operation
  was validated. On a push with many commits, validating all the commits is
  wasteful in the case where the ref operation is rejected. The logic is
  changed so that the ref operation validation is performed before the commit
  validation.
* Disallow change index task duplication.

  It was possible for multiple index tasks to be queued for the same change.
* Fix formatting issues and inconsistencies in soy email templates.
* Use URL Formatter interface to generate URL in outgoing emails.
* Fix error message when JRE is not found when starting Gerrit.

  The error message recommended to check for a JRE “>= 1.7”, but Gerrit requires
  Java 8 minimum.
* Expose the `createProject` method of the `CreateProject` class to plugins.

  This allows plugins to directly invoke the project creation, avoiding the
  checks that are performed when invoking via the `apply` method.
* Expose the jsr305 library in the plugin API.
* PolyGerrit UI Fixes

  + Only display 404 page on initial load.
  + Don’t reload when viewing dashboard.
  + Fix hiding the HTTP password screen.

    It was possible for the HTTP password to be un-hidden using CSS.
  + Add an extension point to allow adding links to the user header.
  + Add extension point to the footer so that users can add links to their
    Privacy policy or Code of conduct.
  + Fix dialog popup when going to /admin/create-project.
* Elasticsearch Fixes

  + Support for Elasticsearch 7.2 and and upgrade elasticsearch-rest-client to 7.2.0.
  + [Issue 10499](https://bugs.chromium.org/p/gerrit/issues/detail?id=10499):
    Set default number of shards according to Elasticsearch version.

    In Elasticsearch version 7.0 the default number of shards was reduced from
    5 to 1.

    See the [Elasticsearch documentation](https://www.elastic.co/guide/en/elasticsearch/reference/current/getting-started-concepts.html#getting-started-shards-and-replicas)
    for details.

### 2.16.9

* Improve performance of migration of accounts to schema 146.

  + Migration of the accounts is parallelized. The default number of threads
    used is the number of available processors. This can be customized using
    the `threadcount` system property.
  + Before the migration, `gc --prune=now` is executed.
  + When hosted on `FileRepository`, refs are packed after migration of every
    1000 accounts.
  + A progress indicator counts every 100 accounts migrated.
* [Issue 10790](https://bugs.chromium.org/p/gerrit/issues/detail?id=10790):
  Avoid evaluating submit rules twice for open changes.

  Prolog submit rules were evaluated twice per page view for an open change,
  which caused performance degradation on projects defining complex rules.
* [Issue 10943](https://bugs.chromium.org/p/gerrit/issues/detail?id=10943):
  Set `References:` header on new change notification mail.

  GMail changed the way
  [emails are grouped in conversation view](https://gsuiteupdates.googleblog.com/2019/03/threading-changes-in-gmail-conversation-view.html),
  which, combined with the fact that
  [Amazon SES changes the `Message-ID` header](https://forums.aws.amazon.com/message.jspa?messageID=262855),
  resulted in the new change notification email not being grouped with
  subsequent emails related to the same change.
* [Issue 10896](https://bugs.chromium.org/p/gerrit/issues/detail?id=10896):
  Fix eliding project name without slash in notification emails.
* [Issue 10920](https://bugs.chromium.org/p/gerrit/issues/detail?id=10920):
  Fix commit date of initial empty commit when creating new project.

  The commit date of the initial commit was the server start time, rather than
  the date of the actual commit.
* [Issue 10952](https://bugs.chromium.org/p/gerrit/issues/detail?id=10952):
  Fix definition of `PID` in `gerrit.sh`.
* Don’t send “GPG keys added” notification when no GPG keys were added.

  A GPG key update can include both addition and removal of GPG keys. The
  notification email for addition of new keys was always sent, even if the
  update only removed keys.
* Update email notifications on changing security related settings.

  Email notifications are now sent when a GPG or SSH key is removed, and
  when the HTTP password is deleted or changed.

  An email notification is now always sent when an SSH key is added to an
  account, even when it was added by an administrator.

  These notifications allow to alert the user if their account is compromised
  and keys or password are altered by the attacker.
* Remove explicit dependency on protobuf\_java.

  The protobuf\_java library is now consumed from rules\_closure.
* Add methods to generate and set the HTTP password on the accounts API.
* Don’t send “GPG keys added” notification when no GPG keys were added.

  A GPG key update can include both the addition and removal of GPG keys. The
  notification email for the addition of new keys was always sent, even if the
  update only removed keys.
* Add methods to generate and set the HTTP password on the accounts API.
* [Issue 10664](https://bugs.chromium.org/p/gerrit/issues/detail?id=10664):
  Fix duplicate key detection when using MySQL for the patch review store.

  Retrieve the error code number from the SQL exception to
  correctly detect and ignore a duplicate key error.
* [Issue 10359](https://bugs.chromium.org/p/gerrit/issues/detail?id=10359):
  LDAP: support servers that do not allow anonymous browsing.

  Add `ldap.supportAnonymous` configuration setting in gerrit.config to support
  servers that do not allow anonymous browsing. Default is true per standard and
  best practice.
* Elasticsearch fixes

  + [Issue 10496](https://bugs.chromium.org/p/gerrit/issues/detail?id=10496) and
    [Issue 10844](https://bugs.chromium.org/p/gerrit/issues/detail?id=10884):
    Fix usage of `include_type_name` in index creation.
  + Add support for Elasticsearch 7.1.
  + Upgrade elasticsearch-rest-client to 7.1.1.
* PolyGerrit UI fixes

  + [Issue 11020](https://bugs.chromium.org/p/gerrit/issues/detail?id=11020):
    Add syntax highlighting for mjs files.
  + [Issue 10549](https://bugs.chromium.org/p/gerrit/issues/detail?id=10549):
    Fix single tab indentation in PolyGerrit diff view.
  + [Issue 9409](https://bugs.chromium.org/p/gerrit/issues/detail?id=9409):
    Fix replacement of file content when navigating between files with `[` and `]`.
  + Upgrade polymer-resin to 2.0.1.
  + [Issue 10670](https://bugs.chromium.org/p/gerrit/issues/detail?id=10670):
    Fix selection of merge base when navigating between merge commit changes.

    When navigating between merge commit changes, the selection of the merge base was not persisted.
  + Hide overflowing author element content.

    In the case of vertical stacking Unicode characters, it was possible for
    the text to overflow out of the element and into other details on the
    review page.

    That is a partial fix for the problem described in
    [issue 10795](https://bugs.chromium.org/p/gerrit/issues/detail?id=10795).
  + [Issue 10744](https://bugs.chromium.org/p/gerrit/issues/detail?id=10744):
    Fix display of “Show More” after change screen reloaded.
  + [Issue 10757](https://bugs.chromium.org/p/gerrit/issues/detail?id=10757):
    Fix handling of “Automatically mark viewed files reviewed” preference.

    Files were automatically marked as reviewed even when the setting was
    disabled.
  + [Issue 10549](https://bugs.chromium.org/p/gerrit/issues/detail?id=10549):
    Fix single tab indentation in diff view.
  + Use dom-if instead of CSS when hiding the user’s password in the element
    `gr-http-password`, to prevent users from using CSS to reshow the
    password screen.
  + Hide project-aware top menus from the header.
  + Upgrade highlightjs for syntax highlighting fixes:

    - Treat `False`, `None` and `True` as literals in python.
    - Fully support C++11 raw strings in cpp.
* Core plugins

  + Replication plugin: Fix internal server error when username or password not
    specified for remote.

    The username and password are both optional, but the replication plugin
    failed with a null pointer exception if either of them was omitted.
  + codemirror-plugin: upgraded to the latest revision on master, which includes
    the following fixes and improvements:

    - Bazel: Fix lint warning flagged by buildifier
    - Add .mailmap
    - Remove CodeMirror modes that are not supported at Google
* Documentation updates

  + [Issue 10897](https://bugs.chromium.org/p/gerrit/issues/detail?id=10897):
    Update links to Google individual and corporate CLA pages.
  + Clarify that account must have a username to be able to set HTTP password.
  + Fix formatting in project config documentation.

### 2.16.8

* [Issue 10695](https://bugs.chromium.org/p/gerrit/issues/detail?id=10695):
  Upgrade JGit to 5.1.7.201904200442-r to fix regression in packfile list
  handling.

  If `core.trustfolderstat` was set to `false`, an infinite loop could occur
  when an object was not found in the packfile.
* Add support for Elasticsearch 6.7.x and 7.0.x.

  The elasticsearch-rest-client is upgraded to 7.0.0.
* Don’t abort auto-abandoning if one change failed.

  When failing to query a single change during auto-abandoning, the whole
  process was aborted. Now the failure is logged and the process continues
  to attempt to abandon subsequent changes.
* [Issue 10693](https://bugs.chromium.org/p/gerrit/issues/detail?id=10693):
  Avoid empty item in list of conflicting files on cherry-picking a change.
* Fix leak of temp files during merge operations.

  `TemporaryBuffer` instances created during merge operations could leave
  undeleted temporary files in the file system.
* Improve logging of invalid schedule values, and clarify documentation.

  When a schedule value, for example `gc.startTime` or `gc.interval`, was
  configured, the error message in the log was not helpful. This is now
  improved to include more information about what was wrong.

  Additionally, the documentation is updated to clarify that the hour
  value in times must be zero-padded.
* Install `AddKeyHtml.soy` template example during installation.

  The installation of this template into `$site_path/etc/mail` was
  omitted.
* Upgrade Flogger to version 0.4.
* Upgrade metrics-core to 4.0.5.
* Upgrade protobuf-java to 3.7.1.
* PolyGerrit Fixes

  + [Issue 10696](https://bugs.chromium.org/p/gerrit/issues/detail?id=10696):
    Increase autocomplete limit for repo inheritance in access page to 50.
  + [Issue 10703](https://bugs.chromium.org/p/gerrit/issues/detail?id=10703):
    Highlight Starlark files as Python.
  + Do not show the HTTP credentials screen when auth type is not HTTP.

### 2.16.7

#### New Features

* [Issue 5728](https://bugs.chromium.org/p/gerrit/issues/detail?id=5728):
  Add support for cherry-picking changes with merge conflicts in PolyGerrit.
* [Issue 8081](https://bugs.chromium.org/p/gerrit/issues/detail?id=8081):
  Add support for “Show Relative Dates in Changes Table” preference in PolyGerrit.
* [Issue 8838](https://bugs.chromium.org/p/gerrit/issues/detail?id=8838):
  Add support for “Default Base For Merges” preference in PolyGerrit.

#### Bug fixes

##### PolyGerrit

* [Issue 9851](https://bugs.chromium.org/p/gerrit/issues/detail?id=9851):
  Fix avatars not showing correctly.
* [Issue 8495](https://bugs.chromium.org/p/gerrit/issues/detail?id=8495):
  Do not show “Patch file” if change does not have a parent.
* [Issue 10494](https://bugs.chromium.org/p/gerrit/issues/detail?id=10494):
  Fix display of change creation screen on mobile devices.
* [Issue 8678](https://bugs.chromium.org/p/gerrit/issues/detail?id=8678):
  Fix setting “Automatically mark viewed files reviewed” in user preferences.
* [Issue 10586](https://bugs.chromium.org/p/gerrit/issues/detail?id=10586):
  Fix syntax highlighting for Verilog/SystemVerilog.
* Fix that an endpoint cannot be used by two plugins anymore.

  ‘name’ does not exist on the plugin object, so the \_initializedPlugins map
  would store undefined=>true for the first plugin and then not allow any
  further plugins.

  For example the change-view-integration could not be used by buildbucket and
  tricium anymore.
* [Issue 10587](https://bugs.chromium.org/p/gerrit/issues/detail?id=10587):
  Fix setting group visibility.

##### Other Fixes

* [Issue 10562](https://bugs.chromium.org/p/gerrit/issues/detail?id=10562):
  Upgrade JGit to 5.1.6.201903130242-r to fix corruption of packfile
  list due to concurrent access during GC.

  See [JGit issue 544199](https://bugs.eclipse.org/bugs/show_bug.cgi?id=544199)
  for details.
* [Issue 10591](https://bugs.chromium.org/p/gerrit/issues/detail?id=10591):
  Fix account and group query with Elasticsearch 6.

  The wrong document type was used in the request URL, causing the query to
  return no results.
* [Issue 7192](https://bugs.chromium.org/p/gerrit/issues/detail?id=7192):
  Strip trailing slashes from name when creating repository.
* [Issue 10568](https://bugs.chromium.org/p/gerrit/issues/detail?id=10568):
  Add `is:submittable` to search suggestions.
* [Issue 10600](https://bugs.chromium.org/p/gerrit/issues/detail?id=10600):
  Fix `commit-msg` hook to abort commit when commit message is empty.
* Allow the `@LogThreshold` annotation to be inherited.
* Fix documentation of hashtag: search predicate.

  The documentation incorrectly stated that the search was an exact match.

### 2.16.6

#### New features

* New configuration option: `gerrit.primaryWeblinkName`.

  The new configuration option allows to specify the name of the link the UI
  should use when multiple weblink providers are available but only one single
  link may be shown on the UI.
* New configuration option: `gerrit.listProjectsFromIndex`.

  The new configuration option allows restoring the legacy behavior of using
  the in-memory cache for rendering the list of projects. When set to true
  the list of projects is rendered using the secondary index and thus is limited
  by the queryLimits.

  By default is set to false, the in-memory cache is used as an engine for listing
  and thus returns all the projects without limits.

#### PolyGerrit UI changes

* Gitiles change-weblink with default weblink name (“browse”) is now inline.

  If available a weblink that links to a code-browser is displayed inline
  on the change screen. Previously weblinks were only considered links to
  code-browsers if their name was one of “gitweb”,”gitiles”. Weblinks with
  name “browse” are now also considered to be links to code-browsers and are
  displayed inline (href of current patchset and parent SHA1s) unless gitweb
  is available and configured as gerrit.primaryWeblinkName.

#### Plugins API

* New annotation @LogThreshold for setting a logging level during the execution
  of the tests. By default is set to DEBUG for backward compatibility.

#### Bug fixes

##### PolyGerrit

* [Issue 10467](https://bugs.chromium.org/p/gerrit/issues/detail?id=10467):
  Fix hard-coded title for mark reviewed/unreviewed button.

  The button title was always “Mark as reviewed” even when the change was
  already marked as reviewed.
* [Issue 10155](https://bugs.chromium.org/p/gerrit/issues/detail?id=10155):
  Exclude WIP changes from ‘Assigned Changes’ dashboard.
* [Issue 10415](https://bugs.chromium.org/p/gerrit/issues/detail?id=10415):
  Fix replacement of project name placeholder in download command.
* [Issue 9911](https://bugs.chromium.org/p/gerrit/issues/detail?id=9911):
  Add dependency on resemblejs.
* [Issue 10344](https://bugs.chromium.org/p/gerrit/issues/detail?id=10344):
  Fix faulty relative URLs for change weblinks.
* [Issue 10355](https://bugs.chromium.org/p/gerrit/issues/detail?id=10355):
  Show all change-weblinks considered “code browser” weblinks.
* [Issue 10505](https://bugs.chromium.org/p/gerrit/issues/detail?id=10505):
  Show border at 72 chars for commit messages in side-by-side view.
* Fix error in plugin loading.
* Fix support for xml syntax highlighting.
* Add commit container gr endpoint for plugins.
* Fix missing `</section>` in gr-settings-view.

##### Other Fixes

* [Issue 10512](https://bugs.chromium.org/p/gerrit/issues/detail?id=10512):
  Include project name in change URL in `Reviewed-on:` footer in commit message.
* [Issue 10500](https://bugs.chromium.org/p/gerrit/issues/detail?id=10500):
  Fix injection of `UrlFormatter` in plugins.

  In version 2.16.1 the binding of the `UrlFormatter` interface was changed to
  use `DynamicItem`, but several classes were still injecting it directly. As a
  result, when such a class got injected in a plugin, the plugin would fail to load.
  It was also not possible for a plugin to provide an alternative implementation of
  `UrlFormatter`, and the `DefaultChangeReportFormatter` always used the
  `DefaultUrlFormatter`.
* [Issue 10488](https://bugs.chromium.org/p/gerrit/issues/detail?id=10488):
  Fix listing of GPG public keys.

  The GPG public keys were truncated in the output of the GPG key REST API
  endpoints.
* Fix authentication for LFS over SSH.
* Add logging of prolog rule reduction limits.

  The configured values of `rules.reductionLimit` and `rules.compileLimit`
  are logged at INFO level at server startup, and the effective value applied
  to a predicate is logged at DEBUG level.
* Improve error message when JRE cannot be found during site start.
* Suggest `--no-edit` option when `Change-Id` line is missing.

  When the `Change-Id` is missing, the commit can be amended without
  editing.
* Fix `commit-msg` hook to not add a Change-Id when `gerrit.createChangeId`
  is disabled.
* Upgrade elasticsearch-rest-client to 6.6.1.

### 2.16.5

#### New features

Allow searching for projects by parent project name, using the ‘parent:foo’ search operator in the query string.
See the [projects search operator documentation](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.5/user-search-projects.html#search-operators)
for more details.

#### Dependency Updates

* [Issue 10024](https://bugs.chromium.org/p/gerrit/issues/detail?id=10024): Upgrade Jetty to 9.4.14.v20181114
  This version fixes a bug that prevents the go-import plugin from working
* [Issue 10279](https://bugs.chromium.org/p/gerrit/issues/detail?id=10279): Upgrade highlight.js to 9.14.0
  This version fixes highlighting when Dart’s string interpolation feature is used.

#### Fixes

##### PolyGerrit

* Add warning that Javascript is required to use PolyGerrit.
* [Issue 10366](https://bugs.chromium.org/p/gerrit/issues/detail?id=10366):
  Fix loading topics that have unusual characters.
* [Issue 10415](https://bugs.chromium.org/p/gerrit/issues/detail?id=10415):
  Fix project name in the download-commands screen
* [Issue 4614](https://bugs.chromium.org/p/gerrit/issues/detail?id=4614):
  Add “verilog” and “SystemVerilog” to the mime list, enabling syntax highlighting.
* [Issue 10309](https://bugs.chromium.org/p/gerrit/issues/detail?id=10309):
  Support for setting max/min value for “Query Limit” and “Batch Changes” on the project’s access screen.

##### API Changes

* Add a method to get revision votes on the revision API.
* [Issue 10380](https://bugs.chromium.org/p/gerrit/issues/detail?id=10380):
  Use project index to render change list on GWT UI.

  **NOTE**: As a consequence of this change, the [list projects REST-API](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.5/rest-api-projects.html#list-projects)
  and project list screen on GWT UI will be subject to the same [queryLimit capability settings](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.5/access-control.html#capability_queryLimit)
  as in the PolyGerrit UI. The same limit applies to the [gerrit ls-projects](https://gerrit-documentation.storage.googleapis.com/Documentation/2.16.5/cmd-ls-projects.html) command.
* [Issue 10382](https://bugs.chromium.org/p/gerrit/issues/detail?id=10382)
  DefaultMemoryCacheModule/DefaultMemoryCacheFactory are exported again in plugin API.
* [Issue 10401](https://bugs.chromium.org/p/gerrit/issues/detail?id=10401):
  Reimplement the project children API on top of the projects secondary index, which requires
  a significantly less amount of heap and CPU.

#### Other fixes

* Add support for Elasticsearch 6.6.

### 2.16.4

#### Reindex for projects, accounts and groups indexes.

Gerrit 2.16.4 includes a fix to the projects, accounts, and groups secondary indexes.
It is very unusual for Gerrit to require a reindex inside a point release.
However, this is an exception because it is the only solution to fix the list sorting
[Issue 10210](https://bugs.chromium.org/p/gerrit/issues/detail?id=10210) reported on PolyGerrit.

The reindex of projects, accounts and groups can be performed either offline or online.
For the offline reindex, make sure that Gerrit is not active and run the following commands:

```
  java -jar gerrit.war reindex --index projects -d ${site_path}
  java -jar gerrit.war reindex --index groups   -d ${site_path}
  java -jar gerrit.war reindex --index accounts -d ${site_path}

```

The online reindex does not require any commands: upgrade the gerrit.war
and restart Gerrit.

**NOTE**: The online reindex for projects may take quite a long time and
require a substantial amount of heap memory to run. During the reindex operation,
Gerrit performance may be sluggish and, even after the reindex is complete,
it would take quite some time for the memory to be released.
It is thus recommended to perform the offline reindex, to avoid impacting the
server performance at startup and after the reindex is complete.

#### Fixes

##### PolyGerrit

* [Issue 8740](https://bugs.chromium.org/p/gerrit/issues/detail?id=8740):
  Disable deps.js requests in the index template to fix page load delay.
* [Issue 10371](https://bugs.chromium.org/p/gerrit/issues/detail?id=10371):
  Fix an issue where a saved edit would always restore the same content
  in subsequent edits of the same file, due to the cache not being erased.
* [Issue 9909](https://bugs.chromium.org/p/gerrit/issues/detail?id=9909):
  Do not crash PolyGerrit UI if permitted labels array is empty
* [Issue 10324](https://bugs.chromium.org/p/gerrit/issues/detail?id=10324):
  Allow plugins (e.g. delete-project) to control the cache invalidation
  and display new content immediately without refreshing the page.
* Fix broken links in gr-icons.html.
* [Issue 7669](https://bugs.chromium.org/p/gerrit/issues/detail?id=7669),
  [Issue 9614](https://bugs.chromium.org/p/gerrit/issues/detail?id=9614):
  Fix ‘/’ getting typed in search bar when pressed.
* [Issue 10151](https://bugs.chromium.org/p/gerrit/issues/detail?id=10151):
  [Issue 10019](https://bugs.chromium.org/p/gerrit/issues/detail?id=10019):
  Fix the “delete” button visibility to allow branch deletion.
* [Issue 10317](https://bugs.chromium.org/p/gerrit/issues/detail?id=10317):
  Don’t show “Same Topic” for only one change.

  When there is only one change in the topic, it doesn’t add any value
  to show the “Same Topic” tab/section because it will always only include
  the currently viewed change.

  The query used to get the changes is modified to exclude the current
  change. This means that the “Same Topic” tab/section now only shows other
  changes in the same topic, but never the current change.

#### Other fixes

* [Issue 10326](https://bugs.chromium.org/p/gerrit/issues/detail?id=10326):
  Fix excessive heap and CPU usage when listing projects.
* Create the `.git/hooks` folder in download commands.
* Add method to get related changes in the Changes API.
* Add method to get edit details in the Change Edit API.

  The new method allows to set the base revision, and request to include the
  files and download commands.
* Add `--skip-project` option to the `MigrateToNoteDb` command.

  This is useful when only a few projects should be skipped but all others
  should be migrated.

### 2.16.3

* [Issue 10262](https://bugs.chromium.org/p/gerrit/issues/detail?id=10262):
  Upgrade JGit to 5.1.5.201812261915-r to fix validation of `wants` in
  `git-upload-pack` for protocol v0 stateless transports.

  AdvertiseRefsHook was not called for `git-upload-pack` in protocol v0
  stateless transports, meaning that `wants` were not validated and
  a user could fetch anything that is pointed to by any ref (using fetch-by-sha1),
  as long as they could guess the object name.
* [Issue 10242](https://bugs.chromium.org/p/gerrit/issues/detail?id=10242):
  Fix regression that allows a user’s account to be taken over when multiple
  authentication providers are in use.

  A regression introduced in 2.14.7 allowed a user’s account to be taken
  over by creating an account on a different provider with exactly the same
  username as the existing Gerrit account.
* [Issue 10082](https://bugs.chromium.org/p/gerrit/issues/detail?id=10082):
  Decouple online reindex activation from index module.

  Plugins were not loaded before online indexing was triggered, resulting
  in plugin-contributed submit rules not being evaluated during indexing.

  Online reindex activation is now decoupled from the index module and
  thus postpones the triggering of online reindexing until after loading
  of the plugins.
* Evict group caches on group creation.

  If a group was created after a previous cache miss for its name, Id,
  or UUID, the cache also did not return the group if it is called
  immediately after the group was created.
* [Issue 10240](https://bugs.chromium.org/p/gerrit/issues/detail?id=10240):
  Fix internal server error when cloning a repository from Gerrit slave.
* Improve error handling if comment note is too large during schema migration.

  During migration to schema 169, comments in NoteDb are migrated to json.
  If loading the blob for a comment note failed due to being too large (in
  excess of a hard-coded 25MB limit), the migration would fail.

  The hard-coded limit is now removed. It is still possible that the migration
  can fail if the blob is excessively large, but the logging of such a
  failure is improved so that the change that failed can be tracked down.
* [Issue 4278](https://bugs.chromium.org/p/gerrit/issues/detail?id=4278):
  Fix wrong code snippet in email notifications.
* Upgrade jackson-core to 2.9.8.

  [Version 2.9.8](https://github.com/FasterXML/jackson/wiki/Jackson-Release-2.9.8)
  includes several bug fixes, including security fixes.
* Upgrade elasticsearch-rest-client to 6.5.4.
* [Issue 10263](https://bugs.chromium.org/p/gerrit/issues/detail?id=10263):
  Include edit ref in `EditInfo` element returned by the edit API.

  It was not possible for users of the Java API to get the edit ref.
* Export the project indexer in the plugin API.
* [Issue 10260](https://bugs.chromium.org/p/gerrit/issues/detail?id=10260):
  Replication plugin: Fix auto-replay of stored events during config reload.
* Add a new method on the account API to set the account name.
* Add new methods on the project API to get/set the project’s `HEAD`.

#### PolyGerrit

* [Issue 9410](https://bugs.chromium.org/p/gerrit/issues/detail?id=9410):
  Add the GWT hash separator to the GWT url.
* Merge top menu items contributed by plugins.

  Each plugin contributes a list single of menus, which are expected
  to be merged in existing top menu entries if they already exist. This
  was implemented in the GWT UI, but not in PolyGerrit.
* [Issue 10267](https://bugs.chromium.org/p/gerrit/issues/detail?id=10267):
  Add support for several more MIME types in syntax highlighting.

  Support is added for: powershell, xquery, cmake, coffeescript, crystal, diff,
  django, dockerfile, ebnf, elm, erlang, fortran, groovy, haml, haxe, ini, julia,
  latex, less, mathematica, nginx, nsis, postgresql, q, scss, scheme, excel, tcl,
  twig, vb, vbscript.
* [Issue 10137](https://bugs.chromium.org/p/gerrit/issues/detail?id=10137):
  Fix alignment of the “By User” column on the group audit screen.

### 2.16.2

* **SECURITY** [Issue 10201](https://bugs.chromium.org/p/gerrit/issues/detail?id=10201):
  Remove support for Git protocol v2, because of a security vulnerability discovered

  The JGit implementation of protocol V2 does not invoke the
  advertiseRefsHook on fetch and ls-refs, which results in all
  refs being sent, regardless of the configured ACLs.
* [Issue 9024](https://bugs.chromium.org/p/gerrit/issues/detail?id=9024):
  Fix setting `PRIVATE` and `WIP` for updated changes in console report.

  In some cases the private and work-in-progress status indicator for
  changes updated by push was shown incorrectly.
* [Issue 10564](https://bugs.chromium.org/p/gerrit/issues/detail?id=10564):
  Fix case-insensitive searching of hashtags.

  The index field has always been stored lowercase, since we intended
  hashtag searches to be case-insensitive. However, we never converted the
  input string to lower case, with the unexpected result that searching
  for `hashtag:ACamelCaseTag` would not return results for changes who
  contain that exact hashtag.
* [Issue 10112](https://bugs.chromium.org/p/gerrit/issues/detail?id=10112):
  Upgrade rules\_closure to make Gerrit buildable with the latest Bazel version.
* [Issue 9781](https://bugs.chromium.org/p/gerrit/issues/detail?id=9781):
  Fix full ACL evaluation for LDAP groups.

  The LDAP groups have been historically filtered by relevance to
  the Gerrit ACLs. However, that optimization has the side effect
  of blocking users to access legitimate projects if they are
  temporarily not cached in memory.
  Allow to disable the LDAP filtering optimization for having always
  a 100% consistent ACL evaluation, regardless of the project’s cache
  status.
* Upgrade elasticsearch-rest-client to 6.5.3.
* Discontinue support for Elasticsearch 2.4.
* Add preliminary support for Elasticsearch 7.

  Support for Elasticsearch 7 is added, and tested against the `alpha1`
  release.
* Add a new method on the account API to set the account name.

### 2.16.1

* [Issue 10018](https://bugs.chromium.org/p/gerrit/issues/detail?id=10018):
  Fix failure to upgrade schema when migrating from 2.13.
* [Issue 10038](https://bugs.chromium.org/p/gerrit/issues/detail?id=10038):
  Add support for Elasticsearch 6.5.
* [Issue 10052](https://bugs.chromium.org/p/gerrit/issues/detail?id=10052):
  Fix invalid requests to Elasticsearch.
* [Issue 10021](https://bugs.chromium.org/p/gerrit/issues/detail?id=10021):
  Security - Disallow create project to execute arbitrary code on the client
  by quoting and encoding project names.
* Fix incorrect json in the example for the ‘Set Access’ REST endpoint.
* [Issue 10143](https://bugs.chromium.org/p/gerrit/issues/detail?id=10143):
  Fix internal server error when running the `kill` command.
* [Issue 9768](https://bugs.chromium.org/p/gerrit/issues/detail?id=9768):
  Explicitly set the number of shards and replicas for Elasticsearch, and
  allow them to be configured.

  From Elasticsearch version 7 the default number of shards per node
  will be changed from 5 to 1.

  The number of shards and number of replicas are now explicitly set when
  creating the index.

  The new settings `elasticsearch.numberOfShards` and `elasticsearch.numberOfReplicas`
  allow the values to be configured. The default values are 5 and 1,
  respectively, which is the same as the default values used by Elasticsearch
  prior to version 7.
* Discontinue support for Elasticsearch 2.4.
* Add preliminary support for Elasticsearch 7.

  Support for Elasticsearch 7 is added, and tested against the `alpha1`
  release.
* Fix internal server error when listing reviewers of a change with reviewers by email.

  Reviewers by email don’t have an account ID but formatting reviewers as
  JSON tried to get account IDs of all reviewers. This failed when the
  change had any reviewers by email.
* Do not create index on `account_group_members` table in postgres database.

  The `account_group_members` table was deleted, but the postgres
  setup still tried to create an index on it, which prevented a new
  site from starting up.
* Don’t serve PolyGerrit UI when running in headless mode.
* Don’t serve static resources when running in slave mode.
* Fix assignee’s status on the change screen.

  The assignee field’s status showed the change owner’s status text.
* Add missing documentation of the ‘Read As’ capability.

#### Breaking changes

* [Change-Id: I3752456](https://gerrit-review.googlesource.com/c/gerrit/%2B/205682) Use dynamic binding for `UrlFormatter`.

  The `UrlFormatter` interface had a fixed binding to its default
  implementation, which meant it was not possible for plugins to
  provide a different implementation but were merely injecting it
  when needed

  It is now possible to replace the default implementation using
  a DynamicItem which requires a change in how it is
  injected and used in plugins.

---

©2025 Gerrit. All rights reserved.

Site last generated: Jan 19, 2025

![Diffy](/images/diffy_logo.png)

[Privacy Notice](https://www.google.com/policies/privacy/)



=== Content from www.gerritcodereview.com_b6a4185d_20250119_111531.html ===


Toggle navigation

[Gerrit Code Review](/index.html)

* [About](/about.html)
* [News](/news.html)
* [Support](/support.html)

* Community
  + [Code of Conduct](/codeofconduct.html)
  + [Forums, Mailing lists etc.](/contact.html)
  + [Members](/members.html)
  + [Contributing](/contributing.html)
  + [Fixing a bug](/bug-fixing.html)
  + [Presentations](/presentations.html)
  + [Kudos](/kudos.html)
  + [User Stories](/userStories.html)
  + [Trademarks](/trademarks.html)
* Code
  + [Source](https://gerrit.googlesource.com/gerrit/)
  + [Releases](/releases-readme.html)
  + [Plugins](/plugins.html)
  + [Roadmap](/roadmap.html)
  + [Builds](https://gerrit-ci.gerritforge.com/)
  + [Reviews](https://gerrit-review.googlesource.com/q/status%3Aopen%2Bproject%3Agerrit)
* Docs
  + [Latest](https://gerrit-documentation.storage.googleapis.com/Documentation/3.11.1/index.html)
  + [Designs](/design-docs-index.html)
  + [Wiki](https://gerrit.googlesource.com/homepage/%2B/master/pages/site/docs/)
* Feedback

# Gerrit 2.15 Release

Download: **[2.15.22](https://gerrit-releases.storage.googleapis.com/gerrit-2.15.22.war)**
| [2.15.21](https://gerrit-releases.storage.googleapis.com/gerrit-2.15.21.war)
| [2.15.19](https://gerrit-releases.storage.googleapis.com/gerrit-2.15.19.war)
| [2.15.18](https://gerrit-releases.storage.googleapis.com/gerrit-2.15.18.war)
| [2.15.17](https://gerrit-releases.storage.googleapis.com/gerrit-2.15.17.war)
| [2.15.16](https://gerrit-releases.storage.googleapis.com/gerrit-2.15.16.war)
| [2.15.15](https://gerrit-releases.storage.googleapis.com/gerrit-2.15.15.war)
| [2.15.14](https://gerrit-releases.storage.googleapis.com/gerrit-2.15.14.war)
| [2.15.13](https://gerrit-releases.storage.googleapis.com/gerrit-2.15.13.war)
| [2.15.12](https://gerrit-releases.storage.googleapis.com/gerrit-2.15.12.war)
| [2.15.11](https://gerrit-releases.storage.googleapis.com/gerrit-2.15.11.war)
| [2.15.10](https://gerrit-releases.storage.googleapis.com/gerrit-2.15.10.war)
| [2.15.9](https://gerrit-releases.storage.googleapis.com/gerrit-2.15.9.war)
| [2.15.8](https://gerrit-releases.storage.googleapis.com/gerrit-2.15.8.war)
| [2.15.7](https://gerrit-releases.storage.googleapis.com/gerrit-2.15.7.war)
| [2.15.6](https://gerrit-releases.storage.googleapis.com/gerrit-2.15.6.war)
| [2.15.5](https://gerrit-releases.storage.googleapis.com/gerrit-2.15.5.war)
| [2.15.4](https://gerrit-releases.storage.googleapis.com/gerrit-2.15.4.war)
| [2.15.3](https://gerrit-releases.storage.googleapis.com/gerrit-2.15.3.war)
| [2.15.2](https://gerrit-releases.storage.googleapis.com/gerrit-2.15.2.war)
| [2.15.1](https://gerrit-releases.storage.googleapis.com/gerrit-2.15.1.war)
| [2.15](https://gerrit-releases.storage.googleapis.com/gerrit-2.15.war)

Documentation: **[2.15.22](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15.22/index.html)**
| [2.15.21](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15.21/index.html)
| [2.15.19](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15.19/index.html)
| [2.15.18](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15.18/index.html)
| [2.15.17](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15.17/index.html)
| [2.15.16](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15.16/index.html)
| [2.15.15](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15.15/index.html)
| [2.15.14](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15.14/index.html)
| [2.15.13](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15.13/index.html)
| [2.15.12](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15.12/index.html)
| [2.15.11](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15.11/index.html)
| [2.15.10](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15.10/index.html)
| [2.15.9](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15.9/index.html)
| [2.15.8](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15.8/index.html)
| [2.15.7](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15.7/index.html)
| [2.15.6](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15.6/index.html)
| [2.15.5](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15.5/index.html)
| [2.15.4](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15.4/index.html)
| [2.15.3](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15.3/index.html)
| [2.15.2](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15.2/index.html)
| [2.15.1](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15.1/index.html)
| [2.15](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15/index.html)

## Release Highlights

* New change workflows for changes not yet ready for full review (formerly
  Drafts).
* The new PolyGerrit UI is mature enough for most uses.
* Account data is stored in
  [NoteDb](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15/config-accounts.html).
* NoteDb migration for change metadata is available for testing. However, it is
  not yet recommended for production.
* Made several improvements and additions to the documentation to help users
  find the information they need.

## Important Notes

### NoteDb migration

* NoteDb for change metadata is considered reasonably stable, and new sites use
  it by default. However, because of
  [Issue 10239](https://bugs.chromium.org/p/gerrit/issues/detail?id=10239) it
  is recommended for existing sites to stay on ReviewDb and migrate to NoteDb
  only after the upgrade to [2.16](../2.16.html).

### Schema Changes

This release contains schema changes. To upgrade:

```
  java -jar gerrit.war init -d site_path

```
### Support for draft changes removed

Support for draft changes and draft patch sets has been completely removed.

In most cases, the new Work-In-Progress workflow is a suitable replacement.
Note that in the Draft workflow, an individual patch set can be a Draft.
However, in both the new Work-In-Progress and Private workflows, WIP and Private
apply to the whole change, not an individual patch set.

When upgrading from an earlier version, draft changes are migrated.
This applies to all draft changes, or changes with draft patch sets
(even if the highest patch set is not a draft), as follows:

1. The “Draft” flag is removed from all patch sets.
2. If the change has been merged or abandoned, no further action is taken.
3. Otherwise, the change is moved to one of
   * Work-In-Progress change (this is the default)
   * Private change

The upgrade process prompts (once) for what Drafts should be migrated to;
either WIP (default) or Private.

The migration means that some draft patch sets, which were previously hidden,
might now be visible to some users who could not previously view them.

Change owners can make them private again using the “Mark Private” option
in the UI, or using the REST API.

### Votes no longer changed retroactively due to permissions

Historically, Gerrit would retroactively change votes on a label when
permissions for the voting user changed. For example, if a user voted
Code-Review+2, but then later lost permission to vote +2 (for example, was
removed from a Maintainers group), all CR+2 votes by that user on open changes
would suddenly appear as CR+1. In 2.15, this retroactive behavior no longer
applies: the CR+2 votes remain CR+2, even if permissions were changed.

This new behavior makes label permissions more consistent with other
permissions: usually, permission changes don’t apply retroactively (you can’t
un-submit a change), and the permission is only checked at the time an action is
performed. It also fixes some technical issues and improves performance of
reindexing changes.

### Release Signatures

Starting in the 2.14.x bugfix series, all release JARs and documentations are
signed by the [Gerrit
maintainers](public-keys.md). This
policy will continue for all future releases.

### New URL Scheme

By default, all Gerrit URLs generated and used by the UI include not just the
change number but the project name as well.

* `https://gerrit.mycompany.com/1234` becomes
  `https://gerrit.mycompany.com/c/some/project/+/1234`
* `https://gerrit.mycompany.com/#/c/1234` becomes
  `https://gerrit.mycompany.com/#/c/some/project/+/1234`
* `https://gerrit.mycompany.com/changes/1234` becomes
  `https://gerrit.mycompany.com/some%2Fproject~1234`

In addition to providing more context to humans reading the URL, this new
scheme improves performance under NoteDb, and paves the way for load balancing
a multi-master installation with repository affinity.

Old URLs will continue to be supported, and simply redirect to the new URLs.

### NoteDb for Accounts

Almost all account data is now stored in
[NoteDb](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15/config-accounts.html).
The account data is migrated automatically during the upgrade process by running
`gerrit.war init`.

The only account data not stored in NoteDb proper are the groups (remain in
ReviewDb) and the reviewed flags which were moved to an external database
(AccountPatchReviewDb) since [2.13](2.13.md).

For Gerrit slaves the
[branches that contain the account data](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15/config-accounts.html#replication)
must be replicated.

### NoteDb for Changes

With this release, the new Gerrit storage backend,
[NoteDb](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15/note-db.html),
is available for testing the new storage of change metadata. NoteDb is also the
default storage backend for new installations.

Support for ReviewDb will be removed in Gerrit 3.0. Gerrit 3.0 will only
support offline migration; to run an online migration, you must migrate to 2.16.x
on ReviewDb and then migrate to NoteDb.

### Daemon User Setup

The setup documentation now recommends setting up a user named `gerrit` instead
of `gerrit2`. This username can be anything; the choice of name doesn’t affect
any functionality. However, some example commands in the documentation may
refer to the new `gerrit` user, so admins might need to tweak them to refer to
`gerrit2` instead.

### Strict validation on labels

In 2.15, posting a review including a vote on any labels that does not exist or is
outside of the permitted range based on the ACLs will now always result in a
failure of the entire operation. Previously, if the “strict labels” option was set
to disabled in the review input, votes to any invalid labels would be silently
ignored. This option has now been removed from the [REST API’s ReviewInput](#rest-api)
as well as the [SSH review command](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15/cmd-review.html).

CI systems that rely on the non-strict behavior of earlier Gerrit versions may
require additional configuration to avoid casting votes to labels which are
invalid for the change.

Following [feedback on the 2.15 release](https://groups.google.com/forum/?hl=en#!topic/repo-discuss/nMZo3HMgJSY)
a new configuration option `change.strictLabels` was introduced in [2.15.2](#2152)
to allow the new strict functionality to be optionally enabled. By default it is
disabled to maintain backwards compatibility with previous release.

### New limit on number of commits received by direct push

A limit is added on the number of commits Gerrit allows to be pushed
in a batch to a branch when bypassing review. The motivation is to
avoid push timeouts caused by commit validation during pushes containing
an excessive amount of new commits.

The default limit is 10000 and can be configured with the
[receive.maxBatchCommits](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15/config-gerrit.html#receive.maxBatchCommits)
setting.

### Java runtime version requirement

Gerrit requires Java Runtime Environment (JRE) version 8; it is not compatible
with JRE 9 or newer yet. For more information, see
[Issue 7843](https://bugs.chromium.org/p/gerrit/issues/detail?id=7843).

### urlAlias unavailable in PolyGerrit

URL rewriting feature introduced in 2.12 via the
[`urlAlias` configuration](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15/config-gerrit.html#urlAlias)
is not available in PolyGerrit and is also unavailable in future releases.
See [Issue 8054](https://bugs.chromium.org/p/gerrit/issues/detail?id=8054) for
more details.

## New Features

### PolyGerrit UI

* Implement admin interface (projects, groups and plugins).
* Refreshed UI based on material design.
* Add hashtag support.
* Add support to show uploader on change screen.
* Lots of bug fixes.

### New Workflows

#### Draft, Private, Work-In-Progress

The draft change feature has been removed, and replaced with two separate
features:

* [Private
  changes](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15/intro-user.html#private-changes)
  are visible only to the owner and reviewers.
* [Work-in-progress
  changes](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15/intro-user.html#wip)
  do not generate notifications.

#### Ignore Changes, Mark Reviewed

Changes can be [ignored, or
marked as reviewed](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15/intro-user.html#ignore),
to reduce email notifications and keep dashboards cleaner.

#### Explicitly Record Reverted Changes

When a change is reverted via the “Revert” button, this fact is recorded in the
change metadata of the newly-created revert change, not just in the commit
message as in the past. A new search operator `revertof:` allows for searching
for reverts of a given change.

#### Delete Inline Comments

Individual inline comments can be deleted after the fact by site
administrators.

#### CCs Users By Email

Users may be CCed on changes by entering their email address, even if they have
not registered an account on the Gerrit server.

This feature is only available when using NoteDb.

#### Publish Comments on Push

When pushing new patch sets on a change or a series of changes, users can
configure Gerrit to automatically [publish any pending draft
comments](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15/intro-user.html#publish-comments-on-push)
they have on those changes, avoiding the need to click through the web UI to
publish all comments.

#### Mark Changes Due to Rebase

When diffing two patch sets of the same change that have different parents,
some differences between the patch sets may be due to the rebase, instead of
changes between the patch set and its base. These differences are now
highlighted in the UI (PolyGerrit only), and are not counted towards the size
of diffs.

#### Improved Push Error Messages

When a push fails because the user does not have the required permission, the generic message
`(prohibited by Gerrit)` has been replaced with a detailed message describing
the exact permissions required.

### Documentation Updates

With this release, we have updated several sections of the documentation to
make it easier for users to find the information they need. These updates
include:

* New [Quickstart guide](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15/linux-quickstart.html)
  to install Gerrit on Linux
* New [About Gerrit](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15/index.html#_about_gerrit)
  section that helps to introduce users to Gerrit
* New [Concepts](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15/index.html#_concepts)
  section to explain Gerrit-specific concepts.

We have also made changes to improve navigation throughout the
documentation.

### REST API

#### Projects

* [ProjectInfo](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15/rest-api-projects.html#project-info)
  now contains label configuration information.

#### Changes

* [Mark Private](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15/rest-api-changes.html#mark-private)
* [Unmark Private](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15/rest-api-changes.html#unmark-private)
* [Ignore](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15/rest-api-changes.html#ignore)
* [Unignore](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15/rest-api-changes.html#unignore)
* [Mark as Reviewed](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15/rest-api-changes.html#mark-as-reviewed)
* [Mark as Unreviewed](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15/rest-api-changes.html#mark-as-unreviewed)
* [ChangeInfo](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15/rest-api-changes.html#change-info)
  now records the change that this change was a revert of.
* [Get Pure Revert](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15/rest-api-changes.html#get-pure-revert)
* [Delete Comment](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15/rest-api-changes.html#delete-comment)
* [Apply Fix](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15/rest-api-changes.html#apply-fix)
* [ChangeInfo](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15/rest-api-changes.html#change-info)
  now contains the submitter, for merged changes.
* [ReviewInput](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15/rest-api-changes.html#review-input)
  no longer offers the `strict_labels` option. It will behave as enabled with
  earlier versions of Gerrit. The entire operation will now fail if any of the
  labels used are not within the user’s permitted range based on ACLs or if the
  label is not configured for the project/branch.

#### Groups

* [GroupInfo](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15/rest-api-groups.html#group-info)
  now contains a `created_on` field.

#### Config

* [Check Consistency](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15/rest-api-config.html#check-consistency)

### API

* New Java API for accessing plugins.
* New Java API for accessing custom project dashboards.
* New `getGroups` method in account API to get a user’s group memberships.
* New `ChangeReportFormatter` extension point for customizing the report output
  from `git push`.
* Instances of [IdString](https://gerrit.googlesource.com/gerrit/%2B/stable-2.15/gerrit-extension-api/src/main/java/com/google/gerrit/extensions/restapi/IdString.java)
  used to return true when `equals` was given a String instance equal to the
  IdString’s URL-encoded value. This violates
  [symmetry](https://en.wikipedia.org/wiki/Equivalence_relation#Definition), so
  this behavior was removed: IdStrings now never compare equal to Strings.

### Replication plugin

* It is now possible to replicate directly to another Gerrit instance.

  It is possible to enable replication to different Gerrit instance by using
  `gerrit+ssh://` as the protocol name followed by the hostname of another
  Gerrit server.

### Hooks plugin

* Username parameters are added to hook invocations.

  When an account parameter is passed to a hook, it gets formatted as
  `Name (Email)` or just `Name` when the account does not have an email
  address. If the account’s name is not set, the name is “Anonymous
  Coward”. From this information it is not easy for a hook to get the
  account’s username.

  All hooks that take an account parameter now automatically also get a
  corresponding username parameter. For example if the hooks takes the
  parameter `--change-owner Name (Email)` it will automatically also get
  the parameter `--change-owner-username username`

## Dependency Updates

* Update Apache Commons Codec to 1.10
* Update Apache Commons Compress to 1.13
* Update Apache Commons Validator to 1.6
* Update Apache Mina SSHD to 1.6.0
* Update AutoValue to 1.4.1 (updated to 1.6.2 in 2.15.4)
* Update Blame Cache to 0.2-5
* Update Bouncy Castle to 1.57 (updated to 1.60 in 2.15.7)
* Update Dropwizard to 3.2.4
* Update GWT to 2.8.1
* Update Jetty to 9.3.18.v20170406 (updated to 9.3.24.v20180605 in 2.15.7)
* Update JGit to 4.9.0.201710071750-r (updated to 4.11.8.201904181247-r in 2.15.15)
* Update Joda-Time to 2.9.9
* Update juniversalchardet to 2.0.0
* Update Lucene to 5.5.4 (updated to 5.5.5 in 2.15.7)
* Update Pegdown to 1.6.0
* Update Polymer to 1.11.0
* Update Soy to 2017-04-23

## Bugfix Releases

### 2.15.22

* Security Fixes

  + [Issue 13858](https://bugs.chromium.org/p/gerrit/issues/detail?id=13858)
    [CVE-2021-22553](https://nvd.nist.gov/vuln/detail/CVE-2021-22553):
    Fixed memory leak in Git-over-HTTP requests.

    Unauthenticated users could exploit this problem in a Denial of Service attack,
    causing the server to go out-of-memory.

### 2.15.21

* Security Fixes

  + [Issue 13621](https://bugs.chromium.org/p/gerrit/issues/detail?id=13621)
    [CVE-2020-8919](https://nvd.nist.gov/vuln/detail/CVE-2020-8919):
    Make `PermissionBackend#ForRef` authoritative.

    Fixes a misconception that leads to data being accessible through Gerrit
    APIs that should be locked down.

    Gerrit had two components for determining if a Git ref is visible to a
    user: `(Default)RefFilter` and `PermissionBackend#ForRef` (e.g.,
    `RefControl`). The former was always capable of providing correct results
    for all refs. The latter only had logic to decide if a Git ref is visible
    according to the Gerrit `READ` permissions. This includes all refs under
    `refs/heads` as well as any other ref that isn’t a database ref or a Git
    tag. This component was unaware of Git tags and notedb-related refs. Hence,
    when asked for a database reference such as `refs/changes/xx/yyyyxx/meta`,
    the logic would allow access if the user has `READ` permissions on any of
    the ref prefixes (such as the default “read refs/\* Anonymous Users”).

    That was problematic, because it bypassed
    [documented behavior](http://gerrit-documentation.storage.googleapis.com/Documentation/2.15.21/access-control.html)
    where a user should only have access to a change if he can see the
    destination ref. The same goes for other database references.
  + [Issue 13514](https://bugs.chromium.org/p/gerrit/issues/detail?id=13514)
    [CVE-2020-8920](https://nvd.nist.gov/vuln/detail/CVE-2020-8920):
    Work around Gitiles bug on `All-Users` visibility.

    Gitiles has a special `FilteredRepository` wrapper that allows carefully
    hiding refs based on the project’s ACLs. There is however an optimization
    that skips the filtering in case a user has `READ` permissions on every ACL
    pattern(s). When the target repository is `All-Users`, the optimization
    turns into a security issue because it allows seeing all personal information
    associated with all accounts, i.e.:

    - draft comments
    - draft edits
    - personally identifiable information (PII) of all users
    - external ids

    This fix now blocks Gitiles or any other part of Gerrit to abuse this power
    when the target repository is `All-Users`, where nobody can be authorized
    to skip the ACLs evaluation anyway.
* Documentation Updates

  + [Issue 12869](https://bugs.chromium.org/p/gerrit/issues/detail?id=12869):
    Add ‘Move a Change’ section
    [to user guide](http://gerrit-documentation.storage.googleapis.com/Documentation/2.15.21/intro-user.html#move).

### 2.15.20

This minor release has been withdrawn.

### 2.15.19

* Security Fixes

  + [Issue 12717](https://bugs.chromium.org/p/gerrit/issues/detail?id=12717):
    Deny access over HTTP for disabled accounts.

    A disabled account was still able to access over HTTP until the existing
    session expired.
* Bug Fixes

  + [Issue 12637](https://bugs.chromium.org/p/gerrit/issues/detail?id=12637):
    Fix SQL connection timeout during migration to schema 146 and 154.

    A full GC is run at the beginning of the migration, after every 100k
    accounts, and at the end of the migration. Additionally, bitmap index
    generation is disabled during the migration.

### 2.15.18

* New Features

  + Add a method on `ProjectConfig` to read from the repository.

    Add a method that allows to read the config from the repository without
    having to provide a `MetaDataUpdate` instance.
  + Syntax highlighting for Jinja2 and Jenkinsfile formats.
* Replication Plugin Fixes

  + [Issue 11573](https://bugs.chromium.org/p/gerrit/issues/detail?id=11573):
    Fix dropping events during plugin restart.
* PolyGerrit UI Fixes

  + Hide “HTTP Credentials” if auth is not `HTTP` or `HTTP_LDAP`.
* Elasticsearch Updates

  + Add support for Elasticsearch 7.4.
  + Update elasticsearch-rest-client to 7.4.2.
* Other Fixes

  + Fix change message when automatically abandoning a change for a project
    that has been deleted.

    The change message and the message tag were inverted.
  + Fix commit message subject when updating project description by REST API.

    The tense of the commit message subject was inconsistent with other similar
    messages.
  + Fix commit timestamp when updating project configurations.

    For some REST API operations that update the project configuration, the
    commit that does the update on `refs/meta/config` had the wrong timestamp.
    Rather than being the time of the actual commit, it was always the time
    of the server startup.

    This was the case for the following operations:

    - Updating the description.
    - Setting the parent project.
    - Updating group names while getting access settings.
  + Upgrade jackson-core to 2.10.0.

    This version includes a fix for [CVE-2019-12384](https://nvd.nist.gov/vuln/detail/CVE-2019-12384).
  + Add more detailed debug logging when not sending an outgoing email.

    There are several conditions that could cause sending of an outgoing
    email to be skipped. These are now logged at debug level.
  + Increase severity to error for logging of exceptions during site initialization.

### 2.15.17

* [Issue 11356](https://bugs.chromium.org/p/gerrit/issues/detail?id=11356):
  Allow to override auto-detected Lucene index configuration.

  The new settings
  [`index.name.maxMergeCount`](http://gerrit-documentation.storage.googleapis.com/Documentation/2.15.17/config-gerrit.html#index.name.maxMergeCount),
  [`index.name.maxThreadCount`](http://gerrit-documentation.storage.googleapis.com/Documentation/2.15.17/config-gerrit.html#index.name.maxThreadCount) and
  [`index.name.enableAutoIOThrottle`](http://gerrit-documentation.storage.googleapis.com/Documentation/2.15.17/config-gerrit.html#index.name.enableAutoIOThrottle)
  allow to manually configure the Lucene index, rather than using auto-detected
  values, to improve performance.
* [Issue 11358](https://bugs.chromium.org/p/gerrit/issues/detail?id=11358):
  Clarify plugin revisions in the documentation.
* Clarify documentation of `sshd.backend`.
* Upgrade JGit to 4.11.9.201909030838-r.

  This version includes a fix for racy atomic ref updates.
* Upgrade elasticsearch-rest-client to 7.3.2.
* PolyGerrit UI Fixes:

  + Fix HTML in commentLink when canonical web URL includes a base link.
  + Add “Delete Changes” permission to the access editor.
  + Remove obsolete “Delete Drafts” and “View Drafts” permissions from the access editor.

### 2.15.16

* [Issue 11248](https://bugs.chromium.org/p/gerrit/issues/detail?id=11248):
  Fix refresh of project hierarchy cache when parent project is updated.
* [Issue 11204](https://bugs.chromium.org/p/gerrit/issues/detail?id=11204):
  Replication plugin: Fix creation of missing repository when replicating to a Gerrit server.
* Fix internal server error when rebasing a change onto a non-existing base change.
* Fix internal server error that occurred sometimes when unstarring a change.
* Fix detecting changes of parent trees when computing change kind for a merge commit.
* Fix internal server error when requesting files for merge commit with invalid parent.
* Add a method on the commit API to get the commit info.
* Add methods on the change API to get comments and draft comments as lists.
* Log all errors when migrating to schema version 130.
* Reduce log spam of “setting reductionLimit” debug messages in the Prolog engine.
* [Issue 9450](https://bugs.chromium.org/p/gerrit/issues/detail?id=9450):
  Add a git-review configuration for developers.

  For developers used to using the [git-review tool](https://pypi.org/project/git-review/)
  for interacting with gerrit servers, it’s necessary to have a `.gitreview` file
  in the repo in question pointing to where the gerrit is.
* Elasticsearch Updates:

  + [Issue 11266](https://bugs.chromium.org/p/gerrit/issues/detail?id=11266):
    Add support for Elasticsearch 6.8.
  + [Issue 11267](https://bugs.chromium.org/p/gerrit/issues/detail?id=11267):
    Add support for Elasticsearch 7.3.
  + Update elasticsearch-rest-client to 7.3.1.
* PolyGerrit UI Fixes:

  + [Issue 10733](https://bugs.chromium.org/p/gerrit/issues/detail?id=10733):
    Fix anchor tag for settings page.
  + [Issue 11344](https://bugs.chromium.org/p/gerrit/issues/detail?id=11344):
    Fix commentlink URL when canonical URL includes a base link.
  + [Issue 10281](https://bugs.chromium.org/p/gerrit/issues/detail?id=10281):
    Set XSRF token for `/` to avoid potential unauthenticated errors after redirects from `/login/`.

### 2.15.15

* Add support for Elasticsearch 7.2.
* Upgrade JGit to 4.11.8.201904181247-r.

  This version of JGit includes a fix in the resolve merger to handle conflicts
  in submodules. See [the upstream issue](https://bugs.eclipse.org/bugs/show_bug.cgi?id=494551)
  for details.
* [Issue 11016](https://bugs.chromium.org/p/gerrit/issues/detail?id=11016):
  Fix failure to initialize on slave.
* [Issue 10664](https://bugs.chromium.org/p/gerrit/issues/detail?id=10664):
  Fix duplicate key detection in MySQL patch review database.
* [Issue 10763](https://bugs.chromium.org/p/gerrit/issues/detail?id=10763):
  Fix ACLs to allow regexes for tag and ref permissions.

  The documentation states that reference names can also be described with
  a regular expression by prefixing the reference name with `^`, but the UI
  only showed the creation field when a non-regex name was used.
* [Issue 11106](https://bugs.chromium.org/p/gerrit/issues/detail?id=11106):
  Fix missing comment context for left side in email notifications.
* [Issue 11082](https://bugs.chromium.org/p/gerrit/issues/detail?id=11082):
  Close changes oldest first when submitting by direct push.
* [Issue 11086](https://bugs.chromium.org/p/gerrit/issues/detail?id=11086):
  Unset the WIP flag when a change is closed by direct push.
* [Issue 10499](https://bugs.chromium.org/p/gerrit/issues/detail?id=10499):
  Set default number of shards according to Elasticsearch version.

  In Elasticsearch version 7.0 the default number of shards was reduced from
  5 to 1.

  See the [Elasticsearch documentation](https://www.elastic.co/guide/en/elasticsearch/reference/current/getting-started-concepts.html#getting-started-shards-and-replicas)
  for details.
* [Issue 10823](https://bugs.chromium.org/p/gerrit/issues/detail?id=10823):
  Hooks plugin: Allow to configure the number of hook execution workers.

  By setting `hooks.executorThreads` the number of workers can be configured.
  If not set, it defaults to 1 which was the previously fixed value.
* Increase default number of SSHD threads to at least 4.

  The default value of the `sshd.threads` setting is changed to be either two
  times the number of available CPU cores, or 4, whichever is greater.
* Allow commit validation listeners to ignore the `skip-validation` push option.

  Gerrit allows certain users to skip validation of new commits by passing
  the `skip-validation` push option.

  A new method `shouldValidateAllCommits` is added on the
  `CommitValidationListener`, to allow plugin implemented validators to
  override this option and always be invoked for new commits. The new
  method has a default implementation that returns `false` meaning that
  existing implementations don’t need to be modified and will behave the
  same as before.
* Optimize commit and ref operation validation for non-ff push.

  On a non-ff push all the commits were validated before the ref operation
  was validated. On a push with many commits, validating all the commits is
  wasteful in the case where the ref operation is rejected. The logic is
  changed so that the ref operation validation is performed before the commit
  validation.
* Disallow change index task duplication.

  It was possible for multiple index tasks to be queued for the same change.
* Fix error message when JRE is not found when starting Gerrit.

  The error message recommended to check for a JRE “>= 1.7”, but Gerrit requires
  Java 8 minimum.
* Adapt `gerrit.sh` script to work on Alpine Linux.
* Expose the `createProject` method of the `CreateProject` class to plugins.

  This allows plugins to directly invoke the project creation, avoiding the
  checks that are performed when invoking via the `apply` method.
* Expose the jsr305 library in the plugin API.
* Expose Gerrit’s GWT client library in the plugin API.
* [Issue 10855](https://bugs.chromium.org/p/gerrit/issues/detail?id=10855):
  Fix transitive load of GWT\_PLUGIN\_DEPS for in-tree plugin builds.
* Make the wording of the “Change Merged” email templates consistent between the
  HTML and text versions.
* Replication plugin fixes:

  + [Issue 10852](https://bugs.chromium.org/p/gerrit/issues/detail?id=10852):
    Make sure to always remove in-flight pushes.
  + Cancel pending replications upon shutdown.
  + Allow to configure timeout for SSH connections and SSH commands.

    The timeouts can be configured with `gerrit.sshConnectionTimeout` and
    `gerrit.sshCommandTimeout`, respectively.
* PolyGerrit UI fixes:

  + Fix hiding the HTTP password screen.

    It was possible for the HTTP password to be un-hidden using CSS.
  + Add an extension point to allow adding links to the user header.
  + Add an extension point to allow custom site footers.
  + [Issue 5791](https://bugs.chromium.org/p/gerrit/issues/detail?id=5791):
    Add an extension point to allow setting a site banner.

### 2.15.14

* Allow to disable log file rotation and compression.

  On sites where log file rotation and compression is done by an external
  service such as [logrotate](http://manpages.ubuntu.com/manpages/zesty/man8/logrotate.8.html),
  administrators may wish to disable Gerrit’s default log rotation and
  compression.

  This can now be done by setting `log.rotate` and `log.compress` to `false`.

  The default value of both settings is `true`, to maintain consistent behavior
  with previous releases.
* Improve performance of migration of accounts to schema 146.

  + Migration of the accounts is parallelized. The default number of threads
    used is the number of available processors. This can be customized using
    the `threadcount` system property.
  + Before the migration, `gc --prune=now` is executed.
  + When hosted on `FileRepository`, refs are packed after migration of every
    1000 accounts.
  + A progress indicator counts every 100 accounts migrated.
* [Issue 10790](https://bugs.chromium.org/p/gerrit/issues/detail?id=10790):
  Avoid evaluating submit rules twice for open changes.

  Prolog submit rules were evaluated twice per page view for an open change,
  which caused performance degradation on projects defining complex rules.
* [Issue 10943](https://bugs.chromium.org/p/gerrit/issues/detail?id=10943):
  Set `References:` header on new change notification mail.

  GMail changed the way
  [emails are grouped in conversation view](https://gsuiteupdates.googleblog.com/2019/03/threading-changes-in-gmail-conversation-view.html),
  which, combined with the fact that
  [Amazon SES changes the `Message-ID` header](https://forums.aws.amazon.com/message.jspa?messageID=262855),
  resulted in the new change notification email not being grouped with
  subsequent emails related to the same change.
* [Issue 10952](https://bugs.chromium.org/p/gerrit/issues/detail?id=10952):
  Fix definition of `PID` in `gerrit.sh`.
* Don’t send “GPG keys added” notification when no GPG keys were added.

  A GPG key update can include both addition and removal of GPG keys. The
  notification email for addition of new keys was always sent, even if the
  update only removed keys.
* Update email notifications on changing security related settings.

  Email notifications are now sent when a GPG or SSH key is removed, and
  when the HTTP password is deleted or changed.

  An email notification is now always sent when an SSH key is added to an
  account, even when it was added by an administrator.

  These notifications allow to alert the user if their account is compromised
  and keys or password are altered by the attacker.
* Remove explicit dependency on protobuf\_java.

  The protobuf\_java library is now consumed from rules\_closure.
* Add methods to generate and set the HTTP password on the accounts API.
* Elasticsearch fixes

  + [Issue 10496](https://bugs.chromium.org/p/gerrit/issues/detail?id=10496) and
    [Issue 10844](https://bugs.chromium.org/p/gerrit/issues/detail?id=10884):
    Fix usage of `include_type_name` in index creation.
  + Add support for Elasticsearch 7.1.
  + Upgrade elasticsearch-rest-client to 7.1.1.
* PolyGerrit UI fixes

  + [Issue 10549](https://bugs.chromium.org/p/gerrit/issues/detail?id=10549):
    Fix single tab indentation in PolyGerrit diff view.
  + [Issue 9409](https://bugs.chromium.org/p/gerrit/issues/detail?id=9409):
    Fix replacement of file content when navigating between files with `[` and `]`.
  + Upgrade polymer-resin to 2.0.1.
* Documentation Updates

  + [Issue 10897](https://bugs.chromium.org/p/gerrit/issues/detail?id=10897):
    Update links to Google individual and corporate CLA pages.
  + Clarify that account must have a username to be able to set HTTP password.
  + Fix formatting in project config documentation.

### 2.15.13

* [Issue 10695](https://bugs.chromium.org/p/gerrit/issues/detail?id=10695):
  Upgrade JGit to 4.9.10.201904181027-r to fix regression in packfile list
  handling.

  If `core.trustfolderstat` was set to `false`, an infinite loop could occur
  when an object was not found in the packfile.
* Add support for Elasticsearch 6.7.x and 7.0.x.

  The elasticsearch-rest-client is upgraded to 7.0.0.
* Add new `SshExecuteCommandInterceptor` extension point.

  The new extension point allows plugins to intercept ssh commands
  and block their execution.
* Don’t abort auto-abandoning if one change failed.

  When failing to query a single change during auto-abandoning, the whole
  process was aborted. Now the failure is logged and the process continues
  to attempt to abandon subsequent changes.
* Install `AddKeyHtml.soy` template example during installation.

  The installation of this template into `$site_path/etc/mail` was
  omitted.
* Upgrade metrics-core to 4.0.5.
* PolyGerrit fixes:

  + [Issue 8644](https://bugs.chromium.org/p/gerrit/issues/detail?id=8644):
    Display group UUID for group audit log if group name is missing.
  + [Issue 9000](https://bugs.chromium.org/p/gerrit/issues/detail?id=9000):
    Fix adding groups created by the singleusergroup plugin.
  + Do not show the HTTP credentials screen when auth type is not HTTP.

### 2.15.12

* [Issue 10562](https://bugs.chromium.org/p/gerrit/issues/detail?id=10562):
  Upgrade JGit to 4.9.9.201903122025-r to fix corruption of packfile
  list due to concurrent access during GC.

  See [JGit issue 544199](https://bugs.eclipse.org/bugs/show_bug.cgi?id=544199)
  for details.
* [Issue 10531](https://bugs.chromium.org/p/gerrit/issues/detail?id=10531):
  Fix LocalUsernamesToLowerCase program.

  The program failed with a “guice configuration error”.
* [Issue 10564](https://bugs.chromium.org/p/gerrit/issues/detail?id=10564):
  Fix case-insensitive searching of hashtags.

  The index field has always been stored lowercase, since we intended
  hashtag searches to be case-insensitive. However, we never converted the
  input string to lower case, with the unexpected result that searching
  for `hashtag:ACamelCaseTag` would not return results for changes who
  contain that exact hashtag.

  The documentation also incorrectly stated that the hashtag search was
  an exact match.
* [Issue 10568](https://bugs.chromium.org/p/gerrit/issues/detail?id=10568):
  Add `is:submittable` to search suggestions.
* [Issue 10587](https://bugs.chromium.org/p/gerrit/issues/detail?id=10587):
  Fix setting group visibility in PolyGerrit.

### 2.15.11

* [Issue 10106](https://bugs.chromium.org/p/gerrit/issues/detail?id=10106):
  Fix internal server error when updating project access via REST API
  without specifying ‘action’ entity.
* [Issue 10488](https://bugs.chromium.org/p/gerrit/issues/detail?id=10488):
  Fix listing of GPG public keys.

  The GPG public keys were truncated in the output of the GPG key REST API
  endpoints.
* [Issue 10415](https://bugs.chromium.org/p/gerrit/issues/detail?id=10415):
  PolyGerrit UI: Fix replacement of project name placeholder in download command.
* Fix authentication for LFS over SSH.
* Add logging of prolog rule reduction limits.

  The configured values of `rules.reductionLimit` and `rules.compileLimit`
  are logged at INFO level at server startup, and the effective value applied
  to a predicate is logged at DEBUG level.
* Improve error message when JRE cannot be found during site start.
* Upgrade elasticsearch-rest-client to 6.6.1.

### 2.15.10

* [Issue 10452](https://bugs.chromium.org/p/gerrit/issues/detail?id=10452):
  Fix daemon startup in slave mode.
* [Issue 10428](https://bugs.chromium.org/p/gerrit/issues/detail?id=10428):
  Fix binding of AuditListeners for plugin tests.
* Improve error messages emitted from commit validators.
* Add a method to get revision votes on the revision API.
* Add support for Elasticsearch 6.6.
* PolyGerrit fixes

  + Add warning that Javascript is required to use PolyGerrit.
  + [Issue 8740](https://bugs.chromium.org/p/gerrit/issues/detail?id=8740):
    Disable deps.js requests in the index template to fix page load delay.

### 2.15.9

* [Issue 10326](https://bugs.chromium.org/p/gerrit/issues/detail?id=10326):
  Fix excessive heap and CPU usage when listing projects.
* [Issue 10021](https://bugs.chromium.org/p/gerrit/issues/detail?id=10021):
  Encode and quote project name in download commands.
* [Issue 10317](https://bugs.chromium.org/p/gerrit/issues/detail?id=10317):
  Don’t show “Same Topic” for only one change.

  When there is only one change in the topic, it doesn’t add any value
  to show the “Same Topic” tab/section because it will always only include
  the currently viewed change.

  The query used to get the changes is modified to exclude the current
  change. This means that the “Same Topic” tab/section now only shows other
  changes in the same topic, but never the current change.
* Create the `.git/hooks` folder in download commands.
* Add method to get related changes in the Changes API.
* Add method to get edit details in the Change Edit API.

  The new method allows to set the base revision, and request to include the
  files and download commands.
* Add method to set a file’s “reviewed” flag on the File API.
* Fix internal server error when getting commit info for root commit.
* Add `--skip-project` option to the `MigrateToNoteDb` command.

  This is useful when only a few projects should be skipped but all others
  should be migrated.
* PolyGerrit fixes

  + [Issue 7669](https://bugs.chromium.org/p/gerrit/issues/detail?id=7669),
    [Issue 9614](https://bugs.chromium.org/p/gerrit/issues/detail?id=9614):
    Fix ‘/’ getting typed in the search bar when pressed.
  + [Issue 10151](https://bugs.chromium.org/p/gerrit/issues/detail?id=10151):
    Fix support for deleting branches.
  + [Issue 10019](https://bugs.chromium.org/p/gerrit/issues/detail?id=10019):
    Fix deletion of branch that `HEAD` pointed to after `HEAD` was moved to a
    different branch.

### 2.15.8

* [Issue 10262](https://bugs.chromium.org/p/gerrit/issues/detail?id=10262):
  Upgrade JGit to 4.9.8.201812241815-r to fix validation of `wants` in
  `git-upload-pack` for protocol v0 stateless transports.

  AdvertiseRefsHook was not called for `git-upload-pack` in protocol v0
  stateless transports, meaning that `wants` were not validated and
  a user could fetch anything that is pointed to by any ref (using fetch-by-sha1),
  as long as they could guess the object name.
* [Issue 10242](https://bugs.chromium.org/p/gerrit/issues/detail?id=10242):
  Fix regression that allows a user’s account to be taken over when multiple
  authentication providers are in use.

  A regression introduced in 2.14.7 allowed a user’s account to be taken
  over by creating an account on a different provider with exactly the same
  username as the existing Gerrit account.
* [Issue 10082](https://bugs.chromium.org/p/gerrit/issues/detail?id=10082):
  Decouple online reindex activation from index module.

  Plugins were not loaded before online indexing was triggered, resulting
  in plugin-contributed submit rules not being evaluated during indexing.

  Online reindex activation is now decoupled from the index module and
  thus postpones the triggering of online reindexing until after loading
  of the plugins.
* [Issue 9024](https://bugs.chromium.org/p/gerrit/issues/detail?id=9024):
  Fix setting `PRIVATE` and `WIP` for updated changes in console report.

  In some cases the private and work-in-progress status indicator for
  changes updated by push was shown incorrectly.
* [Issue 10038](https://bugs.chromium.org/p/gerrit/issues/detail?id=10038):
  Add support for Elasticsearch 6.5.
* [Issue 9768](https://bugs.chromium.org/p/gerrit/issues/detail?id=9768):
  Explicitly set the number of shards and replicas for Elasticsearch, and
  allow them to be configured.

  From Elasticsearch version 7 the default number of shards per node
  will be changed from 5 to 1.

  The number of shards and number of replicas are now explicitly set when
  creating the index.

  The new settings `elasticsearch.numberOfShards` and `elasticsearch.numberOfReplicas`
  allow the values to be configured. The default values are 5 and 1,
  respectively, which is the same as the default values used by Elasticsearch
  prior to version 7.
* Fix incorrect json in the example for the ‘Set Access’ REST endpoint.
* [Issue 10263](https://bugs.chromium.org/p/gerrit/issues/detail?id=10263):
  Include edit ref in `EditInfo` element returned by the edit API.

  It was not possible for users of the Java API to get the edit ref.
* Upgrade elasticsearch-rest-client to 6.5.4.
* Discontinue support for Elasticsearch 2.4.
* Add preliminary support for Elasticsearch 7.

  Support for Elasticsearch 7 is added, and tested against the `alpha1`
  release.
* [Issue 10112](https://bugs.chromium.org/p/gerrit/issues/detail?id=10112):
  Upgrade rules\_closure to make Gerrit buildable with the latest Bazel version.
* [Issue 9781](https://bugs.chromium.org/p/gerrit/issues/detail?id=9781):
  Allow to disable the groups relevance filtering for LDAP.
* Upgrade jackson-core to 2.9.8.

  [Version 2.9.8](https://github.com/FasterXML/jackson/wiki/Jackson-Release-2.9.8)
  includes several bug fixes, including security fixes.
* Add a new method on the account API to set the account name.
* Add new methods on the project API to get/set the project’s `HEAD`.
* Add a new method on the commit API to get “included in” information.

### 2.15.7

* [Issue 9952](https://bugs.chromium.org/p/gerrit/issues/detail?id=9952):
  Upgrade dependencies to newer versions to fix CVEs.

  + [CVE-2015-1832](https://nvd.nist.gov/vuln/detail/CVE-2015-1832):
    Upgrade Apache Derby to 10.12.1.1
  + [CVE-2018-10936](https://nvd.nist.gov/vuln/detail/CVE-2018-10936):
    Upgrade postgresql to 42.2.5
  + [CVE-2017-12629](https://nvd.nist.gov/vuln/detail/CVE-2017-12629):
    Upgrade Lucene to 5.5.5
  + [CVE-2018-10237](https://nvd.nist.gov/vuln/detail/CVE-2018-10237):
    Upgrade guava to 24.1.1-jre
  + [CVE-2018-1000180](https://nvd.nist.gov/vuln/detail/CVE-2018-1000180),
    [CVE-2018-1000613](https://nvd.nist.gov/vuln/detail/CVE-2018-1000613):
    Upgrade Bouncycastle to 1.60
  + [CVE-2017-7656](https://nvd.nist.gov/vuln/detail/CVE-2017-7656),
    [CVE-2017-7657](https://nvd.nist.gov/vuln/detail/CVE-2017-7657),
    [CVE-2017-7658](https://nvd.nist.gov/vuln/detail/CVE-2017-7658),
    [CVE-2017-9735](https://nvd.nist.gov/vuln/detail/CVE-2017-9735),
    [CVE-2018-12536](https://nvd.nist.gov/vuln/detail/CVE-2018-12536):
    Upgrade Jetty to 9.3.24.v20180605
* [Issue 9969](https://bugs.chromium.org/p/gerrit/issues/detail?id=9969):
  Fix incorrect dependency on httpcore-nio for Elasticsearch.

  The Elasticsearch REST client depends on version 4.4.5 of httpcore-nio,
  but the version provided by Gerrit was 4.4.1.
* Remove dependency on httpmime.

  httpmime was a dependency of Apache Solr, which was removed from Gerrit
  some time ago.
* Upgrade Elasticsearch REST client to 6.4.3.
* Fix logic for updating display name on authentication.

  The display name was only being updated in the case when the authentication
  realm did not allow updates.
* [Issue 9982](https://bugs.chromium.org/p/gerrit/issues/detail?id=9982):
  Trigger audit for git over HTTP commands.

  `git-receive-pack` and `git-upload-pack` commands were only audited for
  git over SSH.
* [Issue 9974](https://bugs.chromium.org/p/gerrit/issues/detail?id=9974):
  Fix redirection to documentation index page.
* [Issue 7306](https://bugs.chromium.org/p/gerrit/issues/detail?id=7306) and
  [Issue 9321](https://bugs.chromium.org/p/gerrit/issues/detail?id=9321):
  Fix URL routing.

### 2.15.6

* [Issue 9836](https://bugs.chromium.org/p/gerrit/issues/detail?id=9836):
  Fix database connections leaks.

  The fix for [issue 9823](https://bugs.chromium.org/p/gerrit/issues/detail?id=9823)
  in 2.15.5 introduced a database connection leak.
* Update JGit to 4.9.7.201810191756-r.

  + Fixes a file handle leak in the LFS file server. Note: this fix requires the
    LFS plugin to be updated.
  + Allows the path or url to be absent in the validation of `.gitmodules` files.
  + Fixes malformed Javadoc.
* [Issue 9419](https://bugs.chromium.org/p/gerrit/issues/detail?id=9419):
  Allow users to remove themselves as reviewer from an abandoned change.
* [Issue 9880](https://bugs.chromium.org/p/gerrit/issues/detail?id=9880):
  Fix notifications when a WIP change is reviewed using the `review` ssh command.

  Instead of only the owner being notified, all reviewers were notified.
* Mark cherry-pick change as WIP if source change is WIP.

  If a work-in-progress change is cherry-picked to another branch the
  created cherry-pick change should be marked as work-in-progress too.

### 2.15.5

* Update JGit to 4.9.6.201810051924-r to fix
  [CVE-2018-17456](https://nvd.nist.gov/vuln/detail/CVE-2018-17456).

  This release of JGit implements validation of `.gitmodules` files to protect
  unguarded tools against CVE-2018-17456.
* [Issue 9823](https://bugs.chromium.org/p/gerrit/issues/detail?id=9823):
  Fix force push permission check for administrators and project owners over SSH.

  It was possible for an administrator or project owner to force push to
  a project over SSH without having the Force Push permission.

  This issue did not affect regular users, or pushes over HTTP.
* Update jackson-core to 2.9.7.

  There have been several releases since 2.6.6 including many bug fixes
  and security fixes.
* Update elasticsearch-rest-client to 6.4.2.
* [Issue 9705](https://bugs.chromium.org/p/gerrit/issues/detail?id=9705):
  Fix blank dropdown for ‘Only serve as parent for other repositories’ option
  when creating a new repository.
* [Issue 9610](https://bugs.chromium.org/p/gerrit/issues/detail?id=9610):
  Add support for showing the ‘effective’ value of the max object size limit
  setting.
* [Issue 9787](https://bugs.chromium.org/p/gerrit/issues/detail?id=9787):
  Fix permission check for toggling WIP flag when posting review.
* [Issue 9655](https://bugs.chromium.org/p/gerrit/issues/detail?id=9655):
  Fix support for setting owner of group to a single user.

### 2.15.4

* [Issue 7053](https://bugs.chromium.org/p/gerrit/issues/detail?id=7053):
  Modify search autocompletion to include only email.
* [Issue 8859](https://bugs.chromium.org/p/gerrit/issues/detail?id=8859):
  Skip plugin capability check for administrators.
* [Issue 7896](https://bugs.chromium.org/p/gerrit/issues/detail?id=7896) and
  [Issue 9674](https://bugs.chromium.org/p/gerrit/issues/detail?id=9674):
  Fix compatibility with MS Edge.
* [Issue 9642](https://bugs.chromium.org/p/gerrit/issues/detail?id=9642):
  Fix rendering of ‘Ready’ and ‘Start Review’ buttons.
* [Issue 8472](https://bugs.chromium.org/p/gerrit/issues/detail?id=8472):
  Count unresolved message threads within thread groups rather than by leaves.
* [Issue 7911](https://bugs.chromium.org/p/gerrit/issues/detail?id=7911)
  and [Issue 9506](https://bugs.chromium.org/p/gerrit/issues/detail?id=9506):
  Fix text overflow.
* [Issue 8202](https://bugs.chromium.org/p/gerrit/issues/detail?id=8202):
  Add current patch set to `wip-state-changed` and `private-state-changed`
  events.
* [Issue 9483](https://bugs.chromium.org/p/gerrit/issues/detail?id=9483):
  Perform fonts preloads in “anonymous” cross-origin mode.
* [Issue 8582](https://bugs.chromium.org/p/gerrit/issues/detail?id=8582):
  Turn off autoReindexIfStale by default.
* [Issue 7750](https://bugs.chromium.org/p/gerrit/issues/detail?id=7750):
  Fix enforcing of signed push when ‘Require signed push’ is enabled.
* Remove unused font files.
* [Issue 9670](https://bugs.chromium.org/p/gerrit/issues/detail?id=9670):
  Add support for Elasticsearch 6.4.0.
* [Issue 9711](https://bugs.chromium.org/p/gerrit/issues/detail?id=9711):
  Add a change deleted event.

  Since 2.14 it is possible to delete changes, however there was no specific
  event emitted. A new change deleted event is added, which is notified to
  `stream-events` clients. The hooks plugin is updated to support a `change-deleted`
  hook.
* [Issue 9689](https://bugs.chromium.org/p/gerrit/issues/detail?id=9689):
  Fix visibility of tag creation form on the project screen (GWT).

  The tag creation form was shown when the user had “Create Reference” permission
  on `refs/*` or `refs/heads/*` (but not `refs/tags/*`).
* [Issue 9528](https://bugs.chromium.org/p/gerrit/issues/detail?id=9528):
  Allow project-level
  [`receive.maxObjectSizeLimit`](http://gerrit-documentation.storage.googleapis.com/Documentation/2.15.4/config-project-config.html#receive.maxObjectSizeLimit)
  to be inherited from parent project.

  It is possible to set the limit per project in the `project.config` on
  `refs/meta/config`, and at global level in `$site/etc/gerrit.config`. The
  project setting may override the global setting if it is lower. Changing
  the global setting requires a server restart.

  A limitation of this implementation is that we cannot set the limit at a
  project level and have it inherited to its child projects; it is necessary
  to explicitly set the limit on each child project.

  A new global option
  [`receive.inheritProjectMaxObjectSizeLimit`](http://gerrit-documentation.storage.googleapis.com/Documentation/2.15.4/config-gerrit.html#receive.inheritProjectMaxObjectSizeLimit)
  is added, and when this is enabled the project-level setting is inherited
  from the parent. This new setting is disabled by default to keep backwards
  compatibility with the original behavior.
* Allow more email RFC characters in the username.

  It was possible to set a username with an email-address-like string, but
  only as far as the fact that the `@` character was allowed. Most of the
  other characters allowed by [the RFC](https://www.mailboxvalidator.com/resources/articles/acceptable-email-address-syntax-rfc/)
  were not allowed.
* Ensure user authentication in `AllRequestFilter` filters.

  The order of filters made request authentication only work when the HTTP
  request was issued from the Gerrit UI, but not work when REST API was used.
* commit-message-length-validation plugin: Use “warning” prefix to allow
  colorization of remote output.

  From version 2.19 of git, the “warning” keyword will be highlighted
  in the remote output when `color.remote` is enabled in the git config.
* Fix display of “Delete Changes” permission in access screen on GWT UI.
* Fix permission check when deleting a single branch with the “Delete Branches”
  REST endpoint.
* Include cause in exception when failing to save config in the “Set Config”
  REST endpoint.
* [Issue 9482](https://bugs.chromium.org/p/gerrit/issues/detail?id=9482):
  Fix staleness checker for URL-encoded project names.
* Validate connections when sending a request to the database.

  In some cases it was possible to attempt to reuse an already closed
  connection, which resulted in an internal server exception.
* [Issue 9586](https://bugs.chromium.org/p/gerrit/issues/detail?id=9586) Reload
  change page to land on the latest patch set after change submission in
  PolyGerrit.
* Upgrade JGit to 4.9.5.201809180939-r.

  + [Issue 9153](https://bugs.chromium.org/p/gerrit/issues/detail?id=9153):
    Fix querying for filenames with special characters.
  + [Issue 9667](https://bugs.chromium.org/p/gerrit/issues/detail?id=9667):
    Fix handling of output stream in LFS server.
  + Fix errors during cleanup after deleting refs.
  + Fix errors during cleanup after running garbage collection.
  + Fix atomic lock file creation on NFS.
  + [Honor trustFolderStats also when reading packed-refs](https://git.eclipse.org/r/#/c/112015/).

    Users should note that for repositories with a high number of references
    (for example in excess of 300K refs) and in a server with high traffic,
    this solution may not scale well and should be tested carefully.
* Upgrade guice to 4.2.0.

  Guice [version 4.2.0](https://github.com/google/guice/wiki/Guice42)
  includes performance improvements.
* Upgrade elasticsearch-rest-client to 6.4.1.
* Upgrade Dropwizard Metrics to 4.0.3.
* Upgrade auto-value to 1.6.2.
* Upgrade PostgreSQL connector to 42.2.4.
* Upgrade MariaDB connector to 2.3.0.

### 2.15.3

* [Issue 8915](https://bugs.chromium.org/p/gerrit/issues/detail?id=8915):
  Fix file handle leak when running GC.
  Upgrade JGit to 4.9.2.201712150930-r.15-g5fe8e31d4 which includes a
  [fix](https://git.eclipse.org/r/124285) to prevent the file handle
  leak.
* [Issue 8866](https://bugs.chromium.org/p/gerrit/issues/detail?id=8866):
  Add project and account settings to create new changes as WIP by default.
* [Issue 6094](https://bugs.chromium.org/p/gerrit/issues/detail?id=6094)
  and [Issue 9112](https://bugs.chromium.org/p/gerrit/issues/detail?id=9112):
  Add support for Elasticsearch versions 5 and 6.
  Support is added for Elasticsearch versions 5.6 (tested with versions 5.6.9
  and 5.6.10), 6.2 (tested with version 6.2.4) and 6.3.1.
  Version 2.4 is still supported (tested with version 2.4.6).
  Instead of using the ‘Jest’ client to communicate with Elasticsearch, the
  Elasticsearch low level API is now used.
  Support for Elasticsearch is still considered experimental, and is not
  recommended for production use.
* [Issue 9372](https://bugs.chromium.org/p/gerrit/issues/detail?id=9372):
  Simplify the configuration of Elasticsearch servers.
  Instead of specifying each server in a separate `[elasticsearch "name"]`
  section, with separate values `protocol`, `hostname`, and `port`, the
  servers are now configured as a list of `server` values in the
  `[elasticsearch]` section.
  This also fixes [Issue 9383](https://bugs.chromium.org/p/gerrit/issues/detail?id=9383)
  where a “default” server `http://localhost:9200` would be added by
  the site initialization even if other servers were already explicitly
  configured.
  During startup the list of configured Elasticsearch servers is logged
  at info level.
* [Issue 9146](https://bugs.chromium.org/p/gerrit/issues/detail?id=9146) and
  [Issue 9147](https://bugs.chromium.org/p/gerrit/issues/detail?id=9147):
  Fix Elasticsearch queries for results with substrings in keywords.
  Doing a query that involved the characters “.” and “\_” from full text fields
  did not include results with keywords as a substring. This behavior was
  different from Lucene, where these two characters are mapped to the space
  character (“ “) so that the query returns keywords separated by them.
* Allow to omit the `elasticsearch.username` setting.
  If `elasticsearch.password` is specified, the `username` can be omitted and
  it will default to `elastic` which is the default username configured
  when running Elasticsearch with security enabled.
* Allow to assign “Delete Own Changes” permission to “Change Owners”.
  It was only possible for a user to delete their own change if they were
  a member of a group that was assigned the “Delete Own Changes” permission.
  This was counter-intuitive as it was necessary to either create a specific
  group, or assign the permission to “Registered Users”.
  It is now possible to assign this permission to the “Change Owners”
  virtual group.
* [Issue 9354](https://bugs.chromium.org/p/gerrit/issues/detail?id=9354):
  Add “Delete Changes” permission.
  It was only possible for a user to delete another user’s change if they
  were a member of a group that was assigned the “Administrate Server”
  permission.
  A new “Delete Changes” permission is added. This permission can be
  assigned to a group, or to the “Project Owners” virtual group.
* [Issue 9345](https://bugs.chromium.org/p/gerrit/issues/detail?id=9345):
  Fix creation of plugin log file when `log4j.configuration` is set
  When the environment variable `log4j.configuration` is set, log files
  defined by plugins were not created because the appender couldn’t be
  found.
* Fix repeated `Change-Id` in error message when `Change-Id` line is not
  in the footer.
* [Issue 9245](https://bugs.chromium.org/p/gerrit/issues/detail?id=9245):
  Return the correct information in JSON response after moving a change.
  When moving a change by the REST API, the JSON response contained the
  branch name of the original destination rather than the new destination.
* Fix internal error when moving a change to a branch that does not have a label.
  If a change had a score on a label that was only configured on the
  original branch, moving to a destination branch that did not have the
  label caused an internal error.
* Fix internal error when moving a change without specifying the destination.
  Omitting the destination branch in the input caused an internal error.
* Fix internal error when deleting a comment without providing input.
  The input is optional on the [Delete Comment](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15/rest-api-changes.html#delete-comment)
  REST endpoint, but calling it without input resulted in an internal error.
* Fix internal error when rebuilding Note DB and a change is missing from Review DB.
* Fix omission of ‘branch’ values when saving project config.
  The ‘branch’ values were omitted when saving the config, resulting in them
  being lost.
* [Issue 9195](https://bugs.chromium.org/p/gerrit/issues/detail?id=9195):
  Strip comment lines out of commit message when creating change.
  When a change was created from the UI (or via the ‘Create Change’ REST
  API), and the commit message consisted of only a subject beginning with
  a hash character (`#`), the change was created with a zero Change-Id.
  This was because lines beginning with `#` are considered to be comments,
  and are stripped from the commit message by JGit before computing the
  Change-Id for the commit.
  Before attempting to create the change, Gerrit now strips out any comment
  lines from the commit message and returns an error if this results in
  the commit message being empty.
* [Issue 9389](https://bugs.chromium.org/p/gerrit/issues/detail?id=9389):
  Fix support for syntax highlighting of Clojure source files in the PolyGerrit UI.
* [Issue 5316](https://bugs.chromium.org/p/gerrit/issues/detail?id=5316):
  Fix incorrect relative URL paths in Gitiles links in the PolyGerrit UI.
* Fix internal server error when generating email sender name for
  non-existing account.
* Add `--generate-http-password` option to the ssh `set-account` command.
  To bring the ssh command more in-line with the REST API for a user, it
  is now possible to generate a new HTTP password.
  This allows ordinary users to generate a new HTTP password via ssh when
  they cannot log in to the web UI (e.g. due to being a service account).
  Access to the `set-account` command is also relaxed; normal users may
  use it to set a new password on their own account.
* Sanitize values of `user.name` and `user.email` from `gerrit.config`.
  The `user.name` and `user.email` settings were being read as-is, which
  would allow them to be configured with values that may interfere with
  standard email name/address parsing.
* Fix the default text in the ‘Password’ field on the ‘HTTP Password’ screen
  in the GWT UI.
  The default text said “(click ‘generate’ to revoke an old password)” but the
  label of the button is actually “Generate Password”.
* Add reporting of work queue related metrics.
  Metrics are reported for core work queues. For work queues created by plugins,
  metrics are not reported.

### 2.15.2

* [Issue 8861](https://bugs.chromium.org/p/gerrit/issues/detail?id=8861):
  Fix generation of change numbers to prevent duplicates.
  When migration to NoteDb was aborted, and then started again later,
  generated change numbers overlapped with change numbers created in
  ReviewDb in the meantime.
* [Issue 8931](https://bugs.chromium.org/p/gerrit/issues/detail?id=8931):
  Pass the project name to ‘change indexed’ event listeners.
  When NoteDb is enabled, the change information is stored in the project’s
  git repository. Without the project name, plugins were not able to retrieve
  the change information.
* [Issue 8742](https://bugs.chromium.org/p/gerrit/issues/detail?id=8742):
  Fix infinite loop in intraline diff loader.
  A regression introduced in 2.15.1 caused excessive CPU usage when loading
  intraline diffs.
* [Issue 8697](https://bugs.chromium.org/p/gerrit/issues/detail?id=8697):
  Restore the ability to ignore invalid review labels.
  In 2.15 the `strict_labels` attribute was removed from the review input
  entity, and Gerrit no longer silently ignores invalid label scores. This
  caused breakage in CI systems that submit reviews post-merge and don’t
  have different configurations for if the change is already merged or not.
  For example the Gerrit Trigger Plugin was broken, as
  [discussed on the Gerrit mailing list](https://groups.google.com/forum/?hl=en#!topic/repo-discuss/nMZo3HMgJSY).
  A new configuration [`change.strictLabels`](https://gerrit-documentation.storage.googleapis.com/Documentation/2.15.2/config-gerrit.html#change.strict_labels)
  is introduced. When enabled, Gerrit will reject invalid labels, otherwise
  will silently ignore them. By default it is disabled, for backwards
  compatibility with previous releases.
* [Issue 8728](https://bugs.chromium.org/p/gerrit/issues/detail?id=8728):
  Allow percent encoding in patch set titles.
* [Issue 8850](https://bugs.chromium.org/p/gerrit/issues/detail?id=8850):
  Fix `reviewerin:` search results when user is added as CC.
  The `reviewerin:` search should only return users that were added as a
  reviewer, but was also including users that were added as CC.
* [Issue 8817](https://bugs.chromium.org/p/gerrit/issues/detail?id=8817):
  Fix internal server error when listing projects and a repository is not available.
  The new permission backend was throwing an error when a repository could
  not be found. Now it is simply omitted from the project list.
* [Issue 8643](https://bugs.chromium.org/p/gerrit/issues/detail?id=8643):
  Properly display the status of “Work in Progress” changes.
  When a change was submittable (i.e. had all the necessary labels) but
  was still in the “Work in Progress” state, its status was displayed as
  “Merge Conflict” in the change list and the change screen in the GWT UI.
* [Issue 8936](https://bugs.chromium.org/p/gerrit/issues/detail?id=8936):
  Add missing ‘Hashtags’ label on the change screen in the GWT UI.
* [Issue 8916](https://bugs.chromium.org/p/gerrit/issues/detail?id=8916):
  Allow ownerin predicate to be evaluated by the index.
* Fix double creation of SSH command execution queues.
* Fix timestamp for submodule updates.
  When a submodule was updated by subscription, the same commit timestamp
  was always used due to the server identity being cached.
* Allow to include username in servlet response header.
  By setting `http.addUserAsResponseHeader`, the servlet response includes
  a ‘User’ header that contains the name of the logged in user, enabling
  reverse proxies to log the name of the user that issued the http request.
* Fix user permission checks in APIs when invoked via the GerritApi.
  Actions were incorrectly being denied because the user validation
  was comparing user object instances rather than the account ID that
  they represented.
* Allow to replace the default H2 persistent cache with a custom implementation.
  The default H2 persistent cache can be replaced by a module that implements
  the `CacheImpl` interface.
  An implementation is provided for postgresql.
* Various logging improvements.
* Hooks plugin
  + [Issue 9015](https://bugs.chromium.org/p/gerrit/issues/detail?id=9015):
    Add a `submit` hook
    The `submit` hook is invoked synchronously when a change is submitted. If
    it returns a non-zero exit status, a `MergeValidationException` is thrown
    and the submit is prevented.
    This adds back the ability to block submit by a hook which was removed in
    version 2.14 due to the reworking of the `ref-update` hook behavior.
  + Fix repeated instantiation of the `ref-update` and `commit-received` hooks.
    The hooks were not singletons, which caused new instances to be created
    on every invocation.
  + Wrap account ID in quotes when passing as hook argument.
  + Improve logging to make it easier to track down hook execution problems.
    When a hook exits with an error status (i.e. non-zero), or times out, an error
    is now emitted to the log. Previously there was no log on timeout, and the exit
    status was only logged at debug level.
    The configured hooks path and resolved path for hook files is logged at info
    level.
    When a hook file does not exist, a message is logged at debug level.
  + Improve documentation
    - Expand and improve documentation related to debugging hooks.
    - Restructure the hooks page to separate synchronous and asynchronous hooks, and
      add a table of contents.
* PolyGerrit fixes:
  + [Issue 8655](https://bugs.chromium.org/p/gerrit/issues/detail?id=8655):
    Clear suggestions on autocomplete input change.
  + [Issue 8237](https://bugs.chromium.org/p/gerrit/issues/detail?id=8237):
    Link account chips to owner search rather than user dashboard.
  + [Issue 8375](https://bugs.chromium.org/p/gerrit/issues/detail?id=8375):
    Add reset button to my menu in settings.
  + [Issue 7815](https://bugs.chromium.org/p/gerrit/issues/detail?id=7815):
    Don’t curse over files with up/down keys.
  + [Issue 8722](https://bugs.chromium.org/p/gerrit/issues/detail?id=8722):
    Limit assignee suggestion to users that can see the change.
    This was fixed for the GWT UI in [2.15.1](#2.15.1).
  + [Issue 8940](https://bugs.chromium.org/p/gerrit/issues/detail?id=8940):
    Fix loading change edit on change screen.
  + [Issue 4552](https://bugs.chromium.org/p/gerrit/issues/detail?id=4552):
    Allow some sections of the change list to overflow
  + Add a link to group page in groups section of settings.
  + Make sure plugins are not double counted.
* Elasticsearch fixes
  + [Issue 8523](https://bugs.chromium.org/p/gerrit/issues/detail?id=8523):
    Fix configuration of elasticsearch during site initialization.
    When the site was initialized with Elasticsearch as the secondary index,
    the `elasticsearch.prefix` was not set, and Elasticsearch server-specific
    settings were not correctly set under `elasticsearch.name.protocol`, etc.
  + [Issue 8527](https://bugs.chromium.org/p/gerrit/issues/detail?id=8527):
    Improve documentation of `index.maxLimit` for Elasticsearch.
    When using Elasticsearch, `index.maxLimit` should not exceed the value
    of `index.max_result_window` configured on the Elasticsearch server.
  + [Issue 8553](https://bugs.chromium.org/p/gerrit/issues/detail?id=8553):
    Fix reindexing of an already initialized site with Elasticsearch.
  + [Issue 8690](https://bugs.chromium.org/p/gerrit/issues/detail?id=8690):
    Allow to use the `index start` and `index activate` ssh commands with Elasticsearch.
  + [Issue 8525](https://bugs.chromium.org/p/gerrit/issues/detail?id=8525):
    Fix setting of changed lines in the change info.
  + [Issue 8588](https://bugs.chromium.org/p/gerrit/issues/detail?id=8588):
    Fix setting the star icon status in the change info.
  + [Issue 8806](https://bugs.chromium.org/p/gerrit/issues/detail?id=8806):
    Fix online reindex to new index version.
  + Change default Elasticsearch prefix to `gerrit_`.

### 2.15.1

* [Issue 8677](https://bugs.chromium.org/p/gerrit/issues/detail?id=8677):
  Fix internal error when sending raw input to PUT and POST REST endpoints. In
  particular, this caused errors when using the plugin manager to update or
  install plugins.
* [Issue 5181](https://bugs.chromium.org/p/gerrit/issues/detail?id=5181):
  Limit assignee suggestion to users that can see the change.
* [Issue 6112](https://bugs.chromium.org/p/gerrit/issues/detail?id=6112):
  Add support for “Included In” in the PolyGerrit change screen.
* [Issue 6583](https://bugs.chromium.org/p/gerrit/issues/detail?id=6583):
  Fix false negatives for edits due to rebase.
* [Issue 8574](https://bugs.chromium.org/p/gerrit/issues/detail?id=8574):
  Fix refresh of PolyGerrit change list with “Shift + R”.
* [Issue 8703](https://bugs.chromium.org/p/gerrit/issues/detail?id=8703):
  Fix false warning in server log when creating a new project.
* [Issue 8252](https://bugs.chromium.org/p/gerrit/issues/detail?id=8252):
  Improve error message in PolyGerrit when adding a group member to a group that
  does not exist or is not viewable for the current user.
* Allow admins to toggle the WIP flag on all changes.
* Fix internal server error when group UUID cannot be resolved when getting audit log.
* Display group UUID in group audit log if group name is missing.
  The group name can be missing if there is no group backend that handles the
  group. This can happen for example if a plugin that handled the group was
  removed.
* Fix removal of email/password on external ID update.
* Replication plugin:
  + Fix creation of missing repository.
    When replicating to a destination where the repository does not exist,
    updating the `HEAD` reference failed because the passed reference name was
    not absolute.
  + Add documentation of how to exclude repositories from replication.
  + Fix logging of new project creation and project deletion.
    The “created” and “deleted” logs were emitted even when the operation
    failed.
* Allow graceful rolling restarts
  Set a graceful stop timeout for allowing Jetty to wait for incoming requests
  to be completed before shutting down its sockets.

---

©2025 Gerrit. All rights reserved.

Site last generated: Jan 19, 2025

![Diffy](/images/diffy_logo.png)

[Privacy Notice](https://www.google.com/policies/privacy/)



=== Content from gerrit.googlesource.com_23007d31_20250119_111531.html ===
[![Google Git](//www.gstatic.com/images/branding/lockups/2x/lockup_git_color_108x24dp.png)](/) [Sign in](https://accounts.google.com/AccountChooser?faa=1&service=gerritcodereview&continue=https://gerrit.googlesource.com/login/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65) [gerrit](/?format=HTML) / [gerrit](/gerrit/) / 0532fb876cb86bc091a91f78e6f28fff9e39ca65

| commit | 0532fb876cb86bc091a91f78e6f28fff9e39ca65 | [[log](/gerrit/%2Blog/0532fb876cb86bc091a91f78e6f28fff9e39ca65)] [[tgz](/gerrit/%2Barchive/0532fb876cb86bc091a91f78e6f28fff9e39ca65.tar.gz)] |
| --- | --- | --- |
| author | Patrick Hiesel <hiesel@google.com> | Mon Nov 02 14:30:54 2020 +0100 |
| committer | Patrick Hiesel <hiesel@google.com> | Fri Nov 06 14:13:41 2020 +0100 |
| tree | [81d483ea3348eb3607333375bc9b4ae43c6c5fd4](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/) |
| parent | [33ce3f0ad6d6f17b731887517938562469b693b3](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65%5E) [[diff](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65%5E%21/)] |

```
Make PermissionBackend#ForRef authoritative

This change fixes a misconception that leads to data being accessible
through Gerrit APIs that should be locked down.

Gerrit had two components for determining if a Git ref is visible to a
user: (Default)RefFilter and PermissionBackend#ForRef (ex RefControl).
The former was always capable of providing correct results for all refs.
The latter only had logic to decide if a Git ref is visible according to
the Gerrit READ permissions. This includes all refs under refs/heads as
well as any other ref that isn't a database ref or a Git tag. This
component was unware of Git tags and database references. Hence, when
asked for a database reference such as refs/changes/xx/yyyyxx/meta the
logic would allow access if the user has READ permissions on any of the
ref prefixes, such as the default "read refs/* Anonymous Users".

That is problematic, because it bypasses documented behavior [1] where
a user should only have access to a change if they can see the destination
ref. The same goes for other database references.

This change fixes the problem. It is intentionally kept to a minimally
invasive code change so that it's easier to backport it.

Add tests to assert the correct behavior. These tests would fail before
this fix. We have included them in this change to be able to backport
just a single commit.

[1] <https://gerrit-review.googlesource.com/Documentation/access-control.html>

Change-Id: [Ice3a756cf573dd9b38e3f198ccc44899ccf65f75](https://gerrit-review.googlesource.com/#/q/Ice3a756cf573dd9b38e3f198ccc44899ccf65f75)

```

* [java/com/google/gerrit/entities/RefNames.java](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/java/com/google/gerrit/entities/RefNames.java)[[diff](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65%5E%21/#F0)]
* [java/com/google/gerrit/server/permissions/ChangeControl.java](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/java/com/google/gerrit/server/permissions/ChangeControl.java)[[diff](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65%5E%21/#F1)]
* [java/com/google/gerrit/server/permissions/DefaultRefFilter.java](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/java/com/google/gerrit/server/permissions/DefaultRefFilter.java)[[diff](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65%5E%21/#F2)]
* [java/com/google/gerrit/server/permissions/ProjectControl.java](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/java/com/google/gerrit/server/permissions/ProjectControl.java)[[diff](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65%5E%21/#F3)]
* [java/com/google/gerrit/server/permissions/RefControl.java](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/java/com/google/gerrit/server/permissions/RefControl.java)[[diff](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65%5E%21/#F4)]
* [java/com/google/gerrit/server/permissions/RefVisibilityControl.java](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/java/com/google/gerrit/server/permissions/RefVisibilityControl.java)[Added - [diff](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65%5E%21/#F5)]
* [javatests/com/google/gerrit/acceptance/api/change/ChangeIT.java](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/javatests/com/google/gerrit/acceptance/api/change/ChangeIT.java)[[diff](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65%5E%21/#F6)]
* [javatests/com/google/gerrit/acceptance/api/group/GroupsIT.java](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/javatests/com/google/gerrit/acceptance/api/group/GroupsIT.java)[[diff](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65%5E%21/#F7)]
* [javatests/com/google/gerrit/acceptance/rest/project/AbstractPushTag.java](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/javatests/com/google/gerrit/acceptance/rest/project/AbstractPushTag.java)[[diff](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65%5E%21/#F8)]
* [javatests/com/google/gerrit/acceptance/rest/project/GetBranchIT.java](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/javatests/com/google/gerrit/acceptance/rest/project/GetBranchIT.java)[Added - [diff](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65%5E%21/#F9)]
* [javatests/com/google/gerrit/server/permissions/RefControlTest.java](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/javatests/com/google/gerrit/server/permissions/RefControlTest.java)[[diff](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65%5E%21/#F10)]

11 files changedtree: 81d483ea3348eb3607333375bc9b4ae43c6c5fd4

1. [.settings/](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/.settings/)
2. [antlr3/](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/antlr3/)
3. [contrib/](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/contrib/)
4. [Documentation/](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/Documentation/)
5. [e2e-tests/](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/e2e-tests/)
6. [java/](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/java/)
7. [javatests/](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/javatests/)
8. [lib/](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/lib/)
9. [modules/](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/modules/)
10. [plugins/](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/plugins/)
11. [polygerrit-ui/](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/polygerrit-ui/)
12. [prolog/](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/prolog/)
13. [prologtests/](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/prologtests/)
14. [proto/](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/proto/)
15. [resources/](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/resources/)
16. [tools/](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/tools/)
17. [webapp/](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/webapp/)
18. [polymer-bridges](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/polymer-bridges)
19. [.bazelignore](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/.bazelignore)
20. [.bazelproject](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/.bazelproject)
21. [.bazelrc](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/.bazelrc)
22. [.bazelversion](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/.bazelversion)
23. [.editorconfig](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/.editorconfig)
24. [.git-blame-ignore-revs](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/.git-blame-ignore-revs)
25. [.gitignore](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/.gitignore)
26. [.gitmodules](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/.gitmodules)
27. [.gitreview](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/.gitreview)
28. [.mailmap](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/.mailmap)
29. [.pydevproject](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/.pydevproject)
30. [.zuul.yaml](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/.zuul.yaml)
31. [BUILD](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/BUILD)
32. [COPYING](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/COPYING)
33. [INSTALL](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/INSTALL)
34. [Jenkinsfile](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/Jenkinsfile)
35. [package.json](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/package.json)
36. [README.md](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/README.md)
37. [SUBMITTING\_PATCHES](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/SUBMITTING_PATCHES)
38. [version.bzl](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/version.bzl)
39. [WORKSPACE](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/WORKSPACE)
40. [yarn.lock](/gerrit/%2B/0532fb876cb86bc091a91f78e6f28fff9e39ca65/yarn.lock)

README.md
# Gerrit Code Review

[Gerrit](https://www.gerritcodereview.com) is a code review and project management tool for Git based projects.

[![Build Status](https://gerrit-ci.gerritforge.com/job/Gerrit-master/badge/icon)](https://gerrit-ci.gerritforge.com/job/Gerrit-master/)

## Objective

Gerrit makes reviews easier by showing changes in a side-by-side display, and allowing inline comments to be added by any reviewer.

Gerrit simplifies Git based project maintainership by permitting any authorized user to submit changes to the master Git repository, rather than requiring all approved changes to be merged in by hand by the project maintainer.

## Documentation

For information about how to install and use Gerrit, refer to [the documentation](https://gerrit-review.googlesource.com/Documentation/index.html).

## Source

Our canonical Git repository is located on [googlesource.com](https://gerrit.googlesource.com/gerrit). There is a mirror of the repository on [Github](https://github.com/GerritCodeReview/gerrit).

## Reporting bugs

Please report bugs on the [issue tracker](https://bugs.chromium.org/p/gerrit/issues/list).

## Contribute

Gerrit is the work of hundreds of contributors. We appreciate your help!

Please read the [contribution guidelines](https://gerrit.googlesource.com/gerrit/%2B/master/SUBMITTING_PATCHES).

Note that we do not accept Pull Requests via the Github mirror.

## Getting in contact

The Developer Mailing list is [repo-discuss on Google Groups](https://groups.google.com/forum/#!forum/repo-discuss).

## License

Gerrit is provided under the Apache License 2.0.

## Build

Install [Bazel](https://bazel.build/versions/master/docs/install.html) and run the following:

```
    git clone --recurse-submodules https://gerrit.googlesource.com/gerrit
    cd gerrit && bazel build release

```
## Install binary packages (Deb/Rpm)

The instruction how to configure GerritForge/BinTray repositories is [here](https://gitenterprise.me/2015/02/27/gerrit-2-10-rpm-and-debian-packages-available/)

On Debian/Ubuntu run:

```
    apt-get update & apt-get install gerrit=<version>-<release>

```

*NOTE: release is a counter that starts with 1 and indicates the number of packages that have been released with the same version of the software.*

On CentOS/RedHat run:

```
    yum clean all && yum install gerrit-<version>[-<release>]

```

On Fedora run:

```
    dnf clean all && dnf install gerrit-<version>[-<release>]

```
## Use pre-built Gerrit images on Docker

Docker images of Gerrit are available on [DockerHub](https://hub.docker.com/u/gerritforge/)

To run a CentOS 7 based Gerrit image:

```
    docker run -p 8080:8080 gerritforge/gerrit-centos7[:version]

```

To run a Ubuntu 15.04 based Gerrit image:

```
    docker run -p 8080:8080 gerritforge/gerrit-ubuntu15.04[:version]

```

*NOTE: release is optional. Last released package of the version is installed if the release number is omitted.*

  Powered by [Gitiles](https://gerrit.googlesource.com/gitiles/)| [Privacy](https://policies.google.com/privacy)| [Terms](https://policies.google.com/terms)[txt](?format=TEXT) [json](?format=JSON)
