=== Content from idp-portal.suse.com_6b95d262_20250119_132549.html ===

## UCS

# Welcome to Univention Corporate Server

## JavaScript required

A browser with JavaScript enabled is required in order to use this service.

When using Internet Explorer, please check your security settings and add this address to your trusted sites.



=== Content from bugzilla.suse.com_8ab48140_20250119_113700.html ===


| Bugzilla – Bug 1177361 | VUL-0: CVE-2020-8030: skuba: Insecure /tmp usage when joining node to cluster | Last modified: 2020-12-11 17:16:33 UTC |
| --- | --- | --- |

|  |
| --- |

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [IDP Log In](/saml2_login.cgi?idp=IDP&target=show_bug.cgi%3Fid%3D1177361)
* |
  [Forgot Password](https://idp-portal.suse.com/univention/self-service/#page=passwordreset)

[**Bug 1177361**](show_bug.cgi?id=1177361)
(CVE-2020-8030)
- VUL-0: CVE-2020-8030: skuba: Insecure /tmp usage when joining node to cluster

[Summary:](page.cgi?id=glossary.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
VUL-0: CVE-2020-8030: skuba: Insecure /tmp usage when joining node to cluster

| | [Status](page.cgi?id=status_resolution_matrix.html): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=glossary.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2020-8030 | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | SUSE Security Incidents | | [Classification:](page.cgi?id=glossary.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Novell Products | | [Component:](describecomponents.cgi?product=SUSE Security Incidents "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Audits ([show other bugs](buglist.cgi?component=Audits&product=SUSE%20Security%20Incidents&bug_status=__open__)) | | [Version:](page.cgi?id=glossary.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=glossary.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Other Other | |  | | | [Priority](page.cgi?id=glossary.html#priority): | P3 - Medium **Severity**: Normal | | [Target Milestone:](page.cgi?id=glossary.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=glossary.html#assigned_to "The person in charge of resolving the bug.") | Containers Team | | [QA Contact:](page.cgi?id=glossary.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") | Security Team bot | |  | | | [URL:](page.cgi?id=glossary.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=glossary.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") | CVSSv3.1:SUSE:CVE-2020-8030:5.3:(AV:L... | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=glossary.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=glossary.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2020-10-06 11:35 UTC by Johannes Segitz | | --- | --- | | Modified: | 2020-12-11 17:16 UTC ([History](show_activity.cgi?id=1177361)) | | CC List: | 6 users (show)  dko jenting.hsiao jsegitz kkaempf rfernandezlopez sgrunert | |  | | | [See Also:](page.cgi?id=glossary.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Found By:](page.cgi?id=glossary.html#cf_foundby "A custom Drop Down field in this installation of Bugzilla.") | --- | | [Services Priority:](page.cgi?id=glossary.html#cf_nts_priority "A custom Free Text field in this installation of Bugzilla.") |  | | [Business Priority:](page.cgi?id=glossary.html#cf_biz_priority "A custom Free Text field in this installation of Bugzilla.") |  | | [Blocker:](page.cgi?id=glossary.html#cf_blocker "A custom Drop Down field in this installation of Bugzilla.") | --- | | [Marketing QA Status:](page.cgi?id=glossary.html#cf_marketing_qa_status "A custom Drop Down field in this installation of Bugzilla.") | --- | | [IT Deployment:](page.cgi?id=glossary.html#cf_it_deployment "A custom Drop Down field in this installation of Bugzilla.") | --- | |  | |  * [Clone This Bug](enter_bug.cgi?cloned_bug_id=1177361) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [Add an attachment](attachment.cgi?bugid=1177361&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=1177361&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1177361#c0)  Johannes Segitz   2020-10-06 11:35:08 UTC  ``` While looking into our registry I noticed that skuba uses constant filenames in /tmp and also sets insecure permissions:  1, Static name: /tmp/crio.conf.d Didn't manage to exploit this, but I didn't try hard. With the right timing this might be possible.  2, Static name + insecure permissions: /tmp/kubeadm-init.conf This is more problematic. With simple tools (inotifywait) I couldn't exploit it to set the permissions via symlinks, but that might be possible. More problematic is that the file is created with 644 and is therefore readable by all users. This leaks the bootstrapToken. Together with unsafeSkipCAVerification this is a bad combination because "If an attacker is able to steal a bootstrap token via some vulnerability, they can use that token (along with network-level access) to impersonate the control-plane node to other bootstrapping nodes."  Unfortunately it not only leaks this token, but if the file exists then it will be used without any precautions. E.g. if a user creates -rw-r--r-- 1 sles users 495 Oct  6 08:20 /tmp/kubeadm-init.conf this file will be overwritten. By carefully timing another write kubeadm can be used with a changed configuration to e.g. join the control plane instead of becoming a worker.  I'm not clear why the information leak happens as the permission seem to be correctly set in pkg/skuba/actions/cluster/init/init.go 303         if err := ioutil.WriteFile(skuba.KubeadmInitConfFile(), initCfgContents, 0600); err != nil {  As I was actually reviewing the registry and not skuba I didn't dive into this more.  Please have a look. I think we need a CVE for issue 2. ``` [Comment 1](show_bug.cgi?id=1177361#c1)  Johannes Segitz   2020-10-06 11:37:38 UTC  ``` This is an embargoed bug. This means that this information is not public.  Please do NOT: - talk to other people about this unless they're involved in fixing the issue - make this bug public - submit this into OBS (e.g. fix Leap/Tumbleweed) until this bug becomes public (e.g. no EMBARGOED tag on the header)  Consult with security team if you think that the issue is public and the bug is still private (e.g. subject still contains "EMBARGOED"). Please do NOT make the bug public yourself.  Please be aware that the SUSE:SLE-15-SP3:GA codestream is available via OBS, so do NOT submit there before this is public.  These are the steps that are asked from you: 1, Your primary responsibility is to submit a fix for this issue. Here's a how-to for submitting packages for maintenance releases in IBS:    [https://confluence.suse.com/display/maintenance/How+to+Submit+Packages+or+Containers+to+Maintenance](https://confluence.suse.com/display/maintenance/How%2Bto%2BSubmit%2BPackages%2Bor%2BContainers%2Bto%2BMaintenance)    Apart from the GA codestreams mentioned above, you can submit to IBS anytime. This is private and allows us to start testing as soon as possible. 2, We also want to fix openSUSE if it's affected.    $ is_maintained $PACKAGE    will tell you if the package is inherited from SLES or if it is branched for openSUSE. There are two cases:    - It's coming from SLES: The update will automatically be released for openSUSE. Nothing to do for you.    - It's branched for openSUSE: You need to submit AFTER the bug became public, to the current openSUSE codestreams.    For openSUSE Factory please submit to the devel project of you package AFTER the bug became public.  Security will then take the following steps: - We wait for your submission and package them into an incident for QA testing. The QA tester might reach out to you if they find issues with the update. - Once the coordinated release date (CRD), the date this issue should become public, is reached (or for internal findings: once we're done testing), we remove the EMBARGOED tag from this bug and publish the updates. - Only if the bug here is public you may submit to public repositories (OBS).  You can contact us at:  * IRC: irc.suse.de #security * RocketChat: <https://chat.suse.de/channel/security> * Email: security-team@suse.de  Internal CRD: 2021-01-04 or earlier ``` [Comment 2](show_bug.cgi?id=1177361#c2)  Klaus Kämpf   2020-10-06 16:51:02 UTC  ``` cc Rafa (for skuba), Sascha (for cri-o) ``` [Comment 3](show_bug.cgi?id=1177361#c3)  Sascha Grunert   2020-10-07 07:01:35 UTC  ``` (In reply to Klaus Kämpf from [comment #2](show_bug.cgi?id=1177361#c2)) > cc Rafa (for skuba), Sascha (for cri-o)  Looks like the issue is only scoped to skuba and how it handles the config setup. Feel free to reach out to me if I miss anything. ``` [Comment 4](show_bug.cgi?id=1177361#c4)  Rafael Fernández López   2020-10-07 08:37:52 UTC  ``` (In reply to Johannes Segitz from [comment #0](show_bug.cgi?id=1177361#c0)) > While looking into our registry I noticed that skuba uses constant filenames > in /tmp and also sets insecure permissions: >  > 1, Static name: /tmp/crio.conf.d > Didn't manage to exploit this, but I didn't try hard. With the right timing > this might be possible.  ACK. This is an issue and we should use a tempdir here.  > 2, Static name + insecure permissions: /tmp/kubeadm-init.conf > This is more problematic. With simple tools (inotifywait) I couldn't exploit > it to set the permissions via symlinks, but that might be possible. More > problematic is that the file is created with 644 and is therefore readable > by all users. This leaks the bootstrapToken. Together with > unsafeSkipCAVerification this is a bad combination because "If an attacker > is able to steal a bootstrap token via some vulnerability, they can use that > token (along with network-level access) to impersonate the control-plane > node to other bootstrapping nodes." >  > Unfortunately it not only leaks this token, but if the file exists then it > will be used without any precautions. E.g. if a user creates > -rw-r--r-- 1 sles users 495 Oct  6 08:20 /tmp/kubeadm-init.conf > this file will be overwritten. By carefully timing another write kubeadm can > be used with a changed configuration to e.g. join the control plane instead > of becoming a worker. >  > I'm not clear why the information leak happens as the permission seem to be > correctly set in pkg/skuba/actions/cluster/init/init.go > 303         if err := ioutil.WriteFile(skuba.KubeadmInitConfFile(), > initCfgContents, 0600); err != nil {  This code only executes locally on the bootstrapper machine. The flow looks like this:  - User runs `skuba cluster init` in a local workstation -- this operation writes a set of files on the local machine, at the current folder. - User tweaks configuration locally if desired. - User runs `skuba node bootstrap`.   - This command will copy `kubeadm-init.conf` (desired to be hardcoded) from the current folder to the remote machine. (*)   - Once copied, this command will execute `kubeadm init` on the remote machine with the copied `kubeadm-init.conf`. (**)  So, looking at the local operation (cluster/init/init.go) it's fine (and desired) that this file is hardcoded to `kubeadm-init.conf`. What needs fixing is the logic that performs (*) and (**) -- because on the remote machine [the machine that will become part of the Kubernetes cluster] we want to prevent timing attacks on these files.  So, the course of action that I suggest (please confirm if that looks correct) would be:  - Keep generating `kubeadm-init.conf` on the local machine during `skuba cluster init`. This is an offline command, expected to write some files locally to the current machine, so the user can customize some of them if desired.  - When executing `skuba node boostrap` or `skuba node join`, copy the different files to the remote machine being bootstrapped, making sure that:   - If the target file exists on the remote machine, make sure that its mode is at least as restrictive as the one we would have created before writing any real contents.   - A temporary directory is used on the remote machine if any kind of processing of the file is needed prior to copy to final destination.   @Johannes, does this sound good? ``` [Comment 5](show_bug.cgi?id=1177361#c5)  Johannes Segitz   2020-10-08 11:23:17 UTC  ``` > - Keep generating `kubeadm-init.conf` on the local machine during `skuba cluster init`. This is an offline command, expected to write some files locally to the current machine, so the user can customize some of them if desired.  That is fine since the user will likely do this in a directory they control. Also they seem to be created 600 anyway  > - When executing `skuba node boostrap` or `skuba node join`, copy the different files to the remote machine being bootstrapped, making sure that: >  - If the target file exists on the remote machine, make sure that its mode is at least as restrictive as the one we would have created before writing any real contents. >  - A temporary directory is used on the remote machine if any kind of processing of the file is needed prior to copy to final destination.  I would suggest that a temporary, randomly named directory is created ala mktemp -d. The config files should be copied into this directory. Then the case where the files already exist don't have to be expected and even if the file permissions of the config files are suboptimal (which the of course shouldn't be) they would be protected.  Plese use CVE-2020-8030 to track the second issue. I don't think we need one for the first. ``` [Comment 6](show_bug.cgi?id=1177361#c6)  Rafael Fernández López   2020-10-26 11:01:41 UTC  ``` Adding David Ko and Jenting. ``` [Comment 7](show_bug.cgi?id=1177361#c7)  jenting hsiao   2020-11-05 03:23:16 UTC  ``` v4.2 fix: <https://github.com/SUSE/skuba/pull/1424> v4.5 fix: <https://github.com/SUSE/skuba/pull/1415>  code merged, waiting to be released. ``` [Comment 10](show_bug.cgi?id=1177361#c10)  Swamp Workflow Management   2020-12-11 17:16:33 UTC  ``` SUSE-SU-2020:3761-1: An update that solves four vulnerabilities and has 11 fixes is now available.  Category: security (important) Bug References: 1172270,1173055,1173165,1174219,1174951,1175352,1176225,1176578,1176903,1176904,1177361,1177362,1177660,1177661,1178785 CVE References: CVE-2020-15106,CVE-2020-8029,CVE-2020-8564,CVE-2020-8565 JIRA References:  Sources used: SUSE CaaS Platform 4.5 (src):    caasp-release-4.5.2-1.8.2, cri-o-1.18-1.18.4-4.3.2, etcd-3.4.13-3.3.1, helm2-2.16.12-3.3.1, helm3-3.3.3-3.8.1, kubernetes-1.18-1.18.10-4.3.1, patterns-caasp-Management-4.5-3.3.1, skuba-2.1.11-3.10.1, velero-1.4.2-3.3.1  NOTE: This line indicates an update has been released for the listed product(s). At times this might be only a partial fix. If you have questions please reach out to maintenance coordination. ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=1177361)
* - [XML](show_bug.cgi?ctype=xml&id=1177361)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=1177361)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [IDP Log In](/saml2_login.cgi?idp=IDP&target=show_bug.cgi%3Fid%3D1177361)
  + |
    [Forgot Password](https://idp-portal.suse.com/univention/self-service/#page=passwordreset)

+ Legal:
+ [openSUSE](http://en.opensuse.org/Terms_of_site)
+ [SUSE](https://www.suse.com/company/legal/)


