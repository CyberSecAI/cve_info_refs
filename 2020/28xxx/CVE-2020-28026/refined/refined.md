```
{
  "vulnerability": {
    "root_cause": "The `spool_read_header()` function in Exim uses `fgets()` to read lines from a spool header file into a fixed-size buffer (big_buffer). While it dynamically enlarges the buffer if a line is truncated, this mechanism is not applied consistently across the function. Specifically, the second section of the function, which handles recipient processing, does not have this dynamic buffer enlargement. When DSN is enabled, the ORCPT parameter, which can be arbitrarily long, can be written to the spool header file, causing truncation of the recipient line when read with fgets().",
    "weaknesses": [
      "Line truncation in `spool_read_header()` due to inconsistent buffer handling.",
      "Lack of proper size checks when handling the ORCPT parameter.",
      "New-line injection through a combination of line truncation and crafted ORCPT parameters."
    ],
    "impact": "An attacker can inject new lines into the spool header file by sending a RCPT TO command with a long ORCPT parameter. This could potentially allow an attacker to influence how the mail is handled, potentially leading to arbitrary code execution. It's a weaker form of the new line injection as in CVE-2020-28015 and CVE-2020-28021.",
     "attack_vectors": [
      "Sending an email to a vulnerable Exim server with a crafted RCPT TO command that includes a long ORCPT parameter. This requires DSN (Delivery Status Notification) to be enabled."
    ],
    "required_capabilities": [
      "Ability to send emails to the vulnerable Exim server.",
      "DSN must be enabled on the vulnerable server."
    ],
        "additional_details": "The vulnerability is triggered when `spool_read_header` processes a recipient with an excessively long `ORCPT` parameter which results in a line longer than the buffer used to read lines from the spool file.  Since the buffer is not enlarged in this section of the code, a new line can be injected. An attacker can leverage this vulnerability to trigger an out-of-bounds read and write by controlling the injected line. The proof of concept further utilizes CVE-2020-28022 to read the ORCPT parameter out of bounds, making it possible to reliably control the end of the truncated line, leading to the injection of a crafted new line."
  }
}
```