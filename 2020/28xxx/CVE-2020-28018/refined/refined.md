Based on the provided content, here's a breakdown of the vulnerability described in CVE-2020-28018:

**Root Cause of Vulnerability:**
- The vulnerability lies within the `tls_write()` function in `tls-openssl.c`, specifically how it handles buffered responses when TLS and PIPELINING are enabled, but X_PIPE_CONNECT is disabled.
-  A static `gstring` variable `server_corked` is used to buffer SMTP responses. When `smtp_reset()` is called,  `store_reset()` frees all allocated memory in the `POOL_MAIN` including the buffer used by `server_corked`, but `server_corked` pointer itself is not reset, leading to a use-after-free.

**Weaknesses/Vulnerabilities Present:**
- **Use-After-Free (UAF):** The primary vulnerability is a use-after-free. After the memory associated with the `gstring` is freed, the `server_corked` pointer is still pointing to the freed memory. Subsequent calls to `tls_write()` using this pointer result in a UAF.

**Impact of Exploitation:**
- **Remote Code Execution (RCE):** The UAF can be leveraged to achieve remote code execution as the "exim" user. This is achieved by overwriting the freed `gstring` struct and its buffer to gain control of memory read/write primitives. These primitives are used to:
  1. Leak heap addresses.
  2. Read arbitrary memory, including parts of Exim's configuration.
  3. Overwrite Exim's configuration with arbitrary code, specifically using `"${run{command}}"`, leading to arbitrary command execution through `expand_string()`.
- **Information Disclosure:** As an intermediate step during exploitation the memory leak can also leak other sensitive data from the heap.

**Attack Vectors:**
- **Network:** The vulnerability is triggered via network connections to the Exim server, by sending specially crafted SMTP commands.
- **Specific Configuration:** Requires Exim to be built with OpenSSL, STARTTLS and PIPELINING enabled and X_PIPE_CONNECT disabled.

**Required Attacker Capabilities/Position:**
- **Unauthenticated Remote Attacker:** The attacker does not need any authentication. They can connect to the Exim server and send the crafted commands.
- **Network Access:** The attacker needs to be able to send SMTP commands to the vulnerable Exim server.
- **Ability to craft SMTP commands:** Attacker needs to be able to craft specific sequences of SMTP commands, including EHLO, STARTTLS, MAIL FROM, RCPT TO, etc. in a specific order, including malformed commands and values.

**Technical Details:**
- The `gstring` struct holds a pointer (`s`) to a dynamically allocated string, current size (`size`) and current length/offset (`ptr`).
- The vulnerability occurs because `tls_write` buffers responses before sending them over TLS.
- The `smtp_reset()` function clears most state associated with an SMTP session, but doesn't clear the static `server_corked` variable.
- Exploitation relies on a sequence of events:
  1. Initial TLS handshake with `STARTTLS`.
  2. A pipelined command (e.g., `MAIL FROM` with invalid data), which causes the response to be buffered into the `gstring`.
  3. Termination of TLS and a call to `smtp_reset()`, which frees the memory.
  4. Re-initiation of TLS.
  5. Subsequent use of the freed `gstring` via another SMTP command, resulting in a use-after-free.
- Memory corruption is achieved via specific `MAIL FROM` parameters (specifically the AUTH parameter, which can take hex encoded values) to control values being written to the freed `gstring` struct.
- The vulnerability is present from Exim 4.90 up to (but not including) 4.94