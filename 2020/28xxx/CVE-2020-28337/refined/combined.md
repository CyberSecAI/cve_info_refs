=== Content from sl1nki.page_82e8a5ff_20250119_121910.html ===

[Sl1nki's Page](/)

[About](/about/)[Advisories](/advisories/)[Exploits](/exploits/)[ðŸŽ©](/pentest/)

# CVE-2020-28337 - Microweber v1.1.20 - Zip Slip Directory Traversal

Feb 1, 2021
â€¢ sl1nki

## Vulnerability

**CVE ID:** CVE-2020-28337

**CVSS Score:** 6.7Â ([AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H/E:F/RL:O/RC:C](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H/E:F/RL:O/RC:C&version=3.1))

**Affected Vendors:** Microweber

**Affected Products:** MicroweberÂ (<=1.1.20)

### Description

In Microweber version 1.1.20 and earlier, when a backup file is restored the normalized filenames of extracted files
name are not sanitized in a way to protect against a directory traversal attack. This is often referred to as a
[Zip Slip](https://snyk.io/research/zip-slip-vulnerability) vulnerability. The API endpoint necessary to excute the
restore `/api/Microweber/Utils/Backup/restore` is restricted to admin users, and thus admin user credentials are
required to exploit this vulnerability.

More detail can be found in the [associated blog post](/blog/2021/02/01/microweber-zip-slip).

### Impact

The impact of this vulnerability is that arbitrary paths can be provided within the zip such as
`../../../../payload.php` and allow arbitrary files contained within the zip to be written to arbitrary directories on
the server in the user context of the web server. While the default proof-of-concept writes a php file within the web
root for code execution, an attacker can write arbitrary files *outside* of the web root in the user context of the web
server as well. Additionally, the extracted filenames are not sanitized against the dangerous file extension list,
enabling an extension filter bypass.

## Vendor Response

Microweber responded very quickly and had a patch committed within a few of hours of verifying the vulnerability.
[The patch](https://github.com/microweber/microweber/commit/777ee9c3e7519eb3672c79ac41066175b2001b50) addresses the
vulnerability by skipping filenames containing `..` in the backup, and was applied to both the `zip_open` and
`gzinflate` extraction execution trees.

## Disclosure Timeline

* 2020-10-31 - Vulnerability Discovered
* 2020-11-03 - Disclosed to Microweber
* 2020-11-04 - Microweber confirmed vulnerability
* 2020-11-04 - Patch made available
* 2021-02-01 - Public Disclosure

## Proof-of-Concept

[cve-2020-28337.py.txt](/pocs/cve-2020-28337.py.txt)

* let email = "me" + "@" + "sl1nki.page";

* [sl1nki](https://github.com/sl1nki)
* [3283martin](https://www.linkedin.com/in/3283martin)
* [sl1nki3283](https://www.twitter.com/sl1nki3283)
* [RSS](/feed.xml)

A page for me to write up security research and pentest notes.



=== Content from sl1nki.page_468a267f_20250119_121910.html ===

[Sl1nki's Page](/)

[About](/about/)[Advisories](/advisories/)[Exploits](/exploits/)[ðŸŽ©](/pentest/)

# Microweber - Exploiting a Zip Slip

Feb 1, 2021
â€¢ sl1nki

## Introduction

Microweber is an open-source content management system (CMS) that aims to simplify building websites with a drag and
drop interface. Itâ€™s a PHP-based CMS with built-in blogging and e-commerce capabilities. Microweber also has a modular
expansion system which, along with other features, is managed via an admin panel.

A directory traversal vulnerability was discovered in the Backup restore functionality, that allows an attacker to
write arbitrary files to the file system in the web serverâ€™s user context via a specifically crafted zip file.

## The Vulnerability

The zip slip vulnerability was discovered while exploring functionality within the `Backup.php` script. The related
advisory summary can be found [here](/advisories/CVE-2020-28337).

In Backup.php on line 335, the path to the temporary zip extraction directory is defined within the current cache path
of the application, and then passed in as the `target_dir` for extraction.

![Backup.php - Line 335](/assets/img/CVE-2020-28337/Backup.php-Line335.png)

Following the execution path, the actual extraction
of the zip occurs within the `native_unzip` method starting on line 185 of Unzip.php. The directory traversal attack
occurs is on line 240 of Unzip.php, where the `$target_file_to_save` variable is defined.

![Unzip.php - Line 240](/assets/img/CVE-2020-28337/Unzip.php-Line240.png)

Zip files allow file names to be defined somewhat arbitrarily, which means that the `$name` variable is controllable
by the user and potentially includes relative paths (e.g. ../). Defining `$target_file_to_save` with the string
concatenation `$target_dir . $name` makes this vulnerable to a [Zip Slip](https://snyk.io/research/zip-slip-vulnerability)
directory traversal attack in the absence of additional file path validation or sanitization. The result of the string
concatenation is opened as the output file for the archive entry contents on line 252.

![Unzip.php - Line 252](/assets/img/CVE-2020-28337/Unzip.php-Line252.png)

### Impact

The impact of this vulnerability is that arbitrary paths can be provided within the zip such as
`../../../../payload.php` and allow arbitrary files contained within the zip to be written to arbitrary directories on
the server in the user context of the web server. While the default proof-of-concept writes a php file within the web
root for code execution, an attacker can write arbitrary files *outside* of the web root in the user context of the web
server as well. Additionally, the extracted filenames are not sanitized against the dangerous file extension list,
enabling an extension filter bypass.

## Exploitation

The following steps walk through the necessary sequence to exploit the zip slip directory traversal vulnerability in
order to gain remote code execution (RCE). A proof-of-concept exploit script is available [here](/pocs/cve-2020-28337.py.txt).

### Step 1 - Login

In order to invoke all necessary APIs, a valid *administrator* user session must be present. Thus, an administrator
username and password must be provided.

### Step 2 - Create a malicious zip file

The zip slip approach is derived from [ptoomey3â€™s evilarc](https://github.com/ptoomey3/evilarc) project.

The proof-of-concept default payload is phpinfo() and is created using the Python native `zipfile` module.
The payload is saved to `<webroot>/userfiles/cache/` by default:

```
<?php phpinfo(); ?>

```

The equivalent command to create the zip with `evilarc` is:

```
python evilarc.py -o unix -d 4 -f payload.zip payload.php -p userfiles/modules

```
### Step 3 - Upload zip

Now that a malicious zip file has been created, it needs to be uploaded to the server. The file is uploaded as a
generic file via the `/plupload` endpoint, and then moved into the backup directory in steps 4 & 5.

### Step 4 - Determine webroot file path

Knowing the webroot is necessary in the subsequent step as an absolute filepath is required to move the file into the
backup directory. The webroot of the site is determined the `?debug=true` output on the landing page, matching against
the DefaultController.php path. Everything preceding `/src` is the webroot on the server file system.

### Step 5 - Move the uploaded to backup

A specific API endpoint `/api/Microweber/Utils/Backup/move_uploaded_file_to_backup` exists to move files into the
backup directory, which is used to move the uploaded zip file into the backup directory.

### Step 6 - Restore the backup

Now that the malicious zip file is uploaded and moved into place, itâ€™s time to extract it and exploit the zip slip
directory traversal vulnerability.

Utilizing the `/api/Microweber/Utils/Backup/restore` endpoing with `id=payload.zip` triggers an insecure extraction
of the zip file.

The `Microweber/Utils/Backup/restore` function will attempt to extract the provided zip filename from the backup
directory, but does not properly sanitize extracted filenames to prevent a zip slip.

Since the directory created to extract the zip files is within the webroot with a consistent depth of 4 from the root
(`/storage/cache/backup_restore/<md5 hash>/`), a directory traversal of depth 4 will yield the webroot for a
standard installation.

### Step 7 - Profit! (i.e. Remote Code Execution)

As much as everyone loves a good `phpinfo` page, `shell_exec` is a much more interesting function to have access to
via a remote client.

Upload a shell\_exec payload:

```
./microweber_rce.py --hostname "http://microwebertest.com" --username "admin" --password "password123" --payload '<?php if (isset($_REQUEST["fexec"])) {echo "<pre>" . shell_exec($_REQUEST["fexec"]) . "</pre>";} ?>'

```

Execute `whoami`:

```
http://microwebertest.com/userfiles/cache/payload.php?fexec=whoami

```

With `shell_exec`, an attacker can now download an execute an additional exploit and execute it. Or instead of
`shell_exec`, and attacker could upload a PHP reverse shell directly.

## The Fix

Microweber responded very quickly and had a patch committed within a few of hours of verifying the vulnerability.
[The patch](https://github.com/microweber/microweber/commit/777ee9c3e7519eb3672c79ac41066175b2001b50) addresses the
vulnerability by skipping filenames containing `..` in the backup, and was applied to both the `zip_open` and
`gzinflate` extraction execution trees.

* let email = "me" + "@" + "sl1nki.page";

* [sl1nki](https://github.com/sl1nki)
* [3283martin](https://www.linkedin.com/in/3283martin)
* [sl1nki3283](https://www.twitter.com/sl1nki3283)
* [RSS](/feed.xml)

A page for me to write up security research and pentest notes.



=== Content from github.com_8dbd16f4_20250119_121910.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmicroweber%2Fmicroweber%2Fcommit%2F777ee9c3e7519eb3672c79ac41066175b2001b50)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmicroweber%2Fmicroweber%2Fcommit%2F777ee9c3e7519eb3672c79ac41066175b2001b50)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=microweber%2Fmicroweber)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[microweber](/microweber)
/
**[microweber](/microweber/microweber)**
Public

* [Notifications](/login?return_to=%2Fmicroweber%2Fmicroweber) You must be signed in to change notification settings
* [Fork
  888](/login?return_to=%2Fmicroweber%2Fmicroweber)
* [Star
   3.2k](/login?return_to=%2Fmicroweber%2Fmicroweber)

* [Code](/microweber/microweber)
* [Issues
  360](/microweber/microweber/issues)
* [Pull requests
  0](/microweber/microweber/pulls)
* [Discussions](/microweber/microweber/discussions)
* [Actions](/microweber/microweber/actions)
* [Projects
  0](/microweber/microweber/projects)
* [Wiki](/microweber/microweber/wiki)
* [Security](/microweber/microweber/security)
* [Insights](/microweber/microweber/pulse)

Additional navigation options

* [Code](/microweber/microweber)
* [Issues](/microweber/microweber/issues)
* [Pull requests](/microweber/microweber/pulls)
* [Discussions](/microweber/microweber/discussions)
* [Actions](/microweber/microweber/actions)
* [Projects](/microweber/microweber/projects)
* [Wiki](/microweber/microweber/wiki)
* [Security](/microweber/microweber/security)
* [Insights](/microweber/microweber/pulse)

## Commit

[Permalink](/microweber/microweber/commit/777ee9c3e7519eb3672c79ac41066175b2001b50)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

update

[Browse files](/microweber/microweber/tree/777ee9c3e7519eb3672c79ac41066175b2001b50)
Browse the repository at this point in the history

* Loading branch information

[![@bobimicroweber](https://avatars.githubusercontent.com/u/50577633?s=40&v=4)](/bobimicroweber)

[bobimicroweber](/microweber/microweber/commits?author=bobimicroweber "View all commits by bobimicroweber")
committed
Nov 4, 2020

1 parent
[b32114f](/microweber/microweber/commit/b32114f3e71d9dbb523b6bf29f5334374e1fd6af)

commit 777ee9c

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**28 additions**
and
**3 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* src/MicroweberPackages/Utils/Zip

  + src/MicroweberPackages/Utils/Zip/Unzip.php
    [Unzip.php](#diff-40c78a6758ced6a1ef7ed14cab90226ea24ce267f4359c803d6c811e1011fefe)
* userfiles/modules/admin/backup\_v2/css

  + userfiles/modules/admin/backup\_v2/css/style.css
    [style.css](#diff-0b2bd2becfea6efac4f00b83532b066fcdc091f4537916922445645d53143f71)

## There are no files selected for viewing

30 changes: 27 additions & 3 deletions

30
[src/MicroweberPackages/Utils/Zip/Unzip.php](#diff-40c78a6758ced6a1ef7ed14cab90226ea24ce267f4359c803d6c811e1011fefe "src/MicroweberPackages/Utils/Zip/Unzip.php")

Show comments

[View file](/microweber/microweber/blob/777ee9c3e7519eb3672c79ac41066175b2001b50/src/MicroweberPackages/Utils/Zip/Unzip.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -82,14 +82,19 @@ public function extract($zip\_file, $target\_dir = null, $preserve\_filepath = true |
|  |  | } |
|  |  |  |
|  |  | } else if (function\_exists('gzinflate')) { |
|  |  |  |
|  |  | if (!$files = $this->\_list\_files()) { |
|  |  | $this->set\_error('ZIP folder was empty.'); |
|  |  |  |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | $file\_locations = array(); |
|  |  | foreach ($files as $file => $trash) { |
|  |  |  |
|  |  | if (strpos($file,'..') !== false) { |
|  |  | continue; |
|  |  | } |
|  |  |  |
|  |  | $dirname = pathinfo($file, PATHINFO\_DIRNAME); |
|  |  | $extension = (pathinfo($file, PATHINFO\_EXTENSION)); |
|  |  |  |
| Expand Down  Expand Up | | @@ -205,12 +210,17 @@ public function native\_unzip($zip\_file, $target\_dir = null, $preserve\_filepath = |
|  |  | $name = dirname($name); |
|  |  | $is\_dir\_there = $target\_dir . $name; |
|  |  |  |
|  |  | if (strpos($is\_dir\_there,'..') !== false) { |
|  |  | continue; |
|  |  | } |
|  |  |  |
|  |  | if ($name != '.') { |
|  |  | $dirs\_tree[] = $is\_dir\_there; |
|  |  |  |
|  |  | } |
|  |  |  |
|  |  | } |
|  |  |  |
|  |  | $dirs\_tree = array\_unique($dirs\_tree); |
|  |  |  |
|  |  | foreach ($dirs\_tree as $item) { |
| Expand Down  Expand Up | | @@ -238,6 +248,11 @@ public function native\_unzip($zip\_file, $target\_dir = null, $preserve\_filepath = |
|  |  | $size = zip\_entry\_filesize($entry); |
|  |  | $name = zip\_entry\_name($entry); |
|  |  | $target\_file\_to\_save = normalize\_path($target\_dir . $name, false); |
|  |  |  |
|  |  | if (strpos($target\_file\_to\_save,'..') !== false) { |
|  |  | continue; |
|  |  | } |
|  |  |  |
|  |  | $target\_file\_to\_save\_dir = dirname($target\_file\_to\_save); |
|  |  | if(!is\_dir($target\_file\_to\_save\_dir)){ |
|  |  | mkdir\_recursive($target\_file\_to\_save\_dir); |
| Expand All | | @@ -263,8 +278,9 @@ public function native\_unzip($zip\_file, $target\_dir = null, $preserve\_filepath = |
|  |  | } |
|  |  | zip\_close($archive); |
|  |  | } |
|  |  |  |
|  |  | return $file\_locations; |
|  |  | if (!empty($file\_locations)) { |
|  |  | $file\_locations = array\_unique($file\_locations); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | return $file\_locations; |
| Expand Down  Expand Up | | @@ -569,6 +585,14 @@ private function \_load\_files\_by\_signatures(&$fh, $stop\_on\_file = false) |
|  |  | \*/ |
|  |  | private function \_extract\_file($compressed\_file\_name, $target\_file\_name = false, $underscore\_case = false) |
|  |  | { |
|  |  | if (strpos($target\_file\_name,'..') !== false) { |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | if (strpos($compressed\_file\_name,'..') !== false) { |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | if (!sizeof($this->compressed\_list)) { |
|  |  | $this->set\_debug('Trying to unzip before loading file list... Loading it!'); |
|  |  | $this->\_list\_files(false, $compressed\_file\_name); |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[userfiles/modules/admin/backup\_v2/css/style.css](#diff-0b2bd2becfea6efac4f00b83532b066fcdc091f4537916922445645d53143f71 "userfiles/modules/admin/backup_v2/css/style.css")

Show comments

[View file](/microweber/microweber/blob/777ee9c3e7519eb3672c79ac41066175b2001b50/userfiles/modules/admin/backup_v2/css/style.css)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -140,6 +140,7 @@ |
|  |  | border-radius: 4px; |
|  |  | margin-top: 15px; |
|  |  | margin-bottom: 15px; |
|  |  | overflow-y: scroll; |
|  |  | } |
|  |  |  |
|  |  | .js-export-log:empty { |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `777ee9c`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmicroweber%2Fmicroweber%2Fcommit%2F777ee9c3e7519eb3672c79ac41066175b2001b50) to comment.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from packetstormsecurity.com_9d638db8_20250119_121909.html ===

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

![](/logos/linegray.png)

LOCKED OUTâ›” 24 hour lockout initiated

hi. we regret to inform you that a condition has occurred that has resulted in a 24 hour lockout. this occurs when rate limiting controls are exceeded or when someone attempts to hack the system but fails too many times. we wish you luck in your future attempts tomorrow.
