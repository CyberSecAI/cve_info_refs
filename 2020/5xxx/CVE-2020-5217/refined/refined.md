Based on the provided content, here's an analysis of CVE-2020-5217:

**Root Cause of Vulnerability:**

The vulnerability stems from the `secure_headers` gem's improper handling of user-supplied input when used with the `append/override_content_security_policy_directives` methods. Specifically, the gem failed to sanitize semicolons within user-provided strings used to set Content Security Policy (CSP) directives.

**Weaknesses/Vulnerabilities Present:**

*   **Directive Injection:** The primary weakness was the ability to inject arbitrary CSP directives by including semicolons in user input. The `secure_headers` library would split the string based on the semicolon character and use the resulting fragments as directives in the CSP header.
*   **Lack of Input Sanitization:** The code did not properly sanitize or escape user-provided input before incorporating it into the CSP header. This allowed attackers to inject malicious directives.
*   **CSP Directive Overriding:** Because duplicate CSP directives are ignored, and the first one encountered wins, the injected directive, if placed before a critical directive such as `script-src`, could effectively override it. Additionally, even if `SecureHeaders::OPT_OUT` was specified, a previously undefined directive could be created and given a value.

**Impact of Exploitation:**

*   **Content Security Policy Bypass:** Successful exploitation could bypass the intended Content Security Policy, allowing attackers to inject and execute arbitrary scripts on the victim's web page. This could lead to XSS (Cross-Site Scripting) attacks.
*   **Data Exfiltration:** Attackers could potentially inject directives to allow data exfiltration to attacker-controlled servers.
*   **Page Manipulation:** By controlling the `script-src` or other directives, attackers could manipulate the content and behavior of the webpage.

**Attack Vectors:**

*   **User Input:** Attackers would need to control the user input that is used to populate the CSP directives through methods like `append/override_content_security_policy_directives`.
*   **Web Application Vulnerability:** The application using the `secure_headers` gem would need to pass user input to these methods without proper sanitization.

**Required Attacker Capabilities/Position:**

*   **Ability to Influence Input:** An attacker needs the ability to influence the user input that populates the directives, such as through URL parameters, form submissions, or other request data that gets passed to the vulnerable functions.
*   **Target Application:** The attacker would target a web application using the vulnerable versions of the `secure_headers` gem, which uses user input to set CSP directives.

**Additional Details:**

*   The fix involves replacing semicolons with spaces within user-supplied inputs and emitting a deprecation warning.
*   The vulnerability was reported in issue #418 on the `secure_headers` GitHub repository.
*   The fix was implemented in versions 6.2.0, 5.1.0 and 3.8.0.
*   The vulnerability is described as a "Directive injection when using dynamic overrides with user input."