=== Content from github.com_c9868310_20250119_120038.html ===
From 94535daf406162f259fccceff14357cf91513078 Mon Sep 17 00:00:00 2001
From: yxingwu
Date: Tue, 10 Mar 2020 18:18:39 +0800
Subject: [PATCH 1/7] March 2020
---
README.markdown | 221 +------
build.properties | 6 +-
lib/portal/dependencies.properties | 12 +-
.../asset\_metadata/metadata\_entry.jsp | 14 +-
modules/apps/blogs/blogs-service/build.gradle | 2 +-
.../internal/util/PingbackMethodImpl.java | 3 +-
.../resources/blogs/asset/abstract.jsp | 2 +-
.../resources/blogs/asset/full\_content.jsp | 2 +-
.../resources/blogs/view\_entry\_content.jsp | 2 +-
.../blogs/view\_entry\_content\_detail.jsp | 2 +-
.../resources/blogs/view\_entry\_related.jsp | 2 +-
.../portlet\_display\_template\_basic.ftl | 2 +-
.../portlet\_display\_template\_card.ftl | 2 +-
.../META-INF/resources/view\_calendar.jsp | 2 +-
modules/apps/chat/chat-service/build.gradle | 2 +-
.../chat/internal/jabber/JabberImpl.java | 4 +-
.../configuration-admin-web/build.gradle | 4 +-
.../portlet/SystemSettingsPortlet.java | 58 +-
.../BindConfigurationMVCActionCommand.java | 5 +
...ExportConfigurationMVCResourceCommand.java | 8 +
...gurationModelToDDMFormValuesConverter.java | 20 +-
...EntryModelResourcePermissionRegistrar.java | 16 +-
.../document-library-web/build.gradle | 2 +-
.../view\_file\_entry\_types.jsp | 2 +-
.../DDMDataProviderInstancesServlet.java | 10 +-
.../export-import-web/build.gradle | 2 +-
.../resources/view\_fragment\_entry\_usages.jsp | 2 +-
.../META-INF/resources/alloyeditor.jsp | 1 +
.../frontend-js-lodash-web/package-lock.json | 6 +-
.../frontend-js-lodash-web/package.json | 2 +-
.../hello-world/hello-world-web/build.gradle | 1 +
.../internal/portlet/HelloWorldPortlet.java | 24 +-
.../servlet/taglib/GroupSelectorTag.java | 96 +--
.../item-selector-web/build.gradle | 2 +-
.../resources/journal\_article/page.jsp | 2 +-
.../resources/META-INF/resources/init.jsp | 2 +
.../resources/layout/view/asset\_display.jsp | 17 +
.../action/CreateAccountMVCActionCommand.java | 5 -
.../ForgotPasswordMVCActionCommand.java | 8 +-
.../META-INF/resources/configuration.jsp | 2 +-
.../META-INF/resources/create\_account.jsp | 8 +-
.../resources/create\_anonymous\_account.jsp | 2 +-
.../META-INF/resources/forgot\_password.jsp | 5 +-
.../resources/META-INF/resources/login.jsp | 34 +-
.../resources/content/Language.properties | 4 +-
.../resources/content/Language\_ar.properties | 4 +-
.../resources/content/Language\_bg.properties | 4 +-
.../resources/content/Language\_ca.properties | 4 +-
.../resources/content/Language\_cs.properties | 4 +-
.../resources/content/Language\_da.properties | 4 +-
.../resources/content/Language\_de.properties | 4 +-
.../resources/content/Language\_el.properties | 4 +-
.../resources/content/Language\_en.properties | 4 +-
.../resources/content/Language\_es.properties | 4 +-
.../resources/content/Language\_et.properties | 4 +-
.../resources/content/Language\_eu.properties | 4 +-
.../resources/content/Language\_fa.properties | 4 +-
.../resources/content/Language\_fi.properties | 4 +-
.../resources/content/Language\_fr.properties | 4 +-
.../resources/content/Language\_gl.properties | 4 +-
.../content/Language\_hi\_IN.properties | 4 +-
.../resources/content/Language\_hr.properties | 4 +-
.../resources/content/Language\_hu.properties | 4 +-
.../resources/content/Language\_in.properties | 4 +-
.../resources/content/Language\_it.properties | 4 +-
.../resources/content/Language\_iw.properties | 4 +-
.../resources/content/Language\_ja.properties | 4 +-
.../resources/content/Language\_kk.properties | 13 +
.../resources/content/Language\_ko.properties | 4 +-
.../resources/content/Language\_lo.properties | 4 +-
.../resources/content/Language\_lt.properties | 4 +-
.../resources/content/Language\_nb.properties | 4 +-
.../resources/content/Language\_nl.properties | 4 +-
.../content/Language\_nl\_BE.properties | 4 +-
.../resources/content/Language\_pl.properties | 4 +-
.../content/Language\_pt\_BR.properties | 4 +-
.../content/Language\_pt\_PT.properties | 4 +-
.../resources/content/Language\_ro.properties | 4 +-
.../resources/content/Language\_ru.properties | 4 +-
.../resources/content/Language\_sk.properties | 4 +-
.../resources/content/Language\_sl.properties | 4 +-
.../content/Language\_sr\_RS.properties | 4 +-
.../content/Language\_sr\_RS\_latin.properties | 4 +-
.../resources/content/Language\_sv.properties | 4 +-
.../content/Language\_ta\_IN.properties | 12 +
.../resources/content/Language\_th.properties | 4 +-
.../resources/content/Language\_tr.properties | 4 +-
.../resources/content/Language\_uk.properties | 4 +-
.../resources/content/Language\_vi.properties | 4 +-
.../content/Language\_zh\_CN.properties | 4 +-
.../content/Language\_zh\_TW.properties | 4 +-
.../resources/META-INF/resources/init.jsp | 1 -
.../resources/META-INF/resources/view.jsp | 6 +-
.../asset/MBMessageAssetRenderer.java | 11 +
.../network-utilities-web/build.gradle | 2 +-
.../internal/util/DNSLookupWebCacheItem.java | 4 +-
.../portlet/NotificationsPortlet.java | 116 +++-
.../oauth2-provider-rest/build.gradle | 2 +-
.../token/LiferayAccessTokenService.java | 4 +-
.../build.gradle | 6 +-
.../petra-salesforce-client/build.gradle | 2 +-
.../portal-odata-impl/build.gradle | 2 +-
.../build.gradle | 4 +-
.../RemoteElasticsearchConnection.java | 3 +-
.../context/PortletURLFactoryImpl.java | 41 +-
.../FolderSearchFacetDisplayBuilder.java | 11 +-
.../SearchResultSummaryDisplayBuilder.java | 5 +-
.../portal-security-sso-cas-impl/bnd.bnd | 3 +-
.../portal-security-sso-cas-impl/build.gradle | 5 +-
.../build.gradle | 2 +-
.../edit\_ldap\_server.jsp | 6 +-
.../resources/content/Language.properties | 4 +
.../resources/content/Language\_ar.properties | 4 +
.../resources/content/Language\_bg.properties | 4 +
.../resources/content/Language\_ca.properties | 4 +
.../resources/content/Language\_cs.properties | 4 +
.../resources/content/Language\_da.properties | 4 +
.../resources/content/Language\_de.properties | 8 +-
.../resources/content/Language\_el.properties | 4 +
.../resources/content/Language\_en.properties | 4 +
.../resources/content/Language\_es.properties | 4 +
.../resources/content/Language\_et.properties | 4 +
.../resources/content/Language\_eu.properties | 4 +
.../resources/content/Language\_fa.properties | 4 +
.../resources/content/Language\_fi.properties | 4 +
.../resources/content/Language\_fr.properties | 8 +-
.../resources/content/Language\_gl.properties | 4 +
.../content/Language\_hi\_IN.properties | 4 +
.../resources/content/Language\_hr.properties | 4 +
.../resources/content/Language\_hu.properties | 8 +-
.../resources/content/Language\_in.properties | 4 +
.../resources/content/Language\_it.properties | 4 +
.../resources/content/Language\_iw.properties | 8 +-
.../resources/content/Language\_ja.properties | 8 +-
.../resources/content/Language\_kk.properties | 147 +++++
.../resources/content/Language\_ko.properties | 4 +
.../resources/content/Language\_lo.properties | 4 +
.../resources/content/Language\_lt.properties | 4 +
.../resources/content/Language\_nb.properties | 4 +
.../resources/content/Language\_nl.properties | 8 +-
.../content/Language\_nl\_BE.properties | 4 +
.../resources/content/Language\_pl.properties | 4 +
.../content/Language\_pt\_BR.properties | 8 +-
.../content/Language\_pt\_PT.properties | 4 +
.../resources/content/Language\_ro.properties | 4 +
.../resources/content/Language\_ru.properties | 4 +
.../resources/content/Language\_sk.properties | 4 +
.../resources/content/Language\_sl.properties | 4 +
.../content/Language\_sr\_RS.properties | 4 +
.../content/Language\_sr\_RS\_latin.properties | 4 +
.../resources/content/Language\_sv.properties | 4 +
.../resources/content/Language\_th.properties | 4 +
.../resources/content/Language\_tr.properties | 4 +
.../resources/content/Language\_uk.properties | 4 +
.../resources/content/Language\_vi.properties | 4 +
.../content/Language\_zh\_CN.properties | 4 +
.../content/Language\_zh\_TW.properties | 4 +
.../portal-settings-web/build.gradle | 2 +-
.../resources/email\_notifications.jsp | 22 +
.../portal-store/portal-store-s3/build.gradle | 6 +-
.../FreeMarkerEngineConfiguration.java | 2 +-
.../internal/LiferayObjectWrapper.java | 19 +-
.../VelocityEngineConfiguration.java | 2 +-
.../internal/LiferaySecureUberspector.java | 16 +-
.../portal-template-xsl/build.gradle | 2 +-
.../configuration/XSLEngineConfiguration.java | 5 +
.../xsl/internal/XSLSecureURIResolver.java | 77 +++
.../template/xsl/internal/XSLTemplate.java | 12 +-
.../resources/content/Language.properties | 1 +
.../resources/content/Language\_ar.properties | 1 +
.../resources/content/Language\_bg.properties | 1 +
.../resources/content/Language\_ca.properties | 1 +
.../resources/content/Language\_cs.properties | 1 +
.../resources/content/Language\_da.properties | 1 +
.../resources/content/Language\_de.properties | 1 +
.../resources/content/Language\_el.properties | 1 +
.../resources/content/Language\_en.properties | 1 +
.../resources/content/Language\_es.properties | 1 +
.../resources/content/Language\_et.properties | 1 +
.../resources/content/Language\_eu.properties | 1 +
.../resources/content/Language\_fa.properties | 1 +
.../resources/content/Language\_fi.properties | 1 +
.../resources/content/Language\_fr.properties | 1 +
.../resources/content/Language\_gl.properties | 1 +
.../content/Language\_hi\_IN.properties | 1 +
.../resources/content/Language\_hr.properties | 1 +
.../resources/content/Language\_hu.properties | 1 +
.../resources/content/Language\_in.properties | 1 +
.../resources/content/Language\_it.properties | 1 +
.../resources/content/Language\_iw.properties | 1 +
.../resources/content/Language\_ja.properties | 1 +
.../resources/content/Language\_ko.properties | 1 +
.../resources/content/Language\_lo.properties | 1 +
.../resources/content/Language\_lt.properties | 1 +
.../resources/content/Language\_nb.properties | 1 +
.../resources/content/Language\_nl.properties | 1 +
.../content/Language\_nl\_BE.properties | 1 +
.../resources/content/Language\_pl.properties | 1 +
.../content/Language\_pt\_BR.properties | 1 +
.../content/Language\_pt\_PT.properties | 1 +
.../resources/content/Language\_ro.properties | 1 +
.../resources/content/Language\_ru.properties | 1 +
.../resources/content/Language\_sk.properties | 1 +
.../resources/content/Language\_sl.properties | 1 +
.../content/Language\_sr\_RS.properties | 1 +
.../content/Language\_sr\_RS\_latin.properties | 1 +
.../resources/content/Language\_sv.properties | 1 +
.../resources/content/Language\_th.properties | 1 +
.../resources/content/Language\_tr.properties | 1 +
.../resources/content/Language\_uk.properties | 1 +
.../resources/content/Language\_vi.properties | 1 +
.../content/Language\_zh\_CN.properties | 1 +
.../content/Language\_zh\_TW.properties | 1 +
.../portal-vulcan-api/build.gradle | 6 +-
.../portal-vulcan-impl/build.gradle | 8 +-
.../portal-workflow-api/bnd.bnd | 1 +
.../portal-workflow-api/build.gradle | 1 +
.../WorkflowDefinitionConfiguration.java | 41 ++
.../portal/workflow/configuration/packageinfo | 1 +
.../KaleoTaskInstanceTokenLocalService.java | 12 +
...aleoTaskInstanceTokenLocalServiceUtil.java | 21 +
...oTaskInstanceTokenLocalServiceWrapper.java | 23 +
.../build.gradle | 2 +
.../deployment/DefaultWorkflowDeployer.java | 52 +-
.../build.gradle | 4 +-
.../internal/WorkflowTaskManagerImpl.java | 20 +
.../build.gradle | 2 +-
...aleoTaskInstanceTokenLocalServiceImpl.java | 65 +-
.../resources/content/Language.properties | 3 +
.../resources/content/Language\_ar.properties | 3 +
.../resources/content/Language\_bg.properties | 3 +
.../resources/content/Language\_ca.properties | 3 +
.../resources/content/Language\_cs.properties | 3 +
.../resources/content/Language\_da.properties | 3 +
.../resources/content/Language\_de.properties | 3 +
.../resources/content/Language\_el.properties | 3 +
.../resources/content/Language\_en.properties | 3 +
.../resources/content/Language\_es.properties | 3 +
.../resources/content/Language\_et.properties | 3 +
.../resources/content/Language\_eu.properties | 3 +
.../resources/content/Language\_fa.properties | 3 +
.../resources/content/Language\_fi.properties | 3 +
.../resources/content/Language\_fr.properties | 3 +
.../resources/content/Language\_gl.properties | 3 +
.../content/Language\_hi\_IN.properties | 3 +
.../resources/content/Language\_hr.properties | 3 +
.../resources/content/Language\_hu.properties | 3 +
.../resources/content/Language\_in.properties | 3 +
.../resources/content/Language\_it.properties | 3 +
.../resources/content/Language\_iw.properties | 3 +
.../resources/content/Language\_ja.properties | 3 +
.../resources/content/Language\_kk.properties | 113 ++++
.../resources/content/Language\_ko.properties | 3 +
.../resources/content/Language\_lo.properties | 3 +
.../resources/content/Language\_lt.properties | 3 +
.../resources/content/Language\_nb.properties | 3 +
.../resources/content/Language\_nl.properties | 3 +
.../content/Language\_nl\_BE.properties | 3 +
.../resources/content/Language\_pl.properties | 3 +
.../content/Language\_pt\_BR.properties | 3 +
.../content/Language\_pt\_PT.properties | 3 +
.../resources/content/Language\_ro.properties | 3 +
.../resources/content/Language\_ru.properties | 3 +
.../resources/content/Language\_sk.properties | 3 +
.../resources/content/Language\_sl.properties | 3 +
.../content/Language\_sr\_RS.properties | 3 +
.../content/Language\_sr\_RS\_latin.properties | 3 +
.../resources/content/Language\_sv.properties | 3 +
.../resources/content/Language\_th.properties | 3 +
.../resources/content/Language\_tr.properties | 3 +
.../resources/content/Language\_uk.properties | 3 +
.../resources/content/Language\_vi.properties | 3 +
.../content/Language\_zh\_CN.properties | 3 +
.../content/Language\_zh\_TW.properties | 3 +
.../portal-workflow-web/build.gradle | 2 +-
.../WorkflowDefinitionDisplayContext.java | 30 +
...ControlPanelWorkflowControlPanelEntry.java | 23 +-
.../portlet/ControlPanelWorkflowPortlet.java | 21 +-
...ateDefinitionPortletConfigurationIcon.java | 45 +-
.../tab/WorkflowDefinitionPortletTab.java | 25 +-
.../definition/edit\_workflow\_definition.jsp | 10 +-
.../definition/workflow\_definition\_action.jsp | 12 +-
.../build.gradle | 6 +-
.../apps/server/server-manager/build.gradle | 2 +-
.../META-INF/resources/configuration.jsp | 4 +-
.../resources/META-INF/resources/init.jsp | 1 +
.../resources/site\_vertical\_card.jspf | 2 +-
.../resources/META-INF/resources/init.jsp | 1 +
.../META-INF/resources/view\_sites.jsp | 2 +-
.../portal-osgi-web-wab-extender/build.gradle | 2 +-
.../required-dependencies/build.gradle | 4 +-
.../internal/constants/UsersAdminWebKeys.java | 3 +
...wUsersManagementToolbarDisplayContext.java | 53 +-
.../resources/edit\_user\_navigation.jsp | 4 +-
.../META-INF/resources/view\_flat\_users.jsp | 1 +
.../system.packages.extra.bnd | 10 +-
modules/source-formatter.properties | 10 +
.../JSONWebServiceActionImpl.java | 117 +++-
.../permission/PermissionCacheUtil.java | 26 +
.../service/http/LayoutServiceHttp.java | 254 ++++----
.../service/http/LayoutServiceSoap.java | 18 +
.../service/impl/LayoutServiceImpl.java | 11 +
.../service/impl/UserLocalServiceImpl.java | 115 ++--
.../portal/service/impl/UserServiceImpl.java | 5 +
.../permission/GroupPermissionImpl.java | 8 +-
.../template/TemplateContextHelper.java | 3 +-
.../portal/tools/HypersonicLoader.java | 21 +-
.../src/com/liferay/portal/util/HttpImpl.java | 4 +-
.../portal/util/LayoutSitemapURLProvider.java | 3 +-
.../com/liferay/portal/util/PortalImpl.java | 38 +-
.../com/liferay/portal/util/PropsValues.java | 21 +
.../portal/webserver/WebServerServlet.java | 563 ++++++++++--------
.../WorkflowTaskManagerProxyBean.java | 10 +
.../permission/WorkflowPermissionImpl.java | 2 +-
.../email\_password\_changed\_body.tmpl | 10 +
.../email\_password\_changed\_subject.tmpl | 1 +
.../email\_user\_added\_reset\_password\_body.tmpl | 10 +
.../impl/AssetEntryFinderImpl.java | 14 +-
portal-impl/src/portal.properties | 306 +++++++++-
.../AllowedIPAddressesValidatorFactory.java | 12 +-
.../jsonwebservice/JSONWebServiceNaming.java | 8 +
.../portal/kernel/portlet/LiferayPortlet.java | 9 +-
.../portal/kernel/service/LayoutService.java | 5 +
.../kernel/service/LayoutServiceUtil.java | 7 +
.../kernel/service/LayoutServiceWrapper.java | 8 +
.../portal/kernel/service/UserService.java | 4 +
.../portal/kernel/util/InetAddressUtil.java | 59 ++
.../liferay/portal/kernel/util/PropsKeys.java | 22 +
.../kernel/workflow/WorkflowTaskManager.java | 5 +
.../workflow/WorkflowTaskManagerUtil.java | 9 +
.../docroot/html/common/themes/top\_js.jspf | 4 +-
.../html/taglib/ui/breadcrumb/page.jsp | 2 +-
sql/build-parent.xml | 2 +
333 files changed, 3165 insertions(+), 963 deletions(-)
create mode 100644 modules/apps/login/login-web/src/main/resources/content/Language\_kk.properties
create mode 100644 modules/apps/login/login-web/src/main/resources/content/Language\_ta\_IN.properties
create mode 100644 modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_kk.properties
create mode 100644 modules/apps/portal-template/portal-template-xsl/src/main/java/com/liferay/portal/template/xsl/internal/XSLSecureURIResolver.java
create mode 100644 modules/apps/portal-workflow/portal-workflow-api/src/main/java/com/liferay/portal/workflow/configuration/WorkflowDefinitionConfiguration.java
create mode 100644 modules/apps/portal-workflow/portal-workflow-api/src/main/resources/com/liferay/portal/workflow/configuration/packageinfo
create mode 100644 modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_kk.properties
create mode 100644 modules/source-formatter.properties
create mode 100644 portal-impl/src/com/liferay/portlet/admin/dependencies/email\_password\_changed\_body.tmpl
create mode 100644 portal-impl/src/com/liferay/portlet/admin/dependencies/email\_password\_changed\_subject.tmpl
create mode 100644 portal-impl/src/com/liferay/portlet/admin/dependencies/email\_user\_added\_reset\_password\_body.tmpl
diff --git a/README.markdown b/README.markdown
index cb2c01a5c0ab61..00f7821c4daa89 100644
--- a/README.markdown
+++ b/README.markdown
@@ -1,192 +1,35 @@
-# Liferay Portal
-
-[Liferay Portal](https://community.liferay.com/projects/portal) is an
-open source enterprise web platform for building business solutions that deliver
-immediate results and long-term value. Liferay Portal started out as a personal
-development project in 2000 and was open sourced in 2001.
-
-To get started, check out the project's community homepage at
-[community.liferay.com](https://community.liferay.com)!
-
-## Latest Release Details
-
-The latest release, Liferay Portal version 7.1, is built from the source code of
-Liferay Portal and several other related open source projects. It includes
-features for end users, business professionals, system administrators, and
-enterprise developers.
-
-- Modular architecture for maximum flexibility and reliability
-- Portal features for managing users, groups, and permissions
-- Single page applications for blazingly fast performance
-- Rich web services for integrating with other systems
-- Web content management including Personalization and Content Targeting
-- Documents and rich media management
-- Mobile development platform
-- Business forms and workflow
-- Collaboration features such as blogs, wikis, and social networking
-- Consistent and powerful Lexicon user experience
-- Integrated development environment using
- [Liferay Dev Studio](https://community.liferay.com/projects/ide)
-
-For more details on these and other features, please refer to the
-[user guide](https://dev.liferay.com/discover/portal) on the
-[Liferay Developer Network](https://dev.liferay.com).
-
-## Quick Start
-
-To get up and running quickly, follow the steps below:
-
-1. Download a [pre-built Liferay Portal release](http://liferay.com/downloads).
- For starters, it's recommended to choose Liferay Portal bundled with Tomcat.
-
-2. Download and install
- [Java (JDK) 8](http://www.oracle.com/technetwork/java/javase/downloads/index.html)
- (if necessary) in your local environment.
-
-3. Extract the downloaded pre-built Liferay Portal bundle into a folder.
-
-4. Navigate to the bundle's `liferay-ce-portal-[version]/tomcat-[version]/bin`
- folder and execute `startup.bat` (Windows) or `startup.sh` (Unix/Linux/Mac OS
- X), depending on your operating system.
-
-5. A server console opens, which starts your Liferay Portal instance. Once your
- instance is ready to use, the portal URL address (http://localhost:8080) is
- automatically opened in your default browser.
-
-6. You're presented a Basic Configuration page. Complete the configuration
- options.
-
- Liferay Portal uses an embedded database (HSQL) to make installation fast
- and easy. This database is not ready for production, so consider configuring
- a production-ready database (e.g., MySQL) if you plan on doing more than
- just exploring/testing.
-
-7. Agree to the terms and conditions, create a password, and configure a
- security question/answer.
-
-You can now use Liferay Portal!
-
-For more detailed installation instructions, refer to the
-[system administrator guide](https://dev.liferay.com/discover/deployment) on the
-Liferay Developer Network.
-
-If you wish to \*build\* core Liferay Portal or its plugins, read the
-[CONTRIBUTING guide](CONTRIBUTING.markdown). It includes details on using the
-repositories and building the software.
-
-## Liferay Developer Network
-
-The [Liferay Developer Network](https://dev.liferay.com) (LDN) is the best place
-to learn about Liferay. It has over 200 tutorials, guided learning, and much
-more.
-
-LDN provides
-[learning paths and tutorials](https://dev.liferay.com/develop/tutorials), which
-offer great resources to learn how to develop on Liferay Portal. Learning paths
-are great for those new with Liferay development; they offer a story-like
-approach, providing a beginning-to-end process for creating something (e.g.,
-developing a Liferay web application). As you gain experience developing on
-Liferay Portal, you'll want to dive into
-[tutorials](https://dev.liferay.com/develop/tutorials) for details on leveraging
-Liferay's technologies and frameworks. If you create apps that you want to share
-or sell, you can read LDN's [Distribute](https://dev.liferay.com/distribute)
-section to learn how to publish apps to the
-[Liferay Marketplace](https://web.liferay.com/marketplace).
-
-The Liferay Developer Network is not only your home for Liferay development, but
-it's also your place to [participate](https://dev.liferay.com/participate) in
-making Liferay better. Come check out the
-[Liferay Developer Network](https://dev.liferay.com).
-
-## Source Code
-
-Liferay's main source code resides in the
-[liferay-portal](https://github.com/liferay/liferay-portal) repository. Liferay
-maintains [many other repositories](https://github.com/liferay) related to
-features and supporting documentation.
-
-Liferay Portal \*releases\* are built from the liferay-portal repository. You can
-build Liferay Portal, its modules, and/or any of the other supporting
-technologies from their respective folders/repositories.
-
-## Stay Connected
-
-There are many ways for you to learn what's new in Liferay, get answers to
-questions, and connect with other Liferay community members.
-
-### Twitter
-
-Follow us on Twitter:
-
-- [@Liferay](http://twitter.com/liferay) tweets Liferay's latest announcements
-- [@LiferayDocs](http://twitter.com/liferaydocs) tweets about new articles and
- tutorials
-- [@LiferayEng](http://twitter.com/liferayeng) tweets from the core
- engineering team
-
-### Blog
-
-Read our announcements, engage in discussions, and learn more by following
-[Liferay's Blog Stream](http://www.liferay.com/community/blogs).
-
-### Forum
-
-Do you have questions? Ask them on our very active
-[forums](http://www.liferay.com/community/forums)!
-
-### Chat
-
-Join the conversation on Liferay's Community Chat.
-
-- Get your invite: [community-chat.liferay.com](https://community-chat.liferay.com)
-- Enter the chat: [liferay-community.slack.com](https://liferay-community.slack.com)
-- Channel: `#portal`
-
-## Contributing
-
-Liferay welcomes any and all contributions! Please read the
-[CONTRIBUTING guide](CONTRIBUTING.markdown) for details on developing and
-submitting your contributions.
-
-## Versioning
-
-For transparency and insight into Liferay's release cycle, and for striving to
-maintain backward compatibility, we make a strong effort to uphold the
-versioning for our software. See the
-[Semantic Versioning](https://dev.liferay.com/develop/tutorials/-/knowledge\_base/7-1/semantic-versioning)
-article for more information about how Liferay versions software.
-
-## Bug Reporting and Feature Requests
-
-Did you find a bug? Please file an issue for it at
-[https://issues.liferay.com](https://issues.liferay.com) following
-[Liferay's JIRA Guidelines](http://www.liferay.com/community/wiki/-/wiki/Main/JIRA).
-
-If you'd like to suggest a new feature for Liferay, visit the
-[Contribute a New Feature or Improvement](https://dev.liferay.com/participate/contribute-a-feature)
-page to learn about contributing.
-
-## Professional Services
-
-If you need professional consultation or help with Liferay and your business,
-check out the
-[offerings from Liferay, Inc.](http://www.liferay.com/subscription-services) and
-its [partner network](http://www.liferay.com/services/partners).
-
-## The Liferay Development Team
-
-Liferay Portal is produced by the worldwide Liferay engineering team, and
-involves many hours of development, testing, writing documentation, and working
-with the wider Liferay community of customers, partners, and open source
-developers. We are glad you have chosen Liferay Portal, and hope that it meets
-or exceeds your expectations!
-
-In addition to Liferay's engineering staff, a special thanks goes to the many
-open source developers who volunteer their time and energy to help with the
-release, whether it was bug fixing, idea generation, documentation,
-translations, or other contributions that helped to improve this release.
-
-## Liferay Portal Community Edition License
+# Information
+
+This fork provides security patches for Liferay Portal. For more information about security in Liferay Portal, please see [https://portal.liferay.dev/learn/security](https://portal.liferay.dev/learn/security).
+
+The [March 2020](https://github.com/--link-to-the-diff-patch--) release contains fixes for the following issues:
+[CST-7132](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/117954449),
+[CST-7133](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118080791),
+[CST-7135](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118080894),
+[CST-7136](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118080942),
+[CST-7137](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118080955),
+[CST-7138](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118080994),
+[CST-7139](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118081013),
+[CST-7140](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118081026),
+[CST-7141](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118081039),
+[CST-7142](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118081059),
+[CST-7143](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118081072),
+[CST-7144](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118664243),
+[CST-7145](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118670963),
+[CST-7146](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118671025),
+[CST-7147](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118675447),
+[CST-7148](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118675457),
+[CST-7149](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118762169),
+[CST-7204](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/117954240),
+[CST-7205](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/117954271),
+[CST-7206](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/117954284),
+[CST-7208](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/117954394),
+[CST-7209](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/117954421),
+[CST-7210](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/117954436),
+[CST-7211](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118664044),
+[CST-7212](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118670924)
+
+# Liferay Portal Community Edition License
This library, \*Liferay Portal Community Edition\*, is free software ("Licensed
Software"); you can redistribute it and/or modify it under the terms of the
diff --git a/build.properties b/build.properties
index 64a1e91f9c2e31..c189b910ea795d 100644
--- a/build.properties
+++ b/build.properties
@@ -12,8 +12,8 @@
baseline.jar.bnddir.name=.bnd
#baseline.jar.report.level=diff
- #baseline.jar.report.level=off
- baseline.jar.report.level=persist
+ baseline.jar.report.level=off
+ #baseline.jar.report.level=persist
#baseline.jar.report.level=standard
baseline.jar.report.only.dirty.packages=true
@@ -588,4 +588,4 @@
## Upgrade Table Builder
##
- upgrade.table.dir=
\ No newline at end of file
+ upgrade.table.dir=
diff --git a/lib/portal/dependencies.properties b/lib/portal/dependencies.properties
index 2e191ac7029aa7..28858c70d5f2a6 100644
--- a/lib/portal/dependencies.properties
+++ b/lib/portal/dependencies.properties
@@ -28,7 +28,7 @@ chemistry-opencmis-client-impl=org.apache.chemistry.opencmis:chemistry-opencmis-
chemistry-opencmis-commons-api=org.apache.chemistry.opencmis:chemistry-opencmis-commons-api:0.13.0
chemistry-opencmis-commons-impl=org.apache.chemistry.opencmis:chemistry-opencmis-commons-impl:0.13.0
closure-compiler=com.google.javascript:closure-compiler:v20131014
-commons-beanutils=commons-beanutils:commons-beanutils:1.9.2
+commons-beanutils=commons-beanutils:commons-beanutils:1.9.4
commons-chain=commons-chain:commons-chain:1.2
commons-codec=commons-codec:commons-codec:1.9
commons-collections4=org.apache.commons:commons-collections4:4.2
@@ -71,9 +71,9 @@ ical4j=net.fortuna.ical4j:ical4j:1.0-rc3
im4java=org.im4java:im4java:1.2.0
isoparser=com.googlecode.mp4parser:isoparser:1.1.22
jabsorb=com.liferay:org.jabsorb:1.3.2.LIFERAY-PATCHED-1
-jackson-annotations=com.fasterxml.jackson.core:jackson-annotations:2.9.0
-jackson-core=com.fasterxml.jackson.core:jackson-core:2.9.8
-jackson-databind=com.fasterxml.jackson.core:jackson-databind:2.9.8
+jackson-annotations=com.fasterxml.jackson.core:jackson-annotations:2.9.9
+jackson-core=com.fasterxml.jackson.core:jackson-core:2.9.9
+jackson-databind=com.fasterxml.jackson.core:jackson-databind:2.9.9.3
jai\_codec=com.sun.media:jai-codec:1.1.3
jai\_core=com.sun:jai\_core:1.1.3
jakarta-regexp=com.liferay:org.apache.regexp:1.5
@@ -174,8 +174,8 @@ streambuffer=com.sun.xml.stream.buffer:streambuffer:0.9
stringtemplate=org.antlr:stringtemplate:3.0
struts-core=org.apache.struts:struts-core:1.3.10
tagsoup=org.ccil.cowan.tagsoup:tagsoup:1.2.1
-tika-core=org.apache.tika:tika-core:1.20
-tika-parsers=org.apache.tika:tika-parsers:1.20
+tika-core=org.apache.tika:tika-core:1.22
+tika-parsers=org.apache.tika:tika-parsers:1.22
tomcat-jdbc=org.apache.tomcat:tomcat-jdbc:9.0.17
tomcat-juli=org.apache.tomcat:tomcat-juli:9.0.17
transaction=javax.transaction:javax.transaction-api:1.3
diff --git a/modules/apps/asset/asset-taglib/src/main/resources/META-INF/resources/asset\_metadata/metadata\_entry.jsp b/modules/apps/asset/asset-taglib/src/main/resources/META-INF/resources/asset\_metadata/metadata\_entry.jsp
index 5751e21c00f2eb..4033441f0f3a94 100644
--- a/modules/apps/asset/asset-taglib/src/main/resources/META-INF/resources/asset\_metadata/metadata\_entry.jsp
+++ b/modules/apps/asset/asset-taglib/src/main/resources/META-INF/resources/asset\_metadata/metadata\_entry.jsp
@@ -85,7 +85,15 @@ else if (metadataField.equals("view-count")) {
<%
- User assetRendererUser = UserLocalServiceUtil.getUser(assetRenderer.getUserId());
+ String fullName = LanguageUtil.get(request, "anonymous");
+
+ long userId = assetRenderer.getUserId();
+
+ if (userId > 0) {
+ User assetRendererUser = UserLocalServiceUtil.getUser(userId);
+
+ fullName = assetRendererUser.getFullName();
+ }
String displayDate = StringPool.BLANK;
@@ -100,12 +108,12 @@ else if (metadataField.equals("view-count")) {

- <%= HtmlUtil.escape(assetRendererUser.getFullName()) %>
+ <%= HtmlUtil.escape(fullName) %>
<%= displayDate %>

diff --git a/modules/apps/blogs/blogs-service/build.gradle b/modules/apps/blogs/blogs-service/build.gradle
index b7826f1d9913a4..2d983685025683 100644
--- a/modules/apps/blogs/blogs-service/build.gradle
+++ b/modules/apps/blogs/blogs-service/build.gradle
@@ -27,7 +27,7 @@ dependencies {
compileOnly group: "com.liferay", name: "com.liferay.upload.api", version: "2.0.0"
compileOnly group: "com.liferay", name: "com.liferay.xstream.configurator.api", version: "3.0.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "3.0.0"
- compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "3.20.0"
+ compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "default"
compileOnly group: "com.liferay.portal", name: "com.liferay.util.java", version: "3.0.0"
compileOnly group: "javax.portlet", name: "portlet-api", version: "3.0.0"
compileOnly group: "javax.servlet", name: "javax.servlet-api", version: "3.0.1"
diff --git a/modules/apps/blogs/blogs-service/src/main/java/com/liferay/blogs/internal/util/PingbackMethodImpl.java b/modules/apps/blogs/blogs-service/src/main/java/com/liferay/blogs/internal/util/PingbackMethodImpl.java
index a4f58e832d312f..f97920c4577141 100644
--- a/modules/apps/blogs/blogs-service/src/main/java/com/liferay/blogs/internal/util/PingbackMethodImpl.java
+++ b/modules/apps/blogs/blogs-service/src/main/java/com/liferay/blogs/internal/util/PingbackMethodImpl.java
@@ -48,7 +48,6 @@
import java.io.IOException;
-import java.net.InetAddress;
import java.net.URL;
import java.util.HashMap;
@@ -396,7 +395,7 @@ private boolean \_isSourceURILocalNetwork() {
URL url = new URL(\_sourceURI);
return InetAddressUtil.isLocalInetAddress(
- InetAddress.getByName(url.getHost()));
+ InetAddressUtil.getInetAddressByName(url.getHost()));
}
catch (Exception e) {
if (\_log.isDebugEnabled()) {
diff --git a/modules/apps/blogs/blogs-web/src/main/resources/META-INF/resources/blogs/asset/abstract.jsp b/modules/apps/blogs/blogs-web/src/main/resources/META-INF/resources/blogs/asset/abstract.jsp
index 4cf6006ecfe26f..ec45f4ad9454fb 100644
--- a/modules/apps/blogs/blogs-web/src/main/resources/META-INF/resources/blogs/asset/abstract.jsp
+++ b/modules/apps/blogs/blogs-web/src/main/resources/META-INF/resources/blogs/asset/abstract.jsp
@@ -47,7 +47,7 @@ BlogsEntry entry = (BlogsEntry)request.getAttribute(WebKeys.BLOGS\_ENTRY);
- [<%= entry.getUserName() %>](%3C%25%3D%20entryUserURL%20%25%3E)
+ [<%= HtmlUtil.escape(entry.getUserName()) %>](%3C%25%3D%20entryUserURL%20%25%3E)

diff --git a/modules/apps/blogs/blogs-web/src/main/resources/META-INF/resources/blogs/asset/full\_content.jsp b/modules/apps/blogs/blogs-web/src/main/resources/META-INF/resources/blogs/asset/full\_content.jsp
index 58f51b2fdd9ed7..524eb1ba6041fe 100644
--- a/modules/apps/blogs/blogs-web/src/main/resources/META-INF/resources/blogs/asset/full\_content.jsp
+++ b/modules/apps/blogs/blogs-web/src/main/resources/META-INF/resources/blogs/asset/full\_content.jsp
@@ -69,7 +69,7 @@ String viewEntryURL = assetRenderer.getURLView(liferayPortletResponse, WindowSta
- [<%= entry.getUserName() %>](%3C%25%3D%20entryUserURL%20%25%3E)
+ [<%= HtmlUtil.escape(entry.getUserName()) %>](%3C%25%3D%20entryUserURL%20%25%3E)

diff --git a/modules/apps/blogs/blogs-web/src/main/resources/META-INF/resources/blogs/view\_entry\_content.jsp b/modules/apps/blogs/blogs-web/src/main/resources/META-INF/resources/blogs/view\_entry\_content.jsp
index 6d1f35a4af74c3..e48e94e2a6deb3 100644
--- a/modules/apps/blogs/blogs-web/src/main/resources/META-INF/resources/blogs/view\_entry\_content.jsp
+++ b/modules/apps/blogs/blogs-web/src/main/resources/META-INF/resources/blogs/view\_entry\_content.jsp
@@ -84,7 +84,7 @@ BlogsEntry entry = (BlogsEntry)request.getAttribute("view\_entry\_content.jsp-entr
- [<%= entry.getUserName() %>](%3C%25%3D%20entryUserURL%20%25%3E)
+ [<%= HtmlUtil.escape(entry.getUserName()) %>](%3C%25%3D%20entryUserURL%20%25%3E)

diff --git a/modules/apps/blogs/blogs-web/src/main/resources/META-INF/resources/blogs/view\_entry\_content\_detail.jsp b/modules/apps/blogs/blogs-web/src/main/resources/META-INF/resources/blogs/view\_entry\_content\_detail.jsp
index 0d4c925b8ee845..48ae406b83f962 100644
--- a/modules/apps/blogs/blogs-web/src/main/resources/META-INF/resources/blogs/view\_entry\_content\_detail.jsp
+++ b/modules/apps/blogs/blogs-web/src/main/resources/META-INF/resources/blogs/view\_entry\_content\_detail.jsp
@@ -117,7 +117,7 @@ RatingsStats ratingsStats = (RatingsStats)request.getAttribute("view\_entry\_conte
- [<%= entry.getUserName() %>](%3C%25%3D%20entryUserURL%20%25%3E)
+ [<%= HtmlUtil.escape(entry.getUserName()) %>](%3C%25%3D%20entryUserURL%20%25%3E)

diff --git a/modules/apps/blogs/blogs-web/src/main/resources/META-INF/resources/blogs/view\_entry\_related.jsp b/modules/apps/blogs/blogs-web/src/main/resources/META-INF/resources/blogs/view\_entry\_related.jsp
index 273b26c3c98e8a..413d08adedcf01 100644
--- a/modules/apps/blogs/blogs-web/src/main/resources/META-INF/resources/blogs/view\_entry\_related.jsp
+++ b/modules/apps/blogs/blogs-web/src/main/resources/META-INF/resources/blogs/view\_entry\_related.jsp
@@ -85,7 +85,7 @@ BlogsEntry blogsEntry = (BlogsEntry)request.getAttribute("view\_entry\_related.jsp
- [<%= blogsEntry.getUserName() %>](%3C%25%3D%20blogsEntryUserURL%20%25%3E)
+ [<%= HtmlUtil.escape(blogsEntry.getUserName()) %>](%3C%25%3D%20blogsEntryUserURL%20%25%3E)

diff --git a/modules/apps/blogs/blogs-web/src/main/resources/com/liferay/blogs/web/template/dependencies/portlet\_display\_template\_basic.ftl b/modules/apps/blogs/blogs-web/src/main/resources/com/liferay/blogs/web/template/dependencies/portlet\_display\_template\_basic.ftl
index 3c1f4781565fd6..ad9b82facc5241 100644
--- a/modules/apps/blogs/blogs-web/src/main/resources/com/liferay/blogs/web/template/dependencies/portlet\_display\_template\_basic.ftl
+++ b/modules/apps/blogs/blogs-web/src/main/resources/com/liferay/blogs/web/template/dependencies/portlet\_display\_template\_basic.ftl
@@ -15,7 +15,7 @@
### - [${blogsEntryUtil.getDisplayTitle(resourceBundle, curBlogEntry)}](%24%7BviewEntryPortletURL.toString%28%29%7D) + [${htmlUtil.escape(blogsEntryUtil.getDisplayTitle(resourceBundle, curBlogEntry))}](%24%7BviewEntryPortletURL.toString%28%29%7D)

diff --git a/modules/apps/blogs/blogs-web/src/main/resources/com/liferay/blogs/web/template/dependencies/portlet\_display\_template\_card.ftl b/modules/apps/blogs/blogs-web/src/main/resources/com/liferay/blogs/web/template/dependencies/portlet\_display\_template\_card.ftl
index 7333b0b81067a4..261543a2de1050 100644
--- a/modules/apps/blogs/blogs-web/src/main/resources/com/liferay/blogs/web/template/dependencies/portlet\_display\_template\_card.ftl
+++ b/modules/apps/blogs/blogs-web/src/main/resources/com/liferay/blogs/web/template/dependencies/portlet\_display\_template\_card.ftl
@@ -32,7 +32,7 @@
### [- ${blogsEntryUtil.getDisplayTitle(resourceBundle, curBlogEntry)}](%24%7BviewEntryPortletURL.toString%28%29%7D) + ${htmlUtil.escape(blogsEntryUtil.getDisplayTitle(resourceBundle, curBlogEntry))}

diff --git a/modules/apps/calendar/calendar-web/src/main/resources/META-INF/resources/view\_calendar.jsp b/modules/apps/calendar/calendar-web/src/main/resources/META-INF/resources/view\_calendar.jsp
index 1c00a8b16be0ea..60403bb3367cdb 100644
--- a/modules/apps/calendar/calendar-web/src/main/resources/META-INF/resources/view\_calendar.jsp
+++ b/modules/apps/calendar/calendar-web/src/main/resources/META-INF/resources/view\_calendar.jsp
@@ -115,7 +115,7 @@ boolean columnOptionsVisible = GetterUtil.getBoolean(SessionClicks.get(request,

-
+

diff --git a/modules/apps/chat/chat-service/build.gradle b/modules/apps/chat/chat-service/build.gradle
index fbc6f378077fcb..ed83da3a8ddac1 100644
--- a/modules/apps/chat/chat-service/build.gradle
+++ b/modules/apps/chat/chat-service/build.gradle
@@ -16,7 +16,7 @@ dependencies {
compileOnly group: "com.liferay", name: "com.liferay.portal.spring.extender.api", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.upgrade.api", version: "2.0.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "3.0.0"
- compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "3.18.0"
+ compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "default"
compileOnly group: "javax.portlet", name: "portlet-api", version: "3.0.0"
compileOnly group: "javax.servlet", name: "javax.servlet-api", version: "3.0.1"
compileOnly group: "org.osgi", name: "org.osgi.service.component", version: "1.3.0"
diff --git a/modules/apps/chat/chat-service/src/main/java/com/liferay/chat/internal/jabber/JabberImpl.java b/modules/apps/chat/chat-service/src/main/java/com/liferay/chat/internal/jabber/JabberImpl.java
index 9c8f5f5f58db8f..0b2f52dd1bbae9 100644
--- a/modules/apps/chat/chat-service/src/main/java/com/liferay/chat/internal/jabber/JabberImpl.java
+++ b/modules/apps/chat/chat-service/src/main/java/com/liferay/chat/internal/jabber/JabberImpl.java
@@ -27,6 +27,7 @@
import com.liferay.portal.kernel.model.ContactConstants;
import com.liferay.portal.kernel.model.User;
import com.liferay.portal.kernel.service.UserLocalService;
+import com.liferay.portal.kernel.util.InetAddressUtil;
import com.liferay.portal.kernel.util.StringUtil;
import com.liferay.portal.kernel.util.Validator;
@@ -414,7 +415,8 @@ protected ConnectionConfiguration getConnectionConfiguration()
String jabberHost = \_chatGroupServiceConfiguration.jabberHost();
if (!Validator.isIPAddress(jabberHost)) {
- InetAddress inetAddress = InetAddress.getByName(jabberHost);
+ InetAddress inetAddress = InetAddressUtil.getInetAddressByName(
+ jabberHost);
jabberHost = inetAddress.getHostAddress();
}
diff --git a/modules/apps/configuration-admin/configuration-admin-web/build.gradle b/modules/apps/configuration-admin/configuration-admin-web/build.gradle
index cb9c760f1c8aa2..a1eaa4bc62d5a7 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/build.gradle
+++ b/modules/apps/configuration-admin/configuration-admin-web/build.gradle
@@ -28,7 +28,7 @@ dependencies {
compileOnly group: "com.liferay", name: "com.liferay.portal.configuration.metatype.api", version: "1.1.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.configuration.persistence.api", version: "1.0.0"
compileOnly group: "com.liferay", name: "org.apache.felix.fileinstall", version: "3.6.4.LIFERAY-PATCHED-1"
- compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "3.0.0"
+ compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "default"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "3.29.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.util.taglib", version: "3.0.0"
compileOnly group: "javax.portlet", name: "portlet-api", version: "3.0.0"
@@ -40,7 +40,7 @@ dependencies {
compileOnly group: "org.osgi", name: "org.osgi.service.metatype", version: "1.3.0"
testCompile group: "com.liferay", name: "org.jabsorb", version: "1.3.2.LIFERAY-PATCHED-1"
- testCompile group: "com.liferay.portal", name: "com.liferay.util.java", version: "default"
+ testCompile group: "com.liferay.portal", name: "com.liferay.util.java", version: "3.0.0"
testCompile group: "com.redhat.qe", name: "json-java", version: "20110202"
testCompile group: "easyconf", name: "easyconf", version: "0.9.5"
testCompile group: "org.jodd", name: "jodd-json", version: "3.6.4"
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/java/com/liferay/configuration/admin/web/internal/portlet/SystemSettingsPortlet.java b/modules/apps/configuration-admin/configuration-admin-web/src/main/java/com/liferay/configuration/admin/web/internal/portlet/SystemSettingsPortlet.java
index 378a592e8bf7e6..e8cb6a7492e817 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/java/com/liferay/configuration/admin/web/internal/portlet/SystemSettingsPortlet.java
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/java/com/liferay/configuration/admin/web/internal/portlet/SystemSettingsPortlet.java
@@ -16,8 +16,20 @@
import com.liferay.configuration.admin.constants.ConfigurationAdminPortletKeys;
import com.liferay.portal.kernel.portlet.bridges.mvc.MVCPortlet;
+import com.liferay.portal.kernel.security.auth.PrincipalException;
+import com.liferay.portal.kernel.security.permission.PermissionChecker;
+import com.liferay.portal.kernel.security.permission.PermissionThreadLocal;
+import java.io.IOException;
+
+import javax.portlet.ActionRequest;
+import javax.portlet.ActionResponse;
import javax.portlet.Portlet;
+import javax.portlet.PortletException;
+import javax.portlet.RenderRequest;
+import javax.portlet.RenderResponse;
+import javax.portlet.ResourceRequest;
+import javax.portlet.ResourceResponse;
import org.osgi.service.component.annotations.Component;
@@ -37,9 +49,53 @@
"javax.portlet.init-param.view-template=/view.jsp",
"javax.portlet.name=" + ConfigurationAdminPortletKeys.SYSTEM\_SETTINGS,
"javax.portlet.resource-bundle=content.Language",
- "javax.portlet.security-role-ref=power-user,user"
+ "javax.portlet.security-role-ref=administrator"
},
service = Portlet.class
)
public class SystemSettingsPortlet extends MVCPortlet {
+
+ @Override
+ public void processAction(
+ ActionRequest actionRequest, ActionResponse actionResponse)
+ throws IOException, PortletException {
+
+ checkOmniAdmin();
+
+ super.processAction(actionRequest, actionResponse);
+ }
+
+ @Override
+ public void render(
+ RenderRequest renderRequest, RenderResponse renderResponse)
+ throws IOException, PortletException {
+
+ checkOmniAdmin();
+
+ super.render(renderRequest, renderResponse);
+ }
+
+ @Override
+ public void serveResource(
+ ResourceRequest resourceRequest, ResourceResponse resourceResponse)
+ throws IOException, PortletException {
+
+ checkOmniAdmin();
+
+ super.serveResource(resourceRequest, resourceResponse);
+ }
+
+ protected void checkOmniAdmin() throws PortletException {
+ PermissionChecker permissionChecker =
+ PermissionThreadLocal.getPermissionChecker();
+
+ if (!permissionChecker.isOmniadmin()) {
+ PrincipalException principalException =
+ new PrincipalException.MustBeCompanyAdmin(
+ permissionChecker.getUserId());
+
+ throw new PortletException(principalException);
+ }
+ }
+
}
\ No newline at end of file
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/java/com/liferay/configuration/admin/web/internal/portlet/action/BindConfigurationMVCActionCommand.java b/modules/apps/configuration-admin/configuration-admin-web/src/main/java/com/liferay/configuration/admin/web/internal/portlet/action/BindConfigurationMVCActionCommand.java
index a2b9412f01e013..5e43d53d859790 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/java/com/liferay/configuration/admin/web/internal/portlet/action/BindConfigurationMVCActionCommand.java
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/java/com/liferay/configuration/admin/web/internal/portlet/action/BindConfigurationMVCActionCommand.java
@@ -54,6 +54,7 @@
import java.util.Enumeration;
import java.util.Hashtable;
import java.util.Map;
+import java.util.Objects;
import java.util.ResourceBundle;
import javax.portlet.ActionRequest;
@@ -215,6 +216,10 @@ protected void configureTargetService(
Object value = properties.get(key);
+ if (Objects.equals(value, Portal.TEMP\_OBFUSCATION\_VALUE)) {
+ continue;
+ }
+
configuredProperties.put(key, value);
}
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/java/com/liferay/configuration/admin/web/internal/portlet/action/ExportConfigurationMVCResourceCommand.java b/modules/apps/configuration-admin/configuration-admin-web/src/main/java/com/liferay/configuration/admin/web/internal/portlet/action/ExportConfigurationMVCResourceCommand.java
index f35126cb15f9da..dcce7b269a376f 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/java/com/liferay/configuration/admin/web/internal/portlet/action/ExportConfigurationMVCResourceCommand.java
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/java/com/liferay/configuration/admin/web/internal/portlet/action/ExportConfigurationMVCResourceCommand.java
@@ -31,6 +31,7 @@
import com.liferay.portal.kernel.util.WebKeys;
import com.liferay.portal.kernel.zip.ZipWriter;
import com.liferay.portal.kernel.zip.ZipWriterFactoryUtil;
+import com.liferay.portal.util.PropsValues;
import java.io.FileInputStream;
@@ -258,6 +259,13 @@ protected Properties getProperties(
ConfigurationModel.ALL);
for (AttributeDefinition attributeDefinition : attributeDefinitions) {
+ if (!PropsValues.MODULE\_FRAMEWORK\_EXPORT\_PASSWORD\_ATTRIBUTES &&
+ (attributeDefinition.getType() ==
+ AttributeDefinition.PASSWORD)) {
+
+ continue;
+ }
+
String[] values = AttributeDefinitionUtil.getProperty(
attributeDefinition, configuration);
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/java/com/liferay/configuration/admin/web/internal/util/ConfigurationModelToDDMFormValuesConverter.java b/modules/apps/configuration-admin/configuration-admin-web/src/main/java/com/liferay/configuration/admin/web/internal/util/ConfigurationModelToDDMFormValuesConverter.java
index 8984e942f2b13c..4921da76685b03 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/java/com/liferay/configuration/admin/web/internal/util/ConfigurationModelToDDMFormValuesConverter.java
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/java/com/liferay/configuration/admin/web/internal/util/ConfigurationModelToDDMFormValuesConverter.java
@@ -21,6 +21,7 @@
import com.liferay.dynamic.data.mapping.model.LocalizedValue;
import com.liferay.dynamic.data.mapping.storage.DDMFormFieldValue;
import com.liferay.dynamic.data.mapping.storage.DDMFormValues;
+import com.liferay.portal.kernel.util.Portal;
import com.liferay.portal.kernel.util.StringUtil;
import java.util.Dictionary;
@@ -79,13 +80,18 @@ protected void addDDMFormFieldValues(
Configuration configuration = \_configurationModel.getConfiguration();
- if (hasConfigurationAttribute(configuration, attributeDefinition)) {
- values = AttributeDefinitionUtil.getProperty(
- attributeDefinition, configuration);
+ if (attributeDefinition.getType() == AttributeDefinition.PASSWORD) {
+ values = \_PASSWORD\_TYPE\_VALUES;
}
else {
- values = AttributeDefinitionUtil.getDefaultValue(
- attributeDefinition);
+ if (hasConfigurationAttribute(configuration, attributeDefinition)) {
+ values = AttributeDefinitionUtil.getProperty(
+ attributeDefinition, configuration);
+ }
+ else {
+ values = AttributeDefinitionUtil.getDefaultValue(
+ attributeDefinition);
+ }
}
addDDMFormFieldValues(
@@ -166,6 +172,10 @@ protected void setDDMFormFieldValueLocalizedValue(
ddmFormFieldValue.setValue(localizedValue);
}
+ private static final String[] \_PASSWORD\_TYPE\_VALUES = {
+ Portal.TEMP\_OBFUSCATION\_VALUE
+ };
+
private final ConfigurationModel \_configurationModel;
private final DDMForm \_ddmForm;
private final Map \_ddmFormFieldsMap;
diff --git a/modules/apps/document-library/document-library-service/src/main/java/com/liferay/document/library/internal/security/permission/resource/DLFileEntryModelResourcePermissionRegistrar.java b/modules/apps/document-library/document-library-service/src/main/java/com/liferay/document/library/internal/security/permission/resource/DLFileEntryModelResourcePermissionRegistrar.java
index 3029bdcdfe730a..4e23600a0f0d67 100644
--- a/modules/apps/document-library/document-library-service/src/main/java/com/liferay/document/library/internal/security/permission/resource/DLFileEntryModelResourcePermissionRegistrar.java
+++ b/modules/apps/document-library/document-library-service/src/main/java/com/liferay/document/library/internal/security/permission/resource/DLFileEntryModelResourcePermissionRegistrar.java
@@ -195,9 +195,23 @@ public Boolean contains(
}
}
else if (fileVersion.isPending()) {
- return \_workflowPermission.hasPermission(
+ Boolean hasPermission = \_workflowPermission.hasPermission(
permissionChecker, fileVersion.getGroupId(), name,
fileVersion.getFileVersionId(), actionId);
+
+ if (hasPermission != null) {
+ return hasPermission.booleanValue();
+ }
+
+ boolean hasOwnerPermission =
+ permissionChecker.hasOwnerPermission(
+ dlFileEntry.getCompanyId(), name,
+ dlFileEntry.getFileEntryId(), dlFileEntry.getUserId(),
+ actionId);
+
+ if (!hasOwnerPermission) {
+ return false;
+ }
}
return null;
diff --git a/modules/apps/document-library/document-library-web/build.gradle b/modules/apps/document-library/document-library-web/build.gradle
index bcee093e332863..d757d0d65f0156 100644
--- a/modules/apps/document-library/document-library-web/build.gradle
+++ b/modules/apps/document-library/document-library-web/build.gradle
@@ -31,7 +31,7 @@ dependencies {
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "3.0.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "3.60.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.util.taglib", version: "3.0.0"
- compileOnly group: "commons-fileupload", name: "commons-fileupload", version: "1.3.2"
+ compileOnly group: "commons-fileupload", name: "commons-fileupload", version: "1.3.3"
compileOnly group: "javax.portlet", name: "portlet-api", version: "3.0.0"
compileOnly group: "javax.servlet", name: "javax.servlet-api", version: "3.0.1"
compileOnly group: "javax.servlet.jsp", name: "javax.servlet.jsp-api", version: "2.3.1"
diff --git a/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/view\_file\_entry\_types.jsp b/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/view\_file\_entry\_types.jsp
index 28e43de97b257c..c615ce5b2597a4 100644
--- a/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/view\_file\_entry\_types.jsp
+++ b/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/view\_file\_entry\_types.jsp
@@ -55,7 +55,7 @@ DLViewFileEntryTypesDisplayContext dlViewFileEntryTypesDisplayContext = new DLVi

diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-builder/src/main/java/com/liferay/dynamic/data/mapping/form/builder/internal/servlet/DDMDataProviderInstancesServlet.java b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-builder/src/main/java/com/liferay/dynamic/data/mapping/form/builder/internal/servlet/DDMDataProviderInstancesServlet.java
index 8345becefa8d68..21e2f9a6f05de5 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-builder/src/main/java/com/liferay/dynamic/data/mapping/form/builder/internal/servlet/DDMDataProviderInstancesServlet.java
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-builder/src/main/java/com/liferay/dynamic/data/mapping/form/builder/internal/servlet/DDMDataProviderInstancesServlet.java
@@ -15,7 +15,7 @@
package com.liferay.dynamic.data.mapping.form.builder.internal.servlet;
import com.liferay.dynamic.data.mapping.model.DDMDataProviderInstance;
-import com.liferay.dynamic.data.mapping.service.DDMDataProviderInstanceLocalService;
+import com.liferay.dynamic.data.mapping.service.DDMDataProviderInstanceService;
import com.liferay.dynamic.data.mapping.util.comparator.DataProviderInstanceNameComparator;
import com.liferay.portal.kernel.dao.orm.QueryUtil;
import com.liferay.portal.kernel.exception.PortalException;
@@ -113,8 +113,9 @@ protected JSONArray getDataProviderInstancesJSONArray(
new DataProviderInstanceNameComparator(true);
List ddmDataProviderInstances =
- \_ddmDataProviderInstanceLocalService.getDataProviderInstances(
- groupIds, start, end, dataProviderInstanceNameComparator);
+ \_ddmDataProviderInstanceService.search(
+ themeDisplay.getCompanyId(), groupIds, null, start, end,
+ dataProviderInstanceNameComparator);
JSONArray dataProviderInstancesJSONArray =
\_jsonFactory.createJSONArray();
@@ -153,8 +154,7 @@ protected JSONArray getDataProviderInstancesJSONArray(
private static final long serialVersionUID = 1L;
@Reference
- private DDMDataProviderInstanceLocalService
- \_ddmDataProviderInstanceLocalService;
+ private DDMDataProviderInstanceService \_ddmDataProviderInstanceService;
@Reference
private JSONFactory \_jsonFactory;
diff --git a/modules/apps/export-import/export-import-web/build.gradle b/modules/apps/export-import/export-import-web/build.gradle
index 967076a53447bb..7d58e9c876cbf5 100644
--- a/modules/apps/export-import/export-import-web/build.gradle
+++ b/modules/apps/export-import/export-import-web/build.gradle
@@ -19,7 +19,7 @@ dependencies {
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "3.0.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "3.3.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.util.taglib", version: "3.0.0"
- compileOnly group: "commons-fileupload", name: "commons-fileupload", version: "1.3.2"
+ compileOnly group: "commons-fileupload", name: "commons-fileupload", version: "1.3.3"
compileOnly group: "javax.portlet", name: "portlet-api", version: "3.0.0"
compileOnly group: "javax.servlet", name: "javax.servlet-api", version: "3.0.1"
compileOnly group: "javax.servlet.jsp", name: "javax.servlet.jsp-api", version: "2.3.1"
diff --git a/modules/apps/fragment/fragment-web/src/main/resources/META-INF/resources/view\_fragment\_entry\_usages.jsp b/modules/apps/fragment/fragment-web/src/main/resources/META-INF/resources/view\_fragment\_entry\_usages.jsp
index 937c5558da6850..a0a6f19ef44fb4 100644
--- a/modules/apps/fragment/fragment-web/src/main/resources/META-INF/resources/view\_fragment\_entry\_usages.jsp
+++ b/modules/apps/fragment/fragment-web/src/main/resources/META-INF/resources/view\_fragment\_entry\_usages.jsp
@@ -140,7 +140,7 @@ renderResponse.setTitle(LanguageUtil.format(request, "usages-and-propagation-x",
>

 getGroups(HttpServletRequest request) {
- if (\_groups != null) {
- return \_groups;
+ if (\_groups == null) {
+ \_search(request);
}
- ThemeDisplay themeDisplay = (ThemeDisplay)request.getAttribute(
- WebKeys.THEME\_DISPLAY);
-
- String keywords = ParamUtil.getString(request, "keywords");
-
- LinkedHashMap groupParams = new LinkedHashMap<>();
-
- groupParams.put("site", Boolean.TRUE);
-
- int cur = ParamUtil.getInteger(
- request, SearchContainer.DEFAULT\_CUR\_PARAM,
- SearchContainer.DEFAULT\_CUR);
- int delta = ParamUtil.getInteger(
- request, SearchContainer.DEFAULT\_DELTA\_PARAM,
- SearchContainer.DEFAULT\_DELTA);
-
- int[] startAndEnd = SearchPaginationUtil.calculateStartAndEnd(
- cur, delta);
-
- return GroupLocalServiceUtil.search(
- themeDisplay.getCompanyId(), \_CLASS\_NAME\_IDS, keywords, groupParams,
- startAndEnd[0], startAndEnd[1], null);
+ return \_groups;
}
protected int getGroupsCount(HttpServletRequest request) {
- if ((\_groups != null) || (\_groupsCount > 0)) {
- return \_groupsCount;
+ if (\_groupsCount < 0) {
+ \_search(request);
}
- ThemeDisplay themeDisplay = (ThemeDisplay)request.getAttribute(
- WebKeys.THEME\_DISPLAY);
-
- String keywords = ParamUtil.getString(request, "keywords");
-
- LinkedHashMap groupParams = new LinkedHashMap<>();
-
- groupParams.put("site", Boolean.TRUE);
-
- return GroupLocalServiceUtil.searchCount(
- themeDisplay.getCompanyId(), \_CLASS\_NAME\_IDS, keywords,
- groupParams);
+ return \_groupsCount;
}
@Override
@@ -127,13 +101,53 @@ protected void setAttributes(HttpServletRequest request) {
ItemSelectorUtil.getItemSelector());
}
+ private void \_search(HttpServletRequest request) {
+ try {
+ ThemeDisplay themeDisplay = (ThemeDisplay)request.getAttribute(
+ WebKeys.THEME\_DISPLAY);
+
+ String keywords = ParamUtil.getString(request, "keywords");
+
+ LinkedHashMap groupParams = new LinkedHashMap<>();
+
+ groupParams.put("site", Boolean.TRUE);
+
+ List groups = GroupServiceUtil.search(
+ themeDisplay.getCompanyId(), \_CLASS\_NAME\_IDS, keywords,
+ groupParams, QueryUtil.ALL\_POS, QueryUtil.ALL\_POS, null);
+
+ int cur = ParamUtil.getInteger(
+ request, SearchContainer.DEFAULT\_CUR\_PARAM,
+ SearchContainer.DEFAULT\_CUR);
+ int delta = ParamUtil.getInteger(
+ request, SearchContainer.DEFAULT\_DELTA\_PARAM,
+ SearchContainer.DEFAULT\_DELTA);
+
+ int[] startAndEnd = SearchPaginationUtil.calculateStartAndEnd(
+ cur, delta);
+
+ \_groups = ListUtil.subList(groups, startAndEnd[0], startAndEnd[1]);
+
+ \_groupsCount = groups.size();
+ }
+ catch (PortalException pe) {
+ \_log.error(pe, pe);
+
+ \_groups = Collections.emptyList();
+ \_groupsCount = 0;
+ }
+ }
+
private static final long[] \_CLASS\_NAME\_IDS = {
ClassNameLocalServiceUtil.getClassNameId(Company.class),
ClassNameLocalServiceUtil.getClassNameId(Group.class),
ClassNameLocalServiceUtil.getClassNameId(Organization.class)
};
+ private static final Log \_log = LogFactoryUtil.getLog(
+ GroupSelectorTag.class);
+
private List \_groups;
- private int \_groupsCount;
+ private int \_groupsCount = -1;
}
\ No newline at end of file
diff --git a/modules/apps/item-selector/item-selector-web/build.gradle b/modules/apps/item-selector/item-selector-web/build.gradle
index 4914416319c8c8..86f0e145a5debd 100644
--- a/modules/apps/item-selector/item-selector-web/build.gradle
+++ b/modules/apps/item-selector/item-selector-web/build.gradle
@@ -13,7 +13,7 @@ dependencies {
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "3.0.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "3.0.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.util.taglib", version: "3.0.0"
- compileOnly group: "commons-beanutils", name: "commons-beanutils", version: "1.9.3"
+ compileOnly group: "commons-beanutils", name: "commons-beanutils", version: "1.9.4"
compileOnly group: "javax.portlet", name: "portlet-api", version: "3.0.0"
compileOnly group: "javax.servlet", name: "javax.servlet-api", version: "3.0.1"
compileOnly group: "javax.servlet.jsp", name: "javax.servlet.jsp-api", version: "2.3.1"
diff --git a/modules/apps/journal/journal-taglib/src/main/resources/META-INF/resources/journal\_article/page.jsp b/modules/apps/journal/journal-taglib/src/main/resources/META-INF/resources/journal\_article/page.jsp
index c51c2e20bde4c6..399c360de4f13f 100644
--- a/modules/apps/journal/journal-taglib/src/main/resources/META-INF/resources/journal\_article/page.jsp
+++ b/modules/apps/journal/journal-taglib/src/main/resources/META-INF/resources/journal\_article/page.jsp
@@ -25,7 +25,7 @@ boolean showTitle = GetterUtil.getBoolean((String)request.getAttribute("liferay-
- <%= articleDisplay.getTitle() %>
+ <%= HtmlUtil.escape(articleDisplay.getTitle()) %>

<%= articleDisplay.getContent() %>
diff --git a/modules/apps/layout/layout-type-controller/layout-type-controller-asset-display/src/main/resources/META-INF/resources/init.jsp b/modules/apps/layout/layout-type-controller/layout-type-controller-asset-display/src/main/resources/META-INF/resources/init.jsp
index d2c6d406199b79..272a8307b54ad8 100644
--- a/modules/apps/layout/layout-type-controller/layout-type-controller-asset-display/src/main/resources/META-INF/resources/init.jsp
+++ b/modules/apps/layout/layout-type-controller/layout-type-controller-asset-display/src/main/resources/META-INF/resources/init.jsp
@@ -22,6 +22,7 @@ taglib uri="http://liferay.com/tld/ui" prefix="liferay-ui" %>
<%@ page import="com.liferay.asset.display.contributor.constants.AssetDisplayWebKeys" %><%@
page import="com.liferay.asset.kernel.model.AssetEntry" %><%@
+page import="com.liferay.asset.kernel.model.AssetRendererFactory" %><%@
page import="com.liferay.fragment.constants.FragmentEntryLinkConstants" %><%@
page import="com.liferay.fragment.model.FragmentEntryLink" %><%@
page import="com.liferay.fragment.util.FragmentEntryRenderUtil" %><%@
@@ -31,6 +32,7 @@ page import="com.liferay.petra.string.StringBundler" %><%@
page import="com.liferay.portal.kernel.layoutconfiguration.util.RuntimePageUtil" %><%@
page import="com.liferay.portal.kernel.model.LayoutTemplate" %><%@
page import="com.liferay.portal.kernel.model.LayoutTemplateConstants" %><%@
+page import="com.liferay.portal.kernel.security.permission.ActionKeys" %><%@
page import="com.liferay.portal.kernel.service.LayoutTemplateLocalServiceUtil" %><%@
page import="com.liferay.portal.kernel.template.StringTemplateResource" %><%@
page import="com.liferay.portal.kernel.util.ListUtil" %><%@
diff --git a/modules/apps/layout/layout-type-controller/layout-type-controller-asset-display/src/main/resources/META-INF/resources/layout/view/asset\_display.jsp b/modules/apps/layout/layout-type-controller/layout-type-controller-asset-display/src/main/resources/META-INF/resources/layout/view/asset\_display.jsp
index ec30884fee11dd..c77a65c85213e6 100644
--- a/modules/apps/layout/layout-type-controller/layout-type-controller-asset-display/src/main/resources/META-INF/resources/layout/view/asset\_display.jsp
+++ b/modules/apps/layout/layout-type-controller/layout-type-controller-asset-display/src/main/resources/META-INF/resources/layout/view/asset\_display.jsp
@@ -16,7 +16,24 @@
<%@ include file="/init.jsp" %>
+<%
+AssetRendererFactory assetRendererFactory = null;
+
+if (assetEntry != null) {
+ assetRendererFactory = assetEntry.getAssetRendererFactory();
+}
+%>
+
+
+
+
+
+
+
+
+
+
<%
diff --git a/modules/apps/login/login-web/src/main/java/com/liferay/login/web/internal/portlet/action/CreateAccountMVCActionCommand.java b/modules/apps/login/login-web/src/main/java/com/liferay/login/web/internal/portlet/action/CreateAccountMVCActionCommand.java
index 518798ea204b03..4fec708f200d2b 100644
--- a/modules/apps/login/login-web/src/main/java/com/liferay/login/web/internal/portlet/action/CreateAccountMVCActionCommand.java
+++ b/modules/apps/login/login-web/src/main/java/com/liferay/login/web/internal/portlet/action/CreateAccountMVCActionCommand.java
@@ -193,9 +193,6 @@ protected void addUser(
if (user.getStatus() == WorkflowConstants.STATUS\_APPROVED) {
SessionMessages.add(
request, "userAdded", user.getEmailAddress());
- SessionMessages.add(
- request, "userAddedPassword",
- user.getPasswordUnencrypted());
}
else {
SessionMessages.add(
@@ -530,8 +527,6 @@ protected void updateIncompleteUser(
if (user.getStatus() == WorkflowConstants.STATUS\_APPROVED) {
SessionMessages.add(request, "userAdded", user.getEmailAddress());
- SessionMessages.add(
- request, "userAddedPassword", user.getPasswordUnencrypted());
}
else {
SessionMessages.add(request, "userPending", user.getEmailAddress());
diff --git a/modules/apps/login/login-web/src/main/java/com/liferay/login/web/internal/portlet/action/ForgotPasswordMVCActionCommand.java b/modules/apps/login/login-web/src/main/java/com/liferay/login/web/internal/portlet/action/ForgotPasswordMVCActionCommand.java
index be518bbf5a7213..72799376c9e2c7 100644
--- a/modules/apps/login/login-web/src/main/java/com/liferay/login/web/internal/portlet/action/ForgotPasswordMVCActionCommand.java
+++ b/modules/apps/login/login-web/src/main/java/com/liferay/login/web/internal/portlet/action/ForgotPasswordMVCActionCommand.java
@@ -168,6 +168,12 @@ else if (e instanceof NoSuchUserException ||
e instanceof UserReminderQueryException) {
if (PropsValues.LOGIN\_SECURE\_FORGOT\_PASSWORD) {
+ HttpServletRequest httpServletRequest =
+ \_portal.getHttpServletRequest(actionRequest);
+
+ SessionMessages.add(
+ httpServletRequest, "forgotPasswordSent");
+
sendRedirect(actionRequest, actionResponse, null);
}
else {
@@ -297,7 +303,7 @@ protected void sendPassword(
HttpServletRequest request = \_portal.getHttpServletRequest(
actionRequest);
- SessionMessages.add(request, "passwordSent");
+ SessionMessages.add(request, "forgotPasswordSent");
sendRedirect(actionRequest, actionResponse, null);
}
diff --git a/modules/apps/login/login-web/src/main/resources/META-INF/resources/configuration.jsp b/modules/apps/login/login-web/src/main/resources/META-INF/resources/configuration.jsp
index fcf7e6b751a375..e69c489d1ea71d 100644
--- a/modules/apps/login/login-web/src/main/resources/META-INF/resources/configuration.jsp
+++ b/modules/apps/login/login-web/src/main/resources/META-INF/resources/configuration.jsp
@@ -68,7 +68,7 @@ String emailFromAddress = ParamUtil.getString(request, "preferences--emailFromAd
+
+
+
+
+
+

@@ -193,7 +199,7 @@ renderResponse.setTitle(LanguageUtil.get(request, "create-account"));

-
+
-
+
-
+

-

@@ -159,7 +158,7 @@ renderResponse.setTitle(LanguageUtil.get(request, "forgot-password"));

-
+

-
+
-
+

<%
String userEmailAddress = (String)SessionMessages.get(request, "userAdded");
- String userPassword = (String)SessionMessages.get(request, "userAddedPassword");
%>
-
-
-
-
-
-
-
-
-
-
-
-
+
+
+
+
+
-
+
+
+
+
+
+
+
+
+
+
+

diff --git a/modules/apps/login/login-web/src/main/resources/content/Language.properties b/modules/apps/login/login-web/src/main/resources/content/Language.properties
index bf4e72afd44b3f..6981314055a77a 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=An email has been sent to the provided email address.
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question.
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=Fast Sign In
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=Sign In
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=Thank you for creating an account.
thank-you-for-creating-an-account-your-password-was-sent-to-x=Thank you for creating an account. Your password was sent to {0}. Please check your inbox and spam folders.
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Thank you for creating an account. You will be notified via email at {0} when your account has been approved.
thank-you-for-creating-an-account.-your-password-is-x=Thank you for creating an account. Your password is **{0}**.
+use-your-password-to-login=Use your password to log in.
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account.
you-are-signed-in-as-x=You are signed in as {0}.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}.
your-email-verification-code-was-sent-to-x=Your email verification code was sent to {0}.
your-password-was-sent-to-x=Your password was sent to {0}.
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_ar.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_ar.properties
index 5d109c14c5224c..2e28c13ccc9294 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_ar.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_ar.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=         .
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=      {0}        .
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=  
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet= 
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=   .
thank-you-for-creating-an-account-your-password-was-sent-to-x=    .      {0}.           .
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=   .       {0}    .
thank-you-for-creating-an-account.-your-password-is-x=   .     **{0}**.
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=    {0}.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=          {0}.
your-password-was-sent-to-x=     {0}.
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_bg.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_bg.properties
index 848c32c3728afe..eb39f969d5f933 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_bg.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_bg.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=       . (Automatic Translation)
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question. (Automatic Copy)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=  (Automatic Translation)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=   
thank-you-for-creating-an-account-your-password-was-sent-to-x=Thank you for creating an account. Your password was sent to {0}. Please check your inbox and spam folders. (Automatic Copy)
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Thank you for creating an account. You will be notified via email at {0} when your account has been approved. (Automatic Copy)
thank-you-for-creating-an-account.-your-password-is-x=Thank you for creating an account. Your password is **{0}**. (Automatic Copy)
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=   {0}.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Your email verification code was sent to {0}. (Automatic Copy)
your-password-was-sent-to-x=Your password was sent to {0}. (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_ca.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_ca.properties
index da112831c9f7ed..b9041dc311247c 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_ca.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_ca.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=S'ha enviat un correu electrnic a l'adrea proporcionada.
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=S'enviar un correu electrnic a {0} si responeu correctament la pregunta segent.
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=Inici de sessi rpid
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=Inicia la sessi
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=Grcies per crear un compte.
thank-you-for-creating-an-account-your-password-was-sent-to-x=Grcies per crear un compte. La contrasenya s'ha enviat a {0}. Comproveu les safates d'entrada i de correu brossa.
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Grcies per crear un compte. S'enviar un correu electrnic a {0} quan el vostre compte hagi estat aprovat.
thank-you-for-creating-an-account.-your-password-is-x=Grcies per crear un compte. La vostra contrasenya s **{0}**.
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=Us heu validat com a {0}.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Us hem enviat el codi de verificaci de correu electrnic a {0}.
your-password-was-sent-to-x=La contrasenya s'ha enviat a {0}.
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_cs.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_cs.properties
index 531dd84c6520b1..65ec57d126cf5d 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_cs.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_cs.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=Zadan e-mailovou adresu byl odesln e-mail. (Automatic Translation)
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question. (Automatic Copy)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=Rychl pihlen
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=Pihlen
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=Dkujeme za vytvoen tu.
thank-you-for-creating-an-account-your-password-was-sent-to-x=Thank you for creating an account. Your password was sent to {0}. Please check your inbox and spam folders. (Automatic Copy)
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Dkujeme za vytvoen tu. Budete kontaktovni na e-mailu {0}, jakmile bude V et schvlen.
thank-you-for-creating-an-account.-your-password-is-x=Dkujeme za vytvoen tu. Vae heslo je **{0}**.
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=Nyn jste pihlen(a) jako {0}.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Your email verification code was sent to {0}. (Automatic Copy)
your-password-was-sent-to-x=Your password was sent to {0}. (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_da.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_da.properties
index dc3b393fbdb514..94d1d25feac47a 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_da.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_da.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=An email has been sent to the provided email address. (Automatic Copy)
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question. (Automatic Copy)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=Hurtig log p
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=Log ind
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=Thank you for creating an account. (Automatic
thank-you-for-creating-an-account-your-password-was-sent-to-x=Thank you for creating an account. Your password was sent to {0}. Please check your inbox and spam folders. (Automatic Copy)
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Thank you for creating an account. You will be notified via email at {0} when your account has been approved. (Automatic Copy)
thank-you-for-creating-an-account.-your-password-is-x=Thank you for creating an account. Din adgangskode is **{0}**.
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=Du er logget ind som {0}.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Your email verification code was sent to {0}. (Automatic Copy)
your-password-was-sent-to-x=Your password was sent to {0}. (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_de.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_de.properties
index ed8377441e5a80..f20f3b1ffa6492 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_de.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_de.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=Eine E-Mail wurde an die angegebene E-Mail-Adresse gesendet.
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=Eine E-Mail wird an {0} gesendet, wenn Sie die folgende Frage richtig beantworten knnen.
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=Schnelle Anmeldung
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=Anmeldung
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=Vielen Dank, dass Sie ein Konto erstellt haben
thank-you-for-creating-an-account-your-password-was-sent-to-x=Vielen Dank, dass Sie ein Konto erstellt haben. Ihr Kennwort wurde an {0} gesendet. Bitte prfen Sie Ihren Posteingang und Spam-Ordner.
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Vielen Dank, dass Sie ein Konto erstellt haben. Sie werden per E-Mail unter {0} benachrichtigt, wenn Ihr Konto genehmigt wurde.
thank-you-for-creating-an-account.-your-password-is-x=Vielen Dank, dass Sie ein Konto erstellt haben. Ihr Kennwort lautet **{0}**.
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=Sie sind angemeldet als {0}.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Ihr Besttigungscode wurde an {0} gesendet.
your-password-was-sent-to-x=Ihr Kennwort wurde an {0} gesendet.
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_el.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_el.properties
index 8000c2a8f0f0a9..9b5dccc1e1ca16 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_el.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_el.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address= email     email  . (Automatic Translation)
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question. (Automatic Copy)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet= 
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=  
thank-you-for-creating-an-account-your-password-was-sent-to-x=Thank you for creating an account. Your password was sent to {0}. Please check your inbox and spam folders. (Automatic Copy)
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=     site .    mail  {0}     .
thank-you-for-creating-an-account.-your-password-is-x=     site .      **{0}**.
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=     {0}.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Your email verification code was sent to {0}. (Automatic Copy)
your-password-was-sent-to-x=Your password was sent to {0}. (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_en.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_en.properties
index bf4e72afd44b3f..6981314055a77a 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_en.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_en.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=An email has been sent to the provided email address.
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question.
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=Fast Sign In
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=Sign In
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=Thank you for creating an account.
thank-you-for-creating-an-account-your-password-was-sent-to-x=Thank you for creating an account. Your password was sent to {0}. Please check your inbox and spam folders.
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Thank you for creating an account. You will be notified via email at {0} when your account has been approved.
thank-you-for-creating-an-account.-your-password-is-x=Thank you for creating an account. Your password is **{0}**.
+use-your-password-to-login=Use your password to log in.
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account.
you-are-signed-in-as-x=You are signed in as {0}.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}.
your-email-verification-code-was-sent-to-x=Your email verification code was sent to {0}.
your-password-was-sent-to-x=Your password was sent to {0}.
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_es.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_es.properties
index bd4a78a71373cb..4c9301ab2cd664 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_es.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_es.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=Se envi un correo electrnico a la direccin de correo electrnico especificada.
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=Se enviar un correo electrnico a {0} si puede responder correctamente a la pregunta siguiente.
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=Acceso rpido
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=Login
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=Gracias por crear una cuenta de usuario.
thank-you-for-creating-an-account-your-password-was-sent-to-x=Gracias por crear una cuenta. Su contrasea fue enviada a {0}. por favor chequee sus carpetas de entradas y spam.
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Gracias por crear una cuenta. Ser notificado por correo electrnico en {0} cuando su cuenta sea aprobada.
thank-you-for-creating-an-account.-your-password-is-x=Gracias por crear una cuenta. Tu contrasea es **{0}**.
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=Est conectado como {0}.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=El cdigo de verificacin de su correo electrnico fue enviado a {0}.
your-password-was-sent-to-x=Su contrasea fue enviada a {0}.
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_et.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_et.properties
index 33d6f34f55e5f9..c4237bee03aa1d 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_et.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_et.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=Sisestatud e-posti aadressile on saadetud e-posti. (Automatic Translation)
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question. (Automatic Copy)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=Kiire sisselogimine (Automatic Translation)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=Logi sisse
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=Tname luua konto. (Automatic Translation)
thank-you-for-creating-an-account-your-password-was-sent-to-x=Thank you for creating an account. Your password was sent to {0}. Please check your inbox and spam folders. (Automatic Copy)
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Thank you for creating an account. You will be notified via email at {0} when your account has been approved. (Automatic Copy)
thank-you-for-creating-an-account.-your-password-is-x=Thank you for creating an account. Your password is **{0}**. (Automatic Copy)
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=Oled sisse logitud kui {0}.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Your email verification code was sent to {0}. (Automatic Copy)
your-password-was-sent-to-x=Your password was sent to {0}. (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_eu.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_eu.properties
index 74a7018a0176ff..44d939b878d1cf 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_eu.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_eu.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=An email has been sent to the provided email address. (Automatic Copy)
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question. (Automatic Copy)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=Izen emate azkarra
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=Izena ematea
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=Mila esker kontua sortzeagatik.
thank-you-for-creating-an-account-your-password-was-sent-to-x=Thank you for creating an account. Your password was sent to {0}. Please check your inbox and spam folders. (Automatic Copy)
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Mila esker sure kontua sortzeagatik. Email bidez abisatuko zaizu {0} zure kontua onartzen denean.
thank-you-for-creating-an-account.-your-password-is-x=Mila esker kontua sortzeagatik. Zure pasahitza **{0}** da.
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x={0} gisa baimenduta zaude.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Your email verification code was sent to {0}. (Automatic Copy)
your-password-was-sent-to-x=Your password was sent to {0}. (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_fa.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_fa.properties
index ed374fcc5ab618..701393b91f5c93 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_fa.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_fa.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=         . (Automatic Translation)
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question. (Automatic Copy)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet= 
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=    
thank-you-for-creating-an-account-your-password-was-sent-to-x=Thank you for creating an account. Your password was sent to {0}. Please check your inbox and spam folders. (Automatic Copy)
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=      .        {0}     .
thank-you-for-creating-an-account.-your-password-is-x=       .    **{0}** .
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=   {0}    .
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Your email verification code was sent to {0}. (Automatic Copy)
your-password-was-sent-to-x=Your password was sent to {0}. (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_fi.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_fi.properties
index b71d032b927b88..dc05b38e20bf87 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_fi.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_fi.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=Shkposti on lhetetty annettuun shkpostiosoitteeseen.
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=Shkposti lhetetn osoitteeseen {0}, jos vastaat seuraavaan kysymykseen oikein.
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=Pikakirjautuminen
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=Kirjaudu sisn
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=Kiitos tilin luonnista.
thank-you-for-creating-an-account-your-password-was-sent-to-x=Kiitos tilin luomisesta. Salasanasi on lhetetty osoitteeseen {0}. Tarkista Saapuneet ja roskapostikansiosi.
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Kiitos tilin luonnista. Sinulle ilmoitetaan shkpostitse osoiteeseen {0}, kun tilisi on hyvksytty.
thank-you-for-creating-an-account.-your-password-is-x=Kiitos tilin luonnista. Salasanasi on **{0}**.
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=Olet kirjautunut sisn nimell {0}.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Shkpostin tarkastuskoodisi lhetettiin osoitteeseen {0}.
your-password-was-sent-to-x=Salasanasi on lhetetty osoitteeseen {0}.
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_fr.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_fr.properties
index dc2d030c9475fd..91f927f86c30ed 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_fr.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_fr.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=Un e-mail a t envoy  l'adresse fournie.
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=Un e-mail sera envoy  {0} si vous pouvez rpondre correctement  la question suivante.
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=Connexion rapide
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=Authentification
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=Merci d'avoir cr un compte.
thank-you-for-creating-an-account-your-password-was-sent-to-x=Merci d'avoir cr un compte. Votre mot de passe a t envoy  {0}. Veuillez vrifier votre bote de rception et votre dossier Spam.
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Merci d'avoir crer un compte. Vous serez notifi par e-mail  {0} lorsque votre compte sera approuv.
thank-you-for-creating-an-account.-your-password-is-x=Merci d'avoir cr un compte. Votre mot de passe est **{0}**.
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=Vous tes connect en tant que {0}.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Le code de vrification par e-mail a t envoy  {0}.
your-password-was-sent-to-x=Votre mot de passe a t envoy  {0}.
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_gl.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_gl.properties
index 1bac7dd1c43e46..ef9fb993505517 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_gl.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_gl.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=An email has been sent to the provided email address. (Automatic Copy)
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question. (Automatic Copy)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=Identificacin rpida
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=Rexistro
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=Grazas por crear unha conta.
thank-you-for-creating-an-account-your-password-was-sent-to-x=Thank you for creating an account. Your password was sent to {0}. Please check your inbox and spam folders. (Automatic Copy)
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Grazas por crear unha conta. Sers notificado por correo electrnico a {0} cando a ta conta sexa aprobada.
thank-you-for-creating-an-account.-your-password-is-x=Grazas por crear unha conta. A ta clave  **{0}**.
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=Ests identificado como {0}.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Your email verification code was sent to {0}. (Automatic Copy)
your-password-was-sent-to-x=Your password was sent to {0}. (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_hi\_IN.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_hi\_IN.properties
index a111ef8e2f0527..782a8eb8d02633 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_hi\_IN.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_hi\_IN.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=            (Automatic Translation)
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question. (Automatic Copy)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=      (Automatic Translation)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=  
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=   
thank-you-for-creating-an-account-your-password-was-sent-to-x=Thank you for creating an account. Your password was sent to {0}. Please check your inbox and spam folders. (Automatic Copy)
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Thank you for creating an account. You will be notified via email at {0} when your account has been approved. (Automatic Copy)
thank-you-for-creating-an-account.-your-password-is-x=Thank you for creating an account. Your password is **{0}**. (Automatic Copy)
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x= {0}       |
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Your email verification code was sent to {0}. (Automatic Copy)
your-password-was-sent-to-x=Your password was sent to {0}. (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_hr.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_hr.properties
index a6a4fe96d8702f..182dc48321db27 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_hr.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_hr.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=An email has been sent to the provided email address. (Automatic Copy)
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question. (Automatic Copy)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=Brza prijava
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=Prijava
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=Hvala vam to ste za stvaranje rauna.
thank-you-for-creating-an-account-your-password-was-sent-to-x=Thank you for creating an account. Your password was sent to {0}. Please check your inbox and spam folders. (Automatic Copy)
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Hvala vam to ste stvorili raun. Kada se raun odobri, biti ete obavijeteni putem e-maila na {0}.
thank-you-for-creating-an-account.-your-password-is-x=Hvala vam na stvaranju rauna. Vaa lozinka je **{0}**.
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=Upisali ste se kao {0}.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Your email verification code was sent to {0}. (Automatic Copy)
your-password-was-sent-to-x=Your password was sent to {0}. (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_hu.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_hu.properties
index a7a6a63978de69..d13452440e4a90 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_hu.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_hu.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=Egy e-mailt kldtnk a megadott e-mail cmre.
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=Egy e-mailt kldnk a {0} cmre, ha helyesen vlaszol a kvetkez krdsre.
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=Gyors bejelentkezs
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=Bejelentkezs
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=Ksznjk, hogy fikot hozott ltre.
thank-you-for-creating-an-account-your-password-was-sent-to-x=Ksznjk, hogy fikot hozott ltre. Jelszavt elkldtk a {0} cmre. Krjk, ellenrizze a bemen postjt s a levlszemetek mappjt.
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Ksznjk, hogy fikot hozott ltre. A fik jvhagysrl {0} e-mail cmre rtestst fogunk kldeni.
thank-you-for-creating-an-account.-your-password-is-x=Ksznjk, hogy fikot hozott ltre. A fikhoz tartoz jelsz: **{0}**.
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=n {0} nven jelentkezett be.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Az ellenrz kdot elkldtk e-mailben a {0} cmre.
your-password-was-sent-to-x=Jelszavt elkldtk a {0} cmre.
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_in.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_in.properties
index caaf046fa9af27..c15f4d921a6ee6 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_in.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_in.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=Email telah dikirim ke alamat email yang disediakan. (Automatic Translation)
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question. (Automatic Copy)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=Sign In Instan
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=Masuk
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=Terimakasih untuk membuat akun.
thank-you-for-creating-an-account-your-password-was-sent-to-x=Thank you for creating an account. Your password was sent to {0}. Please check your inbox and spam folders. (Automatic Copy)
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Terima kasih untuk membuat akun. Anda akan diberitahu melalui email di {0} ketika account Anda telah disetujui.
thank-you-for-creating-an-account.-your-password-is-x=Terima kasih untuk membuat akun. Kata sandi Anda **{0}**.
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=Anda masuk sebagai {0}.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Your email verification code was sent to {0}. (Automatic Copy)
your-password-was-sent-to-x=Your password was sent to {0}. (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_it.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_it.properties
index 2f475b74b4ad45..33e15b7a7398e7 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_it.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_it.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=Un'email  stata inviata all'indirizzo di posta elettronica fornito. (Automatic Translation)
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question. (Automatic Copy)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=Accesso veloce
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=Login
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=Grazie per aver creato un profilo.
thank-you-for-creating-an-account-your-password-was-sent-to-x=Grazie per aver creato un account. La password  stata inviata a {0}. Si prega di controllare le cartelle posta in arrivo e la posta indesiderata.
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Grazie per aver creato un account. Sarai notificato via email all'indirizzo {0} quando la tua richiesta verr approvata.
thank-you-for-creating-an-account.-your-password-is-x=Grazie per aver creato un account. La password  **{0}**.
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=Sei autenticato come {0}.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Il codice di verifica email  stato inviato a {0}.
your-password-was-sent-to-x=La password  stata inviata a {0}.
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_iw.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_iw.properties
index da758b51f9761f..c859844d0d0978 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_iw.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_iw.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=     " .
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question. (Automatic Copy)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet= 
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=   .
thank-you-for-creating-an-account-your-password-was-sent-to-x=   .    -{0}.       ,   .
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=   .     -{0}    .
thank-you-for-creating-an-account.-your-password-is-x=   .    **{0}**.
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=   {0}.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=  "    {0}.
your-password-was-sent-to-x=   -{0}.
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_ja.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_ja.properties
index a8d60ee45e2492..2eacbb88ee1938 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_ja.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_ja.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question= {0} 
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=
thank-you-for-creating-an-account-your-password-was-sent-to-x={0}  
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved= {0} 
thank-you-for-creating-an-account.-your-password-is-x=**{0}**
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x={0}
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x= {0} 
your-password-was-sent-to-x= {0} 
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_kk.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_kk.properties
new file mode 100644
index 00000000000000..083c625fe80877
--- /dev/null
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_kk.properties
@@ -0,0 +1,13 @@
+an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question. (Automatic Copy)
+javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=Fast Sign In (Automatic Copy)
+javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=Sign In (Automatic Copy)
+thank-you-for-creating-an-account=Thank you for creating an account. (Automatic Copy)
+thank-you-for-creating-an-account-your-password-was-sent-to-x=Thank you for creating an account. Your password was sent to {0}. Please check your inbox and spam folders. (Automatic Copy)
+thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Thank you for creating an account. You will be notified via email at {0} when your account has been approved. (Automatic Copy)
+thank-you-for-creating-an-account.-your-password-is-x=Thank you for creating an account. Your password is **{0}**. (Automatic Copy)
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
+you-are-signed-in-as-x=You are signed in as {0}. (Automatic Copy)
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
+your-email-verification-code-was-sent-to-x=Your email verification code was sent to {0}. (Automatic Copy)
+your-password-was-sent-to-x=Your password was sent to {0}. (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_ko.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_ko.properties
index 35ef8af4d9830f..3314c0a91d3245 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_ko.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_ko.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=     . (Automatic Translation)
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question. (Automatic Copy)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=  (Automatic Translation)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet= 
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=    . (
thank-you-for-creating-an-account-your-password-was-sent-to-x=Thank you for creating an account. Your password was sent to {0}. Please check your inbox and spam folders. (Automatic Copy)
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Thank you for creating an account. You will be notified via email at {0} when your account has been approved. (Automatic Copy)
thank-you-for-creating-an-account.-your-password-is-x=Thank you for creating an account. Your password is **{0}**. (Automatic Copy)
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=You are signed in as {0}. (Automatic Copy)
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Your email verification code was sent to {0}. (Automatic Copy)
your-password-was-sent-to-x=Your password was sent to {0}. (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_lo.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_lo.properties
index f06445dc3a0db8..c2d03cbc529b4f 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_lo.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_lo.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=An email has been sent to the provided email address. (Automatic Copy)
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question. (Automatic Copy)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=
thank-you-for-creating-an-account-your-password-was-sent-to-x=Thank you for creating an account. Your password was sent to {0}. Please check your inbox and spam folders. (Automatic Copy)
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=.  {0} 
thank-you-for-creating-an-account.-your-password-is-x=. **{0}**.
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x={0}.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Your email verification code was sent to {0}. (Automatic Copy)
your-password-was-sent-to-x=Your password was sent to {0}. (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_lt.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_lt.properties
index 74f5d2f71b6752..61428afc77d45e 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_lt.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_lt.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=Elektroniniu patu buvo isistas  nurodyt elektroninio pato adres. (Automatic Translation)
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question. (Automatic Copy)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=Greitai prisijungti (Automatic Translation)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=eiti  sistem
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=Ai, kad sukurti sskait. (Automatic Tra
thank-you-for-creating-an-account-your-password-was-sent-to-x=Thank you for creating an account. Your password was sent to {0}. Please check your inbox and spam folders. (Automatic Copy)
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Thank you for creating an account. You will be notified via email at {0} when your account has been approved. (Automatic Copy)
thank-you-for-creating-an-account.-your-password-is-x=Thank you for creating an account. Your password is **{0}**. (Automatic Copy)
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=You are signed in as {0}. (Automatic Copy)
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Your email verification code was sent to {0}. (Automatic Copy)
your-password-was-sent-to-x=Your password was sent to {0}. (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_nb.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_nb.properties
index d32725d0342782..cb300c454e897e 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_nb.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_nb.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=En e-post er sendt til den angitte e-postadressen. (Automatic Translation)
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question. (Automatic Copy)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=Hurtiginnlogging
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=Logg inn
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=Takk for at du opprettet en konto.
thank-you-for-creating-an-account-your-password-was-sent-to-x=Thank you for creating an account. Your password was sent to {0}. Please check your inbox and spam folders. (Automatic Copy)
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Takk for at du opprettet en konto. Du vil varsles p e-post {0} nr din konto er blitt godkjent.
thank-you-for-creating-an-account.-your-password-is-x=Takk for at du opprettet en konto. Ditt passord er **{0}**.
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=Du er innlogget som {0}.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Your email verification code was sent to {0}. (Automatic Copy)
your-password-was-sent-to-x=Your password was sent to {0}. (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_nl.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_nl.properties
index 16704bfdb4efd1..ebe8fd18a05cfd 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_nl.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_nl.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=Er werd zonet een e-mail verzonden naar het opgegeven e-mailadres.
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=Als u de volgende vraag juist beantwoordt, wordt er een e-mail verzonden naar {0}.
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=Snel aanmelden
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=Aanmelden
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=Dank voor het aanmaken van uw account.
thank-you-for-creating-an-account-your-password-was-sent-to-x=Dank u voor het aanmaken van een account. Uw wachtwoord is verzonden naar {0}. Controleer uw inbox en spammappen.
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Dank voor het aanmaken van uw account. U ontvangt een e-mail op {0} als uw account is goedgekeurd.
thank-you-for-creating-an-account.-your-password-is-x=Dank voor het aanmaken van uw account. Uw wachtwoord is **{0}**.
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=U bent ingelogd als {0}.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=De verificatiecode van uw e-mail is verzonden naar {0}.
your-password-was-sent-to-x=Uw wachtwoord is verzonden naar {0}.
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_nl\_BE.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_nl\_BE.properties
index e167e022837347..3acb9d134dee73 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_nl\_BE.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_nl\_BE.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=An email has been sent to the provided email address. (Automatic Copy)
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question. (Automatic Copy)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=Snel inloggen
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=Aanmelden
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=Bedankt voor het aanmaken van een account.
thank-you-for-creating-an-account-your-password-was-sent-to-x=Thank you for creating an account. Your password was sent to {0}. Please check your inbox and spam folders. (Automatic Copy)
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Bedankt voor je registratie! Je wordt op de hoogte gehouden via e-mail ({0}) als je account geactiveerd is.
thank-you-for-creating-an-account.-your-password-is-x=Bedankt voor het aanmaken van een account. Uw wachtwoord is **{0}**.
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=Aangemeld als {0}.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Your email verification code was sent to {0}. (Automatic Copy)
your-password-was-sent-to-x=Your password was sent to {0}. (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_pl.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_pl.properties
index d52fd64a2c7af4..d73d26e5dd950c 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_pl.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_pl.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=Wiadomo e-mail zostaa wysana na podany adres e-mail. (Automatic Translation)
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question. (Automatic Copy)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=Szybkie logowanie
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=Logowanie
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=Dzikujemy za zaoenie konta.
thank-you-for-creating-an-account-your-password-was-sent-to-x=Thank you for creating an account. Your password was sent to {0}. Please check your inbox and spam folders. (Automatic Copy)
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Dzikujemy za zaoenie konta. Otrzymasz powiadomienie na adres e-mail {0} gdy Twoje konto zostanie zatwierdzone.
thank-you-for-creating-an-account.-your-password-is-x=Dzikujemy za zaoenie konta. Twoje haso to **{0}**.
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=Jeste zalogowany jako {0}.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Your email verification code was sent to {0}. (Automatic Copy)
your-password-was-sent-to-x=Your password was sent to {0}. (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_pt\_BR.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_pt\_BR.properties
index f48571876dc016..c7543c0ab344bb 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_pt\_BR.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_pt\_BR.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=Um e-mail foi enviado para o endereo de e-mail fornecido.
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=Um e-mail ser enviado para {0} se voc responder corretamente  seguinte pergunta.
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=Acesso Rpido
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=Autenticao
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=Obrigado por criar uma conta.
thank-you-for-creating-an-account-your-password-was-sent-to-x=Obrigado por criar uma conta. Sua senha foi enviada para {0}. Por favor, verifique sua caixa de entrada e pasta de spam.
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Obrigado por criar uma conta. Voc ser notificado atravs do seu email {0} quando for aprovado.
thank-you-for-creating-an-account.-your-password-is-x=Obrigado por criar uma conta. Sua senha  **{0}**.
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=Voc entrou como {0}.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Seu cdigo de verificao por e-mail foi enviado para {0}.
your-password-was-sent-to-x=Sua senha foi enviada para {0}.
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_pt\_PT.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_pt\_PT.properties
index 3e7227670b3178..4fcec4ab838dab 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_pt\_PT.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_pt\_PT.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=An email has been sent to the provided email address. (Automatic Copy)
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question. (Automatic Copy)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=Acesso Rpido
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=Entrar
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=Obrigado por criar uma conta.
thank-you-for-creating-an-account-your-password-was-sent-to-x=Thank you for creating an account. Your password was sent to {0}. Please check your inbox and spam folders. (Automatic Copy)
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Obrigado por criar uma conta. Ser notificado atravs do seu email {0} quando for aprovado.
thank-you-for-creating-an-account.-your-password-is-x=Obrigado por criar uma conta. A sua senha  **{0}**.
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=Est logado como {0}.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Your email verification code was sent to {0}. (Automatic Copy)
your-password-was-sent-to-x=Your password was sent to {0}. (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_ro.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_ro.properties
index 18d623e5ec335a..d4ed28473a8de5 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_ro.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_ro.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=Un e-mail a fost trimis la adresa de e-mail furnizat. (Automatic Translation)
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question. (Automatic Copy)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=Autentificare rapid
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=Autentificare
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=V mulumesc pentru a crea un cont. (Automat
thank-you-for-creating-an-account-your-password-was-sent-to-x=Thank you for creating an account. Your password was sent to {0}. Please check your inbox and spam folders. (Automatic Copy)
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Thank you for creating an account. You will be notified via email at {0} when your account has been approved. (Automatic Copy)
thank-you-for-creating-an-account.-your-password-is-x=Thank you for creating an account. Your password is **{0}**. (Automatic Copy)
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=Esti autentificat ca {0}.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Your email verification code was sent to {0}. (Automatic Copy)
your-password-was-sent-to-x=Your password was sent to {0}. (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_ru.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_ru.properties
index c9b7664fddc1d8..7695d955e53dd2 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_ru.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_ru.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=      . (Automatic Translation)
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question. (Automatic Copy)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet= 
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=  
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=   
thank-you-for-creating-an-account-your-password-was-sent-to-x=Thank you for creating an account. Your password was sent to {0}. Please check your inbox and spam folders. (Automatic Copy)
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=    .      ,    email.
thank-you-for-creating-an-account.-your-password-is-x=    .   **{0}**.
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=   {0}.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Your email verification code was sent to {0}. (Automatic Copy)
your-password-was-sent-to-x=Your password was sent to {0}. (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_sk.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_sk.properties
index 2883896881b2b4..07ba1ae909250b 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_sk.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_sk.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=Uveden e-mailov adresu bol odoslan email. (Automatic Translation)
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question. (Automatic Copy)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=Rchle prihlsenie
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=Prihlsenie
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=akujeme za vytvorenie tu.
thank-you-for-creating-an-account-your-password-was-sent-to-x=Thank you for creating an account. Your password was sent to {0}. Please check your inbox and spam folders. (Automatic Copy)
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=akujeme za vytvorenie tu. Hne ako bude v et schvlen, poleme vm e-mail na adresu {0}.
thank-you-for-creating-an-account.-your-password-is-x=akujeme za vytvorenie tu. Vae heslo je **{0}**.
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=Ste prihlsen ako {0}.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Your email verification code was sent to {0}. (Automatic Copy)
your-password-was-sent-to-x=Your password was sent to {0}. (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_sl.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_sl.properties
index d810c5c84d4869..63be354fe0e487 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_sl.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_sl.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=Email je bil poslan na navedeni e-potni naslov. (Automatic Translation)
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question. (Automatic Copy)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=Hitra prijava (Automatic Translation)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=Registracija
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=Zahvaljujemo se vam za ustvarjanje rauna. (A
thank-you-for-creating-an-account-your-password-was-sent-to-x=Thank you for creating an account. Your password was sent to {0}. Please check your inbox and spam folders. (Automatic Copy)
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Thank you for creating an account. You will be notified via email at {0} when your account has been approved. (Automatic Copy)
thank-you-for-creating-an-account.-your-password-is-x=Thank you for creating an account. Your password is **{0}**. (Automatic Copy)
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=Vpisani ste kot {0}.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Your email verification code was sent to {0}. (Automatic Copy)
your-password-was-sent-to-x=Your password was sent to {0}. (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_sr\_RS.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_sr\_RS.properties
index 207393c5c6d7c6..540323b0473f29 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_sr\_RS.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_sr\_RS.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=An email has been sent to the provided email address. (Automatic Copy)
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question. (Automatic Copy)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet= 
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet= 
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=    
thank-you-for-creating-an-account-your-password-was-sent-to-x=Thank you for creating an account. Your password was sent to {0}. Please check your inbox and spam folders. (Automatic Copy)
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=    .    -  {0},     .
thank-you-for-creating-an-account.-your-password-is-x=    .    **{0}**.
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=   {0}.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Your email verification code was sent to {0}. (Automatic Copy)
your-password-was-sent-to-x=Your password was sent to {0}. (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_sr\_RS\_latin.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_sr\_RS\_latin.properties
index 42ce23bd54791b..e4b1fcaddea198 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_sr\_RS\_latin.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_sr\_RS\_latin.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=An email has been sent to the provided email address. (Automatic Copy)
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question. (Automatic Copy)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=Brzo Prijavljivanje
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=Prijavite se
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=Hvala vam za kreiranje naloga.
thank-you-for-creating-an-account-your-password-was-sent-to-x=Thank you for creating an account. Your password was sent to {0}. Please check your inbox and spam folders. (Automatic Copy)
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Hvala vam za kreiranje naloga. Biete obaveteni putem e-mejla na {0}, kada je va nalog odobren.
thank-you-for-creating-an-account.-your-password-is-x=Hvala vam za kreiranje naloga. Vaa lozinka je **{0}**.
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=Prijavljeni ste kao {0}.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Your email verification code was sent to {0}. (Automatic Copy)
your-password-was-sent-to-x=Your password was sent to {0}. (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_sv.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_sv.properties
index bc6c2f9acd1005..2b150fd1ed73bb 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_sv.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_sv.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=Ett e-postmeddelande har skickats till den angivna e-postadressen.
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=Ett e-postmeddelande kommer att skickas till {0} om fljande frga kan besvaras korrekt.
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=Snabbinloggning
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=Logga in
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=Tack fr att du har skapat ett konto.
thank-you-for-creating-an-account-your-password-was-sent-to-x=Tack fr att du skapade ett konto. Ditt lsenord har skickats till {0}. Kolla i din inkorg och skrppost.
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Tack fr att du skapade ett konto. Du kommer att f en avisering via e-post {0} nr ditt konto har godknts.
thank-you-for-creating-an-account.-your-password-is-x=Tack fr att du skapade ett konto. Ditt lsenord r **{0}**.
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=Du r inloggad som {0}.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Din e-postverifieringskod har skickats till {0}.
your-password-was-sent-to-x=Ditt lsenord har skickats till {0}.
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_ta\_IN.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_ta\_IN.properties
new file mode 100644
index 00000000000000..99f987a6a109fc
--- /dev/null
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_ta\_IN.properties
@@ -0,0 +1,12 @@
+an-email-has-been-sent-to-the-provided-email-address=An email has been sent to the provided email address. (Automatic Copy)
+an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question. (Automatic Copy)
+javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=Fast Sign In (Automatic Copy)
+javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=Sign In (Automatic Copy)
+thank-you-for-creating-an-account=Thank you for creating an account. (Automatic Copy)
+thank-you-for-creating-an-account-your-password-was-sent-to-x=Thank you for creating an account. Your password was sent to {0}. Please check your inbox and spam folders. (Automatic Copy)
+thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Thank you for creating an account. You will be notified via email at {0} when your account has been approved. (Automatic Copy)
+thank-you-for-creating-an-account.-your-password-is-x=Thank you for creating an account. Your password is **{0}**. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
+you-are-signed-in-as-x=You are signed in as {0}. (Automatic Copy)
+your-email-verification-code-was-sent-to-x=Your email verification code was sent to {0}. (Automatic Copy)
+your-password-was-sent-to-x=Your password was sent to {0}. (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_th.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_th.properties
index 74cc2496060f42..cd49c4f6bdf92e 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_th.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_th.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address= (Automatic Translation)
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question. (Automatic Copy)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet= (Automatic Translation)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet= (Automatic Translation)
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=
thank-you-for-creating-an-account-your-password-was-sent-to-x=Thank you for creating an account. Your password was sent to {0}. Please check your inbox and spam folders. (Automatic Copy)
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Thank you for creating an account. You will be notified via email at {0} when your account has been approved. (Automatic Copy)
thank-you-for-creating-an-account.-your-password-is-x=Thank you for creating an account. Your password is **{0}**. (Automatic Copy)
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=You are signed in as {0}. (Automatic Copy)
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Your email verification code was sent to {0}. (Automatic Copy)
your-password-was-sent-to-x=Your password was sent to {0}. (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_tr.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_tr.properties
index 3c01acd1276ba4..e49db1ab33b260 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_tr.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_tr.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=Bir e-posta salanan e-posta adresine gnderildi. (Automatic Translation)
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question. (Automatic Copy)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=Hzl oturum ama (Automatic Translation)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=Oturum A
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=Bir hesap oluturmak iin teekkr ederiz.
thank-you-for-creating-an-account-your-password-was-sent-to-x=Thank you for creating an account. Your password was sent to {0}. Please check your inbox and spam folders. (Automatic Copy)
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Thank you for creating an account. You will be notified via email at {0} when your account has been approved. (Automatic Copy)
thank-you-for-creating-an-account.-your-password-is-x=Thank you for creating an account. Your password is **{0}**. (Automatic Copy)
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x={0} olarak giri yaptnz.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Your email verification code was sent to {0}. (Automatic Copy)
your-password-was-sent-to-x=Your password was sent to {0}. (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_uk.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_uk.properties
index 0d69e45f8d2eaa..7ece1cc6b0e668 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_uk.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_uk.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=       . (Automatic Translation)
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question. (Automatic Copy)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=  (Automatic Translation)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=  
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=   
thank-you-for-creating-an-account-your-password-was-sent-to-x=Thank you for creating an account. Your password was sent to {0}. Please check your inbox and spam folders. (Automatic Copy)
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Thank you for creating an account. You will be notified via email at {0} when your account has been approved. (Automatic Copy)
thank-you-for-creating-an-account.-your-password-is-x=Thank you for creating an account. Your password is **{0}**. (Automatic Copy)
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=   {0}.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Your email verification code was sent to {0}. (Automatic Copy)
your-password-was-sent-to-x=Your password was sent to {0}. (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_vi.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_vi.properties
index 166027e15ff80c..394790d3c8c69f 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_vi.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_vi.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=Email  c gi n a ch email c cung cp. (Automatic Translation)
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question. (Automatic Copy)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=ng nhp nhanh
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=ng nhp
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=Cm n bn  ng k to ti kho
thank-you-for-creating-an-account-your-password-was-sent-to-x=Thank you for creating an account. Your password was sent to {0}. Please check your inbox and spam folders. (Automatic Copy)
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved=Cm n bn  ng k to ti khon. Bn s c bo thng qua th in t {0} khi no ti khon ca bn c chp nhn.
thank-you-for-creating-an-account.-your-password-is-x=Cm n bn  ng k to ti khon. Mt khu ca bn l **{0}**.
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x=Bn ang truy cp vi ti khon {0}.
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Your email verification code was sent to {0}. (Automatic Copy)
your-password-was-sent-to-x=Your password was sent to {0}. (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_zh\_CN.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_zh\_CN.properties
index 86d9fc13f51843..1d0c42ffbc082b 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_zh\_CN.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_zh\_CN.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address=
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question= {0}
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=
thank-you-for-creating-an-account-your-password-was-sent-to-x={0}
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved={0}
thank-you-for-creating-an-account.-your-password-is-x=**{0}**
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x={0}
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x={0}
your-password-was-sent-to-x= {0}
\ No newline at end of file
diff --git a/modules/apps/login/login-web/src/main/resources/content/Language\_zh\_TW.properties b/modules/apps/login/login-web/src/main/resources/content/Language\_zh\_TW.properties
index a4706082a07cab..237a9dde203475 100644
--- a/modules/apps/login/login-web/src/main/resources/content/Language\_zh\_TW.properties
+++ b/modules/apps/login/login-web/src/main/resources/content/Language\_zh\_TW.properties
@@ -1,4 +1,3 @@
-an-email-has-been-sent-to-the-provided-email-address= (Automatic Translation)
an-email-will-be-sent-to-x-if-you-can-correctly-answer-the-following-question=An email will be sent to {0} if you can correctly answer the following question. (Automatic Copy)
javax.portlet.title.com\_liferay\_login\_web\_portlet\_FastLoginPortlet=
javax.portlet.title.com\_liferay\_login\_web\_portlet\_LoginPortlet=
@@ -6,6 +5,9 @@ thank-you-for-creating-an-account=
thank-you-for-creating-an-account-your-password-was-sent-to-x=Thank you for creating an account. Your password was sent to {0}. Please check your inbox and spam folders. (Automatic Copy)
thank-you-for-creating-an-account.-you-will-be-notified-via-email-at-x-when-your-account-has-been-approved={0}
thank-you-for-creating-an-account.-your-password-is-x=**{0}**
+use-your-password-to-login=Use your password to log in. (Automatic Copy)
+you-are-about-to-create-an-account-with-openid-x=You are about to create an account with OpenId {0}. Do not proceed unless this is your account. (Automatic Copy)
you-are-signed-in-as-x= {0} 
+you-can-set-your-password-following-instructions-sent-to-x=You can set your password by following the instructions sent to {0}. (Automatic Copy)
your-email-verification-code-was-sent-to-x=Your email verification code was sent to {0}. (Automatic Copy)
your-password-was-sent-to-x=Your password was sent to {0}. (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/map/map-openstreetmap/src/main/resources/META-INF/resources/init.jsp b/modules/apps/map/map-openstreetmap/src/main/resources/META-INF/resources/init.jsp
index ef4486912f6644..fea877806c5ad4 100644
--- a/modules/apps/map/map-openstreetmap/src/main/resources/META-INF/resources/init.jsp
+++ b/modules/apps/map/map-openstreetmap/src/main/resources/META-INF/resources/init.jsp
@@ -25,7 +25,6 @@ taglib uri="http://liferay.com/tld/util" prefix="liferay-util" %>
<%@ page import="com.liferay.portal.kernel.servlet.BrowserSnifferUtil" %><%@
page import="com.liferay.portal.kernel.util.GetterUtil" %><%@
page import="com.liferay.portal.kernel.util.HtmlUtil" %><%@
-page import="com.liferay.portal.kernel.util.HttpUtil" %><%@
page import="com.liferay.portal.kernel.util.Validator" %><%@
page import="com.liferay.taglib.aui.AUIUtil" %>
diff --git a/modules/apps/map/map-openstreetmap/src/main/resources/META-INF/resources/view.jsp b/modules/apps/map/map-openstreetmap/src/main/resources/META-INF/resources/view.jsp
index abce585a24fd48..bbb08bf7a2087d 100644
--- a/modules/apps/map/map-openstreetmap/src/main/resources/META-INF/resources/view.jsp
+++ b/modules/apps/map/map-openstreetmap/src/main/resources/META-INF/resources/view.jsp
@@ -19,8 +19,6 @@
<%
String namespace = AUIUtil.getNamespace(liferayPortletRequest, liferayPortletResponse);
-String protocol = HttpUtil.getProtocol(request);
-
String bootstrapRequire = (String)request.getAttribute("liferay-map:map:bootstrapRequire");
boolean geolocation = GetterUtil.getBoolean(request.getAttribute("liferay-map:map:geolocation"));
double latitude = (Double)request.getAttribute("liferay-map:map:latitude");
@@ -34,9 +32,9 @@ name = namespace + name;
-
+
-
+

diff --git a/modules/apps/message-boards/message-boards-web/src/main/java/com/liferay/message/boards/web/internal/asset/MBMessageAssetRenderer.java b/modules/apps/message-boards/message-boards-web/src/main/java/com/liferay/message/boards/web/internal/asset/MBMessageAssetRenderer.java
index 0dbc92caa6cb34..c7f6b3c43fef44 100644
--- a/modules/apps/message-boards/message-boards-web/src/main/java/com/liferay/message/boards/web/internal/asset/MBMessageAssetRenderer.java
+++ b/modules/apps/message-boards/message-boards-web/src/main/java/com/liferay/message/boards/web/internal/asset/MBMessageAssetRenderer.java
@@ -20,6 +20,7 @@
import com.liferay.message.boards.model.MBMessage;
import com.liferay.message.boards.service.permission.MBDiscussionPermission;
import com.liferay.portal.kernel.exception.PortalException;
+import com.liferay.portal.kernel.language.LanguageUtil;
import com.liferay.portal.kernel.model.Group;
import com.liferay.portal.kernel.parsers.bbcode.BBCodeTranslatorUtil;
import com.liferay.portal.kernel.portlet.LiferayPortletRequest;
@@ -31,6 +32,7 @@
import com.liferay.portal.kernel.theme.ThemeDisplay;
import com.liferay.portal.kernel.trash.TrashRenderer;
import com.liferay.portal.kernel.util.HtmlUtil;
+import com.liferay.portal.kernel.util.LocaleThreadLocal;
import com.liferay.portal.kernel.util.PortalUtil;
import com.liferay.portal.kernel.util.WebKeys;
@@ -204,11 +206,20 @@ public String getURLViewInContext(
@Override
public long getUserId() {
+ if (\_message.isAnonymous()) {
+ return 0;
+ }
+
return \_message.getUserId();
}
@Override
public String getUserName() {
+ if (\_message.isAnonymous()) {
+ return LanguageUtil.get(
+ LocaleThreadLocal.getDefaultLocale(), "anonymous");
+ }
+
return \_message.getUserName();
}
diff --git a/modules/apps/network-utilities/network-utilities-web/build.gradle b/modules/apps/network-utilities/network-utilities-web/build.gradle
index db84e3e826197b..d1c8fdf81edc47 100644
--- a/modules/apps/network-utilities/network-utilities-web/build.gradle
+++ b/modules/apps/network-utilities/network-utilities-web/build.gradle
@@ -4,7 +4,7 @@ dependencies {
compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "2.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.upgrade.api", version: "2.0.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "3.0.0"
- compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "3.0.0"
+ compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "default"
compileOnly group: "com.liferay.portal", name: "com.liferay.util.taglib", version: "3.0.0"
compileOnly group: "javax.portlet", name: "portlet-api", version: "3.0.0"
compileOnly group: "javax.servlet", name: "javax.servlet-api", version: "3.0.1"
diff --git a/modules/apps/network-utilities/network-utilities-web/src/main/java/com/liferay/network/utilities/web/internal/util/DNSLookupWebCacheItem.java b/modules/apps/network-utilities/network-utilities-web/src/main/java/com/liferay/network/utilities/web/internal/util/DNSLookupWebCacheItem.java
index 0c529d25b4b3a7..79a96f0e7859bc 100644
--- a/modules/apps/network-utilities/network-utilities-web/src/main/java/com/liferay/network/utilities/web/internal/util/DNSLookupWebCacheItem.java
+++ b/modules/apps/network-utilities/network-utilities-web/src/main/java/com/liferay/network/utilities/web/internal/util/DNSLookupWebCacheItem.java
@@ -17,6 +17,7 @@
import com.liferay.network.utilities.web.internal.model.DNSLookup;
import com.liferay.petra.string.StringBundler;
import com.liferay.petra.string.StringPool;
+import com.liferay.portal.kernel.util.InetAddressUtil;
import com.liferay.portal.kernel.util.Time;
import com.liferay.portal.kernel.webcache.WebCacheException;
import com.liferay.portal.kernel.webcache.WebCacheItem;
@@ -45,7 +46,8 @@ public Object convert(String key) throws WebCacheException {
for (char c : array) {
if ((c != '.') && !Character.isDigit(c)) {
- InetAddress inetAddress = InetAddress.getByName(\_domain);
+ InetAddress inetAddress =
+ InetAddressUtil.getInetAddressByName(\_domain);
results = inetAddress.getHostAddress();
diff --git a/modules/apps/notifications/notifications-web/src/main/java/com/liferay/notifications/web/internal/portlet/NotificationsPortlet.java b/modules/apps/notifications/notifications-web/src/main/java/com/liferay/notifications/web/internal/portlet/NotificationsPortlet.java
index 885850f25e305d..88ad2288842ec2 100644
--- a/modules/apps/notifications/notifications-web/src/main/java/com/liferay/notifications/web/internal/portlet/NotificationsPortlet.java
+++ b/modules/apps/notifications/notifications-web/src/main/java/com/liferay/notifications/web/internal/portlet/NotificationsPortlet.java
@@ -15,11 +15,14 @@
package com.liferay.notifications.web.internal.portlet;
import com.liferay.notifications.web.internal.constants.NotificationsPortletKeys;
+import com.liferay.portal.kernel.exception.PortalException;
import com.liferay.portal.kernel.language.LanguageUtil;
import com.liferay.portal.kernel.model.Release;
+import com.liferay.portal.kernel.model.UserNotificationDelivery;
import com.liferay.portal.kernel.model.UserNotificationDeliveryConstants;
import com.liferay.portal.kernel.model.UserNotificationEvent;
import com.liferay.portal.kernel.portlet.bridges.mvc.MVCPortlet;
+import com.liferay.portal.kernel.security.auth.PrincipalException;
import com.liferay.portal.kernel.service.UserNotificationDeliveryLocalService;
import com.liferay.portal.kernel.service.UserNotificationEventLocalService;
import com.liferay.portal.kernel.servlet.SessionMessages;
@@ -28,6 +31,7 @@
import com.liferay.portal.kernel.util.ResourceBundleLoader;
import com.liferay.portal.kernel.util.Validator;
import com.liferay.portal.kernel.util.WebKeys;
+import com.liferay.subscription.model.Subscription;
import com.liferay.subscription.service.SubscriptionLocalService;
import java.io.IOException;
@@ -70,11 +74,15 @@ public void deleteNotifications(
ActionRequest actionRequest, ActionResponse actionResponse)
throws Exception {
+ ThemeDisplay themeDisplay = (ThemeDisplay)actionRequest.getAttribute(
+ WebKeys.THEME\_DISPLAY);
+
long[] userNotificationEventIds = ParamUtil.getLongValues(
actionRequest, "rowIds");
for (long userNotificationEventId : userNotificationEventIds) {
- \_deleteUserNotificationEvent(userNotificationEventId);
+ \_deleteUserNotificationEvent(
+ themeDisplay.getUserId(), userNotificationEventId);
}
\_addSuccessMessage(
@@ -87,10 +95,14 @@ public void deleteUserNotificationEvent(
ActionRequest actionRequest, ActionResponse actionResponse)
throws Exception {
+ ThemeDisplay themeDisplay = (ThemeDisplay)actionRequest.getAttribute(
+ WebKeys.THEME\_DISPLAY);
+
long userNotificationEventId = ParamUtil.getLong(
actionRequest, "userNotificationEventId");
- \_deleteUserNotificationEvent(userNotificationEventId);
+ \_deleteUserNotificationEvent(
+ themeDisplay.getUserId(), userNotificationEventId);
\_addSuccessMessage(
actionRequest, "notification-was-deleted-successfully");
@@ -123,10 +135,13 @@ public void markNotificationAsRead(
ActionRequest actionRequest, ActionResponse actionResponse)
throws Exception {
+ ThemeDisplay themeDisplay = (ThemeDisplay)actionRequest.getAttribute(
+ WebKeys.THEME\_DISPLAY);
+
long userNotificationEventId = ParamUtil.getLong(
actionRequest, "userNotificationEventId");
- updateArchived(userNotificationEventId, true);
+ updateArchived(themeDisplay.getUserId(), userNotificationEventId, true);
\_addSuccessMessage(
actionRequest, "notification-was-marked-as-read-successfully");
@@ -138,10 +153,14 @@ public void markNotificationAsUnread(
ActionRequest actionRequest, ActionResponse actionResponse)
throws Exception {
+ ThemeDisplay themeDisplay = (ThemeDisplay)actionRequest.getAttribute(
+ WebKeys.THEME\_DISPLAY);
+
long userNotificationEventId = ParamUtil.getLong(
actionRequest, "userNotificationEventId");
- updateArchived(userNotificationEventId, false);
+ updateArchived(
+ themeDisplay.getUserId(), userNotificationEventId, false);
\_addSuccessMessage(
actionRequest, "notification-was-marked-as-unread-successfully");
@@ -153,11 +172,15 @@ public void markNotificationsAsRead(
ActionRequest actionRequest, ActionResponse actionResponse)
throws Exception {
+ ThemeDisplay themeDisplay = (ThemeDisplay)actionRequest.getAttribute(
+ WebKeys.THEME\_DISPLAY);
+
long[] userNotificationEventIds = ParamUtil.getLongValues(
actionRequest, "rowIds");
for (long userNotificationEventId : userNotificationEventIds) {
- updateArchived(userNotificationEventId, true);
+ updateArchived(
+ themeDisplay.getUserId(), userNotificationEventId, true);
}
\_addSuccessMessage(
@@ -170,11 +193,15 @@ public void markNotificationsAsUnread(
ActionRequest actionRequest, ActionResponse actionResponse)
throws Exception {
+ ThemeDisplay themeDisplay = (ThemeDisplay)actionRequest.getAttribute(
+ WebKeys.THEME\_DISPLAY);
+
long[] userNotificationEventIds = ParamUtil.getLongValues(
actionRequest, "rowIds");
for (long userNotificationEventId : userNotificationEventIds) {
- updateArchived(userNotificationEventId, false);
+ updateArchived(
+ themeDisplay.getUserId(), userNotificationEventId, false);
}
\_addSuccessMessage(
@@ -236,12 +263,15 @@ public void unsubscribe(
ActionRequest actionRequest, ActionResponse actionResponse)
throws Exception {
+ ThemeDisplay themeDisplay = (ThemeDisplay)actionRequest.getAttribute(
+ WebKeys.THEME\_DISPLAY);
+
long subscriptionId = ParamUtil.getLong(
actionRequest, "subscriptionId");
long userNotificationEventId = ParamUtil.getLong(
actionRequest, "userNotificationEventId");
- \_subscriptionLocalService.deleteSubscription(subscriptionId);
+ \_deleteSubscription(themeDisplay.getUserId(), subscriptionId);
UserNotificationEvent userNotificationEvent =
\_userNotificationEventLocalService.fetchUserNotificationEvent(
@@ -249,7 +279,8 @@ public void unsubscribe(
if (userNotificationEvent != null) {
if (!userNotificationEvent.isArchived()) {
- updateArchived(userNotificationEventId, true);
+ updateArchived(
+ themeDisplay.getUserId(), userNotificationEventId, true);
}
}
@@ -262,6 +293,9 @@ public void updateUserNotificationDelivery(
ActionRequest actionRequest, ActionResponse actionResponse)
throws Exception {
+ ThemeDisplay themeDisplay = (ThemeDisplay)actionRequest.getAttribute(
+ WebKeys.THEME\_DISPLAY);
+
long[] userNotificationDeliveryIds = ParamUtil.getLongValues(
actionRequest, "userNotificationDeliveryIds");
@@ -269,9 +303,8 @@ public void updateUserNotificationDelivery(
boolean deliver = ParamUtil.getBoolean(
actionRequest, String.valueOf(userNotificationDeliveryId));
- \_userNotificationDeliveryLocalService.
- updateUserNotificationDelivery(
- userNotificationDeliveryId, deliver);
+ \_updateUserNotificationDelivery(
+ themeDisplay.getUserId(), userNotificationDeliveryId, deliver);
}
\_addSuccessMessage(
@@ -288,7 +321,8 @@ protected void setRelease(Release release) {
}
protected void updateArchived(
- long userNotificationEventId, boolean archived) {
+ long userId, long userNotificationEventId, boolean archived)
+ throws PortalException {
UserNotificationEvent userNotificationEvent =
\_userNotificationEventLocalService.fetchUserNotificationEvent(
@@ -298,6 +332,10 @@ protected void updateArchived(
return;
}
+ if (userNotificationEvent.getUserId() != userId) {
+ throw new PrincipalException();
+ }
+
userNotificationEvent.setArchived(archived);
\_userNotificationEventLocalService.updateUserNotificationEvent(
@@ -318,15 +356,41 @@ private void \_addSuccessMessage(
LanguageUtil.get(resourceBundle, message));
}
- private void \_deleteUserNotificationEvent(long userNotificationEventId) {
+ private void \_deleteSubscription(long userId, long subscriptionId)
+ throws PortalException {
+
+ Subscription subscription = \_subscriptionLocalService.fetchSubscription(
+ subscriptionId);
+
+ if (subscription == null) {
+ return;
+ }
+
+ if (subscription.getUserId() != userId) {
+ throw new PrincipalException();
+ }
+
+ \_subscriptionLocalService.deleteSubscription(subscriptionId);
+ }
+
+ private void \_deleteUserNotificationEvent(
+ long userId, long userNotificationEventId)
+ throws PortalException {
+
UserNotificationEvent userNotificationEvent =
\_userNotificationEventLocalService.fetchUserNotificationEvent(
userNotificationEventId);
- if (userNotificationEvent != null) {
- \_userNotificationEventLocalService.deleteUserNotificationEvent(
- userNotificationEvent);
+ if (userNotificationEvent == null) {
+ return;
}
+
+ if (userNotificationEvent.getUserId() != userId) {
+ throw new PrincipalException();
+ }
+
+ \_userNotificationEventLocalService.deleteUserNotificationEvent(
+ userNotificationEvent);
}
private void \_sendRedirect(
@@ -340,6 +404,26 @@ private void \_sendRedirect(
}
}
+ private void \_updateUserNotificationDelivery(
+ long userId, long userNotificationDeliveryId, boolean deliver)
+ throws PortalException {
+
+ UserNotificationDelivery userNotificationDelivery =
+ \_userNotificationDeliveryLocalService.fetchUserNotificationDelivery(
+ userNotificationDeliveryId);
+
+ if (userNotificationDelivery == null) {
+ return;
+ }
+
+ if (userNotificationDelivery.getUserId() != userId) {
+ throw new PrincipalException();
+ }
+
+ \_userNotificationDeliveryLocalService.updateUserNotificationDelivery(
+ userNotificationDeliveryId, deliver);
+ }
+
@Reference(target = "(bundle.symbolic.name=com.liferay.notifications.web)")
private ResourceBundleLoader \_resourceBundleLoader;
diff --git a/modules/apps/oauth2-provider/oauth2-provider-rest/build.gradle b/modules/apps/oauth2-provider/oauth2-provider-rest/build.gradle
index 36fe5d4faebce1..3f5fdbd125e157 100644
--- a/modules/apps/oauth2-provider/oauth2-provider-rest/build.gradle
+++ b/modules/apps/oauth2-provider/oauth2-provider-rest/build.gradle
@@ -12,7 +12,7 @@ dependencies {
compileOnly group: "com.liferay", name: "com.liferay.petra.reflect", version: "2.0.0"
compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "2.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.configuration.metatype.api", version: "1.0.0"
- compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "3.0.0"
+ compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "default"
compileOnly group: "javax.portlet", name: "portlet-api", version: "3.0.0"
compileOnly group: "javax.servlet", name: "javax.servlet-api", version: "3.0.1"
compileOnly group: "javax.ws.rs", name: "javax.ws.rs-api", version: "2.1"
diff --git a/modules/apps/oauth2-provider/oauth2-provider-rest/src/main/java/com/liferay/oauth2/provider/rest/internal/endpoint/access/token/LiferayAccessTokenService.java b/modules/apps/oauth2-provider/oauth2-provider-rest/src/main/java/com/liferay/oauth2/provider/rest/internal/endpoint/access/token/LiferayAccessTokenService.java
index 7f583125fc1bab..7309fae83da9c9 100644
--- a/modules/apps/oauth2-provider/oauth2-provider-rest/src/main/java/com/liferay/oauth2/provider/rest/internal/endpoint/access/token/LiferayAccessTokenService.java
+++ b/modules/apps/oauth2-provider/oauth2-provider-rest/src/main/java/com/liferay/oauth2/provider/rest/internal/endpoint/access/token/LiferayAccessTokenService.java
@@ -15,6 +15,7 @@
package com.liferay.oauth2.provider.rest.internal.endpoint.access.token;
import com.liferay.oauth2.provider.rest.internal.endpoint.constants.OAuth2ProviderRestEndpointConstants;
+import com.liferay.portal.kernel.util.InetAddressUtil;
import java.net.InetAddress;
import java.net.UnknownHostException;
@@ -54,7 +55,8 @@ protected Client authenticateClientIfNeeded(
String remoteHost = httpServletRequest.getRemoteHost();
try {
- InetAddress inetAddress = InetAddress.getByName(remoteAddr);
+ InetAddress inetAddress = InetAddressUtil.getInetAddressByName(
+ remoteAddr);
remoteHost = inetAddress.getCanonicalHostName();
}
diff --git a/modules/apps/petra/petra-json-web-service-client/build.gradle b/modules/apps/petra/petra-json-web-service-client/build.gradle
index efea5f74fc338e..5a24673be31d97 100644
--- a/modules/apps/petra/petra-json-web-service-client/build.gradle
+++ b/modules/apps/petra/petra-json-web-service-client/build.gradle
@@ -2,9 +2,9 @@ sourceCompatibility = "1.6"
targetCompatibility = "1.6"
dependencies {
- compileInclude group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.8"
- compileInclude group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.8"
- compileInclude group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.8"
+ compileInclude group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.9"
+ compileInclude group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.9"
+ compileInclude group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.9.3"
compileInclude group: "commons-codec", name: "commons-codec", version: "1.7"
compileInclude group: "oauth.signpost", name: "signpost-commonshttp4", version: "1.2.1.2"
compileInclude group: "oauth.signpost", name: "signpost-core", version: "1.2.1.2"
diff --git a/modules/apps/petra/petra-salesforce-client/build.gradle b/modules/apps/petra/petra-salesforce-client/build.gradle
index f14491b47d7312..813eb8af19495b 100644
--- a/modules/apps/petra/petra-salesforce-client/build.gradle
+++ b/modules/apps/petra/petra-salesforce-client/build.gradle
@@ -4,7 +4,7 @@ dependencies {
compileInclude group: "com.force.api", name: "force-metadata-api", version: "39.0.0"
compileInclude group: "com.force.api", name: "force-partner-api", version: "39.0.0"
compileInclude group: "com.force.api", name: "force-wsc", version: "39.0.0"
- compileInclude group: "commons-beanutils", name: "commons-beanutils", version: "1.9.3"
+ compileInclude group: "commons-beanutils", name: "commons-beanutils", version: "1.9.4"
compileInclude group: "commons-collections", name: "commons-collections", version: "3.2.2"
compileInclude group: "commons-logging", name: "commons-logging", version: "1.2"
compileInclude group: "org.antlr", name: "ST4", version: "4.0.7"
diff --git a/modules/apps/portal-odata/portal-odata-impl/build.gradle b/modules/apps/portal-odata/portal-odata-impl/build.gradle
index a36fbb30ec9838..64260414a99d8f 100644
--- a/modules/apps/portal-odata/portal-odata-impl/build.gradle
+++ b/modules/apps/portal-odata/portal-odata-impl/build.gradle
@@ -1,5 +1,5 @@
dependencies {
- compileInclude group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.8"
+ compileInclude group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.9.3"
compileInclude group: "org.apache.olingo", name: "odata-commons-api", version: "4.4.0"
compileInclude group: "org.apache.olingo", name: "odata-commons-core", version: "4.4.0"
compileInclude group: "org.apache.olingo", name: "odata-server-api", version: "4.4.0"
diff --git a/modules/apps/portal-search-elasticsearch6/portal-search-elasticsearch6-impl/build.gradle b/modules/apps/portal-search-elasticsearch6/portal-search-elasticsearch6-impl/build.gradle
index 3426d288126485..398d45f330b892 100644
--- a/modules/apps/portal-search-elasticsearch6/portal-search-elasticsearch6-impl/build.gradle
+++ b/modules/apps/portal-search-elasticsearch6/portal-search-elasticsearch6-impl/build.gradle
@@ -9,7 +9,7 @@ configurations {
dependencies {
compileInclude group: "com.carrotsearch", name: "hppc", version: "0.7.1"
- compileInclude group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.8.10"
+ compileInclude group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.9"
compileInclude group: "com.fasterxml.jackson.dataformat", name: "jackson-dataformat-cbor", version: "2.8.10"
compileInclude group: "com.fasterxml.jackson.dataformat", name: "jackson-dataformat-smile", version: "2.8.10"
compileInclude group: "com.fasterxml.jackson.dataformat", name: "jackson-dataformat-yaml", version: "2.8.10"
@@ -74,7 +74,7 @@ dependencies {
compileOnly group: "com.liferay", name: "com.liferay.portal.search.engine.adapter.api", version: "2.2.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.search.spi", version: "2.0.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "3.0.0"
- compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "3.0.0"
+ compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "default"
compileOnly group: "commons-collections", name: "commons-collections", version: "3.2.2"
compileOnly group: "org.codehaus.woodstox", name: "stax2-api", version: "3.1.4"
compileOnly group: "org.codehaus.woodstox", name: "woodstox-core-asl", version: "4.4.1"
diff --git a/modules/apps/portal-search-elasticsearch6/portal-search-elasticsearch6-impl/src/main/java/com/liferay/portal/search/elasticsearch6/internal/connection/RemoteElasticsearchConnection.java b/modules/apps/portal-search-elasticsearch6/portal-search-elasticsearch6-impl/src/main/java/com/liferay/portal/search/elasticsearch6/internal/connection/RemoteElasticsearchConnection.java
index a178585baaeb1a..ba2c38c53ab784 100644
--- a/modules/apps/portal-search-elasticsearch6/portal-search-elasticsearch6-impl/src/main/java/com/liferay/portal/search/elasticsearch6/internal/connection/RemoteElasticsearchConnection.java
+++ b/modules/apps/portal-search-elasticsearch6/portal-search-elasticsearch6-impl/src/main/java/com/liferay/portal/search/elasticsearch6/internal/connection/RemoteElasticsearchConnection.java
@@ -19,6 +19,7 @@
import com.liferay.portal.kernel.log.Log;
import com.liferay.portal.kernel.log.LogFactoryUtil;
import com.liferay.portal.kernel.util.GetterUtil;
+import com.liferay.portal.kernel.util.InetAddressUtil;
import com.liferay.portal.kernel.util.Props;
import com.liferay.portal.kernel.util.SetUtil;
import com.liferay.portal.kernel.util.StringUtil;
@@ -103,7 +104,7 @@ protected void addTransportAddress(
int port = GetterUtil.getInteger(transportAddressParts[1]);
- InetAddress inetAddress = InetAddress.getByName(host);
+ InetAddress inetAddress = InetAddressUtil.getInetAddressByName(host);
transportClient.addTransportAddress(
new TransportAddress(inetAddress, port));
diff --git a/modules/apps/portal-search/portal-search-web/src/main/java/com/liferay/portal/search/web/internal/display/context/PortletURLFactoryImpl.java b/modules/apps/portal-search/portal-search-web/src/main/java/com/liferay/portal/search/web/internal/display/context/PortletURLFactoryImpl.java
index 86dd16015bbadb..2e9f27a8bfe516 100644
--- a/modules/apps/portal-search/portal-search-web/src/main/java/com/liferay/portal/search/web/internal/display/context/PortletURLFactoryImpl.java
+++ b/modules/apps/portal-search/portal-search-web/src/main/java/com/liferay/portal/search/web/internal/display/context/PortletURLFactoryImpl.java
@@ -14,7 +14,13 @@
package com.liferay.portal.search.web.internal.display.context;
-import com.liferay.portal.kernel.portlet.PortletURLUtil;
+import com.liferay.portal.kernel.util.ArrayUtil;
+import com.liferay.portal.kernel.util.HttpUtil;
+import com.liferay.portal.kernel.util.PortalUtil;
+import com.liferay.portal.kernel.util.WebKeys;
+import com.liferay.portal.search.web.internal.portlet.shared.search.NullPortletURL;
+
+import java.util.Map;
import javax.portlet.MimeResponse;
import javax.portlet.PortletException;
@@ -30,18 +36,41 @@ public PortletURLFactoryImpl(
PortletRequest portletRequest, MimeResponse mimeResponse) {
\_portletRequest = portletRequest;
- \_mimeResponse = mimeResponse;
}
@Override
public PortletURL getPortletURL() throws PortletException {
- PortletURL portletURL = PortletURLUtil.getCurrent(
- \_portletRequest, \_mimeResponse);
+ return new NullPortletURL() {
+
+ @Override
+ public void setParameter(String name, String value) {
+ String portalURL = PortalUtil.getPortalURL(
+ PortalUtil.getHttpServletRequest(\_portletRequest));
+ String currentURL = (String)\_portletRequest.getAttribute(
+ WebKeys.CURRENT\_URL);
+
+ \_url = portalURL.concat(currentURL);
+
+ Map parameterMap = HttpUtil.getParameterMap(
+ \_url);
+
+ String[] values = parameterMap.get(name);
+
+ if (!ArrayUtil.contains(values, value)) {
+ \_url = HttpUtil.addParameter(\_url, name, value);
+ }
+ }
+
+ @Override
+ public String toString() {
+ return \_url;
+ }
+
+ private String \_url;
- return PortletURLUtil.clone(portletURL, \_mimeResponse);
+ };
}
- private final MimeResponse \_mimeResponse;
private final PortletRequest \_portletRequest;
}
\ No newline at end of file
diff --git a/modules/apps/portal-search/portal-search-web/src/main/java/com/liferay/portal/search/web/internal/facet/display/builder/FolderSearchFacetDisplayBuilder.java b/modules/apps/portal-search/portal-search-web/src/main/java/com/liferay/portal/search/web/internal/facet/display/builder/FolderSearchFacetDisplayBuilder.java
index b52c3dc4d3ab62..85d1036525f16f 100644
--- a/modules/apps/portal-search/portal-search-web/src/main/java/com/liferay/portal/search/web/internal/facet/display/builder/FolderSearchFacetDisplayBuilder.java
+++ b/modules/apps/portal-search/portal-search-web/src/main/java/com/liferay/portal/search/web/internal/facet/display/builder/FolderSearchFacetDisplayBuilder.java
@@ -20,6 +20,7 @@
import com.liferay.portal.kernel.search.facet.collector.TermCollector;
import com.liferay.portal.kernel.util.GetterUtil;
import com.liferay.portal.kernel.util.ListUtil;
+import com.liferay.portal.kernel.util.Validator;
import com.liferay.portal.search.web.internal.facet.display.context.FolderSearchFacetDisplayContext;
import com.liferay.portal.search.web.internal.facet.display.context.FolderSearchFacetTermDisplayContext;
import com.liferay.portal.search.web.internal.facet.display.context.FolderTitleLookup;
@@ -126,12 +127,14 @@ public void setParameterValues(String... parameterValues) {
long folderId = GetterUtil.getLong(termCollector.getTerm());
- if (folderId == 0) {
+ String displayName = getDisplayName(folderId);
+
+ if ((folderId == 0) || (displayName == null)) {
return null;
}
return buildFolderSearchFacetTermDisplayContext(
- folderId, getDisplayName(folderId), termCollector.getFrequency(),
+ folderId, displayName, termCollector.getFrequency(),
isSelected(folderId));
}
@@ -177,11 +180,11 @@ folderId, getDisplayName(folderId), termCollector.getFrequency(),
protected String getDisplayName(long folderId) {
String title = \_folderTitleLookup.getFolderTitle(folderId);
- if (title != null) {
+ if (Validator.isNotNull(title)) {
return title;
}
- return StringPool.OPEN\_BRACKET + folderId + StringPool.CLOSE\_BRACKET;
+ return null;
}
protected FolderSearchFacetTermDisplayContext
diff --git a/modules/apps/portal-search/portal-search-web/src/main/java/com/liferay/portal/search/web/internal/result/display/builder/SearchResultSummaryDisplayBuilder.java b/modules/apps/portal-search/portal-search-web/src/main/java/com/liferay/portal/search/web/internal/result/display/builder/SearchResultSummaryDisplayBuilder.java
index 1c7c6b5cacfb95..9ae4916153e481 100644
--- a/modules/apps/portal-search/portal-search-web/src/main/java/com/liferay/portal/search/web/internal/result/display/builder/SearchResultSummaryDisplayBuilder.java
+++ b/modules/apps/portal-search/portal-search-web/src/main/java/com/liferay/portal/search/web/internal/result/display/builder/SearchResultSummaryDisplayBuilder.java
@@ -277,9 +277,8 @@ protected void buildAssetCategoriesOrTags(
searchResultSummaryDisplayContext.setAssetCategoriesOrTagsVisible(
true);
searchResultSummaryDisplayContext.setFieldAssetCategoryIds(
- Field.ASSET\_CATEGORY\_IDS);
- searchResultSummaryDisplayContext.setFieldAssetTagNames(
- Field.ASSET\_TAG\_NAMES);
+ "category");
+ searchResultSummaryDisplayContext.setFieldAssetTagNames("tag");
}
}
diff --git a/modules/apps/portal-security-sso/portal-security-sso-cas-impl/bnd.bnd b/modules/apps/portal-security-sso/portal-security-sso-cas-impl/bnd.bnd
index fc13102c137075..c981699801f53a 100644
--- a/modules/apps/portal-security-sso/portal-security-sso-cas-impl/bnd.bnd
+++ b/modules/apps/portal-security-sso/portal-security-sso-cas-impl/bnd.bnd
@@ -6,4 +6,5 @@ Import-Package:\
\
!junit.\*,\
\
- \*
\ No newline at end of file
+ \*
+-noee: true
\ No newline at end of file
diff --git a/modules/apps/portal-security-sso/portal-security-sso-cas-impl/build.gradle b/modules/apps/portal-security-sso/portal-security-sso-cas-impl/build.gradle
index 199b4881cdea96..ff014100efc4b1 100644
--- a/modules/apps/portal-security-sso/portal-security-sso-cas-impl/build.gradle
+++ b/modules/apps/portal-security-sso/portal-security-sso-cas-impl/build.gradle
@@ -1,6 +1,7 @@
dependencies {
- compileInclude group: "org.jasig.cas.client", name: "cas-client-core", version: "3.1.12"
- compileInclude group: "org.opensaml", name: "opensaml", version: "1.1"
+ compileInclude group: "org.bouncycastle", name: "bcpkix-jdk15on", version: "1.61"
+ compileInclude group: "org.bouncycastle", name: "bcprov-jdk15on", version: "1.61"
+ compileInclude group: "org.jasig.cas.client", name: "cas-client-core", version: "3.6.1"
compileOnly group: "biz.aQute.bnd", name: "biz.aQute.bndlib", version: "3.1.0"
compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "2.0.0"
diff --git a/modules/apps/portal-security-sso/portal-security-sso-google-impl/build.gradle b/modules/apps/portal-security-sso/portal-security-sso-google-impl/build.gradle
index de2efe76d1c594..084e48a37e1d13 100644
--- a/modules/apps/portal-security-sso/portal-security-sso-google-impl/build.gradle
+++ b/modules/apps/portal-security-sso/portal-security-sso-google-impl/build.gradle
@@ -1,5 +1,5 @@
dependencies {
- compileInclude group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.5.3"
+ compileInclude group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.9"
compileInclude group: "com.google.api-client", name: "google-api-client", version: "1.21.0"
compileInclude group: "com.google.apis", name: "google-api-services-oauth2", version: "v2-rev103-1.21.0"
compileInclude group: "com.google.http-client", name: "google-http-client", version: "1.21.0"
diff --git a/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/resources/META-INF/resources/com.liferay.portal.settings.web/edit\_ldap\_server.jsp b/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/resources/META-INF/resources/com.liferay.portal.settings.web/edit\_ldap\_server.jsp
index 07d0c77dfdf503..296154815b4bf2 100644
--- a/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/resources/META-INF/resources/com.liferay.portal.settings.web/edit\_ldap\_server.jsp
+++ b/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/resources/META-INF/resources/com.liferay.portal.settings.web/edit\_ldap\_server.jsp
@@ -30,11 +30,7 @@ String ldapBaseProviderUrl = ldapServerConfiguration.baseProviderURL();
String ldapBaseDN = ldapServerConfiguration.baseDN();
String ldapSecurityPrincipal = ldapServerConfiguration.securityPrincipal();
-String ldapSecurityCredentials = ldapServerConfiguration.securityCredential();
-
-if (Validator.isNull(ldapSecurityCredentials)) {
- ldapSecurityCredentials = Portal.TEMP\_OBFUSCATION\_VALUE;
-}
+String ldapSecurityCredentials = Portal.TEMP\_OBFUSCATION\_VALUE;
String ldapAuthSearchFilter = ldapServerConfiguration.authSearchFilter();
String ldapUserSearchFilter = ldapServerConfiguration.userSearchFilter();
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language.properties
index 33c8e5b3e23669..f051c29e5cc97f 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=A subset of groups has been displayed for you to review.
a-subset-of-users-has-been-displayed-for-you-to-review=A subset of users has been displayed for you to review.
account-created-notification-body-with-password-help=Enter the body of the email sent to users upon registration. This should contain the user's automatically generated password.
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password.
account-created-notification-body-without-password-help=Enter the body of the email sent to users upon registration. This does not contain the user's password.
add-ldap-server=Add LDAP Server
allow-site-administrators-to-display-content-from-other-sites-they-administer=Allow site administrators to display content from other sites they administer.
@@ -18,6 +19,7 @@ apply-to-existing-users=Apply to Existing Users
are-you-sure-you-want-to-reset-the-configured-values=Are you sure you want to reset the configured values?
autogenerate-user-screen-names=Autogenerate User Screen Names
body-with-password=Body with Password
+body-with-password-link=Body with Password Link
body-without-password=Body without Password
cas-login-url-help=Set the CAS server login URL. Users are redirected to the CAS login page when authenticating into the portal.
cas-logout-on-session-expiration=Logout on session expiration.
@@ -46,6 +48,8 @@ disabled-by-default=Disabled by Default
domain-controller-name-help=Specify the domain controller NetBIOS name.
edit-ldap-server=Edit LDAP Server
email-address-attribute=Email Address Attribute
+email-with-password=Email with Password
+email-without-password=Email without Password
enable-birthday=Enable Birthday
enable-cdn-dynamic-resources=Enable CDN Dynamic Resources
enable-export=Enable Export
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_ar.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_ar.properties
index 0f073d67eb70c7..1e64796c5b4f2a 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_ar.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_ar.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=     .
a-subset-of-users-has-been-displayed-for-you-to-review=     .
account-created-notification-body-with-password-help=        .           .
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=         .        .
add-ldap-server=  LDAP
allow-site-administrators-to-display-content-from-other-sites-they-administer=         .
@@ -18,6 +19,7 @@ apply-to-existing-users=   
are-you-sure-you-want-to-reset-the-configured-values=        
autogenerate-user-screen-names=   
body-with-password=   
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=    
cas-login-url-help=  URL     CAS.           CAS    .
cas-logout-on-session-expiration=      .
@@ -46,6 +48,8 @@ disabled-by-default= 
domain-controller-name-help=      NetBIOS.
edit-ldap-server=  LDAP
email-address-attribute=   
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=  
enable-cdn-dynamic-resources=  CDN 
enable-export= 
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_bg.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_bg.properties
index dde9b8842722fc..2f1cf16628b961 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_bg.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_bg.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=       
a-subset-of-users-has-been-displayed-for-you-to-review=       
account-created-notification-body-with-password-help=    ,     .         . (Automatic Translation)
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Enter the body of the email sent to users upon registration. This does not contain the user's password.
add-ldap-server=  LDAP  (Automatic Translation)
allow-site-administrators-to-display-content-from-other-sites-they-administer=          ,  . (Automatic Translation)
@@ -18,6 +19,7 @@ apply-to-existing-users=  
are-you-sure-you-want-to-reset-the-configured-values=       ? (Automatic Translation)
autogenerate-user-screen-names=    (Automatic Translation)
body-with-password=   (Automatic Translation)
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=   (Automatic Translation)
cas-login-url-help=Set the CAS server login URL. Users are redirected to the CAS login page when authenticating into the portal.
cas-logout-on-session-expiration=   . (Automatic Translation)
@@ -46,6 +48,8 @@ disabled-by-default=   (Automatic
domain-controller-name-help=  NetBIOS    . (Automatic Translation)
edit-ldap-server=  LDAP  (Automatic Translation)
email-address-attribute=     
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=   (Automatic Translation)
enable-cdn-dynamic-resources= CDN   (Automatic Translation)
enable-export=  (Automatic Translation)
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_ca.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_ca.properties
index 615297afac9c98..5f11c23900b83c 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_ca.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_ca.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=S'ha visualitzat un subconjunt de grups per tal que el reviseu.
a-subset-of-users-has-been-displayed-for-you-to-review=S'ha visualitzat un subconjunt d'usuaris per tal que el reviseu.
account-created-notification-body-with-password-help=Introduu el cos del correu electrnic enviat als usuaris en la fase de registre. Aquest missatge ha d'incloure la contrasenya de l'usuari generada automticament.
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Introduu el cos del correu electrnic Introduu el cos del correu electrnic enviat als usuaris en la fase de registre. Aquest missatge no contindr la contrasenya de l'usuari generada automticament.
add-ldap-server=Afegeix un servidor LDAP
allow-site-administrators-to-display-content-from-other-sites-they-administer=Permet als administradors del lloc mostrar contingut d'altres llocs que administren.
@@ -18,6 +19,7 @@ apply-to-existing-users=Aplica-ho als usuaris existents
are-you-sure-you-want-to-reset-the-configured-values=Segur que voleu reiniciar els valors configurats?
autogenerate-user-screen-names=Genera automticament els noms d'usuari
body-with-password=Cos amb contrasenya
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=Cos sense contrasenya
cas-login-url-help=Configura el servidor CAS iniciant URL. Els usuaris es redirigirant a la pgina de registre CAS quan s'autentifiquin al portal.
cas-logout-on-session-expiration=Desconnectar al caducar la sessi.
@@ -46,6 +48,8 @@ disabled-by-default=Desactivat per defecte
domain-controller-name-help=Especifiqueu el nom de NetBIOS del controlador del domini.
edit-ldap-server=Editar servidor LDAP
email-address-attribute=Atribut de l'adrea de correu electrnic
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=Activa la data de naixement
enable-cdn-dynamic-resources=Habilitar els recursos dinmics CDN
enable-export=Habilitar l'exportaci
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_cs.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_cs.properties
index 425e05239aa33e..5f99e0f12557ba 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_cs.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_cs.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=Podmnoina skupin uivatel byla zobrazena k posouzen.
a-subset-of-users-has-been-displayed-for-you-to-review=Podmnoina uivatel byla zobrazena k posouzen.
account-created-notification-body-with-password-help=Zadejte text e-mailu, kter bude zasln nov registrovanm uivatelm. Tento e-mail by ml obsahovat automaticky vygenerovan heslo uivatele.
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Enter the body of the email sent to users upon registration. This does not contain the user's password.
add-ldap-server=Pidat LDAP server
allow-site-administrators-to-display-content-from-other-sites-they-administer=Povolit sprvcm web zobrazit tak obsah dalch web, kter spravuj.
@@ -18,6 +19,7 @@ apply-to-existing-users=Aplikovat na existujc uivatele
are-you-sure-you-want-to-reset-the-configured-values=Jste si jist, e chcete obnovit konfigurovan hodnoty? (Automatic Translation)
autogenerate-user-screen-names=Automatick generovn uivatelskch jmen
body-with-password=Text zprvy s heslem
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=Text zprvy bez hesla
cas-login-url-help=Set the CAS server login URL. Users are redirected to the CAS login page when authenticating into the portal.
cas-logout-on-session-expiration=Odhlen na vypren platnosti relace. (Automatic Translation)
@@ -46,6 +48,8 @@ disabled-by-default=Ve vchozm stavu vypnuto
domain-controller-name-help=Nastavte pro adi domny jeho NetBIOS nzev.
edit-ldap-server=Upravit LDAP server
email-address-attribute=Atribut e-mailov adresy
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=Povolit narozeniny
enable-cdn-dynamic-resources=Povolit dynamick zdroje CDN (Automatic Translation)
enable-export=Povolit Export (Automatic Translation)
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_da.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_da.properties
index c08d62ddcdebdb..234b6cdad98896 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_da.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_da.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=A subset of groups has been displayed for you to review. (Automatic Copy)
a-subset-of-users-has-been-displayed-for-you-to-review=A subset of users has been displayed for you to review. (Automatic Copy)
account-created-notification-body-with-password-help=Angiv meddelelsesteksten for e-mailen som sendes til brugere efter registrering. Meddelelsen br indeholde brugerens automatisk genererede adgangskode.
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Enter the body of the email sent to users upon registration. This does not contain the user's password.
add-ldap-server=Tilfj LDAP Server
allow-site-administrators-to-display-content-from-other-sites-they-administer=Allow site administrators to display content from other sites they administer. (Automatic Copy)
@@ -18,6 +19,7 @@ apply-to-existing-users=Apply to Existing brugere
are-you-sure-you-want-to-reset-the-configured-values=Are you sure you want to reset the configured values? (Automatic Copy)
autogenerate-user-screen-names=Autogenerer bruger-kaldenavn
body-with-password=Body with adgangskode
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=Body without adgangskode
cas-login-url-help=Set the CAS server login URL. Users are redirected to the CAS login page when authenticating into the portal.
cas-logout-on-session-expiration=Log p session udlbet. (Automatic Translation)
@@ -46,6 +48,8 @@ disabled-by-default=Disabled by Default (Automatic Copy)
domain-controller-name-help=Specify the domain controller NetBIOS name. (Automatic Copy)
edit-ldap-server=Tilfj LDAP Server
email-address-attribute=E-mail-adresse Attribute
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=Enable Birthday (Automatic Copy)
enable-cdn-dynamic-resources=Aktivere CDN dynamiske ressourcer (Automatic Translation)
enable-export=Aktivere udfrsel (Automatic Translation)
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_de.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_de.properties
index d6ec5ed5569d09..6c7ab07a257e69 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_de.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_de.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=Bitte prfen Sie den nachfolgenden Auszug aus den vorgefundenen Gruppen auf Richtigkeit.
a-subset-of-users-has-been-displayed-for-you-to-review=Bitte prfen Sie den nachfolgenden Auszug aus den vorgefundenen Benutzern auf Richtigkeit.
account-created-notification-body-with-password-help=Geben Sie den Inhalt der E-Mail an, die whrend der Anmeldung neuer Benutzer versendet. Diese E-Mail sollte das automatisch generiete Kennwort enhalten.
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Geben Sie den Inhalt der E-Mail an, die whrend der Anmeldung neuer Benutzer versendet. Diese E-Mail enthlt nicht das Kennwort des Benutzers.
add-ldap-server=LDAP-Server hinzufgen
allow-site-administrators-to-display-content-from-other-sites-they-administer=Site-Administratoren erlauben, Inhalte anderer von ihnen verwalteter Sites anzuzeigen.
@@ -18,6 +19,7 @@ apply-to-existing-users=Auf vorhandene Benutzer anwenden
are-you-sure-you-want-to-reset-the-configured-values=Sind Sie sicher, dass Sie die konfigurierten Werte zurcksetzen mchten?
autogenerate-user-screen-names=Benutzernamen automatisch generieren
body-with-password=Inhalt mit Kennwort
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=Inhalt ohne Kennwort
cas-login-url-help=CAS Server Login URL. Benutzer werden auf diese Seite weitergeleitet, wenn sie sich am Portal anmelden wollen.
cas-logout-on-session-expiration=CAS-Abmeldung nach Sitzungsablauf.
@@ -46,6 +48,8 @@ disabled-by-default=Standardmig deaktiviert
domain-controller-name-help=Geben Sie den NetBIOS Namen des Domnencontrollers an.
edit-ldap-server=LDAP-Server bearbeiten
email-address-attribute=Email-Adressen-Attribut
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=Eingabe des Geburtstags erlauben
enable-cdn-dynamic-resources=CDN fr dynamische Ressourcen aktivieren
enable-export=Export aktivieren
@@ -140,6 +144,4 @@ the-google-client-secret-is-invalid=Bitte geben Sie ein gltiges Google Client-
the-ldap-url-format-is=Das Format der LDAP Base Provider URL ist *ldap://host:port*. Der Base DN legt die initialten Suchkontext fr Benutzer fest und ist optional. Sie knnen zum Beispiel *ldap://localhost:389* und *ou=Users,o=Example* als Werte angeben.
use-default-interactions-settings=Standardmgen Interaktionstyp benutzen
use-ldap-password-policy=LDAP-Kennwortrichtlinie verwenden
-user-mapping=Benutzerzuordnung
-you-cannot-remove-a-language-that-is-the-current-default-language=Sie knnen keine Sprache lschen, die als Standardsprache festgelegt ist.
-you-must-choose-a-default-language=Bitte whlen Sie mindestens eine Standardsprache aus.
\ No newline at end of file
+user-mapping=Benutzerzuordnung
\ No newline at end of file
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_el.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_el.properties
index f7e3394cb237e0..46f0e0efd376ec 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_el.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_el.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=         .
a-subset-of-users-has-been-displayed-for-you-to-review=        .
account-created-notification-body-with-password-help=    email         .            .
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Enter the body of the email sent to users upon registration. This does not contain the user's password.
add-ldap-server= LDAP server
allow-site-administrators-to-display-content-from-other-sites-they-administer=         sites  . (Automatic Translation)
@@ -18,6 +19,7 @@ apply-to-existing-users=   
are-you-sure-you-want-to-reset-the-configured-values=        ; (Automatic Translation)
autogenerate-user-screen-names=    (screen name)
body-with-password=    
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=    
cas-login-url-help=Set the CAS server login URL. Users are redirected to the CAS login page when authenticating into the portal.
cas-logout-on-session-expiration=      . (Automatic Translation)
@@ -46,6 +48,8 @@ disabled-by-default=  
domain-controller-name-help=   NetBIOS  domain controller
edit-ldap-server= LDAP server
email-address-attribute=  email
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday= 
enable-cdn-dynamic-resources= CDN   (Automatic Translation)
enable-export=   (Automatic Translation)
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_en.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_en.properties
index 33c8e5b3e23669..f051c29e5cc97f 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_en.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_en.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=A subset of groups has been displayed for you to review.
a-subset-of-users-has-been-displayed-for-you-to-review=A subset of users has been displayed for you to review.
account-created-notification-body-with-password-help=Enter the body of the email sent to users upon registration. This should contain the user's automatically generated password.
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password.
account-created-notification-body-without-password-help=Enter the body of the email sent to users upon registration. This does not contain the user's password.
add-ldap-server=Add LDAP Server
allow-site-administrators-to-display-content-from-other-sites-they-administer=Allow site administrators to display content from other sites they administer.
@@ -18,6 +19,7 @@ apply-to-existing-users=Apply to Existing Users
are-you-sure-you-want-to-reset-the-configured-values=Are you sure you want to reset the configured values?
autogenerate-user-screen-names=Autogenerate User Screen Names
body-with-password=Body with Password
+body-with-password-link=Body with Password Link
body-without-password=Body without Password
cas-login-url-help=Set the CAS server login URL. Users are redirected to the CAS login page when authenticating into the portal.
cas-logout-on-session-expiration=Logout on session expiration.
@@ -46,6 +48,8 @@ disabled-by-default=Disabled by Default
domain-controller-name-help=Specify the domain controller NetBIOS name.
edit-ldap-server=Edit LDAP Server
email-address-attribute=Email Address Attribute
+email-with-password=Email with Password
+email-without-password=Email without Password
enable-birthday=Enable Birthday
enable-cdn-dynamic-resources=Enable CDN Dynamic Resources
enable-export=Enable Export
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_es.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_es.properties
index 69b10886fda294..cfce975e10cea6 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_es.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_es.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=Un subconjunto de los grupos se muestran a continuacin para ser revisados.
a-subset-of-users-has-been-displayed-for-you-to-review=Un subconjunto de los usuarios se muestran a continuacin para ser revisados.
account-created-notification-body-with-password-help=Introducir el cuerpo del email enviado a los usuarios en la fase de registro. Contendr la contrasea del usuario generada automticamente.
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Introduzca el cuerpo del correo electrnico que ser enviado a los usuarios al registrarse. Esto no contiene la contrasea del usuario.
add-ldap-server=Aadir servidor de LDAP
allow-site-administrators-to-display-content-from-other-sites-they-administer=Permitir a los administradores del sitio mostrar contenido de otros sitios que administran.
@@ -18,6 +19,7 @@ apply-to-existing-users=Aplicar a los usuarios existentes
are-you-sure-you-want-to-reset-the-configured-values=Est seguro de que quiere restablecer los valores configurados?
autogenerate-user-screen-names=Autogenerar los nombres de usuario
body-with-password=Cuerpo con contrasea
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=Cuerpo sin contrasea
cas-login-url-help=Establece la URL de inicio de sesin del servidor de CAS. Los usuarios son redirigidos a la pgina de inicio de sesin de CAS al autenticarse en el portal.
cas-logout-on-session-expiration=Cerrar sesin cuando caduque la sesin.
@@ -46,6 +48,8 @@ disabled-by-default=Deshabilitado por defecto
domain-controller-name-help=Especifique el nombre de NetBIOS del controlador del dominio.
edit-ldap-server=Editar servidor de LDAP
email-address-attribute=Atributo para el correo electrnico
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=Permitir mostrar la fecha de nacimiento
enable-cdn-dynamic-resources=Habilitar recursos dinmicos de CDN
enable-export=Habilitar exportacin
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_et.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_et.properties
index 745a16229737f3..39d4d21ec3ee7b 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_et.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_et.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=Sulle kuvatakse levaatamiseks gruppide alamhulk.
a-subset-of-users-has-been-displayed-for-you-to-review=Sulle kuvatakse levaatamiseks kasutajate alamhulk.
account-created-notification-body-with-password-help=Sisestage registreerumisel kasutajatele saata e-posti keha. See peaks sisaldama kasutaja automaatselt loodud parooli. (Automatic Translation)
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Enter the body of the email sent to users upon registration. This does not contain the user's password.
add-ldap-server=Lisada LDAP Server (Automatic Translation)
allow-site-administrators-to-display-content-from-other-sites-they-administer=Luba muude saitide nende hallatavat sisu kuvamiseks administraatoritel. (Automatic Translation)
@@ -18,6 +19,7 @@ apply-to-existing-users=Olemasolevate kasutajate suhtes (Automatic Translation)
are-you-sure-you-want-to-reset-the-configured-values=Kas soovite kindlasti lhtestada konfigureeritud vrtuste? (Automatic Translation)
autogenerate-user-screen-names=Genereeri automaatselt ekraani kasutajanimed (Automatic Translation)
body-with-password=Keha parooliga (Automatic Translation)
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=Ilma parool (Automatic Translation)
cas-login-url-help=Set the CAS server login URL. Users are redirected to the CAS login page when authenticating into the portal.
cas-logout-on-session-expiration=Logout seansi aegumine. (Automatic Translation)
@@ -46,6 +48,8 @@ disabled-by-default=Vaikimisi keelatuks (Automatic Translation)
domain-controller-name-help=Mrake selle domeenikontrolleri NetBIOS-i nimi. (Automatic Translation)
edit-ldap-server=Redigeeri LDAP Server (Automatic Translation)
email-address-attribute=E-posti aadressi atribuut
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=Lubade kasutada snnipeva programmi (Automatic Translation)
enable-cdn-dynamic-resources=Lubade kasutada CDN ressursside dnaamiline (Automatic Translation)
enable-export=Lubade kasutada ekspordi (Automatic Translation)
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_eu.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_eu.properties
index 5df24875e69e8d..1b2d58601302fd 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_eu.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_eu.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=Taldeen azpimultzo bat bistaratu da berrikuspenerako.
a-subset-of-users-has-been-displayed-for-you-to-review=Erabiltzaileen azpimultzo bat bistaratu da berrikuspenerako.
account-created-notification-body-with-password-help=Sartu erabiltzaileei erregistratzerakoan bidaliko zaien emailaren gorputza. Honek erabiltzailerantzat automatikoki sortutako pasahitza eduki behar du.
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Enter the body of the email sent to users upon registration. This does not contain the user's password.
add-ldap-server=Gehitu LDAP Zerbitzaria
allow-site-administrators-to-display-content-from-other-sites-they-administer=Allow site administrators to display content from other sites they administer. (Automatic Copy)
@@ -18,6 +19,7 @@ apply-to-existing-users=Existitzen diren erabiltzaileei aplikatu
are-you-sure-you-want-to-reset-the-configured-values=Are you sure you want to reset the configured values? (Automatic Copy)
autogenerate-user-screen-names=Automatikoki sortu Erabiltzaileen Pantaila Izena
body-with-password=Pasahitza duen gorputza
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=Pasahitzik gabeko gorputza
cas-login-url-help=Set the CAS server login URL. Users are redirected to the CAS login page when authenticating into the portal.
cas-logout-on-session-expiration=Logout on session expiration. (Automatic Copy)
@@ -46,6 +48,8 @@ disabled-by-default=Defektuz Desgaituta
domain-controller-name-help=Zehaztu domeinu kontrolatzailearen NetBIOS izena.
edit-ldap-server=Gehitu LDAP Zerbitzaria
email-address-attribute=Posta-elektroniko helbide atributua
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=Jaoitzeguna gaitu
enable-cdn-dynamic-resources=Enable CDN Dynamic Resources (Automatic Copy)
enable-export=Enable Export (Automatic Copy)
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_fa.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_fa.properties
index 325ecd1e711771..853a0bf7260034 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_fa.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_fa.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=        .
a-subset-of-users-has-been-displayed-for-you-to-review=          .
account-created-notification-body-with-password-help=                      .
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=          .      .
add-ldap-server=  LDAP
allow-site-administrators-to-display-content-from-other-sites-they-administer=              .
@@ -18,6 +19,7 @@ apply-to-existing-users=    .
are-you-sure-you-want-to-reset-the-configured-values=           (Automatic Translation)
autogenerate-user-screen-names=      
body-with-password=    
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=    
cas-login-url-help=Set the CAS server login URL. Users are redirected to the CAS login page when authenticating into the portal.
cas-logout-on-session-expiration=   
@@ -46,6 +48,8 @@ disabled-by-default=     .
domain-controller-name-help=   NetBIOS   
edit-ldap-server=  LDAP
email-address-attribute=  
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=    
enable-cdn-dynamic-resources=  CDN Dynamic
enable-export= 
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_fi.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_fi.properties
index abf997c0a09446..0676e759e7db8a 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_fi.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_fi.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=Ryhmien osajoukko esitetn vahvistettavaksi.
a-subset-of-users-has-been-displayed-for-you-to-review=Kyttjien osajoukko esitetn vahvistettavaksi.
account-created-notification-body-with-password-help=Lis shkpostin teksti, mik lhetetn kyttjille rekisterinnin yhteydess. Shkpostin tulisi sislt kyttjlle automaattisesti luotu salasana.
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Lis shkpostin teksti, mik lhetetn kyttjille rekisterinnin yhteydess. Tm ei sisll kyttjn salasanaa.
add-ldap-server=Lis LDAP-palvelin
allow-site-administrators-to-display-content-from-other-sites-they-administer=Salli sivuston pkyttjien nytt sislt muilla sivuilta, joita he hallinnoivat.
@@ -18,6 +19,7 @@ apply-to-existing-users=Lis olemassa oleville kyttjille
are-you-sure-you-want-to-reset-the-configured-values=Oletko varma, ett haluat palauttaa mritetyt roolit?
autogenerate-user-screen-names=Generoi kyttjtunnus automaattisesti
body-with-password=Sislt ja salasana
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=Sislt ilman salasanaa
cas-login-url-help=Aseta CAS-palvelimen kirjautumis-URL. Kyttjt uudelleenohjataan CAS-kirjautumissivulle tunnistauduttaessa portaaliin.
cas-logout-on-session-expiration=Uloskirjautumisen istunnon vanhentumishetki.
@@ -46,6 +48,8 @@ disabled-by-default=Oletuksena kytketty pois
domain-controller-name-help=Mrittele domain kontrollerin NetBIOS nimi.
edit-ldap-server=Muokkaa LDAP-palvelin
email-address-attribute=Shkpostiosoite attribuutti
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=Ota kyttn syntympiv kentt
enable-cdn-dynamic-resources=Ota kyttn CDN dynaamisille resursseille.
enable-export=Ota kyttn ulosvienti
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_fr.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_fr.properties
index 4a5e1a115618d2..bc3d000b6f1a6c 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_fr.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_fr.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=Un sous-ensemble de groupes a t affich pour que vous le vrifiez.
a-subset-of-users-has-been-displayed-for-you-to-review=Un sous-ensemble d'utilisateurs a t affich pour que vous le vrifiez.
account-created-notification-body-with-password-help=Entrez le corps de l'e-mail envoy aux utilisateurs  l'issue de l'enregistrement. Celui-ci devrait contenir le mot de passe gnr automatiquement pour l'utilisateur.
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Entrer le corps du mail  envoyer aux utilisateurs lors de l'inscription. Il ne contient pas de mot de passe utilisateur.
add-ldap-server=Ajouter un serveur LDAP
allow-site-administrators-to-display-content-from-other-sites-they-administer=Permettre aux administrateurs d'afficher le contenu provenant des autres sites qu'ils administrent.
@@ -18,6 +19,7 @@ apply-to-existing-users=Appliquez-vous aux utilisateurs existants
are-you-sure-you-want-to-reset-the-configured-values=Voulez-vous vraiment rinitialiser les valeurs configures ?
autogenerate-user-screen-names=Noms d'cran d'utilisateur d'Autogenerate
body-with-password=Corps de page avec mot de passe
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=Corps de page sans mot de passe
cas-login-url-help=Rglez l'URL de connexion au serveur CAS. Les utilisateurs sont redirigs vers la page de connexion  CAS quand ils se connectent au portail.
cas-logout-on-session-expiration=Dconnexion  cause de l'expiration de session.
@@ -46,6 +48,8 @@ disabled-by-default=Dsactiv par dfaut
domain-controller-name-help=Spcifiez le nom de NetBIOS de contrleur de domaine.
edit-ldap-server=Editer un serveur LDAP
email-address-attribute=Attribut d'adresse email
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=Permettez l'anniversaire
enable-cdn-dynamic-resources=Activer les ressource dynamiques de CDN
enable-export=Activer export
@@ -140,6 +144,4 @@ the-google-client-secret-is-invalid=Veuillez entrer une question secrte du cli
the-ldap-url-format-is=//hte
use-default-interactions-settings=Utiliser les paramtres d'interaction par dfaut
use-ldap-password-policy=Utiliser la politique de mot de passe LDAP
-user-mapping=Mappage d'utilisateur
-you-cannot-remove-a-language-that-is-the-current-default-language=Vous ne pouvez supprimer cette langue parce qu'elle est celle par dfaut.
-you-must-choose-a-default-language=Vous devez choisir une langue par dfaut.
\ No newline at end of file
+user-mapping=Mappage d'utilisateur
\ No newline at end of file
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_gl.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_gl.properties
index 7b65796f7f0ae5..6fe4823321b8be 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_gl.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_gl.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=Un subconxunto dos grupos mstranse a continuacin para ser revisados.
a-subset-of-users-has-been-displayed-for-you-to-review=Un subconxunto dos usuarios mstranse a continuacin para ser revisados.
account-created-notification-body-with-password-help=Insire o corpo do correo que ser enviado aos usuarios ao rexistrarse. Debera conter a contrasea do usuario automaticamente xerada.
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Introduza o corpo do correo electrnico a ser enviado aos usuarios no momento do rexistro. Este texto non contn o contrasinal do usuario.
add-ldap-server=Engadir servidor LDAP
allow-site-administrators-to-display-content-from-other-sites-they-administer=Allow site administrators to display content from other sites they administer. (Automatic Copy)
@@ -18,6 +19,7 @@ apply-to-existing-users=Aplicar aos usuarios existentes
are-you-sure-you-want-to-reset-the-configured-values=Are you sure you want to reset the configured values? (Automatic Copy)
autogenerate-user-screen-names=Autoxenerar os nomes de usuario
body-with-password=Corpo con contrasea
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=Corpo sen contrasea
cas-login-url-help=Defina a URL de login do servidor CAS. Os usuarios sern redireccionados  pxina de login do CAS ao seren autenticados no portal.
cas-logout-on-session-expiration=Logout on session expiration. (Automatic Copy)
@@ -46,6 +48,8 @@ disabled-by-default=Disabled by Default (Automatic Copy)
domain-controller-name-help=Especifica o nome do controlador de dominio NetBIOS.
edit-ldap-server=Engadir servidor LDAP
email-address-attribute=Atributo correo electrnico
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=Permitir data de nacemento
enable-cdn-dynamic-resources=Enable CDN Dynamic Resources (Automatic Copy)
enable-export=Enable Export (Automatic Copy)
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_hi\_IN.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_hi\_IN.properties
index aada104dc35ec8..80160a0dc36c9f 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_hi\_IN.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_hi\_IN.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=            .
a-subset-of-users-has-been-displayed-for-you-to-review=            .
account-created-notification-body-with-password-help=                         (Automatic Translation)
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Enter the body of the email sent to users upon registration. This does not contain the user's password.
add-ldap-server=LDAP   (Automatic Translation)
allow-site-administrators-to-display-content-from-other-sites-they-administer=               (Automatic Translation)
@@ -18,6 +19,7 @@ apply-to-existing-users= 
are-you-sure-you-want-to-reset-the-configured-values=            ? (Automatic Translation)
autogenerate-user-screen-names=-   
body-with-password=    (Automatic Translation)
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=    (Automatic Translation)
cas-login-url-help=Set the CAS server login URL. Users are redirected to the CAS login page when authenticating into the portal.
cas-logout-on-session-expiration=    (Automatic Translation)
@@ -46,6 +48,8 @@ disabled-by-default=    (A
domain-controller-name-help=   NetBIOS    (Automatic Translation)
edit-ldap-server=LDAP     (Automatic Translation)
email-address-attribute=   
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=   
enable-cdn-dynamic-resources=CDN     (Automatic Translation)
enable-export=    (Automatic Translation)
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_hr.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_hr.properties
index a920e9ebb0ba18..4ad687934ae447 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_hr.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_hr.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=Prikazani podskup grupa eka na va pregled.
a-subset-of-users-has-been-displayed-for-you-to-review=Prikazani podskup korisnika eka na va pregled.
account-created-notification-body-with-password-help=Unesite tijelo mail poslan korisnici nakon registracije. Ovo bi trebalo sadravati korisnika automatski generirana lozinka.
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Enter the body of the email sent to users upon registration. This does not contain the user's password.
add-ldap-server=Dodaj LDAP posluitelj
allow-site-administrators-to-display-content-from-other-sites-they-administer=Dozvoli Administratorima web lokacije prikaz sadraja sa drugih lokacija kojim upravljaju.
@@ -18,6 +19,7 @@ apply-to-existing-users=Primijeni na postojee korisnike
are-you-sure-you-want-to-reset-the-configured-values=Are you sure you want to reset the configured values? (Automatic Copy)
autogenerate-user-screen-names=Autogenerate Korisniki Screen imena
body-with-password=Tijelo sa Lozinka
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=Tijelo bez Lozinka
cas-login-url-help=Set the CAS server login URL. Users are redirected to the CAS login page when authenticating into the portal.
cas-logout-on-session-expiration=Logout on session expiration. (Automatic Copy)
@@ -46,6 +48,8 @@ disabled-by-default=Predzadano kao onemogueno
domain-controller-name-help=Navedite kontroleru domene NetBIOS ime.
edit-ldap-server=Dodaj LDAP posluitelj
email-address-attribute=E-mail adresa atributa
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=Omogui roendan
enable-cdn-dynamic-resources=Enable CDN Dynamic Resources (Automatic Copy)
enable-export=Enable Export (Automatic Copy)
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_hu.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_hu.properties
index f58ad3f14bdd02..31e6f560cc52f9 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_hu.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_hu.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=Csoportok egy rszhalmaza ttekintsre megjelentve.
a-subset-of-users-has-been-displayed-for-you-to-review=Felhasznlk egy rszhalmaza ttekintsre megjelentve.
account-created-notification-body-with-password-help=Az e-mail szvege, amely a regisztrl felhasznlknak megy. Ennek tartalmaznia kell a felhasznl automatikusan generlt jelszavt.
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=rd be a levl trzsszvegt, amit a felhasznlk kapnak a regisztrci alkalmval. Ez nem tartalmazza a felhasznl jelszavt.
add-ldap-server=LDAP szerver hozzadsa
allow-site-administrators-to-display-content-from-other-sites-they-administer=A webhely adminisztrtorok szmra lehetv tesz, hogy megjelentsenek ms webhelyekrl szrmaz tartalmat, amiket k adminisztrlnak.
@@ -18,6 +19,7 @@ apply-to-existing-users=Vgrehajts a ltez felhasznlkon
are-you-sure-you-want-to-reset-the-configured-values=Biztosan alaphelyzetbe kvnja lltani a konfigurlt rtkeket?
autogenerate-user-screen-names=Automatikus kpernynv generls
body-with-password=Trzs jelszval
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=Trzs jelsz nlkl
cas-login-url-help=lltsa be a CAS kiszolgl bejelentkezsi URL-jt. A felhasznlk visszakerlnek a CAS bejelentkezsi oldalra, amikor a portlon megadjk az azonost adataikat.
cas-logout-on-session-expiration=Kijelentkezs a munkafolyamat lejrtval.
@@ -46,6 +48,8 @@ disabled-by-default=Letiltva alaprtelmezsbl
domain-controller-name-help=A NetBIOS tartomny vezrl nevnek meghatrozsa.
edit-ldap-server=LDAP szerver szerkesztse
email-address-attribute=E-mail cm tulajdonsga
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=Szletsi id engedlyezse
enable-cdn-dynamic-resources=Engedlyezd a CDN dinamikus erforrsokat
enable-export=Export engedlyezse
@@ -140,6 +144,4 @@ the-google-client-secret-is-invalid=Krjk, rvnyes Google gyfltitkot a
the-ldap-url-format-is=Az alap LDAP szolgltat URL forma az *ldap://host:port*. Az alap DN meghatrozza a kezdeti keressi kontextust a felhasznlk szmra s nem ktelez. Pldul hasznld az *ldap://localhost:389* s *ou=Users,o=Example* az rtkeidhez.
use-default-interactions-settings=Hasznld az alaprtelmezett klcsnhats belltsokat
use-ldap-password-policy=LDAP jelszszablyok hasznlata
-user-mapping=Felhasznlk megfeleltetse
-you-cannot-remove-a-language-that-is-the-current-default-language=A jelenlegi alaprtelmezett nyelv nem tvolthat el.
-you-must-choose-a-default-language=Ki kell vlasztania az alaprtelmezett nyelvet.
\ No newline at end of file
+user-mapping=Felhasznlk megfeleltetse
\ No newline at end of file
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_in.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_in.properties
index f8b1ba18fe2964..68fb4cd06fcc61 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_in.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_in.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=Sebuah subset dari Grup telah ditampilkan bagi Anda untuk diperiksa.
a-subset-of-users-has-been-displayed-for-you-to-review=Sebuah subset dari pengguna telah ditampilkan untuk Anda Review.
account-created-notification-body-with-password-help=Masukan tubuh email yang dikirmkan ke pengguna setelah pendaftaran. Ini harus berisi password user secara otomatis dihasilkan.
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Enter the body of the email sent to users upon registration. This does not contain the user's password.
add-ldap-server=Tambahkan LDAP Server
allow-site-administrators-to-display-content-from-other-sites-they-administer=Memungkinkan administrator situs untuk menampilkan konten dari situs lain yang mereka mengelola. (Automatic Translation)
@@ -18,6 +19,7 @@ apply-to-existing-users=Terapkan untuk Pengguna yang ada
are-you-sure-you-want-to-reset-the-configured-values=Apakah Anda yakin Anda ingin me-reset nilai dikonfigurasi? (Automatic Translation)
autogenerate-user-screen-names=Layar Autogenerate Nama Pengguna
body-with-password=Tubuh dengan Password
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=Tubuh dengan Password
cas-login-url-help=Set the CAS server login URL. Users are redirected to the CAS login page when authenticating into the portal.
cas-logout-on-session-expiration=Logout pada sesi kedaluwarsa. (Automatic Translation)
@@ -46,6 +48,8 @@ disabled-by-default=Dinonaktifkan oleh Default
domain-controller-name-help=Tentukan nama NetBIOS domain controller.
edit-ldap-server=Tambahkan LDAP Server
email-address-attribute=Alamat Email Atribut
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=Aktifkan Ulang Tahun
enable-cdn-dynamic-resources=Mengaktifkan sumber daya dinamis CDN (Automatic Translation)
enable-export=Mengaktifkan ekspor (Automatic Translation)
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_it.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_it.properties
index 593df660630200..42d84f9154760e 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_it.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_it.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review= stato visualizzato un sottoinsieme dei gruppi per la revisione.
a-subset-of-users-has-been-displayed-for-you-to-review= stato visualizzato un sottoinsieme degli utenti per la revisione.
account-created-notification-body-with-password-help=Inserisci il corpo dell'email inviata agli utenti a seguito della registrazione. Dovrebbe contenere la password dell'utente generata automaticamente.
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Inserisci il corpo dell'email inviata agli utenti a seguito della registrazione. Dovrebbe contenere la password dell'utente generata automaticamente.
add-ldap-server=Aggiungi Server LDAP
allow-site-administrators-to-display-content-from-other-sites-they-administer=Consenti agli amministratori di visualizzare i contenuti di altri siti da loro amministrati.
@@ -18,6 +19,7 @@ apply-to-existing-users=Applica agli utenti esistenti
are-you-sure-you-want-to-reset-the-configured-values=Sei sicuro che si desidera reimpostare i valori configurati? (Automatic Translation)
autogenerate-user-screen-names=Autogenera gli username
body-with-password=Corpo con Password
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=Corpo senza Password
cas-login-url-help=Configura la login ULR del server CAS. Gli utenti quando cercheranno di loggarsi nel portale saranno ridirezionati alla pagina di login del server CAS.
cas-logout-on-session-expiration=Logout quando la sessione  scaduta.
@@ -46,6 +48,8 @@ disabled-by-default=Automaticamente Disabilitato
domain-controller-name-help=Specifica il nome del controller dominio NetBIOS.
edit-ldap-server=Modifica Server LDAP
email-address-attribute=Attributo Indirizzo Email
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=Abilita il campo data di nascita
enable-cdn-dynamic-resources=Abilita le Risorse CDN Dinamiche
enable-export=Abilita Esportazione
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_iw.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_iw.properties
index 3b2a686e2ea1e5..66a88b3bea3725 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_iw.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_iw.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=-    .
a-subset-of-users-has-been-displayed-for-you-to-review=-    .
account-created-notification-body-with-password-help=       .         .
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=       .       .
add-ldap-server=  LDAP
allow-site-administrators-to-display-content-from-other-sites-they-administer=        .
@@ -18,6 +19,7 @@ apply-to-existing-users=   
are-you-sure-you-want-to-reset-the-configured-values=       ?
autogenerate-user-screen-names=     
body-with-password=  
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=  
cas-login-url-help=   -URL    CAS.     -CAS     .
cas-logout-on-session-expiration=   .
@@ -46,6 +48,8 @@ disabled-by-default=  
domain-controller-name-help=   -NetBIOS   .
edit-ldap-server=   -LDAP
email-address-attribute=  
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=  
enable-cdn-dynamic-resources=  CDN 
enable-export= 
@@ -140,6 +144,4 @@ the-google-client-secret-is-invalid=    Google .
the-ldap-url-format-is=  -URL    LDAP  *ldap://host:port*. -DN         . ,  -*ldap://localhost:389* -*ou=Users,o=Example*   .
use-default-interactions-settings=     
use-ldap-password-policy=    LDAP
-user-mapping= 
-you-cannot-remove-a-language-that-is-the-current-default-language=        .
-you-must-choose-a-default-language=    .
\ No newline at end of file
+user-mapping= 
\ No newline at end of file
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_ja.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_ja.properties
index 66d20eb0cdd9a4..18d6a7826d7565 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_ja.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_ja.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=
a-subset-of-users-has-been-displayed-for-you-to-review=
account-created-notification-body-with-password-help=
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=
add-ldap-server=LDAP
allow-site-administrators-to-display-content-from-other-sites-they-administer=
@@ -18,6 +19,7 @@ apply-to-existing-users=
are-you-sure-you-want-to-reset-the-configured-values=
autogenerate-user-screen-names=
body-with-password=
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=
cas-login-url-help=CASURLCAS
cas-logout-on-session-expiration=
@@ -46,6 +48,8 @@ disabled-by-default=
domain-controller-name-help=NetBIOS
edit-ldap-server=LDAP
email-address-attribute=
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=
enable-cdn-dynamic-resources=CDN
enable-export=
@@ -140,6 +144,4 @@ the-google-client-secret-is-invalid=Google
the-ldap-url-format-is=LDAPURL*ldap://host:port*DN*ldap://localhost:389*  *ou=Users,o=Example*
use-default-interactions-settings=
use-ldap-password-policy=LDAP
-user-mapping=
-you-cannot-remove-a-language-that-is-the-current-default-language=
-you-must-choose-a-default-language=
\ No newline at end of file
+user-mapping=
\ No newline at end of file
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_kk.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_kk.properties
new file mode 100644
index 00000000000000..d175c3f4da46ec
--- /dev/null
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_kk.properties
@@ -0,0 +1,147 @@
+a-subset-of-groups-has-been-displayed-for-you-to-review=A subset of groups has been displayed for you to review. (Automatic Copy)
+a-subset-of-users-has-been-displayed-for-you-to-review=A subset of users has been displayed for you to review. (Automatic Copy)
+account-created-notification-body-with-password-help=Enter the body of the email sent to users upon registration. This should contain the user's automatically generated password. (Automatic Copy)
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
+account-created-notification-body-without-password-help=Enter the body of the email sent to users upon registration. This does not contain the user's password. (Automatic Copy)
+add-ldap-server=Add LDAP Server (Automatic Copy)
+allow-site-administrators-to-display-content-from-other-sites-they-administer=Allow site administrators to display content from other sites they administer. (Automatic Copy)
+allow-site-administrators-to-use-their-own-logo=Allow site administrators to use their own logo? (Automatic Copy)
+allow-strangers-to-create-accounts=Allow strangers to create accounts? (Automatic Copy)
+allow-strangers-to-create-accounts-with-a-company-email-address=Allow strangers to create accounts with a company email address? (Automatic Copy)
+allow-subsites-to-display-content-from-parent-sites=Allow subsites to display content from parent sites. (Automatic Copy)
+allow-users-to-automatically-log-in=Allow users to automatically log in? (Automatic Copy)
+allow-users-to-request-forgotten-passwords=Allow users to request forgotten passwords? (Automatic Copy)
+allow-users-to-request-forgotten-passwords-help=If this is checked, users can request to have a new password sent to their email address. (Automatic Copy)
+allow-users-to-request-password-reset-links=Allow users to request password reset links? (Automatic Copy)
+allow-users-to-request-password-reset-links-help=If this is checked, users can request to have a password reset link sent to their email address. (Automatic Copy)
+application-interactions=Application Interactions (Automatic Copy)
+apply-to-existing-users=Apply to Existing Users (Automatic Copy)
+are-you-sure-you-want-to-reset-the-configured-values=Are you sure you want to reset the configured values? (Automatic Copy)
+autogenerate-user-screen-names=Autogenerate User Screen Names (Automatic Copy)
+body-with-password=Body with Password (Automatic Copy)
+body-with-password-link=Body with Password Link (Automatic Copy)
+body-without-password=Body without Password (Automatic Copy)
+cas-login-url-help=Set the CAS server login URL. Users are redirected to the CAS login page when authenticating into the portal. (Automatic Copy)
+cas-logout-on-session-expiration=Logout on session expiration. (Automatic Copy)
+cas-logout-on-session-expiration-help=If this is checked, browsers with expired sessions will be redirected to the CAS logout URL. (Automatic Copy)
+cas-logout-url-help=Set the CAS server logout URL. Set this if you want the portal's logout function to trigger a CAS logout. (Automatic Copy)
+cas-no-such-user-redirect-url-help=Set the URL to redirect a user to, if the user can authenticate with CAS but cannot be found in the portal. If import from LDAP is enabled, the user is redirected if he cannot be found or could not be imported from LDAP. (Automatic Copy)
+cas-server-name-help=Set this to enable deep linking into the portal (e.g. http://localhost:8080). (Automatic Copy)
+cas-server-url-help=Set the CAS server domain URL prefix (e.g. https://localhost:8443/cas-web). (Automatic Copy)
+cas-service-url-help=Set this to disable deep linking into the portal (e.g. http://localhost:8080/c/portal/login). (Automatic Copy)
+cdn-host-http=CDN Host HTTP (Automatic Copy)
+cdn-host-https=CDN Host HTTPS (Automatic Copy)
+check-to-apply-the-changes-to-existing-users=Check to apply the changes to existing users. Changes take effect the next time a user signs in. (Automatic Copy)
+custom-contact-mapping=Custom Contact Mapping (Automatic Copy)
+custom-user-mapping=Custom User Mapping (Automatic Copy)
+default-control-panel-theme=Default Control Panel Theme (Automatic Copy)
+default-interactions=Default Interactions (Automatic Copy)
+default-landing-page=Default Landing Page (Automatic Copy)
+default-landing-page-help=This is the page that users are automatically redirected to after logging in. For example, if you want the default landing page to be http://localhost:8080/web/guest/login, set this to /web/guest/login. (Automatic Copy)
+default-ldap-server-settings-are-in-use-please-add-an-ldap-server-to-override-the-default-settings=Default LDAP server settings are in use. Please add an LDAP server to override the default settings. (Automatic Copy)
+default-logout-page=Default Logout Page (Automatic Copy)
+default-logout-page-help=This is the page that users are automatically redirected to after logging out. For example, if you want the default logout page to be http://localhost:8080/web/guest/logout, set this to /web/guest/logout. (Automatic Copy)
+default-regular-theme=Default Regular Theme (Automatic Copy)
+default-theme=Default Theme (Automatic Copy)
+default-values=Default Values (Automatic Copy)
+disabled-by-default=Disabled by Default (Automatic Copy)
+domain-controller-name-help=Specify the domain controller NetBIOS name. (Automatic Copy)
+edit-ldap-server=Edit LDAP Server (Automatic Copy)
+email-address-attribute=Email Address Attribute (Automatic Copy)
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
+enable-birthday=Enable Birthday (Automatic Copy)
+enable-cdn-dynamic-resources=Enable CDN Dynamic Resources (Automatic Copy)
+enable-export=Enable Export (Automatic Copy)
+enable-gender=Enable Gender (Automatic Copy)
+enable-recycle-bin-default=If this is checked, the Recycle Bin is enabled by default while still allowing site administrators to disable it per site. (Automatic Copy)
+enabled-by-default=Enabled by Default (Automatic Copy)
+enter-one-analytics-system-name-per-line=Enter one analytics system name **per line**. (Automatic Copy)
+enter-one-mail-host-name-per-line-for-all-additional-mail-host-names-besides-x=Enter one mail host name **per line** for all additional mail host names besides *{0}*. (Automatic Copy)
+enter-one-screen-name-per-line-to-reserve-the-screen-name=Enter one screen name **per line** to reserve the screen name. (Automatic Copy)
+enter-one-user-email-address-per-line-to-reserve-the-user-email-address=Enter one user email address **per line** to reserve the user email address. (Automatic Copy)
+enter-properties-file-synxtax-comma-delimiter=Enter a properties file syntax. For multiple mappings, the delimiter is a comma ",". (Automatic Copy)
+enter-the-default-organization-site-names-per-line-that-are-associated-with-newly-created-users=Enter the default organization site names **per line** that are associated with newly created users. (Automatic Copy)
+enter-the-default-regular-role-names-per-line-that-are-associated-with-newly-created-users=Enter the default regular role names **per line** that are associated with newly created users. (Automatic Copy)
+enter-the-default-site-names-per-line-that-are-associated-with-newly-created-users=Enter the default site names **per line** that are associated with newly created users. (Automatic Copy)
+enter-the-default-user-group-names-per-line-that-are-associated-with-newly-created-users=Enter the default user group names **per line** that are associated with newly created users. (Automatic Copy)
+enter-the-search-filter-that-is-used-to-test-the-validity-of-a-user=Enter the search filter that is used to test the validity of a user. The tokens @company\_id@, @email\_address@, @screen\_name@, and @user\_id@ are replaced at runtime with the correct values. (Automatic Copy)
+failed-to-bind-to-the-ldap-server-with-given-values=Failed to bind to the LDAP server with given values. (Automatic Copy)
+google-client-secret=Google Client Secret (Automatic Copy)
+group-mapping=Group Mapping (Automatic Copy)
+group-name=Group Name (Automatic Copy)
+home-url=Home URL (Automatic Copy)
+home-url-help=This is the home page of the Liferay instance. For example, if you want the home page to be http://localhost:8080/web/guest/home, set this to /web/guest/home. (Automatic Copy)
+how-do-users-authenticate=How do users authenticate? (Automatic Copy)
+import-cas-users-from-ldap=Import from LDAP (Automatic Copy)
+import-cas-users-from-ldap-help=If this is checked, users authenticated from CAS that do not exist in the portal are imported from LDAP. LDAP must be enabled. (Automatic Copy)
+import-enabled-user-password-autogenerated-help=If this is checked, autogenerated passwords are used for imported users. Exporting these users would lead to their original passwords being overwritten in LDAP. (Automatic Copy)
+import-export=Import / Export (Automatic Copy)
+import-opensso-users-from-ldap=Import from LDAP (Automatic Copy)
+import-opensso-users-from-ldap-help=If this is checked, users authenticated from OpenSSO that do not exist in the portal are imported from LDAP. LDAP must be enabled. (Automatic Copy)
+import-search-filter=Import Search Filter (Automatic Copy)
+javax.portlet.description.com\_liferay\_portal\_settings\_web\_portlet\_PortalSettingsPortlet=Instance Settings includes the global configurable instance settings such as names, authentication, default user associations, and mail host names. (Automatic Copy)
+javax.portlet.title.com\_liferay\_portal\_settings\_web\_portlet\_PortalSettingsPortlet=Instance Settings (Automatic Copy)
+language-and-time-zone=Language and Time Zone (Automatic Copy)
+language-cannot-be-removed-because-it-is-in-use-by-the-following-site-x=Language cannot be removed because it is in use by the following site: {0}. (Automatic Copy)
+ldap-export-must-not-be-enabled-when-autogeneration-of-user-passwords-is-enabled-for-ldap-import=LDAP export must not be enabled when autogeneration of user passwords is enabled for LDAP import. (Automatic Copy)
+ldap-password-policy-help=Note that if this is enabled, the portal will not check for valid passwords, expired passwords, or users that are locked out. This is now handled by the LDAP server's password policy. (Automatic Copy)
+ldap-server-name=Name (Automatic Copy)
+ldap-servers=LDAP Servers (Automatic Copy)
+liferay-analytics-key=Liferay Analytics Key (Automatic Copy)
+liferay-has-failed-to-connect-to-the-ldap-server=Liferay has failed to connect to the LDAP server. Please check your configuration and verify that the LDAP server is running. (Automatic Copy)
+liferay-has-failed-to-connect-to-the-opensso-server=Liferay has failed to connect to the OpenSSO server. Please check your configuration and verify that the OpenSSO server is running. (Automatic Copy)
+liferay-has-failed-to-connect-to-the-opensso-services=Liferay has failed to connect to the OpenSSO services. Please verify that the OpenSSO services are running. (Automatic Copy)
+liferay-has-successfully-connected-to-the-ldap-server=Liferay has successfully connected to the LDAP server. (Automatic Copy)
+liferay-has-successfully-connected-to-the-opensso-server=Liferay has successfully connected to the OpenSSO server. (Automatic Copy)
+load-default-server-configuration-for=Load Default Server Configuration For (Automatic Copy)
+login-url-for-opensso-help=This URL is used to specify the login page of the OpenSSO server. Use *goto=* as the parameter to specify where to redirect after logging in. (Automatic Copy)
+logout-url-for-opensso-help=This URL is used to specify the logout page of the OpenSSO server. Use *goto=* as the parameter to specify where to redirect after logging out. (Automatic Copy)
+mail-host-names=Mail Host Names (Automatic Copy)
+main-configuration=Main Configuration (Automatic Copy)
+mappings-for-opensso-help=The mandatory mappings between OpenSSO and Liferay are: Screen Name, Email Address, First Name, and Last Name. (Automatic Copy)
+oauth-redirect-url=Redirect URL (Automatic Copy)
+one-or-more-languages-cannot-be-removed-because-they-are-in-use-by-the-following-sites-x,-x-and-x-more=One or more languages cannot be removed because they are in use by the following sites: {0}, {1} and {2} More. (Automatic Copy)
+one-or-more-languages-cannot-be-removed-because-they-are-in-use-by-the-following-sites-x-and-x=One or more languages cannot be removed because they are in use by the following sites: {0} and {1}. (Automatic Copy)
+openam-12=OpenAM 12 and Below (Automatic Copy)
+openam-13=OpenAM 13+ (Automatic Copy)
+opensso=OpenSSO (Automatic Copy)
+organization-sites=Organization Sites (Automatic Copy)
+other-directory-server=Other Directory Server (Automatic Copy)
+please-enter-a-unique-ldap-server-name=Please enter a unique LDAP server name. (Automatic Copy)
+please-enter-a-valid-ldap-search-filter=Please enter a valid LDAP search filter. (Automatic Copy)
+please-enter-a-valid-ldap-server-name=Please enter a valid LDAP server name. (Automatic Copy)
+please-enter-a-valid-locale=Please enter a valid locale. (Automatic Copy)
+please-map-each-of-the-group-properties-group-name-and-user-to-an-ldap-attribute=Please map each of the group properties *Group Name* and *User* to an LDAP attribute. (Automatic Copy)
+please-select-at-least-one-social-relation-type=Please select at least one social relation type. (Automatic Copy)
+please-select-the-type-of-social-interaction=Please select the type of social interaction. (Automatic Copy)
+require-strangers-to-verify-their-email-address=Require strangers to verify their email address? (Automatic Copy)
+require-terms-of-use=Require Terms of Use (Automatic Copy)
+reset-values=Reset Values (Automatic Copy)
+screen-name-attribute=Screen Name Attribute (Automatic Copy)
+screen-names=Screen Names (Automatic Copy)
+select-the-default-ratings-type-for-the-following-applications=Select the default ratings type for the following applications. These values can be changed per site through Site Settings. (Automatic Copy)
+service-url-for-opensso-help=This URL is where OpenSSO can be accessed to use the authentication web services. If you are using OpenSSO Express 8 or higher, you need to have the server running Java 6. (Automatic Copy)
+ssl-error=SSL Error (Automatic Copy)
+system.ldap.configuration.name=System LDAP (Automatic Copy)
+test-cas-configuration=Test CAS Configuration (Automatic Copy)
+test-ldap-connection=Test LDAP Connection (Automatic Copy)
+test-ldap-groups=Test LDAP Groups (Automatic Copy)
+test-ldap-users=Test LDAP Users (Automatic Copy)
+test-opensso-configuration=Test OpenSSO Configuration (Automatic Copy)
+the-cas-login-url-is-invalid=The CAS login URL is invalid. (Automatic Copy)
+the-cas-logout-url-is-invalid=The CAS logout URL is invalid. (Automatic Copy)
+the-cas-no-such-user-url-is-invalid=The CAS no such user URL is invalid. (Automatic Copy)
+the-cas-server-name-is-invalid=The CAS server name is invalid. (Automatic Copy)
+the-cas-server-url-is-invalid=The CAS server URL is invalid. (Automatic Copy)
+the-cas-service-url-is-invalid=The CAS service URL is invalid. (Automatic Copy)
+the-facebook-connect-graph-url-is-invalid=Please enter a valid Facebook Graph URL (Automatic Copy)
+the-facebook-connect-oauth-auth-url-is-invalid=Please enter a valid Facebook OAuth Auth URL (Automatic Copy)
+the-facebook-connect-oauth-redirect-url-is-invalid=Please enter a valid Facebook OAuth Redirect URL (Automatic Copy)
+the-facebook-connect-oauth-token-url-is-invalid=Please enter a valid Facebook OAuth Token URL (Automatic Copy)
+the-google-client-id-is-invalid=Please enter a valid Google client ID. (Automatic Copy)
+the-google-client-secret-is-invalid=Please enter a valid Google client secret. (Automatic Copy)
+the-ldap-url-format-is=The LDAP Base Provider URL format is *ldap://host:port*. The Base DN specifies the initial search context for users and is optional. For example, use *ldap://localhost:389* and *ou=Users,o=Example* for your values. (Automatic Copy)
+use-default-interactions-settings=Use Default Interactions Settings (Automatic Copy)
+use-ldap-password-policy=Use LDAP Password Policy (Automatic Copy)
+user-mapping=User Mapping (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_ko.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_ko.properties
index 21b72b0ec41a9e..651565d1110bce 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_ko.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_ko.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=       .
a-subset-of-users-has-been-displayed-for-you-to-review=       .
account-created-notification-body-with-password-help=        .        . (Automatic Translation)
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Enter the body of the email sent to users upon registration. This does not contain the user's password.
add-ldap-server=LDAP   (Automatic Translation)
allow-site-administrators-to-display-content-from-other-sites-they-administer=         . (Automatic Translation)
@@ -18,6 +19,7 @@ apply-to-existing-users=    (Automatic Translation)
are-you-sure-you-want-to-reset-the-configured-values=      ? (Automatic Translation)
autogenerate-user-screen-names=Autogenerate   
body-with-password=    (Automatic Translation)
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=   (Automatic Translation)
cas-login-url-help=Set the CAS server login URL. Users are redirected to the CAS login page when authenticating into the portal.
cas-logout-on-session-expiration= ,  . (Automatic Translation)
@@ -46,6 +48,8 @@ disabled-by-default=    (Automatic Translation)
domain-controller-name-help=  NetBIOS   . (Automatic Translation)
edit-ldap-server=LDAP   (Automatic Translation)
email-address-attribute=  
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=  
enable-cdn-dynamic-resources=CDN    (Automatic Translation)
enable-export=  (Automatic Translation)
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_lo.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_lo.properties
index 502f07b2c13c7c..6e4b0806cc1ef1 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_lo.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_lo.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=.
a-subset-of-users-has-been-displayed-for-you-to-review=.
account-created-notification-body-with-password-help=.   
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Enter the body of the email sent to users upon registration. This does not contain the user's password.
add-ldap-server= LDAP
allow-site-administrators-to-display-content-from-other-sites-they-administer=Allow site administrators to display content from other sites they administer. (Automatic Copy)
@@ -18,6 +19,7 @@ apply-to-existing-users=
are-you-sure-you-want-to-reset-the-configured-values=Are you sure you want to reset the configured values? (Automatic Copy)
autogenerate-user-screen-names=
body-with-password= 
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password= 
cas-login-url-help=Set the CAS server login URL. Users are redirected to the CAS login page when authenticating into the portal.
cas-logout-on-session-expiration=Logout on session expiration. (Automatic Copy)
@@ -46,6 +48,8 @@ disabled-by-default=Disabled by Default (Automatic Copy)
domain-controller-name-help=Specify the domain controller NetBIOS name.
edit-ldap-server= LDAP
email-address-attribute= 
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=
enable-cdn-dynamic-resources=Enable CDN Dynamic Resources (Automatic Copy)
enable-export=Enable Export (Automatic Copy)
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_lt.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_lt.properties
index 4d9837dfa04ad2..59f593770eb238 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_lt.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_lt.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=Grups pogrupis buvo rodomas jums perirti. (Automatic Translation)
a-subset-of-users-has-been-displayed-for-you-to-review=Vartotoj pogrupis buvo rodomas jums perirti. (Automatic Translation)
account-created-notification-body-with-password-help=veskite vartotojams po registracijos el. laiko. Tai turt bti vartotojo automatikai sugeneruot slaptaod. (Automatic Translation)
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Enter the body of the email sent to users upon registration. This does not contain the user's password.
add-ldap-server=Pridti LDAP serveris (Automatic Translation)
allow-site-administrators-to-display-content-from-other-sites-they-administer=Leisti svetaini administratoriai Rodyti turinio i kit svetaini jie administruoti. (Automatic Translation)
@@ -18,6 +19,7 @@ apply-to-existing-users=Taikyti esamiems vartotojams (Automatic Translation)
are-you-sure-you-want-to-reset-the-configured-values=Ar tikrai norite i naujo nustatyti sukonfigruotas reikmes? (Automatic Translation)
autogenerate-user-screen-names=Automatikai generuoti vartotojo segvrdus (Automatic Translation)
body-with-password=Kno su slaptaodiu (Automatic Translation)
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=Knas be slaptaodio (Automatic Translation)
cas-login-url-help=Set the CAS server login URL. Users are redirected to the CAS login page when authenticating into the portal.
cas-logout-on-session-expiration=Logout ant sesijos pabaigos. (Automatic Translation)
@@ -46,6 +48,8 @@ disabled-by-default=Ijungta pagal numatytuosius parametrus (Automatic Translat
domain-controller-name-help=Nurodykite domeno valdiklio NetBIOS vard. (Automatic Translation)
edit-ldap-server=Redaguoti LDAP serveris (Automatic Translation)
email-address-attribute=El. pato adresas atributas (Automatic Translation)
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=Kad gimtadienis (Automatic Translation)
enable-cdn-dynamic-resources=CDN dinaminis iteklius (Automatic Translation)
enable-export=galinti eksporto (Automatic Translation)
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_nb.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_nb.properties
index 30474c3efbef5e..436ed00612673d 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_nb.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_nb.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=Et utvalg av grupper vises for gjennomsyn.
a-subset-of-users-has-been-displayed-for-you-to-review=Et utvalg av brukere vises for gjennomsyn.
account-created-notification-body-with-password-help=Skriv inn kroppen p e-posten som sendes til brukere ved registrering. Denne br inneholde brukerens automatisk genererte passord.
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Enter the body of the email sent to users upon registration. This does not contain the user's password.
add-ldap-server=Legg til LDAP-tjener
allow-site-administrators-to-display-content-from-other-sites-they-administer=Tillat nettstedsadministratorer  vise innhold fra andre nettsteder som de administrerer.
@@ -18,6 +19,7 @@ apply-to-existing-users=Legg til hos eksisterende brukere
are-you-sure-you-want-to-reset-the-configured-values=Er du sikker p at du vil tilbakestille de konfigurerte verdiene? (Automatic Translation)
autogenerate-user-screen-names=Autogenererte brukernavn
body-with-password=Meldingskropp med passord
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=Meldingskropp uten passord
cas-login-url-help=Set the CAS server login URL. Users are redirected to the CAS login page when authenticating into the portal.
cas-logout-on-session-expiration=Logg p kten utlper. (Automatic Translation)
@@ -46,6 +48,8 @@ disabled-by-default=Deaktivert som standard
domain-controller-name-help=Angi domenekontrollers NetBIOS navn.
edit-ldap-server=Endre LDAP-tjener
email-address-attribute=E-postadresse atributt
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=Tillat bursdag
enable-cdn-dynamic-resources=Aktiver CDN dynamiske ressurser (Automatic Translation)
enable-export=Aktiver eksport (Automatic Translation)
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_nl.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_nl.properties
index a80cc9e7c49e11..14d494d2350ad6 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_nl.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_nl.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=Te beoordelen groepen.
a-subset-of-users-has-been-displayed-for-you-to-review=Te beoordelen gebruikers.
account-created-notification-body-with-password-help=Vul hier de inhoud in van het e-mailbericht dat een gebruiker ontvangt na registratie. Deze inhoud moet het automatisch gegenereerde wachtwoord van de gebruiker bevatten.
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Vul hier de inhoud in van het e-mailbericht dat een gebruiker ontvangt na registratie. Deze inhoud zal het wachtwoord van de gebruiker niet bevatten.
add-ldap-server=LDAP-server toevoegen
allow-site-administrators-to-display-content-from-other-sites-they-administer=Beheerders toestaan om content weer te geven van andere sites die zij beheren.
@@ -18,6 +19,7 @@ apply-to-existing-users=Op bestaande gebuikers toepassen
are-you-sure-you-want-to-reset-the-configured-values=Weet u zeker dat u de geconfigureerde waarden wilt resetten?
autogenerate-user-screen-names=Automatisch gegenereerde schermnamen
body-with-password=Hoofdtekst met wachtwoord
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=Hoofdtekst zonder wachtwoord
cas-login-url-help=Stel de aanmeld-URL van de CAS-server in. Gebruikers worden omgeleid naar de CAS-aanmeldpagina bij de authenticatie in de portal.
cas-logout-on-session-expiration=Log uit bij het verlopen van de sessie.
@@ -46,6 +48,8 @@ disabled-by-default=Standaard uitgeschakeld
domain-controller-name-help=NetBIOS-naam van de domeincontroller specificeren.
edit-ldap-server=LDAP-server toevoegen
email-address-attribute=Kenmerk van e-mailadres
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=Verjaardagen inschakelen
enable-cdn-dynamic-resources=Dynamische resources via CDN inschakelen
enable-export=Exporteren inschakelen
@@ -140,6 +144,4 @@ the-google-client-secret-is-invalid=Voer een geldige Google client secret in.
the-ldap-url-format-is=De indeling van de LDAP Base Provider URL is *ldap://host:port*. De Base DN specificeert de initele zoekcontext en is optioneel. Gebruik bijvoorbeeld *ldap://localhost:389* en *ou=Users,o=Example*.
use-default-interactions-settings=Gebruik standaard interactie instellingen
use-ldap-password-policy=LDAP-wachtwoordbeleid gebruiken
-user-mapping=Gebruikerskoppelingen
-you-cannot-remove-a-language-that-is-the-current-default-language=U kunt geen taal verwijderen die de huidige standaardtaal is.
-you-must-choose-a-default-language=U moet een standaardtaal kiezen.
\ No newline at end of file
+user-mapping=Gebruikerskoppelingen
\ No newline at end of file
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_nl\_BE.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_nl\_BE.properties
index 33b9075a3cbf32..cb535e2e937182 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_nl\_BE.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_nl\_BE.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=Groepen die herzien moeten worden.
a-subset-of-users-has-been-displayed-for-you-to-review=Gebruikers die herzien moeten worden.
account-created-notification-body-with-password-help=E-mail: "Account aangemaakt (body met wachtwoord)"
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Enter the body of the email sent to users upon registration. This does not contain the user's password.
add-ldap-server=LDAP-server toevoegen
allow-site-administrators-to-display-content-from-other-sites-they-administer=Kunnen sitebeheerders om weer te geven inhoud van andere sites die zij beheren. (Automatic Translation)
@@ -18,6 +19,7 @@ apply-to-existing-users=Toepassen op bestaande gebruikers
are-you-sure-you-want-to-reset-the-configured-values=Are you sure you want to reset the configured values? (Automatic Copy)
autogenerate-user-screen-names=Automatisch gegenereerde schermnamen
body-with-password=Body met wachtwoord
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=Body zonder wachtwoord
cas-login-url-help=Set the CAS server login URL. Users are redirected to the CAS login page when authenticating into the portal.
cas-logout-on-session-expiration=Logout bij afloop van de sessie. (Automatic Translation)
@@ -46,6 +48,8 @@ disabled-by-default=Standaard uitgeschakeld
domain-controller-name-help=NetBIOS name van de Domain Controller specifiren
edit-ldap-server=LDAP-server toevoegen
email-address-attribute=E-mailadres attribuut
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=Verjaardagen inschakelen
enable-cdn-dynamic-resources=Inschakelen van CDN dynamische middelen (Automatic Translation)
enable-export=Uitvoer inschakelen (Automatic Translation)
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_pl.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_pl.properties
index d73673da025240..acafbb79301322 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_pl.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_pl.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=Zosta Ci wywietlony do przegldu podzbir grup.
a-subset-of-users-has-been-displayed-for-you-to-review=Zosta Ci wywietlony do przegldu podzbir uytkownikw.
account-created-notification-body-with-password-help=Wprowad tre wiadomoci jaka ma zosta wysana uytkownikom po rejestracji. Powinna ona zawiera automatycznie generowane haso uytkownika.
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Wprowad tre wiadomoci jaka ma zosta wysana uytkownikom po rejestracji. Nie bdzie ona zawiera informacji o hale uytkownika.
add-ldap-server=Dodaj serwer LDAP
allow-site-administrators-to-display-content-from-other-sites-they-administer=Pozwl administratorom witryny wywietla zawarto z innych witryn, ktrymi zarzdzaj.
@@ -18,6 +19,7 @@ apply-to-existing-users=Zastosuj do istniejcych uytkownikw
are-you-sure-you-want-to-reset-the-configured-values=Czy na pewno chcesz zresetowa skonfigurowanej wartoci? (Automatic Translation)
autogenerate-user-screen-names=Automatycznie wygeneruj nazwy uytkownika
body-with-password=Tre z hasem
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=Tre bez hasa
cas-login-url-help=Set the CAS server login URL. Users are redirected to the CAS login page when authenticating into the portal.
cas-logout-on-session-expiration=Logout na wyganicie sesji. (Automatic Translation)
@@ -46,6 +48,8 @@ disabled-by-default=Domylnie wyczone
domain-controller-name-help=Okrel nazw kontrolera domeny NetBIOS.
edit-ldap-server=Edytuj serwer LDAP
email-address-attribute=Atrybut adresu e-mail
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=Aktywuj pole "Urodziny" w danych uytkownika
enable-cdn-dynamic-resources=Uywaj serwera CDN dla zasobw generowanych dynamicznie (CSS, JavaScript, obrazki).
enable-export=Umoliwienia wywozu (Automatic Translation)
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_pt\_BR.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_pt\_BR.properties
index a86e5dd57ad287..b3e2bc1f3e6b65 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_pt\_BR.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_pt\_BR.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=Um subconjunto de grupos foi mostrado para voc revisar.
a-subset-of-users-has-been-displayed-for-you-to-review=Um subconjunto de usurios foi mostrado para voc revisar.
account-created-notification-body-with-password-help=Insira o corpo do email enviado aos usurios quando se registrarem. Deve conter a senha do usurios gerada automaticamente.
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Insira o corpo do e-mail a ser enviado aos usurios ao se registrarem. Isto no contm a senha do usurio.
add-ldap-server=Adicione Servidor LDAP
allow-site-administrators-to-display-content-from-other-sites-they-administer=Permite que administradores de sites exibam contedo de outros sites que eles administram.
@@ -18,6 +19,7 @@ apply-to-existing-users=Aplique nos usurios existentes
are-you-sure-you-want-to-reset-the-configured-values=Tem certeza que deseja redefinir os valores configurados?
autogenerate-user-screen-names=Gerar automaticamente nomes de tela de usurio
body-with-password=Corpo com senha
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=Corpo sem senha
cas-login-url-help=Defina o URL de login do servidor CAS. Os usurios sero redirecionados  pgina de login do CAS ao serem autenticados no portal.
cas-logout-on-session-expiration=Logout ao expirar a sesso.
@@ -46,6 +48,8 @@ disabled-by-default=Desativado por Padro
domain-controller-name-help=Especifique o nome NetBIOS do controlador do domnio.
edit-ldap-server=Editar o servidor LDAP
email-address-attribute=Atributo email
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=Habilitar aniversrio
enable-cdn-dynamic-resources=Habilitar Recursos Dinmicos do CDN
enable-export=Habilitar Exportao
@@ -140,6 +144,4 @@ the-google-client-secret-is-invalid=Por favor, insira um segredo vlido de clie
the-ldap-url-format-is=//host
use-default-interactions-settings=Usar Configuraes de Interaes Padro
use-ldap-password-policy=Use a poltica de senha do LDAP
-user-mapping=Mapeamento do usurio
-you-cannot-remove-a-language-that-is-the-current-default-language=Voc no pode remover o idioma definido como padro atual.
-you-must-choose-a-default-language=Voc precisa escolher um idioma padro.
\ No newline at end of file
+user-mapping=Mapeamento do usurio
\ No newline at end of file
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_pt\_PT.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_pt\_PT.properties
index cbd9261f1a6db9..77ebe266bc56bc 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_pt\_PT.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_pt\_PT.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=Foi indicado um subconjunto de grupos para reviso.
a-subset-of-users-has-been-displayed-for-you-to-review=Foi apresentado um subconjunto de utilizadores para reviso.
account-created-notification-body-with-password-help=Introduza o corpo da mensagem de correio enviada aos utilizadores no momento do registo. Este texto deve conter a Palavra-chave gerada automaticamente.
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Introduza o corpo do email a ser enviado aos utilizadores no momento do registo. Este texto no contm a senha do utilizador.
add-ldap-server=Adicionar Servidor LDAP
allow-site-administrators-to-display-content-from-other-sites-they-administer=Permitir que os administradores do site apresentem contedos de outros sites que eles administram.
@@ -18,6 +19,7 @@ apply-to-existing-users=Aplique aos Utilizadores Existentes
are-you-sure-you-want-to-reset-the-configured-values=Tem certeza de que deseja redefinir os valores configurados? (Automatic Translation)
autogenerate-user-screen-names=Gerar Nome de Utilizador Automaticamente
body-with-password=Corpo com Senha
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=Corpo sem Senha
cas-login-url-help=Set the CAS server login URL. Users are redirected to the CAS login page when authenticating into the portal.
cas-logout-on-session-expiration=Sair ao expirar sesso.
@@ -46,6 +48,8 @@ disabled-by-default=Desativado por Omisso
domain-controller-name-help=Especifique o nome NetBIOS do controlador de domnio.
edit-ldap-server=Adicionar Servidor LDAP
email-address-attribute=Atributo do email address
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=Habilitar aniversrio
enable-cdn-dynamic-resources=Habilitar Recursos Dinmicos do CDN
enable-export=Ativar a Exportao
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_ro.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_ro.properties
index 305c37b1ad0cd8..cc0f875c58afd6 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_ro.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_ro.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=Un subset de grupuri a fost afiat pentru ca tu s l revizuieti.
a-subset-of-users-has-been-displayed-for-you-to-review=Un subset de utilizatori a fost afiat pentru ca tu s l revizuiieti
account-created-notification-body-with-password-help=Intra n corpul de e-mail trimis utilizatorilor nregistrarea. Acest lucru ar trebui s conin parola utilizatorului generate automat. (Automatic Translation)
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Enter the body of the email sent to users upon registration. This does not contain the user's password.
add-ldap-server=Adaug Server LDAP
allow-site-administrators-to-display-content-from-other-sites-they-administer=Permite administratorilor de site-ul pentru a afia coninut de pe alte site-uri pe care le administreaz. (Automatic Translation)
@@ -18,6 +19,7 @@ apply-to-existing-users=Aplica la Utilizatori Existeni
are-you-sure-you-want-to-reset-the-configured-values=Sigur reiniializai valorile configurate? (Automatic Translation)
autogenerate-user-screen-names=Nume de Utilizator generate Automat
body-with-password=Corp cu parola (Automatic Translation)
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=Trupul fr parol (Automatic Translation)
cas-login-url-help=Set the CAS server login URL. Users are redirected to the CAS login page when authenticating into the portal.
cas-logout-on-session-expiration=Logout pe sesiune de expirare. (Automatic Translation)
@@ -46,6 +48,8 @@ disabled-by-default=Cu handicap n mod implicit (Automatic Translation)
domain-controller-name-help=Specific numele controller-ul de domeniu NetBIOS.
edit-ldap-server=Adaug Server LDAP
email-address-attribute=Atribut Adres Email
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=Activeaz zi de Natere
enable-cdn-dynamic-resources=Permite CDN dinamic resurse (Automatic Translation)
enable-export=Permite exportul (Automatic Translation)
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_ru.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_ru.properties
index 32dad6d23fca62..750673064c97e0 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_ru.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_ru.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=     .
a-subset-of-users-has-been-displayed-for-you-to-review=     .
account-created-notification-body-with-password-help=  ,      .        .
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Enter the body of the email sent to users upon registration. This does not contain the user's password.
add-ldap-server=  LDAP
allow-site-administrators-to-display-content-from-other-sites-they-administer=       ,   .
@@ -18,6 +19,7 @@ apply-to-existing-users=    
are-you-sure-you-want-to-reset-the-configured-values= ,      ? (Automatic Translation)
autogenerate-user-screen-names=    
body-with-password=   
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=   
cas-login-url-help=Set the CAS server login URL. Users are redirected to the CAS login page when authenticating into the portal.
cas-logout-on-session-expiration=     . (Automatic Translation)
@@ -46,6 +48,8 @@ disabled-by-default=  
domain-controller-name-help= NetBIOS   .
edit-ldap-server=  LDAP
email-address-attribute=  Email
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=  
enable-cdn-dynamic-resources=CDN   (Automatic Translation)
enable-export=  (Automatic Translation)
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_sk.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_sk.properties
index 67575a6d01dc07..c5ad21345e77c9 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_sk.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_sk.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=Zobrazila sa vm podmnoina skupn na posdenie.
a-subset-of-users-has-been-displayed-for-you-to-review=Zobrazila sa vm podmnoina pouvateov na posdenie.
account-created-notification-body-with-password-help=Zadajte text e-mailu, ktor bude zasielan pouvateom po registrcii. Mal by obsahova aj automaticky vygenerovan heslo.
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Zadajte telo e-mailu, ktor bude poslan pouvateovi pri registrcii. Tento neobsahuje pouvateove heslo.
add-ldap-server=Prida LDAP server
allow-site-administrators-to-display-content-from-other-sites-they-administer=Povoli sprvcom sdla zobrazova obsah z inch sdiel, ktor spravuj.
@@ -18,6 +19,7 @@ apply-to-existing-users=Aplikuj na existujcich pouvateov
are-you-sure-you-want-to-reset-the-configured-values=Naozaj chcete vynulova konfigurovan hodnoty? (Automatic Translation)
autogenerate-user-screen-names=Automaticky generuj pouvatesk men
body-with-password=Text sprvy s heslom
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=Text sprvy bez hesla
cas-login-url-help=Set the CAS server login URL. Users are redirected to the CAS login page when authenticating into the portal.
cas-logout-on-session-expiration=Odhlsi na zasadnut uplynut. (Automatic Translation)
@@ -46,6 +48,8 @@ disabled-by-default=Vypnut ako prednastaven
domain-controller-name-help=Nastavte NetBIOS nzov pre radi domny.
edit-ldap-server=Prida LDAP server
email-address-attribute=Atribt e-mailovej adresy
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=Povoli dtum narodenia
enable-cdn-dynamic-resources=Povoli dynamick zdroje CND
enable-export=Povoli export
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_sl.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_sl.properties
index 87881ff88d479f..801d7874e6ce06 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_sl.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_sl.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=Prikazan je nabor skupin za va pregled.
a-subset-of-users-has-been-displayed-for-you-to-review=Prikazan je nabor uporabnikov za va pregled.
account-created-notification-body-with-password-help=Vstopijo v telo email sent v uporabnik ob registraciji. To naj vsebuje uporabnika samodejno ustvarjeno geslo. (Automatic Translation)
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Enter the body of the email sent to users upon registration. This does not contain the user's password.
add-ldap-server=Dodajte strenik LDAP (Automatic Translation)
allow-site-administrators-to-display-content-from-other-sites-they-administer=Dovoli skrbnikom mest za prikaz vsebine iz drugih spletnih strani, ki jih upravljajo. (Automatic Translation)
@@ -18,6 +19,7 @@ apply-to-existing-users=Velja za obstojee uporabnike (Automatic Translation)
are-you-sure-you-want-to-reset-the-configured-values=Ali ste prepriani, da elite ponastaviti konfiguriranih vrednosti? (Automatic Translation)
autogenerate-user-screen-names=Samodejno ustvarjanje uporabnikih imen zaslona (Automatic Translation)
body-with-password=Telo z geslom (Automatic Translation)
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=Telo brez gesla (Automatic Translation)
cas-login-url-help=Set the CAS server login URL. Users are redirected to the CAS login page when authenticating into the portal.
cas-logout-on-session-expiration=Odjava na zasedanju poteka. (Automatic Translation)
@@ -46,6 +48,8 @@ disabled-by-default=Privzeto onemogoene (Automatic Translation)
domain-controller-name-help=Doloite NetBIOS ime krmilnika domene. (Automatic Translation)
edit-ldap-server=Urejanje LDAP strenik (Automatic Translation)
email-address-attribute=Lastnost e-potnega naslova
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=Omogoi rojstni dan (Automatic Translation)
enable-cdn-dynamic-resources=Omogoi dinamino virov CDN (Automatic Translation)
enable-export=Omogoi izvoz (Automatic Translation)
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_sr\_RS.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_sr\_RS.properties
index ead54a03c43902..70ddb144cbc048 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_sr\_RS.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_sr\_RS.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=       .
a-subset-of-users-has-been-displayed-for-you-to-review=       .
account-created-notification-body-with-password-help=  - -      .         .
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Enter the body of the email sent to users upon registration. This does not contain the user's password.
add-ldap-server=  
allow-site-administrators-to-display-content-from-other-sites-they-administer=Allow site administrators to display content from other sites they administer. (Automatic Copy)
@@ -18,6 +19,7 @@ apply-to-existing-users=   
are-you-sure-you-want-to-reset-the-configured-values=Are you sure you want to reset the configured values? (Automatic Copy)
autogenerate-user-screen-names=   
body-with-password=  
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=  
cas-login-url-help=Set the CAS server login URL. Users are redirected to the CAS login page when authenticating into the portal.
cas-logout-on-session-expiration=Logout on session expiration. (Automatic Copy)
@@ -46,6 +48,8 @@ disabled-by-default=Disabled by Default (Automatic Copy)
domain-controller-name-help=    .
edit-ldap-server=  
email-address-attribute=  
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday= 
enable-cdn-dynamic-resources=Enable CDN Dynamic Resources (Automatic Copy)
enable-export=Enable Export (Automatic Copy)
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_sr\_RS\_latin.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_sr\_RS\_latin.properties
index 5ca4b6e22d4e5b..90db52f5155718 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_sr\_RS\_latin.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_sr\_RS\_latin.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=Podskup grupe je prikazan za vas da pregledate.
a-subset-of-users-has-been-displayed-for-you-to-review=Podskup korisnika je prikazan za vas da pregledate.
account-created-notification-body-with-password-help=Unesite telo e-mejl - a za slanje korisnicima nakon registracije. Ono bi trebalo da sadri automatski generisanu lozinku korisnika.
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Enter the body of the email sent to users upon registration. This will not contain the user's password.
add-ldap-server=Dodaj LDAP Server
allow-site-administrators-to-display-content-from-other-sites-they-administer=Allow site administrators to display content from other sites they administer. (Automatic Copy)
@@ -18,6 +19,7 @@ apply-to-existing-users=Primeni na Postojee Korisnike
are-you-sure-you-want-to-reset-the-configured-values=Are you sure you want to reset the configured values? (Automatic Copy)
autogenerate-user-screen-names=Autogenerii Ekranska Imena Korisnika
body-with-password=Telo sa Lozinkom
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=Telo bez Lozinke
cas-login-url-help=Set the CAS server login URL. Users will be redirected to the CAS login page when authenticating into the portal.
cas-logout-on-session-expiration=Logout on session expiration. (Automatic Copy)
@@ -46,6 +48,8 @@ disabled-by-default=Disabled by Default (Automatic Copy)
domain-controller-name-help=Navedite NetBIOS imena domen kontrolera.
edit-ldap-server=Edit LDAP Server (Automatic Copy)
email-address-attribute=Emejl Adresa Atributa
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=Omogui Roendan
enable-cdn-dynamic-resources=Enable CDN Dynamic Resources (Automatic Copy)
enable-export=Enable Export (Automatic Copy)
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_sv.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_sv.properties
index 4b4e247a652d8f..5bfe667cd91eeb 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_sv.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_sv.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=En delmngd grupper visas fr ditt godknnande
a-subset-of-users-has-been-displayed-for-you-to-review=En delmngd anvndare visas fr ditt godknnande
account-created-notification-body-with-password-help=Skriv in meddelandetexten fr mejlet som skall skickas till anvndare som bekrftar att de registrerats. Detta mejl innehller oftast ett automatiskt genererat lsenord.
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Ange meddelandetexten i e-postmeddelandet som skickas till anvndare som bekrftar att de registrerats. E-postmeddelandet innehller inte anvndarens lsenord.
add-ldap-server=Lgg till LDAP-server
allow-site-administrators-to-display-content-from-other-sites-they-administer=Tillt webbplatsadministratrer att visa innehll frn andra webbplatser som de administrerar.
@@ -18,6 +19,7 @@ apply-to-existing-users=Utfr fr befintliga anvndare
are-you-sure-you-want-to-reset-the-configured-values=Vill du verkligen terstlla de konfigurerade vrdena?
autogenerate-user-screen-names=Automatgenerera anvndarnamn
body-with-password=Meddelandetext med lsenord
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=Meddelandetext utan lsenord
cas-login-url-help=Ange URL fr serverinloggning p CAS. Anvndare omdirigeras till inloggningssidan p CAS under autentiseringen p portalen.
cas-logout-on-session-expiration=Logga ut nr sessionen r slut.
@@ -46,6 +48,8 @@ disabled-by-default=Avaktiverad i standardlget
domain-controller-name-help=Ange domnkontrollerns NetBIOS namn.
edit-ldap-server=Lgg till LDAP-server
email-address-attribute=E-postadressattribut
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=Visa fdelsedagar
enable-cdn-dynamic-resources=Aktivera dynamiska resurser fr CDN
enable-export=Aktivera export
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_th.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_th.properties
index 5b4ecd263667bd..234dc233aa07d1 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_th.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_th.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review= (Automatic Translation)
a-subset-of-users-has-been-displayed-for-you-to-review= (Automatic Translation)
account-created-notification-body-with-password-help=  (Automatic Translation)
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=  (Automatic Translation)
add-ldap-server= LDAP (Automatic Translation)
allow-site-administrators-to-display-content-from-other-sites-they-administer=   (Automatic Translation)
@@ -18,6 +19,7 @@ apply-to-existing-users= (
are-you-sure-you-want-to-reset-the-configured-values= (Automatic Translation)
autogenerate-user-screen-names= (Automatic Translation)
body-with-password=  (Automatic Translation)
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password= (Automatic Translation)
cas-login-url-help= CAS URL   CAS  authenticating  (Automatic Translation)
cas-logout-on-session-expiration= (Automatic Translation)
@@ -46,6 +48,8 @@ disabled-by-default= 
domain-controller-name-help= NetBIOS  (Automatic Translation)
edit-ldap-server= LDAP Server (Automatic Translation)
email-address-attribute= (Automatic Translation)
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday= (Automatic Translation)
enable-cdn-dynamic-resources= CDN (Automatic Translation)
enable-export= (Automatic Translation)
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_tr.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_tr.properties
index 5e8abfebe70b37..7f41b11bc4f2b5 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_tr.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_tr.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=Bir grubun alt kmesi sizin gzden geirmeniz iin grntlendi.
a-subset-of-users-has-been-displayed-for-you-to-review=Gzden geirmeniz iin bir kullanc alt kmesi gsteriliyor.
account-created-notification-body-with-password-help=Kayd zerine kullanclara gnderilen e-posta gvdesini girin. Bu kullancnn otomatik olarak oluturulan parolasn iermelidir. (Automatic Translation)
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Enter the body of the email sent to users upon registration. This does not contain the user's password.
add-ldap-server=LDAP sunucusu ekleme (Automatic Translation)
allow-site-administrators-to-display-content-from-other-sites-they-administer=Site yneticileri ynettikleri dier sitelerde bulunan ierii grntlemek izin verir. (Automatic Translation)
@@ -18,6 +19,7 @@ apply-to-existing-users=Varolan kullanclar iin geerli olur (Automatic Tr
are-you-sure-you-want-to-reset-the-configured-values=Yaplandrlm deerleri sfrlamak istediinizden emin misiniz? (Automatic Translation)
autogenerate-user-screen-names=Otomatik oluturulan kullanc takma isimler (Automatic Translation)
body-with-password=ifre ile vcut (Automatic Translation)
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=ifre olmadan vcut (Automatic Translation)
cas-login-url-help=Set the CAS server login URL. Users are redirected to the CAS login page when authenticating into the portal.
cas-logout-on-session-expiration=Oturum kapatma oturum sona erme tarih. (Automatic Translation)
@@ -46,6 +48,8 @@ disabled-by-default=Varsaylan: devre d (Automatic Translation)
domain-controller-name-help=Etki alan denetleyicisi NetBIOS ad belirtin. (Automatic Translation)
edit-ldap-server=LDAP sunucusu Dzenle (Automatic Translation)
email-address-attribute=E-posta Adresi Nitelii
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=Doum gn etkinletirmek (Automatic Translation)
enable-cdn-dynamic-resources=CDN dinamik kaynaklar etkinletirmek (Automatic Translation)
enable-export=Da aktarma etkinletirme (Automatic Translation)
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_uk.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_uk.properties
index 683ec8fea91603..db1d3c2ff00913 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_uk.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_uk.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=     .
a-subset-of-users-has-been-displayed-for-you-to-review=     .
account-created-notification-body-with-password-help=    ,    .       . (Automatic Translation)
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Enter the body of the email sent to users upon registration. This does not contain the user's password.
add-ldap-server=  LDAP (Automatic Translation)
allow-site-administrators-to-display-content-from-other-sites-they-administer=       ,   . (Automatic Translation)
@@ -18,6 +19,7 @@ apply-to-existing-users=   
are-you-sure-you-want-to-reset-the-configured-values=     ? (Automatic Translation)
autogenerate-user-screen-names=    (Automatic Translation)
body-with-password=   (Automatic Translation)
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=   (Automatic Translation)
cas-login-url-help=Set the CAS server login URL. Users are redirected to the CAS login page when authenticating into the portal.
cas-logout-on-session-expiration=    . (Automatic Translation)
@@ -46,6 +48,8 @@ disabled-by-default=   (Automatic Tr
domain-controller-name-help= ' NetBIOS  . (Automatic Translation)
edit-ldap-server=  LDAP (Automatic Translation)
email-address-attribute=    (Automatic Translation)
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=   (Automatic Translation)
enable-cdn-dynamic-resources= CDN   (Automatic Translation)
enable-export=  (Automatic Translation)
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_vi.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_vi.properties
index 3c093ce6d0b38a..d41271ee5c88f8 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_vi.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_vi.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=Mt tp nh ca nhm  c xut hin  bn kim tra.
a-subset-of-users-has-been-displayed-for-you-to-review=Danh sch mt nhm ngi dng ang i bn kim duyt.
account-created-notification-body-with-password-help=Bn hy nhp ni dung th in t s c gi ti ngi dng khi h ng k. Th ny bao gm c mt khu ca ngi dng c h thng t ng to ra.
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=Enter the body of the email sent to users upon registration. This does not contain the user's password.
add-ldap-server=Thm my ch LDAP
allow-site-administrators-to-display-content-from-other-sites-they-administer=Cho php qun tr trang c hin th ni dung t cc trang khc m h cng c quyn qun tr.
@@ -18,6 +19,7 @@ apply-to-existing-users=p dng ti cc ngi s dng  c
are-you-sure-you-want-to-reset-the-configured-values=Bn c chc bn mun t li cc gi tr cu hnh? (Automatic Translation)
autogenerate-user-screen-names=T ng to tn giao din ngi dng
body-with-password=Ni dung vi mt khu
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=Phn thn khng cn mt khu
cas-login-url-help=Set the CAS server login URL. Users are redirected to the CAS login page when authenticating into the portal.
cas-logout-on-session-expiration=ng xut ngy ht hn phin. (Automatic Translation)
@@ -46,6 +48,8 @@ disabled-by-default=Mc nh l V hiu ha
domain-controller-name-help=Bn hy chn tn my ch qun tr th mc doanh nghip (domain controller NetBIOS)
edit-ldap-server=Cp nht my ch LDAP
email-address-attribute=Thuc tnh a ch th in t
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=Hin th sinh nht
enable-cdn-dynamic-resources=S CDN ng ti nguyn (Automatic Translation)
enable-export=S xut khu (Automatic Translation)
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_zh\_CN.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_zh\_CN.properties
index 0f65fe27e1adeb..c934bd43e8d8b7 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_zh\_CN.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_zh\_CN.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=
a-subset-of-users-has-been-displayed-for-you-to-review=
account-created-notification-body-with-password-help=
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=
add-ldap-server=LDAP
allow-site-administrators-to-display-content-from-other-sites-they-administer=
@@ -18,6 +19,7 @@ apply-to-existing-users=
are-you-sure-you-want-to-reset-the-configured-values=
autogenerate-user-screen-names=
body-with-password=
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=
cas-login-url-help= CAS  URL CAS 
cas-logout-on-session-expiration=
@@ -46,6 +48,8 @@ disabled-by-default=
domain-controller-name-help= NetBIOS 
edit-ldap-server=LDAP
email-address-attribute=
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=
enable-cdn-dynamic-resources=CDN
enable-export=
diff --git a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_zh\_TW.properties b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_zh\_TW.properties
index 50d621ced0413a..6a18e40b4bca54 100644
--- a/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_zh\_TW.properties
+++ b/modules/apps/portal-settings/portal-settings-lang/src/main/resources/content/Language\_zh\_TW.properties
@@ -1,6 +1,7 @@
a-subset-of-groups-has-been-displayed-for-you-to-review=
a-subset-of-users-has-been-displayed-for-you-to-review=
account-created-notification-body-with-password-help=
+account-created-notification-body-with-password-reset-help=Enter the body of the email sent to users upon registration. This should contain a link to set a new password. (Automatic Copy)
account-created-notification-body-without-password-help=
add-ldap-server=LDAP
allow-site-administrators-to-display-content-from-other-sites-they-administer=
@@ -18,6 +19,7 @@ apply-to-existing-users=
are-you-sure-you-want-to-reset-the-configured-values= (Automatic Translation)
autogenerate-user-screen-names=
body-with-password=
+body-with-password-link=Body with Password Link (Automatic Copy)
body-without-password=
cas-login-url-help=CASCAS
cas-logout-on-session-expiration= (Automatic Translation)
@@ -46,6 +48,8 @@ disabled-by-default=
domain-controller-name-help=NetBIOS
edit-ldap-server=LDAP
email-address-attribute=
+email-with-password=Email with Password (Automatic Copy)
+email-without-password=Email without Password (Automatic Copy)
enable-birthday=
enable-cdn-dynamic-resources=CDN
enable-export= (Automatic Translation)
diff --git a/modules/apps/portal-settings/portal-settings-web/build.gradle b/modules/apps/portal-settings/portal-settings-web/build.gradle
index 0447f97fccb4ea..186da4ff9df78d 100644
--- a/modules/apps/portal-settings/portal-settings-web/build.gradle
+++ b/modules/apps/portal-settings/portal-settings-web/build.gradle
@@ -14,7 +14,7 @@ dependencies {
compileOnly group: "com.liferay", name: "com.liferay.staging.taglib", version: "4.0.0"
compileOnly group: "com.liferay", name: "com.liferay.users.admin.api", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.users.admin.web", version: "3.0.0"
- compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "3.0.0"
+ compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "default"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "3.0.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.util.java", version: "3.0.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.util.taglib", version: "3.0.0"
diff --git a/modules/apps/portal-settings/portal-settings-web/src/main/resources/META-INF/resources/email\_notifications.jsp b/modules/apps/portal-settings/portal-settings-web/src/main/resources/META-INF/resources/email\_notifications.jsp
index 3089223460cbd4..64ae8a0217fe14 100644
--- a/modules/apps/portal-settings/portal-settings-web/src/main/resources/META-INF/resources/email\_notifications.jsp
+++ b/modules/apps/portal-settings/portal-settings-web/src/main/resources/META-INF/resources/email\_notifications.jsp
@@ -61,6 +61,18 @@ PortletPreferences companyPortletPreferences = PrefsPropsUtil.getPreferences(com
/>

+
+
+
+

+
+
<%@ include file="/definition\_of\_terms.jspf" %>

diff --git a/modules/apps/portal-store/portal-store-s3/build.gradle b/modules/apps/portal-store/portal-store-s3/build.gradle
index 5ebeba35d7f4ba..41173ca5e3079d 100644
--- a/modules/apps/portal-store/portal-store-s3/build.gradle
+++ b/modules/apps/portal-store/portal-store-s3/build.gradle
@@ -2,9 +2,9 @@ dependencies {
compileInclude group: "com.amazonaws", name: "aws-java-sdk-core", version: "1.11.277"
compileInclude group: "com.amazonaws", name: "aws-java-sdk-kms", version: "1.11.277"
compileInclude group: "com.amazonaws", name: "aws-java-sdk-s3", version: "1.11.277"
- compileInclude group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.8"
- compileInclude group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.8"
- compileInclude group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.8"
+ compileInclude group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.9"
+ compileInclude group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.9"
+ compileInclude group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.9.3"
compileInclude group: "com.fasterxml.jackson.dataformat", name: "jackson-dataformat-cbor", version: "2.8.1"
compileInclude group: "commons-codec", name: "commons-codec", version: "1.6"
compileInclude group: "commons-logging", name: "commons-logging", version: "1.2"
diff --git a/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/configuration/FreeMarkerEngineConfiguration.java b/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/configuration/FreeMarkerEngineConfiguration.java
index bcb1ee6f91c122..626787ee29634d 100644
--- a/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/configuration/FreeMarkerEngineConfiguration.java
+++ b/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/configuration/FreeMarkerEngineConfiguration.java
@@ -41,7 +41,7 @@ public interface FreeMarkerEngineConfiguration {
public String[] allowedClasses();
@Meta.AD(
- deflt = "java.lang.Class|java.lang.ClassLoader|java.lang.Compiler|java.lang.Package|java.lang.Process|java.lang.Runtime|java.lang.RuntimePermission|java.lang.SecurityManager|java.lang.System|java.lang.Thread|java.lang.ThreadGroup|java.lang.ThreadLocal",
+ deflt = "com.liferay.portal.json.jabsorb.serializer.LiferayJSONDeserializationWhitelist|java.lang.Class|java.lang.ClassLoader|java.lang.Compiler|java.lang.Package|java.lang.Process|java.lang.Runtime|java.lang.RuntimePermission|java.lang.SecurityManager|java.lang.System|java.lang.Thread|java.lang.ThreadGroup|java.lang.ThreadLocal",
name = "restricted-classes", required = false
)
public String[] restrictedClasses();
diff --git a/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/LiferayObjectWrapper.java b/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/LiferayObjectWrapper.java
index 379bcb5709fc5d..c5d53dc2bacb4e 100644
--- a/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/LiferayObjectWrapper.java
+++ b/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/LiferayObjectWrapper.java
@@ -23,8 +23,10 @@
import com.liferay.portal.kernel.log.Log;
import com.liferay.portal.kernel.log.LogFactoryUtil;
import com.liferay.portal.kernel.templateparser.TemplateNode;
+import com.liferay.portal.kernel.util.AggregateClassLoader;
import com.liferay.portal.kernel.util.StringUtil;
import com.liferay.portal.kernel.util.Validator;
+import com.liferay.portal.util.PortalImpl;
import freemarker.ext.beans.BeansWrapper;
import freemarker.ext.beans.EnumerationModel;
@@ -158,6 +160,20 @@ public boolean remove(Object object) {
\_restrictedClasses = new ArrayList<>(restrictedClassNames.length);
\_restrictedPackageNames = new ArrayList<>();
+ AggregateClassLoader aggregateClassLoader =
+ new AggregateClassLoader(
+ LiferayObjectWrapper.class.getClassLoader());
+
+ aggregateClassLoader.addClassLoader(
+ PortalImpl.class.getClassLoader());
+
+ Thread thread = Thread.currentThread();
+
+ if (thread.getContextClassLoader() != null) {
+ aggregateClassLoader.addClassLoader(
+ thread.getContextClassLoader());
+ }
+
for (String restrictedClassName : restrictedClassNames) {
restrictedClassName = StringUtil.trim(restrictedClassName);
@@ -166,7 +182,8 @@ public boolean remove(Object object) {
}
try {
- \_restrictedClasses.add(Class.forName(restrictedClassName));
+ \_restrictedClasses.add(
+ aggregateClassLoader.loadClass(restrictedClassName));
}
catch (ClassNotFoundException cnfe) {
if (\_log.isInfoEnabled()) {
diff --git a/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/configuration/VelocityEngineConfiguration.java b/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/configuration/VelocityEngineConfiguration.java
index 70276266e73681..cfd79fc64270f7 100644
--- a/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/configuration/VelocityEngineConfiguration.java
+++ b/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/configuration/VelocityEngineConfiguration.java
@@ -42,7 +42,7 @@ public interface VelocityEngineConfiguration {
public int resourceModificationCheckInterval();
@Meta.AD(
- deflt = "java.lang.Class|java.lang.ClassLoader|java.lang.Compiler|java.lang.Package|java.lang.Process|java.lang.Runtime|java.lang.RuntimePermission|java.lang.SecurityManager|java.lang.System|java.lang.Thread|java.lang.ThreadGroup|java.lang.ThreadLocal",
+ deflt = "com.liferay.portal.json.jabsorb.serializer.LiferayJSONDeserializationWhitelist|java.lang.Class|java.lang.ClassLoader|java.lang.Compiler|java.lang.Package|java.lang.Process|java.lang.Runtime|java.lang.RuntimePermission|java.lang.SecurityManager|java.lang.System|java.lang.Thread|java.lang.ThreadGroup|java.lang.ThreadLocal",
name = "restricted-classes", required = false
)
public String[] restrictedClasses();
diff --git a/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/LiferaySecureUberspector.java b/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/LiferaySecureUberspector.java
index d2e71b94a2333e..3c099a42580e69 100644
--- a/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/LiferaySecureUberspector.java
+++ b/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/LiferaySecureUberspector.java
@@ -17,8 +17,10 @@
import com.liferay.petra.string.CharPool;
import com.liferay.petra.string.StringBundler;
import com.liferay.petra.string.StringPool;
+import com.liferay.portal.kernel.util.AggregateClassLoader;
import com.liferay.portal.kernel.util.StringUtil;
import com.liferay.portal.kernel.util.Validator;
+import com.liferay.portal.util.PortalImpl;
import java.util.ArrayList;
import java.util.Collections;
@@ -52,6 +54,17 @@ public void init() {
\_restrictedClasses = new ArrayList<>(restrictedClassNames.length);
+ AggregateClassLoader aggregateClassLoader = new AggregateClassLoader(
+ LiferaySecureUberspector.class.getClassLoader());
+
+ aggregateClassLoader.addClassLoader(PortalImpl.class.getClassLoader());
+
+ Thread thread = Thread.currentThread();
+
+ if (thread.getContextClassLoader() != null) {
+ aggregateClassLoader.addClassLoader(thread.getContextClassLoader());
+ }
+
for (String restrictedClassName : restrictedClassNames) {
restrictedClassName = StringUtil.trim(restrictedClassName);
@@ -60,7 +73,8 @@ public void init() {
}
try {
- \_restrictedClasses.add(Class.forName(restrictedClassName));
+ \_restrictedClasses.add(
+ aggregateClassLoader.loadClass(restrictedClassName));
}
catch (ClassNotFoundException cnfe) {
super.log.error(
diff --git a/modules/apps/portal-template/portal-template-xsl/build.gradle b/modules/apps/portal-template/portal-template-xsl/build.gradle
index b05ed3f9a72c43..0d7e0fefc40aa1 100644
--- a/modules/apps/portal-template/portal-template-xsl/build.gradle
+++ b/modules/apps/portal-template/portal-template-xsl/build.gradle
@@ -3,7 +3,7 @@ dependencies {
compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "2.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.configuration.metatype.api", version: "1.0.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "3.7.0"
- compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "3.0.0"
+ compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "default"
compileOnly group: "javax.servlet", name: "javax.servlet-api", version: "3.0.1"
compileOnly group: "org.osgi", name: "org.osgi.service.component", version: "1.3.0"
compileOnly group: "org.osgi", name: "org.osgi.service.component.annotations", version: "1.3.0"
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/java/com/liferay/portal/template/xsl/configuration/XSLEngineConfiguration.java b/modules/apps/portal-template/portal-template-xsl/src/main/java/com/liferay/portal/template/xsl/configuration/XSLEngineConfiguration.java
index 06f036a2648a37..42bd7251360478 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/java/com/liferay/portal/template/xsl/configuration/XSLEngineConfiguration.java
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/java/com/liferay/portal/template/xsl/configuration/XSLEngineConfiguration.java
@@ -28,6 +28,11 @@
)
public interface XSLEngineConfiguration {
+ @Meta.AD(
+ deflt = "true", name = "prevent-local-connections", required = false
+ )
+ public boolean preventLocalConnections();
+
@Meta.AD(
deflt = "true", name = "secure-processing-enabled", required = false
)
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/java/com/liferay/portal/template/xsl/internal/XSLSecureURIResolver.java b/modules/apps/portal-template/portal-template-xsl/src/main/java/com/liferay/portal/template/xsl/internal/XSLSecureURIResolver.java
new file mode 100644
index 00000000000000..3bb2050e61bf1c
--- /dev/null
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/java/com/liferay/portal/template/xsl/internal/XSLSecureURIResolver.java
@@ -0,0 +1,77 @@
+/\*\*
+ \* Copyright (c) 2000-present Liferay, Inc. All rights reserved.
+ \*
+ \* This library is free software; you can redistribute it and/or modify it under
+ \* the terms of the GNU Lesser General Public License as published by the Free
+ \* Software Foundation; either version 2.1 of the License, or (at your option)
+ \* any later version.
+ \*
+ \* This library is distributed in the hope that it will be useful, but WITHOUT
+ \* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
+ \* FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
+ \* details.
+ \*/
+
+package com.liferay.portal.template.xsl.internal;
+
+import com.liferay.portal.kernel.util.InetAddressUtil;
+import com.liferay.portal.kernel.util.StringBundler;
+import com.liferay.portal.xsl.XSLURIResolver;
+
+import java.net.InetAddress;
+import java.net.MalformedURLException;
+import java.net.URL;
+import java.net.UnknownHostException;
+
+import javax.xml.transform.Source;
+import javax.xml.transform.TransformerException;
+
+/\*\*
+ \* @author Marta Medio
+ \*/
+public class XSLSecureURIResolver implements XSLURIResolver {
+
+ public XSLSecureURIResolver(XSLURIResolver xsluriResolver) {
+ \_xsluriResolver = xsluriResolver;
+ }
+
+ @Override
+ public String getLanguageId() {
+ if (\_xsluriResolver != null) {
+ return \_xsluriResolver.getLanguageId();
+ }
+
+ return null;
+ }
+
+ @Override
+ public Source resolve(String href, String base)
+ throws TransformerException {
+
+ try {
+ URL url = new URL(href);
+
+ if (InetAddressUtil.isLocalInetAddress(
+ InetAddress.getByName(url.getHost()))) {
+
+ throw new TransformerException(
+ StringBundler.concat(
+ "Denied access to resource: ", href,
+ ". Access to local network is disabled by the secure ",
+ "processing feature."));
+ }
+ else if (\_xsluriResolver != null) {
+ return \_xsluriResolver.resolve(href, base);
+ }
+
+ return null;
+ }
+ catch (MalformedURLException | UnknownHostException e) {
+ throw new TransformerException(
+ "Unable to resolve URL reference", e);
+ }
+ }
+
+ private final XSLURIResolver \_xsluriResolver;
+
+}
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/java/com/liferay/portal/template/xsl/internal/XSLTemplate.java b/modules/apps/portal-template/portal-template-xsl/src/main/java/com/liferay/portal/template/xsl/internal/XSLTemplate.java
index 988502b0a7b2e3..0378d4bfeb2140 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/java/com/liferay/portal/template/xsl/internal/XSLTemplate.java
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/java/com/liferay/portal/template/xsl/internal/XSLTemplate.java
@@ -72,6 +72,9 @@ public XSLTemplate(
\_errorTemplateResource = errorTemplateResource;
\_templateContextHelper = templateContextHelper;
+ \_preventLocalConnections =
+ xslEngineConfiguration.preventLocalConnections();
+
\_transformerFactory = TransformerFactory.newInstance(
\_TRANSFORMER\_FACTORY\_CLASS\_NAME, \_TRANSFORMER\_FACTORY\_CLASS\_LOADER);
@@ -82,8 +85,6 @@ public XSLTemplate(
}
catch (TransformerConfigurationException tce) {
}
-
- \_context = new HashMap<>();
}
@Override
@@ -118,6 +119,10 @@ public void doProcessTemplate(Writer writer) throws Exception {
\_transformerFactory.setErrorListener(xslErrorListener);
+ if (\_preventLocalConnections) {
+ xslURIResolver = new XSLSecureURIResolver(xslURIResolver);
+ }
+
\_transformerFactory.setURIResolver(xslURIResolver);
\_xmlStreamSource = new StreamSource(
@@ -316,8 +321,9 @@ private Transformer \_getTransformer(TemplateResource templateResource)
transformerFactoryClass.getClassLoader();
}
- private final Map \_context;
+ private final Map \_context = new HashMap<>();
private TemplateResource \_errorTemplateResource;
+ private final boolean \_preventLocalConnections;
private final TemplateContextHelper \_templateContextHelper;
private final TransformerFactory \_transformerFactory;
private StreamSource \_xmlStreamSource;
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language.properties
index e3545cda2f6953..e00d53684fdf7b 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections
secure-processing-enabled=Secure Processing Enabled
xsl-engine-configuration-name=XSL Engine
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_ar.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_ar.properties
index 2a8e48e80be21c..be713a39cf7371 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_ar.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_ar.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=  
xsl-engine-configuration-name= XSL
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_bg.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_bg.properties
index a2504154e6e887..0fe0feee6f50b6 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_bg.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_bg.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=Secure    (Automatic Translation)
xsl-engine-configuration-name=XSL  (Automatic Translation)
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_ca.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_ca.properties
index 38f1905a876f12..debd849d58e9fa 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_ca.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_ca.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=Processament segur activat
xsl-engine-configuration-name=Motor XSL
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_cs.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_cs.properties
index 53a1cc0c3051ff..a5cd1e0f318835 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_cs.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_cs.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=Bezpen zpracovn povoleno (Automatic Translation)
xsl-engine-configuration-name=XSL motor (Automatic Translation)
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_da.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_da.properties
index b353c78ffda84a..624b1a8a3411f5 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_da.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_da.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=Secure Processing Enabled (Automatic Copy)
xsl-engine-configuration-name=XSL-motor (Automatic Translation)
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_de.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_de.properties
index efb6e740f780ca..669d18fd244446 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_de.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_de.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=Sichere Verarbeitung aktiviert
xsl-engine-configuration-name=XSL-Engine
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_el.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_el.properties
index 718deb766c5263..6621020ce38702 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_el.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_el.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=   (Automatic Translation)
xsl-engine-configuration-name= XSL (Automatic Translation)
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_en.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_en.properties
index e3545cda2f6953..e00d53684fdf7b 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_en.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_en.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections
secure-processing-enabled=Secure Processing Enabled
xsl-engine-configuration-name=XSL Engine
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_es.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_es.properties
index cc3af223ee3948..6b801cfe75385f 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_es.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_es.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=Procesamiento seguro habilitado
xsl-engine-configuration-name=Herramienta XSL
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_et.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_et.properties
index 62056704e3e106..bdebb5fe7ae918 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_et.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_et.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=Turvaline ttlemine lubatud (Automatic Translation)
xsl-engine-configuration-name=XSL-i mootor (Automatic Translation)
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_eu.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_eu.properties
index a81f503a329c8e..fd0b0dca6e2507 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_eu.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_eu.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=Secure Processing Enabled (Automatic Copy)
xsl-engine-configuration-name=XSL Engine (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_fa.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_fa.properties
index e5af98ba8fb79f..1273101e2df6ee 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_fa.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_fa.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=   (Automatic Translation)
xsl-engine-configuration-name= XSL
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_fi.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_fi.properties
index 39327fd05aa2fc..9bd7804156c5d2 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_fi.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_fi.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=Turvallinen Ksittely Kytss
xsl-engine-configuration-name=XSL-moottori
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_fr.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_fr.properties
index d03d5a0a51e4b9..82b430d62ece98 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_fr.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_fr.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=Traitement scurit activ
xsl-engine-configuration-name=Moteur XSL
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_gl.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_gl.properties
index a81f503a329c8e..fd0b0dca6e2507 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_gl.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_gl.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=Secure Processing Enabled (Automatic Copy)
xsl-engine-configuration-name=XSL Engine (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_hi\_IN.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_hi\_IN.properties
index 97ecf1febbe9be..53dcd7a3cde628 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_hi\_IN.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_hi\_IN.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=   (Automatic Translation)
xsl-engine-configuration-name=XSL  (Automatic Translation)
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_hr.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_hr.properties
index a81f503a329c8e..fd0b0dca6e2507 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_hr.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_hr.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=Secure Processing Enabled (Automatic Copy)
xsl-engine-configuration-name=XSL Engine (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_hu.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_hu.properties
index f03957650e1c02..afcb64d3f70ec2 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_hu.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_hu.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=Biztonsgos feldolgozs engedlyezve
xsl-engine-configuration-name=XLS motor
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_in.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_in.properties
index da3ab4e61c4027..7c9639e8ae3e84 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_in.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_in.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=Aman pengolahan diaktifkan (Automatic Translation)
xsl-engine-configuration-name=XSL mesin (Automatic Translation)
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_it.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_it.properties
index c2e611e88fc602..706691a62b354b 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_it.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_it.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=Elaborazione sicura attivata (Automatic Translation)
xsl-engine-configuration-name=Motore XSL
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_iw.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_iw.properties
index 8aca30d2f88dcb..283414b934e36a 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_iw.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_iw.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=  
xsl-engine-configuration-name= XSL
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_ja.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_ja.properties
index a0beab0adeaa9b..7db6cab47db507 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_ja.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_ja.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=
xsl-engine-configuration-name=XSL 
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_ko.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_ko.properties
index 0a4e12c5cdbd64..a032cc5b69e181 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_ko.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_ko.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=    (Automatic Translation)
xsl-engine-configuration-name=XSL  (Automatic Translation)
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_lo.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_lo.properties
index a81f503a329c8e..fd0b0dca6e2507 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_lo.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_lo.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=Secure Processing Enabled (Automatic Copy)
xsl-engine-configuration-name=XSL Engine (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_lt.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_lt.properties
index ab436ae61dc397..1e465595c0c96d 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_lt.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_lt.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=Saugaus apdorojimo jungtas (Automatic Translation)
xsl-engine-configuration-name=XSL variklis (Automatic Translation)
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_nb.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_nb.properties
index c3e9473e1aca20..079c84a5eb84bc 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_nb.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_nb.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=Sikker behandling aktivert (Automatic Translation)
xsl-engine-configuration-name=XSL-motor (Automatic Translation)
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_nl.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_nl.properties
index 3cff4bf5dd9f43..dfb0412f2e68c6 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_nl.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_nl.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=Veilige verwerking ingeschakeld
xsl-engine-configuration-name=XSL engine
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_nl\_BE.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_nl\_BE.properties
index c00cfed67698a9..c9b1c2df3b6386 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_nl\_BE.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_nl\_BE.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=Secure Processing Enabled (Automatic Copy)
xsl-engine-configuration-name=XSL-Engine (Automatic Translation)
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_pl.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_pl.properties
index 0f053780755b66..83ee3b4c31dc84 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_pl.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_pl.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=Bezpieczne przetwarzanie wczone (Automatic Translation)
xsl-engine-configuration-name=XSL silnika (Automatic Translation)
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_pt\_BR.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_pt\_BR.properties
index 1d776d76c6eff8..b38efb7042ca38 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_pt\_BR.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_pt\_BR.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=Processamento seguro habilitado
xsl-engine-configuration-name=Mecanismo XSL
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_pt\_PT.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_pt\_PT.properties
index c5c9e74e751e18..7a285c3be80225 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_pt\_PT.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_pt\_PT.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=Secure Processing Enabled (Automatic Copy)
xsl-engine-configuration-name=Ferramenta XSL
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_ro.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_ro.properties
index 5ffd6915ce371f..e2903617269f84 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_ro.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_ro.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=Asigura prelucrarea activat (Automatic Translation)
xsl-engine-configuration-name=XSL motor (Automatic Translation)
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_ru.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_ru.properties
index a32add85304280..511fce7058d26b 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_ru.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_ru.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=   (Automatic Translation)
xsl-engine-configuration-name=XSL  (Automatic Translation)
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_sk.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_sk.properties
index 19c3fcc82be637..8da5373e81be6a 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_sk.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_sk.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=Bezpen spracovanie povolen (Automatic Translation)
xsl-engine-configuration-name=XSL motora (Automatic Translation)
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_sl.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_sl.properties
index c7c3f0da78cf54..d09301ba86926a 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_sl.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_sl.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=Varna obdelava, omogoeno (Automatic Translation)
xsl-engine-configuration-name=XSL motorja (Automatic Translation)
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_sr\_RS.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_sr\_RS.properties
index a81f503a329c8e..fd0b0dca6e2507 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_sr\_RS.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_sr\_RS.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=Secure Processing Enabled (Automatic Copy)
xsl-engine-configuration-name=XSL Engine (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_sr\_RS\_latin.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_sr\_RS\_latin.properties
index a81f503a329c8e..fd0b0dca6e2507 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_sr\_RS\_latin.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_sr\_RS\_latin.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=Secure Processing Enabled (Automatic Copy)
xsl-engine-configuration-name=XSL Engine (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_sv.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_sv.properties
index ccf88a6865bfbb..df88571bbbe638 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_sv.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_sv.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=Sker process aktiverad
xsl-engine-configuration-name=XSL-motor
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_th.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_th.properties
index f9ccc9ecc476db..f99f620a188ac6 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_th.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_th.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled= (Automatic Translation)
xsl-engine-configuration-name= XSL (Automatic Translation)
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_tr.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_tr.properties
index 7dad1452148c44..213318bb3488af 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_tr.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_tr.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=Gvenli ilem etkin (Automatic Translation)
xsl-engine-configuration-name=XSL motoru (Automatic Translation)
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_uk.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_uk.properties
index 83e46c739c2b33..5923d38b230124 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_uk.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_uk.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=   (Automatic Translation)
xsl-engine-configuration-name=XSL  (Automatic Translation)
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_vi.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_vi.properties
index f49f5f8239e179..b382a55ed6a5c8 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_vi.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_vi.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=X l an ton c kch hot (Automatic Translation)
xsl-engine-configuration-name=XSL ng c (Automatic Translation)
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_zh\_CN.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_zh\_CN.properties
index 7102c15c548dae..cf14915678d911 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_zh\_CN.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_zh\_CN.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled=
xsl-engine-configuration-name=XSL
\ No newline at end of file
diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_zh\_TW.properties b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_zh\_TW.properties
index f1948b6ba5b40b..4ea81aeb88f38a 100644
--- a/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_zh\_TW.properties
+++ b/modules/apps/portal-template/portal-template-xsl/src/main/resources/content/Language\_zh\_TW.properties
@@ -1,2 +1,3 @@
+prevent-local-connections=Prevent Local Connections (Automatic Copy)
secure-processing-enabled= (Automatic Translation)
xsl-engine-configuration-name=XSL  (Automatic Translation)
\ No newline at end of file
diff --git a/modules/apps/portal-vulcan/portal-vulcan-api/build.gradle b/modules/apps/portal-vulcan/portal-vulcan-api/build.gradle
index 19e8ed72667b94..1d3759421f49c1 100644
--- a/modules/apps/portal-vulcan/portal-vulcan-api/build.gradle
+++ b/modules/apps/portal-vulcan/portal-vulcan-api/build.gradle
@@ -2,9 +2,9 @@ dependencies {
compileInclude group: "com.fasterxml.jackson.dataformat", name: "jackson-dataformat-xml", version: "2.9.8"
compileInclude group: "org.yaml", name: "snakeyaml", version: "1.23"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.8"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.8"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.8"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.9"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.9"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.9.3"
compileOnly group: "com.liferay", name: "com.liferay.petra.function", version: "2.0.0"
compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "2.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.odata.api", version: "1.10.0"
diff --git a/modules/apps/portal-vulcan/portal-vulcan-impl/build.gradle b/modules/apps/portal-vulcan/portal-vulcan-impl/build.gradle
index abc1dfc597f1c9..a637da87a0b0c3 100644
--- a/modules/apps/portal-vulcan/portal-vulcan-impl/build.gradle
+++ b/modules/apps/portal-vulcan/portal-vulcan-impl/build.gradle
@@ -33,9 +33,9 @@ dependencies {
compileInclude group: "org.reflections", name: "reflections", version: "0.9.11"
compileInclude group: "org.yaml", name: "snakeyaml", version: "1.23"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.8"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.8"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.8"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.9"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.9"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.9.3"
compileOnly group: "com.fasterxml.jackson.module", name: "jackson-module-jaxb-annotations", version: "2.9.6"
compileOnly group: "com.liferay", name: "com.liferay.osgi.service.tracker.collections", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.osgi.util", version: "4.0.0"
@@ -44,7 +44,7 @@ dependencies {
compileOnly group: "com.liferay", name: "com.liferay.portal.vulcan.api", version: "2.0.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "3.14.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "3.0.0"
- compileOnly group: "commons-fileupload", name: "commons-fileupload", version: "1.3.2"
+ compileOnly group: "commons-fileupload", name: "commons-fileupload", version: "1.3.3"
compileOnly group: "io.github.graphql-java", name: "graphql-java-annotations", version: "5.4"
compileOnly group: "io.swagger.core.v3", name: "swagger-annotations", version: "2.0.5"
compileOnly group: "javax.portlet", name: "portlet-api", version: "3.0.0"
diff --git a/modules/apps/portal-workflow/portal-workflow-api/bnd.bnd b/modules/apps/portal-workflow/portal-workflow-api/bnd.bnd
index 75b94ef884dd59..f3d23b48e8fe1f 100644
--- a/modules/apps/portal-workflow/portal-workflow-api/bnd.bnd
+++ b/modules/apps/portal-workflow/portal-workflow-api/bnd.bnd
@@ -2,6 +2,7 @@ Bundle-Name: Liferay Portal Workflow API
Bundle-SymbolicName: com.liferay.portal.workflow.api
Bundle-Version: 1.2.5
Export-Package:\
+ com.liferay.portal.workflow.configuration,\
com.liferay.portal.workflow.constants,\
com.liferay.portal.workflow.definition.link.update.handler,\
com.liferay.portal.workflow.portlet.tab
diff --git a/modules/apps/portal-workflow/portal-workflow-api/build.gradle b/modules/apps/portal-workflow/portal-workflow-api/build.gradle
index f0079d7ed3d86f..1ededd51984414 100644
--- a/modules/apps/portal-workflow/portal-workflow-api/build.gradle
+++ b/modules/apps/portal-workflow/portal-workflow-api/build.gradle
@@ -5,4 +5,5 @@ dependencies {
compileOnly group: "javax.portlet", name: "portlet-api", version: "3.0.0"
compileOnly group: "javax.servlet", name: "javax.servlet-api", version: "3.0.1"
compileOnly group: "org.osgi", name: "org.osgi.core", version: "6.0.0"
+ compileOnly project(":apps:static:portal-configuration:portal-configuration-metatype-api")
}
\ No newline at end of file
diff --git a/modules/apps/portal-workflow/portal-workflow-api/src/main/java/com/liferay/portal/workflow/configuration/WorkflowDefinitionConfiguration.java b/modules/apps/portal-workflow/portal-workflow-api/src/main/java/com/liferay/portal/workflow/configuration/WorkflowDefinitionConfiguration.java
new file mode 100644
index 00000000000000..3a2a2d7e08a8cf
--- /dev/null
+++ b/modules/apps/portal-workflow/portal-workflow-api/src/main/java/com/liferay/portal/workflow/configuration/WorkflowDefinitionConfiguration.java
@@ -0,0 +1,41 @@
+/\*\*
+ \* Copyright (c) 2000-present Liferay, Inc. All rights reserved.
+ \*
+ \* This library is free software; you can redistribute it and/or modify it under
+ \* the terms of the GNU Lesser General Public License as published by the Free
+ \* Software Foundation; either version 2.1 of the License, or (at your option)
+ \* any later version.
+ \*
+ \* This library is distributed in the hope that it will be useful, but WITHOUT
+ \* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
+ \* FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
+ \* details.
+ \*/
+
+package com.liferay.portal.workflow.configuration;
+
+import aQute.bnd.annotation.metatype.Meta;
+
+import com.liferay.portal.configuration.metatype.annotations.ExtendedObjectClassDefinition;
+
+/\*\*
+ \* @author Tomas Polesovsky
+ \*/
+@ExtendedObjectClassDefinition(category = "workflow")
+@Meta.OCD(
+ id = "com.liferay.portal.workflow.configuration.WorkflowDefinitionConfiguration",
+ localization = "content/Language",
+ name = "workflow-definition-configuration-name"
+)
+public interface WorkflowDefinitionConfiguration {
+
+ @Meta.AD(
+ deflt = "false",
+ description = "allow-administrators-to-publish-and-edit-workflows-description",
+ id = "company.administrator.can.publish",
+ name = "allow-administrators-to-publish-and-edit-workflows",
+ required = false
+ )
+ public boolean companyAdministratorCanPublish();
+
+}
\ No newline at end of file
diff --git a/modules/apps/portal-workflow/portal-workflow-api/src/main/resources/com/liferay/portal/workflow/configuration/packageinfo b/modules/apps/portal-workflow/portal-workflow-api/src/main/resources/com/liferay/portal/workflow/configuration/packageinfo
new file mode 100644
index 00000000000000..e2525561ab2e7b
--- /dev/null
+++ b/modules/apps/portal-workflow/portal-workflow-api/src/main/resources/com/liferay/portal/workflow/configuration/packageinfo
@@ -0,0 +1 @@
+version 1.0.0
\ No newline at end of file
diff --git a/modules/apps/portal-workflow/portal-workflow-kaleo-api/src/main/java/com/liferay/portal/workflow/kaleo/service/KaleoTaskInstanceTokenLocalService.java b/modules/apps/portal-workflow/portal-workflow-kaleo-api/src/main/java/com/liferay/portal/workflow/kaleo/service/KaleoTaskInstanceTokenLocalService.java
index 11c8e1e52ea14e..95d140d492dc36 100644
--- a/modules/apps/portal-workflow/portal-workflow-kaleo-api/src/main/java/com/liferay/portal/workflow/kaleo/service/KaleoTaskInstanceTokenLocalService.java
+++ b/modules/apps/portal-workflow/portal-workflow-kaleo-api/src/main/java/com/liferay/portal/workflow/kaleo/service/KaleoTaskInstanceTokenLocalService.java
@@ -366,6 +366,18 @@ public List search(
OrderByComparator orderByComparator,
ServiceContext serviceContext);
+ @Transactional(propagation = Propagation.SUPPORTS, readOnly = true)
+ public int searchCount(
+ long kaleoInstanceId, Boolean completed, Boolean searchByUserRoles,
+ ServiceContext serviceContext);
+
+ @Transactional(propagation = Propagation.SUPPORTS, readOnly = true)
+ public int searchCount(
+ Long kaleoInstanceId, String assetTitle, String taskName,
+ String[] assetTypes, Long[] assetPrimaryKeys, Date dueDateGT,
+ Date dueDateLT, Boolean completed, Boolean searchByUserRoles,
+ boolean andOperator, ServiceContext serviceContext);
+
@Transactional(propagation = Propagation.SUPPORTS, readOnly = true)
public int searchCount(
String keywords, Boolean completed, Boolean searchByUserRoles,
diff --git a/modules/apps/portal-workflow/portal-workflow-kaleo-api/src/main/java/com/liferay/portal/workflow/kaleo/service/KaleoTaskInstanceTokenLocalServiceUtil.java b/modules/apps/portal-workflow/portal-workflow-kaleo-api/src/main/java/com/liferay/portal/workflow/kaleo/service/KaleoTaskInstanceTokenLocalServiceUtil.java
index 4ac69cbb7b1bdf..aba0bba5182569 100644
--- a/modules/apps/portal-workflow/portal-workflow-kaleo-api/src/main/java/com/liferay/portal/workflow/kaleo/service/KaleoTaskInstanceTokenLocalServiceUtil.java
+++ b/modules/apps/portal-workflow/portal-workflow-kaleo-api/src/main/java/com/liferay/portal/workflow/kaleo/service/KaleoTaskInstanceTokenLocalServiceUtil.java
@@ -533,6 +533,27 @@  search(
orderByComparator, serviceContext);
}
+ public static int searchCount(
+ long kaleoInstanceId, Boolean completed, Boolean searchByUserRoles,
+ com.liferay.portal.kernel.service.ServiceContext serviceContext) {
+
+ return getService().searchCount(
+ kaleoInstanceId, completed, searchByUserRoles, serviceContext);
+ }
+
+ public static int searchCount(
+ Long kaleoInstanceId, String assetTitle, String taskName,
+ String[] assetTypes, Long[] assetPrimaryKeys, java.util.Date dueDateGT,
+ java.util.Date dueDateLT, Boolean completed, Boolean searchByUserRoles,
+ boolean andOperator,
+ com.liferay.portal.kernel.service.ServiceContext serviceContext) {
+
+ return getService().searchCount(
+ kaleoInstanceId, assetTitle, taskName, assetTypes, assetPrimaryKeys,
+ dueDateGT, dueDateLT, completed, searchByUserRoles, andOperator,
+ serviceContext);
+ }
+
public static int searchCount(
String keywords, Boolean completed, Boolean searchByUserRoles,
com.liferay.portal.kernel.service.ServiceContext serviceContext) {
diff --git a/modules/apps/portal-workflow/portal-workflow-kaleo-api/src/main/java/com/liferay/portal/workflow/kaleo/service/KaleoTaskInstanceTokenLocalServiceWrapper.java b/modules/apps/portal-workflow/portal-workflow-kaleo-api/src/main/java/com/liferay/portal/workflow/kaleo/service/KaleoTaskInstanceTokenLocalServiceWrapper.java
index 97c2ecc09cb7a9..f7a90854f5044b 100644
--- a/modules/apps/portal-workflow/portal-workflow-kaleo-api/src/main/java/com/liferay/portal/workflow/kaleo/service/KaleoTaskInstanceTokenLocalServiceWrapper.java
+++ b/modules/apps/portal-workflow/portal-workflow-kaleo-api/src/main/java/com/liferay/portal/workflow/kaleo/service/KaleoTaskInstanceTokenLocalServiceWrapper.java
@@ -587,6 +587,29 @@  search(
orderByComparator, serviceContext);
}
+ @Override
+ public int searchCount(
+ long kaleoInstanceId, Boolean completed, Boolean searchByUserRoles,
+ com.liferay.portal.kernel.service.ServiceContext serviceContext) {
+
+ return \_kaleoTaskInstanceTokenLocalService.searchCount(
+ kaleoInstanceId, completed, searchByUserRoles, serviceContext);
+ }
+
+ @Override
+ public int searchCount(
+ Long kaleoInstanceId, String assetTitle, String taskName,
+ String[] assetTypes, Long[] assetPrimaryKeys, java.util.Date dueDateGT,
+ java.util.Date dueDateLT, Boolean completed, Boolean searchByUserRoles,
+ boolean andOperator,
+ com.liferay.portal.kernel.service.ServiceContext serviceContext) {
+
+ return \_kaleoTaskInstanceTokenLocalService.searchCount(
+ kaleoInstanceId, assetTitle, taskName, assetTypes, assetPrimaryKeys,
+ dueDateGT, dueDateLT, completed, searchByUserRoles, andOperator,
+ serviceContext);
+ }
+
@Override
public int searchCount(
String keywords, Boolean completed, Boolean searchByUserRoles,
diff --git a/modules/apps/portal-workflow/portal-workflow-kaleo-definition-impl/build.gradle b/modules/apps/portal-workflow/portal-workflow-kaleo-definition-impl/build.gradle
index 85b45360143015..28c436b8fe17e9 100644
--- a/modules/apps/portal-workflow/portal-workflow-kaleo-definition-impl/build.gradle
+++ b/modules/apps/portal-workflow/portal-workflow-kaleo-definition-impl/build.gradle
@@ -4,4 +4,6 @@ dependencies {
compileOnly group: "com.liferay", name: "com.liferay.portal.workflow.kaleo.definition.api", version: "3.0.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "3.0.0"
compileOnly group: "org.osgi", name: "org.osgi.service.component.annotations", version: "1.3.0"
+ compileOnly project(":apps:portal-workflow:portal-workflow-api")
+ compileOnly project(":apps:static:portal-configuration:portal-configuration-metatype-api")
}
\ No newline at end of file
diff --git a/modules/apps/portal-workflow/portal-workflow-kaleo-definition-impl/src/main/java/com/liferay/portal/workflow/kaleo/definition/internal/deployment/DefaultWorkflowDeployer.java b/modules/apps/portal-workflow/portal-workflow-kaleo-definition-impl/src/main/java/com/liferay/portal/workflow/kaleo/definition/internal/deployment/DefaultWorkflowDeployer.java
index c7f1ef969bd049..3ca49b841521a5 100644
--- a/modules/apps/portal-workflow/portal-workflow-kaleo-definition-impl/src/main/java/com/liferay/portal/workflow/kaleo/definition/internal/deployment/DefaultWorkflowDeployer.java
+++ b/modules/apps/portal-workflow/portal-workflow-kaleo-definition-impl/src/main/java/com/liferay/portal/workflow/kaleo/definition/internal/deployment/DefaultWorkflowDeployer.java
@@ -14,9 +14,14 @@
package com.liferay.portal.workflow.kaleo.definition.internal.deployment;
+import com.liferay.portal.configuration.metatype.bnd.util.ConfigurableUtil;
import com.liferay.portal.kernel.exception.PortalException;
+import com.liferay.portal.kernel.security.auth.PrincipalException;
+import com.liferay.portal.kernel.security.permission.PermissionChecker;
+import com.liferay.portal.kernel.security.permission.PermissionThreadLocal;
import com.liferay.portal.kernel.service.ServiceContext;
import com.liferay.portal.kernel.workflow.WorkflowDefinition;
+import com.liferay.portal.workflow.configuration.WorkflowDefinitionConfiguration;
import com.liferay.portal.workflow.kaleo.KaleoWorkflowModelConverter;
import com.liferay.portal.workflow.kaleo.definition.Condition;
import com.liferay.portal.workflow.kaleo.definition.Definition;
@@ -41,13 +46,20 @@
import java.util.HashMap;
import java.util.Map;
+import org.osgi.service.component.annotations.Activate;
import org.osgi.service.component.annotations.Component;
+import org.osgi.service.component.annotations.ConfigurationPolicy;
+import org.osgi.service.component.annotations.Modified;
import org.osgi.service.component.annotations.Reference;
/\*\*
\* @author Michael C. Han
\*/
-@Component(immediate = true, service = WorkflowDeployer.class)
+@Component(
+ configurationPid = "com.liferay.portal.workflow.configuration.WorkflowDefinitionConfiguration",
+ configurationPolicy = ConfigurationPolicy.OPTIONAL, immediate = true,
+ service = WorkflowDeployer.class
+)
public class DefaultWorkflowDeployer implements WorkflowDeployer {
/\*\*
@@ -69,6 +81,8 @@ public WorkflowDefinition deploy(
ServiceContext serviceContext)
throws PortalException {
+ checkPermissions();
+
KaleoDefinition kaleoDefinition = \_addOrUpdateKaleoDefinition(
title, name, definition, serviceContext);
@@ -173,6 +187,40 @@ public WorkflowDefinition save(
kaleoDefinition);
}
+ @Activate
+ @Modified
+ protected void activate(Map properties) {
+ WorkflowDefinitionConfiguration workflowDefinitionConfiguration =
+ ConfigurableUtil.createConfigurable(
+ WorkflowDefinitionConfiguration.class, properties);
+
+ \_companyAdministratorCanPublish =
+ workflowDefinitionConfiguration.companyAdministratorCanPublish();
+ }
+
+ protected void checkPermissions() throws PrincipalException {
+ PermissionChecker permissionChecker =
+ PermissionThreadLocal.getPermissionChecker();
+
+ if (permissionChecker == null) {
+ return;
+ }
+
+ if (!permissionChecker.isCompanyAdmin()) {
+ throw new PrincipalException.MustBeCompanyAdmin(
+ permissionChecker.getUserId());
+ }
+
+ if (\_companyAdministratorCanPublish) {
+ return;
+ }
+
+ if (!permissionChecker.isOmniadmin()) {
+ throw new PrincipalException.MustBeOmniadmin(
+ permissionChecker.getUserId());
+ }
+ }
+
private KaleoDefinition \_addOrUpdateKaleoDefinition(
String title, String name, Definition definition,
ServiceContext serviceContext)
@@ -198,6 +246,8 @@ private KaleoDefinition \_addOrUpdateKaleoDefinition(
return kaleoDefinition;
}
+ private boolean \_companyAdministratorCanPublish;
+
@Reference
private KaleoConditionLocalService \_kaleoConditionLocalService;
diff --git a/modules/apps/portal-workflow/portal-workflow-kaleo-runtime-integration-impl/build.gradle b/modules/apps/portal-workflow/portal-workflow-kaleo-runtime-integration-impl/build.gradle
index efbedb3ff2acda..3c04fad9badb17 100644
--- a/modules/apps/portal-workflow/portal-workflow-kaleo-runtime-integration-impl/build.gradle
+++ b/modules/apps/portal-workflow/portal-workflow-kaleo-runtime-integration-impl/build.gradle
@@ -1,9 +1,9 @@
dependencies {
compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "2.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.dao.orm.custom.sql.api", version: "1.0.0"
- compileOnly group: "com.liferay", name: "com.liferay.portal.workflow.kaleo.api", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.workflow.kaleo.definition.api", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.workflow.kaleo.runtime.api", version: "3.1.0"
- compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "3.58.0"
+ compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "default"
compileOnly group: "org.osgi", name: "org.osgi.service.component.annotations", version: "1.3.0"
+ compileOnly project(":apps:portal-workflow:portal-workflow-kaleo-api")
}
\ No newline at end of file
diff --git a/modules/apps/portal-workflow/portal-workflow-kaleo-runtime-integration-impl/src/main/java/com/liferay/portal/workflow/kaleo/runtime/integration/internal/WorkflowTaskManagerImpl.java b/modules/apps/portal-workflow/portal-workflow-kaleo-runtime-integration-impl/src/main/java/com/liferay/portal/workflow/kaleo/runtime/integration/internal/WorkflowTaskManagerImpl.java
index 0e41e5d6f83d91..66b4ea070c47c9 100644
--- a/modules/apps/portal-workflow/portal-workflow-kaleo-runtime-integration-impl/src/main/java/com/liferay/portal/workflow/kaleo/runtime/integration/internal/WorkflowTaskManagerImpl.java
+++ b/modules/apps/portal-workflow/portal-workflow-kaleo-runtime-integration-impl/src/main/java/com/liferay/portal/workflow/kaleo/runtime/integration/internal/WorkflowTaskManagerImpl.java
@@ -398,6 +398,26 @@ public int getWorkflowTaskCountByUserRoles(
}
}
+ @Override
+ public int getWorkflowTaskCountByUserRoles(
+ long companyId, long userId, long workflowInstanceId,
+ Boolean completed)
+ throws WorkflowException {
+
+ try {
+ ServiceContext serviceContext = new ServiceContext();
+
+ serviceContext.setCompanyId(companyId);
+ serviceContext.setUserId(userId);
+
+ return \_kaleoTaskInstanceTokenLocalService.searchCount(
+ workflowInstanceId, completed, Boolean.TRUE, serviceContext);
+ }
+ catch (Exception e) {
+ throw new WorkflowException(e);
+ }
+ }
+
@Override
public int getWorkflowTaskCountByWorkflowInstance(
long companyId, Long userId, long workflowInstanceId,
diff --git a/modules/apps/portal-workflow/portal-workflow-kaleo-service/build.gradle b/modules/apps/portal-workflow/portal-workflow-kaleo-service/build.gradle
index effb06aaea30e2..d5545ca4333378 100644
--- a/modules/apps/portal-workflow/portal-workflow-kaleo-service/build.gradle
+++ b/modules/apps/portal-workflow/portal-workflow-kaleo-service/build.gradle
@@ -15,7 +15,6 @@ dependencies {
compileOnly group: "com.liferay", name: "com.liferay.portal.search.spi", version: "2.1.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.spring.extender.api", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.upgrade.api", version: "2.0.0"
- compileOnly group: "com.liferay", name: "com.liferay.portal.workflow.kaleo.api", version: "3.3.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.workflow.kaleo.definition.api", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.workflow.kaleo.runtime.api", version: "3.0.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "3.0.0"
@@ -25,4 +24,5 @@ dependencies {
compileOnly group: "org.osgi", name: "org.osgi.core", version: "5.0.0"
compileOnly group: "org.osgi", name: "org.osgi.service.component.annotations", version: "1.3.0"
compileOnly group: "org.springframework", name: "spring-context", version: "4.1.9.RELEASE"
+ compileOnly project(":apps:portal-workflow:portal-workflow-kaleo-api")
}
\ No newline at end of file
diff --git a/modules/apps/portal-workflow/portal-workflow-kaleo-service/src/main/java/com/liferay/portal/workflow/kaleo/service/impl/KaleoTaskInstanceTokenLocalServiceImpl.java b/modules/apps/portal-workflow/portal-workflow-kaleo-service/src/main/java/com/liferay/portal/workflow/kaleo/service/impl/KaleoTaskInstanceTokenLocalServiceImpl.java
index 361d24e8fa40cb..d17e04558a7ad7 100644
--- a/modules/apps/portal-workflow/portal-workflow-kaleo-service/src/main/java/com/liferay/portal/workflow/kaleo/service/impl/KaleoTaskInstanceTokenLocalServiceImpl.java
+++ b/modules/apps/portal-workflow/portal-workflow-kaleo-service/src/main/java/com/liferay/portal/workflow/kaleo/service/impl/KaleoTaskInstanceTokenLocalServiceImpl.java
@@ -610,33 +610,20 @@ public List search(
@Override
public int searchCount(
- String keywords, Boolean completed, Boolean searchByUserRoles,
- ServiceContext serviceContext) {
-
- return searchCount(
- keywords, keywords, null, null, null, completed, searchByUserRoles,
- false, serviceContext);
- }
-
- @Override
- public int searchCount(
- String taskName, String assetType, Long[] assetPrimaryKeys,
- Date dueDateGT, Date dueDateLT, Boolean completed,
- Boolean searchByUserRoles, boolean andOperator,
+ long kaleoInstanceId, Boolean completed, Boolean searchByUserRoles,
ServiceContext serviceContext) {
return searchCount(
- null, taskName, getAssetTypes(assetType), assetPrimaryKeys,
- dueDateGT, dueDateLT, completed, searchByUserRoles, andOperator,
- serviceContext);
+ kaleoInstanceId, null, null, null, null, null, null, completed,
+ searchByUserRoles, false, serviceContext);
}
@Override
public int searchCount(
- String assetTitle, String taskName, String[] assetTypes,
- Long[] assetPrimaryKeys, Date dueDateGT, Date dueDateLT,
- Boolean completed, Boolean searchByUserRoles, boolean andOperator,
- ServiceContext serviceContext) {
+ Long kaleoInstanceId, String assetTitle, String taskName,
+ String[] assetTypes, Long[] assetPrimaryKeys, Date dueDateGT,
+ Date dueDateLT, Boolean completed, Boolean searchByUserRoles,
+ boolean andOperator, ServiceContext serviceContext) {
KaleoTaskInstanceTokenQuery kaleoTaskInstanceTokenQuery =
new KaleoTaskInstanceTokenQuery(serviceContext);
@@ -648,6 +635,7 @@ public int searchCount(
kaleoTaskInstanceTokenQuery.setCompleted(completed);
kaleoTaskInstanceTokenQuery.setDueDateGT(dueDateGT);
kaleoTaskInstanceTokenQuery.setDueDateLT(dueDateLT);
+ kaleoTaskInstanceTokenQuery.setKaleoInstanceId(kaleoInstanceId);
kaleoTaskInstanceTokenQuery.setSearchByUserRoles(searchByUserRoles);
kaleoTaskInstanceTokenQuery.setTaskName(taskName);
@@ -671,13 +659,48 @@ public int searchCount(
return 0;
}
+ @Override
+ public int searchCount(
+ String keywords, Boolean completed, Boolean searchByUserRoles,
+ ServiceContext serviceContext) {
+
+ return searchCount(
+ keywords, keywords, null, null, null, completed, searchByUserRoles,
+ false, serviceContext);
+ }
+
+ @Override
+ public int searchCount(
+ String taskName, String assetType, Long[] assetPrimaryKeys,
+ Date dueDateGT, Date dueDateLT, Boolean completed,
+ Boolean searchByUserRoles, boolean andOperator,
+ ServiceContext serviceContext) {
+
+ return searchCount(
+ null, null, taskName, getAssetTypes(assetType), assetPrimaryKeys,
+ dueDateGT, dueDateLT, completed, searchByUserRoles, andOperator,
+ serviceContext);
+ }
+
+ @Override
+ public int searchCount(
+ String assetTitle, String taskName, String[] assetTypes,
+ Long[] assetPrimaryKeys, Date dueDateGT, Date dueDateLT,
+ Boolean completed, Boolean searchByUserRoles, boolean andOperator,
+ ServiceContext serviceContext) {
+
+ return searchCount(
+ null, assetTitle, taskName, assetTypes, assetPrimaryKeys, dueDateGT,
+ dueDateLT, completed, searchByUserRoles, false, serviceContext);
+ }
+
@Override
public int searchCount(
String keywords, String[] assetTypes, Boolean completed,
Boolean searchByUserRoles, ServiceContext serviceContext) {
return searchCount(
- keywords, keywords, assetTypes, null, null, null, completed,
+ null, keywords, keywords, assetTypes, null, null, null, completed,
searchByUserRoles, false, serviceContext);
}
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language.properties
index d4bc8df1c9932d..8423aed4cae998 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=A deleted workflow cannot be recovered.
action-undone=Action undone.
activity-description=Activity Description
add-new-x=Add New {0}
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances).
an-error-occurred-while-retrieving-the-list-of-instances=An error occurred while retrieving the list of publication requests. Please contact an administrator.
configure-assignments=Configure Assignments
copy-does-not-include-revisions=This copy does not include the revision history.
@@ -76,6 +78,7 @@ withdraw-submission=Withdraw Submission
workflow-assigned=Workflow Assigned
workflow-assigned-to-x=Workflow assigned to {0}.
workflow-configuration=Workflow Configuration
+workflow-definition-configuration-name=Workflow Definition
workflow-deleted-successfully=Workflow deleted successfully.
workflow-in-use-remove-assignement-to-x-x=Workflow in use. Remove its assignment to this asset: {0}. {1}
workflow-in-use-remove-assignements-to-x-and-x-x=Workflow in use. Remove its assignments to these assets: {0} and {1}. {2}
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_ar.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_ar.properties
index f6933c86ad08af..4becd03ceba9e1 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_ar.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_ar.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=   
action-undone=   .
activity-description= 
add-new-x= {0} 
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=      .     .
configure-assignments= 
copy-does-not-include-revisions=      .
@@ -76,6 +78,7 @@ withdraw-submission= 
workflow-assigned=  
workflow-assigned-to-x=     {0}.
workflow-configuration=  
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=    .
workflow-in-use-remove-assignement-to-x-x=   .      : {0}. {1}
workflow-in-use-remove-assignements-to-x-and-x-x=   .      : {0}  {1}. {2}
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_bg.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_bg.properties
index c0ca05a0e8e19f..45b624dc78dded 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_bg.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_bg.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=   
action-undone=  . (Automatic Translation)
activity-description=   (Automatic Translation)
add-new-x=Add New {0} (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=         .     . (Automatic Translation)
configure-assignments=   (Automatic Translation)
copy-does-not-include-revisions=      . (Automatic Translation)
@@ -76,6 +78,7 @@ withdraw-submission=  (Automatic Translation)
workflow-assigned=   (Automatic Translation)
workflow-assigned-to-x=Workflow assigned to {0}. (Automatic Copy)
workflow-configuration=  
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=  . (Automatic Translation)
workflow-in-use-remove-assignement-to-x-x=Workflow in use. Remove its assignment to this asset: {0}. {1} (Automatic Copy)
workflow-in-use-remove-assignements-to-x-and-x-x=Workflow in use. Remove its assignments to these assets: {0} and {1}. {2} (Automatic Copy)
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_ca.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_ca.properties
index 00ed034b6606e7..adf7c189372591 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_ca.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_ca.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=Un flux de treball eliminat no es pot rec
action-undone=Acci desfeta.
activity-description=Descripci de l'activitat
add-new-x=Afegeix un {0} nou
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=S'ha produt un error mentre es recuperava la llista de les sollicituds de publicaci. Poseu-vos en contacte amb un administrador.
configure-assignments=Configura les assignacions
copy-does-not-include-revisions=Aquesta cpia no inclou l'historial de revisi.
@@ -76,6 +78,7 @@ withdraw-submission=Retira la sollicitud
workflow-assigned=Flux de treball assignat
workflow-assigned-to-x=Flux de treball assignat a {0}.
workflow-configuration=Configuraci del flux de treball
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=Flux de treball suprimit correctament.
workflow-in-use-remove-assignement-to-x-x=Flux de treball en s. Desplaa la seva assignaci a aquest contingut: {0}. {1}
workflow-in-use-remove-assignements-to-x-and-x-x=Flux de treball en s. Desplaa les seves assignacions a aquests continguts: {0} i {1}. {2}
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_cs.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_cs.properties
index 10c4a4c64b1787..9dab698e3c153d 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_cs.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_cs.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=Nelze obnovit odstrann pracovn post
action-undone=Akce vrtit zpt. (Automatic Translation)
activity-description=Popis aktivity (Automatic Translation)
add-new-x=Pidat nov {0}
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=Pi zskvn seznamu poadavk na publikovn nastala chyba. Kontaktujte, prosm, sprvce.
configure-assignments=Konfigurace piazen (Automatic Translation)
copy-does-not-include-revisions=Tato kopie nezahrnuje historie reviz. (Automatic Translation)
@@ -76,6 +78,7 @@ withdraw-submission=Sthnout podn
workflow-assigned=Pracovn postup piazen (Automatic Translation)
workflow-assigned-to-x=Workflow assigned to {0}. (Automatic Copy)
workflow-configuration=Konfigurace workflow
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=Pracovn postup spn odstrann. (Automatic Translation)
workflow-in-use-remove-assignement-to-x-x=Workflow in use. Remove its assignment to this asset: {0}. {1} (Automatic Copy)
workflow-in-use-remove-assignements-to-x-and-x-x=Workflow in use. Remove its assignments to these assets: {0} and {1}. {2} (Automatic Copy)
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_da.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_da.properties
index c8203a7f3ef162..817a3e49a3fdba 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_da.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_da.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=A deleted workflow cannot be recovered. (
action-undone=Action undone. (Automatic Copy)
activity-description=Activity Description (Automatic Copy)
add-new-x=Tilfj ny i {0}
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=An error occurred while retrieving the list of publication requests. Please contact an administrator. (Automatic Copy)
configure-assignments=Configure Assignments (Automatic Copy)
copy-does-not-include-revisions=This copy does not include the revision history. (Automatic Copy)
@@ -76,6 +78,7 @@ withdraw-submission=Withdraw Submission (Automatic Copy)
workflow-assigned=Workflow Assigned (Automatic Copy)
workflow-assigned-to-x=Workflow assigned to {0}. (Automatic Copy)
workflow-configuration=Arbejdsproceskonfigurering
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=Workflow deleted successfully. (Automatic Copy)
workflow-in-use-remove-assignement-to-x-x=Workflow in use. Remove its assignment to this asset: {0}. {1} (Automatic Copy)
workflow-in-use-remove-assignements-to-x-and-x-x=Workflow in use. Remove its assignments to these assets: {0} and {1}. {2} (Automatic Copy)
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_de.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_de.properties
index 50af2c685b8237..14a6186b919b7c 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_de.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_de.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=Ein gelschter Workflow kann nicht wiede
action-undone=Aktion rckgngig gemacht.
activity-description=Beschreibung der Aktivitt
add-new-x=Neues/neuen {0} hinzufgen
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=Fehler beim Abrufen der Verffentlichungsantrge. Bitte wenden Sie sich an einen Administrator.
configure-assignments=Zuweisungen konfigurieren
copy-does-not-include-revisions=In dieser Kopie ist der berarbeitungsverlauf nicht enthalten.
@@ -76,6 +78,7 @@ withdraw-submission=Einsendung zurckziehen
workflow-assigned=Workflow zugewiesen
workflow-assigned-to-x=Workflow {0} zugewiesen.
workflow-configuration=Workflowkonfiguration
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=Workflow erfolgreich gelscht.
workflow-in-use-remove-assignement-to-x-x=Workflow wird genutzt. Zuweisung zu diesem Asset entfernen: {0}. {1}
workflow-in-use-remove-assignements-to-x-and-x-x=Workflow wird genutzt. Zuweisungen zu diesen Assets entfernen: {0} und {1}. {2}
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_el.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_el.properties
index d99f90beb18b66..c581a2f9d85c0b 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_el.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_el.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=   
action-undone=  . (Automatic Translation)
activity-description=  (Automatic Translation)
add-new-x=  {0}
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=         .     .
configure-assignments=    (Automatic Translation)
copy-does-not-include-revisions=       . (Automatic Translation)
@@ -76,6 +78,7 @@ withdraw-submission= 
workflow-assigned=     (Automatic Translation)
workflow-assigned-to-x=Workflow assigned to {0}. (Automatic Copy)
workflow-configuration=  
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully= ,   . (Automatic Translation)
workflow-in-use-remove-assignement-to-x-x=Workflow in use. Remove its assignment to this asset: {0}. {1} (Automatic Copy)
workflow-in-use-remove-assignements-to-x-and-x-x=Workflow in use. Remove its assignments to these assets: {0} and {1}. {2} (Automatic Copy)
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_en.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_en.properties
index d4bc8df1c9932d..8423aed4cae998 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_en.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_en.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=A deleted workflow cannot be recovered.
action-undone=Action undone.
activity-description=Activity Description
add-new-x=Add New {0}
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances).
an-error-occurred-while-retrieving-the-list-of-instances=An error occurred while retrieving the list of publication requests. Please contact an administrator.
configure-assignments=Configure Assignments
copy-does-not-include-revisions=This copy does not include the revision history.
@@ -76,6 +78,7 @@ withdraw-submission=Withdraw Submission
workflow-assigned=Workflow Assigned
workflow-assigned-to-x=Workflow assigned to {0}.
workflow-configuration=Workflow Configuration
+workflow-definition-configuration-name=Workflow Definition
workflow-deleted-successfully=Workflow deleted successfully.
workflow-in-use-remove-assignement-to-x-x=Workflow in use. Remove its assignment to this asset: {0}. {1}
workflow-in-use-remove-assignements-to-x-and-x-x=Workflow in use. Remove its assignments to these assets: {0} and {1}. {2}
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_es.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_es.properties
index e92cd637f29344..fd5c4de9b0fa76 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_es.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_es.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=No se puede recuperar un flujo de trabajo
action-undone=Accin deshecha.
activity-description=Descripcin de la actividad
add-new-x=Aadir nuevo {0}
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=Se ha producido un error al obtener la lista de instancias. Por favor, contacte con un administrador.
configure-assignments=Configurar asignaciones
copy-does-not-include-revisions=En esta copia no se incluye el historial de revisiones.
@@ -76,6 +78,7 @@ withdraw-submission=Retirar la solicitud
workflow-assigned=Flujo de trabajo asignado
workflow-assigned-to-x=Flujo de trabajo asignado a {0}.
workflow-configuration=Configuracin del Workflow
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=El flujo de trabajo se elimin correctamente.
workflow-in-use-remove-assignement-to-x-x=Flujo de trabajo en uso. Quite su asignacin de este activo: {0}. {1}
workflow-in-use-remove-assignements-to-x-and-x-x=Flujo de trabajo en uso. Quite sus asignaciones de estos activos: {0} y {1}. {2}
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_et.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_et.properties
index 1a054bbdd6e0fd..b5ea71010884be 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_et.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_et.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=Ei saa taastada kustutatud tvoo. (Aut
action-undone=Toimingu tagasi vtta. (Automatic Translation)
activity-description=Tegevuse kirjeldus (Automatic Translation)
add-new-x=Add New {0} (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=Loetelu avaldamise taotlusi toomisel ilmnes trge. Palun prduge administraatori poole. (Automatic Translation)
configure-assignments=Konfigureerige mrangud (Automatic Translation)
copy-does-not-include-revisions=Seda eksemplari ei sisalda lbivaatuse ajalugu. (Automatic Translation)
@@ -76,6 +78,7 @@ withdraw-submission=Thistada esitamise (Automatic Translation)
workflow-assigned=Tvoo mratud (Automatic Translation)
workflow-assigned-to-x=Workflow assigned to {0}. (Automatic Copy)
workflow-configuration=Tvoo konfiguratsiooni (Automatic Translation)
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=Tvoo edukalt kustutatud. (Automatic Translation)
workflow-in-use-remove-assignement-to-x-x=Workflow in use. Remove its assignment to this asset: {0}. {1} (Automatic Copy)
workflow-in-use-remove-assignements-to-x-and-x-x=Workflow in use. Remove its assignments to these assets: {0} and {1}. {2} (Automatic Copy)
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_eu.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_eu.properties
index 829106e1d5425a..58c4bc7aa33dc3 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_eu.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_eu.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=A deleted workflow cannot be recovered. (
action-undone=Action undone. (Automatic Copy)
activity-description=Activity Description (Automatic Copy)
add-new-x=Gehitu {0} Berria
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=Oker bat sortu da instantzien zerrenda eskuratzean. Mesedez, administratzaile batekin harremanetan jarri.
configure-assignments=Configure Assignments (Automatic Copy)
copy-does-not-include-revisions=This copy does not include the revision history. (Automatic Copy)
@@ -76,6 +78,7 @@ withdraw-submission=Eskaera kendu
workflow-assigned=Workflow Assigned (Automatic Copy)
workflow-assigned-to-x=Workflow assigned to {0}. (Automatic Copy)
workflow-configuration=Workflow konfigurazioa
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=Workflow deleted successfully. (Automatic Copy)
workflow-in-use-remove-assignement-to-x-x=Workflow in use. Remove its assignment to this asset: {0}. {1} (Automatic Copy)
workflow-in-use-remove-assignements-to-x-and-x-x=Workflow in use. Remove its assignments to these assets: {0} and {1}. {2} (Automatic Copy)
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_fa.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_fa.properties
index e7ebb11ff755a1..605a3d75f63fe0 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_fa.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_fa.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=     
action-undone=  . (Automatic Translation)
activity-description= 
add-new-x= {0} 
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=       .     .
configure-assignments=  (Automatic Translation)
copy-does-not-include-revisions=        . (Automatic Translation)
@@ -76,6 +78,7 @@ withdraw-submission=   
workflow-assigned=     (Automatic Translation)
workflow-assigned-to-x=Workflow assigned to {0}. (Automatic Copy)
workflow-configuration=   
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=    . (Automatic Translation)
workflow-in-use-remove-assignement-to-x-x=Workflow in use. Remove its assignment to this asset: {0}. {1} (Automatic Copy)
workflow-in-use-remove-assignements-to-x-and-x-x=Workflow in use. Remove its assignments to these assets: {0} and {1}. {2} (Automatic Copy)
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_fi.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_fi.properties
index 311a13f987cb74..ea797b5fa53bde 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_fi.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_fi.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=Poistettua tynkulkua ei voi palauttaa.
action-undone=Toiminto peruttu.
activity-description=Toiminnan kuvaus
add-new-x=Lis uusi {0}
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=Tapahtui virhe haettaessa julkaisupyyntj. Ole hyv ja ota yhteyt yllpitjn.
configure-assignments=Mrit Nimemiset
copy-does-not-include-revisions=Tm kopio ei sisll muutoshistoriaa.
@@ -76,6 +78,7 @@ withdraw-submission=Peruta lhetys
workflow-assigned=Tynkulku Kiinnitetty
workflow-assigned-to-x=Tynkulku nimetty {0}.
workflow-configuration=Tynkulun asetukset
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=Tynkulku poistettu onnistuneesti.
workflow-in-use-remove-assignement-to-x-x=Tynkulku kytss. Poista sen kiinnitys thn sisltn: {0}. {1}
workflow-in-use-remove-assignements-to-x-and-x-x=Tynkulku kytss. Poista sen kiinnitykset nihin sisltihin: {0} ja {1}. {2}
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_fr.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_fr.properties
index 1ac06afed252ee..f1ac6352b62834 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_fr.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_fr.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=Un flux de travail supprim ne peut tr
action-undone=Action annule.
activity-description=Description de l'activit
add-new-x=Ajouter Nouveau {0}
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=Une erreur s'est produite lors de la recherche de la liste des demandes de publication. Veuillez s'il vous plat contacter votre administrateur.
configure-assignments=Configurer les affectations
copy-does-not-include-revisions=Cette copie ne comprend pas d'historique de rvisions.
@@ -76,6 +78,7 @@ withdraw-submission=Retirer la soumission
workflow-assigned=Flux de travail affect
workflow-assigned-to-x=Flux de travail affect  {0}.
workflow-configuration=Configuration des processus
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=Le flux de travail a bien t supprim.
workflow-in-use-remove-assignement-to-x-x=Flux de travail utilis. Supprimez son affectation  cet actif : {0}. {1}
workflow-in-use-remove-assignements-to-x-and-x-x=Flux de travail utilis. Supprimez son affectation  ces actifs : {0} et {1}. {2}
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_gl.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_gl.properties
index 6def67bd127883..08db49fc071407 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_gl.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_gl.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=A deleted workflow cannot be recovered. (
action-undone=Action undone. (Automatic Copy)
activity-description=Activity Description (Automatic Copy)
add-new-x=Engadri novo en {0}
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=Produciuse un erro ao obter a lista de peticins de publicacin. Por favor, contacte co administrador.
configure-assignments=Configure Assignments (Automatic Copy)
copy-does-not-include-revisions=This copy does not include the revision history. (Automatic Copy)
@@ -76,6 +78,7 @@ withdraw-submission=Proposta de retirar
workflow-assigned=Workflow Assigned (Automatic Copy)
workflow-assigned-to-x=Workflow assigned to {0}. (Automatic Copy)
workflow-configuration=Configuracin dos procesos de traballo
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=Workflow deleted successfully. (Automatic Copy)
workflow-in-use-remove-assignement-to-x-x=Workflow in use. Remove its assignment to this asset: {0}. {1} (Automatic Copy)
workflow-in-use-remove-assignements-to-x-and-x-x=Workflow in use. Remove its assignments to these assets: {0} and {1}. {2} (Automatic Copy)
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_hi\_IN.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_hi\_IN.properties
index 8a2ec19f69fddc..466d0158150575 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_hi\_IN.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_hi\_IN.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=   
action-undone=   (Automatic Translation)
activity-description=  (Automatic Translation)
add-new-x=Add New {0} (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=                (Automatic Translation)
configure-assignments=   (Automatic Translation)
copy-does-not-include-revisions=        (Automatic Translation)
@@ -76,6 +78,7 @@ withdraw-submission=   (Automatic Translation)
workflow-assigned=    (Automatic Translation)
workflow-assigned-to-x=Workflow assigned to {0}. (Automatic Copy)
workflow-configuration= 
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=     (Automatic Translation)
workflow-in-use-remove-assignement-to-x-x=Workflow in use. Remove its assignment to this asset: {0}. {1} (Automatic Copy)
workflow-in-use-remove-assignements-to-x-and-x-x=Workflow in use. Remove its assignments to these assets: {0} and {1}. {2} (Automatic Copy)
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_hr.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_hr.properties
index 2a541b7ceb8240..eb51d20a6ccc5a 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_hr.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_hr.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=A deleted workflow cannot be recovered. (
action-undone=Action undone. (Automatic Copy)
activity-description=Activity Description (Automatic Copy)
add-new-x=Dodaj novi {0}
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=Dolo je do pogreke prilikom slanja popisa objavljivanja zahtjeva. Obratite se administratoru.
configure-assignments=Configure Assignments (Automatic Copy)
copy-does-not-include-revisions=This copy does not include the revision history. (Automatic Copy)
@@ -76,6 +78,7 @@ withdraw-submission=Povuci Prijava
workflow-assigned=Workflow Assigned (Automatic Copy)
workflow-assigned-to-x=Workflow assigned to {0}. (Automatic Copy)
workflow-configuration=Konfiguracija tijeka rada
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=Workflow deleted successfully. (Automatic Copy)
workflow-in-use-remove-assignement-to-x-x=Workflow in use. Remove its assignment to this asset: {0}. {1} (Automatic Copy)
workflow-in-use-remove-assignements-to-x-and-x-x=Workflow in use. Remove its assignments to these assets: {0} and {1}. {2} (Automatic Copy)
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_hu.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_hu.properties
index 04e235b3eb3a80..37aec68f6b85f2 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_hu.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_hu.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=Egy trlt munkafolyamat nem llthat
action-undone=A mvelet visszavonva.
activity-description=Tevkenysg lersa
add-new-x=j hozzadsa itt: {0}
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=Hiba trtnt a megjelensi krsek listjnak fogadsa kzben. Egy adminisztrtor tud segteni.
configure-assignments=Hozzrendelsek konfigurlsa
copy-does-not-include-revisions=Ez a msolat nem tartalmaz fellvizsglati elzmnyeket.
@@ -76,6 +78,7 @@ withdraw-submission=Beklds visszavonsa
workflow-assigned=Hozzrendelt munkafolyamat
workflow-assigned-to-x=Munkafolyamat megbzottja {0}.
workflow-configuration=Munkafolyamat konfigurci
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=A munkafolyamat sikeresen trlve.
workflow-in-use-remove-assignement-to-x-x=A munkafolyamat hasznlatban van. Tvoltsa el a tartalomhoz val hozzrendelst: {0}. {1}
workflow-in-use-remove-assignements-to-x-and-x-x=A munkafolyamat hasznlatban van. Tvoltsa el a tartalmakhoz val hozzrendelst: {0} s {1}. {2}
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_in.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_in.properties
index 4c39b042b1b1eb..6d0b54dabdfca7 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_in.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_in.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=Alur kerja yang dihapus tidak dapat dipul
action-undone=Aksi dibatalkan. (Automatic Translation)
activity-description=Deskripsi aktivitas (Automatic Translation)
add-new-x=Tambah Baru di {0}
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=Terjadi kesalahan saat mengambil daftar permintaan publikasi. Silakan hubungi administrator.
configure-assignments=Mengkonfigurasi tugas (Automatic Translation)
copy-does-not-include-revisions=Salinan ini tidak termasuk revisi sejarah. (Automatic Translation)
@@ -76,6 +78,7 @@ withdraw-submission=Withdraw Submission
workflow-assigned=Alur kerja ditetapkan (Automatic Translation)
workflow-assigned-to-x=Workflow assigned to {0}. (Automatic Copy)
workflow-configuration=Konfigurasi Workflow
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=Alur kerja yang berhasil dihapus. (Automatic Translation)
workflow-in-use-remove-assignement-to-x-x=Workflow in use. Remove its assignment to this asset: {0}. {1} (Automatic Copy)
workflow-in-use-remove-assignements-to-x-and-x-x=Workflow in use. Remove its assignments to these assets: {0} and {1}. {2} (Automatic Copy)
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_it.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_it.properties
index 2be05f9d9209e0..bd2fcb0841c99f 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_it.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_it.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=Un workflow eliminato non pu essere rec
action-undone=Operazione annullata. (Automatic Translation)
activity-description=Descrizione Attivit
add-new-x=Aggiungi Nuovo {0}
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=Si  verificato un errore mentre veniva richiamata la lista delle pubblicazioni richieste. Contatta l'amministratore.
configure-assignments=Configura le assegnazioni
copy-does-not-include-revisions=Questa copia non include la cronologia delle revisioni. (Automatic Translation)
@@ -76,6 +78,7 @@ withdraw-submission=Ritira Sottomissione
workflow-assigned=Flusso di lavoro assegnata (Automatic Translation)
workflow-assigned-to-x=Workflow assigned to {0}. (Automatic Copy)
workflow-configuration=Configurazione Workflow
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=Flusso di lavoro eliminato con successo. (Automatic Translation)
workflow-in-use-remove-assignement-to-x-x=Workflow in use. Remove its assignment to this asset: {0}. {1} (Automatic Copy)
workflow-in-use-remove-assignements-to-x-and-x-x=Workflow in use. Remove its assignments to these assets: {0} and {1}. {2} (Automatic Copy)
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_iw.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_iw.properties
index bc548372d65cff..25947bca1bd805 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_iw.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_iw.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=    
action-undone= .
activity-description= 
add-new-x= {0} 
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=      .     .
configure-assignments=  
copy-does-not-include-revisions=     .
@@ -76,6 +78,7 @@ withdraw-submission= 
workflow-assigned=  
workflow-assigned-to-x=   -{0}.
workflow-configuration=   
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=   .
workflow-in-use-remove-assignement-to-x-x=  .      : {0}. {1}
workflow-in-use-remove-assignements-to-x-and-x-x=  .      : {0} -{1}. {2}
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_ja.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_ja.properties
index d7013d0d8f0630..cc22154b59cd0a 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_ja.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_ja.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=
action-undone=
activity-description=
add-new-x={0} 
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=
configure-assignments=
copy-does-not-include-revisions=
@@ -76,6 +78,7 @@ withdraw-submission=
workflow-assigned=
workflow-assigned-to-x={0} 
workflow-configuration=
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=
workflow-in-use-remove-assignement-to-x-x={0}. {1}
workflow-in-use-remove-assignements-to-x-and-x-x={0} {1}. {2}
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_kk.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_kk.properties
new file mode 100644
index 00000000000000..6cf5aa57e3bce9
--- /dev/null
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_kk.properties
@@ -0,0 +1,113 @@
+a-deleted-workflow-cannot-be-recovered=A deleted workflow cannot be recovered. (Automatic Copy)
+action-undone=Action undone. (Automatic Copy)
+activity-description=Activity Description (Automatic Copy)
+add-new-x=Add New {0} (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
+an-error-occurred-while-retrieving-the-list-of-instances=An error occurred while retrieving the list of publication requests. Please contact an administrator. (Automatic Copy)
+configure-assignments=Configure Assignments (Automatic Copy)
+copy-does-not-include-revisions=This copy does not include the revision history. (Automatic Copy)
+definition-imported-sucessfully=Definition imported successfully. (Automatic Copy)
+delete-workflow-question=Delete workflow? (Automatic Copy)
+duplicate-workflow=Duplicate Workflow (Automatic Copy)
+duplicated-from-x=Duplicated from {0} (Automatic Copy)
+each-fork-node-requires-a-join-node-make-sure-all-forks-and-joins-are-properly-paired=Each fork node requires a join node. Make sure all forks and joins are properly paired. (Automatic Copy)
+fix-the-errors-between-the-fork-node-x-and-join-node-x=Fix the errors between the fork node {0} and join node {1}. (Automatic Copy)
+fork-x-and-join-x-nodes-must-be-paired=Fork {0} and join {1} nodes must be paired. (Automatic Copy)
+import-a-file=Import a file (Automatic Copy)
+javax.portlet.description.com\_liferay\_portal\_workflow\_web\_internal\_portlet\_SiteAdministrationWorkflowPortlet=Assign workflow processes to assets and monitor current processes. (Automatic Copy)
+javax.portlet.description.com\_liferay\_portal\_workflow\_web\_internal\_portlet\_UserWorkflowPortlet=Lists workflow processes started by you. (Automatic Copy)
+javax.portlet.title.com\_liferay\_portal\_workflow\_task\_web\_portlet\_MyWorkflowTaskPortlet=My Workflow Tasks (Automatic Copy)
+javax.portlet.title.com\_liferay\_portal\_workflow\_web\_internal\_portlet\_SiteAdministrationWorkflowPortlet=Workflow (Automatic Copy)
+javax.portlet.title.com\_liferay\_portal\_workflow\_web\_internal\_portlet\_UserWorkflowPortlet=My Submissions (Automatic Copy)
+javax.portlet.title.com\_liferay\_portal\_workflow\_web\_portlet\_ControlPanelWorkflowPortlet=Workflow (Automatic Copy)
+my-submissions=My Submissions (Automatic Copy)
+my-workflow-tasks=My Workflow Tasks (Automatic Copy)
+new-workflow=New Workflow (Automatic Copy)
+no-workflow-definitions-are-defined=No workflow definitions are defined. (Automatic Copy)
+not-published=Not Published (Automatic Copy)
+please-add-a-workflow-title-before-publishing=Please add a workflow title before publishing. (Automatic Copy)
+please-enter-a-valid-definition-before-publishing=Please enter a valid definition before publishing. (Automatic Copy)
+restored-to-revision-from-x=Restored to Revision from {0} (Automatic Copy)
+revision-from-x-by-x=Revision from {0}, by {1} (Automatic Copy)
+revision-history=Revision History (Automatic Copy)
+schemes=Schemes (Automatic Copy)
+specify-at-least-one-assignment-for-the-x-task-node=Specify at least one assignment for the {0} task node. (Automatic Copy)
+task-initially-assigned-to-x=Task initially assigned to {0}. (Automatic Copy)
+tasks=Tasks (Automatic Copy)
+the-assets-from-documents-and-media-and-forms-are-assigned-within-their-respective-applications=The assets from Documents and Media and Forms are assigned within their respective applications. (Automatic Copy)
+the-task-form-x-for-task-x-must-specify-a-form-reference-or-form-definition=The task form {0} for task {1} must specify a form reference or form definition. (Automatic Copy)
+the-version-from-x-is-not-valid-for-publication=The version from {0} is not valid for publication. Unpublish the workflow before restoring this version. (Automatic Copy)
+the-workflow-has-too-many-start-nodes-state-nodes-x-and-x=The workflow has too many start nodes (state nodes {0} and {1}). (Automatic Copy)
+the-x-fork-node-must-have-a-matching-join-node=The {0} fork node must have a matching join node. (Automatic Copy)
+the-x-node-cannot-have-an-incoming-transition=The {0} node cannot have an incoming transition. (Automatic Copy)
+the-x-node-has-an-empty-notification-template=The {0} node has an empty notification template. (Automatic Copy)
+the-x-node-must-have-an-incoming-transition=The {0} node must have an incoming transition. (Automatic Copy)
+the-x-node-must-have-an-outgoing-transition=The {0} node must have an outgoing transition. (Automatic Copy)
+the-x-node-must-have-at-least-two-outgoing-transitions=The {0} node must have at least two outgoing transitions. (Automatic Copy)
+the-x-transition-must-end-at-a-node=The {0} transition must end at a node. (Automatic Copy)
+the-x-transition-must-have-a-source-node=The {0} transition must have a source node. (Automatic Copy)
+there-are-no-completed-instances=There are no completed publication requests. (Automatic Copy)
+there-are-no-completed-instances-started-by-me=There are no completed publications requested by me. (Automatic Copy)
+there-are-no-completed-instances-started-by-me-with-the-specified-search-criteria=There are no completed publications requested by me with the specified search criteria. (Automatic Copy)
+there-are-no-completed-instances-with-the-specified-search-criteria=There are no completed publication requests with the specified search criteria. (Automatic Copy)
+there-are-no-completed-tasks=There are no completed tasks. (Automatic Copy)
+there-are-no-completed-tasks-with-the-specified-search-criteria=There are no completed tasks with the specified search criteria. (Automatic Copy)
+there-are-no-instances=There are no publication requests. (Automatic Copy)
+there-are-no-instances-started-by-me=There are no publications requested by me. (Automatic Copy)
+there-are-no-instances-started-by-me-with-the-specified-search-criteria=There are no publications requested by me with the specified search criteria. (Automatic Copy)
+there-are-no-instances-with-the-specified-search-criteria=There are no publication requests with the specified search criteria. (Automatic Copy)
+there-are-no-pending-instances=There are no pending publication requests. (Automatic Copy)
+there-are-no-pending-instances-started-by-me=There are no pending publications requested by me. (Automatic Copy)
+there-are-no-pending-instances-started-by-me-with-the-specified-search-criteria=There are no pending publications requested by me with the specified search criteria. (Automatic Copy)
+there-are-no-pending-instances-with-the-specified-search-criteria=There are no pending publication requests with the specified search criteria. (Automatic Copy)
+there-are-no-pending-tasks-assigned-to-you=There are no pending tasks assigned to you. (Automatic Copy)
+there-are-no-pending-tasks-assigned-to-you-with-the-specified-search-criteria=There are no pending tasks assigned to you with the specified search criteria. (Automatic Copy)
+there-are-no-pending-tasks-assigned-to-your-roles=There are no pending tasks assigned to your roles. (Automatic Copy)
+there-are-no-pending-tasks-assigned-to-your-roles-with-the-specified-search-criteria=There are no pending tasks assigned to your roles with the specified search criteria. (Automatic Copy)
+there-are-no-tasks=There are no tasks. (Automatic Copy)
+there-are-no-tasks-assigned-to-my-roles-with-the-specified-search-criteria=There are no tasks assigned to my roles with the specified search criteria. (Automatic Copy)
+there-are-no-tasks-assigned-to-you=There are no tasks assigned to you. (Automatic Copy)
+there-are-no-tasks-assigned-to-you-with-the-specified-search-criteria=There are no tasks assigned to you with the specified search criteria. (Automatic Copy)
+there-are-no-tasks-assigned-to-your-roles=There are no tasks assigned to your roles. (Automatic Copy)
+there-are-no-tasks-assigned-to-your-roles-with-the-specified-search-criteria=There are no tasks assigned to your roles with the specified search criteria. (Automatic Copy)
+there-are-no-tasks-with-the-specified-search-criteria=There are no tasks with the specified search criteria. (Automatic Copy)
+total-modifications=Total Modifications (Automatic Copy)
+untitled-workflow=Untitled Workflow (Automatic Copy)
+withdraw-submission=Withdraw Submission (Automatic Copy)
+workflow-assigned=Workflow Assigned (Automatic Copy)
+workflow-assigned-to-x=Workflow assigned to {0}. (Automatic Copy)
+workflow-configuration=Workflow Configuration (Automatic Copy)
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
+workflow-deleted-successfully=Workflow deleted successfully. (Automatic Copy)
+workflow-in-use-remove-assignement-to-x-x=Workflow in use. Remove its assignment to this asset: {0}. {1} (Automatic Copy)
+workflow-in-use-remove-assignements-to-x-and-x-x=Workflow in use. Remove its assignments to these assets: {0} and {1}. {2} (Automatic Copy)
+workflow-in-use-remove-assignements-to-x-x-and-x-more-x=Workflow in use. Remove its assignment to these Assets: {0}, {1} and {2} More. {3} (Automatic Copy)
+workflow-published-successfully=Workflow published successfully. (Automatic Copy)
+workflow-saved=Workflow saved. (Automatic Copy)
+workflow-submissions=Workflow Submissions (Automatic Copy)
+workflow-task-web-configuration-name=Workflow Task (Automatic Copy)
+workflow-triggered-on-article-submission=Workflow triggered on article submission. (Automatic Copy)
+workflow-triggered-on-blog-post-submission=Workflow triggered on blog post submission. (Automatic Copy)
+workflow-triggered-on-comment-submission=Workflow triggered on comment submission. (Automatic Copy)
+workflow-triggered-on-event-submission=Workflow triggered on event submission. (Automatic Copy)
+workflow-triggered-on-guest-user-account-submission=Workflow triggered on guest user account submission. (Automatic Copy)
+workflow-triggered-on-message-submission=Workflow triggered on message submission. (Automatic Copy)
+workflow-triggered-on-page-modification-in-the-stage-enviroment=Workflow triggered on page modification in the staging environment. (Automatic Copy)
+workflow-triggered-on-web-content-submission=Workflow triggered on web content submission. (Automatic Copy)
+workflow-triggered-on-wiki-page-submission=Workflow triggered on wiki page submission. (Automatic Copy)
+workflow-unassigned-from-x=Workflow unassigned from {0}. (Automatic Copy)
+workflow-unpublished-successfully=Workflow unpublished successfully. (Automatic Copy)
+workflow-updated-successfully=Workflow updated successfully. (Automatic Copy)
+workflow-web-configuration-name=Workflow (Automatic Copy)
+workflows=Workflows (Automatic Copy)
+write-your-definition-or-x=Write your definition or {0} (Automatic Copy)
+x-assigned-the-task-to-the-x-role={0} assigned the task to the {1} role. (Automatic Copy)
+x-by-x={0}, by {1} (Automatic Copy)
+x-revisions={0} Revisions (Automatic Copy)
+x-submitted-a-x-for-publication={0} submitted a {1} for publication. (Automatic Copy)
+x-updated-the-task={0} updated the task. (Automatic Copy)
+you-cannot-unpublish-or-delete-this-definition=You cannot unpublish or delete this definition. There are process instances that reference this definition. (Automatic Copy)
+you-have-unsaved-changes-do-you-want-to-proceed-without-saving=You have unsaved changes. Do you want to proceed without saving? (Automatic Copy)
+you-must-define-a-start-node=You must define a start node. (Automatic Copy)
+you-must-define-an-end-node=You must define an end node. (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_ko.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_ko.properties
index 0c0e36a3e5ef5e..87fe88a1cd957f 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_ko.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_ko.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=     
action-undone=  . (Automatic Translation)
activity-description=  (Automatic Translation)
add-new-x=Add New {0} (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=        .     . (Automatic Translation)
configure-assignments=  (Automatic Translation)
copy-does-not-include-revisions=      . (Automatic Translation)
@@ -76,6 +78,7 @@ withdraw-submission=  (Automatic Translation)
workflow-assigned=  (Automatic Translation)
workflow-assigned-to-x=Workflow assigned to {0}. (Automatic Copy)
workflow-configuration=Portlet
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=   . (Automatic Translation)
workflow-in-use-remove-assignement-to-x-x=Workflow in use. Remove its assignment to this asset: {0}. {1} (Automatic Copy)
workflow-in-use-remove-assignements-to-x-and-x-x=Workflow in use. Remove its assignments to these assets: {0} and {1}. {2} (Automatic Copy)
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_lo.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_lo.properties
index f8dc8be9450f50..51ac69c7fc0c42 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_lo.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_lo.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=A deleted workflow cannot be recovered. (
action-undone=Action undone. (Automatic Copy)
activity-description=Activity Description (Automatic Copy)
add-new-x= {0}
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=.
configure-assignments=Configure Assignments (Automatic Copy)
copy-does-not-include-revisions=This copy does not include the revision history. (Automatic Copy)
@@ -76,6 +78,7 @@ withdraw-submission=
workflow-assigned=Workflow Assigned (Automatic Copy)
workflow-assigned-to-x=Workflow assigned to {0}. (Automatic Copy)
workflow-configuration=
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=Workflow deleted successfully. (Automatic Copy)
workflow-in-use-remove-assignement-to-x-x=Workflow in use. Remove its assignment to this asset: {0}. {1} (Automatic Copy)
workflow-in-use-remove-assignements-to-x-and-x-x=Workflow in use. Remove its assignments to these assets: {0} and {1}. {2} (Automatic Copy)
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_lt.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_lt.properties
index ea8b9b2befe6c7..b558baeed32f2d 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_lt.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_lt.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=Panaikint darbo eiga negali bti iie
action-undone=Veiksmai anuliuojami. (Automatic Translation)
activity-description=Veiklos apraymas (Automatic Translation)
add-new-x=Add New {0} (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=Nuskaitant paskelbimo uklaus sra vyko klaida. Praome susisiekti su administratoriumi. (Automatic Translation)
configure-assignments=Konfigruoti uduotis (Automatic Translation)
copy-does-not-include-revisions=i kopija nra taisym istorij. (Automatic Translation)
@@ -76,6 +78,7 @@ withdraw-submission=Ataukti pateikim (Automatic Translation)
workflow-assigned=Priskirtas darbo eigos (Automatic Translation)
workflow-assigned-to-x=Workflow assigned to {0}. (Automatic Copy)
workflow-configuration=Darbo eigos konfigracijos (Automatic Translation)
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=Darbo eigos skmingai itrintas. (Automatic Translation)
workflow-in-use-remove-assignement-to-x-x=Workflow in use. Remove its assignment to this asset: {0}. {1} (Automatic Copy)
workflow-in-use-remove-assignements-to-x-and-x-x=Workflow in use. Remove its assignments to these assets: {0} and {1}. {2} (Automatic Copy)
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_nb.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_nb.properties
index 2dd36184e8d3a4..f432dbbf1ed611 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_nb.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_nb.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=En slettet arbeidsflyt kan ikke gjenoppre
action-undone=Handlingen ugjort. (Automatic Translation)
activity-description=Beskrivelse (Automatic Translation)
add-new-x=Legg til ny {0}
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=En feil oppstod ved opphenting av liste med publikasjoner. Vennligst kontakt administrator.
configure-assignments=Konfigurere tildelinger (Automatic Translation)
copy-does-not-include-revisions=Denne utgaven inkluderer ikke revisjonsloggen. (Automatic Translation)
@@ -76,6 +78,7 @@ withdraw-submission=Trekk tilbake innsendelse
workflow-assigned=Arbeidsflyt tildelt (Automatic Translation)
workflow-assigned-to-x=Workflow assigned to {0}. (Automatic Copy)
workflow-configuration=Konfigurering av arbeidsflyt
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=Arbeidsflyt ble slettet. (Automatic Translation)
workflow-in-use-remove-assignement-to-x-x=Workflow in use. Remove its assignment to this asset: {0}. {1} (Automatic Copy)
workflow-in-use-remove-assignements-to-x-and-x-x=Workflow in use. Remove its assignments to these assets: {0} and {1}. {2} (Automatic Copy)
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_nl.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_nl.properties
index 633c671817a046..04afe0a54e9f8e 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_nl.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_nl.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=Een verwijderde workflow kan niet worden
action-undone=Actie ongedaan gemaakt.
activity-description=Activiteitsomschrijving
add-new-x=Nieuwe {0} toevoegen
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=Er trad een fout op tijdens het ophalen van de lijst van instanties. Neem contact op met een beheerder.
configure-assignments=Toewijzingen configureren
copy-does-not-include-revisions=Dit exemplaar bevat geen revisiegeschiedenis.
@@ -76,6 +78,7 @@ withdraw-submission=Inzending intrekken
workflow-assigned=Workflow toegewezen
workflow-assigned-to-x=Workflow toegewezen aan {0}.
workflow-configuration=Werkstroomconfiguratie
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=Workflow verwijderd.
workflow-in-use-remove-assignement-to-x-x=Workflow in gebruik. Verwijder de toewijzing aan deze asset: {0}. {1}
workflow-in-use-remove-assignements-to-x-and-x-x=Workflow in gebruik. Verwijder de toewijzingen aan deze assets: {0} en {1}. {2}
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_nl\_BE.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_nl\_BE.properties
index 21d2a9fb28c08a..a6765ce09d7b33 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_nl\_BE.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_nl\_BE.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=A deleted workflow cannot be recovered. (
action-undone=Action undone. (Automatic Copy)
activity-description=Activiteitsomschrijving
add-new-x=Nieuw toevoegen in {0}
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=Er trad een fout op tijdens het ophalen van de publicatieverzoekenlijsr. Neem a.u.b. contact op met de administrator.
configure-assignments=Configure Assignments (Automatic Copy)
copy-does-not-include-revisions=This copy does not include the revision history. (Automatic Copy)
@@ -76,6 +78,7 @@ withdraw-submission=Inzending intrekken
workflow-assigned=Workflow Assigned (Automatic Copy)
workflow-assigned-to-x=Workflow assigned to {0}. (Automatic Copy)
workflow-configuration=Workflow
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=Workflow deleted successfully. (Automatic Copy)
workflow-in-use-remove-assignement-to-x-x=Workflow in use. Remove its assignment to this asset: {0}. {1} (Automatic Copy)
workflow-in-use-remove-assignements-to-x-and-x-x=Workflow in use. Remove its assignments to these assets: {0} and {1}. {2} (Automatic Copy)
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_pl.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_pl.properties
index 4f9959a1ec97df..e66b650d229d7e 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_pl.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_pl.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=Nie mona odzyska usunitych przepy
action-undone=Czynnoo, cofnite. (Automatic Translation)
activity-description=Opis dziaalnoci (Automatic Translation)
add-new-x=Dodaj nowy w {0}
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=Podczas pobierania listy wnioskw o publikacj wystpi bd. Prosz skontaktowa si z administratorem.
configure-assignments=Konfigurowanie przypisania (Automatic Translation)
copy-does-not-include-revisions=Kopia ta nie obejmuje histori zmian. (Automatic Translation)
@@ -76,6 +78,7 @@ withdraw-submission=Wycofaj zgoszenie
workflow-assigned=Przypisano przepyw pracy (Automatic Translation)
workflow-assigned-to-x=Workflow assigned to {0}. (Automatic Copy)
workflow-configuration=Konfiguracja przepywu pracy
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=Przepywu pracy, usunite pomylnie. (Automatic Translation)
workflow-in-use-remove-assignement-to-x-x=Workflow in use. Remove its assignment to this asset: {0}. {1} (Automatic Copy)
workflow-in-use-remove-assignements-to-x-and-x-x=Workflow in use. Remove its assignments to these assets: {0} and {1}. {2} (Automatic Copy)
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_pt\_BR.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_pt\_BR.properties
index a2398ae4c72378..e74fe06541fb04 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_pt\_BR.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_pt\_BR.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=Um fluxo de trabalho excludo no pode
action-undone=Ao desfeita.
activity-description=Descrio da atividade
add-new-x=Adicionar Novo {0}
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=Um erro ocorreu enquanto obtia a lista de solicitaes de publicao. Por favor, contate o administrador.
configure-assignments=Configurar atribuies
copy-does-not-include-revisions=Esta cpia no inclui o histrico de reviso.
@@ -76,6 +78,7 @@ withdraw-submission=Suspenda a submisso
workflow-assigned=Fluxo de trabalho atribudo
workflow-assigned-to-x=Fluxo de trabalho atribudo para {0}.
workflow-configuration=Configurao de Fluxo de Trabalho
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=Fluxo de Trabalho foi excludo com sucesso.
workflow-in-use-remove-assignement-to-x-x=Fluxo de trabalho em uso. Remova sua atribuio a este ativo: {0}. {1}
workflow-in-use-remove-assignements-to-x-and-x-x=Fluxo de trabalho em uso. Remova suas atribuies a estes ativos: {0} e {1}. {2}
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_pt\_PT.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_pt\_PT.properties
index 0b450b3f5c31c7..0153b5676a8895 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_pt\_PT.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_pt\_PT.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=Um fluxo de trabalho excludo no pode
action-undone=Ao desfeita. (Automatic Translation)
activity-description=Descrio da atividade
add-new-x=Adicionar Novo {0}
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=Ocorreu um erro ao recuperar a lista de pedidos de publicao. Por favor, contacte um administrador.
configure-assignments=Configurar as atribuies (Automatic Translation)
copy-does-not-include-revisions=This copy does not include the revision history. (Automatic Copy)
@@ -76,6 +78,7 @@ withdraw-submission=Suspender a Submisso
workflow-assigned=Fluxo de trabalho atribudo (Automatic Translation)
workflow-assigned-to-x=Workflow assigned to {0}. (Automatic Copy)
workflow-configuration=Configurao de Fluxos
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=Fluxo de trabalho excludo com sucesso. (Automatic Translation)
workflow-in-use-remove-assignement-to-x-x=Workflow in use. Remove its assignment to this asset: {0}. {1} (Automatic Copy)
workflow-in-use-remove-assignements-to-x-and-x-x=Workflow in use. Remove its assignments to these assets: {0} and {1}. {2} (Automatic Copy)
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_ro.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_ro.properties
index 2ac9782aa667ca..ab6bdebd9ed45a 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_ro.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_ro.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=Un flux de lucru terse nu pot fi recupe
action-undone=Aciune anulat. (Automatic Translation)
activity-description=Activitate Descriere (Automatic Translation)
add-new-x=Adauga {0} Nou in Grup
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=O eroare a aprut n timpul recuperrii listei de cereri publice. Te rog contacteaz administratorul.
configure-assignments=Configurai misiuni (Automatic Translation)
copy-does-not-include-revisions=Aceast copie nu include istoria revizie. (Automatic Translation)
@@ -76,6 +78,7 @@ withdraw-submission=Retrare depunerea
workflow-assigned=Flux de lucru asociat (Automatic Translation)
workflow-assigned-to-x=Workflow assigned to {0}. (Automatic Copy)
workflow-configuration=Configuraiile fluxului de lucru
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=Flux de lucru ters cu succes. (Automatic Translation)
workflow-in-use-remove-assignement-to-x-x=Workflow in use. Remove its assignment to this asset: {0}. {1} (Automatic Copy)
workflow-in-use-remove-assignements-to-x-and-x-x=Workflow in use. Remove its assignments to these assets: {0} and {1}. {2} (Automatic Copy)
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_ru.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_ru.properties
index 91b66c2ffc95cd..bfa3a4fc9cb254 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_ru.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_ru.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=  
action-undone= . (Automatic Translation)
activity-description=  (Automatic Translation)
add-new-x=   {0}
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=        . ,   .
configure-assignments=  (Automatic Translation)
copy-does-not-include-revisions=       . (Automatic Translation)
@@ -76,6 +78,7 @@ withdraw-submission= 
workflow-assigned=   (Automatic Translation)
workflow-assigned-to-x=Workflow assigned to {0}. (Automatic Copy)
workflow-configuration=  
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=   . (Automatic Translation)
workflow-in-use-remove-assignement-to-x-x=Workflow in use. Remove its assignment to this asset: {0}. {1} (Automatic Copy)
workflow-in-use-remove-assignements-to-x-and-x-x=Workflow in use. Remove its assignments to these assets: {0} and {1}. {2} (Automatic Copy)
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_sk.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_sk.properties
index 0f7a4d102de303..edd7c4d3d6240c 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_sk.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_sk.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=Odstrnen pracovn postup sa ned ob
action-undone=Akciu vrti sp. (Automatic Translation)
activity-description=Popis predmetu innosti (Automatic Translation)
add-new-x=Prida nov {0}
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=Pri zskavan zoznamu poiadaviek na publikovanie nastala chyba. Kontaktujte prosm administrtora.
configure-assignments=Konfigurcia priradenia (Automatic Translation)
copy-does-not-include-revisions=Tto kpia neobsahuje histrie revzi. (Automatic Translation)
@@ -76,6 +78,7 @@ withdraw-submission=Stiahnu podanie
workflow-assigned=Tok innost prirad (Automatic Translation)
workflow-assigned-to-x=Workflow assigned to {0}. (Automatic Copy)
workflow-configuration=Konfigurcia workflow
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=Tok innost bol spene odstrnen. (Automatic Translation)
workflow-in-use-remove-assignement-to-x-x=Workflow in use. Remove its assignment to this asset: {0}. {1} (Automatic Copy)
workflow-in-use-remove-assignements-to-x-and-x-x=Workflow in use. Remove its assignments to these assets: {0} and {1}. {2} (Automatic Copy)
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_sl.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_sl.properties
index e7f689d120ad21..7b51de9c2b6221 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_sl.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_sl.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=Izbrisan potek dela ni mogoe obnoviti.
action-undone=Ukrep razveljaviti. (Automatic Translation)
activity-description=Opis dejavnosti (Automatic Translation)
add-new-x=Add New {0} (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=Napaka med pridobivanjem seznama zahtevkov za objavo. Prosim sporoi to skrbniku. (Automatic Translation)
configure-assignments=Oblikovati naloge (Automatic Translation)
copy-does-not-include-revisions=Ta izvod vkljuuje zgodovino revizij. (Automatic Translation)
@@ -76,6 +78,7 @@ withdraw-submission=Umakne oddajo (Automatic Translation)
workflow-assigned=Potek dela, ki so dodeljena (Automatic Translation)
workflow-assigned-to-x=Workflow assigned to {0}. (Automatic Copy)
workflow-configuration=Konfiguracija portletov
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=Uspeno izbrisan potek dela. (Automatic Translation)
workflow-in-use-remove-assignement-to-x-x=Workflow in use. Remove its assignment to this asset: {0}. {1} (Automatic Copy)
workflow-in-use-remove-assignements-to-x-and-x-x=Workflow in use. Remove its assignments to these assets: {0} and {1}. {2} (Automatic Copy)
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_sr\_RS.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_sr\_RS.properties
index 6a5bb991d1dca6..babca8e1ef0310 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_sr\_RS.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_sr\_RS.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=A deleted workflow cannot be recovered. (
action-undone=Action undone. (Automatic Copy)
activity-description=Activity Description (Automatic Copy)
add-new-x=  {0}
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=        .   .
configure-assignments=Configure Assignments (Automatic Copy)
copy-does-not-include-revisions=This copy does not include the revision history. (Automatic Copy)
@@ -76,6 +78,7 @@ withdraw-submission= 
workflow-assigned=Workflow Assigned (Automatic Copy)
workflow-assigned-to-x=Workflow assigned to {0}. (Automatic Copy)
workflow-configuration= 
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=Workflow deleted successfully. (Automatic Copy)
workflow-in-use-remove-assignement-to-x-x=Workflow in use. Remove its assignment to this asset: {0}. {1} (Automatic Copy)
workflow-in-use-remove-assignements-to-x-and-x-x=Workflow in use. Remove its assignments to these assets: {0} and {1}. {2} (Automatic Copy)
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_sr\_RS\_latin.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_sr\_RS\_latin.properties
index aaae3fd01827f1..b4105020c5ac76 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_sr\_RS\_latin.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_sr\_RS\_latin.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=A deleted workflow cannot be recovered. (
action-undone=Action undone. (Automatic Copy)
activity-description=Activity Description (Automatic Copy)
add-new-x=Dodaj Novo u {0}
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=Dolo je do greke prilikom preuzimanja liste publikovanih zahteva. Molimo kontaktirajte administratora.
configure-assignments=Configure Assignments (Automatic Copy)
copy-does-not-include-revisions=This copy does not include the revision history. (Automatic Copy)
@@ -76,6 +78,7 @@ withdraw-submission=Povuci Podnoenje
workflow-assigned=Workflow Assigned (Automatic Copy)
workflow-assigned-to-x=Workflow assigned to {0}. (Automatic Copy)
workflow-configuration=Konfiguracija Tokaposla
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=Workflow deleted successfully. (Automatic Copy)
workflow-in-use-remove-assignement-to-x-x=Workflow in use. Remove its assignment to this asset: {0}. {1} (Automatic Copy)
workflow-in-use-remove-assignements-to-x-and-x-x=Workflow in use. Remove its assignments to these assets: {0} and {1}. {2} (Automatic Copy)
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_sv.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_sv.properties
index 1d4d83cc8cb619..e62ab847266554 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_sv.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_sv.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=Det gr inte att terstlla ett bortta
action-undone=tgrden har ngrats.
activity-description=Aktivitetsbeskrivning
add-new-x=Lgg till ny {0}
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=Ett fel uppstod nr listan med publiceringsfrfrgningar skulle hmtas. Kontakta en administratr.
configure-assignments=Konfigurera tilldelningar
copy-does-not-include-revisions=Den hr kopian inkluderar inte revisionshistorik.
@@ -76,6 +78,7 @@ withdraw-submission=Dra tillbaka arbetsflde
workflow-assigned=Arbetsfldet har tilldelats
workflow-assigned-to-x=Arbetsflde har tilldelats till {0}.
workflow-configuration=Arbetsflden - Konfiguration
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=Arbetsfldet har tagits bort.
workflow-in-use-remove-assignement-to-x-x=Arbetsfldet anvnds. Ta bort tilldelningen till den hr resursen: {0}. {1}
workflow-in-use-remove-assignements-to-x-and-x-x=Arbetsfldet anvnds. Ta bort tilldelningen till dessa tillgngar: {0} och {1}. {2}
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_th.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_th.properties
index 105e411283be48..402e0988ff1bf1 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_th.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_th.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=
action-undone= (Automatic Translation)
activity-description= (Automatic Translation)
add-new-x=Add New {0} (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=  (Automatic Translation)
configure-assignments= (Automatic Translation)
copy-does-not-include-revisions= (Automatic Translation)
@@ -76,6 +78,7 @@ withdraw-submission= (Automatic Translation)
workflow-assigned= (Automatic Translation)
workflow-assigned-to-x=Workflow assigned to {0}. (Automatic Copy)
workflow-configuration= (Automatic Translation)
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully= (Automatic Translation)
workflow-in-use-remove-assignement-to-x-x=Workflow in use. Remove its assignment to this asset: {0}. {1} (Automatic Copy)
workflow-in-use-remove-assignements-to-x-and-x-x=Workflow in use. Remove its assignments to these assets: {0} and {1}. {2} (Automatic Copy)
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_tr.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_tr.properties
index 6425dd94a42e4c..dbb21e87efc88c 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_tr.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_tr.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=Silinen bir i ak kurtarlamaz. (
action-undone=Eylem geri alnamaz. (Automatic Translation)
activity-description=Faaliyet tanm (Automatic Translation)
add-new-x=Add New {0} (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=Yayn isteklerinin bir listesi alnrken bir hata olutu. Ltfen yneticiye bavurun. (Automatic Translation)
configure-assignments=Atamalarn yaplandrn (Automatic Translation)
copy-does-not-include-revisions=Bu bilgilerini gzden geirme gemii iermez. (Automatic Translation)
@@ -76,6 +78,7 @@ withdraw-submission=Geri gnderme (Automatic Translation)
workflow-assigned=Atanan i ak (Automatic Translation)
workflow-assigned-to-x=Workflow assigned to {0}. (Automatic Copy)
workflow-configuration=Portlet Ayarlar
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully= ak baaryla silindi. (Automatic Translation)
workflow-in-use-remove-assignement-to-x-x=Workflow in use. Remove its assignment to this asset: {0}. {1} (Automatic Copy)
workflow-in-use-remove-assignements-to-x-and-x-x=Workflow in use. Remove its assignments to these assets: {0} and {1}. {2} (Automatic Copy)
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_uk.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_uk.properties
index 8a0bbcf989d6c2..3b2e978298b344 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_uk.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_uk.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=  
action-undone= . (Automatic Translation)
activity-description=  (Automatic Translation)
add-new-x=Add New {0} (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=       .  ,   . (Automatic Translation)
configure-assignments=  (Automatic Translation)
copy-does-not-include-revisions=    . (Automatic Translation)
@@ -76,6 +78,7 @@ withdraw-submission=  (Automatic Translation)
workflow-assigned=   (Automatic Translation)
workflow-assigned-to-x=Workflow assigned to {0}. (Automatic Copy)
workflow-configuration= 
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=   . (Automatic Translation)
workflow-in-use-remove-assignement-to-x-x=Workflow in use. Remove its assignment to this asset: {0}. {1} (Automatic Copy)
workflow-in-use-remove-assignements-to-x-and-x-x=Workflow in use. Remove its assignments to these assets: {0} and {1}. {2} (Automatic Copy)
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_vi.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_vi.properties
index a36bf49d190aa0..c8aff9102d373b 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_vi.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_vi.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=Mt cng vic  xo khng th
action-undone=Hon tc hnh ng. (Automatic Translation)
activity-description=M t hot ng (Automatic Translation)
add-new-x=Thm mi {0}
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=C li xy ra khi truy vn danh sch cc i tng. Vui lng lin h qun tr mng.
configure-assignments=t cu hnh cc tp (Automatic Translation)
copy-does-not-include-revisions=Bn sao ny khng bao gm lch s sa i. (Automatic Translation)
@@ -76,6 +78,7 @@ withdraw-submission=ng k d thng
workflow-assigned=Cng vic c giao (Automatic Translation)
workflow-assigned-to-x=Workflow assigned to {0}. (Automatic Copy)
workflow-configuration=Ci t quy trnh cng vic
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=Quy trnh lm vic xa thnh cng. (Automatic Translation)
workflow-in-use-remove-assignement-to-x-x=Workflow in use. Remove its assignment to this asset: {0}. {1} (Automatic Copy)
workflow-in-use-remove-assignements-to-x-and-x-x=Workflow in use. Remove its assignments to these assets: {0} and {1}. {2} (Automatic Copy)
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_zh\_CN.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_zh\_CN.properties
index 09d4bb88b68545..6f988c79fcc478 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_zh\_CN.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_zh\_CN.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered=
action-undone=
activity-description=
add-new-x={0}
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=
configure-assignments=
copy-does-not-include-revisions=
@@ -76,6 +78,7 @@ withdraw-submission=
workflow-assigned=
workflow-assigned-to-x= {0} 
workflow-configuration=
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully=
workflow-in-use-remove-assignement-to-x-x={0}{1}
workflow-in-use-remove-assignements-to-x-and-x-x={0}  {1}{2}
diff --git a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_zh\_TW.properties b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_zh\_TW.properties
index 46cf2d4cdd2991..2ef47faacb860f 100644
--- a/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_zh\_TW.properties
+++ b/modules/apps/portal-workflow/portal-workflow-lang/src/main/resources/content/Language\_zh\_TW.properties
@@ -2,6 +2,8 @@ a-deleted-workflow-cannot-be-recovered= (Aut
action-undone= (Automatic Translation)
activity-description= (Automatic Translation)
add-new-x= {0}
+allow-administrators-to-publish-and-edit-workflows=Allow Administrators to Publish and Edit Workflows (Automatic Copy)
+allow-administrators-to-publish-and-edit-workflows-description=When selected, users with the Regular Administrator role in a virtual instance can publish new workflow definitions, including scripting content that is executed inside the portal (and potentially in other virtual instances). (Automatic Copy)
an-error-occurred-while-retrieving-the-list-of-instances=
configure-assignments= (Automatic Translation)
copy-does-not-include-revisions= (Automatic Translation)
@@ -76,6 +78,7 @@ withdraw-submission=
workflow-assigned= (Automatic Translation)
workflow-assigned-to-x=Workflow assigned to {0}. (Automatic Copy)
workflow-configuration=
+workflow-definition-configuration-name=Workflow Definition (Automatic Copy)
workflow-deleted-successfully= (Automatic Translation)
workflow-in-use-remove-assignement-to-x-x=Workflow in use. Remove its assignment to this asset: {0}. {1} (Automatic Copy)
workflow-in-use-remove-assignements-to-x-and-x-x=Workflow in use. Remove its assignments to these assets: {0} and {1}. {2} (Automatic Copy)
diff --git a/modules/apps/portal-workflow/portal-workflow-web/build.gradle b/modules/apps/portal-workflow/portal-workflow-web/build.gradle
index 213fdcd91ec1e7..9932417f3c9b84 100644
--- a/modules/apps/portal-workflow/portal-workflow-web/build.gradle
+++ b/modules/apps/portal-workflow/portal-workflow-web/build.gradle
@@ -10,7 +10,6 @@ dependencies {
compileOnly group: "com.liferay", name: "com.liferay.petra.lang", version: "2.0.0"
compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "2.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.configuration.metatype.api", version: "1.0.0"
- compileOnly group: "com.liferay", name: "com.liferay.portal.workflow.api", version: "1.1.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "3.14.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "3.58.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.util.taglib", version: "3.0.0"
@@ -19,6 +18,7 @@ dependencies {
compileOnly group: "javax.servlet.jsp", name: "javax.servlet.jsp-api", version: "2.3.1"
compileOnly group: "org.osgi", name: "org.osgi.core", version: "5.0.0"
compileOnly group: "org.osgi", name: "org.osgi.service.component.annotations", version: "1.3.0"
+ compileOnly project(":apps:portal-workflow:portal-workflow-api")
testCompile group: "junit", name: "junit", version: "4.12"
}
\ No newline at end of file
diff --git a/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/display/context/WorkflowDefinitionDisplayContext.java b/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/display/context/WorkflowDefinitionDisplayContext.java
index fecb47bf7220b2..6c114192e1414d 100644
--- a/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/display/context/WorkflowDefinitionDisplayContext.java
+++ b/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/display/context/WorkflowDefinitionDisplayContext.java
@@ -25,6 +25,8 @@
import com.liferay.portal.kernel.model.User;
import com.liferay.portal.kernel.model.WorkflowDefinitionLink;
import com.liferay.portal.kernel.portlet.LiferayPortletResponse;
+import com.liferay.portal.kernel.security.permission.PermissionChecker;
+import com.liferay.portal.kernel.security.permission.PermissionThreadLocal;
import com.liferay.portal.kernel.security.permission.ResourceActionsUtil;
import com.liferay.portal.kernel.service.UserLocalService;
import com.liferay.portal.kernel.theme.ThemeDisplay;
@@ -82,6 +84,23 @@ public WorkflowDefinitionDisplayContext(
renderRequest);
}
+ public boolean canPublishWorkflowDefinition() {
+ PermissionChecker permissionChecker =
+ PermissionThreadLocal.getPermissionChecker();
+
+ if (\_companyAdministratorCanPublish &&
+ permissionChecker.isCompanyAdmin()) {
+
+ return true;
+ }
+
+ if (permissionChecker.isOmniadmin()) {
+ return true;
+ }
+
+ return false;
+ }
+
public String getActive(WorkflowDefinition workflowDefinition) {
HttpServletRequest request =
\_workflowDefinitionRequestHelper.getRequest();
@@ -113,6 +132,10 @@ public Date getCreatedDate(WorkflowDefinition workflowDefinition)
}
public JSPCreationMenu getCreationMenu(PageContext pageContext) {
+ if (!canPublishWorkflowDefinition()) {
+ return null;
+ }
+
LiferayPortletResponse response =
\_workflowDefinitionRequestHelper.getLiferayPortletResponse();
@@ -464,6 +487,12 @@ public boolean isDisabledManagementBar(
return !searchContainer.hasResults();
}
+ public void setCompanyAdministratorCanPublish(
+ boolean companyAdministratorCanPublish) {
+
+ \_companyAdministratorCanPublish = companyAdministratorCanPublish;
+ }
+
protected PredicateFilter createPredicateFilter(
String description, String title, int status, boolean andOperator) {
@@ -625,6 +654,7 @@ private PortletURL \_getPortletURL(HttpServletRequest request) {
private static final String \_HTML =
"[[$MESSAGE$]](%5B%24RENDER_URL%24%5D)";
+ private boolean \_companyAdministratorCanPublish;
private final ResourceBundleLoader \_resourceBundleLoader;
private final UserLocalService \_userLocalService;
private final WorkflowDefinitionRequestHelper
diff --git a/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/portlet/ControlPanelWorkflowControlPanelEntry.java b/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/portlet/ControlPanelWorkflowControlPanelEntry.java
index 3adcc01493bc0d..764911a9988841 100644
--- a/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/portlet/ControlPanelWorkflowControlPanelEntry.java
+++ b/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/portlet/ControlPanelWorkflowControlPanelEntry.java
@@ -14,7 +14,11 @@
package com.liferay.portal.workflow.web.internal.portlet;
+import com.liferay.portal.kernel.model.Group;
+import com.liferay.portal.kernel.model.Portlet;
+import com.liferay.portal.kernel.portlet.AdministratorControlPanelEntry;
import com.liferay.portal.kernel.portlet.ControlPanelEntry;
+import com.liferay.portal.kernel.security.permission.PermissionChecker;
import com.liferay.portal.workflow.WorkflowControlPanelEntry;
import com.liferay.portal.workflow.web.internal.constants.WorkflowPortletKeys;
@@ -29,5 +33,22 @@
service = ControlPanelEntry.class
)
public class ControlPanelWorkflowControlPanelEntry
- extends WorkflowControlPanelEntry {
+ extends AdministratorControlPanelEntry {
+
+ @Override
+ public boolean hasAccessPermission(
+ PermissionChecker permissionChecker, Group group, Portlet portlet)
+ throws Exception {
+
+ if (!super.hasAccessPermission(permissionChecker, group, portlet)) {
+ return false;
+ }
+
+ return \_workflowControlPanelEntry.hasAccessPermission(
+ permissionChecker, group, portlet);
+ }
+
+ private final WorkflowControlPanelEntry \_workflowControlPanelEntry =
+ new WorkflowControlPanelEntry();
+
}
\ No newline at end of file
diff --git a/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/portlet/ControlPanelWorkflowPortlet.java b/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/portlet/ControlPanelWorkflowPortlet.java
index c20a6954c7fb90..68b3b3711ffed1 100644
--- a/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/portlet/ControlPanelWorkflowPortlet.java
+++ b/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/portlet/ControlPanelWorkflowPortlet.java
@@ -14,6 +14,9 @@
package com.liferay.portal.workflow.web.internal.portlet;
+import com.liferay.portal.kernel.security.auth.PrincipalException;
+import com.liferay.portal.kernel.security.permission.PermissionChecker;
+import com.liferay.portal.kernel.security.permission.PermissionThreadLocal;
import com.liferay.portal.kernel.util.ResourceBundleLoader;
import com.liferay.portal.workflow.constants.WorkflowWebKeys;
import com.liferay.portal.workflow.web.internal.constants.WorkflowPortletKeys;
@@ -23,6 +26,7 @@
import java.util.List;
import javax.portlet.Portlet;
+import javax.portlet.PortletRequest;
import javax.portlet.RenderRequest;
import org.osgi.service.component.annotations.Component;
@@ -53,7 +57,7 @@
"javax.portlet.init-param.view-template=/view.jsp",
"javax.portlet.name=" + WorkflowPortletKeys.CONTROL\_PANEL\_WORKFLOW,
"javax.portlet.resource-bundle=content.Language",
- "javax.portlet.security-role-ref=power-user,user",
+ "javax.portlet.security-role-ref=administrator",
"javax.portlet.supports.mime-type=text/html"
},
service = Portlet.class
@@ -81,6 +85,21 @@ protected void addRenderRequestAttributes(RenderRequest renderRequest) {
workflowNavigationDisplayContext);
}
+ @Override
+ protected void checkPermissions(PortletRequest portletRequest)
+ throws Exception {
+
+ super.checkPermissions(portletRequest);
+
+ PermissionChecker permissionChecker =
+ PermissionThreadLocal.getPermissionChecker();
+
+ if (!permissionChecker.isCompanyAdmin()) {
+ throw new PrincipalException.MustBeCompanyAdmin(
+ permissionChecker.getUserId());
+ }
+ }
+
@Reference(
policy = ReferencePolicy.DYNAMIC,
policyOption = ReferencePolicyOption.GREEDY,
diff --git a/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/portlet/configuration/icon/DuplicateDefinitionPortletConfigurationIcon.java b/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/portlet/configuration/icon/DuplicateDefinitionPortletConfigurationIcon.java
index d5d35282afd1c0..f01f877211987e 100644
--- a/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/portlet/configuration/icon/DuplicateDefinitionPortletConfigurationIcon.java
+++ b/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/portlet/configuration/icon/DuplicateDefinitionPortletConfigurationIcon.java
@@ -14,21 +14,29 @@
package com.liferay.portal.workflow.web.internal.portlet.configuration.icon;
+import com.liferay.portal.configuration.metatype.bnd.util.ConfigurableUtil;
import com.liferay.portal.kernel.language.LanguageUtil;
import com.liferay.portal.kernel.portlet.configuration.icon.BasePortletConfigurationIcon;
import com.liferay.portal.kernel.portlet.configuration.icon.PortletConfigurationIcon;
+import com.liferay.portal.kernel.security.permission.PermissionChecker;
+import com.liferay.portal.kernel.security.permission.PermissionThreadLocal;
import com.liferay.portal.kernel.util.Portal;
import com.liferay.portal.kernel.util.ResourceBundleLoader;
import com.liferay.portal.kernel.util.WebKeys;
import com.liferay.portal.kernel.workflow.WorkflowDefinition;
+import com.liferay.portal.workflow.configuration.WorkflowDefinitionConfiguration;
import com.liferay.portal.workflow.web.internal.constants.WorkflowPortletKeys;
+import java.util.Map;
import java.util.ResourceBundle;
import javax.portlet.PortletRequest;
import javax.portlet.PortletResponse;
+import org.osgi.service.component.annotations.Activate;
import org.osgi.service.component.annotations.Component;
+import org.osgi.service.component.annotations.ConfigurationPolicy;
+import org.osgi.service.component.annotations.Modified;
import org.osgi.service.component.annotations.Reference;
import org.osgi.service.component.annotations.ReferencePolicy;
import org.osgi.service.component.annotations.ReferencePolicyOption;
@@ -39,7 +47,8 @@
\* @author Jeyvison Nascimento
\*/
@Component(
- immediate = true,
+ configurationPid = "com.liferay.portal.workflow.configuration.WorkflowDefinitionConfiguration",
+ configurationPolicy = ConfigurationPolicy.OPTIONAL, immediate = true,
property = {
"javax.portlet.name=" + WorkflowPortletKeys.CONTROL\_PANEL\_WORKFLOW,
"path=/definition/edit\_workflow\_definition.jsp"
@@ -77,6 +86,10 @@ public String getURL(
@Override
public boolean isShow(PortletRequest portletRequest) {
+ if (!checkPermissions()) {
+ return false;
+ }
+
WorkflowDefinition workflowDefinition =
(WorkflowDefinition)portletRequest.getAttribute(
WebKeys.WORKFLOW\_DEFINITION);
@@ -88,6 +101,36 @@ public boolean isShow(PortletRequest portletRequest) {
return false;
}
+ @Activate
+ @Modified
+ protected void activate(Map properties) {
+ WorkflowDefinitionConfiguration workflowDefinitionConfiguration =
+ ConfigurableUtil.createConfigurable(
+ WorkflowDefinitionConfiguration.class, properties);
+
+ \_companyAdministratorCanPublish =
+ workflowDefinitionConfiguration.companyAdministratorCanPublish();
+ }
+
+ protected boolean checkPermissions() {
+ PermissionChecker permissionChecker =
+ PermissionThreadLocal.getPermissionChecker();
+
+ if (\_companyAdministratorCanPublish &&
+ permissionChecker.isCompanyAdmin()) {
+
+ return true;
+ }
+
+ if (permissionChecker.isOmniadmin()) {
+ return true;
+ }
+
+ return false;
+ }
+
+ private boolean \_companyAdministratorCanPublish;
+
@Reference
private Portal \_portal;
diff --git a/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/portlet/tab/WorkflowDefinitionPortletTab.java b/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/portlet/tab/WorkflowDefinitionPortletTab.java
index 8dec3999189e8e..02744ae945cee3 100644
--- a/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/portlet/tab/WorkflowDefinitionPortletTab.java
+++ b/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/portlet/tab/WorkflowDefinitionPortletTab.java
@@ -14,6 +14,7 @@
package com.liferay.portal.workflow.web.internal.portlet.tab;
+import com.liferay.portal.configuration.metatype.bnd.util.ConfigurableUtil;
import com.liferay.portal.kernel.exception.PortalException;
import com.liferay.portal.kernel.service.UserLocalService;
import com.liferay.portal.kernel.servlet.SessionErrors;
@@ -24,12 +25,14 @@
import com.liferay.portal.kernel.util.WebKeys;
import com.liferay.portal.kernel.workflow.WorkflowDefinition;
import com.liferay.portal.kernel.workflow.WorkflowDefinitionManagerUtil;
+import com.liferay.portal.workflow.configuration.WorkflowDefinitionConfiguration;
import com.liferay.portal.workflow.constants.WorkflowWebKeys;
import com.liferay.portal.workflow.portlet.tab.BaseWorkflowPortletTab;
import com.liferay.portal.workflow.portlet.tab.WorkflowPortletTab;
import com.liferay.portal.workflow.web.internal.display.context.WorkflowDefinitionDisplayContext;
import com.liferay.portal.workflow.web.internal.request.prepocessor.WorkflowPreprocessorHelper;
+import java.util.Map;
import java.util.Objects;
import javax.portlet.PortletException;
@@ -38,14 +41,18 @@
import javax.servlet.ServletContext;
+import org.osgi.service.component.annotations.Activate;
import org.osgi.service.component.annotations.Component;
+import org.osgi.service.component.annotations.ConfigurationPolicy;
+import org.osgi.service.component.annotations.Modified;
import org.osgi.service.component.annotations.Reference;
/\*\*
\* @author Adam Brandizzi
\*/
@Component(
- immediate = true,
+ configurationPid = "com.liferay.portal.workflow.configuration.WorkflowDefinitionConfiguration",
+ configurationPolicy = ConfigurationPolicy.OPTIONAL, immediate = true,
property = "portal.workflow.tabs.name=" + WorkflowWebKeys.WORKFLOW\_TAB\_DEFINITION,
service = WorkflowPortletTab.class
)
@@ -78,6 +85,9 @@ public void prepareRender(
"com.liferay.portal.workflow.web"),
userLocalService);
+ displayContext.setCompanyAdministratorCanPublish(
+ \_companyAdministratorCanPublish);
+
renderRequest.setAttribute(
WorkflowWebKeys.WORKFLOW\_DEFINITION\_DISPLAY\_CONTEXT,
displayContext);
@@ -103,6 +113,17 @@ public void prepareRender(
}
}
+ @Activate
+ @Modified
+ protected void activate(Map properties) {
+ WorkflowDefinitionConfiguration workflowDefinitionConfiguration =
+ ConfigurableUtil.createConfigurable(
+ WorkflowDefinitionConfiguration.class, properties);
+
+ \_companyAdministratorCanPublish =
+ workflowDefinitionConfiguration.companyAdministratorCanPublish();
+ }
+
@Override
protected String getJspPath() {
return "/definition/view.jsp";
@@ -146,4 +167,6 @@ protected void setWorkflowDefinitionRenderRequestAttribute(
@Reference
protected WorkflowPreprocessorHelper workflowPreprocessorHelper;
+ private boolean \_companyAdministratorCanPublish;
+
}
\ No newline at end of file
diff --git a/modules/apps/portal-workflow/portal-workflow-web/src/main/resources/META-INF/resources/definition/edit\_workflow\_definition.jsp b/modules/apps/portal-workflow/portal-workflow-web/src/main/resources/META-INF/resources/definition/edit\_workflow\_definition.jsp
index d54f8e91141ae7..1f4f90d9c7b485 100644
--- a/modules/apps/portal-workflow/portal-workflow-web/src/main/resources/META-INF/resources/definition/edit\_workflow\_definition.jsp
+++ b/modules/apps/portal-workflow/portal-workflow-web/src/main/resources/META-INF/resources/definition/edit\_workflow\_definition.jsp
@@ -261,12 +261,14 @@ renderResponse.setTitle((workflowDefinition == null) ? LanguageUtil.get(request,

+
- <%
- String taglibUpdateOnClick = "Liferay.fire('" + liferayPortletResponse.getNamespace() + "publishDefinition');";
- %>
+ <%
+ String taglibUpdateOnClick = "Liferay.fire('" + liferayPortletResponse.getNamespace() + "publishDefinition');";
+ %>
-
+
+
diff --git a/modules/apps/portal-workflow/portal-workflow-web/src/main/resources/META-INF/resources/definition/workflow\_definition\_action.jsp b/modules/apps/portal-workflow/portal-workflow-web/src/main/resources/META-INF/resources/definition/workflow\_definition\_action.jsp
index d22c13e9acb8ff..f5570b12c546f8 100644
--- a/modules/apps/portal-workflow/portal-workflow-web/src/main/resources/META-INF/resources/definition/workflow\_definition\_action.jsp
+++ b/modules/apps/portal-workflow/portal-workflow-web/src/main/resources/META-INF/resources/definition/workflow\_definition\_action.jsp
@@ -75,11 +75,13 @@ String duplicateTitle = workflowDefinitionDisplayContext.getDuplicateTitle(workf
url="<%= deactivateWorkflowDefinitionURL %>"
/>
-
+
+
+

diff --git a/modules/apps/push-notifications/push-notifications-sender/push-notifications-sender-apple/build.gradle b/modules/apps/push-notifications/push-notifications-sender/push-notifications-sender-apple/build.gradle
index 00829880bd4dd1..990e2ca8a42341 100644
--- a/modules/apps/push-notifications/push-notifications-sender/push-notifications-sender-apple/build.gradle
+++ b/modules/apps/push-notifications/push-notifications-sender/push-notifications-sender-apple/build.gradle
@@ -1,7 +1,7 @@
dependencies {
- compileInclude group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.8"
- compileInclude group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.8"
- compileInclude group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.8"
+ compileInclude group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.9"
+ compileInclude group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.9"
+ compileInclude group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.9.3"
compileInclude group: "com.notnoop.apns", name: "apns", version: "1.0.0.Beta6"
compileOnly group: "biz.aQute.bnd", name: "biz.aQute.bndlib", version: "3.1.0"
diff --git a/modules/apps/server/server-manager/build.gradle b/modules/apps/server/server-manager/build.gradle
index 77b2f3aaad6c3f..4a59adfa4be5e3 100644
--- a/modules/apps/server/server-manager/build.gradle
+++ b/modules/apps/server/server-manager/build.gradle
@@ -1,5 +1,5 @@
dependencies {
- compileInclude group: "commons-fileupload", name: "commons-fileupload", version: "1.3.2"
+ compileInclude group: "commons-fileupload", name: "commons-fileupload", version: "1.3.3"
compileInclude group: "commons-io", name: "commons-io", version: "1.4"
compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "2.0.0"
diff --git a/modules/apps/site-navigation/site-navigation-menu-web/src/main/resources/META-INF/resources/configuration.jsp b/modules/apps/site-navigation/site-navigation-menu-web/src/main/resources/META-INF/resources/configuration.jsp
index a85ea44eddb729..1f3ecb14a9ae11 100644
--- a/modules/apps/site-navigation/site-navigation-menu-web/src/main/resources/META-INF/resources/configuration.jsp
+++ b/modules/apps/site-navigation/site-navigation-menu-web/src/main/resources/META-INF/resources/configuration.jsp
@@ -24,7 +24,7 @@ SiteNavigationMenu siteNavigationMenu = siteNavigationMenuDisplayContext.getSite
String siteNavigationMenuName = StringPool.BLANK;
if (siteNavigationMenu != null) {
- siteNavigationMenuName = siteNavigationMenu.getName();
+ siteNavigationMenuName = HtmlUtil.escape(siteNavigationMenu.getName());
}
else if (siteNavigationMenuDisplayContext.getSelectSiteNavigationMenuType() == SiteNavigationConstants.TYPE\_PRIVATE\_PAGES\_HIERARCHY) {
siteNavigationMenuName = LanguageUtil.get(request, "private-pages-hierarchy");
@@ -86,7 +86,7 @@ else {
- <%= siteNavigationMenu.getName() %>
+ <%= siteNavigationMenuName %>

" id="removeSiteNavigationMenu" role="button">
diff --git a/modules/apps/site/site-browser-web/src/main/resources/META-INF/resources/init.jsp b/modules/apps/site/site-browser-web/src/main/resources/META-INF/resources/init.jsp
index d5241c5dccd886..9ca0c08b6c28c4 100644
--- a/modules/apps/site/site-browser-web/src/main/resources/META-INF/resources/init.jsp
+++ b/modules/apps/site/site-browser-web/src/main/resources/META-INF/resources/init.jsp
@@ -28,6 +28,7 @@ taglib uri="http://liferay.com/tld/ui" prefix="liferay-ui" %>
page import="com.liferay.portal.kernel.model.Group" %><%@
page import="com.liferay.portal.kernel.model.User" %><%@
page import="com.liferay.portal.kernel.security.membershippolicy.SiteMembershipPolicyUtil" %><%@
+page import="com.liferay.portal.kernel.service.GroupServiceUtil" %><%@
page import="com.liferay.portal.kernel.util.HtmlUtil" %><%@
page import="com.liferay.portal.kernel.util.ParamUtil" %><%@
page import="com.liferay.portal.kernel.util.PortalUtil" %><%@
diff --git a/modules/apps/site/site-browser-web/src/main/resources/META-INF/resources/site\_vertical\_card.jspf b/modules/apps/site/site-browser-web/src/main/resources/META-INF/resources/site\_vertical\_card.jspf
index 6cafa9803915bd..b4fc578ed41952 100644
--- a/modules/apps/site/site-browser-web/src/main/resources/META-INF/resources/site\_vertical\_card.jspf
+++ b/modules/apps/site/site-browser-web/src/main/resources/META-INF/resources/site\_vertical\_card.jspf
@@ -15,7 +15,7 @@
--%>
<%
-List childGroups = group.getChildren(true);
+List childGroups = GroupServiceUtil.getGroups(group.getCompanyId(), group.getGroupId(), true);
%>
">
diff --git a/modules/apps/site/site-item-selector-web/src/main/resources/META-INF/resources/init.jsp b/modules/apps/site/site-item-selector-web/src/main/resources/META-INF/resources/init.jsp
index 005ba0ca6728a4..dc9886381dca32 100644
--- a/modules/apps/site/site-item-selector-web/src/main/resources/META-INF/resources/init.jsp
+++ b/modules/apps/site/site-item-selector-web/src/main/resources/META-INF/resources/init.jsp
@@ -26,6 +26,7 @@ taglib uri="http://liferay.com/tld/ui" prefix="liferay-ui" %>
<%@ page import="com.liferay.portal.kernel.language.LanguageUtil" %><%@
page import="com.liferay.portal.kernel.model.Group" %><%@
+page import="com.liferay.portal.kernel.service.GroupServiceUtil" %><%@
page import="com.liferay.portal.kernel.util.HtmlUtil" %><%@
page import="com.liferay.portal.kernel.util.ParamUtil" %><%@
page import="com.liferay.portal.kernel.util.Validator" %><%@
diff --git a/modules/apps/site/site-item-selector-web/src/main/resources/META-INF/resources/view\_sites.jsp b/modules/apps/site/site-item-selector-web/src/main/resources/META-INF/resources/view\_sites.jsp
index 6436d5839f73f3..af6dc83ecf3a10 100644
--- a/modules/apps/site/site-item-selector-web/src/main/resources/META-INF/resources/view\_sites.jsp
+++ b/modules/apps/site/site-item-selector-web/src/main/resources/META-INF/resources/view\_sites.jsp
@@ -64,7 +64,7 @@ GroupSearch groupSearch = siteItemSelectorViewDisplayContext.getGroupSearch();
>
<%
- List childGroups = group.getChildren(true);
+ List childGroups = GroupServiceUtil.getGroups(group.getCompanyId(), group.getGroupId(), true);
Map data = new HashMap();
diff --git a/modules/apps/static/portal-osgi-web/portal-osgi-web-wab-extender/build.gradle b/modules/apps/static/portal-osgi-web/portal-osgi-web-wab-extender/build.gradle
index 597d610baa9339..dc480d2384544b 100644
--- a/modules/apps/static/portal-osgi-web/portal-osgi-web-wab-extender/build.gradle
+++ b/modules/apps/static/portal-osgi-web/portal-osgi-web-wab-extender/build.gradle
@@ -17,7 +17,7 @@ dependencies {
compileOnly group: "com.liferay", name: "org.eclipse.equinox.http.servlet", version: "1.2.2.v20190228-1648-LIFERAY-CACHED"
compileOnly group: "com.liferay", name: "org.eclipse.osgi", version: "3.13.0.LIFERAY-PATCHED-4"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "3.0.0"
- compileOnly group: "commons-fileupload", name: "commons-fileupload", version: "1.3.2"
+ compileOnly group: "commons-fileupload", name: "commons-fileupload", version: "1.3.3"
compileOnly group: "commons-io", name: "commons-io", version: "1.4"
compileOnly group: "org.glassfish", name: "javax.servlet", version: "3.2-b06"
compileOnly group: "org.osgi", name: "org.osgi.service.component", version: "1.3.0"
diff --git a/modules/apps/static/required-dependencies/required-dependencies/build.gradle b/modules/apps/static/required-dependencies/required-dependencies/build.gradle
index 404cb2dbcb410d..0ddcdb54e6dc20 100644
--- a/modules/apps/static/required-dependencies/required-dependencies/build.gradle
+++ b/modules/apps/static/required-dependencies/required-dependencies/build.gradle
@@ -21,9 +21,9 @@ dependencies {
compileOnly group: "com.liferay", name: "org.osgi.service.http", version: "3.5.0-20150611.165350-3.LIFERAY-PATCHED-2"
compileOnly group: "javax.servlet.jsp", name: "javax.servlet.jsp-api", version: "2.3.3"
compileOnly group: "javax.servlet.jsp.jstl", name: "javax.servlet.jsp.jstl-api", version: "1.2.2"
- compileOnly group: "org.apache.aries.cdi", name: "org.apache.aries.cdi.extender", version: "1.0.1-20190213.211706-2"
+ compileOnly group: "org.apache.aries.cdi", name: "org.apache.aries.cdi.extender", version: "1.0.1"
compileOnly group: "org.apache.aries.cdi", name: "org.apache.aries.cdi.extension.el.jsp", version: "1.0.0"
- compileOnly group: "org.apache.aries.cdi", name: "org.apache.aries.cdi.extension.http", version: "1.0.1-20190213.211731-3"
+ compileOnly group: "org.apache.aries.cdi", name: "org.apache.aries.cdi.extension.http", version: "1.0.1"
compileOnly group: "org.apache.aries.cdi", name: "org.apache.aries.cdi.extra", version: "1.0.0"
compileOnly group: "org.apache.aries.spifly", name: "org.apache.aries.spifly.dynamic.framework.extension", version: "1.2"
compileOnly group: "org.apache.felix", name: "org.apache.felix.dependencymanager", version: "3.2.0"
diff --git a/modules/apps/users-admin/users-admin-web/src/main/java/com/liferay/users/admin/web/internal/constants/UsersAdminWebKeys.java b/modules/apps/users-admin/users-admin-web/src/main/java/com/liferay/users/admin/web/internal/constants/UsersAdminWebKeys.java
index cfe4fceb469fe1..362817361bdbee 100644
--- a/modules/apps/users-admin/users-admin-web/src/main/java/com/liferay/users/admin/web/internal/constants/UsersAdminWebKeys.java
+++ b/modules/apps/users-admin/users-admin-web/src/main/java/com/liferay/users/admin/web/internal/constants/UsersAdminWebKeys.java
@@ -23,6 +23,9 @@ public class UsersAdminWebKeys {
public static final String EDITABLE = "EDITABLE";
+ public static final String FILTER\_MANAGEABLE\_ORGANIZATIONS =
+ "FILTER\_MANAGEABLE\_ORGANIZATIONS";
+
public static final String FORM\_LABEL = "FORM\_LABEL";
public static final String JSP\_PATH = "JSP\_PATH";
diff --git a/modules/apps/users-admin/users-admin-web/src/main/java/com/liferay/users/admin/web/internal/display/context/ViewUsersManagementToolbarDisplayContext.java b/modules/apps/users-admin/users-admin-web/src/main/java/com/liferay/users/admin/web/internal/display/context/ViewUsersManagementToolbarDisplayContext.java
index d2d699eb403c6e..bb63284775c59c 100644
--- a/modules/apps/users-admin/users-admin-web/src/main/java/com/liferay/users/admin/web/internal/display/context/ViewUsersManagementToolbarDisplayContext.java
+++ b/modules/apps/users-admin/users-admin-web/src/main/java/com/liferay/users/admin/web/internal/display/context/ViewUsersManagementToolbarDisplayContext.java
@@ -28,18 +28,25 @@
import com.liferay.portal.kernel.language.LanguageUtil;
import com.liferay.portal.kernel.log.Log;
import com.liferay.portal.kernel.log.LogFactoryUtil;
+import com.liferay.portal.kernel.model.ResourceConstants;
import com.liferay.portal.kernel.model.User;
+import com.liferay.portal.kernel.model.UserConstants;
import com.liferay.portal.kernel.portlet.PortletURLUtil;
import com.liferay.portal.kernel.security.permission.ActionKeys;
import com.liferay.portal.kernel.service.UserLocalServiceUtil;
import com.liferay.portal.kernel.service.permission.PortalPermissionUtil;
+import com.liferay.portal.kernel.service.permission.UserPermissionUtil;
import com.liferay.portal.kernel.theme.ThemeDisplay;
+import com.liferay.portal.kernel.util.ArrayUtil;
import com.liferay.portal.kernel.util.Constants;
+import com.liferay.portal.kernel.util.GetterUtil;
+import com.liferay.portal.kernel.util.Validator;
import com.liferay.portal.kernel.util.WebKeys;
import com.liferay.portal.kernel.workflow.WorkflowConstants;
import com.liferay.portal.util.PropsValues;
import com.liferay.portlet.usersadmin.search.UserSearch;
import com.liferay.portlet.usersadmin.search.UserSearchTerms;
+import com.liferay.users.admin.web.internal.constants.UsersAdminWebKeys;
import java.util.LinkedHashMap;
import java.util.List;
@@ -72,7 +79,7 @@ public ViewUsersManagementToolbarDisplayContext(
\_renderRequest, \_renderResponse);
}
- public List getActionDropdownItems() {
+ public List getActionDropdownItems() throws PortalException {
return new DropdownItemList() {
{
if (isShowRestoreButton()) {
@@ -195,7 +202,7 @@ public String getSearchActionURL() {
return searchActionURL.toString();
}
- public SearchContainer getSearchContainer() {
+ public SearchContainer getSearchContainer() throws PortalException {
if (\_userSearch != null) {
return \_userSearch;
}
@@ -227,17 +234,47 @@ else if (\_navigation.equals("inactive")) {
searchTerms.setStatus(WorkflowConstants.STATUS\_INACTIVE);
}
+ LinkedHashMap userParams = new LinkedHashMap<>();
+
+ boolean filterManageableOrganizations = GetterUtil.getBoolean(
+ \_renderRequest.getAttribute(
+ UsersAdminWebKeys.FILTER\_MANAGEABLE\_ORGANIZATIONS));
+
+ String usersListView = GetterUtil.getString(
+ \_renderRequest.getAttribute("view.jsp-usersListView"));
+
+ if (usersListView.equals(UserConstants.LIST\_VIEW\_TREE) &&
+ Validator.isNull(searchTerms.getKeywords())) {
+
+ userParams.put("noOrganizations", Boolean.TRUE);
+ userParams.put("usersOrgsCount", 0);
+ }
+ else if (filterManageableOrganizations &&
+ !UserPermissionUtil.contains(
+ themeDisplay.getPermissionChecker(),
+ ResourceConstants.PRIMKEY\_DNE, ActionKeys.VIEW)) {
+
+ User user = themeDisplay.getUser();
+
+ long[] organizationIds = user.getOrganizationIds();
+
+ if (ArrayUtil.isEmpty(organizationIds)) {
+ organizationIds = new long[] {0};
+ }
+
+ userParams.put("usersOrgs", ArrayUtil.toLongArray(organizationIds));
+ }
+
int total = UserLocalServiceUtil.searchCount(
themeDisplay.getCompanyId(), searchTerms.getKeywords(),
- searchTerms.getStatus(), new LinkedHashMap());
+ searchTerms.getStatus(), userParams);
userSearch.setTotal(total);
List results = UserLocalServiceUtil.search(
themeDisplay.getCompanyId(), searchTerms.getKeywords(),
- searchTerms.getStatus(), new LinkedHashMap(),
- userSearch.getStart(), userSearch.getEnd(),
- userSearch.getOrderByComparator());
+ searchTerms.getStatus(), userParams, userSearch.getStart(),
+ userSearch.getEnd(), userSearch.getOrderByComparator());
userSearch.setResults(results);
@@ -266,7 +303,7 @@ public List getViewTypeItems() {
};
}
- public boolean isShowDeleteButton() {
+ public boolean isShowDeleteButton() throws PortalException {
UserSearchTerms searchTerms =
(UserSearchTerms)getSearchContainer().getSearchTerms();
@@ -280,7 +317,7 @@ public boolean isShowDeleteButton() {
return false;
}
- public boolean isShowRestoreButton() {
+ public boolean isShowRestoreButton() throws PortalException {
UserSearchTerms searchTerms =
(UserSearchTerms)getSearchContainer().getSearchTerms();
diff --git a/modules/apps/users-admin/users-admin-web/src/main/resources/META-INF/resources/edit\_user\_navigation.jsp b/modules/apps/users-admin/users-admin-web/src/main/resources/META-INF/resources/edit\_user\_navigation.jsp
index a303206344f957..116c8d1a97dd85 100644
--- a/modules/apps/users-admin/users-admin-web/src/main/resources/META-INF/resources/edit\_user\_navigation.jsp
+++ b/modules/apps/users-admin/users-admin-web/src/main/resources/META-INF/resources/edit\_user\_navigation.jsp
@@ -27,7 +27,7 @@ User selUser = PortalUtil.getSelectedUser(request);
request.setAttribute(UsersAdminWebKeys.SELECTED\_USER, selUser);
if (selUser != null) {
- PortalUtil.setPageSubtitle(selUser.getFullName(), request);
+ PortalUtil.setPageSubtitle(HtmlUtil.escape(selUser.getFullName()), request);
}
long selUserId = (selUser != null) ? selUser.getUserId() : 0;
@@ -45,7 +45,7 @@ if (!portletName.equals(UsersAdminPortletKeys.MY\_ACCOUNT)) {
portletDisplay.setShowBackIcon(true);
portletDisplay.setURLBack(backURL);
- renderResponse.setTitle((selUser == null) ? LanguageUtil.get(request, "add-user") : LanguageUtil.format(request, "edit-user-x", selUser.getFullName(), false));
+ renderResponse.setTitle((selUser == null) ? LanguageUtil.get(request, "add-user") : LanguageUtil.format(request, "edit-user-x", HtmlUtil.escape(selUser.getFullName()), false));
}
%>
diff --git a/modules/apps/users-admin/users-admin-web/src/main/resources/META-INF/resources/view\_flat\_users.jsp b/modules/apps/users-admin/users-admin-web/src/main/resources/META-INF/resources/view\_flat\_users.jsp
index 283a934913ada7..e7766ff078317e 100644
--- a/modules/apps/users-admin/users-admin-web/src/main/resources/META-INF/resources/view\_flat\_users.jsp
+++ b/modules/apps/users-admin/users-admin-web/src/main/resources/META-INF/resources/view\_flat\_users.jsp
@@ -47,6 +47,7 @@ if (!ParamUtil.getBoolean(renderRequest, "advancedSearch")) {
currentURLObj.setParameter("status", String.valueOf(status));
}
+request.setAttribute(UsersAdminWebKeys.FILTER\_MANAGEABLE\_ORGANIZATIONS, filterManageableOrganizations);
request.setAttribute(UsersAdminWebKeys.STATUS, status);
ViewUsersManagementToolbarDisplayContext viewUsersManagementToolbarDisplayContext = new ViewUsersManagementToolbarDisplayContext(request, renderRequest, renderResponse, displayStyle, navigation, status);
diff --git a/modules/core/portal-bootstrap/system.packages.extra.bnd b/modules/core/portal-bootstrap/system.packages.extra.bnd
index 10423995ffb514..4833dc0a45235d 100644
--- a/modules/core/portal-bootstrap/system.packages.extra.bnd
+++ b/modules/core/portal-bootstrap/system.packages.extra.bnd
@@ -173,11 +173,11 @@ Export-Package:\
org.aopalliance.\*;version='1.0',\
\
org.apache.bcel.\*;version='2.7.1',\
- org.apache.commons.beanutils;version='1.8.2',\
- org.apache.commons.beanutils.converters;version='1.8.2',\
- org.apache.commons.beanutils.expression;version='1.8.2',\
- org.apache.commons.beanutils.locale;version='1.8.2',\
- org.apache.commons.beanutils.locale.converters;version='1.8.2',\
+ org.apache.commons.beanutils;version='1.9.4',\
+ org.apache.commons.beanutils.converters;version='1.9.4',\
+ org.apache.commons.beanutils.expression;version='1.9.4',\
+ org.apache.commons.beanutils.locale;version='1.9.4',\
+ org.apache.commons.beanutils.locale.converters;version='1.9.4',\
org.apache.commons.chain;version='1.2',\
org.apache.commons.chain.config;version='1.2',\
org.apache.commons.chain.generic;version='1.2',\
diff --git a/modules/source-formatter.properties b/modules/source-formatter.properties
new file mode 100644
index 00000000000000..3214fae8f044d2
--- /dev/null
+++ b/modules/source-formatter.properties
@@ -0,0 +1,10 @@
+##
+## Exclusions
+##
+## See https://github.com/liferay/liferay-portal/blob/master/source-formatter.properties
+## for available properties.
+##
+
+ source.check.gradle.dependency.artifacts.check.enforceVersionArtifacts=\
+ com.fasterxml.jackson.core:jackson-databind:2.9.9.3,\
+ org.apache.commons:commons-compress:1.19
diff --git a/portal-impl/src/com/liferay/portal/jsonwebservice/JSONWebServiceActionImpl.java b/portal-impl/src/com/liferay/portal/jsonwebservice/JSONWebServiceActionImpl.java
index bc8cc30265c015..cb0a8165739a1b 100644
--- a/portal-impl/src/com/liferay/portal/jsonwebservice/JSONWebServiceActionImpl.java
+++ b/portal-impl/src/com/liferay/portal/jsonwebservice/JSONWebServiceActionImpl.java
@@ -22,11 +22,19 @@
import com.liferay.portal.kernel.log.Log;
import com.liferay.portal.kernel.log.LogFactoryUtil;
import com.liferay.portal.kernel.service.ServiceContext;
+import com.liferay.portal.kernel.util.ArrayUtil;
import com.liferay.portal.kernel.util.CamelCaseUtil;
import com.liferay.portal.kernel.util.GetterUtil;
import com.liferay.portal.kernel.util.LocaleUtil;
import com.liferay.portal.kernel.util.MethodParameter;
+import com.liferay.portal.kernel.util.PropsKeys;
import com.liferay.portal.kernel.util.StringBundler;
+import com.liferay.portal.util.PropsUtil;
+import com.liferay.registry.Registry;
+import com.liferay.registry.RegistryUtil;
+import com.liferay.registry.ServiceReference;
+import com.liferay.registry.ServiceTracker;
+import com.liferay.registry.util.StringPlus;
import java.lang.reflect.Array;
import java.lang.reflect.Method;
@@ -38,6 +46,7 @@
import java.util.List;
import java.util.Locale;
import java.util.Map;
+import java.util.Objects;
import jodd.bean.BeanCopy;
import jodd.bean.BeanUtil;
@@ -92,6 +101,71 @@ public Object invoke() throws Exception {
return new JSONRPCResponse(jsonRPCRequest, result, exception);
}
+ private void \_checkTypeIsAssignable(
+ int argumentPos, Class  targetClass, Class  parameterType) {
+
+ String parameterTypeName = parameterType.getName();
+
+ if (parameterTypeName.contains("com.liferay") &&
+ parameterTypeName.contains("Util")) {
+
+ throw new IllegalArgumentException(
+ "Not instantiating " + parameterTypeName);
+ }
+
+ if (Objects.equals(targetClass, parameterType)) {
+ return;
+ }
+
+ if (!ReflectUtil.isTypeOf(parameterType, targetClass)) {
+ throw new IllegalArgumentException(
+ StringBundler.concat(
+ "Unmatched argument type ", parameterTypeName,
+ " for method argument ", String.valueOf(argumentPos)));
+ }
+
+ if (parameterType.isPrimitive()) {
+ return;
+ }
+
+ if (parameterTypeName.equals(
+ \_jsonWebServiceNaming.convertModelClassToImplClassName(
+ targetClass))) {
+
+ return;
+ }
+
+ if (ArrayUtil.contains(
+ \_JSONWS\_WEB\_SERVICE\_PARAMETER\_TYPE\_WHITELIST\_CLASS\_NAMES,
+ parameterTypeName)) {
+
+ return;
+ }
+
+ ServiceReference[] serviceReferences =
+ \_serviceTracker.getServiceReferences();
+
+ if (serviceReferences != null) {
+ String key =
+ PropsKeys.
+ JSONWS\_WEB\_SERVICE\_PARAMETER\_TYPE\_WHITELIST\_CLASS\_NAMES;
+
+ for (ServiceReference serviceReference :
+ serviceReferences) {
+
+ List whitelistedClassNames = StringPlus.asList(
+ serviceReference.getProperty(key));
+
+ if (whitelistedClassNames.contains(parameterTypeName)) {
+ return;
+ }
+ }
+ }
+
+ throw new TypeConversionException(
+ parameterTypeName + " is not allowed to be instantiated");
+ }
+
private Object \_convertListToArray(List  list, Class  componentType) {
Object array = Array.newInstance(componentType, list.size());
@@ -314,13 +388,6 @@ private Object \_createDefaultParameterValue(
return serviceContext;
}
- String className = parameterType.getName();
-
- if (className.contains("com.liferay") && className.contains("Util")) {
- throw new IllegalArgumentException(
- "Not instantiating " + className);
- }
-
return parameterType.newInstance();
}
@@ -439,7 +506,9 @@ private Object[] \_prepareParameters(Class  actionClass) throws Exception {
Object parameterValue = null;
if (value != null) {
- Class  parameterType = methodParameters[i].getType();
+ Class  targetClass = methodParameters[i].getType();
+
+ Class  parameterType = targetClass;
String parameterTypeName =
\_jsonWebServiceActionParameters.getParameterTypeName(
@@ -450,15 +519,7 @@ private Object[] \_prepareParameters(Class  actionClass) throws Exception {
parameterType = classLoader.loadClass(parameterTypeName);
- if (!ReflectUtil.isTypeOf(
- parameterType, methodParameters[i].getType())) {
-
- throw new IllegalArgumentException(
- StringBundler.concat(
- "Unmatched argument type ",
- parameterType.getName(),
- " for method argument ", String.valueOf(i)));
- }
+ \_checkTypeIsAssignable(i, targetClass, parameterType);
}
if (value.equals(Void.TYPE)) {
@@ -496,9 +557,31 @@ private Object[] \_prepareParameters(Class  actionClass) throws Exception {
return parameters;
}
+ private static final String[]
+ \_JSONWS\_WEB\_SERVICE\_PARAMETER\_TYPE\_WHITELIST\_CLASS\_NAMES =
+ PropsUtil.getArray(
+ PropsKeys.
+ JSONWS\_WEB\_SERVICE\_PARAMETER\_TYPE\_WHITELIST\_CLASS\_NAMES);
+
private static final Log \_log = LogFactoryUtil.getLog(
JSONWebServiceActionImpl.class);
+ private static final ServiceTracker \_serviceTracker;
+
+ static {
+ Registry registry = RegistryUtil.getRegistry();
+
+ \_serviceTracker = registry.trackServices(
+ registry.getFilter(
+ StringBundler.concat(
+ "(",
+ PropsKeys.
+ JSONWS\_WEB\_SERVICE\_PARAMETER\_TYPE\_WHITELIST\_CLASS\_NAMES,
+ "=\*)")));
+
+ \_serviceTracker.open();
+ }
+
private final JSONWebServiceActionConfig \_jsonWebServiceActionConfig;
private final JSONWebServiceActionParameters
\_jsonWebServiceActionParameters;
diff --git a/portal-impl/src/com/liferay/portal/security/permission/PermissionCacheUtil.java b/portal-impl/src/com/liferay/portal/security/permission/PermissionCacheUtil.java
index 3299308104f001..3ea753de3d4ac8 100644
--- a/portal-impl/src/com/liferay/portal/security/permission/PermissionCacheUtil.java
+++ b/portal-impl/src/com/liferay/portal/security/permission/PermissionCacheUtil.java
@@ -27,6 +27,7 @@
import com.liferay.portal.kernel.cluster.ClusterRequest;
import com.liferay.portal.kernel.model.ResourceConstants;
import com.liferay.portal.kernel.model.Role;
+import com.liferay.portal.kernel.security.permission.PermissionChecker;
import com.liferay.portal.kernel.security.permission.PermissionThreadLocal;
import com.liferay.portal.kernel.security.permission.ResourceBlockIdsBag;
import com.liferay.portal.kernel.security.permission.UserBag;
@@ -37,6 +38,7 @@
import java.io.Serializable;
import java.util.Arrays;
+import java.util.Map;
import java.util.Objects;
/\*\*
@@ -75,6 +77,8 @@ public static void clearCache() {
return;
}
+ \_clearPermissionChecksMap();
+
\_userRolePortalCache.removeAll();
\_userGroupRoleIdsPortalCache.removeAll();
\_permissionPortalCache.removeAll();
@@ -87,6 +91,8 @@ public static void clearCache(long... userIds) {
return;
}
+ \_clearPermissionChecksMap();
+
for (long userId : userIds) {
\_userBagPortalCache.remove(userId);
@@ -105,6 +111,8 @@ public static void clearPrimaryKeyRoleCache() {
return;
}
+ \_clearPermissionChecksMap();
+
\_permissionPortalCache.removeAll();
\_userPrimaryKeyRolePortalCache.removeAll();
}
@@ -121,6 +129,8 @@ public static void clearResourceCache() {
if (!ExportImportThreadLocal.isImportInProcess()) {
\_permissionPortalCache.removeAll();
}
+
+ \_clearPermissionChecksMap();
}
public static void clearResourcePermissionCache(
@@ -133,6 +143,8 @@ public static void clearResourcePermissionCache(
return;
}
+ \_clearPermissionChecksMap();
+
if (scope == ResourceConstants.SCOPE\_INDIVIDUAL) {
\_permissionPortalCacheNamePrimKeyIndexer.removeKeys(
PermissionKeyNamePrimKeyIndexEncoder.encode(name, primKey));
@@ -313,6 +325,20 @@ public static void removeUserPrimaryKeyRole(
\_userPrimaryKeyRolePortalCache.remove(userPrimaryKeyRoleKey);
}
+ private static void \_clearPermissionChecksMap() {
+ PermissionChecker permissionChecker =
+ PermissionThreadLocal.getPermissionChecker();
+
+ if (permissionChecker != null) {
+ Map permissionChecksMap =
+ permissionChecker.getPermissionChecksMap();
+
+ if (permissionChecksMap != null) {
+ permissionChecksMap.clear();
+ }
+ }
+ }
+
private static void \_sendClearCacheClusterMessage(
MethodKey methodKey, Object... arguments) {
diff --git a/portal-impl/src/com/liferay/portal/service/http/LayoutServiceHttp.java b/portal-impl/src/com/liferay/portal/service/http/LayoutServiceHttp.java
index 317d5c6e4b5134..2d1fb1d2bb8763 100644
--- a/portal-impl/src/com/liferay/portal/service/http/LayoutServiceHttp.java
+++ b/portal-impl/src/com/liferay/portal/service/http/LayoutServiceHttp.java
@@ -1356,13 +1356,54 @@ public static long getLayoutPlid(
}
public static java.util.List
- getLayouts(HttpPrincipal httpPrincipal, long groupId, String type) {
+ getLayouts(
+ HttpPrincipal httpPrincipal, long groupId,
+ boolean privateLayout, String type)
+ throws com.liferay.portal.kernel.exception.PortalException {
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "getLayouts",
\_getLayoutsParameterTypes33);
+ MethodHandler methodHandler = new MethodHandler(
+ methodKey, groupId, privateLayout, type);
+
+ Object returnObj = null;
+
+ try {
+ returnObj = TunnelUtil.invoke(httpPrincipal, methodHandler);
+ }
+ catch (Exception e) {
+ if (e instanceof
+ com.liferay.portal.kernel.exception.PortalException) {
+
+ throw (com.liferay.portal.kernel.exception.PortalException)
+ e;
+ }
+
+ throw new com.liferay.portal.kernel.exception.SystemException(
+ e);
+ }
+
+ return (java.util.List)
+ returnObj;
+ }
+ catch (com.liferay.portal.kernel.exception.SystemException se) {
+ \_log.error(se, se);
+
+ throw se;
+ }
+ }
+
+ public static java.util.List
+ getLayouts(HttpPrincipal httpPrincipal, long groupId, String type) {
+
+ try {
+ MethodKey methodKey = new MethodKey(
+ LayoutServiceUtil.class, "getLayouts",
+ \_getLayoutsParameterTypes34);
+
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, type);
@@ -1394,7 +1435,7 @@ public static long getLayoutPlid(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "getLayouts",
- \_getLayoutsParameterTypes34);
+ \_getLayoutsParameterTypes35);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, type, start, end);
@@ -1425,7 +1466,7 @@ public static int getLayoutsCount(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "getLayoutsCount",
- \_getLayoutsCountParameterTypes35);
+ \_getLayoutsCountParameterTypes36);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, privateLayout);
@@ -1456,7 +1497,7 @@ public static int getLayoutsCount(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "getLayoutsCount",
- \_getLayoutsCountParameterTypes36);
+ \_getLayoutsCountParameterTypes37);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, privateLayout, parentLayoutId);
@@ -1487,7 +1528,7 @@ public static int getLayoutsCount(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "getLayoutsCount",
- \_getLayoutsCountParameterTypes37);
+ \_getLayoutsCountParameterTypes38);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, privateLayout, parentLayoutId, priority);
@@ -1517,7 +1558,7 @@ public static int getLayoutsCount(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "getLayoutsCount",
- \_getLayoutsCountParameterTypes38);
+ \_getLayoutsCountParameterTypes39);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, type);
@@ -1548,7 +1589,7 @@ public static String[] getTempFileNames(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "getTempFileNames",
- \_getTempFileNamesParameterTypes39);
+ \_getTempFileNamesParameterTypes40);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, folderName);
@@ -1587,7 +1628,7 @@ public static boolean hasLayout(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "hasLayout",
- \_hasLayoutParameterTypes40);
+ \_hasLayoutParameterTypes41);
MethodHandler methodHandler = new MethodHandler(
methodKey, uuid, groupId, privateLayout);
@@ -1625,7 +1666,7 @@ public static boolean hasPortletId(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "hasPortletId",
- \_hasPortletIdParameterTypes41);
+ \_hasPortletIdParameterTypes42);
MethodHandler methodHandler = new MethodHandler(
methodKey, plid, portletId);
@@ -1666,7 +1707,7 @@ public static void importLayouts(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "importLayouts",
- \_importLayoutsParameterTypes42);
+ \_importLayoutsParameterTypes43);
MethodHandler methodHandler = new MethodHandler(
methodKey, exportImportConfiguration, file);
@@ -1703,7 +1744,7 @@ public static void importLayouts(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "importLayouts",
- \_importLayoutsParameterTypes43);
+ \_importLayoutsParameterTypes44);
MethodHandler methodHandler = new MethodHandler(
methodKey, exportImportConfiguration, is);
@@ -1738,7 +1779,7 @@ public static void importLayouts(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "importLayouts",
- \_importLayoutsParameterTypes44);
+ \_importLayoutsParameterTypes45);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, privateLayout, parameterMap, bytes);
@@ -1773,7 +1814,7 @@ public static void importLayouts(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "importLayouts",
- \_importLayoutsParameterTypes45);
+ \_importLayoutsParameterTypes46);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, privateLayout, parameterMap, file);
@@ -1809,7 +1850,7 @@ public static void importLayouts(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "importLayouts",
- \_importLayoutsParameterTypes46);
+ \_importLayoutsParameterTypes47);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, privateLayout, parameterMap, is);
@@ -1845,7 +1886,7 @@ public static long importLayoutsInBackground(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "importLayoutsInBackground",
- \_importLayoutsInBackgroundParameterTypes47);
+ \_importLayoutsInBackgroundParameterTypes48);
MethodHandler methodHandler = new MethodHandler(
methodKey, taskName, groupId, privateLayout, parameterMap,
@@ -1886,7 +1927,7 @@ public static long importLayoutsInBackground(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "importLayoutsInBackground",
- \_importLayoutsInBackgroundParameterTypes48);
+ \_importLayoutsInBackgroundParameterTypes49);
MethodHandler methodHandler = new MethodHandler(
methodKey, taskName, groupId, privateLayout, parameterMap,
@@ -1928,7 +1969,7 @@ public static void importPortletInfo(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "importPortletInfo",
- \_importPortletInfoParameterTypes49);
+ \_importPortletInfoParameterTypes50);
MethodHandler methodHandler = new MethodHandler(
methodKey, exportImportConfiguration, file);
@@ -1965,7 +2006,7 @@ public static void importPortletInfo(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "importPortletInfo",
- \_importPortletInfoParameterTypes50);
+ \_importPortletInfoParameterTypes51);
MethodHandler methodHandler = new MethodHandler(
methodKey, exportImportConfiguration, is);
@@ -2001,7 +2042,7 @@ public static void importPortletInfo(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "importPortletInfo",
- \_importPortletInfoParameterTypes51);
+ \_importPortletInfoParameterTypes52);
MethodHandler methodHandler = new MethodHandler(
methodKey, plid, groupId, portletId, parameterMap, file);
@@ -2037,7 +2078,7 @@ public static void importPortletInfo(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "importPortletInfo",
- \_importPortletInfoParameterTypes52);
+ \_importPortletInfoParameterTypes53);
MethodHandler methodHandler = new MethodHandler(
methodKey, plid, groupId, portletId, parameterMap, is);
@@ -2072,7 +2113,7 @@ public static void importPortletInfo(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "importPortletInfo",
- \_importPortletInfoParameterTypes53);
+ \_importPortletInfoParameterTypes54);
MethodHandler methodHandler = new MethodHandler(
methodKey, portletId, parameterMap, file);
@@ -2108,7 +2149,7 @@ public static void importPortletInfo(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "importPortletInfo",
- \_importPortletInfoParameterTypes54);
+ \_importPortletInfoParameterTypes55);
MethodHandler methodHandler = new MethodHandler(
methodKey, portletId, parameterMap, is);
@@ -2144,7 +2185,7 @@ public static long importPortletInfoInBackground(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "importPortletInfoInBackground",
- \_importPortletInfoInBackgroundParameterTypes55);
+ \_importPortletInfoInBackgroundParameterTypes56);
MethodHandler methodHandler = new MethodHandler(
methodKey, taskName, plid, groupId, portletId, parameterMap,
@@ -2186,7 +2227,7 @@ public static long importPortletInfoInBackground(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "importPortletInfoInBackground",
- \_importPortletInfoInBackgroundParameterTypes56);
+ \_importPortletInfoInBackgroundParameterTypes57);
MethodHandler methodHandler = new MethodHandler(
methodKey, taskName, plid, groupId, portletId, parameterMap,
@@ -2226,7 +2267,7 @@ public static void importPortletInfoInBackground(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "importPortletInfoInBackground",
- \_importPortletInfoInBackgroundParameterTypes57);
+ \_importPortletInfoInBackgroundParameterTypes58);
MethodHandler methodHandler = new MethodHandler(
methodKey, taskName, portletId, parameterMap, file);
@@ -2262,7 +2303,7 @@ public static void importPortletInfoInBackground(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "importPortletInfoInBackground",
- \_importPortletInfoInBackgroundParameterTypes58);
+ \_importPortletInfoInBackgroundParameterTypes59);
MethodHandler methodHandler = new MethodHandler(
methodKey, taskName, portletId, parameterMap, is);
@@ -2301,7 +2342,7 @@ public static void schedulePublishToLive(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "schedulePublishToLive",
- \_schedulePublishToLiveParameterTypes59);
+ \_schedulePublishToLiveParameterTypes60);
MethodHandler methodHandler = new MethodHandler(
methodKey, sourceGroupId, targetGroupId, privateLayout,
@@ -2341,7 +2382,7 @@ public static void schedulePublishToLive(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "schedulePublishToLive",
- \_schedulePublishToLiveParameterTypes60);
+ \_schedulePublishToLiveParameterTypes61);
MethodHandler methodHandler = new MethodHandler(
methodKey, sourceGroupId, targetGroupId, privateLayout,
@@ -2382,7 +2423,7 @@ public static void schedulePublishToLive(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "schedulePublishToLive",
- \_schedulePublishToLiveParameterTypes61);
+ \_schedulePublishToLiveParameterTypes62);
MethodHandler methodHandler = new MethodHandler(
methodKey, sourceGroupId, targetGroupId, privateLayout,
@@ -2425,7 +2466,7 @@ public static void schedulePublishToRemote(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "schedulePublishToRemote",
- \_schedulePublishToRemoteParameterTypes62);
+ \_schedulePublishToRemoteParameterTypes63);
MethodHandler methodHandler = new MethodHandler(
methodKey, sourceGroupId, privateLayout, layoutIdMap,
@@ -2465,7 +2506,7 @@ public static void setLayouts(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "setLayouts",
- \_setLayoutsParameterTypes63);
+ \_setLayoutsParameterTypes64);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, privateLayout, parentLayoutId, layoutIds,
@@ -2501,7 +2542,7 @@ public static void unschedulePublishToLive(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "unschedulePublishToLive",
- \_unschedulePublishToLiveParameterTypes64);
+ \_unschedulePublishToLiveParameterTypes65);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, jobName, groupName);
@@ -2536,7 +2577,7 @@ public static void unschedulePublishToRemote(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "unschedulePublishToRemote",
- \_unschedulePublishToRemoteParameterTypes65);
+ \_unschedulePublishToRemoteParameterTypes66);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, jobName, groupName);
@@ -2570,7 +2611,7 @@ public static com.liferay.portal.kernel.model.Layout updateIconImage(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "updateIconImage",
- \_updateIconImageParameterTypes66);
+ \_updateIconImageParameterTypes67);
MethodHandler methodHandler = new MethodHandler(
methodKey, plid, bytes);
@@ -2618,7 +2659,7 @@ public static com.liferay.portal.kernel.model.Layout updateLayout(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "updateLayout",
- \_updateLayoutParameterTypes67);
+ \_updateLayoutParameterTypes68);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, privateLayout, layoutId, parentLayoutId,
@@ -2660,7 +2701,7 @@ public static com.liferay.portal.kernel.model.Layout updateLayout(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "updateLayout",
- \_updateLayoutParameterTypes68);
+ \_updateLayoutParameterTypes69);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, privateLayout, layoutId, typeSettings);
@@ -2699,7 +2740,7 @@ public static com.liferay.portal.kernel.model.Layout updateLookAndFeel(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "updateLookAndFeel",
- \_updateLookAndFeelParameterTypes69);
+ \_updateLookAndFeelParameterTypes70);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, privateLayout, layoutId, themeId,
@@ -2739,7 +2780,7 @@ public static com.liferay.portal.kernel.model.Layout updateName(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "updateName",
- \_updateNameParameterTypes70);
+ \_updateNameParameterTypes71);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, privateLayout, layoutId, name, languageId);
@@ -2778,7 +2819,7 @@ public static com.liferay.portal.kernel.model.Layout updateName(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "updateName",
- \_updateNameParameterTypes71);
+ \_updateNameParameterTypes72);
MethodHandler methodHandler = new MethodHandler(
methodKey, plid, name, languageId);
@@ -2817,7 +2858,7 @@ public static com.liferay.portal.kernel.model.Layout updateParentLayoutId(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "updateParentLayoutId",
- \_updateParentLayoutIdParameterTypes72);
+ \_updateParentLayoutIdParameterTypes73);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, privateLayout, layoutId, parentLayoutId);
@@ -2855,7 +2896,7 @@ public static com.liferay.portal.kernel.model.Layout updateParentLayoutId(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "updateParentLayoutId",
- \_updateParentLayoutIdParameterTypes73);
+ \_updateParentLayoutIdParameterTypes74);
MethodHandler methodHandler = new MethodHandler(
methodKey, plid, parentPlid);
@@ -2895,7 +2936,7 @@ public static com.liferay.portal.kernel.model.Layout updateParentLayoutId(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "updateParentLayoutIdAndPriority",
- \_updateParentLayoutIdAndPriorityParameterTypes74);
+ \_updateParentLayoutIdAndPriorityParameterTypes75);
MethodHandler methodHandler = new MethodHandler(
methodKey, plid, parentPlid, priority);
@@ -2934,7 +2975,7 @@ public static com.liferay.portal.kernel.model.Layout updatePriority(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "updatePriority",
- \_updatePriorityParameterTypes75);
+ \_updatePriorityParameterTypes76);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, privateLayout, layoutId, priority);
@@ -2973,7 +3014,7 @@ public static com.liferay.portal.kernel.model.Layout updatePriority(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "updatePriority",
- \_updatePriorityParameterTypes76);
+ \_updatePriorityParameterTypes77);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, privateLayout, layoutId, nextLayoutId,
@@ -3012,7 +3053,7 @@ public static com.liferay.portal.kernel.model.Layout updatePriority(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "updatePriority",
- \_updatePriorityParameterTypes77);
+ \_updatePriorityParameterTypes78);
MethodHandler methodHandler = new MethodHandler(
methodKey, plid, priority);
@@ -3054,7 +3095,7 @@ public static com.liferay.portal.kernel.model.Layout updatePriority(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "validateImportLayoutsFile",
- \_validateImportLayoutsFileParameterTypes78);
+ \_validateImportLayoutsFileParameterTypes79);
MethodHandler methodHandler = new MethodHandler(
methodKey, exportImportConfiguration, file);
@@ -3097,7 +3138,7 @@ public static com.liferay.portal.kernel.model.Layout updatePriority(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "validateImportLayoutsFile",
- \_validateImportLayoutsFileParameterTypes79);
+ \_validateImportLayoutsFileParameterTypes80);
MethodHandler methodHandler = new MethodHandler(
methodKey, exportImportConfiguration, inputStream);
@@ -3139,7 +3180,7 @@ public static com.liferay.portal.kernel.model.Layout updatePriority(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "validateImportLayoutsFile",
- \_validateImportLayoutsFileParameterTypes80);
+ \_validateImportLayoutsFileParameterTypes81);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, privateLayout, parameterMap, file);
@@ -3182,7 +3223,7 @@ public static com.liferay.portal.kernel.model.Layout updatePriority(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "validateImportLayoutsFile",
- \_validateImportLayoutsFileParameterTypes81);
+ \_validateImportLayoutsFileParameterTypes82);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, privateLayout, parameterMap, inputStream);
@@ -3225,7 +3266,7 @@ public static com.liferay.portal.kernel.model.Layout updatePriority(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "validateImportPortletInfo",
- \_validateImportPortletInfoParameterTypes82);
+ \_validateImportPortletInfoParameterTypes83);
MethodHandler methodHandler = new MethodHandler(
methodKey, exportImportConfiguration, file);
@@ -3268,7 +3309,7 @@ public static com.liferay.portal.kernel.model.Layout updatePriority(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "validateImportPortletInfo",
- \_validateImportPortletInfoParameterTypes83);
+ \_validateImportPortletInfoParameterTypes84);
MethodHandler methodHandler = new MethodHandler(
methodKey, exportImportConfiguration, inputStream);
@@ -3310,7 +3351,7 @@ public static com.liferay.portal.kernel.model.Layout updatePriority(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "validateImportPortletInfo",
- \_validateImportPortletInfoParameterTypes84);
+ \_validateImportPortletInfoParameterTypes85);
MethodHandler methodHandler = new MethodHandler(
methodKey, plid, groupId, portletId, parameterMap, file);
@@ -3352,7 +3393,7 @@ public static com.liferay.portal.kernel.model.Layout updatePriority(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "validateImportPortletInfo",
- \_validateImportPortletInfoParameterTypes85);
+ \_validateImportPortletInfoParameterTypes86);
MethodHandler methodHandler = new MethodHandler(
methodKey, plid, groupId, portletId, parameterMap, inputStream);
@@ -3517,129 +3558,132 @@ public static com.liferay.portal.kernel.model.Layout updatePriority(
int.class
};
private static final Class [] \_getLayoutsParameterTypes33 = new Class[] {
- long.class, String.class
+ long.class, boolean.class, String.class
};
private static final Class [] \_getLayoutsParameterTypes34 = new Class[] {
+ long.class, String.class
+ };
+ private static final Class [] \_getLayoutsParameterTypes35 = new Class[] {
long.class, String.class, int.class, int.class
};
- private static final Class [] \_getLayoutsCountParameterTypes35 =
- new Class[] {long.class, boolean.class};
private static final Class [] \_getLayoutsCountParameterTypes36 =
- new Class[] {long.class, boolean.class, long.class};
+ new Class[] {long.class, boolean.class};
private static final Class [] \_getLayoutsCountParameterTypes37 =
- new Class[] {long.class, boolean.class, long.class, int.class};
+ new Class[] {long.class, boolean.class, long.class};
private static final Class [] \_getLayoutsCountParameterTypes38 =
+ new Class[] {long.class, boolean.class, long.class, int.class};
+ private static final Class [] \_getLayoutsCountParameterTypes39 =
new Class[] {long.class, String.class};
- private static final Class [] \_getTempFileNamesParameterTypes39 =
+ private static final Class [] \_getTempFileNamesParameterTypes40 =
new Class[] {long.class, String.class};
- private static final Class [] \_hasLayoutParameterTypes40 = new Class[] {
+ private static final Class [] \_hasLayoutParameterTypes41 = new Class[] {
String.class, long.class, boolean.class
};
- private static final Class [] \_hasPortletIdParameterTypes41 =
+ private static final Class [] \_hasPortletIdParameterTypes42 =
new Class[] {long.class, String.class};
- private static final Class [] \_importLayoutsParameterTypes42 =
+ private static final Class [] \_importLayoutsParameterTypes43 =
new Class[] {
com.liferay.exportimport.kernel.model.ExportImportConfiguration.
class,
java.io.File.class
};
- private static final Class [] \_importLayoutsParameterTypes43 =
+ private static final Class [] \_importLayoutsParameterTypes44 =
new Class[] {
com.liferay.exportimport.kernel.model.ExportImportConfiguration.
class,
java.io.InputStream.class
};
- private static final Class [] \_importLayoutsParameterTypes44 =
+ private static final Class [] \_importLayoutsParameterTypes45 =
new Class[] {
long.class, boolean.class, java.util.Map.class, byte[].class
};
- private static final Class [] \_importLayoutsParameterTypes45 =
+ private static final Class [] \_importLayoutsParameterTypes46 =
new Class[] {
long.class, boolean.class, java.util.Map.class, java.io.File.class
};
- private static final Class [] \_importLayoutsParameterTypes46 =
+ private static final Class [] \_importLayoutsParameterTypes47 =
new Class[] {
long.class, boolean.class, java.util.Map.class,
java.io.InputStream.class
};
- private static final Class [] \_importLayoutsInBackgroundParameterTypes47 =
+ private static final Class [] \_importLayoutsInBackgroundParameterTypes48 =
new Class[] {
String.class, long.class, boolean.class, java.util.Map.class,
java.io.File.class
};
- private static final Class [] \_importLayoutsInBackgroundParameterTypes48 =
+ private static final Class [] \_importLayoutsInBackgroundParameterTypes49 =
new Class[] {
String.class, long.class, boolean.class, java.util.Map.class,
java.io.InputStream.class
};
- private static final Class [] \_importPortletInfoParameterTypes49 =
+ private static final Class [] \_importPortletInfoParameterTypes50 =
new Class[] {
com.liferay.exportimport.kernel.model.ExportImportConfiguration.
class,
java.io.File.class
};
- private static final Class [] \_importPortletInfoParameterTypes50 =
+ private static final Class [] \_importPortletInfoParameterTypes51 =
new Class[] {
com.liferay.exportimport.kernel.model.ExportImportConfiguration.
class,
java.io.InputStream.class
};
- private static final Class [] \_importPortletInfoParameterTypes51 =
+ private static final Class [] \_importPortletInfoParameterTypes52 =
new Class[] {
long.class, long.class, String.class, java.util.Map.class,
java.io.File.class
};
- private static final Class [] \_importPortletInfoParameterTypes52 =
+ private static final Class [] \_importPortletInfoParameterTypes53 =
new Class[] {
long.class, long.class, String.class, java.util.Map.class,
java.io.InputStream.class
};
- private static final Class [] \_importPortletInfoParameterTypes53 =
- new Class[] {String.class, java.util.Map.class, java.io.File.class};
private static final Class [] \_importPortletInfoParameterTypes54 =
+ new Class[] {String.class, java.util.Map.class, java.io.File.class};
+ private static final Class [] \_importPortletInfoParameterTypes55 =
new Class[] {
String.class, java.util.Map.class, java.io.InputStream.class
};
private static final Class []
- \_importPortletInfoInBackgroundParameterTypes55 = new Class[] {
+ \_importPortletInfoInBackgroundParameterTypes56 = new Class[] {
String.class, long.class, long.class, String.class,
java.util.Map.class, java.io.File.class
};
private static final Class []
- \_importPortletInfoInBackgroundParameterTypes56 = new Class[] {
+ \_importPortletInfoInBackgroundParameterTypes57 = new Class[] {
String.class, long.class, long.class, String.class,
java.util.Map.class, java.io.InputStream.class
};
private static final Class []
- \_importPortletInfoInBackgroundParameterTypes57 = new Class[] {
+ \_importPortletInfoInBackgroundParameterTypes58 = new Class[] {
String.class, String.class, java.util.Map.class, java.io.File.class
};
private static final Class []
- \_importPortletInfoInBackgroundParameterTypes58 = new Class[] {
+ \_importPortletInfoInBackgroundParameterTypes59 = new Class[] {
String.class, String.class, java.util.Map.class,
java.io.InputStream.class
};
- private static final Class [] \_schedulePublishToLiveParameterTypes59 =
+ private static final Class [] \_schedulePublishToLiveParameterTypes60 =
new Class[] {
long.class, long.class, boolean.class, long[].class,
java.util.Map.class, String.class, java.util.Date.class,
java.util.Date.class, String.class, String.class,
java.util.Date.class, java.util.Date.class, String.class
};
- private static final Class [] \_schedulePublishToLiveParameterTypes60 =
+ private static final Class [] \_schedulePublishToLiveParameterTypes61 =
new Class[] {
long.class, long.class, boolean.class, long[].class,
java.util.Map.class, String.class, String.class,
java.util.Date.class, java.util.Date.class, String.class
};
- private static final Class [] \_schedulePublishToLiveParameterTypes61 =
+ private static final Class [] \_schedulePublishToLiveParameterTypes62 =
new Class[] {
long.class, long.class, boolean.class, java.util.Map.class,
java.util.Map.class, String.class, java.util.Date.class,
java.util.Date.class, String.class, String.class,
java.util.Date.class, java.util.Date.class, String.class
};
- private static final Class [] \_schedulePublishToRemoteParameterTypes62 =
+ private static final Class [] \_schedulePublishToRemoteParameterTypes63 =
new Class[] {
long.class, boolean.class, java.util.Map.class, java.util.Map.class,
String.class, int.class, String.class, boolean.class, long.class,
@@ -3647,17 +3691,17 @@ public static com.liferay.portal.kernel.model.Layout updatePriority(
String.class, String.class, java.util.Date.class,
java.util.Date.class, String.class
};
- private static final Class [] \_setLayoutsParameterTypes63 = new Class[] {
+ private static final Class [] \_setLayoutsParameterTypes64 = new Class[] {
long.class, boolean.class, long.class, long[].class,
com.liferay.portal.kernel.service.ServiceContext.class
};
- private static final Class [] \_unschedulePublishToLiveParameterTypes64 =
+ private static final Class [] \_unschedulePublishToLiveParameterTypes65 =
new Class[] {long.class, String.class, String.class};
- private static final Class [] \_unschedulePublishToRemoteParameterTypes65 =
+ private static final Class [] \_unschedulePublishToRemoteParameterTypes66 =
new Class[] {long.class, String.class, String.class};
- private static final Class [] \_updateIconImageParameterTypes66 =
+ private static final Class [] \_updateIconImageParameterTypes67 =
new Class[] {long.class, byte[].class};
- private static final Class [] \_updateLayoutParameterTypes67 =
+ private static final Class [] \_updateLayoutParameterTypes68 =
new Class[] {
long.class, boolean.class, long.class, long.class,
java.util.Map.class, java.util.Map.class, java.util.Map.class,
@@ -3665,74 +3709,74 @@ public static com.liferay.portal.kernel.model.Layout updatePriority(
boolean.class, java.util.Map.class, boolean.class, byte[].class,
com.liferay.portal.kernel.service.ServiceContext.class
};
- private static final Class [] \_updateLayoutParameterTypes68 =
+ private static final Class [] \_updateLayoutParameterTypes69 =
new Class[] {long.class, boolean.class, long.class, String.class};
- private static final Class [] \_updateLookAndFeelParameterTypes69 =
+ private static final Class [] \_updateLookAndFeelParameterTypes70 =
new Class[] {
long.class, boolean.class, long.class, String.class, String.class,
String.class
};
- private static final Class [] \_updateNameParameterTypes70 = new Class[] {
+ private static final Class [] \_updateNameParameterTypes71 = new Class[] {
long.class, boolean.class, long.class, String.class, String.class
};
- private static final Class [] \_updateNameParameterTypes71 = new Class[] {
+ private static final Class [] \_updateNameParameterTypes72 = new Class[] {
long.class, String.class, String.class
};
- private static final Class [] \_updateParentLayoutIdParameterTypes72 =
- new Class[] {long.class, boolean.class, long.class, long.class};
private static final Class [] \_updateParentLayoutIdParameterTypes73 =
+ new Class[] {long.class, boolean.class, long.class, long.class};
+ private static final Class [] \_updateParentLayoutIdParameterTypes74 =
new Class[] {long.class, long.class};
private static final Class []
- \_updateParentLayoutIdAndPriorityParameterTypes74 = new Class[] {
+ \_updateParentLayoutIdAndPriorityParameterTypes75 = new Class[] {
long.class, long.class, int.class
};
- private static final Class [] \_updatePriorityParameterTypes75 =
- new Class[] {long.class, boolean.class, long.class, int.class};
private static final Class [] \_updatePriorityParameterTypes76 =
+ new Class[] {long.class, boolean.class, long.class, int.class};
+ private static final Class [] \_updatePriorityParameterTypes77 =
new Class[] {
long.class, boolean.class, long.class, long.class, long.class
};
- private static final Class [] \_updatePriorityParameterTypes77 =
+ private static final Class [] \_updatePriorityParameterTypes78 =
new Class[] {long.class, int.class};
- private static final Class [] \_validateImportLayoutsFileParameterTypes78 =
+ private static final Class [] \_validateImportLayoutsFileParameterTypes79 =
new Class[] {
com.liferay.exportimport.kernel.model.ExportImportConfiguration.
class,
java.io.File.class
};
- private static final Class [] \_validateImportLayoutsFileParameterTypes79 =
+ private static final Class [] \_validateImportLayoutsFileParameterTypes80 =
new Class[] {
com.liferay.exportimport.kernel.model.ExportImportConfiguration.
class,
java.io.InputStream.class
};
- private static final Class [] \_validateImportLayoutsFileParameterTypes80 =
+ private static final Class [] \_validateImportLayoutsFileParameterTypes81 =
new Class[] {
long.class, boolean.class, java.util.Map.class, java.io.File.class
};
- private static final Class [] \_validateImportLayoutsFileParameterTypes81 =
+ private static final Class [] \_validateImportLayoutsFileParameterTypes82 =
new Class[] {
long.class, boolean.class, java.util.Map.class,
java.io.InputStream.class
};
- private static final Class [] \_validateImportPortletInfoParameterTypes82 =
+ private static final Class [] \_validateImportPortletInfoParameterTypes83 =
new Class[] {
com.liferay.exportimport.kernel.model.ExportImportConfiguration.
class,
java.io.File.class
};
- private static final Class [] \_validateImportPortletInfoParameterTypes83 =
+ private static final Class [] \_validateImportPortletInfoParameterTypes84 =
new Class[] {
com.liferay.exportimport.kernel.model.ExportImportConfiguration.
class,
java.io.InputStream.class
};
- private static final Class [] \_validateImportPortletInfoParameterTypes84 =
+ private static final Class [] \_validateImportPortletInfoParameterTypes85 =
new Class[] {
long.class, long.class, String.class, java.util.Map.class,
java.io.File.class
};
- private static final Class [] \_validateImportPortletInfoParameterTypes85 =
+ private static final Class [] \_validateImportPortletInfoParameterTypes86 =
new Class[] {
long.class, long.class, String.class, java.util.Map.class,
java.io.InputStream.class
diff --git a/portal-impl/src/com/liferay/portal/service/http/LayoutServiceSoap.java b/portal-impl/src/com/liferay/portal/service/http/LayoutServiceSoap.java
index f82352cfecffd1..6607c877f775e6 100644
--- a/portal-impl/src/com/liferay/portal/service/http/LayoutServiceSoap.java
+++ b/portal-impl/src/com/liferay/portal/service/http/LayoutServiceSoap.java
@@ -614,6 +614,24 @@ public static com.liferay.portal.kernel.model.LayoutSoap[] getLayouts(
}
}
+ public static com.liferay.portal.kernel.model.LayoutSoap[] getLayouts(
+ long groupId, boolean privateLayout, String type)
+ throws RemoteException {
+
+ try {
+ java.util.List returnValue =
+ LayoutServiceUtil.getLayouts(groupId, privateLayout, type);
+
+ return com.liferay.portal.kernel.model.LayoutSoap.toSoapModels(
+ returnValue);
+ }
+ catch (Exception e) {
+ \_log.error(e, e);
+
+ throw new RemoteException(e.getMessage());
+ }
+ }
+
public static com.liferay.portal.kernel.model.LayoutSoap[] getLayouts(
long groupId, String type)
throws RemoteException {
diff --git a/portal-impl/src/com/liferay/portal/service/impl/LayoutServiceImpl.java b/portal-impl/src/com/liferay/portal/service/impl/LayoutServiceImpl.java
index 2e55c49207414e..45cf5711df2bfc 100644
--- a/portal-impl/src/com/liferay/portal/service/impl/LayoutServiceImpl.java
+++ b/portal-impl/src/com/liferay/portal/service/impl/LayoutServiceImpl.java
@@ -994,6 +994,17 @@ public List getLayouts(
return filterLayouts(layouts);
}
+ @Override
+ public List getLayouts(
+ long groupId, boolean privateLayout, String type)
+ throws PortalException {
+
+ List layouts = layoutLocalService.getLayouts(
+ groupId, privateLayout, type);
+
+ return filterLayouts(layouts);
+ }
+
@Override
public List getLayouts(long groupId, String type) {
return layoutPersistence.filterFindByG\_T(groupId, type);
diff --git a/portal-impl/src/com/liferay/portal/service/impl/UserLocalServiceImpl.java b/portal-impl/src/com/liferay/portal/service/impl/UserLocalServiceImpl.java
index 9852e8ef9cad7d..5374d4298c54d9 100644
--- a/portal-impl/src/com/liferay/portal/service/impl/UserLocalServiceImpl.java
+++ b/portal-impl/src/com/liferay/portal/service/impl/UserLocalServiceImpl.java
@@ -3759,10 +3759,10 @@ public void sendEmailAddressVerification(
}
}
- String fromName = PrefsPropsUtil.getString(
- user.getCompanyId(), PropsKeys.ADMIN\_EMAIL\_FROM\_NAME);
String fromAddress = PrefsPropsUtil.getString(
user.getCompanyId(), PropsKeys.ADMIN\_EMAIL\_FROM\_ADDRESS);
+ String fromName = PrefsPropsUtil.getString(
+ user.getCompanyId(), PropsKeys.ADMIN\_EMAIL\_FROM\_NAME);
PortletPreferences companyPortletPreferences =
PrefsPropsUtil.getPreferences(user.getCompanyId(), true);
@@ -3861,7 +3861,6 @@ public boolean sendPassword(
PasswordPolicy passwordPolicy = user.getPasswordPolicy();
String newPassword = StringPool.BLANK;
- String passwordResetURL = StringPool.BLANK;
if (company.isSendPasswordResetLink()) {
Date expirationDate = null;
@@ -3888,9 +3887,13 @@ public boolean sendPassword(
sb.append("&ticketKey=");
sb.append(ticket.getKey());
- passwordResetURL = sb.toString();
+ String passwordResetURL = sb.toString();
+
+ sendPasswordNotification(
+ user, companyId, null, passwordResetURL, fromName, fromAddress,
+ subject, body, serviceContext);
}
- else {
+ else if (company.isSendPassword()) {
if (!Objects.equals(
PasswordEncryptorUtil.getDefaultPasswordAlgorithmType(),
PasswordEncryptorUtil.TYPE\_NONE)) {
@@ -3942,11 +3945,11 @@ public boolean sendPassword(
else {
newPassword = user.getPassword();
}
- }
- sendPasswordNotification(
- user, companyId, newPassword, passwordResetURL, fromName,
- fromAddress, subject, body, serviceContext);
+ sendPasswordNotification(
+ user, companyId, newPassword, null, fromName, fromAddress,
+ subject, body, serviceContext);
+ }
return company.isSendPassword();
}
@@ -6338,10 +6341,15 @@ protected void notifyUser(
return;
}
- String fromName = PrefsPropsUtil.getString(
- user.getCompanyId(), PropsKeys.ADMIN\_EMAIL\_FROM\_NAME);
+ boolean autoPassword = GetterUtil.getBoolean(
+ serviceContext.getAttribute("autoPassword"));
+ Company company = null;
String fromAddress = PrefsPropsUtil.getString(
user.getCompanyId(), PropsKeys.ADMIN\_EMAIL\_FROM\_ADDRESS);
+ String fromName = PrefsPropsUtil.getString(
+ user.getCompanyId(), PropsKeys.ADMIN\_EMAIL\_FROM\_NAME);
+ String passwordResetURL = StringPool.BLANK;
+ String portalURL = null;
PortletPreferences companyPortletPreferences =
PrefsPropsUtil.getPreferences(user.getCompanyId(), true);
@@ -6351,18 +6359,46 @@ protected void notifyUser(
companyPortletPreferences, "adminEmailUserAddedSubject",
PropsKeys.ADMIN\_EMAIL\_USER\_ADDED\_SUBJECT);
- final Map localizedBodyMap;
+ try {
+ company = companyLocalService.getCompany(user.getCompanyId());
- if (Validator.isNotNull(password)) {
- localizedBodyMap = LocalizationUtil.getLocalizationMap(
- companyPortletPreferences, "adminEmailUserAddedBody",
- PropsKeys.ADMIN\_EMAIL\_USER\_ADDED\_BODY);
+ portalURL = company.getPortalURL(0);
}
- else {
+ catch (PortalException pe) {
+ ReflectionUtil.throwException(pe);
+ }
+
+ final Map localizedBodyMap;
+
+ if (!autoPassword) {
localizedBodyMap = LocalizationUtil.getLocalizationMap(
companyPortletPreferences, "adminEmailUserAddedNoPasswordBody",
PropsKeys.ADMIN\_EMAIL\_USER\_ADDED\_NO\_PASSWORD\_BODY);
}
+ else {
+ if (company.isSendPassword()) {
+ localizedBodyMap = LocalizationUtil.getLocalizationMap(
+ companyPortletPreferences, "adminEmailUserAddedBody",
+ PropsKeys.ADMIN\_EMAIL\_USER\_ADDED\_BODY);
+ }
+ else {
+ Ticket ticket = ticketLocalService.addDistinctTicket(
+ user.getCompanyId(), User.class.getName(), user.getUserId(),
+ TicketConstants.TYPE\_PASSWORD, null, null, serviceContext);
+
+ String plid = String.valueOf(serviceContext.getPlid());
+
+ passwordResetURL = StringBundler.concat(
+ serviceContext.getPortalURL(), serviceContext.getPathMain(),
+ "/portal/update\_password?p\_l\_id=", plid, "&ticketKey=",
+ ticket.getKey());
+
+ localizedBodyMap = LocalizationUtil.getLocalizationMap(
+ companyPortletPreferences,
+ "adminEmailUserAddedResetPasswordBody",
+ PropsKeys.ADMIN\_EMAIL\_USER\_ADDED\_RESET\_PASSWORD\_BODY);
+ }
+ }
String subject = \_getLocalizedValue(
localizedSubjectMap, user.getLocale(), LocaleUtil.getDefault());
@@ -6370,18 +6406,6 @@ protected void notifyUser(
String body = \_getLocalizedValue(
localizedBodyMap, user.getLocale(), LocaleUtil.getDefault());
- String portalURL = null;
-
- try {
- Company company = companyLocalService.getCompany(
- user.getCompanyId());
-
- portalURL = company.getPortalURL(0);
- }
- catch (PortalException pe) {
- ReflectionUtil.throwException(pe);
- }
-
MailTemplateContextBuilder mailTemplateContextBuilder =
MailTemplateFactoryUtil.createMailTemplateContextBuilder();
@@ -6393,6 +6417,8 @@ protected void notifyUser(
"[$TO\_ADDRESS$]", user.getEmailAddress());
mailTemplateContextBuilder.put(
"[$TO\_NAME$]", HtmlUtil.escape(user.getFullName()));
+ mailTemplateContextBuilder.put(
+ "[$PASSWORD\_SETUP\_URL$]", passwordResetURL);
mailTemplateContextBuilder.put(
"[$USER\_ID$]", String.valueOf(user.getUserId()));
mailTemplateContextBuilder.put(
@@ -6512,6 +6538,18 @@ protected void sendPasswordNotification(
PortletPreferences companyPortletPreferences =
PrefsPropsUtil.getPreferences(companyId, true);
+ Company company = null;
+ String portalURL = null;
+
+ try {
+ company = companyLocalService.getCompany(user.getCompanyId());
+
+ portalURL = company.getPortalURL(0);
+ }
+ catch (PortalException pe) {
+ ReflectionUtil.throwException(pe);
+ }
+
final String bodyProperty;
final String prefix;
final String subjectProperty;
@@ -6521,11 +6559,16 @@ protected void sendPasswordNotification(
prefix = "adminEmailPasswordReset";
subjectProperty = PropsKeys.ADMIN\_EMAIL\_PASSWORD\_RESET\_SUBJECT;
}
- else {
+ else if (company.isSendPassword()) {
bodyProperty = PropsKeys.ADMIN\_EMAIL\_PASSWORD\_SENT\_BODY;
prefix = "adminEmailPasswordSent";
subjectProperty = PropsKeys.ADMIN\_EMAIL\_PASSWORD\_SENT\_SUBJECT;
}
+ else {
+ bodyProperty = PropsKeys.ADMIN\_EMAIL\_PASSWORD\_CHANGED\_BODY;
+ prefix = "adminEmailPasswordChanged";
+ subjectProperty = PropsKeys.ADMIN\_EMAIL\_PASSWORD\_CHANGED\_SUBJECT;
+ }
String localizedBody = body;
@@ -6550,18 +6593,6 @@ protected void sendPasswordNotification(
localizedSubjectMap, user.getLocale(), LocaleUtil.getDefault());
}
- String portalURL = null;
-
- try {
- Company company = companyLocalService.getCompany(
- user.getCompanyId());
-
- portalURL = company.getPortalURL(0);
- }
- catch (PortalException pe) {
- ReflectionUtil.throwException(pe);
- }
-
MailTemplateContextBuilder mailTemplateContextBuilder =
MailTemplateFactoryUtil.createMailTemplateContextBuilder();
diff --git a/portal-impl/src/com/liferay/portal/service/impl/UserServiceImpl.java b/portal-impl/src/com/liferay/portal/service/impl/UserServiceImpl.java
index bf3212c58de295..7c03edd1a78c48 100644
--- a/portal-impl/src/com/liferay/portal/service/impl/UserServiceImpl.java
+++ b/portal-impl/src/com/liferay/portal/service/impl/UserServiceImpl.java
@@ -20,6 +20,8 @@
import com.liferay.portal.kernel.exception.RequiredUserException;
import com.liferay.portal.kernel.exception.UserEmailAddressException;
import com.liferay.portal.kernel.exception.UserFieldException;
+import com.liferay.portal.kernel.jsonwebservice.JSONWebService;
+import com.liferay.portal.kernel.jsonwebservice.JSONWebServiceMode;
import com.liferay.portal.kernel.log.Log;
import com.liferay.portal.kernel.log.LogFactoryUtil;
import com.liferay.portal.kernel.model.Address;
@@ -1171,6 +1173,7 @@ public boolean hasRoleUser(
\* password; `false` if the notification email only
\* contains a reset link
\*/
+ @JSONWebService(mode = JSONWebServiceMode.IGNORE)
@Override
public boolean sendPasswordByEmailAddress(
long companyId, String emailAddress)
@@ -1199,6 +1202,7 @@ public boolean sendPasswordByEmailAddress(
\* password; `false` if the notification email only
\* contains a reset link
\*/
+ @JSONWebService(mode = JSONWebServiceMode.IGNORE)
@Override
public boolean sendPasswordByScreenName(long companyId, String screenName)
throws PortalException {
@@ -1224,6 +1228,7 @@ public boolean sendPasswordByScreenName(long companyId, String screenName)
\* password; `false` if the notification email only
\* contains a reset link
\*/
+ @JSONWebService(mode = JSONWebServiceMode.IGNORE)
@Override
public boolean sendPasswordByUserId(long userId) throws PortalException {
return userLocalService.sendPasswordByUserId(userId);
diff --git a/portal-impl/src/com/liferay/portal/service/permission/GroupPermissionImpl.java b/portal-impl/src/com/liferay/portal/service/permission/GroupPermissionImpl.java
index bfc2f580475292..50661c1c4e1837 100644
--- a/portal-impl/src/com/liferay/portal/service/permission/GroupPermissionImpl.java
+++ b/portal-impl/src/com/liferay/portal/service/permission/GroupPermissionImpl.java
@@ -17,6 +17,7 @@
import com.liferay.petra.lang.HashUtil;
import com.liferay.portal.kernel.exception.PortalException;
import com.liferay.portal.kernel.model.Group;
+import com.liferay.portal.kernel.model.GroupConstants;
import com.liferay.portal.kernel.model.User;
import com.liferay.portal.kernel.security.auth.PrincipalException;
import com.liferay.portal.kernel.security.permission.ActionKeys;
@@ -195,9 +196,10 @@ else if ((actionId.equals(ActionKeys.EXPORT\_IMPORT\_LAYOUTS) ||
return true;
}
else if (actionId.equals(ActionKeys.VIEW) &&
- (permissionChecker.hasPermission(
- originalGroup, Group.class.getName(), groupId,
- ActionKeys.ASSIGN\_USER\_ROLES) ||
+ ((originalGroup.getType() == GroupConstants.TYPE\_SITE\_OPEN) ||
+ permissionChecker.hasPermission(
+ originalGroup, Group.class.getName(), groupId,
+ ActionKeys.ASSIGN\_USER\_ROLES) ||
permissionChecker.hasPermission(
originalGroup, Group.class.getName(), groupId,
ActionKeys.MANAGE\_LAYOUTS))) {
diff --git a/portal-impl/src/com/liferay/portal/template/TemplateContextHelper.java b/portal-impl/src/com/liferay/portal/template/TemplateContextHelper.java
index bcd04d9eb3a0ba..07160133e1bc81 100644
--- a/portal-impl/src/com/liferay/portal/template/TemplateContextHelper.java
+++ b/portal-impl/src/com/liferay/portal/template/TemplateContextHelper.java
@@ -94,7 +94,6 @@
import java.io.IOException;
import java.io.InputStream;
-import java.net.InetAddress;
import java.net.URL;
import java.util.Collections;
@@ -1395,7 +1394,7 @@ protected boolean isLocationAccessDenied(String location)
URL url = new URL(location);
if (InetAddressUtil.isLocalInetAddress(
- InetAddress.getByName(url.getHost()))) {
+ InetAddressUtil.getInetAddressByName(url.getHost()))) {
return true;
}
diff --git a/portal-impl/src/com/liferay/portal/tools/HypersonicLoader.java b/portal-impl/src/com/liferay/portal/tools/HypersonicLoader.java
index 0d4b93025a9fb5..31f7c8ead2294f 100644
--- a/portal-impl/src/com/liferay/portal/tools/HypersonicLoader.java
+++ b/portal-impl/src/com/liferay/portal/tools/HypersonicLoader.java
@@ -71,17 +71,32 @@ public static void main(String[] args) throws Exception {
String databaseName = arguments.get("db.database.name");
String sqlDir = arguments.get("db.sql.dir");
String fileNames = arguments.get("db.file.names");
+ String username = arguments.get("db.database.username");
+ String password = arguments.get("db.database.password");
try {
- new HypersonicLoader(databaseName, sqlDir, fileNames);
+ new HypersonicLoader(
+ databaseName, sqlDir, fileNames, username, password);
}
catch (Exception e) {
ArgumentsUtil.processMainException(arguments, e);
}
}
+ /\*\*
+ \* @deprecated As of Mueller (7.2.x), replaced by {@link
+ \* #HypersonicLoader(String, String, String, String, String)}
+ \*/
+ @Deprecated
public HypersonicLoader(
- String databaseName, String sqlDir, String fileNames)
+ String databaseName, String sqlDir, String fileNames) {
+
+ throw new UnsupportedOperationException();
+ }
+
+ public HypersonicLoader(
+ String databaseName, String sqlDir, String fileNames,
+ String username, String password)
throws Exception {
ToolDependencies.wireBasic();
@@ -95,7 +110,7 @@ public HypersonicLoader(
StringBundler.concat(
"jdbc:hsqldb:", sqlDir, "/", databaseName,
";hsqldb.write\_delay=false;shutdown=true"),
- "sa", "")) {
+ username, password)) {
if (Validator.isNull(fileNames)) {
loadHypersonic(con, sqlDir + "/portal/portal-hypersonic.sql");
diff --git a/portal-impl/src/com/liferay/portal/util/HttpImpl.java b/portal-impl/src/com/liferay/portal/util/HttpImpl.java
index 8ac126200c2d51..3764c7966858a1 100644
--- a/portal-impl/src/com/liferay/portal/util/HttpImpl.java
+++ b/portal-impl/src/com/liferay/portal/util/HttpImpl.java
@@ -31,6 +31,7 @@
import com.liferay.portal.kernel.util.FileUtil;
import com.liferay.portal.kernel.util.GetterUtil;
import com.liferay.portal.kernel.util.Http;
+import com.liferay.portal.kernel.util.InetAddressUtil;
import com.liferay.portal.kernel.util.PortalUtil;
import com.liferay.portal.kernel.util.StringBundler;
import com.liferay.portal.kernel.util.StringUtil;
@@ -557,7 +558,8 @@ public String getIpAddress(String url) {
try {
URL urlObj = new URL(url);
- InetAddress address = InetAddress.getByName(urlObj.getHost());
+ InetAddress address = InetAddressUtil.getInetAddressByName(
+ urlObj.getHost());
return address.getHostAddress();
}
diff --git a/portal-impl/src/com/liferay/portal/util/LayoutSitemapURLProvider.java b/portal-impl/src/com/liferay/portal/util/LayoutSitemapURLProvider.java
index f82019977dbeba..13a57c6a959492 100644
--- a/portal-impl/src/com/liferay/portal/util/LayoutSitemapURLProvider.java
+++ b/portal-impl/src/com/liferay/portal/util/LayoutSitemapURLProvider.java
@@ -22,6 +22,7 @@
import com.liferay.portal.kernel.model.LayoutSet;
import com.liferay.portal.kernel.model.LayoutTypeController;
import com.liferay.portal.kernel.service.LayoutLocalServiceUtil;
+import com.liferay.portal.kernel.service.LayoutServiceUtil;
import com.liferay.portal.kernel.spring.osgi.OSGiBeanProperties;
import com.liferay.portal.kernel.theme.ThemeDisplay;
import com.liferay.portal.kernel.util.GetterUtil;
@@ -77,7 +78,7 @@ public void visitLayoutSet(
continue;
}
- List layouts = LayoutLocalServiceUtil.getLayouts(
+ List layouts = LayoutServiceUtil.getLayouts(
layoutSet.getGroupId(), layoutSet.isPrivateLayout(),
entry.getKey());
diff --git a/portal-impl/src/com/liferay/portal/util/PortalImpl.java b/portal-impl/src/com/liferay/portal/util/PortalImpl.java
index dbb647f930eb33..d405d2d998e302 100644
--- a/portal-impl/src/com/liferay/portal/util/PortalImpl.java
+++ b/portal-impl/src/com/liferay/portal/util/PortalImpl.java
@@ -173,6 +173,7 @@
import com.liferay.portal.kernel.util.HtmlUtil;
import com.liferay.portal.kernel.util.Http;
import com.liferay.portal.kernel.util.HttpUtil;
+import com.liferay.portal.kernel.util.InetAddressUtil;
import com.liferay.portal.kernel.util.InheritableMap;
import com.liferay.portal.kernel.util.JavaConstants;
import com.liferay.portal.kernel.util.ListMergeable;
@@ -1003,7 +1004,8 @@ else if (allowedDomain.equals(domain)) {
}
try {
- InetAddress inetAddress = InetAddress.getByName(domain);
+ InetAddress inetAddress = InetAddressUtil.getInetAddressByName(
+ domain);
String hostAddress = inetAddress.getHostAddress();
@@ -2455,13 +2457,39 @@ public String getFirstPageLayoutTypes(HttpServletRequest request) {
@Override
public String getForwardedHost(HttpServletRequest request) {
+ String serverName = request.getServerName();
+
if (!PropsValues.WEB\_SERVER\_FORWARDED\_HOST\_ENABLED) {
- return request.getServerName();
+ return serverName;
+ }
+
+ String forwardedHost = request.getHeader(
+ PropsValues.WEB\_SERVER\_FORWARDED\_HOST\_HEADER);
+
+ if (Validator.isBlank(forwardedHost) ||
+ forwardedHost.equals(serverName)) {
+
+ return serverName;
+ }
+
+ if (\_validPortalDomainCheckDisabled) {
+ if (!Validator.isHostName(forwardedHost)) {
+ if (\_log.isWarnEnabled()) {
+ \_log.warn("Invalid forwarded host: " + forwardedHost);
+ }
+
+ return serverName;
+ }
+ }
+ else if (!isValidPortalDomain(forwardedHost)) {
+ if (\_log.isWarnEnabled()) {
+ \_log.warn("Invalid forwarded host: " + forwardedHost);
+ }
+
+ return serverName;
}
- return GetterUtil.get(
- request.getHeader(PropsValues.WEB\_SERVER\_FORWARDED\_HOST\_HEADER),
- request.getServerName());
+ return forwardedHost;
}
@Override
diff --git a/portal-impl/src/com/liferay/portal/util/PropsValues.java b/portal-impl/src/com/liferay/portal/util/PropsValues.java
index 1efbffd006febc..63da82e5e792ea 100644
--- a/portal-impl/src/com/liferay/portal/util/PropsValues.java
+++ b/portal-impl/src/com/liferay/portal/util/PropsValues.java
@@ -51,6 +51,12 @@ public class PropsValues {
public static String ADMIN\_EMAIL\_FROM\_NAME = PropsUtil.get(
PropsKeys.ADMIN\_EMAIL\_FROM\_NAME);
+ public static final String ADMIN\_EMAIL\_PASSWORD\_CHANGED\_BODY =
+ PropsUtil.get(PropsKeys.ADMIN\_EMAIL\_PASSWORD\_CHANGED\_BODY);
+
+ public static final String ADMIN\_EMAIL\_PASSWORD\_CHANGED\_SUBJECT =
+ PropsUtil.get(PropsKeys.ADMIN\_EMAIL\_PASSWORD\_CHANGED\_SUBJECT);
+
public static final String ADMIN\_EMAIL\_PASSWORD\_RESET\_BODY = PropsUtil.get(
PropsKeys.ADMIN\_EMAIL\_PASSWORD\_RESET\_BODY);
@@ -69,6 +75,9 @@ public class PropsValues {
public static final String ADMIN\_EMAIL\_USER\_ADDED\_NO\_PASSWORD\_BODY =
PropsUtil.get(PropsKeys.ADMIN\_EMAIL\_USER\_ADDED\_NO\_PASSWORD\_BODY);
+ public static final String ADMIN\_EMAIL\_USER\_ADDED\_RESET\_PASSWORD\_BODY =
+ PropsUtil.get(PropsKeys.ADMIN\_EMAIL\_USER\_ADDED\_RESET\_PASSWORD\_BODY);
+
public static final String ADMIN\_EMAIL\_USER\_ADDED\_SUBJECT = PropsUtil.get(
PropsKeys.ADMIN\_EMAIL\_USER\_ADDED\_SUBJECT);
@@ -1107,6 +1116,13 @@ public class PropsValues {
public static String DL\_WEBDAV\_SUBSTITUTION\_CHAR = PropsUtil.get(
PropsKeys.DL\_WEBDAV\_SUBSTITUTION\_CHAR);
+ public static final int DNS\_SECURITY\_ADDRESS\_TIMEOUT\_SECONDS =
+ GetterUtil.getInteger(
+ PropsUtil.get(PropsKeys.DNS\_SECURITY\_ADDRESS\_TIMEOUT\_SECONDS));
+
+ public static final int DNS\_SECURITY\_THREAD\_LIMIT = GetterUtil.getInteger(
+ PropsUtil.get(PropsKeys.DNS\_SECURITY\_THREAD\_LIMIT));
+
public static final String[] DYNAMIC\_RESOURCE\_SERVLET\_ALLOWED\_PATHS =
PropsUtil.getArray(PropsKeys.DYNAMIC\_RESOURCE\_SERVLET\_ALLOWED\_PATHS);
@@ -1852,6 +1868,11 @@ public class PropsValues {
PropsUtil.get(
PropsKeys.MODULE\_FRAMEWORK\_DYNAMIC\_INSTALL\_START\_LEVEL));
+ public static final boolean MODULE\_FRAMEWORK\_EXPORT\_PASSWORD\_ATTRIBUTES =
+ GetterUtil.getBoolean(
+ PropsUtil.get(
+ PropsKeys.MODULE\_FRAMEWORK\_EXPORT\_PASSWORD\_ATTRIBUTES));
+
/\*\*
\* @deprecated As of Judson (7.1.x), with no direct replacement
\*/
diff --git a/portal-impl/src/com/liferay/portal/webserver/WebServerServlet.java b/portal-impl/src/com/liferay/portal/webserver/WebServerServlet.java
index 25bf5ee69d3fc7..a7a5c369384908 100644
--- a/portal-impl/src/com/liferay/portal/webserver/WebServerServlet.java
+++ b/portal-impl/src/com/liferay/portal/webserver/WebServerServlet.java
@@ -146,7 +146,7 @@ public class WebServerServlet extends HttpServlet {
/\*\*
\* @see com.liferay.portal.servlet.filters.virtualhost.VirtualHostFilter
\*/
- public static boolean hasFiles(HttpServletRequest request) {
+ public static boolean hasFiles(HttpServletRequest httpServletRequest) {
String name = PrincipalThreadLocal.getName();
String password = PrincipalThreadLocal.getPassword();
@@ -155,15 +155,15 @@ public static boolean hasFiles(HttpServletRequest request) {
// Do not use permission checking since this may be called from
// other contexts that are also managing the principal
- User user = \_getUser(request);
+ User user = \_getUser(httpServletRequest);
if (!user.isDefaultUser()) {
PrincipalThreadLocal.setName(user.getUserId());
PrincipalThreadLocal.setPassword(
- PortalUtil.getUserPassword(request));
+ PortalUtil.getUserPassword(httpServletRequest));
}
- String path = HttpUtil.fixPath(request.getPathInfo());
+ String path = HttpUtil.fixPath(httpServletRequest.getPathInfo());
String[] pathArray = StringUtil.split(path, CharPool.SLASH);
@@ -174,7 +174,8 @@ else if (Validator.isNumber(pathArray[0])) {
\_checkFileEntry(pathArray);
}
else if (PATH\_PORTLET\_FILE\_ENTRY.equals(pathArray[0])) {
- FileEntry fileEntry = getPortletFileEntry(request, pathArray);
+ FileEntry fileEntry = getPortletFileEntry(
+ httpServletRequest, pathArray);
if (fileEntry != null) {
return true;
@@ -250,16 +251,18 @@ public void init(ServletConfig servletConfig) throws ServletException {
@Override
public void service(
- HttpServletRequest request, HttpServletResponse response)
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse)
throws IOException, ServletException {
User user = null;
try {
- user = \_getUser(request);
+ user = \_getUser(httpServletRequest);
if (\_processCompanyInactiveRequest(
- request, response, user.getCompanyId())) {
+ httpServletRequest, httpServletResponse,
+ user.getCompanyId())) {
return;
}
@@ -267,31 +270,34 @@ public void service(
PrincipalThreadLocal.setName(user.getUserId());
PrincipalThreadLocal.setPassword(
- PortalUtil.getUserPassword(request));
+ PortalUtil.getUserPassword(httpServletRequest));
PermissionChecker permissionChecker =
PermissionCheckerFactoryUtil.create(user);
PermissionThreadLocal.setPermissionChecker(permissionChecker);
+ \_checkResourcePermission(httpServletRequest, httpServletResponse);
+
if (\_lastModified) {
- long lastModified = getLastModified(request);
+ long lastModified = getLastModified(httpServletRequest);
if (lastModified > 0) {
- long ifModifiedSince = request.getDateHeader(
+ long ifModifiedSince = httpServletRequest.getDateHeader(
HttpHeaders.IF\_MODIFIED\_SINCE);
if ((ifModifiedSince > 0) &&
(ifModifiedSince == lastModified)) {
- response.setStatus(HttpServletResponse.SC\_NOT\_MODIFIED);
+ httpServletResponse.setStatus(
+ HttpServletResponse.SC\_NOT\_MODIFIED);
return;
}
}
if (lastModified > 0) {
- response.setDateHeader(
+ httpServletResponse.setDateHeader(
HttpHeaders.LAST\_MODIFIED, lastModified);
}
}
@@ -303,29 +309,29 @@ public void service(
TransactionInvokerUtil.invoke(
builder.build(),
- \_createFileServingCallable(request, response, user));
- }
- catch (NoSuchFileEntryException nsfee) {
- PortalUtil.sendError(
- HttpServletResponse.SC\_NOT\_FOUND, nsfee, request, response);
+ \_createFileServingCallable(
+ httpServletRequest, httpServletResponse, user));
}
- catch (NoSuchFolderException nsfe) {
+ catch (NoSuchFileEntryException | NoSuchFolderException e) {
PortalUtil.sendError(
- HttpServletResponse.SC\_NOT\_FOUND, nsfe, request, response);
+ HttpServletResponse.SC\_NOT\_FOUND, e, httpServletRequest,
+ httpServletResponse);
}
catch (PrincipalException pe) {
- processPrincipalException(pe, user, request, response);
+ processPrincipalException(
+ pe, user, httpServletRequest, httpServletResponse);
}
catch (Exception e) {
- PortalUtil.sendError(e, request, response);
+ PortalUtil.sendError(e, httpServletRequest, httpServletResponse);
}
catch (Throwable t) {
- PortalUtil.sendError(new Exception(t), request, response);
+ PortalUtil.sendError(
+ new Exception(t), httpServletRequest, httpServletResponse);
}
}
protected static FileEntry getPortletFileEntry(
- HttpServletRequest request, String[] pathArray)
+ HttpServletRequest httpServletRequest, String[] pathArray)
throws Exception {
long groupId = GetterUtil.getLong(pathArray[1]);
@@ -334,7 +340,7 @@ protected static FileEntry getPortletFileEntry(
FileEntry fileEntry = PortletFileRepositoryUtil.getPortletFileEntry(
uuid, groupId);
- User user = \_getUser(request);
+ User user = \_getUser(httpServletRequest);
if (!fileEntry.containsPermission(
PermissionCheckerFactoryUtil.create(user), ActionKeys.VIEW)) {
@@ -344,7 +350,7 @@ protected static FileEntry getPortletFileEntry(
}
int status = ParamUtil.getInteger(
- request, "status", WorkflowConstants.STATUS\_APPROVED);
+ httpServletRequest, "status", WorkflowConstants.STATUS\_APPROVED);
if ((status != WorkflowConstants.STATUS\_IN\_TRASH) &&
fileEntry.isInTrash()) {
@@ -381,19 +387,18 @@ protected Image convertFileEntry(boolean smallImage, FileEntry fileEntry)
return image;
}
- catch (PortalException pe) {
- throw pe;
- }
- catch (SystemException se) {
- throw se;
+ catch (PortalException | SystemException e) {
+ throw e;
}
catch (Exception e) {
throw new SystemException(e);
}
}
- protected Image getDefaultImage(HttpServletRequest request, long imageId) {
- String path = GetterUtil.getString(request.getPathInfo());
+ protected Image getDefaultImage(
+ HttpServletRequest httpServletRequest, long imageId) {
+
+ String path = GetterUtil.getString(httpServletRequest.getPathInfo());
if (path.startsWith("/company\_logo") ||
path.startsWith("/layout\_set\_logo") || path.startsWith("/logo")) {
@@ -454,33 +459,27 @@ else if (pathArray.length == 3) {
}
}
- protected Image getImage(HttpServletRequest request, boolean getDefault)
+ protected Image getImage(
+ HttpServletRequest httpServletRequest, boolean getDefault)
throws Exception {
Image image = null;
- long imageId = getImageId(request);
+ long imageId = getImageId(httpServletRequest);
if (imageId > 0) {
image = ImageServiceUtil.getImage(imageId);
- String path = GetterUtil.getString(request.getPathInfo());
+ String path = GetterUtil.getString(
+ httpServletRequest.getPathInfo());
if (path.startsWith("/layout\_icon") || path.startsWith("/logo")) {
Layout layout = LayoutLocalServiceUtil.fetchLayoutByIconImageId(
true, imageId);
if (layout != null) {
- User user = PortalUtil.getUser(request);
-
- if (user == null) {
- long companyId = PortalUtil.getCompanyId(request);
-
- user = UserLocalServiceUtil.getDefaultUser(companyId);
- }
-
- PermissionChecker permissionChecker =
- PermissionCheckerFactoryUtil.create(user);
+ PermissionChecker permissionChecker = \_getPermissionChecker(
+ httpServletRequest);
if (!LayoutPermissionUtil.contains(
permissionChecker, layout, ActionKeys.VIEW)) {
@@ -497,16 +496,8 @@ else if (path.startsWith("/layout\_set\_logo")) {
true, imageId);
if (layoutSet != null) {
- User user = PortalUtil.getUser(request);
-
- if (user == null) {
- long companyId = PortalUtil.getCompanyId(request);
-
- user = UserLocalServiceUtil.getDefaultUser(companyId);
- }
-
- PermissionChecker permissionChecker =
- PermissionCheckerFactoryUtil.create(user);
+ PermissionChecker permissionChecker = \_getPermissionChecker(
+ httpServletRequest);
Group group = layoutSet.getGroup();
@@ -530,10 +521,10 @@ else if (path.startsWith("/user\_female\_portrait") ||
}
}
else {
- String uuid = ParamUtil.getString(request, "uuid");
- long groupId = ParamUtil.getLong(request, "groupId");
+ String uuid = ParamUtil.getString(httpServletRequest, "uuid");
+ long groupId = ParamUtil.getLong(httpServletRequest, "groupId");
boolean igSmallImage = ParamUtil.getBoolean(
- request, "igSmallImage");
+ httpServletRequest, "igSmallImage");
if (Validator.isNotNull(uuid) && (groupId > 0)) {
try {
@@ -554,14 +545,15 @@ else if (path.startsWith("/user\_female\_portrait") ||
\_log.warn("Get a default image for " + imageId);
}
- image = getDefaultImage(request, imageId);
+ image = getDefaultImage(httpServletRequest, imageId);
}
}
return image;
}
- protected byte[] getImageBytes(HttpServletRequest request, Image image)
+ protected byte[] getImageBytes(
+ HttpServletRequest httpServletRequest, Image image)
throws PortalException {
byte[] textObj = image.getTextObj();
@@ -587,9 +579,9 @@ protected byte[] getImageBytes(HttpServletRequest request, Image image)
}
int height = ParamUtil.getInteger(
- request, "height", image.getHeight());
+ httpServletRequest, "height", image.getHeight());
int width = ParamUtil.getInteger(
- request, "width", image.getWidth());
+ httpServletRequest, "width", image.getWidth());
if ((height >= image.getHeight()) && (width >= image.getWidth())) {
return textObj;
@@ -613,25 +605,26 @@ protected byte[] getImageBytes(HttpServletRequest request, Image image)
return textObj;
}
- protected long getImageId(HttpServletRequest request) {
+ protected long getImageId(HttpServletRequest httpServletRequest) {
// The image id may be passed in as image\_id, img\_id, or i\_id
- long imageId = ParamUtil.getLong(request, "image\_id");
+ long imageId = ParamUtil.getLong(httpServletRequest, "image\_id");
if (imageId <= 0) {
- imageId = ParamUtil.getLong(request, "img\_id");
+ imageId = ParamUtil.getLong(httpServletRequest, "img\_id");
}
if (imageId <= 0) {
- imageId = ParamUtil.getLong(request, "i\_id");
+ imageId = ParamUtil.getLong(httpServletRequest, "i\_id");
}
User user = null;
if (imageId <= 0) {
- long companyId = ParamUtil.getLong(request, "companyId");
- String screenName = ParamUtil.getString(request, "screenName");
+ long companyId = ParamUtil.getLong(httpServletRequest, "companyId");
+ String screenName = ParamUtil.getString(
+ httpServletRequest, "screenName");
if ((companyId > 0) && Validator.isNotNull(screenName)) {
user = UserLocalServiceUtil.fetchUserByScreenName(
@@ -644,7 +637,8 @@ protected long getImageId(HttpServletRequest request) {
}
if (\_userFileUploadsSettings.isImageCheckToken() && (imageId > 0)) {
- String imageIdToken = ParamUtil.getString(request, "img\_id\_token");
+ String imageIdToken = ParamUtil.getString(
+ httpServletRequest, "img\_id\_token");
if (user == null) {
user = UserLocalServiceUtil.fetchUserByPortraitId(imageId);
@@ -661,17 +655,18 @@ protected long getImageId(HttpServletRequest request) {
}
@Override
- protected long getLastModified(HttpServletRequest request) {
+ protected long getLastModified(HttpServletRequest httpServletRequest) {
try {
Date modifiedDate = null;
- Image image = getImage(request, true);
+ Image image = getImage(httpServletRequest, true);
if (image != null) {
modifiedDate = image.getModifiedDate();
}
else {
- String path = HttpUtil.fixPath(request.getPathInfo());
+ String path = HttpUtil.fixPath(
+ httpServletRequest.getPathInfo());
String[] pathArray = StringUtil.split(path, CharPool.SLASH);
@@ -695,7 +690,8 @@ protected long getLastModified(HttpServletRequest request) {
return -1;
}
- String version = ParamUtil.getString(request, "version");
+ String version = ParamUtil.getString(
+ httpServletRequest, "version");
if (Validator.isNotNull(version)) {
FileVersion fileVersion = fileEntry.getFileVersion(version);
@@ -754,10 +750,11 @@ protected Image getUserPortraitImageResized(Image image, long imageId)
}
protected boolean isLegacyImageGalleryImageId(
- HttpServletRequest request, HttpServletResponse response) {
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse) {
try {
- long imageId = getImageId(request);
+ long imageId = getImageId(httpServletRequest);
if (imageId == 0) {
return false;
@@ -780,8 +777,9 @@ protected boolean isLegacyImageGalleryImageId(
return false;
}
- ThemeDisplay themeDisplay = (ThemeDisplay)request.getAttribute(
- WebKeys.THEME\_DISPLAY);
+ ThemeDisplay themeDisplay =
+ (ThemeDisplay)httpServletRequest.getAttribute(
+ WebKeys.THEME\_DISPLAY);
String queryString = StringPool.BLANK;
@@ -810,9 +808,10 @@ else if (imageId == thumbnailCapability.getCustom2ImageId(
String url = DLUtil.getPreviewURL(
fileEntry, fileVersion, themeDisplay, queryString);
- response.setHeader(HttpHeaders.LOCATION, url);
+ httpServletResponse.setHeader(HttpHeaders.LOCATION, url);
- response.setStatus(HttpServletResponse.SC\_MOVED\_PERMANENTLY);
+ httpServletResponse.setStatus(
+ HttpServletResponse.SC\_MOVED\_PERMANENTLY);
return true;
}
@@ -827,30 +826,31 @@ protected boolean isSupportsRangeHeader(String contentType) {
}
protected void processPrincipalException(
- Throwable t, User user, HttpServletRequest request,
- HttpServletResponse response)
+ Throwable t, User user, HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse)
throws IOException, ServletException {
if (!user.isDefaultUser()) {
PortalUtil.sendError(
- HttpServletResponse.SC\_UNAUTHORIZED, (Exception)t, request,
- response);
+ HttpServletResponse.SC\_UNAUTHORIZED, (Exception)t,
+ httpServletRequest, httpServletResponse);
return;
}
String redirect = PortalUtil.getPathMain() + "/portal/login";
- String currentURL = PortalUtil.getCurrentURL(request);
+ String currentURL = PortalUtil.getCurrentURL(httpServletRequest);
redirect = HttpUtil.addParameter(redirect, "redirect", currentURL);
- response.sendRedirect(redirect);
+ httpServletResponse.sendRedirect(redirect);
}
protected void sendDocumentLibrary(
- HttpServletRequest request, HttpServletResponse response, User user,
- String path, String[] pathArray)
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse, User user, String path,
+ String[] pathArray)
throws Exception {
Group group = \_getGroup(user.getCompanyId(), pathArray[0]);
@@ -877,46 +877,33 @@ protected void sendDocumentLibrary(
String title = name;
- sendFile(response, user, groupId, folderId, title);
+ sendFile(httpServletResponse, user, groupId, folderId, title);
return;
}
}
try {
- sendFile(response, user, groupId, folderId, "index.html");
+ sendFile(
+ httpServletResponse, user, groupId, folderId, "index.html");
return;
}
- catch (Exception e) {
- if (e instanceof NoSuchFileEntryException ||
- e instanceof PrincipalException) {
-
- try {
- sendFile(response, user, groupId, folderId, "index.htm");
-
- return;
- }
- catch (NoSuchFileEntryException nsfee) {
-
- // LPS-52675
+ catch (NoSuchFileEntryException | PrincipalException e1) {
+ try {
+ sendFile(
+ httpServletResponse, user, groupId, folderId, "index.htm");
- if (\_log.isDebugEnabled()) {
- \_log.debug(nsfee, nsfee);
- }
- }
- catch (PrincipalException pe) {
+ return;
+ }
+ catch (NoSuchFileEntryException | PrincipalException e2) {
- // LPS-52675
+ // LPS-52675
- if (\_log.isDebugEnabled()) {
- \_log.debug(pe, pe);
- }
+ if (\_log.isDebugEnabled()) {
+ \_log.debug(e2, e2);
}
}
- else {
- throw e;
- }
}
List webServerEntries = new ArrayList<>();
@@ -946,11 +933,12 @@ protected void sendDocumentLibrary(
webServerEntries.add(webServerEntry);
}
- sendHTML(response, path, webServerEntries);
+ sendHTML(httpServletResponse, path, webServerEntries);
}
protected void sendFile(
- HttpServletRequest request, HttpServletResponse response, User user,
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse, User user,
String[] pathArray)
throws Exception {
@@ -958,61 +946,34 @@ protected void sendFile(
FileEntry fileEntry = getFileEntry(pathArray);
- if (fileEntry == null) {
- throw new NoSuchFileEntryException();
- }
-
if (\_processCompanyInactiveRequest(
- request, response, fileEntry.getCompanyId())) {
+ httpServletRequest, httpServletResponse,
+ fileEntry.getCompanyId())) {
return;
}
- String version = ParamUtil.getString(request, "version");
+ String version = ParamUtil.getString(httpServletRequest, "version");
- if (Validator.isNull(version)) {
- if (Validator.isNotNull(fileEntry.getVersion())) {
- version = fileEntry.getVersion();
- }
+ if (Validator.isNull(version) &&
+ Validator.isNotNull(fileEntry.getVersion())) {
+
+ version = fileEntry.getVersion();
}
String tempFileId = DLUtil.getTempFileId(
fileEntry.getFileEntryId(), version);
- if (fileEntry.isInTrash()) {
- int status = ParamUtil.getInteger(
- request, "status", WorkflowConstants.STATUS\_APPROVED);
-
- if (status != WorkflowConstants.STATUS\_IN\_TRASH) {
- throw new NoSuchFileEntryException();
- }
-
- PermissionChecker permissionChecker =
- PermissionThreadLocal.getPermissionChecker();
-
- String portletId = PortletProviderUtil.getPortletId(
- TrashEntry.class.getName(), PortletProvider.Action.VIEW);
-
- if (!PortletPermissionUtil.hasControlPanelAccessPermission(
- permissionChecker, fileEntry.getGroupId(), portletId)) {
-
- throw new PrincipalException.MustHavePermission(
- permissionChecker, FileEntry.class.getName(),
- fileEntry.getFileEntryId(),
- ActionKeys.ACCESS\_IN\_CONTROL\_PANEL);
- }
- }
-
FileVersion fileVersion = fileEntry.getFileVersion(version);
- if ((ParamUtil.getInteger(request, "height") > 0) ||
- (ParamUtil.getInteger(request, "width") > 0)) {
+ if ((ParamUtil.getInteger(httpServletRequest, "height") > 0) ||
+ (ParamUtil.getInteger(httpServletRequest, "width") > 0)) {
InputStream inputStream = fileVersion.getContentStream(true);
Image image = ImageToolUtil.getImage(inputStream);
- writeImage(image, request, response);
+ writeImage(image, httpServletRequest, httpServletResponse);
return;
}
@@ -1024,16 +985,21 @@ protected void sendFile(
boolean converted = false;
String targetExtension = ParamUtil.getString(
- request, "targetExtension");
- int imageThumbnail = ParamUtil.getInteger(request, "imageThumbnail");
+ httpServletRequest, "targetExtension");
+ int imageThumbnail = ParamUtil.getInteger(
+ httpServletRequest, "imageThumbnail");
int documentThumbnail = ParamUtil.getInteger(
- request, "documentThumbnail");
+ httpServletRequest, "documentThumbnail");
int previewFileIndex = ParamUtil.getInteger(
- request, "previewFileIndex");
- boolean audioPreview = ParamUtil.getBoolean(request, "audioPreview");
- boolean imagePreview = ParamUtil.getBoolean(request, "imagePreview");
- boolean videoPreview = ParamUtil.getBoolean(request, "videoPreview");
- int videoThumbnail = ParamUtil.getInteger(request, "videoThumbnail");
+ httpServletRequest, "previewFileIndex");
+ boolean audioPreview = ParamUtil.getBoolean(
+ httpServletRequest, "audioPreview");
+ boolean imagePreview = ParamUtil.getBoolean(
+ httpServletRequest, "imagePreview");
+ boolean videoPreview = ParamUtil.getBoolean(
+ httpServletRequest, "videoPreview");
+ int videoThumbnail = ParamUtil.getInteger(
+ httpServletRequest, "videoThumbnail");
InputStream inputStream = null;
long contentLength = 0;
@@ -1090,7 +1056,7 @@ else if (previewFileIndex > 0) {
converted = true;
}
else if (audioPreview || videoPreview) {
- String type = ParamUtil.getString(request, "type");
+ String type = ParamUtil.getString(httpServletRequest, "type");
fileName = FileUtil.stripExtension(
fileName
@@ -1203,27 +1169,29 @@ else if ((videoThumbnail > 0) && (videoThumbnail <= 3)) {
if (isSupportsRangeHeader(contentType)) {
ServletResponseUtil.sendFileWithRangeHeader(
- request, response, fileName, inputStream, contentLength,
- contentType);
+ httpServletRequest, httpServletResponse, fileName, inputStream,
+ contentLength, contentType);
}
else {
- boolean download = ParamUtil.getBoolean(request, "download");
+ boolean download = ParamUtil.getBoolean(
+ httpServletRequest, "download");
if (download) {
ServletResponseUtil.sendFile(
- request, response, fileName, inputStream, contentLength,
- contentType, HttpHeaders.CONTENT\_DISPOSITION\_ATTACHMENT);
+ httpServletRequest, httpServletResponse, fileName,
+ inputStream, contentLength, contentType,
+ HttpHeaders.CONTENT\_DISPOSITION\_ATTACHMENT);
}
else {
ServletResponseUtil.sendFile(
- request, response, fileName, inputStream, contentLength,
- contentType);
+ httpServletRequest, httpServletResponse, fileName,
+ inputStream, contentLength, contentType);
}
}
}
protected void sendFile(
- HttpServletResponse response, User user, long groupId,
+ HttpServletResponse httpServletResponse, User user, long groupId,
long folderId, String title)
throws Exception {
@@ -1231,21 +1199,15 @@ protected void sendFile(
groupId, folderId, title);
ServletResponseUtil.sendFile(
- null, response, title, fileEntry.getContentStream(),
+ null, httpServletResponse, title, fileEntry.getContentStream(),
fileEntry.getSize(), fileEntry.getMimeType(),
HttpHeaders.CONTENT\_DISPOSITION\_ATTACHMENT);
}
protected void sendGroups(
- HttpServletResponse response, User user, String path)
+ HttpServletResponse httpServletResponse, User user, String path)
throws Exception {
- if (!PropsValues.WEB\_SERVER\_SERVLET\_DIRECTORY\_INDEXING\_ENABLED) {
- response.setStatus(HttpServletResponse.SC\_FORBIDDEN);
-
- throw new PrincipalException();
- }
-
List webServerEntries = new ArrayList<>();
List groups = WebDAVUtil.getGroups(user);
@@ -1262,11 +1224,11 @@ protected void sendGroups(
}
}
- sendHTML(response, path, webServerEntries);
+ sendHTML(httpServletResponse, path, webServerEntries);
}
protected void sendHTML(
- HttpServletResponse response, String path,
+ HttpServletResponse httpServletResponse, String path,
List webServerEntries)
throws Exception {
@@ -1288,24 +1250,26 @@ else if (\_WEB\_SERVER\_SERVLET\_VERSION\_VERBOSITY\_PARTIAL) {
template.put("validator", Validator\_IW.getInstance());
- response.setContentType(ContentTypes.TEXT\_HTML\_UTF8);
+ httpServletResponse.setContentType(ContentTypes.TEXT\_HTML\_UTF8);
- template.processTemplate(response.getWriter());
+ template.processTemplate(httpServletResponse.getWriter());
}
protected void sendPortletFileEntry(
- HttpServletRequest request, HttpServletResponse response,
- String[] pathArray)
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse, String[] pathArray)
throws Exception {
- FileEntry fileEntry = getPortletFileEntry(request, pathArray);
+ FileEntry fileEntry = getPortletFileEntry(
+ httpServletRequest, pathArray);
if (fileEntry == null) {
return;
}
if (\_processCompanyInactiveRequest(
- request, response, fileEntry.getCompanyId())) {
+ httpServletRequest, httpServletResponse,
+ fileEntry.getCompanyId())) {
return;
}
@@ -1316,12 +1280,13 @@ protected void sendPortletFileEntry(
fileName = TrashUtil.getOriginalTitle(fileName);
}
- boolean download = ParamUtil.getBoolean(request, "download");
+ boolean download = ParamUtil.getBoolean(httpServletRequest, "download");
if (download) {
ServletResponseUtil.sendFile(
- request, response, fileName, fileEntry.getContentStream(),
- fileEntry.getSize(), fileEntry.getMimeType(),
+ httpServletRequest, httpServletResponse, fileName,
+ fileEntry.getContentStream(), fileEntry.getSize(),
+ fileEntry.getMimeType(),
HttpHeaders.CONTENT\_DISPOSITION\_ATTACHMENT);
}
else {
@@ -1337,14 +1302,14 @@ protected void sendPortletFileEntry(
}
ServletResponseUtil.sendFile(
- request, response, fileName, is, fileEntry.getSize(),
- fileEntry.getMimeType());
+ httpServletRequest, httpServletResponse, fileName, is,
+ fileEntry.getSize(), fileEntry.getMimeType());
}
}
protected void writeImage(
- Image image, HttpServletRequest request,
- HttpServletResponse response)
+ Image image, HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse)
throws PortalException {
if (image == null) {
@@ -1358,20 +1323,21 @@ protected void writeImage(
if (!type.equals(ImageConstants.TYPE\_NOT\_AVAILABLE)) {
contentType = MimeTypesUtil.getExtensionContentType(type);
- response.setContentType(contentType);
+ httpServletResponse.setContentType(contentType);
}
- String fileName = ParamUtil.getString(request, "fileName");
+ String fileName = ParamUtil.getString(httpServletRequest, "fileName");
- byte[] bytes = getImageBytes(request, image);
+ byte[] bytes = getImageBytes(httpServletRequest, image);
try {
if (Validator.isNotNull(fileName)) {
ServletResponseUtil.sendFile(
- request, response, fileName, bytes, contentType);
+ httpServletRequest, httpServletResponse, fileName, bytes,
+ contentType);
}
else {
- ServletResponseUtil.write(response, bytes);
+ ServletResponseUtil.write(httpServletResponse, bytes);
}
}
catch (Exception e) {
@@ -1458,19 +1424,19 @@ private static Group \_getGroup(long companyId, String name)
User user = UserLocalServiceUtil.getUserByScreenName(companyId, name);
- group = user.getGroup();
-
- return group;
+ return user.getGroup();
}
- private static User \_getUser(HttpServletRequest request) throws Exception {
- HttpSession session = request.getSession();
+ private static User \_getUser(HttpServletRequest httpServletRequest)
+ throws Exception {
+
+ HttpSession session = httpServletRequest.getSession();
if (PortalSessionThreadLocal.getHttpSession() == null) {
PortalSessionThreadLocal.setHttpSession(session);
}
- User user = PortalUtil.getUser(request);
+ User user = PortalUtil.getUser(httpServletRequest);
if (user != null) {
return user;
@@ -1482,17 +1448,14 @@ private static User \_getUser(HttpServletRequest request) throws Exception {
if ((userIdString != null) && (password != null)) {
long userId = GetterUtil.getLong(userIdString);
- user = UserLocalServiceUtil.getUser(userId);
+ return UserLocalServiceUtil.getUser(userId);
}
- else {
- long companyId = PortalUtil.getCompanyId(request);
- Company company = CompanyLocalServiceUtil.getCompany(companyId);
+ long companyId = PortalUtil.getCompanyId(httpServletRequest);
- user = company.getDefaultUser();
- }
+ Company company = CompanyLocalServiceUtil.getCompany(companyId);
- return user;
+ return company.getDefaultUser();
}
private static boolean \_isDirectoryIndexingEnabled(Group group) {
@@ -1504,72 +1467,158 @@ private static boolean \_isDirectoryIndexingEnabled(Group group) {
PropsValues.WEB\_SERVER\_SERVLET\_DIRECTORY\_INDEXING\_ENABLED);
}
- private Callable \_createFileServingCallable(
- final HttpServletRequest request, final HttpServletResponse response,
- final User user) {
+ private void \_checkResourcePermission(
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse)
+ throws Exception {
- return new Callable() {
+ String path = HttpUtil.fixPath(httpServletRequest.getPathInfo());
- @Override
- public Void call() throws Exception {
- String path = HttpUtil.fixPath(request.getPathInfo());
+ String[] pathArray = StringUtil.split(path, CharPool.SLASH);
- String[] pathArray = StringUtil.split(path, CharPool.SLASH);
+ if (pathArray.length == 0) {
- if (pathArray.length == 0) {
- sendGroups(
- response, user,
- request.getServletPath() + StringPool.SLASH + path);
+ // Check for sendGroups
+
+ if (!PropsValues.WEB\_SERVER\_SERVLET\_DIRECTORY\_INDEXING\_ENABLED) {
+ httpServletResponse.setStatus(HttpServletResponse.SC\_FORBIDDEN);
+
+ throw new PrincipalException();
+ }
+ }
+ else if (Validator.isNumber(pathArray[0])) {
+
+ // Check for sendFile
+
+ FileEntry fileEntry = getFileEntry(pathArray);
+
+ String portletId = \_getPortletId(fileEntry, httpServletRequest);
+
+ if (portletId == null) {
+ return;
+ }
+
+ PermissionChecker permissionChecker =
+ PermissionThreadLocal.getPermissionChecker();
+
+ if (!PortletPermissionUtil.hasControlPanelAccessPermission(
+ permissionChecker, fileEntry.getGroupId(), portletId)) {
+
+ throw new PrincipalException.MustHavePermission(
+ permissionChecker, FileEntry.class.getName(),
+ fileEntry.getFileEntryId(),
+ ActionKeys.ACCESS\_IN\_CONTROL\_PANEL);
+ }
+ }
+ }
+
+ private Callable \_createFileServingCallable(
+ final HttpServletRequest httpServletRequest,
+ final HttpServletResponse httpServletResponse, final User user) {
+
+ return () -> {
+ String path = HttpUtil.fixPath(httpServletRequest.getPathInfo());
+
+ String[] pathArray = StringUtil.split(path, CharPool.SLASH);
+
+ if (pathArray.length == 0) {
+ sendGroups(
+ httpServletResponse, user,
+ httpServletRequest.getServletPath() + StringPool.SLASH +
+ path);
+ }
+ else {
+ if (Validator.isNumber(pathArray[0])) {
+ sendFile(
+ httpServletRequest, httpServletResponse, user,
+ pathArray);
+ }
+ else if (PATH\_PORTLET\_FILE\_ENTRY.equals(pathArray[0])) {
+ sendPortletFileEntry(
+ httpServletRequest, httpServletResponse, pathArray);
}
else {
- if (Validator.isNumber(pathArray[0])) {
- sendFile(request, response, user, pathArray);
+
+ if (PropsValues.WEB\_SERVER\_SERVLET\_CHECK\_IMAGE\_GALLERY &&
+ isLegacyImageGalleryImageId(
+ httpServletRequest, httpServletResponse)) {
+
+ return null;
}
- else if (PATH\_PORTLET\_FILE\_ENTRY.equals(pathArray[0])) {
- sendPortletFileEntry(request, response, pathArray);
+
+ Image image = getImage(httpServletRequest, true);
+
+ if (image != null) {
+ if ((image.getCompanyId() != user.getCompanyId()) &&
+ \_processCompanyInactiveRequest(
+ httpServletRequest, httpServletResponse,
+ image.getCompanyId())) {
+
+ return null;
+ }
+
+ writeImage(
+ image, httpServletRequest, httpServletResponse);
}
else {
- if (PropsValues.
- WEB\_SERVER\_SERVLET\_CHECK\_IMAGE\_GALLERY) {
+ sendDocumentLibrary(
+ httpServletRequest, httpServletResponse, user,
+ httpServletRequest.getServletPath() +
+ StringPool.SLASH + path,
+ pathArray);
+ }
+ }
+ }
- if (isLegacyImageGalleryImageId(
- request, response)) {
+ return null;
+ };
+ }
- return null;
- }
- }
+ private PermissionChecker \_getPermissionChecker(
+ HttpServletRequest httpServletRequest)
+ throws Exception {
- Image image = getImage(request, true);
+ User user = PortalUtil.getUser(httpServletRequest);
- if (image != null) {
- if ((image.getCompanyId() != user.getCompanyId()) &&
- \_processCompanyInactiveRequest(
- request, response, image.getCompanyId())) {
+ if (user == null) {
+ long companyId = PortalUtil.getCompanyId(httpServletRequest);
- return null;
- }
+ user = UserLocalServiceUtil.getDefaultUser(companyId);
+ }
- writeImage(image, request, response);
- }
- else {
- sendDocumentLibrary(
- request, response, user,
- request.getServletPath() + StringPool.SLASH +
- path,
- pathArray);
- }
- }
- }
+ return PermissionCheckerFactoryUtil.create(user);
+ }
- return null;
+ private String \_getPortletId(
+ FileEntry fileEntry, HttpServletRequest httpServletRequest)
+ throws PortalException {
+
+ if (fileEntry.isInTrash()) {
+ int status = ParamUtil.getInteger(
+ httpServletRequest, "status",
+ WorkflowConstants.STATUS\_APPROVED);
+
+ if (status != WorkflowConstants.STATUS\_IN\_TRASH) {
+ throw new NoSuchFileEntryException();
}
- };
+ return PortletProviderUtil.getPortletId(
+ TrashEntry.class.getName(), PortletProvider.Action.VIEW);
+ }
+
+ Group group = GroupLocalServiceUtil.getGroup(fileEntry.getGroupId());
+
+ if (!group.isStagingGroup()) {
+ return null;
+ }
+
+ return PortletProviderUtil.getPortletId(
+ FileEntry.class.getName(), PortletProvider.Action.VIEW);
}
private boolean \_processCompanyInactiveRequest(
- HttpServletRequest request, HttpServletResponse response,
- long companyId)
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse, long companyId)
throws IOException {
if ((companyId == CompanyConstants.SYSTEM) ||
@@ -1579,7 +1628,7 @@ private boolean \_processCompanyInactiveRequest(
}
\_inactiveRequestHandler.processInactiveRequest(
- request, response,
+ httpServletRequest, httpServletResponse,
"this-instance-is-inactive-please-contact-the-administrator");
if (\_log.isDebugEnabled()) {
diff --git a/portal-impl/src/com/liferay/portal/workflow/WorkflowTaskManagerProxyBean.java b/portal-impl/src/com/liferay/portal/workflow/WorkflowTaskManagerProxyBean.java
index 7c83accdb8895c..b014de9a1e4515 100644
--- a/portal-impl/src/com/liferay/portal/workflow/WorkflowTaskManagerProxyBean.java
+++ b/portal-impl/src/com/liferay/portal/workflow/WorkflowTaskManagerProxyBean.java
@@ -17,6 +17,7 @@
import com.liferay.portal.kernel.messaging.proxy.BaseProxyBean;
import com.liferay.portal.kernel.spring.osgi.OSGiBeanProperties;
import com.liferay.portal.kernel.util.OrderByComparator;
+import com.liferay.portal.kernel.workflow.WorkflowException;
import com.liferay.portal.kernel.workflow.WorkflowTask;
import com.liferay.portal.kernel.workflow.WorkflowTaskManager;
@@ -119,6 +120,15 @@ public int getWorkflowTaskCountByUserRoles(
throw new UnsupportedOperationException();
}
+ @Override
+ public int getWorkflowTaskCountByUserRoles(
+ long companyId, long userId, long workflowInstanceId,
+ Boolean completed)
+ throws WorkflowException {
+
+ throw new UnsupportedOperationException();
+ }
+
@Override
public int getWorkflowTaskCountByWorkflowInstance(
long companyId, Long userId, long workflowInstanceId,
diff --git a/portal-impl/src/com/liferay/portal/workflow/permission/WorkflowPermissionImpl.java b/portal-impl/src/com/liferay/portal/workflow/permission/WorkflowPermissionImpl.java
index 9e438253a23063..e1989df84f85ca 100644
--- a/portal-impl/src/com/liferay/portal/workflow/permission/WorkflowPermissionImpl.java
+++ b/portal-impl/src/com/liferay/portal/workflow/permission/WorkflowPermissionImpl.java
@@ -104,7 +104,7 @@ protected boolean hasImplicitPermission(
count = WorkflowTaskManagerUtil.getWorkflowTaskCountByUserRoles(
permissionChecker.getCompanyId(), permissionChecker.getUserId(),
- Boolean.FALSE);
+ workflowInstance.getWorkflowInstanceId(), Boolean.FALSE);
if (count > 0) {
return true;
diff --git a/portal-impl/src/com/liferay/portlet/admin/dependencies/email\_password\_changed\_body.tmpl b/portal-impl/src/com/liferay/portlet/admin/dependencies/email\_password\_changed\_body.tmpl
new file mode 100644
index 00000000000000..43cd31795f8d6c
--- /dev/null
+++ b/portal-impl/src/com/liferay/portlet/admin/dependencies/email\_password\_changed\_body.tmpl
@@ -0,0 +1,10 @@
+Dear [$TO\_NAME$],

+
+Your password for [$PORTAL\_URL$] has been changed.

+
+The request for a new password was made from [$REMOTE\_ADDRESS$] / [$REMOTE\_HOST$].

+
+Sincerely,

+[$FROM\_NAME$]

+[$FROM\_ADDRESS$]

+[$PORTAL\_URL$]
\ No newline at end of file
diff --git a/portal-impl/src/com/liferay/portlet/admin/dependencies/email\_password\_changed\_subject.tmpl b/portal-impl/src/com/liferay/portlet/admin/dependencies/email\_password\_changed\_subject.tmpl
new file mode 100644
index 00000000000000..f919b537ee0652
--- /dev/null
+++ b/portal-impl/src/com/liferay/portlet/admin/dependencies/email\_password\_changed\_subject.tmpl
@@ -0,0 +1 @@
+[$PORTAL\_URL$]: Your Password Has Been Changed
\ No newline at end of file
diff --git a/portal-impl/src/com/liferay/portlet/admin/dependencies/email\_user\_added\_reset\_password\_body.tmpl b/portal-impl/src/com/liferay/portlet/admin/dependencies/email\_user\_added\_reset\_password\_body.tmpl
new file mode 100644
index 00000000000000..6253fdd4903860
--- /dev/null
+++ b/portal-impl/src/com/liferay/portlet/admin/dependencies/email\_user\_added\_reset\_password\_body.tmpl
@@ -0,0 +1,10 @@
+Dear new user,

+
+Welcome! You recently created an account at [$PORTAL\_URL$].
+
+Your can setup your password here: [$PASSWORD\_SETUP\_URL$]

 Enjoy!

+
+Sincerely,

+[$FROM\_NAME$]

+[$FROM\_ADDRESS$]

+[$PORTAL\_URL$]
\ No newline at end of file
diff --git a/portal-impl/src/com/liferay/portlet/asset/service/persistence/impl/AssetEntryFinderImpl.java b/portal-impl/src/com/liferay/portlet/asset/service/persistence/impl/AssetEntryFinderImpl.java
index 5560db1c60a254..90354b074a4801 100644
--- a/portal-impl/src/com/liferay/portlet/asset/service/persistence/impl/AssetEntryFinderImpl.java
+++ b/portal-impl/src/com/liferay/portlet/asset/service/persistence/impl/AssetEntryFinderImpl.java
@@ -391,8 +391,18 @@ protected SQLQuery buildAssetQuerySQL(
sb.append("AssetLink.entryId2)");
}
- String orderByCol1 = entryQuery.getOrderByCol1();
- String orderByCol2 = entryQuery.getOrderByCol2();
+ String orderByCol1 = AssetEntryQuery.ORDER\_BY\_COLUMNS[2];
+ String orderByCol2 = AssetEntryQuery.ORDER\_BY\_COLUMNS[2];
+
+ for (String orderByColumn : AssetEntryQuery.ORDER\_BY\_COLUMNS) {
+ if (orderByColumn.equals(entryQuery.getOrderByCol1())) {
+ orderByCol1 = orderByColumn;
+ }
+
+ if (orderByColumn.equals(entryQuery.getOrderByCol2())) {
+ orderByCol2 = orderByColumn;
+ }
+ }
if (orderByCol1.equals("ratings") || orderByCol2.equals("ratings")) {
sb.append(" LEFT JOIN RatingsStats ON (RatingsStats.classNameId ");
diff --git a/portal-impl/src/portal.properties b/portal-impl/src/portal.properties
index 17f22968954d8d..40a44c2b600248 100644
--- a/portal-impl/src/portal.properties
+++ b/portal-impl/src/portal.properties
@@ -6631,6 +6631,28 @@
#
direct.servlet.context.reload=true
+##
+## DNS
+##
+
+ #
+ # Configure the seconds to wait for resolving an external domain. This limit
+ # helps prevent DoS attacks when trying to resolve an external domain. By
+ # default, the Oracle Java implementation has a 15 second timeout for DNS
+ # queries, so you must enter a number of less than 15.
+ #
+ # Env: LIFERAY\_DNS\_PERIOD\_SECURITY\_PERIOD\_ADDRESS\_PERIOD\_TIMEOUT\_PERIOD\_SECONDS
+ #
+ dns.security.address.timeout.seconds=2
+
+ #
+ # Configure the maximum number of threads when resolving an external domain.
+ # This limit helps prevent DoS attacks.
+ #
+ # Env: LIFERAY\_DNS\_PERIOD\_SECURITY\_PERIOD\_THREAD\_PERIOD\_LIMIT
+ #
+ dns.security.thread.limit=10
+
##
## ETag
##
@@ -7200,6 +7222,265 @@
#
json.web.service.enabled=true
+ #
+ # Input a list of comma delimited class names that are allowed to be used
+ # for JSON web service request object parameters.
+ #
+ # Env: LIFERAY\_JSONWS\_PERIOD\_WEB\_PERIOD\_SERVICE\_PERIOD\_PARAMETER\_PERIOD\_TYPE\_PERIOD\_WHITELIST\_PERIOD\_CLASS\_PERIOD\_NAMES
+ #
+ jsonws.web.service.parameter.type.whitelist.class.names=\
+ \
+ #
+ # java.lang.Object in
+ # com.liferay.expando.kernel.service.ExpandoColumnService
+ #
+ \
+ com.liferay.portal.json.JSONObjectImpl,\
+ java.util.Date,\
+ \
+ #
+ # com.liferay.lcs.messaging.Message
+ #
+ \
+ com.liferay.lcs.messaging.analytics.AnalyticsEventsMessage,\
+ com.liferay.lcs.messaging.analytics.ATAnalyticsEventsMessage,\
+ com.liferay.lcs.messaging.analytics.ScreensAnalyticsEventsMessage,\
+ com.liferay.lcs.messaging.CommandMessage,\
+ com.liferay.lcs.messaging.HandshakeMessage,\
+ com.liferay.lcs.messaging.HealthMessage,\
+ com.liferay.lcs.messaging.HeartbeatMessage,\
+ com.liferay.lcs.messaging.LCSMessageMessage,\
+ com.liferay.lcs.messaging.LCSSubscriptionEntryMessage,\
+ com.liferay.lcs.messaging.MessageBusCommandMessage,\
+ com.liferay.lcs.messaging.MessageBusMessage,\
+ com.liferay.lcs.messaging.MetricsMessage,\
+ com.liferay.lcs.messaging.ResponseMessage,\
+ com.liferay.lcs.messaging.ScheduledTaskMessage,\
+ \
+ #
+ # com.liferay.portal.kernel.search.Query
+ #
+ \
+ com.liferay.portal.kernel.search.generic.BooleanQueryImpl,\
+ com.liferay.portal.kernel.search.generic.DisMaxQuery,\
+ com.liferay.portal.kernel.search.generic.FuzzyQuery,\
+ com.liferay.portal.kernel.search.generic.MatchAllQuery,\
+ com.liferay.portal.kernel.search.generic.MatchQuery,\
+ com.liferay.portal.kernel.search.generic.MoreLikeThisQuery,\
+ com.liferay.portal.kernel.search.generic.MultiMatchQuery,\
+ com.liferay.portal.kernel.search.generic.NestedQuery,\
+ com.liferay.portal.kernel.search.generic.StringQuery,\
+ com.liferay.portal.kernel.search.generic.TermQueryImpl,\
+ com.liferay.portal.kernel.search.generic.TermRangeQueryImpl,\
+ com.liferay.portal.kernel.search.generic.WildcardQueryImpl,\
+ \
+ #
+ # com.liferay.portal.kernel.util.OrderByComparator
+ #
+ \
+ com.liferay.asset.kernel.util.comparator.AssetTagCountComparator,\
+ com.liferay.asset.util.comparator.AssetTagCountComparator,\
+ com.liferay.background.task.kernel.util.comparator.BackgroundTaskCompletionDateComparator,\
+ com.liferay.background.task.kernel.util.comparator.BackgroundTaskCreateDateComparator,\
+ com.liferay.background.task.kernel.util.comparator.BackgroundTaskNameComparator,\
+ com.liferay.blogs.util.comparator.EntryDisplayDateComparator,\
+ com.liferay.blogs.util.comparator.EntryIdComparator,\
+ com.liferay.blogs.util.comparator.EntryModifiedDateComparator,\
+ com.liferay.blogs.util.comparator.EntryTitleComparator,\
+ com.liferay.blogs.util.comparator.StatsUserLastPostDateComparator,\
+ com.liferay.bookmarks.util.comparator.EntryCreateDateComparator,\
+ com.liferay.bookmarks.util.comparator.EntryModifiedDateComparator,\
+ com.liferay.bookmarks.util.comparator.EntryNameComparator,\
+ com.liferay.bookmarks.util.comparator.EntryPriorityComparator,\
+ com.liferay.bookmarks.util.comparator.EntryURLComparator,\
+ com.liferay.bookmarks.util.comparator.EntryVisitsComparator,\
+ com.liferay.bookmarks.util.comparator.FolderIdComparator,\
+ com.liferay.calendar.util.comparator.CalendarBookingStartTimeComparator,\
+ com.liferay.calendar.util.comparator.CalendarNameComparator,\
+ com.liferay.calendar.util.comparator.CalendarResourceCodeComparator,\
+ com.liferay.calendar.util.comparator.CalendarResourceNameComparator,\
+ com.liferay.document.library.content.service.util.comparator.DLContentVersionComparator,\
+ com.liferay.document.library.file.rank.util.comparator.FileRankCreateDateComparator,\
+ com.liferay.document.library.kernel.util.comparator.FileRankCreateDateComparator,\
+ com.liferay.document.library.kernel.util.comparator.FolderIdComparator,\
+ com.liferay.document.library.kernel.util.comparator.FolderNameComparator,\
+ com.liferay.document.library.kernel.util.comparator.RepositoryModelCreateDateComparator,\
+ com.liferay.document.library.kernel.util.comparator.RepositoryModelModifiedDateComparator,\
+ com.liferay.document.library.kernel.util.comparator.RepositoryModelReadCountComparator,\
+ com.liferay.document.library.kernel.util.comparator.RepositoryModelSizeComparator,\
+ com.liferay.document.library.kernel.util.comparator.RepositoryModelTitleComparator,\
+ com.liferay.dynamic.data.lists.util.comparator.DDLRecordCreateDateComparator,\
+ com.liferay.dynamic.data.lists.util.comparator.DDLRecordIdComparator,\
+ com.liferay.dynamic.data.lists.util.comparator.DDLRecordModifiedDateComparator,\
+ com.liferay.dynamic.data.lists.util.comparator.DDLRecordSetCreateDateComparator,\
+ com.liferay.dynamic.data.lists.util.comparator.DDLRecordSetModifiedDateComparator,\
+ com.liferay.dynamic.data.lists.util.comparator.DDLRecordSetNameComparator,\
+ com.liferay.dynamic.data.mapping.util.comparator.DataProviderInstanceModifiedDateComparator,\
+ com.liferay.dynamic.data.mapping.util.comparator.DataProviderInstanceNameComparator,\
+ com.liferay.dynamic.data.mapping.util.comparator.DDMFormInstanceModifiedDateComparator,\
+ com.liferay.dynamic.data.mapping.util.comparator.DDMFormInstanceNameComparator,\
+ com.liferay.dynamic.data.mapping.util.comparator.DDMFormInstanceRecordIdComparator,\
+ com.liferay.dynamic.data.mapping.util.comparator.DDMFormInstanceRecordModifiedDateComparator,\
+ com.liferay.dynamic.data.mapping.util.comparator.StructureCreateDateComparator,\
+ com.liferay.dynamic.data.mapping.util.comparator.StructureIdComparator,\
+ com.liferay.dynamic.data.mapping.util.comparator.StructureLinkStructureNameComparator,\
+ com.liferay.dynamic.data.mapping.util.comparator.StructureModifiedDateComparator,\
+ com.liferay.dynamic.data.mapping.util.comparator.StructureNameComparator,\
+ com.liferay.dynamic.data.mapping.util.comparator.StructureStructureKeyComparator,\
+ com.liferay.dynamic.data.mapping.util.comparator.TemplateIdComparator,\
+ com.liferay.dynamic.data.mapping.util.comparator.TemplateModifiedDateComparator,\
+ com.liferay.exportimport.kernel.lar.StagedModelModifiedDateComparator,\
+ com.liferay.exportimport.util.comparator.ExportImportConfigurationNameComparator,\
+ com.liferay.fragment.util.comparator.FragmentCollectionCreateDateComparator,\
+ com.liferay.fragment.util.comparator.FragmentCollectionNameComparator,\
+ com.liferay.fragment.util.comparator.FragmentEntryCreateDateComparator,\
+ com.liferay.fragment.util.comparator.FragmentEntryLinkLastPropagationDateComparator,\
+ com.liferay.fragment.util.comparator.FragmentEntryNameComparator,\
+ com.liferay.friendly.url.util.comparator.FriendlyURLEntryCreateDateComparator,\
+ com.liferay.journal.util.comparator.ArticleCreateDateComparator,\
+ com.liferay.journal.util.comparator.ArticleDisplayDateComparator,\
+ com.liferay.journal.util.comparator.ArticleIDComparator,\
+ com.liferay.journal.util.comparator.ArticleModifiedDateComparator,\
+ com.liferay.journal.util.comparator.ArticleResourcePKComparator,\
+ com.liferay.journal.util.comparator.ArticleReviewDateComparator,\
+ com.liferay.journal.util.comparator.ArticleTitleComparator,\
+ com.liferay.journal.util.comparator.ArticleVersionComparator,\
+ com.liferay.journal.util.comparator.FeedIDComparator,\
+ com.liferay.journal.util.comparator.FeedNameComparator,\
+ com.liferay.journal.util.comparator.FolderArticleArticleIdComparator,\
+ com.liferay.journal.util.comparator.FolderArticleDisplayDateComparator,\
+ com.liferay.journal.util.comparator.FolderArticleModifiedDateComparator,\
+ com.liferay.journal.util.comparator.FolderArticleTitleComparator,\
+ com.liferay.journal.util.comparator.FolderIdComparator,\
+ com.liferay.knowledge.base.util.comparator.KBArticleCreateDateComparator,\
+ com.liferay.knowledge.base.util.comparator.KBArticleModifiedDateComparator,\
+ com.liferay.knowledge.base.util.comparator.KBArticlePriorityComparator,\
+ com.liferay.knowledge.base.util.comparator.KBArticleStatusComparator,\
+ com.liferay.knowledge.base.util.comparator.KBArticleTitleComparator,\
+ com.liferay.knowledge.base.util.comparator.KBArticleUserNameComparator,\
+ com.liferay.knowledge.base.util.comparator.KBArticleVersionComparator,\
+ com.liferay.knowledge.base.util.comparator.KBArticleViewCountComparator,\
+ com.liferay.knowledge.base.util.comparator.KBCommentCreateDateComparator,\
+ com.liferay.knowledge.base.util.comparator.KBCommentModifiedDateComparator,\
+ com.liferay.knowledge.base.util.comparator.KBCommentStatusComparator,\
+ com.liferay.knowledge.base.util.comparator.KBCommentUserNameComparator,\
+ com.liferay.knowledge.base.util.comparator.KBFolderNameComparator,\
+ com.liferay.knowledge.base.util.comparator.KBObjectsModifiedDateComparator,\
+ com.liferay.knowledge.base.util.comparator.KBObjectsPriorityComparator,\
+ com.liferay.knowledge.base.util.comparator.KBObjectsTitleComparator,\
+ com.liferay.knowledge.base.util.comparator.KBObjectsViewCountComparator,\
+ com.liferay.knowledge.base.util.comparator.KBTemplateCreateDateComparator,\
+ com.liferay.knowledge.base.util.comparator.KBTemplateModifiedDateComparator,\
+ com.liferay.knowledge.base.util.comparator.KBTemplateTitleComparator,\
+ com.liferay.knowledge.base.util.comparator.KBTemplateUserNameComparator,\
+ com.liferay.layout.page.template.util.comparator.LayoutPageTemplateCollectionCreateDateComparator,\
+ com.liferay.layout.page.template.util.comparator.LayoutPageTemplateCollectionNameComparator,\
+ com.liferay.layout.page.template.util.comparator.LayoutPageTemplateEntryCreateDateComparator,\
+ com.liferay.layout.page.template.util.comparator.LayoutPageTemplateEntryNameComparator,\
+ com.liferay.layout.util.comparator.LayoutCreateDateComparator,\
+ com.liferay.marketplace.util.comparator.AppTitleComparator,\
+ com.liferay.membership.requests.kernel.util.comparator.MembershipRequestCreateDateComparator,\
+ com.liferay.message.boards.util.comparator.CategoryModifiedDateComparator,\
+ com.liferay.message.boards.util.comparator.CategoryTitleComparator,\
+ com.liferay.message.boards.util.comparator.MBObjectsModifiedDateComparator,\
+ com.liferay.message.boards.util.comparator.MBObjectsTitleComparator,\
+ com.liferay.message.boards.util.comparator.ThreadLastPostDateComparator,\
+ com.liferay.message.boards.util.comparator.ThreadModifiedDateComparator,\
+ com.liferay.message.boards.util.comparator.ThreadTitleComparator,\
+ com.liferay.microblogs.util.comparator.EntryCreateDateComparator,\
+ com.liferay.mobile.device.rules.util.comparator.ActionCreateDateComparator,\
+ com.liferay.mobile.device.rules.util.comparator.RuleCreateDateComparator,\
+ com.liferay.mobile.device.rules.util.comparator.RuleGroupCreateDateComparator,\
+ com.liferay.mobile.device.rules.util.comparator.RuleGroupInstancePriorityComparator,\
+ com.liferay.notifications.web.internal.util.comparator.UserNotificationEventTimestampComparator,\
+ com.liferay.osb.faro.web.internal.util.comparator.ContactsCardTemplateNameComparator,\
+ com.liferay.polls.util.comparator.PollsQuestionCreateDateComparator,\
+ com.liferay.polls.util.comparator.PollsQuestionTitleComparator,\
+ com.liferay.portal.background.task.internal.comparator.BackgroundTaskCompletionDateComparator,\
+ com.liferay.portal.background.task.internal.comparator.BackgroundTaskCreateDateComparator,\
+ com.liferay.portal.background.task.internal.comparator.BackgroundTaskNameComparator,\
+ com.liferay.portal.kernel.util.comparator.ContactFirstNameComparator,\
+ com.liferay.portal.kernel.util.comparator.ContactJobTitleComparator,\
+ com.liferay.portal.kernel.util.comparator.ContactLastNameComparator,\
+ com.liferay.portal.kernel.util.comparator.GroupFriendlyURLComparator,\
+ com.liferay.portal.kernel.util.comparator.GroupIdComparator,\
+ com.liferay.portal.kernel.util.comparator.GroupNameComparator,\
+ com.liferay.portal.kernel.util.comparator.GroupTypeComparator,\
+ com.liferay.portal.kernel.util.comparator.LayoutComparator,\
+ com.liferay.portal.kernel.util.comparator.LayoutPriorityComparator,\
+ com.liferay.portal.kernel.util.comparator.LayoutPrototypeCreateDateComparator,\
+ com.liferay.portal.kernel.util.comparator.LayoutRevisionCreateDateComparator,\
+ com.liferay.portal.kernel.util.comparator.LayoutRevisionIdComparator,\
+ com.liferay.portal.kernel.util.comparator.LayoutRevisionModifiedDateComparator,\
+ com.liferay.portal.kernel.util.comparator.LayoutSetBranchCreateDateComparator,\
+ com.liferay.portal.kernel.util.comparator.LayoutSetPrototypeCreateDateComparator,\
+ com.liferay.portal.kernel.util.comparator.OrganizationIdComparator,\
+ com.liferay.portal.kernel.util.comparator.OrganizationNameComparator,\
+ com.liferay.portal.kernel.util.comparator.OrganizationTypeComparator,\
+ com.liferay.portal.kernel.util.comparator.PasswordPolicyDescriptionComparator,\
+ com.liferay.portal.kernel.util.comparator.PasswordPolicyNameComparator,\
+ com.liferay.portal.kernel.util.comparator.ResourceActionBitwiseValueComparator,\
+ com.liferay.portal.kernel.util.comparator.RoleDescriptionComparator,\
+ com.liferay.portal.kernel.util.comparator.RoleNameComparator,\
+ com.liferay.portal.kernel.util.comparator.RoleRoleIdComparator,\
+ com.liferay.portal.kernel.util.comparator.RoleTypeComparator,\
+ com.liferay.portal.kernel.util.comparator.SubscriptionClassNameIdComparator,\
+ com.liferay.portal.kernel.util.comparator.TeamNameComparator,\
+ com.liferay.portal.kernel.util.comparator.UserEmailAddressComparator,\
+ com.liferay.portal.kernel.util.comparator.UserFirstNameComparator,\
+ com.liferay.portal.kernel.util.comparator.UserGroupDescriptionComparator,\
+ com.liferay.portal.kernel.util.comparator.UserGroupIdComparator,\
+ com.liferay.portal.kernel.util.comparator.UserGroupNameComparator,\
+ com.liferay.portal.kernel.util.comparator.UserIdComparator,\
+ com.liferay.portal.kernel.util.comparator.UserJobTitleComparator,\
+ com.liferay.portal.kernel.util.comparator.UserLastNameComparator,\
+ com.liferay.portal.kernel.util.comparator.UserLoginDateComparator,\
+ com.liferay.portal.kernel.util.comparator.UserScreenNameComparator,\
+ com.liferay.portal.reports.engine.console.util.comparator.DefinitionCreateDateComparator,\
+ com.liferay.portal.reports.engine.console.util.comparator.EntryCreateDateComparator,\
+ com.liferay.portal.reports.engine.console.util.comparator.SourceCreateDateComparator,\
+ com.liferay.portal.security.audit.storage.comparator.AuditEventCreateDateComparator,\
+ com.liferay.portal.security.service.access.policy.util.comparator.SAPEntryNameComparator,\
+ com.liferay.portal.workflow.kaleo.forms.util.comparator.KaleoProcessCreateDateComparator,\
+ com.liferay.portal.workflow.kaleo.forms.util.comparator.KaleoProcessModifiedDateComparator,\
+ com.liferay.portal.workflow.kaleo.util.comparator.KaleoDefinitionVersionIdComparator,\
+ com.liferay.portal.workflow.kaleo.util.comparator.KaleoDefinitionVersionModifiedDateComparator,\
+ com.liferay.portal.workflow.kaleo.util.comparator.KaleoDefinitionVersionNameComparator,\
+ com.liferay.portal.workflow.kaleo.util.comparator.KaleoDefinitionVersionTitleComparator,\
+ com.liferay.portal.workflow.kaleo.util.comparator.KaleoDefinitionVersionVersionComparator,\
+ com.liferay.portal.workflow.web.internal.util.comparator.WorkflowDefinitionActiveComparator,\
+ com.liferay.portal.workflow.web.internal.util.comparator.WorkflowDefinitionModifiedDateComparator,\
+ com.liferay.portal.workflow.web.internal.util.comparator.WorkflowDefinitionNameComparator,\
+ com.liferay.portal.workflow.web.internal.util.comparator.WorkflowDefinitionTitleComparator,\
+ com.liferay.portlet.asset.util.comparator.AssetCategoryCreateDateComparator,\
+ com.liferay.portlet.asset.util.comparator.AssetCategoryLeftCategoryIdComparator,\
+ com.liferay.portlet.asset.util.comparator.AssetTagAssetCountComparator,\
+ com.liferay.portlet.asset.util.comparator.AssetTagNameComparator,\
+ com.liferay.portlet.asset.util.comparator.AssetVocabularyCreateDateComparator,\
+ com.liferay.portlet.configuration.web.internal.util.comparator.ArchivedSettingsModifiedDateComparator,\
+ com.liferay.portlet.configuration.web.internal.util.comparator.ArchivedSettingsNameComparator,\
+ com.liferay.push.notifications.util.comparator.PushNotificationsDevicePlatformComparator,\
+ com.liferay.site.admin.web.internal.display.context.comparator.SiteInitializerNameComparator,\
+ com.liferay.site.navigation.util.comparator.SiteNavigationMenuCreateDateComparator,\
+ com.liferay.site.navigation.util.comparator.SiteNavigationMenuItemOrderComparator,\
+ com.liferay.site.navigation.util.comparator.SiteNavigationMenuNameComparator,\
+ com.liferay.social.kernel.util.comparator.SocialActivitySetModifiedDateComparator,\
+ com.liferay.subscription.util.comparator.SubscriptionClassNameIdComparator,\
+ com.liferay.sync.util.comparator.SyncDLObjectModifiedTimeComparator,\
+ com.liferay.trash.kernel.util.comparator.EntryCreateDateComparator,\
+ com.liferay.trash.kernel.util.comparator.EntryTypeComparator,\
+ com.liferay.trash.kernel.util.comparator.EntryUserNameComparator,\
+ com.liferay.trash.util.comparator.EntryCreateDateComparator,\
+ com.liferay.trash.util.comparator.EntryTypeComparator,\
+ com.liferay.trash.util.comparator.EntryUserNameComparator,\
+ com.liferay.users.admin.web.internal.util.comparator.OrganizationUserNameComparator,\
+ com.liferay.wiki.util.comparator.NodeLastPostDateComparator,\
+ com.liferay.wiki.util.comparator.NodeNameComparator,\
+ com.liferay.wiki.util.comparator.PageCreateDateComparator,\
+ com.liferay.wiki.util.comparator.PageModifiedDateComparator,\
+ com.liferay.wiki.util.comparator.PageTitleComparator,\
+ com.liferay.wiki.util.comparator.PageVersionComparator
+
#
# Set this property to true if JSON web services are discoverable through
# the API page.
@@ -7240,7 +7521,8 @@
#
# Env: LIFERAY\_JSONWS\_PERIOD\_WEB\_PERIOD\_SERVICE\_PERIOD\_PATHS\_PERIOD\_EXCLUDES
#
- jsonws.web.service.paths.excludes=
+ jsonws.web.service.paths.excludes=\
+ /user/update-password
#
# The property "jsonws.web.service.paths.includes" denotes patterns for JSON
@@ -7771,6 +8053,13 @@
module.framework.properties.osgi.context.bootdelegation=false
module.framework.properties.osgi.module.lock.timeout=3600
+ #
+ # Set this true to enable exporting passwords to configuration files.
+ #
+ # Env: LIFERAY\_MODULE\_PERIOD\_FRAMEWORK\_PERIOD\_EXPORT\_PERIOD\_PASSWORD\_PERIOD\_ATTRIBUTES
+ #
+ module.framework.export.password.attributes=true
+
##
## Module Framework Web Application Bundles
##
@@ -9874,6 +10163,19 @@
admin.email.user.added.subject=com/liferay/portlet/admin/dependencies/email\_user\_added\_subject.tmpl
admin.email.user.added.body=com/liferay/portlet/admin/dependencies/email\_user\_added\_body.tmpl
admin.email.user.added.no.password.body=com/liferay/portlet/admin/dependencies/email\_user\_added\_no\_password\_body.tmpl
+ admin.email.user.added.reset.password.body=com/liferay/portlet/admin/dependencies/email\_user\_added\_reset\_password\_body.tmpl
+
+ #
+ # Env: LIFERAY\_ADMIN\_PERIOD\_EMAIL\_PERIOD\_PASSWORD\_PERIOD\_CHANGED\_PERIOD\_BODY
+ # Env: LIFERAY\_ADMIN\_PERIOD\_EMAIL\_PERIOD\_PASSWORD\_PERIOD\_CHANGED\_PERIOD\_SUBJECT
+ #
+ admin.email.password.changed.subject=com/liferay/portlet/admin/dependencies/email\_password\_changed\_subject.tmpl
+ admin.email.password.changed.body=com/liferay/portlet/admin/dependencies/email\_password\_changed\_body.tmpl
+
+ #
+ # Env: LIFERAY\_ADMIN\_PERIOD\_EMAIL\_PERIOD\_PASSWORD\_PERIOD\_RESET\_PERIOD\_BODY
+ # Env: LIFERAY\_ADMIN\_PERIOD\_EMAIL\_PERIOD\_PASSWORD\_PERIOD\_RESET\_PERIOD\_SUBJECT
+ #
admin.email.password.reset.subject=com/liferay/portlet/admin/dependencies/email\_password\_reset\_subject.tmpl
admin.email.password.reset.body=com/liferay/portlet/admin/dependencies/email\_password\_reset\_body.tmpl
@@ -10790,7 +11092,7 @@
#
# Env: LIFERAY\_LOGIN\_PERIOD\_CREATE\_PERIOD\_ACCOUNT\_PERIOD\_ALLOW\_PERIOD\_CUSTOM\_PERIOD\_PASSWORD
#
- login.create.account.allow.custom.password=false
+ login.create.account.allow.custom.password=true
#
# Set this to true to disable the login popup dialog. This should only be
diff --git a/portal-kernel/src/com/liferay/portal/kernel/internal/security/access/control/AllowedIPAddressesValidatorFactory.java b/portal-kernel/src/com/liferay/portal/kernel/internal/security/access/control/AllowedIPAddressesValidatorFactory.java
index 0bdf5ba3d64d33..1554b18ccfbd8a 100644
--- a/portal-kernel/src/com/liferay/portal/kernel/internal/security/access/control/AllowedIPAddressesValidatorFactory.java
+++ b/portal-kernel/src/com/liferay/portal/kernel/internal/security/access/control/AllowedIPAddressesValidatorFactory.java
@@ -18,6 +18,7 @@
import com.liferay.portal.kernel.log.Log;
import com.liferay.portal.kernel.log.LogFactoryUtil;
import com.liferay.portal.kernel.util.GetterUtil;
+import com.liferay.portal.kernel.util.InetAddressUtil;
import com.liferay.portal.kernel.util.StringUtil;
import com.liferay.portal.kernel.util.Validator;
@@ -43,12 +44,14 @@ public static AllowedIPAddressesValidator create(
try {
if (Validator.isIPv4Address(ipAddressAndNetmask[0])) {
return new V4AllowedIPAddressesValidator(
- InetAddress.getByName(ipAddressAndNetmask[0]),
+ InetAddressUtil.getInetAddressByName(
+ ipAddressAndNetmask[0]),
ipAddressAndNetmask);
}
else if (Validator.isIPv6Address(ipAddressAndNetmask[0])) {
return new V6AllowedIPAddressesValidator(
- InetAddress.getByName(ipAddressAndNetmask[0]),
+ InetAddressUtil.getInetAddressByName(
+ ipAddressAndNetmask[0]),
ipAddressAndNetmask);
}
else {
@@ -81,7 +84,7 @@ public boolean isAllowedIPAddress(String ipAddress) {
InetAddress inetAddress = null;
try {
- inetAddress = InetAddress.getByName(ipAddress);
+ inetAddress = InetAddressUtil.getInetAddressByName(ipAddress);
}
catch (UnknownHostException uhe) {
return false;
@@ -161,7 +164,8 @@ private byte[] \_getNetmaskFromCIDR(String netmask) {
private byte[] \_getNetmaskFromDotNotation(String netmask)
throws UnknownHostException {
- InetAddress inetAddress = InetAddress.getByName(netmask);
+ InetAddress inetAddress = InetAddressUtil.getInetAddressByName(
+ netmask);
return inetAddress.getAddress();
}
diff --git a/portal-kernel/src/com/liferay/portal/kernel/jsonwebservice/JSONWebServiceNaming.java b/portal-kernel/src/com/liferay/portal/kernel/jsonwebservice/JSONWebServiceNaming.java
index 050ef275fbc25b..b22801e3dcda0c 100644
--- a/portal-kernel/src/com/liferay/portal/kernel/jsonwebservice/JSONWebServiceNaming.java
+++ b/portal-kernel/src/com/liferay/portal/kernel/jsonwebservice/JSONWebServiceNaming.java
@@ -15,6 +15,7 @@
package com.liferay.portal.kernel.jsonwebservice;
import com.liferay.petra.string.StringPool;
+import com.liferay.portal.kernel.annotation.ImplementationClassName;
import com.liferay.portal.kernel.servlet.HttpMethods;
import com.liferay.portal.kernel.util.CamelCaseUtil;
import com.liferay.portal.kernel.util.PortalUtil;
@@ -54,6 +55,13 @@ public String convertMethodToPath(Method method) {
}
public String convertModelClassToImplClassName(Class  clazz) {
+ ImplementationClassName implementationClassName = clazz.getAnnotation(
+ ImplementationClassName.class);
+
+ if (implementationClassName != null) {
+ return implementationClassName.value();
+ }
+
String className = clazz.getName();
className = StringUtil.replace(className, ".kernel.", ".");
diff --git a/portal-kernel/src/com/liferay/portal/kernel/portlet/LiferayPortlet.java b/portal-kernel/src/com/liferay/portal/kernel/portlet/LiferayPortlet.java
index 6f16fab837101d..8526a3f5a89e68 100644
--- a/portal-kernel/src/com/liferay/portal/kernel/portlet/LiferayPortlet.java
+++ b/portal-kernel/src/com/liferay/portal/kernel/portlet/LiferayPortlet.java
@@ -655,7 +655,7 @@ protected void writeJSON(
response.setContentType(getJSONContentType(portletRequest));
- ServletResponseUtil.write(response, jsonObj.toString());
+ ServletResponseUtil.write(response, \_toXSSSafeJSON(jsonObj.toString()));
response.flushBuffer();
}
@@ -667,7 +667,8 @@ protected void writeJSON(
mimeResponse.setContentType(getJSONContentType(portletRequest));
- PortletResponseUtil.write(mimeResponse, jsonObj.toString());
+ PortletResponseUtil.write(
+ mimeResponse, \_toXSSSafeJSON(jsonObj.toString()));
mimeResponse.flushBuffer();
}
@@ -676,6 +677,10 @@ protected void writeJSON(
protected boolean alwaysSendRedirect;
protected Set validPaths;
+ private String \_toXSSSafeJSON(String json) {
+ return StringUtil.replace(json, CharPool.LESS\_THAN, "\\u003c");
+ }
+
private static final String[] \_IGNORED\_SESSION\_MESSAGE\_SUFFIXES = {
SessionMessages.KEY\_SUFFIX\_DELETE\_SUCCESS\_DATA,
SessionMessages.KEY\_SUFFIX\_FORCE\_SEND\_REDIRECT,
diff --git a/portal-kernel/src/com/liferay/portal/kernel/service/LayoutService.java b/portal-kernel/src/com/liferay/portal/kernel/service/LayoutService.java
index 9359ee4ea03bb3..b3cdbf9f92b816 100644
--- a/portal-kernel/src/com/liferay/portal/kernel/service/LayoutService.java
+++ b/portal-kernel/src/com/liferay/portal/kernel/service/LayoutService.java
@@ -525,6 +525,11 @@ public List getLayouts(
boolean incomplete, int start, int end)
throws PortalException;
+ @Transactional(propagation = Propagation.SUPPORTS, readOnly = true)
+ public List getLayouts(
+ long groupId, boolean privateLayout, String type)
+ throws PortalException;
+
@Transactional(propagation = Propagation.SUPPORTS, readOnly = true)
public List getLayouts(long groupId, String type);
diff --git a/portal-kernel/src/com/liferay/portal/kernel/service/LayoutServiceUtil.java b/portal-kernel/src/com/liferay/portal/kernel/service/LayoutServiceUtil.java
index b8a567485cdd1d..32ab0065d4d4f7 100644
--- a/portal-kernel/src/com/liferay/portal/kernel/service/LayoutServiceUtil.java
+++ b/portal-kernel/src/com/liferay/portal/kernel/service/LayoutServiceUtil.java
@@ -637,6 +637,13 @@ public static long getLayoutPlid(
groupId, privateLayout, parentLayoutId, incomplete, start, end);
}
+ public static java.util.List
+ getLayouts(long groupId, boolean privateLayout, String type)
+ throws com.liferay.portal.kernel.exception.PortalException {
+
+ return getService().getLayouts(groupId, privateLayout, type);
+ }
+
public static java.util.List
getLayouts(long groupId, String type) {
diff --git a/portal-kernel/src/com/liferay/portal/kernel/service/LayoutServiceWrapper.java b/portal-kernel/src/com/liferay/portal/kernel/service/LayoutServiceWrapper.java
index 6dc085b47e2d4f..e7dd920df2fa9f 100644
--- a/portal-kernel/src/com/liferay/portal/kernel/service/LayoutServiceWrapper.java
+++ b/portal-kernel/src/com/liferay/portal/kernel/service/LayoutServiceWrapper.java
@@ -661,6 +661,14 @@ public java.util.List getLayouts(
groupId, privateLayout, parentLayoutId, incomplete, start, end);
}
+ @Override
+ public java.util.List getLayouts(
+ long groupId, boolean privateLayout, String type)
+ throws com.liferay.portal.kernel.exception.PortalException {
+
+ return \_layoutService.getLayouts(groupId, privateLayout, type);
+ }
+
@Override
public java.util.List getLayouts(
long groupId, String type) {
diff --git a/portal-kernel/src/com/liferay/portal/kernel/service/UserService.java b/portal-kernel/src/com/liferay/portal/kernel/service/UserService.java
index b44320b5d95685..a0480f5f5517d0 100644
--- a/portal-kernel/src/com/liferay/portal/kernel/service/UserService.java
+++ b/portal-kernel/src/com/liferay/portal/kernel/service/UserService.java
@@ -20,6 +20,7 @@
import com.liferay.portal.kernel.exception.PortalException;
import com.liferay.portal.kernel.exception.SystemException;
import com.liferay.portal.kernel.jsonwebservice.JSONWebService;
+import com.liferay.portal.kernel.jsonwebservice.JSONWebServiceMode;
import com.liferay.portal.kernel.model.Address;
import com.liferay.portal.kernel.model.EmailAddress;
import com.liferay.portal.kernel.model.Phone;
@@ -670,6 +671,7 @@ public boolean hasRoleUser(
password; `false` if the notification email only
contains a reset link
\*/
+ @JSONWebService(mode = JSONWebServiceMode.IGNORE)
public boolean sendPasswordByEmailAddress(
long companyId, String emailAddress)
throws PortalException;
@@ -693,6 +695,7 @@ public boolean sendPasswordByEmailAddress(
password; `false` if the notification email only
contains a reset link
\*/
+ @JSONWebService(mode = JSONWebServiceMode.IGNORE)
public boolean sendPasswordByScreenName(long companyId, String screenName)
throws PortalException;
@@ -714,6 +717,7 @@ public boolean sendPasswordByScreenName(long companyId, String screenName)
password; `false` if the notification email only
contains a reset link
\*/
+ @JSONWebService(mode = JSONWebServiceMode.IGNORE)
public boolean sendPasswordByUserId(long userId) throws PortalException;
/\*\*
diff --git a/portal-kernel/src/com/liferay/portal/kernel/util/InetAddressUtil.java b/portal-kernel/src/com/liferay/portal/kernel/util/InetAddressUtil.java
index a209987386ce33..ff0bd41aa2810e 100644
--- a/portal-kernel/src/com/liferay/portal/kernel/util/InetAddressUtil.java
+++ b/portal-kernel/src/com/liferay/portal/kernel/util/InetAddressUtil.java
@@ -14,7 +14,10 @@
package com.liferay.portal.kernel.util;
+import com.liferay.portal.kernel.concurrent.DefaultNoticeableFuture;
import com.liferay.portal.kernel.exception.SystemException;
+import com.liferay.portal.kernel.log.Log;
+import com.liferay.portal.kernel.log.LogFactoryUtil;
import java.net.Inet4Address;
import java.net.InetAddress;
@@ -22,13 +25,59 @@
import java.net.UnknownHostException;
import java.util.Enumeration;
+import java.util.concurrent.ExecutionException;
+import java.util.concurrent.TimeUnit;
+import java.util.concurrent.TimeoutException;
+import java.util.concurrent.atomic.AtomicInteger;
/\*\*
\* @author Michael C. Han
\* @author Shuyang Zhou
+ \* @author Marta Medio
\*/
public class InetAddressUtil {
+ public static InetAddress getInetAddressByName(String domain)
+ throws UnknownHostException {
+
+ AtomicInteger atomicInteger = new AtomicInteger(
+ \_DNS\_SECURITY\_THREAD\_LIMIT);
+
+ try {
+ if (atomicInteger.getAndDecrement() <= 0) {
+ \_log.error(
+ "Thread limit exceeded to resolve domain: " + domain);
+
+ return null;
+ }
+
+ DefaultNoticeableFuture defaultNoticeableFuture =
+ new DefaultNoticeableFuture<>(
+ () -> InetAddress.getByName(domain));
+
+ Thread thread = new Thread(
+ defaultNoticeableFuture, "InetAddressUtil");
+
+ thread.setDaemon(true);
+
+ thread.start();
+
+ return defaultNoticeableFuture.get(
+ \_DNS\_SECURITY\_ADDRESS\_TIMEOUT\_SECONDS, TimeUnit.SECONDS);
+ }
+ catch (ExecutionException | InterruptedException | TimeoutException e) {
+ if (\_log.isDebugEnabled()) {
+ \_log.debug(e, e);
+ }
+
+ throw new UnknownHostException(
+ "Unable to resolve domain: " + domain);
+ }
+ finally {
+ atomicInteger.incrementAndGet();
+ }
+ }
+
public static String getLocalHostName() throws Exception {
return LocalHostNameHolder.\_LOCAL\_HOST\_NAME;
}
@@ -74,6 +123,16 @@ public static boolean isLocalInetAddress(InetAddress inetAddress) {
return false;
}
+ private static final int \_DNS\_SECURITY\_ADDRESS\_TIMEOUT\_SECONDS =
+ GetterUtil.getInteger(
+ PropsUtil.get(PropsKeys.DNS\_SECURITY\_ADDRESS\_TIMEOUT\_SECONDS));
+
+ private static final int \_DNS\_SECURITY\_THREAD\_LIMIT = GetterUtil.getInteger(
+ PropsUtil.get(PropsKeys.DNS\_SECURITY\_THREAD\_LIMIT));
+
+ private static final Log \_log = LogFactoryUtil.getLog(
+ InetAddressUtil.class);
+
private static class LocalHostNameHolder {
private static final String \_LOCAL\_HOST\_NAME;
diff --git a/portal-kernel/src/com/liferay/portal/kernel/util/PropsKeys.java b/portal-kernel/src/com/liferay/portal/kernel/util/PropsKeys.java
index d0e246af839f3f..27d7fa27b6282a 100644
--- a/portal-kernel/src/com/liferay/portal/kernel/util/PropsKeys.java
+++ b/portal-kernel/src/com/liferay/portal/kernel/util/PropsKeys.java
@@ -38,6 +38,12 @@ public interface PropsKeys {
public static final String ADMIN\_EMAIL\_FROM\_NAME = "admin.email.from.name";
+ public static final String ADMIN\_EMAIL\_PASSWORD\_CHANGED\_BODY =
+ "admin.email.password.changed.body";
+
+ public static final String ADMIN\_EMAIL\_PASSWORD\_CHANGED\_SUBJECT =
+ "admin.email.password.changed.subject";
+
public static final String ADMIN\_EMAIL\_PASSWORD\_RESET\_BODY =
"admin.email.password.reset.body";
@@ -59,6 +65,9 @@ public interface PropsKeys {
public static final String ADMIN\_EMAIL\_USER\_ADDED\_NO\_PASSWORD\_BODY =
"admin.email.user.added.no.password.body";
+ public static final String ADMIN\_EMAIL\_USER\_ADDED\_RESET\_PASSWORD\_BODY =
+ "admin.email.user.added.reset.password.body";
+
public static final String ADMIN\_EMAIL\_USER\_ADDED\_SUBJECT =
"admin.email.user.added.subject";
@@ -1175,6 +1184,12 @@ public interface PropsKeys {
public static final String DL\_WEBDAV\_SUBSTITUTION\_CHAR =
"dl.webdav.substitution.char";
+ public static final String DNS\_SECURITY\_ADDRESS\_TIMEOUT\_SECONDS =
+ "dns.security.address.timeout.seconds";
+
+ public static final String DNS\_SECURITY\_THREAD\_LIMIT =
+ "dns.security.thread.limit";
+
public static final String DYNAMIC\_RESOURCE\_SERVLET\_ALLOWED\_PATHS =
"dynamic.resource.servlet.allowed.paths";
@@ -1656,6 +1671,10 @@ public interface PropsKeys {
public static final String JSONWS\_WEB\_SERVICE\_INVALID\_HTTP\_METHODS =
"jsonws.web.service.invalid.http.methods";
+ public static final String
+ JSONWS\_WEB\_SERVICE\_PARAMETER\_TYPE\_WHITELIST\_CLASS\_NAMES =
+ "jsonws.web.service.parameter.type.whitelist.class.names";
+
public static final String JSONWS\_WEB\_SERVICE\_PATHS\_EXCLUDES =
"jsonws.web.service.paths.excludes";
@@ -2184,6 +2203,9 @@ public interface PropsKeys {
public static final String MODULE\_FRAMEWORK\_DYNAMIC\_INSTALL\_START\_LEVEL =
"module.framework.dynamic.install.start.level";
+ public static final String MODULE\_FRAMEWORK\_EXPORT\_PASSWORD\_ATTRIBUTES =
+ "module.framework.export.password.attributes";
+
/\*\*
\* @deprecated As of Judson (7.1.x), with no direct replacement
\*/
diff --git a/portal-kernel/src/com/liferay/portal/kernel/workflow/WorkflowTaskManager.java b/portal-kernel/src/com/liferay/portal/kernel/workflow/WorkflowTaskManager.java
index 7c8212187d09cd..6c638426a392d2 100644
--- a/portal-kernel/src/com/liferay/portal/kernel/workflow/WorkflowTaskManager.java
+++ b/portal-kernel/src/com/liferay/portal/kernel/workflow/WorkflowTaskManager.java
@@ -87,6 +87,11 @@ public int getWorkflowTaskCountByUserRoles(
long companyId, long userId, Boolean completed)
throws WorkflowException;
+ public int getWorkflowTaskCountByUserRoles(
+ long companyId, long userId, long workflowInstanceId,
+ Boolean completed)
+ throws WorkflowException;
+
public int getWorkflowTaskCountByWorkflowInstance(
long companyId, Long userId, long workflowInstanceId,
Boolean completed)
diff --git a/portal-kernel/src/com/liferay/portal/kernel/workflow/WorkflowTaskManagerUtil.java b/portal-kernel/src/com/liferay/portal/kernel/workflow/WorkflowTaskManagerUtil.java
index 5eb63bac1ae293..7974df52203ba8 100644
--- a/portal-kernel/src/com/liferay/portal/kernel/workflow/WorkflowTaskManagerUtil.java
+++ b/portal-kernel/src/com/liferay/portal/kernel/workflow/WorkflowTaskManagerUtil.java
@@ -134,6 +134,15 @@ public static int getWorkflowTaskCountByUserRoles(
companyId, userId, completed);
}
+ public static int getWorkflowTaskCountByUserRoles(
+ long companyId, long userId, long workflowInstanceId,
+ Boolean completed)
+ throws WorkflowException {
+
+ return getWorkflowTaskManager().getWorkflowTaskCountByUserRoles(
+ companyId, userId, workflowInstanceId, completed);
+ }
+
public static int getWorkflowTaskCountByWorkflowInstance(
long companyId, Long userId, long workflowInstanceId,
Boolean completed)
diff --git a/portal-web/docroot/html/common/themes/top\_js.jspf b/portal-web/docroot/html/common/themes/top\_js.jspf
index 74e89b4041fc00..458af09d3830b0 100644
--- a/portal-web/docroot/html/common/themes/top\_js.jspf
+++ b/portal-web/docroot/html/common/themes/top\_js.jspf
@@ -269,13 +269,13 @@
return '<%= HtmlUtil.escapeJS(themeDisplay.getURLHome()) %>';
},
getUserEmailAddress: function() {
- return '<%= themeDisplay.isSignedIn() ? user.getEmailAddress() : StringPool.BLANK %>';
+ return '<%= themeDisplay.isSignedIn() ? HtmlUtil.escapeJS(user.getEmailAddress()) : StringPool.BLANK %>';
},
getUserId: function() {
return '<%= themeDisplay.getUserId() %>';
},
getUserName: function() {
- return '<%= themeDisplay.isSignedIn() ? UnicodeFormatter.toString(user.getFullName()) : StringPool.BLANK %>';
+ return '<%= themeDisplay.isSignedIn() ? HtmlUtil.escapeJS(UnicodeFormatter.toString(user.getFullName())) : StringPool.BLANK %>';
},
isAddSessionIdToURL: function() {
return <%= themeDisplay.isAddSessionIdToURL() %>;
diff --git a/portal-web/docroot/html/taglib/ui/breadcrumb/page.jsp b/portal-web/docroot/html/taglib/ui/breadcrumb/page.jsp
index 31c61a32bd3180..c9edc862588626 100644
--- a/portal-web/docroot/html/taglib/ui/breadcrumb/page.jsp
+++ b/portal-web/docroot/html/taglib/ui/breadcrumb/page.jsp
@@ -16,7 +16,7 @@
<%@ include file="/html/taglib/ui/breadcrumb/init.jsp" %>
-
+
<%
diff --git a/sql/build-parent.xml b/sql/build-parent.xml
index 45e1ed0844eae0..d5aa3794c3ef97 100644
--- a/sql/build-parent.xml
+++ b/sql/build-parent.xml
@@ -108,6 +108,8 @@

+
+

From 20e6facdf5f1c16cc292b47315436d1731be6608 Mon Sep 17 00:00:00 2001
From: Samuel Kong
Date: Wed, 18 Mar 2020 11:52:02 +0800
Subject: [PATCH 2/7] Update README
---
README.markdown | 10 ++++++++--
1 file changed, 8 insertions(+), 2 deletions(-)
diff --git a/README.markdown b/README.markdown
index 00f7821c4daa89..b5708fca65bbce 100644
--- a/README.markdown
+++ b/README.markdown
@@ -1,8 +1,14 @@
# Information
-This fork provides security patches for Liferay Portal. For more information about security in Liferay Portal, please see [https://portal.liferay.dev/learn/security](https://portal.liferay.dev/learn/security).
+This fork provides security patches for Liferay Portal 7.1.3. For more
+information about security in Liferay Portal, please see
+[https://portal.liferay.dev/learn/security](https://portal.liferay.dev/learn/security).
-The [March 2020](https://github.com/--link-to-the-diff-patch--) release contains fixes for the following issues:
+\*\*Cumulative diff patch:\*\*
+[https://github.com/community-security-team/liferay-portal/compare/7.1.3-ga4...7.1.3-cumulative.patch](https://github.com/community-security-team/liferay-portal/compare/7.1.3-ga4...7.1.3-cumulative.patch)
+
+The [March 2020](https://github.com/community-security-team/liferay-portal/commit/94535daf406162f259fccceff14357cf91513078)
+release contains fixes for the following issues:
[CST-7132](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/117954449),
[CST-7133](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118080791),
[CST-7135](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118080894),
From afda58bf8a7b6c6cc840646d756e90cf01639b35 Mon Sep 17 00:00:00 2001
From: yxingwu
Date: Fri, 5 Jun 2020 17:31:33 +0800
Subject: [PATCH 3/7] June 2020
---
README.markdown | 42 +-
lib/portal/dependencies.properties | 20 +-
lib/versions-complete.xml | 2 +-
lib/versions-ext.xml | 2 +-
lib/versions.html | 2 +-
.../servlet/filter/AMAuthVerifierFilter.java | 1 +
.../apio-architect-impl/build.gradle | 6 +-
.../internal/portlet/action/RSSAction.java | 147 ++++--
.../resources/js/scheduler\_event\_recorder.js | 2 +-
.../commerce-cart-taglib/build.gradle | 6 +-
.../commerce-frontend-impl/build.gradle | 6 +-
.../commerce-initializer-util/build.gradle | 6 +-
.../commerce-openapi-admin/build.gradle | 2 +-
.../commerce-openapi-core-impl/build.gradle | 6 +-
.../commerce-openapi-util/build.gradle | 6 +-
.../openapi/util/generator/build.gradle.tpl | 2 +-
.../build.gradle | 4 +-
.../build.gradle | 2 +-
.../build.gradle | 2 +-
.../build.gradle | 2 +-
.../build.gradle | 2 +-
.../build.gradle | 2 +-
.../build.gradle | 2 +-
.../DataProviderConfigurationCategory.java} | 24 +-
.../resources/content/Language.properties | 1 +
.../resources/content/Language\_ar.properties | 1 +
.../resources/content/Language\_bg.properties | 1 +
.../resources/content/Language\_ca.properties | 1 +
.../resources/content/Language\_cs.properties | 1 +
.../resources/content/Language\_da.properties | 1 +
.../resources/content/Language\_de.properties | 2 +-
.../resources/content/Language\_el.properties | 1 +
.../resources/content/Language\_en.properties | 1 +
.../resources/content/Language\_es.properties | 1 +
.../resources/content/Language\_et.properties | 1 +
.../resources/content/Language\_eu.properties | 1 +
.../resources/content/Language\_fa.properties | 1 +
.../resources/content/Language\_fi.properties | 2 +-
.../resources/content/Language\_fr.properties | 2 +-
.../resources/content/Language\_gl.properties | 1 +
.../content/Language\_hi\_IN.properties | 1 +
.../resources/content/Language\_hr.properties | 1 +
.../resources/content/Language\_hu.properties | 2 +-
.../resources/content/Language\_in.properties | 1 +
.../resources/content/Language\_it.properties | 1 +
.../resources/content/Language\_iw.properties | 2 +-
.../resources/content/Language\_ja.properties | 2 +-
.../resources/content/Language\_kk.properties | 80 +++
.../resources/content/Language\_ko.properties | 1 +
.../resources/content/Language\_lo.properties | 1 +
.../resources/content/Language\_lt.properties | 1 +
.../resources/content/Language\_nb.properties | 1 +
.../resources/content/Language\_nl.properties | 2 +-
.../content/Language\_nl\_BE.properties | 1 +
.../resources/content/Language\_pl.properties | 1 +
.../content/Language\_pt\_BR.properties | 2 +-
.../content/Language\_pt\_PT.properties | 1 +
.../resources/content/Language\_ro.properties | 1 +
.../resources/content/Language\_ru.properties | 1 +
.../resources/content/Language\_sk.properties | 1 +
.../resources/content/Language\_sl.properties | 1 +
.../content/Language\_sr\_RS.properties | 1 +
.../content/Language\_sr\_RS\_latin.properties | 1 +
.../resources/content/Language\_sv.properties | 1 +
.../resources/content/Language\_th.properties | 1 +
.../resources/content/Language\_tr.properties | 1 +
.../resources/content/Language\_uk.properties | 1 +
.../resources/content/Language\_vi.properties | 1 +
.../content/Language\_zh\_CN.properties | 1 +
.../content/Language\_zh\_TW.properties | 1 +
.../internal/util/DLValidatorImpl.java | 17 +-
.../internal/util/DLValidatorImplTest.java | 91 ++++
.../display/context/logic/UIItemsBuilder.java | 19 +-
.../document\_library/search\_resources.jsp | 2 +-
.../dynamic-data-lists-web/build.gradle | 2 +-
.../DDLDisplayTemplateTransformer.java | 16 +-
.../dynamic-data-mapping-api/bnd.bnd | 1 +
.../DDMDataProviderConfiguration.java | 41 ++
.../DataProviderInstanceURLException.java | 42 ++
.../data/provider/configuration/packageinfo | 1 +
.../build.gradle | 3 +-
.../AddDataProviderMVCActionCommand.java | 19 +-
.../META-INF/resources/edit\_data\_provider.jsp | 2 +
.../META-INF/resources/exceptions.jspf | 17 +
.../resources/META-INF/resources/init.jsp | 1 +
...ceParameterSettingsAuthVerifierFilter.java | 1 +
...taProviderInstancesAuthVerifierFilter.java | 1 +
...MFieldSetDefinitionAuthVerifierFilter.java | 1 +
...tingsDDMFormContextAuthVerifierFilter.java | 1 +
.../DDMFormFunctionsAuthVerifierFilter.java | 1 +
.../filter/RolesAuthVerifierFilter.java | 1 +
...FormContextProviderAuthVerifierFilter.java | 1 +
.../resources/content/Language.properties | 4 +
.../resources/content/Language\_ar.properties | 4 +
.../resources/content/Language\_bg.properties | 4 +
.../resources/content/Language\_ca.properties | 4 +
.../resources/content/Language\_cs.properties | 4 +
.../resources/content/Language\_da.properties | 4 +
.../resources/content/Language\_de.properties | 4 +
.../resources/content/Language\_el.properties | 4 +
.../resources/content/Language\_en.properties | 4 +
.../resources/content/Language\_es.properties | 4 +
.../resources/content/Language\_et.properties | 4 +
.../resources/content/Language\_eu.properties | 4 +
.../resources/content/Language\_fa.properties | 4 +
.../resources/content/Language\_fi.properties | 4 +
.../resources/content/Language\_fr.properties | 4 +
.../resources/content/Language\_gl.properties | 4 +
.../content/Language\_hi\_IN.properties | 4 +
.../resources/content/Language\_hr.properties | 4 +
.../resources/content/Language\_hu.properties | 4 +
.../resources/content/Language\_in.properties | 4 +
.../resources/content/Language\_it.properties | 4 +
.../resources/content/Language\_iw.properties | 4 +
.../resources/content/Language\_ja.properties | 4 +
.../resources/content/Language\_kk.properties | 4 +
.../resources/content/Language\_ko.properties | 4 +
.../resources/content/Language\_lo.properties | 4 +
.../resources/content/Language\_lt.properties | 4 +
.../resources/content/Language\_nb.properties | 4 +
.../resources/content/Language\_nl.properties | 4 +
.../content/Language\_nl\_BE.properties | 4 +
.../resources/content/Language\_pl.properties | 4 +
.../content/Language\_pt\_BR.properties | 4 +
.../content/Language\_pt\_PT.properties | 4 +
.../resources/content/Language\_ro.properties | 4 +
.../resources/content/Language\_ru.properties | 4 +
.../resources/content/Language\_sk.properties | 4 +
.../resources/content/Language\_sl.properties | 4 +
.../content/Language\_sr\_RS.properties | 4 +
.../content/Language\_sr\_RS\_latin.properties | 4 +
.../resources/content/Language\_sv.properties | 4 +
.../resources/content/Language\_th.properties | 4 +
.../resources/content/Language\_tr.properties | 4 +
.../resources/content/Language\_uk.properties | 4 +
.../resources/content/Language\_vi.properties | 4 +
.../content/Language\_zh\_CN.properties | 4 +
.../content/Language\_zh\_TW.properties | 4 +
.../dynamic-data-mapping-service/build.gradle | 7 +-
.../dynamic-data-mapping-service/service.xml | 1 +
...DDMDataProviderConfigurationActivator.java | 50 ++
.../DDMFormFieldFreeMarkerRenderer.java | 149 +++---
...MDataProviderInstanceLocalServiceImpl.java | 72 +++
.../DDMDataProviderInstanceServiceImpl.java | 97 +++-
.../PortletExportControllerImpl.java | 47 +-
.../flags/service/FlagsEntryService.java | 2 +
.../FlagsRequestMessageListener.java | 7 +-
.../service/impl/FlagsEntryServiceImpl.java | 3 +
.../FragmentCollectionLocalServiceImpl.java | 7 +
.../impl/FragmentEntryLocalServiceImpl.java | 7 +
.../ImageEditorDLDisplayContextHelper.java | 11 +-
.../apps/journal/journal-service/build.gradle | 2 +-
.../transformer/JournalTransformer.java | 12 +-
.../journal/util/impl/JournalUtil.java | 8 +-
.../build.gradle | 6 +-
modules/apps/polls/polls-web/build.gradle | 4 +-
.../portal/cache/BasePortalCacheManager.java | 16 -
.../cache/PortalCacheBootstrapLoader.java | 2 +
.../PortalCacheBootstrapLoaderFactory.java | 2 +
.../PortalCacheConfiguration.java | 20 +-
.../EhcachePortalCacheConfiguration.java | 8 +-
.../MultiVMEhcachePortalCacheManager.java | 9 -
...EhcachePortalCacheManagerConfigurator.java | 2 -
...EhcachePortalCacheManagerConfigurator.java | 46 --
.../ClusterLinkBootstrapLoaderHelperUtil.java | 472 ------------------
...ClusterLinkPortalCacheBootstrapLoader.java | 133 -----
.../portal-odata-impl/build.gradle | 2 +-
.../build.gradle | 2 +-
.../resources/search/results/view.jsp | 2 +-
.../META-INF/resources/user/facet/view.jsp | 2 +-
.../build.gradle | 2 +-
.../build.gradle | 4 +-
...ssionAuthVerifierConfiguration-default.cfg | 1 +
.../session/PortalSessionAuthVerifier.java | 39 +-
.../PortalSessionAuthVerifierPublisher.java | 16 +
...ortalSessionAuthVerifierConfiguration.java | 4 +
.../resources/content/Language.properties | 1 +
.../resources/content/Language\_ar.properties | 1 +
.../resources/content/Language\_bg.properties | 1 +
.../resources/content/Language\_ca.properties | 1 +
.../resources/content/Language\_cs.properties | 1 +
.../resources/content/Language\_da.properties | 1 +
.../resources/content/Language\_de.properties | 1 +
.../resources/content/Language\_el.properties | 1 +
.../resources/content/Language\_en.properties | 1 +
.../resources/content/Language\_es.properties | 1 +
.../resources/content/Language\_et.properties | 1 +
.../resources/content/Language\_eu.properties | 1 +
.../resources/content/Language\_fa.properties | 1 +
.../resources/content/Language\_fi.properties | 1 +
.../resources/content/Language\_fr.properties | 1 +
.../resources/content/Language\_gl.properties | 1 +
.../content/Language\_hi\_IN.properties | 1 +
.../resources/content/Language\_hr.properties | 1 +
.../resources/content/Language\_hu.properties | 1 +
.../resources/content/Language\_in.properties | 1 +
.../resources/content/Language\_it.properties | 1 +
.../resources/content/Language\_iw.properties | 1 +
.../resources/content/Language\_ja.properties | 1 +
.../resources/content/Language\_kk.properties | 9 +
.../resources/content/Language\_ko.properties | 1 +
.../resources/content/Language\_lo.properties | 1 +
.../resources/content/Language\_lt.properties | 1 +
.../resources/content/Language\_nb.properties | 1 +
.../resources/content/Language\_nl.properties | 1 +
.../content/Language\_nl\_BE.properties | 1 +
.../resources/content/Language\_pl.properties | 1 +
.../content/Language\_pt\_BR.properties | 1 +
.../content/Language\_pt\_PT.properties | 1 +
.../resources/content/Language\_ro.properties | 1 +
.../resources/content/Language\_ru.properties | 1 +
.../resources/content/Language\_sk.properties | 1 +
.../resources/content/Language\_sl.properties | 1 +
.../content/Language\_sr\_RS.properties | 1 +
.../content/Language\_sr\_RS\_latin.properties | 1 +
.../resources/content/Language\_sv.properties | 1 +
.../resources/content/Language\_th.properties | 1 +
.../resources/content/Language\_tr.properties | 1 +
.../resources/content/Language\_uk.properties | 1 +
.../resources/content/Language\_vi.properties | 1 +
.../content/Language\_zh\_CN.properties | 1 +
.../content/Language\_zh\_TW.properties | 1 +
...ngsTestLDAPConnectionMVCRenderCommand.java | 42 ++
...ettingsTestLDAPGroupsMVCRenderCommand.java | 42 ++
...SettingsTestLDAPUsersMVCRenderCommand.java | 42 ++
.../edit\_ldap\_server.jsp | 4 +-
.../com.liferay.portal.settings.web/init.jsp | 1 +
.../portal-store/portal-store-s3/build.gradle | 6 +-
.../portal-template-freemarker/build.gradle | 2 +-
.../FreeMarkerEngineConfiguration.java | 2 +-
.../internal/FreeMarkerManager.java | 162 ++++--
.../internal/FreeMarkerTemplate.java | 55 +-
.../FreeMarkerTemplateContextHelper.java | 23 +-
...java => LiferayFreeMarkerStringModel.java} | 13 +-
.../internal/LiferayObjectConstructor.java | 12 +-
.../internal/LiferayObjectWrapper.java | 237 +--------
.../RestrictedLiferayObjectWrapper.java | 254 ++++++++++
.../internal/FreeMarkerTemplateTest.java | 12 +
.../RestrictedLiferayObjectWrapperTest.java | 311 ++++++++++++
.../portal-template-soy-impl/build.gradle | 2 +-
.../template/soy/internal/SoyManager.java | 12 +-
.../template/soy/internal/SoyTemplate.java | 5 +-
.../portal-template-velocity/build.gradle | 2 +-
.../VelocityEngineConfiguration.java | 4 +-
.../internal/LiferaySecureUberspector.java | 6 +-
.../RestrictedTemplateThreadLocal.java | 37 ++
.../velocity/internal/VelocityManager.java | 29 +-
.../velocity/internal/VelocityTemplate.java | 35 +-
.../VelocityTemplateContextHelper.java | 2 +-
.../template/xsl/internal/XSLTemplate.java | 7 +
.../portal-vulcan-api/build.gradle | 6 +-
.../portal-vulcan-impl/build.gradle | 6 +-
.../build.gradle | 2 +-
.../internal/PortletDisplayTemplateImpl.java | 72 ++-
.../build.gradle | 6 +-
.../apps/server/server-admin-web/build.gradle | 4 +-
.../META-INF/resources/configuration.jsp | 2 +-
.../resources/process\_summary\_link/page.jsp | 2 +-
...nmentsManagementToolbarDisplayContext.java | 4 +
.../resources/edit\_user\_group\_assignments.jsp | 16 +-
.../DefaultWikiListPagesDisplayContext.java | 2 +-
modules/source-formatter.properties | 6 +-
.../util/RuntimePageImpl.java | 173 ++++---
.../model/impl/LayoutTypePortletImpl.java | 21 +-
.../AbstractMultiResourceTemplate.java | 19 +-
.../AbstractSingleResourceTemplate.java | 20 +-
.../portal/template/AbstractTemplate.java | 42 ++
.../portal/template/BaseTemplateManager.java | 28 ++
.../template/PrivilegedTemplateWrapper.java | 9 +
.../portal/template/RestrictedTemplate.java | 13 +-
.../template/TemplateContextHelper.java | 11 +-
.../portal/templateparser/Transformer.java | 9 +-
.../src/com/liferay/portal/util/HttpImpl.java | 122 ++---
.../com/liferay/portal/util/PortalImpl.java | 34 +-
.../portal/verify/VerifyProperties.java | 3 +
.../portal/webserver/WebServerEntry.java | 20 +
.../portal/webserver/WebServerServlet.java | 6 -
.../webserver/dependencies/template.ftl | 4 +-
portal-impl/src/portal.properties | 25 +-
.../templatemanagerutil/TestTemplate.java | 7 +
.../test-multi-ehcache-config.xml | 2 -
.../portal/kernel/template/Template.java | 8 +
.../kernel/template/TemplateManager.java | 28 ++
.../liferay/portal/kernel/util/PropsKeys.java | 12 +
.../docroot/html/common/themes/top\_js.jspf | 2 +-
.../taglib/ui/page\_iterator/lexicon/start.jsp | 8 +-
.../html/taglib/ui/page\_iterator/start.jsp | 6 +-
.../ClusteringMissingPlugins.testcase | 5 +-
...rmatter-api-signature-check-exceptions.txt | 2 +-
.../bridges/freemarker/FreeMarkerPortlet.java | 9 +-
.../src/com/liferay/taglib/aui/ATag.java | 2 +-
.../src/com/liferay/taglib/ui/IconTag.java | 10 +-
.../com/liferay/taglib/util/ThemeUtil.java | 119 ++---
293 files changed, 2834 insertions(+), 1660 deletions(-)
rename modules/apps/{portal-cache/portal-cache-multiple/src/main/java/com/liferay/portal/cache/multiple/internal/bootstrap/ClusterLinkPortalCacheBootstrapLoaderFactory.java => configuration-admin/configuration-admin-web/src/main/java/com/liferay/configuration/admin/web/internal/category/DataProviderConfigurationCategory.java} (54%)
create mode 100644 modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_kk.properties
create mode 100644 modules/apps/document-library/document-library-service/src/test/java/com/liferay/document/library/internal/util/DLValidatorImplTest.java
create mode 100644 modules/apps/dynamic-data-mapping/dynamic-data-mapping-api/src/main/java/com/liferay/dynamic/data/mapping/data/provider/configuration/DDMDataProviderConfiguration.java
create mode 100644 modules/apps/dynamic-data-mapping/dynamic-data-mapping-api/src/main/java/com/liferay/dynamic/data/mapping/exception/DataProviderInstanceURLException.java
create mode 100644 modules/apps/dynamic-data-mapping/dynamic-data-mapping-api/src/main/resources/com/liferay/dynamic/data/mapping/data/provider/configuration/packageinfo
create mode 100644 modules/apps/dynamic-data-mapping/dynamic-data-mapping-data-provider-web/src/main/resources/META-INF/resources/exceptions.jspf
create mode 100644 modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/src/main/java/com/liferay/dynamic/data/mapping/internal/data/provider/configuration/activator/DDMDataProviderConfigurationActivator.java
delete mode 100644 modules/apps/portal-cache/portal-cache-multiple/src/main/java/com/liferay/portal/cache/multiple/internal/bootstrap/ClusterLinkBootstrapLoaderHelperUtil.java
delete mode 100644 modules/apps/portal-cache/portal-cache-multiple/src/main/java/com/liferay/portal/cache/multiple/internal/bootstrap/ClusterLinkPortalCacheBootstrapLoader.java
create mode 100644 modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_kk.properties
rename modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/{LiferayFreeMarkerBeanModel.java => LiferayFreeMarkerStringModel.java} (81%)
create mode 100644 modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/RestrictedLiferayObjectWrapper.java
create mode 100644 modules/apps/portal-template/portal-template-freemarker/src/test/java/com/liferay/portal/template/freemarker/internal/RestrictedLiferayObjectWrapperTest.java
create mode 100644 modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/RestrictedTemplateThreadLocal.java
diff --git a/README.markdown b/README.markdown
index b5708fca65bbce..eb12e8273dc3ea 100644
--- a/README.markdown
+++ b/README.markdown
@@ -7,33 +7,23 @@ information about security in Liferay Portal, please see
\*\*Cumulative diff patch:\*\*
[https://github.com/community-security-team/liferay-portal/compare/7.1.3-ga4...7.1.3-cumulative.patch](https://github.com/community-security-team/liferay-portal/compare/7.1.3-ga4...7.1.3-cumulative.patch)
-The [March 2020](https://github.com/community-security-team/liferay-portal/commit/94535daf406162f259fccceff14357cf91513078)
+The [June 2020](https://github.com/community-security-team/liferay-portal/commit/94535daf406162f259fccceff14357cf91513078)
release contains fixes for the following issues:
-[CST-7132](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/117954449),
-[CST-7133](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118080791),
-[CST-7135](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118080894),
-[CST-7136](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118080942),
-[CST-7137](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118080955),
-[CST-7138](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118080994),
-[CST-7139](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118081013),
-[CST-7140](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118081026),
-[CST-7141](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118081039),
-[CST-7142](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118081059),
-[CST-7143](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118081072),
-[CST-7144](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118664243),
-[CST-7145](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118670963),
-[CST-7146](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118671025),
-[CST-7147](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118675447),
-[CST-7148](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118675457),
-[CST-7149](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118762169),
-[CST-7204](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/117954240),
-[CST-7205](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/117954271),
-[CST-7206](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/117954284),
-[CST-7208](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/117954394),
-[CST-7209](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/117954421),
-[CST-7210](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/117954436),
-[CST-7211](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118664044),
-[CST-7212](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118670924)
+[CST-7150](),
+[CST-7213](),
+[CST-7214](),
+[CST-7215](),
+[CST-7216](),
+[CST-7217](),
+[CST-7218](),
+[CST-7219](),
+[CST-7220](),
+[CST-7221](),
+[CST-7222](),
+[CST-7223](),
+[CST-7301](),
+[CST-7302](),
+[CST-7303]()
# Liferay Portal Community Edition License
diff --git a/lib/portal/dependencies.properties b/lib/portal/dependencies.properties
index 28858c70d5f2a6..45aec6eaff9938 100644
--- a/lib/portal/dependencies.properties
+++ b/lib/portal/dependencies.properties
@@ -13,11 +13,11 @@ aspectj-rt=org.aspectj:aspectjrt:1.8.13
aspectj-weaver=org.aspectj:aspectjweaver:1.8.13
axis-ant=org.apache.axis:axis-ant:1.4
axis=com.liferay:org.apache.axis:1.4.LIFERAY-PATCHED-3
-bcmail=org.bouncycastle:bcmail-jdk16:1.45
-bcprov=org.bouncycastle:bcprov-jdk16:1.45
+bcmail=org.bouncycastle:bcmail-jdk15on:1.61
+bcprov=org.bouncycastle:bcprov-jdk15on:1.61
boilerpipe=com.liferay:de.l3s.boilerpipe:1.1.0.LIFERAY-PATCHED-1
bsf=bsf:bsf:2.4.0
-c3p0=com.mchange:c3p0:0.9.5.3
+c3p0=com.mchange:c3p0:0.9.5.4
ccpp-ri=com.liferay:javax.ccpp.ccpp-ri:1.0
ccpp=javax.ccpp:ccpp:1.0
cglib-nodep=cglib:cglib-nodep:2.2.2
@@ -33,7 +33,7 @@ commons-chain=commons-chain:commons-chain:1.2
commons-codec=commons-codec:commons-codec:1.9
commons-collections4=org.apache.commons:commons-collections4:4.2
commons-collections=commons-collections:commons-collections:3.2.2
-commons-compress=org.apache.commons:commons-compress:1.18
+commons-compress=org.apache.commons:commons-compress:1.19
commons-configuration=commons-configuration:commons-configuration:1.10
commons-dbcp=commons-dbcp:commons-dbcp:1.2.2
commons-digester=commons-digester:commons-digester:1.8.1
@@ -71,9 +71,9 @@ ical4j=net.fortuna.ical4j:ical4j:1.0-rc3
im4java=org.im4java:im4java:1.2.0
isoparser=com.googlecode.mp4parser:isoparser:1.1.22
jabsorb=com.liferay:org.jabsorb:1.3.2.LIFERAY-PATCHED-1
-jackson-annotations=com.fasterxml.jackson.core:jackson-annotations:2.9.9
-jackson-core=com.fasterxml.jackson.core:jackson-core:2.9.9
-jackson-databind=com.fasterxml.jackson.core:jackson-databind:2.9.9.3
+jackson-annotations=com.fasterxml.jackson.core:jackson-annotations:2.9.10
+jackson-core=com.fasterxml.jackson.core:jackson-core:2.9.10
+jackson-databind=com.fasterxml.jackson.core:jackson-databind:2.9.10.1
jai\_codec=com.sun.media:jai-codec:1.1.3
jai\_core=com.sun:jai\_core:1.1.3
jakarta-regexp=com.liferay:org.apache.regexp:1.5
@@ -90,13 +90,13 @@ jaxws-rt=com.sun.xml.ws:jaxws-rt:2.1.7
jazzy=net.sf.jazzy:jazzy:0.5.2-rtext-1.4.1-2
jcifs=org.samba.jcifs:jcifs:1.3.14-kohsuke-1
jcl-over-slf4j=org.slf4j:jcl-over-slf4j:1.7.2
-jcommon=jfree:jcommon:1.0.16
+jcommon=org.jfree:jcommon:1.0.24
jdom=org.jopendocument:jdom:1.1.1
jempbox=org.apache.pdfbox:jempbox:1.8.16
jena=com.liferay:com.hp.hpl.jena:1.4
jericho-html=net.htmlparser.jericho:jericho-html:3.1
jersey-common=org.glassfish.jersey.core:jersey-common:2.26
-jfreechart=jfree:jfreechart:1.0.13
+jfreechart=org.jfree:jfreechart:1.0.19
jhighlight=com.uwyn:jhighlight:1.0
jhlabs-filters=com.jhlabs:imaging:01012005
jmatio=org.tallison:jmatio:1.2
@@ -131,7 +131,7 @@ mimepull=org.jvnet:mimepull:1.3
monte-cc=com.liferay:org.monte:0.7.7
nekohtml=net.sourceforge.nekohtml:nekohtml:1.9.22
netcdf=edu.ucar:netcdf:4.3.23
-netty-all=io.netty:netty-all:4.1.32.Final
+netty-all=io.netty:netty-all:4.1.42.Final
odmg=odmg:odmg:3.0
oro=oro:oro:2.0.8
pdfbox=org.apache.pdfbox:pdfbox:2.0.13
diff --git a/lib/versions-complete.xml b/lib/versions-complete.xml
index 6e225078af6142..6374aaeaef7eee 100644
--- a/lib/versions-complete.xml
+++ b/lib/versions-complete.xml
@@ -6289,7 +6289,7 @@

lib/portal/commons-compress.jar
- 1.18
+ 1.19
Commons Compress
http://commons.apache.org/compress
diff --git a/lib/versions-ext.xml b/lib/versions-ext.xml
index 1eb2121e8e0617..2913c9f2acaf23 100644
--- a/lib/versions-ext.xml
+++ b/lib/versions-ext.xml
@@ -1390,7 +1390,7 @@

lib/portal/commons-compress.jar
- 1.18
+ 1.19
Commons Compress
http://commons.apache.org/compress
diff --git a/lib/versions.html b/lib/versions.html
index 9e5726b6388022..64843327b19635 100644
--- a/lib/versions.html
+++ b/lib/versions.html
@@ -2754,7 +2754,7 @@  ||- lib/portal/commons-compress.jar | 1.18 | [Commons Compress](http://commons.apache.org/compress) | [Apache License 2.0](http://www.apache.org/licenses/LICENSE-2.0) + lib/portal/commons-compress.jar | 1.19 | [Commons Compress](http://commons.apache.org/compress) | [Apache License 2.0](http://www.apache.org/licenses/LICENSE-2.0) |  | |
diff --git a/modules/apps/adaptive-media/adaptive-media-web/src/main/java/com/liferay/adaptive/media/web/internal/servlet/filter/AMAuthVerifierFilter.java b/modules/apps/adaptive-media/adaptive-media-web/src/main/java/com/liferay/adaptive/media/web/internal/servlet/filter/AMAuthVerifierFilter.java
index 01905cbc81aa7f..1eca94c83437f4 100644
--- a/modules/apps/adaptive-media/adaptive-media-web/src/main/java/com/liferay/adaptive/media/web/internal/servlet/filter/AMAuthVerifierFilter.java
+++ b/modules/apps/adaptive-media/adaptive-media-web/src/main/java/com/liferay/adaptive/media/web/internal/servlet/filter/AMAuthVerifierFilter.java
@@ -27,6 +27,7 @@
@Component(
immediate = true,
property = {
+ "filter.init.auth.verifier.PortalSessionAuthVerifier.check.csrf.token=false",
"filter.init.auth.verifier.PortalSessionAuthVerifier.urls.includes=/" + AMWebConstants.SERVLET\_PATH + "/\*",
"osgi.http.whiteboard.filter.name=com.liferay.adaptive.media.web.internal.servlet.filter.AMAuthVerifierFilter",
"osgi.http.whiteboard.filter.pattern=/" + AMWebConstants.SERVLET\_PATH + "/\*"
diff --git a/modules/apps/apio-architect/apio-architect-impl/build.gradle b/modules/apps/apio-architect/apio-architect-impl/build.gradle
index bb1e2491340d5d..cd821dbac292bd 100644
--- a/modules/apps/apio-architect/apio-architect-impl/build.gradle
+++ b/modules/apps/apio-architect/apio-architect-impl/build.gradle
@@ -1,7 +1,7 @@
dependencies {
- compileInclude group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.8"
- compileInclude group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.8"
- compileInclude group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.8"
+ compileInclude group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
+ compileInclude group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
+ compileInclude group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.10.1"
compileInclude group: "com.liferay", name: "com.liferay.osgi.felix.util", version: "2.0.0"
compileInclude group: "com.liferay", name: "com.liferay.osgi.service.tracker.collections", version: "3.0.1"
compileInclude group: "commons-fileupload", name: "commons-fileupload", version: "1.3.3"
diff --git a/modules/apps/blogs/blogs-web/src/main/java/com/liferay/blogs/web/internal/portlet/action/RSSAction.java b/modules/apps/blogs/blogs-web/src/main/java/com/liferay/blogs/web/internal/portlet/action/RSSAction.java
index f7a92792cf3119..428af1f117c960 100644
--- a/modules/apps/blogs/blogs-web/src/main/java/com/liferay/blogs/web/internal/portlet/action/RSSAction.java
+++ b/modules/apps/blogs/blogs-web/src/main/java/com/liferay/blogs/web/internal/portlet/action/RSSAction.java
@@ -17,23 +17,31 @@
import com.liferay.blogs.configuration.BlogsGroupServiceOverriddenConfiguration;
import com.liferay.blogs.constants.BlogsConstants;
import com.liferay.blogs.service.BlogsEntryService;
+import com.liferay.petra.string.StringBundler;
import com.liferay.petra.string.StringPool;
import com.liferay.portal.kernel.dao.search.SearchContainer;
-import com.liferay.portal.kernel.model.Layout;
-import com.liferay.portal.kernel.model.LayoutConstants;
+import com.liferay.portal.kernel.exception.PortalException;
import com.liferay.portal.kernel.module.configuration.ConfigurationProvider;
+import com.liferay.portal.kernel.security.permission.ActionKeys;
+import com.liferay.portal.kernel.service.permission.GroupPermissionUtil;
+import com.liferay.portal.kernel.servlet.ServletResponseUtil;
import com.liferay.portal.kernel.settings.GroupServiceSettingsLocator;
+import com.liferay.portal.kernel.struts.BaseStrutsAction;
import com.liferay.portal.kernel.struts.StrutsAction;
import com.liferay.portal.kernel.theme.ThemeDisplay;
+import com.liferay.portal.kernel.util.ContentTypes;
import com.liferay.portal.kernel.util.ParamUtil;
+import com.liferay.portal.kernel.util.Portal;
import com.liferay.portal.kernel.util.WebKeys;
import com.liferay.portal.kernel.workflow.WorkflowConstants;
-import com.liferay.portal.struts.BaseRSSStrutsAction;
import com.liferay.rss.util.RSSUtil;
+import java.nio.charset.StandardCharsets;
+
import java.util.Date;
import javax.servlet.http.HttpServletRequest;
+import javax.servlet.http.HttpServletResponse;
import org.osgi.service.component.annotations.Component;
import org.osgi.service.component.annotations.Reference;
@@ -44,21 +52,68 @@
@Component(
immediate = true, property = "path=/blogs/rss", service = StrutsAction.class
)
-public class RSSAction extends BaseRSSStrutsAction {
+public class RSSAction extends BaseStrutsAction {
@Override
- protected byte[] getRSS(HttpServletRequest request) throws Exception {
- ThemeDisplay themeDisplay = (ThemeDisplay)request.getAttribute(
- WebKeys.THEME\_DISPLAY);
+ public String execute(
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse)
+ throws Exception {
- Layout layout = themeDisplay.getLayout();
+ if (!\_isRSSFeedsEnabled(httpServletRequest) ||
+ !\_hasGroupViewPermission(httpServletRequest)) {
- long plid = ParamUtil.getLong(request, "plid");
+ \_portal.sendRSSFeedsDisabledError(
+ httpServletRequest, httpServletResponse);
- if (plid == LayoutConstants.DEFAULT\_PLID) {
- plid = themeDisplay.getPlid();
+ return null;
}
+ try {
+ ServletResponseUtil.sendFile(
+ httpServletRequest, httpServletResponse, null,
+ \_getRSS(httpServletRequest), ContentTypes.TEXT\_XML\_UTF8);
+
+ return null;
+ }
+ catch (Exception e) {
+ \_portal.sendError(e, httpServletRequest, httpServletResponse);
+
+ return null;
+ }
+ }
+
+ @Reference(unbind = "-")
+ protected void setBlogsEntryService(BlogsEntryService blogsEntryService) {
+ \_blogsEntryService = blogsEntryService;
+ }
+
+ @Reference(unbind = "-")
+ protected void setConfigurationProvider(
+ ConfigurationProvider configurationProvider) {
+
+ \_configurationProvider = configurationProvider;
+ }
+
+ private String \_getFindEntryURL(long plid, ThemeDisplay themeDisplay) {
+ if (plid == 0) {
+ return themeDisplay.getPortalURL() + themeDisplay.getPathMain() +
+ "/blogs/find\_entry?";
+ }
+
+ return StringBundler.concat(
+ themeDisplay.getPortalURL(), themeDisplay.getPathMain(),
+ "/blogs/find\_entry?p\_l\_id=", plid);
+ }
+
+ private String \_getFindEntryURL(ThemeDisplay themeDisplay) {
+ return \_getFindEntryURL(0, themeDisplay);
+ }
+
+ private byte[] \_getRSS(HttpServletRequest request) throws Exception {
+ ThemeDisplay themeDisplay = (ThemeDisplay)request.getAttribute(
+ WebKeys.THEME\_DISPLAY);
+
long companyId = ParamUtil.getLong(request, "companyId");
long groupId = ParamUtil.getLong(request, "groupId");
long organizationId = ParamUtil.getLong(request, "organizationId");
@@ -72,54 +127,67 @@ protected byte[] getRSS(HttpServletRequest request) throws Exception {
String displayStyle = ParamUtil.getString(
request, "displayStyle", RSSUtil.DISPLAY\_STYLE\_DEFAULT);
- String feedURL =
- themeDisplay.getPortalURL() + themeDisplay.getPathMain() +
- "/blogs/find\_entry?";
-
- String entryURL = feedURL;
-
String rss = StringPool.BLANK;
if (companyId > 0) {
- feedURL = StringPool.BLANK;
+ String entryURL = \_getFindEntryURL(themeDisplay);
rss = \_blogsEntryService.getCompanyEntriesRSS(
companyId, new Date(), status, max, type, version, displayStyle,
- feedURL, entryURL, themeDisplay);
+ StringPool.BLANK, entryURL, themeDisplay);
}
else if (groupId > 0) {
- feedURL += "p\_l\_id=" + plid;
+ long plid = ParamUtil.getLong(
+ request, "plid", themeDisplay.getPlid());
- entryURL = feedURL;
+ String feedURL = \_getFindEntryURL(plid, themeDisplay);
rss = \_blogsEntryService.getGroupEntriesRSS(
groupId, new Date(), status, max, type, version, displayStyle,
- feedURL, entryURL, themeDisplay);
+ feedURL, feedURL, themeDisplay);
}
else if (organizationId > 0) {
- feedURL = StringPool.BLANK;
+ String entryURL = \_getFindEntryURL(themeDisplay);
rss = \_blogsEntryService.getOrganizationEntriesRSS(
organizationId, new Date(), status, max, type, version,
- displayStyle, feedURL, entryURL, themeDisplay);
+ displayStyle, StringPool.BLANK, entryURL, themeDisplay);
}
- else if (layout != null) {
- groupId = themeDisplay.getScopeGroupId();
+ else if (themeDisplay.getLayout() != null) {
+ String feedURL = themeDisplay.getPathMain() + "/blogs/rss";
feedURL = themeDisplay.getPathMain() + "/blogs/rss";
- entryURL = feedURL;
-
rss = \_blogsEntryService.getGroupEntriesRSS(
groupId, new Date(), status, max, type, version, displayStyle,
- feedURL, entryURL, themeDisplay);
+ feedURL, feedURL, themeDisplay);
}
- return rss.getBytes(StringPool.UTF8);
+ return rss.getBytes(StandardCharsets.UTF\_8);
}
- @Override
- protected boolean isRSSFeedsEnabled(HttpServletRequest request)
+ private boolean \_hasGroupViewPermission(
+ HttpServletRequest httpServletRequest)
+ throws PortalException {
+
+ ThemeDisplay themeDisplay =
+ (ThemeDisplay)httpServletRequest.getAttribute(
+ WebKeys.THEME\_DISPLAY);
+
+ long groupId = ParamUtil.getLong(httpServletRequest, "groupId");
+
+ if ((groupId == 0) ||
+ GroupPermissionUtil.contains(
+ themeDisplay.getPermissionChecker(), groupId,
+ ActionKeys.VIEW)) {
+
+ return true;
+ }
+
+ return false;
+ }
+
+ private boolean \_isRSSFeedsEnabled(HttpServletRequest request)
throws Exception {
ThemeDisplay themeDisplay = (ThemeDisplay)request.getAttribute(
@@ -136,19 +204,10 @@ protected boolean isRSSFeedsEnabled(HttpServletRequest request)
return blogsGroupServiceOverriddenConfiguration.enableRss();
}
- @Reference(unbind = "-")
- protected void setBlogsEntryService(BlogsEntryService blogsEntryService) {
- \_blogsEntryService = blogsEntryService;
- }
-
- @Reference(unbind = "-")
- protected void setConfigurationProvider(
- ConfigurationProvider configurationProvider) {
-
- \_configurationProvider = configurationProvider;
- }
-
private BlogsEntryService \_blogsEntryService;
private ConfigurationProvider \_configurationProvider;
+ @Reference
+ private Portal \_portal;
+
}
\ No newline at end of file
diff --git a/modules/apps/calendar/calendar-web/src/main/resources/META-INF/resources/js/scheduler\_event\_recorder.js b/modules/apps/calendar/calendar-web/src/main/resources/META-INF/resources/js/scheduler\_event\_recorder.js
index 326a899ab9fee6..625c6f6cb241c3 100644
--- a/modules/apps/calendar/calendar-web/src/main/resources/META-INF/resources/js/scheduler\_event\_recorder.js
+++ b/modules/apps/calendar/calendar-web/src/main/resources/META-INF/resources/js/scheduler\_event\_recorder.js
@@ -580,7 +580,7 @@ AUI.add(
var values = calendarResources.map(
function(item) {
- return item.name;
+ return Lang.String.escapeHTML(item.name);
}
);
diff --git a/modules/apps/commerce/commerce-cart-taglib/build.gradle b/modules/apps/commerce/commerce-cart-taglib/build.gradle
index 39996ce89b6371..0fe202bf88b8b6 100644
--- a/modules/apps/commerce/commerce-cart-taglib/build.gradle
+++ b/modules/apps/commerce/commerce-cart-taglib/build.gradle
@@ -1,9 +1,9 @@
apply plugin: "com.liferay.lang.merger"
dependencies {
- compileInclude group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.8"
- compileInclude group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.8"
- compileInclude group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.8"
+ compileInclude group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
+ compileInclude group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
+ compileInclude group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.10.1"
compileOnly group: "com.liferay.commerce", name: "com.liferay.commerce.api", version: "7.1.0"
compileOnly group: "com.liferay.commerce", name: "com.liferay.commerce.currency.api", version: "1.0.0"
diff --git a/modules/apps/commerce/commerce-frontend-impl/build.gradle b/modules/apps/commerce/commerce-frontend-impl/build.gradle
index 573cb45f78a13c..5ec7e11c61af7a 100644
--- a/modules/apps/commerce/commerce-frontend-impl/build.gradle
+++ b/modules/apps/commerce/commerce-frontend-impl/build.gradle
@@ -1,9 +1,9 @@
apply plugin: "com.liferay.lang.merger"
dependencies {
- compileInclude group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.8"
- compileInclude group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.8"
- compileInclude group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.8"
+ compileInclude group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
+ compileInclude group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
+ compileInclude group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.10.1"
compileOnly group: "biz.aQute.bnd", name: "biz.aQute.bndlib", version: "3.1.0"
compileOnly group: "com.liferay.commerce", name: "com.liferay.commerce.account.api", version: "3.0.0"
diff --git a/modules/apps/commerce/commerce-initializer-util/build.gradle b/modules/apps/commerce/commerce-initializer-util/build.gradle
index 22aa02bc1f70d3..e9aef830f3ff50 100644
--- a/modules/apps/commerce/commerce-initializer-util/build.gradle
+++ b/modules/apps/commerce/commerce-initializer-util/build.gradle
@@ -1,7 +1,7 @@
dependencies {
- compileInclude group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.6"
- compileInclude group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.6"
- compileInclude group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.6"
+ compileInclude group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
+ compileInclude group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
+ compileInclude group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.10.1"
compileOnly group: "com.google.code.findbugs", name: "annotations", version: "3.0.1"
compileOnly group: "com.liferay", name: "com.liferay.dynamic.data.mapping.api", version: "4.1.0"
diff --git a/modules/apps/commerce/commerce-openapi-admin/build.gradle b/modules/apps/commerce/commerce-openapi-admin/build.gradle
index 8e762bc91b9fb8..1366df7f1e0103 100644
--- a/modules/apps/commerce/commerce-openapi-admin/build.gradle
+++ b/modules/apps/commerce/commerce-openapi-admin/build.gradle
@@ -1,6 +1,6 @@
dependencies {
compileOnly group: "biz.aQute.bnd", name: "biz.aQute.bndlib", version: "3.1.0"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.8"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
compileOnly group: "com.fasterxml.jackson.dataformat", name: "jackson-dataformat-xml", version: "2.9.8"
compileOnly group: "com.liferay.commerce", name: "com.liferay.commerce.account.api", version: "3.0.0"
compileOnly group: "com.liferay.commerce", name: "com.liferay.commerce.api", version: "7.1.0"
diff --git a/modules/apps/commerce/commerce-openapi-core-impl/build.gradle b/modules/apps/commerce/commerce-openapi-core-impl/build.gradle
index 41e866c27adb6e..d30da32e278d95 100644
--- a/modules/apps/commerce/commerce-openapi-core-impl/build.gradle
+++ b/modules/apps/commerce/commerce-openapi-core-impl/build.gradle
@@ -3,9 +3,9 @@ dependencies {
compileOnly group: "biz.aQute.bnd", name: "biz.aQute.bndlib", version: "3.1.0"
compileOnly group: "com.fasterxml", name: "aalto-xml", version: "0.9.10"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.8"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.8"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.8"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.10.1"
compileOnly group: "com.fasterxml.jackson.dataformat", name: "jackson-dataformat-xml", version: "2.9.8"
compileOnly group: "com.fasterxml.jackson.module", name: "jackson-module-jaxb-annotations", version: "2.9.8"
compileOnly group: "com.liferay.commerce", name: "com.liferay.commerce.api", version: "7.1.0"
diff --git a/modules/apps/commerce/commerce-openapi-util/build.gradle b/modules/apps/commerce/commerce-openapi-util/build.gradle
index 13575d2863cda5..fbc826ba286ba9 100644
--- a/modules/apps/commerce/commerce-openapi-util/build.gradle
+++ b/modules/apps/commerce/commerce-openapi-util/build.gradle
@@ -36,8 +36,8 @@ configFiles.each { File file ->
defaultTasks "generateRestModule"
dependencies {
- compile group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.8"
- compile group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.8"
+ compile group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
+ compile group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.10.1"
compile group: "com.fasterxml.jackson.dataformat", name: "jackson-dataformat-yaml", version: "2.9.8"
compile group: "com.liferay", name: "com.liferay.petra.json.web.service.client", version: "11.0.0"
compile group: "javax.ws.rs", name: "javax.ws.rs-api", version: "2.1"
@@ -48,7 +48,7 @@ dependencies {
compile group: "org.slf4j", name: "slf4j-api", version: "1.7.2"
compile group: "org.slf4j", name: "slf4j-log4j12", version: "1.7.2"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.8"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
testCompile group: "junit", name: "junit", version: "4.12"
}
diff --git a/modules/apps/commerce/commerce-openapi-util/src/main/resources/com/liferay/commerce/openapi/util/generator/build.gradle.tpl b/modules/apps/commerce/commerce-openapi-util/src/main/resources/com/liferay/commerce/openapi/util/generator/build.gradle.tpl
index cb5bd4045e02e3..78326cffebc080 100644
--- a/modules/apps/commerce/commerce-openapi-util/src/main/resources/com/liferay/commerce/openapi/util/generator/build.gradle.tpl
+++ b/modules/apps/commerce/commerce-openapi-util/src/main/resources/com/liferay/commerce/openapi/util/generator/build.gradle.tpl
@@ -1,6 +1,6 @@
dependencies {
compileOnly group: "biz.aQute.bnd", name: "biz.aQute.bndlib", version: "3.1.0"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.6"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
compileOnly group: "com.fasterxml.jackson.dataformat", name: "jackson-dataformat-xml", version: "2.9.6"
compileOnly group: "com.liferay", name: "com.liferay.oauth2.provider.scope.api", version: "1.0.0"
compileOnly group: "com.liferay", name: "com.liferay.osgi.service.tracker.collections", version: "3.0.0"
diff --git a/modules/apps/commerce/commerce-payment-method-mercanet/build.gradle b/modules/apps/commerce/commerce-payment-method-mercanet/build.gradle
index a62b72fc164c59..6813168d04fce0 100644
--- a/modules/apps/commerce/commerce-payment-method-mercanet/build.gradle
+++ b/modules/apps/commerce/commerce-payment-method-mercanet/build.gradle
@@ -1,6 +1,6 @@
dependencies {
- compileInclude group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.8"
- compileInclude group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.8"
+ compileInclude group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
+ compileInclude group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.10.1"
compileInclude group: "com.fasterxml.jackson.datatype", name: "jackson-datatype-jsr310", version: "2.9.8"
compileInclude group: "com.worldline.sips", name: "payment-sdk-common", version: "1.0.1"
compileInclude group: "org.apache.commons", name: "commons-lang3", version: "3.8.1"
diff --git a/modules/apps/commerce/headless/headless-commerce/headless-commerce-admin-catalog-api/build.gradle b/modules/apps/commerce/headless/headless-commerce/headless-commerce-admin-catalog-api/build.gradle
index d48cc6957f0904..a35e7cf0a293b4 100644
--- a/modules/apps/commerce/headless/headless-commerce/headless-commerce-admin-catalog-api/build.gradle
+++ b/modules/apps/commerce/headless/headless-commerce/headless-commerce-admin-catalog-api/build.gradle
@@ -1,5 +1,5 @@
dependencies {
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.8"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
compileOnly group: "com.liferay", name: "com.liferay.petra.function", version: "2.0.0"
compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "2.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.vulcan.api", version: "1.0.0-20190325.181508-2"
diff --git a/modules/apps/commerce/headless/headless-commerce/headless-commerce-admin-catalog-impl/build.gradle b/modules/apps/commerce/headless/headless-commerce/headless-commerce-admin-catalog-impl/build.gradle
index aa63bdf28d224d..438d3532e825a1 100644
--- a/modules/apps/commerce/headless/headless-commerce/headless-commerce-admin-catalog-impl/build.gradle
+++ b/modules/apps/commerce/headless/headless-commerce/headless-commerce-admin-catalog-impl/build.gradle
@@ -1,5 +1,5 @@
dependencies {
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.8"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
compileOnly group: "com.liferay", name: "com.liferay.portal.odata.api", version: "1.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.vulcan.api", version: "1.0.0-20190325.181508-2"
compileOnly group: "com.liferay.commerce", name: "com.liferay.commerce.api", version: "7.1.0"
diff --git a/modules/apps/commerce/headless/headless-commerce/headless-commerce-admin-pricing-api/build.gradle b/modules/apps/commerce/headless/headless-commerce/headless-commerce-admin-pricing-api/build.gradle
index d48cc6957f0904..a35e7cf0a293b4 100644
--- a/modules/apps/commerce/headless/headless-commerce/headless-commerce-admin-pricing-api/build.gradle
+++ b/modules/apps/commerce/headless/headless-commerce/headless-commerce-admin-pricing-api/build.gradle
@@ -1,5 +1,5 @@
dependencies {
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.8"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
compileOnly group: "com.liferay", name: "com.liferay.petra.function", version: "2.0.0"
compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "2.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.vulcan.api", version: "1.0.0-20190325.181508-2"
diff --git a/modules/apps/commerce/headless/headless-commerce/headless-commerce-admin-pricing-impl/build.gradle b/modules/apps/commerce/headless/headless-commerce/headless-commerce-admin-pricing-impl/build.gradle
index 1429b2a95f702e..aa7b84a7de2d78 100644
--- a/modules/apps/commerce/headless/headless-commerce/headless-commerce-admin-pricing-impl/build.gradle
+++ b/modules/apps/commerce/headless/headless-commerce/headless-commerce-admin-pricing-impl/build.gradle
@@ -1,5 +1,5 @@
dependencies {
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.8"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
compileOnly group: "com.liferay", name: "com.liferay.portal.odata.api", version: "1.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.vulcan.api", version: "1.0.0-20190325.181508-2"
compileOnly group: "com.liferay.commerce", name: "com.liferay.commerce.discount.api", version: "2.2.0"
diff --git a/modules/apps/commerce/headless/headless-commerce/headless-commerce-admin-site-setting-api/build.gradle b/modules/apps/commerce/headless/headless-commerce/headless-commerce-admin-site-setting-api/build.gradle
index d48cc6957f0904..a35e7cf0a293b4 100644
--- a/modules/apps/commerce/headless/headless-commerce/headless-commerce-admin-site-setting-api/build.gradle
+++ b/modules/apps/commerce/headless/headless-commerce/headless-commerce-admin-site-setting-api/build.gradle
@@ -1,5 +1,5 @@
dependencies {
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.8"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
compileOnly group: "com.liferay", name: "com.liferay.petra.function", version: "2.0.0"
compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "2.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.vulcan.api", version: "1.0.0-20190325.181508-2"
diff --git a/modules/apps/commerce/headless/headless-commerce/headless-commerce-admin-site-setting-impl/build.gradle b/modules/apps/commerce/headless/headless-commerce/headless-commerce-admin-site-setting-impl/build.gradle
index a375757d4332ff..92c9df24c27cf0 100644
--- a/modules/apps/commerce/headless/headless-commerce/headless-commerce-admin-site-setting-impl/build.gradle
+++ b/modules/apps/commerce/headless/headless-commerce/headless-commerce-admin-site-setting-impl/build.gradle
@@ -1,5 +1,5 @@
dependencies {
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.8"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
compileOnly group: "com.liferay", name: "com.liferay.portal.odata.api", version: "1.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.vulcan.api", version: "1.0.0-20190325.181508-2"
compileOnly group: "com.liferay.commerce", name: "com.liferay.commerce.api", version: "7.1.0"
diff --git a/modules/apps/portal-cache/portal-cache-multiple/src/main/java/com/liferay/portal/cache/multiple/internal/bootstrap/ClusterLinkPortalCacheBootstrapLoaderFactory.java b/modules/apps/configuration-admin/configuration-admin-web/src/main/java/com/liferay/configuration/admin/web/internal/category/DataProviderConfigurationCategory.java
similarity index 54%
rename from modules/apps/portal-cache/portal-cache-multiple/src/main/java/com/liferay/portal/cache/multiple/internal/bootstrap/ClusterLinkPortalCacheBootstrapLoaderFactory.java
rename to modules/apps/configuration-admin/configuration-admin-web/src/main/java/com/liferay/configuration/admin/web/internal/category/DataProviderConfigurationCategory.java
index 3ca6b59da8e580..69f426da868789 100644
--- a/modules/apps/portal-cache/portal-cache-multiple/src/main/java/com/liferay/portal/cache/multiple/internal/bootstrap/ClusterLinkPortalCacheBootstrapLoaderFactory.java
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/java/com/liferay/configuration/admin/web/internal/category/DataProviderConfigurationCategory.java
@@ -12,25 +12,27 @@
\* details.
\*/
-package com.liferay.portal.cache.multiple.internal.bootstrap;
+package com.liferay.configuration.admin.web.internal.category;
-import com.liferay.portal.cache.PortalCacheBootstrapLoader;
-import com.liferay.portal.cache.PortalCacheBootstrapLoaderFactory;
-
-import java.util.Properties;
+import com.liferay.configuration.admin.category.ConfigurationCategory;
import org.osgi.service.component.annotations.Component;
/\*\*
- \* @author Tina Tian
+ \* @author Yuxing Wu
\*/
-@Component(immediate = true, service = PortalCacheBootstrapLoaderFactory.class)
-public class ClusterLinkPortalCacheBootstrapLoaderFactory
- implements PortalCacheBootstrapLoaderFactory {
+@Component(service = ConfigurationCategory.class)
+public class DataProviderConfigurationCategory
+ implements ConfigurationCategory {
+
+ @Override
+ public String getCategoryKey() {
+ return "data-providers";
+ }
@Override
- public PortalCacheBootstrapLoader create(Properties properties) {
- return new ClusterLinkPortalCacheBootstrapLoader(properties);
+ public String getCategorySection() {
+ return "content-and-data";
}
}
\ No newline at end of file
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language.properties
index 6d9039549df26f..4a8dabd9004a91 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA
category.chat=Chat
category.community-tools=Community Tools
category.connectors=Connectors
+category.data-providers=Data Providers
category.devices=Devices
category.display-content=Display Content
category.documents-and-media=Documents and Media
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_ar.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_ar.properties
index 464237496a195a..62b0500de83a15 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_ar.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_ar.properties
@@ -17,6 +17,7 @@ category.captcha=
category.chat=
category.community-tools= 
category.connectors=
+category.data-providers=Data Providers (Automatic Copy)
category.devices=
category.display-content= 
category.documents-and-media= 
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_bg.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_bg.properties
index 9161ef1047ac4f..cca4b1abfd7ba1 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_bg.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_bg.properties
@@ -17,6 +17,7 @@ category.captcha= (Automatic Translation)
category.chat= (Automatic Translation)
category.community-tools=  (Automatic Translation)
category.connectors= (Automatic Translation)
+category.data-providers=Data Providers (Automatic Copy)
category.devices= (Automatic Translation)
category.display-content=   (Automatic Translation)
category.documents-and-media=   (Automatic Translation)
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_ca.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_ca.properties
index 4b6b9fc59157fb..3390c8b1abad4a 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_ca.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_ca.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA
category.chat=Xat
category.community-tools=Eines de la comunitat
category.connectors=Connectors
+category.data-providers=Data Providers (Automatic Copy)
category.devices=Dispositius
category.display-content=Mostra el contingut
category.documents-and-media=Documents i Multimdia
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_cs.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_cs.properties
index b2c1bd5c93b91a..64ad27d9d29af2 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_cs.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_cs.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA (Automatic Translation)
category.chat=Konverzace (Automatic Translation)
category.community-tools=Nstroje Spoleenstv (Automatic Translation)
category.connectors=Konektory (Automatic Translation)
+category.data-providers=Data Providers (Automatic Copy)
category.devices=Zazen (Automatic Translation)
category.display-content=Zobrazit obsah (Automatic Translation)
category.documents-and-media=Dokumenty a mdia (Automatic Translation)
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_da.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_da.properties
index 678369172b63fa..878b849e8c0cf9 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_da.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_da.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA (Automatic Copy)
category.chat=Chat (Automatic Copy)
category.community-tools=Community Tools (Automatic Copy)
category.connectors=Connectors (Automatic Copy)
+category.data-providers=Data Providers (Automatic Copy)
category.devices=Devices (Automatic Copy)
category.display-content=Display Content (Automatic Copy)
category.documents-and-media=Documents and Media (Automatic Copy)
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_de.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_de.properties
index 2df4b16e78e8c4..d13234f0b43cb1 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_de.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_de.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA
category.chat=Chat
category.community-tools=Community-Tools
category.connectors=Connectors
+category.data-providers=Data Providers (Automatic Copy)
category.devices=Gerte
category.display-content=Anzeigeinhalt
category.documents-and-media=Dokumente und Medien
@@ -44,7 +45,6 @@ category.productivity=Produktivitt
category.rss=RSS
category.scripting-engines=Scripting-Engines
category.security-tools=Sicherheitstools
-category.sharing=Teilen
category.social-networks=Soziale Netzwerke
category.sso=SSO
category.template-engines=Vorlagen-Engines
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_el.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_el.properties
index f203b3edd71096..0d0ffa67b2eeff 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_el.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_el.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA (Automatic Translation)
category.chat= (Automatic Translation)
category.community-tools=  (Automatic Translation)
category.connectors=  (Automatic Translation)
+category.data-providers=Data Providers (Automatic Copy)
category.devices= (Automatic Translation)
category.display-content=  (Automatic Translation)
category.documents-and-media=   (Automatic Translation)
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_en.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_en.properties
index 6d9039549df26f..4a8dabd9004a91 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_en.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_en.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA
category.chat=Chat
category.community-tools=Community Tools
category.connectors=Connectors
+category.data-providers=Data Providers
category.devices=Devices
category.display-content=Display Content
category.documents-and-media=Documents and Media
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_es.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_es.properties
index 14d71a41dc0006..3cf87c6dce2f2c 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_es.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_es.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA
category.chat=Chat
category.community-tools=Herramientas de la comunidad
category.connectors=Conectores
+category.data-providers=Data Providers (Automatic Copy)
category.devices=Dispositivos
category.display-content=Mostrar contenido
category.documents-and-media=Documentos y multimedia
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_et.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_et.properties
index e4c84f31ebcaf0..8eacd63fd0d1d0 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_et.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_et.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA (Automatic Translation)
category.chat=Vestlus (Automatic Translation)
category.community-tools=henduse vahendite (Automatic Translation)
category.connectors=hendused (Automatic Translation)
+category.data-providers=Data Providers (Automatic Copy)
category.devices=Seadmed (Automatic Translation)
category.display-content=Nita sisu (Automatic Translation)
category.documents-and-media=Dokumente ja andmekandjaid (Automatic Translation)
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_eu.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_eu.properties
index b58152a87808ee..76d5d300f78634 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_eu.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_eu.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA (Automatic Copy)
category.chat=Chat (Automatic Copy)
category.community-tools=Community Tools (Automatic Copy)
category.connectors=Connectors (Automatic Copy)
+category.data-providers=Data Providers (Automatic Copy)
category.devices=Devices (Automatic Copy)
category.display-content=Display Content (Automatic Copy)
category.documents-and-media=Documents and Media (Automatic Copy)
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_fa.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_fa.properties
index 8f1312d6b4e8cc..587f65c1986805 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_fa.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_fa.properties
@@ -17,6 +17,7 @@ category.captcha= (Automatic Translation)
category.chat= (Automatic Translation)
category.community-tools=  (Automatic Translation)
category.connectors=   (Automatic Translation)
+category.data-providers=Data Providers (Automatic Copy)
category.devices=  (Automatic Translation)
category.display-content=  (Automatic Translation)
category.documents-and-media=   (Automatic Translation)
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_fi.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_fi.properties
index 0a4884b7a0c68f..b8eb488eddfae7 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_fi.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_fi.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA
category.chat=Keskustelu
category.community-tools=Yhteistykalut
category.connectors=Liittimet
+category.data-providers=Data Providers (Automatic Copy)
category.devices=Laitteet
category.display-content=Nyttkonteksti
category.documents-and-media=Asiakirjat ja Media
@@ -44,7 +45,6 @@ category.productivity=Tuottavuus
category.rss=RSS
category.scripting-engines=Komentosarjojen Moottorit
category.security-tools=Turvallisuustykalut
-category.sharing=Jakaminen
category.social-networks=Sosiaaliset Verkostot
category.sso=SSO
category.template-engines=Mallimoottorit
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_fr.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_fr.properties
index 76f47b61b07ef5..9ac75bf3645db3 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_fr.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_fr.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA
category.chat=Chat
category.community-tools=Outils communautaires
category.connectors=Connecteurs
+category.data-providers=Data Providers (Automatic Copy)
category.devices=Appareils
category.display-content=Afficher le contenu
category.documents-and-media=Documents et mdias
@@ -44,7 +45,6 @@ category.productivity=Productivit
category.rss=RSS
category.scripting-engines=Moteurs de script
category.security-tools=Outils de scurit
-category.sharing=Partage
category.social-networks=Rseaux Sociaux
category.sso=SSO
category.template-engines=Moteurs de modle
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_gl.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_gl.properties
index b58152a87808ee..76d5d300f78634 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_gl.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_gl.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA (Automatic Copy)
category.chat=Chat (Automatic Copy)
category.community-tools=Community Tools (Automatic Copy)
category.connectors=Connectors (Automatic Copy)
+category.data-providers=Data Providers (Automatic Copy)
category.devices=Devices (Automatic Copy)
category.display-content=Display Content (Automatic Copy)
category.documents-and-media=Documents and Media (Automatic Copy)
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_hi\_IN.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_hi\_IN.properties
index f884583d7189d1..6e63c2787b4260 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_hi\_IN.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_hi\_IN.properties
@@ -17,6 +17,7 @@ category.captcha= (Automatic Translation)
category.chat= (Automatic Translation)
category.community-tools=  (Automatic Translation)
category.connectors= (Automatic Translation)
+category.data-providers=Data Providers (Automatic Copy)
category.devices= (Automatic Translation)
category.display-content=   (Automatic Translation)
category.documents-and-media=   (Automatic Translation)
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_hr.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_hr.properties
index b58152a87808ee..76d5d300f78634 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_hr.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_hr.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA (Automatic Copy)
category.chat=Chat (Automatic Copy)
category.community-tools=Community Tools (Automatic Copy)
category.connectors=Connectors (Automatic Copy)
+category.data-providers=Data Providers (Automatic Copy)
category.devices=Devices (Automatic Copy)
category.display-content=Display Content (Automatic Copy)
category.documents-and-media=Documents and Media (Automatic Copy)
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_hu.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_hu.properties
index a50a139e7ba1bf..00e57bfae06d70 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_hu.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_hu.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA
category.chat=Csevegs
category.community-tools=Kzssgi eszkzk
category.connectors=Csatolk
+category.data-providers=Data Providers (Automatic Copy)
category.devices=Eszkzk
category.display-content=Megjelents tartalma
category.documents-and-media=Dokumentumok s mdik
@@ -44,7 +45,6 @@ category.productivity=Termelkenysg
category.rss=RSS
category.scripting-engines=Parancsfjlkezel motorok
category.security-tools=Biztonsgi eszkzk
-category.sharing=Megoszts
category.social-networks=Kzssgi hlzatok
category.sso=SSO
category.template-engines=Sablonmotorok
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_in.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_in.properties
index 90dbd744f0b39c..5992dc905c456b 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_in.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_in.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA (Automatic Translation)
category.chat=Obrolan (Automatic Translation)
category.community-tools=Alat-alat komunitas (Automatic Translation)
category.connectors=Konektor (Automatic Translation)
+category.data-providers=Data Providers (Automatic Copy)
category.devices=Perangkat (Automatic Translation)
category.display-content=Menampilkan konten (Automatic Translation)
category.documents-and-media=Dokumen dan Media (Automatic Translation)
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_it.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_it.properties
index ede12520d6d7f6..3eb810be20414a 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_it.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_it.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA
category.chat=Chat
category.community-tools=Strumenti della community
category.connectors=Connettori
+category.data-providers=Data Providers (Automatic Copy)
category.devices=Dispositivi
category.display-content=Visualizza Contenuto
category.documents-and-media=Documenti e Media
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_iw.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_iw.properties
index 7e1c8495df7567..316d832ed249a5 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_iw.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_iw.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA
category.chat='
category.community-tools= 
category.connectors=
+category.data-providers=Data Providers (Automatic Copy)
category.devices=
category.display-content= 
category.documents-and-media= 
@@ -44,7 +45,6 @@ category.productivity=
category.rss=RSS
category.scripting-engines= 
category.security-tools= 
-category.sharing=
category.social-networks= 
category.sso=SSO
category.template-engines= 
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_ja.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_ja.properties
index 5b2cec09f6c235..a5e9fd48efac4b 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_ja.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_ja.properties
@@ -17,6 +17,7 @@ category.captcha=
category.chat=
category.community-tools=
category.connectors=
+category.data-providers=Data Providers (Automatic Copy)
category.devices=
category.display-content=
category.documents-and-media=
@@ -44,7 +45,6 @@ category.productivity=
category.rss=RSS
category.scripting-engines= 
category.security-tools=
-category.sharing=
category.social-networks=
category.sso=SSO
category.template-engines= 
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_kk.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_kk.properties
new file mode 100644
index 00000000000000..76d5d300f78634
--- /dev/null
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_kk.properties
@@ -0,0 +1,80 @@
+category-section.commerce=Commerce (Automatic Copy)
+category-section.content=Content (Automatic Copy)
+category-section.other=Other (Automatic Copy)
+category-section.platform=Platform (Automatic Copy)
+category-section.security=Security (Automatic Copy)
+category-section.social=Social (Automatic Copy)
+category.adaptive-media=Adaptive Media (Automatic Copy)
+category.analytics=Analytics (Automatic Copy)
+category.announcements=Announcements (Automatic Copy)
+category.api-authentication=API Authentication (Automatic Copy)
+category.assets=Assets (Automatic Copy)
+category.audit=Audit (Automatic Copy)
+category.auto-login=Auto Login (Automatic Copy)
+category.blogs=Blogs (Automatic Copy)
+category.breadcrumbs=Breadcrumbs (Automatic Copy)
+category.captcha=CAPTCHA (Automatic Copy)
+category.chat=Chat (Automatic Copy)
+category.community-tools=Community Tools (Automatic Copy)
+category.connectors=Connectors (Automatic Copy)
+category.data-providers=Data Providers (Automatic Copy)
+category.devices=Devices (Automatic Copy)
+category.display-content=Display Content (Automatic Copy)
+category.documents-and-media=Documents and Media (Automatic Copy)
+category.dynamic-data-lists=Dynamic Data Lists (Automatic Copy)
+category.dynamic-data-mapping=Dynamic Data Mapping (Automatic Copy)
+category.file-storage=File Storage (Automatic Copy)
+category.forms=Forms (Automatic Copy)
+category.foundation=Foundation (Automatic Copy)
+category.frontend-infrastructure=Frontend Infrastructure (Automatic Copy)
+category.general=General (Automatic Copy)
+category.infrastructure=Infrastructure (Automatic Copy)
+category.knowledge-base=Knowledge Base (Automatic Copy)
+category.ldap=LDAP (Automatic Copy)
+category.localization=Localization (Automatic Copy)
+category.message-boards=Message Boards (Automatic Copy)
+category.messaging=Messaging (Automatic Copy)
+category.module-container=Module Container (Automatic Copy)
+category.navigation=Navigation (Automatic Copy)
+category.notifications=Notifications (Automatic Copy)
+category.oauth2=OAuth 2 (Automatic Copy)
+category.open-id=OpenID (Automatic Copy)
+category.other=Other (Automatic Copy)
+category.pages=Pages (Automatic Copy)
+category.productivity=Productivity (Automatic Copy)
+category.rss=RSS (Automatic Copy)
+category.scripting-engines=Scripting Engines (Automatic Copy)
+category.security-tools=Security Tools (Automatic Copy)
+category.social-networks=Social Networks (Automatic Copy)
+category.sso=SSO (Automatic Copy)
+category.template-engines=Template Engines (Automatic Copy)
+category.third-party=Third Party (Automatic Copy)
+category.upgrades=Upgrades (Automatic Copy)
+category.user-activity=User Activity (Automatic Copy)
+category.users=Users (Automatic Copy)
+category.web-api=Web API (Automatic Copy)
+category.web-content=Web Content (Automatic Copy)
+category.web-experience=Web Experience (Automatic Copy)
+category.widget-tools=Widget Tools (Automatic Copy)
+category.xsl-content=XSL Content (Automatic Copy)
+collaboration=Collaboration (Automatic Copy)
+configuration-entries=Configuration Entries (Automatic Copy)
+context-paths=Context Paths (Automatic Copy)
+default-configuration-for-all-sites=Default Configuration for All Sites (Automatic Copy)
+default-configuration-for-widget=Default Configuration for the Widget (Automatic Copy)
+default-settings-for-all-instances=Default Settings for All Instances (Automatic Copy)
+export-all-settings=Export All Settings (Automatic Copy)
+export-entries=Export Entries (Automatic Copy)
+factory=Factory (Automatic Copy)
+forms-and-workflow=Forms and Workflow (Automatic Copy)
+foundation=Foundation (Automatic Copy)
+javax.portlet.title.com\_liferay\_configuration\_admin\_web\_portlet\_SystemSettingsPortlet=System Settings (Automatic Copy)
+no-configurations-were-found=No configurations were found. (Automatic Copy)
+no-entries-for-x-have-been-added-yet=No entries for {0} have been added yet. Use the "Add Button" below to add the first. (Automatic Copy)
+reset-default-values=Reset Default Values (Automatic Copy)
+scope.company=Virtual Instance Scope (Automatic Copy)
+scope.group=Site Scope (Automatic Copy)
+scope.portlet-instance=Widget Scope (Automatic Copy)
+scope.system=System Scope (Automatic Copy)
+this-configuration-was-not-saved-yet=This configuration was not saved yet. The values shown are the default. (Automatic Copy)
+web-experience=Web Experience (Automatic Copy)
\ No newline at end of file
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_ko.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_ko.properties
index f480c5a663b283..4c236af1fa5e9a 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_ko.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_ko.properties
@@ -17,6 +17,7 @@ category.captcha=  (Automatic Translation)
category.chat= (Automatic Translation)
category.community-tools=  (Automatic Translation)
category.connectors= (Automatic Translation)
+category.data-providers=Data Providers (Automatic Copy)
category.devices= (Automatic Translation)
category.display-content=  (Automatic Translation)
category.documents-and-media=   (Automatic Translation)
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_lo.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_lo.properties
index b58152a87808ee..76d5d300f78634 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_lo.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_lo.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA (Automatic Copy)
category.chat=Chat (Automatic Copy)
category.community-tools=Community Tools (Automatic Copy)
category.connectors=Connectors (Automatic Copy)
+category.data-providers=Data Providers (Automatic Copy)
category.devices=Devices (Automatic Copy)
category.display-content=Display Content (Automatic Copy)
category.documents-and-media=Documents and Media (Automatic Copy)
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_lt.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_lt.properties
index f0cd0a8511fdcf..936a3ef9d988e5 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_lt.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_lt.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA (Automatic Translation)
category.chat=Pokalbiai (Automatic Translation)
category.community-tools=Bendrijos priemons (Automatic Translation)
category.connectors=Jungtys (Automatic Translation)
+category.data-providers=Data Providers (Automatic Copy)
category.devices=Prietaisai (Automatic Translation)
category.display-content=Rodyti turin (Automatic Translation)
category.documents-and-media=Dokumentuose ir iniasklaidos (Automatic Translation)
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_nb.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_nb.properties
index 4f8b75a1a4123c..ee851a80acd114 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_nb.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_nb.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA (Automatic Translation)
category.chat=Chat (Automatic Translation)
category.community-tools=Samfunn verkty (Automatic Translation)
category.connectors=Kontakter (Automatic Translation)
+category.data-providers=Data Providers (Automatic Copy)
category.devices=Enheter (Automatic Translation)
category.display-content=Vise innhold (Automatic Translation)
category.documents-and-media=Dokumenter og Media (Automatic Translation)
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_nl.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_nl.properties
index 60554cf5459139..c1295f04bb44be 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_nl.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_nl.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA
category.chat=Chat
category.community-tools=Communitytools
category.connectors=Connectoren
+category.data-providers=Data Providers (Automatic Copy)
category.devices=Apparaten
category.display-content=Inhoud weergeven
category.documents-and-media=Documenten en media
@@ -44,7 +45,6 @@ category.productivity=Productiviteit
category.rss=RSS
category.scripting-engines=Scriptmachines
category.security-tools=Beveiligingstools
-category.sharing=Delen
category.social-networks=Sociale netwerken
category.sso=SSO
category.template-engines=Sjabloonmachines
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_nl\_BE.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_nl\_BE.properties
index 915e8271f09b69..bb67f43d2a7024 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_nl\_BE.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_nl\_BE.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA (Automatic Copy)
category.chat=Chat (Automatic Copy)
category.community-tools=Community Tools (Automatic Copy)
category.connectors=Connectors (Automatic Copy)
+category.data-providers=Data Providers (Automatic Copy)
category.devices=Devices (Automatic Copy)
category.display-content=Display Content (Automatic Copy)
category.documents-and-media=Documents and Media (Automatic Copy)
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_pl.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_pl.properties
index 6c60bcd203d684..af17af1c053f42 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_pl.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_pl.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA (Automatic Translation)
category.chat=Czat (Automatic Translation)
category.community-tools=Narzdzia spoecznoci (Automatic Translation)
category.connectors=Zcza (Automatic Translation)
+category.data-providers=Data Providers (Automatic Copy)
category.devices=Urzdzenia (Automatic Translation)
category.display-content=Wywietlanie zawartoci (Automatic Translation)
category.documents-and-media=Dokumenty i Media (Automatic Translation)
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_pt\_BR.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_pt\_BR.properties
index 6af4a208e388a7..0b49dd15a7c5c9 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_pt\_BR.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_pt\_BR.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA
category.chat=Bate-papo
category.community-tools=Ferramentas de Comunidade
category.connectors=Conectores
+category.data-providers=Data Providers (Automatic Copy)
category.devices=Dispositivos
category.display-content=Exibir Contedo
category.documents-and-media=Documentos e Mdia
@@ -44,7 +45,6 @@ category.productivity=Produtividade
category.rss=RSS
category.scripting-engines=Mecanismos de Scripts
category.security-tools=Ferramentas de Segurana
-category.sharing=Partilhando
category.social-networks=Redes Sociais
category.sso=Login nico (SSO)
category.template-engines=Mecanismos de Modelo
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_pt\_PT.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_pt\_PT.properties
index c483a3579550a3..6907e267904557 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_pt\_PT.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_pt\_PT.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA (Automatic Copy)
category.chat=Chat (Automatic Copy)
category.community-tools=Community Tools (Automatic Copy)
category.connectors=Connectors (Automatic Copy)
+category.data-providers=Data Providers (Automatic Copy)
category.devices=Devices (Automatic Copy)
category.display-content=Display Content (Automatic Copy)
category.documents-and-media=Documents and Media (Automatic Copy)
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_ro.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_ro.properties
index 2387051ff1fbc9..341ea5d120697b 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_ro.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_ro.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA (Automatic Translation)
category.chat=Chat-ul (Automatic Translation)
category.community-tools=Instrumente de Comunitate (Automatic Translation)
category.connectors=Conectori (Automatic Translation)
+category.data-providers=Data Providers (Automatic Copy)
category.devices=Dispozitive (Automatic Translation)
category.display-content=Afia coninut (Automatic Translation)
category.documents-and-media=Documente i mass-Media (Automatic Translation)
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_ru.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_ru.properties
index ba94623a76de69..929aa8ae94d758 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_ru.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_ru.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA (Automatic Translation)
category.chat= (Automatic Translation)
category.community-tools=  (Automatic Translation)
category.connectors= (Automatic Translation)
+category.data-providers=Data Providers (Automatic Copy)
category.devices= (Automatic Translation)
category.display-content=  (Automatic Translation)
category.documents-and-media=     (Automatic Translation)
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_sk.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_sk.properties
index 665fcf1d22b3dc..f2abb079900447 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_sk.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_sk.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA (Automatic Translation)
category.chat=Chat (Automatic Translation)
category.community-tools=Nstrojov Spoloenstva (Automatic Translation)
category.connectors=Konektory (Automatic Translation)
+category.data-providers=Data Providers (Automatic Copy)
category.devices=Zariadenia (Automatic Translation)
category.display-content=Zobrazi obsah (Automatic Translation)
category.documents-and-media=Dokumenty a mdi (Automatic Translation)
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_sl.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_sl.properties
index 5299f38a0f9db3..a47c417aaeb6f7 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_sl.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_sl.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA (Automatic Translation)
category.chat=Klepet (Automatic Translation)
category.community-tools=Skupnosti orodja (Automatic Translation)
category.connectors=Prikljuki (Automatic Translation)
+category.data-providers=Data Providers (Automatic Copy)
category.devices=Naprave (Automatic Translation)
category.display-content=Izpis vsebine (Automatic Translation)
category.documents-and-media=Dokumentov in mediji (Automatic Translation)
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_sr\_RS.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_sr\_RS.properties
index b58152a87808ee..76d5d300f78634 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_sr\_RS.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_sr\_RS.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA (Automatic Copy)
category.chat=Chat (Automatic Copy)
category.community-tools=Community Tools (Automatic Copy)
category.connectors=Connectors (Automatic Copy)
+category.data-providers=Data Providers (Automatic Copy)
category.devices=Devices (Automatic Copy)
category.display-content=Display Content (Automatic Copy)
category.documents-and-media=Documents and Media (Automatic Copy)
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_sr\_RS\_latin.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_sr\_RS\_latin.properties
index b58152a87808ee..76d5d300f78634 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_sr\_RS\_latin.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_sr\_RS\_latin.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA (Automatic Copy)
category.chat=Chat (Automatic Copy)
category.community-tools=Community Tools (Automatic Copy)
category.connectors=Connectors (Automatic Copy)
+category.data-providers=Data Providers (Automatic Copy)
category.devices=Devices (Automatic Copy)
category.display-content=Display Content (Automatic Copy)
category.documents-and-media=Documents and Media (Automatic Copy)
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_sv.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_sv.properties
index 54aec479b4e1e2..8f86632653788b 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_sv.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_sv.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA
category.chat=Chatt
category.community-tools=Communityverktyg
category.connectors=Kopplingar
+category.data-providers=Data Providers (Automatic Copy)
category.devices=Enheter
category.display-content=Visa innehllet
category.documents-and-media=Dokument och media
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_th.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_th.properties
index f73b01cb93b4e7..e7045fed7b0a14 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_th.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_th.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA (Automatic Translation)
category.chat= (Automatic Translation)
category.community-tools= (Automatic Translation)
category.connectors= (Automatic Translation)
+category.data-providers=Data Providers (Automatic Copy)
category.devices= (Automatic Translation)
category.display-content= (Automatic Translation)
category.documents-and-media= (Automatic Translation)
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_tr.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_tr.properties
index 156291d0974283..1a7698bcf672b1 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_tr.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_tr.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA (Automatic Translation)
category.chat=Sohbet (Automatic Translation)
category.community-tools=Topluluk aralar (Automatic Translation)
category.connectors=Balayclar (Automatic Translation)
+category.data-providers=Data Providers (Automatic Copy)
category.devices=Aygtlar (Automatic Translation)
category.display-content=erik grntleme (Automatic Translation)
category.documents-and-media=Belgeleri ve medya (Automatic Translation)
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_uk.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_uk.properties
index 4d8f04c8a91c86..06c1fb9c01db41 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_uk.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_uk.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA (Automatic Translation)
category.chat= (Automatic Translation)
category.community-tools=  (Automatic Translation)
category.connectors=  (Automatic Translation)
+category.data-providers=Data Providers (Automatic Copy)
category.devices= (Automatic Translation)
category.display-content=  (Automatic Translation)
category.documents-and-media=   (Automatic Translation)
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_vi.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_vi.properties
index 91205ef4a4a1e5..aa61d1de5e9d63 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_vi.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_vi.properties
@@ -17,6 +17,7 @@ category.captcha=CAPTCHA (Automatic Translation)
category.chat=Tr chuyn (Automatic Translation)
category.community-tools=Cng c cng ng (Automatic Translation)
category.connectors=Kt ni (Automatic Translation)
+category.data-providers=Data Providers (Automatic Copy)
category.devices=Thit b (Automatic Translation)
category.display-content=Hin th ni dung (Automatic Translation)
category.documents-and-media=Ti liu v phng tin truyn thng (Automatic Translation)
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_zh\_CN.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_zh\_CN.properties
index 95d7e50e2da156..2bade3aa7efc47 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_zh\_CN.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_zh\_CN.properties
@@ -17,6 +17,7 @@ category.captcha=
category.chat=
category.community-tools=
category.connectors=
+category.data-providers=Data Providers (Automatic Copy)
category.devices=
category.display-content=
category.documents-and-media=
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_zh\_TW.properties b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_zh\_TW.properties
index ee4b37ba9396fe..a82ad1c15eb60e 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_zh\_TW.properties
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/content/Language\_zh\_TW.properties
@@ -17,6 +17,7 @@ category.captcha=captcha (Automatic Translation)
category.chat= (Automatic Translation)
category.community-tools= (Automatic Translation)
category.connectors= (Automatic Translation)
+category.data-providers=Data Providers (Automatic Copy)
category.devices= (Automatic Translation)
category.display-content= (Automatic Translation)
category.documents-and-media= (Automatic Translation)
diff --git a/modules/apps/document-library/document-library-service/src/main/java/com/liferay/document/library/internal/util/DLValidatorImpl.java b/modules/apps/document-library/document-library-service/src/main/java/com/liferay/document/library/internal/util/DLValidatorImpl.java
index 3eb5e199c24185..ff067c7842ea3e 100644
--- a/modules/apps/document-library/document-library-service/src/main/java/com/liferay/document/library/internal/util/DLValidatorImpl.java
+++ b/modules/apps/document-library/document-library-service/src/main/java/com/liferay/document/library/internal/util/DLValidatorImpl.java
@@ -23,6 +23,7 @@
import com.liferay.document.library.kernel.exception.SourceFileNameException;
import com.liferay.document.library.kernel.util.DLUtil;
import com.liferay.document.library.kernel.util.DLValidator;
+import com.liferay.petra.string.CharPool;
import com.liferay.petra.string.StringBundler;
import com.liferay.petra.string.StringPool;
import com.liferay.portal.configuration.metatype.bnd.util.ConfigurableUtil;
@@ -139,11 +140,17 @@ public void validateFileExtension(String fileName)
boolean validFileExtension = false;
- String[] fileExtensions = \_dlConfiguration.fileExtensions();
+ for (String fileExtension : \_dlConfiguration.fileExtensions()) {
+ String fileNameExtension = StringUtil.toLowerCase(
+ FileUtil.getExtension(fileName));
- for (String fileExtension : fileExtensions) {
if (StringPool.STAR.equals(fileExtension) ||
- StringUtil.endsWith(fileName, fileExtension)) {
+ StringUtil.equals(
+ fileNameExtension,
+ StringUtil.toLowerCase(
+ StringUtil.replace(
+ fileExtension, CharPool.PERIOD,
+ StringPool.BLANK)))) {
validFileExtension = true;
@@ -308,6 +315,10 @@ protected String replaceDLNameBlacklist(String title) {
return title;
}
+ protected void setDLConfiguration(DLConfiguration dlConfiguration) {
+ \_dlConfiguration = dlConfiguration;
+ }
+
private volatile DLConfiguration \_dlConfiguration;
@Reference
diff --git a/modules/apps/document-library/document-library-service/src/test/java/com/liferay/document/library/internal/util/DLValidatorImplTest.java b/modules/apps/document-library/document-library-service/src/test/java/com/liferay/document/library/internal/util/DLValidatorImplTest.java
new file mode 100644
index 00000000000000..ce8e9e0ca863ad
--- /dev/null
+++ b/modules/apps/document-library/document-library-service/src/test/java/com/liferay/document/library/internal/util/DLValidatorImplTest.java
@@ -0,0 +1,91 @@
+/\*\*
+ \* Copyright (c) 2000-present Liferay, Inc. All rights reserved.
+ \*
+ \* This library is free software; you can redistribute it and/or modify it under
+ \* the terms of the GNU Lesser General Public License as published by the Free
+ \* Software Foundation; either version 2.1 of the License, or (at your option)
+ \* any later version.
+ \*
+ \* This library is distributed in the hope that it will be useful, but WITHOUT
+ \* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
+ \* FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
+ \* details.
+ \*/
+
+package com.liferay.document.library.internal.util;
+
+import com.liferay.document.library.configuration.DLConfiguration;
+import com.liferay.document.library.kernel.exception.FileExtensionException;
+import com.liferay.document.library.kernel.util.DLValidator;
+import com.liferay.portal.kernel.util.FileUtil;
+import com.liferay.portal.util.FileImpl;
+
+import org.junit.Before;
+import org.junit.Test;
+
+import org.mockito.Mockito;
+
+/\*\*
+ \* @author Adolfo Prez
+ \*/
+public class DLValidatorImplTest {
+
+ @Before
+ public void setUp() {
+ DLValidatorImpl dlValidatorImpl = new DLValidatorImpl();
+
+ \_dlConfiguration = Mockito.mock(DLConfiguration.class);
+
+ dlValidatorImpl.setDLConfiguration(\_dlConfiguration);
+
+ \_dlValidator = dlValidatorImpl;
+
+ FileUtil fileUtil = new FileUtil();
+
+ fileUtil.setFile(FileImpl.getInstance());
+ }
+
+ @Test(expected = FileExtensionException.class)
+ public void testInvalidExtension() throws Exception {
+ \_validateFileExtension("test.gf");
+ }
+
+ @Test
+ public void testValidLowerCaseExtension() throws Exception {
+ \_validateFileExtension("test.gif");
+ }
+
+ @Test
+ public void testValidMixedCaseExtension() throws Exception {
+ \_validateFileExtension("test.GiF");
+ }
+
+ @Test
+ public void testValidUpperCaseExtension() throws Exception {
+ \_validateFileExtension("test.GIF");
+ }
+
+ private void \_validateFileExtension(String fileName)
+ throws FileExtensionException {
+
+ Mockito.when(
+ \_dlConfiguration.fileExtensions()
+ ).thenReturn(
+ new String[] {".gif"}
+ );
+
+ \_dlValidator.validateFileExtension(fileName);
+
+ Mockito.when(
+ \_dlConfiguration.fileExtensions()
+ ).thenReturn(
+ new String[] {"gif"}
+ );
+
+ \_dlValidator.validateFileExtension(fileName);
+ }
+
+ private DLConfiguration \_dlConfiguration;
+ private DLValidator \_dlValidator;
+
+}
\ No newline at end of file
diff --git a/modules/apps/document-library/document-library-web/src/main/java/com/liferay/document/library/web/internal/display/context/logic/UIItemsBuilder.java b/modules/apps/document-library/document-library-web/src/main/java/com/liferay/document/library/web/internal/display/context/logic/UIItemsBuilder.java
index 240be08d4bc071..690e98496e012f 100644
--- a/modules/apps/document-library/document-library-web/src/main/java/com/liferay/document/library/web/internal/display/context/logic/UIItemsBuilder.java
+++ b/modules/apps/document-library/document-library-web/src/main/java/com/liferay/document/library/web/internal/display/context/logic/UIItemsBuilder.java
@@ -172,8 +172,8 @@ public void addCheckinToolbarItem(List toolbarItems)
new JavaScriptToolbarItem(), toolbarItems, DLUIItemKeys.CHECKIN,
LanguageUtil.get(\_resourceBundle, "checkin"),
StringBundler.concat(
- getNamespace(), "showVersionDetailsDialog('", portletURL,
- "');"));
+ getNamespace(), "showVersionDetailsDialog('",
+ HtmlUtil.escapeJS(portletURL.toString()), "');"));
String javaScript =
"/com/liferay/document/library/web/display/context/dependencies" +
@@ -281,7 +281,7 @@ public void addCompareToMenuItem(List menuItems)
sb.append(jsNamespace);
sb.append("compareVersionDialog('");
- sb.append(selectFileVersionURL.toString());
+ sb.append(HtmlUtil.escapeJS(selectFileVersionURL.toString()));
sb.append("');");
JavaScriptMenuItem javaScriptMenuItem = \_addJavaScriptUIItem(
@@ -658,7 +658,8 @@ public void addOpenInMsOfficeMenuItem(List menuItems)
true);
String onClick = StringBundler.concat(
- getNamespace(), "openDocument('", webDavURL, "');");
+ getNamespace(), "openDocument('", HtmlUtil.escapeJS(webDavURL),
+ "');");
JavaScriptMenuItem javaScriptMenuItem = \_addJavaScriptUIItem(
new JavaScriptMenuItem(), menuItems, DLUIItemKeys.OPEN\_IN\_MS\_OFFICE,
@@ -707,7 +708,7 @@ public void addOpenInMsOfficeToolbarItem(List toolbarItems)
sb.append(getNamespace());
sb.append("openDocument('");
- sb.append(webDavURL);
+ sb.append(HtmlUtil.escapeJS(webDavURL));
sb.append("');");
\_addJavaScriptUIItem(
@@ -784,7 +785,7 @@ public void addPermissionsToolbarItem(List toolbarItems)
sb.append("'dialog-with-footer'}, title: '");
sb.append(UnicodeLanguageUtil.get(\_resourceBundle, "permissions"));
sb.append("', uri: '");
- sb.append(permissionsURL);
+ sb.append(HtmlUtil.escapeJS(permissionsURL));
sb.append("'});");
\_addJavaScriptUIItem(
@@ -945,8 +946,8 @@ public JavaScriptMenuItem getJavacriptCheckinMenuItem()
javaScriptMenuItem.setLabel("checkin");
javaScriptMenuItem.setOnClick(
StringBundler.concat(
- getNamespace(), "showVersionDetailsDialog('", portletURL,
- "');"));
+ getNamespace(), "showVersionDetailsDialog('",
+ HtmlUtil.escapeJS(portletURL.toString()), "');"));
String javaScript =
"/com/liferay/document/library/web/display/context/dependencies" +
@@ -1017,7 +1018,7 @@ protected String getSubmitFormJavaScript(String cmd, String redirect) {
sb.append("fm.");
sb.append(getNamespace());
sb.append("redirect.value = '");
- sb.append(redirect);
+ sb.append(HtmlUtil.escapeJS(redirect));
sb.append("';");
}
diff --git a/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/search\_resources.jsp b/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/search\_resources.jsp
index ad3907475d2801..c67313c472c713 100644
--- a/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/search\_resources.jsp
+++ b/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/search\_resources.jsp
@@ -64,7 +64,7 @@ entriesChecker.setRememberCheckBoxStateURLRegex("^(?!.\*" + liferayPortletRespons
 getLocalizedMap(Locale locale, String value) {
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-data-provider-web/src/main/resources/META-INF/resources/edit\_data\_provider.jsp b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-data-provider-web/src/main/resources/META-INF/resources/edit\_data\_provider.jsp
index c1c64069837386..e0d0313c46c4ca 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-data-provider-web/src/main/resources/META-INF/resources/edit\_data\_provider.jsp
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-data-provider-web/src/main/resources/META-INF/resources/edit\_data\_provider.jsp
@@ -49,6 +49,8 @@ renderResponse.setTitle((ddmDataProviderInstance == null) ? LanguageUtil.get(req

+ <%@ include file="/exceptions.jspf" %>
+
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-data-provider-web/src/main/resources/META-INF/resources/exceptions.jspf b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-data-provider-web/src/main/resources/META-INF/resources/exceptions.jspf
new file mode 100644
index 00000000000000..e18a4268a4b031
--- /dev/null
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-data-provider-web/src/main/resources/META-INF/resources/exceptions.jspf
@@ -0,0 +1,17 @@
+<%--
+/\*\*
+ \* Copyright (c) 2000-present Liferay, Inc. All rights reserved.
+ \*
+ \* This library is free software; you can redistribute it and/or modify it under
+ \* the terms of the GNU Lesser General Public License as published by the Free
+ \* Software Foundation; either version 2.1 of the License, or (at your option)
+ \* any later version.
+ \*
+ \* This library is distributed in the hope that it will be useful, but WITHOUT
+ \* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
+ \* FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
+ \* details.
+ \*/
+--%>
+
+
\ No newline at end of file
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-data-provider-web/src/main/resources/META-INF/resources/init.jsp b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-data-provider-web/src/main/resources/META-INF/resources/init.jsp
index a528d6b58bf918..cc2cdc504e0b4e 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-data-provider-web/src/main/resources/META-INF/resources/init.jsp
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-data-provider-web/src/main/resources/META-INF/resources/init.jsp
@@ -27,6 +27,7 @@ taglib uri="http://liferay.com/tld/ui" prefix="liferay-ui" %><%@
taglib uri="http://liferay.com/tld/util" prefix="liferay-util" %>
<%@ page import="com.liferay.dynamic.data.mapping.data.provider.web.internal.display.context.DDMDataProviderDisplayContext" %><%@
+page import="com.liferay.dynamic.data.mapping.exception.DataProviderInstanceURLException" %><%@
page import="com.liferay.dynamic.data.mapping.exception.RequiredDataProviderInstanceException" %><%@
page import="com.liferay.dynamic.data.mapping.model.DDMDataProviderInstance" %><%@
page import="com.liferay.petra.string.StringPool" %><%@
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-builder/src/main/java/com/liferay/dynamic/data/mapping/form/builder/internal/servlet/filter/DDMDataProviderInstanceParameterSettingsAuthVerifierFilter.java b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-builder/src/main/java/com/liferay/dynamic/data/mapping/form/builder/internal/servlet/filter/DDMDataProviderInstanceParameterSettingsAuthVerifierFilter.java
index 38610f89e9b745..65566945203e60 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-builder/src/main/java/com/liferay/dynamic/data/mapping/form/builder/internal/servlet/filter/DDMDataProviderInstanceParameterSettingsAuthVerifierFilter.java
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-builder/src/main/java/com/liferay/dynamic/data/mapping/form/builder/internal/servlet/filter/DDMDataProviderInstanceParameterSettingsAuthVerifierFilter.java
@@ -27,6 +27,7 @@
immediate = true,
property = {
"dynamic.data.mapping.form.builder.servlet=true",
+ "filter.init.auth.verifier.PortalSessionAuthVerifier.check.csrf.token=false",
"filter.init.auth.verifier.PortalSessionAuthVerifier.urls.includes=/dynamic-data-mapping-form-builder-provider-instance-parameter-settings/\*",
"osgi.http.whiteboard.filter.name=com.liferay.dynamic.data.mapping.form.builder.internal.servlet.filter.DDMDataProviderInstanceParameterSettingsAuthVerifierFilter",
"osgi.http.whiteboard.filter.pattern=/dynamic-data-mapping-form-builder-provider-instance-parameter-settings/\*"
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-builder/src/main/java/com/liferay/dynamic/data/mapping/form/builder/internal/servlet/filter/DDMDataProviderInstancesAuthVerifierFilter.java b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-builder/src/main/java/com/liferay/dynamic/data/mapping/form/builder/internal/servlet/filter/DDMDataProviderInstancesAuthVerifierFilter.java
index 198b0098573aef..23325e45c00d51 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-builder/src/main/java/com/liferay/dynamic/data/mapping/form/builder/internal/servlet/filter/DDMDataProviderInstancesAuthVerifierFilter.java
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-builder/src/main/java/com/liferay/dynamic/data/mapping/form/builder/internal/servlet/filter/DDMDataProviderInstancesAuthVerifierFilter.java
@@ -26,6 +26,7 @@
@Component(
immediate = true,
property = {
+ "filter.init.auth.verifier.PortalSessionAuthVerifier.check.csrf.token=false",
"filter.init.auth.verifier.PortalSessionAuthVerifier.urls.includes=/dynamic-data-mapping-form-builder-data-provider-instances/\*",
"osgi.http.whiteboard.filter.name=com.liferay.dynamic.data.mapping.form.builder.internal.servlet.filter.DDMDataProviderInstancesAuthVerifierFilter",
"osgi.http.whiteboard.filter.pattern=/dynamic-data-mapping-form-builder-data-provider-instances/\*"
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-builder/src/main/java/com/liferay/dynamic/data/mapping/form/builder/internal/servlet/filter/DDMFieldSetDefinitionAuthVerifierFilter.java b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-builder/src/main/java/com/liferay/dynamic/data/mapping/form/builder/internal/servlet/filter/DDMFieldSetDefinitionAuthVerifierFilter.java
index 440ef1ca6ea1c4..860b6b39dcd75e 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-builder/src/main/java/com/liferay/dynamic/data/mapping/form/builder/internal/servlet/filter/DDMFieldSetDefinitionAuthVerifierFilter.java
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-builder/src/main/java/com/liferay/dynamic/data/mapping/form/builder/internal/servlet/filter/DDMFieldSetDefinitionAuthVerifierFilter.java
@@ -26,6 +26,7 @@
@Component(
immediate = true,
property = {
+ "filter.init.auth.verifier.PortalSessionAuthVerifier.check.csrf.token=false",
"filter.init.auth.verifier.PortalSessionAuthVerifier.urls.includes=/dynamic-data-mapping-form-builder-fieldset-definition/\*",
"osgi.http.whiteboard.filter.name=com.liferay.dynamic.data.mapping.form.builder.internal.servlet.filter.DDMFieldSetDefinitionAuthVerifierFilter",
"osgi.http.whiteboard.filter.pattern=/dynamic-data-mapping-form-builder-fieldset-definition/\*"
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-builder/src/main/java/com/liferay/dynamic/data/mapping/form/builder/internal/servlet/filter/DDMFieldSettingsDDMFormContextAuthVerifierFilter.java b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-builder/src/main/java/com/liferay/dynamic/data/mapping/form/builder/internal/servlet/filter/DDMFieldSettingsDDMFormContextAuthVerifierFilter.java
index 275283488ae73a..ae3c46138b1b0c 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-builder/src/main/java/com/liferay/dynamic/data/mapping/form/builder/internal/servlet/filter/DDMFieldSettingsDDMFormContextAuthVerifierFilter.java
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-builder/src/main/java/com/liferay/dynamic/data/mapping/form/builder/internal/servlet/filter/DDMFieldSettingsDDMFormContextAuthVerifierFilter.java
@@ -26,6 +26,7 @@
@Component(
immediate = true,
property = {
+ "filter.init.auth.verifier.PortalSessionAuthVerifier.check.csrf.token=false",
"filter.init.auth.verifier.PortalSessionAuthVerifier.urls.includes=/dynamic-data-mapping-form-builder-field-settings-form-context/\*",
"osgi.http.whiteboard.filter.name=com.liferay.dynamic.data.mapping.form.builder.internal.servlet.filter.DDMFieldSettingsDDMFormContextAuthVerifierFilter",
"osgi.http.whiteboard.filter.pattern=/dynamic-data-mapping-form-builder-field-settings-form-context/\*"
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-builder/src/main/java/com/liferay/dynamic/data/mapping/form/builder/internal/servlet/filter/DDMFormFunctionsAuthVerifierFilter.java b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-builder/src/main/java/com/liferay/dynamic/data/mapping/form/builder/internal/servlet/filter/DDMFormFunctionsAuthVerifierFilter.java
index ad05b1f8456e20..1a875a9f40f6e3 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-builder/src/main/java/com/liferay/dynamic/data/mapping/form/builder/internal/servlet/filter/DDMFormFunctionsAuthVerifierFilter.java
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-builder/src/main/java/com/liferay/dynamic/data/mapping/form/builder/internal/servlet/filter/DDMFormFunctionsAuthVerifierFilter.java
@@ -26,6 +26,7 @@
@Component(
immediate = true,
property = {
+ "filter.init.auth.verifier.PortalSessionAuthVerifier.check.csrf.token=false",
"filter.init.auth.verifier.PortalSessionAuthVerifier.urls.includes=/dynamic-data-mapping-form-builder-functions/\*",
"osgi.http.whiteboard.filter.name=com.liferay.dynamic.data.mapping.form.builder.internal.servlet.filter.DDMFormFunctionsAuthVerifierFilter",
"osgi.http.whiteboard.filter.pattern=/dynamic-data-mapping-form-builder-functions/\*"
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-builder/src/main/java/com/liferay/dynamic/data/mapping/form/builder/internal/servlet/filter/RolesAuthVerifierFilter.java b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-builder/src/main/java/com/liferay/dynamic/data/mapping/form/builder/internal/servlet/filter/RolesAuthVerifierFilter.java
index 71009e0142ac25..a3d2b1d7d864e5 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-builder/src/main/java/com/liferay/dynamic/data/mapping/form/builder/internal/servlet/filter/RolesAuthVerifierFilter.java
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-builder/src/main/java/com/liferay/dynamic/data/mapping/form/builder/internal/servlet/filter/RolesAuthVerifierFilter.java
@@ -26,6 +26,7 @@
@Component(
immediate = true,
property = {
+ "filter.init.auth.verifier.PortalSessionAuthVerifier.check.csrf.token=false",
"filter.init.auth.verifier.PortalSessionAuthVerifier.urls.includes=/dynamic-data-mapping-form-builder-roles/\*",
"osgi.http.whiteboard.filter.name=com.liferay.dynamic.data.mapping.form.builder.internal.servlet.filter.FieldSettingsDDMFormContextAuthVerifierFilter",
"osgi.http.whiteboard.filter.pattern=/dynamic-data-mapping-form-builder-roles/\*"
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-renderer/src/main/java/com/liferay/dynamic/data/mapping/form/renderer/internal/servlet/filter/DDMFormContextProviderAuthVerifierFilter.java b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-renderer/src/main/java/com/liferay/dynamic/data/mapping/form/renderer/internal/servlet/filter/DDMFormContextProviderAuthVerifierFilter.java
index a6e5f200ea3163..46ea82a2c5bfa1 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-renderer/src/main/java/com/liferay/dynamic/data/mapping/form/renderer/internal/servlet/filter/DDMFormContextProviderAuthVerifierFilter.java
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-renderer/src/main/java/com/liferay/dynamic/data/mapping/form/renderer/internal/servlet/filter/DDMFormContextProviderAuthVerifierFilter.java
@@ -26,6 +26,7 @@
@Component(
immediate = true,
property = {
+ "filter.init.auth.verifier.PortalSessionAuthVerifier.check.csrf.token=false",
"filter.init.auth.verifier.PortalSessionAuthVerifier.urls.includes=/dynamic-data-mapping-form-context-provider/\*",
"osgi.http.whiteboard.filter.name=com.liferay.dynamic.data.mapping.form.renderer.internal.servlet.filter.DDMFormContextProviderAuthVerifierFilter",
"osgi.http.whiteboard.filter.pattern=/dynamic-data-mapping-form-context-provider/\*"
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language.properties
index 5f7e89545cb564..a1073084e4c9d5 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language.properties
@@ -1,4 +1,6 @@
a-single-line=A Single Line
+access-local-network-description=Set if data providers have access to the local network.
+access-local-network-name=Access Local Network
action.ADD\_DATA\_PROVIDER\_INSTANCE=Add Data Provider Instance
action.ADD\_FORM\_INSTANCE=Add Form Instance
action.ADD\_FORM\_INSTANCE\_RECORD=Add Form Instance Record
@@ -70,6 +72,7 @@ data-providers=Data Providers
date-field-type-description=Select date from a Datepicker.
date-field-type-label=Date
ddm-data-provider=Dynamic Data Mapping Data Provider
+ddm-data-provider-configuration-name=Data Providers
ddm-form-web-configuration-name=Forms
ddm-service-configuration-name=Dynamic Data Mapping Service
ddm-structure-local-service=DDM Structure Local Service
@@ -321,6 +324,7 @@ unpublish-form=Unpublish Form
untitled-element-set=Untitled Element Set
untitled-form=Untitled Form
untitled-page-x-of-x=Untitled Page ({0} of {1})
+url-must-not-be-a-local-network=URL must not be a local network.
validation-failed-for-field-x=Validation failed for field "{0}".
variable=Variable
view-form=View Form
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_ar.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_ar.properties
index 01345c83ef7089..8dec7b4bdd7e14 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_ar.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_ar.properties
@@ -1,4 +1,6 @@
a-single-line= 
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=   
action.ADD\_FORM\_INSTANCE=  
action.ADD\_FORM\_INSTANCE\_RECORD=   
@@ -70,6 +72,7 @@ data-providers= 
date-field-type-description=    .
date-field-type-label=
ddm-data-provider=    
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=
ddm-service-configuration-name=   
ddm-structure-local-service=   DDM
@@ -321,6 +324,7 @@ unpublish-form=  
untitled-element-set=   
untitled-form=  
untitled-page-x-of-x= ({0}  {1})  
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=     "{0}".
variable=
view-form= 
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_bg.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_bg.properties
index 91f8ba8783c146..65f5b48528767f 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_bg.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_bg.properties
@@ -1,4 +1,6 @@
a-single-line=  (Automatic Translation)
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=      (Automatic Translation)
action.ADD\_FORM\_INSTANCE=    (Automatic Translation)
action.ADD\_FORM\_INSTANCE\_RECORD=    (Automatic Translation)
@@ -70,6 +72,7 @@ data-providers=   (Automatic Translation)
date-field-type-description=   Datepicker. (Automatic Translation)
date-field-type-label= (Automatic Translation)
ddm-data-provider=        (Automatic Translation)
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name= (Automatic Translation)
ddm-service-configuration-name=    (Automatic Translation)
ddm-structure-local-service=DDM    (Automatic Translation)
@@ -321,6 +324,7 @@ unpublish-form=    
untitled-element-set=   (Automatic Translation)
untitled-form=  (Automatic Translation)
untitled-page-x-of-x=Untitled Page ({0} of {1}) (Automatic Copy)
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validation failed for field "{0}". (Automatic Copy)
variable= (Automatic Translation)
view-form=   (Automatic Translation)
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_ca.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_ca.properties
index 233b8885097974..74e1aaf5b943d9 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_ca.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_ca.properties
@@ -1,4 +1,6 @@
a-single-line=Una sola lnia
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=Afegir una instncia del provedor de dades
action.ADD\_FORM\_INSTANCE=Afegeix la instncia del formulari
action.ADD\_FORM\_INSTANCE\_RECORD=Afegeix l'informe de la instncia del formulari
@@ -70,6 +72,7 @@ data-providers=Provedors de dades
date-field-type-description=Seleccioneu dates d'un selector de dates.
date-field-type-label=Data
ddm-data-provider=Provedor de Dades de Mapeig Dinmic
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=Formularis
ddm-service-configuration-name=Servei de mapeig de dades dinmic
ddm-structure-local-service=Servei local d'estructura DDM
@@ -321,6 +324,7 @@ unpublish-form=Anulla la publicaci del formulari
untitled-element-set=Conjunt d'elements sense ttol
untitled-form=Formulari sense nom
untitled-page-x-of-x=Pgina sense ttol ({0} de {1})
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validaci fallida pel camp "{0}".
variable=Variable
view-form=Visualitzaci del formulari
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_cs.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_cs.properties
index 489279b71e844a..e239e5460b498b 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_cs.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_cs.properties
@@ -1,4 +1,6 @@
a-single-line=Jeden dek (Automatic Translation)
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=Pidat instanci zprostedkovatele dat (Automatic Translation)
action.ADD\_FORM\_INSTANCE=Pidn Instance formule (Automatic Translation)
action.ADD\_FORM\_INSTANCE\_RECORD=Pidat zznam Instance Form (Automatic Translation)
@@ -70,6 +72,7 @@ data-providers=Zprostedkovatel dat (Automatic Translation)
date-field-type-description=Vyberte datum Datepicker. (Automatic Translation)
date-field-type-label=Datum (Automatic Translation)
ddm-data-provider=Dynamick Data mapovn dat zprostedkovatele (Automatic Translation)
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=Formule (Automatic Translation)
ddm-service-configuration-name=Dynamick Data mapov sluba (Automatic Translation)
ddm-structure-local-service=Lokln rozhran struktur dynamickho mapovn dat
@@ -321,6 +324,7 @@ unpublish-form=Zruen publikovn formule (Automatic Translation)
untitled-element-set=Bez nzvu prvku sada (Automatic Translation)
untitled-form=Formule bez nzvu (Automatic Translation)
untitled-page-x-of-x=Untitled Page ({0} of {1}) (Automatic Copy)
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validation failed for field "{0}". (Automatic Copy)
variable=Promnn
view-form=Zobrazit formul (Automatic Translation)
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_da.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_da.properties
index 2150a8960a074b..55011e187a92fa 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_da.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_da.properties
@@ -1,4 +1,6 @@
a-single-line=A Single Line (Automatic Copy)
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=Add Data Provider Instance (Automatic Copy)
action.ADD\_FORM\_INSTANCE=Add Form Instance (Automatic Copy)
action.ADD\_FORM\_INSTANCE\_RECORD=Add Form Instance Record (Automatic Copy)
@@ -70,6 +72,7 @@ data-providers=Data Providers (Automatic Copy)
date-field-type-description=Select date from a Datepicker. (Automatic Copy)
date-field-type-label=Date (Automatic Copy)
ddm-data-provider=Dynamic Data Mapping Data Provider (Automatic Copy)
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=Forms (Automatic Copy)
ddm-service-configuration-name=Dynamic Data kortlgningstjeneste (Automatic Translation)
ddm-structure-local-service=DDM Structure Local Service (Automatic Copy)
@@ -321,6 +324,7 @@ unpublish-form=Unpublish Form (Automatic Copy)
untitled-element-set=Untitled Element Set (Automatic Copy)
untitled-form=Untitled Form (Automatic Translation)
untitled-page-x-of-x=Untitled Page ({0} of {1}) (Automatic Copy)
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validation failed for field "{0}". (Automatic Copy)
variable=Variable (Automatic Copy)
view-form=View Form (Automatic Copy)
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_de.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_de.properties
index 28810587ecaf96..b2524c858f0410 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_de.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_de.properties
@@ -1,4 +1,6 @@
a-single-line=Eine einzelne Zeile
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=Datenanbieter hinzufgen
action.ADD\_FORM\_INSTANCE=Formularinstanz hinzufgen
action.ADD\_FORM\_INSTANCE\_RECORD=Formularinstanzaufzeichnung hinzufgen
@@ -70,6 +72,7 @@ data-providers=Datenanbieter
date-field-type-description=Whlen Sie ein Datum von einem Datumswhler aus.
date-field-type-label=Datum
ddm-data-provider=Datenanbieter fr die dynamische Datenzuordnung
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=Formulare
ddm-service-configuration-name=Dynamische Datenzuordnungen, Service
ddm-structure-local-service=Lokaler Service DDM-Struktur
@@ -321,6 +324,7 @@ unpublish-form=Formular zurckziehen
untitled-element-set=Unbenanntes Elementset
untitled-form=Unbenanntes Formular
untitled-page-x-of-x=Unbenannte Seite ({0} von {1})
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validierung des Feldes "{0}" fehlgeschlagen.
variable=Variable
view-form=Formular anzeigen
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_el.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_el.properties
index 8649a55a97b61e..2e84cdb7b0b48c 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_el.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_el.properties
@@ -1,4 +1,6 @@
a-single-line=   (Automatic Translation)
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=      (Automatic Translation)
action.ADD\_FORM\_INSTANCE=   (Automatic Translation)
action.ADD\_FORM\_INSTANCE\_RECORD=    (Automatic Translation)
@@ -70,6 +72,7 @@ data-providers=   (Automatic T
date-field-type-description=    Datepicker. (Automatic Translation)
date-field-type-label= (Automatic Translation)
ddm-data-provider=      (Automatic Translation)
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name= (Automatic Translation)
ddm-service-configuration-name=    (Automatic Translation)
ddm-structure-local-service=   DDM (Automatic Translation)
@@ -321,6 +324,7 @@ unpublish-form=   (Automatic
untitled-element-set=   (Automatic Translation)
untitled-form=  (Automatic Translation)
untitled-page-x-of-x=Untitled Page ({0} of {1}) (Automatic Copy)
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validation failed for field "{0}". (Automatic Copy)
variable= (Automatic Translation)
view-form=  (Automatic Translation)
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_en.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_en.properties
index 5f7e89545cb564..a1073084e4c9d5 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_en.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_en.properties
@@ -1,4 +1,6 @@
a-single-line=A Single Line
+access-local-network-description=Set if data providers have access to the local network.
+access-local-network-name=Access Local Network
action.ADD\_DATA\_PROVIDER\_INSTANCE=Add Data Provider Instance
action.ADD\_FORM\_INSTANCE=Add Form Instance
action.ADD\_FORM\_INSTANCE\_RECORD=Add Form Instance Record
@@ -70,6 +72,7 @@ data-providers=Data Providers
date-field-type-description=Select date from a Datepicker.
date-field-type-label=Date
ddm-data-provider=Dynamic Data Mapping Data Provider
+ddm-data-provider-configuration-name=Data Providers
ddm-form-web-configuration-name=Forms
ddm-service-configuration-name=Dynamic Data Mapping Service
ddm-structure-local-service=DDM Structure Local Service
@@ -321,6 +324,7 @@ unpublish-form=Unpublish Form
untitled-element-set=Untitled Element Set
untitled-form=Untitled Form
untitled-page-x-of-x=Untitled Page ({0} of {1})
+url-must-not-be-a-local-network=URL must not be a local network.
validation-failed-for-field-x=Validation failed for field "{0}".
variable=Variable
view-form=View Form
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_es.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_es.properties
index 32b4f73dd48879..6e3639db24c6fa 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_es.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_es.properties
@@ -1,4 +1,6 @@
a-single-line=Una lnea
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=Aadir instancia del proveedor de datos
action.ADD\_FORM\_INSTANCE=Aadir instancia de formulario
action.ADD\_FORM\_INSTANCE\_RECORD=Aadir registro de instancia de formulario
@@ -70,6 +72,7 @@ data-providers=Proveedores de datos
date-field-type-description=Seleccione una fecha con un selector de fecha.
date-field-type-label=Fecha
ddm-data-provider=Proveedor de datos para el mapeado dinmico de datos
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=Formularios
ddm-service-configuration-name=Servicio de mapeado dinmico de datos
ddm-structure-local-service=Servicio local de estructura de DDM
@@ -321,6 +324,7 @@ unpublish-form=Anular la publicacin de formulario
untitled-element-set=Conjunto de elementos sin ttulo
untitled-form=Formulario sin ttulo
untitled-page-x-of-x=Pgina sin nombre ({0} de {1})
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=La validacin ha fallado para el campo "{0}".
variable=Variable
view-form=Ver formulario
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_et.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_et.properties
index 0718d4184b2567..4667e9151345c2 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_et.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_et.properties
@@ -1,4 +1,6 @@
a-single-line=herealine (Automatic Translation)
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=Lisage andmete pakkuja eksemplar (Automatic Translation)
action.ADD\_FORM\_INSTANCE=Lisada vormi astme (Automatic Translation)
action.ADD\_FORM\_INSTANCE\_RECORD=Vormi astme kirje lisamine (Automatic Translation)
@@ -70,6 +72,7 @@ data-providers=Andmete esitajatele (Automatic Translation)
date-field-type-description=Valige kuupev on Datepicker. (Automatic Translation)
date-field-type-label=Kuupev (Automatic Translation)
ddm-data-provider=Dnaamilise kaardistamise andmepakkuja (Automatic Translation)
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=Vormid (Automatic Translation)
ddm-service-configuration-name=Dnaamilise kaardistamine teenus (Automatic Translation)
ddm-structure-local-service=DDM struktuuri kohalik teenus (Automatic Translation)
@@ -321,6 +324,7 @@ unpublish-form=Avaldamise vorm (Automatic Translation)
untitled-element-set=Nimetu Element komplekt (Automatic Translation)
untitled-form=Nimetu vorm (Automatic Translation)
untitled-page-x-of-x=Untitled Page ({0} of {1}) (Automatic Copy)
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validation failed for field "{0}". (Automatic Copy)
variable=Muutuja (Automatic Translation)
view-form=Vaate vorm (Automatic Translation)
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_eu.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_eu.properties
index 507ed720634b80..d5b8690f0fd41d 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_eu.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_eu.properties
@@ -1,4 +1,6 @@
a-single-line=A Single Line (Automatic Copy)
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=Add Data Provider Instance (Automatic Copy)
action.ADD\_FORM\_INSTANCE=Add Form Instance (Automatic Copy)
action.ADD\_FORM\_INSTANCE\_RECORD=Add Form Instance Record (Automatic Copy)
@@ -70,6 +72,7 @@ data-providers=Data Providers (Automatic Copy)
date-field-type-description=Select date from a Datepicker. (Automatic Copy)
date-field-type-label=Date (Automatic Copy)
ddm-data-provider=Dynamic Data Mapping Data Provider (Automatic Copy)
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=Forms (Automatic Copy)
ddm-service-configuration-name=Dynamic Data Mapping Service (Automatic Copy)
ddm-structure-local-service=DDM Structure Local Service (Automatic Copy)
@@ -321,6 +324,7 @@ unpublish-form=Unpublish Form (Automatic Copy)
untitled-element-set=Untitled Element Set (Automatic Copy)
untitled-form=Untitled Form (Automatic Copy)
untitled-page-x-of-x=Untitled Page ({0} of {1}) (Automatic Copy)
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validation failed for field "{0}". (Automatic Copy)
variable=Variable (Automatic Copy)
view-form=View Form (Automatic Copy)
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_fa.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_fa.properties
index fc97999822af3b..bf880863c68a57 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_fa.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_fa.properties
@@ -1,4 +1,6 @@
a-single-line=  (Automatic Translation)
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=     
action.ADD\_FORM\_INSTANCE=    (Automatic Translation)
action.ADD\_FORM\_INSTANCE\_RECORD=     (Automatic Translation)
@@ -70,6 +72,7 @@ data-providers=   (Automatic Translation)
date-field-type-description=  Datepicker  . (Automatic Translation)
date-field-type-label= (Automatic Translation)
ddm-data-provider=        (Automatic Translation)
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name= (Automatic Translation)
ddm-service-configuration-name=   
ddm-structure-local-service=DDM   
@@ -321,6 +324,7 @@ unpublish-form=  (Automatic Translation)
untitled-element-set=    (Automatic Translation)
untitled-form= 
untitled-page-x-of-x=   ({0} of {1})
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validation failed for field "{0}". (Automatic Copy)
variable=
view-form= 
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_fi.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_fi.properties
index bada8e90072c3d..2f2f33bd59d6d5 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_fi.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_fi.properties
@@ -1,4 +1,6 @@
a-single-line=Yksi rivi
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=Lis tietopalvelun esiintymt
action.ADD\_FORM\_INSTANCE=Lis Lomakeinstanssi
action.ADD\_FORM\_INSTANCE\_RECORD=Lis Lomakeinstanssitietue
@@ -70,6 +72,7 @@ data-providers=Tietolhteet
date-field-type-description=Valitse piv Pivmrvalitsimesta.
date-field-type-label=Pivmr
ddm-data-provider=Dynaaminen tietojen yhdistmisen tietopalvelu
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=Lomakkeet
ddm-service-configuration-name=Dynaaminen tietojen yhdistmispalvelu
ddm-structure-local-service=DDM-rakenne Paikallinen Palvelu
@@ -321,6 +324,7 @@ unpublish-form=Peruuta Lomakkeen Julkaisu
untitled-element-set=Otsikoimaton Elementti Asetettu
untitled-form=Nimetnlomake
untitled-page-x-of-x=Nimetn sivu ({0} / {1})
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Vahvistus eponnistui kentlle "{0}".
variable=Muuttuja
view-form=Nyt lomake
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_fr.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_fr.properties
index dfb148771fd6f2..a00f338e5ece8c 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_fr.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_fr.properties
@@ -1,4 +1,6 @@
a-single-line=Une seule ligne
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=Ajouter des exemples au fournisseur de donnes
action.ADD\_FORM\_INSTANCE=Ajouter une instance de formulaire
action.ADD\_FORM\_INSTANCE\_RECORD=Ajouter un enregistrement d'instance de formulaire
@@ -70,6 +72,7 @@ data-providers=Fournisseurs de donnes
date-field-type-description=Slectionnez une date dans un Datepicker.
date-field-type-label=Date
ddm-data-provider=Fournisseur de donnes de cartographie de donnes dynamiques
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=Formulaires
ddm-service-configuration-name=Service de cartographie de donnes dynamique
ddm-structure-local-service=Service local des structures de DDM (mapping de donnes dynamique)
@@ -321,6 +324,7 @@ unpublish-form=Annuler la publication du formulaire
untitled-element-set=Jeu d'lments sans titre
untitled-form=Formulaire sans titre
untitled-page-x-of-x=Page sans nom ({0} de {1})
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Echec de la validation du champ "{0}".
variable=Variable
view-form=Visualiser le formulaire
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_gl.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_gl.properties
index 9c7f6ae35c9455..efac413a5de416 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_gl.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_gl.properties
@@ -1,4 +1,6 @@
a-single-line=A Single Line (Automatic Copy)
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=Add Data Provider Instance (Automatic Copy)
action.ADD\_FORM\_INSTANCE=Add Form Instance (Automatic Copy)
action.ADD\_FORM\_INSTANCE\_RECORD=Add Form Instance Record (Automatic Copy)
@@ -70,6 +72,7 @@ data-providers=Data Providers (Automatic Copy)
date-field-type-description=Select date from a Datepicker. (Automatic Copy)
date-field-type-label=Date (Automatic Copy)
ddm-data-provider=Dynamic Data Mapping Data Provider (Automatic Copy)
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=Forms (Automatic Copy)
ddm-service-configuration-name=Dynamic Data Mapping Service (Automatic Copy)
ddm-structure-local-service=DDM Structure Local Service (Automatic Copy)
@@ -321,6 +324,7 @@ unpublish-form=Unpublish Form (Automatic Copy)
untitled-element-set=Untitled Element Set (Automatic Copy)
untitled-form=Untitled Form (Automatic Copy)
untitled-page-x-of-x=Untitled Page ({0} of {1}) (Automatic Copy)
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validation failed for field "{0}". (Automatic Copy)
variable=Variable (Automatic Copy)
view-form=View Form (Automatic Copy)
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_hi\_IN.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_hi\_IN.properties
index cabdeb8ab3de6c..30c0298e2c2d37 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_hi\_IN.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_hi\_IN.properties
@@ -1,4 +1,6 @@
a-single-line=   (Automatic Translation)
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=    (Automatic Translation)
action.ADD\_FORM\_INSTANCE=   (Automatic Translation)
action.ADD\_FORM\_INSTANCE\_RECORD=    (Automatic Translation)
@@ -70,6 +72,7 @@ data-providers=  (Automatic Translation)
date-field-type-description= Datepicker       (Automatic Translation)
date-field-type-label= (Automatic Translation)
ddm-data-provider=     (Automatic Translation)
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name= (Automatic Translation)
ddm-service-configuration-name=    (Automatic Translation)
ddm-structure-local-service=DDM    (Automatic Translation)
@@ -321,6 +324,7 @@ unpublish-form=   (A
untitled-element-set=   (Automatic Translation)
untitled-form=  (Automatic Translation)
untitled-page-x-of-x=Untitled Page ({0} of {1}) (Automatic Copy)
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validation failed for field "{0}". (Automatic Copy)
variable= (Automatic Translation)
view-form=  (Automatic Translation)
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_hr.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_hr.properties
index ec269191eaa9df..3f656e49902b27 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_hr.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_hr.properties
@@ -1,4 +1,6 @@
a-single-line=A Single Line (Automatic Copy)
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=Add Data Provider Instance (Automatic Copy)
action.ADD\_FORM\_INSTANCE=Add Form Instance (Automatic Copy)
action.ADD\_FORM\_INSTANCE\_RECORD=Add Form Instance Record (Automatic Copy)
@@ -70,6 +72,7 @@ data-providers=Data Providers (Automatic Copy)
date-field-type-description=Select date from a Datepicker. (Automatic Copy)
date-field-type-label=Date (Automatic Copy)
ddm-data-provider=Dynamic Data Mapping Data Provider (Automatic Copy)
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=Forms (Automatic Copy)
ddm-service-configuration-name=Dynamic Data Mapping Service (Automatic Copy)
ddm-structure-local-service=Lokalna usluga DDM strukture
@@ -321,6 +324,7 @@ unpublish-form=Unpublish Form (Automatic Copy)
untitled-element-set=Untitled Element Set (Automatic Copy)
untitled-form=Untitled Form (Automatic Copy)
untitled-page-x-of-x=Untitled Page ({0} of {1}) (Automatic Copy)
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validation failed for field "{0}". (Automatic Copy)
variable=Variable (Automatic Copy)
view-form=View Form (Automatic Copy)
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_hu.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_hu.properties
index 7520a085d487b8..24616c0866739c 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_hu.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_hu.properties
@@ -1,4 +1,6 @@
a-single-line=Egyetlen vonal
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=Adatszolgltati plda hozzadsa
action.ADD\_FORM\_INSTANCE=rlappldny hozzadsa
action.ADD\_FORM\_INSTANCE\_RECORD=rlappldny felvtelnek hozzadsa
@@ -70,6 +72,7 @@ data-providers=Adatszolgltatk
date-field-type-description=Vlasszon dtumot egy dtumvlasztbl.
date-field-type-label=Dtum
ddm-data-provider=Dinamikus adatlekpez adatszolgltat
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=rlapok
ddm-service-configuration-name=Dinamikus adatlekpez szolgltats
ddm-structure-local-service=DDM struktra helyi szolgltats
@@ -321,6 +324,7 @@ unpublish-form=Kzzttel visszavonsa
untitled-element-set=Nvtelen elemcsoport
untitled-form=Nvtelen rlap
untitled-page-x-of-x=sszesen {1}) oldalbl ({0} cm nlkli oldal
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=A "{0}" mez rvnyestse sikertelen.
variable=Vltoz
view-form=rlap megtekintse
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_in.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_in.properties
index cdd46ddb5a7575..7dd3f7b825324c 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_in.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_in.properties
@@ -1,4 +1,6 @@
a-single-line=Satu baris (Automatic Translation)
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=Tambahkan Data Provider contoh (Automatic Translation)
action.ADD\_FORM\_INSTANCE=Menambahkan contoh formulir (Automatic Translation)
action.ADD\_FORM\_INSTANCE\_RECORD=Tambahkan formulir contoh Record (Automatic Translation)
@@ -70,6 +72,7 @@ data-providers=Penyedia data (Automatic Translation)
date-field-type-description=Pilih tanggal dari Datepicker. (Automatic Translation)
date-field-type-label=Tanggal (Automatic Translation)
ddm-data-provider=Penyedia Data pemetaan Data dinamis (Automatic Translation)
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=Bentuk (Automatic Translation)
ddm-service-configuration-name=Layanan pemetaan Data dinamis (Automatic Translation)
ddm-structure-local-service=DDM struktur Layanan lokal (Automatic Translation)
@@ -321,6 +324,7 @@ unpublish-form=Menghentikan penayangan bentuk (Automatic Translation)
untitled-element-set=Untitled elemen Set (Automatic Translation)
untitled-form=Untitled bentuk (Automatic Translation)
untitled-page-x-of-x=Untitled Page ({0} of {1}) (Automatic Copy)
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validation failed for field "{0}". (Automatic Copy)
variable=Variabel (Automatic Translation)
view-form=Lihat formulir (Automatic Translation)
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_it.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_it.properties
index 8c997911f1f050..f5174db2cc6faf 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_it.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_it.properties
@@ -1,4 +1,6 @@
a-single-line=Una sola riga (Automatic Translation)
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=Aggiungi Istanza Provider Dati
action.ADD\_FORM\_INSTANCE=Aggiungi modulo istanza (Automatic Translation)
action.ADD\_FORM\_INSTANCE\_RECORD=Aggiungere Record di istanza del modulo (Automatic Translation)
@@ -70,6 +72,7 @@ data-providers=Provider di dati (Automatic Translation)
date-field-type-description=Selezionare data da un controllo Datepicker. (Automatic Translation)
date-field-type-label=Data (Automatic Translation)
ddm-data-provider=Provider Mappatura Dati Dinamici
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=Forme (Automatic Translation)
ddm-service-configuration-name=Servizio Mappatura Dati Dinamici
ddm-structure-local-service=Servizio Locale DDM Structure
@@ -321,6 +324,7 @@ unpublish-form=Annullare la pubblicazione di forma (Automatic Translation)
untitled-element-set=Insieme di elementi senza titolo (Automatic Translation)
untitled-form=Modulo Senza Nome
untitled-page-x-of-x=Pagina Senza Titolo ({0} di {1})
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validazione fallita per il campo "{0}".
variable=Variabile
view-form=Visualizza Modulo
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_iw.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_iw.properties
index e5faeb69319e4b..1c5780fe81ac59 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_iw.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_iw.properties
@@ -1,4 +1,6 @@
a-single-line= 
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=   
action.ADD\_FORM\_INSTANCE=  
action.ADD\_FORM\_INSTANCE\_RECORD=   
@@ -70,6 +72,7 @@ data-providers= 
date-field-type-description=   .
date-field-type-label=
ddm-data-provider=    
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=
ddm-service-configuration-name=   
ddm-structure-local-service=   DDM
@@ -321,6 +324,7 @@ unpublish-form=  
untitled-element-set=   
untitled-form=  
untitled-page-x-of-x=   ({0}  {1})
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=    "{0}".
variable=
view-form= 
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_ja.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_ja.properties
index be12bf81cf6dd5..ba6ede5a50d801 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_ja.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_ja.properties
@@ -1,4 +1,6 @@
a-single-line=
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=
action.ADD\_FORM\_INSTANCE=
action.ADD\_FORM\_INSTANCE\_RECORD=
@@ -70,6 +72,7 @@ data-providers=
date-field-type-description=Datepicker 
date-field-type-label=
ddm-data-provider=
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=
ddm-service-configuration-name=
ddm-structure-local-service=DDM 
@@ -321,6 +324,7 @@ unpublish-form=
untitled-element-set=
untitled-form=
untitled-page-x-of-x={1} {0} 
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x={0}
variable=
view-form=
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_kk.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_kk.properties
index 920b18be3453b7..c219d27fde48b0 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_kk.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_kk.properties
@@ -1,4 +1,6 @@
a-single-line=A Single Line (Automatic Copy)
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=Add Data Provider Instance (Automatic Copy)
action.ADD\_FORM\_INSTANCE=Add Form Instance (Automatic Copy)
action.ADD\_FORM\_INSTANCE\_RECORD=Add Form Instance Record (Automatic Copy)
@@ -70,6 +72,7 @@ data-providers=Data Providers (Automatic Copy)
date-field-type-description=Select date from a Datepicker. (Automatic Copy)
date-field-type-label=Date (Automatic Copy)
ddm-data-provider=Dynamic Data Mapping Data Provider (Automatic Copy)
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=Forms (Automatic Copy)
ddm-service-configuration-name=Dynamic Data Mapping Service (Automatic Copy)
ddm-structure-local-service=DDM Structure Local Service (Automatic Copy)
@@ -321,6 +324,7 @@ unpublish-form=Unpublish Form (Automatic Copy)
untitled-element-set=Untitled Element Set (Automatic Copy)
untitled-form=Untitled Form (Automatic Copy)
untitled-page-x-of-x=Untitled Page ({0} of {1}) (Automatic Copy)
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validation failed for field "{0}". (Automatic Copy)
variable=Variable (Automatic Copy)
view-form=View Form (Automatic Copy)
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_ko.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_ko.properties
index 80a74f8a8be54e..8b64e89dd045cd 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_ko.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_ko.properties
@@ -1,4 +1,6 @@
a-single-line=  (Automatic Translation)
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=    (Automatic Translation)
action.ADD\_FORM\_INSTANCE=   (Automatic Translation)
action.ADD\_FORM\_INSTANCE\_RECORD=    (Automatic Translation)
@@ -70,6 +72,7 @@ data-providers=  (Automatic Translation)
date-field-type-description=Datepicker   . (Automatic Translation)
date-field-type-label= (Automatic Translation)
ddm-data-provider=     (Automatic Translation)
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name= (Automatic Translation)
ddm-service-configuration-name=    (Automatic Translation)
ddm-structure-local-service=DDM    (Automatic Translation)
@@ -321,6 +324,7 @@ unpublish-form=  (Automatic Translation)
untitled-element-set=   (Automatic Translation)
untitled-form=   (Automatic Translation)
untitled-page-x-of-x=Untitled Page ({0} of {1}) (Automatic Copy)
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validation failed for field "{0}". (Automatic Copy)
variable= (Automatic Translation)
view-form=  (Automatic Translation)
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_lo.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_lo.properties
index 0233880ec726d5..653aa5d36a8fd3 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_lo.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_lo.properties
@@ -1,4 +1,6 @@
a-single-line=A Single Line (Automatic Copy)
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=Add Data Provider Instance (Automatic Copy)
action.ADD\_FORM\_INSTANCE=Add Form Instance (Automatic Copy)
action.ADD\_FORM\_INSTANCE\_RECORD=Add Form Instance Record (Automatic Copy)
@@ -70,6 +72,7 @@ data-providers=Data Providers (Automatic Copy)
date-field-type-description=Select date from a Datepicker. (Automatic Copy)
date-field-type-label=Date (Automatic Copy)
ddm-data-provider=Dynamic Data Mapping Data Provider (Automatic Copy)
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=Forms (Automatic Copy)
ddm-service-configuration-name=Dynamic Data Mapping Service (Automatic Copy)
ddm-structure-local-service=DDM Structure Local Service (Automatic Copy)
@@ -321,6 +324,7 @@ unpublish-form=Unpublish Form (Automatic Copy)
untitled-element-set=Untitled Element Set (Automatic Copy)
untitled-form=Untitled Form (Automatic Copy)
untitled-page-x-of-x=Untitled Page ({0} of {1}) (Automatic Copy)
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validation failed for field "{0}". (Automatic Copy)
variable=Variable (Automatic Copy)
view-form=View Form (Automatic Copy)
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_lt.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_lt.properties
index 9baee914f675a2..c478dbdbba196c 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_lt.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_lt.properties
@@ -1,4 +1,6 @@
a-single-line=Vienoje eilutje (Automatic Translation)
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=Pridti duomen teikjo egzempliorius (Automatic Translation)
action.ADD\_FORM\_INSTANCE=Pridti formos egzempliori (Automatic Translation)
action.ADD\_FORM\_INSTANCE\_RECORD=Formos egzemplioriaus rao traukimas (Automatic Translation)
@@ -70,6 +72,7 @@ data-providers=Duomen teikjai (Automatic Translation)
date-field-type-description=Pasirinkite data yra datos pasirinkimui. (Automatic Translation)
date-field-type-label=Data (Automatic Translation)
ddm-data-provider=Dinamini duomen atvaizdavimo duomen teikjas (Automatic Translation)
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=Form (Automatic Translation)
ddm-service-configuration-name=Dinamini duomen atvaizdavimo paslaugos (Automatic Translation)
ddm-structure-local-service=Deividas struktros vietos paslaug (Automatic Translation)
@@ -321,6 +324,7 @@ unpublish-form=Anuliuoti publikavim forma (Automatic Translation)
untitled-element-set=Be pavadinimo element rinkinys (Automatic Translation)
untitled-form=Nevardinta forma (Automatic Translation)
untitled-page-x-of-x=Untitled Page ({0} of {1}) (Automatic Copy)
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validation failed for field "{0}". (Automatic Copy)
variable=Kintamasis (Automatic Translation)
view-form=Rodyti form (Automatic Translation)
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_nb.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_nb.properties
index 0acbd2198260cd..7be55ec043ea8d 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_nb.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_nb.properties
@@ -1,4 +1,6 @@
a-single-line=n linje (Automatic Translation)
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=Legge til Data Provider forekomst (Automatic Translation)
action.ADD\_FORM\_INSTANCE=Legge til skjemaet forekomst (Automatic Translation)
action.ADD\_FORM\_INSTANCE\_RECORD=Legge til skjemaet forekomst post (Automatic Translation)
@@ -70,6 +72,7 @@ data-providers=Dataleverandrer (Automatic Translation)
date-field-type-description=Velge dato fra en Datepicker. (Automatic Translation)
date-field-type-label=Dato (Automatic Translation)
ddm-data-provider=Dataleverandren for dynamisk tilordning (Automatic Translation)
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=Skjemaer (Automatic Translation)
ddm-service-configuration-name=Tilordningstjenesten for dynamiske Data (Automatic Translation)
ddm-structure-local-service=Lokal tjeneste for DDM struktuerer
@@ -321,6 +324,7 @@ unpublish-form=Publiseringen av skjemaet (Automatic Translation)
untitled-element-set=Untitled elementsett (Automatic Translation)
untitled-form=Skjema uten navn (Automatic Translation)
untitled-page-x-of-x=Untitled Page ({0} of {1}) (Automatic Copy)
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validation failed for field "{0}". (Automatic Copy)
variable=Variabel
view-form=Vis skjema (Automatic Translation)
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_nl.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_nl.properties
index 93d72f27cb8056..ab6cea60b38bf3 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_nl.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_nl.properties
@@ -1,4 +1,6 @@
a-single-line=Een enkele lijn
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=Dataprovider geval toevoegen
action.ADD\_FORM\_INSTANCE=Formulierinstantie toevoegen
action.ADD\_FORM\_INSTANCE\_RECORD=Invoer formulierinstantie toevoegen
@@ -70,6 +72,7 @@ data-providers=Dataproviders
date-field-type-description=Selecteer een datum in een datumkiezer.
date-field-type-label=Datum
ddm-data-provider=Dynamische data-indeling indelingsprovider
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=Formulieren
ddm-service-configuration-name=Dynamische gegevensindeling service
ddm-structure-local-service=DDM-structuur lokale service
@@ -321,6 +324,7 @@ unpublish-form=Publicatie formulier ongedaan maken
untitled-element-set=Elementenset zonder titel
untitled-form=Naamloos formulier
untitled-page-x-of-x=Naamloze pagina ({0} van {1})
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validatie mislukt voor veld "{0}".
variable=Variabele
view-form=Formulier bekijken
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_nl\_BE.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_nl\_BE.properties
index e7d17d1bde870c..515da7a6fad550 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_nl\_BE.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_nl\_BE.properties
@@ -1,4 +1,6 @@
a-single-line=A Single Line (Automatic Copy)
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=Add Data Provider Instance (Automatic Copy)
action.ADD\_FORM\_INSTANCE=Add Form Instance (Automatic Copy)
action.ADD\_FORM\_INSTANCE\_RECORD=Add Form Instance Record (Automatic Copy)
@@ -70,6 +72,7 @@ data-providers=Data Providers (Automatic Copy)
date-field-type-description=Select date from a Datepicker. (Automatic Copy)
date-field-type-label=Date (Automatic Copy)
ddm-data-provider=Dynamic Data Mapping Data Provider (Automatic Copy)
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=Forms (Automatic Copy)
ddm-service-configuration-name=Dynamische gegevens kaartservice op Internet (Automatic Translation)
ddm-structure-local-service=DDM structuur lokale Service (Automatic Translation)
@@ -321,6 +324,7 @@ unpublish-form=Unpublish Form (Automatic Copy)
untitled-element-set=Untitled Element Set (Automatic Copy)
untitled-form=Untitled formulier (Automatic Translation)
untitled-page-x-of-x=Untitled Page ({0} of {1}) (Automatic Copy)
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validation failed for field "{0}". (Automatic Copy)
variable=Variabele (Automatic Translation)
view-form=View Form (Automatic Copy)
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_pl.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_pl.properties
index ed33b85e2fe10f..8711140564b0a6 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_pl.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_pl.properties
@@ -1,4 +1,6 @@
a-single-line=Pojedynczy wiersz (Automatic Translation)
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=Doda wystpienie dostawcy danych (Automatic Translation)
action.ADD\_FORM\_INSTANCE=Dodaj wystpienie formularza (Automatic Translation)
action.ADD\_FORM\_INSTANCE\_RECORD=Dodaj rekord wystpienie formularza (Automatic Translation)
@@ -70,6 +72,7 @@ data-providers=Dostawcw danych (Automatic Translation)
date-field-type-description=Wybierz dat z Datepicker. (Automatic Translation)
date-field-type-label=Data (Automatic Translation)
ddm-data-provider=Dostawca danych mapowania danych dynamicznych (Automatic Translation)
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=Formularze (Automatic Translation)
ddm-service-configuration-name=Usuga mapowania danych dynamicznych (Automatic Translation)
ddm-structure-local-service=Lokalny serwis struktur DMD
@@ -321,6 +324,7 @@ unpublish-form=Cofnij publikowanie formularza (Automatic Translation)
untitled-element-set=Element bez nazwy zestawu (Automatic Translation)
untitled-form=Bez tytuu formularza (Automatic Translation)
untitled-page-x-of-x=Untitled Page ({0} of {1}) (Automatic Copy)
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validation failed for field "{0}". (Automatic Copy)
variable=Zmienna
view-form=Widok formularza (Automatic Translation)
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_pt\_BR.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_pt\_BR.properties
index 5d24656d3c7c8e..fe5b5c829012cb 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_pt\_BR.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_pt\_BR.properties
@@ -1,4 +1,6 @@
a-single-line=Uma nica linha
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=Adicionar instncia de provedor de dados
action.ADD\_FORM\_INSTANCE=Adicionar instncia de formulrio
action.ADD\_FORM\_INSTANCE\_RECORD=Adicionar entrada de instncia de formulrio
@@ -70,6 +72,7 @@ data-providers=Provedores de dados
date-field-type-description=Selecione a data de um Seletor de Data.
date-field-type-label=Data
ddm-data-provider=Provedor de Dados
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=Formulrios
ddm-service-configuration-name=Servio de mapeamento de dados dinmicos
ddm-structure-local-service=DDM Structure Local Service
@@ -321,6 +324,7 @@ unpublish-form=Cancelar a publicao do formulrio
untitled-element-set=Conjunto de elementos sem Ttulo
untitled-form=Formulrio sem Ttulo
untitled-page-x-of-x=Pgina sem ttulo ({0} de {1})
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validao falhou para o campo "{0}".
variable=Varivel
view-form=Visualizar formulrio
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_pt\_PT.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_pt\_PT.properties
index ca8c5eb6a12d7e..45d772287b86b0 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_pt\_PT.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_pt\_PT.properties
@@ -1,4 +1,6 @@
a-single-line=Uma nica linha (Automatic Translation)
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=Adicionar instncia de provedor de dados
action.ADD\_FORM\_INSTANCE=Adicionar a instncia do formulrio (Automatic Translation)
action.ADD\_FORM\_INSTANCE\_RECORD=Adicionar registro de instncia de formulrio (Automatic Translation)
@@ -70,6 +72,7 @@ data-providers=Provedores de dados (Automatic Translation)
date-field-type-description=Selecione a data de um Datepicker. (Automatic Translation)
date-field-type-label=Data (Automatic Translation)
ddm-data-provider=Provedor de Dados de Mapeamento de Dados Dinmicos
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=Formulrios
ddm-service-configuration-name=Servio de mapeamento de dados dinmicos
ddm-structure-local-service=DDM Structure Local Service
@@ -321,6 +324,7 @@ unpublish-form=Unpublish Form (Automatic Copy)
untitled-element-set=Conjunto de elemento sem ttulo (Automatic Translation)
untitled-form=Formulrio sem Ttulo
untitled-page-x-of-x=Pgina sem Ttulo ({0} de {1})
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validao falhou para o campo "{0}".
variable=Varivel
view-form=Ver Formulrio
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_ro.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_ro.properties
index c98e9804ab78e0..11e2cedd933fe2 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_ro.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_ro.properties
@@ -1,4 +1,6 @@
a-single-line=O singur linie (Automatic Translation)
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=Adauga instanta de furnizor de date (Automatic Translation)
action.ADD\_FORM\_INSTANCE=Adauga forma instanta (Automatic Translation)
action.ADD\_FORM\_INSTANCE\_RECORD=Adauga Record de exemplu formular (Automatic Translation)
@@ -70,6 +72,7 @@ data-providers=Furnizori de date (Automatic Translation)
date-field-type-description=Selectai data la o Datepicker. (Automatic Translation)
date-field-type-label=Data (Automatic Translation)
ddm-data-provider=Furnizor de date dinamic date de cartografiere (Automatic Translation)
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=Forme (Automatic Translation)
ddm-service-configuration-name=Servicii de cartografiere date dinamice (Automatic Translation)
ddm-structure-local-service=IOANA structura Local de servicii (Automatic Translation)
@@ -321,6 +324,7 @@ unpublish-form=Publicare formular (Automatic Translation)
untitled-element-set=Set Element fr titlu (Automatic Translation)
untitled-form=Formular fr titlu (Automatic Translation)
untitled-page-x-of-x=Untitled Page ({0} of {1}) (Automatic Copy)
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validation failed for field "{0}". (Automatic Copy)
variable=Variabila (Automatic Translation)
view-form=Vezi formular (Automatic Translation)
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_ru.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_ru.properties
index 28d453cc5aaece..373744ff8277ed 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_ru.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_ru.properties
@@ -1,4 +1,6 @@
a-single-line=  (Automatic Translation)
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=    (Automatic Translation)
action.ADD\_FORM\_INSTANCE=   (Automatic Translation)
action.ADD\_FORM\_INSTANCE\_RECORD=    (Automatic Translation)
@@ -70,6 +72,7 @@ data-providers=  (Automatic Translation)
date-field-type-description=    Datepicker. (Automatic Translation)
date-field-type-label= (Automatic Translation)
ddm-data-provider=     (Automatic Translation)
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name= (Automatic Translation)
ddm-service-configuration-name=    (Automatic Translation)
ddm-structure-local-service=DDM Structure Local Service
@@ -321,6 +324,7 @@ unpublish-form=   (Automatic Translati
untitled-element-set=    (Automatic Translation)
untitled-form=   (Automatic Translation)
untitled-page-x-of-x=Untitled Page ({0} of {1}) (Automatic Copy)
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validation failed for field "{0}". (Automatic Copy)
variable=
view-form=  (Automatic Translation)
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_sk.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_sk.properties
index 31dd7184c5ad5d..15606d6856021a 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_sk.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_sk.properties
@@ -1,4 +1,6 @@
a-single-line=Jeden riadok (Automatic Translation)
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=Prida intancia poskytovatea dajov (Automatic Translation)
action.ADD\_FORM\_INSTANCE=Prida intanciu formulra (Automatic Translation)
action.ADD\_FORM\_INSTANCE\_RECORD=Prida formulr stupa zznam (Automatic Translation)
@@ -70,6 +72,7 @@ data-providers=Poskytovatelia dajov (Automatic Translation)
date-field-type-description=Vyberte dtum z Datepicker. (Automatic Translation)
date-field-type-label=Dtum (Automatic Translation)
ddm-data-provider=Dynamic Data mapovanie dajov poskytovatea (Automatic Translation)
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=Formulre (Automatic Translation)
ddm-service-configuration-name=Dynamick daje mapovacej sluby (Automatic Translation)
ddm-structure-local-service=Loklna sluba mapovacch truktr dajov.
@@ -321,6 +324,7 @@ unpublish-form=Publikovanie formulra (Automatic Translation)
untitled-element-set=Sbor bez nzvu prvku (Automatic Translation)
untitled-form=Formulr bez nzvu (Automatic Translation)
untitled-page-x-of-x=Untitled Page ({0} of {1}) (Automatic Copy)
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validation failed for field "{0}". (Automatic Copy)
variable=Premenn
view-form=Zobrazi formulr (Automatic Translation)
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_sl.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_sl.properties
index 802432405a5fb1..9e52aab91514a8 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_sl.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_sl.properties
@@ -1,4 +1,6 @@
a-single-line=V eni vrstici (Automatic Translation)
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=Dodajanje podatkov ponudnika stopnje (Automatic Translation)
action.ADD\_FORM\_INSTANCE=Dodaj obliko stopnje (Automatic Translation)
action.ADD\_FORM\_INSTANCE\_RECORD=Dodaj obliko stopnje zapis (Automatic Translation)
@@ -70,6 +72,7 @@ data-providers=Ponudniki podatkov (Automatic Translation)
date-field-type-description=Izberite datum na izbirnik datuma. (Automatic Translation)
date-field-type-label=Datum (Automatic Translation)
ddm-data-provider=Ponudnik podatkov kartiranje dinaminih podatkov (Automatic Translation)
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=Oblike (Automatic Translation)
ddm-service-configuration-name=Dynamic Data kartograf usluga (Automatic Translation)
ddm-structure-local-service=DDM strukturo Lokalna storitev (Automatic Translation)
@@ -321,6 +324,7 @@ unpublish-form=Prekliite objavo obrazca (Automatic Translation)
untitled-element-set=Neimenovan Element Set (Automatic Translation)
untitled-form=Neimenovan obrazec (Automatic Translation)
untitled-page-x-of-x=Untitled Page ({0} of {1}) (Automatic Copy)
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validation failed for field "{0}". (Automatic Copy)
variable=Spremenljivka (Automatic Translation)
view-form=Pogled obrazca (Automatic Translation)
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_sr\_RS.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_sr\_RS.properties
index e195cfc9395d9e..4786d74985af43 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_sr\_RS.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_sr\_RS.properties
@@ -1,4 +1,6 @@
a-single-line=A Single Line (Automatic Copy)
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=Add Data Provider Instance (Automatic Copy)
action.ADD\_FORM\_INSTANCE=Add Form Instance (Automatic Copy)
action.ADD\_FORM\_INSTANCE\_RECORD=Add Form Instance Record (Automatic Copy)
@@ -70,6 +72,7 @@ data-providers=Data Providers (Automatic Copy)
date-field-type-description=Select date from a Datepicker. (Automatic Copy)
date-field-type-label=Date (Automatic Copy)
ddm-data-provider=Dynamic Data Mapping Data Provider (Automatic Copy)
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=Forms (Automatic Copy)
ddm-service-configuration-name=Dynamic Data Mapping Service (Automatic Copy)
ddm-structure-local-service=DDM Structure Local Service (Automatic Copy)
@@ -321,6 +324,7 @@ unpublish-form=Unpublish Form (Automatic Copy)
untitled-element-set=Untitled Element Set (Automatic Copy)
untitled-form=Untitled Form (Automatic Copy)
untitled-page-x-of-x=Untitled Page ({0} of {1}) (Automatic Copy)
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validation failed for field "{0}". (Automatic Copy)
variable=Variable (Automatic Copy)
view-form=View Form (Automatic Copy)
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_sr\_RS\_latin.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_sr\_RS\_latin.properties
index ab42e56c197199..822910925d2e90 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_sr\_RS\_latin.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_sr\_RS\_latin.properties
@@ -1,4 +1,6 @@
a-single-line=A Single Line (Automatic Copy)
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=Add Data Provider Instance (Automatic Copy)
action.ADD\_FORM\_INSTANCE=Add Form Instance (Automatic Copy)
action.ADD\_FORM\_INSTANCE\_RECORD=Add Form Instance Record (Automatic Copy)
@@ -70,6 +72,7 @@ data-providers=Data Providers (Automatic Copy)
date-field-type-description=Select date from a Datepicker. (Automatic Copy)
date-field-type-label=Date (Automatic Copy)
ddm-data-provider=Dynamic Data Mapping Data Provider (Automatic Copy)
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=Forms (Automatic Copy)
ddm-service-configuration-name=Dynamic Data Mapping Service (Automatic Copy)
ddm-structure-local-service=DDM Structure Local Service (Automatic Copy)
@@ -321,6 +324,7 @@ unpublish-form=Unpublish Form (Automatic Copy)
untitled-element-set=Untitled Element Set (Automatic Copy)
untitled-form=Untitled Form (Automatic Copy)
untitled-page-x-of-x=Untitled Page ({0} of {1}) (Automatic Copy)
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validation failed for field "{0}". (Automatic Copy)
variable=Variable (Automatic Copy)
view-form=View Form (Automatic Copy)
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_sv.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_sv.properties
index 9b8c8850adc2bc..10e82fdff8be87 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_sv.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_sv.properties
@@ -1,4 +1,6 @@
a-single-line=Enkel rad
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=Lgg till dataprovider-instans
action.ADD\_FORM\_INSTANCE=Lgg till formulrinstans
action.ADD\_FORM\_INSTANCE\_RECORD=Lgg till formulrinstanspost
@@ -70,6 +72,7 @@ data-providers=Dataproviders
date-field-type-description=Vlj ett datum frn en datumvljare.
date-field-type-label=Datum
ddm-data-provider=Dataprovider fr dynamisk datamappning
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=Formulr
ddm-service-configuration-name=Tjnst fr dynamisk datamappning
ddm-structure-local-service=Lokal tjnst fr DDM-struktur
@@ -321,6 +324,7 @@ unpublish-form=Avpublicera formulr
untitled-element-set=Namnls elementuppsttning
untitled-form=Namnlst formulr
untitled-page-x-of-x=Namnls sida ({0} av {1})
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Det gick inte att validera fltet "{0}".
variable=Variabel
view-form=Visa formulr
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_th.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_th.properties
index ffc2d3eb3b9ef8..7ce9911d65189d 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_th.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_th.properties
@@ -1,4 +1,6 @@
a-single-line= (Automatic Translation)
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE= (Automatic Translation)
action.ADD\_FORM\_INSTANCE= (Automatic Translation)
action.ADD\_FORM\_INSTANCE\_RECORD= (Automatic Translation)
@@ -70,6 +72,7 @@ data-providers= (Automatic
date-field-type-description= (Automatic Translation)
date-field-type-label= (Automatic Translation)
ddm-data-provider= (Automatic Translation)
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name= (Automatic Translation)
ddm-service-configuration-name= (Automatic Translation)
ddm-structure-local-service= DDM (Automatic Translation)
@@ -321,6 +324,7 @@ unpublish-form=
untitled-element-set= (Automatic Translation)
untitled-form= (Automatic Translation)
untitled-page-x-of-x=Untitled Page ({0} of {1}) (Automatic Copy)
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validation failed for field "{0}". (Automatic Copy)
variable= (Automatic Translation)
view-form= (Automatic Translation)
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_tr.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_tr.properties
index e4f0a2cba52d2c..ced9f4729b22b3 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_tr.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_tr.properties
@@ -1,4 +1,6 @@
a-single-line=Tek bir satr (Automatic Translation)
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=Veri salaycs rnei ekleyin (Automatic Translation)
action.ADD\_FORM\_INSTANCE=Form rnei ekleme (Automatic Translation)
action.ADD\_FORM\_INSTANCE\_RECORD=Form rnei kayd ekleme (Automatic Translation)
@@ -70,6 +72,7 @@ data-providers=Veri salayclar (Automatic Translation)
date-field-type-description=Tarihi bir Datepicker sein. (Automatic Translation)
date-field-type-label=Tarihi (Automatic Translation)
ddm-data-provider=Dinamik veri eleme veri salaycs (Automatic Translation)
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=Formlar (Automatic Translation)
ddm-service-configuration-name=Dinamik veri eleme hizmeti (Automatic Translation)
ddm-structure-local-service=DDM yaps yerel hizmet (Automatic Translation)
@@ -321,6 +324,7 @@ unpublish-form=Form yaymdan kaldrma (Automatic Translation)
untitled-element-set=Adsz e kmesi (Automatic Translation)
untitled-form=Adsz Form (Automatic Translation)
untitled-page-x-of-x=Untitled Page ({0} of {1}) (Automatic Copy)
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validation failed for field "{0}". (Automatic Copy)
variable=Deiken (Automatic Translation)
view-form=Formunu grntle (Automatic Translation)
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_uk.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_uk.properties
index 0bc7d414ed4dea..aa62b1e1b1b473 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_uk.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_uk.properties
@@ -1,4 +1,6 @@
a-single-line=  (Automatic Translation)
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=    (Automatic Translation)
action.ADD\_FORM\_INSTANCE=   (Automatic Translation)
action.ADD\_FORM\_INSTANCE\_RECORD=    (Automatic Translation)
@@ -70,6 +72,7 @@ data-providers=  (Automatic Translation)
date-field-type-description=   . (Automatic Translation)
date-field-type-label= (Automatic Translation)
ddm-data-provider=     (Automatic Translation)
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name= (Automatic Translation)
ddm-service-configuration-name=    (Automatic Translation)
ddm-structure-local-service=    (Automatic Translation)
@@ -321,6 +324,7 @@ unpublish-form=   (Automatic T
untitled-element-set=    (Automatic Translation)
untitled-form=   (Automatic Translation)
untitled-page-x-of-x=Untitled Page ({0} of {1}) (Automatic Copy)
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validation failed for field "{0}". (Automatic Copy)
variable= (Automatic Translation)
view-form=  (Automatic Translation)
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_vi.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_vi.properties
index 470833d369cdc0..a47a6e93fce10f 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_vi.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_vi.properties
@@ -1,4 +1,6 @@
a-single-line=Mt dng (Automatic Translation)
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=Thm d liu nh cung cp v d (Automatic Translation)
action.ADD\_FORM\_INSTANCE=Thm hnh thc th hin (Automatic Translation)
action.ADD\_FORM\_INSTANCE\_RECORD=Thm hnh thc th hin ghi (Automatic Translation)
@@ -70,6 +72,7 @@ data-providers=Nh cung cp d liu (Automatic Translation)
date-field-type-description=Chn ngy mt Datepicker. (Automatic Translation)
date-field-type-label=Ngy (Automatic Translation)
ddm-data-provider=D liu ng lp bn  d liu nh cung cp (Automatic Translation)
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=Cc hnh thc (Automatic Translation)
ddm-service-configuration-name=Dch v lp bn  nng ng d liu (Automatic Translation)
ddm-structure-local-service=DDM Structure Local Service
@@ -321,6 +324,7 @@ unpublish-form=Khng xut bn di hnh thc (Automatic Translation)
untitled-element-set=Cha t tn nguyn t thit lp (Automatic Translation)
untitled-form=Cha c tiu  mu (Automatic Translation)
untitled-page-x-of-x=Untitled Page ({0} of {1}) (Automatic Copy)
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validation failed for field "{0}". (Automatic Copy)
variable=Bin
view-form=Xem mu (Automatic Translation)
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_zh\_CN.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_zh\_CN.properties
index 8b83c5baa40c1c..d1ecfcdd07eff7 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_zh\_CN.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_zh\_CN.properties
@@ -1,4 +1,6 @@
a-single-line=
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE=
action.ADD\_FORM\_INSTANCE=
action.ADD\_FORM\_INSTANCE\_RECORD=
@@ -70,6 +72,7 @@ data-providers=
date-field-type-description=Datepicker
date-field-type-label=
ddm-data-provider=
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name=
ddm-service-configuration-name=
ddm-structure-local-service=
@@ -321,6 +324,7 @@ unpublish-form=
untitled-element-set=
untitled-form=
untitled-page-x-of-x= ({0}  {1})
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x= "{0}"
variable=
view-form=
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_zh\_TW.properties b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_zh\_TW.properties
index 1ef57a202167cf..aea6bb582591c8 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_zh\_TW.properties
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-lang/src/main/resources/content/Language\_zh\_TW.properties
@@ -1,4 +1,6 @@
a-single-line= (Automatic Translation)
+access-local-network-description=Set if data providers have access to the local network. (Automatic Copy)
+access-local-network-name=Access Local Network (Automatic Copy)
action.ADD\_DATA\_PROVIDER\_INSTANCE= (Automatic Translation)
action.ADD\_FORM\_INSTANCE= (Automatic Translation)
action.ADD\_FORM\_INSTANCE\_RECORD= (Automatic Translation)
@@ -70,6 +72,7 @@ data-providers= (Automatic Translation)
date-field-type-description= Datepicker  (Automatic Translation)
date-field-type-label= (Automatic Translation)
ddm-data-provider= (Automatic Translation)
+ddm-data-provider-configuration-name=Data Providers (Automatic Copy)
ddm-form-web-configuration-name= (Automatic Translation)
ddm-service-configuration-name= (Automatic Translation)
ddm-structure-local-service=DDL
@@ -321,6 +324,7 @@ unpublish-form= (Automatic Translation)
untitled-element-set= (Automatic Translation)
untitled-form= (Automatic Translation)
untitled-page-x-of-x=Untitled Page ({0} of {1}) (Automatic Copy)
+url-must-not-be-a-local-network=URL must not be a local network. (Automatic Copy)
validation-failed-for-field-x=Validation failed for field "{0}". (Automatic Copy)
variable=
view-form= (Automatic Translation)
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/build.gradle b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/build.gradle
index db0d890f0c5c15..422277380cbab9 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/build.gradle
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/build.gradle
@@ -5,7 +5,6 @@ buildService {
dependencies {
compileOnly group: "biz.aQute.bnd", name: "biz.aQute.bndlib", version: "3.1.0"
- compileOnly group: "com.liferay", name: "com.liferay.dynamic.data.mapping.api", version: "4.5.0"
compileOnly group: "com.liferay", name: "com.liferay.exportimport.api", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.journal.api", version: "3.5.0"
compileOnly group: "com.liferay", name: "com.liferay.mobile.device.rules.api", version: "3.0.0"
@@ -26,12 +25,14 @@ dependencies {
compileOnly group: "com.liferay", name: "com.liferay.registry.api", version: "2.0.0"
compileOnly group: "com.liferay", name: "com.liferay.staging.api", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.xstream.configurator.api", version: "3.0.0"
- compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "3.0.0"
- compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "3.18.0"
+ compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "default"
+ compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "default"
compileOnly group: "com.liferay.portal", name: "com.liferay.util.java", version: "3.0.0"
compileOnly group: "javax.mail", name: "mail", version: "1.4"
compileOnly group: "javax.portlet", name: "portlet-api", version: "3.0.0"
compileOnly group: "javax.servlet", name: "javax.servlet-api", version: "3.0.1"
compileOnly group: "org.osgi", name: "org.osgi.core", version: "5.0.0"
compileOnly group: "org.osgi", name: "org.osgi.service.component.annotations", version: "1.3.0"
+
+ compileOnly project(":apps:dynamic-data-mapping:dynamic-data-mapping-api")
}
\ No newline at end of file
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/service.xml b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/service.xml
index a70cbf3f2d4a2f..cb97bdc6013f58 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/service.xml
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/service.xml
@@ -721,6 +721,7 @@
ContentData
ContentName
DataProviderInstanceName
+ DataProviderInstanceURL
FormInstanceName
FormInstanceRecordGroupId
FormInstanceSettingsRedirectURL
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/src/main/java/com/liferay/dynamic/data/mapping/internal/data/provider/configuration/activator/DDMDataProviderConfigurationActivator.java b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/src/main/java/com/liferay/dynamic/data/mapping/internal/data/provider/configuration/activator/DDMDataProviderConfigurationActivator.java
new file mode 100644
index 00000000000000..0d6aad658c79c7
--- /dev/null
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/src/main/java/com/liferay/dynamic/data/mapping/internal/data/provider/configuration/activator/DDMDataProviderConfigurationActivator.java
@@ -0,0 +1,50 @@
+/\*\*
+ \* Copyright (c) 2000-present Liferay, Inc. All rights reserved.
+ \*
+ \* This library is free software; you can redistribute it and/or modify it under
+ \* the terms of the GNU Lesser General Public License as published by the Free
+ \* Software Foundation; either version 2.1 of the License, or (at your option)
+ \* any later version.
+ \*
+ \* This library is distributed in the hope that it will be useful, but WITHOUT
+ \* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
+ \* FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
+ \* details.
+ \*/
+
+package com.liferay.dynamic.data.mapping.internal.data.provider.configuration.activator;
+
+import com.liferay.dynamic.data.mapping.data.provider.configuration.DDMDataProviderConfiguration;
+import com.liferay.portal.configuration.metatype.bnd.util.ConfigurableUtil;
+
+import java.util.Map;
+
+import org.osgi.service.component.annotations.Activate;
+import org.osgi.service.component.annotations.Component;
+import org.osgi.service.component.annotations.ConfigurationPolicy;
+import org.osgi.service.component.annotations.Modified;
+
+/\*\*
+ \* @author Leonardo Barros
+ \*/
+@Component(
+ configurationPid = "com.liferay.dynamic.data.mapping.data.provider.configuration.DDMDataProviderConfiguration",
+ configurationPolicy = ConfigurationPolicy.OPTIONAL, immediate = true,
+ service = DDMDataProviderConfigurationActivator.class
+)
+public class DDMDataProviderConfigurationActivator {
+
+ public DDMDataProviderConfiguration getDDMDataProviderConfiguration() {
+ return \_ddmDataProviderConfiguration;
+ }
+
+ @Activate
+ @Modified
+ protected void activate(Map properties) {
+ \_ddmDataProviderConfiguration = ConfigurableUtil.createConfigurable(
+ DDMDataProviderConfiguration.class, properties);
+ }
+
+ private volatile DDMDataProviderConfiguration \_ddmDataProviderConfiguration;
+
+}
\ No newline at end of file
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/src/main/java/com/liferay/dynamic/data/mapping/internal/render/DDMFormFieldFreeMarkerRenderer.java b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/src/main/java/com/liferay/dynamic/data/mapping/internal/render/DDMFormFieldFreeMarkerRenderer.java
index d1fd3efdf252d9..7f8001d28e00d6 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/src/main/java/com/liferay/dynamic/data/mapping/internal/render/DDMFormFieldFreeMarkerRenderer.java
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/src/main/java/com/liferay/dynamic/data/mapping/internal/render/DDMFormFieldFreeMarkerRenderer.java
@@ -41,7 +41,6 @@
import com.liferay.portal.kernel.template.ClassLoaderTemplateResource;
import com.liferay.portal.kernel.template.Template;
import com.liferay.portal.kernel.template.TemplateConstants;
-import com.liferay.portal.kernel.template.TemplateManager;
import com.liferay.portal.kernel.template.TemplateManagerUtil;
import com.liferay.portal.kernel.template.TemplateResource;
import com.liferay.portal.kernel.theme.ThemeDisplay;
@@ -121,8 +120,9 @@ public String render(
}
protected void addDDMFormFieldOptionHTML(
- HttpServletRequest request, HttpServletResponse response,
- DDMFormField ddmFormField, String mode, boolean readOnly,
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse, DDMFormField ddmFormField,
+ String mode, boolean readOnly,
Map freeMarkerContext, StringBundler sb,
String label, String value)
throws Exception {
@@ -139,8 +139,9 @@ protected void addDDMFormFieldOptionHTML(
sb.append(
processFTL(
- request, response, ddmFormField.getFieldNamespace(), "option",
- mode, readOnly, freeMarkerContext));
+ httpServletRequest, httpServletResponse,
+ ddmFormField.getFieldNamespace(), "option", mode, readOnly,
+ freeMarkerContext));
}
protected void addLayoutProperties(
@@ -208,17 +209,19 @@ protected int countFieldRepetition(
}
protected String getDDMFormFieldOptionHTML(
- HttpServletRequest request, HttpServletResponse response,
- DDMFormField ddmFormField, String mode, boolean readOnly,
- Locale locale, Map freeMarkerContext)
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse, DDMFormField ddmFormField,
+ String mode, boolean readOnly, Locale locale,
+ Map freeMarkerContext)
throws Exception {
StringBundler sb = new StringBundler();
if (Objects.equals(ddmFormField.getType(), "select")) {
addDDMFormFieldOptionHTML(
- request, response, ddmFormField, mode, readOnly,
- freeMarkerContext, sb, StringPool.BLANK, StringPool.BLANK);
+ httpServletRequest, httpServletResponse, ddmFormField, mode,
+ readOnly, freeMarkerContext, sb, StringPool.BLANK,
+ StringPool.BLANK);
}
DDMFormFieldOptions ddmFormFieldOptions =
@@ -228,20 +231,22 @@ protected String getDDMFormFieldOptionHTML(
LocalizedValue label = ddmFormFieldOptions.getOptionLabels(value);
addDDMFormFieldOptionHTML(
- request, response, ddmFormField, mode, readOnly,
- freeMarkerContext, sb, label.getString(locale), value);
+ httpServletRequest, httpServletResponse, ddmFormField, mode,
+ readOnly, freeMarkerContext, sb, label.getString(locale),
+ value);
}
return sb.toString();
}
protected Map getFieldContext(
- HttpServletRequest request, HttpServletResponse response,
- String portletNamespace, String namespace, DDMFormField ddmFormField,
- Locale locale) {
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse, String portletNamespace,
+ String namespace, DDMFormField ddmFormField, Locale locale) {
Map> fieldsContext = getFieldsContext(
- request, response, portletNamespace, namespace);
+ httpServletRequest, httpServletResponse, portletNamespace,
+ namespace);
String name = ddmFormField.getName();
@@ -268,7 +273,7 @@ protected Map getFieldContext(
addStructureProperties(ddmFormField, fieldContext);
boolean checkRequired = GetterUtil.getBoolean(
- request.getAttribute("checkRequired"), true);
+ httpServletRequest.getAttribute("checkRequired"), true);
if (!checkRequired) {
fieldContext.put("required", Boolean.FALSE.toString());
@@ -280,16 +285,17 @@ protected Map getFieldContext(
}
protected String getFieldHTML(
- HttpServletRequest request, HttpServletResponse response,
- DDMFormField ddmFormField, Fields fields,
- DDMFormField parentDDMFormField, String portletNamespace,
- String namespace, String mode, boolean readOnly,
- boolean showEmptyFieldLabel, Locale locale)
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse, DDMFormField ddmFormField,
+ Fields fields, DDMFormField parentDDMFormField,
+ String portletNamespace, String namespace, String mode,
+ boolean readOnly, boolean showEmptyFieldLabel, Locale locale)
throws Exception {
Map freeMarkerContext = getFreeMarkerContext(
- request, response, portletNamespace, namespace, ddmFormField,
- parentDDMFormField, showEmptyFieldLabel, locale);
+ httpServletRequest, httpServletResponse, portletNamespace,
+ namespace, ddmFormField, parentDDMFormField, showEmptyFieldLabel,
+ locale);
if (fields != null) {
freeMarkerContext.put("fields", fields);
@@ -302,12 +308,13 @@ protected String getFieldHTML(
int offset = 0;
DDMFieldsCounter ddmFieldsCounter = getFieldsCounter(
- request, response, fields, portletNamespace, namespace);
+ httpServletRequest, httpServletResponse, fields, portletNamespace,
+ namespace);
String name = ddmFormField.getName();
String fieldDisplayValue = getFieldsDisplayValue(
- request, response, fields);
+ httpServletRequest, httpServletResponse, fields);
String[] fieldsDisplayValues = getFieldsDisplayValues(
fieldDisplayValue);
@@ -357,9 +364,10 @@ protected String getFieldHTML(
childrenHTMLSB.append(
getHTML(
- request, response, ddmFormField.getNestedDDMFormFields(),
- fields, ddmFormField, portletNamespace, namespace, mode,
- readOnly, showEmptyFieldLabel, locale));
+ httpServletRequest, httpServletResponse,
+ ddmFormField.getNestedDDMFormFields(), fields, ddmFormField,
+ portletNamespace, namespace, mode, readOnly,
+ showEmptyFieldLabel, locale));
if (Objects.equals(ddmFormField.getType(), "select") ||
Objects.equals(ddmFormField.getType(), "radio")) {
@@ -372,16 +380,17 @@ protected String getFieldHTML(
childrenHTMLSB.append(
getDDMFormFieldOptionHTML(
- request, response, ddmFormField, mode, readOnly, locale,
- optionFreeMarkerContext));
+ httpServletRequest, httpServletResponse, ddmFormField,
+ mode, readOnly, locale, optionFreeMarkerContext));
}
fieldStructure.put("children", childrenHTMLSB.toString());
sb.append(
processFTL(
- request, response, ddmFormField.getFieldNamespace(),
- ddmFormField.getType(), mode, readOnly, freeMarkerContext));
+ httpServletRequest, httpServletResponse,
+ ddmFormField.getFieldNamespace(), ddmFormField.getType(),
+ mode, readOnly, freeMarkerContext));
fieldRepetition--;
}
@@ -420,46 +429,48 @@ protected int getFieldOffset(
}
protected Map> getFieldsContext(
- HttpServletRequest request, HttpServletResponse response,
- String portletNamespace, String namespace) {
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse, String portletNamespace,
+ String namespace) {
String fieldsContextKey =
portletNamespace + namespace + "fieldsContext";
Map> fieldsContext =
- (Map>)request.getAttribute(
+ (Map>)httpServletRequest.getAttribute(
fieldsContextKey);
if (fieldsContext == null) {
fieldsContext = new HashMap<>();
- request.setAttribute(fieldsContextKey, fieldsContext);
+ httpServletRequest.setAttribute(fieldsContextKey, fieldsContext);
}
return fieldsContext;
}
protected DDMFieldsCounter getFieldsCounter(
- HttpServletRequest request, HttpServletResponse response, Fields fields,
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse, Fields fields,
String portletNamespace, String namespace) {
String fieldsCounterKey = portletNamespace + namespace + "fieldsCount";
DDMFieldsCounter ddmFieldsCounter =
- (DDMFieldsCounter)request.getAttribute(fieldsCounterKey);
+ (DDMFieldsCounter)httpServletRequest.getAttribute(fieldsCounterKey);
if (ddmFieldsCounter == null) {
ddmFieldsCounter = new DDMFieldsCounter();
- request.setAttribute(fieldsCounterKey, ddmFieldsCounter);
+ httpServletRequest.setAttribute(fieldsCounterKey, ddmFieldsCounter);
}
return ddmFieldsCounter;
}
protected String getFieldsDisplayValue(
- HttpServletRequest request, HttpServletResponse response,
- Fields fields) {
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse, Fields fields) {
String defaultFieldsDisplayValue = null;
@@ -473,7 +484,8 @@ protected String getFieldsDisplayValue(
}
return ParamUtil.getString(
- request, DDMImpl.FIELDS\_DISPLAY\_NAME, defaultFieldsDisplayValue);
+ httpServletRequest, DDMImpl.FIELDS\_DISPLAY\_NAME,
+ defaultFieldsDisplayValue);
}
protected String[] getFieldsDisplayValues(String fieldDisplayValue) {
@@ -491,40 +503,43 @@ protected String[] getFieldsDisplayValues(String fieldDisplayValue) {
}
protected Map getFreeMarkerContext(
- HttpServletRequest request, HttpServletResponse response,
- String portletNamespace, String namespace, DDMFormField ddmFormField,
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse, String portletNamespace,
+ String namespace, DDMFormField ddmFormField,
DDMFormField parentDDMFormField, boolean showEmptyFieldLabel,
Locale locale) {
Map freeMarkerContext = new HashMap<>();
Map fieldContext = getFieldContext(
- request, response, portletNamespace, namespace, ddmFormField,
- locale);
+ httpServletRequest, httpServletResponse, portletNamespace,
+ namespace, ddmFormField, locale);
Map parentFieldContext = new HashMap<>();
if (parentDDMFormField != null) {
parentFieldContext = getFieldContext(
- request, response, portletNamespace, namespace,
- parentDDMFormField, locale);
+ httpServletRequest, httpServletResponse, portletNamespace,
+ namespace, parentDDMFormField, locale);
}
freeMarkerContext.put(
"ddmPortletId", DDMPortletKeys.DYNAMIC\_DATA\_MAPPING);
- Editor editor = DDMFormFieldFreeMarkerRendererHelper.getEditor(request);
+ Editor editor = DDMFormFieldFreeMarkerRendererHelper.getEditor(
+ httpServletRequest);
freeMarkerContext.put("editorName", editor.getName());
freeMarkerContext.put("fieldStructure", fieldContext);
- ThemeDisplay themeDisplay = (ThemeDisplay)request.getAttribute(
- WebKeys.THEME\_DISPLAY);
+ ThemeDisplay themeDisplay =
+ (ThemeDisplay)httpServletRequest.getAttribute(
+ WebKeys.THEME\_DISPLAY);
try {
String itemSelectorAuthToken = AuthTokenUtil.getToken(
- request,
+ httpServletRequest,
PortalUtil.getControlPanelPlid(themeDisplay.getCompanyId()),
PortletKeys.ITEM\_SELECTOR);
@@ -548,7 +563,8 @@ protected Map getFreeMarkerContext(
}
protected String getHTML(
- HttpServletRequest request, HttpServletResponse response,
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse,
List ddmFormFields, Fields fields,
DDMFormField parentDDMFormField, String portletNamespace,
String namespace, String mode, boolean readOnly,
@@ -560,9 +576,9 @@ protected String getHTML(
for (DDMFormField ddmFormField : ddmFormFields) {
sb.append(
getFieldHTML(
- request, response, ddmFormField, fields, parentDDMFormField,
- portletNamespace, namespace, mode, readOnly,
- showEmptyFieldLabel, locale));
+ httpServletRequest, httpServletResponse, ddmFormField,
+ fields, parentDDMFormField, portletNamespace, namespace,
+ mode, readOnly, showEmptyFieldLabel, locale));
}
return sb.toString();
@@ -584,8 +600,9 @@ protected TemplateResource getTemplateResource(String resource) {
}
protected String processFTL(
- HttpServletRequest request, HttpServletResponse response,
- String fieldNamespace, String type, String mode, boolean readOnly,
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse, String fieldNamespace,
+ String type, String mode, boolean readOnly,
Map freeMarkerContext)
throws Exception {
@@ -641,24 +658,20 @@ protected String processFTL(
template.put(entry.getKey(), entry.getValue());
}
- TemplateManager templateManager =
- TemplateManagerUtil.getTemplateManager(
- TemplateConstants.LANG\_TYPE\_FTL);
-
- templateManager.addTaglibSupport(template, request, response);
+ template.prepareTaglib(httpServletRequest, httpServletResponse);
- return processFTL(request, response, template);
+ return processFTL(httpServletRequest, httpServletResponse, template);
}
/\*\*
\* @see com.liferay.taglib.util.ThemeUtil#includeFTL
\*/
protected String processFTL(
- HttpServletRequest request, HttpServletResponse response,
- Template template)
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse, Template template)
throws Exception {
- template.prepare(request);
+ template.prepare(httpServletRequest);
Writer writer = new UnsyncStringWriter();
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/src/main/java/com/liferay/dynamic/data/mapping/service/impl/DDMDataProviderInstanceLocalServiceImpl.java b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/src/main/java/com/liferay/dynamic/data/mapping/service/impl/DDMDataProviderInstanceLocalServiceImpl.java
index e5569c39778dbb..ba0c3e2449bfa2 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/src/main/java/com/liferay/dynamic/data/mapping/service/impl/DDMDataProviderInstanceLocalServiceImpl.java
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/src/main/java/com/liferay/dynamic/data/mapping/service/impl/DDMDataProviderInstanceLocalServiceImpl.java
@@ -14,28 +14,38 @@
package com.liferay.dynamic.data.mapping.service.impl;
+import com.liferay.dynamic.data.mapping.data.provider.configuration.DDMDataProviderConfiguration;
import com.liferay.dynamic.data.mapping.exception.DataProviderInstanceNameException;
+import com.liferay.dynamic.data.mapping.exception.DataProviderInstanceURLException;
import com.liferay.dynamic.data.mapping.exception.NoSuchDataProviderInstanceException;
import com.liferay.dynamic.data.mapping.exception.RequiredDataProviderInstanceException;
+import com.liferay.dynamic.data.mapping.internal.data.provider.configuration.activator.DDMDataProviderConfigurationActivator;
import com.liferay.dynamic.data.mapping.io.DDMFormValuesJSONSerializer;
import com.liferay.dynamic.data.mapping.model.DDMDataProviderInstance;
+import com.liferay.dynamic.data.mapping.model.Value;
import com.liferay.dynamic.data.mapping.service.base.DDMDataProviderInstanceLocalServiceBaseImpl;
+import com.liferay.dynamic.data.mapping.storage.DDMFormFieldValue;
import com.liferay.dynamic.data.mapping.storage.DDMFormValues;
import com.liferay.dynamic.data.mapping.validator.DDMFormValuesValidator;
import com.liferay.portal.kernel.dao.orm.ActionableDynamicQuery;
import com.liferay.portal.kernel.dao.orm.Property;
import com.liferay.portal.kernel.dao.orm.PropertyFactoryUtil;
import com.liferay.portal.kernel.exception.PortalException;
+import com.liferay.portal.kernel.log.Log;
+import com.liferay.portal.kernel.log.LogFactoryUtil;
import com.liferay.portal.kernel.model.ResourceConstants;
import com.liferay.portal.kernel.model.User;
import com.liferay.portal.kernel.service.ServiceContext;
import com.liferay.portal.kernel.service.permission.ModelPermissions;
import com.liferay.portal.kernel.util.GroupThreadLocal;
+import com.liferay.portal.kernel.util.InetAddressUtil;
import com.liferay.portal.kernel.util.LocaleUtil;
import com.liferay.portal.kernel.util.OrderByComparator;
import com.liferay.portal.kernel.util.Validator;
import com.liferay.portal.spring.extender.service.ServiceReference;
+import java.net.URL;
+
import java.util.List;
import java.util.Locale;
import java.util.Map;
@@ -329,13 +339,75 @@ protected void validate(
"Name is null for locale " + locale.getDisplayName());
}
+ DDMDataProviderConfiguration ddmDataProviderConfiguration =
+ ddmDataProviderConfigurationActivator.
+ getDDMDataProviderConfiguration();
+
+ if (!ddmDataProviderConfiguration.accessLocalNetwork()) {
+ \_validateLocalNetworkURL(ddmFormValues);
+ }
+
ddmFormValuesValidator.validate(ddmFormValues);
}
+ @ServiceReference(type = DDMDataProviderConfigurationActivator.class)
+ protected DDMDataProviderConfigurationActivator
+ ddmDataProviderConfigurationActivator;
+
@ServiceReference(type = DDMFormValuesJSONSerializer.class)
protected DDMFormValuesJSONSerializer ddmFormValuesJSONSerializer;
@ServiceReference(type = DDMFormValuesValidator.class)
protected DDMFormValuesValidator ddmFormValuesValidator;
+ private boolean \_isLocalNetworkURL(String value) {
+ try {
+ URL url = new URL(value);
+
+ return InetAddressUtil.isLocalInetAddress(
+ InetAddressUtil.getInetAddressByName(url.getHost()));
+ }
+ catch (Exception e) {
+ if (\_log.isDebugEnabled()) {
+ \_log.debug(e, e);
+ }
+ }
+
+ return true;
+ }
+
+ private void \_validateLocalNetworkURL(DDMFormValues ddmFormValues)
+ throws PortalException {
+
+ Map> ddmFormFieldValuesMap =
+ ddmFormValues.getDDMFormFieldValuesMap();
+
+ if (!ddmFormFieldValuesMap.containsKey("url")) {
+ return;
+ }
+
+ List ddmFormFieldValues = ddmFormFieldValuesMap.get(
+ "url");
+
+ for (DDMFormFieldValue ddmFormFieldValue : ddmFormFieldValues) {
+ Value value = ddmFormFieldValue.getValue();
+
+ for (Locale locale : value.getAvailableLocales()) {
+ String valueString = value.getString(locale);
+
+ if (!Validator.isUrl(valueString)) {
+ continue;
+ }
+
+ if (\_isLocalNetworkURL(valueString)) {
+ throw new DataProviderInstanceURLException(
+ "URL must not be a local network");
+ }
+ }
+ }
+ }
+
+ private static final Log \_log = LogFactoryUtil.getLog(
+ DDMDataProviderInstanceLocalServiceImpl.class);
+
}
\ No newline at end of file
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/src/main/java/com/liferay/dynamic/data/mapping/service/impl/DDMDataProviderInstanceServiceImpl.java b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/src/main/java/com/liferay/dynamic/data/mapping/service/impl/DDMDataProviderInstanceServiceImpl.java
index 6dd3a753b117af..7d52b75a5d3cd6 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/src/main/java/com/liferay/dynamic/data/mapping/service/impl/DDMDataProviderInstanceServiceImpl.java
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/src/main/java/com/liferay/dynamic/data/mapping/service/impl/DDMDataProviderInstanceServiceImpl.java
@@ -20,6 +20,11 @@
import com.liferay.dynamic.data.mapping.service.base.DDMDataProviderInstanceServiceBaseImpl;
import com.liferay.dynamic.data.mapping.storage.DDMFormValues;
import com.liferay.portal.kernel.exception.PortalException;
+import com.liferay.portal.kernel.json.JSONArray;
+import com.liferay.portal.kernel.json.JSONFactoryUtil;
+import com.liferay.portal.kernel.json.JSONObject;
+import com.liferay.portal.kernel.log.Log;
+import com.liferay.portal.kernel.log.LogFactoryUtil;
import com.liferay.portal.kernel.security.permission.ActionKeys;
import com.liferay.portal.kernel.security.permission.resource.ModelResourcePermission;
import com.liferay.portal.kernel.security.permission.resource.ModelResourcePermissionFactory;
@@ -27,10 +32,14 @@
import com.liferay.portal.kernel.security.permission.resource.PortletResourcePermissionFactory;
import com.liferay.portal.kernel.service.ServiceContext;
import com.liferay.portal.kernel.util.OrderByComparator;
+import com.liferay.portal.kernel.util.StringUtil;
+import java.util.Iterator;
import java.util.List;
import java.util.Locale;
import java.util.Map;
+import java.util.stream.Collectors;
+import java.util.stream.Stream;
/\*\*
\* @author Leonardo Barros
@@ -151,8 +160,34 @@ public List search(
long companyId, long[] groupIds, String keywords, int start, int end,
OrderByComparator orderByComparator) {
- return ddmDataProviderInstanceFinder.filterByKeywords(
- companyId, groupIds, keywords, start, end, orderByComparator);
+ List ddmDataProviderInstances =
+ ddmDataProviderInstanceFinder.filterByKeywords(
+ companyId, groupIds, keywords, start, end, orderByComparator);
+
+ Stream ddmDataProviderInstanceStream =
+ ddmDataProviderInstances.stream();
+
+ return ddmDataProviderInstanceStream.filter(
+ ddmDataProviderInstance -> {
+ try {
+ return \_ddmDataProviderInstanceModelResourcePermission.
+ contains(
+ getPermissionChecker(),
+ ddmDataProviderInstance.getDataProviderInstanceId(),
+ ActionKeys.VIEW);
+ }
+ catch (PortalException portalException) {
+ \_log.error(portalException, portalException);
+
+ return false;
+ }
+ }
+ ).map(
+ ddmDataProviderInstance -> \_removeAuthenticationData(
+ ddmDataProviderInstance)
+ ).collect(
+ Collectors.toList()
+ );
}
@Override
@@ -196,6 +231,64 @@ public DDMDataProviderInstance updateDataProviderInstance(
ddmFormValues, serviceContext);
}
+ private JSONArray \_filterFieldValues(JSONArray fieldValuesJSONArray) {
+ JSONArray filteredFieldValuesJSONArray =
+ JSONFactoryUtil.createJSONArray();
+
+ Iterator iterator = fieldValuesJSONArray.iterator();
+
+ while (iterator.hasNext()) {
+ JSONObject fieldValueJSONObject = (JSONObject)iterator.next();
+
+ String fieldValueName = fieldValueJSONObject.getString("name");
+
+ if (StringUtil.equals(fieldValueName, "password") ||
+ StringUtil.equals(fieldValueName, "username")) {
+
+ continue;
+ }
+
+ filteredFieldValuesJSONArray.put(fieldValueJSONObject);
+ }
+
+ return filteredFieldValuesJSONArray;
+ }
+
+ private DDMDataProviderInstance \_removeAuthenticationData(
+ DDMDataProviderInstance ddmDataProviderInstance) {
+
+ try {
+ JSONObject definitionJSONObject = JSONFactoryUtil.createJSONObject(
+ ddmDataProviderInstance.getDefinition());
+
+ if (!definitionJSONObject.has("fieldValues")) {
+ return ddmDataProviderInstance;
+ }
+
+ JSONArray fieldValuesJSONArray = definitionJSONObject.getJSONArray(
+ "fieldValues");
+
+ definitionJSONObject.put(
+ "fieldValues", \_filterFieldValues(fieldValuesJSONArray));
+
+ ddmDataProviderInstance.setDefinition(
+ definitionJSONObject.toJSONString());
+ }
+ catch (Exception exception) {
+ if (\_log.isWarnEnabled()) {
+ \_log.warn(
+ "Unable to remove authentication data from data " +
+ "providers search",
+ exception);
+ }
+ }
+
+ return ddmDataProviderInstance;
+ }
+
+ private static final Log \_log = LogFactoryUtil.getLog(
+ DDMDataProviderInstanceServiceImpl.class);
+
private static volatile ModelResourcePermission
\_ddmDataProviderInstanceModelResourcePermission =
ModelResourcePermissionFactory.getInstance(
diff --git a/modules/apps/export-import/export-import-service/src/main/java/com/liferay/exportimport/internal/controller/PortletExportControllerImpl.java b/modules/apps/export-import/export-import-service/src/main/java/com/liferay/exportimport/internal/controller/PortletExportControllerImpl.java
index df5ccd44c4b710..dd5d95a55736fa 100644
--- a/modules/apps/export-import/export-import-service/src/main/java/com/liferay/exportimport/internal/controller/PortletExportControllerImpl.java
+++ b/modules/apps/export-import/export-import-service/src/main/java/com/liferay/exportimport/internal/controller/PortletExportControllerImpl.java
@@ -1158,15 +1158,7 @@ protected void exportPortletPreferences(
return;
}
- LayoutTypePortlet layoutTypePortlet = null;
-
- if (layout != null) {
- layoutTypePortlet = (LayoutTypePortlet)layout.getLayoutType();
- }
-
- if ((layoutTypePortlet == null) ||
- layoutTypePortlet.hasPortletId(portletId)) {
-
+ if (\_hasPortletId(layout, portletId, ownerType)) {
exportPortletPreference(
portletDataContext, ownerId, ownerType, defaultUser,
portletPreferences, portletId, plid, parentElement);
@@ -1423,6 +1415,43 @@ private PortletDataHandler \_getPortletDataHandler(
);
}
+ private boolean \_hasPortletId(
+ Layout layout, String portletId, int ownerType) {
+
+ if (layout == null) {
+ return true;
+ }
+
+ LayoutTypePortlet layoutTypePortlet =
+ (LayoutTypePortlet)layout.getLayoutType();
+
+ if (layoutTypePortlet == null) {
+ return true;
+ }
+
+ boolean rootPortletId = false;
+
+ if ((ownerType == PortletKeys.PREFS\_OWNER\_TYPE\_COMPANY) ||
+ (ownerType == PortletKeys.PREFS\_OWNER\_TYPE\_GROUP)) {
+
+ rootPortletId = true;
+ }
+
+ if (!rootPortletId) {
+ return layoutTypePortlet.hasPortletId(portletId);
+ }
+
+ List allPortlets = layoutTypePortlet.getAllPortlets(false);
+
+ for (Portlet portlet : allPortlets) {
+ if (portletId.equals(portlet.getRootPortletId())) {
+ return true;
+ }
+ }
+
+ return false;
+ }
+
private Optional \_replacePortlet(
PortletDataContext portletDataContext, Portlet portlet) {
diff --git a/modules/apps/flags/flags-api/src/main/java/com/liferay/flags/service/FlagsEntryService.java b/modules/apps/flags/flags-api/src/main/java/com/liferay/flags/service/FlagsEntryService.java
index 856afd6102ac72..2b3b30137034eb 100644
--- a/modules/apps/flags/flags-api/src/main/java/com/liferay/flags/service/FlagsEntryService.java
+++ b/modules/apps/flags/flags-api/src/main/java/com/liferay/flags/service/FlagsEntryService.java
@@ -19,6 +19,7 @@
import com.liferay.portal.kernel.exception.PortalException;
import com.liferay.portal.kernel.exception.SystemException;
import com.liferay.portal.kernel.jsonwebservice.JSONWebService;
+import com.liferay.portal.kernel.jsonwebservice.JSONWebServiceMode;
import com.liferay.portal.kernel.security.access.control.AccessControlled;
import com.liferay.portal.kernel.service.BaseService;
import com.liferay.portal.kernel.service.ServiceContext;
@@ -56,6 +57,7 @@ public interface FlagsEntryService extends BaseService {
\*
\* Never modify or reference this interface directly. Always use {@link FlagsEntryServiceUtil} to access the flags entry remote service. Add custom service methods to `com.liferay.flags.service.impl.FlagsEntryServiceImpl` and rerun ServiceBuilder to automatically copy the method declarations to this interface.
\*/
+ @JSONWebService(mode = JSONWebServiceMode.IGNORE)
public void addEntry(
String className, long classPK, String reporterEmailAddress,
long reportedUserId, String contentTitle, String contentURL,
diff --git a/modules/apps/flags/flags-service/src/main/java/com/liferay/flags/internal/messaging/FlagsRequestMessageListener.java b/modules/apps/flags/flags-service/src/main/java/com/liferay/flags/internal/messaging/FlagsRequestMessageListener.java
index 3b18a09d9e5d3c..2092240e827dd4 100644
--- a/modules/apps/flags/flags-service/src/main/java/com/liferay/flags/internal/messaging/FlagsRequestMessageListener.java
+++ b/modules/apps/flags/flags-service/src/main/java/com/liferay/flags/internal/messaging/FlagsRequestMessageListener.java
@@ -238,16 +238,13 @@ protected void notify(
subscriptionSender.setBody(body);
subscriptionSender.setCompanyId(company.getCompanyId());
subscriptionSender.setContextAttributes(
- "[$CONTENT\_ID$]", contentId, "[$CONTENT\_TYPE$]", contentType,
+ "[$CONTENT\_ID$]", contentId, "[$CONTENT\_TITLE$]", contentTitle,
+ "[$CONTENT\_TYPE$]", contentType, "[$CONTENT\_URL$]", contentURL,
"[$DATE$]", now.toString(), "[$REASON$]", reason,
"[$REPORTED\_USER\_ADDRESS$]", reportedEmailAddress,
"[$REPORTED\_USER\_NAME$]", reportedUserName, "[$REPORTED\_USER\_URL$]",
reportedUserURL, "[$REPORTER\_USER\_ADDRESS$]", reporterEmailAddress,
"[$REPORTER\_USER\_NAME$]", reporterUserName);
- subscriptionSender.setContextAttribute(
- "[$CONTENT\_TITLE$]", contentTitle, false);
- subscriptionSender.setContextAttribute(
- "[$CONTENT\_URL$]", contentURL, false);
subscriptionSender.setCreatorUserId(reporterUserId);
subscriptionSender.setFrom(fromAddress, fromName);
subscriptionSender.setHtmlFormat(true);
diff --git a/modules/apps/flags/flags-service/src/main/java/com/liferay/flags/service/impl/FlagsEntryServiceImpl.java b/modules/apps/flags/flags-service/src/main/java/com/liferay/flags/service/impl/FlagsEntryServiceImpl.java
index b7548876accadb..39af0661540ac6 100644
--- a/modules/apps/flags/flags-service/src/main/java/com/liferay/flags/service/impl/FlagsEntryServiceImpl.java
+++ b/modules/apps/flags/flags-service/src/main/java/com/liferay/flags/service/impl/FlagsEntryServiceImpl.java
@@ -18,6 +18,8 @@
import com.liferay.flags.service.base.FlagsEntryServiceBaseImpl;
import com.liferay.portal.kernel.exception.EmailAddressException;
import com.liferay.portal.kernel.exception.PortalException;
+import com.liferay.portal.kernel.jsonwebservice.JSONWebService;
+import com.liferay.portal.kernel.jsonwebservice.JSONWebServiceMode;
import com.liferay.portal.kernel.messaging.DestinationNames;
import com.liferay.portal.kernel.messaging.MessageBusUtil;
import com.liferay.portal.kernel.service.ServiceContext;
@@ -28,6 +30,7 @@
\*/
public class FlagsEntryServiceImpl extends FlagsEntryServiceBaseImpl {
+ @JSONWebService(mode = JSONWebServiceMode.IGNORE)
@Override
public void addEntry(
String className, long classPK, String reporterEmailAddress,
diff --git a/modules/apps/fragment/fragment-service/src/main/java/com/liferay/fragment/service/impl/FragmentCollectionLocalServiceImpl.java b/modules/apps/fragment/fragment-service/src/main/java/com/liferay/fragment/service/impl/FragmentCollectionLocalServiceImpl.java
index 89efbd83d8ac4a..93c5ce5377b73d 100644
--- a/modules/apps/fragment/fragment-service/src/main/java/com/liferay/fragment/service/impl/FragmentCollectionLocalServiceImpl.java
+++ b/modules/apps/fragment/fragment-service/src/main/java/com/liferay/fragment/service/impl/FragmentCollectionLocalServiceImpl.java
@@ -209,6 +209,13 @@ protected void validate(String name) throws PortalException {
if (Validator.isNull(name)) {
throw new FragmentCollectionNameException("Name must not be null");
}
+
+ if (name.contains(StringPool.PERIOD) ||
+ name.contains(StringPool.SLASH)) {
+
+ throw new FragmentCollectionNameException(
+ "Name contains invalid characters");
+ }
}
protected void validateFragmentCollectionKey(
diff --git a/modules/apps/fragment/fragment-service/src/main/java/com/liferay/fragment/service/impl/FragmentEntryLocalServiceImpl.java b/modules/apps/fragment/fragment-service/src/main/java/com/liferay/fragment/service/impl/FragmentEntryLocalServiceImpl.java
index a81b155a6de180..4035e1abb25e20 100644
--- a/modules/apps/fragment/fragment-service/src/main/java/com/liferay/fragment/service/impl/FragmentEntryLocalServiceImpl.java
+++ b/modules/apps/fragment/fragment-service/src/main/java/com/liferay/fragment/service/impl/FragmentEntryLocalServiceImpl.java
@@ -414,6 +414,13 @@ protected void validate(String name) throws PortalException {
throw new FragmentEntryNameException("Name must not be null");
}
+ if (name.contains(StringPool.PERIOD) ||
+ name.contains(StringPool.SLASH)) {
+
+ throw new FragmentEntryNameException(
+ "Name contains invalid characters");
+ }
+
int nameMaxLength = ModelHintsUtil.getMaxLength(
FragmentEntry.class.getName(), "name");
diff --git a/modules/apps/frontend-image-editor/frontend-image-editor-integration-document-library/src/main/java/com/liferay/frontend/image/editor/integration/document/library/internal/display/context/logic/ImageEditorDLDisplayContextHelper.java b/modules/apps/frontend-image-editor/frontend-image-editor-integration-document-library/src/main/java/com/liferay/frontend/image/editor/integration/document/library/internal/display/context/logic/ImageEditorDLDisplayContextHelper.java
index 8ae277405ce016..067aeb3fd4153c 100644
--- a/modules/apps/frontend-image-editor/frontend-image-editor-integration-document-library/src/main/java/com/liferay/frontend/image/editor/integration/document/library/internal/display/context/logic/ImageEditorDLDisplayContextHelper.java
+++ b/modules/apps/frontend-image-editor/frontend-image-editor-integration-document-library/src/main/java/com/liferay/frontend/image/editor/integration/document/library/internal/display/context/logic/ImageEditorDLDisplayContextHelper.java
@@ -44,6 +44,7 @@
import com.liferay.portal.kernel.theme.PortletDisplay;
import com.liferay.portal.kernel.theme.ThemeDisplay;
import com.liferay.portal.kernel.util.ArrayUtil;
+import com.liferay.portal.kernel.util.HtmlUtil;
import com.liferay.portal.kernel.util.JavaConstants;
import com.liferay.portal.kernel.util.PortalUtil;
import com.liferay.portal.kernel.util.WebKeys;
@@ -237,15 +238,15 @@ private String \_getOnclickMethod() {
sb.append(liferayPortletResponse.getNamespace());
sb.append("editWithImageEditor('");
- sb.append(imageEditorURL.toString());
+ sb.append(HtmlUtil.escapeJS(imageEditorURL.toString()));
sb.append("', '");
- sb.append(editURL.toString());
+ sb.append(HtmlUtil.escapeJS(editURL.toString()));
sb.append("', '");
- sb.append(\_fileEntry.getFileName());
+ sb.append(HtmlUtil.escapeJS(\_fileEntry.getFileName()));
sb.append("', '");
- sb.append(fileEntryPreviewURL);
+ sb.append(HtmlUtil.escapeJS(fileEntryPreviewURL));
sb.append("', '");
- sb.append(\_fileEntry.getMimeType());
+ sb.append(HtmlUtil.escapeJS(\_fileEntry.getMimeType()));
sb.append("');");
return sb.toString();
diff --git a/modules/apps/journal/journal-service/build.gradle b/modules/apps/journal/journal-service/build.gradle
index 1a1168215232dd..8687f18eee8994 100644
--- a/modules/apps/journal/journal-service/build.gradle
+++ b/modules/apps/journal/journal-service/build.gradle
@@ -36,7 +36,7 @@ dependencies {
compileOnly group: "com.liferay", name: "com.liferay.upload.api", version: "2.0.0"
compileOnly group: "com.liferay", name: "com.liferay.xstream.configurator.api", version: "3.0.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "3.0.0"
- compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "3.28.0"
+ compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "default"
compileOnly group: "com.liferay.portal", name: "com.liferay.util.java", version: "3.0.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.util.taglib", version: "3.0.0"
compileOnly group: "commons-lang", name: "commons-lang", version: "2.1"
diff --git a/modules/apps/journal/journal-service/src/main/java/com/liferay/journal/internal/transformer/JournalTransformer.java b/modules/apps/journal/journal-service/src/main/java/com/liferay/journal/internal/transformer/JournalTransformer.java
index 3670d3f2a42832..7d1e3857435b10 100644
--- a/modules/apps/journal/journal-service/src/main/java/com/liferay/journal/internal/transformer/JournalTransformer.java
+++ b/modules/apps/journal/journal-service/src/main/java/com/liferay/journal/internal/transformer/JournalTransformer.java
@@ -39,7 +39,6 @@
import com.liferay.portal.kernel.template.StringTemplateResource;
import com.liferay.portal.kernel.template.Template;
import com.liferay.portal.kernel.template.TemplateConstants;
-import com.liferay.portal.kernel.template.TemplateManager;
import com.liferay.portal.kernel.template.TemplateManagerUtil;
import com.liferay.portal.kernel.template.TemplateResource;
import com.liferay.portal.kernel.templateparser.TemplateNode;
@@ -306,15 +305,8 @@ protected String doTransform(
template.put("viewMode", viewMode);
if (themeDisplay != null) {
- TemplateManager templateManager =
- TemplateManagerUtil.getTemplateManager(langType);
-
- HttpServletRequest request = themeDisplay.getRequest();
-
- templateManager.addTaglibSupport(
- template, request, themeDisplay.getResponse());
- templateManager.addTaglibTheme(
- template, "taglibLiferay", request,
+ template.prepareTaglib(
+ themeDisplay.getRequest(),
new PipingServletResponse(
themeDisplay.getResponse(), unsyncStringWriter));
}
diff --git a/modules/apps/journal/journal-service/src/main/java/com/liferay/journal/util/impl/JournalUtil.java b/modules/apps/journal/journal-service/src/main/java/com/liferay/journal/util/impl/JournalUtil.java
index b6c0ca707963bb..5fbcf77ab3ea2a 100644
--- a/modules/apps/journal/journal-service/src/main/java/com/liferay/journal/util/impl/JournalUtil.java
+++ b/modules/apps/journal/journal-service/src/main/java/com/liferay/journal/util/impl/JournalUtil.java
@@ -47,8 +47,6 @@
import com.liferay.portal.kernel.service.UserLocalServiceUtil;
import com.liferay.portal.kernel.template.TemplateHandler;
import com.liferay.portal.kernel.template.TemplateHandlerRegistryUtil;
-import com.liferay.portal.kernel.template.TemplateManager;
-import com.liferay.portal.kernel.template.TemplateManagerUtil;
import com.liferay.portal.kernel.templateparser.TransformerListener;
import com.liferay.portal.kernel.theme.ThemeDisplay;
import com.liferay.portal.kernel.util.FriendlyURLNormalizerUtil;
@@ -376,17 +374,13 @@ public static String transform(
String langType, boolean propagateException)
throws Exception {
- TemplateManager templateManager =
- TemplateManagerUtil.getTemplateManager(langType);
-
TemplateHandler templateHandler =
TemplateHandlerRegistryUtil.getTemplateHandler(
JournalArticle.class.getName());
Map contextObjects = new HashMap<>();
- templateManager.addContextObjects(
- contextObjects, templateHandler.getCustomContextObjects());
+ contextObjects.putAll(templateHandler.getCustomContextObjects());
return \_journalTransformer.transform(
themeDisplay, contextObjects, tokens, viewMode, languageId,
diff --git a/modules/apps/petra/petra-json-web-service-client/build.gradle b/modules/apps/petra/petra-json-web-service-client/build.gradle
index 5a24673be31d97..7089aac1bf0b1d 100644
--- a/modules/apps/petra/petra-json-web-service-client/build.gradle
+++ b/modules/apps/petra/petra-json-web-service-client/build.gradle
@@ -2,9 +2,9 @@ sourceCompatibility = "1.6"
targetCompatibility = "1.6"
dependencies {
- compileInclude group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.9"
- compileInclude group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.9"
- compileInclude group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.9.3"
+ compileInclude group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
+ compileInclude group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
+ compileInclude group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.10.1"
compileInclude group: "commons-codec", name: "commons-codec", version: "1.7"
compileInclude group: "oauth.signpost", name: "signpost-commonshttp4", version: "1.2.1.2"
compileInclude group: "oauth.signpost", name: "signpost-core", version: "1.2.1.2"
diff --git a/modules/apps/polls/polls-web/build.gradle b/modules/apps/polls/polls-web/build.gradle
index 5e562f3f8b696d..9b5049c66c3a03 100644
--- a/modules/apps/polls/polls-web/build.gradle
+++ b/modules/apps/polls/polls-web/build.gradle
@@ -1,6 +1,6 @@
dependencies {
- compileInclude group: "jfree", name: "jcommon", version: "1.0.16"
- compileInclude group: "jfree", name: "jfreechart", version: "1.0.13"
+ compileInclude group: "org.jfree", name: "jcommon", version: "1.0.24"
+ compileInclude group: "org.jfree", name: "jfreechart", version: "1.0.19"
compileOnly group: "com.liferay", name: "com.liferay.application.list.api", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.frontend.taglib", version: "3.0.0"
diff --git a/modules/apps/portal-cache/portal-cache-api/src/main/java/com/liferay/portal/cache/BasePortalCacheManager.java b/modules/apps/portal-cache/portal-cache-api/src/main/java/com/liferay/portal/cache/BasePortalCacheManager.java
index e3d25955a3bcbb..9312ea43bc68f5 100644
--- a/modules/apps/portal-cache/portal-cache-api/src/main/java/com/liferay/portal/cache/BasePortalCacheManager.java
+++ b/modules/apps/portal-cache/portal-cache-api/src/main/java/com/liferay/portal/cache/BasePortalCacheManager.java
@@ -118,22 +118,6 @@ public PortalCache getPortalCache(
if (previousPortalCache != null) {
portalCache = previousPortalCache;
}
- else if (portalCacheConfiguration != null) {
- Properties portalCacheBootstrapLoaderProperties =
- portalCacheConfiguration.
- getPortalCacheBootstrapLoaderProperties();
-
- if (portalCacheBootstrapLoaderProperties != null) {
- PortalCacheBootstrapLoader portalCacheBootstrapLoader =
- portalCacheBootstrapLoaderFactory.create(
- portalCacheBootstrapLoaderProperties);
-
- if (portalCacheBootstrapLoader != null) {
- portalCacheBootstrapLoader.loadPortalCache(
- getPortalCacheManagerName(), portalCacheName);
- }
- }
- }
return portalCache;
}
diff --git a/modules/apps/portal-cache/portal-cache-api/src/main/java/com/liferay/portal/cache/PortalCacheBootstrapLoader.java b/modules/apps/portal-cache/portal-cache-api/src/main/java/com/liferay/portal/cache/PortalCacheBootstrapLoader.java
index f0d170d666bdfb..9c881bd86e90f3 100644
--- a/modules/apps/portal-cache/portal-cache-api/src/main/java/com/liferay/portal/cache/PortalCacheBootstrapLoader.java
+++ b/modules/apps/portal-cache/portal-cache-api/src/main/java/com/liferay/portal/cache/PortalCacheBootstrapLoader.java
@@ -16,7 +16,9 @@
/\*\*
\* @author Tina Tian
+ \* @deprecated As of Judson (7.1.x), with no direct replacement
\*/
+@Deprecated
public interface PortalCacheBootstrapLoader {
public static final String BOOTSTRAP\_ASYNCHRONOUSLY =
diff --git a/modules/apps/portal-cache/portal-cache-api/src/main/java/com/liferay/portal/cache/PortalCacheBootstrapLoaderFactory.java b/modules/apps/portal-cache/portal-cache-api/src/main/java/com/liferay/portal/cache/PortalCacheBootstrapLoaderFactory.java
index 0f71d639539592..1ef7611d4beb11 100644
--- a/modules/apps/portal-cache/portal-cache-api/src/main/java/com/liferay/portal/cache/PortalCacheBootstrapLoaderFactory.java
+++ b/modules/apps/portal-cache/portal-cache-api/src/main/java/com/liferay/portal/cache/PortalCacheBootstrapLoaderFactory.java
@@ -18,7 +18,9 @@
/\*\*
\* @author Tina Tian
+ \* @deprecated As of Judson (7.1.x), with no direct replacement
\*/
+@Deprecated
public interface PortalCacheBootstrapLoaderFactory {
public PortalCacheBootstrapLoader create(Properties properties);
diff --git a/modules/apps/portal-cache/portal-cache-api/src/main/java/com/liferay/portal/cache/configuration/PortalCacheConfiguration.java b/modules/apps/portal-cache/portal-cache-api/src/main/java/com/liferay/portal/cache/configuration/PortalCacheConfiguration.java
index 960e0af412d574..cc64525ba74a1b 100644
--- a/modules/apps/portal-cache/portal-cache-api/src/main/java/com/liferay/portal/cache/configuration/PortalCacheConfiguration.java
+++ b/modules/apps/portal-cache/portal-cache-api/src/main/java/com/liferay/portal/cache/configuration/PortalCacheConfiguration.java
@@ -62,13 +62,14 @@ public PortalCacheConfiguration(
\_portalCacheListenerPropertiesSet = new HashSet<>(
portalCacheListenerPropertiesSet);
}
-
- \_portalCacheBootstrapLoaderProperties =
- portalCacheBootstrapLoaderProperties;
}
+ /\*\*
+ \* @deprecated As of Judson (7.1.x), with no direct replacement
+ \*/
+ @Deprecated
public Properties getPortalCacheBootstrapLoaderProperties() {
- return \_portalCacheBootstrapLoaderProperties;
+ return null;
}
public Set getPortalCacheListenerPropertiesSet() {
@@ -83,18 +84,17 @@ public PortalCacheConfiguration newPortalCacheConfiguration(
String portalCacheName) {
return new PortalCacheConfiguration(
- portalCacheName, \_portalCacheListenerPropertiesSet,
- \_portalCacheBootstrapLoaderProperties);
+ portalCacheName, \_portalCacheListenerPropertiesSet, null);
}
+ /\*\*
+ \* @deprecated As of Judson (7.1.x), with no direct replacement
+ \*/
+ @Deprecated
public void setPortalCacheBootstrapLoaderProperties(
Properties portalCacheBootstrapLoaderProperties) {
-
- \_portalCacheBootstrapLoaderProperties =
- portalCacheBootstrapLoaderProperties;
}
- private Properties \_portalCacheBootstrapLoaderProperties;
private final Set \_portalCacheListenerPropertiesSet;
private final String \_portalCacheName;
diff --git a/modules/apps/portal-cache/portal-cache-ehcache-impl/src/main/java/com/liferay/portal/cache/ehcache/internal/EhcachePortalCacheConfiguration.java b/modules/apps/portal-cache/portal-cache-ehcache-impl/src/main/java/com/liferay/portal/cache/ehcache/internal/EhcachePortalCacheConfiguration.java
index 43059a3bec3a98..f9db5c31fbe62d 100644
--- a/modules/apps/portal-cache/portal-cache-ehcache-impl/src/main/java/com/liferay/portal/cache/ehcache/internal/EhcachePortalCacheConfiguration.java
+++ b/modules/apps/portal-cache/portal-cache-ehcache-impl/src/main/java/com/liferay/portal/cache/ehcache/internal/EhcachePortalCacheConfiguration.java
@@ -30,9 +30,7 @@ public EhcachePortalCacheConfiguration(
Properties portalCacheBootstrapLoaderProperties,
boolean requireSerialization) {
- super(
- portalCacheName, portalCacheListenerPropertiesSet,
- portalCacheBootstrapLoaderProperties);
+ super(portalCacheName, portalCacheListenerPropertiesSet, null);
\_requireSerialization = requireSerialization;
}
@@ -46,8 +44,8 @@ public PortalCacheConfiguration newPortalCacheConfiguration(
String portalCacheName) {
return new EhcachePortalCacheConfiguration(
- portalCacheName, getPortalCacheListenerPropertiesSet(),
- getPortalCacheBootstrapLoaderProperties(), \_requireSerialization);
+ portalCacheName, getPortalCacheListenerPropertiesSet(), null,
+ \_requireSerialization);
}
private final boolean \_requireSerialization;
diff --git a/modules/apps/portal-cache/portal-cache-ehcache-impl/src/main/java/com/liferay/portal/cache/ehcache/internal/MultiVMEhcachePortalCacheManager.java b/modules/apps/portal-cache/portal-cache-ehcache-impl/src/main/java/com/liferay/portal/cache/ehcache/internal/MultiVMEhcachePortalCacheManager.java
index 07b42ae602d683..c0c8e1989b2117 100644
--- a/modules/apps/portal-cache/portal-cache-ehcache-impl/src/main/java/com/liferay/portal/cache/ehcache/internal/MultiVMEhcachePortalCacheManager.java
+++ b/modules/apps/portal-cache/portal-cache-ehcache-impl/src/main/java/com/liferay/portal/cache/ehcache/internal/MultiVMEhcachePortalCacheManager.java
@@ -14,7 +14,6 @@
package com.liferay.portal.cache.ehcache.internal;
-import com.liferay.portal.cache.PortalCacheBootstrapLoaderFactory;
import com.liferay.portal.cache.PortalCacheListenerFactory;
import com.liferay.portal.cache.PortalCacheManagerListenerFactory;
import com.liferay.portal.cache.ehcache.internal.configurator.MultiVMEhcachePortalCacheManagerConfigurator;
@@ -94,14 +93,6 @@ protected void setMultiVMEhcachePortalCacheManagerConfigurator(
multiVMEhcachePortalCacheManagerConfigurator;
}
- @Reference(unbind = "-")
- protected void setPortalCacheBootstrapLoaderFactory(
- PortalCacheBootstrapLoaderFactory portalCacheBootstrapLoaderFactory) {
-
- this.portalCacheBootstrapLoaderFactory =
- portalCacheBootstrapLoaderFactory;
- }
-
@Reference(unbind = "-")
protected void setPortalCacheListenerFactory(
PortalCacheListenerFactory portalCacheListenerFactory) {
diff --git a/modules/apps/portal-cache/portal-cache-ehcache-impl/src/main/java/com/liferay/portal/cache/ehcache/internal/configurator/BaseEhcachePortalCacheManagerConfigurator.java b/modules/apps/portal-cache/portal-cache-ehcache-impl/src/main/java/com/liferay/portal/cache/ehcache/internal/configurator/BaseEhcachePortalCacheManagerConfigurator.java
index cfd2ce3e743baa..283a856372c76d 100644
--- a/modules/apps/portal-cache/portal-cache-ehcache-impl/src/main/java/com/liferay/portal/cache/ehcache/internal/configurator/BaseEhcachePortalCacheManagerConfigurator.java
+++ b/modules/apps/portal-cache/portal-cache-ehcache-impl/src/main/java/com/liferay/portal/cache/ehcache/internal/configurator/BaseEhcachePortalCacheManagerConfigurator.java
@@ -82,8 +82,6 @@ protected void clearListenerConfigrations(
return;
}
- cacheConfiguration.bootstrapCacheLoaderFactory(null);
-
List  factoryConfigurations =
cacheConfiguration.getCacheEventListenerConfigurations();
diff --git a/modules/apps/portal-cache/portal-cache-ehcache-impl/src/main/java/com/liferay/portal/cache/ehcache/internal/configurator/MultiVMEhcachePortalCacheManagerConfigurator.java b/modules/apps/portal-cache/portal-cache-ehcache-impl/src/main/java/com/liferay/portal/cache/ehcache/internal/configurator/MultiVMEhcachePortalCacheManagerConfigurator.java
index 46af1f7bfecf52..8dd362c9635be4 100644
--- a/modules/apps/portal-cache/portal-cache-ehcache-impl/src/main/java/com/liferay/portal/cache/ehcache/internal/configurator/MultiVMEhcachePortalCacheManagerConfigurator.java
+++ b/modules/apps/portal-cache/portal-cache-ehcache-impl/src/main/java/com/liferay/portal/cache/ehcache/internal/configurator/MultiVMEhcachePortalCacheManagerConfigurator.java
@@ -50,16 +50,8 @@ public class MultiVMEhcachePortalCacheManagerConfigurator
@Activate
protected void activate() {
- \_bootstrapLoaderEnabled = GetterUtil.getBoolean(
- props.get(PropsKeys.EHCACHE\_BOOTSTRAP\_CACHE\_LOADER\_ENABLED));
- \_bootstrapLoaderProperties = props.getProperties(
- PropsKeys.EHCACHE\_BOOTSTRAP\_CACHE\_LOADER\_PROPERTIES +
- StringPool.PERIOD,
- true);
clusterEnabled = GetterUtil.getBoolean(
props.get(PropsKeys.CLUSTER\_LINK\_ENABLED));
- \_defaultBootstrapLoaderPropertiesString = getPortalPropertiesString(
- PropsKeys.EHCACHE\_BOOTSTRAP\_CACHE\_LOADER\_PROPERTIES\_DEFAULT);
\_defaultReplicatorPropertiesString = getPortalPropertiesString(
PropsKeys.EHCACHE\_REPLICATOR\_PROPERTIES\_DEFAULT);
\_replicatorProperties = props.getProperties(
@@ -137,12 +129,6 @@ protected void manageConfiguration(
ObjectValuePair propertiesPair =
entry.getValue();
- if (\_bootstrapLoaderEnabled && (propertiesPair.getKey() != null)) {
- portalCacheConfiguration.
- setPortalCacheBootstrapLoaderProperties(
- propertiesPair.getKey());
- }
-
if (propertiesPair.getValue() != null) {
Set portalCacheListenerPropertiesSet =
portalCacheConfiguration.
@@ -180,20 +166,6 @@ protected PortalCacheConfiguration parseCacheListenerConfigurations(
String cacheName = cacheConfiguration.getName();
- if (\_bootstrapLoaderEnabled) {
- String bootstrapLoaderPropertiesString =
- (String)\_bootstrapLoaderProperties.remove(cacheName);
-
- if (Validator.isNull(bootstrapLoaderPropertiesString)) {
- bootstrapLoaderPropertiesString =
- \_defaultBootstrapLoaderPropertiesString;
- }
-
- portalCacheConfiguration.setPortalCacheBootstrapLoaderProperties(
- parseProperties(
- bootstrapLoaderPropertiesString, StringPool.COMMA));
- }
-
String replicatorPropertiesString =
(String)\_replicatorProperties.remove(cacheName);
@@ -227,21 +199,6 @@ protected void setProps(Props props) {
Map>
mergedPropertiesMap = new HashMap<>();
- if (\_bootstrapLoaderEnabled) {
- for (String portalCacheName :
- \_bootstrapLoaderProperties.stringPropertyNames()) {
-
- mergedPropertiesMap.put(
- portalCacheName,
- new ObjectValuePair(
- parseProperties(
- \_bootstrapLoaderProperties.getProperty(
- portalCacheName),
- StringPool.COMMA),
- null));
- }
- }
-
for (String portalCacheName :
\_replicatorProperties.stringPropertyNames()) {
@@ -267,9 +224,6 @@ protected void setProps(Props props) {
return mergedPropertiesMap;
}
- private boolean \_bootstrapLoaderEnabled;
- private Properties \_bootstrapLoaderProperties;
- private String \_defaultBootstrapLoaderPropertiesString;
private String \_defaultReplicatorPropertiesString;
private Properties \_replicatorProperties;
diff --git a/modules/apps/portal-cache/portal-cache-multiple/src/main/java/com/liferay/portal/cache/multiple/internal/bootstrap/ClusterLinkBootstrapLoaderHelperUtil.java b/modules/apps/portal-cache/portal-cache-multiple/src/main/java/com/liferay/portal/cache/multiple/internal/bootstrap/ClusterLinkBootstrapLoaderHelperUtil.java
deleted file mode 100644
index 4c6f8a8eeda1c8..00000000000000
--- a/modules/apps/portal-cache/portal-cache-multiple/src/main/java/com/liferay/portal/cache/multiple/internal/bootstrap/ClusterLinkBootstrapLoaderHelperUtil.java
+++ /dev/null
@@ -1,472 +0,0 @@
-/\*\*
- \* Copyright (c) 2000-present Liferay, Inc. All rights reserved.
- \*
- \* This library is free software; you can redistribute it and/or modify it under
- \* the terms of the GNU Lesser General Public License as published by the Free
- \* Software Foundation; either version 2.1 of the License, or (at your option)
- \* any later version.
- \*
- \* This library is distributed in the hope that it will be useful, but WITHOUT
- \* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
- \* FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
- \* details.
- \*/
-
-package com.liferay.portal.cache.multiple.internal.bootstrap;
-
-import com.liferay.petra.lang.CentralizedThreadLocal;
-import com.liferay.portal.kernel.cache.PortalCache;
-import com.liferay.portal.kernel.cache.PortalCacheHelperUtil;
-import com.liferay.portal.kernel.cache.PortalCacheManager;
-import com.liferay.portal.kernel.cache.PortalCacheManagerProvider;
-import com.liferay.portal.kernel.cluster.ClusterExecutorUtil;
-import com.liferay.portal.kernel.cluster.ClusterNode;
-import com.liferay.portal.kernel.cluster.ClusterNodeResponse;
-import com.liferay.portal.kernel.cluster.ClusterRequest;
-import com.liferay.portal.kernel.cluster.FutureClusterResponses;
-import com.liferay.portal.kernel.exception.SystemException;
-import com.liferay.portal.kernel.io.AnnotatedObjectInputStream;
-import com.liferay.portal.kernel.io.AnnotatedObjectOutputStream;
-import com.liferay.portal.kernel.log.Log;
-import com.liferay.portal.kernel.log.LogFactoryUtil;
-import com.liferay.portal.kernel.util.GetterUtil;
-import com.liferay.portal.kernel.util.MethodHandler;
-import com.liferay.portal.kernel.util.MethodKey;
-import com.liferay.portal.kernel.util.PropsKeys;
-import com.liferay.portal.kernel.util.PropsUtil;
-import com.liferay.portal.kernel.util.SocketUtil;
-
-import java.io.IOException;
-import java.io.ObjectInputStream;
-import java.io.ObjectOutputStream;
-import java.io.OutputStream;
-import java.io.Serializable;
-
-import java.net.ServerSocket;
-import java.net.Socket;
-import java.net.SocketAddress;
-import java.net.SocketException;
-import java.net.SocketTimeoutException;
-
-import java.nio.channels.ServerSocketChannel;
-
-import java.util.ArrayList;
-import java.util.Arrays;
-import java.util.Collections;
-import java.util.HashMap;
-import java.util.List;
-import java.util.Map;
-import java.util.concurrent.BlockingQueue;
-import java.util.concurrent.TimeUnit;
-
-import org.osgi.service.component.annotations.Activate;
-import org.osgi.service.component.annotations.Component;
-
-/\*\*
- \* @author Shuyang Zhou
- \* @author Sherry Yang
- \*/
-@Component(immediate = true, service = {})
-public class ClusterLinkBootstrapLoaderHelperUtil {
-
- public static SocketAddress createServerSocketFromCluster(
- String portalCacheManagerName, List portalCacheNames)
- throws Exception {
-
- ClusterNode localClusterNode =
- ClusterExecutorUtil.getLocalClusterNode();
-
- ServerSocketChannel serverSocketChannel =
- SocketUtil.createServerSocketChannel(
- localClusterNode.getBindInetAddress(),
- GetterUtil.getInteger(
- PropsUtil.get(PropsKeys.EHCACHE\_SOCKET\_START\_PORT), 32454),
- \_serverSocketConfigurator);
-
- ServerSocket serverSocket = serverSocketChannel.socket();
-
- ClusterLinkBootstrapLoaderServerThread
- clusterLinkBootstrapLoaderServerThread =
- new ClusterLinkBootstrapLoaderServerThread(
- serverSocket, portalCacheManagerName, portalCacheNames);
-
- clusterLinkBootstrapLoaderServerThread.start();
-
- return serverSocket.getLocalSocketAddress();
- }
-
- public static boolean isSkipped() {
- return \_skipBootstrapLoaderThreadLocal.get();
- }
-
- public static void loadCachesFromCluster(
- String portalCacheManagerName, String... portalCacheNames)
- throws Exception {
-
- synchronized (ClusterLinkBootstrapLoaderHelperUtil.class) {
- if (!\_started) {
- List portalCaches = \_deferredPortalCaches.get(
- portalCacheManagerName);
-
- if (portalCaches == null) {
- portalCaches = new ArrayList<>();
-
- \_deferredPortalCaches.put(
- portalCacheManagerName, portalCaches);
- }
-
- Collections.addAll(portalCaches, portalCacheNames);
-
- return;
- }
- }
-
- List clusterNodes = ClusterExecutorUtil.getClusterNodes();
-
- if (\_log.isInfoEnabled()) {
- \_log.info("Cluster nodes " + clusterNodes);
- }
-
- if (clusterNodes.size() <= 1) {
- if (\_log.isDebugEnabled()) {
- \_log.debug(
- "Not loading cache from cluster because a cluster peer " +
- "was not found");
- }
-
- return;
- }
-
- PortalCacheManager extends Serializable, ? portalCacheManager =
- PortalCacheManagerProvider.getPortalCacheManager(
- portalCacheManagerName);
-
- if (!portalCacheManager.isClusterAware()) {
- return;
- }
-
- ClusterRequest clusterRequest = ClusterRequest.createMulticastRequest(
- new MethodHandler(
- \_createServerSocketFromClusterMethodKey, portalCacheManagerName,
- Arrays.asList(portalCacheNames)),
- true);
-
- FutureClusterResponses futureClusterResponses =
- ClusterExecutorUtil.execute(clusterRequest);
-
- BlockingQueue clusterNodeResponses =
- futureClusterResponses.getPartialResults();
-
- ClusterNodeResponse clusterNodeResponse = null;
-
- try {
- clusterNodeResponse = clusterNodeResponses.poll(
- GetterUtil.getLong(
- PropsUtil.get(
- PropsKeys.CLUSTER\_LINK\_NODE\_BOOTUP\_RESPONSE\_TIMEOUT),
- 10000),
- TimeUnit.MILLISECONDS);
- }
- catch (InterruptedException ie) {
- return;
- }
-
- if (clusterNodeResponse == null) {
- if (\_log.isWarnEnabled()) {
- \_log.warn(
- "Unable to load cache from the cluster because there was " +
- "no peer response");
- }
-
- return;
- }
-
- if (\_log.isInfoEnabled()) {
- \_log.info(
- "Load cache data from cluster node " +
- clusterNodeResponse.getClusterNode());
- }
-
- Socket socket = null;
-
- try {
- SocketAddress remoteSocketAddress =
- (SocketAddress)clusterNodeResponse.getResult();
-
- if (remoteSocketAddress == null) {
- \_log.error(
- "Cluster peer " + clusterNodeResponse.getClusterNode() +
- " responded with a null socket address");
-
- return;
- }
-
- socket = new Socket();
-
- socket.connect(remoteSocketAddress);
-
- socket.shutdownOutput();
-
- ObjectInputStream objectInputStream =
- new AnnotatedObjectInputStream(socket.getInputStream());
-
- PortalCache portalCache = null;
-
- try {
- while (true) {
- Object object = objectInputStream.readObject();
-
- if (object instanceof CacheElement) {
- CacheElement cacheElement = (CacheElement)object;
-
- PortalCacheHelperUtil.putWithoutReplicator(
- portalCache, cacheElement.getKey(),
- cacheElement.getValue());
- }
- else if (object instanceof String) {
- if (\_COMMAND\_SOCKET\_CLOSE.equals(object)) {
- break;
- }
-
- \_skipBootstrapLoaderThreadLocal.set(Boolean.TRUE);
-
- try {
- portalCache =
- (PortalCache)
- portalCacheManager.getPortalCache(
- (String)object);
- }
- finally {
- \_skipBootstrapLoaderThreadLocal.remove();
- }
- }
- else {
- throw new SystemException(
- "Socket input stream returned invalid object " +
- object);
- }
- }
- }
- finally {
- if (objectInputStream != null) {
- objectInputStream.close();
- }
- }
- }
- catch (Exception e) {
- throw new Exception(
- "Unable to load cache data from cluster node " +
- clusterNodeResponse.getClusterNode(),
- e);
- }
- finally {
- if (socket != null) {
- socket.close();
- }
- }
- }
-
- @Activate
- protected void activate() {
- if (!\_started) {
- \_started = true;
- }
-
- if (\_deferredPortalCaches.isEmpty()) {
- return;
- }
-
- if (\_log.isDebugEnabled()) {
- \_log.debug("Loading deferred caches");
- }
-
- try {
- for (Map.Entry> entry :
- \_deferredPortalCaches.entrySet()) {
-
- List portalCacheNames = entry.getValue();
-
- if (portalCacheNames.isEmpty()) {
- continue;
- }
-
- loadCachesFromCluster(
- entry.getKey(),
- portalCacheNames.toArray(
- new String[portalCacheNames.size()]));
- }
- }
- catch (Exception e) {
- if (\_log.isWarnEnabled()) {
- \_log.warn("Unable to load cache data from the cluster", e);
- }
- }
- finally {
- \_deferredPortalCaches.clear();
- }
- }
-
- private static final String \_COMMAND\_SOCKET\_CLOSE = "${SOCKET\_CLOSE}";
-
- private static final Log \_log = LogFactoryUtil.getLog(
- ClusterLinkBootstrapLoaderHelperUtil.class);
-
- private static final MethodKey \_createServerSocketFromClusterMethodKey =
- new MethodKey(
- ClusterLinkBootstrapLoaderHelperUtil.class,
- "createServerSocketFromCluster", String.class, List.class);
- private static final Map> \_deferredPortalCaches =
- new HashMap<>();
- private static final SocketUtil.ServerSocketConfigurator
- \_serverSocketConfigurator = new SocketCacheServerSocketConfiguration();
- private static final ThreadLocal \_skipBootstrapLoaderThreadLocal =
- new CentralizedThreadLocal<>(
- ClusterLinkBootstrapLoaderHelperUtil.class +
- ".\_skipBootstrapLoaderThreadLocal",
- () -> Boolean.FALSE, false);
- private static boolean \_started;
-
- private static class CacheElement implements Serializable {
-
- public CacheElement(Serializable key, Serializable value) {
- \_key = key;
- \_value = value;
- }
-
- public Serializable getKey() {
- return \_key;
- }
-
- public Serializable getValue() {
- return \_value;
- }
-
- private final Serializable \_key;
- private final Serializable \_value;
-
- }
-
- private static class ClusterLinkBootstrapLoaderServerThread extends Thread {
-
- public ClusterLinkBootstrapLoaderServerThread(
- ServerSocket serverSocket, String portalCacheManagerName,
- List portalCacheNames) {
-
- \_serverSocket = serverSocket;
- \_portalCacheManagerName = portalCacheManagerName;
- \_portalCacheNames = portalCacheNames;
-
- setDaemon(true);
- setName(
- ClusterLinkBootstrapLoaderServerThread.class.getName() + " - " +
- portalCacheNames);
- setPriority(Thread.NORM\_PRIORITY);
- }
-
- @Override
- public void run() {
- Socket socket = null;
-
- try {
- try {
- socket = \_serverSocket.accept();
- }
- catch (SocketTimeoutException ste) {
- if (\_log.isDebugEnabled()) {
- \_log.debug(
- "Terminating the socket thread " + getName() +
- " that the client requested but never used");
- }
-
- return;
- }
- finally {
- \_serverSocket.close();
- }
-
- socket.shutdownInput();
-
- try (OutputStream outputStream = socket.getOutputStream();
- ObjectOutputStream objectOutputStream =
- new AnnotatedObjectOutputStream(outputStream)) {
-
- PortalCacheManager extends Serializable, ?
- portalCacheManager =
- PortalCacheManagerProvider.getPortalCacheManager(
- \_portalCacheManagerName);
-
- for (String portalCacheName : \_portalCacheNames) {
- PortalCache portalCache =
- (PortalCache)
- portalCacheManager.getPortalCache(
- portalCacheName);
-
- if (portalCache == null) {
- \_skipBootstrapLoaderThreadLocal.set(Boolean.TRUE);
-
- try {
- portalCacheManager.getPortalCache(
- portalCacheName);
- }
- finally {
- \_skipBootstrapLoaderThreadLocal.remove();
- }
-
- continue;
- }
-
- objectOutputStream.writeObject(portalCacheName);
-
- List keys = portalCache.getKeys();
-
- for (Serializable key : keys) {
- Serializable value = portalCache.get(key);
-
- if (value != null) {
- CacheElement cacheElement = new CacheElement(
- key, value);
-
- objectOutputStream.writeObject(cacheElement);
- }
- }
- }
-
- objectOutputStream.writeObject(\_COMMAND\_SOCKET\_CLOSE);
- }
- }
- catch (Exception e) {
- throw new RuntimeException(e);
- }
- finally {
- if (socket != null) {
- try {
- socket.close();
- }
- catch (IOException ioe) {
- throw new RuntimeException(ioe);
- }
- }
- }
- }
-
- private final String \_portalCacheManagerName;
- private final List \_portalCacheNames;
- private final ServerSocket \_serverSocket;
-
- }
-
- private static class SocketCacheServerSocketConfiguration
- implements SocketUtil.ServerSocketConfigurator {
-
- @Override
- public void configure(ServerSocket serverSocket)
- throws SocketException {
-
- serverSocket.setSoTimeout(
- GetterUtil.getInteger(
- PropsUtil.get(PropsKeys.EHCACHE\_SOCKET\_SO\_TIMEOUT), 10000));
- }
-
- }
-
-}
\ No newline at end of file
diff --git a/modules/apps/portal-cache/portal-cache-multiple/src/main/java/com/liferay/portal/cache/multiple/internal/bootstrap/ClusterLinkPortalCacheBootstrapLoader.java b/modules/apps/portal-cache/portal-cache-multiple/src/main/java/com/liferay/portal/cache/multiple/internal/bootstrap/ClusterLinkPortalCacheBootstrapLoader.java
deleted file mode 100644
index 2351fd17c08524..00000000000000
--- a/modules/apps/portal-cache/portal-cache-multiple/src/main/java/com/liferay/portal/cache/multiple/internal/bootstrap/ClusterLinkPortalCacheBootstrapLoader.java
+++ /dev/null
@@ -1,133 +0,0 @@
-/\*\*
- \* Copyright (c) 2000-present Liferay, Inc. All rights reserved.
- \*
- \* This library is free software; you can redistribute it and/or modify it under
- \* the terms of the GNU Lesser General Public License as published by the Free
- \* Software Foundation; either version 2.1 of the License, or (at your option)
- \* any later version.
- \*
- \* This library is distributed in the hope that it will be useful, but WITHOUT
- \* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
- \* FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
- \* details.
- \*/
-
-package com.liferay.portal.cache.multiple.internal.bootstrap;
-
-import com.liferay.petra.string.StringBundler;
-import com.liferay.portal.cache.PortalCacheBootstrapLoader;
-import com.liferay.portal.kernel.log.Log;
-import com.liferay.portal.kernel.log.LogFactoryUtil;
-import com.liferay.portal.kernel.util.GetterUtil;
-
-import java.util.Properties;
-
-/\*\*
- \* @author Tina Tian
- \*/
-public class ClusterLinkPortalCacheBootstrapLoader
- implements PortalCacheBootstrapLoader {
-
- public ClusterLinkPortalCacheBootstrapLoader(Properties properties) {
- if (properties != null) {
- \_bootstrapAsynchronously = GetterUtil.getBoolean(
- properties.getProperty(
- PortalCacheBootstrapLoader.BOOTSTRAP\_ASYNCHRONOUSLY),
- PortalCacheBootstrapLoader.DEFAULT\_BOOTSTRAP\_ASYNCHRONOUSLY);
- }
- else {
- \_bootstrapAsynchronously =
- PortalCacheBootstrapLoader.DEFAULT\_BOOTSTRAP\_ASYNCHRONOUSLY;
- }
- }
-
- @Override
- public boolean isAsynchronous() {
- return \_bootstrapAsynchronously;
- }
-
- @Override
- public void loadPortalCache(
- String portalCacheManagerName, String portalCacheName) {
-
- if (ClusterLinkBootstrapLoaderHelperUtil.isSkipped()) {
- return;
- }
-
- if (\_bootstrapAsynchronously) {
- BootstrapLoaderClientThread bootstrapLoaderClientThread =
- new BootstrapLoaderClientThread(
- portalCacheManagerName, portalCacheName);
-
- bootstrapLoaderClientThread.start();
- }
- else {
- doLoad(portalCacheManagerName, portalCacheName);
- }
- }
-
- protected void doLoad(
- String portalCacheManagerName, String portalCacheName) {
-
- if (\_log.isDebugEnabled()) {
- \_log.debug("Bootstraping " + portalCacheName);
- }
-
- try {
- ClusterLinkBootstrapLoaderHelperUtil.loadCachesFromCluster(
- portalCacheManagerName, portalCacheName);
- }
- catch (Exception e) {
- if (\_log.isWarnEnabled()) {
- \_log.warn("Unable to load cache data from the cluster", e);
- }
- }
- }
-
- private static final Log \_log = LogFactoryUtil.getLog(
- ClusterLinkPortalCacheBootstrapLoader.class);
-
- private final boolean \_bootstrapAsynchronously;
-
- private class BootstrapLoaderClientThread extends Thread {
-
- public BootstrapLoaderClientThread(
- String portalCacheManagerName, String portalCacheName) {
-
- if (\_log.isDebugEnabled()) {
- \_log.debug(
- StringBundler.concat(
- "Bootstrap loader client thread for cache ",
- portalCacheName, " from cache manager ",
- portalCacheManagerName));
- }
-
- \_portalCacheManagerName = portalCacheManagerName;
- \_portalCacheName = portalCacheName;
-
- setDaemon(true);
- setName(
- StringBundler.concat(
- BootstrapLoaderClientThread.class.getName(), " - ",
- portalCacheManagerName, " - ", portalCacheName));
- setPriority(Thread.NORM\_PRIORITY);
- }
-
- @Override
- public void run() {
- try {
- doLoad(\_portalCacheManagerName, \_portalCacheName);
- }
- catch (Exception e) {
- if (\_log.isWarnEnabled()) {
- \_log.warn("Unable to asynchronously stream bootstrap", e);
- }
- }
- }
-
- private final String \_portalCacheManagerName;
- private final String \_portalCacheName;
-
- }
-
-}
\ No newline at end of file
diff --git a/modules/apps/portal-odata/portal-odata-impl/build.gradle b/modules/apps/portal-odata/portal-odata-impl/build.gradle
index 64260414a99d8f..16653553127b52 100644
--- a/modules/apps/portal-odata/portal-odata-impl/build.gradle
+++ b/modules/apps/portal-odata/portal-odata-impl/build.gradle
@@ -1,5 +1,5 @@
dependencies {
- compileInclude group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.9.3"
+ compileInclude group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.10.1"
compileInclude group: "org.apache.olingo", name: "odata-commons-api", version: "4.4.0"
compileInclude group: "org.apache.olingo", name: "odata-commons-core", version: "4.4.0"
compileInclude group: "org.apache.olingo", name: "odata-server-api", version: "4.4.0"
diff --git a/modules/apps/portal-search-elasticsearch6/portal-search-elasticsearch6-impl/build.gradle b/modules/apps/portal-search-elasticsearch6/portal-search-elasticsearch6-impl/build.gradle
index 398d45f330b892..71a5bcf4e5f1df 100644
--- a/modules/apps/portal-search-elasticsearch6/portal-search-elasticsearch6-impl/build.gradle
+++ b/modules/apps/portal-search-elasticsearch6/portal-search-elasticsearch6-impl/build.gradle
@@ -9,7 +9,7 @@ configurations {
dependencies {
compileInclude group: "com.carrotsearch", name: "hppc", version: "0.7.1"
- compileInclude group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.9"
+ compileInclude group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
compileInclude group: "com.fasterxml.jackson.dataformat", name: "jackson-dataformat-cbor", version: "2.8.10"
compileInclude group: "com.fasterxml.jackson.dataformat", name: "jackson-dataformat-smile", version: "2.8.10"
compileInclude group: "com.fasterxml.jackson.dataformat", name: "jackson-dataformat-yaml", version: "2.8.10"
diff --git a/modules/apps/portal-search/portal-search-web/src/main/resources/META-INF/resources/search/results/view.jsp b/modules/apps/portal-search/portal-search-web/src/main/resources/META-INF/resources/search/results/view.jsp
index f860939606be0f..ec811ef196a823 100644
--- a/modules/apps/portal-search/portal-search-web/src/main/resources/META-INF/resources/search/results/view.jsp
+++ b/modules/apps/portal-search/portal-search-web/src/main/resources/META-INF/resources/search/results/view.jsp
@@ -133,7 +133,7 @@ com.liferay.portal.kernel.dao.search.SearchContainer
-  **<%= searchResultSummaryDisplayContext.getCreatorUserName() %>**
+  **<%= HtmlUtil.escape(searchResultSummaryDisplayContext.getCreatorUserName()) %>**

diff --git a/modules/apps/portal-search/portal-search-web/src/main/resources/META-INF/resources/user/facet/view.jsp b/modules/apps/portal-search/portal-search-web/src/main/resources/META-INF/resources/user/facet/view.jsp
index 27e999113dc415..12fcc92d9ddc30 100644
--- a/modules/apps/portal-search/portal-search-web/src/main/resources/META-INF/resources/user/facet/view.jsp
+++ b/modules/apps/portal-search/portal-search-web/src/main/resources/META-INF/resources/user/facet/view.jsp
@@ -82,7 +82,7 @@ UserSearchFacetDisplayContext userSearchFacetDisplayContext = (UserSearchFacetDi- -  />
  +  />
  ">
  <%= HtmlUtil.escape(userSearchFacetTermDisplayContext.getUserName()) %>
  diff --git a/modules/apps/portal-security-sso/portal-security-sso-google-impl/build.gradle b/modules/apps/portal-security-sso/portal-security-sso-google-impl/build.gradle
  index 084e48a37e1d13..e59aa1713c21a9 100644
  --- a/modules/apps/portal-security-sso/portal-security-sso-google-impl/build.gradle
  +++ b/modules/apps/portal-security-sso/portal-security-sso-google-impl/build.gradle
  @@ -1,5 +1,5 @@
  dependencies {
  - compileInclude group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.9"
  + compileInclude group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
  compileInclude group: "com.google.api-client", name: "google-api-client", version: "1.21.0"
  compileInclude group: "com.google.apis", name: "google-api-services-oauth2", version: "v2-rev103-1.21.0"
  compileInclude group: "com.google.http-client", name: "google-http-client", version: "1.21.0"
  diff --git a/modules/apps/portal-security-sso/portal-security-sso-openid-connect-impl/build.gradle b/modules/apps/portal-security-sso/portal-security-sso-openid-connect-impl/build.gradle
  index d1872ee1d1762b..3390d505fca3bc 100644
  --- a/modules/apps/portal-security-sso/portal-security-sso-openid-connect-impl/build.gradle
  +++ b/modules/apps/portal-security-sso/portal-security-sso-openid-connect-impl/build.gradle
  @@ -1,8 +1,8 @@
  dependencies {
  compileInclude group: "com.github.stephenc.jcip", name: "jcip-annotations", version: "1.0-1"
  compileInclude group: "com.nimbusds", name: "lang-tag", version: "1.4.4"
  - compileInclude group: "com.nimbusds", name: "nimbus-jose-jwt", version: "6.7"
  - compileInclude group: "com.nimbusds", name: "oauth2-oidc-sdk", version: "6.5"
  + compileInclude group: "com.nimbusds", name: "nimbus-jose-jwt", version: "7.9"
  + compileInclude group: "com.nimbusds", name: "oauth2-oidc-sdk", version: "6.16.2"
  compileInclude group: "com.sun.mail", name: "javax.mail", version: "1.6.2"
  compileInclude group: "javax.activation", name: "activation", version: "1.1.1"
  compileInclude group: "net.minidev", name: "accessors-smart", version: "1.2"
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/configs/com.liferay.portal.security.auth.verifier.internal.portal.session.module.configuration.PortalSessionAuthVerifierConfiguration-default.cfg b/modules/apps/portal-security/portal-security-auth-verifier/configs/com.liferay.portal.security.auth.verifier.internal.portal.session.module.configuration.PortalSessionAuthVerifierConfiguration-default.cfg
  index 34dc9e7c655ea4..c6de92ec800b66 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/configs/com.liferay.portal.security.auth.verifier.internal.portal.session.module.configuration.PortalSessionAuthVerifierConfiguration-default.cfg
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/configs/com.liferay.portal.security.auth.verifier.internal.portal.session.module.configuration.PortalSessionAuthVerifierConfiguration-default.cfg
  @@ -1,2 +1,3 @@
  +checkCSRFToken=B"false"
  enabled=true
  urlsIncludes=/api/json\*,/api/jsonws\*,/c/portal/json\_service\*
  \ No newline at end of file
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/java/com/liferay/portal/security/auth/verifier/internal/portal/session/PortalSessionAuthVerifier.java b/modules/apps/portal-security/portal-security-auth-verifier/src/main/java/com/liferay/portal/security/auth/verifier/internal/portal/session/PortalSessionAuthVerifier.java
  index daabd0130dacbb..9a330520cf832a 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/java/com/liferay/portal/security/auth/verifier/internal/portal/session/PortalSessionAuthVerifier.java
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/java/com/liferay/portal/security/auth/verifier/internal/portal/session/PortalSessionAuthVerifier.java
  @@ -14,13 +14,19 @@
  package com.liferay.portal.security.auth.verifier.internal.portal.session;
  +import com.liferay.petra.string.StringBundler;
  import com.liferay.portal.kernel.exception.PortalException;
  import com.liferay.portal.kernel.exception.SystemException;
  +import com.liferay.portal.kernel.log.Log;
  +import com.liferay.portal.kernel.log.LogFactoryUtil;
  import com.liferay.portal.kernel.model.User;
  import com.liferay.portal.kernel.security.auth.AccessControlContext;
  import com.liferay.portal.kernel.security.auth.AuthException;
  +import com.liferay.portal.kernel.security.auth.AuthTokenUtil;
  +import com.liferay.portal.kernel.security.auth.PrincipalException;
  import com.liferay.portal.kernel.security.auth.verifier.AuthVerifier;
  import com.liferay.portal.kernel.security.auth.verifier.AuthVerifierResult;
  +import com.liferay.portal.kernel.util.GetterUtil;
  import com.liferay.portal.kernel.util.PortalUtil;
  import java.util.Properties;
  @@ -47,14 +53,40 @@ public AuthVerifierResult verify(
  try {
  AuthVerifierResult authVerifierResult = new AuthVerifierResult();
  - HttpServletRequest request = accessControlContext.getRequest();
  + HttpServletRequest httpServletRequest =
  + accessControlContext.getRequest();
  - User user = PortalUtil.getUser(request);
  + User user = PortalUtil.getUser(httpServletRequest);
  if ((user == null) || user.isDefaultUser()) {
  return authVerifierResult;
  }
  + boolean checkCSRFToken = GetterUtil.getBoolean(
  + properties.get("check.csrf.token"), true);
  +
  + if (checkCSRFToken) {
  + HttpServletRequest originalHttpServletRequest =
  + PortalUtil.getOriginalServletRequest(httpServletRequest);
  +
  + String requestURI = originalHttpServletRequest.getRequestURI();
  +
  + try {
  + AuthTokenUtil.checkCSRFToken(
  + originalHttpServletRequest, requestURI);
  + }
  + catch (PrincipalException pe) {
  + if (\_log.isDebugEnabled()) {
  + \_log.debug(
  + StringBundler.concat(
  + "Unable to verify CSRF token for ", requestURI,
  + ": ", pe.getMessage()));
  + }
  +
  + return authVerifierResult;
  + }
  + }
  +
  authVerifierResult.setPasswordBasedAuthentication(true);
  authVerifierResult.setState(AuthVerifierResult.State.SUCCESS);
  authVerifierResult.setUserId(user.getUserId());
  @@ -69,4 +101,7 @@ public AuthVerifierResult verify(
  }
  }
  + private static final Log \_log = LogFactoryUtil.getLog(
  + PortalSessionAuthVerifier.class);
  +
  }
  \ No newline at end of file
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/java/com/liferay/portal/security/auth/verifier/internal/portal/session/module/PortalSessionAuthVerifierPublisher.java b/modules/apps/portal-security/portal-security-auth-verifier/src/main/java/com/liferay/portal/security/auth/verifier/internal/portal/session/module/PortalSessionAuthVerifierPublisher.java
  index f474fa8ee56e7e..631491f9b875f9 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/java/com/liferay/portal/security/auth/verifier/internal/portal/session/module/PortalSessionAuthVerifierPublisher.java
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/java/com/liferay/portal/security/auth/verifier/internal/portal/session/module/PortalSessionAuthVerifierPublisher.java
  @@ -18,6 +18,7 @@
  import com.liferay.portal.security.auth.verifier.internal.module.BaseAuthVerifierPublisher;
  import com.liferay.portal.security.auth.verifier.internal.portal.session.PortalSessionAuthVerifier;
  +import java.util.HashMap;
  import java.util.Map;
  import org.osgi.framework.BundleContext;
  @@ -42,6 +43,12 @@ public class PortalSessionAuthVerifierPublisher
  protected void activate(
  BundleContext bundleContext, Map properties) {
  + if (!properties.containsKey("check.csrf.token")) {
  + properties = new HashMap<>(properties);
  +
  + properties.put("check.csrf.token", false);
  + }
  +
  super.activate(bundleContext, properties);
  }
  @@ -64,6 +71,15 @@ protected void modified(
  super.modified(bundleContext, properties);
  }
  + @Override
  + protected String translateKey(String authVerifierPropertyName, String key) {
  + if (key.equals("hostsAllowed")) {
  + key = "check.csrf.token";
  + }
  +
  + return super.translateKey(authVerifierPropertyName, key);
  + }
  +
  private final AuthVerifier \_authVerifier = new PortalSessionAuthVerifier();
  }
  \ No newline at end of file
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/java/com/liferay/portal/security/auth/verifier/internal/portal/session/module/configuration/PortalSessionAuthVerifierConfiguration.java b/modules/apps/portal-security/portal-security-auth-verifier/src/main/java/com/liferay/portal/security/auth/verifier/internal/portal/session/module/configuration/PortalSessionAuthVerifierConfiguration.java
  index d5330b75067e9e..2482933cec9c87 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/java/com/liferay/portal/security/auth/verifier/internal/portal/session/module/configuration/PortalSessionAuthVerifierConfiguration.java
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/java/com/liferay/portal/security/auth/verifier/internal/portal/session/module/configuration/PortalSessionAuthVerifierConfiguration.java
  @@ -34,4 +34,8 @@
  )
  public interface PortalSessionAuthVerifierConfiguration
  extends BaseAuthVerifierConfiguration {
  +
  + @Meta.AD(deflt = "true", name = "check-csrf-token", required = false)
  + public boolean checkCSRFToken();
  +
  }
  \ No newline at end of file
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language.properties
  index 5b0443af9c399f..9044e9e744ec07 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=Basic Auth Header
  +check-csrf-token=Check CSRF Token
  digest-authentication-auth-verifier-configuration-name=Digest Authentication
  force-basic-auth=Force Basic Authentication
  force-digest-auth=Force Digest Authentication
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_ar.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_ar.properties
  index d868709522eef8..9113dc159c1c3c 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_ar.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_ar.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=  
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name= 
  force-basic-auth=  
  force-digest-auth=   
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_bg.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_bg.properties
  index 442b8523bdc94e..1e5d546d8ca188 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_bg.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_bg.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=   (Automatic Translation)
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=  (Automatic Translation)
  force-basic-auth=   (Automatic Translation)
  force-digest-auth=   (Automatic Translation)
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_ca.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_ca.properties
  index 429d806a1a2cf0..d4af9ddb0182be 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_ca.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_ca.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=Capalera d'autenticaci bsica
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=Autenticaci amb credencials
  force-basic-auth=Fora l'autenticaci bsica
  force-digest-auth=Fora l'autenticaci de resum
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_cs.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_cs.properties
  index 4e3772ebc0f710..7ca06f624a54c5 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_cs.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_cs.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=Zkladn oven hlaviky (Automatic Translation)
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=Ovovn algoritmem Digest (Automatic Translation)
  force-basic-auth=Zkladn ovovn platnosti (Automatic Translation)
  force-digest-auth=Sla ovovn algoritmem Digest (Automatic Translation)
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_da.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_da.properties
  index c5a47b11d76688..2bca0a8d994217 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_da.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_da.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=Basic Auth Header (Automatic Copy)
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=Digest Authentication (Automatic Copy)
  force-basic-auth=Force Basic Authentication (Automatic Copy)
  force-digest-auth=Force Digest Authentication (Automatic Copy)
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_de.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_de.properties
  index f7eb656bd6e97b..e2439aa6d52af6 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_de.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_de.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=berschrift Basisauthentifizierung
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=Digest-Authentifizierung
  force-basic-auth=Basisauthentifizierung erzwingen
  force-digest-auth=Digest-Authentifizierung erzwingen
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_el.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_el.properties
  index ae18e02003e005..5958f0ea6c7822 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_el.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_el.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=   (Automatic Translation)
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=   Digest (Automatic Translation)
  force-basic-auth=     (Automatic Translation)
  force-digest-auth=   Digest  (Automatic Translation)
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_en.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_en.properties
  index 5b0443af9c399f..9044e9e744ec07 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_en.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_en.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=Basic Auth Header
  +check-csrf-token=Check CSRF Token
  digest-authentication-auth-verifier-configuration-name=Digest Authentication
  force-basic-auth=Force Basic Authentication
  force-digest-auth=Force Digest Authentication
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_es.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_es.properties
  index 0199b0fb1978e7..6947caace8f0b8 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_es.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_es.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=Encabezado de autenticacin bsica
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=Autenticacin implcita
  force-basic-auth=Forzar autenticacin bsica
  force-digest-auth=Forzar autenticacin implcita
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_et.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_et.properties
  index 233f1cf1648cd8..17539e05c11720 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_et.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_et.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=Basic Auth pis (Automatic Translation)
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=Autentimine (Automatic Translation)
  force-basic-auth=Ju phiautentimist (Automatic Translation)
  force-digest-auth=Ju autentimine (Automatic Translation)
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_eu.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_eu.properties
  index c5a47b11d76688..2bca0a8d994217 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_eu.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_eu.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=Basic Auth Header (Automatic Copy)
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=Digest Authentication (Automatic Copy)
  force-basic-auth=Force Basic Authentication (Automatic Copy)
  force-digest-auth=Force Digest Authentication (Automatic Copy)
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_fa.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_fa.properties
  index cb61dd3eec324d..16453f56a8758d 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_fa.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_fa.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=   (Automatic Translation)
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name= (Automatic Translation)
  force-basic-auth=    (Automatic Translation)
  force-digest-auth=    (Automatic Translation)
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_fi.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_fi.properties
  index 7e83a9be33e2ce..85a2a19acc93e1 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_fi.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_fi.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=Perus-tunnistusotsikko
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=Koontitodennus
  force-basic-auth=Pakota Perustodennus
  force-digest-auth=Pakota Koontiarvotodennus
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_fr.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_fr.properties
  index a8e56928e322bb..0d87a1e47abe52 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_fr.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_fr.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=En-tte d'authentification basique
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=Authentification du manifeste
  force-basic-auth=Forcer l'authentification basique
  force-digest-auth=Forcer l'authentification du manifeste
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_gl.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_gl.properties
  index c5a47b11d76688..2bca0a8d994217 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_gl.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_gl.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=Basic Auth Header (Automatic Copy)
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=Digest Authentication (Automatic Copy)
  force-basic-auth=Force Basic Authentication (Automatic Copy)
  force-digest-auth=Force Digest Authentication (Automatic Copy)
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_hi\_IN.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_hi\_IN.properties
  index 63fa7a88c2f30e..3d16c5d8f35bb6 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_hi\_IN.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_hi\_IN.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=    (Automatic Translation)
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=  (Automatic Translation)
  force-basic-auth=   (Automatic Translation)
  force-digest-auth=   (Automatic Translation)
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_hr.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_hr.properties
  index c5a47b11d76688..2bca0a8d994217 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_hr.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_hr.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=Basic Auth Header (Automatic Copy)
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=Digest Authentication (Automatic Copy)
  force-basic-auth=Force Basic Authentication (Automatic Copy)
  force-digest-auth=Force Digest Authentication (Automatic Copy)
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_hu.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_hu.properties
  index 70e7df85441638..d0fa3ae20c0e06 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_hu.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_hu.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=Alapszint hitelest fejlc
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=Kivonatos hitelests
  force-basic-auth=Knyszertett alapszint hitelests
  force-digest-auth=Knyszertett kivonatos hitelests
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_in.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_in.properties
  index 00fe252c98e61e..31e4d9d9e90f2b 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_in.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_in.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=Dasar Auth Header (Automatic Translation)
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=Digest otentikasi (Automatic Translation)
  force-basic-auth=Otentikasi dasar kekuatan (Automatic Translation)
  force-digest-auth=Kekuatan Digest otentikasi (Automatic Translation)
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_it.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_it.properties
  index 3b56eafc79d165..2ddd5df5ff7dfa 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_it.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_it.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=Intestazione di Auth base (Automatic Translation)
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=Autenticazione del digest (Automatic Translation)
  force-basic-auth=Autenticazione di base di forza (Automatic Translation)
  force-digest-auth=Forza l'autenticazione del Digest (Automatic Translation)
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_iw.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_iw.properties
  index 9c5a9808cdd541..3389704230e0f7 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_iw.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_iw.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=  
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name= 
  force-basic-auth=  
  force-digest-auth=  
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_ja.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_ja.properties
  index fd705368b39486..b8aee1c30e9960 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_ja.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_ja.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=Basic
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=
  force-basic-auth=
  force-digest-auth=
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_kk.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_kk.properties
  new file mode 100644
  index 00000000000000..2bca0a8d994217
  --- /dev/null
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_kk.properties
  @@ -0,0 +1,9 @@
  +basic-auth-header-auth-verifier-configuration-name=Basic Auth Header (Automatic Copy)
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  +digest-authentication-auth-verifier-configuration-name=Digest Authentication (Automatic Copy)
  +force-basic-auth=Force Basic Authentication (Automatic Copy)
  +force-digest-auth=Force Digest Authentication (Automatic Copy)
  +portal-session-auth-verifier-configuration-name=Portal Sessions (Automatic Copy)
  +request-parameter-auth-verifier-configuration-name=Request Parameter (Automatic Copy)
  +service-access-policy-name=Service Access Policy Name (Automatic Copy)
  +tunnel-auth-verifier-configuration-name=Tunnel Authentication (Automatic Copy)
  \ No newline at end of file
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_ko.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_ko.properties
  index a7d1cd0df00802..a40b5b71e97f54 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_ko.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_ko.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=   (Automatic Translation)
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=  (Automatic Translation)
  force-basic-auth=   (Automatic Translation)
  force-digest-auth=   (Automatic Translation)
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_lo.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_lo.properties
  index c5a47b11d76688..2bca0a8d994217 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_lo.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_lo.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=Basic Auth Header (Automatic Copy)
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=Digest Authentication (Automatic Copy)
  force-basic-auth=Force Basic Authentication (Automatic Copy)
  force-digest-auth=Force Digest Authentication (Automatic Copy)
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_lt.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_lt.properties
  index c6ba233f2872c0..5b84866734bb55 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_lt.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_lt.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=Pagrindinio Auth antrats (Automatic Translation)
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=Sutrumpintas autentifikavimas (Automatic Translation)
  force-basic-auth=Jgos bazin autentifikavim (Automatic Translation)
  force-digest-auth=Galioja sutrumpintas autentifikavimas (Automatic Translation)
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_nb.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_nb.properties
  index fc96f35c5fe25c..caa3c505c8afb3 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_nb.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_nb.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=Grunnleggende Auth-topptekst (Automatic Translation)
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=Sammendragsgodkjenning (Automatic Translation)
  force-basic-auth=Force enkel godkjenning (Automatic Translation)
  force-digest-auth=Force sammendragsgodkjenning (Automatic Translation)
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_nl.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_nl.properties
  index 328ea0bb8e2ee1..3a24981a030d91 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_nl.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_nl.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=Basis ver. koptekst
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=Digest-verificatie
  force-basic-auth=Basisauthenticatie forceren
  force-digest-auth=Digest-authenticatie forceren
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_nl\_BE.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_nl\_BE.properties
  index c5a47b11d76688..2bca0a8d994217 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_nl\_BE.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_nl\_BE.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=Basic Auth Header (Automatic Copy)
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=Digest Authentication (Automatic Copy)
  force-basic-auth=Force Basic Authentication (Automatic Copy)
  force-digest-auth=Force Digest Authentication (Automatic Copy)
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_pl.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_pl.properties
  index 80735f1b002946..079d336e5d211e 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_pl.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_pl.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=Podstawowym Auth nagwka (Automatic Translation)
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=Uwierzytelnianie szyfrowane (Automatic Translation)
  force-basic-auth=Uwierzytelnianie podstawowe siy (Automatic Translation)
  force-digest-auth=Uwierzytelnianie szyfrowane ycie (Automatic Translation)
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_pt\_BR.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_pt\_BR.properties
  index 20781c2aa53f97..4b29c6c6200fed 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_pt\_BR.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_pt\_BR.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=Cabealho de Autenticao Bsica
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=Autenticao Digest
  force-basic-auth=Forar autenticao bsica
  force-digest-auth=Forar autenticao de resumo
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_pt\_PT.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_pt\_PT.properties
  index c5a47b11d76688..2bca0a8d994217 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_pt\_PT.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_pt\_PT.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=Basic Auth Header (Automatic Copy)
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=Digest Authentication (Automatic Copy)
  force-basic-auth=Force Basic Authentication (Automatic Copy)
  force-digest-auth=Force Digest Authentication (Automatic Copy)
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_ro.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_ro.properties
  index beb6803fccb263..8dfd1cf5e4735a 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_ro.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_ro.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=Baz Auth antet (Automatic Translation)
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=Autentificare Digest (Automatic Translation)
  force-basic-auth=Autentificare de baz vigoare (Automatic Translation)
  force-digest-auth=Vigoare Digest autentificare (Automatic Translation)
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_ru.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_ru.properties
  index abbd6ef1a89a42..c2c2cfc592a6f4 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_ru.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_ru.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=  Auth (Automatic Translation)
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=-  (Automatic Translation)
  force-basic-auth=    (Automatic Translation)
  force-digest-auth= -  (Automatic Translation)
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_sk.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_sk.properties
  index 0c3035de83690b..00a24758d24037 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_sk.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_sk.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=Zkladn Auth hlaviky (Automatic Translation)
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=Shrnn overovanie (Automatic Translation)
  force-basic-auth=Zkladn overovanie platnosti (Automatic Translation)
  force-digest-auth=innos funkcie Digest Authentication (Automatic Translation)
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_sl.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_sl.properties
  index 3ca427163349eb..c1fb52c1d02a50 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_sl.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_sl.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=Osnovno preverjanje pristnosti glavo (Automatic Translation)
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=Strogo preverjanje pristnosti (Automatic Translation)
  force-basic-auth=Osnovno preverjanje pristnosti veljavne (Automatic Translation)
  force-digest-auth=Sila strogo preverjanje pristnosti (Automatic Translation)
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_sr\_RS.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_sr\_RS.properties
  index c5a47b11d76688..2bca0a8d994217 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_sr\_RS.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_sr\_RS.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=Basic Auth Header (Automatic Copy)
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=Digest Authentication (Automatic Copy)
  force-basic-auth=Force Basic Authentication (Automatic Copy)
  force-digest-auth=Force Digest Authentication (Automatic Copy)
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_sr\_RS\_latin.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_sr\_RS\_latin.properties
  index c5a47b11d76688..2bca0a8d994217 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_sr\_RS\_latin.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_sr\_RS\_latin.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=Basic Auth Header (Automatic Copy)
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=Digest Authentication (Automatic Copy)
  force-basic-auth=Force Basic Authentication (Automatic Copy)
  force-digest-auth=Force Digest Authentication (Automatic Copy)
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_sv.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_sv.properties
  index 186dfbe82309a9..52150aef37364c 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_sv.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_sv.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=Vanlig autentiseringsrubrik
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=Sammanfattad autentisering
  force-basic-auth=Tvinga vanlig autentisering
  force-digest-auth=Tvinga sammanfattad autentisering
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_th.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_th.properties
  index 9be56ad37430ac..77c6fe6eb265cd 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_th.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_th.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name= (Automatic Translation)
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name= (Automatic Translation)
  force-basic-auth= (Automatic Translation)
  force-digest-auth= (Automatic Translation)
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_tr.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_tr.properties
  index d1031605a9c272..3fc5b4899f174c 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_tr.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_tr.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=Temel kimlik dorulama stbilgisi (Automatic Translation)
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=zet kimlik dorulamas (Automatic Translation)
  force-basic-auth=G temel kimlik dorulamas (Automatic Translation)
  force-digest-auth=Kuvvet zet kimlik dorulamas (Automatic Translation)
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_uk.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_uk.properties
  index 2142fcb04ee361..9e393f6a454b11 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_uk.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_uk.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name= Auth  (Automatic Translation)
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=  (Automatic Translation)
  force-basic-auth=   (Automatic Translation)
  force-digest-auth=   (Automatic Translation)
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_vi.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_vi.properties
  index 75b9e8b4749b94..693d7176ce2d6a 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_vi.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_vi.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=C bn Auth tiu  (Automatic Translation)
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=Tiu ha xc thc (Automatic Translation)
  force-basic-auth=Lc lng xc thc c bn (Automatic Translation)
  force-digest-auth=Lc lng tiu ha xc thc (Automatic Translation)
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_zh\_CN.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_zh\_CN.properties
  index 19dadc2ea590eb..339ad69082fe6a 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_zh\_CN.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_zh\_CN.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name=
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name=
  force-basic-auth=
  force-digest-auth=
  diff --git a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_zh\_TW.properties b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_zh\_TW.properties
  index 554a3fd3d16afa..915071361cdea1 100644
  --- a/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_zh\_TW.properties
  +++ b/modules/apps/portal-security/portal-security-auth-verifier/src/main/resources/content/Language\_zh\_TW.properties
  @@ -1,4 +1,5 @@
  basic-auth-header-auth-verifier-configuration-name= (Automatic Translation)
  +check-csrf-token=Check CSRF Token (Automatic Copy)
  digest-authentication-auth-verifier-configuration-name= (Automatic Translation)
  force-basic-auth= (Automatic Translation)
  force-digest-auth= (Automatic Translation)
  diff --git a/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/java/com/liferay/portal/settings/authentication/ldap/web/internal/portlet/action/PortalSettingsTestLDAPConnectionMVCRenderCommand.java b/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/java/com/liferay/portal/settings/authentication/ldap/web/internal/portlet/action/PortalSettingsTestLDAPConnectionMVCRenderCommand.java
  index e0e016dfd91f64..01ea880c96d9f8 100644
  --- a/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/java/com/liferay/portal/settings/authentication/ldap/web/internal/portlet/action/PortalSettingsTestLDAPConnectionMVCRenderCommand.java
  +++ b/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/java/com/liferay/portal/settings/authentication/ldap/web/internal/portlet/action/PortalSettingsTestLDAPConnectionMVCRenderCommand.java
  @@ -14,9 +14,19 @@
  package com.liferay.portal.settings.authentication.ldap.web.internal.portlet.action;
  +import com.liferay.portal.kernel.log.Log;
  +import com.liferay.portal.kernel.log.LogFactoryUtil;
  import com.liferay.portal.kernel.portlet.bridges.mvc.MVCRenderCommand;
  +import com.liferay.portal.kernel.portlet.bridges.mvc.MVCRenderConstants;
  +import com.liferay.portal.kernel.security.auth.AuthTokenUtil;
  +import com.liferay.portal.kernel.security.auth.PrincipalException;
  +import com.liferay.portal.kernel.util.Portal;
  import com.liferay.portal.settings.constants.PortalSettingsPortletKeys;
  +import javax.portlet.PortletException;
  +import javax.portlet.RenderRequest;
  +import javax.portlet.RenderResponse;
  +
  import javax.servlet.ServletContext;
  import org.osgi.service.component.annotations.Component;
  @@ -35,6 +45,32 @@
  public class PortalSettingsTestLDAPConnectionMVCRenderCommand
  extends BasePortalSettingsMVCRenderCommand {
  + @Override
  + public String render(
  + RenderRequest renderRequest, RenderResponse renderResponse)
  + throws PortletException {
  +
  + try {
  + AuthTokenUtil.checkCSRFToken(
  + \_portal.getOriginalServletRequest(
  + \_portal.getHttpServletRequest(renderRequest)),
  + getClass().getName());
  +
  + return super.render(renderRequest, renderResponse);
  + }
  + catch (PrincipalException pe) {
  + if (\_log.isDebugEnabled()) {
  + \_log.debug(
  + "Unable to test LDAP connection: " + pe.getMessage(), pe);
  + }
  + else if (\_log.isWarnEnabled()) {
  + \_log.warn("Unable to test LDAP connection: " + pe.getMessage());
  + }
  + }
  +
  + return MVCRenderConstants.MVC\_PATH\_VALUE\_SKIP\_DISPATCH;
  + }
  +
  @Override
  protected String getJspPath() {
  return \_JSP\_PATH;
  @@ -51,4 +87,10 @@ protected void setServletContext(ServletContext servletContext) {
  private static final String \_JSP\_PATH =
  "/com.liferay.portal.settings.web/test\_ldap\_connection.jsp";
  + private static final Log \_log = LogFactoryUtil.getLog(
  + PortalSettingsTestLDAPConnectionMVCRenderCommand.class);
  +
  + @Reference
  + private Portal \_portal;
  +
  }
  \ No newline at end of file
  diff --git a/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/java/com/liferay/portal/settings/authentication/ldap/web/internal/portlet/action/PortalSettingsTestLDAPGroupsMVCRenderCommand.java b/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/java/com/liferay/portal/settings/authentication/ldap/web/internal/portlet/action/PortalSettingsTestLDAPGroupsMVCRenderCommand.java
  index 71b45a4c18e2ff..d9f41a22ed9f87 100644
  --- a/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/java/com/liferay/portal/settings/authentication/ldap/web/internal/portlet/action/PortalSettingsTestLDAPGroupsMVCRenderCommand.java
  +++ b/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/java/com/liferay/portal/settings/authentication/ldap/web/internal/portlet/action/PortalSettingsTestLDAPGroupsMVCRenderCommand.java
  @@ -14,9 +14,19 @@
  package com.liferay.portal.settings.authentication.ldap.web.internal.portlet.action;
  +import com.liferay.portal.kernel.log.Log;
  +import com.liferay.portal.kernel.log.LogFactoryUtil;
  import com.liferay.portal.kernel.portlet.bridges.mvc.MVCRenderCommand;
  +import com.liferay.portal.kernel.portlet.bridges.mvc.MVCRenderConstants;
  +import com.liferay.portal.kernel.security.auth.AuthTokenUtil;
  +import com.liferay.portal.kernel.security.auth.PrincipalException;
  +import com.liferay.portal.kernel.util.Portal;
  import com.liferay.portal.settings.constants.PortalSettingsPortletKeys;
  +import javax.portlet.PortletException;
  +import javax.portlet.RenderRequest;
  +import javax.portlet.RenderResponse;
  +
  import javax.servlet.ServletContext;
  import org.osgi.service.component.annotations.Component;
  @@ -35,6 +45,32 @@
  public class PortalSettingsTestLDAPGroupsMVCRenderCommand
  extends BasePortalSettingsMVCRenderCommand {
  + @Override
  + public String render(
  + RenderRequest renderRequest, RenderResponse renderResponse)
  + throws PortletException {
  +
  + try {
  + AuthTokenUtil.checkCSRFToken(
  + \_portal.getOriginalServletRequest(
  + \_portal.getHttpServletRequest(renderRequest)),
  + getClass().getName());
  +
  + return super.render(renderRequest, renderResponse);
  + }
  + catch (PrincipalException pe) {
  + if (\_log.isDebugEnabled()) {
  + \_log.debug(
  + "Unable to test LDAP connection: " + pe.getMessage(), pe);
  + }
  + else if (\_log.isWarnEnabled()) {
  + \_log.warn("Unable to test LDAP connection: " + pe.getMessage());
  + }
  + }
  +
  + return MVCRenderConstants.MVC\_PATH\_VALUE\_SKIP\_DISPATCH;
  + }
  +
  @Override
  protected String getJspPath() {
  return \_JSP\_PATH;
  @@ -51,4 +87,10 @@ protected void setServletContext(ServletContext servletContext) {
  private static final String \_JSP\_PATH =
  "/com.liferay.portal.settings.web/test\_ldap\_groups.jsp";
  + private static final Log \_log = LogFactoryUtil.getLog(
  + PortalSettingsTestLDAPGroupsMVCRenderCommand.class);
  +
  + @Reference
  + private Portal \_portal;
  +
  }
  \ No newline at end of file
  diff --git a/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/java/com/liferay/portal/settings/authentication/ldap/web/internal/portlet/action/PortalSettingsTestLDAPUsersMVCRenderCommand.java b/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/java/com/liferay/portal/settings/authentication/ldap/web/internal/portlet/action/PortalSettingsTestLDAPUsersMVCRenderCommand.java
  index cd6ab35422d5a7..50dc9a67de6c6b 100644
  --- a/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/java/com/liferay/portal/settings/authentication/ldap/web/internal/portlet/action/PortalSettingsTestLDAPUsersMVCRenderCommand.java
  +++ b/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/java/com/liferay/portal/settings/authentication/ldap/web/internal/portlet/action/PortalSettingsTestLDAPUsersMVCRenderCommand.java
  @@ -14,9 +14,19 @@
  package com.liferay.portal.settings.authentication.ldap.web.internal.portlet.action;
  +import com.liferay.portal.kernel.log.Log;
  +import com.liferay.portal.kernel.log.LogFactoryUtil;
  import com.liferay.portal.kernel.portlet.bridges.mvc.MVCRenderCommand;
  +import com.liferay.portal.kernel.portlet.bridges.mvc.MVCRenderConstants;
  +import com.liferay.portal.kernel.security.auth.AuthTokenUtil;
  +import com.liferay.portal.kernel.security.auth.PrincipalException;
  +import com.liferay.portal.kernel.util.Portal;
  import com.liferay.portal.settings.constants.PortalSettingsPortletKeys;
  +import javax.portlet.PortletException;
  +import javax.portlet.RenderRequest;
  +import javax.portlet.RenderResponse;
  +
  import javax.servlet.ServletContext;
  import org.osgi.service.component.annotations.Component;
  @@ -35,6 +45,32 @@
  public class PortalSettingsTestLDAPUsersMVCRenderCommand
  extends BasePortalSettingsMVCRenderCommand {
  + @Override
  + public String render(
  + RenderRequest renderRequest, RenderResponse renderResponse)
  + throws PortletException {
  +
  + try {
  + AuthTokenUtil.checkCSRFToken(
  + \_portal.getOriginalServletRequest(
  + \_portal.getHttpServletRequest(renderRequest)),
  + getClass().getName());
  +
  + return super.render(renderRequest, renderResponse);
  + }
  + catch (PrincipalException pe) {
  + if (\_log.isDebugEnabled()) {
  + \_log.debug(
  + "Unable to test LDAP connection: " + pe.getMessage(), pe);
  + }
  + else if (\_log.isWarnEnabled()) {
  + \_log.warn("Unable to test LDAP connection: " + pe.getMessage());
  + }
  + }
  +
  + return MVCRenderConstants.MVC\_PATH\_VALUE\_SKIP\_DISPATCH;
  + }
  +
  @Override
  protected String getJspPath() {
  return \_JSP\_PATH;
  @@ -51,4 +87,10 @@ protected void setServletContext(ServletContext servletContext) {
  private static final String \_JSP\_PATH =
  "/com.liferay.portal.settings.web/test\_ldap\_users.jsp";
  + private static final Log \_log = LogFactoryUtil.getLog(
  + PortalSettingsTestLDAPUsersMVCRenderCommand.class);
  +
  + @Reference
  + private Portal \_portal;
  +
  }
  \ No newline at end of file
  diff --git a/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/resources/META-INF/resources/com.liferay.portal.settings.web/edit\_ldap\_server.jsp b/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/resources/META-INF/resources/com.liferay.portal.settings.web/edit\_ldap\_server.jsp
  index 296154815b4bf2..d1f2f8d38215a6 100644
  --- a/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/resources/META-INF/resources/com.liferay.portal.settings.web/edit\_ldap\_server.jsp
  +++ b/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/resources/META-INF/resources/com.liferay.portal.settings.web/edit\_ldap\_server.jsp
  @@ -473,7 +473,9 @@ renderResponse.setTitle((ldapServerId == 0) ? LanguageUtil.get(resourceBundle, "
  var url = null;
  - var data = {};
  + var data = {
  + p\_auth: '<%= AuthTokenUtil.getToken(request) %>'
  + };
  if (type == 'ldapConnection') {
  url = '';
  diff --git a/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/resources/META-INF/resources/com.liferay.portal.settings.web/init.jsp b/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/resources/META-INF/resources/com.liferay.portal.settings.web/init.jsp
  index a15a15a2ebc6a1..459a623677d1ed 100644
  --- a/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/resources/META-INF/resources/com.liferay.portal.settings.web/init.jsp
  +++ b/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/resources/META-INF/resources/com.liferay.portal.settings.web/init.jsp
  @@ -28,6 +28,7 @@ page import="com.liferay.petra.string.StringPool" %><%@
  page import="com.liferay.portal.kernel.language.LanguageUtil" %><%@
  page import="com.liferay.portal.kernel.language.UnicodeLanguageUtil" %><%@
  page import="com.liferay.portal.kernel.portlet.LiferayWindowState" %><%@
  +page import="com.liferay.portal.kernel.security.auth.AuthTokenUtil" %><%@
  page import="com.liferay.portal.kernel.security.auth.FullNameDefinition" %><%@
  page import="com.liferay.portal.kernel.security.auth.FullNameDefinitionFactory" %><%@
  page import="com.liferay.portal.kernel.util.Constants" %><%@
  diff --git a/modules/apps/portal-store/portal-store-s3/build.gradle b/modules/apps/portal-store/portal-store-s3/build.gradle
  index 41173ca5e3079d..50134f98e5871f 100644
  --- a/modules/apps/portal-store/portal-store-s3/build.gradle
  +++ b/modules/apps/portal-store/portal-store-s3/build.gradle
  @@ -2,9 +2,9 @@ dependencies {
  compileInclude group: "com.amazonaws", name: "aws-java-sdk-core", version: "1.11.277"
  compileInclude group: "com.amazonaws", name: "aws-java-sdk-kms", version: "1.11.277"
  compileInclude group: "com.amazonaws", name: "aws-java-sdk-s3", version: "1.11.277"
  - compileInclude group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.9"
  - compileInclude group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.9"
  - compileInclude group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.9.3"
  + compileInclude group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
  + compileInclude group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
  + compileInclude group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.10.1"
  compileInclude group: "com.fasterxml.jackson.dataformat", name: "jackson-dataformat-cbor", version: "2.8.1"
  compileInclude group: "commons-codec", name: "commons-codec", version: "1.6"
  compileInclude group: "commons-logging", name: "commons-logging", version: "1.2"
  diff --git a/modules/apps/portal-template/portal-template-freemarker/build.gradle b/modules/apps/portal-template/portal-template-freemarker/build.gradle
  index 52256fa898fbf9..85af3306bd6a17 100644
  --- a/modules/apps/portal-template/portal-template-freemarker/build.gradle
  +++ b/modules/apps/portal-template/portal-template-freemarker/build.gradle
  @@ -9,7 +9,7 @@ dependencies {
  compileOnly group: "com.liferay", name: "com.liferay.petra.reflect", version: "2.0.0"
  compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "2.0.0"
  compileOnly group: "com.liferay", name: "com.liferay.portal.configuration.metatype.api", version: "1.0.0"
  - compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "3.25.0"
  + compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "default"
  compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "3.33.0"
  compileOnly group: "com.liferay.portal", name: "com.liferay.util.taglib", version: "3.0.0"
  compileOnly group: "javax.servlet", name: "javax.servlet-api", version: "3.0.1"
  diff --git a/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/configuration/FreeMarkerEngineConfiguration.java b/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/configuration/FreeMarkerEngineConfiguration.java
  index 626787ee29634d..31f7d30190f3a4 100644
  --- a/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/configuration/FreeMarkerEngineConfiguration.java
  +++ b/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/configuration/FreeMarkerEngineConfiguration.java
  @@ -41,7 +41,7 @@ public interface FreeMarkerEngineConfiguration {
  public String[] allowedClasses();
  @Meta.AD(
  - deflt = "com.liferay.portal.json.jabsorb.serializer.LiferayJSONDeserializationWhitelist|java.lang.Class|java.lang.ClassLoader|java.lang.Compiler|java.lang.Package|java.lang.Process|java.lang.Runtime|java.lang.RuntimePermission|java.lang.SecurityManager|java.lang.System|java.lang.Thread|java.lang.ThreadGroup|java.lang.ThreadLocal",
  + deflt = "com.ibm.\*|com.liferay.portal.json.jabsorb.serializer.LiferayJSONDeserializationWhitelist|com.liferay.portal.spring.context.\*|io.undertow.\*|java.lang.Class|java.lang.ClassLoader|java.lang.Compiler|java.lang.Package|java.lang.Process|java.lang.Runtime|java.lang.RuntimePermission|java.lang.SecurityManager|java.lang.System|java.lang.Thread|java.lang.ThreadGroup|java.lang.ThreadLocal|org.apache.\*|org.glassfish.\*|org.jboss.\*|org.springframework.\*|org.wildfly.\*|weblogic.\*",
  name = "restricted-classes", required = false
  )
  public String[] restrictedClasses();
  diff --git a/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/FreeMarkerManager.java b/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/FreeMarkerManager.java
  index 987b3b56f762ed..da9c6f29244cba 100644
  --- a/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/FreeMarkerManager.java
  +++ b/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/FreeMarkerManager.java
  @@ -33,7 +33,6 @@
  import com.liferay.portal.kernel.util.ProxyUtil;
  import com.liferay.portal.kernel.util.StringUtil;
  import com.liferay.portal.template.BaseSingleTemplateManager;
  -import com.liferay.portal.template.RestrictedTemplate;
  import com.liferay.portal.template.TemplateContextHelper;
  import com.liferay.portal.template.freemarker.configuration.FreeMarkerEngineConfiguration;
  @@ -51,6 +50,7 @@
  import freemarker.ext.servlet.ServletContextHashModel;
  import freemarker.template.Configuration;
  +import freemarker.template.ObjectWrapper;
  import freemarker.template.TemplateHashModel;
  import freemarker.template.TemplateModel;
  import freemarker.template.TemplateModelException;
  @@ -106,6 +106,10 @@
  )
  public class FreeMarkerManager extends BaseSingleTemplateManager {
  + /\*\*
  + \* @deprecated As of Athanasius (7.3.x), with no direct replacement
  + \*/
  + @Deprecated
  public static BeansWrapper getBeansWrapper() {
  Thread currentThread = Thread.currentThread();
  @@ -125,6 +129,10 @@ public static BeansWrapper getBeansWrapper() {
  return beansWrapper;
  }
  + /\*\*
  + \* @deprecated As of Athanasius (7.3.x), with no direct replacement
  + \*/
  + @Deprecated
  @Override
  public void addStaticClassSupport(
  Map contextObjects, String variableName,
  @@ -149,68 +157,65 @@ public void addStaticClassSupport(
  }
  }
  + /\*\*
  + \* @deprecated As of Athanasius (7.3.x), with no direct replacement
  + \*/
  + @Deprecated
  @Override
  public void addTaglibApplication(
  Map contextObjects, String applicationName,
  ServletContext servletContext) {
  contextObjects.put(
  - applicationName, getServletContextHashModel(servletContext));
  + applicationName,
  + getServletContextHashModel(
  + servletContext, \_configuration.getObjectWrapper()));
  }
  + /\*\*
  + \* @deprecated As of Athanasius (7.3.x), with no direct replacement
  + \*/
  + @Deprecated
  @Override
  public void addTaglibFactory(
  Map contextObjects, String taglibFactoryName,
  ServletContext servletContext) {
  contextObjects.put(
  - taglibFactoryName, new TaglibFactoryWrapper(servletContext));
  + taglibFactoryName,
  + new TaglibFactoryWrapper(servletContext, getBeansWrapper()));
  }
  + /\*\*
  + \* @deprecated As of Athanasius (7.3.x), with no direct replacement
  + \*/
  + @Deprecated
  @Override
  public void addTaglibRequest(
  Map contextObjects, String applicationName,
  - HttpServletRequest request, HttpServletResponse response) {
  + HttpServletRequest httpServletRequest,
  + HttpServletResponse httpServletResponse) {
  contextObjects.put(
  applicationName,
  new HttpRequestHashModel(
  - request, response, \_configuration.getObjectWrapper()));
  + httpServletRequest, httpServletResponse,
  + \_configuration.getObjectWrapper()));
  }
  + /\*\*
  + \* @deprecated As of Athanasius (7.3.x), with no direct replacement
  + \*/
  + @Deprecated
  @Override
  public void addTaglibSupport(
  - Map contextObjects, HttpServletRequest request,
  - HttpServletResponse response) {
  -
  - ServletContext servletContext = request.getServletContext();
  -
  - addTaglibApplication(contextObjects, "Application", servletContext);
  -
  - addTaglibRequest(contextObjects, "Request", request, response);
  -
  - // Legacy
  -
  - TaglibFactoryWrapper taglibFactoryWrapper = new TaglibFactoryWrapper(
  - servletContext);
  + Map contextObjects,
  + HttpServletRequest httpServletRequest,
  + HttpServletResponse httpServletResponse) {
  - contextObjects.put("PortalJspTagLibs", taglibFactoryWrapper);
  - contextObjects.put("PortletJspTagLibs", taglibFactoryWrapper);
  - contextObjects.put("taglibLiferayHash", taglibFactoryWrapper);
  -
  - // Contributed
  -
  - for (Map.Entry entry : \_taglibMappings.entrySet()) {
  - try {
  - contextObjects.put(
  - entry.getKey(), taglibFactoryWrapper.get(entry.getValue()));
  - }
  - catch (TemplateModelException tme) {
  - \_log.error(
  - "Unable to add taglib " + entry.getKey() + " to context",
  - tme);
  - }
  - }
  + addTaglibSupport(
  + contextObjects, httpServletRequest, httpServletResponse,
  + getBeansWrapper());
  }
  @Override
  @@ -277,12 +282,6 @@ public void init() throws TemplateException {
  \_freeMarkerEngineConfiguration.localizedLookup());
  \_configuration.setNewBuiltinClassResolver(\_templateClassResolver);
  - \_configuration.setObjectWrapper(
  - new LiferayObjectWrapper(
  - \_freeMarkerEngineConfiguration.allowedClasses(),
  - \_freeMarkerEngineConfiguration.restrictedClasses(),
  - \_freeMarkerEngineConfiguration.restrictedMethods()));
  -
  try {
  \_configuration.setSetting(
  "auto\_import",
  @@ -296,9 +295,23 @@ public void init() throws TemplateException {
  throw new TemplateException("Unable to init FreeMarker manager", e);
  }
  + \_defaultBeanWrapper = new LiferayObjectWrapper();
  + \_restrictedBeanWrapper = new RestrictedLiferayObjectWrapper(
  + \_freeMarkerEngineConfiguration.allowedClasses(),
  + \_freeMarkerEngineConfiguration.restrictedClasses(),
  + \_freeMarkerEngineConfiguration.restrictedMethods());
  +
  if (isEnableDebuggerService()) {
  DebuggerService.getBreakpoints("\*");
  }
  +
  + FreeMarkerTemplateContextHelper freeMarkerTemplateContextHelper =
  + (FreeMarkerTemplateContextHelper)templateContextHelper;
  +
  + freeMarkerTemplateContextHelper.setDefaultBeansWrapper(
  + \_defaultBeanWrapper);
  + freeMarkerTemplateContextHelper.setRestrictedBeansWrapper(
  + \_restrictedBeanWrapper);
  }
  @Reference(unbind = "-")
  @@ -345,6 +358,46 @@ protected void activate(ComponentContext componentContext) {
  WriterFactoryUtil.setWriterFactory(new UnsyncStringWriterFactory());
  }
  + protected void addTaglibSupport(
  + Map contextObjects,
  + HttpServletRequest httpServletRequest,
  + HttpServletResponse httpServletResponse, ObjectWrapper objectWrapper) {
  +
  + ServletContext servletContext = httpServletRequest.getServletContext();
  +
  + contextObjects.put(
  + "Application",
  + getServletContextHashModel(servletContext, objectWrapper));
  +
  + contextObjects.put(
  + "Request",
  + new HttpRequestHashModel(
  + httpServletRequest, httpServletResponse, objectWrapper));
  +
  + // Legacy
  +
  + TaglibFactoryWrapper taglibFactoryWrapper = new TaglibFactoryWrapper(
  + servletContext, objectWrapper);
  +
  + contextObjects.put("PortalJspTagLibs", taglibFactoryWrapper);
  + contextObjects.put("PortletJspTagLibs", taglibFactoryWrapper);
  + contextObjects.put("taglibLiferayHash", taglibFactoryWrapper);
  +
  + // Contributed
  +
  + for (Map.Entry entry : \_taglibMappings.entrySet()) {
  + try {
  + contextObjects.put(
  + entry.getKey(), taglibFactoryWrapper.get(entry.getValue()));
  + }
  + catch (TemplateModelException templateModelException) {
  + \_log.error(
  + "Unable to add taglib " + entry.getKey() + " to context",
  + templateModelException);
  + }
  + }
  + }
  +
  @Deactivate
  protected void deactivate() {
  \_bundleTracker.close();
  @@ -356,17 +409,17 @@ protected Template doGetTemplate(
  TemplateResource errorTemplateResource, boolean restricted,
  Map helperUtilities) {
  - Template template = new FreeMarkerTemplate(
  - templateResource, errorTemplateResource, helperUtilities,
  - \_configuration, templateContextHelper,
  - \_freeMarkerEngineConfiguration.resourceModificationCheck());
  + BeansWrapper beansWrapper = \_defaultBeanWrapper;
  if (restricted) {
  - template = new RestrictedTemplate(
  - template, templateContextHelper.getRestrictedVariables());
  + beansWrapper = \_restrictedBeanWrapper;
  }
  - return template;
  + return new FreeMarkerTemplate(
  + templateResource, errorTemplateResource, helperUtilities,
  + \_configuration, templateContextHelper,
  + \_freeMarkerEngineConfiguration.resourceModificationCheck(),
  + restricted, beansWrapper, this);
  }
  protected FreeMarkerBundleClassloader getFreeMarkerBundleClassloader() {
  @@ -403,12 +456,11 @@ protected FreeMarkerBundleClassloader getFreeMarkerBundleClassloader() {
  }
  protected ServletContextHashModel getServletContextHashModel(
  - ServletContext servletContext) {
  + ServletContext servletContext, ObjectWrapper objectWrapper) {
  GenericServlet genericServlet = new JSPSupportServlet(servletContext);
  - return new ServletContextHashModel(
  - genericServlet, \_configuration.getObjectWrapper());
  + return new ServletContextHashModel(genericServlet, objectWrapper);
  }
  protected ServletContext getServletContextWrapper(
  @@ -452,9 +504,11 @@ protected void setSingleVMPool(SingleVMPool singleVMPool) {
  private volatile int \_bundleTrackingCount = -2;
  private Configuration \_configuration;
  + private BeansWrapper \_defaultBeanWrapper;
  private volatile FreeMarkerBundleClassloader \_freeMarkerBundleClassloader;
  private volatile FreeMarkerEngineConfiguration
  \_freeMarkerEngineConfiguration;
  + private BeansWrapper \_restrictedBeanWrapper;
  private SingleVMPool \_singleVMPool;
  private final Map \_taglibMappings =
  new ConcurrentHashMap<>();
  @@ -652,14 +706,16 @@ public void removedBundle(
  private class TaglibFactoryWrapper implements TemplateHashModel {
  - public TaglibFactoryWrapper(ServletContext servletContext) {
  + public TaglibFactoryWrapper(
  + ServletContext servletContext, ObjectWrapper objectWrapper) {
  +
  \_freeMarkerBundleClassloader = getFreeMarkerBundleClassloader();
  \_taglibFactory = new TaglibFactory(
  getServletContextWrapper(
  servletContext, \_freeMarkerBundleClassloader));
  - \_taglibFactory.setObjectWrapper(getBeansWrapper());
  + \_taglibFactory.setObjectWrapper(objectWrapper);
  }
  @Override
  diff --git a/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/FreeMarkerTemplate.java b/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/FreeMarkerTemplate.java
  index bff5bf167bd7b5..8b0f7b5eaca190 100644
  --- a/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/FreeMarkerTemplate.java
  +++ b/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/FreeMarkerTemplate.java
  @@ -14,6 +14,8 @@
  package com.liferay.portal.template.freemarker.internal;
  +import com.liferay.portal.kernel.log.Log;
  +import com.liferay.portal.kernel.log.LogFactoryUtil;
  import com.liferay.portal.kernel.template.StringTemplateResource;
  import com.liferay.portal.kernel.template.TemplateConstants;
  import com.liferay.portal.kernel.template.TemplateException;
  @@ -24,6 +26,7 @@
  import freemarker.core.ParseException;
  +import freemarker.ext.beans.BeansWrapper;
  import freemarker.ext.util.WrapperTemplateModel;
  import freemarker.template.AdapterTemplateModel;
  @@ -32,6 +35,7 @@
  import freemarker.template.SimpleCollection;
  import freemarker.template.Template;
  import freemarker.template.TemplateCollectionModel;
  +import freemarker.template.TemplateHashModel;
  import freemarker.template.TemplateHashModelEx;
  import freemarker.template.TemplateModel;
  import freemarker.template.TemplateModelException;
  @@ -47,6 +51,9 @@
  import java.util.HashMap;
  import java.util.Map;
  +import javax.servlet.http.HttpServletRequest;
  +import javax.servlet.http.HttpServletResponse;
  +
  /\*\*
  \* @author Mika Koivisto
  \* @author Tina Tian
  @@ -57,13 +64,27 @@ public FreeMarkerTemplate(
  TemplateResource templateResource,
  TemplateResource errorTemplateResource, Map context,
  Configuration configuration,
  - TemplateContextHelper templateContextHelper, long interval) {
  + TemplateContextHelper templateContextHelper, long interval,
  + boolean restricted, BeansWrapper beansWrapper,
  + FreeMarkerManager freeMarkerManager) {
  super(
  templateResource, errorTemplateResource, context,
  - templateContextHelper, TemplateConstants.LANG\_TYPE\_FTL, interval);
  + templateContextHelper, TemplateConstants.LANG\_TYPE\_FTL, interval,
  + restricted);
  \_configuration = configuration;
  + \_beansWrapper = beansWrapper;
  + \_freeMarkerManager = freeMarkerManager;
  + }
  +
  + @Override
  + public void prepareTaglib(
  + HttpServletRequest httpServletRequest,
  + HttpServletResponse httpServletResponse) {
  +
  + \_freeMarkerManager.addTaglibSupport(
  + context, httpServletRequest, httpServletResponse, \_beansWrapper);
  }
  @Override
  @@ -120,10 +141,10 @@ protected void processTemplate(
  getTemplateResourceUUID(templateResource),
  TemplateConstants.DEFAUT\_ENCODING);
  + template.setObjectWrapper(\_beansWrapper);
  +
  template.process(
  - new CachableDefaultMapAdapter(
  - context, template.getObjectWrapper()),
  - writer);
  + new CachableDefaultMapAdapter(context, \_beansWrapper), writer);
  }
  finally {
  TemplateResourceThreadLocal.setTemplateResource(
  @@ -131,11 +152,35 @@ protected void processTemplate(
  }
  }
  + @Override
  + protected Object putClass(String key, Class  clazz) {
  + try {
  + TemplateHashModel templateHashModel =
  + \_beansWrapper.getStaticModels();
  +
  + return context.put(key, templateHashModel.get(clazz.getName()));
  + }
  + catch (TemplateModelException templateModelException) {
  + if (\_log.isWarnEnabled()) {
  + \_log.warn(
  + "Variable " + key + " registration fail",
  + templateModelException);
  + }
  +
  + return null;
  + }
  + }
  +
  private static final TemplateModel \_NULL\_TEMPLATE\_MODEL =
  new TemplateModel() {
  };
  + private static final Log \_log = LogFactoryUtil.getLog(
  + FreeMarkerTemplate.class);
  +
  + private final BeansWrapper \_beansWrapper;
  private final Configuration \_configuration;
  + private final FreeMarkerManager \_freeMarkerManager;
  private class CachableDefaultMapAdapter
  extends WrappingTemplateModel
  diff --git a/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/FreeMarkerTemplateContextHelper.java b/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/FreeMarkerTemplateContextHelper.java
  index f6ed54842425ae..0c364a4ba34e70 100644
  --- a/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/FreeMarkerTemplateContextHelper.java
  +++ b/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/FreeMarkerTemplateContextHelper.java
  @@ -124,6 +124,14 @@ public void prepare(
  }
  }
  + public void setDefaultBeansWrapper(BeansWrapper defaultBeansWrapper) {
  + \_defaultBeansWrapper = defaultBeansWrapper;
  + }
  +
  + public void setRestrictedBeansWrapper(BeansWrapper restrictedBeansWrapper) {
  + \_restrictedBeansWrapper = restrictedBeansWrapper;
  + }
  +
  @Activate
  @Modified
  protected void activate(Map properties) {
  @@ -136,17 +144,22 @@ protected void activate(Map properties) {
  @Override
  protected void populateExtraHelperUtilities(
  - Map helperUtilities) {
  + Map helperUtilities, boolean restricted) {
  - // Enum util
  + BeansWrapper beansWrapper = \_defaultBeansWrapper;
  - BeansWrapper beansWrapper = FreeMarkerManager.getBeansWrapper();
  + if (restricted) {
  + beansWrapper = \_restrictedBeansWrapper;
  + }
  +
  + // Enum util
  helperUtilities.put("enumUtil", beansWrapper.getEnumModels());
  // Object util
  - helperUtilities.put("objectUtil", new LiferayObjectConstructor());
  + helperUtilities.put(
  + "objectUtil", new LiferayObjectConstructor(beansWrapper));
  // Portlet preferences
  @@ -176,8 +189,10 @@ protected void unregisterTemplateContextContributor(
  \_templateContextContributors.remove(templateContextContributor);
  }
  + private BeansWrapper \_defaultBeansWrapper;
  private volatile FreeMarkerEngineConfiguration
  \_freeMarkerEngineConfiguration;
  + private BeansWrapper \_restrictedBeansWrapper;
  private Set \_restrictedVariables;
  private final List
  \_templateContextContributors = new CopyOnWriteArrayList<>();
  diff --git a/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/LiferayFreeMarkerBeanModel.java b/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/LiferayFreeMarkerStringModel.java
  similarity index 81%
  rename from modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/LiferayFreeMarkerBeanModel.java
  rename to modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/LiferayFreeMarkerStringModel.java
  index c777f4c3172be2..084bd7aaf2f9c7 100644
  --- a/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/LiferayFreeMarkerBeanModel.java
  +++ b/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/LiferayFreeMarkerStringModel.java
  @@ -17,9 +17,9 @@
  import com.liferay.petra.string.StringBundler;
  import com.liferay.portal.kernel.util.StringUtil;
  -import freemarker.ext.beans.BeanModel;
  import freemarker.ext.beans.BeansWrapper;
  import freemarker.ext.beans.InvalidPropertyException;
  +import freemarker.ext.beans.StringModel;
  import freemarker.template.TemplateModel;
  import freemarker.template.TemplateModelException;
  @@ -29,14 +29,21 @@
  /\*\*
  \* @author Marta Medio
  \*/
  -public class LiferayFreeMarkerBeanModel extends BeanModel {
  +public class LiferayFreeMarkerStringModel extends StringModel {
  - public LiferayFreeMarkerBeanModel(Object object, BeansWrapper wrapper) {
  + public LiferayFreeMarkerStringModel(Object object, BeansWrapper wrapper) {
  super(object, wrapper);
  }
  @Override
  public TemplateModel get(String key) throws TemplateModelException {
  + if (\_restrictedMethodNames == null) {
  + throw new InvalidPropertyException(
  + StringBundler.concat(
  + "Denied access to method or field ", key, " of ",
  + object.getClass()));
  + }
  +
  String methodOrFieldName = StringUtil.toLowerCase(key);
  for (String restrictedMethodName : \_restrictedMethodNames) {
  diff --git a/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/LiferayObjectConstructor.java b/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/LiferayObjectConstructor.java
  index c906e37c24f65b..ad56a2af9273fb 100644
  --- a/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/LiferayObjectConstructor.java
  +++ b/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/LiferayObjectConstructor.java
  @@ -28,6 +28,10 @@
  \*/
  public class LiferayObjectConstructor implements TemplateMethodModelEx {
  + public LiferayObjectConstructor(BeansWrapper beansWrapper) {
  + \_beansWrapper = beansWrapper;
  + }
  +
  @Override
  public Object exec(@SuppressWarnings("rawtypes") List arguments)
  throws TemplateModelException {
  @@ -58,12 +62,12 @@ public Object exec(@SuppressWarnings("rawtypes") List arguments)
  }
  }
  - BeansWrapper beansWrapper = FreeMarkerManager.getBeansWrapper();
  -
  - Object object = beansWrapper.newInstance(
  + Object object = \_beansWrapper.newInstance(
  clazz, arguments.subList(1, arguments.size()));
  - return beansWrapper.wrap(object);
  + return \_beansWrapper.wrap(object);
  }
  + private final BeansWrapper \_beansWrapper;
  +
  }
  \ No newline at end of file
  diff --git a/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/LiferayObjectWrapper.java b/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/LiferayObjectWrapper.java
  index c5d53dc2bacb4e..d0cc9f4321cd6d 100644
  --- a/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/LiferayObjectWrapper.java
  +++ b/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/LiferayObjectWrapper.java
  @@ -17,16 +17,7 @@
  import com.liferay.petra.concurrent.ConcurrentReferenceKeyHashMap;
  import com.liferay.petra.memory.FinalizeManager;
  import com.liferay.petra.reflect.ReflectionUtil;
  -import com.liferay.petra.string.CharPool;
  -import com.liferay.petra.string.StringBundler;
  -import com.liferay.petra.string.StringPool;
  -import com.liferay.portal.kernel.log.Log;
  -import com.liferay.portal.kernel.log.LogFactoryUtil;
  import com.liferay.portal.kernel.templateparser.TemplateNode;
  -import com.liferay.portal.kernel.util.AggregateClassLoader;
  -import com.liferay.portal.kernel.util.StringUtil;
  -import com.liferay.portal.kernel.util.Validator;
  -import com.liferay.portal.util.PortalImpl;
  import freemarker.ext.beans.BeansWrapper;
  import freemarker.ext.beans.EnumerationModel;
  @@ -45,17 +36,11 @@
  import java.lang.reflect.Field;
  -import java.util.ArrayList;
  import java.util.Collection;
  -import java.util.Collections;
  import java.util.Enumeration;
  -import java.util.HashMap;
  import java.util.HashSet;
  -import java.util.List;
  import java.util.Map;
  import java.util.ResourceBundle;
  -import java.util.Set;
  -import java.util.concurrent.ConcurrentHashMap;
  import org.w3c.dom.Node;
  @@ -64,10 +49,7 @@
  \*/
  public class LiferayObjectWrapper extends DefaultObjectWrapper {
  - public LiferayObjectWrapper(
  - String[] allowedClassNames, String[] restrictedClassNames,
  - String[] restrictedMethodNames) {
  -
  + public LiferayObjectWrapper() {
  super(Configuration.getVersion());
  try {
  @@ -99,106 +81,6 @@ public boolean remove(Object object) {
  catch (Exception e) {
  ReflectionUtil.throwException(e);
  }
  -
  - if (allowedClassNames == null) {
  - \_allowedClassNames = Collections.emptyList();
  - }
  - else {
  - \_allowedClassNames = new ArrayList<>(allowedClassNames.length);
  -
  - for (String allowedClassName : allowedClassNames) {
  - allowedClassName = StringUtil.trim(allowedClassName);
  -
  - if (Validator.isBlank(allowedClassName)) {
  - continue;
  - }
  -
  - \_allowedClassNames.add(allowedClassName);
  - }
  - }
  -
  - if (restrictedMethodNames == null) {
  - \_restrictedMethodNames = Collections.emptyMap();
  - }
  - else {
  - \_restrictedMethodNames = new HashMap<>(
  - restrictedMethodNames.length);
  -
  - for (String restrictedMethodName : restrictedMethodNames) {
  - int index = restrictedMethodName.indexOf(CharPool.POUND);
  -
  - if (index < 0) {
  - \_log.error(
  - StringBundler.concat(
  - "\"", restrictedMethodName,
  - "\" does not match format ",
  - "\"className#methodName\""));
  -
  - continue;
  - }
  -
  - String className = StringUtil.trim(
  - restrictedMethodName.substring(0, index));
  - String methodName = StringUtil.trim(
  - restrictedMethodName.substring(index + 1));
  -
  - Set methodNames =
  - \_restrictedMethodNames.computeIfAbsent(
  - className, key -> new HashSet<>());
  -
  - methodNames.add(StringUtil.toLowerCase(methodName));
  - }
  - }
  -
  - \_allowAllClasses = \_allowedClassNames.contains(StringPool.STAR);
  -
  - if (restrictedClassNames == null) {
  - \_restrictedClasses = Collections.emptyList();
  - \_restrictedPackageNames = Collections.emptyList();
  - }
  - else {
  - \_restrictedClasses = new ArrayList<>(restrictedClassNames.length);
  - \_restrictedPackageNames = new ArrayList<>();
  -
  - AggregateClassLoader aggregateClassLoader =
  - new AggregateClassLoader(
  - LiferayObjectWrapper.class.getClassLoader());
  -
  - aggregateClassLoader.addClassLoader(
  - PortalImpl.class.getClassLoader());
  -
  - Thread thread = Thread.currentThread();
  -
  - if (thread.getContextClassLoader() != null) {
  - aggregateClassLoader.addClassLoader(
  - thread.getContextClassLoader());
  - }
  -
  - for (String restrictedClassName : restrictedClassNames) {
  - restrictedClassName = StringUtil.trim(restrictedClassName);
  -
  - if (Validator.isBlank(restrictedClassName)) {
  - continue;
  - }
  -
  - try {
  - \_restrictedClasses.add(
  - aggregateClassLoader.loadClass(restrictedClassName));
  - }
  - catch (ClassNotFoundException cnfe) {
  - if (\_log.isInfoEnabled()) {
  - \_log.info(
  - StringBundler.concat(
  - "Unable to find restricted class ",
  - restrictedClassName,
  - ". Registering as a package."),
  - cnfe);
  - }
  -
  - \_restrictedPackageNames.add(restrictedClassName);
  - }
  - }
  - }
  }
  @Override
  @@ -215,21 +97,6 @@ public TemplateModel wrap(Object object) throws TemplateModelException {
  String className = clazz.getName();
  - if (!\_allowAllClasses) {
  - \_checkClassIsRestricted(clazz);
  - }
  -
  - if (\_restrictedMethodNames.containsKey(className)) {
  - LiferayFreeMarkerBeanModel liferayFreeMarkerBeanModel =
  - (LiferayFreeMarkerBeanModel)
  - \_LIFERAY\_FREEMARKER\_BEAN\_MODEL\_FACTORY.create(object, this);
  -
  - liferayFreeMarkerBeanModel.setRestrictedMethodNames(
  - \_restrictedMethodNames.get(className));
  -
  - return liferayFreeMarkerBeanModel;
  - }
  -
  if (className.startsWith("com.liferay.")) {
  if (object instanceof TemplateNode) {
  return new LiferayTemplateModel((TemplateNode)object, this);
  @@ -277,60 +144,6 @@ else if (object instanceof ResourceBundle) {
  return modelFactory.create(object, this);
  }
  - private void \_checkClassIsRestricted(Class  clazz)
  - throws TemplateModelException {
  -
  - ClassRestrictionInformation classRestrictionInformation =
  - \_classRestrictionInformations.computeIfAbsent(
  - clazz.getName(),
  - className -> {
  - if (\_allowedClassNames.contains(className)) {
  - return \_nullInstance;
  - }
  -
  - for (Class  restrictedClass : \_restrictedClasses) {
  - if (!restrictedClass.isAssignableFrom(clazz)) {
  - continue;
  - }
  -
  - return new ClassRestrictionInformation(
  - StringBundler.concat(
  - "Denied resolving class ", className, " by ",
  - restrictedClass.getName()));
  - }
  -
  - int index = className.lastIndexOf(StringPool.PERIOD);
  -
  - if (index == -1) {
  - return \_nullInstance;
  - }
  -
  - String packageName = className.substring(0, index);
  -
  - packageName = packageName.concat(StringPool.PERIOD);
  -
  - for (String restrictedPackageName :
  - \_restrictedPackageNames) {
  -
  - if (!packageName.startsWith(restrictedPackageName)) {
  - continue;
  - }
  -
  - return new ClassRestrictionInformation(
  - StringBundler.concat(
  - "Denied resolving class ", className, " by ",
  - restrictedPackageName));
  - }
  -
  - return \_nullInstance;
  - });
  -
  - if (classRestrictionInformation.isRestricted()) {
  - throw new TemplateModelException(
  - classRestrictionInformation.getDescription());
  - }
  - }
  -
  private static final ModelFactory \_ENUMERATION\_MODEL\_FACTORY =
  new ModelFactory() {
  @@ -344,19 +157,6 @@ public TemplateModel create(
  };
  - private static final ModelFactory \_LIFERAY\_FREEMARKER\_BEAN\_MODEL\_FACTORY =
  - new ModelFactory() {
  -
  - @Override
  - public TemplateModel create(
  - Object object, ObjectWrapper objectWrapper) {
  -
  - return new LiferayFreeMarkerBeanModel(
  - object, (BeansWrapper)objectWrapper);
  - }
  -
  - };
  -
  private static final ModelFactory \_NODE\_MODEL\_FACTORY = new ModelFactory() {
  @Override
  @@ -393,16 +193,11 @@ public TemplateModel create(
  };
  - private static final Log \_log = LogFactoryUtil.getLog(
  - LiferayObjectWrapper.class);
  -
  private static final Field \_cacheClassNamesField;
  private static final Field \_classIntrospectorField;
  private static final Map, ModelFactory> \_modelFactories =
  new ConcurrentReferenceKeyHashMap<>(
  FinalizeManager.SOFT\_REFERENCE\_FACTORY);
  - private static final ClassRestrictionInformation \_nullInstance =
  - new ClassRestrictionInformation(null);
  static {
  try {
  @@ -421,34 +216,4 @@ public TemplateModel create(
  }
  }
  - private final boolean \_allowAllClasses;
  - private final List \_allowedClassNames;
  - private final Map
  - \_classRestrictionInformations = new ConcurrentHashMap<>();
  - private final List> \_restrictedClasses;
  - private final Map> \_restrictedMethodNames;
  - private final List \_restrictedPackageNames;
  -
  - private static class ClassRestrictionInformation {
  -
  - public String getDescription() {
  - return \_description;
  - }
  -
  - public boolean isRestricted() {
  - if (\_description == null) {
  - return false;
  - }
  -
  - return true;
  - }
  -
  - private ClassRestrictionInformation(String description) {
  - \_description = description;
  - }
  -
  - private final String \_description;
  -
  - }
  -
  }
  \ No newline at end of file
  diff --git a/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/RestrictedLiferayObjectWrapper.java b/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/RestrictedLiferayObjectWrapper.java
  new file mode 100644
  index 00000000000000..cac99d591f4b8d
  --- /dev/null
  +++ b/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/RestrictedLiferayObjectWrapper.java
  @@ -0,0 +1,254 @@
  +/\*\*
  + \* Copyright (c) 2000-present Liferay, Inc. All rights reserved.
  + \*
  + \* This library is free software; you can redistribute it and/or modify it under
  + \* the terms of the GNU Lesser General Public License as published by the Free
  + \* Software Foundation; either version 2.1 of the License, or (at your option)
  + \* any later version.
  + \*
  + \* This library is distributed in the hope that it will be useful, but WITHOUT
  + \* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
  + \* FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
  + \* details.
  + \*/
  +
  +package com.liferay.portal.template.freemarker.internal;
  +
  +import com.liferay.petra.string.CharPool;
  +import com.liferay.petra.string.StringBundler;
  +import com.liferay.petra.string.StringPool;
  +import com.liferay.portal.kernel.log.Log;
  +import com.liferay.portal.kernel.log.LogFactoryUtil;
  +import com.liferay.portal.kernel.util.AggregateClassLoader;
  +import com.liferay.portal.kernel.util.StringUtil;
  +import com.liferay.portal.kernel.util.Validator;
  +import com.liferay.portal.util.PortalImpl;
  +
  +import freemarker.ext.beans.BeansWrapper;
  +import freemarker.ext.util.ModelFactory;
  +
  +import freemarker.template.ObjectWrapper;
  +import freemarker.template.TemplateModel;
  +import freemarker.template.TemplateModelException;
  +
  +import java.util.ArrayList;
  +import java.util.Collections;
  +import java.util.HashMap;
  +import java.util.HashSet;
  +import java.util.List;
  +import java.util.Map;
  +import java.util.Set;
  +import java.util.concurrent.ConcurrentHashMap;
  +
  +/\*\*
  + \* @author Mika Koivisto
  + \*/
  +public class RestrictedLiferayObjectWrapper extends LiferayObjectWrapper {
  +
  + public RestrictedLiferayObjectWrapper(
  + String[] allowedClassNames, String[] restrictedClassNames,
  + String[] restrictedMethodNames) {
  +
  + if (allowedClassNames == null) {
  + \_allowedClassNames = Collections.emptyList();
  + }
  + else {
  + \_allowedClassNames = new ArrayList<>(allowedClassNames.length);
  +
  + for (String allowedClassName : allowedClassNames) {
  + allowedClassName = StringUtil.trim(allowedClassName);
  +
  + if (Validator.isBlank(allowedClassName)) {
  + continue;
  + }
  +
  + \_allowedClassNames.add(allowedClassName);
  + }
  + }
  +
  + if (restrictedMethodNames == null) {
  + \_restrictedMethodNames = Collections.emptyMap();
  + }
  + else {
  + \_restrictedMethodNames = new HashMap<>(
  + restrictedMethodNames.length);
  +
  + for (String restrictedMethodName : restrictedMethodNames) {
  + int index = restrictedMethodName.indexOf(CharPool.POUND);
  +
  + if (index < 0) {
  + \_log.error(
  + StringBundler.concat(
  + "\"", restrictedMethodName,
  + "\" does not match format ",
  + "\"className#methodName\""));
  +
  + continue;
  + }
  +
  + String className = StringUtil.trim(
  + restrictedMethodName.substring(0, index));
  + String methodName = StringUtil.trim(
  + restrictedMethodName.substring(index + 1));
  +
  + Set methodNames =
  + \_restrictedMethodNames.computeIfAbsent(
  + className, key -> new HashSet<>());
  +
  + methodNames.add(StringUtil.toLowerCase(methodName));
  + }
  + }
  +
  + \_allowAllClasses = \_allowedClassNames.contains(StringPool.STAR);
  +
  + if (restrictedClassNames == null) {
  + \_restrictedClasses = Collections.emptyList();
  + \_restrictedPackageNames = Collections.emptyList();
  + }
  + else {
  + \_restrictedClasses = new ArrayList<>(restrictedClassNames.length);
  + \_restrictedPackageNames = new ArrayList<>();
  +
  + AggregateClassLoader aggregateClassLoader =
  + new AggregateClassLoader(
  + LiferayObjectWrapper.class.getClassLoader());
  +
  + aggregateClassLoader.addClassLoader(
  + PortalImpl.class.getClassLoader());
  +
  + Thread thread = Thread.currentThread();
  +
  + if (thread.getContextClassLoader() != null) {
  + aggregateClassLoader.addClassLoader(
  + thread.getContextClassLoader());
  + }
  +
  + for (String restrictedClassName : restrictedClassNames) {
  + restrictedClassName = StringUtil.trim(restrictedClassName);
  +
  + if (Validator.isBlank(restrictedClassName)) {
  + continue;
  + }
  +
  + try {
  + \_restrictedClasses.add(
  + aggregateClassLoader.loadClass(restrictedClassName));
  + }
  + catch (ClassNotFoundException cnfe) {
  + if (\_log.isInfoEnabled()) {
  + \_log.info(
  + StringBundler.concat(
  + "Unable to find restricted class ",
  + restrictedClassName,
  + ". Registering as a package."),
  + cnfe);
  + }
  +
  + if (restrictedClassName.endsWith(StringPool.STAR)) {
  + restrictedClassName = restrictedClassName.substring(
  + 0, restrictedClassName.length() - 1);
  + }
  +
  + \_restrictedPackageNames.add(restrictedClassName);
  + }
  + }
  + }
  + }
  +
  + @Override
  + public TemplateModel wrap(Object object) throws TemplateModelException {
  + if (object == null) {
  + return null;
  + }
  +
  + if (object instanceof TemplateModel) {
  + return (TemplateModel)object;
  + }
  +
  + Class  clazz = object.getClass();
  +
  + String className = clazz.getName();
  +
  + if (!\_allowAllClasses && \_isRestricted(clazz)) {
  + return \_LIFERAY\_FREEMARKER\_STRING\_MODEL\_FACTORY.create(
  + object, this);
  + }
  +
  + if (\_restrictedMethodNames.containsKey(className)) {
  + LiferayFreeMarkerStringModel liferayFreeMarkerStringModel =
  + (LiferayFreeMarkerStringModel)
  + \_LIFERAY\_FREEMARKER\_STRING\_MODEL\_FACTORY.create(
  + object, this);
  +
  + liferayFreeMarkerStringModel.setRestrictedMethodNames(
  + \_restrictedMethodNames.get(className));
  +
  + return liferayFreeMarkerStringModel;
  + }
  +
  + return super.wrap(object);
  + }
  +
  + private boolean \_isRestricted(Class  clazz) {
  + return \_restrictedClassMap.computeIfAbsent(
  + clazz.getName(),
  + className -> {
  + if (\_allowedClassNames.contains(className)) {
  + return false;
  + }
  +
  + for (Class  restrictedClass : \_restrictedClasses) {
  + if (!restrictedClass.isAssignableFrom(clazz)) {
  + continue;
  + }
  +
  + return true;
  + }
  +
  + int index = className.lastIndexOf(StringPool.PERIOD);
  +
  + if (index == -1) {
  + return false;
  + }
  +
  + String packageName = className.substring(0, index);
  +
  + packageName = packageName.concat(StringPool.PERIOD);
  +
  + for (String restrictedPackageName : \_restrictedPackageNames) {
  + if (!packageName.startsWith(restrictedPackageName)) {
  + continue;
  + }
  +
  + return true;
  + }
  +
  + return false;
  + });
  + }
  +
  + private static final ModelFactory \_LIFERAY\_FREEMARKER\_STRING\_MODEL\_FACTORY =
  + new ModelFactory() {
  +
  + @Override
  + public TemplateModel create(
  + Object object, ObjectWrapper objectWrapper) {
  +
  + return new LiferayFreeMarkerStringModel(
  + object, (BeansWrapper)objectWrapper);
  + }
  +
  + };
  +
  + private static final Log \_log = LogFactoryUtil.getLog(
  + RestrictedLiferayObjectWrapper.class);
  +
  + private final boolean \_allowAllClasses;
  + private final List \_allowedClassNames;
  + private final List> \_restrictedClasses;
  + private final Map \_restrictedClassMap =
  + new ConcurrentHashMap<>();
  + private final Map> \_restrictedMethodNames;
  + private final List \_restrictedPackageNames;
  +
  +}
  \ No newline at end of file
  diff --git a/modules/apps/portal-template/portal-template-freemarker/src/test/java/com/liferay/portal/template/freemarker/internal/FreeMarkerTemplateTest.java b/modules/apps/portal-template/portal-template-freemarker/src/test/java/com/liferay/portal/template/freemarker/internal/FreeMarkerTemplateTest.java
  index 9917fc3fb3febe..e4727267b71c3d 100644
  --- a/modules/apps/portal-template/portal-template-freemarker/src/test/java/com/liferay/portal/template/freemarker/internal/FreeMarkerTemplateTest.java
  +++ b/modules/apps/portal-template/portal-template-freemarker/src/test/java/com/liferay/portal/template/freemarker/internal/FreeMarkerTemplateTest.java
  @@ -33,6 +33,8 @@
  import freemarker.core.ParseException;
  +import freemarker.ext.beans.BeansWrapper;
  +
  import freemarker.template.Configuration;
  import java.io.IOException;
  @@ -98,6 +100,7 @@ public void testGet() throws Exception {
  Template template = new FreeMarkerTemplate(
  new MockTemplateResource(\_TEMPLATE\_FILE\_NAME), null, null,
  \_configuration, \_templateContextHelper,
  +
  \_freeMarkerEngineConfiguration.resourceModificationCheck());
  template.put(\_TEST\_KEY, \_TEST\_VALUE);
  @@ -118,6 +121,7 @@ public void testPrepare() throws Exception {
  Template template = new FreeMarkerTemplate(
  new MockTemplateResource(\_TEMPLATE\_FILE\_NAME), null, null,
  \_configuration, \_templateContextHelper,
  +
  \_freeMarkerEngineConfiguration.resourceModificationCheck());
  template.put(\_TEST\_KEY, \_TEST\_VALUE);
  @@ -140,6 +144,7 @@ public void testProcessTemplate1() throws Exception {
  Template template = new FreeMarkerTemplate(
  new MockTemplateResource(\_TEMPLATE\_FILE\_NAME), null, null,
  \_configuration, \_templateContextHelper,
  +
  \_freeMarkerEngineConfiguration.resourceModificationCheck());
  template.put(\_TEST\_KEY, \_TEST\_VALUE);
  @@ -158,6 +163,7 @@ public void testProcessTemplate2() throws Exception {
  Template template = new FreeMarkerTemplate(
  new MockTemplateResource(\_WRONG\_TEMPLATE\_ID), null, null,
  \_configuration, \_templateContextHelper,
  +
  \_freeMarkerEngineConfiguration.resourceModificationCheck());
  template.put(\_TEST\_KEY, \_TEST\_VALUE);
  @@ -182,6 +188,7 @@ public void testProcessTemplate3() throws Exception {
  new StringTemplateResource(
  \_WRONG\_TEMPLATE\_ID, \_TEST\_TEMPLATE\_CONTENT),
  null, null, \_configuration, \_templateContextHelper,
  +
  \_freeMarkerEngineConfiguration.resourceModificationCheck());
  template.put(\_TEST\_KEY, \_TEST\_VALUE);
  @@ -201,6 +208,7 @@ public void testProcessTemplate4() throws Exception {
  new MockTemplateResource(\_TEMPLATE\_FILE\_NAME),
  new MockTemplateResource(\_WRONG\_ERROR\_TEMPLATE\_ID), null,
  \_configuration, \_templateContextHelper,
  +
  \_freeMarkerEngineConfiguration.resourceModificationCheck());
  template.put(\_TEST\_KEY, \_TEST\_VALUE);
  @@ -220,6 +228,7 @@ public void testProcessTemplate5() throws Exception {
  new MockTemplateResource(\_WRONG\_TEMPLATE\_ID),
  new MockTemplateResource(\_TEMPLATE\_FILE\_NAME), null, \_configuration,
  \_templateContextHelper,
  +
  \_freeMarkerEngineConfiguration.resourceModificationCheck());
  template.put(\_TEST\_KEY, \_TEST\_VALUE);
  @@ -239,6 +248,7 @@ public void testProcessTemplate6() throws Exception {
  new MockTemplateResource(\_WRONG\_TEMPLATE\_ID),
  new MockTemplateResource(\_WRONG\_ERROR\_TEMPLATE\_ID), null,
  \_configuration, \_templateContextHelper,
  +
  \_freeMarkerEngineConfiguration.resourceModificationCheck());
  template.put(\_TEST\_KEY, \_TEST\_VALUE);
  @@ -265,6 +275,7 @@ public void testProcessTemplate7() throws Exception {
  new StringTemplateResource(
  \_WRONG\_ERROR\_TEMPLATE\_ID, \_TEST\_TEMPLATE\_CONTENT),
  null, \_configuration, \_templateContextHelper,
  +
  \_freeMarkerEngineConfiguration.resourceModificationCheck());
  template.put(\_TEST\_KEY, \_TEST\_VALUE);
  @@ -287,6 +298,7 @@ public void testProcessTemplate8() throws Exception {
  Template template = new FreeMarkerTemplate(
  new MockTemplateResource(\_TEMPLATE\_FILE\_NAME), null, context,
  \_configuration, \_templateContextHelper,
  +
  \_freeMarkerEngineConfiguration.resourceModificationCheck());
  UnsyncStringWriter unsyncStringWriter = new UnsyncStringWriter();
  diff --git a/modules/apps/portal-template/portal-template-freemarker/src/test/java/com/liferay/portal/template/freemarker/internal/RestrictedLiferayObjectWrapperTest.java b/modules/apps/portal-template/portal-template-freemarker/src/test/java/com/liferay/portal/template/freemarker/internal/RestrictedLiferayObjectWrapperTest.java
  new file mode 100644
  index 00000000000000..1e142fe5ef53ee
  --- /dev/null
  +++ b/modules/apps/portal-template/portal-template-freemarker/src/test/java/com/liferay/portal/template/freemarker/internal/RestrictedLiferayObjectWrapperTest.java
  @@ -0,0 +1,311 @@
  +/\*\*
  + \* Copyright (c) 2000-present Liferay, Inc. All rights reserved.
  + \*
  + \* This library is free software; you can redistribute it and/or modify it under
  + \* the terms of the GNU Lesser General Public License as published by the Free
  + \* Software Foundation; either version 2.1 of the License, or (at your option)
  + \* any later version.
  + \*
  + \* This library is distributed in the hope that it will be useful, but WITHOUT
  + \* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
  + \* FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
  + \* details.
  + \*/
  +
  +package com.liferay.portal.template.freemarker.internal;
  +
  +import com.liferay.petra.string.StringBundler;
  +import com.liferay.petra.string.StringPool;
  +import com.liferay.portal.kernel.test.CaptureHandler;
  +import com.liferay.portal.kernel.test.JDKLoggerTestUtil;
  +import com.liferay.portal.kernel.test.ReflectionTestUtil;
  +import com.liferay.portal.kernel.test.rule.CodeCoverageAssertor;
  +
  +import freemarker.ext.beans.InvalidPropertyException;
  +
  +import freemarker.template.TemplateModel;
  +import freemarker.template.TemplateModelException;
  +
  +import java.util.Collections;
  +import java.util.List;
  +import java.util.logging.Level;
  +import java.util.logging.LogRecord;
  +
  +import org.hamcrest.CoreMatchers;
  +
  +import org.junit.Assert;
  +import org.junit.ClassRule;
  +import org.junit.Test;
  +
  +/\*\*
  + \* @author Tina Tian
  + \*/
  +public class RestrictedLiferayObjectWrapperTest
  + extends BaseObjectWrapperTestCase {
  +
  + @ClassRule
  + public static final CodeCoverageAssertor codeCoverageAssertor =
  + CodeCoverageAssertor.INSTANCE;
  +
  + @Test
  + public void testCheckClassIsRestricted() {
  + \_testCheckClassIsRestricted(
  + new RestrictedLiferayObjectWrapper(null, null, null),
  + TestLiferayObject.class, null);
  +
  + \_testCheckClassIsRestricted(
  + new RestrictedLiferayObjectWrapper(
  + new String[] {TestLiferayObject.class.getName()},
  + new String[] {TestLiferayObject.class.getName()}, null),
  + TestLiferayObject.class, null);
  +
  + \_testCheckClassIsRestricted(
  + new RestrictedLiferayObjectWrapper(
  + null, new String[] {"java.lang.String"}, null),
  + TestLiferayObject.class, null);
  +
  + \_testCheckClassIsRestricted(
  + new RestrictedLiferayObjectWrapper(
  + null, new String[] {"com.liferay.portal.cache"}, null),
  + TestLiferayObject.class, null);
  +
  + \_testCheckClassIsRestricted(
  + new RestrictedLiferayObjectWrapper(
  + null, new String[] {TestLiferayObject.class.getName()}, null),
  + TestLiferayObject.class,
  + StringBundler.concat(
  + "Denied resolving class ", TestLiferayObject.class.getName(),
  + " by ", TestLiferayObject.class.getName()));
  +
  + \_testCheckClassIsRestricted(
  + new RestrictedLiferayObjectWrapper(
  + null, new String[] {"com.liferay.portal.template.freemarker"},
  + null),
  + TestLiferayObject.class,
  + StringBundler.concat(
  + "Denied resolving class ", TestLiferayObject.class.getName(),
  + " by com.liferay.portal.template.freemarker"));
  +
  + \_testCheckClassIsRestricted(
  + new RestrictedLiferayObjectWrapper(
  + null, new String[] {"com.liferay.portal.template.freemarker"},
  + null),
  + byte.class, null);
  + }
  +
  + @Test
  + public void testCheckClassIsRestrictedWithNoContextClassloader() {
  + Thread thread = Thread.currentThread();
  +
  + ClassLoader contextClassLoader = thread.getContextClassLoader();
  +
  + thread.setContextClassLoader(null);
  +
  + try {
  + \_testCheckClassIsRestricted(
  + new RestrictedLiferayObjectWrapper(
  + new String[] {TestLiferayObject.class.getName()},
  + new String[] {TestLiferayObject.class.getName()}, null),
  + TestLiferayObject.class, null);
  + }
  + finally {
  + thread.setContextClassLoader(contextClassLoader);
  + }
  + }
  +
  + @Test
  + public void testConstructor() {
  + try (CaptureHandler captureHandler =
  + JDKLoggerTestUtil.configureJDKLogger(
  + RestrictedLiferayObjectWrapper.class.getName(),
  + Level.INFO)) {
  +
  + Assert.assertEquals(
  + Collections.singletonList("com.liferay.package.name"),
  + ReflectionTestUtil.getFieldValue(
  + new RestrictedLiferayObjectWrapper(
  + null, new String[] {"com.liferay.package.name"}, null),
  + "\_restrictedPackageNames"));
  +
  + List logRecords = captureHandler.getLogRecords();
  +
  + Assert.assertEquals(logRecords.toString(), 1, logRecords.size());
  +
  + LogRecord logRecord = logRecords.get(0);
  +
  + Assert.assertEquals(
  + "Unable to find restricted class com.liferay.package.name. " +
  + "Registering as a package.",
  + logRecord.getMessage());
  + }
  +
  + try (CaptureHandler captureHandler =
  + JDKLoggerTestUtil.configureJDKLogger(
  + RestrictedLiferayObjectWrapper.class.getName(),
  + Level.OFF)) {
  +
  + Assert.assertEquals(
  + Collections.singletonList("com.liferay.package.name"),
  + ReflectionTestUtil.getFieldValue(
  + new RestrictedLiferayObjectWrapper(
  + null, new String[] {"com.liferay.package.name"}, null),
  + "\_restrictedPackageNames"));
  +
  + List logRecords = captureHandler.getLogRecords();
  +
  + Assert.assertEquals(logRecords.toString(), 0, logRecords.size());
  + }
  + }
  +
  + @Test
  + public void testRestrictedMethodNames() throws Exception {
  + RestrictedLiferayObjectWrapper restrictedLiferayObjectWrapper =
  + new RestrictedLiferayObjectWrapper(
  + null, null,
  + new String[] {
  + TestLiferayMethodObject.class.getName() + "#getName"
  + });
  +
  + TemplateModel templateModel = restrictedLiferayObjectWrapper.wrap(
  + new TestLiferayMethodObject("name"));
  +
  + Assert.assertThat(
  + templateModel,
  + CoreMatchers.instanceOf(LiferayFreeMarkerStringModel.class));
  +
  + LiferayFreeMarkerStringModel liferayFreeMarkerStringModel =
  + (LiferayFreeMarkerStringModel)templateModel;
  +
  + \_testRestrictedMethodNames(liferayFreeMarkerStringModel, "name");
  + \_testRestrictedMethodNames(liferayFreeMarkerStringModel, "Name");
  + \_testRestrictedMethodNames(liferayFreeMarkerStringModel, "getName");
  + \_testRestrictedMethodNames(liferayFreeMarkerStringModel, "getname");
  + }
  +
  + @Test
  + public void testRestrictedMethodNamesIncorrectSyntax() throws Exception {
  + try (CaptureHandler captureHandler =
  + JDKLoggerTestUtil.configureJDKLogger(
  + RestrictedLiferayObjectWrapper.class.getName(),
  + Level.INFO)) {
  +
  + String methodName =
  + TestLiferayMethodObject.class.getName() + ".getName";
  +
  + new RestrictedLiferayObjectWrapper(
  + null, null, new String[] {methodName});
  +
  + List logRecords = captureHandler.getLogRecords();
  +
  + Assert.assertEquals(logRecords.toString(), 1, logRecords.size());
  +
  + LogRecord logRecord = logRecords.get(0);
  +
  + Assert.assertEquals(
  + "\"" + methodName + "\" does not match format " +
  + "\"className#methodName\"",
  + logRecord.getMessage());
  + }
  + }
  +
  + @Test
  + public void testWrap() throws Exception {
  + testWrap(new RestrictedLiferayObjectWrapper(null, null, null));
  + testWrap(
  + new RestrictedLiferayObjectWrapper(
  + new String[] {StringPool.STAR}, null, null));
  + testWrap(
  + new RestrictedLiferayObjectWrapper(
  + new String[] {StringPool.STAR},
  + new String[] {LiferayObjectWrapper.class.getName()}, null));
  + testWrap(
  + new RestrictedLiferayObjectWrapper(
  + new String[] {StringPool.BLANK}, null, null));
  + testWrap(
  + new RestrictedLiferayObjectWrapper(
  + null, new String[] {StringPool.BLANK}, null));
  + testWrap(
  + new RestrictedLiferayObjectWrapper(
  + new String[] {StringPool.BLANK},
  + new String[] {StringPool.BLANK}, null));
  +
  + testWrap(
  + new RestrictedLiferayObjectWrapper(
  + new String[] {StringPool.BLANK},
  + new String[] {StringPool.BLANK},
  + new String[] {StringPool.BLANK}));
  +
  + testWrap(
  + new RestrictedLiferayObjectWrapper(
  + new String[] {StringPool.BLANK},
  + new String[] {StringPool.BLANK},
  + new String[] {
  + TestLiferayMethodObject.class.getName() + "#getName"
  + }));
  + }
  +
  + private void \_testCheckClassIsRestricted(
  + RestrictedLiferayObjectWrapper restrictedLiferayObjectWrapper,
  + Class  targetClass, String exceptionMessage) {
  +
  + try {
  + ReflectionTestUtil.invoke(
  + restrictedLiferayObjectWrapper, "\_checkClassIsRestricted",
  + new Class [] {Class.class}, targetClass);
  +
  + Assert.assertNull(
  + "Should throw TemplateModelException", exceptionMessage);
  + }
  + catch (Exception e) {
  + Assert.assertSame(TemplateModelException.class, e.getClass());
  +
  + TemplateModelException templateModelException =
  + (TemplateModelException)e;
  +
  + Assert.assertEquals(
  + exceptionMessage, templateModelException.getMessage());
  + }
  + }
  +
  + private void \_testRestrictedMethodNames(
  + LiferayFreeMarkerStringModel liferayFreeMarkerStringModel, String key) {
  +
  + try {
  + liferayFreeMarkerStringModel.get(key);
  +
  + Assert.assertNull("Should throw TemplateModelException for " + key);
  + }
  + catch (TemplateModelException tme) {
  + Assert.assertSame(InvalidPropertyException.class, tme.getClass());
  +
  + Assert.assertEquals(
  + "Denied access to method or field " + key + " of " +
  + TestLiferayMethodObject.class.toString(),
  + tme.getMessage());
  + }
  + }
  +
  + private class TestLiferayMethodObject {
  +
  + public String getName() {
  + return \_name;
  + }
  +
  + public void setName(String name) {
  + \_name = name;
  + }
  +
  + @Override
  + public String toString() {
  + return \_name;
  + }
  +
  + private TestLiferayMethodObject(String name) {
  + \_name = name;
  + }
  +
  + private String \_name;
  +
  + }
  +
  +}
  \ No newline at end of file
  diff --git a/modules/apps/portal-template/portal-template-soy-impl/build.gradle b/modules/apps/portal-template/portal-template-soy-impl/build.gradle
  index b9e12751a5d970..0a9596dff47007 100644
  --- a/modules/apps/portal-template/portal-template-soy-impl/build.gradle
  +++ b/modules/apps/portal-template/portal-template-soy-impl/build.gradle
  @@ -37,7 +37,7 @@ dependencies {
  compileOnly group: "com.liferay", name: "com.liferay.portal.configuration.persistence.api", version: "1.0.0"
  compileOnly group: "com.liferay", name: "com.liferay.portal.template.soy.api", version: "1.0.0"
  compileOnly group: "com.liferay", name: "com.liferay.portal.upgrade.api", version: "2.0.0"
  - compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "3.25.0"
  + compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "default"
  compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "3.0.0"
  compileOnly group: "com.redhat.qe", name: "json-java", version: "20110202"
  compileOnly group: "javax.portlet", name: "portlet-api", version: "3.0.0"
  diff --git a/modules/apps/portal-template/portal-template-soy-impl/src/main/java/com/liferay/portal/template/soy/internal/SoyManager.java b/modules/apps/portal-template/portal-template-soy-impl/src/main/java/com/liferay/portal/template/soy/internal/SoyManager.java
  index 493fd2d482f6d2..550f297dbd62f1 100644
  --- a/modules/apps/portal-template/portal-template-soy-impl/src/main/java/com/liferay/portal/template/soy/internal/SoyManager.java
  +++ b/modules/apps/portal-template/portal-template-soy-impl/src/main/java/com/liferay/portal/template/soy/internal/SoyManager.java
  @@ -21,7 +21,6 @@
  import com.liferay.portal.kernel.template.TemplateManager;
  import com.liferay.portal.kernel.template.TemplateResource;
  import com.liferay.portal.template.BaseMultiTemplateManager;
  -import com.liferay.portal.template.RestrictedTemplate;
  import com.liferay.portal.template.TemplateContextHelper;
  import java.util.HashSet;
  @@ -110,17 +109,10 @@ protected Template doGetTemplate(
  TemplateResource errorTemplateResource, boolean restricted,
  Map helperUtilities) {
  - Template template = new SoyTemplate(
  + return new SoyTemplate(
  templateResources, errorTemplateResource, helperUtilities,
  (SoyTemplateContextHelper)templateContextHelper,
  - \_soyTofuCacheHandler);
  -
  - if (restricted) {
  - template = new RestrictedTemplate(
  - template, templateContextHelper.getRestrictedVariables());
  - }
  -
  - return template;
  + \_soyTofuCacheHandler, restricted);
  }
  @Reference(unbind = "-")
  diff --git a/modules/apps/portal-template/portal-template-soy-impl/src/main/java/com/liferay/portal/template/soy/internal/SoyTemplate.java b/modules/apps/portal-template/portal-template-soy-impl/src/main/java/com/liferay/portal/template/soy/internal/SoyTemplate.java
  index f80c5942a6ea02..9c244cbd6786be 100644
  --- a/modules/apps/portal-template/portal-template-soy-impl/src/main/java/com/liferay/portal/template/soy/internal/SoyTemplate.java
  +++ b/modules/apps/portal-template/portal-template-soy-impl/src/main/java/com/liferay/portal/template/soy/internal/SoyTemplate.java
  @@ -67,11 +67,12 @@ public SoyTemplate(
  List templateResources,
  TemplateResource errorTemplateResource, Map context,
  SoyTemplateContextHelper templateContextHelper,
  - SoyTofuCacheHandler soyTofuCacheHandler) {
  + SoyTofuCacheHandler soyTofuCacheHandler, boolean restricted) {
  super(
  templateResources, errorTemplateResource, context,
  - templateContextHelper, TemplateConstants.LANG\_TYPE\_SOY, 0);
  + templateContextHelper, TemplateConstants.LANG\_TYPE\_SOY, 0,
  + restricted);
  \_templateContextHelper = templateContextHelper;
  diff --git a/modules/apps/portal-template/portal-template-velocity/build.gradle b/modules/apps/portal-template/portal-template-velocity/build.gradle
  index 439d1e064e391d..7172432a7836cc 100644
  --- a/modules/apps/portal-template/portal-template-velocity/build.gradle
  +++ b/modules/apps/portal-template/portal-template-velocity/build.gradle
  @@ -9,7 +9,7 @@ dependencies {
  compileOnly group: "com.liferay", name: "com.liferay.petra.reflect", version: "2.0.0"
  compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "2.0.0"
  compileOnly group: "com.liferay", name: "com.liferay.portal.configuration.metatype.api", version: "1.0.0"
  - compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "3.25.0"
  + compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "default"
  compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "3.33.0"
  compileOnly group: "com.liferay.portal", name: "com.liferay.util.taglib", version: "3.0.0"
  compileOnly group: "commons-collections", name: "commons-collections", version: "3.2.2"
  diff --git a/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/configuration/VelocityEngineConfiguration.java b/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/configuration/VelocityEngineConfiguration.java
  index cfd79fc64270f7..cee318bd7ff5b3 100644
  --- a/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/configuration/VelocityEngineConfiguration.java
  +++ b/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/configuration/VelocityEngineConfiguration.java
  @@ -54,8 +54,8 @@ public interface VelocityEngineConfiguration {
  public String[] restrictedMethods();
  @Meta.AD(
  - deflt = "java.lang.reflect", name = "restricted-packages",
  - required = false
  + deflt = "com.liferay.portal.spring.context|com.ibm|io.undertow|java.lang.reflect|org.apache|org.glassfish|org.jboss|org.springframework|org.wildfly|weblogic",
  + name = "restricted-packages", required = false
  )
  public String[] restrictedPackages();
  diff --git a/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/LiferaySecureUberspector.java b/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/LiferaySecureUberspector.java
  index 3c099a42580e69..ee72a010dbe7e9 100644
  --- a/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/LiferaySecureUberspector.java
  +++ b/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/LiferaySecureUberspector.java
  @@ -257,9 +257,11 @@ public boolean checkObjectExecutePermission(
  "Executing method " + methodName + " is not allowed");
  }
  - \_checkClassIsRestricted(clazz);
  + if (RestrictedTemplateThreadLocal.isRestricted()) {
  + \_checkClassIsRestricted(clazz);
  - \_checkMethodIsRestricted(clazz, methodName);
  + \_checkMethodIsRestricted(clazz, methodName);
  + }
  return true;
  }
  diff --git a/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/RestrictedTemplateThreadLocal.java b/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/RestrictedTemplateThreadLocal.java
  new file mode 100644
  index 00000000000000..8e65bbc8437983
  --- /dev/null
  +++ b/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/RestrictedTemplateThreadLocal.java
  @@ -0,0 +1,37 @@
  +/\*\*
  + \* Copyright (c) 2000-present Liferay, Inc. All rights reserved.
  + \*
  + \* This library is free software; you can redistribute it and/or modify it under
  + \* the terms of the GNU Lesser General Public License as published by the Free
  + \* Software Foundation; either version 2.1 of the License, or (at your option)
  + \* any later version.
  + \*
  + \* This library is distributed in the hope that it will be useful, but WITHOUT
  + \* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
  + \* FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
  + \* details.
  + \*/
  +
  +package com.liferay.portal.template.velocity.internal;
  +
  +import com.liferay.petra.lang.CentralizedThreadLocal;
  +
  +/\*\*
  + \* @author Tina Tian
  + \*/
  +public class RestrictedTemplateThreadLocal {
  +
  + public static boolean isRestricted() {
  + return \_restricted.get();
  + }
  +
  + public static void setRestricted(boolean restricted) {
  + \_restricted.set(restricted);
  + }
  +
  + private static final ThreadLocal \_restricted =
  + new CentralizedThreadLocal<>(
  + RestrictedTemplateThreadLocal.class + ".\_restricted",
  + () -> Boolean.FALSE);
  +
  +}
  \ No newline at end of file
  diff --git a/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/VelocityManager.java b/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/VelocityManager.java
  index 8b3c4588983b62..a2a0fb617bf22d 100644
  --- a/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/VelocityManager.java
  +++ b/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/VelocityManager.java
  @@ -27,7 +27,6 @@
  import com.liferay.portal.kernel.template.TemplateResourceLoader;
  import com.liferay.portal.kernel.util.StringUtil;
  import com.liferay.portal.template.BaseSingleTemplateManager;
  -import com.liferay.portal.template.RestrictedTemplate;
  import com.liferay.portal.template.TemplateContextHelper;
  import com.liferay.portal.template.velocity.configuration.VelocityEngineConfiguration;
  import com.liferay.taglib.util.VelocityTaglib;
  @@ -62,15 +61,21 @@
  )
  public class VelocityManager extends BaseSingleTemplateManager {
  + /\*\*
  + \* @deprecated As of Athanasius (7.3.x), with no direct replacement
  + \*/
  + @Deprecated
  @Override
  - public void addTaglibTheme(
  - Map contextObjects, String themeName,
  - HttpServletRequest request, HttpServletResponse response) {
  + public void addTaglibSupport(
  + Map contextObjects,
  + HttpServletRequest httpServletRequest,
  + HttpServletResponse httpServletResponse) {
  VelocityTaglib velocityTaglib = new VelocityTaglibImpl(
  - request.getServletContext(), request, response, contextObjects);
  + httpServletRequest.getServletContext(), httpServletRequest,
  + httpServletResponse, contextObjects);
  - contextObjects.put(themeName, velocityTaglib);
  + contextObjects.put("taglibLiferay", velocityTaglib);
  contextObjects.put("velocityTaglib\_layoutIcon", \_layoutIconMethod);
  @@ -268,17 +273,11 @@ protected Template doGetTemplate(
  TemplateResource errorTemplateResource, boolean restricted,
  Map helperUtilities) {
  - Template template = new VelocityTemplate(
  + return new VelocityTemplate(
  templateResource, errorTemplateResource, helperUtilities,
  \_velocityEngine, templateContextHelper,
  - \_velocityEngineConfiguration.resourceModificationCheckInterval());
  -
  - if (restricted) {
  - template = new RestrictedTemplate(
  - template, templateContextHelper.getRestrictedVariables());
  - }
  -
  - return template;
  + \_velocityEngineConfiguration.resourceModificationCheckInterval(),
  + restricted);
  }
  private static final Method \_layoutIconMethod;
  diff --git a/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/VelocityTemplate.java b/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/VelocityTemplate.java
  index 8cc54f8a556592..5f838cea622e27 100644
  --- a/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/VelocityTemplate.java
  +++ b/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/VelocityTemplate.java
  @@ -21,11 +21,16 @@
  import com.liferay.portal.template.AbstractSingleResourceTemplate;
  import com.liferay.portal.template.TemplateContextHelper;
  import com.liferay.portal.template.TemplateResourceThreadLocal;
  +import com.liferay.taglib.util.VelocityTaglib;
  +import com.liferay.taglib.util.VelocityTaglibImpl;
  import java.io.Writer;
  import java.util.Map;
  +import javax.servlet.http.HttpServletRequest;
  +import javax.servlet.http.HttpServletResponse;
  +
  import org.apache.velocity.Template;
  import org.apache.velocity.VelocityContext;
  import org.apache.velocity.app.VelocityEngine;
  @@ -41,15 +46,32 @@ public VelocityTemplate(
  TemplateResource errorTemplateResource, Map context,
  VelocityEngine velocityEngine,
  TemplateContextHelper templateContextHelper,
  - int resourceModificationCheckInterval) {
  + int resourceModificationCheckInterval, boolean restricted) {
  super(
  templateResource, errorTemplateResource, context,
  templateContextHelper, TemplateConstants.LANG\_TYPE\_VM,
  - resourceModificationCheckInterval);
  + resourceModificationCheckInterval, restricted);
  \_velocityContext = new VelocityContext(super.context);
  \_velocityEngine = velocityEngine;
  + \_restricted = restricted;
  + }
  +
  + @Override
  + public void prepareTaglib(
  + HttpServletRequest httpServletRequest,
  + HttpServletResponse httpServletResponse) {
  +
  + VelocityTaglib velocityTaglib = new VelocityTaglibImpl(
  + httpServletRequest.getServletContext(), httpServletRequest,
  + httpServletResponse, context);
  +
  + context.put("taglibLiferay", velocityTaglib);
  +
  + // Legacy support
  +
  + context.put("theme", velocityTaglib);
  }
  @Override
  @@ -91,6 +113,10 @@ protected void processTemplate(
  TemplateResourceThreadLocal.setTemplateResource(
  TemplateConstants.LANG\_TYPE\_VM, templateResource);
  + if (\_restricted) {
  + RestrictedTemplateThreadLocal.setRestricted(true);
  + }
  +
  try {
  Template template = \_velocityEngine.getTemplate(
  getTemplateResourceUUID(templateResource),
  @@ -101,9 +127,14 @@ protected void processTemplate(
  finally {
  TemplateResourceThreadLocal.setTemplateResource(
  TemplateConstants.LANG\_TYPE\_VM, null);
  +
  + if (\_restricted) {
  + RestrictedTemplateThreadLocal.setRestricted(false);
  + }
  }
  }
  + private final boolean \_restricted;
  private final VelocityContext \_velocityContext;
  private final VelocityEngine \_velocityEngine;
  diff --git a/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/VelocityTemplateContextHelper.java b/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/VelocityTemplateContextHelper.java
  index 137a9356336842..5b6a171800990b 100644
  --- a/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/VelocityTemplateContextHelper.java
  +++ b/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/VelocityTemplateContextHelper.java
  @@ -143,7 +143,7 @@ protected void activate(Map properties) {
  @Override
  protected void populateExtraHelperUtilities(
  - Map velocityContext) {
  + Map velocityContext, boolean restrict) {
  // Date tool
  diff --git a/modules/apps/portal-template/portal-template-xsl/src/main/java/com/liferay/portal/template/xsl/internal/XSLTemplate.java b/modules/apps/portal-template/portal-template-xsl/src/main/java/com/liferay/portal/template/xsl/internal/XSLTemplate.java
  index 0378d4bfeb2140..7c144bb8140229 100644
  --- a/modules/apps/portal-template/portal-template-xsl/src/main/java/com/liferay/portal/template/xsl/internal/XSLTemplate.java
  +++ b/modules/apps/portal-template/portal-template-xsl/src/main/java/com/liferay/portal/template/xsl/internal/XSLTemplate.java
  @@ -37,6 +37,7 @@
  import java.util.Set;
  import javax.servlet.http.HttpServletRequest;
  +import javax.servlet.http.HttpServletResponse;
  import javax.xml.XMLConstants;
  import javax.xml.transform.Transformer;
  @@ -198,6 +199,12 @@ public void prepare(HttpServletRequest request) {
  \_templateContextHelper.prepare(this, request);
  }
  + @Override
  + public void prepareTaglib(
  + HttpServletRequest httpServletRequest,
  + HttpServletResponse httpServletResponse) {
  + }
  +
  @Override
  public void processTemplate(Writer writer) throws TemplateException {
  Thread currentThread = Thread.currentThread();
  diff --git a/modules/apps/portal-vulcan/portal-vulcan-api/build.gradle b/modules/apps/portal-vulcan/portal-vulcan-api/build.gradle
  index 1d3759421f49c1..f43d2708ae7577 100644
  --- a/modules/apps/portal-vulcan/portal-vulcan-api/build.gradle
  +++ b/modules/apps/portal-vulcan/portal-vulcan-api/build.gradle
  @@ -2,9 +2,9 @@ dependencies {
  compileInclude group: "com.fasterxml.jackson.dataformat", name: "jackson-dataformat-xml", version: "2.9.8"
  compileInclude group: "org.yaml", name: "snakeyaml", version: "1.23"
  - compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.9"
  - compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.9"
  - compileOnly group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.9.3"
  + compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
  + compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
  + compileOnly group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.10.1"
  compileOnly group: "com.liferay", name: "com.liferay.petra.function", version: "2.0.0"
  compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "2.0.0"
  compileOnly group: "com.liferay", name: "com.liferay.portal.odata.api", version: "1.10.0"
  diff --git a/modules/apps/portal-vulcan/portal-vulcan-impl/build.gradle b/modules/apps/portal-vulcan/portal-vulcan-impl/build.gradle
  index a637da87a0b0c3..c8a82684d5cb37 100644
  --- a/modules/apps/portal-vulcan/portal-vulcan-impl/build.gradle
  +++ b/modules/apps/portal-vulcan/portal-vulcan-impl/build.gradle
  @@ -33,9 +33,9 @@ dependencies {
  compileInclude group: "org.reflections", name: "reflections", version: "0.9.11"
  compileInclude group: "org.yaml", name: "snakeyaml", version: "1.23"
  - compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.9"
  - compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.9"
  - compileOnly group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.9.3"
  + compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
  + compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
  + compileOnly group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.10.1"
  compileOnly group: "com.fasterxml.jackson.module", name: "jackson-module-jaxb-annotations", version: "2.9.6"
  compileOnly group: "com.liferay", name: "com.liferay.osgi.service.tracker.collections", version: "3.0.0"
  compileOnly group: "com.liferay", name: "com.liferay.osgi.util", version: "4.0.0"
  diff --git a/modules/apps/portlet-display-template/portlet-display-template-impl/build.gradle b/modules/apps/portlet-display-template/portlet-display-template-impl/build.gradle
  index 2030ba2da79259..a0eeca78771f1b 100644
  --- a/modules/apps/portlet-display-template/portlet-display-template-impl/build.gradle
  +++ b/modules/apps/portlet-display-template/portlet-display-template-impl/build.gradle
  @@ -6,7 +6,7 @@ dependencies {
  compileOnly group: "com.liferay", name: "com.liferay.petra.model.adapter", version: "2.0.0"
  compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "2.0.0"
  compileOnly group: "com.liferay", name: "com.liferay.portlet.display.template.api", version: "1.0.0"
  - compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "3.0.0"
  + compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "default"
  compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "3.0.0"
  compileOnly group: "com.liferay.portal", name: "com.liferay.util.taglib", version: "3.0.0"
  compileOnly group: "javax.portlet", name: "portlet-api", version: "3.0.0"
  diff --git a/modules/apps/portlet-display-template/portlet-display-template-impl/src/main/java/com/liferay/portlet/display/template/internal/PortletDisplayTemplateImpl.java b/modules/apps/portlet-display-template/portlet-display-template-impl/src/main/java/com/liferay/portlet/display/template/internal/PortletDisplayTemplateImpl.java
  index 21121e14564efe..5d2e90eca7c3f7 100644
  --- a/modules/apps/portlet-display-template/portlet-display-template-impl/src/main/java/com/liferay/portlet/display/template/internal/PortletDisplayTemplateImpl.java
  +++ b/modules/apps/portlet-display-template/portlet-display-template-impl/src/main/java/com/liferay/portlet/display/template/internal/PortletDisplayTemplateImpl.java
  @@ -29,8 +29,6 @@
  import com.liferay.portal.kernel.template.TemplateConstants;
  import com.liferay.portal.kernel.template.TemplateHandler;
  import com.liferay.portal.kernel.template.TemplateHandlerRegistryUtil;
  -import com.liferay.portal.kernel.template.TemplateManager;
  -import com.liferay.portal.kernel.template.TemplateManagerUtil;
  import com.liferay.portal.kernel.template.TemplateVariableGroup;
  import com.liferay.portal.kernel.theme.ThemeDisplay;
  import com.liferay.portal.kernel.util.ArrayUtil;
  @@ -354,24 +352,26 @@ public Map getTemplateVariableGroups(
  @Override
  public String renderDDMTemplate(
  - HttpServletRequest request, HttpServletResponse response,
  - DDMTemplate ddmTemplate, List  entries)
  + HttpServletRequest httpServletRequest,
  + HttpServletResponse httpServletResponse, DDMTemplate ddmTemplate,
  + List  entries)
  throws Exception {
  Map contextObjects = new HashMap<>();
  return renderDDMTemplate(
  - request, response, ddmTemplate, entries, contextObjects);
  + httpServletRequest, httpServletResponse, ddmTemplate, entries,
  + contextObjects);
  }
  /\*\*
  \* Returns the DDM template's content.
  \*
  - \* @param request the request corresponding to a portlet render. In some
  + \* @param httpServletRequest the request corresponding to a portlet render. In some
  \* cases, such as an {@link HttpServletRequest} corresponding to a
  \* portlet action or resource request, or for a regular servlet, the
  \* `renderRequest` is not accessible to the template.
  - \* @param response the response corresponding to a portlet render. In some
  + \* @param httpServletResponse the response corresponding to a portlet render. In some
  \* cases, such as an {@link HttpServletResponse} corresponding to a
  \* portlet action or resource response, or for a regular servlet,
  \* the `renderResponse` is not accessible to the
  @@ -385,20 +385,23 @@ public String renderDDMTemplate(
  \*/
  @Override
  public String renderDDMTemplate(
  - HttpServletRequest request, HttpServletResponse response,
  - DDMTemplate ddmTemplate, List  entries,
  - Map contextObjects)
  + HttpServletRequest httpServletRequest,
  + HttpServletResponse httpServletResponse, DDMTemplate ddmTemplate,
  + List  entries, Map contextObjects)
  throws Exception {
  Transformer transformer = TransformerHolder.getTransformer();
  - ThemeDisplay themeDisplay = (ThemeDisplay)request.getAttribute(
  - WebKeys.THEME\_DISPLAY);
  + ThemeDisplay themeDisplay =
  + (ThemeDisplay)httpServletRequest.getAttribute(
  + WebKeys.THEME\_DISPLAY);
  - PortletRequest portletRequest = (PortletRequest)request.getAttribute(
  - JavaConstants.JAVAX\_PORTLET\_REQUEST);
  - PortletResponse portletResponse = (PortletResponse)request.getAttribute(
  - JavaConstants.JAVAX\_PORTLET\_RESPONSE);
  + PortletRequest portletRequest =
  + (PortletRequest)httpServletRequest.getAttribute(
  + JavaConstants.JAVAX\_PORTLET\_REQUEST);
  + PortletResponse portletResponse =
  + (PortletResponse)httpServletRequest.getAttribute(
  + JavaConstants.JAVAX\_PORTLET\_RESPONSE);
  if ((portletRequest != null) && (portletResponse != null)) {
  PortletURL currentURL = PortletURLUtil.getCurrent(
  @@ -418,7 +421,8 @@ public String renderDDMTemplate(
  }
  contextObjects.put(
  - PortletDisplayTemplateConstants.LOCALE, request.getLocale());
  + PortletDisplayTemplateConstants.LOCALE,
  + httpServletRequest.getLocale());
  if (portletRequest instanceof RenderRequest) {
  RenderRequest renderRequest = (RenderRequest)portletRequest;
  @@ -462,26 +466,14 @@ else if (portletResponse instanceof ResourceResponse) {
  contextObjects.put(
  TemplateConstants.CLASS\_NAME\_ID, ddmTemplate.getClassNameId());
  - TemplateManager templateManager =
  - TemplateManagerUtil.getTemplateManager(ddmTemplate.getLanguage());
  -
  TemplateHandler templateHandler =
  TemplateHandlerRegistryUtil.getTemplateHandler(
  ddmTemplate.getClassNameId());
  - templateManager.addContextObjects(
  - contextObjects, templateHandler.getCustomContextObjects());
  -
  - // Taglibs
  -
  - templateManager.addTaglibSupport(contextObjects, request, response);
  + contextObjects.putAll(templateHandler.getCustomContextObjects());
  UnsyncStringWriter unsyncStringWriter = new UnsyncStringWriter();
  - templateManager.addTaglibTheme(
  - contextObjects, "taglibLiferay", request,
  - new PipingServletResponse(response, unsyncStringWriter));
  -
  contextObjects.put(TemplateConstants.WRITER, unsyncStringWriter);
  if (portletRequest != null) {
  @@ -490,33 +482,37 @@ else if (portletResponse instanceof ResourceResponse) {
  return transformer.transform(
  themeDisplay, contextObjects, ddmTemplate.getScript(),
  - ddmTemplate.getLanguage(), unsyncStringWriter);
  + ddmTemplate.getLanguage(), unsyncStringWriter, httpServletRequest,
  + new PipingServletResponse(httpServletResponse, unsyncStringWriter));
  }
  @Override
  public String renderDDMTemplate(
  - HttpServletRequest request, HttpServletResponse response,
  - long ddmTemplateId, List  entries)
  + HttpServletRequest httpServletRequest,
  + HttpServletResponse httpServletResponse, long ddmTemplateId,
  + List  entries)
  throws Exception {
  Map contextObjects = new HashMap<>();
  return renderDDMTemplate(
  - request, response, ddmTemplateId, entries, contextObjects);
  + httpServletRequest, httpServletResponse, ddmTemplateId, entries,
  + contextObjects);
  }
  @Override
  public String renderDDMTemplate(
  - HttpServletRequest request, HttpServletResponse response,
  - long ddmTemplateId, List  entries,
  - Map contextObjects)
  + HttpServletRequest httpServletRequest,
  + HttpServletResponse httpServletResponse, long ddmTemplateId,
  + List  entries, Map contextObjects)
  throws Exception {
  DDMTemplate ddmTemplate = \_ddmTemplateLocalService.getTemplate(
  ddmTemplateId);
  return renderDDMTemplate(
  - request, response, ddmTemplate, entries, contextObjects);
  + httpServletRequest, httpServletResponse, ddmTemplate, entries,
  + contextObjects);
  }
  private Map \_mergePortletPreferences(
  diff --git a/modules/apps/push-notifications/push-notifications-sender/push-notifications-sender-apple/build.gradle b/modules/apps/push-notifications/push-notifications-sender/push-notifications-sender-apple/build.gradle
  index 990e2ca8a42341..40c047143dacd7 100644
  --- a/modules/apps/push-notifications/push-notifications-sender/push-notifications-sender-apple/build.gradle
  +++ b/modules/apps/push-notifications/push-notifications-sender/push-notifications-sender-apple/build.gradle
  @@ -1,7 +1,7 @@
  dependencies {
  - compileInclude group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.9"
  - compileInclude group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.9"
  - compileInclude group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.9.3"
  + compileInclude group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
  + compileInclude group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
  + compileInclude group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.10.1"
  compileInclude group: "com.notnoop.apns", name: "apns", version: "1.0.0.Beta6"
  compileOnly group: "biz.aQute.bnd", name: "biz.aQute.bndlib", version: "3.1.0"
  diff --git a/modules/apps/server/server-admin-web/build.gradle b/modules/apps/server/server-admin-web/build.gradle
  index 70385400d2c1da..84fdfabf80c4e6 100644
  --- a/modules/apps/server/server-admin-web/build.gradle
  +++ b/modules/apps/server/server-admin-web/build.gradle
  @@ -1,6 +1,6 @@
  dependencies {
  - compileInclude group: "jfree", name: "jcommon", version: "1.0.16"
  - compileInclude group: "jfree", name: "jfreechart", version: "1.0.13"
  + compileInclude group: "org.jfree", name: "jcommon", version: "1.0.24"
  + compileInclude group: "org.jfree", name: "jfreechart", version: "1.0.19"
  compileOnly group: "biz.aQute.bnd", name: "biz.aQute.bndlib", version: "3.1.0"
  compileOnly group: "com.liferay", name: "com.liferay.application.list.api", version: "3.0.0"
  diff --git a/modules/apps/site-navigation/site-navigation-menu-web/src/main/resources/META-INF/resources/configuration.jsp b/modules/apps/site-navigation/site-navigation-menu-web/src/main/resources/META-INF/resources/configuration.jsp
  index 1f3ecb14a9ae11..825f63edd2e6e8 100644
  --- a/modules/apps/site-navigation/site-navigation-menu-web/src/main/resources/META-INF/resources/configuration.jsp
  +++ b/modules/apps/site-navigation/site-navigation-menu-web/src/main/resources/META-INF/resources/configuration.jsp
  @@ -168,7 +168,7 @@ else {
  - <%= rootMenuItemName %>
  + <%= HtmlUtil.escape(rootMenuItemName) %>

diff --git a/modules/apps/staging/staging-taglib/src/main/resources/META-INF/resources/process\_summary\_link/page.jsp b/modules/apps/staging/staging-taglib/src/main/resources/META-INF/resources/process\_summary\_link/page.jsp
index 30ff8a9249700b..56b8cc83b1f2f0 100644
--- a/modules/apps/staging/staging-taglib/src/main/resources/META-INF/resources/process\_summary\_link/page.jsp
+++ b/modules/apps/staging/staging-taglib/src/main/resources/META-INF/resources/process\_summary\_link/page.jsp
@@ -24,7 +24,7 @@
<%
BackgroundTaskDisplay backgroundTaskDisplay = BackgroundTaskDisplayFactoryUtil.getBackgroundTaskDisplay(backgroundTask);
-String taglibOnClick = liferayPortletResponse.getNamespace() + "showProcessSummary(" + String.valueOf(backgroundTask.getBackgroundTaskId()) + ", '" + HtmlUtil.escapeJS(backgroundTaskDisplay.getDisplayName(request)) + "', '" + HtmlUtil.escape(processSummaryURL) + "');";
+String taglibOnClick = liferayPortletResponse.getNamespace() + "showProcessSummary(" + String.valueOf(backgroundTask.getBackgroundTaskId()) + ", '" + HtmlUtil.escapeJS(backgroundTaskDisplay.getDisplayName(request)) + "', '" + HtmlUtil.escapeJS(processSummaryURL) + "');";
%>
<%
-String redirect = ParamUtil.getString(request, "redirect");
+String backURL = ParamUtil.getString(request, "backURL");
+
+PortletURL homeURL = renderResponse.createRenderURL();
+
+homeURL.setParameter("mvcPath", "/view.jsp");
+
+if (Validator.isNull(backURL)) {
+ backURL = homeURL.toString();
+}
long userGroupId = ParamUtil.getLong(request, "userGroupId");
@@ -35,14 +43,10 @@ else {
}
portletDisplay.setShowBackIcon(true);
-portletDisplay.setURLBack(redirect);
+portletDisplay.setURLBack(backURL);
renderResponse.setTitle(userGroup.getName());
-PortletURL homeURL = renderResponse.createRenderURL();
-
-homeURL.setParameter("mvcPath", "/view.jsp");
-
PortalUtil.addPortletBreadcrumbEntry(request, LanguageUtil.get(request, "user-groups"), homeURL.toString());
PortalUtil.addPortletBreadcrumbEntry(request, userGroup.getName(), null);
diff --git a/modules/apps/wiki/wiki-web/src/main/java/com/liferay/wiki/web/internal/display/context/DefaultWikiListPagesDisplayContext.java b/modules/apps/wiki/wiki-web/src/main/java/com/liferay/wiki/web/internal/display/context/DefaultWikiListPagesDisplayContext.java
index f885ae682bdc3a..c86ab5859fc529 100644
--- a/modules/apps/wiki/wiki-web/src/main/java/com/liferay/wiki/web/internal/display/context/DefaultWikiListPagesDisplayContext.java
+++ b/modules/apps/wiki/wiki-web/src/main/java/com/liferay/wiki/web/internal/display/context/DefaultWikiListPagesDisplayContext.java
@@ -692,7 +692,7 @@ protected void addPrintPageMenuItem(
portletURL.setParameter("viewMode", Constants.PRINT);
portletURL.setWindowState(LiferayWindowState.POP\_UP);
- sb.append(portletURL.toString());
+ sb.append(HtmlUtil.escapeJS(portletURL.toString()));
sb.append("', '', 'directories=0,height=480,left=80,location=1,");
sb.append("menubar=1,resizable=1,scrollbars=yes,status=0,");
diff --git a/modules/source-formatter.properties b/modules/source-formatter.properties
index 3214fae8f044d2..7ef5e04670bb00 100644
--- a/modules/source-formatter.properties
+++ b/modules/source-formatter.properties
@@ -6,5 +6,7 @@
##
source.check.gradle.dependency.artifacts.check.enforceVersionArtifacts=\
- com.fasterxml.jackson.core:jackson-databind:2.9.9.3,\
- org.apache.commons:commons-compress:1.19
+ com.fasterxml.jackson.core:jackson-annotations:2.9.10,\
+ com.fasterxml.jackson.core:jackson-core:2.9.10,\
+ com.fasterxml.jackson.core:jackson-databind:2.9.10.1,\
+ org.apache.commons:commons-compress:1.19
\ No newline at end of file
diff --git a/portal-impl/src/com/liferay/portal/layoutconfiguration/util/RuntimePageImpl.java b/portal-impl/src/com/liferay/portal/layoutconfiguration/util/RuntimePageImpl.java
index 4e2602e19c01dd..9a71dc196e8751 100644
--- a/portal-impl/src/com/liferay/portal/layoutconfiguration/util/RuntimePageImpl.java
+++ b/portal-impl/src/com/liferay/portal/layoutconfiguration/util/RuntimePageImpl.java
@@ -102,87 +102,100 @@ public void afterExecute(Runnable runnable, Throwable throwable) {
@Override
public StringBundler getProcessedTemplate(
- HttpServletRequest request, HttpServletResponse response,
- String portletId, TemplateResource templateResource)
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse, String portletId,
+ TemplateResource templateResource)
throws Exception {
return doDispatch(
- request, response, portletId, templateResource,
- TemplateConstants.LANG\_TYPE\_VM, true);
+ httpServletRequest, httpServletResponse, portletId,
+ templateResource, TemplateConstants.LANG\_TYPE\_VM, true);
}
@Override
public void processCustomizationSettings(
- HttpServletRequest request, HttpServletResponse response,
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse,
TemplateResource templateResource)
throws Exception {
processCustomizationSettings(
- request, response, templateResource,
+ httpServletRequest, httpServletResponse, templateResource,
TemplateConstants.LANG\_TYPE\_VM);
}
@Override
public void processCustomizationSettings(
- HttpServletRequest request, HttpServletResponse response,
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse,
TemplateResource templateResource, String langType)
throws Exception {
- doDispatch(request, response, null, templateResource, langType, false);
+ doDispatch(
+ httpServletRequest, httpServletResponse, null, templateResource,
+ langType, false);
}
@Override
public void processTemplate(
- HttpServletRequest request, HttpServletResponse response,
- String portletId, TemplateResource templateResource)
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse, String portletId,
+ TemplateResource templateResource)
throws Exception {
StringBundler sb = doDispatch(
- request, response, portletId, templateResource,
- TemplateConstants.LANG\_TYPE\_VM, true);
+ httpServletRequest, httpServletResponse, portletId,
+ templateResource, TemplateConstants.LANG\_TYPE\_VM, true);
- sb.writeTo(response.getWriter());
+ sb.writeTo(httpServletResponse.getWriter());
}
@Override
public void processTemplate(
- HttpServletRequest request, HttpServletResponse response,
- String portletId, TemplateResource templateResource,
- String langType)
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse, String portletId,
+ TemplateResource templateResource, String langType)
throws Exception {
StringBundler sb = doDispatch(
- request, response, portletId, templateResource, langType, true);
+ httpServletRequest, httpServletResponse, portletId,
+ templateResource, langType, true);
- sb.writeTo(response.getWriter());
+ sb.writeTo(httpServletResponse.getWriter());
}
@Override
public void processTemplate(
- HttpServletRequest request, HttpServletResponse response,
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse,
TemplateResource templateResource)
throws Exception {
- processTemplate(request, response, null, templateResource);
+ processTemplate(
+ httpServletRequest, httpServletResponse, null, templateResource);
}
@Override
public void processTemplate(
- HttpServletRequest request, HttpServletResponse response,
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse,
TemplateResource templateResource, String langType)
throws Exception {
- processTemplate(request, response, null, templateResource, langType);
+ processTemplate(
+ httpServletRequest, httpServletResponse, null, templateResource,
+ langType);
}
@Override
public String processXML(
- HttpServletRequest request, HttpServletResponse response,
- String content)
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse, String content)
throws Exception {
- PortletResponse portletResponse = (PortletResponse)request.getAttribute(
- JavaConstants.JAVAX\_PORTLET\_RESPONSE);
+ PortletResponse portletResponse =
+ (PortletResponse)httpServletRequest.getAttribute(
+ JavaConstants.JAVAX\_PORTLET\_RESPONSE);
if ((portletResponse != null) &&
!(portletResponse instanceof RenderResponse)) {
@@ -191,9 +204,10 @@ public String processXML(
"processXML can only be invoked in the render phase");
}
- RuntimeLogic portletLogic = new PortletLogic(request, response);
+ RuntimeLogic portletLogic = new PortletLogic(
+ httpServletRequest, httpServletResponse);
- content = processXML(request, content, portletLogic);
+ content = processXML(httpServletRequest, content, portletLogic);
if (portletResponse == null) {
return content;
@@ -204,15 +218,15 @@ public String processXML(
RuntimeLogic actionURLLogic = new ActionURLLogic(renderResponse);
RuntimeLogic renderURLLogic = new RenderURLLogic(renderResponse);
- content = processXML(request, content, actionURLLogic);
- content = processXML(request, content, renderURLLogic);
+ content = processXML(httpServletRequest, content, actionURLLogic);
+ content = processXML(httpServletRequest, content, renderURLLogic);
return content;
}
@Override
public String processXML(
- HttpServletRequest request, String content,
+ HttpServletRequest httpServletRequest, String content,
RuntimeLogic runtimeLogic)
throws Exception {
@@ -226,22 +240,24 @@ public String processXML(
return content;
}
- Portlet renderPortlet = (Portlet)request.getAttribute(
+ Portlet renderPortlet = (Portlet)httpServletRequest.getAttribute(
WebKeys.RENDER\_PORTLET);
- Boolean renderPortletResource = (Boolean)request.getAttribute(
- WebKeys.RENDER\_PORTLET\_RESOURCE);
+ Boolean renderPortletResource =
+ (Boolean)httpServletRequest.getAttribute(
+ WebKeys.RENDER\_PORTLET\_RESOURCE);
- String outerPortletId = (String)request.getAttribute(
+ String outerPortletId = (String)httpServletRequest.getAttribute(
WebKeys.OUTER\_PORTLET\_ID);
if (outerPortletId == null) {
- request.setAttribute(
+ httpServletRequest.setAttribute(
WebKeys.OUTER\_PORTLET\_ID, renderPortlet.getPortletId());
}
try {
- request.setAttribute(WebKeys.RENDER\_PORTLET\_RESOURCE, Boolean.TRUE);
+ httpServletRequest.setAttribute(
+ WebKeys.RENDER\_PORTLET\_RESOURCE, Boolean.TRUE);
StringBundler sb = new StringBundler();
@@ -285,25 +301,28 @@ public String processXML(
}
finally {
if (outerPortletId == null) {
- request.removeAttribute(WebKeys.OUTER\_PORTLET\_ID);
+ httpServletRequest.removeAttribute(WebKeys.OUTER\_PORTLET\_ID);
}
- request.setAttribute(WebKeys.RENDER\_PORTLET, renderPortlet);
+ httpServletRequest.setAttribute(
+ WebKeys.RENDER\_PORTLET, renderPortlet);
if (renderPortletResource == null) {
- request.removeAttribute(WebKeys.RENDER\_PORTLET\_RESOURCE);
+ httpServletRequest.removeAttribute(
+ WebKeys.RENDER\_PORTLET\_RESOURCE);
}
else {
- request.setAttribute(
+ httpServletRequest.setAttribute(
WebKeys.RENDER\_PORTLET\_RESOURCE, renderPortletResource);
}
}
}
protected StringBundler doDispatch(
- HttpServletRequest request, HttpServletResponse response,
- String portletId, TemplateResource templateResource,
- String langType, boolean processTemplate)
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse, String portletId,
+ TemplateResource templateResource, String langType,
+ boolean processTemplate)
throws Exception {
ClassLoader pluginClassLoader = null;
@@ -338,12 +357,13 @@ protected StringBundler doDispatch(
if (processTemplate) {
return doProcessTemplate(
- request, response, portletId, templateResource, langType,
- false);
+ httpServletRequest, httpServletResponse, portletId,
+ templateResource, langType, false);
}
doProcessCustomizationSettings(
- request, response, templateResource, langType, false);
+ httpServletRequest, httpServletResponse, templateResource,
+ langType, false);
return null;
}
@@ -357,13 +377,15 @@ protected StringBundler doDispatch(
}
protected void doProcessCustomizationSettings(
- HttpServletRequest request, HttpServletResponse response,
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse,
TemplateResource templateResource, String langType,
boolean restricted)
throws Exception {
CustomizationSettingsProcessor processor =
- new CustomizationSettingsProcessor(request, response);
+ new CustomizationSettingsProcessor(
+ httpServletRequest, httpServletResponse);
Template template = TemplateManagerUtil.getTemplate(
langType, templateResource, restricted);
@@ -372,7 +394,7 @@ protected void doProcessCustomizationSettings(
// Velocity variables
- template.prepare(request);
+ template.prepare(httpServletRequest);
// liferay:include tag library
@@ -382,7 +404,7 @@ protected void doProcessCustomizationSettings(
template.put("theme", velocityTaglib);
try {
- template.processTemplate(response.getWriter());
+ template.processTemplate(httpServletResponse.getWriter());
}
catch (Exception e) {
\_log.error(e, e);
@@ -392,13 +414,14 @@ protected void doProcessCustomizationSettings(
}
protected StringBundler doProcessTemplate(
- HttpServletRequest request, HttpServletResponse response,
- String portletId, TemplateResource templateResource,
- String langType, boolean restricted)
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse, String portletId,
+ TemplateResource templateResource, String langType,
+ boolean restricted)
throws Exception {
TemplateProcessor processor = new TemplateProcessor(
- request, response, portletId);
+ httpServletRequest, httpServletResponse, portletId);
TemplateManager templateManager =
TemplateManagerUtil.getTemplateManager(langType);
@@ -410,13 +433,13 @@ protected StringBundler doProcessTemplate(
// Velocity variables
- template.prepare(request);
+ template.prepare(httpServletRequest);
UnsyncStringWriter unsyncStringWriter = new UnsyncStringWriter();
- templateManager.addTaglibTheme(
- template, "taglibLiferay", request,
- new PipingServletResponse(response, unsyncStringWriter));
+ template.prepareTaglib(
+ httpServletRequest,
+ new PipingServletResponse(httpServletResponse, unsyncStringWriter));
try {
template.processTemplate(unsyncStringWriter);
@@ -460,7 +483,7 @@ protected StringBundler doProcessTemplate(
javax.portlet.Portlet portlet =
PortletBagUtil.getPortletInstance(
- request.getServletContext(), portletModel,
+ httpServletRequest.getServletContext(), portletModel,
portletModel.getRootPortletId());
if (!PortletTypeUtil.isHeaderPortlet(portlet)) {
@@ -469,7 +492,7 @@ protected StringBundler doProcessTemplate(
Map headerRequestMap =
portletRenderer.renderHeaders(
- request, response,
+ httpServletRequest, httpServletResponse,
portletModel.getHeaderRequestAttributePrefixes());
String rendererPortletId = portletModel.getPortletId();
@@ -498,7 +521,7 @@ protected StringBundler doProcessTemplate(
}
boolean portletParallelRender = GetterUtil.getBoolean(
- request.getAttribute(WebKeys.PORTLET\_PARALLEL\_RENDER));
+ httpServletRequest.getAttribute(WebKeys.PORTLET\_PARALLEL\_RENDER));
Lock lock = null;
@@ -527,16 +550,18 @@ protected StringBundler doProcessTemplate(
lock = new ReentrantLock();
}
- request.setAttribute(
+ httpServletRequest.setAttribute(
WebKeys.PARALLEL\_RENDERING\_MERGE\_LOCK, lock);
ObjectValuePair objectValuePair =
- ThreadLocalFacadeServletRequestWrapperUtil.inject(request);
+ ThreadLocalFacadeServletRequestWrapperUtil.inject(
+ httpServletRequest);
try {
parallelyRenderPortlets(
- objectValuePair.getKey(), response, processor,
- contentsMap, portletHeaderRequestMap, portletRenderers);
+ objectValuePair.getKey(), httpServletResponse,
+ processor, contentsMap, portletHeaderRequestMap,
+ portletRenderers);
}
finally {
Closeable closeable = objectValuePair.getValue();
@@ -544,7 +569,8 @@ protected StringBundler doProcessTemplate(
closeable.close();
}
- request.removeAttribute(WebKeys.PARALLEL\_RENDERING\_MERGE\_LOCK);
+ httpServletRequest.removeAttribute(
+ WebKeys.PARALLEL\_RENDERING\_MERGE\_LOCK);
if (\_log.isDebugEnabled()) {
\_log.debug(
@@ -565,7 +591,7 @@ protected StringBundler doProcessTemplate(
contentsMap.put(
rendererPortletId,
portletRenderer.render(
- request, response,
+ httpServletRequest, httpServletResponse,
portletHeaderRequestMap.get(rendererPortletId)));
if (\_log.isDebugEnabled()) {
@@ -635,7 +661,8 @@ protected LayoutTemplate getLayoutTemplate(String velocityTemplateId) {
}
protected void parallelyRenderPortlets(
- HttpServletRequest request, HttpServletResponse response,
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse,
TemplateProcessor processor, Map contentsMap,
Map> portletHeaderRequestMap,
List portletRenderers)
@@ -661,7 +688,7 @@ protected void parallelyRenderPortlets(
Callable renderCallable =
portletRenderer.getCallable(
- request, response,
+ httpServletRequest, httpServletResponse,
portletHeaderRequestMap.get(rendererPortletId));
Future future = null;
@@ -776,7 +803,8 @@ else if ((waitTime > 0) || future.isDone()) {
portlet.getPortletId());
}
- sb = portletRenderer.renderAjax(request, response);
+ sb = portletRenderer.renderAjax(
+ httpServletRequest, httpServletResponse);
}
else {
if (\_log.isDebugEnabled()) {
@@ -794,7 +822,8 @@ else if ((waitTime > 0) || future.isDone()) {
}
}
- sb = portletRenderer.renderError(request, response);
+ sb = portletRenderer.renderError(
+ httpServletRequest, httpServletResponse);
}
contentsMap.put(portlet.getPortletId(), sb);
diff --git a/portal-impl/src/com/liferay/portal/model/impl/LayoutTypePortletImpl.java b/portal-impl/src/com/liferay/portal/model/impl/LayoutTypePortletImpl.java
index ae832fb34fd2cf..70d2d08d8b58cd 100644
--- a/portal-impl/src/com/liferay/portal/model/impl/LayoutTypePortletImpl.java
+++ b/portal-impl/src/com/liferay/portal/model/impl/LayoutTypePortletImpl.java
@@ -1846,12 +1846,7 @@ protected boolean hasNonstaticPortletId(String columnId, String portletId) {
String[] columnValues = StringUtil.split(columnValue);
for (String nonstaticPortletId : columnValues) {
- String decodedNonStaticPortletName =
- PortletIdCodec.decodePortletName(nonstaticPortletId);
-
- if (nonstaticPortletId.equals(portletId) ||
- decodedNonStaticPortletName.equals(portletId)) {
-
+ if (nonstaticPortletId.equals(portletId)) {
return true;
}
}
@@ -1864,12 +1859,7 @@ protected boolean hasStaticPortletId(String columnId, String portletId) {
PropsKeys.LAYOUT\_STATIC\_PORTLETS\_START + columnId);
for (String staticPortletId : staticPortletIdsStart) {
- String decodedStaticPortletName = PortletIdCodec.decodePortletName(
- staticPortletId);
-
- if (staticPortletId.equals(portletId) ||
- decodedStaticPortletName.equals(portletId)) {
-
+ if (staticPortletId.equals(portletId)) {
return true;
}
}
@@ -1878,12 +1868,7 @@ protected boolean hasStaticPortletId(String columnId, String portletId) {
PropsKeys.LAYOUT\_STATIC\_PORTLETS\_END + columnId);
for (String staticPortletId : staticPortletIdsEnd) {
- String decodedStaticPortletName = PortletIdCodec.decodePortletName(
- staticPortletId);
-
- if (staticPortletId.equals(portletId) ||
- decodedStaticPortletName.equals(portletId)) {
-
+ if (staticPortletId.equals(portletId)) {
return true;
}
}
diff --git a/portal-impl/src/com/liferay/portal/template/AbstractMultiResourceTemplate.java b/portal-impl/src/com/liferay/portal/template/AbstractMultiResourceTemplate.java
index 45f2b46515907e..41ab605abd4b44 100644
--- a/portal-impl/src/com/liferay/portal/template/AbstractMultiResourceTemplate.java
+++ b/portal-impl/src/com/liferay/portal/template/AbstractMultiResourceTemplate.java
@@ -31,15 +31,32 @@
\*/
public abstract class AbstractMultiResourceTemplate extends AbstractTemplate {
+ /\*\*
+ \* @deprecated As of Mueller (7.2.x), replaced by {@link
+ \* #AbstractMultiResourceTemplate(List, TemplateResource, Map,
+ \* TemplateContextHelper, String, long, boolean)}}
+ \*/
+ @Deprecated
public AbstractMultiResourceTemplate(
List templateResources,
TemplateResource errorTemplateResource, Map context,
TemplateContextHelper templateContextHelper, String templateManagerName,
long interval) {
+ this(
+ templateResources, errorTemplateResource, context,
+ templateContextHelper, templateManagerName, interval, false);
+ }
+
+ public AbstractMultiResourceTemplate(
+ List templateResources,
+ TemplateResource errorTemplateResource, Map context,
+ TemplateContextHelper templateContextHelper, String templateManagerName,
+ long interval, boolean restricted) {
+
super(
errorTemplateResource, context, templateContextHelper,
- templateManagerName);
+ templateManagerName, restricted);
if (ListUtil.isEmpty(templateResources)) {
throw new IllegalArgumentException("Template resource is null");
diff --git a/portal-impl/src/com/liferay/portal/template/AbstractSingleResourceTemplate.java b/portal-impl/src/com/liferay/portal/template/AbstractSingleResourceTemplate.java
index 5f5838e8cf3ddf..7b3324696936aa 100644
--- a/portal-impl/src/com/liferay/portal/template/AbstractSingleResourceTemplate.java
+++ b/portal-impl/src/com/liferay/portal/template/AbstractSingleResourceTemplate.java
@@ -37,15 +37,33 @@
\*/
public abstract class AbstractSingleResourceTemplate extends AbstractTemplate {
+ /\*\*
+ \* @deprecated As of Mueller (7.2.x), replaced by {@link
+ \* #AbstractSingleResourceTemplate(TemplateResource,
+ \* TemplateResource, Map, TemplateContextHelper, String, long,
+ \* boolean)}}
+ \*/
+ @Deprecated
public AbstractSingleResourceTemplate(
TemplateResource templateResource,
TemplateResource errorTemplateResource, Map context,
TemplateContextHelper templateContextHelper, String templateManagerName,
long interval) {
+ this(
+ templateResource, errorTemplateResource, context,
+ templateContextHelper, templateManagerName, interval, false);
+ }
+
+ public AbstractSingleResourceTemplate(
+ TemplateResource templateResource,
+ TemplateResource errorTemplateResource, Map context,
+ TemplateContextHelper templateContextHelper, String templateManagerName,
+ long interval, boolean restricted) {
+
super(
errorTemplateResource, context, templateContextHelper,
- templateManagerName);
+ templateManagerName, restricted);
if (templateResource == null) {
throw new IllegalArgumentException("Template resource is null");
diff --git a/portal-impl/src/com/liferay/portal/template/AbstractTemplate.java b/portal-impl/src/com/liferay/portal/template/AbstractTemplate.java
index 9045f092a65278..504f1231b196c1 100644
--- a/portal-impl/src/com/liferay/portal/template/AbstractTemplate.java
+++ b/portal-impl/src/com/liferay/portal/template/AbstractTemplate.java
@@ -28,17 +28,34 @@
import java.util.Set;
import javax.servlet.http.HttpServletRequest;
+import javax.servlet.http.HttpServletResponse;
/\*\*
\* @author Tina Tian
\*/
public abstract class AbstractTemplate implements Template {
+ /\*\*
+ \* @deprecated As of Mueller (7.2.x), replaced by {@link
+ \* #AbstractTemplate(TemplateResource, Map,
+ \* TemplateContextHelper, String, boolean)}}
+ \*/
+ @Deprecated
public AbstractTemplate(
TemplateResource errorTemplateResource, Map context,
TemplateContextHelper templateContextHelper,
String templateManagerName) {
+ this(
+ errorTemplateResource, context, templateContextHelper,
+ templateManagerName, false);
+ }
+
+ public AbstractTemplate(
+ TemplateResource errorTemplateResource, Map context,
+ TemplateContextHelper templateContextHelper, String templateManagerName,
+ boolean restricted) {
+
if (templateContextHelper == null) {
throw new IllegalArgumentException(
"Template context helper is null");
@@ -59,6 +76,7 @@ public AbstractTemplate(
}
\_templateContextHelper = templateContextHelper;
+ \_restricted = restricted;
}
@Override
@@ -121,12 +139,31 @@ public void prepare(HttpServletRequest request) {
\_templateContextHelper.prepare(this, request);
}
+ @Override
+ public void prepareTaglib(
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse) {
+ }
+
@Override
public Object put(String key, Object value) {
if ((key == null) || (value == null)) {
return null;
}
+ if (\_restricted) {
+ Set restrictedVariables =
+ \_templateContextHelper.getRestrictedVariables();
+
+ if (restrictedVariables.contains(key)) {
+ return null;
+ }
+ }
+
+ if (value instanceof Class) {
+ return putClass(key, (Class )value);
+ }
+
return context.put(key, value);
}
@@ -171,6 +208,10 @@ protected String getTemplateResourceUUID(
protected abstract void handleException(Exception exception, Writer writer)
throws TemplateException;
+ protected Object putClass(String key, Class  clazz) {
+ return context.put(key, clazz);
+ }
+
protected void write(Writer writer) throws TemplateException {
Writer oldWriter = (Writer)get(TemplateConstants.WRITER);
@@ -190,6 +231,7 @@ protected void write(Writer writer) throws TemplateException {
protected Map context;
protected TemplateResource errorTemplateResource;
+ private final boolean \_restricted;
private final TemplateContextHelper \_templateContextHelper;
}
\ No newline at end of file
diff --git a/portal-impl/src/com/liferay/portal/template/BaseTemplateManager.java b/portal-impl/src/com/liferay/portal/template/BaseTemplateManager.java
index 044f612c92c088..1d729fd0ae802d 100644
--- a/portal-impl/src/com/liferay/portal/template/BaseTemplateManager.java
+++ b/portal-impl/src/com/liferay/portal/template/BaseTemplateManager.java
@@ -33,6 +33,10 @@
\*/
public abstract class BaseTemplateManager implements TemplateManager {
+ /\*\*
+ \* @deprecated As of Athanasius (7.3.x), with no direct replacement
+ \*/
+ @Deprecated
@Override
public void addContextObjects(
Map contextObjects,
@@ -57,36 +61,60 @@ public void addContextObjects(
}
}
+ /\*\*
+ \* @deprecated As of Athanasius (7.3.x), with no direct replacement
+ \*/
+ @Deprecated
@Override
public void addStaticClassSupport(
Map contextObjects, String variableName,
Class  variableClass) {
}
+ /\*\*
+ \* @deprecated As of Athanasius (7.3.x), with no direct replacement
+ \*/
+ @Deprecated
@Override
public void addTaglibApplication(
Map contextObjects, String applicationName,
ServletContext servletContext) {
}
+ /\*\*
+ \* @deprecated As of Athanasius (7.3.x), with no direct replacement
+ \*/
+ @Deprecated
@Override
public void addTaglibFactory(
Map contextObjects, String taglibLiferayHash,
ServletContext servletContext) {
}
+ /\*\*
+ \* @deprecated As of Athanasius (7.3.x), with no direct replacement
+ \*/
+ @Deprecated
@Override
public void addTaglibRequest(
Map contextObjects, String applicationName,
HttpServletRequest request, HttpServletResponse response) {
}
+ /\*\*
+ \* @deprecated As of Athanasius (7.3.x), with no direct replacement
+ \*/
+ @Deprecated
@Override
public void addTaglibSupport(
Map contextObjects, HttpServletRequest request,
HttpServletResponse response) {
}
+ /\*\*
+ \* @deprecated As of Athanasius (7.3.x), with no direct replacement
+ \*/
+ @Deprecated
@Override
public void addTaglibTheme(
Map contextObjects, String themeName,
diff --git a/portal-impl/src/com/liferay/portal/template/PrivilegedTemplateWrapper.java b/portal-impl/src/com/liferay/portal/template/PrivilegedTemplateWrapper.java
index f38db698d85e41..224c6a0df2ed0f 100644
--- a/portal-impl/src/com/liferay/portal/template/PrivilegedTemplateWrapper.java
+++ b/portal-impl/src/com/liferay/portal/template/PrivilegedTemplateWrapper.java
@@ -29,6 +29,7 @@
import java.util.Set;
import javax.servlet.http.HttpServletRequest;
+import javax.servlet.http.HttpServletResponse;
/\*\*
\* @author Tina Tian
@@ -102,6 +103,14 @@ public void prepare(HttpServletRequest request) {
\_template.prepare(request);
}
+ @Override
+ public void prepareTaglib(
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse) {
+
+ \_template.prepareTaglib(httpServletRequest, httpServletResponse);
+ }
+
@Override
public void processTemplate(Writer writer) throws TemplateException {
try {
diff --git a/portal-impl/src/com/liferay/portal/template/RestrictedTemplate.java b/portal-impl/src/com/liferay/portal/template/RestrictedTemplate.java
index 2975a3d5017298..fbd3a66117e1ff 100644
--- a/portal-impl/src/com/liferay/portal/template/RestrictedTemplate.java
+++ b/portal-impl/src/com/liferay/portal/template/RestrictedTemplate.java
@@ -24,10 +24,13 @@
import java.util.Set;
import javax.servlet.http.HttpServletRequest;
+import javax.servlet.http.HttpServletResponse;
/\*\*
- \* @author Tina Tian
+ \* @author Tina Tian
+ \* @deprecated As of Mueller (7.2.x), with no direct replacement
\*/
+@Deprecated
public class RestrictedTemplate implements Template {
public RestrictedTemplate(
@@ -92,6 +95,14 @@ public void prepare(HttpServletRequest request) {
\_template.prepare(request);
}
+ @Override
+ public void prepareTaglib(
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse) {
+
+ \_template.prepareTaglib(httpServletRequest, httpServletResponse);
+ }
+
@Override
public void processTemplate(Writer writer) throws TemplateException {
\_template.processTemplate(writer);
diff --git a/portal-impl/src/com/liferay/portal/template/TemplateContextHelper.java b/portal-impl/src/com/liferay/portal/template/TemplateContextHelper.java
index 07160133e1bc81..fc18296237fcee 100644
--- a/portal-impl/src/com/liferay/portal/template/TemplateContextHelper.java
+++ b/portal-impl/src/com/liferay/portal/template/TemplateContextHelper.java
@@ -186,7 +186,7 @@ public Map getHelperUtilities(
Map helperUtilities = new HashMap<>();
populateCommonHelperUtilities(helperUtilities);
- populateExtraHelperUtilities(helperUtilities);
+ populateExtraHelperUtilities(helperUtilities, restricted);
if (restricted) {
Set restrictedVariables = getRestrictedVariables();
@@ -856,9 +856,18 @@ protected void populateDeprecatedCommonHelperUtilities(
}
}
+ /\*\*
+ \* @deprecated As of Athanasius (7.3.x), replaced by {@link
+ \* #populateExtraHelperUtilities(Map, boolean)}
+ \*/
+ @Deprecated
protected void populateExtraHelperUtilities(Map variables) {
}
+ protected void populateExtraHelperUtilities(
+ Map variables, boolean restricted) {
+ }
+
protected void prepareTiles(
Map contextObjects, HttpServletRequest request) {
diff --git a/portal-impl/src/com/liferay/portal/templateparser/Transformer.java b/portal-impl/src/com/liferay/portal/templateparser/Transformer.java
index 6c5f878ed29f83..0d01e7c4bc8667 100644
--- a/portal-impl/src/com/liferay/portal/templateparser/Transformer.java
+++ b/portal-impl/src/com/liferay/portal/templateparser/Transformer.java
@@ -41,6 +41,9 @@
import java.util.HashMap;
import java.util.Map;
+import javax.servlet.http.HttpServletRequest;
+import javax.servlet.http.HttpServletResponse;
+
/\*\*
\* @author Brian Wing Shun Chan
\* @author Raymond Aug
@@ -85,7 +88,9 @@ public Transformer(
public String transform(
ThemeDisplay themeDisplay, Map contextObjects,
String script, String langType,
- UnsyncStringWriter unsyncStringWriter)
+ UnsyncStringWriter unsyncStringWriter,
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse)
throws Exception {
if (Validator.isNull(langType)) {
@@ -136,6 +141,8 @@ public String transform(
template.put("siteGroupId", siteGroupId);
template.put("templatesPath", templatesPath);
+ template.prepareTaglib(httpServletRequest, httpServletResponse);
+
// Deprecated variables
template.put("groupId", scopeGroupId);
diff --git a/portal-impl/src/com/liferay/portal/util/HttpImpl.java b/portal-impl/src/com/liferay/portal/util/HttpImpl.java
index 3764c7966858a1..3837cf7069a750 100644
--- a/portal-impl/src/com/liferay/portal/util/HttpImpl.java
+++ b/portal-impl/src/com/liferay/portal/util/HttpImpl.java
@@ -16,6 +16,7 @@
import aQute.bnd.annotation.ProviderType;
+import com.liferay.petra.lang.CentralizedThreadLocal;
import com.liferay.petra.memory.FinalizeAction;
import com.liferay.petra.memory.FinalizeManager;
import com.liferay.petra.string.CharPool;
@@ -55,6 +56,7 @@
import java.util.ArrayList;
import java.util.Date;
+import java.util.HashMap;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;
@@ -517,14 +519,8 @@ public String getDomain(String url) {
return url;
}
- url = url.trim();
-
- if (\_getProtocolDelimiterIndex(url) < 0) {
- url = Http.HTTPS\_WITH\_SLASH + url;
- }
-
try {
- URI uri = new URI(url);
+ URI uri = \_getURI(url);
String host = uri.getHost();
@@ -614,20 +610,20 @@ public String getPath(String url) {
return url;
}
- if (url.startsWith(Http.HTTP)) {
- int pos = url.indexOf(
- CharPool.SLASH, Http.HTTPS\_WITH\_SLASH.length());
+ try {
+ URI uri = \_getURI(url);
- url = url.substring(pos);
- }
+ String path = uri.getPath();
- int pos = url.indexOf(CharPool.QUESTION);
+ if (path == null) {
+ return StringPool.BLANK;
+ }
- if (pos == -1) {
- return url;
+ return path;
+ }
+ catch (URISyntaxException uriSyntaxException) {
+ return StringPool.BLANK;
}
-
- return url.substring(0, pos);
}
@Override
@@ -656,15 +652,24 @@ public String getProtocol(RenderRequest renderRequest) {
@Override
public String getProtocol(String url) {
- url = url.trim();
+ if (Validator.isNull(url)) {
+ return url;
+ }
- int index = \_getProtocolDelimiterIndex(url);
+ try {
+ URI uri = \_getURI(url);
- if (index > 0) {
- return url.substring(0, index);
- }
+ String scheme = uri.getScheme();
- return StringPool.BLANK;
+ if (scheme == null) {
+ return StringPool.BLANK;
+ }
+
+ return scheme;
+ }
+ catch (URISyntaxException uriSyntaxException) {
+ return StringPool.BLANK;
+ }
}
@Override
@@ -673,13 +678,20 @@ public String getQueryString(String url) {
return url;
}
- int pos = url.indexOf(CharPool.QUESTION);
+ try {
+ URI uri = \_getURI(url);
- if (pos == -1) {
+ String queryString = uri.getQuery();
+
+ if (queryString == null) {
+ return StringPool.BLANK;
+ }
+
+ return queryString;
+ }
+ catch (URISyntaxException uriSyntaxException) {
return StringPool.BLANK;
}
-
- return url.substring(pos + 1);
}
@Override
@@ -698,11 +710,11 @@ public boolean hasDomain(String url) {
@Override
public boolean hasProtocol(String url) {
- if (\_getProtocolDelimiterIndex(url) > 0) {
- return true;
+ if (Validator.isNull(url)) {
+ return false;
}
- return false;
+ return Validator.isNotNull(getProtocol(url));
}
@Override
@@ -1106,12 +1118,20 @@ else if (pos == 0) {
@Override
public String removeProtocol(String url) {
- url = url.trim();
+ String protocol = getProtocol(url);
+
+ if (Validator.isNotNull(protocol)) {
+ url = url.trim();
- int index = \_getProtocolDelimiterIndex(url);
+ if (url.regionMatches(
+ protocol.length(), PROTOCOL\_DELIMITER, 0,
+ PROTOCOL\_DELIMITER.length())) {
- if (index > 0) {
- return url.substring(index + PROTOCOL\_DELIMITER.length());
+ return url.substring(
+ protocol.length() + PROTOCOL\_DELIMITER.length());
+ }
+
+ return url.substring(protocol.length() + StringPool.COLON.length());
}
return url;
@@ -1738,7 +1758,7 @@ protected InputStream URLtoInputStream(
URI uri = null;
try {
- uri = new URI(location);
+ uri = \_getURI(location);
}
catch (URISyntaxException urise) {
throw new IOException("Invalid URI: " + location, urise);
@@ -1759,7 +1779,7 @@ else if (!location.startsWith(Http.HTTP\_WITH\_SLASH) &&
location = Http.HTTP\_WITH\_SLASH + location;
- uri = new URI(location);
+ uri = \_getURI(location);
}
HttpHost targetHttpHost = new HttpHost(
@@ -2016,32 +2036,20 @@ public void close() throws IOException {
}
}
- private int \_getProtocolDelimiterIndex(String url) {
- if (Validator.isNull(url)) {
- return -1;
- }
-
- // Define protocol as "[a-zA-Z][a-zA-Z0-9]\*://"
-
- int pos = url.indexOf(Http.PROTOCOL\_DELIMITER);
+ private URI \_getURI(String uriString) throws URISyntaxException {
+ Map uris = \_uris.get();
- if (pos <= 0) {
- return -1;
- }
+ uriString = uriString.trim();
- if (!Validator.isChar(url.charAt(0))) {
- return -1;
- }
+ URI uri = uris.get(uriString);
- for (int i = 1; i < pos; ++i) {
- if (!Validator.isChar(url.charAt(i)) &&
- !Validator.isDigit(url.charAt(i))) {
+ if (uri == null) {
+ uri = new URI(uriString);
- return -1;
- }
+ uris.put(uriString, uri);
}
- return pos;
+ return uri;
}
private String \_shortenURL(
@@ -2172,6 +2180,8 @@ private String \_shortenURL(
private static final Log \_log = LogFactoryUtil.getLog(HttpImpl.class);
private static final ThreadLocal \_cookies = new ThreadLocal<>();
+ private static final ThreadLocal> \_uris =
+ new CentralizedThreadLocal<>(HttpImpl.class + ".\_uris", HashMap::new);
private final CloseableHttpClient \_closeableHttpClient;
private final Pattern \_nonProxyHostsPattern;
diff --git a/portal-impl/src/com/liferay/portal/util/PortalImpl.java b/portal-impl/src/com/liferay/portal/util/PortalImpl.java
index d405d2d998e302..ad6a721c5e4981 100644
--- a/portal-impl/src/com/liferay/portal/util/PortalImpl.java
+++ b/portal-impl/src/com/liferay/portal/util/PortalImpl.java
@@ -939,18 +939,28 @@ public String escapeRedirect(String url) {
return url;
}
- url = url.trim();
+ String domain = HttpUtil.getDomain(url);
+ String protocol = HttpUtil.getProtocol(url);
+
+ if (Validator.isBlank(domain)) {
+ if (Validator.isBlank(HttpUtil.getPath(url))) {
+ return null;
+ }
- if ((url.charAt(0) == CharPool.SLASH) &&
- ((url.length() == 1) ||
- ((url.length() > 1) && (url.charAt(1) != CharPool.SLASH)))) {
+ // Specs allows URL of protocol followed by path, but we do not.
+
+ if (!Validator.isBlank(protocol)) {
+ return null;
+ }
+
+ // The URL is a relative path
return url;
}
- String domain = HttpUtil.getDomain(url);
+ // Specs regards URL staring with double slashes valid, but we do not.
- if (domain.isEmpty()) {
+ if (Validator.isBlank(protocol)) {
return null;
}
@@ -8106,10 +8116,16 @@ protected long getPlidFromPortletId(
LayoutTypePortlet layoutTypePortlet =
(LayoutTypePortlet)layout.getLayoutType();
- if (layoutTypePortlet.hasPortletId(portletId, true) &&
- (getScopeGroupId(layout, portletId) == scopeGroupId)) {
+ if (getScopeGroupId(layout, portletId) != scopeGroupId) {
+ continue;
+ }
+
+ for (Portlet portlet : layoutTypePortlet.getAllPortlets()) {
+ if (portletId.equals(portlet.getPortletId()) ||
+ portletId.equals(portlet.getRootPortletId())) {
- return layout.getPlid();
+ return layout.getPlid();
+ }
}
}
diff --git a/portal-impl/src/com/liferay/portal/verify/VerifyProperties.java b/portal-impl/src/com/liferay/portal/verify/VerifyProperties.java
index 914f8168eaff4f..da8cbd1da2dbd0 100644
--- a/portal-impl/src/com/liferay/portal/verify/VerifyProperties.java
+++ b/portal-impl/src/com/liferay/portal/verify/VerifyProperties.java
@@ -1713,7 +1713,10 @@ protected void verifySystemProperties() throws Exception {
"configuration.jsp",
"editor.wysiwyg.portal-web.docroot.html.portlet.portal\_settings." +
"email\_notifications.jsp",
+ "ehcache.bootstrap.cache.loader.enabled",
"ehcache.bootstrap.cache.loader.factory",
+ "ehcache.bootstrap.cache.loader.properties",
+ "ehcache.bootstrap.cache.loader.properties.default",
"ehcache.cache.event.listener.factory",
"ehcache.cache.manager.peer.listener.factory",
"ehcache.cache.manager.peer.provider.factory",
diff --git a/portal-impl/src/com/liferay/portal/webserver/WebServerEntry.java b/portal-impl/src/com/liferay/portal/webserver/WebServerEntry.java
index d1d4bebd414acb..ae77ad1040e722 100644
--- a/portal-impl/src/com/liferay/portal/webserver/WebServerEntry.java
+++ b/portal-impl/src/com/liferay/portal/webserver/WebServerEntry.java
@@ -15,10 +15,13 @@
package com.liferay.portal.webserver;
import com.liferay.petra.string.StringPool;
+import com.liferay.portal.kernel.util.FastDateFormatFactoryUtil;
import com.liferay.portal.kernel.util.GetterUtil;
import com.liferay.portal.kernel.util.HttpUtil;
import com.liferay.portal.kernel.util.URLCodec;
+import java.text.Format;
+
import java.util.Date;
/\*\*
@@ -38,6 +41,14 @@ public WebServerEntry(
\_name = name;
\_createDate = createDate;
\_modifiedDate = modifiedDate;
+
+ if (modifiedDate != null) {
+ Format format = FastDateFormatFactoryUtil.getSimpleDateFormat(
+ "d MMM yyyy HH:mm z");
+
+ \_modifiedDateString = format.format(modifiedDate);
+ }
+
\_description = GetterUtil.getString(description);
\_size = size;
}
@@ -54,6 +65,10 @@ public Date getModifiedDate() {
return \_modifiedDate;
}
+ public String getModifiedDateString() {
+ return \_modifiedDateString;
+ }
+
public String getName() {
return \_name;
}
@@ -78,6 +93,10 @@ public void setModifiedDate(Date modifiedDate) {
\_modifiedDate = modifiedDate;
}
+ public void setModifiedDateString(String modifiedDateString) {
+ \_modifiedDateString = modifiedDateString;
+ }
+
public void setName(String name) {
\_name = name;
}
@@ -110,6 +129,7 @@ protected String getPath(String path, String name) {
private Date \_createDate;
private String \_description;
private Date \_modifiedDate;
+ private String \_modifiedDateString;
private String \_name;
private String \_path;
private long \_size;
diff --git a/portal-impl/src/com/liferay/portal/webserver/WebServerServlet.java b/portal-impl/src/com/liferay/portal/webserver/WebServerServlet.java
index a7a5c369384908..75c2f5bf4ffe1d 100644
--- a/portal-impl/src/com/liferay/portal/webserver/WebServerServlet.java
+++ b/portal-impl/src/com/liferay/portal/webserver/WebServerServlet.java
@@ -86,7 +86,6 @@
import com.liferay.portal.kernel.transaction.TransactionInvokerUtil;
import com.liferay.portal.kernel.util.ContentTypes;
import com.liferay.portal.kernel.util.DigesterUtil;
-import com.liferay.portal.kernel.util.FastDateFormatFactoryUtil;
import com.liferay.portal.kernel.util.FileUtil;
import com.liferay.portal.kernel.util.GetterUtil;
import com.liferay.portal.kernel.util.HtmlUtil;
@@ -120,8 +119,6 @@
import java.net.URL;
-import java.text.Format;
-
import java.util.ArrayList;
import java.util.Date;
import java.util.List;
@@ -1235,7 +1232,6 @@ protected void sendHTML(
Template template = TemplateManagerUtil.getTemplate(
TemplateConstants.LANG\_TYPE\_FTL, \_templateResource, true);
- template.put("dateFormat", \_dateFormat);
template.put("entries", webServerEntries);
template.put("path", HttpUtil.encodePath(path));
@@ -1661,8 +1657,6 @@ private boolean \_processCompanyInactiveRequest(
UserFileUploadsSettings.class, WebServerServlet.class,
"\_userFileUploadsSettings", false);
- private final Format \_dateFormat =
- FastDateFormatFactoryUtil.getSimpleDateFormat("d MMM yyyy HH:mm z");
private boolean \_lastModified = true;
private TemplateResource \_templateResource;
diff --git a/portal-impl/src/com/liferay/portal/webserver/dependencies/template.ftl b/portal-impl/src/com/liferay/portal/webserver/dependencies/template.ftl
index 121f541146b17c..25a4b60691c5d8 100644
--- a/portal-impl/src/com/liferay/portal/webserver/dependencies/template.ftl
+++ b/portal-impl/src/com/liferay/portal/webserver/dependencies/template.ftl
@@ -26,8 +26,8 @@
[${entry.name}](%24%7Bentry.path%7D) - <#if entry.getModifiedDate()??> - ${dateFormat.format(entry.modifiedDate)} + <#if entry.getModifiedDateString()??> + ${entry.modifiedDateString} <#else> -  diff --git a/portal-impl/src/portal.properties b/portal-impl/src/portal.properties index 40a44c2b600248..063878b3cbfae6 100644 --- a/portal-impl/src/portal.properties +++ b/portal-impl/src/portal.properties @@ -1695,29 +1695,6 @@ ehcache.single.vm.config.location=/ehcache/liferay-single-vm.xml ehcache.multi.vm.config.location=/ehcache/liferay-multi-vm-clustered.xml - # - # Set this to true to enable the Ehcache bootstrap cache loader. - # - # Env: LIFERAY\_EHCACHE\_PERIOD\_BOOTSTRAP\_PERIOD\_CACHE\_PERIOD\_LOADER\_PERIOD\_ENABLED - # - ehcache.bootstrap.cache.loader.enabled=false - - # - # Input a list of comma delimited key value pair to set bootstrap loader - # properties for the default cache. - # - # Env: LIFERAY\_EHCACHE\_PERIOD\_BOOTSTRAP\_PERIOD\_CACHE\_PERIOD\_LOADER\_PERIOD\_PROPERTIES\_PERIOD\_DEFAULT - # - ehcache.bootstrap.cache.loader.properties.default= - - # - # Input a list of comma delimited key value pair to set bootstrap loader - # properties for a specific cache. - # - # Env: LIFERAY\_EHCACHE\_PERIOD\_BOOTSTRAP\_PERIOD\_CACHE\_PERIOD\_LOADER\_PERIOD\_PROPERTIES\_PERIOD\_\_DOLLAR\_\_OPENCURLYBRACE\_SPECIFIC\_PERIOD\_CACHE\_PERIOD\_NAME\_CLOSECURLYBRACE\_ - # - #ehcache.bootstrap.cache.loader.properties.${specific.cache.name}= - # # Input a list of comma delimited key value pair to set replication # properties for the default cache. @@ -5928,7 +5905,7 @@ setup.database.driverClassName[sybase]=com.sybase.jdbc4.jdbc.SybDriver setup.database.jar.name[com.mysql.jdbc.Driver]=mysql.jar - setup.database.jar.url[com.mysql.jdbc.Driver]=http://repo1.maven.org/maven2/mysql/mysql-connector-java/5.1.23/mysql-connector-java-5.1.23.jar + setup.database.jar.url[com.mysql.jdbc.Driver]=https://repo1.maven.org/maven2/mysql/mysql-connector-java/5.1.23/mysql-connector-java-5.1.23.jar setup.database.url[db2]=jdbc:db2://localhost:50000/lportal:deferPrepares=false;fullyMaterializeInputStreams=true;fullyMaterializeLobData=true;progresssiveLocators=2;progressiveStreaming=2; setup.database.url[hypersonic]=jdbc:hsqldb:${liferay.home}/data/hypersonic/lportal diff --git a/portal-impl/test/integration/com/liferay/portal/kernel/template/bundle/templatemanagerutil/TestTemplate.java b/portal-impl/test/integration/com/liferay/portal/kernel/template/bundle/templatemanagerutil/TestTemplate.java index b9e94b26f71ce1..e7b8252167e452 100644 --- a/portal-impl/test/integration/com/liferay/portal/kernel/template/bundle/templatemanagerutil/TestTemplate.java +++ b/portal-impl/test/integration/com/liferay/portal/kernel/template/bundle/templatemanagerutil/TestTemplate.java @@ -23,6 +23,7 @@ import java.util.Set; import javax.servlet.http.HttpServletRequest; +import javax.servlet.http.HttpServletResponse; /\*\* \* @author Philip Jones @@ -81,6 +82,12 @@ public Set keySet() { public void prepare(HttpServletRequest request) { } + @Override + public void prepareTaglib( + HttpServletRequest httpServletRequest, + HttpServletResponse httpServletResponse) { + } + @Override public void processTemplate(Writer writer) { } diff --git a/portal-impl/test/unit/com/liferay/portal/dao/orm/hibernate/region/dependencies/test-multi-ehcache-config.xml b/portal-impl/test/unit/com/liferay/portal/dao/orm/hibernate/region/dependencies/test-multi-ehcache-config.xml index 8736b2d6e2a9e5..29c30947438bac 100644 --- a/portal-impl/test/unit/com/liferay/portal/dao/orm/hibernate/region/dependencies/test-multi-ehcache-config.xml +++ b/portal-impl/test/unit/com/liferay/portal/dao/orm/hibernate/region/dependencies/test-multi-ehcache-config.xml @@ -19,7 +19,6 @@ propertySeparator="," />  -   @@ -29,6 +28,5 @@ propertySeparator="," />  -    \ No newline at end of file diff --git a/portal-kernel/src/com/liferay/portal/kernel/template/Template.java b/portal-kernel/src/com/liferay/portal/kernel/template/Template.java index fde5281e750c74..f6bb3d611e07b8 100644 --- a/portal-kernel/src/com/liferay/portal/kernel/template/Template.java +++ b/portal-kernel/src/com/liferay/portal/kernel/template/Template.java @@ -14,15 +14,19 @@ package com.liferay.portal.kernel.template; +import aQute.bnd.annotation.ProviderType; + import java.io.Writer; import java.util.Map; import javax.servlet.http.HttpServletRequest; +import javax.servlet.http.HttpServletResponse; /\*\* \* @author Tina Tian \*/ +@ProviderType public interface Template extends Map { public void doProcessTemplate(Writer writer) throws Exception; @@ -33,6 +37,10 @@ public interface Template extends Map { public void prepare(HttpServletRequest request); + public void prepareTaglib( + HttpServletRequest httpServletRequest, + HttpServletResponse httpServletResponse); + public void processTemplate(Writer writer) throws TemplateException; } \ No newline at end of file diff --git a/portal-kernel/src/com/liferay/portal/kernel/template/TemplateManager.java b/portal-kernel/src/com/liferay/portal/kernel/template/TemplateManager.java index 5b3f93f8aa2833..b828d2e7d3fbaf 100644 --- a/portal-kernel/src/com/liferay/portal/kernel/template/TemplateManager.java +++ b/portal-kernel/src/com/liferay/portal/kernel/template/TemplateManager.java @@ -27,30 +27,58 @@ \*/ public interface TemplateManager { + /\*\* + \* @deprecated As of Athanasius (7.3.x), with no direct replacement + \*/ + @Deprecated public void addContextObjects( Map contextObjects, Map newContextObjects); + /\*\* + \* @deprecated As of Athanasius (7.3.x), with no direct replacement + \*/ + @Deprecated public void addStaticClassSupport( Map contextObjects, String variableName, Class  variableClass); + /\*\* + \* @deprecated As of Athanasius (7.3.x), with no direct replacement + \*/ + @Deprecated public void addTaglibApplication( Map contextObjects, String applicationName, ServletContext servletContext); + /\*\* + \* @deprecated As of Athanasius (7.3.x), with no direct replacement + \*/ + @Deprecated public void addTaglibFactory( Map contextObjects, String taglibLiferayHash, ServletContext servletContext); + /\*\* + \* @deprecated As of Athanasius (7.3.x), with no direct replacement + \*/ + @Deprecated public void addTaglibRequest( Map contextObjects, String applicationName, HttpServletRequest request, HttpServletResponse response); + /\*\* + \* @deprecated As of Athanasius (7.3.x), with no direct replacement + \*/ + @Deprecated public void addTaglibSupport( Map contextObjects, HttpServletRequest request, HttpServletResponse response); + /\*\* + \* @deprecated As of Athanasius (7.3.x), with no direct replacement + \*/ + @Deprecated public void addTaglibTheme( Map contextObjects, String string, HttpServletRequest request, HttpServletResponse response); diff --git a/portal-kernel/src/com/liferay/portal/kernel/util/PropsKeys.java b/portal-kernel/src/com/liferay/portal/kernel/util/PropsKeys.java index 27d7fa27b6282a..3b4f4280b1590f 100644 --- a/portal-kernel/src/com/liferay/portal/kernel/util/PropsKeys.java +++ b/portal-kernel/src/com/liferay/portal/kernel/util/PropsKeys.java @@ -1199,12 +1199,24 @@ public interface PropsKeys { public static final String EHCACHE\_BLOCKING\_CACHE\_ALLOWED = "ehcache.blocking.cache.allowed"; + /\*\* + \* @deprecated As of Judson (7.1.x), with no direct replacement + \*/ + @Deprecated public static final String EHCACHE\_BOOTSTRAP\_CACHE\_LOADER\_ENABLED = "ehcache.bootstrap.cache.loader.enabled"; + /\*\* + \* @deprecated As of Judson (7.1.x), with no direct replacement + \*/ + @Deprecated public static final String EHCACHE\_BOOTSTRAP\_CACHE\_LOADER\_PROPERTIES = "ehcache.bootstrap.cache.loader.properties"; + /\*\* + \* @deprecated As of Judson (7.1.x), with no direct replacement + \*/ + @Deprecated public static final String EHCACHE\_BOOTSTRAP\_CACHE\_LOADER\_PROPERTIES\_DEFAULT = "ehcache.bootstrap.cache.loader.properties.default"; diff --git a/portal-web/docroot/html/common/themes/top\_js.jspf b/portal-web/docroot/html/common/themes/top\_js.jspf index 458af09d3830b0..10cba2965c8022 100644 --- a/portal-web/docroot/html/common/themes/top\_js.jspf +++ b/portal-web/docroot/html/common/themes/top\_js.jspf @@ -194,7 +194,7 @@ String completeURL = PortalUtil.getCurrentCompleteURL(request); %> - return '<%= PortalUtil.getCanonicalURL(completeURL, themeDisplay, layout, false, false) %>'; + return '<%= HtmlUtil.escapeJS(PortalUtil.getCanonicalURL(completeURL, themeDisplay, layout, false, false)) %>'; }, getCDNBaseURL: function() { return '<%= themeDisplay.getCDNBaseURL() %>'; diff --git a/portal-web/docroot/html/taglib/ui/page\_iterator/lexicon/start.jsp b/portal-web/docroot/html/taglib/ui/page\_iterator/lexicon/start.jsp index 42a212875ae5d8..70af8a32ca02ab 100644 --- a/portal-web/docroot/html/taglib/ui/page\_iterator/lexicon/start.jsp +++ b/portal-web/docroot/html/taglib/ui/page\_iterator/lexicon/start.jsp @@ -70,7 +70,7 @@ if (forcePost && (portletURL != null)) { %> -  +     @@ -100,7 +100,7 @@ if (forcePost && (portletURL != null)) { %>- - ["><%= String.valueOf(curDelta) %>](%3C%25%3D%20curDeltaURL%20%25%3E)   + ["><%= String.valueOf(curDelta) %>](%3C%25%3D%20HtmlUtil.escapeHREF%28curDeltaURL%29%20%25%3E) <% @@ -310,7 +310,7 @@ if (forcePost && (portletURL != null)) { namespace: '<%= namespace %>', pages: '<%= pages %>', randomNamespace: '<%= randomNamespace %>', - url: '<%= url %>', + url: '<%= HtmlUtil.escapeJS(url) %>', urlAnchor: '<%= urlAnchor %>' } ); @@ -330,7 +330,7 @@ if (forcePost && (portletURL != null)) { <%! private String \_getHREF(String formName, String curParam, int cur, String jsCall, String url, String urlAnchor) throws Exception { if (Validator.isNotNull(url)) { - return HttpUtil.addParameter(HttpUtil.removeParameter(url, curParam) + urlAnchor, curParam, cur); + return HtmlUtil.escapeHREF(HttpUtil.addParameter(HttpUtil.removeParameter(url, curParam) + urlAnchor, curParam, cur)); } return "javascript:document." + formName + "." + curParam + ".value = '" + cur + "'; " + jsCall; diff --git a/portal-web/docroot/html/taglib/ui/page\_iterator/start.jsp b/portal-web/docroot/html/taglib/ui/page\_iterator/start.jsp index d95e305e9939bc..057df7276d0d9c 100644 --- a/portal-web/docroot/html/taglib/ui/page\_iterator/start.jsp +++ b/portal-web/docroot/html/taglib/ui/page\_iterator/start.jsp @@ -83,7 +83,7 @@ if (forcePost && (portletURL != null)) { url = url.split(namespace)[0]; %> -  +     @@ -204,7 +204,7 @@ if (forcePost && (portletURL != null)) {  <% @@ -239,7 +239,7 @@ if (forcePost && (portletURL != null)) {  <% diff --git a/portal-web/test/functional/com/liferay/portalweb/tests/coreinfrastructureee/clustering/clusteringframework/ClusteringMissingPlugins.testcase b/portal-web/test/functional/com/liferay/portalweb/tests/coreinfrastructureee/clustering/clusteringframework/ClusteringMissingPlugins.testcase index 63e80362a72ea4..c66f0c8b181203 100644 --- a/portal-web/test/functional/com/liferay/portalweb/tests/coreinfrastructureee/clustering/clusteringframework/ClusteringMissingPlugins.testcase +++ b/portal-web/test/functional/com/liferay/portalweb/tests/coreinfrastructureee/clustering/clusteringframework/ClusteringMissingPlugins.testcase @@ -27,6 +27,7 @@ definition { } @ignore = "true" +<<<<<<< HEAD @priority = "3" test CacheBootstrapLoader { property custom.properties = "ehcache.bootstrap.cache.loader.enabled=true${line.separator}ehcache.bootstrap.cache.loader.properties.test.cache=bootstrapAsynchronously=false"; @@ -96,9 +97,11 @@ definition { } @ignore = "true" +======= +>>>>>>> da7371982368... LPS-96563 Remove bootstrap feature of cache, including classes, properties and tests. (manually backport to resolve conflict and avoid major version bump) @priority = "4" test CacheReplicationbyCopy { - property custom.properties = "ehcache.bootstrap.cache.loader.enabled=false${line.separator}ehcache.replicator.properties.test.cache=replicatePutsViaCopy=true"; + property custom.properties = "ehcache.replicator.properties.test.cache=replicatePutsViaCopy=true"; property test.name.skip.portal.instance = "ClusteringMissingPlugins#CacheReplicationbyCopy"; Clustering.viewClusterStatusInConsole(); diff --git a/source-formatter-api-signature-check-exceptions.txt b/source-formatter-api-signature-check-exceptions.txt index 7648807e739ae6..afed807196a712 100644 --- a/source-formatter-api-signature-check-exceptions.txt +++ b/source-formatter-api-signature-check-exceptions.txt @@ -326,7 +326,7 @@ com.liferay.portal.setup.SetupWizardUtil#isDefaultDatabase(HttpServletRequest) com.liferay.portal.setup.SetupWizardUtil#testDatabase(HttpServletRequest) com.liferay.portal.setup.SetupWizardUtil#updateLanguage(HttpServletRequest,HttpServletResponse) com.liferay.portal.setup.SetupWizardUtil#updateSetup(HttpServletRequest,HttpServletResponse) -com.liferay.portal.templateparser.Transformer#transform(ThemeDisplay,Map,String,String,UnsyncStringWriter) +com.liferay.portal.templateparser.Transformer#transform(ThemeDisplay,Map,String,String,UnsyncStringWriter,HttpServletRequest,HttpServletResponse) com.liferay.portal.util.LayoutClone#get(HttpServletRequest,long) com.liferay.portal.util.LayoutClone#update(HttpServletRequest,long,String) com.liferay.portal.util.LayoutURLUtil#getLayoutURL(Layout,ServiceContext) diff --git a/util-bridges/src/com/liferay/util/bridges/freemarker/FreeMarkerPortlet.java b/util-bridges/src/com/liferay/util/bridges/freemarker/FreeMarkerPortlet.java index ad4a0286d3aefa..bfbcd8261b65ca 100644 --- a/util-bridges/src/com/liferay/util/bridges/freemarker/FreeMarkerPortlet.java +++ b/util-bridges/src/com/liferay/util/bridges/freemarker/FreeMarkerPortlet.java @@ -21,7 +21,6 @@ import com.liferay.portal.kernel.template.Template; import com.liferay.portal.kernel.template.TemplateConstants; import com.liferay.portal.kernel.template.TemplateException; -import com.liferay.portal.kernel.template.TemplateManager; import com.liferay.portal.kernel.template.TemplateManagerUtil; import com.liferay.portal.kernel.template.TemplateResource; import com.liferay.portal.kernel.template.TemplateResourceLoaderUtil; @@ -86,15 +85,11 @@ protected void include( TemplateResourceLoaderUtil.getTemplateResource( TemplateConstants.LANG\_TYPE\_FTL, resourcePath); - TemplateManager templateManager = - TemplateManagerUtil.getTemplateManager( - TemplateConstants.LANG\_TYPE\_FTL); - Template template = TemplateManagerUtil.getTemplate( TemplateConstants.LANG\_TYPE\_FTL, templateResource, false); - templateManager.addTaglibSupport( - template, PortalUtil.getHttpServletRequest(portletRequest), + template.prepareTaglib( + PortalUtil.getHttpServletRequest(portletRequest), PortalUtil.getHttpServletResponse(portletResponse)); template.put("portletContext", getPortletContext()); diff --git a/util-taglib/src/com/liferay/taglib/aui/ATag.java b/util-taglib/src/com/liferay/taglib/aui/ATag.java index 3cfbd139555ff4..120b1933e634ef 100644 --- a/util-taglib/src/com/liferay/taglib/aui/ATag.java +++ b/util-taglib/src/com/liferay/taglib/aui/ATag.java @@ -140,7 +140,7 @@ protected int processStartTag() throws Exception { if (Validator.isNotNull(onClick)) { jspWriter.write("onClick=\""); - jspWriter.write(onClick); + jspWriter.write(HtmlUtil.escapeAttribute(onClick)); jspWriter.write("\" "); } diff --git a/util-taglib/src/com/liferay/taglib/ui/IconTag.java b/util-taglib/src/com/liferay/taglib/ui/IconTag.java index 7af60ba1ce5cfd..028f75b002e9d4 100644 --- a/util-taglib/src/com/liferay/taglib/ui/IconTag.java +++ b/util-taglib/src/com/liferay/taglib/ui/IconTag.java @@ -517,8 +517,9 @@ private String \_getDetails(ThemeDisplay themeDisplay) { String details = null; if (\_alt != null) { - details = - " alt=\"" + LanguageUtil.get(\_getResourceBundle(), \_alt) + "\""; + String alt = LanguageUtil.get(\_getResourceBundle(), \_alt); + + details = " alt=\"" + HtmlUtil.escapeAttribute(alt) + "\""; } else if (isLabel()) { details = " alt=\"\""; @@ -530,7 +531,8 @@ else if (isLabel()) { String localizedProcessedMessage = StringPool.BLANK; - String processedMessage = getProcessedMessage(); + String processedMessage = HtmlUtil.escapeAttribute( + getProcessedMessage()); if (processedMessage != null) { localizedProcessedMessage = LanguageUtil.get( @@ -641,7 +643,7 @@ else if (isLabel()) { sb.append(details); sb.append(" style=\"background-image: url('"); - sb.append(spriteFileURL); + sb.append(HtmlUtil.escapeCSS(spriteFileURL)); sb.append("'); background-position: 50% -"); sb.append(spriteImage.getOffset()); sb.append("px; background-repeat: no-repeat; height: "); diff --git a/util-taglib/src/com/liferay/taglib/util/ThemeUtil.java b/util-taglib/src/com/liferay/taglib/util/ThemeUtil.java index 3c82b0d556c5cb..69e64d7aa33c3f 100644 --- a/util-taglib/src/com/liferay/taglib/util/ThemeUtil.java +++ b/util-taglib/src/com/liferay/taglib/util/ThemeUtil.java @@ -25,7 +25,6 @@ import com.liferay.portal.kernel.template.Template; import com.liferay.portal.kernel.template.TemplateConstants; import com.liferay.portal.kernel.template.TemplateContextContributor; -import com.liferay.portal.kernel.template.TemplateManager; import com.liferay.portal.kernel.template.TemplateManagerUtil; import com.liferay.portal.kernel.template.TemplateResource; import com.liferay.portal.kernel.template.TemplateResourceLoaderUtil; @@ -56,11 +55,12 @@ \*/ public class ThemeUtil { - public static String getPortletId(HttpServletRequest request) { + public static String getPortletId(HttpServletRequest httpServletRequest) { String portletId = null; - ThemeDisplay themeDisplay = (ThemeDisplay)request.getAttribute( - WebKeys.THEME\_DISPLAY); + ThemeDisplay themeDisplay = + (ThemeDisplay)httpServletRequest.getAttribute( + WebKeys.THEME\_DISPLAY); if (themeDisplay != null) { PortletDisplay portletDisplay = themeDisplay.getPortletDisplay(); @@ -72,41 +72,48 @@ public static String getPortletId(HttpServletRequest request) { } public static void include( - ServletContext servletContext, HttpServletRequest request, - HttpServletResponse response, String path, Theme theme) + ServletContext servletContext, + HttpServletRequest httpServletRequest, + HttpServletResponse httpServletResponse, String path, Theme theme) throws Exception { String extension = theme.getTemplateExtension(); if (extension.equals(ThemeHelper.TEMPLATE\_EXTENSION\_FTL)) { - includeFTL(servletContext, request, response, path, theme, true); + includeFTL( + servletContext, httpServletRequest, httpServletResponse, path, + theme, true); } else { path = theme.getTemplatesPath() + StringPool.SLASH + path; - includeJSP(servletContext, request, response, path, theme); + includeJSP( + servletContext, httpServletRequest, httpServletResponse, path, + theme); } } public static String includeFTL( - ServletContext servletContext, HttpServletRequest request, - HttpServletResponse response, String path, Theme theme, + ServletContext servletContext, + HttpServletRequest httpServletRequest, + HttpServletResponse httpServletResponse, String path, Theme theme, boolean write) throws Exception { return doDispatch( - servletContext, request, response, path, theme, write, - ThemeHelper.TEMPLATE\_EXTENSION\_FTL); + servletContext, httpServletRequest, httpServletResponse, path, + theme, write, ThemeHelper.TEMPLATE\_EXTENSION\_FTL); } public static void includeJSP( - ServletContext servletContext, HttpServletRequest request, - HttpServletResponse response, String path, Theme theme) + ServletContext servletContext, + HttpServletRequest httpServletRequest, + HttpServletResponse httpServletResponse, String path, Theme theme) throws Exception { doDispatch( - servletContext, request, response, path, theme, true, - ThemeHelper.TEMPLATE\_EXTENSION\_JSP); + servletContext, httpServletRequest, httpServletResponse, path, + theme, true, ThemeHelper.TEMPLATE\_EXTENSION\_JSP); } /\*\* @@ -114,19 +121,21 @@ public static void includeJSP( \*/ @Deprecated public static String includeVM( - ServletContext servletContext, HttpServletRequest request, - HttpServletResponse response, String path, Theme theme, + ServletContext servletContext, + HttpServletRequest httpServletRequest, + HttpServletResponse httpServletResponse, String path, Theme theme, boolean write) throws Exception { return doDispatch( - servletContext, request, response, path, theme, write, - ThemeHelper.TEMPLATE\_EXTENSION\_VM); + servletContext, httpServletRequest, httpServletResponse, path, + theme, write, ThemeHelper.TEMPLATE\_EXTENSION\_VM); } protected static String doDispatch( - ServletContext servletContext, HttpServletRequest request, - HttpServletResponse response, String path, Theme theme, + ServletContext servletContext, + HttpServletRequest httpServletRequest, + HttpServletResponse httpServletResponse, String path, Theme theme, boolean write, String extension) throws Exception { @@ -156,11 +165,13 @@ protected static String doDispatch( try { if (extension.equals(ThemeHelper.TEMPLATE\_EXTENSION\_FTL)) { return doIncludeFTL( - servletContext, request, response, path, theme, false, - write); + servletContext, httpServletRequest, httpServletResponse, + path, theme, false, write); } else if (extension.equals(ThemeHelper.TEMPLATE\_EXTENSION\_JSP)) { - doIncludeJSP(servletContext, request, response, path, theme); + doIncludeJSP( + servletContext, httpServletRequest, httpServletResponse, + path, theme); } return null; @@ -175,8 +186,9 @@ else if (extension.equals(ThemeHelper.TEMPLATE\_EXTENSION\_JSP)) { } protected static String doIncludeFTL( - ServletContext servletContext, HttpServletRequest request, - HttpServletResponse response, String path, Theme theme, + ServletContext servletContext, + HttpServletRequest httpServletRequest, + HttpServletResponse httpServletResponse, String path, Theme theme, boolean restricted, boolean write) throws Exception { @@ -197,7 +209,7 @@ protected static String doIncludeFTL( ServletContextPool.put(servletContextName, servletContext); } - String portletId = getPortletId(request); + String portletId = getPortletId(httpServletRequest); String resourcePath = theme.getResourcePath( servletContext, portletId, path); @@ -237,14 +249,14 @@ protected static String doIncludeFTL( // FreeMarker variables - template.prepare(request); + template.prepare(httpServletRequest); // Custom theme variables for (TemplateContextContributor templateContextContributor : \_templateContextContributors) { - templateContextContributor.prepare(template, request); + templateContextContributor.prepare(template, httpServletRequest); } // Theme servlet context @@ -257,21 +269,16 @@ protected static String doIncludeFTL( Writer writer = null; if (write) { - writer = response.getWriter(); + writer = httpServletResponse.getWriter(); } else { writer = new UnsyncStringWriter(); - response = new PipingServletResponse(response, writer); + httpServletResponse = new PipingServletResponse( + httpServletResponse, writer); } - TemplateManager templateManager = - TemplateManagerUtil.getTemplateManager( - TemplateConstants.LANG\_TYPE\_FTL); - - templateManager.addTaglibSupport(template, request, response); - templateManager.addTaglibTheme( - template, "taglibLiferay", request, response); + template.prepareTaglib(httpServletRequest, httpServletResponse); template.put(TemplateConstants.WRITER, writer); @@ -287,8 +294,9 @@ protected static String doIncludeFTL( } protected static void doIncludeJSP( - ServletContext servletContext, HttpServletRequest request, - HttpServletResponse response, String path, Theme theme) + ServletContext servletContext, + HttpServletRequest httpServletRequest, + HttpServletResponse httpServletResponse, String path, Theme theme) throws Exception { if (theme.isWARFile()) { @@ -312,7 +320,8 @@ protected static void doIncludeJSP( path)); } else { - requestDispatcher.include(request, response); + requestDispatcher.include( + httpServletRequest, httpServletResponse); } } } @@ -326,7 +335,8 @@ protected static void doIncludeJSP( "Theme ", theme.getThemeId(), " does not have ", path)); } else { - requestDispatcher.include(request, response); + requestDispatcher.include( + httpServletRequest, httpServletResponse); } } } @@ -336,8 +346,9 @@ protected static void doIncludeJSP( \*/ @Deprecated protected static String doIncludeVM( - ServletContext servletContext, HttpServletRequest request, - HttpServletResponse response, String page, Theme theme, + ServletContext servletContext, + HttpServletRequest httpServletRequest, + HttpServletResponse httpServletResponse, String page, Theme theme, boolean restricted, boolean write) throws Exception { @@ -358,7 +369,7 @@ protected static String doIncludeVM( ServletContextPool.put(servletContextName, servletContext); } - String portletId = getPortletId(request); + String portletId = getPortletId(httpServletRequest); String resourcePath = theme.getResourcePath( servletContext, portletId, page); @@ -406,23 +417,19 @@ protected static String doIncludeVM( "Unable to load template resource " + resourcePath); } - TemplateManager templateManager = - TemplateManagerUtil.getTemplateManager( - TemplateConstants.LANG\_TYPE\_VM); - Template template = TemplateManagerUtil.getTemplate( TemplateConstants.LANG\_TYPE\_VM, templateResource, restricted); // Velocity variables - template.prepare(request); + template.prepare(httpServletRequest); // Custom theme variables for (TemplateContextContributor templateContextContributor : \_templateContextContributors) { - templateContextContributor.prepare(template, request); + templateContextContributor.prepare(template, httpServletRequest); } // Theme servlet context @@ -437,17 +444,15 @@ protected static String doIncludeVM( Writer writer = null; if (write) { - writer = response.getWriter(); + writer = httpServletResponse.getWriter(); } else { writer = new UnsyncStringWriter(); - response = new PipingServletResponse(response, writer); + httpServletResponse = new PipingServletResponse( + httpServletResponse, writer); } - templateManager.addTaglibTheme( - template, "taglibLiferay", request, response); - template.put(TemplateConstants.WRITER, writer); // Merge templates From 11d7c6ed259c82a5e97119e82373fdda37a74c2c Mon Sep 17 00:00:00 2001 From: Samuel Kong  Date: Tue, 9 Jun 2020 11:04:16 +0800 Subject: [PATCH 4/7] Update README --- README.markdown | 60 ++++++++++++++++++++++++++++++++++++------------- 1 file changed, 44 insertions(+), 16 deletions(-) diff --git a/README.markdown b/README.markdown index eb12e8273dc3ea..15b60a80942999 100644 --- a/README.markdown +++ b/README.markdown @@ -7,23 +7,51 @@ information about security in Liferay Portal, please see \*\*Cumulative diff patch:\*\* [https://github.com/community-security-team/liferay-portal/compare/7.1.3-ga4...7.1.3-cumulative.patch](https://github.com/community-security-team/liferay-portal/compare/7.1.3-ga4...7.1.3-cumulative.patch) -The [June 2020](https://github.com/community-security-team/liferay-portal/commit/94535daf406162f259fccceff14357cf91513078) +The [June 2020](https://github.com/community-security-team/liferay-portal/commit/afda58bf8a7b6c6cc840646d756e90cf01639b35) release contains fixes for the following issues: -[CST-7150](), -[CST-7213](), -[CST-7214](), -[CST-7215](), -[CST-7216](), -[CST-7217](), -[CST-7218](), -[CST-7219](), -[CST-7220](), -[CST-7221](), -[CST-7222](), -[CST-7223](), -[CST-7301](), -[CST-7302](), -[CST-7303]() +[CST-7150](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119317521), +[CST-7213](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119317427), +[CST-7214](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119317439), +[CST-7215](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119317555), +[CST-7216](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119318646), +[CST-7217](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119319717), +[CST-7218](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119319747), +[CST-7219](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119320878), +[CST-7220](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119324436), +[CST-7221](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119326522), +[CST-7222](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119326537), +[CST-7223](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119326552), +[CST-7301](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119317396), +[CST-7302](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119317411), +[CST-7303](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119326567) + +The [March 2020](https://github.com/community-security-team/liferay-portal/commit/94535daf406162f259fccceff14357cf91513078) +release contains fixes for the following issues: +[CST-7132](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/117954449), +[CST-7133](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118080791), +[CST-7135](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118080894), +[CST-7136](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118080942), +[CST-7137](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118080955), +[CST-7138](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118080994), +[CST-7139](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118081013), +[CST-7140](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118081026), +[CST-7141](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118081039), +[CST-7142](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118081059), +[CST-7143](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118081072), +[CST-7144](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118664243), +[CST-7145](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118670963), +[CST-7146](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118671025), +[CST-7147](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118675447), +[CST-7148](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118675457), +[CST-7149](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118762169), +[CST-7204](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/117954240), +[CST-7205](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/117954271), +[CST-7206](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/117954284), +[CST-7208](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/117954394), +[CST-7209](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/117954421), +[CST-7210](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/117954436), +[CST-7211](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118664044), +[CST-7212](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/118670924) # Liferay Portal Community Edition License From 9ae123df776bb22e5f52091fb79d530a7edc2ae6 Mon Sep 17 00:00:00 2001 From: yxingwu  Date: Mon, 10 Aug 2020 18:44:12 +0800 Subject: [PATCH 5/7] September 2020 --- .../portal-vulcan-impl/build.gradle | 1 + .../internal/jaxrs/feature/VulcanFeature.java | 9 ++++++- .../body/MultipartBodyMessageBodyReader.java | 22 ++++++++++++++-- .../UploadServletRequestFilter.java | 6 +++-- .../upload/UploadServletRequestImpl.java | 12 +++++++-- .../com/liferay/portal/util/PortalImpl.java | 26 +++++++++++++++++++ 6 files changed, 69 insertions(+), 7 deletions(-) diff --git a/modules/apps/portal-vulcan/portal-vulcan-impl/build.gradle b/modules/apps/portal-vulcan/portal-vulcan-impl/build.gradle index c8a82684d5cb37..421d1be770c5bc 100644 --- a/modules/apps/portal-vulcan/portal-vulcan-impl/build.gradle +++ b/modules/apps/portal-vulcan/portal-vulcan-impl/build.gradle @@ -57,6 +57,7 @@ dependencies { compileOnly group: "org.osgi", name: "org.osgi.service.component.annotations", version: "1.3.0" compileOnly group: "org.osgi", name: "org.osgi.service.jaxrs", version: "1.0.0" compileOnly group: "org.springframework", name: "spring-tx", version: "4.1.9.RELEASE" + compileOnly project(":apps:document-library:document-library-api") testCompile group: "org.hamcrest", name: "hamcrest-all", version: "1.3" } diff --git a/modules/apps/portal-vulcan/portal-vulcan-impl/src/main/java/com/liferay/portal/vulcan/internal/jaxrs/feature/VulcanFeature.java b/modules/apps/portal-vulcan/portal-vulcan-impl/src/main/java/com/liferay/portal/vulcan/internal/jaxrs/feature/VulcanFeature.java index 43cbd896244af5..afa0e211f13dee 100644 --- a/modules/apps/portal-vulcan/portal-vulcan-impl/src/main/java/com/liferay/portal/vulcan/internal/jaxrs/feature/VulcanFeature.java +++ b/modules/apps/portal-vulcan/portal-vulcan-impl/src/main/java/com/liferay/portal/vulcan/internal/jaxrs/feature/VulcanFeature.java @@ -17,6 +17,7 @@ import com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider; import com.fasterxml.jackson.jaxrs.xml.JacksonXMLProvider; +import com.liferay.document.library.kernel.util.DLValidator; import com.liferay.portal.kernel.language.Language; import com.liferay.portal.kernel.search.filter.Filter; import com.liferay.portal.kernel.service.GroupLocalService; @@ -92,7 +93,6 @@ public boolean configure(FeatureContext featureContext) { featureContext.register(JSONMessageBodyWriter.class); featureContext.register(JsonParseExceptionMapper.class); featureContext.register(InvalidFormatExceptionMapper.class); - featureContext.register(MultipartBodyMessageBodyReader.class); featureContext.register(NoSuchModelExceptionMapper.class); featureContext.register(ObjectMapperContextResolver.class); featureContext.register(PaginationContextProvider.class); @@ -113,6 +113,10 @@ public boolean configure(FeatureContext featureContext) { featureContext.register( new FilterContextProvider( \_expressionConvert, \_filterParserProvider, \_language, \_portal)); + featureContext.register( + new MultipartBodyMessageBodyReader( + \_dlValidator.getMaxAllowableSize())); + featureContext.register( new SiteValidatorContainerRequestFilter(\_groupLocalService)); @@ -130,6 +134,9 @@ protected void activate(BundleContext bundleContext) { private BundleContext \_bundleContext; + @Reference + private DLValidator \_dlValidator; + @Reference( target = "(result.class.name=com.liferay.portal.kernel.search.filter.Filter)" ) diff --git a/modules/apps/portal-vulcan/portal-vulcan-impl/src/main/java/com/liferay/portal/vulcan/internal/jaxrs/message/body/MultipartBodyMessageBodyReader.java b/modules/apps/portal-vulcan/portal-vulcan-impl/src/main/java/com/liferay/portal/vulcan/internal/jaxrs/message/body/MultipartBodyMessageBodyReader.java index 6cd8783d4be7ad..26428d7dfa862d 100644 --- a/modules/apps/portal-vulcan/portal-vulcan-impl/src/main/java/com/liferay/portal/vulcan/internal/jaxrs/message/body/MultipartBodyMessageBodyReader.java +++ b/modules/apps/portal-vulcan/portal-vulcan-impl/src/main/java/com/liferay/portal/vulcan/internal/jaxrs/message/body/MultipartBodyMessageBodyReader.java @@ -41,6 +41,7 @@ import javax.ws.rs.ext.Providers; import org.apache.commons.fileupload.FileItem; +import org.apache.commons.fileupload.FileUploadBase; import org.apache.commons.fileupload.disk.DiskFileItemFactory; import org.apache.commons.fileupload.servlet.ServletFileUpload; import org.apache.commons.fileupload.util.Streams; @@ -54,6 +55,10 @@ public class MultipartBodyMessageBodyReader implements MessageBodyReader { + public MultipartBodyMessageBodyReader(long fileMaxSize) { + \_fileMaxSize = fileMaxSize; + } + @Override public boolean isReadable( Class  clazz, Type genericType, Annotation[] annotations, @@ -79,6 +84,9 @@ public MultipartBody readFrom( ServletFileUpload servletFileUpload = new ServletFileUpload( new DiskFileItemFactory()); + servletFileUpload.setFileSizeMax(\_fileMaxSize); + servletFileUpload.setSizeMax(\_fileMaxSize); + List fileItems = servletFileUpload.parseRequest( \_httpServletRequest); @@ -101,12 +109,22 @@ public MultipartBody readFrom( return MultipartBody.of( binaryFiles, contextResolver::getContext, values); } - catch (Exception e) { + catch (FileUploadBase.SizeLimitExceededException + sizeLimitExceededException) { + throw new BadRequestException( - "Request body is not a valid multipart form", e); + "Please enter a file with a valid file size no larger than " + + \_fileMaxSize, + sizeLimitExceededException); + } + catch (Exception exception) { + throw new BadRequestException( + "Request body is not a valid multipart form", exception); } } + private final long \_fileMaxSize; + @Context private HttpServletRequest \_httpServletRequest; diff --git a/portal-impl/src/com/liferay/portal/servlet/filters/uploadservletrequest/UploadServletRequestFilter.java b/portal-impl/src/com/liferay/portal/servlet/filters/uploadservletrequest/UploadServletRequestFilter.java index f5855e72ef4f8b..d7fbf4f9d2d38f 100644 --- a/portal-impl/src/com/liferay/portal/servlet/filters/uploadservletrequest/UploadServletRequestFilter.java +++ b/portal-impl/src/com/liferay/portal/servlet/filters/uploadservletrequest/UploadServletRequestFilter.java @@ -44,9 +44,11 @@ public class UploadServletRequestFilter extends BasePortalFilter { @Override public boolean isFilterEnabled( - HttpServletRequest request, HttpServletResponse response) { + HttpServletRequest httpServletRequest, + HttpServletResponse httpServletResponse) { - String contentType = request.getHeader(HttpHeaders.CONTENT\_TYPE); + String contentType = httpServletRequest.getHeader( + HttpHeaders.CONTENT\_TYPE); if ((contentType != null) && contentType.startsWith(ContentTypes.MULTIPART\_FORM\_DATA)) { diff --git a/portal-impl/src/com/liferay/portal/upload/UploadServletRequestImpl.java b/portal-impl/src/com/liferay/portal/upload/UploadServletRequestImpl.java index 1021e41809c0ea..dd9311a2249e48 100644 --- a/portal-impl/src/com/liferay/portal/upload/UploadServletRequestImpl.java +++ b/portal-impl/src/com/liferay/portal/upload/UploadServletRequestImpl.java @@ -100,13 +100,23 @@ public UploadServletRequestImpl( new LiferayFileItemFactory(getTempDir())); } + long uploadServletRequestImplMaxSize = + UploadServletRequestConfigurationHelperUtil.getMaxSize(); + if (maxRequestSize > 0) { servletFileUpload.setSizeMax(maxRequestSize); } + else { + servletFileUpload.setSizeMax(uploadServletRequestImplMaxSize); + } if (maxFileSize > 0) { servletFileUpload.setFileSizeMax(maxFileSize); } + else { + servletFileUpload.setFileSizeMax( + uploadServletRequestImplMaxSize); + } liferayServletRequest = new LiferayServletRequest(request); @@ -115,8 +125,6 @@ public UploadServletRequestImpl( liferayServletRequest.setFinishedReadingOriginalStream(true); - long uploadServletRequestImplMaxSize = - UploadServletRequestConfigurationHelperUtil.getMaxSize(); long uploadServletRequestImplSize = 0; int contentLength = request.getContentLength(); diff --git a/portal-impl/src/com/liferay/portal/util/PortalImpl.java b/portal-impl/src/com/liferay/portal/util/PortalImpl.java index ad6a721c5e4981..0791263fe10b75 100644 --- a/portal-impl/src/com/liferay/portal/util/PortalImpl.java +++ b/portal-impl/src/com/liferay/portal/util/PortalImpl.java @@ -6854,6 +6854,28 @@ public boolean isValidResourceId(String resourceId) { return false; } + int count = \_PORTLET\_RESOURCE\_ID\_URL\_DECODE\_COUNT; + + while ((count > 0) && resourceId.contains("%")) { + resourceId = HttpUtil.decodePath(resourceId); + + if (Validator.isNull(resourceId)) { + return false; + } + + matcher = \_bannedResourceIdPattern.matcher(resourceId); + + if (matcher.matches()) { + return false; + } + + count--; + + if (count == 0) { + return false; + } + } + return true; } @@ -9121,6 +9143,10 @@ private boolean \_isSameHostName( private static final Locale \_NULL\_LOCALE; + private static final int \_PORTLET\_RESOURCE\_ID\_URL\_DECODE\_COUNT = + GetterUtil.getInteger( + PropsUtil.get("portlet.resource.id.url.decode.count"), 10); + private static final String \_PRIVATE\_GROUP\_SERVLET\_MAPPING = PropsValues.LAYOUT\_FRIENDLY\_URL\_PRIVATE\_GROUP\_SERVLET\_MAPPING; From 9ed927b6aa0e435c613a416a83ba41bf98455b8e Mon Sep 17 00:00:00 2001 From: yxingwu  Date: Tue, 5 Jan 2021 15:37:20 +0800 Subject: [PATCH 6/7] Fix the release info --- .../src/com/liferay/portal/kernel/util/ReleaseInfo.java | 8 +++++--- 1 file changed, 5 insertions(+), 3 deletions(-) diff --git a/portal-kernel/src/com/liferay/portal/kernel/util/ReleaseInfo.java b/portal-kernel/src/com/liferay/portal/kernel/util/ReleaseInfo.java index 194734834afa74..74470f75d786e4 100644 --- a/portal-kernel/src/com/liferay/portal/kernel/util/ReleaseInfo.java +++ b/portal-kernel/src/com/liferay/portal/kernel/util/ReleaseInfo.java @@ -221,6 +221,8 @@ public class ReleaseInfo { public static final int RELEASE\_7\_1\_2\_BUILD\_NUMBER = 7102; + public static final int RELEASE\_7\_1\_3\_BUILD\_NUMBER = 7103; + public static final int RELEASE\_7\_1\_10\_BUILD\_NUMBER = 7110; public static final Date getBuildDate() { @@ -272,7 +274,7 @@ public static final String getVersion() { return \_VERSION; } - private static final String \_BUILD = "7102"; + private static final String \_BUILD = "7103"; private static final int \_BUILD\_NUMBER = GetterUtil.getInteger(\_BUILD); @@ -292,9 +294,9 @@ public static final String getVersion() { private static final String \_VENDOR = "Liferay, Inc."; - private static final String \_VERSION = "7.1.2"; + private static final String \_VERSION = "7.1.3"; - private static final String \_VERSION\_DISPLAY\_NAME = "7.1.2 CE GA3"; + private static final String \_VERSION\_DISPLAY\_NAME = "7.1.3 CE GA4"; private static String \_releaseInfo; private static String \_serverInfo; From 545202104c12641b481e5126e33aea53517cc5e7 Mon Sep 17 00:00:00 2001 From: yxingwu  Date: Tue, 7 Feb 2023 14:39:06 +0800 Subject: [PATCH 7/7] Update README --- README.markdown | 4 ++-- 1 file changed, 2 insertions(+), 2 deletions(-) diff --git a/README.markdown b/README.markdown index 15b60a80942999..b368548d90155a 100644 --- a/README.markdown +++ b/README.markdown @@ -2,7 +2,7 @@ This fork provides security patches for Liferay Portal 7.1.3. For more information about security in Liferay Portal, please see -[https://portal.liferay.dev/learn/security](https://portal.liferay.dev/learn/security). +[https://liferay.dev/portal/security](https://liferay.dev/portal/security). \*\*Cumulative diff patch:\*\* [https://github.com/community-security-team/liferay-portal/compare/7.1.3-ga4...7.1.3-cumulative.patch](https://github.com/community-security-team/liferay-portal/compare/7.1.3-ga4...7.1.3-cumulative.patch) @@ -72,4 +72,4 @@ along with this library; if not, write to Free Software Foundation, Inc. 51 Franklin Street, Fifth Floor -Boston, MA 02110-1301 USA \ No newline at end of file +Boston, MA 02110-1301 USA |

=== Content from github.com_40d7cb2a_20250119_120039.html ===
From bda30ad9175af6c41842561e389834172a86aab8 Mon Sep 17 00:00:00 2001
From: Samuel Kong
Date: Fri, 5 Jun 2020 14:41:05 +0800
Subject: [PATCH 01/15] Prepare README
---
README.markdown | 205 +++++-------------------------------------------
1 file changed, 18 insertions(+), 187 deletions(-)
diff --git a/README.markdown b/README.markdown
index b9668308c04967..60a3803734fbaa 100644
--- a/README.markdown
+++ b/README.markdown
@@ -1,195 +1,26 @@
-# Liferay Portal
+# Information
-[Liferay Portal](https://portal.liferay.dev) is an
-open source enterprise web platform for building business solutions that deliver
-immediate results and long-term value. Liferay Portal started out as a personal
-development project in 2000 and was open sourced in 2001.
+This fork provides security patches for Liferay Portal 7.2.1. For more
+information about security in Liferay Portal, please see
+[https://portal.liferay.dev/learn/security](https://portal.liferay.dev/learn/security).
-To get started, check out the project's homepage at
-[portal.liferay.dev](https://portal.liferay.dev)!
+\*\*Cumulative diff patch:\*\*
+[https://github.com/community-security-team/liferay-portal/compare/7.2.1-ga2...7.2.1-cumulative.patch](https://github.com/community-security-team/liferay-portal/compare/7.2.1-ga2...7.2.1-cumulative.patch)
-## Product Details
-
-Liferay Portal is built from the source code found in
-[liferay-portal](https://github.com/liferay/liferay-portal) repository
-and several other related open source projects. It includes
-features for end users, business professionals, system administrators, and
-enterprise developers.
-
-- Modular architecture for maximum flexibility and reliability
-- Portal features for managing users, groups, and permissions
-- Single page applications for blazingly fast performance
-- Rich web services for integrating with other systems
-- Web content management including Personalization and Content Targeting
-- Documents and rich media management
-- Mobile development platform
-- Business forms and workflow
-- Collaboration features such as blogs, wikis, and social networking
-- Consistent and powerful Lexicon user experience
-- Integrated development environment using
- [Liferay Dev Studio](https://liferay.dev/projects/ide)
-
-For more details on these and other features, please refer to the
-[user guide](https://portal.liferay.dev/docs/latest/user) or
-[developer guide](https://portal.liferay.dev/docs/latest/dev)
-
-## Quick Start
-
-To get up and running quickly, follow the steps below:
-
-1. Download a [pre-built Liferay Portal release](https://portal.liferay.dev/download)
- bundled with Tomcat.
-
-2. Download and install
- [Java (JDK) 8](http://www.oracle.com/technetwork/java/javase/downloads/index.html)
- (if necessary) in your local environment.
-
-3. Extract the downloaded pre-built Liferay Portal bundle into a folder.
-
-4. Navigate to the bundle's `liferay-ce-portal-[version]/tomcat-[version]/bin`
- folder and execute `startup.bat` (Windows) or `startup.sh` (Unix/Linux/Mac OS
- X), depending on your operating system.
-
-5. A server console opens, which starts your Liferay Portal instance. Once your
- instance is ready to use, the portal URL address (http://localhost:8080) is
- automatically opened in your default browser.
-
-6. You're presented a Basic Configuration page. Complete the configuration
- options.
-
- Liferay Portal uses an embedded database (HSQL) to make installation fast
- and easy. This database is not ready for production, so consider configuring
- a production-ready database (e.g., MySQL) if you plan on doing more than
- just exploring/testing.
-
-7. Agree to the terms and conditions, create a password, and configure a
- security question/answer.
-
-You can now use Liferay Portal!
-
-For more detailed installation instructions, refer to the
-[deployment guide](https://portal.liferay.dev/docs/latest/deploy).
-
-If you wish to \*build\* core Liferay Portal or its plugins, read
-[Building Liferay Portal from source code](https://portal.liferay.dev/participate/fix-a-bug/building-liferay-source).
-It includes details on using the repositories and building the software.
-
-## Liferay Portal website
-
-The [Liferay Portal website](https://portal.liferay.dev) is the best place
-to learn about Liferay Portal.
-
-It has over 200 tutorials, guided learning, and much more. Developer documentation
-explains
-
-- [How to build various applications](https://portal.liferay.dev/docs/latest/appdev),
-- [How to use provided frameworks](https://portal.liferay.dev/docs/latest/frameworks)
-- [How to customize existing features](https://portal.liferay.dev/docs/latest/customization)
-- [How to solve common challenges](https://portal.liferay.dev/docs/latest/tutorials),
-
-It is also your place to learn hot to [participate](https://portal.liferay.dev/participate)
-in making Liferay Portal better:
-
-- [How to report an issue](https://portal.liferay.dev/participate/feedback/report-issues).
-- [How to request new features](https://portal.liferay.dev/participate/feedback/suggestions)
-- [How to provide feedback](https://portal.liferay.dev/participate/continuous-feedback/overview)
-- [How to help a fellow developer](https://portal.liferay.dev/participate/help-a-fellow-developer)
-- [How to help with translations](https://portal.liferay.dev/participate/translate/overview)
-
-## Liferay Marketplace Developer Portal
-
-If you create apps that you want to share or sell, you can visit
-[Liferay Marketplace Developer Portal](https://marketplace.liferay.dev/)
-to learn how to publish apps to the [Liferay Marketplace](https://web.liferay.com/marketplace).
-
-## Source Code
-
-Liferay Portal's main source code resides in the
-[liferay-portal](https://github.com/liferay/liferay-portal) repository. Liferay
-maintains [many other repositories](https://github.com/liferay) related to
-features and supporting documentation.
-
-Liferay Portal \*releases\* are built from the
-[liferay-portal](https://github.com/liferay/liferay-portal) repository. You can
-build Liferay Portal, its modules, and/or any of the other supporting
-technologies from their respective folders/repositories.
-
-## Stay Connected
-
-There are many ways for you to learn what's new in Liferay Portal, get answers to
-questions, and connect with other Liferay community members.
-
-### Twitter
-
-Follow us on Twitter:
-
-- [@Liferay](http://twitter.com/liferay) tweets Liferay's latest announcements
-- [@LiferayDocs](http://twitter.com/liferaydocs) tweets about new articles and
- tutorials
-- [@LiferayEng](http://twitter.com/liferayeng) tweets from the core
- engineering and Developer Relations team
-- [@liferaydesign](https://twitter.com/liferaydesign) tweets from Liferay
- UI/UX designers
-- [@liferayfaces](https://twitter.com/liferayfaces) tweets from Liferay Faces team
-
-### Blog
-
-Read our announcements, engage in discussions, and learn more by following
-[Liferay's Blog Stream](https://liferay.dev/blogs).
-
-### Forum
-
-Do you have questions? Ask them on our very active
-[forums](https://liferay.dev/forums)!
-
-### Chat
-
-Join the conversation on Liferay's Community Chat.
-
-- Get your invite: [https://liferay.dev/chat](https://liferay.dev/chat)
-- Enter the chat: [liferay-community.slack.com](https://liferay-community.slack.com)
-- Channel: `#portal`
-
-## Contributing
-
-Liferay welcomes any and all contributions! Please read the
-[CONTRIBUTING guide](CONTRIBUTING.markdown) for details on developing and
-submitting your contributions.
-
-## Versioning
-
-For transparency and insight into Liferay's release cycle, and for striving to
-maintain backward compatibility, we make a strong effort to uphold the
-versioning for our software. See the
-[Semantic Versioning](https://portal.liferay.dev/docs/latest/customization/-/knowledge\_base/c/semantic-versioning)
-article for more information about how Liferay versions software.
-
-## Professional Services
-
-If you need professional consultation or help with Liferay and your business,
-check out the
-[offerings from Liferay, Inc.](http://www.liferay.com/subscription-services) and
-its [partner network](http://www.liferay.com/services/partners).
-
-## The Liferay Development Team
-
-Liferay Portal is produced by the worldwide Liferay engineering team, and
-involves many hours of development, testing, writing documentation, and working
-with the wider Liferay community of customers, partners, and open source
-developers. We are glad you have chosen Liferay Portal, and hope that it meets
-or exceeds your expectations!
-
-In addition to Liferay's engineering staff, a special thanks goes to the many
-open source developers who volunteer their time and energy to help with the
-release, whether it was bug fixing, idea generation, documentation,
-translations, or other contributions that helped to improve this release.
-
-## Liferay Portal Community Edition License
+# Liferay Portal Community Edition License
SPDX-License-Identifier: LGPL-2.1-or-later
-\*Liferay Portal Community Edition\* is free software: you can redistribute it and/or modify it under the terms of the GNU Lesser General Public License as published by the Free Software Foundation, either version 2.1 of the License, or (at your option) any later version.
+\*Liferay Portal Community Edition\* is free software: you can redistribute it
+and/or modify it under the terms of the GNU Lesser General Public License as
+published by the Free Software Foundation, either version 2.1 of the License,
+or (at your option) any later version.
-\*Liferay Portal Community Edition\* is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more details.
+\*Liferay Portal Community Edition\* is distributed in the hope that it will be
+useful, but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser
+General Public License for more details.
-You should have received a copy of the GNU Lesser General Public License along with \*Liferay Portal Community Edition\*. If not, see [](https://www.gnu.org/licenses/)
\ No newline at end of file
+You should have received a copy of the GNU Lesser General Public License along
+with \*Liferay Portal Community Edition\*. If not, see
+[](https://www.gnu.org/licenses/)
\ No newline at end of file
From 064e6b01afa1e087e4c6bbaf7f71c97ee33f3ee9 Mon Sep 17 00:00:00 2001
From: yxingwu
Date: Fri, 5 Jun 2020 15:44:35 +0800
Subject: [PATCH 02/15] June 2020
---
README.markdown | 13 +
build.properties | 4 +-
lib/portal/dependencies.properties | 14 +-
.../resources/js/scheduler\_event\_recorder.js | 2 +-
...eDriveDLViewFileVersionDisplayContext.java | 9 +-
.../internal/util/DLValidatorImpl.java | 17 +-
.../internal/util/DLValidatorImplTest.java | 91 ++++
.../display/context/logic/UIItemsBuilder.java | 19 +-
.../document\_library/search\_resources.jsp | 2 +-
.../dynamic-data-lists-web/build.gradle | 2 +-
.../DDLDisplayTemplateTransformer.java | 16 +-
.../dynamic-data-mapping-service/build.gradle | 2 +-
.../DDMFormFieldFreeMarkerRenderer.java | 8 +-
.../DDMDataProviderInstanceServiceImpl.java | 104 +++-
.../flags/service/FlagsEntryService.java | 2 +
.../FlagsRequestMessageListener.java | 7 +-
.../service/impl/FlagsEntryServiceImpl.java | 3 +
.../build.gradle | 2 +-
.../FreeMarkerFragmentEntryProcessor.java | 20 +-
.../build.gradle | 2 +-
.../FragmentEntryProcessorHelperImpl.java | 11 +-
.../FragmentCollectionLocalServiceImpl.java | 7 +
.../impl/FragmentEntryLocalServiceImpl.java | 7 +
.../ImageEditorDLDisplayContextHelper.java | 11 +-
.../apps/journal/journal-service/build.gradle | 2 +-
.../transformer/JournalTransformer.java | 14 +-
.../journal/internal/util/JournalUtil.java | 8 +-
modules/apps/polls/polls-web/build.gradle | 4 +-
.../portal/cache/BasePortalCacheManager.java | 16 -
.../cache/PortalCacheBootstrapLoader.java | 2 +
.../PortalCacheBootstrapLoaderFactory.java | 2 +
.../PortalCacheConfiguration.java | 20 +-
.../EhcachePortalCacheConfiguration.java | 8 +-
.../MultiVMEhcachePortalCacheManager.java | 9 -
...EhcachePortalCacheManagerConfigurator.java | 2 -
...EhcachePortalCacheManagerConfigurator.java | 46 --
.../ClusterLinkBootstrapLoaderHelperUtil.java | 470 ------------------
...ClusterLinkPortalCacheBootstrapLoader.java | 133 -----
...LinkPortalCacheBootstrapLoaderFactory.java | 39 --
.../portal/profile/ModulePortalProfile.java | 11 -
.../resources/search/results/view.jsp | 2 +-
.../META-INF/resources/user/facet/view.jsp | 2 +-
.../build.gradle | 4 +-
...ngsTestLDAPConnectionMVCRenderCommand.java | 42 ++
...ettingsTestLDAPGroupsMVCRenderCommand.java | 42 ++
...SettingsTestLDAPUsersMVCRenderCommand.java | 42 ++
.../edit\_ldap\_server.jsp | 4 +-
.../com.liferay.portal.settings.web/init.jsp | 1 +
.../portal-template-freemarker/build.gradle | 2 +-
.../FreeMarkerEngineConfiguration.java | 2 +-
.../internal/FreeMarkerManager.java | 136 +++--
.../internal/FreeMarkerTemplate.java | 50 +-
.../FreeMarkerTemplateContextHelper.java | 23 +-
...java => LiferayFreeMarkerStringModel.java} | 13 +-
.../internal/LiferayObjectConstructor.java | 12 +-
.../RestrictedLiferayObjectWrapper.java | 120 ++---
.../internal/FreeMarkerTemplateTest.java | 23 +-
.../RestrictedLiferayObjectWrapperTest.java | 18 +-
.../portal-template-velocity/build.gradle | 2 +-
.../VelocityEngineConfiguration.java | 4 +-
.../velocity/internal/VelocityManager.java | 10 +-
.../velocity/internal/VelocityTemplate.java | 21 +
.../VelocityTemplateContextHelper.java | 2 +-
.../build.gradle | 2 +-
.../internal/PortletDisplayTemplateImpl.java | 20 +-
.../apps/server/server-admin-web/build.gradle | 4 +-
.../util/SharingJavaScriptFactoryImpl.java | 7 +-
.../resources/dynamic\_include/bottom.jsp | 2 +-
.../META-INF/resources/configuration.jsp | 2 +-
.../resources/process\_summary\_link/page.jsp | 2 +-
.../required-dependencies/build.gradle | 4 +-
...nmentsManagementToolbarDisplayContext.java | 4 +
.../resources/edit\_user\_group\_assignments.jsp | 16 +-
.../DefaultWikiListPagesDisplayContext.java | 2 +-
modules/source-formatter.properties | 3 +
.../util/RuntimePageImpl.java | 4 +-
.../liferay/portal/template/BaseTemplate.java | 15 +
.../portal/template/BaseTemplateManager.java | 28 ++
.../portal/template/RestrictedTemplate.java | 9 +
.../template/TemplateContextHelper.java | 11 +-
.../com/liferay/portal/template/packageinfo | 2 +-
.../portal/templateparser/Transformer.java | 9 +-
.../src/com/liferay/portal/util/HttpImpl.java | 122 ++---
.../com/liferay/portal/util/PortalImpl.java | 22 +-
.../portal/verify/VerifyProperties.java | 3 +
.../portal/webserver/WebServerEntry.java | 20 +
.../portal/webserver/WebServerServlet.java | 6 -
.../webserver/dependencies/template.ftl | 4 +-
portal-impl/src/portal.properties | 25 +-
.../test-multi-ehcache-config.xml | 2 -
.../portal/kernel/template/Template.java | 8 +
.../kernel/template/TemplateManager.java | 28 ++
.../liferay/portal/kernel/util/PropsKeys.java | 12 +
.../docroot/html/common/themes/top\_js.jspf | 2 +-
.../docroot/html/taglib/ui/menu\_item/page.jsp | 2 +-
.../taglib/ui/page\_iterator/lexicon/start.jsp | 8 +-
.../html/taglib/ui/page\_iterator/start.jsp | 6 +-
.../ClusteringMissingPlugins.testcase | 59 +--
...rmatter-api-signature-check-exceptions.txt | 2 +-
.../bridges/freemarker/FreeMarkerPortlet.java | 9 +-
.../src/com/liferay/taglib/aui/ATag.java | 2 +-
.../src/com/liferay/taglib/ui/IconTag.java | 10 +-
.../com/liferay/taglib/util/ThemeUtil.java | 17 +-
103 files changed, 1004 insertions(+), 1249 deletions(-)
create mode 100644 modules/apps/document-library/document-library-service/src/test/java/com/liferay/document/library/internal/util/DLValidatorImplTest.java
delete mode 100644 modules/apps/portal-cache/portal-cache-multiple/src/main/java/com/liferay/portal/cache/multiple/internal/bootstrap/ClusterLinkBootstrapLoaderHelperUtil.java
delete mode 100644 modules/apps/portal-cache/portal-cache-multiple/src/main/java/com/liferay/portal/cache/multiple/internal/bootstrap/ClusterLinkPortalCacheBootstrapLoader.java
delete mode 100644 modules/apps/portal-cache/portal-cache-multiple/src/main/java/com/liferay/portal/cache/multiple/internal/bootstrap/ClusterLinkPortalCacheBootstrapLoaderFactory.java
rename modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/{LiferayFreeMarkerBeanModel.java => LiferayFreeMarkerStringModel.java} (81%)
diff --git a/README.markdown b/README.markdown
index 60a3803734fbaa..62d47e21084c88 100644
--- a/README.markdown
+++ b/README.markdown
@@ -7,6 +7,19 @@ information about security in Liferay Portal, please see
\*\*Cumulative diff patch:\*\*
[https://github.com/community-security-team/liferay-portal/compare/7.2.1-ga2...7.2.1-cumulative.patch](https://github.com/community-security-team/liferay-portal/compare/7.2.1-ga2...7.2.1-cumulative.patch)
+The [June 2020]() release contains fixes for the following issues:
+[CST-7213](),
+[CST-7214](),
+[CST-7216](),
+[CST-7217](),
+[CST-7218](),
+[CST-7219](),
+[CST-7220](),
+[CST-7221](),
+[CST-7301](),
+[CST-7302](),
+[CST-7303]()
+
# Liferay Portal Community Edition License
SPDX-License-Identifier: LGPL-2.1-or-later
diff --git a/build.properties b/build.properties
index 00803f407fc3d8..d4be64c9d603d5 100644
--- a/build.properties
+++ b/build.properties
@@ -12,8 +12,8 @@
baseline.jar.bnddir.name=.bnd
#baseline.jar.report.level=diff
- #baseline.jar.report.level=off
- baseline.jar.report.level=persist
+ baseline.jar.report.level=off
+ #baseline.jar.report.level=persist
#baseline.jar.report.level=standard
baseline.jar.report.only.dirty.packages=true
diff --git a/lib/portal/dependencies.properties b/lib/portal/dependencies.properties
index 10cf9870442860..02687255aa6aac 100644
--- a/lib/portal/dependencies.properties
+++ b/lib/portal/dependencies.properties
@@ -12,11 +12,11 @@ aspectj-rt=org.aspectj:aspectjrt:1.8.13
aspectj-weaver=org.aspectj:aspectjweaver:1.8.13
axis-ant=org.apache.axis:axis-ant:1.4
axis=com.liferay:org.apache.axis:1.4.LIFERAY-PATCHED-4
-bcmail=org.bouncycastle:bcmail-jdk16:1.45
-bcprov=org.bouncycastle:bcprov-jdk16:1.45
+bcmail=org.bouncycastle:bcmail-jdk15on:1.61
+bcprov=org.bouncycastle:bcprov-jdk15on:1.61
boilerpipe=com.liferay:de.l3s.boilerpipe:1.1.0.LIFERAY-PATCHED-1
bsf=bsf:bsf:2.4.0
-c3p0=com.mchange:c3p0:0.9.5.3
+c3p0=com.mchange:c3p0:0.9.5.4
ccpp-ri=com.liferay:javax.ccpp.ccpp-ri:1.0
ccpp=javax.ccpp:ccpp:1.0
cglib-nodep=cglib:cglib-nodep:2.2.2
@@ -27,7 +27,7 @@ commons-chain=commons-chain:commons-chain:1.2
commons-codec=commons-codec:commons-codec:1.9
commons-collections4=org.apache.commons:commons-collections4:4.2
commons-collections=commons-collections:commons-collections:3.2.2
-commons-compress=org.apache.commons:commons-compress:1.18
+commons-compress=org.apache.commons:commons-compress:1.19
commons-configuration=com.liferay:org.apache.commons.configuration:1.10.LIFERAY-PATCHED-2
commons-dbcp=commons-dbcp:commons-dbcp:1.2.2
commons-digester=commons-digester:commons-digester:1.8.1
@@ -83,13 +83,13 @@ jazzy=net.sf.jazzy:jazzy:0.5.2-rtext-1.4.1-2
jbig2-imageio=org.apache.pdfbox:jbig2-imageio:3.0.2
jcifs=org.samba.jcifs:jcifs:1.3.14-kohsuke-1
jcl-over-slf4j=org.slf4j:jcl-over-slf4j:1.7.2
-jcommon=jfree:jcommon:1.0.16
+jcommon=org.jfree:jcommon:1.0.24
jdom=org.jdom:jdom:1.1.3
jempbox=org.apache.pdfbox:jempbox:1.8.16
jena=com.liferay:com.hp.hpl.jena:1.4
jericho-html=net.htmlparser.jericho:jericho-html:3.1
jersey-common=org.glassfish.jersey.core:jersey-common:2.26
-jfreechart=jfree:jfreechart:1.0.13
+jfreechart=org.jfree:jfreechart:1.0.19
jhighlight=com.uwyn:jhighlight:1.0
jhlabs-filters=com.jhlabs:imaging:01012005
jmatio=org.tallison:jmatio:1.2
@@ -123,7 +123,7 @@ mimepull=org.jvnet:mimepull:1.3
monte-cc=com.liferay:org.monte:0.7.7
nekohtml=net.sourceforge.nekohtml:nekohtml:1.9.22
netcdf=edu.ucar:netcdf:4.3.23
-netty-all=io.netty:netty-all:4.1.32.Final
+netty-all=io.netty:netty-all:4.1.42.Final
odmg=odmg:odmg:3.0
oro=oro:oro:2.0.8
pdfbox=org.apache.pdfbox:pdfbox:2.0.13
diff --git a/modules/apps/calendar/calendar-web/src/main/resources/META-INF/resources/js/scheduler\_event\_recorder.js b/modules/apps/calendar/calendar-web/src/main/resources/META-INF/resources/js/scheduler\_event\_recorder.js
index 4fa53d2953e5c5..e936a021885949 100644
--- a/modules/apps/calendar/calendar-web/src/main/resources/META-INF/resources/js/scheduler\_event\_recorder.js
+++ b/modules/apps/calendar/calendar-web/src/main/resources/META-INF/resources/js/scheduler\_event\_recorder.js
@@ -582,7 +582,7 @@ AUI.add(
\_syncInviteesContent(contentNode, calendarResources) {
var values = calendarResources.map(item => {
- return item.name;
+ return Lang.String.escapeHTML(item.name);
});
contentNode = A.one(contentNode);
diff --git a/modules/apps/document-library-opener/document-library-opener-google-drive-web/src/main/java/com/liferay/document/library/opener/google/drive/web/internal/display/context/DLOpenerGoogleDriveDLViewFileVersionDisplayContext.java b/modules/apps/document-library-opener/document-library-opener-google-drive-web/src/main/java/com/liferay/document/library/opener/google/drive/web/internal/display/context/DLOpenerGoogleDriveDLViewFileVersionDisplayContext.java
index ddc3f70357de0d..828c3c96cdce96 100644
--- a/modules/apps/document-library-opener/document-library-opener-google-drive-web/src/main/java/com/liferay/document/library/opener/google/drive/web/internal/display/context/DLOpenerGoogleDriveDLViewFileVersionDisplayContext.java
+++ b/modules/apps/document-library-opener/document-library-opener-google-drive-web/src/main/java/com/liferay/document/library/opener/google/drive/web/internal/display/context/DLOpenerGoogleDriveDLViewFileVersionDisplayContext.java
@@ -42,6 +42,7 @@
import com.liferay.portal.kernel.servlet.taglib.ui.URLMenuItem;
import com.liferay.portal.kernel.theme.ThemeDisplay;
import com.liferay.portal.kernel.util.Constants;
+import com.liferay.portal.kernel.util.HtmlUtil;
import com.liferay.portal.kernel.util.JavaConstants;
import com.liferay.portal.kernel.util.Portal;
import com.liferay.portal.kernel.util.PortalUtil;
@@ -269,13 +270,17 @@ private void \_updateCancelCheckoutAndCheckinMenuItems(
javaScriptUIItem.setOnClick(
StringBundler.concat(
"window.location.href = '",
- \_getActionURL(Constants.CHECKIN), "'"));
+ HtmlUtil.escapeJS(
+ \_getActionURL(Constants.CHECKIN)),
+ "'"));
}
else {
javaScriptUIItem.setOnClick(
StringBundler.concat(
\_getNamespace(), "showVersionDetailsDialog('",
- \_getActionURL(Constants.CHECKIN), "');"));
+ HtmlUtil.escapeJS(
+ \_getActionURL(Constants.CHECKIN)),
+ "');"));
}
}
}
diff --git a/modules/apps/document-library/document-library-service/src/main/java/com/liferay/document/library/internal/util/DLValidatorImpl.java b/modules/apps/document-library/document-library-service/src/main/java/com/liferay/document/library/internal/util/DLValidatorImpl.java
index 5c17dcf2b2dc90..d43a849c80f736 100644
--- a/modules/apps/document-library/document-library-service/src/main/java/com/liferay/document/library/internal/util/DLValidatorImpl.java
+++ b/modules/apps/document-library/document-library-service/src/main/java/com/liferay/document/library/internal/util/DLValidatorImpl.java
@@ -23,6 +23,7 @@
import com.liferay.document.library.kernel.exception.SourceFileNameException;
import com.liferay.document.library.kernel.util.DLUtil;
import com.liferay.document.library.kernel.util.DLValidator;
+import com.liferay.petra.string.CharPool;
import com.liferay.petra.string.StringBundler;
import com.liferay.petra.string.StringPool;
import com.liferay.portal.configuration.metatype.bnd.util.ConfigurableUtil;
@@ -141,11 +142,17 @@ public void validateFileExtension(String fileName)
boolean validFileExtension = false;
- String[] fileExtensions = \_dlConfiguration.fileExtensions();
+ for (String fileExtension : \_dlConfiguration.fileExtensions()) {
+ String fileNameExtension = StringUtil.toLowerCase(
+ FileUtil.getExtension(fileName));
- for (String fileExtension : fileExtensions) {
if (StringPool.STAR.equals(fileExtension) ||
- StringUtil.endsWith(fileName, fileExtension)) {
+ StringUtil.equals(
+ fileNameExtension,
+ StringUtil.toLowerCase(
+ StringUtil.replace(
+ fileExtension, CharPool.PERIOD,
+ StringPool.BLANK)))) {
validFileExtension = true;
@@ -263,6 +270,10 @@ protected void activate(Map properties) {
DLConfiguration.class, properties);
}
+ protected void setDLConfiguration(DLConfiguration dlConfiguration) {
+ \_dlConfiguration = dlConfiguration;
+ }
+
private String \_replaceDLCharLastBlacklist(String title) {
String previousTitle = null;
diff --git a/modules/apps/document-library/document-library-service/src/test/java/com/liferay/document/library/internal/util/DLValidatorImplTest.java b/modules/apps/document-library/document-library-service/src/test/java/com/liferay/document/library/internal/util/DLValidatorImplTest.java
new file mode 100644
index 00000000000000..ce8e9e0ca863ad
--- /dev/null
+++ b/modules/apps/document-library/document-library-service/src/test/java/com/liferay/document/library/internal/util/DLValidatorImplTest.java
@@ -0,0 +1,91 @@
+/\*\*
+ \* Copyright (c) 2000-present Liferay, Inc. All rights reserved.
+ \*
+ \* This library is free software; you can redistribute it and/or modify it under
+ \* the terms of the GNU Lesser General Public License as published by the Free
+ \* Software Foundation; either version 2.1 of the License, or (at your option)
+ \* any later version.
+ \*
+ \* This library is distributed in the hope that it will be useful, but WITHOUT
+ \* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
+ \* FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
+ \* details.
+ \*/
+
+package com.liferay.document.library.internal.util;
+
+import com.liferay.document.library.configuration.DLConfiguration;
+import com.liferay.document.library.kernel.exception.FileExtensionException;
+import com.liferay.document.library.kernel.util.DLValidator;
+import com.liferay.portal.kernel.util.FileUtil;
+import com.liferay.portal.util.FileImpl;
+
+import org.junit.Before;
+import org.junit.Test;
+
+import org.mockito.Mockito;
+
+/\*\*
+ \* @author Adolfo Prez
+ \*/
+public class DLValidatorImplTest {
+
+ @Before
+ public void setUp() {
+ DLValidatorImpl dlValidatorImpl = new DLValidatorImpl();
+
+ \_dlConfiguration = Mockito.mock(DLConfiguration.class);
+
+ dlValidatorImpl.setDLConfiguration(\_dlConfiguration);
+
+ \_dlValidator = dlValidatorImpl;
+
+ FileUtil fileUtil = new FileUtil();
+
+ fileUtil.setFile(FileImpl.getInstance());
+ }
+
+ @Test(expected = FileExtensionException.class)
+ public void testInvalidExtension() throws Exception {
+ \_validateFileExtension("test.gf");
+ }
+
+ @Test
+ public void testValidLowerCaseExtension() throws Exception {
+ \_validateFileExtension("test.gif");
+ }
+
+ @Test
+ public void testValidMixedCaseExtension() throws Exception {
+ \_validateFileExtension("test.GiF");
+ }
+
+ @Test
+ public void testValidUpperCaseExtension() throws Exception {
+ \_validateFileExtension("test.GIF");
+ }
+
+ private void \_validateFileExtension(String fileName)
+ throws FileExtensionException {
+
+ Mockito.when(
+ \_dlConfiguration.fileExtensions()
+ ).thenReturn(
+ new String[] {".gif"}
+ );
+
+ \_dlValidator.validateFileExtension(fileName);
+
+ Mockito.when(
+ \_dlConfiguration.fileExtensions()
+ ).thenReturn(
+ new String[] {"gif"}
+ );
+
+ \_dlValidator.validateFileExtension(fileName);
+ }
+
+ private DLConfiguration \_dlConfiguration;
+ private DLValidator \_dlValidator;
+
+}
\ No newline at end of file
diff --git a/modules/apps/document-library/document-library-web/src/main/java/com/liferay/document/library/web/internal/display/context/logic/UIItemsBuilder.java b/modules/apps/document-library/document-library-web/src/main/java/com/liferay/document/library/web/internal/display/context/logic/UIItemsBuilder.java
index 287d57115fa186..b379df6b9be058 100644
--- a/modules/apps/document-library/document-library-web/src/main/java/com/liferay/document/library/web/internal/display/context/logic/UIItemsBuilder.java
+++ b/modules/apps/document-library/document-library-web/src/main/java/com/liferay/document/library/web/internal/display/context/logic/UIItemsBuilder.java
@@ -190,8 +190,8 @@ public void addCheckinToolbarItem(List toolbarItems)
new JavaScriptToolbarItem(), toolbarItems, DLUIItemKeys.CHECKIN,
LanguageUtil.get(\_resourceBundle, "checkin"),
StringBundler.concat(
- getNamespace(), "showVersionDetailsDialog('", portletURL,
- "');"));
+ getNamespace(), "showVersionDetailsDialog('",
+ HtmlUtil.escapeJS(portletURL.toString()), "');"));
String javaScript =
"/com/liferay/document/library/web/display/context/dependencies" +
@@ -290,7 +290,7 @@ public void addCompareToMenuItem(List menuItems)
sb.append(jsNamespace);
sb.append("compareVersionDialog('");
- sb.append(selectFileVersionURL.toString());
+ sb.append(HtmlUtil.escapeJS(selectFileVersionURL.toString()));
sb.append("');");
JavaScriptMenuItem javaScriptMenuItem = \_addJavaScriptUIItem(
@@ -634,7 +634,8 @@ public void addOpenInMsOfficeMenuItem(List menuItems)
true);
String onClick = StringBundler.concat(
- getNamespace(), "openDocument('", webDavURL, "');");
+ getNamespace(), "openDocument('", HtmlUtil.escapeJS(webDavURL),
+ "');");
JavaScriptMenuItem javaScriptMenuItem = \_addJavaScriptUIItem(
new JavaScriptMenuItem(), menuItems, DLUIItemKeys.OPEN\_IN\_MS\_OFFICE,
@@ -683,7 +684,7 @@ public void addOpenInMsOfficeToolbarItem(List toolbarItems)
sb.append(getNamespace());
sb.append("openDocument('");
- sb.append(webDavURL);
+ sb.append(HtmlUtil.escapeJS(webDavURL));
sb.append("');");
\_addJavaScriptUIItem(
@@ -763,7 +764,7 @@ public void addPermissionsToolbarItem(List toolbarItems)
sb.append("'dialog-with-footer'}, title: '");
sb.append(UnicodeLanguageUtil.get(\_resourceBundle, "permissions"));
sb.append("', uri: '");
- sb.append(permissionsURL);
+ sb.append(HtmlUtil.escapeJS(permissionsURL));
sb.append("'});");
\_addJavaScriptUIItem(
@@ -932,8 +933,8 @@ public MenuItem getCheckinMenuItem() throws PortalException {
javaScriptMenuItem.setLabel("checkin");
javaScriptMenuItem.setOnClick(
StringBundler.concat(
- getNamespace(), "showVersionDetailsDialog('", portletURL,
- "');"));
+ getNamespace(), "showVersionDetailsDialog('",
+ HtmlUtil.escapeJS(portletURL.toString()), "');"));
String javaScript =
"/com/liferay/document/library/web/display/context/dependencies" +
@@ -994,7 +995,7 @@ protected String getSubmitFormJavaScript(String cmd, String redirect) {
sb.append("fm.");
sb.append(getNamespace());
sb.append("redirect.value = '");
- sb.append(redirect);
+ sb.append(HtmlUtil.escapeJS(redirect));
sb.append("';");
}
diff --git a/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/search\_resources.jsp b/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/search\_resources.jsp
index e88a51062f7172..0d9d3bc5e2c3e6 100644
--- a/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/search\_resources.jsp
+++ b/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/search\_resources.jsp
@@ -64,7 +64,7 @@ entriesChecker.setRememberCheckBoxStateURLRegex("^(?!.\*" + liferayPortletRespons
 search(
long companyId, long[] groupIds, String keywords, int start, int end,
OrderByComparator orderByComparator) {
- return ddmDataProviderInstanceFinder.filterByKeywords(
- companyId, groupIds, keywords, start, end, orderByComparator);
+ List ddmDataProviderInstances =
+ ddmDataProviderInstanceFinder.filterByKeywords(
+ companyId, groupIds, keywords, start, end, orderByComparator);
+
+ Stream ddmDataProviderInstanceStream =
+ ddmDataProviderInstances.stream();
+
+ return ddmDataProviderInstanceStream.filter(
+ ddmDataProviderInstance -> {
+ try {
+ return \_ddmDataProviderInstanceModelResourcePermission.
+ contains(
+ getPermissionChecker(),
+ ddmDataProviderInstance.getDataProviderInstanceId(),
+ ActionKeys.VIEW);
+ }
+ catch (PortalException portalException) {
+ \_log.error(portalException, portalException);
+
+ return false;
+ }
+ }
+ ).map(
+ ddmDataProviderInstance -> \_removeAuthenticationData(
+ ddmDataProviderInstance)
+ ).collect(
+ Collectors.toList()
+ );
}
@Override
@@ -205,12 +240,77 @@ public DDMDataProviderInstance updateDataProviderInstance(
ddmFormValues, serviceContext);
}
+ @Reference(unbind = "-")
+ protected void setJSONFactory(JSONFactory jsonFactory) {
+ \_jsonFactory = jsonFactory;
+ }
+
+ private JSONArray \_filterFieldValues(JSONArray fieldValuesJSONArray) {
+ JSONArray filteredFieldValuesJSONArray = \_jsonFactory.createJSONArray();
+
+ Iterator iterator = fieldValuesJSONArray.iterator();
+
+ while (iterator.hasNext()) {
+ JSONObject fieldValueJSONObject = (JSONObject)iterator.next();
+
+ String fieldValueName = fieldValueJSONObject.getString("name");
+
+ if (StringUtil.equals(fieldValueName, "password") ||
+ StringUtil.equals(fieldValueName, "username")) {
+
+ continue;
+ }
+
+ filteredFieldValuesJSONArray.put(fieldValueJSONObject);
+ }
+
+ return filteredFieldValuesJSONArray;
+ }
+
+ private DDMDataProviderInstance \_removeAuthenticationData(
+ DDMDataProviderInstance ddmDataProviderInstance) {
+
+ try {
+ JSONObject definitionJSONObject = \_jsonFactory.createJSONObject(
+ ddmDataProviderInstance.getDefinition());
+
+ if (!definitionJSONObject.has("fieldValues")) {
+ return ddmDataProviderInstance;
+ }
+
+ JSONArray fieldValuesJSONArray = definitionJSONObject.getJSONArray(
+ "fieldValues");
+
+ definitionJSONObject.put(
+ "fieldValues", \_filterFieldValues(fieldValuesJSONArray));
+
+ ddmDataProviderInstance.setDefinition(
+ definitionJSONObject.toJSONString());
+ }
+ catch (Exception exception) {
+ if (\_log.isWarnEnabled()) {
+ \_log.warn(
+ "Unable to remove authentication data from data " +
+ "providers search",
+ exception);
+ }
+ }
+
+ return ddmDataProviderInstance;
+ }
+
+ private static final Log \_log = LogFactoryUtil.getLog(
+ DDMDataProviderInstanceServiceImpl.class);
+
@Reference(
target = "(model.class.name=com.liferay.dynamic.data.mapping.model.DDMDataProviderInstance)"
)
private ModelResourcePermission
\_ddmDataProviderInstanceModelResourcePermission;
+ @Reference
+ private JSONFactory \_jsonFactory;
+
@Reference(target = "(resource.name=" + DDMConstants.RESOURCE\_NAME + ")")
private PortletResourcePermission \_portletResourcePermission;
diff --git a/modules/apps/flags/flags-api/src/main/java/com/liferay/flags/service/FlagsEntryService.java b/modules/apps/flags/flags-api/src/main/java/com/liferay/flags/service/FlagsEntryService.java
index 9f362fdcf6ddcf..4e91932a8dcb56 100644
--- a/modules/apps/flags/flags-api/src/main/java/com/liferay/flags/service/FlagsEntryService.java
+++ b/modules/apps/flags/flags-api/src/main/java/com/liferay/flags/service/FlagsEntryService.java
@@ -17,6 +17,7 @@
import com.liferay.portal.kernel.exception.PortalException;
import com.liferay.portal.kernel.exception.SystemException;
import com.liferay.portal.kernel.jsonwebservice.JSONWebService;
+import com.liferay.portal.kernel.jsonwebservice.JSONWebServiceMode;
import com.liferay.portal.kernel.security.access.control.AccessControlled;
import com.liferay.portal.kernel.service.BaseService;
import com.liferay.portal.kernel.service.ServiceContext;
@@ -48,6 +49,7 @@ public interface FlagsEntryService extends BaseService {
\*
\* Never modify or reference this interface directly. Always use {@link FlagsEntryServiceUtil} to access the flags entry remote service. Add custom service methods to `com.liferay.flags.service.impl.FlagsEntryServiceImpl` and rerun ServiceBuilder to automatically copy the method declarations to this interface.
\*/
+ @JSONWebService(mode = JSONWebServiceMode.IGNORE)
public void addEntry(
String className, long classPK, String reporterEmailAddress,
long reportedUserId, String contentTitle, String contentURL,
diff --git a/modules/apps/flags/flags-service/src/main/java/com/liferay/flags/internal/messaging/FlagsRequestMessageListener.java b/modules/apps/flags/flags-service/src/main/java/com/liferay/flags/internal/messaging/FlagsRequestMessageListener.java
index 2d7838c106c5c2..75e0de39c05baa 100644
--- a/modules/apps/flags/flags-service/src/main/java/com/liferay/flags/internal/messaging/FlagsRequestMessageListener.java
+++ b/modules/apps/flags/flags-service/src/main/java/com/liferay/flags/internal/messaging/FlagsRequestMessageListener.java
@@ -261,16 +261,13 @@ protected void notify(
subscriptionSender.setBody(body);
subscriptionSender.setCompanyId(company.getCompanyId());
subscriptionSender.setContextAttributes(
- "[$CONTENT\_ID$]", contentId, "[$CONTENT\_TYPE$]", contentType,
+ "[$CONTENT\_ID$]", contentId, "[$CONTENT\_TITLE$]", contentTitle,
+ "[$CONTENT\_TYPE$]", contentType, "[$CONTENT\_URL$]", contentURL,
"[$DATE$]", now.toString(), "[$REASON$]", reason,
"[$REPORTED\_USER\_ADDRESS$]", reportedEmailAddress,
"[$REPORTED\_USER\_NAME$]", reportedUserName, "[$REPORTED\_USER\_URL$]",
reportedUserURL, "[$REPORTER\_USER\_ADDRESS$]", reporterEmailAddress,
"[$REPORTER\_USER\_NAME$]", reporterUserName);
- subscriptionSender.setContextAttribute(
- "[$CONTENT\_TITLE$]", contentTitle, false);
- subscriptionSender.setContextAttribute(
- "[$CONTENT\_URL$]", contentURL, false);
subscriptionSender.setCreatorUserId(reporterUserId);
subscriptionSender.setFrom(fromAddress, fromName);
subscriptionSender.setHtmlFormat(true);
diff --git a/modules/apps/flags/flags-service/src/main/java/com/liferay/flags/service/impl/FlagsEntryServiceImpl.java b/modules/apps/flags/flags-service/src/main/java/com/liferay/flags/service/impl/FlagsEntryServiceImpl.java
index 1ea8b441a596f3..def5872766a277 100644
--- a/modules/apps/flags/flags-service/src/main/java/com/liferay/flags/service/impl/FlagsEntryServiceImpl.java
+++ b/modules/apps/flags/flags-service/src/main/java/com/liferay/flags/service/impl/FlagsEntryServiceImpl.java
@@ -19,6 +19,8 @@
import com.liferay.portal.aop.AopService;
import com.liferay.portal.kernel.exception.EmailAddressException;
import com.liferay.portal.kernel.exception.PortalException;
+import com.liferay.portal.kernel.jsonwebservice.JSONWebService;
+import com.liferay.portal.kernel.jsonwebservice.JSONWebServiceMode;
import com.liferay.portal.kernel.messaging.DestinationNames;
import com.liferay.portal.kernel.messaging.Message;
import com.liferay.portal.kernel.messaging.MessageBus;
@@ -40,6 +42,7 @@
)
public class FlagsEntryServiceImpl extends FlagsEntryServiceBaseImpl {
+ @JSONWebService(mode = JSONWebServiceMode.IGNORE)
@Override
public void addEntry(
String className, long classPK, String reporterEmailAddress,
diff --git a/modules/apps/fragment/fragment-entry-processor/fragment-entry-processor-freemarker/build.gradle b/modules/apps/fragment/fragment-entry-processor/fragment-entry-processor-freemarker/build.gradle
index 6c25f3a91e87f4..43753e315ff386 100644
--- a/modules/apps/fragment/fragment-entry-processor/fragment-entry-processor-freemarker/build.gradle
+++ b/modules/apps/fragment/fragment-entry-processor/fragment-entry-processor-freemarker/build.gradle
@@ -4,7 +4,7 @@ dependencies {
compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.configuration.metatype.api", version: "2.0.0"
compileOnly group: "com.liferay", name: "com.liferay.segments.api", version: "1.9.0"
- compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "4.34.0"
+ compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "default"
compileOnly group: "org.apache.felix", name: "org.apache.felix.http.servlet-api", version: "1.1.2"
compileOnly group: "org.osgi", name: "org.osgi.service.component.annotations", version: "1.3.0"
}
\ No newline at end of file
diff --git a/modules/apps/fragment/fragment-entry-processor/fragment-entry-processor-freemarker/src/main/java/com/liferay/fragment/entry/processor/freemarker/FreeMarkerFragmentEntryProcessor.java b/modules/apps/fragment/fragment-entry-processor/fragment-entry-processor-freemarker/src/main/java/com/liferay/fragment/entry/processor/freemarker/FreeMarkerFragmentEntryProcessor.java
index 548fbe76e0b81a..0ecaedb81aca13 100644
--- a/modules/apps/fragment/fragment-entry-processor/fragment-entry-processor-freemarker/src/main/java/com/liferay/fragment/entry/processor/freemarker/FreeMarkerFragmentEntryProcessor.java
+++ b/modules/apps/fragment/fragment-entry-processor/fragment-entry-processor-freemarker/src/main/java/com/liferay/fragment/entry/processor/freemarker/FreeMarkerFragmentEntryProcessor.java
@@ -36,7 +36,6 @@
import com.liferay.portal.kernel.template.Template;
import com.liferay.portal.kernel.template.TemplateConstants;
import com.liferay.portal.kernel.template.TemplateException;
-import com.liferay.portal.kernel.template.TemplateManager;
import com.liferay.portal.kernel.template.TemplateManagerUtil;
import com.liferay.portal.kernel.util.ResourceBundleUtil;
import com.liferay.portal.kernel.util.Validator;
@@ -113,10 +112,6 @@ public String processFragmentEntryLinkHTML(
template.put(TemplateConstants.WRITER, unsyncStringWriter);
- TemplateManager templateManager =
- TemplateManagerUtil.getTemplateManager(
- TemplateConstants.LANG\_TYPE\_FTL);
-
Map contextObjects = new HashMap<>();
JSONObject configurationValuesJSONObject =
@@ -135,10 +130,10 @@ public String processFragmentEntryLinkHTML(
configurationValuesJSONObject,
fragmentEntryLink.getConfiguration()));
- templateManager.addContextObjects(template, contextObjects);
+ template.putAll(contextObjects);
- templateManager.addTaglibSupport(
- template, fragmentEntryProcessorContext.getHttpServletRequest(),
+ template.prepareTaglib(
+ fragmentEntryProcessorContext.getHttpServletRequest(),
fragmentEntryProcessorContext.getHttpServletResponse());
template.prepare(fragmentEntryProcessorContext.getHttpServletRequest());
@@ -187,10 +182,6 @@ public void validateFragmentEntryHTML(String html, String configuration)
(httpServletRequest.getAttribute(WebKeys.THEME\_DISPLAY) !=
null)) {
- TemplateManager templateManager =
- TemplateManagerUtil.getTemplateManager(
- TemplateConstants.LANG\_TYPE\_FTL);
-
Map contextObjects = new HashMap<>();
JSONObject configurationDefaultValuesJSONObject =
@@ -207,10 +198,9 @@ public void validateFragmentEntryHTML(String html, String configuration)
FragmentEntryConfigUtil.getContextObjects(
configurationDefaultValuesJSONObject, configuration));
- templateManager.addContextObjects(template, contextObjects);
+ template.putAll(contextObjects);
- templateManager.addTaglibSupport(
- template, httpServletRequest, httpServletResponse);
+ template.prepareTaglib(httpServletRequest, httpServletResponse);
template.prepare(httpServletRequest);
diff --git a/modules/apps/fragment/fragment-entry-processor/fragment-entry-processor-impl/build.gradle b/modules/apps/fragment/fragment-entry-processor/fragment-entry-processor-impl/build.gradle
index 6f15ae86edc10f..7efc079762d6ee 100644
--- a/modules/apps/fragment/fragment-entry-processor/fragment-entry-processor-impl/build.gradle
+++ b/modules/apps/fragment/fragment-entry-processor/fragment-entry-processor-impl/build.gradle
@@ -6,7 +6,7 @@ dependencies {
compileOnly group: "com.liferay", name: "com.liferay.info.api", version: "4.1.0"
compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.segments.api", version: "1.9.0"
- compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "4.34.0"
+ compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "default"
compileOnly group: "javax.portlet", name: "portlet-api", version: "3.0.1"
compileOnly group: "org.apache.felix", name: "org.apache.felix.http.servlet-api", version: "1.1.2"
compileOnly group: "org.jsoup", name: "jsoup", version: "1.10.2"
diff --git a/modules/apps/fragment/fragment-entry-processor/fragment-entry-processor-impl/src/main/java/com/liferay/fragment/entry/processor/internal/util/FragmentEntryProcessorHelperImpl.java b/modules/apps/fragment/fragment-entry-processor/fragment-entry-processor-impl/src/main/java/com/liferay/fragment/entry/processor/internal/util/FragmentEntryProcessorHelperImpl.java
index 8d29e9286773ba..84cde9219a1fb6 100644
--- a/modules/apps/fragment/fragment-entry-processor/fragment-entry-processor-impl/src/main/java/com/liferay/fragment/entry/processor/internal/util/FragmentEntryProcessorHelperImpl.java
+++ b/modules/apps/fragment/fragment-entry-processor/fragment-entry-processor-impl/src/main/java/com/liferay/fragment/entry/processor/internal/util/FragmentEntryProcessorHelperImpl.java
@@ -34,7 +34,6 @@
import com.liferay.portal.kernel.template.StringTemplateResource;
import com.liferay.portal.kernel.template.Template;
import com.liferay.portal.kernel.template.TemplateConstants;
-import com.liferay.portal.kernel.template.TemplateManager;
import com.liferay.portal.kernel.template.TemplateManagerUtil;
import com.liferay.portal.kernel.trash.TrashHandler;
import com.liferay.portal.kernel.trash.TrashHandlerRegistryUtil;
@@ -211,15 +210,7 @@ public String processTemplate(
TemplateConstants.LANG\_TYPE\_FTL,
new StringTemplateResource("template\_id", "[#ftl] " + html), true);
- TemplateManager templateManager =
- TemplateManagerUtil.getTemplateManager(
- TemplateConstants.LANG\_TYPE\_FTL);
-
- templateManager.addTaglibSupport(
- template, fragmentEntryProcessorContext.getHttpServletRequest(),
- fragmentEntryProcessorContext.getHttpServletResponse());
- templateManager.addTaglibTheme(
- template, "taglibLiferay",
+ template.prepareTaglib(
fragmentEntryProcessorContext.getHttpServletRequest(),
fragmentEntryProcessorContext.getHttpServletResponse());
diff --git a/modules/apps/fragment/fragment-service/src/main/java/com/liferay/fragment/service/impl/FragmentCollectionLocalServiceImpl.java b/modules/apps/fragment/fragment-service/src/main/java/com/liferay/fragment/service/impl/FragmentCollectionLocalServiceImpl.java
index 802d947dc5e4fa..4defcfae7456fc 100644
--- a/modules/apps/fragment/fragment-service/src/main/java/com/liferay/fragment/service/impl/FragmentCollectionLocalServiceImpl.java
+++ b/modules/apps/fragment/fragment-service/src/main/java/com/liferay/fragment/service/impl/FragmentCollectionLocalServiceImpl.java
@@ -255,6 +255,13 @@ protected void validate(String name) throws PortalException {
if (Validator.isNull(name)) {
throw new FragmentCollectionNameException("Name must not be null");
}
+
+ if (name.contains(StringPool.PERIOD) ||
+ name.contains(StringPool.SLASH)) {
+
+ throw new FragmentCollectionNameException(
+ "Name contains invalid characters");
+ }
}
protected void validateFragmentCollectionKey(
diff --git a/modules/apps/fragment/fragment-service/src/main/java/com/liferay/fragment/service/impl/FragmentEntryLocalServiceImpl.java b/modules/apps/fragment/fragment-service/src/main/java/com/liferay/fragment/service/impl/FragmentEntryLocalServiceImpl.java
index ced4565f09aecc..fe8a1c7f2786a0 100644
--- a/modules/apps/fragment/fragment-service/src/main/java/com/liferay/fragment/service/impl/FragmentEntryLocalServiceImpl.java
+++ b/modules/apps/fragment/fragment-service/src/main/java/com/liferay/fragment/service/impl/FragmentEntryLocalServiceImpl.java
@@ -758,6 +758,13 @@ protected void validate(String name) throws PortalException {
throw new FragmentEntryNameException("Name must not be null");
}
+ if (name.contains(StringPool.PERIOD) ||
+ name.contains(StringPool.SLASH)) {
+
+ throw new FragmentEntryNameException(
+ "Name contains invalid characters");
+ }
+
int nameMaxLength = ModelHintsUtil.getMaxLength(
FragmentEntry.class.getName(), "name");
diff --git a/modules/apps/frontend-image-editor/frontend-image-editor-integration-document-library/src/main/java/com/liferay/frontend/image/editor/integration/document/library/internal/display/context/logic/ImageEditorDLDisplayContextHelper.java b/modules/apps/frontend-image-editor/frontend-image-editor-integration-document-library/src/main/java/com/liferay/frontend/image/editor/integration/document/library/internal/display/context/logic/ImageEditorDLDisplayContextHelper.java
index 00e26f01385c3f..234af99711737c 100644
--- a/modules/apps/frontend-image-editor/frontend-image-editor-integration-document-library/src/main/java/com/liferay/frontend/image/editor/integration/document/library/internal/display/context/logic/ImageEditorDLDisplayContextHelper.java
+++ b/modules/apps/frontend-image-editor/frontend-image-editor-integration-document-library/src/main/java/com/liferay/frontend/image/editor/integration/document/library/internal/display/context/logic/ImageEditorDLDisplayContextHelper.java
@@ -44,6 +44,7 @@
import com.liferay.portal.kernel.theme.PortletDisplay;
import com.liferay.portal.kernel.theme.ThemeDisplay;
import com.liferay.portal.kernel.util.ArrayUtil;
+import com.liferay.portal.kernel.util.HtmlUtil;
import com.liferay.portal.kernel.util.JavaConstants;
import com.liferay.portal.kernel.util.PortalUtil;
import com.liferay.portal.kernel.util.WebKeys;
@@ -241,15 +242,15 @@ private String \_getOnclickMethod() {
sb.append(liferayPortletResponse.getNamespace());
sb.append("editWithImageEditor('");
- sb.append(imageEditorURL.toString());
+ sb.append(HtmlUtil.escapeJS(imageEditorURL.toString()));
sb.append("', '");
- sb.append(editURL.toString());
+ sb.append(HtmlUtil.escapeJS(editURL.toString()));
sb.append("', '");
- sb.append(\_fileEntry.getFileName());
+ sb.append(HtmlUtil.escapeJS(\_fileEntry.getFileName()));
sb.append("', '");
- sb.append(fileEntryPreviewURL);
+ sb.append(HtmlUtil.escapeJS(fileEntryPreviewURL));
sb.append("', '");
- sb.append(\_fileEntry.getMimeType());
+ sb.append(HtmlUtil.escapeJS(\_fileEntry.getMimeType()));
sb.append("');");
return sb.toString();
diff --git a/modules/apps/journal/journal-service/build.gradle b/modules/apps/journal/journal-service/build.gradle
index 67b399ef989bbf..6a360bd54ec510 100644
--- a/modules/apps/journal/journal-service/build.gradle
+++ b/modules/apps/journal/journal-service/build.gradle
@@ -41,7 +41,7 @@ dependencies {
compileOnly group: "com.liferay", name: "com.liferay.upload.api", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.xstream.configurator.api", version: "4.0.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "4.0.0"
- compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "4.35.0"
+ compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "default"
compileOnly group: "com.liferay.portal", name: "com.liferay.util.java", version: "4.0.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.util.taglib", version: "4.0.0"
compileOnly group: "commons-lang", name: "commons-lang", version: "2.6"
diff --git a/modules/apps/journal/journal-service/src/main/java/com/liferay/journal/internal/transformer/JournalTransformer.java b/modules/apps/journal/journal-service/src/main/java/com/liferay/journal/internal/transformer/JournalTransformer.java
index 5cf6c625d55afa..2d307a11af1816 100644
--- a/modules/apps/journal/journal-service/src/main/java/com/liferay/journal/internal/transformer/JournalTransformer.java
+++ b/modules/apps/journal/journal-service/src/main/java/com/liferay/journal/internal/transformer/JournalTransformer.java
@@ -39,7 +39,6 @@
import com.liferay.portal.kernel.template.StringTemplateResource;
import com.liferay.portal.kernel.template.Template;
import com.liferay.portal.kernel.template.TemplateConstants;
-import com.liferay.portal.kernel.template.TemplateManager;
import com.liferay.portal.kernel.template.TemplateManagerUtil;
import com.liferay.portal.kernel.template.TemplateResource;
import com.liferay.portal.kernel.templateparser.TemplateNode;
@@ -324,17 +323,8 @@ protected String doTransform(
template.put("viewMode", viewMode);
if (themeDisplay != null) {
- TemplateManager templateManager =
- TemplateManagerUtil.getTemplateManager(langType);
-
- HttpServletRequest httpServletRequest =
- themeDisplay.getRequest();
-
- templateManager.addTaglibSupport(
- template, httpServletRequest,
- themeDisplay.getResponse());
- templateManager.addTaglibTheme(
- template, "taglibLiferay", httpServletRequest,
+ template.prepareTaglib(
+ themeDisplay.getRequest(),
new PipingServletResponse(
themeDisplay.getResponse(), unsyncStringWriter));
}
diff --git a/modules/apps/journal/journal-service/src/main/java/com/liferay/journal/internal/util/JournalUtil.java b/modules/apps/journal/journal-service/src/main/java/com/liferay/journal/internal/util/JournalUtil.java
index f39f3e5ee470b5..f894b34214419f 100644
--- a/modules/apps/journal/journal-service/src/main/java/com/liferay/journal/internal/util/JournalUtil.java
+++ b/modules/apps/journal/journal-service/src/main/java/com/liferay/journal/internal/util/JournalUtil.java
@@ -47,8 +47,6 @@
import com.liferay.portal.kernel.service.UserLocalServiceUtil;
import com.liferay.portal.kernel.template.TemplateHandler;
import com.liferay.portal.kernel.template.TemplateHandlerRegistryUtil;
-import com.liferay.portal.kernel.template.TemplateManager;
-import com.liferay.portal.kernel.template.TemplateManagerUtil;
import com.liferay.portal.kernel.templateparser.TransformerListener;
import com.liferay.portal.kernel.theme.ThemeDisplay;
import com.liferay.portal.kernel.util.FriendlyURLNormalizerUtil;
@@ -376,17 +374,13 @@ public static String transform(
String langType, boolean propagateException)
throws Exception {
- TemplateManager templateManager =
- TemplateManagerUtil.getTemplateManager(langType);
-
TemplateHandler templateHandler =
TemplateHandlerRegistryUtil.getTemplateHandler(
JournalArticle.class.getName());
Map contextObjects = new HashMap<>();
- templateManager.addContextObjects(
- contextObjects, templateHandler.getCustomContextObjects());
+ contextObjects.putAll(templateHandler.getCustomContextObjects());
return \_journalTransformer.transform(
themeDisplay, contextObjects, tokens, viewMode, languageId,
diff --git a/modules/apps/polls/polls-web/build.gradle b/modules/apps/polls/polls-web/build.gradle
index e826c4d71f2494..741f5aa0961f22 100644
--- a/modules/apps/polls/polls-web/build.gradle
+++ b/modules/apps/polls/polls-web/build.gradle
@@ -1,6 +1,6 @@
dependencies {
- compileInclude group: "jfree", name: "jcommon", version: "1.0.16"
- compileInclude group: "jfree", name: "jfreechart", version: "1.0.13"
+ compileInclude group: "org.jfree", name: "jcommon", version: "1.0.24"
+ compileInclude group: "org.jfree", name: "jfreechart", version: "1.0.19"
compileOnly group: "com.liferay", name: "com.liferay.application.list.api", version: "4.0.0"
compileOnly group: "com.liferay", name: "com.liferay.frontend.taglib", version: "4.0.0"
diff --git a/modules/apps/portal-cache/portal-cache-api/src/main/java/com/liferay/portal/cache/BasePortalCacheManager.java b/modules/apps/portal-cache/portal-cache-api/src/main/java/com/liferay/portal/cache/BasePortalCacheManager.java
index 5f14377c2f712d..70db6a0bdd1782 100644
--- a/modules/apps/portal-cache/portal-cache-api/src/main/java/com/liferay/portal/cache/BasePortalCacheManager.java
+++ b/modules/apps/portal-cache/portal-cache-api/src/main/java/com/liferay/portal/cache/BasePortalCacheManager.java
@@ -127,22 +127,6 @@ public PortalCache getPortalCache(
portalCache = previousPortalCache;
}
- else if (portalCacheConfiguration != null) {
- Properties portalCacheBootstrapLoaderProperties =
- portalCacheConfiguration.
- getPortalCacheBootstrapLoaderProperties();
-
- if (portalCacheBootstrapLoaderProperties != null) {
- PortalCacheBootstrapLoader portalCacheBootstrapLoader =
- portalCacheBootstrapLoaderFactory.create(
- portalCacheBootstrapLoaderProperties);
-
- if (portalCacheBootstrapLoader != null) {
- portalCacheBootstrapLoader.loadPortalCache(
- getPortalCacheManagerName(), portalCacheName);
- }
- }
- }
return portalCache;
}
diff --git a/modules/apps/portal-cache/portal-cache-api/src/main/java/com/liferay/portal/cache/PortalCacheBootstrapLoader.java b/modules/apps/portal-cache/portal-cache-api/src/main/java/com/liferay/portal/cache/PortalCacheBootstrapLoader.java
index f0d170d666bdfb..126af132892f0b 100644
--- a/modules/apps/portal-cache/portal-cache-api/src/main/java/com/liferay/portal/cache/PortalCacheBootstrapLoader.java
+++ b/modules/apps/portal-cache/portal-cache-api/src/main/java/com/liferay/portal/cache/PortalCacheBootstrapLoader.java
@@ -16,7 +16,9 @@
/\*\*
\* @author Tina Tian
+ \* @deprecated As of Mueller (7.2.x), with no direct replacement
\*/
+@Deprecated
public interface PortalCacheBootstrapLoader {
public static final String BOOTSTRAP\_ASYNCHRONOUSLY =
diff --git a/modules/apps/portal-cache/portal-cache-api/src/main/java/com/liferay/portal/cache/PortalCacheBootstrapLoaderFactory.java b/modules/apps/portal-cache/portal-cache-api/src/main/java/com/liferay/portal/cache/PortalCacheBootstrapLoaderFactory.java
index 0f71d639539592..5d279a86f85c1c 100644
--- a/modules/apps/portal-cache/portal-cache-api/src/main/java/com/liferay/portal/cache/PortalCacheBootstrapLoaderFactory.java
+++ b/modules/apps/portal-cache/portal-cache-api/src/main/java/com/liferay/portal/cache/PortalCacheBootstrapLoaderFactory.java
@@ -18,7 +18,9 @@
/\*\*
\* @author Tina Tian
+ \* @deprecated As of Mueller (7.2.x), with no direct replacement
\*/
+@Deprecated
public interface PortalCacheBootstrapLoaderFactory {
public PortalCacheBootstrapLoader create(Properties properties);
diff --git a/modules/apps/portal-cache/portal-cache-api/src/main/java/com/liferay/portal/cache/configuration/PortalCacheConfiguration.java b/modules/apps/portal-cache/portal-cache-api/src/main/java/com/liferay/portal/cache/configuration/PortalCacheConfiguration.java
index 960e0af412d574..cd67aa8c5402ae 100644
--- a/modules/apps/portal-cache/portal-cache-api/src/main/java/com/liferay/portal/cache/configuration/PortalCacheConfiguration.java
+++ b/modules/apps/portal-cache/portal-cache-api/src/main/java/com/liferay/portal/cache/configuration/PortalCacheConfiguration.java
@@ -62,13 +62,14 @@ public PortalCacheConfiguration(
\_portalCacheListenerPropertiesSet = new HashSet<>(
portalCacheListenerPropertiesSet);
}
-
- \_portalCacheBootstrapLoaderProperties =
- portalCacheBootstrapLoaderProperties;
}
+ /\*\*
+ \* @deprecated As of Mueller (7.2.x), with no direct replacement
+ \*/
+ @Deprecated
public Properties getPortalCacheBootstrapLoaderProperties() {
- return \_portalCacheBootstrapLoaderProperties;
+ return null;
}
public Set getPortalCacheListenerPropertiesSet() {
@@ -83,18 +84,17 @@ public PortalCacheConfiguration newPortalCacheConfiguration(
String portalCacheName) {
return new PortalCacheConfiguration(
- portalCacheName, \_portalCacheListenerPropertiesSet,
- \_portalCacheBootstrapLoaderProperties);
+ portalCacheName, \_portalCacheListenerPropertiesSet, null);
}
+ /\*\*
+ \* @deprecated As of Mueller (7.2.x), with no direct replacement
+ \*/
+ @Deprecated
public void setPortalCacheBootstrapLoaderProperties(
Properties portalCacheBootstrapLoaderProperties) {
-
- \_portalCacheBootstrapLoaderProperties =
- portalCacheBootstrapLoaderProperties;
}
- private Properties \_portalCacheBootstrapLoaderProperties;
private final Set \_portalCacheListenerPropertiesSet;
private final String \_portalCacheName;
diff --git a/modules/apps/portal-cache/portal-cache-ehcache-impl/src/main/java/com/liferay/portal/cache/ehcache/internal/EhcachePortalCacheConfiguration.java b/modules/apps/portal-cache/portal-cache-ehcache-impl/src/main/java/com/liferay/portal/cache/ehcache/internal/EhcachePortalCacheConfiguration.java
index 43059a3bec3a98..f9db5c31fbe62d 100644
--- a/modules/apps/portal-cache/portal-cache-ehcache-impl/src/main/java/com/liferay/portal/cache/ehcache/internal/EhcachePortalCacheConfiguration.java
+++ b/modules/apps/portal-cache/portal-cache-ehcache-impl/src/main/java/com/liferay/portal/cache/ehcache/internal/EhcachePortalCacheConfiguration.java
@@ -30,9 +30,7 @@ public EhcachePortalCacheConfiguration(
Properties portalCacheBootstrapLoaderProperties,
boolean requireSerialization) {
- super(
- portalCacheName, portalCacheListenerPropertiesSet,
- portalCacheBootstrapLoaderProperties);
+ super(portalCacheName, portalCacheListenerPropertiesSet, null);
\_requireSerialization = requireSerialization;
}
@@ -46,8 +44,8 @@ public PortalCacheConfiguration newPortalCacheConfiguration(
String portalCacheName) {
return new EhcachePortalCacheConfiguration(
- portalCacheName, getPortalCacheListenerPropertiesSet(),
- getPortalCacheBootstrapLoaderProperties(), \_requireSerialization);
+ portalCacheName, getPortalCacheListenerPropertiesSet(), null,
+ \_requireSerialization);
}
private final boolean \_requireSerialization;
diff --git a/modules/apps/portal-cache/portal-cache-ehcache-impl/src/main/java/com/liferay/portal/cache/ehcache/internal/MultiVMEhcachePortalCacheManager.java b/modules/apps/portal-cache/portal-cache-ehcache-impl/src/main/java/com/liferay/portal/cache/ehcache/internal/MultiVMEhcachePortalCacheManager.java
index f69f1bce6535f0..71be4242867787 100644
--- a/modules/apps/portal-cache/portal-cache-ehcache-impl/src/main/java/com/liferay/portal/cache/ehcache/internal/MultiVMEhcachePortalCacheManager.java
+++ b/modules/apps/portal-cache/portal-cache-ehcache-impl/src/main/java/com/liferay/portal/cache/ehcache/internal/MultiVMEhcachePortalCacheManager.java
@@ -14,7 +14,6 @@
package com.liferay.portal.cache.ehcache.internal;
-import com.liferay.portal.cache.PortalCacheBootstrapLoaderFactory;
import com.liferay.portal.cache.PortalCacheListenerFactory;
import com.liferay.portal.cache.PortalCacheManagerListenerFactory;
import com.liferay.portal.cache.ehcache.internal.configurator.MultiVMEhcachePortalCacheManagerConfigurator;
@@ -76,14 +75,6 @@ protected void setMultiVMEhcachePortalCacheManagerConfigurator(
multiVMEhcachePortalCacheManagerConfigurator;
}
- @Reference(unbind = "-")
- protected void setPortalCacheBootstrapLoaderFactory(
- PortalCacheBootstrapLoaderFactory portalCacheBootstrapLoaderFactory) {
-
- this.portalCacheBootstrapLoaderFactory =
- portalCacheBootstrapLoaderFactory;
- }
-
@Reference(unbind = "-")
protected void setPortalCacheListenerFactory(
PortalCacheListenerFactory portalCacheListenerFactory) {
diff --git a/modules/apps/portal-cache/portal-cache-ehcache-impl/src/main/java/com/liferay/portal/cache/ehcache/internal/configurator/BaseEhcachePortalCacheManagerConfigurator.java b/modules/apps/portal-cache/portal-cache-ehcache-impl/src/main/java/com/liferay/portal/cache/ehcache/internal/configurator/BaseEhcachePortalCacheManagerConfigurator.java
index ed67a0f83ccfe4..0691db4e72084c 100644
--- a/modules/apps/portal-cache/portal-cache-ehcache-impl/src/main/java/com/liferay/portal/cache/ehcache/internal/configurator/BaseEhcachePortalCacheManagerConfigurator.java
+++ b/modules/apps/portal-cache/portal-cache-ehcache-impl/src/main/java/com/liferay/portal/cache/ehcache/internal/configurator/BaseEhcachePortalCacheManagerConfigurator.java
@@ -83,8 +83,6 @@ protected void clearListenerConfigrations(
return;
}
- cacheConfiguration.bootstrapCacheLoaderFactory(null);
-
List  factoryConfigurations =
cacheConfiguration.getCacheEventListenerConfigurations();
diff --git a/modules/apps/portal-cache/portal-cache-ehcache-impl/src/main/java/com/liferay/portal/cache/ehcache/internal/configurator/MultiVMEhcachePortalCacheManagerConfigurator.java b/modules/apps/portal-cache/portal-cache-ehcache-impl/src/main/java/com/liferay/portal/cache/ehcache/internal/configurator/MultiVMEhcachePortalCacheManagerConfigurator.java
index 67d3ecbcf3c171..17095a1c363e0c 100644
--- a/modules/apps/portal-cache/portal-cache-ehcache-impl/src/main/java/com/liferay/portal/cache/ehcache/internal/configurator/MultiVMEhcachePortalCacheManagerConfigurator.java
+++ b/modules/apps/portal-cache/portal-cache-ehcache-impl/src/main/java/com/liferay/portal/cache/ehcache/internal/configurator/MultiVMEhcachePortalCacheManagerConfigurator.java
@@ -50,16 +50,8 @@ public class MultiVMEhcachePortalCacheManagerConfigurator
@Activate
protected void activate() {
- \_bootstrapLoaderEnabled = GetterUtil.getBoolean(
- props.get(PropsKeys.EHCACHE\_BOOTSTRAP\_CACHE\_LOADER\_ENABLED));
- \_bootstrapLoaderProperties = props.getProperties(
- PropsKeys.EHCACHE\_BOOTSTRAP\_CACHE\_LOADER\_PROPERTIES +
- StringPool.PERIOD,
- true);
clusterEnabled = GetterUtil.getBoolean(
props.get(PropsKeys.CLUSTER\_LINK\_ENABLED));
- \_defaultBootstrapLoaderPropertiesString = getPortalPropertiesString(
- PropsKeys.EHCACHE\_BOOTSTRAP\_CACHE\_LOADER\_PROPERTIES\_DEFAULT);
\_defaultReplicatorPropertiesString = getPortalPropertiesString(
PropsKeys.EHCACHE\_REPLICATOR\_PROPERTIES\_DEFAULT);
\_replicatorProperties = props.getProperties(
@@ -137,12 +129,6 @@ protected void manageConfiguration(
ObjectValuePair propertiesPair =
entry.getValue();
- if (\_bootstrapLoaderEnabled && (propertiesPair.getKey() != null)) {
- portalCacheConfiguration.
- setPortalCacheBootstrapLoaderProperties(
- propertiesPair.getKey());
- }
-
if (propertiesPair.getValue() != null) {
Set portalCacheListenerPropertiesSet =
portalCacheConfiguration.
@@ -181,20 +167,6 @@ protected PortalCacheConfiguration parseCacheListenerConfigurations(
String cacheName = cacheConfiguration.getName();
- if (\_bootstrapLoaderEnabled) {
- String bootstrapLoaderPropertiesString =
- (String)\_bootstrapLoaderProperties.remove(cacheName);
-
- if (Validator.isNull(bootstrapLoaderPropertiesString)) {
- bootstrapLoaderPropertiesString =
- \_defaultBootstrapLoaderPropertiesString;
- }
-
- portalCacheConfiguration.setPortalCacheBootstrapLoaderProperties(
- parseProperties(
- bootstrapLoaderPropertiesString, StringPool.COMMA));
- }
-
String replicatorPropertiesString =
(String)\_replicatorProperties.remove(cacheName);
@@ -228,21 +200,6 @@ protected void setProps(Props props) {
Map>
mergedPropertiesMap = new HashMap<>();
- if (\_bootstrapLoaderEnabled) {
- for (String portalCacheName :
- \_bootstrapLoaderProperties.stringPropertyNames()) {
-
- mergedPropertiesMap.put(
- portalCacheName,
- new ObjectValuePair(
- parseProperties(
- \_bootstrapLoaderProperties.getProperty(
- portalCacheName),
- StringPool.COMMA),
- null));
- }
- }
-
for (String portalCacheName :
\_replicatorProperties.stringPropertyNames()) {
@@ -268,9 +225,6 @@ protected void setProps(Props props) {
return mergedPropertiesMap;
}
- private boolean \_bootstrapLoaderEnabled;
- private Properties \_bootstrapLoaderProperties;
- private String \_defaultBootstrapLoaderPropertiesString;
private String \_defaultReplicatorPropertiesString;
private Properties \_replicatorProperties;
diff --git a/modules/apps/portal-cache/portal-cache-multiple/src/main/java/com/liferay/portal/cache/multiple/internal/bootstrap/ClusterLinkBootstrapLoaderHelperUtil.java b/modules/apps/portal-cache/portal-cache-multiple/src/main/java/com/liferay/portal/cache/multiple/internal/bootstrap/ClusterLinkBootstrapLoaderHelperUtil.java
deleted file mode 100644
index adc71af3148ea0..00000000000000
--- a/modules/apps/portal-cache/portal-cache-multiple/src/main/java/com/liferay/portal/cache/multiple/internal/bootstrap/ClusterLinkBootstrapLoaderHelperUtil.java
+++ /dev/null
@@ -1,470 +0,0 @@
-/\*\*
- \* Copyright (c) 2000-present Liferay, Inc. All rights reserved.
- \*
- \* This library is free software; you can redistribute it and/or modify it under
- \* the terms of the GNU Lesser General Public License as published by the Free
- \* Software Foundation; either version 2.1 of the License, or (at your option)
- \* any later version.
- \*
- \* This library is distributed in the hope that it will be useful, but WITHOUT
- \* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
- \* FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
- \* details.
- \*/
-
-package com.liferay.portal.cache.multiple.internal.bootstrap;
-
-import com.liferay.petra.lang.CentralizedThreadLocal;
-import com.liferay.portal.cache.multiple.internal.PortalCacheManagerUtil;
-import com.liferay.portal.kernel.cache.PortalCache;
-import com.liferay.portal.kernel.cache.PortalCacheHelperUtil;
-import com.liferay.portal.kernel.cache.PortalCacheManager;
-import com.liferay.portal.kernel.cluster.ClusterExecutorUtil;
-import com.liferay.portal.kernel.cluster.ClusterNode;
-import com.liferay.portal.kernel.cluster.ClusterNodeResponse;
-import com.liferay.portal.kernel.cluster.ClusterRequest;
-import com.liferay.portal.kernel.cluster.FutureClusterResponses;
-import com.liferay.portal.kernel.exception.SystemException;
-import com.liferay.portal.kernel.io.AnnotatedObjectInputStream;
-import com.liferay.portal.kernel.io.AnnotatedObjectOutputStream;
-import com.liferay.portal.kernel.log.Log;
-import com.liferay.portal.kernel.log.LogFactoryUtil;
-import com.liferay.portal.kernel.util.GetterUtil;
-import com.liferay.portal.kernel.util.MethodHandler;
-import com.liferay.portal.kernel.util.MethodKey;
-import com.liferay.portal.kernel.util.PropsKeys;
-import com.liferay.portal.kernel.util.PropsUtil;
-import com.liferay.portal.kernel.util.SocketUtil;
-
-import java.io.IOException;
-import java.io.ObjectInputStream;
-import java.io.ObjectOutputStream;
-import java.io.OutputStream;
-import java.io.Serializable;
-
-import java.net.ServerSocket;
-import java.net.Socket;
-import java.net.SocketAddress;
-import java.net.SocketException;
-import java.net.SocketTimeoutException;
-
-import java.nio.channels.ServerSocketChannel;
-
-import java.util.ArrayList;
-import java.util.Arrays;
-import java.util.Collections;
-import java.util.HashMap;
-import java.util.List;
-import java.util.Map;
-import java.util.concurrent.BlockingQueue;
-import java.util.concurrent.TimeUnit;
-
-import org.osgi.service.component.annotations.Activate;
-import org.osgi.service.component.annotations.Component;
-
-/\*\*
- \* @author Shuyang Zhou
- \* @author Sherry Yang
- \*/
-@Component(enabled = false, immediate = true, service = {})
-public class ClusterLinkBootstrapLoaderHelperUtil {
-
- public static SocketAddress createServerSocketFromCluster(
- String portalCacheManagerName, List portalCacheNames)
- throws Exception {
-
- ClusterNode localClusterNode =
- ClusterExecutorUtil.getLocalClusterNode();
-
- ServerSocketChannel serverSocketChannel =
- SocketUtil.createServerSocketChannel(
- localClusterNode.getBindInetAddress(),
- GetterUtil.getInteger(
- PropsUtil.get(PropsKeys.EHCACHE\_SOCKET\_START\_PORT), 32454),
- \_serverSocketConfigurator);
-
- ServerSocket serverSocket = serverSocketChannel.socket();
-
- ClusterLinkBootstrapLoaderServerThread
- clusterLinkBootstrapLoaderServerThread =
- new ClusterLinkBootstrapLoaderServerThread(
- serverSocket, portalCacheManagerName, portalCacheNames);
-
- clusterLinkBootstrapLoaderServerThread.start();
-
- return serverSocket.getLocalSocketAddress();
- }
-
- public static boolean isSkipped() {
- return \_skipBootstrapLoaderThreadLocal.get();
- }
-
- public static void loadCachesFromCluster(
- String portalCacheManagerName, String... portalCacheNames)
- throws Exception {
-
- synchronized (ClusterLinkBootstrapLoaderHelperUtil.class) {
- if (!\_started) {
- List portalCaches = \_deferredPortalCaches.get(
- portalCacheManagerName);
-
- if (portalCaches == null) {
- portalCaches = new ArrayList<>();
-
- \_deferredPortalCaches.put(
- portalCacheManagerName, portalCaches);
- }
-
- Collections.addAll(portalCaches, portalCacheNames);
-
- return;
- }
- }
-
- List clusterNodes = ClusterExecutorUtil.getClusterNodes();
-
- if (\_log.isInfoEnabled()) {
- \_log.info("Cluster nodes " + clusterNodes);
- }
-
- if (clusterNodes.size() <= 1) {
- if (\_log.isDebugEnabled()) {
- \_log.debug(
- "Not loading cache from cluster because a cluster peer " +
- "was not found");
- }
-
- return;
- }
-
- PortalCacheManager extends Serializable, ? portalCacheManager =
- PortalCacheManagerUtil.getPortalCacheManager(
- portalCacheManagerName);
-
- if (!portalCacheManager.isClusterAware()) {
- return;
- }
-
- ClusterRequest clusterRequest = ClusterRequest.createMulticastRequest(
- new MethodHandler(
- \_createServerSocketFromClusterMethodKey, portalCacheManagerName,
- Arrays.asList(portalCacheNames)),
- true);
-
- FutureClusterResponses futureClusterResponses =
- ClusterExecutorUtil.execute(clusterRequest);
-
- BlockingQueue clusterNodeResponses =
- futureClusterResponses.getPartialResults();
-
- ClusterNodeResponse clusterNodeResponse = null;
-
- try {
- clusterNodeResponse = clusterNodeResponses.poll(
- GetterUtil.getLong(
- PropsUtil.get(
- PropsKeys.CLUSTER\_LINK\_NODE\_BOOTUP\_RESPONSE\_TIMEOUT),
- 10000),
- TimeUnit.MILLISECONDS);
- }
- catch (InterruptedException ie) {
- return;
- }
-
- if (clusterNodeResponse == null) {
- if (\_log.isWarnEnabled()) {
- \_log.warn(
- "Unable to load cache from the cluster because there was " +
- "no peer response");
- }
-
- return;
- }
-
- if (\_log.isInfoEnabled()) {
- \_log.info(
- "Load cache data from cluster node " +
- clusterNodeResponse.getClusterNode());
- }
-
- Socket socket = null;
-
- try {
- SocketAddress remoteSocketAddress =
- (SocketAddress)clusterNodeResponse.getResult();
-
- if (remoteSocketAddress == null) {
- \_log.error(
- "Cluster peer " + clusterNodeResponse.getClusterNode() +
- " responded with a null socket address");
-
- return;
- }
-
- socket = new Socket();
-
- socket.connect(remoteSocketAddress);
-
- socket.shutdownOutput();
-
- ObjectInputStream objectInputStream =
- new AnnotatedObjectInputStream(socket.getInputStream());
-
- PortalCache portalCache = null;
-
- try {
- while (true) {
- Object object = objectInputStream.readObject();
-
- if (object instanceof CacheElement) {
- CacheElement cacheElement = (CacheElement)object;
-
- PortalCacheHelperUtil.putWithoutReplicator(
- portalCache, cacheElement.getKey(),
- cacheElement.getValue());
- }
- else if (object instanceof String) {
- if (\_COMMAND\_SOCKET\_CLOSE.equals(object)) {
- break;
- }
-
- \_skipBootstrapLoaderThreadLocal.set(Boolean.TRUE);
-
- try {
- portalCache =
- (PortalCache)
- portalCacheManager.getPortalCache(
- (String)object);
- }
- finally {
- \_skipBootstrapLoaderThreadLocal.remove();
- }
- }
- else {
- throw new SystemException(
- "Socket input stream returned invalid object " +
- object);
- }
- }
- }
- finally {
- if (objectInputStream != null) {
- objectInputStream.close();
- }
- }
- }
- catch (Exception e) {
- throw new Exception(
- "Unable to load cache data from cluster node " +
- clusterNodeResponse.getClusterNode(),
- e);
- }
- finally {
- if (socket != null) {
- socket.close();
- }
- }
- }
-
- @Activate
- protected void activate() {
- if (!\_started) {
- \_started = true;
- }
-
- if (\_deferredPortalCaches.isEmpty()) {
- return;
- }
-
- if (\_log.isDebugEnabled()) {
- \_log.debug("Loading deferred caches");
- }
-
- try {
- for (Map.Entry> entry :
- \_deferredPortalCaches.entrySet()) {
-
- List portalCacheNames = entry.getValue();
-
- if (portalCacheNames.isEmpty()) {
- continue;
- }
-
- loadCachesFromCluster(
- entry.getKey(), portalCacheNames.toArray(new String[0]));
- }
- }
- catch (Exception e) {
- if (\_log.isWarnEnabled()) {
- \_log.warn("Unable to load cache data from the cluster", e);
- }
- }
- finally {
- \_deferredPortalCaches.clear();
- }
- }
-
- private static final String \_COMMAND\_SOCKET\_CLOSE = "${SOCKET\_CLOSE}";
-
- private static final Log \_log = LogFactoryUtil.getLog(
- ClusterLinkBootstrapLoaderHelperUtil.class);
-
- private static final MethodKey \_createServerSocketFromClusterMethodKey =
- new MethodKey(
- ClusterLinkBootstrapLoaderHelperUtil.class,
- "createServerSocketFromCluster", String.class, List.class);
- private static final Map> \_deferredPortalCaches =
- new HashMap<>();
- private static final SocketUtil.ServerSocketConfigurator
- \_serverSocketConfigurator = new SocketCacheServerSocketConfiguration();
- private static final ThreadLocal \_skipBootstrapLoaderThreadLocal =
- new CentralizedThreadLocal<>(
- ClusterLinkBootstrapLoaderHelperUtil.class +
- ".\_skipBootstrapLoaderThreadLocal",
- () -> Boolean.FALSE, false);
- private static boolean \_started;
-
- private static class CacheElement implements Serializable {
-
- public CacheElement(Serializable key, Serializable value) {
- \_key = key;
- \_value = value;
- }
-
- public Serializable getKey() {
- return \_key;
- }
-
- public Serializable getValue() {
- return \_value;
- }
-
- private final Serializable \_key;
- private final Serializable \_value;
-
- }
-
- private static class ClusterLinkBootstrapLoaderServerThread extends Thread {
-
- public ClusterLinkBootstrapLoaderServerThread(
- ServerSocket serverSocket, String portalCacheManagerName,
- List portalCacheNames) {
-
- \_serverSocket = serverSocket;
- \_portalCacheManagerName = portalCacheManagerName;
- \_portalCacheNames = portalCacheNames;
-
- setDaemon(true);
- setName(
- ClusterLinkBootstrapLoaderServerThread.class.getName() + " - " +
- portalCacheNames);
- setPriority(Thread.NORM\_PRIORITY);
- }
-
- @Override
- public void run() {
- Socket socket = null;
-
- try {
- try {
- socket = \_serverSocket.accept();
- }
- catch (SocketTimeoutException ste) {
- if (\_log.isDebugEnabled()) {
- \_log.debug(
- "Terminating the socket thread " + getName() +
- " that the client requested but never used");
- }
-
- return;
- }
- finally {
- \_serverSocket.close();
- }
-
- socket.shutdownInput();
-
- try (OutputStream outputStream = socket.getOutputStream();
- ObjectOutputStream objectOutputStream =
- new AnnotatedObjectOutputStream(outputStream)) {
-
- PortalCacheManager extends Serializable, ?
- portalCacheManager =
- PortalCacheManagerUtil.getPortalCacheManager(
- \_portalCacheManagerName);
-
- for (String portalCacheName : \_portalCacheNames) {
- PortalCache portalCache =
- (PortalCache)
- portalCacheManager.getPortalCache(
- portalCacheName);
-
- if (portalCache == null) {
- \_skipBootstrapLoaderThreadLocal.set(Boolean.TRUE);
-
- try {
- portalCacheManager.getPortalCache(
- portalCacheName);
- }
- finally {
- \_skipBootstrapLoaderThreadLocal.remove();
- }
-
- continue;
- }
-
- objectOutputStream.writeObject(portalCacheName);
-
- List keys = portalCache.getKeys();
-
- for (Serializable key : keys) {
- Serializable value = portalCache.get(key);
-
- if (value != null) {
- CacheElement cacheElement = new CacheElement(
- key, value);
-
- objectOutputStream.writeObject(cacheElement);
- }
- }
- }
-
- objectOutputStream.writeObject(\_COMMAND\_SOCKET\_CLOSE);
- }
- }
- catch (Exception e) {
- throw new RuntimeException(e);
- }
- finally {
- if (socket != null) {
- try {
- socket.close();
- }
- catch (IOException ioe) {
- throw new RuntimeException(ioe);
- }
- }
- }
- }
-
- private final String \_portalCacheManagerName;
- private final List \_portalCacheNames;
- private final ServerSocket \_serverSocket;
-
- }
-
- private static class SocketCacheServerSocketConfiguration
- implements SocketUtil.ServerSocketConfigurator {
-
- @Override
- public void configure(ServerSocket serverSocket)
- throws SocketException {
-
- serverSocket.setSoTimeout(
- GetterUtil.getInteger(
- PropsUtil.get(PropsKeys.EHCACHE\_SOCKET\_SO\_TIMEOUT), 10000));
- }
-
- }
-
-}
\ No newline at end of file
diff --git a/modules/apps/portal-cache/portal-cache-multiple/src/main/java/com/liferay/portal/cache/multiple/internal/bootstrap/ClusterLinkPortalCacheBootstrapLoader.java b/modules/apps/portal-cache/portal-cache-multiple/src/main/java/com/liferay/portal/cache/multiple/internal/bootstrap/ClusterLinkPortalCacheBootstrapLoader.java
deleted file mode 100644
index 2351fd17c08524..00000000000000
--- a/modules/apps/portal-cache/portal-cache-multiple/src/main/java/com/liferay/portal/cache/multiple/internal/bootstrap/ClusterLinkPortalCacheBootstrapLoader.java
+++ /dev/null
@@ -1,133 +0,0 @@
-/\*\*
- \* Copyright (c) 2000-present Liferay, Inc. All rights reserved.
- \*
- \* This library is free software; you can redistribute it and/or modify it under
- \* the terms of the GNU Lesser General Public License as published by the Free
- \* Software Foundation; either version 2.1 of the License, or (at your option)
- \* any later version.
- \*
- \* This library is distributed in the hope that it will be useful, but WITHOUT
- \* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
- \* FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
- \* details.
- \*/
-
-package com.liferay.portal.cache.multiple.internal.bootstrap;
-
-import com.liferay.petra.string.StringBundler;
-import com.liferay.portal.cache.PortalCacheBootstrapLoader;
-import com.liferay.portal.kernel.log.Log;
-import com.liferay.portal.kernel.log.LogFactoryUtil;
-import com.liferay.portal.kernel.util.GetterUtil;
-
-import java.util.Properties;
-
-/\*\*
- \* @author Tina Tian
- \*/
-public class ClusterLinkPortalCacheBootstrapLoader
- implements PortalCacheBootstrapLoader {
-
- public ClusterLinkPortalCacheBootstrapLoader(Properties properties) {
- if (properties != null) {
- \_bootstrapAsynchronously = GetterUtil.getBoolean(
- properties.getProperty(
- PortalCacheBootstrapLoader.BOOTSTRAP\_ASYNCHRONOUSLY),
- PortalCacheBootstrapLoader.DEFAULT\_BOOTSTRAP\_ASYNCHRONOUSLY);
- }
- else {
- \_bootstrapAsynchronously =
- PortalCacheBootstrapLoader.DEFAULT\_BOOTSTRAP\_ASYNCHRONOUSLY;
- }
- }
-
- @Override
- public boolean isAsynchronous() {
- return \_bootstrapAsynchronously;
- }
-
- @Override
- public void loadPortalCache(
- String portalCacheManagerName, String portalCacheName) {
-
- if (ClusterLinkBootstrapLoaderHelperUtil.isSkipped()) {
- return;
- }
-
- if (\_bootstrapAsynchronously) {
- BootstrapLoaderClientThread bootstrapLoaderClientThread =
- new BootstrapLoaderClientThread(
- portalCacheManagerName, portalCacheName);
-
- bootstrapLoaderClientThread.start();
- }
- else {
- doLoad(portalCacheManagerName, portalCacheName);
- }
- }
-
- protected void doLoad(
- String portalCacheManagerName, String portalCacheName) {
-
- if (\_log.isDebugEnabled()) {
- \_log.debug("Bootstraping " + portalCacheName);
- }
-
- try {
- ClusterLinkBootstrapLoaderHelperUtil.loadCachesFromCluster(
- portalCacheManagerName, portalCacheName);
- }
- catch (Exception e) {
- if (\_log.isWarnEnabled()) {
- \_log.warn("Unable to load cache data from the cluster", e);
- }
- }
- }
-
- private static final Log \_log = LogFactoryUtil.getLog(
- ClusterLinkPortalCacheBootstrapLoader.class);
-
- private final boolean \_bootstrapAsynchronously;
-
- private class BootstrapLoaderClientThread extends Thread {
-
- public BootstrapLoaderClientThread(
- String portalCacheManagerName, String portalCacheName) {
-
- if (\_log.isDebugEnabled()) {
- \_log.debug(
- StringBundler.concat(
- "Bootstrap loader client thread for cache ",
- portalCacheName, " from cache manager ",
- portalCacheManagerName));
- }
-
- \_portalCacheManagerName = portalCacheManagerName;
- \_portalCacheName = portalCacheName;
-
- setDaemon(true);
- setName(
- StringBundler.concat(
- BootstrapLoaderClientThread.class.getName(), " - ",
- portalCacheManagerName, " - ", portalCacheName));
- setPriority(Thread.NORM\_PRIORITY);
- }
-
- @Override
- public void run() {
- try {
- doLoad(\_portalCacheManagerName, \_portalCacheName);
- }
- catch (Exception e) {
- if (\_log.isWarnEnabled()) {
- \_log.warn("Unable to asynchronously stream bootstrap", e);
- }
- }
- }
-
- private final String \_portalCacheManagerName;
- private final String \_portalCacheName;
-
- }
-
-}
\ No newline at end of file
diff --git a/modules/apps/portal-cache/portal-cache-multiple/src/main/java/com/liferay/portal/cache/multiple/internal/bootstrap/ClusterLinkPortalCacheBootstrapLoaderFactory.java b/modules/apps/portal-cache/portal-cache-multiple/src/main/java/com/liferay/portal/cache/multiple/internal/bootstrap/ClusterLinkPortalCacheBootstrapLoaderFactory.java
deleted file mode 100644
index 415763c16146fd..00000000000000
--- a/modules/apps/portal-cache/portal-cache-multiple/src/main/java/com/liferay/portal/cache/multiple/internal/bootstrap/ClusterLinkPortalCacheBootstrapLoaderFactory.java
+++ /dev/null
@@ -1,39 +0,0 @@
-/\*\*
- \* Copyright (c) 2000-present Liferay, Inc. All rights reserved.
- \*
- \* This library is free software; you can redistribute it and/or modify it under
- \* the terms of the GNU Lesser General Public License as published by the Free
- \* Software Foundation; either version 2.1 of the License, or (at your option)
- \* any later version.
- \*
- \* This library is distributed in the hope that it will be useful, but WITHOUT
- \* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
- \* FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
- \* details.
- \*/
-
-package com.liferay.portal.cache.multiple.internal.bootstrap;
-
-import com.liferay.portal.cache.PortalCacheBootstrapLoader;
-import com.liferay.portal.cache.PortalCacheBootstrapLoaderFactory;
-
-import java.util.Properties;
-
-import org.osgi.service.component.annotations.Component;
-
-/\*\*
- \* @author Tina Tian
- \*/
-@Component(
- enabled = false, immediate = true,
- service = PortalCacheBootstrapLoaderFactory.class
-)
-public class ClusterLinkPortalCacheBootstrapLoaderFactory
- implements PortalCacheBootstrapLoaderFactory {
-
- @Override
- public PortalCacheBootstrapLoader create(Properties properties) {
- return new ClusterLinkPortalCacheBootstrapLoader(properties);
- }
-
-}
\ No newline at end of file
diff --git a/modules/apps/portal-cache/portal-cache-multiple/src/main/java/com/liferay/portal/cache/multiple/internal/portal/profile/ModulePortalProfile.java b/modules/apps/portal-cache/portal-cache-multiple/src/main/java/com/liferay/portal/cache/multiple/internal/portal/profile/ModulePortalProfile.java
index 6bb25ecf40ea1a..e26e337c9f6154 100644
--- a/modules/apps/portal-cache/portal-cache-multiple/src/main/java/com/liferay/portal/cache/multiple/internal/portal/profile/ModulePortalProfile.java
+++ b/modules/apps/portal-cache/portal-cache-multiple/src/main/java/com/liferay/portal/cache/multiple/internal/portal/profile/ModulePortalProfile.java
@@ -14,12 +14,9 @@
package com.liferay.portal.cache.multiple.internal.portal.profile;
-import com.liferay.portal.cache.PortalCacheBootstrapLoaderFactory;
import com.liferay.portal.cache.PortalCacheReplicatorFactory;
import com.liferay.portal.cache.multiple.internal.ClusterLinkPortalCacheReplicatorFactory;
import com.liferay.portal.cache.multiple.internal.PortalCacheManagerUtil;
-import com.liferay.portal.cache.multiple.internal.bootstrap.ClusterLinkBootstrapLoaderHelperUtil;
-import com.liferay.portal.cache.multiple.internal.bootstrap.ClusterLinkPortalCacheBootstrapLoaderFactory;
import com.liferay.portal.cache.multiple.internal.cluster.link.ClusterLinkPortalCacheClusterChannelFactory;
import com.liferay.portal.cache.multiple.internal.cluster.link.PortalCacheClusterLink;
import com.liferay.portal.cache.multiple.internal.cluster.link.messaging.ClusterLinkMessagingConfigurator;
@@ -63,12 +60,6 @@ public void activate(ComponentContext componentContext) {
BundleContext bundleContext = componentContext.getBundleContext();
- bundleContext.registerService(
- PortalCacheBootstrapLoaderFactory.class,
- ProxyFactory.newDummyInstance(
- PortalCacheBootstrapLoaderFactory.class),
- new HashMapDictionary<>());
-
bundleContext.registerService(
PortalCacheReplicatorFactory.class,
ProxyFactory.newDummyInstance(
@@ -78,9 +69,7 @@ public void activate(ComponentContext componentContext) {
init(
componentContext, supportedPortalProfileNames,
- ClusterLinkBootstrapLoaderHelperUtil.class.getName(),
ClusterLinkMessagingConfigurator.class.getName(),
- ClusterLinkPortalCacheBootstrapLoaderFactory.class.getName(),
ClusterLinkPortalCacheClusterChannelFactory.class.getName(),
ClusterLinkPortalCacheClusterListener.class.getName(),
ClusterLinkPortalCacheReplicatorFactory.class.getName(),
diff --git a/modules/apps/portal-search/portal-search-web/src/main/resources/META-INF/resources/search/results/view.jsp b/modules/apps/portal-search/portal-search-web/src/main/resources/META-INF/resources/search/results/view.jsp
index dd3230e93a737e..fe89b2c863587e 100644
--- a/modules/apps/portal-search/portal-search-web/src/main/resources/META-INF/resources/search/results/view.jsp
+++ b/modules/apps/portal-search/portal-search-web/src/main/resources/META-INF/resources/search/results/view.jsp
@@ -136,7 +136,7 @@ com.liferay.portal.kernel.dao.search.SearchContainer

-  **<%= searchResultSummaryDisplayContext.getCreatorUserName() %>**
+  **<%= HtmlUtil.escape(searchResultSummaryDisplayContext.getCreatorUserName()) %>**

diff --git a/modules/apps/portal-search/portal-search-web/src/main/resources/META-INF/resources/user/facet/view.jsp b/modules/apps/portal-search/portal-search-web/src/main/resources/META-INF/resources/user/facet/view.jsp
index 3346e7e7ab77bc..80947e3a04b320 100644
--- a/modules/apps/portal-search/portal-search-web/src/main/resources/META-INF/resources/user/facet/view.jsp
+++ b/modules/apps/portal-search/portal-search-web/src/main/resources/META-INF/resources/user/facet/view.jsp
@@ -82,7 +82,7 @@ UserSearchFacetDisplayContext userSearchFacetDisplayContext = (UserSearchFacetDi- -  />
  +  />
  ">
  <%= HtmlUtil.escape(userSearchFacetTermDisplayContext.getUserName()) %>
  diff --git a/modules/apps/portal-security-sso/portal-security-sso-openid-connect-impl/build.gradle b/modules/apps/portal-security-sso/portal-security-sso-openid-connect-impl/build.gradle
  index 3b27a7caf06855..9d29f2bec34a3f 100644
  --- a/modules/apps/portal-security-sso/portal-security-sso-openid-connect-impl/build.gradle
  +++ b/modules/apps/portal-security-sso/portal-security-sso-openid-connect-impl/build.gradle
  @@ -1,8 +1,8 @@
  dependencies {
  compileInclude group: "com.github.stephenc.jcip", name: "jcip-annotations", version: "1.0-1"
  compileInclude group: "com.nimbusds", name: "lang-tag", version: "1.4.4"
  - compileInclude group: "com.nimbusds", name: "nimbus-jose-jwt", version: "6.7"
  - compileInclude group: "com.nimbusds", name: "oauth2-oidc-sdk", version: "6.5"
  + compileInclude group: "com.nimbusds", name: "nimbus-jose-jwt", version: "7.9"
  + compileInclude group: "com.nimbusds", name: "oauth2-oidc-sdk", version: "6.16.2"
  compileInclude group: "com.sun.mail", name: "javax.mail", version: "1.6.2"
  compileInclude group: "javax.activation", name: "activation", version: "1.1.1"
  compileInclude group: "net.minidev", name: "accessors-smart", version: "1.2"
  diff --git a/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/java/com/liferay/portal/settings/authentication/ldap/web/internal/portlet/action/PortalSettingsTestLDAPConnectionMVCRenderCommand.java b/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/java/com/liferay/portal/settings/authentication/ldap/web/internal/portlet/action/PortalSettingsTestLDAPConnectionMVCRenderCommand.java
  index 347bf00da70866..deb925911f491c 100644
  --- a/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/java/com/liferay/portal/settings/authentication/ldap/web/internal/portlet/action/PortalSettingsTestLDAPConnectionMVCRenderCommand.java
  +++ b/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/java/com/liferay/portal/settings/authentication/ldap/web/internal/portlet/action/PortalSettingsTestLDAPConnectionMVCRenderCommand.java
  @@ -15,7 +15,17 @@
  package com.liferay.portal.settings.authentication.ldap.web.internal.portlet.action;
  import com.liferay.configuration.admin.constants.ConfigurationAdminPortletKeys;
  +import com.liferay.portal.kernel.log.Log;
  +import com.liferay.portal.kernel.log.LogFactoryUtil;
  import com.liferay.portal.kernel.portlet.bridges.mvc.MVCRenderCommand;
  +import com.liferay.portal.kernel.portlet.bridges.mvc.MVCRenderConstants;
  +import com.liferay.portal.kernel.security.auth.AuthTokenUtil;
  +import com.liferay.portal.kernel.security.auth.PrincipalException;
  +import com.liferay.portal.kernel.util.Portal;
  +
  +import javax.portlet.PortletException;
  +import javax.portlet.RenderRequest;
  +import javax.portlet.RenderResponse;
  import javax.servlet.ServletContext;
  @@ -35,6 +45,32 @@
  public class PortalSettingsTestLDAPConnectionMVCRenderCommand
  extends BasePortalSettingsMVCRenderCommand {
  + @Override
  + public String render(
  + RenderRequest renderRequest, RenderResponse renderResponse)
  + throws PortletException {
  +
  + try {
  + AuthTokenUtil.checkCSRFToken(
  + \_portal.getOriginalServletRequest(
  + \_portal.getHttpServletRequest(renderRequest)),
  + getClass().getName());
  +
  + return super.render(renderRequest, renderResponse);
  + }
  + catch (PrincipalException pe) {
  + if (\_log.isDebugEnabled()) {
  + \_log.debug(
  + "Unable to test LDAP connection: " + pe.getMessage(), pe);
  + }
  + else if (\_log.isWarnEnabled()) {
  + \_log.warn("Unable to test LDAP connection: " + pe.getMessage());
  + }
  + }
  +
  + return MVCRenderConstants.MVC\_PATH\_VALUE\_SKIP\_DISPATCH;
  + }
  +
  @Override
  protected String getJspPath() {
  return \_JSP\_PATH;
  @@ -51,4 +87,10 @@ protected void setServletContext(ServletContext servletContext) {
  private static final String \_JSP\_PATH =
  "/com.liferay.portal.settings.web/test\_ldap\_connection.jsp";
  + private static final Log \_log = LogFactoryUtil.getLog(
  + PortalSettingsTestLDAPConnectionMVCRenderCommand.class);
  +
  + @Reference
  + private Portal \_portal;
  +
  }
  \ No newline at end of file
  diff --git a/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/java/com/liferay/portal/settings/authentication/ldap/web/internal/portlet/action/PortalSettingsTestLDAPGroupsMVCRenderCommand.java b/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/java/com/liferay/portal/settings/authentication/ldap/web/internal/portlet/action/PortalSettingsTestLDAPGroupsMVCRenderCommand.java
  index 087b7b68a98b66..7a1db5e24f7cb9 100644
  --- a/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/java/com/liferay/portal/settings/authentication/ldap/web/internal/portlet/action/PortalSettingsTestLDAPGroupsMVCRenderCommand.java
  +++ b/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/java/com/liferay/portal/settings/authentication/ldap/web/internal/portlet/action/PortalSettingsTestLDAPGroupsMVCRenderCommand.java
  @@ -15,7 +15,17 @@
  package com.liferay.portal.settings.authentication.ldap.web.internal.portlet.action;
  import com.liferay.configuration.admin.constants.ConfigurationAdminPortletKeys;
  +import com.liferay.portal.kernel.log.Log;
  +import com.liferay.portal.kernel.log.LogFactoryUtil;
  import com.liferay.portal.kernel.portlet.bridges.mvc.MVCRenderCommand;
  +import com.liferay.portal.kernel.portlet.bridges.mvc.MVCRenderConstants;
  +import com.liferay.portal.kernel.security.auth.AuthTokenUtil;
  +import com.liferay.portal.kernel.security.auth.PrincipalException;
  +import com.liferay.portal.kernel.util.Portal;
  +
  +import javax.portlet.PortletException;
  +import javax.portlet.RenderRequest;
  +import javax.portlet.RenderResponse;
  import javax.servlet.ServletContext;
  @@ -35,6 +45,32 @@
  public class PortalSettingsTestLDAPGroupsMVCRenderCommand
  extends BasePortalSettingsMVCRenderCommand {
  + @Override
  + public String render(
  + RenderRequest renderRequest, RenderResponse renderResponse)
  + throws PortletException {
  +
  + try {
  + AuthTokenUtil.checkCSRFToken(
  + \_portal.getOriginalServletRequest(
  + \_portal.getHttpServletRequest(renderRequest)),
  + getClass().getName());
  +
  + return super.render(renderRequest, renderResponse);
  + }
  + catch (PrincipalException pe) {
  + if (\_log.isDebugEnabled()) {
  + \_log.debug(
  + "Unable to test LDAP connection: " + pe.getMessage(), pe);
  + }
  + else if (\_log.isWarnEnabled()) {
  + \_log.warn("Unable to test LDAP connection: " + pe.getMessage());
  + }
  + }
  +
  + return MVCRenderConstants.MVC\_PATH\_VALUE\_SKIP\_DISPATCH;
  + }
  +
  @Override
  protected String getJspPath() {
  return \_JSP\_PATH;
  @@ -51,4 +87,10 @@ protected void setServletContext(ServletContext servletContext) {
  private static final String \_JSP\_PATH =
  "/com.liferay.portal.settings.web/test\_ldap\_groups.jsp";
  + private static final Log \_log = LogFactoryUtil.getLog(
  + PortalSettingsTestLDAPGroupsMVCRenderCommand.class);
  +
  + @Reference
  + private Portal \_portal;
  +
  }
  \ No newline at end of file
  diff --git a/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/java/com/liferay/portal/settings/authentication/ldap/web/internal/portlet/action/PortalSettingsTestLDAPUsersMVCRenderCommand.java b/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/java/com/liferay/portal/settings/authentication/ldap/web/internal/portlet/action/PortalSettingsTestLDAPUsersMVCRenderCommand.java
  index 79a7a3b3db1d74..dff93f4689cd3c 100644
  --- a/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/java/com/liferay/portal/settings/authentication/ldap/web/internal/portlet/action/PortalSettingsTestLDAPUsersMVCRenderCommand.java
  +++ b/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/java/com/liferay/portal/settings/authentication/ldap/web/internal/portlet/action/PortalSettingsTestLDAPUsersMVCRenderCommand.java
  @@ -15,7 +15,17 @@
  package com.liferay.portal.settings.authentication.ldap.web.internal.portlet.action;
  import com.liferay.configuration.admin.constants.ConfigurationAdminPortletKeys;
  +import com.liferay.portal.kernel.log.Log;
  +import com.liferay.portal.kernel.log.LogFactoryUtil;
  import com.liferay.portal.kernel.portlet.bridges.mvc.MVCRenderCommand;
  +import com.liferay.portal.kernel.portlet.bridges.mvc.MVCRenderConstants;
  +import com.liferay.portal.kernel.security.auth.AuthTokenUtil;
  +import com.liferay.portal.kernel.security.auth.PrincipalException;
  +import com.liferay.portal.kernel.util.Portal;
  +
  +import javax.portlet.PortletException;
  +import javax.portlet.RenderRequest;
  +import javax.portlet.RenderResponse;
  import javax.servlet.ServletContext;
  @@ -35,6 +45,32 @@
  public class PortalSettingsTestLDAPUsersMVCRenderCommand
  extends BasePortalSettingsMVCRenderCommand {
  + @Override
  + public String render(
  + RenderRequest renderRequest, RenderResponse renderResponse)
  + throws PortletException {
  +
  + try {
  + AuthTokenUtil.checkCSRFToken(
  + \_portal.getOriginalServletRequest(
  + \_portal.getHttpServletRequest(renderRequest)),
  + getClass().getName());
  +
  + return super.render(renderRequest, renderResponse);
  + }
  + catch (PrincipalException pe) {
  + if (\_log.isDebugEnabled()) {
  + \_log.debug(
  + "Unable to test LDAP connection: " + pe.getMessage(), pe);
  + }
  + else if (\_log.isWarnEnabled()) {
  + \_log.warn("Unable to test LDAP connection: " + pe.getMessage());
  + }
  + }
  +
  + return MVCRenderConstants.MVC\_PATH\_VALUE\_SKIP\_DISPATCH;
  + }
  +
  @Override
  protected String getJspPath() {
  return \_JSP\_PATH;
  @@ -51,4 +87,10 @@ protected void setServletContext(ServletContext servletContext) {
  private static final String \_JSP\_PATH =
  "/com.liferay.portal.settings.web/test\_ldap\_users.jsp";
  + private static final Log \_log = LogFactoryUtil.getLog(
  + PortalSettingsTestLDAPUsersMVCRenderCommand.class);
  +
  + @Reference
  + private Portal \_portal;
  +
  }
  \ No newline at end of file
  diff --git a/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/resources/META-INF/resources/com.liferay.portal.settings.web/edit\_ldap\_server.jsp b/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/resources/META-INF/resources/com.liferay.portal.settings.web/edit\_ldap\_server.jsp
  index 0a782356d3a213..a8df3425e23b87 100644
  --- a/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/resources/META-INF/resources/com.liferay.portal.settings.web/edit\_ldap\_server.jsp
  +++ b/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/resources/META-INF/resources/com.liferay.portal.settings.web/edit\_ldap\_server.jsp
  @@ -507,7 +507,9 @@ renderResponse.setTitle((ldapServerId == 0) ? LanguageUtil.get(resourceBundle, "
  var url = null;
  - var data = {};
  + var data = {
  + p\_auth: '<%= AuthTokenUtil.getToken(request) %>'
  + };
  if (type === 'ldapConnection') {
  url =
  diff --git a/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/resources/META-INF/resources/com.liferay.portal.settings.web/init.jsp b/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/resources/META-INF/resources/com.liferay.portal.settings.web/init.jsp
  index 56472607061a2e..67872874450052 100644
  --- a/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/resources/META-INF/resources/com.liferay.portal.settings.web/init.jsp
  +++ b/modules/apps/portal-settings/portal-settings-authentication-ldap-web/src/main/resources/META-INF/resources/com.liferay.portal.settings.web/init.jsp
  @@ -28,6 +28,7 @@ page import="com.liferay.petra.string.StringPool" %><%@
  page import="com.liferay.portal.kernel.language.LanguageUtil" %><%@
  page import="com.liferay.portal.kernel.language.UnicodeLanguageUtil" %><%@
  page import="com.liferay.portal.kernel.portlet.LiferayWindowState" %><%@
  +page import="com.liferay.portal.kernel.security.auth.AuthTokenUtil" %><%@
  page import="com.liferay.portal.kernel.security.auth.FullNameDefinition" %><%@
  page import="com.liferay.portal.kernel.security.auth.FullNameDefinitionFactory" %><%@
  page import="com.liferay.portal.kernel.util.Constants" %><%@
  diff --git a/modules/apps/portal-template/portal-template-freemarker/build.gradle b/modules/apps/portal-template/portal-template-freemarker/build.gradle
  index 361feef4ae4ea1..e114229b352924 100644
  --- a/modules/apps/portal-template/portal-template-freemarker/build.gradle
  +++ b/modules/apps/portal-template/portal-template-freemarker/build.gradle
  @@ -9,7 +9,7 @@ dependencies {
  compileOnly group: "com.liferay", name: "com.liferay.petra.reflect", version: "3.0.0"
  compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "3.0.0"
  compileOnly group: "com.liferay", name: "com.liferay.portal.configuration.metatype.api", version: "2.0.0"
  - compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "4.4.0"
  + compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "default"
  compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "4.34.0"
  compileOnly group: "com.liferay.portal", name: "com.liferay.util.taglib", version: "4.0.0"
  compileOnly group: "org.apache.felix", name: "org.apache.felix.http.servlet-api", version: "1.1.2"
  diff --git a/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/configuration/FreeMarkerEngineConfiguration.java b/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/configuration/FreeMarkerEngineConfiguration.java
  index 626787ee29634d..31f7d30190f3a4 100644
  --- a/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/configuration/FreeMarkerEngineConfiguration.java
  +++ b/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/configuration/FreeMarkerEngineConfiguration.java
  @@ -41,7 +41,7 @@ public interface FreeMarkerEngineConfiguration {
  public String[] allowedClasses();
  @Meta.AD(
  - deflt = "com.liferay.portal.json.jabsorb.serializer.LiferayJSONDeserializationWhitelist|java.lang.Class|java.lang.ClassLoader|java.lang.Compiler|java.lang.Package|java.lang.Process|java.lang.Runtime|java.lang.RuntimePermission|java.lang.SecurityManager|java.lang.System|java.lang.Thread|java.lang.ThreadGroup|java.lang.ThreadLocal",
  + deflt = "com.ibm.\*|com.liferay.portal.json.jabsorb.serializer.LiferayJSONDeserializationWhitelist|com.liferay.portal.spring.context.\*|io.undertow.\*|java.lang.Class|java.lang.ClassLoader|java.lang.Compiler|java.lang.Package|java.lang.Process|java.lang.Runtime|java.lang.RuntimePermission|java.lang.SecurityManager|java.lang.System|java.lang.Thread|java.lang.ThreadGroup|java.lang.ThreadLocal|org.apache.\*|org.glassfish.\*|org.jboss.\*|org.springframework.\*|org.wildfly.\*|weblogic.\*",
  name = "restricted-classes", required = false
  )
  public String[] restrictedClasses();
  diff --git a/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/FreeMarkerManager.java b/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/FreeMarkerManager.java
  index 56897e612d4845..8f3d1f016fd0f9 100644
  --- a/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/FreeMarkerManager.java
  +++ b/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/FreeMarkerManager.java
  @@ -109,6 +109,10 @@
  )
  public class FreeMarkerManager extends BaseTemplateManager {
  + /\*\*
  + \* @deprecated As of Athanasius (7.3.x), with no direct replacement
  + \*/
  + @Deprecated
  public static BeansWrapper getBeansWrapper() {
  Thread currentThread = Thread.currentThread();
  @@ -128,6 +132,10 @@ public static BeansWrapper getBeansWrapper() {
  return beansWrapper;
  }
  + /\*\*
  + \* @deprecated As of Athanasius (7.3.x), with no direct replacement
  + \*/
  + @Deprecated
  @Override
  public void addStaticClassSupport(
  Map contextObjects, String variableName,
  @@ -152,24 +160,39 @@ public void addStaticClassSupport(
  }
  }
  + /\*\*
  + \* @deprecated As of Athanasius (7.3.x), with no direct replacement
  + \*/
  + @Deprecated
  @Override
  public void addTaglibApplication(
  Map contextObjects, String applicationName,
  ServletContext servletContext) {
  contextObjects.put(
  - applicationName, getServletContextHashModel(servletContext));
  + applicationName,
  + getServletContextHashModel(
  + servletContext, \_configuration.getObjectWrapper()));
  }
  + /\*\*
  + \* @deprecated As of Athanasius (7.3.x), with no direct replacement
  + \*/
  + @Deprecated
  @Override
  public void addTaglibFactory(
  Map contextObjects, String taglibFactoryName,
  ServletContext servletContext) {
  contextObjects.put(
  - taglibFactoryName, new TaglibFactoryWrapper(servletContext));
  + taglibFactoryName,
  + new TaglibFactoryWrapper(servletContext, getBeansWrapper()));
  }
  + /\*\*
  + \* @deprecated As of Athanasius (7.3.x), with no direct replacement
  + \*/
  + @Deprecated
  @Override
  public void addTaglibRequest(
  Map contextObjects, String applicationName,
  @@ -183,41 +206,19 @@ public void addTaglibRequest(
  \_configuration.getObjectWrapper()));
  }
  + /\*\*
  + \* @deprecated As of Athanasius (7.3.x), with no direct replacement
  + \*/
  + @Deprecated
  @Override
  public void addTaglibSupport(
  Map contextObjects,
  HttpServletRequest httpServletRequest,
  HttpServletResponse httpServletResponse) {
  - ServletContext servletContext = httpServletRequest.getServletContext();
  -
  - addTaglibApplication(contextObjects, "Application", servletContext);
  -
  - addTaglibRequest(
  - contextObjects, "Request", httpServletRequest, httpServletResponse);
  -
  - // Legacy
  -
  - TaglibFactoryWrapper taglibFactoryWrapper = new TaglibFactoryWrapper(
  - servletContext);
  -
  - contextObjects.put("PortalJspTagLibs", taglibFactoryWrapper);
  - contextObjects.put("PortletJspTagLibs", taglibFactoryWrapper);
  - contextObjects.put("taglibLiferayHash", taglibFactoryWrapper);
  -
  - // Contributed
  -
  - for (Map.Entry entry : \_taglibMappings.entrySet()) {
  - try {
  - contextObjects.put(
  - entry.getKey(), taglibFactoryWrapper.get(entry.getValue()));
  - }
  - catch (TemplateModelException tme) {
  - \_log.error(
  - "Unable to add taglib " + entry.getKey() + " to context",
  - tme);
  - }
  - }
  + addTaglibSupport(
  + contextObjects, httpServletRequest, httpServletResponse,
  + getBeansWrapper());
  }
  @Override
  @@ -310,8 +311,8 @@ public void init() throws TemplateException {
  throw new TemplateException("Unable to init FreeMarker manager", e);
  }
  - \_defaultObjectWrapper = new LiferayObjectWrapper();
  - \_restrictedObjectWrapper = new RestrictedLiferayObjectWrapper(
  + \_defaultBeanWrapper = new LiferayObjectWrapper();
  + \_restrictedBeanWrapper = new RestrictedLiferayObjectWrapper(
  \_freeMarkerEngineConfiguration.allowedClasses(),
  \_freeMarkerEngineConfiguration.restrictedClasses(),
  \_freeMarkerEngineConfiguration.restrictedMethods());
  @@ -319,6 +320,14 @@ public void init() throws TemplateException {
  if (isEnableDebuggerService()) {
  DebuggerService.getBreakpoints("\*");
  }
  +
  + FreeMarkerTemplateContextHelper freeMarkerTemplateContextHelper =
  + (FreeMarkerTemplateContextHelper)templateContextHelper;
  +
  + freeMarkerTemplateContextHelper.setDefaultBeansWrapper(
  + \_defaultBeanWrapper);
  + freeMarkerTemplateContextHelper.setRestrictedBeansWrapper(
  + \_restrictedBeanWrapper);
  }
  @Reference(unbind = "-")
  @@ -365,6 +374,46 @@ protected void activate(ComponentContext componentContext) {
  WriterFactoryUtil.setWriterFactory(new UnsyncStringWriterFactory());
  }
  + protected void addTaglibSupport(
  + Map contextObjects,
  + HttpServletRequest httpServletRequest,
  + HttpServletResponse httpServletResponse, ObjectWrapper objectWrapper) {
  +
  + ServletContext servletContext = httpServletRequest.getServletContext();
  +
  + contextObjects.put(
  + "Application",
  + getServletContextHashModel(servletContext, objectWrapper));
  +
  + contextObjects.put(
  + "Request",
  + new HttpRequestHashModel(
  + httpServletRequest, httpServletResponse, objectWrapper));
  +
  + // Legacy
  +
  + TaglibFactoryWrapper taglibFactoryWrapper = new TaglibFactoryWrapper(
  + servletContext, objectWrapper);
  +
  + contextObjects.put("PortalJspTagLibs", taglibFactoryWrapper);
  + contextObjects.put("PortletJspTagLibs", taglibFactoryWrapper);
  + contextObjects.put("taglibLiferayHash", taglibFactoryWrapper);
  +
  + // Contributed
  +
  + for (Map.Entry entry : \_taglibMappings.entrySet()) {
  + try {
  + contextObjects.put(
  + entry.getKey(), taglibFactoryWrapper.get(entry.getValue()));
  + }
  + catch (TemplateModelException templateModelException) {
  + \_log.error(
  + "Unable to add taglib " + entry.getKey() + " to context",
  + templateModelException);
  + }
  + }
  + }
  +
  @Deactivate
  protected void deactivate() {
  \_bundleTracker.close();
  @@ -375,16 +424,16 @@ protected Template doGetTemplate(
  TemplateResource templateResource, boolean restricted,
  Map helperUtilities) {
  - ObjectWrapper objectWrapper = \_defaultObjectWrapper;
  + BeansWrapper beansWrapper = \_defaultBeanWrapper;
  if (restricted) {
  - objectWrapper = \_restrictedObjectWrapper;
  + beansWrapper = \_restrictedBeanWrapper;
  }
  return new FreeMarkerTemplate(
  templateResource, helperUtilities, \_configuration,
  templateContextHelper, \_freeMarkerTemplateResourceCache, restricted,
  - objectWrapper);
  + beansWrapper, this);
  }
  protected FreeMarkerBundleClassloader getFreeMarkerBundleClassloader() {
  @@ -421,12 +470,11 @@ protected FreeMarkerBundleClassloader getFreeMarkerBundleClassloader() {
  }
  protected ServletContextHashModel getServletContextHashModel(
  - ServletContext servletContext) {
  + ServletContext servletContext, ObjectWrapper objectWrapper) {
  GenericServlet genericServlet = new JSPSupportServlet(servletContext);
  - return new ServletContextHashModel(
  - genericServlet, \_configuration.getObjectWrapper());
  + return new ServletContextHashModel(genericServlet, objectWrapper);
  }
  protected ServletContext getServletContextWrapper(
  @@ -496,7 +544,7 @@ private String \_getMacroLibrary() {
  private volatile int \_bundleTrackingCount = -2;
  private Configuration \_configuration;
  - private ObjectWrapper \_defaultObjectWrapper;
  + private BeansWrapper \_defaultBeanWrapper;
  private volatile FreeMarkerBundleClassloader \_freeMarkerBundleClassloader;
  private volatile FreeMarkerEngineConfiguration
  \_freeMarkerEngineConfiguration;
  @@ -504,7 +552,7 @@ private String \_getMacroLibrary() {
  @Reference
  private FreeMarkerTemplateResourceCache \_freeMarkerTemplateResourceCache;
  - private ObjectWrapper \_restrictedObjectWrapper;
  + private BeansWrapper \_restrictedBeanWrapper;
  private SingleVMPool \_singleVMPool;
  private final Map \_taglibMappings =
  new ConcurrentHashMap<>();
  @@ -702,14 +750,16 @@ public void removedBundle(
  private class TaglibFactoryWrapper implements TemplateHashModel {
  - public TaglibFactoryWrapper(ServletContext servletContext) {
  + public TaglibFactoryWrapper(
  + ServletContext servletContext, ObjectWrapper objectWrapper) {
  +
  \_freeMarkerBundleClassloader = getFreeMarkerBundleClassloader();
  \_taglibFactory = new TaglibFactory(
  getServletContextWrapper(
  servletContext, \_freeMarkerBundleClassloader));
  - \_taglibFactory.setObjectWrapper(getBeansWrapper());
  + \_taglibFactory.setObjectWrapper(objectWrapper);
  }
  @Override
  diff --git a/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/FreeMarkerTemplate.java b/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/FreeMarkerTemplate.java
  index 14dd6a4b39e03d..313faf73ed74af 100644
  --- a/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/FreeMarkerTemplate.java
  +++ b/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/FreeMarkerTemplate.java
  @@ -14,6 +14,8 @@
  package com.liferay.portal.template.freemarker.internal;
  +import com.liferay.portal.kernel.log.Log;
  +import com.liferay.portal.kernel.log.LogFactoryUtil;
  import com.liferay.portal.kernel.template.StringTemplateResource;
  import com.liferay.portal.kernel.template.TemplateConstants;
  import com.liferay.portal.kernel.template.TemplateException;
  @@ -25,6 +27,7 @@
  import freemarker.core.ParseException;
  +import freemarker.ext.beans.BeansWrapper;
  import freemarker.ext.util.WrapperTemplateModel;
  import freemarker.template.AdapterTemplateModel;
  @@ -33,6 +36,7 @@
  import freemarker.template.SimpleCollection;
  import freemarker.template.Template;
  import freemarker.template.TemplateCollectionModel;
  +import freemarker.template.TemplateHashModel;
  import freemarker.template.TemplateHashModelEx;
  import freemarker.template.TemplateModel;
  import freemarker.template.TemplateModelException;
  @@ -46,6 +50,9 @@
  import java.util.HashMap;
  import java.util.Map;
  +import javax.servlet.http.HttpServletRequest;
  +import javax.servlet.http.HttpServletResponse;
  +
  /\*\*
  \* @author Mika Koivisto
  \* @author Tina Tian
  @@ -57,19 +64,29 @@ public FreeMarkerTemplate(
  Configuration configuration,
  TemplateContextHelper templateContextHelper,
  TemplateResourceCache templateResourceCache, boolean restricted,
  - ObjectWrapper objectWrapper) {
  + BeansWrapper beansWrapper, FreeMarkerManager freeMarkerManager) {
  super(templateResource, context, templateContextHelper, restricted);
  \_configuration = configuration;
  \_templateResourceCache = templateResourceCache;
  - \_objectWrapper = objectWrapper;
  + \_beansWrapper = beansWrapper;
  + \_freeMarkerManager = freeMarkerManager;
  if (templateResourceCache.isEnabled()) {
  cacheTemplateResource(templateResourceCache, templateResource);
  }
  }
  + @Override
  + public void prepareTaglib(
  + HttpServletRequest httpServletRequest,
  + HttpServletResponse httpServletResponse) {
  +
  + \_freeMarkerManager.addTaglibSupport(
  + context, httpServletRequest, httpServletResponse, \_beansWrapper);
  + }
  +
  @Override
  protected void handleException(
  TemplateResource templateResource,
  @@ -132,10 +149,10 @@ protected void processTemplate(
  getTemplateResourceUUID(templateResource),
  TemplateConstants.DEFAUT\_ENCODING);
  - template.setObjectWrapper(\_objectWrapper);
  + template.setObjectWrapper(\_beansWrapper);
  template.process(
  - new CachableDefaultMapAdapter(context, \_objectWrapper), writer);
  + new CachableDefaultMapAdapter(context, \_beansWrapper), writer);
  }
  finally {
  TemplateResourceThreadLocal.setTemplateResource(
  @@ -143,12 +160,35 @@ protected void processTemplate(
  }
  }
  + @Override
  + protected Object putClass(String key, Class  clazz) {
  + try {
  + TemplateHashModel templateHashModel =
  + \_beansWrapper.getStaticModels();
  +
  + return context.put(key, templateHashModel.get(clazz.getName()));
  + }
  + catch (TemplateModelException templateModelException) {
  + if (\_log.isWarnEnabled()) {
  + \_log.warn(
  + "Variable " + key + " registration fail",
  + templateModelException);
  + }
  +
  + return null;
  + }
  + }
  +
  private static final TemplateModel \_NULL\_TEMPLATE\_MODEL =
  new TemplateModel() {
  };
  + private static final Log \_log = LogFactoryUtil.getLog(
  + FreeMarkerTemplate.class);
  +
  + private final BeansWrapper \_beansWrapper;
  private final Configuration \_configuration;
  - private final ObjectWrapper \_objectWrapper;
  + private final FreeMarkerManager \_freeMarkerManager;
  private final TemplateResourceCache \_templateResourceCache;
  private class CachableDefaultMapAdapter
  diff --git a/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/FreeMarkerTemplateContextHelper.java b/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/FreeMarkerTemplateContextHelper.java
  index 68b4804a7430b4..89acc4c95a0442 100644
  --- a/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/FreeMarkerTemplateContextHelper.java
  +++ b/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/FreeMarkerTemplateContextHelper.java
  @@ -128,6 +128,14 @@ public void prepare(
  }
  }
  + public void setDefaultBeansWrapper(BeansWrapper defaultBeansWrapper) {
  + \_defaultBeansWrapper = defaultBeansWrapper;
  + }
  +
  + public void setRestrictedBeansWrapper(BeansWrapper restrictedBeansWrapper) {
  + \_restrictedBeansWrapper = restrictedBeansWrapper;
  + }
  +
  @Activate
  @Modified
  protected void activate(Map properties) {
  @@ -140,17 +148,22 @@ protected void activate(Map properties) {
  @Override
  protected void populateExtraHelperUtilities(
  - Map helperUtilities) {
  + Map helperUtilities, boolean restricted) {
  - // Enum util
  + BeansWrapper beansWrapper = \_defaultBeansWrapper;
  - BeansWrapper beansWrapper = FreeMarkerManager.getBeansWrapper();
  + if (restricted) {
  + beansWrapper = \_restrictedBeansWrapper;
  + }
  +
  + // Enum util
  helperUtilities.put("enumUtil", beansWrapper.getEnumModels());
  // Object util
  - helperUtilities.put("objectUtil", new LiferayObjectConstructor());
  + helperUtilities.put(
  + "objectUtil", new LiferayObjectConstructor(beansWrapper));
  // Portlet preferences
  @@ -180,8 +193,10 @@ protected void unregisterTemplateContextContributor(
  \_templateContextContributors.remove(templateContextContributor);
  }
  + private BeansWrapper \_defaultBeansWrapper;
  private volatile FreeMarkerEngineConfiguration
  \_freeMarkerEngineConfiguration;
  + private BeansWrapper \_restrictedBeansWrapper;
  private Set \_restrictedVariables;
  private final List
  \_templateContextContributors = new CopyOnWriteArrayList<>();
  diff --git a/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/LiferayFreeMarkerBeanModel.java b/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/LiferayFreeMarkerStringModel.java
  similarity index 81%
  rename from modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/LiferayFreeMarkerBeanModel.java
  rename to modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/LiferayFreeMarkerStringModel.java
  index c777f4c3172be2..084bd7aaf2f9c7 100644
  --- a/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/LiferayFreeMarkerBeanModel.java
  +++ b/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/LiferayFreeMarkerStringModel.java
  @@ -17,9 +17,9 @@
  import com.liferay.petra.string.StringBundler;
  import com.liferay.portal.kernel.util.StringUtil;
  -import freemarker.ext.beans.BeanModel;
  import freemarker.ext.beans.BeansWrapper;
  import freemarker.ext.beans.InvalidPropertyException;
  +import freemarker.ext.beans.StringModel;
  import freemarker.template.TemplateModel;
  import freemarker.template.TemplateModelException;
  @@ -29,14 +29,21 @@
  /\*\*
  \* @author Marta Medio
  \*/
  -public class LiferayFreeMarkerBeanModel extends BeanModel {
  +public class LiferayFreeMarkerStringModel extends StringModel {
  - public LiferayFreeMarkerBeanModel(Object object, BeansWrapper wrapper) {
  + public LiferayFreeMarkerStringModel(Object object, BeansWrapper wrapper) {
  super(object, wrapper);
  }
  @Override
  public TemplateModel get(String key) throws TemplateModelException {
  + if (\_restrictedMethodNames == null) {
  + throw new InvalidPropertyException(
  + StringBundler.concat(
  + "Denied access to method or field ", key, " of ",
  + object.getClass()));
  + }
  +
  String methodOrFieldName = StringUtil.toLowerCase(key);
  for (String restrictedMethodName : \_restrictedMethodNames) {
  diff --git a/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/LiferayObjectConstructor.java b/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/LiferayObjectConstructor.java
  index c906e37c24f65b..ad56a2af9273fb 100644
  --- a/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/LiferayObjectConstructor.java
  +++ b/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/LiferayObjectConstructor.java
  @@ -28,6 +28,10 @@
  \*/
  public class LiferayObjectConstructor implements TemplateMethodModelEx {
  + public LiferayObjectConstructor(BeansWrapper beansWrapper) {
  + \_beansWrapper = beansWrapper;
  + }
  +
  @Override
  public Object exec(@SuppressWarnings("rawtypes") List arguments)
  throws TemplateModelException {
  @@ -58,12 +62,12 @@ public Object exec(@SuppressWarnings("rawtypes") List arguments)
  }
  }
  - BeansWrapper beansWrapper = FreeMarkerManager.getBeansWrapper();
  -
  - Object object = beansWrapper.newInstance(
  + Object object = \_beansWrapper.newInstance(
  clazz, arguments.subList(1, arguments.size()));
  - return beansWrapper.wrap(object);
  + return \_beansWrapper.wrap(object);
  }
  + private final BeansWrapper \_beansWrapper;
  +
  }
  \ No newline at end of file
  diff --git a/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/RestrictedLiferayObjectWrapper.java b/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/RestrictedLiferayObjectWrapper.java
  index 6b271c0c817af6..ce02849b8b77b6 100644
  --- a/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/RestrictedLiferayObjectWrapper.java
  +++ b/modules/apps/portal-template/portal-template-freemarker/src/main/java/com/liferay/portal/template/freemarker/internal/RestrictedLiferayObjectWrapper.java
  @@ -143,6 +143,11 @@ public RestrictedLiferayObjectWrapper(
  cnfe);
  }
  + if (restrictedClassName.endsWith(StringPool.STAR)) {
  + restrictedClassName = restrictedClassName.substring(
  + 0, restrictedClassName.length() - 1);
  + }
  +
  \_restrictedPackageNames.add(restrictedClassName);
  }
  }
  @@ -163,86 +168,72 @@ public TemplateModel wrap(Object object) throws TemplateModelException {
  String className = clazz.getName();
  - if (!\_allowAllClasses) {
  - \_checkClassIsRestricted(clazz);
  + if (!\_allowAllClasses && \_isRestricted(clazz)) {
  + return \_LIFERAY\_FREEMARKER\_STRING\_MODEL\_FACTORY.create(
  + object, this);
  }
  if (\_restrictedMethodNames.containsKey(className)) {
  - LiferayFreeMarkerBeanModel liferayFreeMarkerBeanModel =
  - (LiferayFreeMarkerBeanModel)
  - \_LIFERAY\_FREEMARKER\_BEAN\_MODEL\_FACTORY.create(object, this);
  + LiferayFreeMarkerStringModel liferayFreeMarkerStringModel =
  + (LiferayFreeMarkerStringModel)
  + \_LIFERAY\_FREEMARKER\_STRING\_MODEL\_FACTORY.create(
  + object, this);
  - liferayFreeMarkerBeanModel.setRestrictedMethodNames(
  + liferayFreeMarkerStringModel.setRestrictedMethodNames(
  \_restrictedMethodNames.get(className));
  - return liferayFreeMarkerBeanModel;
  + return liferayFreeMarkerStringModel;
  }
  return super.wrap(object);
  }
  - private void \_checkClassIsRestricted(Class  clazz)
  - throws TemplateModelException {
  -
  - ClassRestrictionInformation classRestrictionInformation =
  - \_classRestrictionInformations.computeIfAbsent(
  - clazz.getName(),
  - className -> {
  - if (\_allowedClassNames.contains(className)) {
  - return \_nullInstance;
  - }
  -
  - for (Class  restrictedClass : \_restrictedClasses) {
  - if (!restrictedClass.isAssignableFrom(clazz)) {
  - continue;
  - }
  + private boolean \_isRestricted(Class  clazz) {
  + return \_restrictedClassMap.computeIfAbsent(
  + clazz.getName(),
  + className -> {
  + if (\_allowedClassNames.contains(className)) {
  + return false;
  + }
  - return new ClassRestrictionInformation(
  - StringBundler.concat(
  - "Denied resolving class ", className, " by ",
  - restrictedClass.getName()));
  + for (Class  restrictedClass : \_restrictedClasses) {
  + if (!restrictedClass.isAssignableFrom(clazz)) {
  + continue;
  }
  - int index = className.lastIndexOf(StringPool.PERIOD);
  -
  - if (index == -1) {
  - return \_nullInstance;
  - }
  + return true;
  + }
  - String packageName = className.substring(0, index);
  + int index = className.lastIndexOf(StringPool.PERIOD);
  - packageName = packageName.concat(StringPool.PERIOD);
  + if (index == -1) {
  + return false;
  + }
  - for (String restrictedPackageName :
  - \_restrictedPackageNames) {
  + String packageName = className.substring(0, index);
  - if (!packageName.startsWith(restrictedPackageName)) {
  - continue;
  - }
  + packageName = packageName.concat(StringPool.PERIOD);
  - return new ClassRestrictionInformation(
  - StringBundler.concat(
  - "Denied resolving class ", className, " by ",
  - restrictedPackageName));
  + for (String restrictedPackageName : \_restrictedPackageNames) {
  + if (!packageName.startsWith(restrictedPackageName)) {
  + continue;
  }
  - return \_nullInstance;
  - });
  + return true;
  + }
  - if (classRestrictionInformation.isRestricted()) {
  - throw new TemplateModelException(
  - classRestrictionInformation.getDescription());
  - }
  + return false;
  + });
  }
  - private static final ModelFactory \_LIFERAY\_FREEMARKER\_BEAN\_MODEL\_FACTORY =
  + private static final ModelFactory \_LIFERAY\_FREEMARKER\_STRING\_MODEL\_FACTORY =
  new ModelFactory() {
  @Override
  public TemplateModel create(
  Object object, ObjectWrapper objectWrapper) {
  - return new LiferayFreeMarkerBeanModel(
  + return new LiferayFreeMarkerStringModel(
  object, (BeansWrapper)objectWrapper);
  }
  @@ -251,37 +242,12 @@ public TemplateModel create(
  private static final Log \_log = LogFactoryUtil.getLog(
  RestrictedLiferayObjectWrapper.class);
  - private static final ClassRestrictionInformation \_nullInstance =
  - new ClassRestrictionInformation(null);
  -
  private final boolean \_allowAllClasses;
  private final List \_allowedClassNames;
  - private final Map
  - \_classRestrictionInformations = new ConcurrentHashMap<>();
  private final List> \_restrictedClasses;
  + private final Map \_restrictedClassMap =
  + new ConcurrentHashMap<>();
  private final Map> \_restrictedMethodNames;
  private final List \_restrictedPackageNames;
  - private static class ClassRestrictionInformation {
  -
  - public String getDescription() {
  - return \_description;
  - }
  -
  - public boolean isRestricted() {
  - if (\_description == null) {
  - return false;
  - }
  -
  - return true;
  - }
  -
  - private ClassRestrictionInformation(String description) {
  - \_description = description;
  - }
  -
  - private final String \_description;
  -
  - }
  -
  }
  \ No newline at end of file
  diff --git a/modules/apps/portal-template/portal-template-freemarker/src/test/java/com/liferay/portal/template/freemarker/internal/FreeMarkerTemplateTest.java b/modules/apps/portal-template/portal-template-freemarker/src/test/java/com/liferay/portal/template/freemarker/internal/FreeMarkerTemplateTest.java
  index 586999a5b0fa46..11a44d9785d81a 100644
  --- a/modules/apps/portal-template/portal-template-freemarker/src/test/java/com/liferay/portal/template/freemarker/internal/FreeMarkerTemplateTest.java
  +++ b/modules/apps/portal-template/portal-template-freemarker/src/test/java/com/liferay/portal/template/freemarker/internal/FreeMarkerTemplateTest.java
  @@ -27,6 +27,8 @@
  import freemarker.core.ParseException;
  +import freemarker.ext.beans.BeansWrapper;
  +
  import freemarker.template.Configuration;
  import java.io.IOException;
  @@ -93,7 +95,7 @@ public void testGet() throws Exception {
  Template template = new FreeMarkerTemplate(
  new MockTemplateResource(\_TEMPLATE\_FILE\_NAME), null, \_configuration,
  \_templateContextHelper, \_templateResourceCache, false,
  - \_configuration.getObjectWrapper());
  + (BeansWrapper)\_configuration.getObjectWrapper());
  template.put(\_TEST\_KEY, \_TEST\_VALUE);
  @@ -113,7 +115,7 @@ public void testPrepare() throws Exception {
  Template template = new FreeMarkerTemplate(
  new MockTemplateResource(\_TEMPLATE\_FILE\_NAME), null, \_configuration,
  \_templateContextHelper, \_templateResourceCache, false,
  - \_configuration.getObjectWrapper());
  + (BeansWrapper)\_configuration.getObjectWrapper());
  template.put(\_TEST\_KEY, \_TEST\_VALUE);
  @@ -135,7 +137,7 @@ public void testProcessTemplate1() throws Exception {
  Template template = new FreeMarkerTemplate(
  new MockTemplateResource(\_TEMPLATE\_FILE\_NAME), null, \_configuration,
  \_templateContextHelper, \_templateResourceCache, false,
  - \_configuration.getObjectWrapper());
  + (BeansWrapper)\_configuration.getObjectWrapper());
  template.put(\_TEST\_KEY, \_TEST\_VALUE);
  @@ -153,7 +155,7 @@ public void testProcessTemplate2() throws Exception {
  Template template = new FreeMarkerTemplate(
  new MockTemplateResource(\_WRONG\_TEMPLATE\_ID), null, \_configuration,
  \_templateContextHelper, \_templateResourceCache, false,
  - \_configuration.getObjectWrapper());
  + (BeansWrapper)\_configuration.getObjectWrapper());
  template.put(\_TEST\_KEY, \_TEST\_VALUE);
  @@ -177,7 +179,8 @@ public void testProcessTemplate3() throws Exception {
  new StringTemplateResource(
  \_WRONG\_TEMPLATE\_ID, \_TEST\_TEMPLATE\_CONTENT),
  null, \_configuration, \_templateContextHelper,
  - \_templateResourceCache, false, \_configuration.getObjectWrapper());
  + \_templateResourceCache, false,
  + (BeansWrapper)\_configuration.getObjectWrapper());
  template.put(\_TEST\_KEY, \_TEST\_VALUE);
  @@ -195,7 +198,7 @@ public void testProcessTemplate4() throws Exception {
  Template template = new FreeMarkerTemplate(
  new MockTemplateResource(\_TEMPLATE\_FILE\_NAME), null, \_configuration,
  \_templateContextHelper, \_templateResourceCache, false,
  - \_configuration.getObjectWrapper());
  + (BeansWrapper)\_configuration.getObjectWrapper());
  template.put(\_TEST\_KEY, \_TEST\_VALUE);
  @@ -215,7 +218,7 @@ public void testProcessTemplate5() throws Exception {
  Template template = new FreeMarkerTemplate(
  new MockTemplateResource(\_WRONG\_TEMPLATE\_ID), null, \_configuration,
  \_templateContextHelper, \_templateResourceCache, false,
  - \_configuration.getObjectWrapper());
  + (BeansWrapper)\_configuration.getObjectWrapper());
  template.put(\_TEST\_KEY, \_TEST\_VALUE);
  @@ -235,7 +238,7 @@ public void testProcessTemplate6() throws Exception {
  Template template = new FreeMarkerTemplate(
  new MockTemplateResource(\_WRONG\_TEMPLATE\_ID), null, \_configuration,
  \_templateContextHelper, \_templateResourceCache, false,
  - \_configuration.getObjectWrapper());
  + (BeansWrapper)\_configuration.getObjectWrapper());
  template.put(\_TEST\_KEY, \_TEST\_VALUE);
  @@ -261,7 +264,7 @@ public void testProcessTemplate7() throws Exception {
  Template template = new FreeMarkerTemplate(
  new MockTemplateResource(\_WRONG\_TEMPLATE\_ID), null, \_configuration,
  \_templateContextHelper, \_templateResourceCache, false,
  - \_configuration.getObjectWrapper());
  + (BeansWrapper)\_configuration.getObjectWrapper());
  template.put(\_TEST\_KEY, \_TEST\_VALUE);
  @@ -286,7 +289,7 @@ public void testProcessTemplate8() throws Exception {
  Template template = new FreeMarkerTemplate(
  new MockTemplateResource(\_TEMPLATE\_FILE\_NAME), context,
  \_configuration, \_templateContextHelper, \_templateResourceCache,
  - false, \_configuration.getObjectWrapper());
  + false, (BeansWrapper)\_configuration.getObjectWrapper());
  UnsyncStringWriter unsyncStringWriter = new UnsyncStringWriter();
  diff --git a/modules/apps/portal-template/portal-template-freemarker/src/test/java/com/liferay/portal/template/freemarker/internal/RestrictedLiferayObjectWrapperTest.java b/modules/apps/portal-template/portal-template-freemarker/src/test/java/com/liferay/portal/template/freemarker/internal/RestrictedLiferayObjectWrapperTest.java
  index 0f6db659e2a202..faa6d9174a3f5b 100644
  --- a/modules/apps/portal-template/portal-template-freemarker/src/test/java/com/liferay/portal/template/freemarker/internal/RestrictedLiferayObjectWrapperTest.java
  +++ b/modules/apps/portal-template/portal-template-freemarker/src/test/java/com/liferay/portal/template/freemarker/internal/RestrictedLiferayObjectWrapperTest.java
  @@ -171,15 +171,15 @@ public void testRestrictedMethodNames() throws Exception {
  Assert.assertThat(
  templateModel,
  - CoreMatchers.instanceOf(LiferayFreeMarkerBeanModel.class));
  + CoreMatchers.instanceOf(LiferayFreeMarkerStringModel.class));
  - LiferayFreeMarkerBeanModel liferayFreeMarkerBeanModel =
  - (LiferayFreeMarkerBeanModel)templateModel;
  + LiferayFreeMarkerStringModel liferayFreeMarkerStringModel =
  + (LiferayFreeMarkerStringModel)templateModel;
  - \_testRestrictedMethodNames(liferayFreeMarkerBeanModel, "name");
  - \_testRestrictedMethodNames(liferayFreeMarkerBeanModel, "Name");
  - \_testRestrictedMethodNames(liferayFreeMarkerBeanModel, "getName");
  - \_testRestrictedMethodNames(liferayFreeMarkerBeanModel, "getname");
  + \_testRestrictedMethodNames(liferayFreeMarkerStringModel, "name");
  + \_testRestrictedMethodNames(liferayFreeMarkerStringModel, "Name");
  + \_testRestrictedMethodNames(liferayFreeMarkerStringModel, "getName");
  + \_testRestrictedMethodNames(liferayFreeMarkerStringModel, "getname");
  }
  @Test
  @@ -269,10 +269,10 @@ private void \_testCheckClassIsRestricted(
  }
  private void \_testRestrictedMethodNames(
  - LiferayFreeMarkerBeanModel liferayFreeMarkerBeanModel, String key) {
  + LiferayFreeMarkerStringModel liferayFreeMarkerStringModel, String key) {
  try {
  - liferayFreeMarkerBeanModel.get(key);
  + liferayFreeMarkerStringModel.get(key);
  Assert.assertNull("Should throw TemplateModelException for " + key);
  }
  diff --git a/modules/apps/portal-template/portal-template-velocity/build.gradle b/modules/apps/portal-template/portal-template-velocity/build.gradle
  index 1afc0768a8d773..5be34196fd1845 100644
  --- a/modules/apps/portal-template/portal-template-velocity/build.gradle
  +++ b/modules/apps/portal-template/portal-template-velocity/build.gradle
  @@ -9,7 +9,7 @@ dependencies {
  compileOnly group: "com.liferay", name: "com.liferay.petra.reflect", version: "3.0.0"
  compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "3.0.0"
  compileOnly group: "com.liferay", name: "com.liferay.portal.configuration.metatype.api", version: "2.0.0"
  - compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "4.4.0"
  + compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "default"
  compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "4.34.0"
  compileOnly group: "com.liferay.portal", name: "com.liferay.util.taglib", version: "4.0.0"
  compileOnly group: "commons-collections", name: "commons-collections", version: "3.2.2"
  diff --git a/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/configuration/VelocityEngineConfiguration.java b/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/configuration/VelocityEngineConfiguration.java
  index cfd79fc64270f7..cee318bd7ff5b3 100644
  --- a/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/configuration/VelocityEngineConfiguration.java
  +++ b/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/configuration/VelocityEngineConfiguration.java
  @@ -54,8 +54,8 @@ public interface VelocityEngineConfiguration {
  public String[] restrictedMethods();
  @Meta.AD(
  - deflt = "java.lang.reflect", name = "restricted-packages",
  - required = false
  + deflt = "com.liferay.portal.spring.context|com.ibm|io.undertow|java.lang.reflect|org.apache|org.glassfish|org.jboss|org.springframework|org.wildfly|weblogic",
  + name = "restricted-packages", required = false
  )
  public String[] restrictedPackages();
  diff --git a/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/VelocityManager.java b/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/VelocityManager.java
  index f290aa4ffde3ce..0d7dc297fd8417 100644
  --- a/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/VelocityManager.java
  +++ b/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/VelocityManager.java
  @@ -63,9 +63,13 @@
  )
  public class VelocityManager extends BaseTemplateManager {
  + /\*\*
  + \* @deprecated As of Athanasius (7.3.x), with no direct replacement
  + \*/
  + @Deprecated
  @Override
  - public void addTaglibTheme(
  - Map contextObjects, String themeName,
  + public void addTaglibSupport(
  + Map contextObjects,
  HttpServletRequest httpServletRequest,
  HttpServletResponse httpServletResponse) {
  @@ -73,7 +77,7 @@ public void addTaglibTheme(
  httpServletRequest.getServletContext(), httpServletRequest,
  httpServletResponse, contextObjects);
  - contextObjects.put(themeName, velocityTaglib);
  + contextObjects.put("taglibLiferay", velocityTaglib);
  contextObjects.put("velocityTaglib\_layoutIcon", \_layoutIconMethod);
  diff --git a/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/VelocityTemplate.java b/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/VelocityTemplate.java
  index 2fcd88ec9e5a4c..69851446c135e8 100644
  --- a/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/VelocityTemplate.java
  +++ b/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/VelocityTemplate.java
  @@ -22,11 +22,16 @@
  import com.liferay.portal.template.BaseTemplate;
  import com.liferay.portal.template.TemplateContextHelper;
  import com.liferay.portal.template.TemplateResourceThreadLocal;
  +import com.liferay.taglib.util.VelocityTaglib;
  +import com.liferay.taglib.util.VelocityTaglibImpl;
  import java.io.Writer;
  import java.util.Map;
  +import javax.servlet.http.HttpServletRequest;
  +import javax.servlet.http.HttpServletResponse;
  +
  import org.apache.velocity.Template;
  import org.apache.velocity.VelocityContext;
  import org.apache.velocity.app.VelocityEngine;
  @@ -55,6 +60,22 @@ public VelocityTemplate(
  }
  }
  + @Override
  + public void prepareTaglib(
  + HttpServletRequest httpServletRequest,
  + HttpServletResponse httpServletResponse) {
  +
  + VelocityTaglib velocityTaglib = new VelocityTaglibImpl(
  + httpServletRequest.getServletContext(), httpServletRequest,
  + httpServletResponse, context);
  +
  + context.put("taglibLiferay", velocityTaglib);
  +
  + // Legacy support
  +
  + context.put("theme", velocityTaglib);
  + }
  +
  @Override
  protected void handleException(
  TemplateResource templateResource,
  diff --git a/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/VelocityTemplateContextHelper.java b/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/VelocityTemplateContextHelper.java
  index 253ff074c777ed..3d445b224727aa 100644
  --- a/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/VelocityTemplateContextHelper.java
  +++ b/modules/apps/portal-template/portal-template-velocity/src/main/java/com/liferay/portal/template/velocity/internal/VelocityTemplateContextHelper.java
  @@ -146,7 +146,7 @@ protected void activate(Map properties) {
  @Override
  protected void populateExtraHelperUtilities(
  - Map velocityContext) {
  + Map velocityContext, boolean restrict) {
  // Date tool
  diff --git a/modules/apps/portlet-display-template/portlet-display-template-impl/build.gradle b/modules/apps/portlet-display-template/portlet-display-template-impl/build.gradle
  index 70ec4891ee9c28..f49c90472b91fb 100644
  --- a/modules/apps/portlet-display-template/portlet-display-template-impl/build.gradle
  +++ b/modules/apps/portlet-display-template/portlet-display-template-impl/build.gradle
  @@ -6,7 +6,7 @@ dependencies {
  compileOnly group: "com.liferay", name: "com.liferay.petra.model.adapter", version: "3.1.0"
  compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "3.0.0"
  compileOnly group: "com.liferay", name: "com.liferay.portlet.display.template.api", version: "2.0.0"
  - compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "4.0.0"
  + compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "default"
  compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "4.34.0"
  compileOnly group: "com.liferay.portal", name: "com.liferay.util.taglib", version: "4.0.0"
  compileOnly group: "javax.portlet", name: "portlet-api", version: "3.0.1"
  diff --git a/modules/apps/portlet-display-template/portlet-display-template-impl/src/main/java/com/liferay/portlet/display/template/internal/PortletDisplayTemplateImpl.java b/modules/apps/portlet-display-template/portlet-display-template-impl/src/main/java/com/liferay/portlet/display/template/internal/PortletDisplayTemplateImpl.java
  index fb08b7add81be1..483cd4d868f030 100644
  --- a/modules/apps/portlet-display-template/portlet-display-template-impl/src/main/java/com/liferay/portlet/display/template/internal/PortletDisplayTemplateImpl.java
  +++ b/modules/apps/portlet-display-template/portlet-display-template-impl/src/main/java/com/liferay/portlet/display/template/internal/PortletDisplayTemplateImpl.java
  @@ -29,8 +29,6 @@
  import com.liferay.portal.kernel.template.TemplateConstants;
  import com.liferay.portal.kernel.template.TemplateHandler;
  import com.liferay.portal.kernel.template.TemplateHandlerRegistryUtil;
  -import com.liferay.portal.kernel.template.TemplateManager;
  -import com.liferay.portal.kernel.template.TemplateManagerUtil;
  import com.liferay.portal.kernel.template.TemplateVariableGroup;
  import com.liferay.portal.kernel.theme.ThemeDisplay;
  import com.liferay.portal.kernel.util.ArrayUtil;
  @@ -469,27 +467,14 @@ else if (portletResponse instanceof ResourceResponse) {
  contextObjects.put(
  TemplateConstants.CLASS\_NAME\_ID, ddmTemplate.getClassNameId());
  - TemplateManager templateManager =
  - TemplateManagerUtil.getTemplateManager(ddmTemplate.getLanguage());
  -
  TemplateHandler templateHandler =
  TemplateHandlerRegistryUtil.getTemplateHandler(
  ddmTemplate.getClassNameId());
  - templateManager.addContextObjects(
  - contextObjects, templateHandler.getCustomContextObjects());
  -
  - // Taglibs
  -
  - templateManager.addTaglibSupport(
  - contextObjects, httpServletRequest, httpServletResponse);
  + contextObjects.putAll(templateHandler.getCustomContextObjects());
  UnsyncStringWriter unsyncStringWriter = new UnsyncStringWriter();
  - templateManager.addTaglibTheme(
  - contextObjects, "taglibLiferay", httpServletRequest,
  - new PipingServletResponse(httpServletResponse, unsyncStringWriter));
  -
  contextObjects.put(TemplateConstants.WRITER, unsyncStringWriter);
  if (portletRequest != null) {
  @@ -498,7 +483,8 @@ else if (portletResponse instanceof ResourceResponse) {
  return transformer.transform(
  themeDisplay, contextObjects, ddmTemplate.getScript(),
  - ddmTemplate.getLanguage(), unsyncStringWriter);
  + ddmTemplate.getLanguage(), unsyncStringWriter, httpServletRequest,
  + new PipingServletResponse(httpServletResponse, unsyncStringWriter));
  }
  @Override
  diff --git a/modules/apps/server/server-admin-web/build.gradle b/modules/apps/server/server-admin-web/build.gradle
  index 683e5f9df5d0d5..23122bd514932c 100644
  --- a/modules/apps/server/server-admin-web/build.gradle
  +++ b/modules/apps/server/server-admin-web/build.gradle
  @@ -1,6 +1,6 @@
  dependencies {
  - compileInclude group: "jfree", name: "jcommon", version: "1.0.16"
  - compileInclude group: "jfree", name: "jfreechart", version: "1.0.13"
  + compileInclude group: "org.jfree", name: "jcommon", version: "1.0.24"
  + compileInclude group: "org.jfree", name: "jfreechart", version: "1.0.19"
  compileOnly group: "biz.aQute.bnd", name: "biz.aQute.bnd.annotation", version: "4.2.0"
  compileOnly group: "com.liferay", name: "com.liferay.application.list.api", version: "4.0.0"
  diff --git a/modules/apps/sharing/sharing-web/src/main/java/com/liferay/sharing/web/internal/display/context/util/SharingJavaScriptFactoryImpl.java b/modules/apps/sharing/sharing-web/src/main/java/com/liferay/sharing/web/internal/display/context/util/SharingJavaScriptFactoryImpl.java
  index 265a2f19608a37..403f3c1deb4c39 100644
  --- a/modules/apps/sharing/sharing-web/src/main/java/com/liferay/sharing/web/internal/display/context/util/SharingJavaScriptFactoryImpl.java
  +++ b/modules/apps/sharing/sharing-web/src/main/java/com/liferay/sharing/web/internal/display/context/util/SharingJavaScriptFactoryImpl.java
  @@ -24,6 +24,7 @@
  import com.liferay.portal.kernel.log.LogFactoryUtil;
  import com.liferay.portal.kernel.service.ClassNameLocalService;
  import com.liferay.portal.kernel.util.Html;
  +import com.liferay.portal.kernel.util.HtmlUtil;
  import com.liferay.portal.kernel.util.JavaConstants;
  import com.liferay.portal.kernel.util.Portal;
  import com.liferay.portal.kernel.util.ResourceBundleUtil;
  @@ -70,7 +71,8 @@ public String createSharingOnClickMethod(
  "Liferay.Sharing.share(",
  \_classNameLocalService.getClassNameId(className), ", ", classPK,
  ", '",
  - \_getSharingDialogTitle(className, classPK, httpServletRequest),
  + HtmlUtil.escapeJS(
  + \_getSharingDialogTitle(className, classPK, httpServletRequest)),
  "', '", \_getNamespace(httpServletRequest), "', false)");
  }
  @@ -126,8 +128,7 @@ private String \_getSharingDialogTitle(
  String title = \_getAssetTitle(className, classPK, locale);
  if (Validator.isNotNull(title)) {
  - return \_language.format(
  - resourceBundle, "share-x", \_html.escapeJS(title));
  + return \_language.format(resourceBundle, "share-x", title);
  }
  return \_language.get(resourceBundle, "share");
  diff --git a/modules/apps/sharing/sharing-web/src/main/resources/META-INF/resources/dynamic\_include/bottom.jsp b/modules/apps/sharing/sharing-web/src/main/resources/META-INF/resources/dynamic\_include/bottom.jsp
  index 09484aee4c87f8..22d454b1c9122f 100644
  --- a/modules/apps/sharing/sharing-web/src/main/resources/META-INF/resources/dynamic\_include/bottom.jsp
  +++ b/modules/apps/sharing/sharing-web/src/main/resources/META-INF/resources/dynamic\_include/bottom.jsp
  @@ -46,7 +46,7 @@ sharingURL.setWindowState(LiferayWindowState.POP\_UP);
  }
  },
  id: 'sharingDialog',
  - title: title,
  + title: Liferay.Util.escapeHTML(title),
  uri: uri
  });
  }
  diff --git a/modules/apps/site-navigation/site-navigation-menu-web/src/main/resources/META-INF/resources/configuration.jsp b/modules/apps/site-navigation/site-navigation-menu-web/src/main/resources/META-INF/resources/configuration.jsp
  index d6b6bab3227379..ea420e958fe1ec 100644
  --- a/modules/apps/site-navigation/site-navigation-menu-web/src/main/resources/META-INF/resources/configuration.jsp
  +++ b/modules/apps/site-navigation/site-navigation-menu-web/src/main/resources/META-INF/resources/configuration.jsp
  @@ -168,7 +168,7 @@ else {
  - <%= rootMenuItemName %>
  + <%= HtmlUtil.escape(rootMenuItemName) %>

diff --git a/modules/apps/staging/staging-taglib/src/main/resources/META-INF/resources/process\_summary\_link/page.jsp b/modules/apps/staging/staging-taglib/src/main/resources/META-INF/resources/process\_summary\_link/page.jsp
index 3fc7102aef91e4..ff8044c0d04a2f 100644
--- a/modules/apps/staging/staging-taglib/src/main/resources/META-INF/resources/process\_summary\_link/page.jsp
+++ b/modules/apps/staging/staging-taglib/src/main/resources/META-INF/resources/process\_summary\_link/page.jsp
@@ -24,7 +24,7 @@
<%
BackgroundTaskDisplay backgroundTaskDisplay = BackgroundTaskDisplayFactoryUtil.getBackgroundTaskDisplay(backgroundTask);
-String taglibOnClick = liferayPortletResponse.getNamespace() + "showProcessSummary(" + String.valueOf(backgroundTask.getBackgroundTaskId()) + ", '" + HtmlUtil.escapeJS(backgroundTaskDisplay.getDisplayName(request)) + "', '" + HtmlUtil.escape(processSummaryURL) + "');";
+String taglibOnClick = liferayPortletResponse.getNamespace() + "showProcessSummary(" + String.valueOf(backgroundTask.getBackgroundTaskId()) + ", '" + HtmlUtil.escapeJS(backgroundTaskDisplay.getDisplayName(request)) + "', '" + HtmlUtil.escapeJS(processSummaryURL) + "');";
%>
<%
-String redirect = ParamUtil.getString(request, "redirect");
+String backURL = ParamUtil.getString(request, "backURL");
+
+PortletURL homeURL = renderResponse.createRenderURL();
+
+homeURL.setParameter("mvcPath", "/view.jsp");
+
+if (Validator.isNull(backURL)) {
+ backURL = homeURL.toString();
+}
long userGroupId = ParamUtil.getLong(request, "userGroupId");
@@ -35,14 +43,10 @@ else {
}
portletDisplay.setShowBackIcon(true);
-portletDisplay.setURLBack(redirect);
+portletDisplay.setURLBack(backURL);
renderResponse.setTitle(userGroup.getName());
-PortletURL homeURL = renderResponse.createRenderURL();
-
-homeURL.setParameter("mvcPath", "/view.jsp");
-
PortalUtil.addPortletBreadcrumbEntry(request, LanguageUtil.get(request, "user-groups"), homeURL.toString());
PortalUtil.addPortletBreadcrumbEntry(request, userGroup.getName(), null);
diff --git a/modules/apps/wiki/wiki-web/src/main/java/com/liferay/wiki/web/internal/display/context/DefaultWikiListPagesDisplayContext.java b/modules/apps/wiki/wiki-web/src/main/java/com/liferay/wiki/web/internal/display/context/DefaultWikiListPagesDisplayContext.java
index 39c80de692045e..f10f422701674d 100644
--- a/modules/apps/wiki/wiki-web/src/main/java/com/liferay/wiki/web/internal/display/context/DefaultWikiListPagesDisplayContext.java
+++ b/modules/apps/wiki/wiki-web/src/main/java/com/liferay/wiki/web/internal/display/context/DefaultWikiListPagesDisplayContext.java
@@ -698,7 +698,7 @@ protected void addPrintPageMenuItem(
portletURL.setParameter("viewMode", Constants.PRINT);
portletURL.setWindowState(LiferayWindowState.POP\_UP);
- sb.append(portletURL.toString());
+ sb.append(HtmlUtil.escapeJS(portletURL.toString()));
sb.append("', '', 'directories=0,height=480,left=80,location=1,");
sb.append("menubar=1,resizable=1,scrollbars=yes,status=0,");
diff --git a/modules/source-formatter.properties b/modules/source-formatter.properties
index 1bf8a4c8c609ef..ea9991e4888de2 100644
--- a/modules/source-formatter.properties
+++ b/modules/source-formatter.properties
@@ -24,9 +24,12 @@
javax.portlet:portlet-api:3.0.1,\
javax.servlet:javax.servlet-api:3.1.0,\
org.apache.ant:ant:1.9.14,\
+ org.apache.commons:commons-compress:1.19,\
org.apache.felix:org.apache.felix.http.servlet-api:1.1.2,\
org.jboss.arquillian.junit:arquillian-junit-container:1.1.10.Final,\
org.jdom:jdom:1.1.3,\
+ org.jfree:jcommon:1.0.24,\
+ org.jfree:jfreechart:1.0.19,\
org.jsoup:jsoup:1.10.2,\
org.osgi:org.osgi.annotation.versioning:1.1.0,\
org.osgi:org.osgi.dto:1.1.0,\
diff --git a/portal-impl/src/com/liferay/portal/layoutconfiguration/util/RuntimePageImpl.java b/portal-impl/src/com/liferay/portal/layoutconfiguration/util/RuntimePageImpl.java
index 07944108e8e525..bc3871c7f85472 100644
--- a/portal-impl/src/com/liferay/portal/layoutconfiguration/util/RuntimePageImpl.java
+++ b/portal-impl/src/com/liferay/portal/layoutconfiguration/util/RuntimePageImpl.java
@@ -437,8 +437,8 @@ protected StringBundler doProcessTemplate(
UnsyncStringWriter unsyncStringWriter = new UnsyncStringWriter();
- templateManager.addTaglibTheme(
- template, "taglibLiferay", httpServletRequest,
+ template.prepareTaglib(
+ httpServletRequest,
new PipingServletResponse(httpServletResponse, unsyncStringWriter));
try {
diff --git a/portal-impl/src/com/liferay/portal/template/BaseTemplate.java b/portal-impl/src/com/liferay/portal/template/BaseTemplate.java
index dd1a8fa4443256..f6ef3f949a7b1c 100644
--- a/portal-impl/src/com/liferay/portal/template/BaseTemplate.java
+++ b/portal-impl/src/com/liferay/portal/template/BaseTemplate.java
@@ -32,6 +32,7 @@
import java.util.function.Supplier;
import javax.servlet.http.HttpServletRequest;
+import javax.servlet.http.HttpServletResponse;
/\*\*
\* @author Tina Tian
@@ -121,6 +122,12 @@ public void prepare(HttpServletRequest httpServletRequest) {
\_templateContextHelper.prepare(this, httpServletRequest);
}
+ @Override
+ public void prepareTaglib(
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse) {
+ }
+
@Override
public void processTemplate(Writer writer) throws TemplateException {
try {
@@ -194,6 +201,10 @@ public Object put(String key, Object value) {
}
}
+ if (value instanceof Class) {
+ return putClass(key, (Class )value);
+ }
+
return context.put(key, value);
}
@@ -253,6 +264,10 @@ protected abstract void processTemplate(
TemplateResource templateResource, Writer writer)
throws Exception;
+ protected Object putClass(String key, Class  clazz) {
+ return context.put(key, clazz);
+ }
+
protected Map context;
private final boolean \_restricted;
diff --git a/portal-impl/src/com/liferay/portal/template/BaseTemplateManager.java b/portal-impl/src/com/liferay/portal/template/BaseTemplateManager.java
index 06d4d330244db5..56855e72d2f3af 100644
--- a/portal-impl/src/com/liferay/portal/template/BaseTemplateManager.java
+++ b/portal-impl/src/com/liferay/portal/template/BaseTemplateManager.java
@@ -30,6 +30,10 @@
\*/
public abstract class BaseTemplateManager implements TemplateManager {
+ /\*\*
+ \* @deprecated As of Athanasius (7.3.x), with no direct replacement
+ \*/
+ @Deprecated
@Override
public void addContextObjects(
Map contextObjects,
@@ -54,24 +58,40 @@ public void addContextObjects(
}
}
+ /\*\*
+ \* @deprecated As of Athanasius (7.3.x), with no direct replacement
+ \*/
+ @Deprecated
@Override
public void addStaticClassSupport(
Map contextObjects, String variableName,
Class  variableClass) {
}
+ /\*\*
+ \* @deprecated As of Athanasius (7.3.x), with no direct replacement
+ \*/
+ @Deprecated
@Override
public void addTaglibApplication(
Map contextObjects, String applicationName,
ServletContext servletContext) {
}
+ /\*\*
+ \* @deprecated As of Athanasius (7.3.x), with no direct replacement
+ \*/
+ @Deprecated
@Override
public void addTaglibFactory(
Map contextObjects, String taglibLiferayHash,
ServletContext servletContext) {
}
+ /\*\*
+ \* @deprecated As of Athanasius (7.3.x), with no direct replacement
+ \*/
+ @Deprecated
@Override
public void addTaglibRequest(
Map contextObjects, String applicationName,
@@ -79,6 +99,10 @@ public void addTaglibRequest(
HttpServletResponse httpServletResponse) {
}
+ /\*\*
+ \* @deprecated As of Athanasius (7.3.x), with no direct replacement
+ \*/
+ @Deprecated
@Override
public void addTaglibSupport(
Map contextObjects,
@@ -86,6 +110,10 @@ public void addTaglibSupport(
HttpServletResponse httpServletResponse) {
}
+ /\*\*
+ \* @deprecated As of Athanasius (7.3.x), with no direct replacement
+ \*/
+ @Deprecated
@Override
public void addTaglibTheme(
Map contextObjects, String themeName,
diff --git a/portal-impl/src/com/liferay/portal/template/RestrictedTemplate.java b/portal-impl/src/com/liferay/portal/template/RestrictedTemplate.java
index 614faf55069f82..568b7d19a13b9b 100644
--- a/portal-impl/src/com/liferay/portal/template/RestrictedTemplate.java
+++ b/portal-impl/src/com/liferay/portal/template/RestrictedTemplate.java
@@ -26,6 +26,7 @@
import java.util.function.Supplier;
import javax.servlet.http.HttpServletRequest;
+import javax.servlet.http.HttpServletResponse;
/\*\*
\* @author Tina Tian
@@ -81,6 +82,14 @@ public void prepare(HttpServletRequest httpServletRequest) {
\_template.prepare(httpServletRequest);
}
+ @Override
+ public void prepareTaglib(
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse) {
+
+ \_template.prepareTaglib(httpServletRequest, httpServletResponse);
+ }
+
@Override
public void processTemplate(Writer writer) throws TemplateException {
\_template.processTemplate(writer);
diff --git a/portal-impl/src/com/liferay/portal/template/TemplateContextHelper.java b/portal-impl/src/com/liferay/portal/template/TemplateContextHelper.java
index ccc5c5f8c5b1fc..1b329c4b628487 100644
--- a/portal-impl/src/com/liferay/portal/template/TemplateContextHelper.java
+++ b/portal-impl/src/com/liferay/portal/template/TemplateContextHelper.java
@@ -186,7 +186,7 @@ public Map getHelperUtilities(
Map helperUtilities = new HashMap<>();
populateCommonHelperUtilities(helperUtilities);
- populateExtraHelperUtilities(helperUtilities);
+ populateExtraHelperUtilities(helperUtilities, restricted);
if (restricted) {
Set restrictedVariables = getRestrictedVariables();
@@ -860,9 +860,18 @@ protected void populateDeprecatedCommonHelperUtilities(
}
}
+ /\*\*
+ \* @deprecated As of Athanasius (7.3.x), replaced by {@link
+ \* #populateExtraHelperUtilities(Map, boolean)}
+ \*/
+ @Deprecated
protected void populateExtraHelperUtilities(Map variables) {
}
+ protected void populateExtraHelperUtilities(
+ Map variables, boolean restricted) {
+ }
+
protected void prepareTiles(
Map contextObjects,
HttpServletRequest httpServletRequest) {
diff --git a/portal-impl/src/com/liferay/portal/template/packageinfo b/portal-impl/src/com/liferay/portal/template/packageinfo
index e68b954f617fab..bbcbfe4fb3b987 100644
--- a/portal-impl/src/com/liferay/portal/template/packageinfo
+++ b/portal-impl/src/com/liferay/portal/template/packageinfo
@@ -1 +1 @@
-version 2.1.1
\ No newline at end of file
+version 2.2.0
\ No newline at end of file
diff --git a/portal-impl/src/com/liferay/portal/templateparser/Transformer.java b/portal-impl/src/com/liferay/portal/templateparser/Transformer.java
index 2aa68469ea135d..538d691f4c51b2 100644
--- a/portal-impl/src/com/liferay/portal/templateparser/Transformer.java
+++ b/portal-impl/src/com/liferay/portal/templateparser/Transformer.java
@@ -41,6 +41,9 @@
import java.util.HashMap;
import java.util.Map;
+import javax.servlet.http.HttpServletRequest;
+import javax.servlet.http.HttpServletResponse;
+
/\*\*
\* @author Brian Wing Shun Chan
\* @author Raymond Aug
@@ -85,7 +88,9 @@ public Transformer(
public String transform(
ThemeDisplay themeDisplay, Map contextObjects,
String script, String langType,
- UnsyncStringWriter unsyncStringWriter)
+ UnsyncStringWriter unsyncStringWriter,
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse)
throws Exception {
if (Validator.isNull(langType)) {
@@ -136,6 +141,8 @@ public String transform(
template.put("siteGroupId", siteGroupId);
template.put("templatesPath", templatesPath);
+ template.prepareTaglib(httpServletRequest, httpServletResponse);
+
// Deprecated variables
template.put("groupId", scopeGroupId);
diff --git a/portal-impl/src/com/liferay/portal/util/HttpImpl.java b/portal-impl/src/com/liferay/portal/util/HttpImpl.java
index 16bc8177b71534..02f023dab6f5bf 100644
--- a/portal-impl/src/com/liferay/portal/util/HttpImpl.java
+++ b/portal-impl/src/com/liferay/portal/util/HttpImpl.java
@@ -14,6 +14,7 @@
package com.liferay.portal.util;
+import com.liferay.petra.lang.CentralizedThreadLocal;
import com.liferay.petra.memory.FinalizeAction;
import com.liferay.petra.memory.FinalizeManager;
import com.liferay.petra.string.CharPool;
@@ -53,6 +54,7 @@
import java.util.ArrayList;
import java.util.Date;
+import java.util.HashMap;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;
@@ -502,14 +504,8 @@ public String getDomain(String url) {
return url;
}
- url = url.trim();
-
- if (\_getProtocolDelimiterIndex(url) < 0) {
- url = Http.HTTPS\_WITH\_SLASH + url;
- }
-
try {
- URI uri = new URI(url);
+ URI uri = \_getURI(url);
String host = uri.getHost();
@@ -599,20 +595,20 @@ public String getPath(String url) {
return url;
}
- if (url.startsWith(Http.HTTP)) {
- int pos = url.indexOf(
- CharPool.SLASH, Http.HTTPS\_WITH\_SLASH.length());
+ try {
+ URI uri = \_getURI(url);
- url = url.substring(pos);
- }
+ String path = uri.getPath();
- int pos = url.indexOf(CharPool.QUESTION);
+ if (path == null) {
+ return StringPool.BLANK;
+ }
- if (pos == -1) {
- return url;
+ return path;
+ }
+ catch (URISyntaxException uriSyntaxException) {
+ return StringPool.BLANK;
}
-
- return url.substring(0, pos);
}
@Override
@@ -641,15 +637,24 @@ public String getProtocol(RenderRequest renderRequest) {
@Override
public String getProtocol(String url) {
- url = url.trim();
+ if (Validator.isNull(url)) {
+ return url;
+ }
- int index = \_getProtocolDelimiterIndex(url);
+ try {
+ URI uri = \_getURI(url);
- if (index > 0) {
- return url.substring(0, index);
- }
+ String scheme = uri.getScheme();
- return StringPool.BLANK;
+ if (scheme == null) {
+ return StringPool.BLANK;
+ }
+
+ return scheme;
+ }
+ catch (URISyntaxException uriSyntaxException) {
+ return StringPool.BLANK;
+ }
}
@Override
@@ -658,13 +663,20 @@ public String getQueryString(String url) {
return url;
}
- int pos = url.indexOf(CharPool.QUESTION);
+ try {
+ URI uri = \_getURI(url);
- if (pos == -1) {
+ String queryString = uri.getQuery();
+
+ if (queryString == null) {
+ return StringPool.BLANK;
+ }
+
+ return queryString;
+ }
+ catch (URISyntaxException uriSyntaxException) {
return StringPool.BLANK;
}
-
- return url.substring(pos + 1);
}
@Override
@@ -683,11 +695,11 @@ public boolean hasDomain(String url) {
@Override
public boolean hasProtocol(String url) {
- if (\_getProtocolDelimiterIndex(url) > 0) {
- return true;
+ if (Validator.isNull(url)) {
+ return false;
}
- return false;
+ return Validator.isNotNull(getProtocol(url));
}
@Override
@@ -1091,12 +1103,20 @@ public String removePathParameters(String uri) {
@Override
public String removeProtocol(String url) {
- url = url.trim();
+ String protocol = getProtocol(url);
+
+ if (Validator.isNotNull(protocol)) {
+ url = url.trim();
- int index = \_getProtocolDelimiterIndex(url);
+ if (url.regionMatches(
+ protocol.length(), PROTOCOL\_DELIMITER, 0,
+ PROTOCOL\_DELIMITER.length())) {
- if (index > 0) {
- return url.substring(index + PROTOCOL\_DELIMITER.length());
+ return url.substring(
+ protocol.length() + PROTOCOL\_DELIMITER.length());
+ }
+
+ return url.substring(protocol.length() + StringPool.COLON.length());
}
return url;
@@ -1719,7 +1739,7 @@ protected InputStream URLtoInputStream(
URI uri = null;
try {
- uri = new URI(location);
+ uri = \_getURI(location);
}
catch (URISyntaxException urise) {
throw new IOException("Invalid URI: " + location, urise);
@@ -1740,7 +1760,7 @@ else if (!location.startsWith(Http.HTTP\_WITH\_SLASH) &&
location = Http.HTTP\_WITH\_SLASH + location;
- uri = new URI(location);
+ uri = \_getURI(location);
}
HttpHost targetHttpHost = new HttpHost(
@@ -1997,32 +2017,20 @@ public void close() throws IOException {
}
}
- private int \_getProtocolDelimiterIndex(String url) {
- if (Validator.isNull(url)) {
- return -1;
- }
-
- // Define protocol as "[a-zA-Z][a-zA-Z0-9]\*://"
-
- int pos = url.indexOf(Http.PROTOCOL\_DELIMITER);
+ private URI \_getURI(String uriString) throws URISyntaxException {
+ Map uris = \_uris.get();
- if (pos <= 0) {
- return -1;
- }
+ uriString = uriString.trim();
- if (!Validator.isChar(url.charAt(0))) {
- return -1;
- }
+ URI uri = uris.get(uriString);
- for (int i = 1; i < pos; ++i) {
- if (!Validator.isChar(url.charAt(i)) &&
- !Validator.isDigit(url.charAt(i))) {
+ if (uri == null) {
+ uri = new URI(uriString);
- return -1;
- }
+ uris.put(uriString, uri);
}
- return pos;
+ return uri;
}
private String \_shortenURL(
@@ -2153,6 +2161,8 @@ private String \_shortenURL(
private static final Log \_log = LogFactoryUtil.getLog(HttpImpl.class);
private static final ThreadLocal \_cookies = new ThreadLocal<>();
+ private static final ThreadLocal> \_uris =
+ new CentralizedThreadLocal<>(HttpImpl.class + ".\_uris", HashMap::new);
private final CloseableHttpClient \_closeableHttpClient;
private final Pattern \_nonProxyHostsPattern;
diff --git a/portal-impl/src/com/liferay/portal/util/PortalImpl.java b/portal-impl/src/com/liferay/portal/util/PortalImpl.java
index 484bf4caf459b3..22a626768ddb0b 100644
--- a/portal-impl/src/com/liferay/portal/util/PortalImpl.java
+++ b/portal-impl/src/com/liferay/portal/util/PortalImpl.java
@@ -931,18 +931,28 @@ public String escapeRedirect(String url) {
return url;
}
- url = url.trim();
+ String domain = HttpUtil.getDomain(url);
+ String protocol = HttpUtil.getProtocol(url);
- if ((url.charAt(0) == CharPool.SLASH) &&
- ((url.length() == 1) ||
- ((url.length() > 1) && (url.charAt(1) != CharPool.SLASH)))) {
+ if (Validator.isBlank(domain)) {
+ if (Validator.isBlank(HttpUtil.getPath(url))) {
+ return null;
+ }
+
+ // Specs allow URL of protocol followed by path, but we do not
+
+ if (!Validator.isBlank(protocol)) {
+ return null;
+ }
+
+ // The URL is a relative path
return url;
}
- String domain = HttpUtil.getDomain(url);
+ // Specs regard URL starting with double slashes as valid, but we do not
- if (domain.isEmpty()) {
+ if (Validator.isBlank(protocol)) {
return null;
}
diff --git a/portal-impl/src/com/liferay/portal/verify/VerifyProperties.java b/portal-impl/src/com/liferay/portal/verify/VerifyProperties.java
index d82717ec648f69..ab9cbef4e5d965 100644
--- a/portal-impl/src/com/liferay/portal/verify/VerifyProperties.java
+++ b/portal-impl/src/com/liferay/portal/verify/VerifyProperties.java
@@ -1687,7 +1687,10 @@ protected void verifySystemProperties() throws Exception {
"configuration.jsp",
"editor.wysiwyg.portal-web.docroot.html.portlet.portal\_settings." +
"email\_notifications.jsp",
+ "ehcache.bootstrap.cache.loader.enabled",
"ehcache.bootstrap.cache.loader.factory",
+ "ehcache.bootstrap.cache.loader.properties",
+ "ehcache.bootstrap.cache.loader.properties.default",
"ehcache.cache.event.listener.factory",
"ehcache.cache.manager.peer.listener.factory",
"ehcache.cache.manager.peer.provider.factory",
diff --git a/portal-impl/src/com/liferay/portal/webserver/WebServerEntry.java b/portal-impl/src/com/liferay/portal/webserver/WebServerEntry.java
index d1d4bebd414acb..ae77ad1040e722 100644
--- a/portal-impl/src/com/liferay/portal/webserver/WebServerEntry.java
+++ b/portal-impl/src/com/liferay/portal/webserver/WebServerEntry.java
@@ -15,10 +15,13 @@
package com.liferay.portal.webserver;
import com.liferay.petra.string.StringPool;
+import com.liferay.portal.kernel.util.FastDateFormatFactoryUtil;
import com.liferay.portal.kernel.util.GetterUtil;
import com.liferay.portal.kernel.util.HttpUtil;
import com.liferay.portal.kernel.util.URLCodec;
+import java.text.Format;
+
import java.util.Date;
/\*\*
@@ -38,6 +41,14 @@ public WebServerEntry(
\_name = name;
\_createDate = createDate;
\_modifiedDate = modifiedDate;
+
+ if (modifiedDate != null) {
+ Format format = FastDateFormatFactoryUtil.getSimpleDateFormat(
+ "d MMM yyyy HH:mm z");
+
+ \_modifiedDateString = format.format(modifiedDate);
+ }
+
\_description = GetterUtil.getString(description);
\_size = size;
}
@@ -54,6 +65,10 @@ public Date getModifiedDate() {
return \_modifiedDate;
}
+ public String getModifiedDateString() {
+ return \_modifiedDateString;
+ }
+
public String getName() {
return \_name;
}
@@ -78,6 +93,10 @@ public void setModifiedDate(Date modifiedDate) {
\_modifiedDate = modifiedDate;
}
+ public void setModifiedDateString(String modifiedDateString) {
+ \_modifiedDateString = modifiedDateString;
+ }
+
public void setName(String name) {
\_name = name;
}
@@ -110,6 +129,7 @@ protected String getPath(String path, String name) {
private Date \_createDate;
private String \_description;
private Date \_modifiedDate;
+ private String \_modifiedDateString;
private String \_name;
private String \_path;
private long \_size;
diff --git a/portal-impl/src/com/liferay/portal/webserver/WebServerServlet.java b/portal-impl/src/com/liferay/portal/webserver/WebServerServlet.java
index ed64c3ad1323c6..33fe805dfd91ab 100644
--- a/portal-impl/src/com/liferay/portal/webserver/WebServerServlet.java
+++ b/portal-impl/src/com/liferay/portal/webserver/WebServerServlet.java
@@ -86,7 +86,6 @@
import com.liferay.portal.kernel.transaction.TransactionInvokerUtil;
import com.liferay.portal.kernel.util.ContentTypes;
import com.liferay.portal.kernel.util.DigesterUtil;
-import com.liferay.portal.kernel.util.FastDateFormatFactoryUtil;
import com.liferay.portal.kernel.util.FileUtil;
import com.liferay.portal.kernel.util.GetterUtil;
import com.liferay.portal.kernel.util.HtmlUtil;
@@ -120,8 +119,6 @@
import java.net.URL;
-import java.text.Format;
-
import java.util.ArrayList;
import java.util.Date;
import java.util.List;
@@ -1230,7 +1227,6 @@ protected void sendHTML(
Template template = TemplateManagerUtil.getTemplate(
TemplateConstants.LANG\_TYPE\_FTL, \_templateResource, true);
- template.put("dateFormat", \_dateFormat);
template.put("entries", webServerEntries);
template.put("path", HttpUtil.encodePath(path));
@@ -1653,8 +1649,6 @@ private boolean \_processCompanyInactiveRequest(
UserFileUploadsSettings.class, WebServerServlet.class,
"\_userFileUploadsSettings", false);
- private final Format \_dateFormat =
- FastDateFormatFactoryUtil.getSimpleDateFormat("d MMM yyyy HH:mm z");
private boolean \_lastModified = true;
private TemplateResource \_templateResource;
diff --git a/portal-impl/src/com/liferay/portal/webserver/dependencies/template.ftl b/portal-impl/src/com/liferay/portal/webserver/dependencies/template.ftl
index 121f541146b17c..25a4b60691c5d8 100644
--- a/portal-impl/src/com/liferay/portal/webserver/dependencies/template.ftl
+++ b/portal-impl/src/com/liferay/portal/webserver/dependencies/template.ftl
@@ -26,8 +26,8 @@
[${entry.name}](%24%7Bentry.path%7D) - <#if entry.getModifiedDate()??> - ${dateFormat.format(entry.modifiedDate)} + <#if entry.getModifiedDateString()??> + ${entry.modifiedDateString} <#else> -  diff --git a/portal-impl/src/portal.properties b/portal-impl/src/portal.properties index 87c4eba4eef83a..aa18a93b4b9e60 100644 --- a/portal-impl/src/portal.properties +++ b/portal-impl/src/portal.properties @@ -1624,29 +1624,6 @@ ehcache.single.vm.config.location=/ehcache/liferay-single-vm.xml ehcache.multi.vm.config.location=/ehcache/liferay-multi-vm.xml - # - # Set this to true to enable the Ehcache bootstrap cache loader. - # - # Env: LIFERAY\_EHCACHE\_PERIOD\_BOOTSTRAP\_PERIOD\_CACHE\_PERIOD\_LOADER\_PERIOD\_ENABLED - # - ehcache.bootstrap.cache.loader.enabled=false - - # - # Input a list of comma delimited key value pair to set bootstrap loader - # properties for the default cache. - # - # Env: LIFERAY\_EHCACHE\_PERIOD\_BOOTSTRAP\_PERIOD\_CACHE\_PERIOD\_LOADER\_PERIOD\_PROPERTIES\_PERIOD\_DEFAULT - # - ehcache.bootstrap.cache.loader.properties.default= - - # - # Input a list of comma delimited key value pair to set bootstrap loader - # properties for a specific cache. - # - # Env: LIFERAY\_EHCACHE\_PERIOD\_BOOTSTRAP\_PERIOD\_CACHE\_PERIOD\_LOADER\_PERIOD\_PROPERTIES\_PERIOD\_\_DOLLAR\_\_OPENCURLYBRACE\_SPECIFIC\_PERIOD\_CACHE\_PERIOD\_NAME\_CLOSECURLYBRACE\_ - # - #ehcache.bootstrap.cache.loader.properties.${specific.cache.name}= - # # Input a list of comma delimited key value pair to set replication # properties for the default cache. @@ -5900,7 +5877,7 @@ # Env: LIFERAY\_SETUP\_PERIOD\_DATABASE\_PERIOD\_JAR\_PERIOD\_URL\_OPENBRACKET\_COM\_PERIOD\_MYSQL\_PERIOD\_CJ\_PERIOD\_JDBC\_PERIOD\_\_UPPERCASED\_RIVER\_CLOSEBRACKET\_ # setup.database.jar.name[com.mysql.cj.jdbc.Driver]=mysql.jar - setup.database.jar.url[com.mysql.cj.jdbc.Driver]=http://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.15/mysql-connector-java-8.0.15.jar + setup.database.jar.url[com.mysql.cj.jdbc.Driver]=https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.15/mysql-connector-java-8.0.15.jar # # Env: LIFERAY\_SETUP\_PERIOD\_DATABASE\_PERIOD\_URL\_OPENBRACKET\_DB\_NUMBER2\_\_CLOSEBRACKET\_ diff --git a/portal-impl/test/unit/com/liferay/portal/dao/orm/hibernate/region/dependencies/test-multi-ehcache-config.xml b/portal-impl/test/unit/com/liferay/portal/dao/orm/hibernate/region/dependencies/test-multi-ehcache-config.xml index 8736b2d6e2a9e5..29c30947438bac 100644 --- a/portal-impl/test/unit/com/liferay/portal/dao/orm/hibernate/region/dependencies/test-multi-ehcache-config.xml +++ b/portal-impl/test/unit/com/liferay/portal/dao/orm/hibernate/region/dependencies/test-multi-ehcache-config.xml @@ -19,7 +19,6 @@ propertySeparator="," />  -   @@ -29,6 +28,5 @@ propertySeparator="," />  -    \ No newline at end of file diff --git a/portal-kernel/src/com/liferay/portal/kernel/template/Template.java b/portal-kernel/src/com/liferay/portal/kernel/template/Template.java index 3e36af5b159b5f..38163d5e048eab 100644 --- a/portal-kernel/src/com/liferay/portal/kernel/template/Template.java +++ b/portal-kernel/src/com/liferay/portal/kernel/template/Template.java @@ -20,14 +20,22 @@ import java.util.function.Supplier; import javax.servlet.http.HttpServletRequest; +import javax.servlet.http.HttpServletResponse; + +import org.osgi.annotation.versioning.ProviderType; /\*\* \* @author Tina Tian \*/ +@ProviderType public interface Template extends Map { public void prepare(HttpServletRequest httpServletRequest); + public void prepareTaglib( + HttpServletRequest httpServletRequest, + HttpServletResponse httpServletResponse); + public void processTemplate(Writer writer) throws TemplateException; public void processTemplate( diff --git a/portal-kernel/src/com/liferay/portal/kernel/template/TemplateManager.java b/portal-kernel/src/com/liferay/portal/kernel/template/TemplateManager.java index 3868b3638c2431..a24dda0352eb61 100644 --- a/portal-kernel/src/com/liferay/portal/kernel/template/TemplateManager.java +++ b/portal-kernel/src/com/liferay/portal/kernel/template/TemplateManager.java @@ -26,32 +26,60 @@ \*/ public interface TemplateManager { + /\*\* + \* @deprecated As of Athanasius (7.3.x), with no direct replacement + \*/ + @Deprecated public void addContextObjects( Map contextObjects, Map newContextObjects); + /\*\* + \* @deprecated As of Athanasius (7.3.x), with no direct replacement + \*/ + @Deprecated public void addStaticClassSupport( Map contextObjects, String variableName, Class  variableClass); + /\*\* + \* @deprecated As of Athanasius (7.3.x), with no direct replacement + \*/ + @Deprecated public void addTaglibApplication( Map contextObjects, String applicationName, ServletContext servletContext); + /\*\* + \* @deprecated As of Athanasius (7.3.x), with no direct replacement + \*/ + @Deprecated public void addTaglibFactory( Map contextObjects, String taglibLiferayHash, ServletContext servletContext); + /\*\* + \* @deprecated As of Athanasius (7.3.x), with no direct replacement + \*/ + @Deprecated public void addTaglibRequest( Map contextObjects, String applicationName, HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse); + /\*\* + \* @deprecated As of Athanasius (7.3.x), with no direct replacement + \*/ + @Deprecated public void addTaglibSupport( Map contextObjects, HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse); + /\*\* + \* @deprecated As of Athanasius (7.3.x), with no direct replacement + \*/ + @Deprecated public void addTaglibTheme( Map contextObjects, String string, HttpServletRequest httpServletRequest, diff --git a/portal-kernel/src/com/liferay/portal/kernel/util/PropsKeys.java b/portal-kernel/src/com/liferay/portal/kernel/util/PropsKeys.java index 10a66dadc41bfa..b693c7e6602f38 100644 --- a/portal-kernel/src/com/liferay/portal/kernel/util/PropsKeys.java +++ b/portal-kernel/src/com/liferay/portal/kernel/util/PropsKeys.java @@ -1247,12 +1247,24 @@ public interface PropsKeys { public static final String EHCACHE\_BLOCKING\_CACHE\_ALLOWED = "ehcache.blocking.cache.allowed"; + /\*\* + \* @deprecated As of Mueller (7.2.x), with no direct replacement + \*/ + @Deprecated public static final String EHCACHE\_BOOTSTRAP\_CACHE\_LOADER\_ENABLED = "ehcache.bootstrap.cache.loader.enabled"; + /\*\* + \* @deprecated As of Mueller (7.2.x), with no direct replacement + \*/ + @Deprecated public static final String EHCACHE\_BOOTSTRAP\_CACHE\_LOADER\_PROPERTIES = "ehcache.bootstrap.cache.loader.properties"; + /\*\* + \* @deprecated As of Mueller (7.2.x), with no direct replacement + \*/ + @Deprecated public static final String EHCACHE\_BOOTSTRAP\_CACHE\_LOADER\_PROPERTIES\_DEFAULT = "ehcache.bootstrap.cache.loader.properties.default"; diff --git a/portal-web/docroot/html/common/themes/top\_js.jspf b/portal-web/docroot/html/common/themes/top\_js.jspf index 7e60dfb15a9d6a..9f92a54f05f8fd 100644 --- a/portal-web/docroot/html/common/themes/top\_js.jspf +++ b/portal-web/docroot/html/common/themes/top\_js.jspf @@ -194,7 +194,7 @@ String completeURL = PortalUtil.getCurrentCompleteURL(request); %> - return '<%= PortalUtil.getCanonicalURL(completeURL, themeDisplay, layout, false, false) %>'; + return '<%= HtmlUtil.escapeJS(PortalUtil.getCanonicalURL(completeURL, themeDisplay, layout, false, false)) %>'; }, getCDNBaseURL: function() { return '<%= themeDisplay.getCDNBaseURL() %>'; diff --git a/portal-web/docroot/html/taglib/ui/menu\_item/page.jsp b/portal-web/docroot/html/taglib/ui/menu\_item/page.jsp index 9c0e54a1e99536..2a156c2f840eba 100644 --- a/portal-web/docroot/html/taglib/ui/menu\_item/page.jsp +++ b/portal-web/docroot/html/taglib/ui/menu\_item/page.jsp @@ -43,7 +43,7 @@ MenuItem menuItem = (MenuItem)request.getAttribute("liferay-ui:menu\_item:menuIte data="<%= javaScriptMenuItem.getData() %>" iconCssClass="<%= javaScriptMenuItem.getIcon() %>" message="<%= HtmlUtil.escape(javaScriptMenuItem.getLabel()) %>" - onClick="<%= HtmlUtil.escapeAttribute(javaScriptMenuItem.getOnClick()) %>" + onClick="<%= javaScriptMenuItem.getOnClick() %>" url="javascript:;" /> diff --git a/portal-web/docroot/html/taglib/ui/page\_iterator/lexicon/start.jsp b/portal-web/docroot/html/taglib/ui/page\_iterator/lexicon/start.jsp index ba5ece16ed41d5..fd940690f2431b 100644 --- a/portal-web/docroot/html/taglib/ui/page\_iterator/lexicon/start.jsp +++ b/portal-web/docroot/html/taglib/ui/page\_iterator/lexicon/start.jsp @@ -70,7 +70,7 @@ if (forcePost && (portletURL != null)) { %> -  +     @@ -102,7 +102,7 @@ if (forcePost && (portletURL != null)) { %>- - [">   + [">   <%= String.valueOf(curDelta) %>      @@ -344,7 +344,7 @@ if (forcePost && (portletURL != null)) {   namespace: '<%= namespace %>',   pages: '<%= pages %>',   randomNamespace: '<%= randomNamespace %>',   - url: '<%= url %>',   + url: '<%= HtmlUtil.escapeJS(url) %>',   urlAnchor: '<%= urlAnchor %>'   }   );   @@ -369,7 +369,7 @@ if (forcePost && (portletURL != null)) {   <%!   private String \_getHREF(String formName, String curParam, int cur, String jsCall, String url, String urlAnchor) throws Exception {   if (Validator.isNotNull(url)) {   - return HttpUtil.addParameter(HttpUtil.removeParameter(url, curParam) + urlAnchor, curParam, cur);   + return HtmlUtil.escapeHREF(HttpUtil.addParameter(HttpUtil.removeParameter(url, curParam) + urlAnchor, curParam, cur));   }   return "javascript:document." + formName + "." + curParam + ".value = '" + cur + "'; " + jsCall;   diff --git a/portal-web/docroot/html/taglib/ui/page\_iterator/start.jsp b/portal-web/docroot/html/taglib/ui/page\_iterator/start.jsp   index 2d124c1d5237d9..d0d898682e4d2e 100644   --- a/portal-web/docroot/html/taglib/ui/page\_iterator/start.jsp   +++ b/portal-web/docroot/html/taglib/ui/page\_iterator/start.jsp   @@ -83,7 +83,7 @@ if (forcePost && (portletURL != null)) {   url = url.split(namespace)[0];   %>   -    +             @@ -204,7 +204,7 @@ if (forcePost && (portletURL != null)) {      <%   @@ -239,7 +239,7 @@ if (forcePost && (portletURL != null)) {      <%   diff --git a/portal-web/test/functional/com/liferay/portalweb/tests/coreinfrastructureee/clustering/clusteringframework/ClusteringMissingPlugins.testcase b/portal-web/test/functional/com/liferay/portalweb/tests/coreinfrastructureee/clustering/clusteringframework/ClusteringMissingPlugins.testcase   index 5d74a76a1e66ed..24f729bce1d048 100644   --- a/portal-web/test/functional/com/liferay/portalweb/tests/coreinfrastructureee/clustering/clusteringframework/ClusteringMissingPlugins.testcase   +++ b/portal-web/test/functional/com/liferay/portalweb/tests/coreinfrastructureee/clustering/clusteringframework/ClusteringMissingPlugins.testcase   @@ -27,66 +27,9 @@ definition {   }   }   - @ignore = "true"   - @priority = "3"   - test CacheBootstrapLoader {   - property custom.properties = "ehcache.bootstrap.cache.loader.enabled=true${line.separator}ehcache.bootstrap.cache.loader.properties.test.cache=bootstrapAsynchronously=false";   - property test.name.skip.portal.instance = "ClusteringMissingPlugins#CacheBootstrapLoader";   -   - Clustering.viewClusterStatusInConsole();   -   - Clustering.enableDebugging(   - categoryName = "com.liferay.portal.cache.ehcache.internal.event.PortalCacheCacheEventListener.test.cache",   - nodePort = "8080");   -   - Clustering.enableDebugging(   - categoryName = "com.liferay.portal.cache.ehcache.internal.event.PortalCacheCacheEventListener.test.cache",   - nodePort = "9080");   -   - Clustering.deployJarOnSpecificServer(   - liferayDependencyJars = "com.liferay.cluster.test.module.7.2.jar",   - nodePort = "8080");   -   - Clustering.viewTextNotPresentOnSpecificNode(   - exceptionText = "Could not resolve module: com.liferay.cluster.test.module",   - nodePort = "8080");   -   - Clustering.runGroovyScript(   - nodePort = "8080",   - scriptFile = "groovy-script-portal-cache-put-modules.groovy");   -   - Clustering.viewTextPresentOnSpecificNode(   - expectedText = "Put test.key into test.cache",   - nodePort = "8080");   -   - Clustering.viewTextNotPresentOnSpecificNode(   - exceptionText = "Unable to deserialize object",   - nodePort = "9080");   -   - Clustering.deployJarOnSpecificServer(   - liferayDependencyJars = "com.liferay.cluster.test.module.7.2.jar",   - nodePort = "9080");   -   - Clustering.viewTextNotPresentOnSpecificNode(   - exceptionText = "Could not resolve module: com.liferay.cluster.test.module",   - nodePort = "9080");   -   - Clustering.runGroovyScript(   - nodePort = "9080",   - scriptFile = "groovy-script-portal-cache-get.groovy");   -   - Clustering.viewTextPresentOnSpecificNode(   - expectedText = "Put test.key into test.cache",   - nodePort = "9080");   -   - AssertTextEquals(   - locator1 = "ServerAdministrationScript#OUTPUT\_FIELD",   - value1 = "test.key=test.value");   - }   -   @priority = "4"   test CacheReplicationbyCopy {   - property custom.properties = "ehcache.bootstrap.cache.loader.enabled=false${line.separator}ehcache.replicator.properties.test.cache=replicatePutsViaCopy=true";   + property custom.properties = "ehcache.replicator.properties.test.cache=replicatePutsViaCopy=true";   property test.name.skip.portal.instance = "ClusteringMissingPlugins#CacheReplicationbyCopy";   Clustering.viewClusterStatusInConsole();   diff --git a/source-formatter-api-signature-check-exceptions.txt b/source-formatter-api-signature-check-exceptions.txt   index ff6b81ad2ec132..a4b4dbf63185af 100644   --- a/source-formatter-api-signature-check-exceptions.txt   +++ b/source-formatter-api-signature-check-exceptions.txt   @@ -343,7 +343,7 @@ com.liferay.portal.setup.SetupWizardUtil#isDefaultDatabase(HttpServletRequest)   com.liferay.portal.setup.SetupWizardUtil#testDatabase(HttpServletRequest)   com.liferay.portal.setup.SetupWizardUtil#updateLanguage(HttpServletRequest,HttpServletResponse)   com.liferay.portal.setup.SetupWizardUtil#updateSetup(HttpServletRequest,HttpServletResponse)   -com.liferay.portal.templateparser.Transformer#transform(ThemeDisplay,Map,String,String,UnsyncStringWriter)   +com.liferay.portal.templateparser.Transformer#transform(ThemeDisplay,Map,String,String,UnsyncStringWriter,HttpServletRequest,HttpServletResponse)   com.liferay.portal.util.LayoutClone#get(HttpServletRequest,long)   com.liferay.portal.util.LayoutClone#update(HttpServletRequest,long,String)   com.liferay.portal.util.LayoutURLUtil#getLayoutURL(Layout,ServiceContext)   diff --git a/util-bridges/src/com/liferay/util/bridges/freemarker/FreeMarkerPortlet.java b/util-bridges/src/com/liferay/util/bridges/freemarker/FreeMarkerPortlet.java   index c71ec32c19c023..e73f6d5145912b 100644   --- a/util-bridges/src/com/liferay/util/bridges/freemarker/FreeMarkerPortlet.java   +++ b/util-bridges/src/com/liferay/util/bridges/freemarker/FreeMarkerPortlet.java   @@ -21,7 +21,6 @@   import com.liferay.portal.kernel.template.Template;   import com.liferay.portal.kernel.template.TemplateConstants;   import com.liferay.portal.kernel.template.TemplateException;   -import com.liferay.portal.kernel.template.TemplateManager;   import com.liferay.portal.kernel.template.TemplateManagerUtil;   import com.liferay.portal.kernel.template.TemplateResource;   import com.liferay.portal.kernel.template.TemplateResourceLoaderUtil;   @@ -86,15 +85,11 @@ protected void include(   TemplateResourceLoaderUtil.getTemplateResource(   TemplateConstants.LANG\_TYPE\_FTL, resourcePath);   - TemplateManager templateManager =   - TemplateManagerUtil.getTemplateManager(   - TemplateConstants.LANG\_TYPE\_FTL);   -   Template template = TemplateManagerUtil.getTemplate(   TemplateConstants.LANG\_TYPE\_FTL, templateResource, false);   - templateManager.addTaglibSupport(   - template, PortalUtil.getHttpServletRequest(portletRequest),   + template.prepareTaglib(   + PortalUtil.getHttpServletRequest(portletRequest),   PortalUtil.getHttpServletResponse(portletResponse));   template.put("portletContext", getPortletContext());   diff --git a/util-taglib/src/com/liferay/taglib/aui/ATag.java b/util-taglib/src/com/liferay/taglib/aui/ATag.java   index 44baead5ff5882..e73a112137df73 100644   --- a/util-taglib/src/com/liferay/taglib/aui/ATag.java   +++ b/util-taglib/src/com/liferay/taglib/aui/ATag.java   @@ -143,7 +143,7 @@ protected int processStartTag() throws Exception {   if (Validator.isNotNull(onClick)) {   jspWriter.write("onClick=\"");   - jspWriter.write(onClick);   + jspWriter.write(HtmlUtil.escapeAttribute(onClick));   jspWriter.write("\" ");   }   diff --git a/util-taglib/src/com/liferay/taglib/ui/IconTag.java b/util-taglib/src/com/liferay/taglib/ui/IconTag.java   index 5c17e05130eb8e..3b6d43842a6419 100644   --- a/util-taglib/src/com/liferay/taglib/ui/IconTag.java   +++ b/util-taglib/src/com/liferay/taglib/ui/IconTag.java   @@ -596,8 +596,9 @@ private String \_getDetails(ThemeDisplay themeDisplay) {   String details = null;   if (\_alt != null) {   - details =   - " alt=\"" + LanguageUtil.get(\_getResourceBundle(), \_alt) + "\"";   + String alt = LanguageUtil.get(\_getResourceBundle(), \_alt);   +   + details = " alt=\"" + HtmlUtil.escapeAttribute(alt) + "\"";   }   else if (isLabel()) {   details = " alt=\"\"";   @@ -609,7 +610,8 @@ else if (isLabel()) {   String localizedProcessedMessage = StringPool.BLANK;   - String processedMessage = getProcessedMessage();   + String processedMessage = HtmlUtil.escapeAttribute(   + getProcessedMessage());   if (processedMessage != null) {   localizedProcessedMessage = LanguageUtil.get(   @@ -727,7 +729,7 @@ else if (isLabel()) {   sb.append(details);   sb.append(" style=\"background-image: url('");   - sb.append(spriteFileURL);   + sb.append(HtmlUtil.escapeCSS(spriteFileURL));   sb.append("'); background-position: 50% -");   sb.append(spriteImage.getOffset());   sb.append("px; background-repeat: no-repeat; height: ");   diff --git a/util-taglib/src/com/liferay/taglib/util/ThemeUtil.java b/util-taglib/src/com/liferay/taglib/util/ThemeUtil.java   index aa8ab6351c9ebb..acac21d4c93f75 100644   --- a/util-taglib/src/com/liferay/taglib/util/ThemeUtil.java   +++ b/util-taglib/src/com/liferay/taglib/util/ThemeUtil.java   @@ -25,7 +25,6 @@   import com.liferay.portal.kernel.template.Template;   import com.liferay.portal.kernel.template.TemplateConstants;   import com.liferay.portal.kernel.template.TemplateContextContributor;   -import com.liferay.portal.kernel.template.TemplateManager;   import com.liferay.portal.kernel.template.TemplateManagerUtil;   import com.liferay.portal.kernel.template.TemplateResource;   import com.liferay.portal.kernel.template.TemplateResourceLoaderUtil;   @@ -284,14 +283,7 @@ protected static String doIncludeFTL(   httpServletResponse, writer);   }   - TemplateManager templateManager =   - TemplateManagerUtil.getTemplateManager(   - TemplateConstants.LANG\_TYPE\_FTL);   -   - templateManager.addTaglibSupport(   - template, httpServletRequest, httpServletResponse);   - templateManager.addTaglibTheme(   - template, "taglibLiferay", httpServletRequest, httpServletResponse);   + template.prepareTaglib(httpServletRequest, httpServletResponse);   template.put(TemplateConstants.WRITER, writer);   @@ -434,10 +426,6 @@ protected static String doIncludeVM(   "Unable to load template resource " + resourcePath);   }   - TemplateManager templateManager =   - TemplateManagerUtil.getTemplateManager(   - TemplateConstants.LANG\_TYPE\_VM);   -   Template template = TemplateManagerUtil.getTemplate(   TemplateConstants.LANG\_TYPE\_VM, templateResource, restricted);   @@ -474,9 +462,6 @@ protected static String doIncludeVM(   httpServletResponse, writer);   }   - templateManager.addTaglibTheme(   - template, "taglibLiferay", httpServletRequest, httpServletResponse);   -   template.put(TemplateConstants.WRITER, writer);   // Merge templates   From d9b51b77452f2a426ea617c130011f7bc5e5ff54 Mon Sep 17 00:00:00 2001   From: Samuel Kong    Date: Tue, 9 Jun 2020 11:14:05 +0800   Subject: [PATCH 03/15] Update README   ---   README.markdown | 22 +++++++++++-----------   1 file changed, 11 insertions(+), 11 deletions(-)   diff --git a/README.markdown b/README.markdown   index 62d47e21084c88..2e25fa6c7da577 100644   --- a/README.markdown   +++ b/README.markdown   @@ -8,17 +8,17 @@ information about security in Liferay Portal, please see   [https://github.com/community-security-team/liferay-portal/compare/7.2.1-ga2...7.2.1-cumulative.patch](https://github.com/community-security-team/liferay-portal/compare/7.2.1-ga2...7.2.1-cumulative.patch)   The [June 2020]() release contains fixes for the following issues:   -[CST-7213](),   -[CST-7214](),   -[CST-7216](),   -[CST-7217](),   -[CST-7218](),   -[CST-7219](),   -[CST-7220](),   -[CST-7221](),   -[CST-7301](),   -[CST-7302](),   -[CST-7303]()   +[CST-7213](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119317427),   +[CST-7214](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119317439),   +[CST-7216](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119318646),   +[CST-7217](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119319717),   +[CST-7218](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119319747),   +[CST-7219](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119320878),   +[CST-7220](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119324436),   +[CST-7221](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119326522),   +[CST-7301](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119317396),   +[CST-7302](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119317411),   +[CST-7303](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119326567)   # Liferay Portal Community Edition License   From ed211f44d636d07647d7b8e2d1f0b0016866ab15 Mon Sep 17 00:00:00 2001   From: yxingwu    Date: Mon, 10 Aug 2020 11:01:59 +0800   Subject: [PATCH 04/15] September 2020   ---   lib/portal/dependencies.properties | 4 +-   lib/versions-complete.xml | 2 +-   lib/versions-ext.xml | 2 +-   lib/versions.html | 2 +-   .../impl/BlogsEntryLocalServiceImpl.java | 43 ++--   .../ImageBlogsUploadFileEntryHandler.java | 35 ++--   .../META-INF/resources/blogs/edit\_entry.jsp | 11 +-   .../model/listener/UserModelListener.java | 5 +   .../META-INF/resources/search\_results.jsp | 6 +-   .../bnd.bnd | 3 +   .../build.gradle | 22 +--   ...LAdminManagementToolbarDisplayContext.java | 2 +-   .../document\_library/configuration.jsp | 3 +-   .../document\_library/edit\_file\_entry.jsp | 3 +-   .../document\_library/edit\_folder.jsp | 6 +-   .../info\_panel\_file\_entry.jsp | 2 +-   .../document\_library/js/bulk/BulkStatus.es.js | 3 +-   .../js/categorization/EditCategories.es.js | 10 +-   .../js/categorization/EditTags.es.js | 3 +-   .../document\_library/js/legacy/main.js | 33 ++--   .../document\_library/js/legacy/upload.js | 70 ++++---   .../upload\_multiple\_file\_entries.jsp | 9 +-   ...upload\_multiple\_file\_entries\_resources.jsp | 3 +-   .../image\_gallery\_display/view\_images.jsp | 3 +-   .../build.gradle | 2 +-   .../dynamic-data-mapping-service/build.gradle | 2 +-   .../dynamic-data-mapping-test/build.gradle | 2 +-   .../internal/staging/StagingImpl.java | 13 ++   .../EditFragmentEntryDisplayContext.java | 12 +-   .../frontend-js-jquery-web/package.json | 2 +-   .../imageio-plugins/build.gradle | 30 +--   .../ForgotPasswordMVCActionCommand.java | 186 ++++++++++++------   .../META-INF/resources/create\_account.jsp | 2 +-   .../META-INF/resources/forgot\_password.jsp | 27 +--   .../resources/view\_search\_results.jsp | 6 +-   .../verifier/OAuth2JSONWSAuthVerifier.java | 5 +   .../auth/verifier/OAuth2RESTAuthVerifier.java | 7 +   modules/apps/petra/petra-log4j/build.gradle | 2 +-   modules/apps/petra/petra-xml/build.gradle | 2 +-   .../portal-odata/portal-odata-impl/bnd.bnd | 37 +++-   .../portal-odata-impl/build.gradle | 17 +-   .../expression/ExpressionVisitorImpl.java | 10 +   .../portal-vulcan-impl/build.gradle | 1 +   .../internal/jaxrs/feature/VulcanFeature.java | 8 +-   .../body/MultipartBodyMessageBodyReader.java | 18 ++   .../definition/edit\_workflow\_definition.jsp | 4 +-   ...gingProcessesWebToolbarDisplayContext.java | 98 +++++----   .../PublishTemplatesConfigurationIcon.java | 24 +++   .../publish\_layouts\_processes.jsp | 6 +   .../resources/META-INF/resources/toolbar.jsp | 9 +-   .../system.packages.extra.bnd | 2 +-   modules/yarn.lock | 8 +-   .../liferay/portal/action/SitemapAction.java | 10 +   .../upload/UploadServletRequestImpl.java | 12 +-   .../com/liferay/portal/util/PortalImpl.java | 26 +++   55 files changed, 599 insertions(+), 276 deletions(-)   diff --git a/lib/portal/dependencies.properties b/lib/portal/dependencies.properties   index 02687255aa6aac..6acb6f9855d6da 100644   --- a/lib/portal/dependencies.properties   +++ b/lib/portal/dependencies.properties   @@ -46,7 +46,7 @@ concurrent=concurrent:concurrent:1.3.4   crypt=com.liferay:org.vps.crypt:1.0   daisydiff=com.liferay:org.outerj.daisy.daisydiff:1.2   displaytag=displaytag:displaytag:1.2   -dom4j=dom4j:dom4j:1.6.1   +dom4j=org.dom4j:dom4j:2.1.3   eclipse-core-runtime=org.eclipse.core:runtime:20070801   ecs=ecs:ecs:1.4.2   fontbox=org.apache.pdfbox:fontbox:2.0.13   @@ -123,7 +123,7 @@ mimepull=org.jvnet:mimepull:1.3   monte-cc=com.liferay:org.monte:0.7.7   nekohtml=net.sourceforge.nekohtml:nekohtml:1.9.22   netcdf=edu.ucar:netcdf:4.3.23   -netty-all=io.netty:netty-all:4.1.42.Final   +netty-all=io.netty:netty-all:4.1.48.Final   odmg=odmg:odmg:3.0   oro=oro:oro:2.0.8   pdfbox=org.apache.pdfbox:pdfbox:2.0.13   diff --git a/lib/versions-complete.xml b/lib/versions-complete.xml   index dcfe7452463bb0..48e89515308563 100644   --- a/lib/versions-complete.xml   +++ b/lib/versions-complete.xml   @@ -6787,7 +6787,7 @@      lib/portal/netty-all.jar   - 4.1.32.Final   + 4.1.48.Final   Netty   http://netty.io   diff --git a/lib/versions-ext.xml b/lib/versions-ext.xml   index 59b801a6181165..88b68b553614bc 100644   --- a/lib/versions-ext.xml   +++ b/lib/versions-ext.xml   @@ -2500,7 +2500,7 @@      lib/portal/netty-all.jar   - 4.1.32.Final   + 4.1.48.Final   Netty   http://netty.io   diff --git a/lib/versions.html b/lib/versions.html   index 989e86bfbe1d09..ffcb1674d01be5 100644   --- a/lib/versions.html   +++ b/lib/versions.html   @@ -2984,7 +2984,7 @@](%3C%25%3D%20HtmlUtil.escapeHREF%28curDeltaURL%29%20%25%3E)](%3C%25%3D%20curDeltaURL%20%25%3E) |  ||- lib/portal/netty-all.jar | 4.1.32.Final | [Netty](http://netty.io) | [Apache License 2.0](http://www.apache.org/licenses/LICENSE-2.0) + lib/portal/netty-all.jar | 4.1.48.Final | [Netty](http://netty.io) | [Apache License 2.0](http://www.apache.org/licenses/LICENSE-2.0) |  | |
diff --git a/modules/apps/blogs/blogs-service/src/main/java/com/liferay/blogs/service/impl/BlogsEntryLocalServiceImpl.java b/modules/apps/blogs/blogs-service/src/main/java/com/liferay/blogs/service/impl/BlogsEntryLocalServiceImpl.java
index 0a4d0c6c646e31..b2a93c1991b56d 100644
--- a/modules/apps/blogs/blogs-service/src/main/java/com/liferay/blogs/service/impl/BlogsEntryLocalServiceImpl.java
+++ b/modules/apps/blogs/blogs-service/src/main/java/com/liferay/blogs/service/impl/BlogsEntryLocalServiceImpl.java
@@ -116,6 +116,7 @@
import java.util.Locale;
import java.util.Map;
import java.util.Set;
+import java.util.stream.Stream;
import javax.portlet.PortletRequest;
import javax.portlet.PortletURL;
@@ -573,6 +574,8 @@ else if (imageSelector.getImageBytes() != null) {
entry.getUserId(), entry.getGroupId(), entryId, imageSelector);
}
+ validate(smallImageFileEntryId);
+
entry.setSmallImage(smallImage);
entry.setSmallImageFileEntryId(smallImageFileEntryId);
entry.setSmallImageURL(smallImageURL);
@@ -2259,22 +2262,7 @@ protected void validate(long smallImageFileEntryId) throws PortalException {
FileEntry fileEntry = \_portletFileRepository.getPortletFileEntry(
smallImageFileEntryId);
- boolean validSmallImageExtension = false;
-
- for (String imageExtension :
- \_blogsFileUploadsConfiguration.imageExtensions()) {
-
- if (StringPool.STAR.equals(imageExtension) ||
- imageExtension.equals(
- StringPool.PERIOD + fileEntry.getExtension())) {
-
- validSmallImageExtension = true;
-
- break;
- }
- }
-
- if (!validSmallImageExtension) {
+ if (!\_isValidImageMimeType(fileEntry)) {
throw new EntrySmallImageNameException(
"Invalid small image for file entry " +
smallImageFileEntryId);
@@ -2470,6 +2458,29 @@ private String \_getURLTitle(long entryId) {
return StringPool.BLANK;
}
+ private boolean \_isValidImageMimeType(FileEntry fileEntry) {
+ if (ArrayUtil.contains(
+ \_blogsFileUploadsConfiguration.imageExtensions(),
+ StringPool.STAR)) {
+
+ return true;
+ }
+
+ Set extensions = MimeTypesUtil.getExtensions(
+ fileEntry.getMimeType());
+
+ if (Stream.of(
+ \_blogsFileUploadsConfiguration.imageExtensions()).anyMatch(
+ extension ->
+ extension.equals(StringPool.STAR) ||
+ extensions.contains(extension))) {
+
+ return true;
+ }
+
+ return false;
+ }
+
private static final String \_COVER\_IMAGE\_FOLDER\_NAME = "Cover Image";
private static final String \_SMALL\_IMAGE\_FOLDER\_NAME = "Small Image";
diff --git a/modules/apps/blogs/blogs-web/src/main/java/com/liferay/blogs/web/internal/upload/ImageBlogsUploadFileEntryHandler.java b/modules/apps/blogs/blogs-web/src/main/java/com/liferay/blogs/web/internal/upload/ImageBlogsUploadFileEntryHandler.java
index 84aeb8b2754822..1294fb098502c7 100644
--- a/modules/apps/blogs/blogs-web/src/main/java/com/liferay/blogs/web/internal/upload/ImageBlogsUploadFileEntryHandler.java
+++ b/modules/apps/blogs/blogs-web/src/main/java/com/liferay/blogs/web/internal/upload/ImageBlogsUploadFileEntryHandler.java
@@ -30,7 +30,7 @@
import com.liferay.portal.kernel.security.permission.resource.PortletResourcePermission;
import com.liferay.portal.kernel.theme.ThemeDisplay;
import com.liferay.portal.kernel.upload.UploadPortletRequest;
-import com.liferay.portal.kernel.util.FileUtil;
+import com.liferay.portal.kernel.util.MimeTypesUtil;
import com.liferay.portal.kernel.util.WebKeys;
import com.liferay.upload.UploadFileEntryHandler;
@@ -38,6 +38,8 @@
import java.io.InputStream;
import java.util.Map;
+import java.util.Set;
+import java.util.stream.Stream;
import org.osgi.service.component.annotations.Activate;
import org.osgi.service.component.annotations.Component;
@@ -68,12 +70,13 @@ public FileEntry upload(UploadPortletRequest uploadPortletRequest)
ActionKeys.ADD\_ENTRY);
String fileName = uploadPortletRequest.getFileName(\_PARAMETER\_NAME);
-
- \_validateFile(fileName, uploadPortletRequest.getSize(\_PARAMETER\_NAME));
-
String contentType = uploadPortletRequest.getContentType(
\_PARAMETER\_NAME);
+ \_validateFile(
+ fileName, contentType,
+ uploadPortletRequest.getSize(\_PARAMETER\_NAME));
+
try (InputStream inputStream = uploadPortletRequest.getFileAsStream(
\_PARAMETER\_NAME)) {
@@ -116,7 +119,7 @@ protected FileEntry addFileEntry(
@Reference(target = "(resource.name=" + BlogsConstants.RESOURCE\_NAME + ")")
protected PortletResourcePermission portletResourcePermission;
- private void \_validateFile(String fileName, long size)
+ private void \_validateFile(String fileName, String contentType, long size)
throws PortalException {
long blogsImageMaxSize = \_blogsFileUploadsConfiguration.imageMaxSize();
@@ -125,20 +128,20 @@ private void \_validateFile(String fileName, long size)
throw new EntryImageSizeException();
}
- String extension = FileUtil.getExtension(fileName);
+ Set extensions = MimeTypesUtil.getExtensions(contentType);
- for (String imageExtension :
- \_blogsFileUploadsConfiguration.imageExtensions()) {
+ boolean validContentType = Stream.of(
+ \_blogsFileUploadsConfiguration.imageExtensions()
+ ).anyMatch(
+ extension ->
+ extension.equals(StringPool.STAR) ||
+ extensions.contains(extension)
+ );
- if (StringPool.STAR.equals(imageExtension) ||
- imageExtension.equals(StringPool.PERIOD + extension)) {
-
- return;
- }
+ if (!validContentType) {
+ throw new EntryImageNameException(
+ "Invalid image for file name " + fileName);
}
-
- throw new EntryImageNameException(
- "Invalid image for file name " + fileName);
}
private static final String \_PARAMETER\_NAME = "imageSelectorFileName";
diff --git a/modules/apps/blogs/blogs-web/src/main/resources/META-INF/resources/blogs/edit\_entry.jsp b/modules/apps/blogs/blogs-web/src/main/resources/META-INF/resources/blogs/edit\_entry.jsp
index 5e0ce232429449..53f9f0d771b643 100644
--- a/modules/apps/blogs/blogs-web/src/main/resources/META-INF/resources/blogs/edit\_entry.jsp
+++ b/modules/apps/blogs/blogs-web/src/main/resources/META-INF/resources/blogs/edit\_entry.jsp
@@ -44,6 +44,9 @@ String coverImageCaption = BeanParamUtil.getString(entry, request, "coverImageCa
long coverImageFileEntryId = BeanParamUtil.getLong(entry, request, "coverImageFileEntryId");
long smallImageFileEntryId = BeanParamUtil.getLong(entry, request, "smallImageFileEntryId");
+BlogsFileUploadsConfiguration blogsFileUploadsConfiguration = ConfigurationProviderUtil.getSystemConfiguration(BlogsFileUploadsConfiguration.class);
+BlogsGroupServiceSettings blogsGroupServiceSettings = BlogsGroupServiceSettings.getInstance(scopeGroupId);
+
portletDisplay.setShowBackIcon(true);
portletDisplay.setURLBack(redirect);
@@ -53,8 +56,6 @@ if (portletTitleBasedNavigation) {
renderResponse.setTitle((entry != null) ? BlogsEntryUtil.getDisplayTitle(resourceBundle, entry) : LanguageUtil.get(request, "new-blog-entry"));
}
-BlogsGroupServiceSettings blogsGroupServiceSettings = BlogsGroupServiceSettings.getInstance(scopeGroupId);
-
BlogsPortletInstanceConfiguration blogsPortletInstanceConfiguration = BlogsPortletInstanceConfigurationUtil.getBlogsPortletInstanceConfiguration(themeDisplay);
%>
@@ -121,6 +122,11 @@ BlogsPortletInstanceConfiguration blogsPortletInstanceConfiguration = BlogsPortl

+
+
+  <%= StringUtil.merge(blogsFileUploadsConfiguration.imageExtensions()) %>.
+
+

@@ -144,7 +150,6 @@ BlogsPortletInstanceConfiguration blogsPortletInstanceConfiguration = BlogsPortl

<%
- BlogsFileUploadsConfiguration blogsFileUploadsConfiguration = ConfigurationProviderUtil.getSystemConfiguration(BlogsFileUploadsConfiguration.class);
BlogsItemSelectorHelper blogsItemSelectorHelper = (BlogsItemSelectorHelper)request.getAttribute(BlogsWebKeys.BLOGS\_ITEM\_SELECTOR\_HELPER);
RequestBackedPortletURLFactory requestBackedPortletURLFactory = RequestBackedPortletURLFactoryUtil.create(liferayPortletRequest);
%>
diff --git a/modules/apps/calendar/calendar-service/src/main/java/com/liferay/calendar/internal/model/listener/UserModelListener.java b/modules/apps/calendar/calendar-service/src/main/java/com/liferay/calendar/internal/model/listener/UserModelListener.java
index 3f64230be9ec40..e7c2ac3bebd16b 100644
--- a/modules/apps/calendar/calendar-service/src/main/java/com/liferay/calendar/internal/model/listener/UserModelListener.java
+++ b/modules/apps/calendar/calendar-service/src/main/java/com/liferay/calendar/internal/model/listener/UserModelListener.java
@@ -18,6 +18,7 @@
import com.liferay.calendar.service.CalendarResourceLocalService;
import com.liferay.portal.kernel.exception.ModelListenerException;
import com.liferay.portal.kernel.model.BaseModelListener;
+import com.liferay.portal.kernel.model.GroupConstants;
import com.liferay.portal.kernel.model.ModelListener;
import com.liferay.portal.kernel.model.User;
import com.liferay.portal.kernel.util.LocaleUtil;
@@ -57,6 +58,10 @@ public void onAfterUpdate(User user) throws ModelListenerException {
return;
}
+ if (user.isDefaultUser() && name.equals(GroupConstants.GUEST)) {
+ return;
+ }
+
Map nameMap = new HashMap<>();
nameMap.put(LocaleUtil.getSiteDefault(), user.getFullName());
diff --git a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/META-INF/resources/search\_results.jsp b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/META-INF/resources/search\_results.jsp
index 0872e0b2699334..bf5ed0f37f722b 100644
--- a/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/META-INF/resources/search\_results.jsp
+++ b/modules/apps/configuration-admin/configuration-admin-web/src/main/resources/META-INF/resources/search\_results.jsp
@@ -17,15 +17,15 @@
<%@ include file="/init.jsp" %>
<%
-String redirect = renderRequest.getParameter("redirect");
+String redirect = PortalUtil.escapeRedirect(renderRequest.getParameter("redirect"));
ConfigurationEntryIterator configurationEntryIterator = (ConfigurationEntryIterator)request.getAttribute(ConfigurationAdminWebKeys.CONFIGURATION\_ENTRY\_ITERATOR);
ConfigurationEntryRetriever configurationEntryRetriever = (ConfigurationEntryRetriever)request.getAttribute(ConfigurationAdminWebKeys.CONFIGURATION\_ENTRY\_RETRIEVER);
ConfigurationScopeDisplayContext configurationScopeDisplayContext = new ConfigurationScopeDisplayContext(renderRequest);
-if (redirect == null) {
- redirect = renderResponse.createRenderURL();
+if (Validator.isNull(redirect)) {
+ redirect = String.valueOf(renderResponse.createRenderURL());
}
PortletURL searchURL = renderResponse.createRenderURL();
diff --git a/modules/apps/document-library/document-library-repository-cmis-impl/bnd.bnd b/modules/apps/document-library/document-library-repository-cmis-impl/bnd.bnd
index 3d576ce1c57b87..2ee7899360c5f3 100644
--- a/modules/apps/document-library/document-library-repository-cmis-impl/bnd.bnd
+++ b/modules/apps/document-library/document-library-repository-cmis-impl/bnd.bnd
@@ -26,4 +26,7 @@ Import-Package:\
\
!org.relaxng.datatype.\*,\
\
+ !org.springframework.osgi.io.\*,\
+ !org.springframework.osgi.util.\*,\
+ \
\*
\ No newline at end of file
diff --git a/modules/apps/document-library/document-library-repository-cmis-impl/build.gradle b/modules/apps/document-library/document-library-repository-cmis-impl/build.gradle
index 6623f19c40177b..9d8dd0d8a611c6 100644
--- a/modules/apps/document-library/document-library-repository-cmis-impl/build.gradle
+++ b/modules/apps/document-library/document-library-repository-cmis-impl/build.gradle
@@ -4,17 +4,17 @@ dependencies {
compileInclude group: "org.apache.chemistry.opencmis", name: "chemistry-opencmis-client-impl", version: "0.14.0"
compileInclude group: "org.apache.chemistry.opencmis", name: "chemistry-opencmis-commons-api", version: "0.14.0"
compileInclude group: "org.apache.chemistry.opencmis", name: "chemistry-opencmis-commons-impl", version: "0.14.0"
- compileInclude group: "org.apache.cxf", name: "cxf-api", version: "2.7.11"
- compileInclude group: "org.apache.cxf", name: "cxf-rt-bindings-soap", version: "2.7.11"
- compileInclude group: "org.apache.cxf", name: "cxf-rt-bindings-xml", version: "2.7.11"
- compileInclude group: "org.apache.cxf", name: "cxf-rt-core", version: "2.7.11"
- compileInclude group: "org.apache.cxf", name: "cxf-rt-databinding-jaxb", version: "2.7.11"
- compileInclude group: "org.apache.cxf", name: "cxf-rt-frontend-jaxws", version: "2.7.11"
- compileInclude group: "org.apache.cxf", name: "cxf-rt-frontend-simple", version: "2.7.11"
- compileInclude group: "org.apache.cxf", name: "cxf-rt-transports-http", version: "2.7.11"
- compileInclude group: "org.apache.cxf", name: "cxf-rt-ws-addr", version: "2.7.11"
- compileInclude group: "org.apache.cxf", name: "cxf-rt-ws-policy", version: "2.7.11"
- compileInclude group: "org.apache.neethi", name: "neethi", version: "3.0.3"
+ compileInclude group: "org.apache.cxf", name: "cxf-core", version: "3.2.12"
+ compileInclude group: "org.apache.cxf", name: "cxf-rt-bindings-soap", version: "3.2.12"
+ compileInclude group: "org.apache.cxf", name: "cxf-rt-bindings-xml", version: "3.2.12"
+ compileInclude group: "org.apache.cxf", name: "cxf-rt-databinding-jaxb", version: "3.2.12"
+ compileInclude group: "org.apache.cxf", name: "cxf-rt-frontend-jaxws", version: "3.2.12"
+ compileInclude group: "org.apache.cxf", name: "cxf-rt-frontend-simple", version: "3.2.12"
+ compileInclude group: "org.apache.cxf", name: "cxf-rt-transports-http", version: "3.2.12"
+ compileInclude group: "org.apache.cxf", name: "cxf-rt-ws-addr", version: "3.2.12"
+ compileInclude group: "org.apache.cxf", name: "cxf-rt-ws-policy", version: "3.2.12"
+ compileInclude group: "org.apache.cxf", name: "cxf-rt-wsdl", version: "3.2.12"
+ compileInclude group: "org.apache.neethi", name: "neethi", version: "3.1.1"
compileOnly group: "com.liferay", name: "com.liferay.document.library.repository.cmis.api", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.petra.concurrent", version: "3.0.0"
diff --git a/modules/apps/document-library/document-library-web/src/main/java/com/liferay/document/library/web/internal/display/context/DLAdminManagementToolbarDisplayContext.java b/modules/apps/document-library/document-library-web/src/main/java/com/liferay/document/library/web/internal/display/context/DLAdminManagementToolbarDisplayContext.java
index 54ece284bf2a58..57eed1aa4618a3 100644
--- a/modules/apps/document-library/document-library-web/src/main/java/com/liferay/document/library/web/internal/display/context/DLAdminManagementToolbarDisplayContext.java
+++ b/modules/apps/document-library/document-library-web/src/main/java/com/liferay/document/library/web/internal/display/context/DLAdminManagementToolbarDisplayContext.java
@@ -475,7 +475,7 @@ public List getFilterLabelItems() {
String label = String.format(
"%s: %s",
LanguageUtil.get(\_httpServletRequest, "owner"),
- user.getFullName());
+ HtmlUtil.escape(user.getFullName()));
labelItem.setLabel(label);
});
diff --git a/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/configuration.jsp b/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/configuration.jsp
index cec83375b3a648..f6512ff7dfe05f 100644
--- a/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/configuration.jsp
+++ b/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/configuration.jsp
@@ -185,7 +185,8 @@ DLPortletInstanceSettingsHelper dlPortletInstanceSettingsHelper = new DLPortletI
currentColumnsElement,
'<%= UnicodeLanguageUtil.get(request, "action") %>'
);
- } else {
+ }
+ else {
var options = document.querySelectorAll(
'#currentEntryColumns option[value="action"], #availableEntryColumns option[value="action"]'
);
diff --git a/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/edit\_file\_entry.jsp b/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/edit\_file\_entry.jsp
index f4cdcc6ea19706..473d58fd58aac9 100644
--- a/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/edit\_file\_entry.jsp
+++ b/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/edit\_file\_entry.jsp
@@ -588,7 +588,8 @@ if (portletTitleBasedNavigation) {
if (<%= dlAdminDisplayContext.isVersioningStrategyOverridable() %>) {
showVersionDetailsDialog(form);
- } else {
+ }
+ else {
submitForm(form);
}
}
diff --git a/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/edit\_folder.jsp b/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/edit\_folder.jsp
index efdbb4b2b9da1d..6672fa588ddfd1 100644
--- a/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/edit\_folder.jsp
+++ b/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/edit\_folder.jsp
@@ -353,7 +353,8 @@ if (portletTitleBasedNavigation) {
if (!searchContainerData.length) {
searchContainerData = [];
- } else {
+ }
+ else {
searchContainerData = searchContainerData.split(',');
}
@@ -531,7 +532,8 @@ if (portletTitleBasedNavigation) {
);
restrictionTypeWorkflow.show();
- } else {
+ }
+ else {
selectContainer.show();
}
},
diff --git a/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/info\_panel\_file\_entry.jsp b/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/info\_panel\_file\_entry.jsp
index 57fdbd9196aaf0..793fc2f3430e88 100644
--- a/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/info\_panel\_file\_entry.jsp
+++ b/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/info\_panel\_file\_entry.jsp
@@ -98,7 +98,7 @@ long assetClassPK = DLAssetHelperUtil.getAssetClassPK(fileEntry, fileVersion);
- [<%= owner.getFullName() %>](%3C%25%3D%20owner.isDefaultUser%28%29%20? StringPool.BLANK : owner.getDisplayURL(themeDisplay) %>)
+ [<%= HtmlUtil.escape(owner.getFullName()) %>](%3C%25%3D%20owner.isDefaultUser%28%29%20? StringPool.BLANK : owner.getDisplayURL(themeDisplay) %>)

diff --git a/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/js/bulk/BulkStatus.es.js b/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/js/bulk/BulkStatus.es.js
index 0172f85b41a663..f6d17b3680d2bc 100644
--- a/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/js/bulk/BulkStatus.es.js
+++ b/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/js/bulk/BulkStatus.es.js
@@ -104,7 +104,8 @@ class BulkStatus extends Component {
if (error) {
message = Liferay.Language.get('an-unexpected-error-occurred');
- } else {
+ }
+ else {
message = Liferay.Language.get('changes-saved');
}
diff --git a/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/js/categorization/EditCategories.es.js b/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/js/categorization/EditCategories.es.js
index c82a3765417ea2..0712ab054691da 100644
--- a/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/js/categorization/EditCategories.es.js
+++ b/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/js/categorization/EditCategories.es.js
@@ -55,9 +55,7 @@ class EditCategories extends Component {
created() {
this.append = true;
this.dataSource = [];
- this.urlCategories = `/bulk/v1.0/sites/${
- this.groupIds[0]
- }/taxonomy-vocabularies/common`;
+ this.urlCategories = `/bulk/v1.0/sites/${this.groupIds[0]}/taxonomy-vocabularies/common`;
this.\_feedbackErrorClass = 'form-feedback-item';
this.\_requiredVocabularyErrorMarkupText =
@@ -93,7 +91,8 @@ class EditCategories extends Component {
if (inputNode.value) {
inputNode.parentElement.parentElement.classList.remove('has-error');
- } else {
+ }
+ else {
inputNode.parentElement.parentElement.classList.add('has-error');
const feedbackErrorNode = inputNode.parentElement.querySelector(
@@ -282,7 +281,8 @@ class EditCategories extends Component {
if (!this.append) {
addedCategories = finalCategories;
- } else {
+ }
+ else {
addedCategories = finalCategories.filter(
categoryId =>
this.initialCategories.indexOf(categoryId) == -1
diff --git a/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/js/categorization/EditTags.es.js b/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/js/categorization/EditTags.es.js
index bd69ffebb2876f..ac9da0665f1909 100644
--- a/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/js/categorization/EditTags.es.js
+++ b/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/js/categorization/EditTags.es.js
@@ -172,7 +172,8 @@ class EditTags extends Component {
if (!this.append) {
addedTags = finalTags;
- } else {
+ }
+ else {
addedTags = finalTags.filter(
tag => this.\_initialTags.indexOf(tag) == -1
);
diff --git a/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/js/legacy/main.js b/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/js/legacy/main.js
index 990d643aeef74d..797ef6f50f6a43 100644
--- a/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/js/legacy/main.js
+++ b/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/js/legacy/main.js
@@ -84,7 +84,8 @@ AUI.add(
instance.\_selectedFileEntries = selectedElements.attr(
'value'
);
- } else {
+ }
+ else {
instance.\_selectedFileEntries = [];
}
},
@@ -285,7 +286,8 @@ AUI.add(
form.get(namespace + 'javax-portlet-action').val(
action
);
- } else {
+ }
+ else {
form.get(namespace + 'cmd').val(action);
}
@@ -327,20 +329,25 @@ AUI.add(
instance.\_openModalTags();
action = null;
- } else if (action === 'editCategories') {
+ }
+ else if (action === 'editCategories') {
instance.\_openModalCategories();
action = null;
- } else if (action === 'move' || action === 'moveEntries') {
+ }
+ else if (action === 'move' || action === 'moveEntries') {
instance.\_openModalMove();
action = null;
- } else if (action === 'download') {
+ }
+ else if (action === 'download') {
url = instance.get('downloadEntryUrl');
- } else if (action === 'deleteEntries') {
+ }
+ else if (action === 'deleteEntries') {
if (instance.get('trashEnabled')) {
action = 'move\_to\_trash';
- } else if (
+ }
+ else if (
confirm(
Liferay.Language.get(
'are-you-sure-you-want-to-delete-the-selected-entries'
@@ -348,10 +355,12 @@ AUI.add(
)
) {
action = 'delete';
- } else {
+ }
+ else {
action = null;
}
- } else if (action === 'checkin') {
+ }
+ else if (action === 'checkin') {
Liferay.DocumentLibraryCheckin.showDialog(
namespace,
(versionIncrease, changeLog) => {
@@ -525,7 +534,8 @@ AUI.add(
dialogTitle = Liferay.Language.get(
'select-destination-folder-for-x-item'
);
- } else {
+ }
+ else {
dialogTitle = Liferay.Language.get(
'select-destination-folder-for-x-items'
);
@@ -550,7 +560,8 @@ AUI.add(
parameterName,
parameterValue
);
- } else {
+ }
+ else {
instance.\_moveCurrentSelection(event.folderid);
}
}
diff --git a/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/js/legacy/upload.js b/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/js/legacy/upload.js
index f640c67e4af279..1daf69c5d8688b 100644
--- a/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/js/legacy/upload.js
+++ b/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/js/legacy/upload.js
@@ -301,7 +301,8 @@ AUI.add(
data
)
);
- } else {
+ }
+ else {
handles.push(
uploader.after(
'fileuploadstart',
@@ -522,7 +523,8 @@ AUI.add(
entriesContainer = searchContainer.one('tbody');
entryNode = instance.\_createEntryRow(name, size);
- } else {
+ }
+ else {
var entriesContainerSelector =
'ul.tabular-list-group:last-of-type';
@@ -613,11 +615,14 @@ AUI.add(
if (item == STR\_NAME) {
value = sub(TPL\_ENTRY\_ROW\_TITLE, [name]);
- } else if (item == STR\_SIZE) {
+ }
+ else if (item == STR\_SIZE) {
value = Liferay.Util.formatStorage(size);
- } else if (item == 'downloads') {
+ }
+ else if (item == 'downloads') {
value = '0';
- } else if (index === 0) {
+ }
+ else if (index === 0) {
value = sub(TPL\_HIDDEN\_CHECK\_BOX, [
instance.get(STR\_HOST).ns('rowIdsFileEntry')
]);
@@ -678,7 +683,8 @@ AUI.add(
file.overlay = overlay;
file.progressBar = progressBar;
file.target = target;
- } else {
+ }
+ else {
target.overlay = overlay;
target.progressBar = progressBar;
}
@@ -740,7 +746,8 @@ AUI.add(
'src',
PATH\_THEME\_IMAGES + '/common/close.png'
);
- } else {
+ }
+ else {
node.addClass(CSS\_UPLOAD\_ERROR);
}
@@ -782,7 +789,8 @@ AUI.add(
if (error === true) {
uploadResultClass = CSS\_UPLOAD\_ERROR;
- } else if (error == ERROR\_RESULTS\_MIXED) {
+ }
+ else if (error == ERROR\_RESULTS\_MIXED) {
uploadResultClass = CSS\_UPLOAD\_WARNING;
}
}
@@ -859,7 +867,8 @@ AUI.add(
var overlay = A.Widget.getByNode(target);
folderEntry = overlay.\_originalConfig.target;
- } else {
+ }
+ else {
if (target.attr('data-folder') === 'true') {
folderEntry = target;
}
@@ -893,7 +902,8 @@ AUI.add(
instance.get(STR\_FOLDER\_ID),
fileName
]);
- } else {
+ }
+ else {
if (
LString.endsWith(
fileName.toLowerCase(),
@@ -901,11 +911,14 @@ AUI.add(
)
) {
thumbnailName = STR\_THUMBNAIL\_PDF;
- } else if (REGEX\_AUDIO.test(fileName)) {
+ }
+ else if (REGEX\_AUDIO.test(fileName)) {
thumbnailName = STR\_THUMBNAIL\_AUDIO;
- } else if (REGEX\_VIDEO.test(fileName)) {
+ }
+ else if (REGEX\_VIDEO.test(fileName)) {
thumbnailName = STR\_THUMBNAIL\_VIDEO;
- } else if (REGEX\_COMPRESSED.test(fileName)) {
+ }
+ else if (REGEX\_COMPRESSED.test(fileName)) {
thumbnailName = STR\_THUMBNAIL\_COMPRESSED;
}
@@ -974,17 +987,19 @@ AUI.add(
try {
responseData = JSON.parse(responseData);
- } catch (e) {}
+ }
+ catch (e) {}
if (Lang.isObject(responseData)) {
error =
responseData.status &&
- (responseData.status >= 490 &&
- responseData.status < 500);
+ responseData.status >= 490 &&
+ responseData.status < 500;
if (error) {
message = responseData.message;
- } else {
+ }
+ else {
message =
instance.get(STR\_HOST).ns('fileEntryId=') +
responseData.fileEntryId;
@@ -1141,7 +1156,8 @@ AUI.add(
if (keyData) {
instance.\_updateDataSetEntry(key, keyData, validFiles);
- } else {
+ }
+ else {
var dataSet = instance.\_getDataSet();
var folderNode = null;
@@ -1196,7 +1212,8 @@ AUI.add(
response.message,
displayStyle
);
- } else {
+ }
+ else {
var displayStyleList = displayStyle == STR\_LIST;
var fileEntryId = JSON.parse(event.data)
@@ -1335,7 +1352,8 @@ AUI.add(
instance.\_attachSubscriptions(uploadData);
uploader.uploadThese(fileList, uploadURL);
- } else {
+ }
+ else {
uploader.fire('alluploadscomplete');
}
},
@@ -1347,7 +1365,8 @@ AUI.add(
if (currentUploadData.folderId === key) {
instance.\_addFilesToQueueBottom(unmergedData);
- } else {
+ }
+ else {
instance.\_combineFileLists(data.fileList, unmergedData);
var dataSet = instance.\_getDataSet();
@@ -1414,12 +1433,14 @@ AUI.add(
folderEntryNode.progressBar,
0
);
- } else {
+ }
+ else {
instance.\_createUploadStatus(folderEntryNode);
}
folderEntryNode.removeClass(CSS\_ACTIVE\_AREA);
- } else {
+ }
+ else {
var displayStyle = instance.\_getDisplayStyle();
filesPartition.matches.map(file => {
@@ -1487,7 +1508,8 @@ AUI.add(
instance.\_maxFileSize
)
]);
- } else if (size === 0) {
+ }
+ else if (size === 0) {
errorMessage = strings.zeroByteFile;
}
diff --git a/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/upload\_multiple\_file\_entries.jsp b/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/upload\_multiple\_file\_entries.jsp
index 1679d14a086f8b..021104b318b7e9 100644
--- a/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/upload\_multiple\_file\_entries.jsp
+++ b/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/upload\_multiple\_file\_entries.jsp
@@ -200,13 +200,15 @@ if (portletTitleBasedNavigation) {
if (originalFileName === item.fileName) {
childHTML =
'<%= UnicodeLanguageUtil.get(request, "successfully-saved") %>';
- } else {
+ }
+ else {
childHTML =
'<%= UnicodeLanguageUtil.get(request, "successfully-saved") %> (' +
item.fileName +
')';
}
- } else {
+ }
+ else {
cssClass = 'upload-error';
childHTML =
@@ -228,7 +230,8 @@ if (portletTitleBasedNavigation) {
if (commonFileMetadataContainer.io) {
commonFileMetadataContainer.io.start();
- } else {
+ }
+ else {
commonFileMetadataContainer.load(
'<%= uploadMultipleFileEntries %>'
);
diff --git a/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/upload\_multiple\_file\_entries\_resources.jsp b/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/upload\_multiple\_file\_entries\_resources.jsp
index 35d5e3902d3754..c07932831a306c 100644
--- a/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/upload\_multiple\_file\_entries\_resources.jsp
+++ b/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/document\_library/upload\_multiple\_file\_entries\_resources.jsp
@@ -259,7 +259,8 @@ else {
if (selectedFilesCount === fileNodes.length) {
selectedFilesText =
'<%= UnicodeLanguageUtil.get(request, "all-files-selected") %>';
- } else {
+ }
+ else {
selectedFilesText = Liferay.Util.sub(
'<%= UnicodeLanguageUtil.get(request, "x-files-selected") %>',
selectedFilesCount
diff --git a/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/image\_gallery\_display/view\_images.jsp b/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/image\_gallery\_display/view\_images.jsp
index a07f7dd5b53bf5..2548fd493e0a08 100644
--- a/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/image\_gallery\_display/view\_images.jsp
+++ b/modules/apps/document-library/document-library-web/src/main/resources/META-INF/resources/image\_gallery\_display/view\_images.jsp
@@ -267,7 +267,8 @@ embeddedPlayerURL.setWindowState(LiferayWindowState.POP\_UP);
imageViewer.\_syncPlaying = function() {
if (this.get('playing')) {
this.\_player.setHTML(TPL\_PLAYER\_PAUSE);
- } else {
+ }
+ else {
this.\_player.setHTML(TPL\_PLAYER\_PLAY);
}
};
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-field-type/build.gradle b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-field-type/build.gradle
index 9bbe58e9b75f4f..2ecb0435d63197 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-field-type/build.gradle
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-field-type/build.gradle
@@ -20,7 +20,7 @@ dependencies {
testCompile group: "com.liferay.portal", name: "com.liferay.util.java", version: "default"
testCompile group: "commons-collections", name: "commons-collections", version: "3.2.2"
testCompile group: "commons-lang", name: "commons-lang", version: "2.6"
- testCompile group: "org.dom4j", name: "dom4j", version: "2.0.0"
+ testCompile group: "org.dom4j", name: "dom4j", version: "2.1.3"
testCompile group: "org.jabsorb", name: "jabsorb", version: "1.3.1"
testCompile group: "org.jodd", name: "jodd-bean", version: "3.6.4"
testCompile group: "org.jodd", name: "jodd-json", version: "3.6.4"
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/build.gradle b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/build.gradle
index a58b08f1e26a26..6eebd854147800 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/build.gradle
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/build.gradle
@@ -42,7 +42,7 @@ dependencies {
compileOnly group: "org.osgi", name: "osgi.core", version: "6.0.0"
testCompile group: "commons-configuration", name: "commons-configuration", version: "1.10"
- testCompile group: "org.dom4j", name: "dom4j", version: "2.0.0"
+ testCompile group: "org.dom4j", name: "dom4j", version: "2.1.3"
testCompile group: "org.jodd", name: "jodd-bean", version: "3.6.4"
testCompile group: "org.jodd", name: "jodd-json", version: "3.6.4"
testCompile group: "org.json", name: "json", version: "20180813"
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-test/build.gradle b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-test/build.gradle
index 02a92967483d7f..a0519155b04a30 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-test/build.gradle
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-test/build.gradle
@@ -12,7 +12,7 @@ dependencies {
testCompile group: "commons-lang", name: "commons-lang", version: "2.6"
testCompile group: "javax.portlet", name: "portlet-api", version: "3.0.1"
testCompile group: "org.apache.felix", name: "org.apache.felix.http.servlet-api", version: "1.1.2"
- testCompile group: "org.dom4j", name: "dom4j", version: "2.0.0"
+ testCompile group: "org.dom4j", name: "dom4j", version: "2.1.3"
testCompile group: "org.jabsorb", name: "jabsorb", version: "1.3.1"
testCompile group: "org.jodd", name: "jodd-bean", version: "3.6.4"
testCompile group: "org.jodd", name: "jodd-json", version: "3.6.4"
diff --git a/modules/apps/export-import/export-import-service/src/main/java/com/liferay/exportimport/internal/staging/StagingImpl.java b/modules/apps/export-import/export-import-service/src/main/java/com/liferay/exportimport/internal/staging/StagingImpl.java
index 191aa1f2b2ba69..1d687d12d3687b 100644
--- a/modules/apps/export-import/export-import-service/src/main/java/com/liferay/exportimport/internal/staging/StagingImpl.java
+++ b/modules/apps/export-import/export-import-service/src/main/java/com/liferay/exportimport/internal/staging/StagingImpl.java
@@ -2363,6 +2363,8 @@ public long publishLayouts(
long userId, ExportImportConfiguration exportImportConfiguration)
throws PortalException {
+ \_checkPermission(exportImportConfiguration);
+
Map settingsMap =
exportImportConfiguration.getSettingsMap();
@@ -3654,6 +3656,8 @@ protected long doCopyRemoteLayouts(
boolean secureConnection, boolean remotePrivateLayout)
throws PortalException {
+ \_checkPermission(exportImportConfiguration);
+
Map settingsMap =
exportImportConfiguration.getSettingsMap();
@@ -4163,6 +4167,15 @@ protected void setRecentLayoutSetBranchId(
ProxiedLayoutsThreadLocal.clearProxiedLayouts();
}
+ private void \_checkPermission(
+ ExportImportConfiguration exportImportConfiguration)
+ throws PortalException {
+
+ GroupPermissionUtil.check(
+ PermissionThreadLocal.getPermissionChecker(),
+ exportImportConfiguration.getGroupId(), ActionKeys.PUBLISH\_STAGING);
+ }
+
private void \_setGroupTypeSetting(long groupId, String key, String value) {
Group group = \_groupLocalService.fetchGroup(groupId);
diff --git a/modules/apps/fragment/fragment-web/src/main/java/com/liferay/fragment/web/internal/display/context/EditFragmentEntryDisplayContext.java b/modules/apps/fragment/fragment-web/src/main/java/com/liferay/fragment/web/internal/display/context/EditFragmentEntryDisplayContext.java
index df38a783b8f5cb..6bdcac0275d65f 100644
--- a/modules/apps/fragment/fragment-web/src/main/java/com/liferay/fragment/web/internal/display/context/EditFragmentEntryDisplayContext.java
+++ b/modules/apps/fragment/fragment-web/src/main/java/com/liferay/fragment/web/internal/display/context/EditFragmentEntryDisplayContext.java
@@ -302,11 +302,9 @@ private String \_getCssContent() {
return \_cssContent;
}
- \_cssContent = ParamUtil.getString(\_httpServletRequest, "cssContent");
-
FragmentEntry fragmentEntry = getFragmentEntry();
- if ((fragmentEntry != null) && Validator.isNull(\_cssContent)) {
+ if (fragmentEntry != null) {
\_cssContent = fragmentEntry.getCss();
if (Validator.isNull(\_cssContent)) {
@@ -348,11 +346,9 @@ private String \_getHtmlContent() {
return \_htmlContent;
}
- \_htmlContent = ParamUtil.getString(\_httpServletRequest, "htmlContent");
-
FragmentEntry fragmentEntry = getFragmentEntry();
- if ((fragmentEntry != null) && Validator.isNull(\_htmlContent)) {
+ if (fragmentEntry != null) {
\_htmlContent = fragmentEntry.getHtml();
if (Validator.isNull(\_htmlContent)) {
@@ -374,11 +370,9 @@ private String \_getJsContent() {
return \_jsContent;
}
- \_jsContent = ParamUtil.getString(\_httpServletRequest, "jsContent");
-
FragmentEntry fragmentEntry = getFragmentEntry();
- if ((fragmentEntry != null) && Validator.isNull(\_jsContent)) {
+ if (fragmentEntry != null) {
\_jsContent = fragmentEntry.getJs();
}
diff --git a/modules/apps/frontend-js/frontend-js-jquery-web/package.json b/modules/apps/frontend-js/frontend-js-jquery-web/package.json
index dc48d0455d8127..c9184d0e09cafa 100644
--- a/modules/apps/frontend-js/frontend-js-jquery-web/package.json
+++ b/modules/apps/frontend-js/frontend-js-jquery-web/package.json
@@ -1,7 +1,7 @@
{
"dependencies": {
"bootstrap": "4.3.1",
- "jquery": "3.4.1",
+ "jquery": "3.5.1",
"popper.js": "1.14.7"
},
"name": "frontend-js-jquery-web",
diff --git a/modules/apps/imageio-plugins/imageio-plugins/build.gradle b/modules/apps/imageio-plugins/imageio-plugins/build.gradle
index 8843347d4f7ee2..71d1de1f9ad152 100644
--- a/modules/apps/imageio-plugins/imageio-plugins/build.gradle
+++ b/modules/apps/imageio-plugins/imageio-plugins/build.gradle
@@ -2,21 +2,21 @@ dependencies {
compileInclude group: "com.twelvemonkeys.common", name: "common-image", version: "3.3.2"
compileInclude group: "com.twelvemonkeys.common", name: "common-io", version: "3.3.2"
compileInclude group: "com.twelvemonkeys.common", name: "common-lang", version: "3.3.2"
- compileInclude group: "com.twelvemonkeys.imageio", name: "imageio-bmp", version: "3.3.2"
- compileInclude group: "com.twelvemonkeys.imageio", name: "imageio-core", version: "3.3.2"
- compileInclude group: "com.twelvemonkeys.imageio", name: "imageio-hdr", version: "3.3.2"
- compileInclude group: "com.twelvemonkeys.imageio", name: "imageio-icns", version: "3.3.2"
- compileInclude group: "com.twelvemonkeys.imageio", name: "imageio-iff", version: "3.3.2"
- compileInclude group: "com.twelvemonkeys.imageio", name: "imageio-jpeg", version: "3.3.2"
- compileInclude group: "com.twelvemonkeys.imageio", name: "imageio-metadata", version: "3.3.2"
- compileInclude group: "com.twelvemonkeys.imageio", name: "imageio-pcx", version: "3.3.2"
- compileInclude group: "com.twelvemonkeys.imageio", name: "imageio-pict", version: "3.3.2"
- compileInclude group: "com.twelvemonkeys.imageio", name: "imageio-pnm", version: "3.3.2"
- compileInclude group: "com.twelvemonkeys.imageio", name: "imageio-psd", version: "3.3.2"
- compileInclude group: "com.twelvemonkeys.imageio", name: "imageio-sgi", version: "3.3.2"
- compileInclude group: "com.twelvemonkeys.imageio", name: "imageio-tga", version: "3.3.2"
- compileInclude group: "com.twelvemonkeys.imageio", name: "imageio-thumbsdb", version: "3.3.2"
- compileInclude group: "com.twelvemonkeys.imageio", name: "imageio-tiff", version: "3.3.2"
+ compileInclude group: "com.twelvemonkeys.imageio", name: "imageio-bmp", version: "3.5"
+ compileInclude group: "com.twelvemonkeys.imageio", name: "imageio-core", version: "3.5"
+ compileInclude group: "com.twelvemonkeys.imageio", name: "imageio-hdr", version: "3.5"
+ compileInclude group: "com.twelvemonkeys.imageio", name: "imageio-icns", version: "3.5"
+ compileInclude group: "com.twelvemonkeys.imageio", name: "imageio-iff", version: "3.5"
+ compileInclude group: "com.twelvemonkeys.imageio", name: "imageio-jpeg", version: "3.5"
+ compileInclude group: "com.twelvemonkeys.imageio", name: "imageio-metadata", version: "3.5"
+ compileInclude group: "com.twelvemonkeys.imageio", name: "imageio-pcx", version: "3.5"
+ compileInclude group: "com.twelvemonkeys.imageio", name: "imageio-pict", version: "3.5"
+ compileInclude group: "com.twelvemonkeys.imageio", name: "imageio-pnm", version: "3.5"
+ compileInclude group: "com.twelvemonkeys.imageio", name: "imageio-psd", version: "3.5"
+ compileInclude group: "com.twelvemonkeys.imageio", name: "imageio-sgi", version: "3.5"
+ compileInclude group: "com.twelvemonkeys.imageio", name: "imageio-tga", version: "3.5"
+ compileInclude group: "com.twelvemonkeys.imageio", name: "imageio-thumbsdb", version: "3.5"
+ compileInclude group: "com.twelvemonkeys.imageio", name: "imageio-tiff", version: "3.5"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "4.34.0"
compileOnly group: "org.osgi", name: "osgi.core", version: "6.0.0"
diff --git a/modules/apps/login/login-web/src/main/java/com/liferay/login/web/internal/portlet/action/ForgotPasswordMVCActionCommand.java b/modules/apps/login/login-web/src/main/java/com/liferay/login/web/internal/portlet/action/ForgotPasswordMVCActionCommand.java
index e273abe549d62e..4b3585efc35b56 100644
--- a/modules/apps/login/login-web/src/main/java/com/liferay/login/web/internal/portlet/action/ForgotPasswordMVCActionCommand.java
+++ b/modules/apps/login/login-web/src/main/java/com/liferay/login/web/internal/portlet/action/ForgotPasswordMVCActionCommand.java
@@ -28,7 +28,10 @@
import com.liferay.portal.kernel.exception.UserLockoutException;
import com.liferay.portal.kernel.exception.UserReminderQueryException;
import com.liferay.portal.kernel.language.LanguageUtil;
+import com.liferay.portal.kernel.log.Log;
+import com.liferay.portal.kernel.log.LogFactoryUtil;
import com.liferay.portal.kernel.model.Company;
+import com.liferay.portal.kernel.model.CompanyConstants;
import com.liferay.portal.kernel.model.User;
import com.liferay.portal.kernel.module.configuration.ConfigurationProvider;
import com.liferay.portal.kernel.portlet.bridges.mvc.BaseMVCActionCommand;
@@ -38,6 +41,7 @@
import com.liferay.portal.kernel.servlet.SessionErrors;
import com.liferay.portal.kernel.servlet.SessionMessages;
import com.liferay.portal.kernel.theme.ThemeDisplay;
+import com.liferay.portal.kernel.util.GetterUtil;
import com.liferay.portal.kernel.util.ParamUtil;
import com.liferay.portal.kernel.util.Portal;
import com.liferay.portal.kernel.util.PropsKeys;
@@ -45,6 +49,9 @@
import com.liferay.portal.kernel.util.WebKeys;
import com.liferay.portal.util.PropsValues;
+import java.util.Iterator;
+import java.util.Set;
+
import javax.portlet.ActionRequest;
import javax.portlet.ActionResponse;
import javax.portlet.PortletPreferences;
@@ -86,22 +93,27 @@ protected void checkReminderQueries(
int step = ParamUtil.getInteger(actionRequest, "step");
+ String login = (String)portletSession.getAttribute(
+ WebKeys.FORGOT\_PASSWORD\_REMINDER\_USER\_EMAIL\_ADDRESS);
+
+ if (login == null) {
+ step = 1;
+ }
+
if (step == 1) {
checkCaptcha(actionRequest);
portletSession.removeAttribute(
WebKeys.FORGOT\_PASSWORD\_REMINDER\_ATTEMPTS);
- portletSession.removeAttribute(
- WebKeys.FORGOT\_PASSWORD\_REMINDER\_USER\_EMAIL\_ADDRESS);
- }
- User user = getUser(actionRequest);
+ login = ParamUtil.getString(actionRequest, "login");
- portletSession.setAttribute(
- WebKeys.FORGOT\_PASSWORD\_REMINDER\_USER\_EMAIL\_ADDRESS,
- user.getEmailAddress());
+ portletSession.setAttribute(
+ WebKeys.FORGOT\_PASSWORD\_REMINDER\_USER\_EMAIL\_ADDRESS, login);
+ }
- actionRequest.setAttribute(WebKeys.FORGOT\_PASSWORD\_REMINDER\_USER, user);
+ actionRequest.setAttribute(
+ WebKeys.FORGOT\_PASSWORD\_REMINDER\_USER, getUser(actionRequest));
if (step == 2) {
Integer reminderAttempts = (Integer)portletSession.getAttribute(
@@ -149,18 +161,24 @@ protected void doProcessAction(
sendPassword(actionRequest, actionResponse);
}
}
- catch (Exception e) {
- if (e instanceof CaptchaException ||
- e instanceof UserEmailAddressException) {
+ catch (Exception exception) {
+ if (\_log.isDebugEnabled()) {
+ \_log.debug(
+ "Unable to send password: " + exception.getMessage(),
+ exception);
+ }
+
+ if (exception instanceof CaptchaException ||
+ exception instanceof UserEmailAddressException ||
+ exception instanceof UserReminderQueryException) {
- SessionErrors.add(actionRequest, e.getClass());
+ SessionErrors.add(actionRequest, exception.getClass());
}
- else if (e instanceof NoSuchUserException ||
- e instanceof RequiredReminderQueryException ||
- e instanceof SendPasswordException ||
- e instanceof UserActiveException ||
- e instanceof UserLockoutException ||
- e instanceof UserReminderQueryException) {
+ else if (exception instanceof NoSuchUserException ||
+ exception instanceof RequiredReminderQueryException ||
+ exception instanceof SendPasswordException ||
+ exception instanceof UserActiveException ||
+ exception instanceof UserLockoutException) {
if (PropsValues.LOGIN\_SECURE\_FORGOT\_PASSWORD) {
SessionMessages.add(
@@ -170,11 +188,11 @@ else if (e instanceof NoSuchUserException ||
sendRedirect(actionRequest, actionResponse, null);
}
else {
- SessionErrors.add(actionRequest, e.getClass(), e);
+ SessionErrors.add(actionRequest, exception.getClass(), exception);
}
}
else {
- \_portal.sendError(e, actionRequest, actionResponse);
+ \_portal.sendError(exception, actionRequest, actionResponse);
}
}
}
@@ -192,64 +210,57 @@ protected CaptchaConfiguration getCaptchaConfiguration()
}
protected User getUser(ActionRequest actionRequest) throws Exception {
- PortletSession portletSession = actionRequest.getPortletSession();
+ try {
+ return \_getUser(actionRequest);
+ }
+ catch (Exception exception) {
+ if (\_log.isDebugEnabled()) {
+ \_log.debug(
+ "Unable to get user: " + exception.getMessage(), exception);
+ }
+
+ if (!PropsValues.LOGIN\_SECURE\_FORGOT\_PASSWORD) {
+ throw exception;
+ }
+ }
ThemeDisplay themeDisplay = (ThemeDisplay)actionRequest.getAttribute(
WebKeys.THEME\_DISPLAY);
- String sessionEmailAddress = (String)portletSession.getAttribute(
- WebKeys.FORGOT\_PASSWORD\_REMINDER\_USER\_EMAIL\_ADDRESS);
+ User defaultUser = \_userLocalService.getDefaultUser(
+ themeDisplay.getCompanyId());
- User user = null;
+ Set reminderQueryQuestions =
+ defaultUser.getReminderQueryQuestions();
- if (Validator.isNotNull(sessionEmailAddress)) {
- user = \_userLocalService.getUserByEmailAddress(
- themeDisplay.getCompanyId(), sessionEmailAddress);
+ if (!reminderQueryQuestions.isEmpty()) {
+ Iterator iterator = reminderQueryQuestions.iterator();
+
+ defaultUser.setReminderQueryQuestion(iterator.next());
}
else {
- long userId = ParamUtil.getLong(actionRequest, "userId");
- String screenName = ParamUtil.getString(
- actionRequest, "screenName");
- String emailAddress = ParamUtil.getString(
- actionRequest, "emailAddress");
-
- if (Validator.isNotNull(emailAddress)) {
- user = \_userLocalService.getUserByEmailAddress(
- themeDisplay.getCompanyId(), emailAddress);
- }
- else if (Validator.isNotNull(screenName)) {
- user = \_userLocalService.getUserByScreenName(
- themeDisplay.getCompanyId(), screenName);
- }
- else if (userId > 0) {
- user = \_userLocalService.getUserById(userId);
- }
- else {
- throw new NoSuchUserException("User does not exist");
- }
+ defaultUser.setReminderQueryQuestion(
+ "what-is-your-library-card-number");
}
- if (!user.isActive()) {
- throw new UserActiveException("Inactive user " + user.getUuid());
- }
+ defaultUser.setReminderQueryAnswer(
+ defaultUser.getReminderQueryQuestion());
- \_userLocalService.checkLockout(user);
-
- return user;
+ return defaultUser;
}
protected void sendPassword(
ActionRequest actionRequest, ActionResponse actionResponse)
throws Exception {
- ThemeDisplay themeDisplay = (ThemeDisplay)actionRequest.getAttribute(
- WebKeys.THEME\_DISPLAY);
-
- Company company = themeDisplay.getCompany();
-
User user = getUser(actionRequest);
if (PropsValues.USERS\_REMINDER\_QUERIES\_ENABLED) {
+ if (user.isDefaultUser()) {
+ throw new UserReminderQueryException(
+ "Reminder query answer does not match answer");
+ }
+
if (PropsValues.USERS\_REMINDER\_QUERIES\_REQUIRED &&
!user.hasReminderQuery()) {
@@ -268,6 +279,19 @@ protected void sendPassword(
}
}
+ if (user.isDefaultUser()) {
+ SessionMessages.add(
+ \_portal.getHttpServletRequest(actionRequest),
+ "forgotPasswordSent");
+
+ return;
+ }
+
+ ThemeDisplay themeDisplay = (ThemeDisplay)actionRequest.getAttribute(
+ WebKeys.THEME\_DISPLAY);
+
+ Company company = themeDisplay.getCompany();
+
PortletPreferences portletPreferences = actionRequest.getPreferences();
String languageId = LanguageUtil.getLanguageId(actionRequest);
@@ -304,6 +328,52 @@ protected void setUserLocalService(UserLocalService userLocalService) {
\_userLocalService = userLocalService;
}
+ private User \_getUser(ActionRequest actionRequest) throws Exception {
+ User user = null;
+
+ ThemeDisplay themeDisplay = (ThemeDisplay)actionRequest.getAttribute(
+ WebKeys.THEME\_DISPLAY);
+
+ Company company = themeDisplay.getCompany();
+
+ String authType = company.getAuthType();
+
+ PortletSession portletSession = actionRequest.getPortletSession();
+
+ String login = (String)portletSession.getAttribute(
+ WebKeys.FORGOT\_PASSWORD\_REMINDER\_USER\_EMAIL\_ADDRESS);
+
+ if (Validator.isNull(login)) {
+ login = ParamUtil.getString(actionRequest, "login");
+ }
+
+ if (authType.equals(CompanyConstants.AUTH\_TYPE\_EA)) {
+ user = \_userLocalService.getUserByEmailAddress(
+ themeDisplay.getCompanyId(), login);
+ }
+ else if (authType.equals(CompanyConstants.AUTH\_TYPE\_SN)) {
+ user = \_userLocalService.getUserByScreenName(
+ themeDisplay.getCompanyId(), login);
+ }
+ else if (authType.equals(CompanyConstants.AUTH\_TYPE\_ID)) {
+ user = \_userLocalService.getUserById(GetterUtil.getLong(login));
+ }
+ else {
+ throw new NoSuchUserException("User does not exist");
+ }
+
+ if (!user.isActive()) {
+ throw new UserActiveException("Inactive user " + user.getUuid());
+ }
+
+ \_userLocalService.checkLockout(user);
+
+ return user;
+ }
+
+ private static final Log \_log = LogFactoryUtil.getLog(
+ ForgotPasswordMVCActionCommand.class);
+
@Reference
private ConfigurationProvider \_configurationProvider;
diff --git a/modules/apps/login/login-web/src/main/resources/META-INF/resources/create\_account.jsp b/modules/apps/login/login-web/src/main/resources/META-INF/resources/create\_account.jsp
index 9fbb1fd312ff89..2c618b4a49d874 100644
--- a/modules/apps/login/login-web/src/main/resources/META-INF/resources/create\_account.jsp
+++ b/modules/apps/login/login-web/src/main/resources/META-INF/resources/create\_account.jsp
@@ -33,7 +33,7 @@ renderResponse.setTitle(LanguageUtil.get(request, "create-account"));
-
+

diff --git a/modules/apps/login/login-web/src/main/resources/META-INF/resources/forgot\_password.jsp b/modules/apps/login/login-web/src/main/resources/META-INF/resources/forgot\_password.jsp
index ff97130890db3f..524ed01c99ac2f 100644
--- a/modules/apps/login/login-web/src/main/resources/META-INF/resources/forgot\_password.jsp
+++ b/modules/apps/login/login-web/src/main/resources/META-INF/resources/forgot\_password.jsp
@@ -23,6 +23,8 @@ if (Validator.isNull(authType)) {
authType = company.getAuthType();
}
+String login = (String)portletSession.getAttribute(WebKeys.FORGOT\_PASSWORD\_REMINDER\_USER\_EMAIL\_ADDRESS);
+
Integer reminderAttempts = (Integer)portletSession.getAttribute(WebKeys.FORGOT\_PASSWORD\_REMINDER\_ATTEMPTS);
if (reminderAttempts == null) {
@@ -74,23 +76,17 @@ renderResponse.setTitle(LanguageUtil.get(request, "forgot-password"));
<%
- String loginParameter = null;
String loginLabel = null;
if (authType.equals(CompanyConstants.AUTH\_TYPE\_EA)) {
- loginParameter = "emailAddress";
loginLabel = "email-address";
}
else if (authType.equals(CompanyConstants.AUTH\_TYPE\_SN)) {
- loginParameter = "screenName";
loginLabel = "screen-name";
}
else if (authType.equals(CompanyConstants.AUTH\_TYPE\_ID)) {
- loginParameter = "userId";
loginLabel = "id";
}
-
- String loginValue = ParamUtil.getString(request, loginParameter);
%>

@@ -103,7 +99,7 @@ renderResponse.setTitle(LanguageUtil.get(request, "forgot-password"));

-
+

@@ -119,7 +115,7 @@ renderResponse.setTitle(LanguageUtil.get(request, "forgot-password"));

-
+

@@ -129,21 +125,6 @@ renderResponse.setTitle(LanguageUtil.get(request, "forgot-password"));

-
- <%
- String login = null;
-
- if (authType.equals(CompanyConstants.AUTH\_TYPE\_EA)) {
- login = user2.getEmailAddress();
- }
- else if (authType.equals(CompanyConstants.AUTH\_TYPE\_SN)) {
- login = user2.getScreenName();
- }
- else if (authType.equals(CompanyConstants.AUTH\_TYPE\_ID)) {
- login = String.valueOf(user2.getUserId());
- }
- %>
-

diff --git a/modules/apps/marketplace/marketplace-app-manager-web/src/main/resources/META-INF/resources/view\_search\_results.jsp b/modules/apps/marketplace/marketplace-app-manager-web/src/main/resources/META-INF/resources/view\_search\_results.jsp
index 86a4ad1b9f9820..8e4cc6f2ec320f 100644
--- a/modules/apps/marketplace/marketplace-app-manager-web/src/main/resources/META-INF/resources/view\_search\_results.jsp
+++ b/modules/apps/marketplace/marketplace-app-manager-web/src/main/resources/META-INF/resources/view\_search\_results.jsp
@@ -17,7 +17,11 @@
<%@ include file="/init.jsp" %>
<%
-String redirect = ParamUtil.getString(request, "redirect", String.valueOf(renderResponse.createRenderURL()));
+String redirect = PortalUtil.escapeRedirect(ParamUtil.getString(request, "redirect"));
+
+if (Validator.isNull(redirect)) {
+ redirect = String.valueOf(renderResponse.createRenderURL());
+}
portletDisplay.setShowBackIcon(true);
portletDisplay.setURLBack(redirect);
diff --git a/modules/apps/oauth2-provider/oauth2-provider-jsonws/src/main/java/com/liferay/oauth2/provider/jsonws/internal/security/auth/verifier/OAuth2JSONWSAuthVerifier.java b/modules/apps/oauth2-provider/oauth2-provider-jsonws/src/main/java/com/liferay/oauth2/provider/jsonws/internal/security/auth/verifier/OAuth2JSONWSAuthVerifier.java
index 1991861a54e8fe..337408c8541817 100644
--- a/modules/apps/oauth2-provider/oauth2-provider-jsonws/src/main/java/com/liferay/oauth2/provider/jsonws/internal/security/auth/verifier/OAuth2JSONWSAuthVerifier.java
+++ b/modules/apps/oauth2-provider/oauth2-provider-jsonws/src/main/java/com/liferay/oauth2/provider/jsonws/internal/security/auth/verifier/OAuth2JSONWSAuthVerifier.java
@@ -35,6 +35,7 @@
import com.liferay.portal.kernel.log.LogFactoryUtil;
import com.liferay.portal.kernel.security.auth.AccessControlContext;
import com.liferay.portal.kernel.security.auth.AuthException;
+import com.liferay.portal.kernel.security.auth.CompanyThreadLocal;
import com.liferay.portal.kernel.security.auth.verifier.AuthVerifier;
import com.liferay.portal.kernel.security.auth.verifier.AuthVerifierResult;
import com.liferay.portal.kernel.security.service.access.policy.ServiceAccessPolicy;
@@ -101,6 +102,10 @@ public AuthVerifierResult verify(
long companyId = oAuth2Application.getCompanyId();
+ if (companyId != CompanyThreadLocal.getCompanyId()) {
+ return authVerifierResult;
+ }
+
BearerTokenProvider bearerTokenProvider =
\_bearerTokenProviderAccessor.getBearerTokenProvider(
companyId, oAuth2Application.getClientId());
diff --git a/modules/apps/oauth2-provider/oauth2-provider-rest/src/main/java/com/liferay/oauth2/provider/rest/internal/security/auth/verifier/OAuth2RESTAuthVerifier.java b/modules/apps/oauth2-provider/oauth2-provider-rest/src/main/java/com/liferay/oauth2/provider/rest/internal/security/auth/verifier/OAuth2RESTAuthVerifier.java
index 1adec7d8dbfc20..35f3bb824d1cb1 100644
--- a/modules/apps/oauth2-provider/oauth2-provider-rest/src/main/java/com/liferay/oauth2/provider/rest/internal/security/auth/verifier/OAuth2RESTAuthVerifier.java
+++ b/modules/apps/oauth2-provider/oauth2-provider-rest/src/main/java/com/liferay/oauth2/provider/rest/internal/security/auth/verifier/OAuth2RESTAuthVerifier.java
@@ -30,6 +30,7 @@
import com.liferay.portal.kernel.log.LogFactoryUtil;
import com.liferay.portal.kernel.security.auth.AccessControlContext;
import com.liferay.portal.kernel.security.auth.AuthException;
+import com.liferay.portal.kernel.security.auth.CompanyThreadLocal;
import com.liferay.portal.kernel.security.auth.verifier.AuthVerifier;
import com.liferay.portal.kernel.security.auth.verifier.AuthVerifierResult;
import com.liferay.portal.kernel.servlet.HttpHeaders;
@@ -84,6 +85,12 @@ public AuthVerifierResult verify(
OAuth2Application oAuth2Application =
accessToken.getOAuth2Application();
+ long companyId = oAuth2Application.getCompanyId();
+
+ if (companyId != CompanyThreadLocal.getCompanyId()) {
+ return authVerifierResult;
+ }
+
BearerTokenProvider bearerTokenProvider =
\_bearerTokenProviderAccessor.getBearerTokenProvider(
oAuth2Application.getCompanyId(),
diff --git a/modules/apps/petra/petra-log4j/build.gradle b/modules/apps/petra/petra-log4j/build.gradle
index f0ab10f43e8b98..e70e04bf61e78f 100644
--- a/modules/apps/petra/petra-log4j/build.gradle
+++ b/modules/apps/petra/petra-log4j/build.gradle
@@ -2,6 +2,6 @@ dependencies {
compileOnly group: "com.liferay", name: "com.liferay.petra.reflect", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "3.0.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "4.34.0"
- compileOnly group: "dom4j", name: "dom4j", version: "1.6.1"
+ compileOnly group: "org.dom4j", name: "dom4j", version: "2.1.3"
compileOnly group: "log4j", name: "log4j", version: "1.2.17"
}
\ No newline at end of file
diff --git a/modules/apps/petra/petra-xml/build.gradle b/modules/apps/petra/petra-xml/build.gradle
index af74ffc13c6bae..17627e63cbb0ac 100644
--- a/modules/apps/petra/petra-xml/build.gradle
+++ b/modules/apps/petra/petra-xml/build.gradle
@@ -1,5 +1,5 @@
dependencies {
compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "3.0.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "4.34.0"
- compileOnly group: "dom4j", name: "dom4j", version: "1.6.1"
+ compileOnly group: "org.dom4j", name: "dom4j", version: "2.1.3"
}
\ No newline at end of file
diff --git a/modules/apps/portal-odata/portal-odata-impl/bnd.bnd b/modules/apps/portal-odata/portal-odata-impl/bnd.bnd
index 169bc63854e435..f8eba8fa15569c 100644
--- a/modules/apps/portal-odata/portal-odata-impl/bnd.bnd
+++ b/modules/apps/portal-odata/portal-odata-impl/bnd.bnd
@@ -1,4 +1,39 @@
Bundle-Name: Liferay Portal OData Implementation
Bundle-SymbolicName: com.liferay.portal.odata.impl
Bundle-Version: 2.0.8
-Import-Package: \*
\ No newline at end of file
+Import-Package:\
+ !com.google.protobuf.\*,\
+ \
+ !com.jcraft.jzlib.\*,\
+ \
+ !com.ning.compress.\*,\
+ \
+ !com.oracle.svm.core.annotate.\*,\
+ \
+ !io.netty.internal.tcnative.\*,\
+ \
+ !lzma.sdk.\*,\
+ \
+ !net.jpountz.lz4.\*,\
+ !net.jpountz.xxhash.\*,\
+ \
+ !org.apache.logging.log4j.\*,\
+ \
+ !org.bouncycastle.asn1.x500.\*,\
+ !org.bouncycastle.cert.\*,\
+ !org.bouncycastle.jce.provider.\*,\
+ !org.bouncycastle.operator.\*,\
+ \
+ !org.conscrypt.\*,\
+ \
+ !org.eclipse.jetty.alpn.\*,\
+ !org.eclipse.jetty.npn.\*,\
+ \
+ !org.jboss.marshalling.\*,\
+ \
+ !reactor.blockhound.\*,\
+ \
+ !sun.security.util.\*,\
+ !sun.security.x509.\*,\
+ \
+ \*
\ No newline at end of file
diff --git a/modules/apps/portal-odata/portal-odata-impl/build.gradle b/modules/apps/portal-odata/portal-odata-impl/build.gradle
index e8d5178bf98423..8215925ed93b44 100644
--- a/modules/apps/portal-odata/portal-odata-impl/build.gradle
+++ b/modules/apps/portal-odata/portal-odata-impl/build.gradle
@@ -1,9 +1,16 @@
dependencies {
- compileInclude group: "org.apache.olingo", name: "odata-commons-api", version: "4.4.0"
- compileInclude group: "org.apache.olingo", name: "odata-commons-core", version: "4.4.0"
- compileInclude group: "org.apache.olingo", name: "odata-server-api", version: "4.4.0"
- compileInclude group: "org.apache.olingo", name: "odata-server-core", version: "4.4.0"
- compileInclude group: "org.apache.olingo", name: "odata-server-core-ext", version: "4.4.0"
+ compileInclude group: "io.netty", name: "netty-buffer", version: "4.1.50.Final"
+ compileInclude group: "io.netty", name: "netty-codec", version: "4.1.50.Final"
+ compileInclude group: "io.netty", name: "netty-codec-http", version: "4.1.50.Final"
+ compileInclude group: "io.netty", name: "netty-common", version: "4.1.50.Final"
+ compileInclude group: "io.netty", name: "netty-handler", version: "4.1.50.Final"
+ compileInclude group: "io.netty", name: "netty-resolver", version: "4.1.50.Final"
+ compileInclude group: "io.netty", name: "netty-transport", version: "4.1.50.Final"
+ compileInclude group: "org.apache.olingo", name: "odata-commons-api", version: "4.7.1"
+ compileInclude group: "org.apache.olingo", name: "odata-commons-core", version: "4.7.1"
+ compileInclude group: "org.apache.olingo", name: "odata-server-api", version: "4.7.1"
+ compileInclude group: "org.apache.olingo", name: "odata-server-core", version: "4.7.1"
+ compileInclude group: "org.apache.olingo", name: "odata-server-core-ext", version: "4.7.1"
compileOnly group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.10.1"
compileOnly group: "com.liferay", name: "com.liferay.osgi.util", version: "5.0.0"
diff --git a/modules/apps/portal-odata/portal-odata-impl/src/main/java/com/liferay/portal/odata/internal/filter/expression/ExpressionVisitorImpl.java b/modules/apps/portal-odata/portal-odata-impl/src/main/java/com/liferay/portal/odata/internal/filter/expression/ExpressionVisitorImpl.java
index 256f7ed9eecdf6..9ea74f98134da3 100644
--- a/modules/apps/portal-odata/portal-odata-impl/src/main/java/com/liferay/portal/odata/internal/filter/expression/ExpressionVisitorImpl.java
+++ b/modules/apps/portal-odata/portal-odata-impl/src/main/java/com/liferay/portal/odata/internal/filter/expression/ExpressionVisitorImpl.java
@@ -85,6 +85,16 @@ public Expression visitBinaryOperator(
);
}
+ @Override
+ public Expression visitBinaryOperator(
+ BinaryOperatorKind binaryOperatorKind,
+ Expression leftBinaryOperationExpression,
+ List rightBinaryOperationExpressions) {
+
+ throw new UnsupportedOperationException(
+ "Binary operator: " + binaryOperatorKind);
+ }
+
@Override
public Expression visitEnum(EdmEnumType edmEnumType, List list) {
throw new UnsupportedOperationException(
diff --git a/modules/apps/portal-vulcan/portal-vulcan-impl/build.gradle b/modules/apps/portal-vulcan/portal-vulcan-impl/build.gradle
index 549fa83b5af77f..9138aa471e92b9 100644
--- a/modules/apps/portal-vulcan/portal-vulcan-impl/build.gradle
+++ b/modules/apps/portal-vulcan/portal-vulcan-impl/build.gradle
@@ -62,6 +62,7 @@ dependencies {
compileOnly group: "org.osgi", name: "org.osgi.util.promise", version: "1.1.0"
compileOnly group: "org.osgi", name: "osgi.core", version: "6.0.0"
compileOnly group: "org.springframework", name: "spring-tx", version: "4.1.9.RELEASE"
+ compileOnly project(":apps:document-library:document-library-api")
testCompile group: "org.hamcrest", name: "hamcrest-all", version: "1.3"
}
diff --git a/modules/apps/portal-vulcan/portal-vulcan-impl/src/main/java/com/liferay/portal/vulcan/internal/jaxrs/feature/VulcanFeature.java b/modules/apps/portal-vulcan/portal-vulcan-impl/src/main/java/com/liferay/portal/vulcan/internal/jaxrs/feature/VulcanFeature.java
index 127d8da7422ffe..55fde89467026a 100644
--- a/modules/apps/portal-vulcan/portal-vulcan-impl/src/main/java/com/liferay/portal/vulcan/internal/jaxrs/feature/VulcanFeature.java
+++ b/modules/apps/portal-vulcan/portal-vulcan-impl/src/main/java/com/liferay/portal/vulcan/internal/jaxrs/feature/VulcanFeature.java
@@ -17,6 +17,7 @@
import com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider;
import com.fasterxml.jackson.jaxrs.xml.JacksonXMLProvider;
+import com.liferay.document.library.kernel.util.DLValidator;
import com.liferay.portal.kernel.language.Language;
import com.liferay.portal.kernel.search.filter.Filter;
import com.liferay.portal.kernel.service.GroupLocalService;
@@ -101,7 +102,6 @@ public boolean configure(FeatureContext featureContext) {
featureContext.register(JsonParseExceptionMapper.class);
featureContext.register(InvalidFormatExceptionMapper.class);
featureContext.register(LogContainerRequestFilter.class);
- featureContext.register(MultipartBodyMessageBodyReader.class);
featureContext.register(NestedFieldsContainerRequestFilter.class);
featureContext.register(NoSuchModelExceptionMapper.class);
featureContext.register(ObjectMapperContextResolver.class);
@@ -126,6 +126,9 @@ public boolean configure(FeatureContext featureContext) {
featureContext.register(
new FilterContextProvider(
\_expressionConvert, \_filterParserProvider, \_language, \_portal));
+ featureContext.register(
+ new MultipartBodyMessageBodyReader(
+ \_dlValidator.getMaxAllowableSize()));
\_nestedFieldsWriterInterceptor = new NestedFieldsWriterInterceptor(
\_bundleContext);
@@ -156,6 +159,9 @@ protected void deactivate() {
private BundleContext \_bundleContext;
+ @Reference
+ private DLValidator \_dlValidator;
+
@Reference(
target = "(result.class.name=com.liferay.portal.kernel.search.filter.Filter)"
)
diff --git a/modules/apps/portal-vulcan/portal-vulcan-impl/src/main/java/com/liferay/portal/vulcan/internal/jaxrs/message/body/MultipartBodyMessageBodyReader.java b/modules/apps/portal-vulcan/portal-vulcan-impl/src/main/java/com/liferay/portal/vulcan/internal/jaxrs/message/body/MultipartBodyMessageBodyReader.java
index 92a936ba826a31..3efca5c1c8260d 100644
--- a/modules/apps/portal-vulcan/portal-vulcan-impl/src/main/java/com/liferay/portal/vulcan/internal/jaxrs/message/body/MultipartBodyMessageBodyReader.java
+++ b/modules/apps/portal-vulcan/portal-vulcan-impl/src/main/java/com/liferay/portal/vulcan/internal/jaxrs/message/body/MultipartBodyMessageBodyReader.java
@@ -44,6 +44,7 @@
import javax.ws.rs.ext.Providers;
import org.apache.commons.fileupload.FileItem;
+import org.apache.commons.fileupload.FileUploadBase;
import org.apache.commons.fileupload.disk.DiskFileItemFactory;
import org.apache.commons.fileupload.servlet.ServletFileUpload;
import org.apache.commons.fileupload.util.Streams;
@@ -57,6 +58,10 @@
public class MultipartBodyMessageBodyReader
implements MessageBodyReader {
+ public MultipartBodyMessageBodyReader(long fileMaxSize) {
+ \_fileMaxSize = fileMaxSize;
+ }
+
@Override
public boolean isReadable(
Class  clazz, Type genericType, Annotation[] annotations,
@@ -103,6 +108,9 @@ public MultipartBody readFrom(
ServletFileUpload servletFileUpload = new ServletFileUpload(
new DiskFileItemFactory());
+ servletFileUpload.setFileSizeMax(\_fileMaxSize);
+ servletFileUpload.setSizeMax(\_fileMaxSize);
+
List fileItems = servletFileUpload.parseRequest(
\_httpServletRequest);
@@ -125,12 +133,22 @@ public MultipartBody readFrom(
return MultipartBody.of(
binaryFiles, contextResolver::getContext, values);
}
+ catch (FileUploadBase.SizeLimitExceededException
+ sizeLimitExceededException) {
+
+ throw new BadRequestException(
+ "Please enter a file with a valid file size no larger than " +
+ \_fileMaxSize,
+ sizeLimitExceededException);
+ }
catch (Exception e) {
throw new BadRequestException(
"Request body is not a valid multipart form", e);
}
}
+ private final long \_fileMaxSize;
+
@Context
private HttpServletRequest \_httpServletRequest;
diff --git a/modules/apps/portal-workflow/portal-workflow-web/src/main/resources/META-INF/resources/definition/edit\_workflow\_definition.jsp b/modules/apps/portal-workflow/portal-workflow-web/src/main/resources/META-INF/resources/definition/edit\_workflow\_definition.jsp
index 9e23a000e7940a..1393151b5494b0 100644
--- a/modules/apps/portal-workflow/portal-workflow-web/src/main/resources/META-INF/resources/definition/edit\_workflow\_definition.jsp
+++ b/modules/apps/portal-workflow/portal-workflow-web/src/main/resources/META-INF/resources/definition/edit\_workflow\_definition.jsp
@@ -150,7 +150,7 @@ renderResponse.setTitle((workflowDefinition == null) ? LanguageUtil.get(request,
<%= dateFormatTime.format(workflowDefinitionDisplayContext.getCreatedDate(workflowDefinition)) %>

-
+

@@ -163,7 +163,7 @@ renderResponse.setTitle((workflowDefinition == null) ? LanguageUtil.get(request,
<%= dateFormatTime.format(workflowDefinition.getModifiedDate()) %>

-
+

diff --git a/modules/apps/staging/staging-processes-web/src/main/java/com/liferay/staging/processes/web/internal/display/context/StagingProcessesWebToolbarDisplayContext.java b/modules/apps/staging/staging-processes-web/src/main/java/com/liferay/staging/processes/web/internal/display/context/StagingProcessesWebToolbarDisplayContext.java
index 246338a3402514..6149a615b5207b 100644
--- a/modules/apps/staging/staging-processes-web/src/main/java/com/liferay/staging/processes/web/internal/display/context/StagingProcessesWebToolbarDisplayContext.java
+++ b/modules/apps/staging/staging-processes-web/src/main/java/com/liferay/staging/processes/web/internal/display/context/StagingProcessesWebToolbarDisplayContext.java
@@ -57,7 +57,20 @@ public StagingProcessesWebToolbarDisplayContext(
portlet.getRootPortletId());
}
+ /\*\*
+ \* @deprecated As of Mueller (7.2.x), replaced by {@link
+ \* #getActionDropdownItems(boolean)}
+ \*/
+ @Deprecated
public List getActionDropdownItems() {
+ return getActionDropdownItems(true);
+ }
+
+ public List getActionDropdownItems(boolean hasPermission) {
+ if (!hasPermission) {
+ return null;
+ }
+
return new DropdownItemList() {
{
add(
@@ -72,7 +85,20 @@ public List getActionDropdownItems() {
};
}
+ /\*\*
+ \* @deprecated As of Mueller (7.2.x), replaced by {@link
+ \* #getCreationMenu(boolean)}
+ \*/
+ @Deprecated
+ public CreationMenu getCreationMenu() {
+ return getCreationMenu(true);
+ }
+
public CreationMenu getCreationMenu(boolean hasPermission) {
+ if (!hasPermission) {
+ return null;
+ }
+
return new CreationMenu() {
{
int configurationType = 0;
@@ -93,38 +119,15 @@ public CreationMenu getCreationMenu(boolean hasPermission) {
TYPE\_PUBLISH\_LAYOUT\_LOCAL;
}
- if (hasPermission) {
- List exportImportConfigurations =
- ExportImportConfigurationLocalServiceUtil.
- getExportImportConfigurations(
- stagingGroupId, configurationType);
-
- for (ExportImportConfiguration exportImportConfiguration :
- exportImportConfigurations) {
-
- addRestDropdownItem(
- dropdownItem -> {
- String cmd = Constants.PUBLISH\_TO\_LIVE;
-
- if (stagingGroup.isStagedRemotely()) {
- cmd = Constants.PUBLISH\_TO\_REMOTE;
- }
-
- dropdownItem.setHref(
- \_portletResponse.createRenderURL(),
- "mvcRenderCommandName", "publishLayouts",
- Constants.CMD, cmd,
- "exportImportConfigurationId",
- String.valueOf(
- exportImportConfiguration.
- getExportImportConfigurationId()),
- "groupId", String.valueOf(stagingGroupId));
- dropdownItem.setLabel(
- exportImportConfiguration.getName());
- });
- }
-
- addPrimaryDropdownItem(
+ List exportImportConfigurations =
+ ExportImportConfigurationLocalServiceUtil.
+ getExportImportConfigurations(
+ stagingGroupId, configurationType);
+
+ for (ExportImportConfiguration exportImportConfiguration :
+ exportImportConfigurations) {
+
+ addRestDropdownItem(
dropdownItem -> {
String cmd = Constants.PUBLISH\_TO\_LIVE;
@@ -135,14 +138,35 @@ public CreationMenu getCreationMenu(boolean hasPermission) {
dropdownItem.setHref(
\_portletResponse.createRenderURL(),
"mvcRenderCommandName", "publishLayouts",
- Constants.CMD, cmd, "groupId",
- String.valueOf(stagingGroupId), "privateLayout",
- Boolean.FALSE.toString());
+ Constants.CMD, cmd,
+ "exportImportConfigurationId",
+ String.valueOf(
+ exportImportConfiguration.
+ getExportImportConfigurationId()),
+ "groupId", String.valueOf(stagingGroupId));
dropdownItem.setLabel(
- LanguageUtil.get(
- \_httpServletRequest, "custom-publication"));
+ exportImportConfiguration.getName());
});
}
+
+ addPrimaryDropdownItem(
+ dropdownItem -> {
+ String cmd = Constants.PUBLISH\_TO\_LIVE;
+
+ if (stagingGroup.isStagedRemotely()) {
+ cmd = Constants.PUBLISH\_TO\_REMOTE;
+ }
+
+ dropdownItem.setHref(
+ \_portletResponse.createRenderURL(),
+ "mvcRenderCommandName", "publishLayouts",
+ Constants.CMD, cmd, "groupId",
+ String.valueOf(stagingGroupId), "privateLayout",
+ Boolean.FALSE.toString());
+ dropdownItem.setLabel(
+ LanguageUtil.get(
+ \_httpServletRequest, "custom-publication"));
+ });
}
};
}
diff --git a/modules/apps/staging/staging-processes-web/src/main/java/com/liferay/staging/processes/web/internal/portlet/configuration/icon/PublishTemplatesConfigurationIcon.java b/modules/apps/staging/staging-processes-web/src/main/java/com/liferay/staging/processes/web/internal/portlet/configuration/icon/PublishTemplatesConfigurationIcon.java
index 3da83001e0a314..c72455b75c5b83 100644
--- a/modules/apps/staging/staging-processes-web/src/main/java/com/liferay/staging/processes/web/internal/portlet/configuration/icon/PublishTemplatesConfigurationIcon.java
+++ b/modules/apps/staging/staging-processes-web/src/main/java/com/liferay/staging/processes/web/internal/portlet/configuration/icon/PublishTemplatesConfigurationIcon.java
@@ -14,11 +14,16 @@
package com.liferay.staging.processes.web.internal.portlet.configuration.icon;
+import com.liferay.portal.kernel.exception.PortalException;
import com.liferay.portal.kernel.language.LanguageUtil;
+import com.liferay.portal.kernel.log.Log;
+import com.liferay.portal.kernel.log.LogFactoryUtil;
import com.liferay.portal.kernel.model.Group;
import com.liferay.portal.kernel.model.User;
import com.liferay.portal.kernel.portlet.configuration.icon.BasePortletConfigurationIcon;
import com.liferay.portal.kernel.portlet.configuration.icon.PortletConfigurationIcon;
+import com.liferay.portal.kernel.security.permission.ActionKeys;
+import com.liferay.portal.kernel.service.permission.GroupPermissionUtil;
import com.liferay.portal.kernel.theme.ThemeDisplay;
import com.liferay.portal.kernel.util.Portal;
import com.liferay.portal.kernel.util.ResourceBundleUtil;
@@ -82,6 +87,22 @@ public boolean isShow(PortletRequest portletRequest) {
Group scopeGroup = themeDisplay.getScopeGroup();
+ try {
+ if (!GroupPermissionUtil.contains(
+ themeDisplay.getPermissionChecker(), scopeGroup,
+ ActionKeys.PUBLISH\_STAGING)) {
+
+ return false;
+ }
+ }
+ catch (PortalException portalException) {
+ if (\_log.isDebugEnabled()) {
+ \_log.debug(portalException, portalException);
+ }
+
+ return false;
+ }
+
if ((scopeGroup != null) &&
(scopeGroup.hasStagingGroup() ||
(scopeGroup.hasRemoteStagingGroup() &&
@@ -110,6 +131,9 @@ public boolean isUseDialog() {
return false;
}
+ private static final Log \_log = LogFactoryUtil.getLog(
+ PublishTemplatesConfigurationIcon.class);
+
@Reference
private Portal \_portal;
diff --git a/modules/apps/staging/staging-processes-web/src/main/resources/META-INF/resources/processes\_list/publish\_layouts\_processes.jsp b/modules/apps/staging/staging-processes-web/src/main/resources/META-INF/resources/processes\_list/publish\_layouts\_processes.jsp
index 13c1fc888e665e..737c9fe2007e56 100644
--- a/modules/apps/staging/staging-processes-web/src/main/resources/META-INF/resources/processes\_list/publish\_layouts\_processes.jsp
+++ b/modules/apps/staging/staging-processes-web/src/main/resources/META-INF/resources/processes\_list/publish\_layouts\_processes.jsp
@@ -16,10 +16,16 @@
<%@ include file="/init.jsp" %>
+<%
+boolean hasPublishStagingPermission = GroupPermissionUtil.contains(permissionChecker, scopeGroupId, ActionKeys.PUBLISH\_STAGING);
+%>
+

\ No newline at end of file
diff --git a/modules/apps/staging/staging-processes-web/src/main/resources/META-INF/resources/toolbar.jsp b/modules/apps/staging/staging-processes-web/src/main/resources/META-INF/resources/toolbar.jsp
index d83cefc9268f91..c9ef8af5c43353 100644
--- a/modules/apps/staging/staging-processes-web/src/main/resources/META-INF/resources/toolbar.jsp
+++ b/modules/apps/staging/staging-processes-web/src/main/resources/META-INF/resources/toolbar.jsp
@@ -27,6 +27,8 @@ String orderByCol = ParamUtil.getString(request, "orderByCol");
String orderByType = ParamUtil.getString(request, "orderByType");
String searchContainerId = ParamUtil.getString(request, "searchContainerId");
+boolean hasPublishStagingPermission = GroupPermissionUtil.contains(permissionChecker, scopeGroupId, ActionKeys.PUBLISH\_STAGING);
+
PortletURL portletURL = liferayPortletResponse.createRenderURL();
portletURL.setParameter("mvcRenderCommandName", mvcRenderCommandName);
@@ -39,11 +41,12 @@ portletURL.setParameter("searchContainerId", String.valueOf(searchContainerId));
%>
 0) {
servletFileUpload.setSizeMax(maxRequestSize);
}
+ else {
+ servletFileUpload.setSizeMax(uploadServletRequestImplMaxSize);
+ }
if (maxFileSize > 0) {
servletFileUpload.setFileSizeMax(maxFileSize);
}
+ else {
+ servletFileUpload.setFileSizeMax(
+ uploadServletRequestImplMaxSize);
+ }
liferayServletRequest = new LiferayServletRequest(
httpServletRequest);
@@ -116,8 +126,6 @@ public UploadServletRequestImpl(
liferayServletRequest.setFinishedReadingOriginalStream(true);
- long uploadServletRequestImplMaxSize =
- UploadServletRequestConfigurationHelperUtil.getMaxSize();
long uploadServletRequestImplSize = 0;
int contentLength = httpServletRequest.getContentLength();
diff --git a/portal-impl/src/com/liferay/portal/util/PortalImpl.java b/portal-impl/src/com/liferay/portal/util/PortalImpl.java
index 22a626768ddb0b..406c5965a8a133 100644
--- a/portal-impl/src/com/liferay/portal/util/PortalImpl.java
+++ b/portal-impl/src/com/liferay/portal/util/PortalImpl.java
@@ -6629,6 +6629,28 @@ public boolean isValidResourceId(String resourceId) {
return false;
}
+ int count = \_PORTLET\_RESOURCE\_ID\_URL\_DECODE\_COUNT;
+
+ while ((count > 0) && resourceId.contains("%")) {
+ resourceId = HttpUtil.decodePath(resourceId);
+
+ if (Validator.isNull(resourceId)) {
+ return false;
+ }
+
+ matcher = \_bannedResourceIdPattern.matcher(resourceId);
+
+ if (matcher.matches()) {
+ return false;
+ }
+
+ count--;
+
+ if (count == 0) {
+ return false;
+ }
+ }
+
return true;
}
@@ -8858,6 +8880,10 @@ private boolean \_isSameHostName(
private static final Locale \_NULL\_LOCALE;
+ private static final int \_PORTLET\_RESOURCE\_ID\_URL\_DECODE\_COUNT =
+ GetterUtil.getInteger(
+ PropsUtil.get("portlet.resource.id.url.decode.count"), 10);
+
private static final String \_PRIVATE\_GROUP\_SERVLET\_MAPPING =
PropsValues.LAYOUT\_FRIENDLY\_URL\_PRIVATE\_GROUP\_SERVLET\_MAPPING;
From af5048f91a569026aba6037846b6322d56c4dc74 Mon Sep 17 00:00:00 2001
From: yxingwu
Date: Tue, 1 Sep 2020 10:09:59 +0800
Subject: [PATCH 05/15] Update README
---
README.markdown | 16 ++++++++++++++++
1 file changed, 16 insertions(+)
diff --git a/README.markdown b/README.markdown
index 2e25fa6c7da577..02725c6907feac 100644
--- a/README.markdown
+++ b/README.markdown
@@ -7,6 +7,22 @@ information about security in Liferay Portal, please see
\*\*Cumulative diff patch:\*\*
[https://github.com/community-security-team/liferay-portal/compare/7.2.1-ga2...7.2.1-cumulative.patch](https://github.com/community-security-team/liferay-portal/compare/7.2.1-ga2...7.2.1-cumulative.patch)
+The [September 2020]() release contains fixes for the following issues:
+[CST-7224](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119784785),
+[CST-7225](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119784802),
+[CST-7226](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119784815),
+[CST-7307](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119761505),
+[CST-7308](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119772204),
+[CST-7309](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119772218),
+[CST-7310](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119784734),
+[CST-7311](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119784748),
+[CST-7312](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119784846),
+[CST-7313](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119784872),
+[CST-7314](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119784884),
+[CST-7315](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119784897),
+[CST-7316](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119784916),
+[CST-7317](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119784928)
+
The [June 2020]() release contains fixes for the following issues:
[CST-7213](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119317427),
[CST-7214](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119317439),
From 6ce1823e51fceedb2925a70ee67dd586846f4ff3 Mon Sep 17 00:00:00 2001
From: yxingwu
Date: Wed, 5 May 2021 11:10:43 +0800
Subject: [PATCH 06/15] Fix the links in the readme file
---
README.markdown | 4 ++--
1 file changed, 2 insertions(+), 2 deletions(-)
diff --git a/README.markdown b/README.markdown
index 02725c6907feac..f098879423ad72 100644
--- a/README.markdown
+++ b/README.markdown
@@ -7,7 +7,7 @@ information about security in Liferay Portal, please see
\*\*Cumulative diff patch:\*\*
[https://github.com/community-security-team/liferay-portal/compare/7.2.1-ga2...7.2.1-cumulative.patch](https://github.com/community-security-team/liferay-portal/compare/7.2.1-ga2...7.2.1-cumulative.patch)
-The [September 2020]() release contains fixes for the following issues:
+The [September 2020](https://github.com/community-security-team/liferay-portal/commit/ed211f44d636d07647d7b8e2d1f0b0016866ab15) release contains fixes for the following issues:
[CST-7224](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119784785),
[CST-7225](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119784802),
[CST-7226](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119784815),
@@ -23,7 +23,7 @@ The [September 2020]() release contains fixes for the following issues:
[CST-7316](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119784916),
[CST-7317](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119784928)
-The [June 2020]() release contains fixes for the following issues:
+The [June 2020](https://github.com/community-security-team/liferay-portal/commit/064e6b01afa1e087e4c6bbaf7f71c97ee33f3ee9) release contains fixes for the following issues:
[CST-7213](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119317427),
[CST-7214](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119317439),
[CST-7216](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119318646),
From ce56c3137a8a97ffdad8a3e95ede563dd97c946f Mon Sep 17 00:00:00 2001
From: yxingwu
Date: Thu, 1 Apr 2021 15:33:30 +0800
Subject: [PATCH 07/15] May 2021
---
.classpath | 1 +
lib/.gitignore | 1 +
lib/portal/dependencies.properties | 15 +-
lib/versions-complete.xml | 8 +-
lib/versions-ext.xml | 10 +-
lib/versions.html | 8 +-
.../resources/edit\_vocabulary\_settings.jspf | 2 +-
.../resources/META-INF/resources/view.jsp | 2 +-
.../AssetTagsSelector.es.js | 2 +-
.../build.gradle | 6 +-
.../build.gradle | 20 +-
.../dynamic-data-lists-service/bnd.bnd | 1 +
.../dynamic-data-lists-service/build.gradle | 4 +-
.../context/DDMFormDisplayContext.java | 4 +-
...dFormInstanceRecordMVCResourceCommand.java | 11 +-
.../PublishFormInstanceMVCActionCommand.java | 16 +-
.../META-INF/resources/display/view.jsp | 22 +-
.../META-INF/resource-actions/default.xml | 4 +-
.../export-import-service/build.gradle | 3 +-
modules/apps/flags/flags-taglib/package.json | 3 +
.../taglib/servlet/taglib/react/FlagsTag.java | 9 +-
.../servlet/taglib/util/FlagsTagUtil.java | 12 +
.../flags/js/components/Captcha.es.js | 44 ++
.../resources/flags/js/components/Flags.es.js | 17 +-
.../flags/js/components/FlagsModal.es.js | 19 +
.../test/js/components/Flags.es.js | 6 +
.../test/js/components/FlagsModal.es.js | 2 +
modules/apps/flags/flags-web/build.gradle | 2 +
.../action/CaptchaMVCResourceCommand.java | 57 ++
.../action/EditEntryMVCActionCommand.java | 91 +++-
.../action/GetCaptchaMVCResourceCommand.java | 47 ++
.../META-INF/resources/get\_captcha.jsp | 23 +
.../resources/META-INF/resources/init.jsp | 4 +-
.../resources/META-INF/resources/view.jsp | 2 +-
.../frontend-editor-ckeditor-web/build.gradle | 2 +-
.../frontend-editor-ckeditor-web/package.json | 2 +-
.../META-INF/resources/liferay/util\_window.js | 2 +-
.../frontend-js-lodash-web/package.json | 2 +-
.../frontend-taglib-clay/build.gradle | 4 +
.../META-INF/resources/journal\_template.jsp | 2 +-
.../knowledge-base-service/build.gradle | 2 +-
.../apps/layout/layout-admin-web/build.gradle | 4 +-
.../context/LayoutsAdminDisplayContext.java | 59 +-
.../META-INF/resources/add\_layout.jsp | 8 +
.../META-INF/resources/flattened\_view.jsp | 8 +-
.../portlet/NotificationsPortlet.java | 6 +-
.../oauth2-provider-rest/build.gradle | 16 +-
.../oauth2-provider-scope-impl/build.gradle | 4 +-
...viderScopeLiferayAccessControlContext.java | 11 +-
.../oauth2-provider-test/build.gradle | 2 +-
.../portal-odata-impl/build.gradle | 2 +-
.../portal-remote-cors-impl/build.gradle | 1 +
.../feature/CORSAnnotationDynamicFeature.java | 81 ++-
.../servlet/filter/CORSServletFilter.java | 86 +--
...rablePortalCORSServletFilterPublisher.java | 2 +-
.../portal-remote-cxf-common/build.gradle | 4 +-
.../portal-remote-jaxrs-whiteboard/bnd.bnd | 288 +++++-----
.../build.gradle | 14 +-
.../org/apache/cxf/.lfrbuild-packageinfo | 4 +
.../build.gradle | 2 +-
.../portal-remote-rest-extender/build.gradle | 8 +-
.../build.gradle | 8 +-
.../build.gradle | 8 +-
.../portal-scheduler-quartz/build.gradle | 2 +-
.../portal-scripting-groovy/build.gradle | 2 +-
.../build.gradle | 6 +-
.../build.gradle | 6 +-
.../build.gradle | 2 +-
.../portal-security-antisamy/build.gradle | 8 +-
.../configuration/S3StoreConfiguration.java | 2 +-
.../portal-template-velocity/build.gradle | 2 +-
.../portal-vulcan-api/build.gradle | 2 +-
.../portal-vulcan-impl/build.gradle | 10 +-
.../portal-vulcan-test/build.gradle | 4 +-
.../service/KaleoInstanceLocalService.java | 4 +
.../KaleoInstanceLocalServiceUtil.java | 7 +
.../KaleoInstanceLocalServiceWrapper.java | 8 +
.../persistence/KaleoInstancePersistence.java | 60 ++
.../persistence/KaleoInstanceUtil.java | 82 +++
.../build.gradle | 2 +-
.../internal/DefaultWorkflowEngineImpl.java | 23 +-
.../build.gradle | 2 +-
.../internal/WorkflowInstanceManagerImpl.java | 14 +
.../build.gradle | 2 +-
.../portal-workflow-kaleo-service/service.xml | 5 +
.../model/impl/KaleoInstanceModelImpl.java | 21 +-
.../impl/KaleoInstanceLocalServiceImpl.java | 8 +
.../impl/KaleoInstancePersistenceImpl.java | 350 ++++++++++++
.../main/resources/META-INF/sql/indexes.sql | 1 +
.../test/KaleoInstancePersistenceTest.java | 35 ++
.../portal-workflow-task-web/build.gradle | 4 +-
.../WorkflowTaskPermissionChecker.java | 39 +-
.../portlet/MyWorkflowTaskPortlet.java | 11 +-
.../action/AssignTaskMVCResourceCommand.java | 11 +-
.../WorkflowTaskBaseMVCActionCommand.java | 6 +-
.../resources/META-INF/resources/init.jsp | 1 +
.../resources/workflow\_task\_assign.jsp | 2 +-
.../portal-workflow-web/build.gradle | 4 +-
.../WorkflowInstanceEditDisplayContext.java | 5 +-
.../internal/portlet/UserWorkflowPortlet.java | 77 +++
...eleteWorkflowInstanceMVCActionCommand.java | 2 +-
.../tab/WorkflowInstancePortletTab.java | 3 +-
.../META-INF/resources/advanced\_styling.jsp | 6 +-
.../resources/META-INF/resources/init.jsp | 1 +
.../resources/META-INF/resources/view.jsp | 2 +-
...onfigurationPermissionsDisplayContext.java | 3 -
modules/apps/powwow/powwow-portlet/ivy.xml | 2 +-
.../build.gradle | 4 +-
.../resources/preview\_membership\_request.jsp | 4 +-
.../portal-lpkg-deployer-test/build.gradle | 2 +-
.../build.gradle | 2 +-
modules/apps/tasks/tasks-portlet/ivy.xml | 2 +-
modules/apps/upload/upload-web/build.gradle | 2 +-
...eOrganizationPortletConfigurationIcon.java | 3 +-
.../system.packages.extra.bnd | 2 +-
.../build.gradle | 2 +-
modules/yarn.lock | 515 ++----------------
nbproject/project.properties | 1 +
.../portal/action/JSONServiceAction.java | 11 +-
.../JSONWebServiceServiceAction.java | 24 +-
.../service/http/LayoutServiceHttp.java | 196 +++++--
.../service/http/LayoutServiceSoap.java | 40 ++
.../service/impl/LayoutLocalServiceImpl.java | 105 +++-
.../service/impl/LayoutServiceImpl.java | 31 ++
.../service/impl/UserLocalServiceImpl.java | 34 +-
...UserNotificationEventLocalServiceImpl.java | 40 +-
.../permission/UserPermissionImpl.java | 4 +-
.../com/liferay/portal/struts/JSONAction.java | 11 +-
.../com/liferay/portal/util/PropsValues.java | 4 +
portal-impl/src/portal-developer.properties | 2 +
portal-impl/src/portal.properties | 12 +-
.../kernel/service/LayoutLocalService.java | 29 +
.../service/LayoutLocalServiceUtil.java | 39 ++
.../service/LayoutLocalServiceWrapper.java | 42 ++
.../portal/kernel/service/LayoutService.java | 13 +
.../kernel/service/LayoutServiceUtil.java | 21 +
.../kernel/service/LayoutServiceWrapper.java | 22 +
.../UserNotificationEventLocalService.java | 7 +-
...UserNotificationEventLocalServiceUtil.java | 12 +-
...rNotificationEventLocalServiceWrapper.java | 13 +-
.../liferay/portal/kernel/util/PropsKeys.java | 3 +
.../workflow/WorkflowInstanceManager.java | 7 +
.../workflow/WorkflowInstanceManagerUtil.java | 8 +
143 files changed, 2241 insertions(+), 997 deletions(-)
create mode 100644 modules/apps/flags/flags-taglib/src/main/resources/META-INF/resources/flags/js/components/Captcha.es.js
create mode 100644 modules/apps/flags/flags-web/src/main/java/com/liferay/flags/web/internal/portlet/action/CaptchaMVCResourceCommand.java
create mode 100644 modules/apps/flags/flags-web/src/main/java/com/liferay/flags/web/internal/portlet/action/GetCaptchaMVCResourceCommand.java
create mode 100644 modules/apps/flags/flags-web/src/main/resources/META-INF/resources/get\_captcha.jsp
create mode 100644 modules/apps/portal-remote/portal-remote-jaxrs-whiteboard/src/main/resources/org/apache/cxf/.lfrbuild-packageinfo
diff --git a/.classpath b/.classpath
index ed9d9bb98a8c6a..38479a0881e41b 100644
--- a/.classpath
+++ b/.classpath
@@ -262,6 +262,7 @@

+

diff --git a/lib/.gitignore b/lib/.gitignore
index f1557c2a87acc1..677bc3104013ec 100644
--- a/lib/.gitignore
+++ b/lib/.gitignore
@@ -232,6 +232,7 @@
/portal/slf4j-api.jar
/portal/soap.jar
/portal/soap-api.jar
+/portal/sparse-bit-set.jar
/portal/spring-aop.jar
/portal/spring-aspects.jar
/portal/spring-beans.jar
diff --git a/lib/portal/dependencies.properties b/lib/portal/dependencies.properties
index 6acb6f9855d6da..2f3802df2cbda5 100644
--- a/lib/portal/dependencies.properties
+++ b/lib/portal/dependencies.properties
@@ -127,10 +127,10 @@ netty-all=io.netty:netty-all:4.1.48.Final
odmg=odmg:odmg:3.0
oro=oro:oro:2.0.8
pdfbox=org.apache.pdfbox:pdfbox:2.0.13
-poi-ooxml-schemas=org.apache.poi:poi-ooxml-schemas:4.0.1
-poi-ooxml=org.apache.poi:poi-ooxml:4.0.1
-poi-scratchpad=org.apache.poi:poi-scratchpad:4.0.1
-poi=org.apache.poi:poi:4.0.1
+poi-ooxml-schemas=org.apache.poi:poi-ooxml-schemas:4.1.2
+poi-ooxml=org.apache.poi:poi-ooxml:4.1.2
+poi-scratchpad=org.apache.poi:poi-scratchpad:4.1.2
+poi=org.apache.poi:poi:4.1.2
rdffilter=com.liferay:com.megginson.sax.rdf:1.0
rhino=org.mozilla:rhino:1.7R4
ridl=org.openoffice:ridl:2.3.1
@@ -145,6 +145,7 @@ simplecaptcha=com.liferay:nl.captcha.simplecaptcha:1.1.1
slf4j-api=org.slf4j:slf4j-api:1.7.26
soap-api=com.liferay:javax.xml.soap:1.4.0.LIFERAY-PATCHED-1
soap=soap:soap:2.2
+sparse-bit-set=com.zaxxer:SparseBitSet:1.2
spring-aop=org.springframework:spring-aop:4.3.22.RELEASE
spring-aspects=org.springframework:spring-aspects:4.3.22.RELEASE
spring-beans=org.springframework:spring-beans:4.3.22.RELEASE
@@ -165,8 +166,8 @@ stax=stax:stax-api:1.0.1
streambuffer=com.sun.xml.stream.buffer:streambuffer:0.9
stringtemplate=org.antlr:stringtemplate:3.0
tagsoup=org.ccil.cowan.tagsoup:tagsoup:1.2.1
-tika-core=org.apache.tika:tika-core:1.22
-tika-parsers=org.apache.tika:tika-parsers:1.22
+tika-core=org.apache.tika:tika-core:1.24
+tika-parsers=org.apache.tika:tika-parsers:1.24
tomcat-jdbc=org.apache.tomcat:tomcat-jdbc:9.0.17
tomcat-juli=org.apache.tomcat:tomcat-juli:9.0.17
transaction=javax.transaction:javax.transaction-api:1.3
@@ -185,7 +186,7 @@ xml-apis=xml-apis:xml-apis:1.4.01
xmlsec=org.apache.santuario:xmlsec:1.5.8
xmpcore=com.adobe.xmp:xmpcore:5.1.3
xpp3=xpp3:xpp3\_min:1.1.4c
-xstream=com.thoughtworks.xstream:xstream:1.4.11.1
+xstream=com.thoughtworks.xstream:xstream:1.4.14
xuggle-xuggler-noarch=com.liferay:xuggle.xuggler.noarch:5.4
xz=org.tukaani:xz:1.8
yui-compressor=com.yahoo.platform.yui:yuicompressor:2.4.8
\ No newline at end of file
diff --git a/lib/versions-complete.xml b/lib/versions-complete.xml
index 48e89515308563..5b798666a88418 100644
--- a/lib/versions-complete.xml
+++ b/lib/versions-complete.xml
@@ -6836,7 +6836,7 @@

lib/portal/poi-ooxml-schemas.jar
- 4.0.1
+ 4.1.2
POI
http://poi.apache.org
@@ -6849,7 +6849,7 @@

lib/portal/poi-ooxml.jar
- 4.0.1
+ 4.1.2
POI
http://poi.apache.org
@@ -6862,7 +6862,7 @@

lib/portal/poi-scratchpad.jar
- 4.0.1
+ 4.1.2
POI
http://poi.apache.org
@@ -6875,7 +6875,7 @@

lib/portal/poi.jar
- 4.0.1
+ 4.1.2
POI
http://poi.apache.org
diff --git a/lib/versions-ext.xml b/lib/versions-ext.xml
index 88b68b553614bc..3ffbd03cc19e96 100644
--- a/lib/versions-ext.xml
+++ b/lib/versions-ext.xml
@@ -2549,7 +2549,7 @@

lib/portal/poi.jar
- 4.0.1
+ 4.1.2
POI
http://poi.apache.org
@@ -2562,7 +2562,7 @@

lib/portal/poi-ooxml.jar
- 4.0.1
+ 4.1.2
POI
http://poi.apache.org
@@ -2575,7 +2575,7 @@

lib/portal/poi-ooxml-schemas.jar
- 4.0.1
+ 4.1.2
POI
http://poi.apache.org
@@ -2588,7 +2588,7 @@

lib/portal/poi-scratchpad.jar
- 4.0.1
+ 4.1.2
POI
http://poi.apache.org
@@ -3359,7 +3359,7 @@

lib/portal/xstream.jar
- 1.4.11.1
+ 1.4.14
XStream
http://xstream.codehaus.org
diff --git a/lib/versions.html b/lib/versions.html
index ffcb1674d01be5..67cf35b4877995 100644
--- a/lib/versions.html
+++ b/lib/versions.html
@@ -3008,28 +3008,28 @@  ||- lib/portal/poi-ooxml-schemas.jar | 4.0.1 | [POI](http://poi.apache.org) | [Apache License 2.0](http://www.apache.org/licenses/LICENSE-2.0) + lib/portal/poi-ooxml-schemas.jar | 4.1.2 | [POI](http://poi.apache.org) | [Apache License 2.0](http://www.apache.org/licenses/LICENSE-2.0)  Copyright (c) 2009 The Apache Software Foundation |  | |
|- lib/portal/poi-ooxml.jar | 4.0.1 | [POI](http://poi.apache.org) | [Apache License 2.0](http://www.apache.org/licenses/LICENSE-2.0) + lib/portal/poi-ooxml.jar | 4.1.2 | [POI](http://poi.apache.org) | [Apache License 2.0](http://www.apache.org/licenses/LICENSE-2.0)  Copyright (c) 2009 The Apache Software Foundation |  | |
|- lib/portal/poi-scratchpad.jar | 4.0.1 | [POI](http://poi.apache.org) | [Apache License 2.0](http://www.apache.org/licenses/LICENSE-2.0) + lib/portal/poi-scratchpad.jar | 4.1.2 | [POI](http://poi.apache.org) | [Apache License 2.0](http://www.apache.org/licenses/LICENSE-2.0)  Copyright (c) 2009 The Apache Software Foundation |  | |
|- lib/portal/poi.jar | 4.0.1 | [POI](http://poi.apache.org) | [Apache License 2.0](http://www.apache.org/licenses/LICENSE-2.0) + lib/portal/poi.jar | 4.1.2 | [POI](http://poi.apache.org) | [Apache License 2.0](http://www.apache.org/licenses/LICENSE-2.0)  Copyright (c) 2009 The Apache Software Foundation  diff --git a/modules/apps/asset/asset-categories-admin-web/src/main/resources/META-INF/resources/edit\_vocabulary\_settings.jspf b/modules/apps/asset/asset-categories-admin-web/src/main/resources/META-INF/resources/edit\_vocabulary\_settings.jspf index c4d12cd98b0d1c..1cc6faf20c43b5 100644 --- a/modules/apps/asset/asset-categories-admin-web/src/main/resources/META-INF/resources/edit\_vocabulary\_settings.jspf +++ b/modules/apps/asset/asset-categories-admin-web/src/main/resources/META-INF/resources/edit\_vocabulary\_settings.jspf @@ -100,7 +100,7 @@ if (vocabulary != null) { for (ClassType classType : classTypes) { %> -  +  <% } diff --git a/modules/apps/asset/asset-publisher-web/src/main/resources/META-INF/resources/view.jsp b/modules/apps/asset/asset-publisher-web/src/main/resources/META-INF/resources/view.jsp index 64234fb7d91ef5..799a09613c8168 100644 --- a/modules/apps/asset/asset-publisher-web/src/main/resources/META-INF/resources/view.jsp +++ b/modules/apps/asset/asset-publisher-web/src/main/resources/META-INF/resources/view.jsp @@ -142,7 +142,7 @@ SearchContainer searchContainer = assetPublisherDisplayContext.getSearchContaine  - const assetEntryId = '<%= assetPublisherDisplayContext.getAssetEntryId() %>'; + const assetEntryId = '<%= HtmlUtil.escape(assetPublisherDisplayContext.getAssetEntryId()) %>'; if (assetEntryId) { window.location.hash = assetEntryId; diff --git a/modules/apps/asset/asset-taglib/src/main/resources/META-INF/resources/asset\_tags\_selector/AssetTagsSelector.es.js b/modules/apps/asset/asset-taglib/src/main/resources/META-INF/resources/asset\_tags\_selector/AssetTagsSelector.es.js index 0155701ddd8c14..0d4b373fc9ef1d 100644 --- a/modules/apps/asset/asset-taglib/src/main/resources/META-INF/resources/asset\_tags\_selector/AssetTagsSelector.es.js +++ b/modules/apps/asset/asset-taglib/src/main/resources/META-INF/resources/asset\_tags\_selector/AssetTagsSelector.es.js @@ -126,7 +126,7 @@ class AssetTagsSelector extends Component { const filteredItems = event.target.filteredItems; if (!filteredItems || (filteredItems && filteredItems.length === 0)) { - const inputValue = event.target.inputValue; + const inputValue = Liferay.Util.escape(event.target.inputValue); if (inputValue) { const existingTag = this.selectedItems.find( diff --git a/modules/apps/document-library-opener/document-library-opener-google-drive-web/build.gradle b/modules/apps/document-library-opener/document-library-opener-google-drive-web/build.gradle index a18270866253d3..b8110569b63136 100644 --- a/modules/apps/document-library-opener/document-library-opener-google-drive-web/build.gradle +++ b/modules/apps/document-library-opener/document-library-opener-google-drive-web/build.gradle @@ -9,9 +9,9 @@ dependencies { compileInclude group: "com.google.guava", name: "guava", version: "25.1-jre" compileInclude group: "com.google.http-client", name: "google-http-client", version: "1.23.0" compileInclude group: "com.google.http-client", name: "google-http-client-jackson2", version: "1.23.0" - compileInclude group: "com.google.oauth-client", name: "google-oauth-client", version: "1.23.0" - compileInclude group: "com.google.oauth-client", name: "google-oauth-client-java6", version: "1.23.0" - compileInclude group: "com.google.oauth-client", name: "google-oauth-client-servlet", version: "1.23.0" + compileInclude group: "com.google.oauth-client", name: "google-oauth-client", version: "1.31.0" + compileInclude group: "com.google.oauth-client", name: "google-oauth-client-java6", version: "1.31.0" + compileInclude group: "com.google.oauth-client", name: "google-oauth-client-servlet", version: "1.31.0" compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10" compileOnly group: "com.liferay", name: "com.liferay.connected.app.api", version: "1.0.0" diff --git a/modules/apps/document-library/document-library-repository-cmis-impl/build.gradle b/modules/apps/document-library/document-library-repository-cmis-impl/build.gradle index 9d8dd0d8a611c6..8b64ce1de980ff 100644 --- a/modules/apps/document-library/document-library-repository-cmis-impl/build.gradle +++ b/modules/apps/document-library/document-library-repository-cmis-impl/build.gradle @@ -4,16 +4,16 @@ dependencies { compileInclude group: "org.apache.chemistry.opencmis", name: "chemistry-opencmis-client-impl", version: "0.14.0" compileInclude group: "org.apache.chemistry.opencmis", name: "chemistry-opencmis-commons-api", version: "0.14.0" compileInclude group: "org.apache.chemistry.opencmis", name: "chemistry-opencmis-commons-impl", version: "0.14.0" - compileInclude group: "org.apache.cxf", name: "cxf-core", version: "3.2.12" - compileInclude group: "org.apache.cxf", name: "cxf-rt-bindings-soap", version: "3.2.12" - compileInclude group: "org.apache.cxf", name: "cxf-rt-bindings-xml", version: "3.2.12" - compileInclude group: "org.apache.cxf", name: "cxf-rt-databinding-jaxb", version: "3.2.12" - compileInclude group: "org.apache.cxf", name: "cxf-rt-frontend-jaxws", version: "3.2.12" - compileInclude group: "org.apache.cxf", name: "cxf-rt-frontend-simple", version: "3.2.12" - compileInclude group: "org.apache.cxf", name: "cxf-rt-transports-http", version: "3.2.12" - compileInclude group: "org.apache.cxf", name: "cxf-rt-ws-addr", version: "3.2.12" - compileInclude group: "org.apache.cxf", name: "cxf-rt-ws-policy", version: "3.2.12" - compileInclude group: "org.apache.cxf", name: "cxf-rt-wsdl", version: "3.2.12" + compileInclude group: "org.apache.cxf", name: "cxf-core", version: "3.2.14" + compileInclude group: "org.apache.cxf", name: "cxf-rt-bindings-soap", version: "3.2.14" + compileInclude group: "org.apache.cxf", name: "cxf-rt-bindings-xml", version: "3.2.14" + compileInclude group: "org.apache.cxf", name: "cxf-rt-databinding-jaxb", version: "3.2.14" + compileInclude group: "org.apache.cxf", name: "cxf-rt-frontend-jaxws", version: "3.2.14" + compileInclude group: "org.apache.cxf", name: "cxf-rt-frontend-simple", version: "3.2.14" + compileInclude group: "org.apache.cxf", name: "cxf-rt-transports-http", version: "3.2.14" + compileInclude group: "org.apache.cxf", name: "cxf-rt-ws-addr", version: "3.2.14" + compileInclude group: "org.apache.cxf", name: "cxf-rt-ws-policy", version: "3.2.14" + compileInclude group: "org.apache.cxf", name: "cxf-rt-wsdl", version: "3.2.14" compileInclude group: "org.apache.neethi", name: "neethi", version: "3.1.1" compileOnly group: "com.liferay", name: "com.liferay.document.library.repository.cmis.api", version: "3.0.0" diff --git a/modules/apps/dynamic-data-lists/dynamic-data-lists-service/bnd.bnd b/modules/apps/dynamic-data-lists/dynamic-data-lists-service/bnd.bnd index 64150fa0a24c3d..73b6558fb13ebc 100644 --- a/modules/apps/dynamic-data-lists/dynamic-data-lists-service/bnd.bnd +++ b/modules/apps/dynamic-data-lists/dynamic-data-lists-service/bnd.bnd @@ -2,6 +2,7 @@ Bundle-Name: Liferay Dynamic Data Lists Service Bundle-SymbolicName: com.liferay.dynamic.data.lists.service Bundle-Version: 3.0.27 Import-Package:\ + !org.apache.commons.collections4.\*,\ !org.apache.poi.hssf.usermodel.\*,\ !org.apache.poi.ss.usermodel.\*,\ \ diff --git a/modules/apps/dynamic-data-lists/dynamic-data-lists-service/build.gradle b/modules/apps/dynamic-data-lists/dynamic-data-lists-service/build.gradle index 1851a0b764b7aa..f603a0aaafb81e 100644 --- a/modules/apps/dynamic-data-lists/dynamic-data-lists-service/build.gradle +++ b/modules/apps/dynamic-data-lists/dynamic-data-lists-service/build.gradle @@ -4,7 +4,9 @@ buildService { } dependencies { - compileInclude group: "org.apache.poi", name: "poi", version: "3.15" + compileInclude group: "com.zaxxer", name: "SparseBitSet", version: "1.2" + compileInclude group: "org.apache.commons", name: "commons-math3", version: "3.6.1" + compileInclude group: "org.apache.poi", name: "poi", version: "4.1.2" compileOnly group: "biz.aQute.bnd", name: "biz.aQute.bnd.annotation", version: "4.2.0" compileOnly group: "com.liferay", name: "com.liferay.dynamic.data.lists.api", version: "4.1.0" diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-web/src/main/java/com/liferay/dynamic/data/mapping/form/web/internal/display/context/DDMFormDisplayContext.java b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-web/src/main/java/com/liferay/dynamic/data/mapping/form/web/internal/display/context/DDMFormDisplayContext.java index d5e4aa974f1758..a22b0f68894cc3 100644 --- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-web/src/main/java/com/liferay/dynamic/data/mapping/form/web/internal/display/context/DDMFormDisplayContext.java +++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-web/src/main/java/com/liferay/dynamic/data/mapping/form/web/internal/display/context/DDMFormDisplayContext.java @@ -299,7 +299,7 @@ public boolean hasAddFormInstanceRecordPermission() throws PortalException { return \_hasAddFormInstanceRecordPermission; } - \_hasAddFormInstanceRecordPermission = true; + \_hasAddFormInstanceRecordPermission = false; DDMFormInstance ddmFormInstance = getFormInstance(); @@ -320,7 +320,7 @@ public boolean hasViewPermission() throws PortalException { return \_hasViewPermission; } - \_hasViewPermission = true; + \_hasViewPermission = false; DDMFormInstance ddmFormInstance = \_ddmFormInstanceLocalService.fetchFormInstance(getFormInstanceId()); diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-web/src/main/java/com/liferay/dynamic/data/mapping/form/web/internal/portlet/action/AddFormInstanceRecordMVCResourceCommand.java b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-web/src/main/java/com/liferay/dynamic/data/mapping/form/web/internal/portlet/action/AddFormInstanceRecordMVCResourceCommand.java index e2a58169fc699d..104e8928dd3d83 100644 --- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-web/src/main/java/com/liferay/dynamic/data/mapping/form/web/internal/portlet/action/AddFormInstanceRecordMVCResourceCommand.java +++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-web/src/main/java/com/liferay/dynamic/data/mapping/form/web/internal/portlet/action/AddFormInstanceRecordMVCResourceCommand.java @@ -28,6 +28,7 @@ import com.liferay.dynamic.data.mapping.storage.DDMFormValues; import com.liferay.portal.kernel.exception.PortalException; import com.liferay.portal.kernel.language.LanguageUtil; +import com.liferay.portal.kernel.model.User; import com.liferay.portal.kernel.portlet.bridges.mvc.BaseMVCResourceCommand; import com.liferay.portal.kernel.portlet.bridges.mvc.MVCResourceCommand; import com.liferay.portal.kernel.service.ServiceContext; @@ -108,7 +109,12 @@ protected void doServeResource( boolean preview = ParamUtil.getBoolean(resourceRequest, "preview"); - if (preview) { + ThemeDisplay themeDisplay = (ThemeDisplay)resourceRequest.getAttribute( + WebKeys.THEME\_DISPLAY); + + User user = themeDisplay.getUser(); + + if (preview || user.isDefaultUser()) { return; } @@ -125,9 +131,6 @@ protected void doServeResource( return; } - ThemeDisplay themeDisplay = (ThemeDisplay)resourceRequest.getAttribute( - WebKeys.THEME\_DISPLAY); - DDMFormInstanceRecordVersion ddmFormInstanceRecordVersion = \_ddmFormInstanceRecordVersionLocalService. fetchLatestFormInstanceRecordVersion( diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-web/src/main/java/com/liferay/dynamic/data/mapping/form/web/internal/portlet/action/PublishFormInstanceMVCActionCommand.java b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-web/src/main/java/com/liferay/dynamic/data/mapping/form/web/internal/portlet/action/PublishFormInstanceMVCActionCommand.java index 7a9134f8908aee..ff0545b319aad3 100644 --- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-web/src/main/java/com/liferay/dynamic/data/mapping/form/web/internal/portlet/action/PublishFormInstanceMVCActionCommand.java +++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-web/src/main/java/com/liferay/dynamic/data/mapping/form/web/internal/portlet/action/PublishFormInstanceMVCActionCommand.java @@ -150,11 +150,25 @@ protected void updateFormInstancePermission( \_portal.getCompanyId(actionRequest), RoleConstants.GUEST); ResourcePermission resourcePermission = - \_resourcePermissionLocalService.getResourcePermission( + \_resourcePermissionLocalService.fetchResourcePermission( role.getCompanyId(), DDMFormInstance.class.getName(), ResourceConstants.SCOPE\_INDIVIDUAL, String.valueOf(formInstanceId), role.getRoleId()); + if (resourcePermission == null) { + \_resourcePermissionLocalService.setResourcePermissions( + role.getCompanyId(), DDMFormInstance.class.getName(), + ResourceConstants.SCOPE\_INDIVIDUAL, + String.valueOf(formInstanceId), role.getRoleId(), + new String[] {DDMActionKeys.ADD\_FORM\_INSTANCE\_RECORD}); + + resourcePermission = + \_resourcePermissionLocalService.fetchResourcePermission( + role.getCompanyId(), DDMFormInstance.class.getName(), + ResourceConstants.SCOPE\_INDIVIDUAL, + String.valueOf(formInstanceId), role.getRoleId()); + } + if (published) { resourcePermission.addResourceAction( DDMActionKeys.ADD\_FORM\_INSTANCE\_RECORD); diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-web/src/main/resources/META-INF/resources/display/view.jsp b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-web/src/main/resources/META-INF/resources/display/view.jsp index e6f14172778d71..f2b1cb14cbe2fb 100644 --- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-web/src/main/resources/META-INF/resources/display/view.jsp +++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-web/src/main/resources/META-INF/resources/display/view.jsp @@ -177,12 +177,16 @@ long formInstanceId = ddmFormDisplayContext.getFormInstanceId(); | |

+ function clearInterval(intervalId) {
+ if (intervalId) {
+ clearInterval(intervalId);
+ }
+ }
+
var intervalId;
function clearPortletHandlers(event) {
- if (intervalId) {
- clearInterval(intervalId);
- }
+ clearInterval(intervalId);
Liferay.detach('destroyPortlet', clearPortletHandlers);
}
@@ -211,6 +215,10 @@ long formInstanceId = ddmFormDisplayContext.getFormInstanceId();

+ Liferay.on('sessionExpired', function (event) {
+ clearInterval(intervalId);
+ });
+
function autoSave() {
const data = new URLSearchParams({
formInstanceId: <%= formInstanceId %>,
@@ -226,9 +234,7 @@ long formInstanceId = ddmFormDisplayContext.getFormInstanceId();
}
function startAutoSave() {
- if (intervalId) {
- clearInterval(intervalId);
- }
+ clearInterval(intervalId);
intervalId = setInterval(
autoSave,
@@ -238,9 +244,7 @@ long formInstanceId = ddmFormDisplayContext.getFormInstanceId();

function startAutoExtendSession() {
- if (intervalId) {
- clearInterval(intervalId);
- }
+ clearInterval(intervalId);
var tenSeconds = 10000;
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/src/main/resources/META-INF/resource-actions/default.xml b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/src/main/resources/META-INF/resource-actions/default.xml
index 583c0e4ceb0630..b2895379fed035 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/src/main/resources/META-INF/resource-actions/default.xml
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/src/main/resources/META-INF/resource-actions/default.xml
@@ -69,9 +69,7 @@
VIEW

-
- VIEW
-
+
DELETE
PERMISSIONS
diff --git a/modules/apps/export-import/export-import-service/build.gradle b/modules/apps/export-import/export-import-service/build.gradle
index c91725d1a0e1b8..9ca390c928919e 100644
--- a/modules/apps/export-import/export-import-service/build.gradle
+++ b/modules/apps/export-import/export-import-service/build.gradle
@@ -22,7 +22,8 @@ dependencies {
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "4.0.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "4.34.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.util.java", version: "4.0.0"
- compileOnly group: "com.thoughtworks.xstream", name: "xstream", version: "1.4.11.1"
+ compileOnly group: "com.thoughtworks.xstream", name: "xstream", version: "1.4.14"
+
compileOnly group: "commons-lang", name: "commons-lang", version: "2.6"
compileOnly group: "javax.portlet", name: "portlet-api", version: "3.0.1"
compileOnly group: "org.apache.felix", name: "org.apache.felix.http.servlet-api", version: "1.1.2"
diff --git a/modules/apps/flags/flags-taglib/package.json b/modules/apps/flags/flags-taglib/package.json
index 48a3888551d25c..73f53f085915b0 100644
--- a/modules/apps/flags/flags-taglib/package.json
+++ b/modules/apps/flags/flags-taglib/package.json
@@ -1,11 +1,14 @@
{
"dependencies": {
+ "@clayui/alert": "3.2.0",
"@clayui/button": "3.0.0",
"@clayui/icon": "3.0.0",
"@clayui/modal": "3.0.0",
"clay-button": "2.18.1",
"clay-icon": "2.18.1",
+
"frontend-js-web": "\*",
+ "metal-dom": "2.16.8",
"metal-soy": "2.16.8",
"metal-state": "2.16.8",
"prop-types": "15.7.2",
diff --git a/modules/apps/flags/flags-taglib/src/main/java/com/liferay/flags/taglib/servlet/taglib/react/FlagsTag.java b/modules/apps/flags/flags-taglib/src/main/java/com/liferay/flags/taglib/servlet/taglib/react/FlagsTag.java
index 0a5704ee31ee17..5d25ce8c9ae4b6 100644
--- a/modules/apps/flags/flags-taglib/src/main/java/com/liferay/flags/taglib/servlet/taglib/react/FlagsTag.java
+++ b/modules/apps/flags/flags-taglib/src/main/java/com/liferay/flags/taglib/servlet/taglib/react/FlagsTag.java
@@ -26,6 +26,7 @@
import com.liferay.portal.kernel.model.User;
import com.liferay.portal.kernel.theme.ThemeDisplay;
import com.liferay.portal.kernel.util.AggregateResourceBundle;
+import com.liferay.portal.kernel.util.HashMapBuilder;
import com.liferay.portal.kernel.util.PortalUtil;
import com.liferay.portal.kernel.util.PortletKeys;
import com.liferay.portal.kernel.util.ResourceBundleUtil;
@@ -177,12 +178,14 @@ private Map \_getData(String message)
data.put("context", context);
- Map props = new HashMap<>();
-
ThemeDisplay themeDisplay = (ThemeDisplay)request.getAttribute(
WebKeys.THEME\_DISPLAY);
- props.put("baseData", \_getDataJSONObject(themeDisplay));
+ Map props = HashMapBuilder.put(
+ "baseData", \_getDataJSONObject(themeDisplay)
+ ).put(
+ "captchaURI", FlagsTagUtil.getCaptchaURI(request)
+ ).build();
Company company = themeDisplay.getCompany();
diff --git a/modules/apps/flags/flags-taglib/src/main/java/com/liferay/flags/taglib/servlet/taglib/util/FlagsTagUtil.java b/modules/apps/flags/flags-taglib/src/main/java/com/liferay/flags/taglib/servlet/taglib/util/FlagsTagUtil.java
index 2b8ed44099ed56..f509494ba83df3 100644
--- a/modules/apps/flags/flags-taglib/src/main/java/com/liferay/flags/taglib/servlet/taglib/util/FlagsTagUtil.java
+++ b/modules/apps/flags/flags-taglib/src/main/java/com/liferay/flags/taglib/servlet/taglib/util/FlagsTagUtil.java
@@ -18,6 +18,7 @@
import com.liferay.portal.kernel.exception.PortalException;
import com.liferay.portal.kernel.language.LanguageUtil;
import com.liferay.portal.kernel.module.configuration.ConfigurationProviderUtil;
+import com.liferay.portal.kernel.portlet.LiferayPortletURL;
import com.liferay.portal.kernel.portlet.PortletURLFactoryUtil;
import com.liferay.portal.kernel.portlet.PortletURLUtil;
import com.liferay.portal.kernel.theme.ThemeDisplay;
@@ -40,6 +41,17 @@
\*/
public class FlagsTagUtil {
+ public static String getCaptchaURI(HttpServletRequest httpServletRequest) {
+ LiferayPortletURL captchaResourceURL = PortletURLFactoryUtil.create(
+ httpServletRequest, PortletKeys.FLAGS,
+ PortletRequest.RESOURCE\_PHASE);
+
+ captchaResourceURL.setCopyCurrentRenderParameters(false);
+ captchaResourceURL.setResourceID("/flags/get\_captcha");
+
+ return captchaResourceURL.toString();
+ }
+
public static String getCurrentURL(HttpServletRequest httpServletRequest) {
PortletRequest portletRequest =
(PortletRequest)httpServletRequest.getAttribute(
diff --git a/modules/apps/flags/flags-taglib/src/main/resources/META-INF/resources/flags/js/components/Captcha.es.js b/modules/apps/flags/flags-taglib/src/main/resources/META-INF/resources/flags/js/components/Captcha.es.js
new file mode 100644
index 00000000000000..b6870d527221b6
--- /dev/null
+++ b/modules/apps/flags/flags-taglib/src/main/resources/META-INF/resources/flags/js/components/Captcha.es.js
@@ -0,0 +1,44 @@
+/\*\*
+ \* Copyright (c) 2000-present Liferay, Inc. All rights reserved.
+ \*
+ \* This library is free software; you can redistribute it and/or modify it under
+ \* the terms of the GNU Lesser General Public License as published by the Free
+ \* Software Foundation; either version 2.1 of the License, or (at your option)
+ \* any later version.
+ \*
+ \* This library is distributed in the hope that it will be useful, but WITHOUT
+ \* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
+ \* FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
+ \* details.
+ \*/
+
+import {fetch} from 'frontend-js-web';
+import {globalEval} from 'metal-dom';
+import PropTypes from 'prop-types';
+import React, {useEffect, useLayoutEffect, useRef, useState} from 'react';
+
+function Captcha({uri}) {
+ const ref = useRef(null);
+ const [html, setHtml] = useState(null);
+
+ useEffect(() => {
+ fetch(uri)
+ .then(res => res.text())
+ .then(setHtml);
+ }, [uri]);
+
+ useLayoutEffect(() => {
+ if (html) {
+ ref.current.innerHTML = html;
+ globalEval.runScriptsInElement(ref.current);
+ }
+ }, [html]);
+
+ return html ?  : null;
+}
+
+Captcha.propTypes = {
+ uri: PropTypes.string.isRequired
+};
+
+export default Captcha;
diff --git a/modules/apps/flags/flags-taglib/src/main/resources/META-INF/resources/flags/js/components/Flags.es.js b/modules/apps/flags/flags-taglib/src/main/resources/META-INF/resources/flags/js/components/Flags.es.js
index 629e6e47f36fdc..ec27827995dd7d 100644
--- a/modules/apps/flags/flags-taglib/src/main/resources/META-INF/resources/flags/js/components/Flags.es.js
+++ b/modules/apps/flags/flags-taglib/src/main/resources/META-INF/resources/flags/js/components/Flags.es.js
@@ -32,6 +32,7 @@ import FlagsModal from './FlagsModal.es';
const Flags = ({
baseData,
+ captchaURI,
companyName,
disabled = false,
forceLogin = false,
@@ -47,6 +48,7 @@ const Flags = ({
const [status, setStatus] = useState(
forceLogin ? STATUS\_LOGIN : STATUS\_REPORT
);
+ const [error, setError] = useState(null);
const [otherReason, setOtherReason] = useState('');
const [reporterEmailAddress, setReporterEmailAddress] = useState('');
@@ -68,6 +70,7 @@ const Flags = ({
};
const handleClickClose = () => {
+ setError(false);
setReportDialogOpen(false);
};
@@ -105,15 +108,16 @@ const Flags = ({
}
fetch(uri, {
- body: objectToFormData(formDataObj),
+ body: objectToFormData(formDataObj, new FormData(event.target)),
method: 'post'
})
- .then(({status}) => {
+ .then(res => res.json())
+ .then(({error}) => {
if (isMounted()) {
- if (status === Liferay.STATUS\_CODE.OK) {
+ setError(error);
+ setIsSending(false);
+ if (!error) {
setStatus(STATUS\_SUCCESS);
- } else {
- setStatus(STATUS\_ERROR);
}
}
})
@@ -154,7 +158,9 @@ const Flags = ({

{reportDialogOpen && (
+ {error && (
+
+ {error}
+
+ )}

{sub(
Liferay.Language.get(
@@ -113,6 +125,7 @@ const ModalContentForm = ({
/>

)}
+ {captchaURI && }

 {
};
const FlagsModal = ({
+ captchaURI,
companyName,
+ error,
handleClose,
handleInputChange,
handleSubmit,
@@ -211,6 +226,8 @@ const FlagsModal = ({

{status === STATUS\_REPORT ? (
);
function \_renderFlagsComponent({
+ captchaURI = '',
companyName = 'Liferay',
baseData = {},
onlyIcon = false,
@@ -45,6 +46,7 @@ function \_renderFlagsComponent({
return render(
 {
const form = await waitForElement(() => getByRole('form'));
+ [...form.elements].forEach(element => {
+ element.value = 'someValue';
+ });
+
fireEvent.submit(form);
});
diff --git a/modules/apps/flags/flags-taglib/test/js/components/FlagsModal.es.js b/modules/apps/flags/flags-taglib/test/js/components/FlagsModal.es.js
index d1b7ba4147164f..7394f19d6feed3 100644
--- a/modules/apps/flags/flags-taglib/test/js/components/FlagsModal.es.js
+++ b/modules/apps/flags/flags-taglib/test/js/components/FlagsModal.es.js
@@ -24,6 +24,7 @@ import {
} from '../../../src/main/resources/META-INF/resources/flags/js/constants.es';
function \_renderFlagsModalComponent({
+ captchaURI = '',
companyName = 'Liferay',
handleClose = () => {},
handleInputChange = () => {},
@@ -42,6 +43,7 @@ function \_renderFlagsModalComponent({
return render(
+
+<%@ include file="/init.jsp" %>
+
+
+
+
\ No newline at end of file
diff --git a/modules/apps/flags/flags-web/src/main/resources/META-INF/resources/init.jsp b/modules/apps/flags/flags-web/src/main/resources/META-INF/resources/init.jsp
index c69e8de38f61fe..aecd27507179ab 100644
--- a/modules/apps/flags/flags-web/src/main/resources/META-INF/resources/init.jsp
+++ b/modules/apps/flags/flags-web/src/main/resources/META-INF/resources/init.jsp
@@ -14,8 +14,10 @@
\*/
--%>
-<%@ taglib uri="http://liferay.com/tld/flags" prefix="liferay-flags" %><%@
+<%@ taglib uri="http://liferay.com/tld/captcha" prefix="liferay-captcha" %><%@
+taglib uri="http://liferay.com/tld/flags" prefix="liferay-flags" %><%@
taglib uri="http://liferay.com/tld/frontend" prefix="liferay-frontend" %><%@
+taglib uri="http://liferay.com/tld/portlet" prefix="liferay-portlet" %><%@
taglib uri="http://liferay.com/tld/theme" prefix="liferay-theme" %>
<%@ page import="com.liferay.portal.kernel.model.Group" %><%@
diff --git a/modules/apps/fragment/fragment-web/src/main/resources/META-INF/resources/view.jsp b/modules/apps/fragment/fragment-web/src/main/resources/META-INF/resources/view.jsp
index f31ae41d732a66..91288cdedb8cb8 100644
--- a/modules/apps/fragment/fragment-web/src/main/resources/META-INF/resources/view.jsp
+++ b/modules/apps/fragment/fragment-web/src/main/resources/META-INF/resources/view.jsp
@@ -143,7 +143,7 @@ List fragmentCollectionContributors = fragmentDis

- <%= fragmentDisplayContext.getGroupName(scopeGroupId) %>
+ <%= HtmlUtil.escape(fragmentDisplayContext.getGroupName(scopeGroupId)) %>
<%
for (FragmentCollection fragmentCollection : fragmentCollections) {
diff --git a/modules/apps/frontend-editor/frontend-editor-ckeditor-web/build.gradle b/modules/apps/frontend-editor/frontend-editor-ckeditor-web/build.gradle
index 437fbb7cf27368..df0e20543feed4 100644
--- a/modules/apps/frontend-editor/frontend-editor-ckeditor-web/build.gradle
+++ b/modules/apps/frontend-editor/frontend-editor-ckeditor-web/build.gradle
@@ -8,7 +8,7 @@ task buildCKEditorPlugins(type: Copy)
task buildCKEditorScayt(type: Copy)
task buildCKEditorWsc(type: Copy)
-String ckEditorVersion = "4.11.3"
+String ckEditorVersion = "4.14.1"
String ckEditorScaytUrl = "https://ckeditor.com/cke4/sites/default/files/scayt/releases/scayt\_${ckEditorVersion}.zip"
String ckEditorWscUrl = "https://ckeditor.com/cke4/sites/default/files/wsc/releases/wsc\_${ckEditorVersion}.zip"
diff --git a/modules/apps/frontend-editor/frontend-editor-ckeditor-web/package.json b/modules/apps/frontend-editor/frontend-editor-ckeditor-web/package.json
index c98ac0308d3f85..e938eb4005cdf6 100644
--- a/modules/apps/frontend-editor/frontend-editor-ckeditor-web/package.json
+++ b/modules/apps/frontend-editor/frontend-editor-ckeditor-web/package.json
@@ -1,6 +1,6 @@
{
"dependencies": {
- "liferay-ckeditor": "4.11.4-liferay.2"
+ "liferay-ckeditor": "4.14.1-liferay.10"
},
"name": "frontend-editor-ckeditor-web",
"scripts": {
diff --git a/modules/apps/frontend-js/frontend-js-aui-web/src/main/resources/META-INF/resources/liferay/util\_window.js b/modules/apps/frontend-js/frontend-js-aui-web/src/main/resources/META-INF/resources/liferay/util\_window.js
index 3fa5fdc4b72a45..bfad174b7abe45 100644
--- a/modules/apps/frontend-js/frontend-js-aui-web/src/main/resources/META-INF/resources/liferay/util\_window.js
+++ b/modules/apps/frontend-js/frontend-js-aui-web/src/main/resources/META-INF/resources/liferay/util\_window.js
@@ -348,7 +348,7 @@ AUI.add(
config.title = '';
}
- modal.titleNode.html(config.title);
+ modal.titleNode.html(Lang.String.escapeHTML(config.title));
modal.fillHeight(modal.bodyNode);
diff --git a/modules/apps/frontend-js/frontend-js-lodash-web/package.json b/modules/apps/frontend-js/frontend-js-lodash-web/package.json
index 652bcdec2365a4..9ede8e04d7279d 100644
--- a/modules/apps/frontend-js/frontend-js-lodash-web/package.json
+++ b/modules/apps/frontend-js/frontend-js-lodash-web/package.json
@@ -1,6 +1,6 @@
{
"dependencies": {
- "lodash": "4.17.14"
+ "lodash": "4.17.19"
},
"name": "frontend-js-lodash-web",
"scripts": {
diff --git a/modules/apps/frontend-taglib/frontend-taglib-clay/build.gradle b/modules/apps/frontend-taglib/frontend-taglib-clay/build.gradle
index 3ea3e2b5f4f063..1b7ce8374b4f03 100644
--- a/modules/apps/frontend-taglib/frontend-taglib-clay/build.gradle
+++ b/modules/apps/frontend-taglib/frontend-taglib-clay/build.gradle
@@ -9,6 +9,10 @@ dependencies {
compileOnly group: "com.liferay.portal", name: "com.liferay.util.taglib", version: "4.0.0"
compileOnly group: "javax.portlet", name: "portlet-api", version: "3.0.1"
compileOnly group: "javax.servlet.jsp", name: "javax.servlet.jsp-api", version: "2.3.1"
+ compileOnly group: "javax.ws.rs", name: "javax.ws.rs-api", version: "2.1"
+ compileOnly group: "org.apache.cxf", name: "cxf-core", version: "3.2.14"
+ compileOnly group: "org.apache.cxf", name: "cxf-rt-frontend-jaxrs", version: "3.2.14"
+ compileOnly group: "org.apache.cxf", name: "cxf-rt-rs-extension-providers", version: "3.2.14"
compileOnly group: "org.apache.felix", name: "org.apache.felix.http.servlet-api", version: "1.1.2"
compileOnly group: "org.osgi", name: "org.osgi.service.component.annotations", version: "1.3.0"
compileOnly group: "org.osgi", name: "osgi.core", version: "6.0.0"
diff --git a/modules/apps/journal/journal-content-web/src/main/resources/META-INF/resources/journal\_template.jsp b/modules/apps/journal/journal-content-web/src/main/resources/META-INF/resources/journal\_template.jsp
index ade67f88659632..9578dc547d1c02 100644
--- a/modules/apps/journal/journal-content-web/src/main/resources/META-INF/resources/journal\_template.jsp
+++ b/modules/apps/journal/journal-content-web/src/main/resources/META-INF/resources/journal\_template.jsp
@@ -38,7 +38,7 @@ String refererPortletName = ParamUtil.getString(request, "refererPortletName");
DDMTemplate defaultDDMTemplate = journalContentDisplayContext.getDefaultDDMTemplate();
if (defaultDDMTemplate != null) {
- defaultDDMTemplateName = defaultDDMTemplate.getName(locale);
+ defaultDDMTemplateName = HtmlUtil.escape(defaultDDMTemplate.getName(locale));
}
%>
diff --git a/modules/apps/knowledge-base/knowledge-base-service/build.gradle b/modules/apps/knowledge-base/knowledge-base-service/build.gradle
index 312246bb21c05d..3b600b127e3d77 100644
--- a/modules/apps/knowledge-base/knowledge-base-service/build.gradle
+++ b/modules/apps/knowledge-base/knowledge-base-service/build.gradle
@@ -29,7 +29,7 @@ dependencies {
compileOnly group: "org.osgi", name: "org.osgi.service.component.annotations", version: "1.3.0"
compileOnly group: "org.osgi", name: "osgi.core", version: "6.0.0"
- testCompile group: "org.apache.tika", name: "tika-core", version: "1.14"
+ testCompile group: "org.apache.tika", name: "tika-core", version: "1.24"
testCompile group: "org.mockito", name: "mockito-core", version: "1.10.8"
testCompile group: "org.pegdown", name: "pegdown", version: "1.1.0"
}
\ No newline at end of file
diff --git a/modules/apps/layout/layout-admin-web/build.gradle b/modules/apps/layout/layout-admin-web/build.gradle
index 1d4d97852e01f5..4c6a0a1471c81a 100644
--- a/modules/apps/layout/layout-admin-web/build.gradle
+++ b/modules/apps/layout/layout-admin-web/build.gradle
@@ -47,8 +47,8 @@ dependencies {
compileOnly group: "com.liferay", name: "com.liferay.site.navigation.taglib", version: "4.0.0"
compileOnly group: "com.liferay", name: "com.liferay.staging.api", version: "4.0.0"
compileOnly group: "com.liferay", name: "com.liferay.upload.api", version: "3.0.0"
- compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "4.0.0"
- compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "4.34.0"
+ compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "default"
+ compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "default"
compileOnly group: "com.liferay.portal", name: "com.liferay.util.taglib", version: "4.0.0"
compileOnly group: "javax.portlet", name: "portlet-api", version: "3.0.1"
compileOnly group: "javax.servlet.jsp", name: "javax.servlet.jsp-api", version: "2.3.1"
diff --git a/modules/apps/layout/layout-admin-web/src/main/java/com/liferay/layout/admin/web/internal/display/context/LayoutsAdminDisplayContext.java b/modules/apps/layout/layout-admin-web/src/main/java/com/liferay/layout/admin/web/internal/display/context/LayoutsAdminDisplayContext.java
index 9af74912a4ee54..5540fd6f625631 100644
--- a/modules/apps/layout/layout-admin-web/src/main/java/com/liferay/layout/admin/web/internal/display/context/LayoutsAdminDisplayContext.java
+++ b/modules/apps/layout/layout-admin-web/src/main/java/com/liferay/layout/admin/web/internal/display/context/LayoutsAdminDisplayContext.java
@@ -59,6 +59,7 @@
import com.liferay.portal.kernel.portlet.LiferayWindowState;
import com.liferay.portal.kernel.security.permission.ActionKeys;
import com.liferay.portal.kernel.service.LayoutLocalServiceUtil;
+import com.liferay.portal.kernel.service.LayoutServiceUtil;
import com.liferay.portal.kernel.service.LayoutSetBranchLocalServiceUtil;
import com.liferay.portal.kernel.service.LayoutSetLocalServiceUtil;
import com.liferay.portal.kernel.service.ServiceContext;
@@ -576,9 +577,9 @@ public JSONArray getLayoutsJSONArray(
JSONArray layoutsJSONArray = JSONFactoryUtil.createJSONArray();
- List layouts = LayoutLocalServiceUtil.getLayouts(
+ List layouts = LayoutServiceUtil.getLayouts(
getSelGroupId(), privateLayout, parentLayoutId, true,
- QueryUtil.ALL\_POS, QueryUtil.ALL\_POS, null);
+ QueryUtil.ALL\_POS, QueryUtil.ALL\_POS);
for (Layout layout : layouts) {
if (\_getActiveLayoutSetBranchId() > 0) {
@@ -634,8 +635,9 @@ public JSONArray getLayoutsJSONArray(
layoutJSONObject.put("draft", false);
}
- int childLayoutsCount = LayoutLocalServiceUtil.getLayoutsCount(
- getSelGroup(), layout.isPrivateLayout(), layout.getLayoutId());
+ int childLayoutsCount = LayoutServiceUtil.getLayoutsCount(
+ getSelGroupId(), layout.isPrivateLayout(),
+ layout.getLayoutId());
layoutJSONObject.put("hasChild", childLayoutsCount > 0);
@@ -708,8 +710,8 @@ public SearchContainer getLayoutsSearchContainer() throws PortalException {
layoutsSearchContainer.setRowChecker(emptyOnClickRowChecker);
- int layoutsCount = LayoutLocalServiceUtil.getLayoutsCount(
- getSelGroup(), isPrivateLayout(), getKeywords(),
+ int layoutsCount = LayoutServiceUtil.getLayoutsCount(
+ getSelGroupId(), isPrivateLayout(), getKeywords(),
new String[] {
LayoutConstants.TYPE\_CONTENT, LayoutConstants.TYPE\_EMBEDDED,
LayoutConstants.TYPE\_LINK\_TO\_LAYOUT,
@@ -718,7 +720,7 @@ public SearchContainer getLayoutsSearchContainer() throws PortalException {
LayoutConstants.TYPE\_URL
});
- List layouts = LayoutLocalServiceUtil.getLayouts(
+ List layouts = LayoutServiceUtil.getLayouts(
getSelGroupId(), isPrivateLayout(), getKeywords(),
new String[] {
LayoutConstants.TYPE\_CONTENT, LayoutConstants.TYPE\_EMBEDDED,
@@ -943,9 +945,9 @@ public List getRelativeBreadcrumbEntries(Layout layout)
List breadcrumbEntries = new ArrayList<>();
- List curLayouts = layout.getAncestors();
+ List ancestorLayouts = layout.getAncestors();
- Collections.reverse(curLayouts);
+ Collections.reverse(ancestorLayouts);
boolean showLayoutPath = false;
@@ -953,17 +955,25 @@ public List getRelativeBreadcrumbEntries(Layout layout)
showLayoutPath = true;
}
- for (Layout curLayout : curLayouts) {
+ for (Layout ancestorLayout : ancestorLayouts) {
if (showLayoutPath) {
BreadcrumbEntry breadcrumbEntry = new BreadcrumbEntry();
- breadcrumbEntry.setTitle(
- curLayout.getName(\_themeDisplay.getLocale()));
+ if (LayoutPermissionUtil.contains(
+ \_themeDisplay.getPermissionChecker(), ancestorLayout,
+ ActionKeys.VIEW)) {
+
+ breadcrumbEntry.setTitle(
+ ancestorLayout.getName(\_themeDisplay.getLocale()));
+ }
+ else {
+ breadcrumbEntry.setTitle(StringPool.TRIPLE\_PERIOD);
+ }
breadcrumbEntries.add(breadcrumbEntry);
}
- if (curLayout.getPlid() == getSelPlid()) {
+ if (ancestorLayout.getPlid() == getSelPlid()) {
showLayoutPath = true;
}
}
@@ -1170,11 +1180,11 @@ public String getViewLayoutURL(Layout layout) throws PortalException {
}
public boolean hasLayouts() {
- int privatePagesCount = LayoutLocalServiceUtil.getLayoutsCount(
- getSelGroup(), true, 0);
+ int privatePagesCount = LayoutServiceUtil.getLayoutsCount(
+ getSelGroupId(), true, 0);
- int publicPagesCount = LayoutLocalServiceUtil.getLayoutsCount(
- getSelGroup(), false, 0);
+ int publicPagesCount = LayoutServiceUtil.getLayoutsCount(
+ getSelGroupId(), false, 0);
if ((privatePagesCount + publicPagesCount) > 0) {
return true;
@@ -1224,6 +1234,21 @@ public boolean isLayoutPageTemplateEntry() {
return false;
}
+ public boolean isLayoutReachable(Layout layout) throws PortalException {
+ List ancestorLayouts = layout.getAncestors();
+
+ for (Layout ancestorLayout : ancestorLayouts) {
+ if (!LayoutPermissionUtil.contains(
+ \_themeDisplay.getPermissionChecker(), ancestorLayout,
+ ActionKeys.VIEW)) {
+
+ return false;
+ }
+ }
+
+ return true;
+ }
+
public boolean isPagesTab() {
if (Objects.equals(getTabs1(), "pages")) {
return true;
diff --git a/modules/apps/layout/layout-admin-web/src/main/resources/META-INF/resources/add\_layout.jsp b/modules/apps/layout/layout-admin-web/src/main/resources/META-INF/resources/add\_layout.jsp
index 5cfba9ecaf48bb..57ec98be719b52 100644
--- a/modules/apps/layout/layout-admin-web/src/main/resources/META-INF/resources/add\_layout.jsp
+++ b/modules/apps/layout/layout-admin-web/src/main/resources/META-INF/resources/add\_layout.jsp
@@ -85,6 +85,14 @@ List autoSiteNavigationMenus = layoutsAdminDisplayContext.ge
var formData = new FormData();
+ formData.append('p\_auth', Liferay.authToken);
+
+ formActionURL = new URL(form.action);
+
+ formActionURL.searchParams.delete('p\_auth');
+
+ form.action = formActionURL;
+
Array.prototype.slice
.call(form.querySelectorAll('input'))
.forEach(function(input) {
diff --git a/modules/apps/layout/layout-admin-web/src/main/resources/META-INF/resources/flattened\_view.jsp b/modules/apps/layout/layout-admin-web/src/main/resources/META-INF/resources/flattened\_view.jsp
index fcca60b8828e4b..6c23a2f9392d9b 100644
--- a/modules/apps/layout/layout-admin-web/src/main/resources/META-INF/resources/flattened\_view.jsp
+++ b/modules/apps/layout/layout-admin-web/src/main/resources/META-INF/resources/flattened\_view.jsp
@@ -106,9 +106,13 @@ if (Validator.isNotNull(redirect)) {
>
<%
- PortletURL portletURL = layoutsAdminDisplayContext.getPortletURL();
+ PortletURL portletURL = null;
- portletURL.setParameter("selPlid", String.valueOf(layout.getPlid()));
+ if (layoutsAdminDisplayContext.isLayoutReachable(layout)) {
+ portletURL = layoutsAdminDisplayContext.getPortletURL();
+
+ portletURL.setParameter("selPlid", String.valueOf(layout.getPlid()));
+ }
%>
 {
- MultivaluedMap headers =
- containerRequestContext.getHeaders();
- if (corsSupport.isCORSRequest(headers::getFirst) &&
- corsSupport.isValidCORSRequest(
- containerRequestContext.getMethod(), headers::getFirst)) {
-
- MultivaluedMap responseHeaders =
- containerResponseContext.getHeaders();
-
- corsSupport.writeResponseHeaders(
- headers::getFirst, responseHeaders::addFirst);
- }
- };
+ context.register(new CORSContainerRequestFilter(corsSupport));
+ }
}
protected CORS getCORS(ResourceInfo resourceInfo) {
@@ -121,8 +108,56 @@ protected CORSSupport getCORSSupport(CORS cors) {
@Context
private ResourceInfo \_resourceInfo;
+ private class CORSContainerRequestFilter
+ implements ContainerResponseFilter {
+
+ public CORSContainerRequestFilter(CORSSupport corsSupport) {
+ \_corsSupport = corsSupport;
+ }
+
+ @Override
+ public void filter(
+ ContainerRequestContext containerRequestContext,
+ ContainerResponseContext containerResponseContext)
+ throws IOException {
+
+ MultivaluedMap headers =
+ containerRequestContext.getHeaders();
+
+ if (\_corsSupport.isCORSRequest(headers::getFirst) &&
+ \_corsSupport.isValidCORSRequest(
+ containerRequestContext.getMethod(), headers::getFirst) &&
+ (OAuth2ProviderScopeLiferayAccessControlContext.
+ isOAuth2AuthVerified() ||
+ \_isGuestUser())) {
+
+ MultivaluedMap responseHeaders =
+ containerResponseContext.getHeaders();
+
+ \_corsSupport.writeResponseHeaders(
+ headers::getFirst, responseHeaders::addFirst);
+ }
+ }
+
+ private boolean \_isGuestUser() {
+ PermissionChecker permissionChecker =
+ PermissionThreadLocal.getPermissionChecker();
+
+ if (permissionChecker == null) {
+ return true;
+ }
+
+ User user = permissionChecker.getUser();
+
+ return user.isDefaultUser();
+ }
+
+ private final CORSSupport \_corsSupport;
+
+ }
+
@PreMatching
- private static class CORSPreflighContainerRequestFilter
+ private class CORSPreflighContainerRequestFilter
implements ContainerRequestFilter {
public CORSPreflighContainerRequestFilter(CORSSupport corsSupport) {
@@ -138,7 +173,7 @@ public void filter(ContainerRequestContext containerRequestContext)
if (\_corsSupport.isCORSRequest(headers::getFirst) &&
StringUtil.equals(
- containerRequestContext.getMethod(), "OPTIONS") &&
+ containerRequestContext.getMethod(), HttpMethod.OPTIONS) &&
\_corsSupport.isValidCORSPreflightRequest(headers::getFirst)) {
Response.ResponseBuilder responseBuilder = Response.ok();
diff --git a/modules/apps/portal-remote/portal-remote-cors-impl/src/main/java/com/liferay/portal/remote/cors/internal/servlet/filter/CORSServletFilter.java b/modules/apps/portal-remote/portal-remote-cors-impl/src/main/java/com/liferay/portal/remote/cors/internal/servlet/filter/CORSServletFilter.java
index d5767b00efd226..e0af48607bdeb1 100644
--- a/modules/apps/portal-remote/portal-remote-cors-impl/src/main/java/com/liferay/portal/remote/cors/internal/servlet/filter/CORSServletFilter.java
+++ b/modules/apps/portal-remote/portal-remote-cors-impl/src/main/java/com/liferay/portal/remote/cors/internal/servlet/filter/CORSServletFilter.java
@@ -14,58 +14,39 @@
package com.liferay.portal.remote.cors.internal.servlet.filter;
+import com.liferay.oauth2.provider.scope.liferay.OAuth2ProviderScopeLiferayAccessControlContext;
+import com.liferay.portal.kernel.log.Log;
+import com.liferay.portal.kernel.log.LogFactoryUtil;
+import com.liferay.portal.kernel.model.User;
+import com.liferay.portal.kernel.security.permission.PermissionChecker;
+import com.liferay.portal.kernel.security.permission.PermissionThreadLocal;
+import com.liferay.portal.kernel.servlet.BaseFilter;
import com.liferay.portal.kernel.servlet.HttpMethods;
import com.liferay.portal.kernel.util.StringUtil;
import com.liferay.portal.remote.cors.internal.CORSSupport;
-import java.io.IOException;
-
import java.util.Map;
-import javax.servlet.Filter;
import javax.servlet.FilterChain;
-import javax.servlet.FilterConfig;
import javax.servlet.ServletException;
-import javax.servlet.ServletRequest;
-import javax.servlet.ServletResponse;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
/\*\*
\* @author Carlos Sierra Andrs
\*/
-public class CORSServletFilter implements Filter {
-
- @Override
- public void destroy() {
- }
+public class CORSServletFilter extends BaseFilter {
@Override
- public final void doFilter(
- ServletRequest servletRequest, ServletResponse servletResponse,
- FilterChain filterChain)
- throws IOException, ServletException {
-
- HttpServletRequest httpServletRequest =
- (HttpServletRequest)servletRequest;
+ public boolean isFilterEnabled(
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse) {
if (corsSupport.isCORSRequest(httpServletRequest::getHeader)) {
- try {
- processCORSRequest(
- httpServletRequest, (HttpServletResponse)servletResponse,
- filterChain);
- }
- catch (Exception e) {
- throw new ServletException(e);
- }
+ return true;
}
- else {
- filterChain.doFilter(servletRequest, servletResponse);
- }
- }
- @Override
- public void init(FilterConfig filterConfig) throws ServletException {
+ return false;
}
public void processCORSRequest(
@@ -89,7 +70,10 @@ public void processCORSRequest(
if (corsSupport.isValidCORSRequest(
httpServletRequest.getMethod(),
- httpServletRequest::getHeader)) {
+ httpServletRequest::getHeader) &&
+ (OAuth2ProviderScopeLiferayAccessControlContext.
+ isOAuth2AuthVerified() ||
+ \_isGuest())) {
corsSupport.writeResponseHeaders(
httpServletRequest::getHeader, httpServletResponse::setHeader);
@@ -102,6 +86,42 @@ public void setCORSHeaders(Map corsHeaders) {
corsSupport.setCORSHeaders(corsHeaders);
}
+ @Override
+ protected Log getLog() {
+ return \_log;
+ }
+
+ @Override
+ protected void processFilter(
+ HttpServletRequest httpServletRequest,
+ HttpServletResponse httpServletResponse, FilterChain filterChain)
+ throws ServletException {
+
+ try {
+ processCORSRequest(
+ httpServletRequest, httpServletResponse, filterChain);
+ }
+ catch (Exception exception) {
+ throw new ServletException(exception);
+ }
+ }
+
protected final CORSSupport corsSupport = new CORSSupport();
+ private boolean \_isGuest() {
+ PermissionChecker permissionChecker =
+ PermissionThreadLocal.getPermissionChecker();
+
+ if (permissionChecker == null) {
+ return true;
+ }
+
+ User user = permissionChecker.getUser();
+
+ return user.isDefaultUser();
+ }
+
+ private static final Log \_log = LogFactoryUtil.getLog(
+ CORSServletFilter.class);
+
}
\ No newline at end of file
diff --git a/modules/apps/portal-remote/portal-remote-cors-impl/src/main/java/com/liferay/portal/remote/cors/internal/servlet/filter/ConfigurablePortalCORSServletFilterPublisher.java b/modules/apps/portal-remote/portal-remote-cors-impl/src/main/java/com/liferay/portal/remote/cors/internal/servlet/filter/ConfigurablePortalCORSServletFilterPublisher.java
index 49d6e3fc9ca59c..c75709dbc408bd 100644
--- a/modules/apps/portal-remote/portal-remote-cors-impl/src/main/java/com/liferay/portal/remote/cors/internal/servlet/filter/ConfigurablePortalCORSServletFilterPublisher.java
+++ b/modules/apps/portal-remote/portal-remote-cors-impl/src/main/java/com/liferay/portal/remote/cors/internal/servlet/filter/ConfigurablePortalCORSServletFilterPublisher.java
@@ -62,7 +62,7 @@ protected void activate(
Dictionary filterProperties = new HashMapDictionary<>();
- filterProperties.put("before-filter", "Auto Login Filter");
+ filterProperties.put("before-filter", "Upload Servlet Request Filter");
filterProperties.put("dispatcher", new String[] {"FORWARD", "REQUEST"});
filterProperties.put("servlet-context-name", "");
filterProperties.put(
diff --git a/modules/apps/portal-remote/portal-remote-cxf-common/build.gradle b/modules/apps/portal-remote/portal-remote-cxf-common/build.gradle
index eba1d1fa5916b3..2551142ee014f1 100644
--- a/modules/apps/portal-remote/portal-remote-cxf-common/build.gradle
+++ b/modules/apps/portal-remote/portal-remote-cxf-common/build.gradle
@@ -3,8 +3,8 @@ dependencies {
compileOnly group: "com.liferay", name: "com.liferay.portal.configuration.metatype.api", version: "2.0.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "4.0.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "4.34.0"
- compileOnly group: "org.apache.cxf", name: "cxf-core", version: "3.2.5"
- compileOnly group: "org.apache.cxf", name: "cxf-rt-transports-http", version: "3.2.5"
+ compileOnly group: "org.apache.cxf", name: "cxf-core", version: "3.2.14"
+ compileOnly group: "org.apache.cxf", name: "cxf-rt-transports-http", version: "3.2.14"
compileOnly group: "org.apache.felix", name: "org.apache.felix.dependencymanager", version: "4.6.0"
compileOnly group: "org.apache.felix", name: "org.apache.felix.http.servlet-api", version: "1.1.2"
compileOnly group: "org.osgi", name: "org.osgi.service.component.annotations", version: "1.3.0"
diff --git a/modules/apps/portal-remote/portal-remote-jaxrs-whiteboard/bnd.bnd b/modules/apps/portal-remote/portal-remote-jaxrs-whiteboard/bnd.bnd
index 3292fa74711952..c9537a4ad4f759 100644
--- a/modules/apps/portal-remote/portal-remote-jaxrs-whiteboard/bnd.bnd
+++ b/modules/apps/portal-remote/portal-remote-jaxrs-whiteboard/bnd.bnd
@@ -12,150 +12,150 @@ Export-Package:\
javax.wsdl.factory;version="1.2",\
javax.wsdl.xml;version="1.2",\
\
- org.apache.cxf;version="3.2.5";-split-package:=first,\
- org.apache.cxf.annotations;version="3.2.5";-split-package:=first,\
- org.apache.cxf.attachment;version="3.2.5";-split-package:=first,\
- org.apache.cxf.binding;version="3.2.5";-split-package:=first,\
- org.apache.cxf.binding.soap;version="3.2.5",\
- org.apache.cxf.binding.soap.interceptor;version="3.2.5",\
- org.apache.cxf.binding.soap.jms;version="3.2.5",\
- org.apache.cxf.binding.soap.jms.interceptor;version="3.2.5",\
- org.apache.cxf.binding.soap.model;version="3.2.5",\
- org.apache.cxf.binding.soap.saaj;version="3.2.5",\
- org.apache.cxf.binding.soap.wsdl;version="3.2.5",\
- org.apache.cxf.binding.soap.wsdl.extensions;version="3.2.5",\
- org.apache.cxf.binding.soap.wsdl11;version="3.2.5",\
- org.apache.cxf.binding.xml;version="3.2.5",\
- org.apache.cxf.binding.xml.interceptor;version="3.2.5",\
- org.apache.cxf.binding.xml.wsdl11;version="3.2.5",\
- org.apache.cxf.bindings;version="3.2.5",\
- org.apache.cxf.bindings.xformat;version="3.2.5",\
- org.apache.cxf.bus;version="3.2.5";-split-package:=first,\
- org.apache.cxf.bus.blueprint;version="3.2.5";-split-package:=first,\
- org.apache.cxf.bus.extension;version="3.2.5";-split-package:=first,\
- org.apache.cxf.bus.managers;version="3.2.5";-split-package:=first,\
- org.apache.cxf.bus.osgi;version="3.2.5";-split-package:=first,\
- org.apache.cxf.bus.resource;version="3.2.5";-split-package:=first,\
- org.apache.cxf.bus.spring;version="3.2.5";-split-package:=first,\
- org.apache.cxf.buslifecycle;version="3.2.5";-split-package:=first,\
- org.apache.cxf.catalog;version="3.2.5";-split-package:=first,\
- org.apache.cxf.common;version="3.2.5";-split-package:=first,\
- org.apache.cxf.common.annotation;version="3.2.5";-split-package:=first,\
- org.apache.cxf.common.classloader;version="3.2.5";-split-package:=first,\
- org.apache.cxf.common.i18n;version="3.2.5";-split-package:=first,\
- org.apache.cxf.common.injection;version="3.2.5";-split-package:=first,\
- org.apache.cxf.common.jaxb;version="3.2.5";-split-package:=first,\
- org.apache.cxf.common.logging;version="3.2.5";-split-package:=first,\
- org.apache.cxf.common.security;version="3.2.5";-split-package:=first,\
- org.apache.cxf.common.util;version="3.2.5";-split-package:=first,\
- org.apache.cxf.common.xmlschema;version="3.2.5";-split-package:=first,\
- org.apache.cxf.configuration;version="3.2.5";-split-package:=first,\
- org.apache.cxf.configuration.blueprint;version="3.2.5";-split-package:=first,\
- org.apache.cxf.configuration.jsse;version="3.2.5";-split-package:=first,\
- org.apache.cxf.configuration.security;version="3.2.5";-split-package:=first,\
- org.apache.cxf.configuration.spring;version="3.2.5";-split-package:=first,\
- org.apache.cxf.continuations;version="3.2.5";-split-package:=first,\
- org.apache.cxf.databinding;version="3.2.5";-split-package:=first,\
- org.apache.cxf.databinding.source;version="3.2.5";-split-package:=first,\
- org.apache.cxf.databinding.source.mime;version="3.2.5";-split-package:=first,\
- org.apache.cxf.databinding.stax;version="3.2.5";-split-package:=first,\
- org.apache.cxf.endpoint;version="3.2.5";-split-package:=first,\
- org.apache.cxf.extension;version="3.2.5";-split-package:=first,\
- org.apache.cxf.feature;version="3.2.5";-split-package:=first,\
- org.apache.cxf.feature.transform;version="3.2.5";-split-package:=first,\
- org.apache.cxf.feature.validation;version="3.2.5";-split-package:=first,\
- org.apache.cxf.headers;version="3.2.5";-split-package:=first,\
- org.apache.cxf.helpers;version="3.2.5";-split-package:=first,\
- org.apache.cxf.interceptor;version="3.2.5";-split-package:=first,\
- org.apache.cxf.interceptor.security;version="3.2.5";-split-package:=first,\
- org.apache.cxf.interceptor.security.callback;version="3.2.5";-split-package:=first,\
- org.apache.cxf.interceptor.transform;version="3.2.5";-split-package:=first,\
- org.apache.cxf.internal;version="3.2.5";-split-package:=first,\
- org.apache.cxf.io;version="3.2.5";-split-package:=first,\
- org.apache.cxf.jaxrs;version="3.2.5",\
- org.apache.cxf.jaxrs.client.spec;version="3.2.5",\
- org.apache.cxf.jaxrs.ext;version="3.2.5",\
- org.apache.cxf.jaxrs.ext.multipart;version="3.2.5",\
- org.apache.cxf.jaxrs.ext.xml;version="3.2.5",\
- org.apache.cxf.jaxrs.impl;version="3.2.5",\
- org.apache.cxf.jaxrs.impl.tl;version="3.2.5",\
- org.apache.cxf.jaxrs.interceptor;version="3.2.5",\
- org.apache.cxf.jaxrs.lifecycle;version="3.2.5",\
- org.apache.cxf.jaxrs.model;version="3.2.5",\
- org.apache.cxf.jaxrs.model.doc;version="3.2.5",\
- org.apache.cxf.jaxrs.nio;version="3.2.5",\
- org.apache.cxf.jaxrs.provider;version="3.2.5",\
- org.apache.cxf.jaxrs.security;version="3.2.5",\
- org.apache.cxf.jaxrs.servlet;version="3.2.5",\
- org.apache.cxf.jaxrs.sse.client;version="3.2.5",\
- org.apache.cxf.jaxrs.utils;version="3.2.5",\
- org.apache.cxf.jaxrs.utils.multipart;version="3.2.5",\
- org.apache.cxf.jaxrs.utils.schemas;version="3.2.5",\
- org.apache.cxf.jaxrs.validation;version="3.2.5",\
- org.apache.cxf.logging;version="3.2.5";-split-package:=first,\
- org.apache.cxf.management;version="3.2.5";-split-package:=first,\
- org.apache.cxf.management.annotation;version="3.2.5";-split-package:=first,\
- org.apache.cxf.message;version="3.2.5";-split-package:=first,\
- org.apache.cxf.phase;version="3.2.5";-split-package:=first,\
- org.apache.cxf.policy;version="3.2.5";-split-package:=first,\
- org.apache.cxf.resource;version="3.2.5";-split-package:=first,\
- org.apache.cxf.security;version="3.2.5";-split-package:=first,\
- org.apache.cxf.security.claims;version="3.2.5",\
- org.apache.cxf.security.claims.authorization;version="3.2.5";-split-package:=first,\
- org.apache.cxf.security.transport;version="3.2.5";-split-package:=first,\
- org.apache.cxf.service;version="3.2.5";-split-package:=first,\
- org.apache.cxf.service.factory;version="3.2.5";-split-package:=first,\
- org.apache.cxf.service.invoker;version="3.2.5";-split-package:=first,\
- org.apache.cxf.service.invoker.spring;version="3.2.5";-split-package:=first,\
- org.apache.cxf.service.model;version="3.2.5";-split-package:=first,\
- org.apache.cxf.staxutils;version="3.2.5";-split-package:=first,\
- org.apache.cxf.staxutils.transform;version="3.2.5";-split-package:=first,\
- org.apache.cxf.staxutils.validation;version="3.2.5";-split-package:=first,\
- org.apache.cxf.tools;version="3.2.5",\
- org.apache.cxf.tools.common;version="3.2.5",\
- org.apache.cxf.tools.common.dom;version="3.2.5",\
- org.apache.cxf.tools.common.jaxb;version="3.2.5",\
- org.apache.cxf.tools.common.model;version="3.2.5",\
- org.apache.cxf.tools.common.toolspec;version="3.2.5",\
- org.apache.cxf.tools.common.toolspec.parser;version="3.2.5",\
- org.apache.cxf.tools.util;version="3.2.5",\
- org.apache.cxf.tools.validator;version="3.2.5",\
- org.apache.cxf.tools.validator.internal;version="3.2.5",\
- org.apache.cxf.tools.validator.internal.model;version="3.2.5",\
- org.apache.cxf.transport;version="3.2.5";-split-package:=first,\
- org.apache.cxf.transport.common;version="3.2.5",\
- org.apache.cxf.transport.common.gzip;version="3.2.5";-split-package:=first,\
- org.apache.cxf.transport.http;version="3.2.5",\
- org.apache.cxf.transport.http.auth;version="3.2.5",\
- org.apache.cxf.transport.http.blueprint;version="3.2.5",\
- org.apache.cxf.transport.http.osgi;version="3.2.5",\
- org.apache.cxf.transport.http.policy;version="3.2.5",\
- org.apache.cxf.transport.http.policy.impl;version="3.2.5",\
- org.apache.cxf.transport.http.spring;version="3.2.5",\
- org.apache.cxf.transport.https;version="3.2.5",\
- org.apache.cxf.transport.https.httpclient;version="3.2.5",\
- org.apache.cxf.transport.servlet;version="3.2.5",\
- org.apache.cxf.transport.servlet.blueprint;version="3.2.5",\
- org.apache.cxf.transport.servlet.servicelist;version="3.2.5",\
- org.apache.cxf.transports;version="3.2.5",\
- org.apache.cxf.transports.http;version="3.2.5",\
- org.apache.cxf.transports.http.configuration;version="3.2.5",\
- org.apache.cxf.validation;version="3.2.5";-split-package:=first,\
- org.apache.cxf.version;version="3.2.5";-split-package:=first,\
- org.apache.cxf.workqueue;version="3.2.5";-split-package:=first,\
- org.apache.cxf.ws;version="3.2.5",\
- org.apache.cxf.ws.addressing;version="3.2.5";-split-package:=first,\
- org.apache.cxf.ws.addressing.v200403;version="3.2.5";-split-package:=first,\
- org.apache.cxf.ws.addressing.v200408;version="3.2.5";-split-package:=first,\
- org.apache.cxf.ws.addressing.wsdl;version="3.2.5";-split-package:=first,\
- org.apache.cxf.wsdl;version="3.2.5",\
- org.apache.cxf.wsdl.binding;version="3.2.5",\
- org.apache.cxf.wsdl.http;version="3.2.5";-split-package:=first,\
- org.apache.cxf.wsdl.interceptors;version="3.2.5",\
- org.apache.cxf.wsdl.service;version="3.2.5",\
- org.apache.cxf.wsdl.service.factory;version="3.2.5",\
- org.apache.cxf.wsdl11;version="3.2.5",\
- org.apache.cxf.\*;version="3.2.5",\
+ org.apache.cxf;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.annotations;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.attachment;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.binding;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.binding.soap;version="3.2.14",\
+ org.apache.cxf.binding.soap.interceptor;version="3.2.14",\
+ org.apache.cxf.binding.soap.jms;version="3.2.14",\
+ org.apache.cxf.binding.soap.jms.interceptor;version="3.2.14",\
+ org.apache.cxf.binding.soap.model;version="3.2.14",\
+ org.apache.cxf.binding.soap.saaj;version="3.2.14",\
+ org.apache.cxf.binding.soap.wsdl;version="3.2.14",\
+ org.apache.cxf.binding.soap.wsdl.extensions;version="3.2.14",\
+ org.apache.cxf.binding.soap.wsdl11;version="3.2.14",\
+ org.apache.cxf.binding.xml;version="3.2.14",\
+ org.apache.cxf.binding.xml.interceptor;version="3.2.14",\
+ org.apache.cxf.binding.xml.wsdl11;version="3.2.14",\
+ org.apache.cxf.bindings;version="3.2.14",\
+ org.apache.cxf.bindings.xformat;version="3.2.14",\
+ org.apache.cxf.bus;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.bus.blueprint;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.bus.extension;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.bus.managers;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.bus.osgi;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.bus.resource;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.bus.spring;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.buslifecycle;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.catalog;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.common;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.common.annotation;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.common.classloader;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.common.i18n;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.common.injection;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.common.jaxb;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.common.logging;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.common.security;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.common.util;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.common.xmlschema;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.configuration;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.configuration.blueprint;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.configuration.jsse;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.configuration.security;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.configuration.spring;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.continuations;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.databinding;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.databinding.source;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.databinding.source.mime;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.databinding.stax;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.endpoint;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.extension;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.feature;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.feature.transform;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.feature.validation;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.headers;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.helpers;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.interceptor;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.interceptor.security;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.interceptor.security.callback;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.interceptor.transform;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.internal;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.io;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.jaxrs;version="3.2.14",\
+ org.apache.cxf.jaxrs.client.spec;version="3.2.14",\
+ org.apache.cxf.jaxrs.ext;version="3.2.14",\
+ org.apache.cxf.jaxrs.ext.multipart;version="3.2.14",\
+ org.apache.cxf.jaxrs.ext.xml;version="3.2.14",\
+ org.apache.cxf.jaxrs.impl;version="3.2.14",\
+ org.apache.cxf.jaxrs.impl.tl;version="3.2.14",\
+ org.apache.cxf.jaxrs.interceptor;version="3.2.14",\
+ org.apache.cxf.jaxrs.lifecycle;version="3.2.14",\
+ org.apache.cxf.jaxrs.model;version="3.2.14",\
+ org.apache.cxf.jaxrs.model.doc;version="3.2.14",\
+ org.apache.cxf.jaxrs.nio;version="3.2.14",\
+ org.apache.cxf.jaxrs.provider;version="3.2.14",\
+ org.apache.cxf.jaxrs.security;version="3.2.14",\
+ org.apache.cxf.jaxrs.servlet;version="3.2.14",\
+ org.apache.cxf.jaxrs.sse.client;version="3.2.14",\
+ org.apache.cxf.jaxrs.utils;version="3.2.14",\
+ org.apache.cxf.jaxrs.utils.multipart;version="3.2.14",\
+ org.apache.cxf.jaxrs.utils.schemas;version="3.2.14",\
+ org.apache.cxf.jaxrs.validation;version="3.2.14",\
+ org.apache.cxf.logging;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.management;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.management.annotation;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.message;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.phase;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.policy;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.resource;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.security;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.security.claims;version="3.2.14",\
+ org.apache.cxf.security.claims.authorization;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.security.transport;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.service;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.service.factory;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.service.invoker;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.service.invoker.spring;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.service.model;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.staxutils;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.staxutils.transform;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.staxutils.validation;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.tools;version="3.2.14",\
+ org.apache.cxf.tools.common;version="3.2.14",\
+ org.apache.cxf.tools.common.dom;version="3.2.14",\
+ org.apache.cxf.tools.common.jaxb;version="3.2.14",\
+ org.apache.cxf.tools.common.model;version="3.2.14",\
+ org.apache.cxf.tools.common.toolspec;version="3.2.14",\
+ org.apache.cxf.tools.common.toolspec.parser;version="3.2.14",\
+ org.apache.cxf.tools.util;version="3.2.14",\
+ org.apache.cxf.tools.validator;version="3.2.14",\
+ org.apache.cxf.tools.validator.internal;version="3.2.14",\
+ org.apache.cxf.tools.validator.internal.model;version="3.2.14",\
+ org.apache.cxf.transport;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.transport.common;version="3.2.14",\
+ org.apache.cxf.transport.common.gzip;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.transport.http;version="3.2.14",\
+ org.apache.cxf.transport.http.auth;version="3.2.14",\
+ org.apache.cxf.transport.http.blueprint;version="3.2.14",\
+ org.apache.cxf.transport.http.osgi;version="3.2.14",\
+ org.apache.cxf.transport.http.policy;version="3.2.14",\
+ org.apache.cxf.transport.http.policy.impl;version="3.2.14",\
+ org.apache.cxf.transport.http.spring;version="3.2.14",\
+ org.apache.cxf.transport.https;version="3.2.14",\
+ org.apache.cxf.transport.https.httpclient;version="3.2.14",\
+ org.apache.cxf.transport.servlet;version="3.2.14",\
+ org.apache.cxf.transport.servlet.blueprint;version="3.2.14",\
+ org.apache.cxf.transport.servlet.servicelist;version="3.2.14",\
+ org.apache.cxf.transports;version="3.2.14",\
+ org.apache.cxf.transports.http;version="3.2.14",\
+ org.apache.cxf.transports.http.configuration;version="3.2.14",\
+ org.apache.cxf.validation;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.version;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.workqueue;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.ws;version="3.2.14",\
+ org.apache.cxf.ws.addressing;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.ws.addressing.v200403;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.ws.addressing.v200408;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.ws.addressing.wsdl;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.wsdl;version="3.2.14",\
+ org.apache.cxf.wsdl.binding;version="3.2.14",\
+ org.apache.cxf.wsdl.http;version="3.2.14";-split-package:=first,\
+ org.apache.cxf.wsdl.interceptors;version="3.2.14",\
+ org.apache.cxf.wsdl.service;version="3.2.14",\
+ org.apache.cxf.wsdl.service.factory;version="3.2.14",\
+ org.apache.cxf.wsdl11;version="3.2.14",\
+ org.apache.cxf.\*;version="3.2.14",\
org.apache.ws;version="2.2.3",\
org.apache.ws.commons;version="2.2.3",\
org.apache.ws.commons.schema;version="2.2.3",\
diff --git a/modules/apps/portal-remote/portal-remote-jaxrs-whiteboard/build.gradle b/modules/apps/portal-remote/portal-remote-jaxrs-whiteboard/build.gradle
index 618be5fc4c2b5a..d01116feb92d60 100644
--- a/modules/apps/portal-remote/portal-remote-jaxrs-whiteboard/build.gradle
+++ b/modules/apps/portal-remote/portal-remote-jaxrs-whiteboard/build.gradle
@@ -1,15 +1,15 @@
dependencies {
- compileInclude group: "org.apache.cxf", name: "cxf-core", version: "3.2.5"
- compileInclude group: "org.apache.cxf", name: "cxf-rt-bindings-soap", version: "3.2.5"
- compileInclude group: "org.apache.cxf", name: "cxf-rt-bindings-xml", version: "3.2.5"
- compileInclude group: "org.apache.cxf", name: "cxf-rt-databinding-jaxb", version: "3.2.5"
- compileInclude group: "org.apache.cxf", name: "cxf-rt-wsdl", version: "3.2.5"
- compileInclude group: "org.apache.cxf", name: "cxf-tools-validator", version: "3.2.5"
+ compileInclude group: "org.apache.cxf", name: "cxf-core", version: "3.2.14"
+ compileInclude group: "org.apache.cxf", name: "cxf-rt-bindings-soap", version: "3.2.14"
+ compileInclude group: "org.apache.cxf", name: "cxf-rt-bindings-xml", version: "3.2.14"
+ compileInclude group: "org.apache.cxf", name: "cxf-rt-databinding-jaxb", version: "3.2.14"
+ compileInclude group: "org.apache.cxf", name: "cxf-rt-wsdl", version: "3.2.14"
+ compileInclude group: "org.apache.cxf", name: "cxf-tools-validator", version: "3.2.14"
compileInclude group: "wsdl4j", name: "wsdl4j", version: "1.6.3"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "4.34.0"
compileOnly group: "javax.json", name: "javax.json-api", version: "1.0"
- compileOnly group: "org.apache.aries.jax.rs", name: "org.apache.aries.jax.rs.whiteboard", version: "1.0.6"
+ compileOnly group: "org.apache.aries.jax.rs", name: "org.apache.aries.jax.rs.whiteboard", version: "1.0.9"
compileOnly group: "org.apache.geronimo.specs", name: "geronimo-jaxrs\_2.1\_spec", version: "1.1"
compileOnly group: "org.osgi", name: "org.osgi.service.jaxrs", version: "1.0.0"
compileOnly group: "org.osgi", name: "org.osgi.util.function", version: "1.1.0"
diff --git a/modules/apps/portal-remote/portal-remote-jaxrs-whiteboard/src/main/resources/org/apache/cxf/.lfrbuild-packageinfo b/modules/apps/portal-remote/portal-remote-jaxrs-whiteboard/src/main/resources/org/apache/cxf/.lfrbuild-packageinfo
new file mode 100644
index 00000000000000..54a1fbea029375
--- /dev/null
+++ b/modules/apps/portal-remote/portal-remote-jaxrs-whiteboard/src/main/resources/org/apache/cxf/.lfrbuild-packageinfo
@@ -0,0 +1,4 @@
+EXCESSIVE-VERSION-INCREASE-RECURSIVE
+PACKAGE-ADDED-MISSING-PACKAGEINFO-RECURSIVE
+VERSION-INCREASE-REQUIRED-RECURSIVE
+VERSION-INCREASE-SUGGESTED-RECURSIVE
\ No newline at end of file
diff --git a/modules/apps/portal-remote/portal-remote-rest-extender-test/build.gradle b/modules/apps/portal-remote/portal-remote-rest-extender-test/build.gradle
index 56ea9955da67a2..0772da55567e10 100644
--- a/modules/apps/portal-remote/portal-remote-rest-extender-test/build.gradle
+++ b/modules/apps/portal-remote/portal-remote-rest-extender-test/build.gradle
@@ -2,7 +2,7 @@ dependencies {
testIntegrationCompile group: "com.liferay", name: "com.liferay.arquillian.extension.junit.bridge", version: "1.0.19"
testIntegrationCompile group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "default"
testIntegrationCompile group: "javax.ws.rs", name: "javax.ws.rs-api", version: "2.1"
- testIntegrationCompile group: "org.apache.cxf", name: "cxf-core", version: "3.2.5"
+ testIntegrationCompile group: "org.apache.cxf", name: "cxf-core", version: "3.2.14"
testIntegrationCompile group: "org.osgi", name: "org.osgi.service.cm", version: "1.5.0"
testIntegrationCompile group: "org.osgi", name: "org.osgi.service.component.annotations", version: "1.3.0"
testIntegrationCompile group: "org.osgi", name: "org.osgi.service.http", version: "1.2.1"
diff --git a/modules/apps/portal-remote/portal-remote-rest-extender/build.gradle b/modules/apps/portal-remote/portal-remote-rest-extender/build.gradle
index ea84bb236f48dc..1296a314990595 100644
--- a/modules/apps/portal-remote/portal-remote-rest-extender/build.gradle
+++ b/modules/apps/portal-remote/portal-remote-rest-extender/build.gradle
@@ -1,6 +1,6 @@
dependencies {
- compileInclude group: "org.apache.cxf", name: "cxf-rt-rs-extension-providers", version: "3.2.5"
- compileInclude group: "org.apache.cxf", name: "cxf-rt-rs-json-basic", version: "3.2.5"
+ compileInclude group: "org.apache.cxf", name: "cxf-rt-rs-extension-providers", version: "3.2.14"
+ compileInclude group: "org.apache.cxf", name: "cxf-rt-rs-json-basic", version: "3.2.14"
compileInclude group: "org.codehaus.jettison", name: "jettison", version: "1.3.3"
compileOnly group: "biz.aQute.bnd", name: "biz.aQute.bnd.annotation", version: "4.2.0"
@@ -8,8 +8,8 @@ dependencies {
compileOnly group: "com.liferay", name: "com.liferay.portal.configuration.metatype.api", version: "2.0.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "4.34.0"
compileOnly group: "javax.ws.rs", name: "javax.ws.rs-api", version: "2.1"
- compileOnly group: "org.apache.cxf", name: "cxf-core", version: "3.2.5"
- compileOnly group: "org.apache.cxf", name: "cxf-rt-frontend-jaxrs", version: "3.2.5"
+ compileOnly group: "org.apache.cxf", name: "cxf-core", version: "3.2.14"
+ compileOnly group: "org.apache.cxf", name: "cxf-rt-frontend-jaxrs", version: "3.2.14"
compileOnly group: "org.apache.felix", name: "org.apache.felix.dependencymanager", version: "4.6.0"
compileOnly group: "org.codehaus.jettison", name: "jettison", version: "1.3.3"
compileOnly group: "org.osgi", name: "org.osgi.service.component.annotations", version: "1.3.0"
diff --git a/modules/apps/portal-remote/portal-remote-soap-extender-impl/build.gradle b/modules/apps/portal-remote/portal-remote-soap-extender-impl/build.gradle
index 214b714d0214a8..e29a6de4f10d9c 100644
--- a/modules/apps/portal-remote/portal-remote-soap-extender-impl/build.gradle
+++ b/modules/apps/portal-remote/portal-remote-soap-extender-impl/build.gradle
@@ -1,7 +1,7 @@
dependencies {
- compileInclude group: "org.apache.cxf", name: "cxf-rt-frontend-jaxws", version: "3.2.5"
- compileInclude group: "org.apache.cxf", name: "cxf-rt-frontend-simple", version: "3.2.5"
- compileInclude group: "org.apache.cxf", name: "cxf-rt-ws-policy", version: "3.2.5"
+ compileInclude group: "org.apache.cxf", name: "cxf-rt-frontend-jaxws", version: "3.2.14"
+ compileInclude group: "org.apache.cxf", name: "cxf-rt-frontend-simple", version: "3.2.14"
+ compileInclude group: "org.apache.cxf", name: "cxf-rt-ws-policy", version: "3.2.14"
compileOnly group: "biz.aQute.bnd", name: "biz.aQute.bnd.annotation", version: "4.2.0"
compileOnly group: "com.liferay", name: "com.liferay.osgi.util", version: "5.0.0"
@@ -11,7 +11,7 @@ dependencies {
compileOnly group: "com.liferay", name: "com.liferay.portal.remote.soap.extender.api", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.upgrade.api", version: "3.0.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "4.34.0"
- compileOnly group: "org.apache.cxf", name: "cxf-core", version: "3.2.5"
+ compileOnly group: "org.apache.cxf", name: "cxf-core", version: "3.2.14"
compileOnly group: "org.apache.felix", name: "org.apache.felix.dependencymanager", version: "4.6.0"
compileOnly group: "org.osgi", name: "org.osgi.service.component.annotations", version: "1.3.0"
compileOnly group: "org.osgi", name: "org.osgi.service.http.whiteboard", version: "1.0.0"
diff --git a/modules/apps/portal-remote/portal-remote-soap-extender-test/build.gradle b/modules/apps/portal-remote/portal-remote-soap-extender-test/build.gradle
index fc82bae76e7bc1..e9a7e85f66ed0d 100644
--- a/modules/apps/portal-remote/portal-remote-soap-extender-test/build.gradle
+++ b/modules/apps/portal-remote/portal-remote-soap-extender-test/build.gradle
@@ -4,10 +4,10 @@ dependencies {
testIntegrationCompile group: "com.liferay", name: "javax.xml.ws", version: "2.3.0.LIFERAY-PATCHED-1"
testIntegrationCompile group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "default"
testIntegrationCompile group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "default"
- testIntegrationCompile group: "org.apache.cxf", name: "cxf-core", version: "3.1.9"
- testIntegrationCompile group: "org.apache.cxf", name: "cxf-rt-frontend-jaxws", version: "3.2.5"
- testIntegrationCompile group: "org.apache.cxf", name: "cxf-rt-frontend-simple", version: "3.2.5"
- testIntegrationCompile group: "org.apache.cxf", name: "cxf-rt-ws-policy", version: "3.2.5"
+ testIntegrationCompile group: "org.apache.cxf", name: "cxf-core", version: "3.2.14"
+ testIntegrationCompile group: "org.apache.cxf", name: "cxf-rt-frontend-jaxws", version: "3.2.14"
+ testIntegrationCompile group: "org.apache.cxf", name: "cxf-rt-frontend-simple", version: "3.2.14"
+ testIntegrationCompile group: "org.apache.cxf", name: "cxf-rt-ws-policy", version: "3.2.14"
testIntegrationCompile group: "org.apache.httpcomponents", name: "httpclient", version: "4.3.5"
testIntegrationCompile group: "org.osgi", name: "org.osgi.service.cm", version: "1.5.0"
testIntegrationCompile group: "org.osgi", name: "org.osgi.service.component.annotations", version: "1.3.0"
diff --git a/modules/apps/portal-scheduler/portal-scheduler-quartz/build.gradle b/modules/apps/portal-scheduler/portal-scheduler-quartz/build.gradle
index e4a93e0a6fa480..3991e6f8414e4f 100644
--- a/modules/apps/portal-scheduler/portal-scheduler-quartz/build.gradle
+++ b/modules/apps/portal-scheduler/portal-scheduler-quartz/build.gradle
@@ -1,5 +1,5 @@
dependencies {
- compileInclude group: "org.quartz-scheduler", name: "quartz", version: "2.1.7"
+ compileInclude group: "com.liferay", name: "org.quartz", version: "2.1.7.LIFERAY-PATCHED-1"
compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.profile.api", version: "3.0.0"
diff --git a/modules/apps/portal-scripting/portal-scripting-groovy/build.gradle b/modules/apps/portal-scripting/portal-scripting-groovy/build.gradle
index 11ba8cb676736d..abdeac80cf6710 100644
--- a/modules/apps/portal-scripting/portal-scripting-groovy/build.gradle
+++ b/modules/apps/portal-scripting/portal-scripting-groovy/build.gradle
@@ -1,5 +1,5 @@
dependencies {
- compileInclude group: "org.codehaus.groovy", name: "groovy", version: "2.4.5"
+ compileInclude group: "org.codehaus.groovy", name: "groovy", version: "2.4.21"
compileOnly group: "com.liferay", name: "com.liferay.portal.scripting.api", version: "3.0.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "4.34.0"
diff --git a/modules/apps/portal-search-elasticsearch6/portal-search-elasticsearch6-impl/build.gradle b/modules/apps/portal-search-elasticsearch6/portal-search-elasticsearch6-impl/build.gradle
index 3477c9b354e110..9b1574b1e43177 100644
--- a/modules/apps/portal-search-elasticsearch6/portal-search-elasticsearch6-impl/build.gradle
+++ b/modules/apps/portal-search-elasticsearch6/portal-search-elasticsearch6-impl/build.gradle
@@ -31,8 +31,8 @@ dependencies {
compileInclude group: "org.antlr", name: "antlr4-runtime", version: "4.5.3"
compileInclude group: "org.apache.httpcomponents", name: "httpasyncclient", version: "4.1.3"
compileInclude group: "org.apache.httpcomponents", name: "httpclient", version: "4.4"
- compileInclude group: "org.apache.logging.log4j", name: "log4j-api", version: "2.11.2"
- compileInclude group: "org.apache.logging.log4j", name: "log4j-core", version: "2.11.2"
+ compileInclude group: "org.apache.logging.log4j", name: "log4j-api", version: "2.13.3"
+ compileInclude group: "org.apache.logging.log4j", name: "log4j-core", version: "2.13.3"
compileInclude group: "org.apache.lucene", name: "lucene-analyzers-common", version: luceneVersion
compileInclude group: "org.apache.lucene", name: "lucene-core", version: luceneVersion
compileInclude group: "org.apache.lucene", name: "lucene-grouping", version: luceneVersion
@@ -96,7 +96,7 @@ dependencies {
testCompile group: "log4j", name: "log4j", version: "1.2.17"
testCompile group: "net.java.dev.jna", name: "jna", version: "4.1.0"
testCompile group: "org.apache.felix", name: "org.apache.felix.http.servlet-api", version: "1.1.2"
- testCompile group: "org.apache.tika", name: "tika-core", version: "1.14"
+ testCompile group: "org.apache.tika", name: "tika-core", version: "1.24"
testCompile group: "org.jabsorb", name: "jabsorb", version: "1.3.1"
testCompile group: "org.jodd", name: "jodd-bean", version: "3.6.4"
testCompile group: "org.jodd", name: "jodd-json", version: "3.6.4"
diff --git a/modules/apps/portal-search-elasticsearch7/portal-search-elasticsearch7-impl/build.gradle b/modules/apps/portal-search-elasticsearch7/portal-search-elasticsearch7-impl/build.gradle
index c871c78e43bd75..6cbf21ae57aef9 100644
--- a/modules/apps/portal-search-elasticsearch7/portal-search-elasticsearch7-impl/build.gradle
+++ b/modules/apps/portal-search-elasticsearch7/portal-search-elasticsearch7-impl/build.gradle
@@ -30,8 +30,8 @@ dependencies {
compileInclude group: "org.antlr", name: "antlr4-runtime", version: "4.5.3"
compileInclude group: "org.apache.httpcomponents", name: "httpasyncclient", version: "4.1.3"
compileInclude group: "org.apache.httpcomponents", name: "httpclient", version: "4.4"
- compileInclude group: "org.apache.logging.log4j", name: "log4j-api", version: "2.11.2"
- compileInclude group: "org.apache.logging.log4j", name: "log4j-core", version: "2.11.2"
+ compileInclude group: "org.apache.logging.log4j", name: "log4j-api", version: "2.13.3"
+ compileInclude group: "org.apache.logging.log4j", name: "log4j-core", version: "2.13.3"
compileInclude group: "org.apache.lucene", name: "lucene-analyzers-common", version: luceneVersion
compileInclude group: "org.apache.lucene", name: "lucene-backward-codecs", version: luceneVersion
compileInclude group: "org.apache.lucene", name: "lucene-core", version: luceneVersion
@@ -100,7 +100,7 @@ dependencies {
testCompile group: "log4j", name: "log4j", version: "1.2.17"
testCompile group: "net.java.dev.jna", name: "jna", version: "4.1.0"
testCompile group: "org.apache.felix", name: "org.apache.felix.http.servlet-api", version: "1.1.2"
- testCompile group: "org.apache.tika", name: "tika-core", version: "1.14"
+ testCompile group: "org.apache.tika", name: "tika-core", version: "1.24"
testCompile group: "org.jabsorb", name: "jabsorb", version: "1.3.1"
testCompile group: "org.jodd", name: "jodd-bean", version: "3.6.4"
testCompile group: "org.jodd", name: "jodd-json", version: "3.6.4"
diff --git a/modules/apps/portal-security-sso-google/portal-security-sso-google-impl/build.gradle b/modules/apps/portal-security-sso-google/portal-security-sso-google-impl/build.gradle
index bd8cca94b8f4f8..9afdbd5f90ad20 100644
--- a/modules/apps/portal-security-sso-google/portal-security-sso-google-impl/build.gradle
+++ b/modules/apps/portal-security-sso-google/portal-security-sso-google-impl/build.gradle
@@ -3,7 +3,7 @@ dependencies {
compileInclude group: "com.google.apis", name: "google-api-services-oauth2", version: "v2-rev103-1.21.0"
compileInclude group: "com.google.http-client", name: "google-http-client", version: "1.21.0"
compileInclude group: "com.google.http-client", name: "google-http-client-jackson2", version: "1.21.0"
- compileInclude group: "com.google.oauth-client", name: "google-oauth-client", version: "1.21.0"
+ compileInclude group: "com.google.oauth-client", name: "google-oauth-client", version: "1.31.0"
compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
compileOnly group: "com.google.code.findbugs", name: "jsr305", version: "1.3.9"
diff --git a/modules/apps/portal-security/portal-security-antisamy/build.gradle b/modules/apps/portal-security/portal-security-antisamy/build.gradle
index 342eb5736ae27a..bcd1592bec3d11 100644
--- a/modules/apps/portal-security/portal-security-antisamy/build.gradle
+++ b/modules/apps/portal-security/portal-security-antisamy/build.gradle
@@ -10,10 +10,10 @@ dependencies {
compileInclude group: "net.sourceforge.nekohtml", name: "nekohtml", version: "1.9.16"
compileInclude group: "org.apache.httpcomponents", name: "httpclient", version: "4.5.5"
compileInclude group: "org.apache.httpcomponents", name: "httpcore", version: "4.4.9"
- compileInclude group: "org.apache.xmlgraphics", name: "batik-constants", version: "1.10"
- compileInclude group: "org.apache.xmlgraphics", name: "batik-css", version: "1.10"
- compileInclude group: "org.apache.xmlgraphics", name: "batik-i18n", version: "1.10"
- compileInclude group: "org.apache.xmlgraphics", name: "batik-util", version: "1.10"
+ compileInclude group: "org.apache.xmlgraphics", name: "batik-constants", version: "1.13"
+ compileInclude group: "org.apache.xmlgraphics", name: "batik-css", version: "1.13"
+ compileInclude group: "org.apache.xmlgraphics", name: "batik-i18n", version: "1.13"
+ compileInclude group: "org.apache.xmlgraphics", name: "batik-util", version: "1.13"
compileInclude group: "org.apache.xmlgraphics", name: "xmlgraphics-commons", version: "2.2"
compileInclude group: "org.owasp.antisamy", name: "antisamy", version: "1.5.7"
compileInclude group: "xml-apis", name: "xml-apis-ext", version: "1.3.04"
diff --git a/modules/apps/portal-store/portal-store-s3/src/main/java/com/liferay/portal/store/s3/configuration/S3StoreConfiguration.java b/modules/apps/portal-store/portal-store-s3/src/main/java/com/liferay/portal/store/s3/configuration/S3StoreConfiguration.java
index 40e67ab50c99c4..602d899afb79af 100644
--- a/modules/apps/portal-store/portal-store-s3/src/main/java/com/liferay/portal/store/s3/configuration/S3StoreConfiguration.java
+++ b/modules/apps/portal-store/portal-store-s3/src/main/java/com/liferay/portal/store/s3/configuration/S3StoreConfiguration.java
@@ -158,7 +158,7 @@ public interface S3StoreConfiguration {
@Meta.AD(
description = "proxy-password-help", name = "proxy-password",
- required = false
+ required = false, type = Meta.Type.Password
)
public String proxyPassword();
diff --git a/modules/apps/portal-template/portal-template-velocity/build.gradle b/modules/apps/portal-template/portal-template-velocity/build.gradle
index 5be34196fd1845..f5499b3739c3fb 100644
--- a/modules/apps/portal-template/portal-template-velocity/build.gradle
+++ b/modules/apps/portal-template/portal-template-velocity/build.gradle
@@ -18,7 +18,7 @@ dependencies {
compileOnly group: "org.osgi", name: "osgi.core", version: "6.0.0"
testCompile group: "com.liferay.portal", name: "com.liferay.util.java", version: "default"
- testCompile group: "org.apache.tika", name: "tika-core", version: "1.14"
+ testCompile group: "org.apache.tika", name: "tika-core", version: "1.24"
testCompile project(":core:petra:petra-concurrent")
testCompile project(":core:petra:petra-memory")
testCompile project(":core:registry-api")
diff --git a/modules/apps/portal-vulcan/portal-vulcan-api/build.gradle b/modules/apps/portal-vulcan/portal-vulcan-api/build.gradle
index c35d79b8ec7275..7e99a60c568469 100644
--- a/modules/apps/portal-vulcan/portal-vulcan-api/build.gradle
+++ b/modules/apps/portal-vulcan/portal-vulcan-api/build.gradle
@@ -1,6 +1,6 @@
dependencies {
compileInclude group: "com.fasterxml.jackson.dataformat", name: "jackson-dataformat-xml", version: "2.9.8"
- compileInclude group: "org.yaml", name: "snakeyaml", version: "1.23"
+ compileInclude group: "org.yaml", name: "snakeyaml", version: "1.27"
compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
diff --git a/modules/apps/portal-vulcan/portal-vulcan-impl/build.gradle b/modules/apps/portal-vulcan/portal-vulcan-impl/build.gradle
index 9138aa471e92b9..8f0d0d0ee982a9 100644
--- a/modules/apps/portal-vulcan/portal-vulcan-impl/build.gradle
+++ b/modules/apps/portal-vulcan/portal-vulcan-impl/build.gradle
@@ -13,7 +13,7 @@ dependencies {
compileInclude group: "com.fasterxml.jackson.datatype", name: "jackson-datatype-jdk8", version: "2.9.8"
compileInclude group: "com.fasterxml.jackson.jaxrs", name: "jackson-jaxrs-xml-provider", version: "2.9.8"
compileInclude group: "com.google.guava", name: "failureaccess", version: "1.0.1"
- compileInclude group: "com.google.guava", name: "guava", version: "27.1-jre"
+ compileInclude group: "com.google.guava", name: "guava", version: "30.0-jre"
compileInclude group: "com.graphql-java", name: "graphql-java", version: "12.0"
compileInclude group: "com.graphql-java", name: "java-dataloader", version: "2.1.1"
compileInclude group: "com.graphql-java-kickstart", name: "graphql-java-servlet", version: "7.5.0"
@@ -25,11 +25,11 @@ dependencies {
compileInclude group: "io.swagger.core.v3", name: "swagger-models", version: "2.0.6"
compileInclude group: "org.antlr", name: "antlr4-runtime", version: "4.7.1"
compileInclude group: "org.apache.commons", name: "commons-lang3", version: "3.8"
- compileInclude group: "org.hibernate.validator", name: "hibernate-validator", version: "6.0.15.Final"
+ compileInclude group: "org.hibernate.validator", name: "hibernate-validator", version: "6.1.5.Final"
compileInclude group: "org.javassist", name: "javassist", version: "3.23.1-GA"
compileInclude group: "org.reactivestreams", name: "reactive-streams", version: "1.0.2"
compileInclude group: "org.reflections", name: "reflections", version: "0.9.11"
- compileInclude group: "org.yaml", name: "snakeyaml", version: "1.23"
+ compileInclude group: "org.yaml", name: "snakeyaml", version: "1.27"
compileOnly group: "biz.aQute.bnd", name: "biz.aQute.bndlib", version: "4.2.0"
compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
@@ -51,8 +51,8 @@ dependencies {
compileOnly group: "javax.portlet", name: "portlet-api", version: "3.0.1"
compileOnly group: "javax.validation", name: "validation-api", version: "2.0.1.Final"
compileOnly group: "javax.ws.rs", name: "javax.ws.rs-api", version: "2.1"
- compileOnly group: "org.apache.cxf", name: "cxf-core", version: "3.2.5"
- compileOnly group: "org.apache.cxf", name: "cxf-rt-frontend-jaxrs", version: "3.2.5"
+ compileOnly group: "org.apache.cxf", name: "cxf-core", version: "3.2.14"
+ compileOnly group: "org.apache.cxf", name: "cxf-rt-frontend-jaxrs", version: "3.2.14"
compileOnly group: "org.apache.felix", name: "org.apache.felix.http.servlet-api", version: "1.1.2"
compileOnly group: "org.osgi", name: "org.osgi.service.cm", version: "1.5.0"
compileOnly group: "org.osgi", name: "org.osgi.service.component", version: "1.3.0"
diff --git a/modules/apps/portal-vulcan/portal-vulcan-test/build.gradle b/modules/apps/portal-vulcan/portal-vulcan-test/build.gradle
index 3b98b750385b65..9c954e4315f9ab 100644
--- a/modules/apps/portal-vulcan/portal-vulcan-test/build.gradle
+++ b/modules/apps/portal-vulcan/portal-vulcan-test/build.gradle
@@ -3,8 +3,8 @@ dependencies {
testIntegrationCompile group: "com.liferay", name: "com.liferay.arquillian.extension.junit.bridge", version: "1.0.19"
testIntegrationCompile group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "default"
testIntegrationCompile group: "javax.ws.rs", name: "javax.ws.rs-api", version: "2.1"
- testIntegrationCompile group: "org.apache.cxf", name: "cxf-core", version: "3.2.5"
- testIntegrationCompile group: "org.apache.cxf", name: "cxf-rt-frontend-jaxrs", version: "3.2.5"
+ testIntegrationCompile group: "org.apache.cxf", name: "cxf-core", version: "3.2.14"
+ testIntegrationCompile group: "org.apache.cxf", name: "cxf-rt-frontend-jaxrs", version: "3.2.14"
testIntegrationCompile group: "org.springframework", name: "spring-test", version: "4.1.9.RELEASE"
testIntegrationCompile project(":apps:portal-odata:portal-odata-api")
testIntegrationCompile project(":apps:portal-vulcan:portal-vulcan-api")
diff --git a/modules/apps/portal-workflow/portal-workflow-kaleo-api/src/main/java/com/liferay/portal/workflow/kaleo/service/KaleoInstanceLocalService.java b/modules/apps/portal-workflow/portal-workflow-kaleo-api/src/main/java/com/liferay/portal/workflow/kaleo/service/KaleoInstanceLocalService.java
index 6a30679627a252..03b0fd8c55ff76 100644
--- a/modules/apps/portal-workflow/portal-workflow-kaleo-api/src/main/java/com/liferay/portal/workflow/kaleo/service/KaleoInstanceLocalService.java
+++ b/modules/apps/portal-workflow/portal-workflow-kaleo-api/src/main/java/com/liferay/portal/workflow/kaleo/service/KaleoInstanceLocalService.java
@@ -192,6 +192,10 @@ public long dynamicQueryCount(
@Transactional(propagation = Propagation.SUPPORTS, readOnly = true)
public KaleoInstance fetchKaleoInstance(long kaleoInstanceId);
+ @Transactional(propagation = Propagation.SUPPORTS, readOnly = true)
+ public KaleoInstance fetchKaleoInstance(
+ long kaleoInstanceId, long companyId, long userId);
+
@Transactional(propagation = Propagation.SUPPORTS, readOnly = true)
public ActionableDynamicQuery getActionableDynamicQuery();
diff --git a/modules/apps/portal-workflow/portal-workflow-kaleo-api/src/main/java/com/liferay/portal/workflow/kaleo/service/KaleoInstanceLocalServiceUtil.java b/modules/apps/portal-workflow/portal-workflow-kaleo-api/src/main/java/com/liferay/portal/workflow/kaleo/service/KaleoInstanceLocalServiceUtil.java
index 62e6ff3fa91af0..6c4f913d40d802 100644
--- a/modules/apps/portal-workflow/portal-workflow-kaleo-api/src/main/java/com/liferay/portal/workflow/kaleo/service/KaleoInstanceLocalServiceUtil.java
+++ b/modules/apps/portal-workflow/portal-workflow-kaleo-api/src/main/java/com/liferay/portal/workflow/kaleo/service/KaleoInstanceLocalServiceUtil.java
@@ -225,6 +225,13 @@ public static long dynamicQueryCount(
return getService().fetchKaleoInstance(kaleoInstanceId);
}
+ public static com.liferay.portal.workflow.kaleo.model.KaleoInstance
+ fetchKaleoInstance(long kaleoInstanceId, long companyId, long userId) {
+
+ return getService().fetchKaleoInstance(
+ kaleoInstanceId, companyId, userId);
+ }
+
public static com.liferay.portal.kernel.dao.orm.ActionableDynamicQuery
getActionableDynamicQuery() {
diff --git a/modules/apps/portal-workflow/portal-workflow-kaleo-api/src/main/java/com/liferay/portal/workflow/kaleo/service/KaleoInstanceLocalServiceWrapper.java b/modules/apps/portal-workflow/portal-workflow-kaleo-api/src/main/java/com/liferay/portal/workflow/kaleo/service/KaleoInstanceLocalServiceWrapper.java
index 4c83b61e470ccc..16a5c48f8a08b3 100644
--- a/modules/apps/portal-workflow/portal-workflow-kaleo-api/src/main/java/com/liferay/portal/workflow/kaleo/service/KaleoInstanceLocalServiceWrapper.java
+++ b/modules/apps/portal-workflow/portal-workflow-kaleo-api/src/main/java/com/liferay/portal/workflow/kaleo/service/KaleoInstanceLocalServiceWrapper.java
@@ -236,6 +236,14 @@ public long dynamicQueryCount(
return \_kaleoInstanceLocalService.fetchKaleoInstance(kaleoInstanceId);
}
+ @Override
+ public com.liferay.portal.workflow.kaleo.model.KaleoInstance
+ fetchKaleoInstance(long kaleoInstanceId, long companyId, long userId) {
+
+ return \_kaleoInstanceLocalService.fetchKaleoInstance(
+ kaleoInstanceId, companyId, userId);
+ }
+
@Override
public com.liferay.portal.kernel.dao.orm.ActionableDynamicQuery
getActionableDynamicQuery() {
diff --git a/modules/apps/portal-workflow/portal-workflow-kaleo-api/src/main/java/com/liferay/portal/workflow/kaleo/service/persistence/KaleoInstancePersistence.java b/modules/apps/portal-workflow/portal-workflow-kaleo-api/src/main/java/com/liferay/portal/workflow/kaleo/service/persistence/KaleoInstancePersistence.java
index 47d82f034a06f9..9cb49300d533cf 100644
--- a/modules/apps/portal-workflow/portal-workflow-kaleo-api/src/main/java/com/liferay/portal/workflow/kaleo/service/persistence/KaleoInstancePersistence.java
+++ b/modules/apps/portal-workflow/portal-workflow-kaleo-api/src/main/java/com/liferay/portal/workflow/kaleo/service/persistence/KaleoInstancePersistence.java
@@ -796,6 +796,66 @@ public KaleoInstance[] findByCN\_CPK\_PrevAndNext(
\*/
public int countByCN\_CPK(String className, long classPK);
+ /\*\*
+ \* Returns the kaleo instance where kaleoInstanceId = ? and companyId = ? and userId = ? or throws a `NoSuchInstanceException` if it could not be found.
+ \*
+ \* @param kaleoInstanceId the kaleo instance ID
+ \* @param companyId the company ID
+ \* @param userId the user ID
+ \* @return the matching kaleo instance
+ \* @throws NoSuchInstanceException if a matching kaleo instance could not be found
+ \*/
+ public KaleoInstance findByKII\_C\_U(
+ long kaleoInstanceId, long companyId, long userId)
+ throws NoSuchInstanceException;
+
+ /\*\*
+ \* Returns the kaleo instance where kaleoInstanceId = ? and companyId = ? and userId = ? or returns `null` if it could not be found. Uses the finder cache.
+ \*
+ \* @param kaleoInstanceId the kaleo instance ID
+ \* @param companyId the company ID
+ \* @param userId the user ID
+ \* @return the matching kaleo instance, or `null` if a matching kaleo instance could not be found
+ \*/
+ public KaleoInstance fetchByKII\_C\_U(
+ long kaleoInstanceId, long companyId, long userId);
+
+ /\*\*
+ \* Returns the kaleo instance where kaleoInstanceId = ? and companyId = ? and userId = ? or returns `null` if it could not be found, optionally using the finder cache.
+ \*
+ \* @param kaleoInstanceId the kaleo instance ID
+ \* @param companyId the company ID
+ \* @param userId the user ID
+ \* @param useFinderCache whether to use the finder cache
+ \* @return the matching kaleo instance, or `null` if a matching kaleo instance could not be found
+ \*/
+ public KaleoInstance fetchByKII\_C\_U(
+ long kaleoInstanceId, long companyId, long userId,
+ boolean useFinderCache);
+
+ /\*\*
+ \* Removes the kaleo instance where kaleoInstanceId = ? and companyId = ? and userId = ? from the database.
+ \*
+ \* @param kaleoInstanceId the kaleo instance ID
+ \* @param companyId the company ID
+ \* @param userId the user ID
+ \* @return the kaleo instance that was removed
+ \*/
+ public KaleoInstance removeByKII\_C\_U(
+ long kaleoInstanceId, long companyId, long userId)
+ throws NoSuchInstanceException;
+
+ /\*\*
+ \* Returns the number of kaleo instances where kaleoInstanceId = ? and companyId = ? and userId = ?.
+ \*
+ \* @param kaleoInstanceId the kaleo instance ID
+ \* @param companyId the company ID
+ \* @param userId the user ID
+ \* @return the number of matching kaleo instances
+ \*/
+ public int countByKII\_C\_U(
+ long kaleoInstanceId, long companyId, long userId);
+
/\*\*
\* Returns all the kaleo instances where companyId = ? and kaleoDefinitionName = ? and kaleoDefinitionVersion = ? and completionDate = ?.
\*
diff --git a/modules/apps/portal-workflow/portal-workflow-kaleo-api/src/main/java/com/liferay/portal/workflow/kaleo/service/persistence/KaleoInstanceUtil.java b/modules/apps/portal-workflow/portal-workflow-kaleo-api/src/main/java/com/liferay/portal/workflow/kaleo/service/persistence/KaleoInstanceUtil.java
index 8f373ea3034f47..f8592036037da4 100644
--- a/modules/apps/portal-workflow/portal-workflow-kaleo-api/src/main/java/com/liferay/portal/workflow/kaleo/service/persistence/KaleoInstanceUtil.java
+++ b/modules/apps/portal-workflow/portal-workflow-kaleo-api/src/main/java/com/liferay/portal/workflow/kaleo/service/persistence/KaleoInstanceUtil.java
@@ -1058,6 +1058,88 @@ public static int countByCN\_CPK(String className, long classPK) {
return getPersistence().countByCN\_CPK(className, classPK);
}
+ /\*\*
+ \* Returns the kaleo instance where kaleoInstanceId = ? and companyId = ? and userId = ? or throws a `NoSuchInstanceException` if it could not be found.
+ \*
+ \* @param kaleoInstanceId the kaleo instance ID
+ \* @param companyId the company ID
+ \* @param userId the user ID
+ \* @return the matching kaleo instance
+ \* @throws NoSuchInstanceException if a matching kaleo instance could not be found
+ \*/
+ public static KaleoInstance findByKII\_C\_U(
+ long kaleoInstanceId, long companyId, long userId)
+ throws com.liferay.portal.workflow.kaleo.exception.
+ NoSuchInstanceException {
+
+ return getPersistence().findByKII\_C\_U(
+ kaleoInstanceId, companyId, userId);
+ }
+
+ /\*\*
+ \* Returns the kaleo instance where kaleoInstanceId = ? and companyId = ? and userId = ? or returns `null` if it could not be found. Uses the finder cache.
+ \*
+ \* @param kaleoInstanceId the kaleo instance ID
+ \* @param companyId the company ID
+ \* @param userId the user ID
+ \* @return the matching kaleo instance, or `null` if a matching kaleo instance could not be found
+ \*/
+ public static KaleoInstance fetchByKII\_C\_U(
+ long kaleoInstanceId, long companyId, long userId) {
+
+ return getPersistence().fetchByKII\_C\_U(
+ kaleoInstanceId, companyId, userId);
+ }
+
+ /\*\*
+ \* Returns the kaleo instance where kaleoInstanceId = ? and companyId = ? and userId = ? or returns `null` if it could not be found, optionally using the finder cache.
+ \*
+ \* @param kaleoInstanceId the kaleo instance ID
+ \* @param companyId the company ID
+ \* @param userId the user ID
+ \* @param useFinderCache whether to use the finder cache
+ \* @return the matching kaleo instance, or `null` if a matching kaleo instance could not be found
+ \*/
+ public static KaleoInstance fetchByKII\_C\_U(
+ long kaleoInstanceId, long companyId, long userId,
+ boolean useFinderCache) {
+
+ return getPersistence().fetchByKII\_C\_U(
+ kaleoInstanceId, companyId, userId, useFinderCache);
+ }
+
+ /\*\*
+ \* Removes the kaleo instance where kaleoInstanceId = ? and companyId = ? and userId = ? from the database.
+ \*
+ \* @param kaleoInstanceId the kaleo instance ID
+ \* @param companyId the company ID
+ \* @param userId the user ID
+ \* @return the kaleo instance that was removed
+ \*/
+ public static KaleoInstance removeByKII\_C\_U(
+ long kaleoInstanceId, long companyId, long userId)
+ throws com.liferay.portal.workflow.kaleo.exception.
+ NoSuchInstanceException {
+
+ return getPersistence().removeByKII\_C\_U(
+ kaleoInstanceId, companyId, userId);
+ }
+
+ /\*\*
+ \* Returns the number of kaleo instances where kaleoInstanceId = ? and companyId = ? and userId = ?.
+ \*
+ \* @param kaleoInstanceId the kaleo instance ID
+ \* @param companyId the company ID
+ \* @param userId the user ID
+ \* @return the number of matching kaleo instances
+ \*/
+ public static int countByKII\_C\_U(
+ long kaleoInstanceId, long companyId, long userId) {
+
+ return getPersistence().countByKII\_C\_U(
+ kaleoInstanceId, companyId, userId);
+ }
+
/\*\*
\* Returns all the kaleo instances where companyId = ? and kaleoDefinitionName = ? and kaleoDefinitionVersion = ? and completionDate = ?.
\*
diff --git a/modules/apps/portal-workflow/portal-workflow-kaleo-runtime-impl/build.gradle b/modules/apps/portal-workflow/portal-workflow-kaleo-runtime-impl/build.gradle
index f9afca714a4702..deca62dd86c39a 100644
--- a/modules/apps/portal-workflow/portal-workflow-kaleo-runtime-impl/build.gradle
+++ b/modules/apps/portal-workflow/portal-workflow-kaleo-runtime-impl/build.gradle
@@ -7,7 +7,6 @@ dependencies {
compileOnly group: "com.liferay", name: "com.liferay.portal.instance.lifecycle.api", version: "2.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.rules.engine.api", version: "4.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.workflow.api", version: "5.0.0"
- compileOnly group: "com.liferay", name: "com.liferay.portal.workflow.kaleo.api", version: "4.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.workflow.kaleo.definition.api", version: "4.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.workflow.kaleo.runtime.api", version: "4.0.0"
compileOnly group: "com.liferay", name: "com.liferay.push.notifications.api", version: "3.0.0"
@@ -16,4 +15,5 @@ dependencies {
compileOnly group: "org.osgi", name: "org.osgi.service.component.annotations", version: "1.3.0"
compileOnly group: "org.osgi", name: "osgi.core", version: "6.0.0"
compileOnly group: "org.springframework", name: "spring-context", version: "4.1.9.RELEASE"
+ compileOnly project(":apps:portal-workflow:portal-workflow-kaleo-api")
}
\ No newline at end of file
diff --git a/modules/apps/portal-workflow/portal-workflow-kaleo-runtime-impl/src/main/java/com/liferay/portal/workflow/kaleo/runtime/internal/DefaultWorkflowEngineImpl.java b/modules/apps/portal-workflow/portal-workflow-kaleo-runtime-impl/src/main/java/com/liferay/portal/workflow/kaleo/runtime/internal/DefaultWorkflowEngineImpl.java
index d71cd2210a3f67..5d90d9cfd7fa1a 100644
--- a/modules/apps/portal-workflow/portal-workflow-kaleo-runtime-impl/src/main/java/com/liferay/portal/workflow/kaleo/runtime/internal/DefaultWorkflowEngineImpl.java
+++ b/modules/apps/portal-workflow/portal-workflow-kaleo-runtime-impl/src/main/java/com/liferay/portal/workflow/kaleo/runtime/internal/DefaultWorkflowEngineImpl.java
@@ -277,12 +277,23 @@ public WorkflowInstance getWorkflowInstance(
throws WorkflowException {
try {
- KaleoInstance kaleoInstance =
- kaleoInstanceLocalService.getKaleoInstance(workflowInstanceId);
+ KaleoInstance kaleoInstance = null;
- return \_kaleoWorkflowModelConverter.toWorkflowInstance(
- kaleoInstance,
- kaleoInstance.getRootKaleoInstanceToken(serviceContext));
+ if (serviceContext.getUserId() > 0) {
+ kaleoInstance = kaleoInstanceLocalService.fetchKaleoInstance(
+ workflowInstanceId, serviceContext.getCompanyId(),
+ serviceContext.getUserId());
+ }
+ else {
+ kaleoInstance = kaleoInstanceLocalService.getKaleoInstance(
+ workflowInstanceId);
+ }
+
+ if (kaleoInstance != null) {
+ return \_kaleoWorkflowModelConverter.toWorkflowInstance(
+ kaleoInstance,
+ kaleoInstance.getRootKaleoInstanceToken(serviceContext));
+ }
}
catch (WorkflowException we) {
throw we;
@@ -290,6 +301,8 @@ public WorkflowInstance getWorkflowInstance(
catch (Exception e) {
throw new WorkflowException(e);
}
+
+ return null;
}
@Override
diff --git a/modules/apps/portal-workflow/portal-workflow-kaleo-runtime-integration-impl/build.gradle b/modules/apps/portal-workflow/portal-workflow-kaleo-runtime-integration-impl/build.gradle
index 7646b01d6c5c10..48950bb43965fa 100644
--- a/modules/apps/portal-workflow/portal-workflow-kaleo-runtime-integration-impl/build.gradle
+++ b/modules/apps/portal-workflow/portal-workflow-kaleo-runtime-integration-impl/build.gradle
@@ -4,6 +4,6 @@ dependencies {
compileOnly group: "com.liferay", name: "com.liferay.portal.workflow.kaleo.api", version: "4.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.workflow.kaleo.definition.api", version: "4.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.workflow.kaleo.runtime.api", version: "4.0.0"
- compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "4.34.0"
+ compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "default"
compileOnly group: "org.osgi", name: "org.osgi.service.component.annotations", version: "1.3.0"
}
\ No newline at end of file
diff --git a/modules/apps/portal-workflow/portal-workflow-kaleo-runtime-integration-impl/src/main/java/com/liferay/portal/workflow/kaleo/runtime/integration/internal/WorkflowInstanceManagerImpl.java b/modules/apps/portal-workflow/portal-workflow-kaleo-runtime-integration-impl/src/main/java/com/liferay/portal/workflow/kaleo/runtime/integration/internal/WorkflowInstanceManagerImpl.java
index 6d235ecd2c3196..0e8ecb52fee42d 100644
--- a/modules/apps/portal-workflow/portal-workflow-kaleo-runtime-integration-impl/src/main/java/com/liferay/portal/workflow/kaleo/runtime/integration/internal/WorkflowInstanceManagerImpl.java
+++ b/modules/apps/portal-workflow/portal-workflow-kaleo-runtime-integration-impl/src/main/java/com/liferay/portal/workflow/kaleo/runtime/integration/internal/WorkflowInstanceManagerImpl.java
@@ -84,6 +84,20 @@ public WorkflowInstance getWorkflowInstance(
workflowInstanceId, serviceContext);
}
+ @Override
+ public WorkflowInstance getWorkflowInstance(
+ long companyId, long userId, long workflowInstanceId)
+ throws WorkflowException {
+
+ ServiceContext serviceContext = new ServiceContext();
+
+ serviceContext.setCompanyId(companyId);
+ serviceContext.setUserId(userId);
+
+ return \_workflowEngine.getWorkflowInstance(
+ workflowInstanceId, serviceContext);
+ }
+
@Override
public int getWorkflowInstanceCount(
long companyId, Long userId, String assetClassName,
diff --git a/modules/apps/portal-workflow/portal-workflow-kaleo-service/build.gradle b/modules/apps/portal-workflow/portal-workflow-kaleo-service/build.gradle
index 4340177e57c6ff..d43d015ba5d2b3 100644
--- a/modules/apps/portal-workflow/portal-workflow-kaleo-service/build.gradle
+++ b/modules/apps/portal-workflow/portal-workflow-kaleo-service/build.gradle
@@ -16,7 +16,6 @@ dependencies {
compileOnly group: "com.liferay", name: "com.liferay.portal.search.spi", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.upgrade.api", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.workflow.api", version: "5.1.0"
- compileOnly group: "com.liferay", name: "com.liferay.portal.workflow.kaleo.api", version: "4.1.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.workflow.kaleo.definition.api", version: "4.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.workflow.kaleo.runtime.api", version: "4.0.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "4.0.0"
@@ -27,4 +26,5 @@ dependencies {
compileOnly group: "org.osgi", name: "org.osgi.service.component.annotations", version: "1.3.0"
compileOnly group: "org.osgi", name: "osgi.core", version: "6.0.0"
compileOnly group: "org.springframework", name: "spring-context", version: "4.1.9.RELEASE"
+ compileOnly project(":apps:portal-workflow:portal-workflow-kaleo-api")
}
\ No newline at end of file
diff --git a/modules/apps/portal-workflow/portal-workflow-kaleo-service/service.xml b/modules/apps/portal-workflow/portal-workflow-kaleo-service/service.xml
index f5e4da9554b1ab..6d60b207d089e0 100644
--- a/modules/apps/portal-workflow/portal-workflow-kaleo-service/service.xml
+++ b/modules/apps/portal-workflow/portal-workflow-kaleo-service/service.xml
@@ -262,6 +262,11 @@

+
+
+
+
+

diff --git a/modules/apps/portal-workflow/portal-workflow-kaleo-service/src/main/java/com/liferay/portal/workflow/kaleo/model/impl/KaleoInstanceModelImpl.java b/modules/apps/portal-workflow/portal-workflow-kaleo-service/src/main/java/com/liferay/portal/workflow/kaleo/model/impl/KaleoInstanceModelImpl.java
index 712708928d656e..1ebdf544fa3f2f 100644
--- a/modules/apps/portal-workflow/portal-workflow-kaleo-service/src/main/java/com/liferay/portal/workflow/kaleo/model/impl/KaleoInstanceModelImpl.java
+++ b/modules/apps/portal-workflow/portal-workflow-kaleo-service/src/main/java/com/liferay/portal/workflow/kaleo/model/impl/KaleoInstanceModelImpl.java
@@ -136,9 +136,9 @@ public class KaleoInstanceModelImpl
public static final long KALEODEFINITIONVERSIONID\_COLUMN\_BITMASK = 128L;
- public static final long USERID\_COLUMN\_BITMASK = 256L;
+ public static final long KALEOINSTANCEID\_COLUMN\_BITMASK = 256L;
- public static final long KALEOINSTANCEID\_COLUMN\_BITMASK = 512L;
+ public static final long USERID\_COLUMN\_BITMASK = 512L;
public static void setEntityCacheEnabled(boolean entityCacheEnabled) {
\_entityCacheEnabled = entityCacheEnabled;
@@ -384,9 +384,19 @@ public long getKaleoInstanceId() {
public void setKaleoInstanceId(long kaleoInstanceId) {
\_columnBitmask = -1L;
+ if (!\_setOriginalKaleoInstanceId) {
+ \_setOriginalKaleoInstanceId = true;
+
+ \_originalKaleoInstanceId = \_kaleoInstanceId;
+ }
+
\_kaleoInstanceId = kaleoInstanceId;
}
+ public long getOriginalKaleoInstanceId() {
+ return \_originalKaleoInstanceId;
+ }
+
@Override
public long getGroupId() {
return \_groupId;
@@ -810,6 +820,11 @@ public boolean isFinderCacheEnabled() {
public void resetOriginalValues() {
KaleoInstanceModelImpl kaleoInstanceModelImpl = this;
+ kaleoInstanceModelImpl.\_originalKaleoInstanceId =
+ kaleoInstanceModelImpl.\_kaleoInstanceId;
+
+ kaleoInstanceModelImpl.\_setOriginalKaleoInstanceId = false;
+
kaleoInstanceModelImpl.\_originalCompanyId =
kaleoInstanceModelImpl.\_companyId;
@@ -1021,6 +1036,8 @@ private static class EscapedModelProxyProviderFunctionHolder {
private long \_mvccVersion;
private long \_kaleoInstanceId;
+ private long \_originalKaleoInstanceId;
+ private boolean \_setOriginalKaleoInstanceId;
private long \_groupId;
private long \_companyId;
private long \_originalCompanyId;
diff --git a/modules/apps/portal-workflow/portal-workflow-kaleo-service/src/main/java/com/liferay/portal/workflow/kaleo/service/impl/KaleoInstanceLocalServiceImpl.java b/modules/apps/portal-workflow/portal-workflow-kaleo-service/src/main/java/com/liferay/portal/workflow/kaleo/service/impl/KaleoInstanceLocalServiceImpl.java
index 476b91b1da54a8..fce18ac9908445 100644
--- a/modules/apps/portal-workflow/portal-workflow-kaleo-service/src/main/java/com/liferay/portal/workflow/kaleo/service/impl/KaleoInstanceLocalServiceImpl.java
+++ b/modules/apps/portal-workflow/portal-workflow-kaleo-service/src/main/java/com/liferay/portal/workflow/kaleo/service/impl/KaleoInstanceLocalServiceImpl.java
@@ -240,6 +240,14 @@ public KaleoInstance deleteKaleoInstance(long kaleoInstanceId) {
return kaleoInstance;
}
+ @Override
+ public KaleoInstance fetchKaleoInstance(
+ long kaleoInstanceId, long companyId, long userId) {
+
+ return kaleoInstancePersistence.fetchByKII\_C\_U(
+ kaleoInstanceId, companyId, userId);
+ }
+
@Override
public List getKaleoInstances(
Long userId, String assetClassName, Long assetClassPK,
diff --git a/modules/apps/portal-workflow/portal-workflow-kaleo-service/src/main/java/com/liferay/portal/workflow/kaleo/service/persistence/impl/KaleoInstancePersistenceImpl.java b/modules/apps/portal-workflow/portal-workflow-kaleo-service/src/main/java/com/liferay/portal/workflow/kaleo/service/persistence/impl/KaleoInstancePersistenceImpl.java
index a989dea224e251..a611f6f2c8a60d 100644
--- a/modules/apps/portal-workflow/portal-workflow-kaleo-service/src/main/java/com/liferay/portal/workflow/kaleo/service/persistence/impl/KaleoInstancePersistenceImpl.java
+++ b/modules/apps/portal-workflow/portal-workflow-kaleo-service/src/main/java/com/liferay/portal/workflow/kaleo/service/persistence/impl/KaleoInstancePersistenceImpl.java
@@ -33,6 +33,7 @@
import com.liferay.portal.kernel.util.GetterUtil;
import com.liferay.portal.kernel.util.OrderByComparator;
import com.liferay.portal.kernel.util.ProxyUtil;
+import com.liferay.portal.kernel.util.StringUtil;
import com.liferay.portal.workflow.kaleo.exception.NoSuchInstanceException;
import com.liferay.portal.workflow.kaleo.model.KaleoInstance;
import com.liferay.portal.workflow.kaleo.model.impl.KaleoInstanceImpl;
@@ -46,6 +47,7 @@
import java.sql.Timestamp;
+import java.util.Collections;
import java.util.Date;
import java.util.List;
import java.util.Map;
@@ -2814,6 +2816,278 @@ public int countByCN\_CPK(String className, long classPK) {
private static final String \_FINDER\_COLUMN\_CN\_CPK\_CLASSPK\_2 =
"kaleoInstance.classPK = ?";
+ private FinderPath \_finderPathFetchByKII\_C\_U;
+ private FinderPath \_finderPathCountByKII\_C\_U;
+
+ /\*\*
+ \* Returns the kaleo instance where kaleoInstanceId = ? and companyId = ? and userId = ? or throws a `NoSuchInstanceException` if it could not be found.
+ \*
+ \* @param kaleoInstanceId the kaleo instance ID
+ \* @param companyId the company ID
+ \* @param userId the user ID
+ \* @return the matching kaleo instance
+ \* @throws NoSuchInstanceException if a matching kaleo instance could not be found
+ \*/
+ @Override
+ public KaleoInstance findByKII\_C\_U(
+ long kaleoInstanceId, long companyId, long userId)
+ throws NoSuchInstanceException {
+
+ KaleoInstance kaleoInstance = fetchByKII\_C\_U(
+ kaleoInstanceId, companyId, userId);
+
+ if (kaleoInstance == null) {
+ StringBundler msg = new StringBundler(8);
+
+ msg.append(\_NO\_SUCH\_ENTITY\_WITH\_KEY);
+
+ msg.append("kaleoInstanceId=");
+ msg.append(kaleoInstanceId);
+
+ msg.append(", companyId=");
+ msg.append(companyId);
+
+ msg.append(", userId=");
+ msg.append(userId);
+
+ msg.append("}");
+
+ if (\_log.isDebugEnabled()) {
+ \_log.debug(msg.toString());
+ }
+
+ throw new NoSuchInstanceException(msg.toString());
+ }
+
+ return kaleoInstance;
+ }
+
+ /\*\*
+ \* Returns the kaleo instance where kaleoInstanceId = ? and companyId = ? and userId = ? or returns `null` if it could not be found. Uses the finder cache.
+ \*
+ \* @param kaleoInstanceId the kaleo instance ID
+ \* @param companyId the company ID
+ \* @param userId the user ID
+ \* @return the matching kaleo instance, or `null` if a matching kaleo instance could not be found
+ \*/
+ @Override
+ public KaleoInstance fetchByKII\_C\_U(
+ long kaleoInstanceId, long companyId, long userId) {
+
+ return fetchByKII\_C\_U(kaleoInstanceId, companyId, userId, true);
+ }
+
+ /\*\*
+ \* Returns the kaleo instance where kaleoInstanceId = ? and companyId = ? and userId = ? or returns `null` if it could not be found, optionally using the finder cache.
+ \*
+ \* @param kaleoInstanceId the kaleo instance ID
+ \* @param companyId the company ID
+ \* @param userId the user ID
+ \* @param useFinderCache whether to use the finder cache
+ \* @return the matching kaleo instance, or `null` if a matching kaleo instance could not be found
+ \*/
+ @Override
+ public KaleoInstance fetchByKII\_C\_U(
+ long kaleoInstanceId, long companyId, long userId,
+ boolean useFinderCache) {
+
+ Object[] finderArgs = null;
+
+ if (useFinderCache) {
+ finderArgs = new Object[] {kaleoInstanceId, companyId, userId};
+ }
+
+ Object result = null;
+
+ if (useFinderCache) {
+ result = finderCache.getResult(
+ \_finderPathFetchByKII\_C\_U, finderArgs, this);
+ }
+
+ if (result instanceof KaleoInstance) {
+ KaleoInstance kaleoInstance = (KaleoInstance)result;
+
+ if ((kaleoInstanceId != kaleoInstance.getKaleoInstanceId()) ||
+ (companyId != kaleoInstance.getCompanyId()) ||
+ (userId != kaleoInstance.getUserId())) {
+
+ result = null;
+ }
+ }
+
+ if (result == null) {
+ StringBundler query = new StringBundler(5);
+
+ query.append(\_SQL\_SELECT\_KALEOINSTANCE\_WHERE);
+
+ query.append(\_FINDER\_COLUMN\_KII\_C\_U\_KALEOINSTANCEID\_2);
+
+ query.append(\_FINDER\_COLUMN\_KII\_C\_U\_COMPANYID\_2);
+
+ query.append(\_FINDER\_COLUMN\_KII\_C\_U\_USERID\_2);
+
+ String sql = query.toString();
+
+ Session session = null;
+
+ try {
+ session = openSession();
+
+ Query q = session.createQuery(sql);
+
+ QueryPos qPos = QueryPos.getInstance(q);
+
+ qPos.add(kaleoInstanceId);
+
+ qPos.add(companyId);
+
+ qPos.add(userId);
+
+ List list = q.list();
+
+ if (list.isEmpty()) {
+ if (useFinderCache) {
+ finderCache.putResult(
+ \_finderPathFetchByKII\_C\_U, finderArgs, list);
+ }
+ }
+ else {
+ if (list.size() > 1) {
+ Collections.sort(list, Collections.reverseOrder());
+
+ if (\_log.isWarnEnabled()) {
+ if (!useFinderCache) {
+ finderArgs = new Object[] {
+ kaleoInstanceId, companyId, userId
+ };
+ }
+
+ \_log.warn(
+ "KaleoInstancePersistenceImpl.fetchByKII\_C\_U(long, long, long, boolean) with parameters (" +
+ StringUtil.merge(finderArgs) +
+ ") yields a result set with more than 1 result. This violates the logical unique restriction. There is no order guarantee on which result is returned by this finder.");
+ }
+ }
+
+ KaleoInstance kaleoInstance = list.get(0);
+
+ result = kaleoInstance;
+
+ cacheResult(kaleoInstance);
+ }
+ }
+ catch (Exception e) {
+ if (useFinderCache) {
+ finderCache.removeResult(
+ \_finderPathFetchByKII\_C\_U, finderArgs);
+ }
+
+ throw processException(e);
+ }
+ finally {
+ closeSession(session);
+ }
+ }
+
+ if (result instanceof List ) {
+ return null;
+ }
+ else {
+ return (KaleoInstance)result;
+ }
+ }
+
+ /\*\*
+ \* Removes the kaleo instance where kaleoInstanceId = ? and companyId = ? and userId = ? from the database.
+ \*
+ \* @param kaleoInstanceId the kaleo instance ID
+ \* @param companyId the company ID
+ \* @param userId the user ID
+ \* @return the kaleo instance that was removed
+ \*/
+ @Override
+ public KaleoInstance removeByKII\_C\_U(
+ long kaleoInstanceId, long companyId, long userId)
+ throws NoSuchInstanceException {
+
+ KaleoInstance kaleoInstance = findByKII\_C\_U(
+ kaleoInstanceId, companyId, userId);
+
+ return remove(kaleoInstance);
+ }
+
+ /\*\*
+ \* Returns the number of kaleo instances where kaleoInstanceId = ? and companyId = ? and userId = ?.
+ \*
+ \* @param kaleoInstanceId the kaleo instance ID
+ \* @param companyId the company ID
+ \* @param userId the user ID
+ \* @return the number of matching kaleo instances
+ \*/
+ @Override
+ public int countByKII\_C\_U(
+ long kaleoInstanceId, long companyId, long userId) {
+
+ FinderPath finderPath = \_finderPathCountByKII\_C\_U;
+
+ Object[] finderArgs = new Object[] {kaleoInstanceId, companyId, userId};
+
+ Long count = (Long)finderCache.getResult(finderPath, finderArgs, this);
+
+ if (count == null) {
+ StringBundler query = new StringBundler(4);
+
+ query.append(\_SQL\_COUNT\_KALEOINSTANCE\_WHERE);
+
+ query.append(\_FINDER\_COLUMN\_KII\_C\_U\_KALEOINSTANCEID\_2);
+
+ query.append(\_FINDER\_COLUMN\_KII\_C\_U\_COMPANYID\_2);
+
+ query.append(\_FINDER\_COLUMN\_KII\_C\_U\_USERID\_2);
+
+ String sql = query.toString();
+
+ Session session = null;
+
+ try {
+ session = openSession();
+
+ Query q = session.createQuery(sql);
+
+ QueryPos qPos = QueryPos.getInstance(q);
+
+ qPos.add(kaleoInstanceId);
+
+ qPos.add(companyId);
+
+ qPos.add(userId);
+
+ count = (Long)q.uniqueResult();
+
+ finderCache.putResult(finderPath, finderArgs, count);
+ }
+ catch (Exception e) {
+ finderCache.removeResult(finderPath, finderArgs);
+
+ throw processException(e);
+ }
+ finally {
+ closeSession(session);
+ }
+ }
+
+ return count.intValue();
+ }
+
+ private static final String \_FINDER\_COLUMN\_KII\_C\_U\_KALEOINSTANCEID\_2 =
+ "kaleoInstance.kaleoInstanceId = ? AND ";
+
+ private static final String \_FINDER\_COLUMN\_KII\_C\_U\_COMPANYID\_2 =
+ "kaleoInstance.companyId = ? AND ";
+
+ private static final String \_FINDER\_COLUMN\_KII\_C\_U\_USERID\_2 =
+ "kaleoInstance.userId = ?";
+
private FinderPath \_finderPathWithPaginationFindByC\_KDN\_KDV\_CD;
private FinderPath \_finderPathWithoutPaginationFindByC\_KDN\_KDV\_CD;
private FinderPath \_finderPathCountByC\_KDN\_KDV\_CD;
@@ -3567,6 +3841,14 @@ public void cacheResult(KaleoInstance kaleoInstance) {
entityCacheEnabled, KaleoInstanceImpl.class,
kaleoInstance.getPrimaryKey(), kaleoInstance);
+ finderCache.putResult(
+ \_finderPathFetchByKII\_C\_U,
+ new Object[] {
+ kaleoInstance.getKaleoInstanceId(),
+ kaleoInstance.getCompanyId(), kaleoInstance.getUserId()
+ },
+ kaleoInstance);
+
kaleoInstance.resetOriginalValues();
}
@@ -3621,6 +3903,8 @@ public void clearCache(KaleoInstance kaleoInstance) {
finderCache.clearCache(FINDER\_CLASS\_NAME\_LIST\_WITH\_PAGINATION);
finderCache.clearCache(FINDER\_CLASS\_NAME\_LIST\_WITHOUT\_PAGINATION);
+
+ clearUniqueFindersCache((KaleoInstanceModelImpl)kaleoInstance, true);
}
@Override
@@ -3632,6 +3916,52 @@ public void clearCache(List kaleoInstances) {
entityCache.removeResult(
entityCacheEnabled, KaleoInstanceImpl.class,
kaleoInstance.getPrimaryKey());
+
+ clearUniqueFindersCache(
+ (KaleoInstanceModelImpl)kaleoInstance, true);
+ }
+ }
+
+ protected void cacheUniqueFindersCache(
+ KaleoInstanceModelImpl kaleoInstanceModelImpl) {
+
+ Object[] args = new Object[] {
+ kaleoInstanceModelImpl.getKaleoInstanceId(),
+ kaleoInstanceModelImpl.getCompanyId(),
+ kaleoInstanceModelImpl.getUserId()
+ };
+
+ finderCache.putResult(
+ \_finderPathCountByKII\_C\_U, args, Long.valueOf(1), false);
+ finderCache.putResult(
+ \_finderPathFetchByKII\_C\_U, args, kaleoInstanceModelImpl, false);
+ }
+
+ protected void clearUniqueFindersCache(
+ KaleoInstanceModelImpl kaleoInstanceModelImpl, boolean clearCurrent) {
+
+ if (clearCurrent) {
+ Object[] args = new Object[] {
+ kaleoInstanceModelImpl.getKaleoInstanceId(),
+ kaleoInstanceModelImpl.getCompanyId(),
+ kaleoInstanceModelImpl.getUserId()
+ };
+
+ finderCache.removeResult(\_finderPathCountByKII\_C\_U, args);
+ finderCache.removeResult(\_finderPathFetchByKII\_C\_U, args);
+ }
+
+ if ((kaleoInstanceModelImpl.getColumnBitmask() &
+ \_finderPathFetchByKII\_C\_U.getColumnBitmask()) != 0) {
+
+ Object[] args = new Object[] {
+ kaleoInstanceModelImpl.getOriginalKaleoInstanceId(),
+ kaleoInstanceModelImpl.getOriginalCompanyId(),
+ kaleoInstanceModelImpl.getOriginalUserId()
+ };
+
+ finderCache.removeResult(\_finderPathCountByKII\_C\_U, args);
+ finderCache.removeResult(\_finderPathFetchByKII\_C\_U, args);
}
}
@@ -4020,6 +4350,9 @@ else if (isNew) {
entityCacheEnabled, KaleoInstanceImpl.class,
kaleoInstance.getPrimaryKey(), kaleoInstance, false);
+ clearUniqueFindersCache(kaleoInstanceModelImpl, false);
+ cacheUniqueFindersCache(kaleoInstanceModelImpl);
+
kaleoInstance.resetOriginalValues();
return kaleoInstance;
@@ -4410,6 +4743,23 @@ public void activate() {
FINDER\_CLASS\_NAME\_LIST\_WITHOUT\_PAGINATION, "countByCN\_CPK",
new String[] {String.class.getName(), Long.class.getName()});
+ \_finderPathFetchByKII\_C\_U = new FinderPath(
+ entityCacheEnabled, finderCacheEnabled, KaleoInstanceImpl.class,
+ FINDER\_CLASS\_NAME\_ENTITY, "fetchByKII\_C\_U",
+ new String[] {
+ Long.class.getName(), Long.class.getName(), Long.class.getName()
+ },
+ KaleoInstanceModelImpl.KALEOINSTANCEID\_COLUMN\_BITMASK |
+ KaleoInstanceModelImpl.COMPANYID\_COLUMN\_BITMASK |
+ KaleoInstanceModelImpl.USERID\_COLUMN\_BITMASK);
+
+ \_finderPathCountByKII\_C\_U = new FinderPath(
+ entityCacheEnabled, finderCacheEnabled, Long.class,
+ FINDER\_CLASS\_NAME\_LIST\_WITHOUT\_PAGINATION, "countByKII\_C\_U",
+ new String[] {
+ Long.class.getName(), Long.class.getName(), Long.class.getName()
+ });
+
\_finderPathWithPaginationFindByC\_KDN\_KDV\_CD = new FinderPath(
entityCacheEnabled, finderCacheEnabled, KaleoInstanceImpl.class,
FINDER\_CLASS\_NAME\_LIST\_WITH\_PAGINATION, "findByC\_KDN\_KDV\_CD",
diff --git a/modules/apps/portal-workflow/portal-workflow-kaleo-service/src/main/resources/META-INF/sql/indexes.sql b/modules/apps/portal-workflow/portal-workflow-kaleo-service/src/main/resources/META-INF/sql/indexes.sql
index ce9e18efaedd73..1ffb79a5bd8d00 100644
--- a/modules/apps/portal-workflow/portal-workflow-kaleo-service/src/main/resources/META-INF/sql/indexes.sql
+++ b/modules/apps/portal-workflow/portal-workflow-kaleo-service/src/main/resources/META-INF/sql/indexes.sql
@@ -16,6 +16,7 @@ create index IX\_58D85ECB on KaleoInstance (className[$COLUMN\_LENGTH:200$], class
create index IX\_BF5839F8 on KaleoInstance (companyId, kaleoDefinitionName[$COLUMN\_LENGTH:200$], kaleoDefinitionVersion, completionDate);
create index IX\_C6D7A867 on KaleoInstance (companyId, userId);
create index IX\_3DA1A5AC on KaleoInstance (kaleoDefinitionVersionId, completed);
+create index IX\_6D12641D on KaleoInstance (kaleoInstanceId, companyId, userId);
create index IX\_360D34D9 on KaleoInstanceToken (companyId, parentKaleoInstanceTokenId, completionDate);
create index IX\_1181057E on KaleoInstanceToken (kaleoDefinitionVersionId);
diff --git a/modules/apps/portal-workflow/portal-workflow-kaleo-test/src/testIntegration/java/com/liferay/portal/workflow/kaleo/service/persistence/test/KaleoInstancePersistenceTest.java b/modules/apps/portal-workflow/portal-workflow-kaleo-test/src/testIntegration/java/com/liferay/portal/workflow/kaleo/service/persistence/test/KaleoInstancePersistenceTest.java
index 04c97f39fdf79d..f6c1ab4c86205e 100644
--- a/modules/apps/portal-workflow/portal-workflow-kaleo-test/src/testIntegration/java/com/liferay/portal/workflow/kaleo/service/persistence/test/KaleoInstancePersistenceTest.java
+++ b/modules/apps/portal-workflow/portal-workflow-kaleo-test/src/testIntegration/java/com/liferay/portal/workflow/kaleo/service/persistence/test/KaleoInstancePersistenceTest.java
@@ -21,6 +21,7 @@
import com.liferay.portal.kernel.dao.orm.ProjectionFactoryUtil;
import com.liferay.portal.kernel.dao.orm.QueryUtil;
import com.liferay.portal.kernel.dao.orm.RestrictionsFactoryUtil;
+import com.liferay.portal.kernel.test.ReflectionTestUtil;
import com.liferay.portal.kernel.test.rule.AggregateTestRule;
import com.liferay.portal.kernel.test.util.RandomTestUtil;
import com.liferay.portal.kernel.transaction.Propagation;
@@ -249,6 +250,15 @@ public void testCountByCN\_CPK() throws Exception {
\_persistence.countByCN\_CPK((String)null, 0L);
}
+ @Test
+ public void testCountByKII\_C\_U() throws Exception {
+ \_persistence.countByKII\_C\_U(
+ RandomTestUtil.nextLong(), RandomTestUtil.nextLong(),
+ RandomTestUtil.nextLong());
+
+ \_persistence.countByKII\_C\_U(0L, 0L, 0L);
+ }
+
@Test
public void testCountByC\_KDN\_KDV\_CD() throws Exception {
\_persistence.countByC\_KDN\_KDV\_CD(
@@ -509,6 +519,31 @@ public void testDynamicQueryByProjectionMissing() throws Exception {
Assert.assertEquals(0, result.size());
}
+ @Test
+ public void testResetOriginalValues() throws Exception {
+ KaleoInstance newKaleoInstance = addKaleoInstance();
+
+ \_persistence.clearCache();
+
+ KaleoInstance existingKaleoInstance = \_persistence.findByPrimaryKey(
+ newKaleoInstance.getPrimaryKey());
+
+ Assert.assertEquals(
+ Long.valueOf(existingKaleoInstance.getKaleoInstanceId()),
+ ReflectionTestUtil.invoke(
+ existingKaleoInstance, "getOriginalKaleoInstanceId",
+ new Class [0]));
+ Assert.assertEquals(
+ Long.valueOf(existingKaleoInstance.getCompanyId()),
+ ReflectionTestUtil.invoke(
+ existingKaleoInstance, "getOriginalCompanyId",
+ new Class [0]));
+ Assert.assertEquals(
+ Long.valueOf(existingKaleoInstance.getUserId()),
+ ReflectionTestUtil.invoke(
+ existingKaleoInstance, "getOriginalUserId", new Class [0]));
+ }
+
protected KaleoInstance addKaleoInstance() throws Exception {
long pk = RandomTestUtil.nextLong();
diff --git a/modules/apps/portal-workflow/portal-workflow-task-web/build.gradle b/modules/apps/portal-workflow/portal-workflow-task-web/build.gradle
index c8375fb82ea6ba..3fcbb14377ce14 100644
--- a/modules/apps/portal-workflow/portal-workflow-task-web/build.gradle
+++ b/modules/apps/portal-workflow/portal-workflow-task-web/build.gradle
@@ -20,8 +20,8 @@ dependencies {
compileOnly group: "com.liferay", name: "com.liferay.portal.configuration.metatype.api", version: "2.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.workflow.api", version: "5.0.0"
compileOnly group: "com.liferay", name: "com.liferay.product.navigation.personal.menu.api", version: "1.0.0"
- compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "4.0.0"
- compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "4.34.0"
+ compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "default"
+ compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "default"
compileOnly group: "com.liferay.portal", name: "com.liferay.util.taglib", version: "4.0.0"
compileOnly group: "javax.portlet", name: "portlet-api", version: "3.0.1"
compileOnly group: "javax.servlet.jsp", name: "javax.servlet.jsp-api", version: "2.3.1"
diff --git a/modules/apps/portal-workflow/portal-workflow-task-web/src/main/java/com/liferay/portal/workflow/task/web/internal/permission/WorkflowTaskPermissionChecker.java b/modules/apps/portal-workflow/portal-workflow-task-web/src/main/java/com/liferay/portal/workflow/task/web/internal/permission/WorkflowTaskPermissionChecker.java
index 2cd7a07ff34200..db40103a95e91c 100644
--- a/modules/apps/portal-workflow/portal-workflow-task-web/src/main/java/com/liferay/portal/workflow/task/web/internal/permission/WorkflowTaskPermissionChecker.java
+++ b/modules/apps/portal-workflow/portal-workflow-task-web/src/main/java/com/liferay/portal/workflow/task/web/internal/permission/WorkflowTaskPermissionChecker.java
@@ -22,11 +22,16 @@
import com.liferay.portal.kernel.model.Organization;
import com.liferay.portal.kernel.model.Role;
import com.liferay.portal.kernel.model.User;
+import com.liferay.portal.kernel.security.auth.PrincipalException;
+import com.liferay.portal.kernel.security.permission.ActionKeys;
import com.liferay.portal.kernel.security.permission.PermissionChecker;
import com.liferay.portal.kernel.service.GroupLocalServiceUtil;
import com.liferay.portal.kernel.service.OrganizationLocalServiceUtil;
+import com.liferay.portal.kernel.service.UserNotificationEventLocalServiceUtil;
import com.liferay.portal.kernel.util.ArrayUtil;
+import com.liferay.portal.kernel.util.HashMapBuilder;
import com.liferay.portal.kernel.util.MapUtil;
+import com.liferay.portal.kernel.util.PortletKeys;
import com.liferay.portal.kernel.workflow.WorkflowConstants;
import com.liferay.portal.kernel.workflow.WorkflowHandler;
import com.liferay.portal.kernel.workflow.WorkflowHandlerRegistryUtil;
@@ -44,14 +49,42 @@
\*/
public class WorkflowTaskPermissionChecker {
+ public void check(
+ long groupId, WorkflowTask workflowTask,
+ PermissionChecker permissionChecker)
+ throws PortalException {
+
+ if (!hasPermission(groupId, workflowTask, permissionChecker)) {
+ throw new PrincipalException.MustHavePermission(
+ permissionChecker, WorkflowTask.class.getName(),
+ workflowTask.getWorkflowTaskId(), ActionKeys.VIEW);
+ }
+ }
+
public boolean hasPermission(
long groupId, WorkflowTask workflowTask,
PermissionChecker permissionChecker) {
if (permissionChecker.isOmniadmin() ||
- permissionChecker.isCompanyAdmin() ||
- (workflowTask.isCompleted() &&
- hasAssetViewPermission(workflowTask, permissionChecker))) {
+ permissionChecker.isCompanyAdmin()) {
+
+ return true;
+ }
+
+ int userNotificationEventsCount =
+ UserNotificationEventLocalServiceUtil.
+ getUserNotificationEventsCount(
+ permissionChecker.getUserId(), PortletKeys.MY\_WORKFLOW\_TASK,
+ HashMapBuilder.put(
+ "workflowInstanceId",
+ String.valueOf(workflowTask.getWorkflowInstanceId())
+ ).put(
+ "workflowTaskId",
+ String.valueOf(workflowTask.getWorkflowTaskId())
+ ).build());
+
+ if (hasAssetViewPermission(workflowTask, permissionChecker) &&
+ ((userNotificationEventsCount > 0) || workflowTask.isCompleted())) {
return true;
}
diff --git a/modules/apps/portal-workflow/portal-workflow-task-web/src/main/java/com/liferay/portal/workflow/task/web/internal/portlet/MyWorkflowTaskPortlet.java b/modules/apps/portal-workflow/portal-workflow-task-web/src/main/java/com/liferay/portal/workflow/task/web/internal/portlet/MyWorkflowTaskPortlet.java
index 01cb9595cd33e9..69e11167129570 100644
--- a/modules/apps/portal-workflow/portal-workflow-task-web/src/main/java/com/liferay/portal/workflow/task/web/internal/portlet/MyWorkflowTaskPortlet.java
+++ b/modules/apps/portal-workflow/portal-workflow-task-web/src/main/java/com/liferay/portal/workflow/task/web/internal/portlet/MyWorkflowTaskPortlet.java
@@ -127,15 +127,8 @@ protected void checkWorkflowTaskViewPermission(
workflowTask.getOptionalAttributes(), "groupId",
themeDisplay.getSiteGroupId());
- if (!\_workflowTaskPermissionChecker.hasPermission(
- groupId, workflowTask, themeDisplay.getPermissionChecker())) {
-
- throw new PrincipalException(
- String.format(
- "User %d does not have permission to view task %d",
- themeDisplay.getUserId(),
- workflowTask.getWorkflowTaskId()));
- }
+ \_workflowTaskPermissionChecker.check(
+ groupId, workflowTask, themeDisplay.getPermissionChecker());
}
@Override
diff --git a/modules/apps/portal-workflow/portal-workflow-task-web/src/main/java/com/liferay/portal/workflow/task/web/internal/portlet/action/AssignTaskMVCResourceCommand.java b/modules/apps/portal-workflow/portal-workflow-task-web/src/main/java/com/liferay/portal/workflow/task/web/internal/portlet/action/AssignTaskMVCResourceCommand.java
index f8c7d7cc5774a9..353e7554625361 100644
--- a/modules/apps/portal-workflow/portal-workflow-task-web/src/main/java/com/liferay/portal/workflow/task/web/internal/portlet/action/AssignTaskMVCResourceCommand.java
+++ b/modules/apps/portal-workflow/portal-workflow-task-web/src/main/java/com/liferay/portal/workflow/task/web/internal/portlet/action/AssignTaskMVCResourceCommand.java
@@ -16,7 +16,6 @@
import com.liferay.portal.kernel.portlet.bridges.mvc.BaseMVCResourceCommand;
import com.liferay.portal.kernel.portlet.bridges.mvc.MVCResourceCommand;
-import com.liferay.portal.kernel.security.auth.PrincipalException;
import com.liferay.portal.kernel.servlet.SessionMessages;
import com.liferay.portal.kernel.theme.ThemeDisplay;
import com.liferay.portal.kernel.util.MapUtil;
@@ -57,14 +56,8 @@ protected void checkWorkflowTaskAssignmentPermission(
workflowTask.getOptionalAttributes(), "groupId",
themeDisplay.getSiteGroupId());
- if (!\_workflowTaskPermissionChecker.hasPermission(
- groupId, workflowTask, themeDisplay.getPermissionChecker())) {
-
- throw new PrincipalException(
- String.format(
- "User %d does not have permission to assign task %d",
- themeDisplay.getUserId(), workflowTaskId));
- }
+ \_workflowTaskPermissionChecker.check(
+ groupId, workflowTask, themeDisplay.getPermissionChecker());
}
@Override
diff --git a/modules/apps/portal-workflow/portal-workflow-task-web/src/main/java/com/liferay/portal/workflow/task/web/internal/portlet/action/WorkflowTaskBaseMVCActionCommand.java b/modules/apps/portal-workflow/portal-workflow-task-web/src/main/java/com/liferay/portal/workflow/task/web/internal/portlet/action/WorkflowTaskBaseMVCActionCommand.java
index 6538c02a975dd5..555c72f9e4ae1b 100644
--- a/modules/apps/portal-workflow/portal-workflow-task-web/src/main/java/com/liferay/portal/workflow/task/web/internal/portlet/action/WorkflowTaskBaseMVCActionCommand.java
+++ b/modules/apps/portal-workflow/portal-workflow-task-web/src/main/java/com/liferay/portal/workflow/task/web/internal/portlet/action/WorkflowTaskBaseMVCActionCommand.java
@@ -74,7 +74,11 @@ protected void setRedirectAttribute(ActionRequest actionRequest) {
closeRedirect);
}
- actionRequest.setAttribute(WebKeys.REDIRECT, redirect);
+ redirect = PortalUtil.escapeRedirect(redirect);
+
+ if (Validator.isNotNull(redirect)) {
+ actionRequest.setAttribute(WebKeys.REDIRECT, redirect);
+ }
}
}
\ No newline at end of file
diff --git a/modules/apps/portal-workflow/portal-workflow-task-web/src/main/resources/META-INF/resources/init.jsp b/modules/apps/portal-workflow/portal-workflow-task-web/src/main/resources/META-INF/resources/init.jsp
index d3eb98c7d47ec8..921a36975f21d8 100644
--- a/modules/apps/portal-workflow/portal-workflow-task-web/src/main/resources/META-INF/resources/init.jsp
+++ b/modules/apps/portal-workflow/portal-workflow-task-web/src/main/resources/META-INF/resources/init.jsp
@@ -39,6 +39,7 @@ page import="com.liferay.portal.kernel.portlet.LiferayWindowState" %><%@
page import="com.liferay.portal.kernel.util.ArrayUtil" %><%@
page import="com.liferay.portal.kernel.util.HtmlUtil" %><%@
page import="com.liferay.portal.kernel.util.ParamUtil" %><%@
+page import="com.liferay.portal.kernel.util.PortalUtil" %><%@
page import="com.liferay.portal.kernel.util.PortletKeys" %><%@
page import="com.liferay.portal.kernel.util.StringUtil" %><%@
page import="com.liferay.portal.kernel.util.Validator" %><%@
diff --git a/modules/apps/portal-workflow/portal-workflow-task-web/src/main/resources/META-INF/resources/workflow\_task\_assign.jsp b/modules/apps/portal-workflow/portal-workflow-task-web/src/main/resources/META-INF/resources/workflow\_task\_assign.jsp
index 3ad1ad32b53ae6..aabd006d46230b 100644
--- a/modules/apps/portal-workflow/portal-workflow-task-web/src/main/resources/META-INF/resources/workflow\_task\_assign.jsp
+++ b/modules/apps/portal-workflow/portal-workflow-task-web/src/main/resources/META-INF/resources/workflow\_task\_assign.jsp
@@ -85,7 +85,7 @@ String redirect = ParamUtil.getString(request, "redirect");
method: 'POST'
}).then(function() {
Liferay.Util.getOpener().refreshPortlet(
- '<%= redirect.toString() %>'
+ '<%= PortalUtil.escapeRedirect(redirect.toString()) %>'
);
Liferay.Util.getWindow(
'assignToDialog'
diff --git a/modules/apps/portal-workflow/portal-workflow-web/build.gradle b/modules/apps/portal-workflow/portal-workflow-web/build.gradle
index 52e1357fa0d24e..9f6ebef637bc58 100644
--- a/modules/apps/portal-workflow/portal-workflow-web/build.gradle
+++ b/modules/apps/portal-workflow/portal-workflow-web/build.gradle
@@ -13,8 +13,8 @@ dependencies {
compileOnly group: "com.liferay", name: "com.liferay.portal.configuration.metatype.api", version: "2.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.workflow.api", version: "5.1.0"
compileOnly group: "com.liferay", name: "com.liferay.product.navigation.personal.menu.api", version: "1.0.0"
- compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "4.0.0"
- compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "4.34.0"
+ compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "default"
+ compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "default"
compileOnly group: "com.liferay.portal", name: "com.liferay.util.taglib", version: "4.0.0"
compileOnly group: "javax.portlet", name: "portlet-api", version: "3.0.1"
compileOnly group: "javax.servlet.jsp", name: "javax.servlet.jsp-api", version: "2.3.1"
diff --git a/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/display/context/WorkflowInstanceEditDisplayContext.java b/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/display/context/WorkflowInstanceEditDisplayContext.java
index 6558bab84abf41..4189f882c9a378 100644
--- a/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/display/context/WorkflowInstanceEditDisplayContext.java
+++ b/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/display/context/WorkflowInstanceEditDisplayContext.java
@@ -128,9 +128,8 @@ public Object getAssignedTheTaskToMessageArguments(WorkflowLog workflowLog)
}
public String getHeaderTitle() throws PortalException {
- return LanguageUtil.get(
- workflowInstanceRequestHelper.getRequest(),
- getWorkflowDefinitionName());
+ return getWorkflowDefinitionName() + ": " +
+ getTaskContentTitleMessage();
}
public String getIconCssClass() {
diff --git a/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/portlet/UserWorkflowPortlet.java b/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/portlet/UserWorkflowPortlet.java
index e208e9623a2f25..1f867ee53fd16d 100644
--- a/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/portlet/UserWorkflowPortlet.java
+++ b/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/portlet/UserWorkflowPortlet.java
@@ -14,16 +14,30 @@
package com.liferay.portal.workflow.web.internal.portlet;
+import com.liferay.portal.kernel.exception.PortalException;
+import com.liferay.portal.kernel.security.auth.PrincipalException;
+import com.liferay.portal.kernel.security.permission.ActionKeys;
+import com.liferay.portal.kernel.security.permission.PermissionChecker;
+import com.liferay.portal.kernel.security.permission.PermissionThreadLocal;
+import com.liferay.portal.kernel.servlet.SessionErrors;
+import com.liferay.portal.kernel.util.ParamUtil;
import com.liferay.portal.kernel.util.ResourceBundleLoader;
+import com.liferay.portal.kernel.workflow.WorkflowException;
+import com.liferay.portal.kernel.workflow.WorkflowInstance;
+import com.liferay.portal.kernel.workflow.WorkflowInstanceManagerUtil;
import com.liferay.portal.workflow.constants.WorkflowWebKeys;
import com.liferay.portal.workflow.web.internal.constants.WorkflowPortletKeys;
import com.liferay.portal.workflow.web.internal.display.context.WorkflowNavigationDisplayContext;
+import java.io.IOException;
+
import java.util.Arrays;
import java.util.List;
import javax.portlet.Portlet;
+import javax.portlet.PortletException;
import javax.portlet.RenderRequest;
+import javax.portlet.RenderResponse;
import org.osgi.service.component.annotations.Component;
import org.osgi.service.component.annotations.Reference;
@@ -64,6 +78,28 @@ public List getWorkflowPortletTabNames() {
return Arrays.asList(WorkflowWebKeys.WORKFLOW\_TAB\_MY\_SUBMISSIONS);
}
+ @Override
+ public void render(
+ RenderRequest renderRequest, RenderResponse renderResponse)
+ throws IOException, PortletException {
+
+ try {
+ checkWorkflowInstanceViewPermission(renderRequest);
+ }
+ catch (PortalException portalException) {
+ if (portalException instanceof PrincipalException ||
+ portalException instanceof WorkflowException) {
+
+ SessionErrors.add(renderRequest, portalException.getClass());
+ }
+ else {
+ throw new PortletException(portalException);
+ }
+ }
+
+ super.render(renderRequest, renderResponse);
+ }
+
@Override
protected void addRenderRequestAttributes(RenderRequest renderRequest) {
super.addRenderRequestAttributes(renderRequest);
@@ -77,6 +113,47 @@ protected void addRenderRequestAttributes(RenderRequest renderRequest) {
workflowNavigationDisplayContext);
}
+ protected void checkWorkflowInstanceViewPermission(
+ RenderRequest renderRequest)
+ throws PortalException {
+
+ PermissionChecker permissionChecker =
+ PermissionThreadLocal.getPermissionChecker();
+
+ long workflowInstanceId = ParamUtil.getLong(
+ renderRequest, "workflowInstanceId");
+
+ if (workflowInstanceId != 0) {
+ WorkflowInstance workflowInstance =
+ WorkflowInstanceManagerUtil.getWorkflowInstance(
+ permissionChecker.getCompanyId(),
+ permissionChecker.getUserId(), workflowInstanceId);
+
+ if (workflowInstance == null) {
+ throw new PrincipalException.MustHavePermission(
+ permissionChecker, WorkflowInstance.class.getName(),
+ workflowInstanceId, ActionKeys.VIEW);
+ }
+ }
+ }
+
+ @Override
+ protected void doDispatch(
+ RenderRequest renderRequest, RenderResponse renderResponse)
+ throws IOException, PortletException {
+
+ if (SessionErrors.contains(
+ renderRequest, PrincipalException.getNestedClasses()) ||
+ SessionErrors.contains(
+ renderRequest, WorkflowException.class.getName())) {
+
+ include("/instance/error.jsp", renderRequest, renderResponse);
+ }
+ else {
+ super.doDispatch(renderRequest, renderResponse);
+ }
+ }
+
@Reference(
policy = ReferencePolicy.DYNAMIC,
policyOption = ReferencePolicyOption.GREEDY,
diff --git a/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/portlet/action/DeleteWorkflowInstanceMVCActionCommand.java b/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/portlet/action/DeleteWorkflowInstanceMVCActionCommand.java
index 358d1fc4c0060a..60cdda78ab1f44 100644
--- a/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/portlet/action/DeleteWorkflowInstanceMVCActionCommand.java
+++ b/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/portlet/action/DeleteWorkflowInstanceMVCActionCommand.java
@@ -111,7 +111,7 @@ protected void doProcessAction(
portletSession.getPortletContext();
PortletRequestDispatcher portletRequestDispatcher =
- portletContext.getRequestDispatcher("/error.jsp");
+ portletContext.getRequestDispatcher("/instance/error.jsp");
portletRequestDispatcher.include(actionRequest, actionResponse);
}
diff --git a/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/portlet/tab/WorkflowInstancePortletTab.java b/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/portlet/tab/WorkflowInstancePortletTab.java
index 22e85c0a896c3e..e1a8e869fbe1b0 100644
--- a/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/portlet/tab/WorkflowInstancePortletTab.java
+++ b/modules/apps/portal-workflow/portal-workflow-web/src/main/java/com/liferay/portal/workflow/web/internal/portlet/tab/WorkflowInstancePortletTab.java
@@ -80,7 +80,8 @@ public void prepareDispatch(
@Override
public void prepareProcessAction(
- ActionRequest actionRequest, ActionResponse actionResponse) {
+ ActionRequest actionRequest, ActionResponse actionResponse)
+ throws PortletException {
String actionName = ParamUtil.getString(
actionRequest, ActionRequest.ACTION\_NAME);
diff --git a/modules/apps/portlet-configuration/portlet-configuration-css-web/src/main/resources/META-INF/resources/advanced\_styling.jsp b/modules/apps/portlet-configuration/portlet-configuration-css-web/src/main/resources/META-INF/resources/advanced\_styling.jsp
index 08fdda012033da..5b41f7ff9c701f 100644
--- a/modules/apps/portlet-configuration/portlet-configuration-css-web/src/main/resources/META-INF/resources/advanced\_styling.jsp
+++ b/modules/apps/portlet-configuration/portlet-configuration-css-web/src/main/resources/META-INF/resources/advanced\_styling.jsp
@@ -22,7 +22,7 @@

- : **#portlet\_<%= portletConfigurationCSSPortletDisplayContext.getPortletResource() %>**
+ : **#portlet\_<%= HtmlUtil.escapeJS(portletConfigurationCSSPortletDisplayContext.getPortletResource()) %>**

@@ -66,7 +66,7 @@
if (addId) {
addId.addEventListener('click', function() {
insertCustomCSSValue(
- '#portlet\_<%= portletConfigurationCSSPortletDisplayContext.getPortletResource() %>'
+ '#portlet\_<%= HtmlUtil.escapeJS(portletConfigurationCSSPortletDisplayContext.getPortletResource()) %>'
);
});
}
@@ -82,7 +82,7 @@
}
var portlet = Liferay.Util.getOpener()[
- 'portlet\_<%= portletConfigurationCSSPortletDisplayContext.getPortletResource() %>'
+ 'portlet\_<%= HtmlUtil.escapeJS(portletConfigurationCSSPortletDisplayContext.getPortletResource()) %>'
];
if (portlet) {
diff --git a/modules/apps/portlet-configuration/portlet-configuration-css-web/src/main/resources/META-INF/resources/init.jsp b/modules/apps/portlet-configuration/portlet-configuration-css-web/src/main/resources/META-INF/resources/init.jsp
index 433ccf34e6dee5..9069248deec540 100644
--- a/modules/apps/portlet-configuration/portlet-configuration-css-web/src/main/resources/META-INF/resources/init.jsp
+++ b/modules/apps/portlet-configuration/portlet-configuration-css-web/src/main/resources/META-INF/resources/init.jsp
@@ -27,6 +27,7 @@ taglib uri="http://liferay.com/tld/util" prefix="liferay-util" %>
<%@ page import="com.liferay.portal.kernel.language.LanguageUtil" %><%@
page import="com.liferay.portal.kernel.model.PortletDecorator" %><%@
+page import="com.liferay.portal.kernel.util.HtmlUtil" %><%@
page import="com.liferay.portal.kernel.util.LocaleUtil" %><%@
page import="com.liferay.portlet.configuration.css.web.internal.constants.PortletConfigurationCSSConstants" %><%@
page import="com.liferay.portlet.configuration.css.web.internal.display.context.PortletConfigurationCSSPortletDisplayContext" %>
diff --git a/modules/apps/portlet-configuration/portlet-configuration-css-web/src/main/resources/META-INF/resources/view.jsp b/modules/apps/portlet-configuration/portlet-configuration-css-web/src/main/resources/META-INF/resources/view.jsp
index 9bca546c336db8..6e2c587571629a 100644
--- a/modules/apps/portlet-configuration/portlet-configuration-css-web/src/main/resources/META-INF/resources/view.jsp
+++ b/modules/apps/portlet-configuration/portlet-configuration-css-web/src/main/resources/META-INF/resources/view.jsp
@@ -28,7 +28,7 @@
name="fm"
>

-
+
(resourceActions);
resourceActions.remove(ActionKeys.ASSIGN\_MEMBERS);
- resourceActions.remove(ActionKeys.DEFINE\_PERMISSIONS);
resourceActions.remove(ActionKeys.DELETE);
- resourceActions.remove(ActionKeys.PERMISSIONS);
resourceActions.remove(ActionKeys.UPDATE);
- resourceActions.remove(ActionKeys.VIEW);
}
}
diff --git a/modules/apps/powwow/powwow-portlet/ivy.xml b/modules/apps/powwow/powwow-portlet/ivy.xml
index d9361e7804c003..9d3ebbcac2bb6f 100644
--- a/modules/apps/powwow/powwow-portlet/ivy.xml
+++ b/modules/apps/powwow/powwow-portlet/ivy.xml
@@ -14,7 +14,7 @@

-
+

diff --git a/modules/apps/segments/segments-content-targeting-upgrade/build.gradle b/modules/apps/segments/segments-content-targeting-upgrade/build.gradle
index 1cf2c666ac6377..f1f1db73f68d45 100644
--- a/modules/apps/segments/segments-content-targeting-upgrade/build.gradle
+++ b/modules/apps/segments/segments-content-targeting-upgrade/build.gradle
@@ -12,8 +12,8 @@ dependencies {
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "4.34.0"
compileOnly group: "javax.portlet", name: "portlet-api", version: "3.0.1"
compileOnly group: "javax.ws.rs", name: "javax.ws.rs-api", version: "2.1"
- compileOnly group: "org.apache.cxf", name: "cxf-rt-rs-client", version: "3.2.5"
- compileOnly group: "org.apache.cxf", name: "cxf-rt-rs-extension-providers", version: "3.2.5"
+ compileOnly group: "org.apache.cxf", name: "cxf-rt-rs-client", version: "3.2.14"
+ compileOnly group: "org.apache.cxf", name: "cxf-rt-rs-extension-providers", version: "3.2.14"
compileOnly group: "org.apache.felix", name: "org.apache.felix.http.servlet-api", version: "1.1.2"
compileOnly group: "org.osgi", name: "org.osgi.service.component", version: "1.3.0"
compileOnly group: "org.osgi", name: "org.osgi.service.component.annotations", version: "1.3.0"
diff --git a/modules/apps/site/site-memberships-web/src/main/resources/META-INF/resources/preview\_membership\_request.jsp b/modules/apps/site/site-memberships-web/src/main/resources/META-INF/resources/preview\_membership\_request.jsp
index 7a4e11843904f2..28da8ced381776 100644
--- a/modules/apps/site/site-memberships-web/src/main/resources/META-INF/resources/preview\_membership\_request.jsp
+++ b/modules/apps/site/site-memberships-web/src/main/resources/META-INF/resources/preview\_membership\_request.jsp
@@ -59,7 +59,7 @@ renderResponse.setTitle(userName);

- <%= membershipRequest.getComments() %>
+ <%= HtmlUtil.escape(membershipRequest.getComments()) %>

@@ -103,7 +103,7 @@ renderResponse.setTitle(userName);

- <%= membershipRequest.getReplyComments() %>
+ <%= HtmlUtil.escape(membershipRequest.getReplyComments()) %>

diff --git a/modules/apps/static/portal-lpkg-deployer/portal-lpkg-deployer-test/build.gradle b/modules/apps/static/portal-lpkg-deployer/portal-lpkg-deployer-test/build.gradle
index 3332eaf93b952a..d99981c49564b7 100644
--- a/modules/apps/static/portal-lpkg-deployer/portal-lpkg-deployer-test/build.gradle
+++ b/modules/apps/static/portal-lpkg-deployer/portal-lpkg-deployer-test/build.gradle
@@ -4,7 +4,7 @@ dependencies {
testCompile group: "com.liferay.portal", name: "com.liferay.util.java", version: "default"
testCompile group: "commons-io", name: "commons-io", version: "2.5"
testCompile group: "org.apache.felix", name: "org.apache.felix.http.servlet-api", version: "1.1.2"
- testCompile group: "org.apache.tika", name: "tika-core", version: "1.14"
+ testCompile group: "org.apache.tika", name: "tika-core", version: "1.24"
testCompile group: "org.osgi", name: "osgi.core", version: "6.0.0"
testCompile project(":apps:static:portal-lpkg-deployer:portal-lpkg-deployer-test-util")
testCompile project(":core:petra:petra-lang")
diff --git a/modules/apps/static/portal-osgi-web/portal-osgi-web-wab-generator-impl/build.gradle b/modules/apps/static/portal-osgi-web/portal-osgi-web-wab-generator-impl/build.gradle
index d203feb53093a2..d3bce6e5258c96 100644
--- a/modules/apps/static/portal-osgi-web/portal-osgi-web-wab-generator-impl/build.gradle
+++ b/modules/apps/static/portal-osgi-web/portal-osgi-web-wab-generator-impl/build.gradle
@@ -20,7 +20,7 @@ dependencies {
testCompile group: "commons-httpclient", name: "commons-httpclient", version: "3.1"
testCompile group: "commons-io", name: "commons-io", version: "2.5"
testCompile group: "jaxen", name: "jaxen", version: "1.1.1"
- testCompile group: "org.apache.tika", name: "tika-core", version: "1.14"
+ testCompile group: "org.apache.tika", name: "tika-core", version: "1.24"
testCompile group: "org.slf4j", name: "slf4j-api", version: "1.7.26"
testCompile project(":apps:petra:petra-xml")
testCompile project(":core:petra:petra-concurrent")
diff --git a/modules/apps/tasks/tasks-portlet/ivy.xml b/modules/apps/tasks/tasks-portlet/ivy.xml
index 4eb30be77fe33d..01f9153025aa2a 100644
--- a/modules/apps/tasks/tasks-portlet/ivy.xml
+++ b/modules/apps/tasks/tasks-portlet/ivy.xml
@@ -13,7 +13,7 @@

-
+

diff --git a/modules/apps/upload/upload-web/build.gradle b/modules/apps/upload/upload-web/build.gradle
index cc89d2797d5c90..5b9aee11e08a3f 100644
--- a/modules/apps/upload/upload-web/build.gradle
+++ b/modules/apps/upload/upload-web/build.gradle
@@ -14,6 +14,6 @@ dependencies {
testCompile group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "default"
testCompile group: "com.liferay.portal", name: "com.liferay.util.java", version: "default"
- testCompile group: "org.apache.tika", name: "tika-core", version: "1.14"
+ testCompile group: "org.apache.tika", name: "tika-core", version: "1.24"
testCompile project(":core:petra:petra-lang")
}
\ No newline at end of file
diff --git a/modules/apps/users-admin/users-admin-web/src/main/java/com/liferay/users/admin/web/internal/portlet/configuration/icon/DeleteOrganizationPortletConfigurationIcon.java b/modules/apps/users-admin/users-admin-web/src/main/java/com/liferay/users/admin/web/internal/portlet/configuration/icon/DeleteOrganizationPortletConfigurationIcon.java
index ffed97f080909c..039f2abd55da13 100644
--- a/modules/apps/users-admin/users-admin-web/src/main/java/com/liferay/users/admin/web/internal/portlet/configuration/icon/DeleteOrganizationPortletConfigurationIcon.java
+++ b/modules/apps/users-admin/users-admin-web/src/main/java/com/liferay/users/admin/web/internal/portlet/configuration/icon/DeleteOrganizationPortletConfigurationIcon.java
@@ -23,6 +23,7 @@
import com.liferay.portal.kernel.service.permission.OrganizationPermissionUtil;
import com.liferay.portal.kernel.theme.PortletDisplay;
import com.liferay.portal.kernel.theme.ThemeDisplay;
+import com.liferay.portal.kernel.util.HtmlUtil;
import com.liferay.portal.kernel.util.Validator;
import com.liferay.portal.kernel.util.WebKeys;
import com.liferay.users.admin.constants.UsersAdminPortletKeys;
@@ -89,7 +90,7 @@ public String getOnClick(
(RenderResponse)portletResponse);
}
- sb.append(backURL);
+ sb.append(HtmlUtil.escapeJS(backURL));
sb.append("');");
}
diff --git a/modules/core/portal-bootstrap/system.packages.extra.bnd b/modules/core/portal-bootstrap/system.packages.extra.bnd
index 56b2c3703ad7ff..b84f226cac9d36 100644
--- a/modules/core/portal-bootstrap/system.packages.extra.bnd
+++ b/modules/core/portal-bootstrap/system.packages.extra.bnd
@@ -117,7 +117,7 @@ Export-Package:\
com.sun.syndication.io;version='1.0',\
com.sun.syndication.io.impl;version='1.0',\
\
- com.thoughtworks.xstream.\*;version='1.4.11.1',\
+ com.thoughtworks.xstream.\*;version='1.4.14',\
\
java\_cup.runtime.\*;version='2.7.1',\
\
diff --git a/modules/util/portal-tools-sample-sql-builder/build.gradle b/modules/util/portal-tools-sample-sql-builder/build.gradle
index 0a16f070d76eff..3ec12a00618566 100644
--- a/modules/util/portal-tools-sample-sql-builder/build.gradle
+++ b/modules/util/portal-tools-sample-sql-builder/build.gradle
@@ -60,7 +60,7 @@ dependencies {
testCompile group: "com.mchange", name: "c3p0", version: "0.9.5"
testCompile group: "commons-io", name: "commons-io", version: "2.5"
testCompile group: "log4j", name: "apache-log4j-extras", version: "1.1"
- testCompile group: "org.apache.tika", name: "tika-core", version: "1.14"
+ testCompile group: "org.apache.tika", name: "tika-core", version: "1.24"
testCompile group: "org.apache.tomcat", name: "tomcat-jdbc", version: "8.0.32"
testCompile group: "org.jodd", name: "jodd-json", version: "3.6.4"
testCompile group: "org.json", name: "json", version: "20180813"
diff --git a/modules/yarn.lock b/modules/yarn.lock
index 8e234419d5bdf4..777656fe36ed22 100644
--- a/modules/yarn.lock
+++ b/modules/yarn.lock
@@ -960,7 +960,7 @@
dependencies:
regenerator-runtime "^0.13.2"
-"@babel/runtime@^7.0.0", "@babel/runtime@^7.1.2", "@babel/runtime@^7.4.0", "@babel/runtime@^7.4.2", "@babel/runtime@^7.4.3", "@babel/runtime@^7.4.5", "@babel/runtime@^7.5.0", "@babel/runtime@^7.5.1", "@babel/runtime@^7.5.4":
+"@babel/runtime@^7.0.0", "@babel/runtime@^7.1.2", "@babel/runtime@^7.4.2", "@babel/runtime@^7.4.3", "@babel/runtime@^7.4.5", "@babel/runtime@^7.5.0", "@babel/runtime@^7.5.1", "@babel/runtime@^7.5.4":
version "7.6.3"
resolved "https://registry.yarnpkg.com/@babel/runtime/-/runtime-7.6.3.tgz#935122c74c73d2240cafd32ddb5fc2a6cd35cf1f"
integrity sha512-kq6anf9JGjW8Nt5rYfEuGRaEAaH1mkv3Bbu6rYvLOpPh/RusSJXuKPEAoZ7L7gybZkchE8+NV5g9vKF4AGAtsA==
@@ -1008,6 +1008,14 @@
"@clayui/icon" "^3.0.0"
classnames "^2.2.6"
+"@clayui/alert@3.2.0":
+ version "3.2.0"
+ resolved "https://registry.yarnpkg.com/@clayui/alert/-/alert-3.2.0.tgz#5e6020d003790da2a944aa9e90001af805f9541d"
+ integrity sha512-z+6dTobjGNGMQCrRumR+9G96TUvpsekv80Oy2V1p6K6SMWnOOZdGvq5Fy6cN9irOSCNzKtyzvZccmh6pQXf9vg==
+ dependencies:
+ "@clayui/icon" "^3.0.3"
+ classnames "^2.2.6"
+
"@clayui/autocomplete@3.0.0", "@clayui/autocomplete@^3.0.0":
version "3.0.0"
resolved "https://registry.yarnpkg.com/@clayui/autocomplete/-/autocomplete-3.0.0.tgz#f74cd63d6203699cb4e94234a55a36c535002b25"
@@ -1132,6 +1140,14 @@
classnames "^2.2.6"
warning "^4.0.3"
+"@clayui/icon@^3.0.3":
+ version "3.1.0"
+ resolved "https://registry.yarnpkg.com/@clayui/icon/-/icon-3.1.0.tgz#9e600f87194f8dacfb49ace121fbab25a2e82f03"
+ integrity sha512-rxFih7ktNoYx7jJMYWA5GiEh6bJ5W3mB5fWRlSAw8sVyDvSH8rIdaqR77SmvAJDTygfKuKJlyeHnhTmWZgJbCg==
+ dependencies:
+ classnames "^2.2.6"
+ warning "^4.0.3"
+
"@clayui/label@3.0.0", "@clayui/label@^3.0.0":
version "3.0.0"
resolved "https://registry.yarnpkg.com/@clayui/label/-/label-3.0.0.tgz#13433df24acfe875ae0da3b8f1c7d29eb2f67b95"
@@ -2183,15 +2199,6 @@
pretty-format "^24.0.0"
redent "^3.0.0"
-"@testing-library/react-hooks@1.0.4":
- version "1.0.4"
- resolved "https://registry.yarnpkg.com/@testing-library/react-hooks/-/react-hooks-1.0.4.tgz#5e91df44c3cee305c50b1b0e1fa9d97578024309"
- integrity sha512-yFulIcOY7oTtkUHRzmWb0nPWpt0mA/WMm6BWCzoZopLptlSk6LrGC3P53bdN7UTcYqyExszSwMz3o8PYYQeeEA==
- dependencies:
- "@babel/runtime" "^7.4.2"
- "@types/react" "^16.8.22"
- "@types/react-test-renderer" "^16.8.2"
-
"@testing-library/react@8.0.7":
version "8.0.7"
resolved "https://registry.yarnpkg.com/@testing-library/react/-/react-8.0.7.tgz#b5992c9156e926850a0e3a7c882ae1aed83b1c77"
@@ -2300,14 +2307,7 @@
resolved "https://registry.yarnpkg.com/@types/q/-/q-1.5.2.tgz#690a1475b84f2a884fd07cd797c00f5f31356ea8"
integrity sha512-ce5d3q03Ex0sy4R14722Rmt6MT07Ua+k4FwDfdcToYJcMKNtRVQvJ6JCAPdAmAnbRb6CsX6aYb9m96NGod9uTw==
-"@types/react-test-renderer@^16.8.2":
- version "16.9.1"
- resolved "https://registry.yarnpkg.com/@types/react-test-renderer/-/react-test-renderer-16.9.1.tgz#9d432c46c515ebe50c45fa92c6fb5acdc22e39c4"
- integrity sha512-nCXQokZN1jp+QkoDNmDZwoWpKY8HDczqevIDO4Uv9/s9rbGPbSpy8Uaxa5ixHKkcm/Wt0Y9C3wCxZivh4Al+rQ==
- dependencies:
- "@types/react" "\*"
-
-"@types/react@\*", "@types/react@^16.8.22":
+"@types/react@\*":
version "16.9.9"
resolved "https://registry.yarnpkg.com/@types/react/-/react-16.9.9.tgz#a62c6f40f04bc7681be5e20975503a64fe783c3a"
integrity sha512-L+AudFJkDukk+ukInYvpoAPyJK5q1GanFOINOJnM0w6tUgITuWvJ4jyoBPFL7z4/L8hGLd+K/6xR5uUjXu0vVg==
@@ -2575,22 +2575,6 @@ after@0.8.2:
string.prototype.padstart "^3.0.0"
symbol.prototype.description "^1.0.0"
-airbnb-prop-types@^2.15.0:
- version "2.15.0"
- resolved "https://registry.yarnpkg.com/airbnb-prop-types/-/airbnb-prop-types-2.15.0.tgz#5287820043af1eb469f5b0af0d6f70da6c52aaef"
- integrity sha512-jUh2/hfKsRjNFC4XONQrxo/n/3GG4Tn6Hl0WlFQN5PY9OMC9loSCoAYKnZsWaP8wEfd5xcrPloK0Zg6iS1xwVA==
- dependencies:
- array.prototype.find "^2.1.0"
- function.prototype.name "^1.1.1"
- has "^1.0.3"
- is-regex "^1.0.4"
- object-is "^1.0.1"
- object.assign "^4.1.0"
- object.entries "^1.1.0"
- prop-types "^15.7.2"
- prop-types-exact "^1.2.0"
- react-is "^16.9.0"
-
ajv-errors@^1.0.0:
version "1.0.1"
resolved "https://registry.yarnpkg.com/ajv-errors/-/ajv-errors-1.0.1.tgz#f35986aceb91afadec4102fbd85014950cefa64d"
@@ -2851,11 +2835,6 @@ array-equal@^1.0.0:
resolved "https://registry.yarnpkg.com/array-equal/-/array-equal-1.0.0.tgz#8c2a5ef2472fd9ea742b04c77a75093ba2757c93"
integrity sha1-jCpe8kcv2ep0KwTHenUJO6J1fJM=
-array-filter@^1.0.0:
- version "1.0.0"
- resolved "https://registry.yarnpkg.com/array-filter/-/array-filter-1.0.0.tgz#baf79e62e6ef4c2a4c0b831232daffec251f9d83"
- integrity sha1-uveeYubvTCpMC4MSMtr/7CUfnYM=
-
array-filter@~0.0.0:
version "0.0.1"
resolved "https://registry.yarnpkg.com/array-filter/-/array-filter-0.0.1.tgz#7da8cf2e26628ed732803581fd21f67cacd2eeec"
@@ -2931,14 +2910,6 @@ array-unique@^0.3.2:
resolved "https://registry.yarnpkg.com/array-unique/-/array-unique-0.3.2.tgz#a894b75d4bc4f6cd679ef3244a9fd8f46ae2d428"
integrity sha1-qJS3XUvE9s1nnvMkSp/Y9Gri1Cg=
-array.prototype.find@^2.1.0:
- version "2.1.0"
- resolved "https://registry.yarnpkg.com/array.prototype.find/-/array.prototype.find-2.1.0.tgz#630f2eaf70a39e608ac3573e45cf8ccd0ede9ad7"
- integrity sha512-Wn41+K1yuO5p7wRZDl7890c3xvv5UBrfVXTVIe28rSQb6LS0fZMDrQB6PAcxQFRFy6vJTLDc3A2+3CjQdzVKRg==
- dependencies:
- define-properties "^1.1.3"
- es-abstract "^1.13.0"
-
array.prototype.flat@^1.2.1:
version "1.2.1"
resolved "https://registry.yarnpkg.com/array.prototype.flat/-/array.prototype.flat-1.2.1.tgz#812db8f02cad24d3fab65dd67eabe3b8903494a4"
@@ -3100,14 +3071,6 @@ axe-core@^3.2.2:
resolved "https://registry.yarnpkg.com/axe-core/-/axe-core-3.3.1.tgz#3d1fa78cca8ead1b78c350581501e4e37b97b826"
integrity sha512-gw1T0JptHPF4AdLLqE8yQq3Z7YvsYkpFmFWd84r6hnq/QoKRr8icYHFumhE7wYl5TVIHgVlchMyJsAYh0CfwCQ==
-axios@0.18.1:
- version "0.18.1"
- resolved "https://registry.yarnpkg.com/axios/-/axios-0.18.1.tgz#ff3f0de2e7b5d180e757ad98000f1081b87bcea3"
- integrity sha512-0BfJq4NSfQXd+SkFdrvFbG7addhYSBA2mQwISr46pD6E5iqkWg02RAs8vyTT/j0RTnoYmeXauBuSv1qKwR179g==
- dependencies:
- follow-redirects "1.5.10"
- is-buffer "^2.0.2"
-
babel-code-frame@^6.22.0, babel-code-frame@^6.26.0:
version "6.26.0"
resolved "https://registry.yarnpkg.com/babel-code-frame/-/babel-code-frame-6.26.0.tgz#63fd43f7dc1e3bb7ce35947db8fe369a3f58c74b"
@@ -4186,7 +4149,7 @@ billboard.js@1.5.1:
dependencies:
d3 "^5.5.0"
-billboard.js@^1.6.0, billboard.js@^1.8.0:
+billboard.js@^1.8.0:
version "1.10.2"
resolved "https://registry.yarnpkg.com/billboard.js/-/billboard.js-1.10.2.tgz#2cddd5d7e56b9a547c1b6c891580f9909a6aba58"
integrity sha512-9AbLl3xnsaA50hyQuelYVK0cw7VW3IMkLcCwJ4nYmy9IN7UD617AIAfFY4AbH+/zKMsDceeUOPFfstqy2UeyGA==
@@ -4787,18 +4750,6 @@ chardet@^0.7.0:
resolved "https://registry.yarnpkg.com/chardet/-/chardet-0.7.0.tgz#90094849f0937f2eedc2425d0d28a9e5f0cbad9e"
integrity sha512-mT8iDcrh03qDGRRmoA2hmBJnxpllMR+0/0qlzjqZES6NdiWDcZkCNAk4rPFZ9Q85r27unkiNNg8ZOiwZXBHwcA==
-cheerio@^1.0.0-rc.2:
- version "1.0.0-rc.3"
- resolved "https://registry.yarnpkg.com/cheerio/-/cheerio-1.0.0-rc.3.tgz#094636d425b2e9c0f4eb91a46c05630c9a1a8bf6"
- integrity sha512-0td5ijfUPuubwLUu0OBoe98gZj8C/AA+RW3v67GPlGOrvxWjZmBXiBCRU+I8VEiNyJzjth40POfHiz2RB3gImA==
- dependencies:
- css-select "~1.2.0"
- dom-serializer "~0.1.1"
- entities "~1.1.1"
- htmlparser2 "^3.9.1"
- lodash "^4.15.0"
- parse5 "^3.0.1"
-
chokidar@^2.0.2, chokidar@^2.0.3, chokidar@^2.0.4, chokidar@^2.1.6:
version "2.1.6"
resolved "https://registry.yarnpkg.com/chokidar/-/chokidar-2.1.6.tgz#b6cad653a929e244ce8a834244164d241fa954c5"
@@ -4949,15 +4900,7 @@ clay-card@2.18.1, clay-card@^2.18.1:
metal-state "^2.16.0"
metal-web-component "^2.16.0"
-clay-charts-react@2.4.1:
- version "2.4.1"
- resolved "https://registry.yarnpkg.com/clay-charts-react/-/clay-charts-react-2.4.1.tgz#7d7155d3bc1a50838bcc0ae23a369d8fc4d29861"
- integrity sha512-Wv05J4CKbCl/I6JrBilymoYNTp9vLZMkGv9MU6VF6BCi31brtoEAVYyHNeTGqtKi+46HOOV7MSpjK2aKJb7k5Q==
- dependencies:
- clay-charts-shared "^2.4.1"
- react-billboardjs "^1.4.3"
-
-clay-charts-shared@^2.16.2, clay-charts-shared@^2.4.1:
+clay-charts-shared@^2.16.2:
version "2.16.2"
resolved "https://registry.yarnpkg.com/clay-charts-shared/-/clay-charts-shared-2.16.2.tgz#f9bf6f4caaa534006ace4b064eb7b7a37a26e769"
integrity sha512-HuIjXB5NDXeGIJWaAHWHdawc1AQuo2vdiqSp47EOT302CHYJ0q5bbsrAdfWuYt3umZo0yB1lh6f14Jjl1qRENw==
@@ -5762,7 +5705,7 @@ core-js@^1.0.0:
resolved "https://registry.yarnpkg.com/core-js/-/core-js-1.2.7.tgz#652294c14651db28fa93bd2d5ff2983a4f08c636"
integrity sha1-ZSKUwUZR2yj6k70tX/KYOk8IxjY=
-core-js@^2.2.0, core-js@^2.4.0, core-js@^2.4.1, core-js@^2.5.0:
+core-js@^2.2.0, core-js@^2.4.0, core-js@^2.5.0:
version "2.6.10"
resolved "https://registry.yarnpkg.com/core-js/-/core-js-2.6.10.tgz#8a5b8391f8cc7013da703411ce5b585706300d7f"
integrity sha512-I39t74+4t+zau64EN1fE5v2W31Adtc/REhzWN+gWRRXg6WH5qAsZm62DHpQ1+Yhe4047T55jvzz7MUqF/dBBlA==
@@ -5989,7 +5932,7 @@ css-select-base-adapter@^0.1.1:
resolved "https://registry.yarnpkg.com/css-select-base-adapter/-/css-select-base-adapter-0.1.1.tgz#3b2ff4972cc362ab88561507a95408a1432135d7"
integrity sha512-jQVeeRG70QI08vSTwf1jHxp74JoZsr2XSgETae8/xC8ovSnL2WF87GTLO86Sbwdt2lK4Umg4HnnwMO4YF3Ce7w==
-css-select@^1.1.0, css-select@~1.2.0:
+css-select@^1.1.0:
version "1.2.0"
resolved "https://registry.yarnpkg.com/css-select/-/css-select-1.2.0.tgz#2b3a110539c5355f1cd8d314623e870b121ec858"
integrity sha1-KzoRBTnFNV8c2NMUYj6HCxIeyFg=
@@ -6088,11 +6031,6 @@ currently-unhandled@^0.4.1:
dependencies:
array-find-index "^1.0.1"
-custom-event-polyfill@1.0.6:
- version "1.0.6"
- resolved "https://registry.yarnpkg.com/custom-event-polyfill/-/custom-event-polyfill-1.0.6.tgz#6b026e81cd9f7bc896bd6b016a427407bb068db1"
- integrity sha512-3FxpFlzGcHrDykwWu+xWVXZ8PfykM/9/bI3zXb953sh+AjInZWcQmrnmvPoZgiqNjmbtTm10PWvYqvRW527x6g==
-
custom-event@~1.0.0:
version "1.0.1"
resolved "https://registry.yarnpkg.com/custom-event/-/custom-event-1.0.1.tgz#5d02a46850adf1b4a317946a3928fccb5bfd0425"
@@ -6446,13 +6384,6 @@ debug@2.6.9, debug@^2.1.2, debug@^2.2.0, debug@^2.3.3, debug@^2.6.0, debug@^2.6.
dependencies:
ms "2.0.0"
-debug@=3.1.0, debug@~3.1.0:
- version "3.1.0"
- resolved "https://registry.yarnpkg.com/debug/-/debug-3.1.0.tgz#5bb5a0672628b64149566ba16819e61518c67261"
- integrity sha512-OX8XqP7/1a9cqkxYw2yXss15f26NKWBpDXQd0/uK/KPqdQhxbPa994hnzjcE2VqQpDslf55723cKPUOGSmMY3g==
- dependencies:
- ms "2.0.0"
-
debug@^3.0.0, debug@^3.1.0, debug@^3.2.5:
version "3.2.6"
resolved "https://registry.yarnpkg.com/debug/-/debug-3.2.6.tgz#e83d17de16d8a7efb7717edbe5fb10135eee629b"
@@ -6467,6 +6398,13 @@ debug@^4.0.1, debug@^4.1.0, debug@^4.1.1:
dependencies:
ms "^2.1.1"
+debug@~3.1.0:
+ version "3.1.0"
+ resolved "https://registry.yarnpkg.com/debug/-/debug-3.1.0.tgz#5bb5a0672628b64149566ba16819e61518c67261"
+ integrity sha512-OX8XqP7/1a9cqkxYw2yXss15f26NKWBpDXQd0/uK/KPqdQhxbPa994hnzjcE2VqQpDslf55723cKPUOGSmMY3g==
+ dependencies:
+ ms "2.0.0"
+
decamelize@^1.1.1, decamelize@^1.1.2, decamelize@^1.2.0:
version "1.2.0"
resolved "https://registry.yarnpkg.com/decamelize/-/decamelize-1.2.0.tgz#f6534d15148269b20352e7bee26f501f9a191290"
@@ -6712,11 +6650,6 @@ dir-glob@^3.0.1:
dependencies:
path-type "^4.0.0"
-discontinuous-range@1.0.0:
- version "1.0.0"
- resolved "https://registry.yarnpkg.com/discontinuous-range/-/discontinuous-range-1.0.0.tgz#e38331f0844bba49b9a9cb71c771585aab1bc65a"
- integrity sha1-44Mx8IRLukm5qctxx3FYWqsbxlo=
-
dnd-core@^7.7.0:
version "7.7.0"
resolved "https://registry.yarnpkg.com/dnd-core/-/dnd-core-7.7.0.tgz#3166aefc8c5b85ca4ade4ae836712a3108975fab"
@@ -6792,14 +6725,6 @@ dom-serializer@0:
domelementtype "^2.0.1"
entities "^2.0.0"
-dom-serializer@~0.1.1:
- version "0.1.1"
- resolved "https://registry.yarnpkg.com/dom-serializer/-/dom-serializer-0.1.1.tgz#1ec4059e284babed36eec2941d4a970a189ce7c0"
- integrity sha512-l0IU0pPzLWSHBcieZbpOKgkIn3ts3vAh7ZuFyXNwJxJXk/c4Gwj9xaTJwIDVQCXawWD0qb3IzMGH5rglQaO0XA==
- dependencies:
- domelementtype "^1.3.0"
- entities "^1.1.1"
-
dom-walk@^0.1.0:
version "0.1.1"
resolved "https://registry.yarnpkg.com/dom-walk/-/dom-walk-0.1.1.tgz#672226dc74c8f799ad35307df936aba11acd6018"
@@ -6815,7 +6740,7 @@ domain-browser@^1.1.1:
resolved "https://registry.yarnpkg.com/domain-browser/-/domain-browser-1.2.0.tgz#3d31f50191a6749dd1375a7f522e823d42e54eda"
integrity sha512-jnjyiM6eRyZl2H+W8Q/zLMA481hzi0eszAaBUzIVnmYVDBbnLxVNnfu1HgEBvCbL+71FrxMl3E6lpKH7Ge3OXA==
-domelementtype@1, domelementtype@^1.3.0, domelementtype@^1.3.1:
+domelementtype@1, domelementtype@^1.3.1:
version "1.3.1"
resolved "https://registry.yarnpkg.com/domelementtype/-/domelementtype-1.3.1.tgz#d048c44b37b0d10a7f2a3d5fee3f4333d790481f"
integrity sha512-BSKB+TSpMpFI/HOxCNr1O8aMOTZ8hT3pM3GQ0w/mWRmkhEDSFJkkyzz4XQsBV44BChwGkrDfMyjVD0eA2aFV3w==
@@ -7100,66 +7025,6 @@ env-paths@^1.0.0:
resolved "https://registry.yarnpkg.com/env-paths/-/env-paths-1.0.0.tgz#4168133b42bb05c38a35b1ae4397c8298ab369e0"
integrity sha1-QWgTO0K7BcOKNbGuQ5fIKYqzaeA=
-enzyme-adapter-react-16@1.14.0:
- version "1.14.0"
- resolved "https://registry.yarnpkg.com/enzyme-adapter-react-16/-/enzyme-adapter-react-16-1.14.0.tgz#204722b769172bcf096cb250d33e6795c1f1858f"
- integrity sha512-7PcOF7pb4hJUvjY7oAuPGpq3BmlCig3kxXGi2kFx0YzJHppqX1K8IIV9skT1IirxXlu8W7bneKi+oQ10QRnhcA==
- dependencies:
- enzyme-adapter-utils "^1.12.0"
- has "^1.0.3"
- object.assign "^4.1.0"
- object.values "^1.1.0"
- prop-types "^15.7.2"
- react-is "^16.8.6"
- react-test-renderer "^16.0.0-0"
- semver "^5.7.0"
-
-enzyme-adapter-utils@^1.12.0:
- version "1.12.1"
- resolved "https://registry.yarnpkg.com/enzyme-adapter-utils/-/enzyme-adapter-utils-1.12.1.tgz#e828e0d038e2b1efa4b9619ce896226f85c9dd88"
- integrity sha512-KWiHzSjZaLEoDCOxY8Z1RAbUResbqKN5bZvenPbfKtWorJFVETUw754ebkuCQ3JKm0adx1kF8JaiR+PHPiP47g==
- dependencies:
- airbnb-prop-types "^2.15.0"
- function.prototype.name "^1.1.1"
- object.assign "^4.1.0"
- object.fromentries "^2.0.1"
- prop-types "^15.7.2"
- semver "^5.7.0"
-
-enzyme-to-json@3.3.5:
- version "3.3.5"
- resolved "https://registry.yarnpkg.com/enzyme-to-json/-/enzyme-to-json-3.3.5.tgz#f8eb82bd3d5941c9d8bc6fd9140030777d17d0af"
- integrity sha512-DmH1wJ68HyPqKSYXdQqB33ZotwfUhwQZW3IGXaNXgR69Iodaoj8TF/D9RjLdz4pEhGq2Tx2zwNUIjBuqoZeTgA==
- dependencies:
- lodash "^4.17.4"
-
-enzyme@3.10.0:
- version "3.10.0"
- resolved "https://registry.yarnpkg.com/enzyme/-/enzyme-3.10.0.tgz#7218e347c4a7746e133f8e964aada4a3523452f6"
- integrity sha512-p2yy9Y7t/PFbPoTvrWde7JIYB2ZyGC+NgTNbVEGvZ5/EyoYSr9aG/2rSbVvyNvMHEhw9/dmGUJHWtfQIEiX9pg==
- dependencies:
- array.prototype.flat "^1.2.1"
- cheerio "^1.0.0-rc.2"
- function.prototype.name "^1.1.0"
- has "^1.0.3"
- html-element-map "^1.0.0"
- is-boolean-object "^1.0.0"
- is-callable "^1.1.4"
- is-number-object "^1.0.3"
- is-regex "^1.0.4"
- is-string "^1.0.4"
- is-subset "^0.1.1"
- lodash.escape "^4.0.1"
- lodash.isequal "^4.5.0"
- object-inspect "^1.6.0"
- object-is "^1.0.1"
- object.assign "^4.1.0"
- object.entries "^1.0.4"
- object.values "^1.0.4"
- raf "^3.4.0"
- rst-selector-parser "^2.2.3"
- string.prototype.trim "^1.1.2"
-
errno@^0.1.3, errno@~0.1.7:
version "0.1.7"
resolved "https://registry.yarnpkg.com/errno/-/errno-0.1.7.tgz#4684d71779ad39af177e3f007996f7c67c852618"
@@ -7852,11 +7717,6 @@ fb-watchman@^2.0.0:
dependencies:
bser "^2.0.0"
-fbjs-css-vars@^1.0.0:
- version "1.0.2"
- resolved "https://registry.yarnpkg.com/fbjs-css-vars/-/fbjs-css-vars-1.0.2.tgz#216551136ae02fe255932c3ec8775f18e2c078b8"
- integrity sha512-b2XGFAFdWZWg0phtAWLHCk836A1Xann+I+Dgd3Gk64MHKZO44FfoD1KxyvbSh0qZsIoXQGGlVztIY+oitJPpRQ==
-
fbjs@^0.8.0, fbjs@^0.8.1:
version "0.8.17"
resolved "https://registry.yarnpkg.com/fbjs/-/fbjs-0.8.17.tgz#c4d598ead6949112653d6588b01a5cdcd9f90fdd"
@@ -7870,20 +7730,6 @@ fbjs@^0.8.0, fbjs@^0.8.1:
setimmediate "^1.0.5"
ua-parser-js "^0.7.18"
-fbjs@^1.0.0:
- version "1.0.0"
- resolved "https://registry.yarnpkg.com/fbjs/-/fbjs-1.0.0.tgz#52c215e0883a3c86af2a7a776ed51525ae8e0a5a"
- integrity sha512-MUgcMEJaFhCaF1QtWGnmq9ZDRAzECTCRAF7O6UZIlAlkTs1SasiX9aP0Iw7wfD2mJ7wDTNfg2w7u5fSCwJk1OA==
- dependencies:
- core-js "^2.4.1"
- fbjs-css-vars "^1.0.0"
- isomorphic-fetch "^2.1.1"
- loose-envify "^1.0.0"
- object-assign "^4.1.0"
- promise "^7.1.1"
- setimmediate "^1.0.5"
- ua-parser-js "^0.7.18"
-
figgy-pudding@^3.5.1:
version "3.5.1"
resolved "https://registry.yarnpkg.com/figgy-pudding/-/figgy-pudding-3.5.1.tgz#862470112901c727a0e495a80744bd5baa1d6790"
@@ -8144,13 +7990,6 @@ focus-lock@^0.6.3:
resolved "https://registry.yarnpkg.com/focus-lock/-/focus-lock-0.6.5.tgz#f6eb37832a9b1b205406175f5277396a28c0fce1"
integrity sha512-i/mVBOoa9o+tl+u9owOJUF8k8L85odZNIsctB+JAK2HFT8jckiBwmk+3uydlm6FN8czgnkIwQtBv6yyAbrzXjw==
-follow-redirects@1.5.10:
- version "1.5.10"
- resolved "https://registry.yarnpkg.com/follow-redirects/-/follow-redirects-1.5.10.tgz#7b7a9f9aea2fdff36786a94ff643ed07f4ff5e2a"
- integrity sha512-0V5l4Cizzvqt5D44aTXbFZz+FtyXV1vrDN6qrelxtfYQKW0KO0W2T/hkE8xvGa/540LkZlkaUjO4ailYTFtHVQ==
- dependencies:
- debug "=3.1.0"
-
follow-redirects@^1.0.0:
version "1.9.0"
resolved "https://registry.yarnpkg.com/follow-redirects/-/follow-redirects-1.9.0.tgz#8d5bcdc65b7108fe1508649c79c12d732dcedb4f"
@@ -8396,7 +8235,7 @@ function-bind@^1.0.2, function-bind@^1.1.1:
resolved "https://registry.yarnpkg.com/function-bind/-/function-bind-1.1.1.tgz#a56899d3ea3c9bab874bb9773b7c5ede92f4895d"
integrity sha512-yIovAzMX49sF8Yl58fSCWJ5svSLuaibPxXQJFLmBObTuCr0Mf1KiPopGM9NiFjiYBCbfaa2Fh6breQ6ANVTI0A==
-function.prototype.name@^1.1.0, function.prototype.name@^1.1.1:
+function.prototype.name@^1.1.0:
version "1.1.1"
resolved "https://registry.yarnpkg.com/function.prototype.name/-/function.prototype.name-1.1.1.tgz#6d252350803085abc2ad423d4fe3be2f9cbda392"
integrity sha512-e1NzkiJuw6xqVH7YSdiW/qDHebcmMhPNe6w+4ZYYEg0VA+LaLzx37RimbPLuonHhYGFGPx1ME2nSi74JiaCr/Q==
@@ -9342,18 +9181,6 @@ highlight.js@~9.12.0:
resolved "https://registry.yarnpkg.com/highlight.js/-/highlight.js-9.12.0.tgz#e6d9dbe57cbefe60751f02af336195870c90c01e"
integrity sha1-5tnb5Xy+/mB1HwKvM2GVhwyQwB4=
-history@^4.9.0:
- version "4.10.1"
- resolved "https://registry.yarnpkg.com/history/-/history-4.10.1.tgz#33371a65e3a83b267434e2b3f3b1b4c58aad4cf3"
- integrity sha512-36nwAD620w12kuzPAsyINPWJqlNbij+hpK1k9XRloDtym8mxzGYl2c17LnV6IAGB2Dmg4tEa7G7DlawS0+qjew==
- dependencies:
- "@babel/runtime" "^7.1.2"
- loose-envify "^1.2.0"
- resolve-pathname "^3.0.0"
- tiny-invariant "^1.0.2"
- tiny-warning "^1.0.0"
- value-equal "^1.0.1"
-
hmac-drbg@^1.0.0:
version "1.0.1"
resolved "https://registry.yarnpkg.com/hmac-drbg/-/hmac-drbg-1.0.1.tgz#d2745701025a6c775a6c545793ed502fc0c649a1"
@@ -9368,7 +9195,7 @@ hoist-non-react-statics@^2.3.1, hoist-non-react-statics@^2.5.5:
resolved "https://registry.yarnpkg.com/hoist-non-react-statics/-/hoist-non-react-statics-2.5.5.tgz#c5903cf409c0dfd908f388e619d86b9c1174cb47"
integrity sha512-rqcy4pJo55FTTLWt+bU8ukscqHeE/e9KWvsOW2b/a3afxQZhwkQdT1rPPCJ0rYXdj4vNcasY8zHTH+jF/qStxw==
-hoist-non-react-statics@^3.1.0, hoist-non-react-statics@^3.3.0:
+hoist-non-react-statics@^3.3.0:
version "3.3.0"
resolved "https://registry.yarnpkg.com/hoist-non-react-statics/-/hoist-non-react-statics-3.3.0.tgz#b09178f0122184fb95acf525daaecb4d8f45958b"
integrity sha512-0XsbTXxgiaCDYDIWFcwkmerZPSwywfUqYmwT4jzewKTQSWoE6FCMoUVOeBJWK3E/CrWbxRG3m5GzY4lnIwGRBA==
@@ -9405,13 +9232,6 @@ hpack.js@^2.1.6:
readable-stream "^2.0.1"
wbuf "^1.1.0"
-html-element-map@^1.0.0:
- version "1.1.0"
- resolved "https://registry.yarnpkg.com/html-element-map/-/html-element-map-1.1.0.tgz#e5aab9a834caf883b421f8bd9eaedcaac887d63c"
- integrity sha512-iqiG3dTZmy+uUaTmHarTL+3/A2VW9ox/9uasKEZC+R/wAtUrTcRlXPSaPqsnWPfIu8wqn09jQNwMRqzL54jSYA==
- dependencies:
- array-filter "^1.0.0"
-
html-encoding-sniffer@^1.0.2:
version "1.0.2"
resolved "https://registry.yarnpkg.com/html-encoding-sniffer/-/html-encoding-sniffer-1.0.2.tgz#e70d84b94da53aa375e11fe3a351be6642ca46f8"
@@ -9449,7 +9269,7 @@ html-webpack-plugin@^4.0.0-beta.2:
tapable "^1.1.3"
util.promisify "1.0.0"
-htmlparser2@^3.3.0, htmlparser2@^3.9.1:
+htmlparser2@^3.3.0:
version "3.10.1"
resolved "https://registry.yarnpkg.com/htmlparser2/-/htmlparser2-3.10.1.tgz#bd679dc3f59897b6a34bb10749c855bb53a9392f"
integrity sha512-IgieNijUMbkDovyoKObU1DUhm1iwNYE/fuifEoEHfd1oZKZDaONBSkal7Y01shxsM49R4XaMdGez3WnF9UfiCQ==
@@ -9928,21 +9748,11 @@ is-binary-path@^1.0.0:
dependencies:
binary-extensions "^1.0.0"
-is-boolean-object@^1.0.0:
- version "1.0.0"
- resolved "https://registry.yarnpkg.com/is-boolean-object/-/is-boolean-object-1.0.0.tgz#98f8b28030684219a95f375cfbd88ce3405dff93"
- integrity sha1-mPiygDBoQhmpXzdc+9iM40Bd/5M=
-
is-buffer@^1.0.2, is-buffer@^1.1.5:
version "1.1.6"
resolved "https://registry.yarnpkg.com/is-buffer/-/is-buffer-1.1.6.tgz#efaa2ea9daa0d7ab2ea13a97b2b8ad51fefbe8be"
integrity sha512-NcdALwpXkTm5Zvvbk7owOUSvVvBKDgKP5/ewfXEznmQFfs4ZRmanOeKBTjRVjka3QFoN6XJ+9F3USqfHqTaU5w==
-is-buffer@^2.0.2:
- version "2.0.4"
- resolved "https://registry.yarnpkg.com/is-buffer/-/is-buffer-2.0.4.tgz#3e572f23c8411a5cfd9557c849e3665e0b290623"
- integrity sha512-Kq1rokWXOPXWuaMAqZiJW4XxsmD9zGx9q4aePabbn3qCRGedtH7Cm+zV8WETitMfu1wdh+Rvd6w5egwSngUX2A==
-
is-callable@^1.1.4:
version "1.1.4"
resolved "https://registry.yarnpkg.com/is-callable/-/is-callable-1.1.4.tgz#1e1adf219e1eeb684d691f9d6a05ff0d30a24d75"
@@ -10099,11 +9909,6 @@ is-hexadecimal@^1.0.0:
resolved "https://registry.yarnpkg.com/is-hexadecimal/-/is-hexadecimal-1.0.3.tgz#e8a426a69b6d31470d3a33a47bb825cda02506ee"
integrity sha512-zxQ9//Q3D/34poZf8fiy3m3XVpbQc7ren15iKqrTtLPwkPD/t3Scy9Imp63FujULGxuK0ZlCwoo5xNpktFgbOA==
-is-number-object@^1.0.3:
- version "1.0.3"
- resolved "https://registry.yarnpkg.com/is-number-object/-/is-number-object-1.0.3.tgz#f265ab89a9f445034ef6aff15a8f00b00f551799"
- integrity sha1-8mWrian0RQNO9q/xWo8AsA9VF5k=
-
is-number@^0.1.1:
version "0.1.1"
resolved "https://registry.yarnpkg.com/is-number/-/is-number-0.1.1.tgz#69a7af116963d47206ec9bd9b48a14216f1e3806"
@@ -10235,16 +10040,6 @@ is-stream@^1.0.0, is-stream@^1.0.1, is-stream@^1.1.0:
resolved "https://registry.yarnpkg.com/is-stream/-/is-stream-1.1.0.tgz#12d4a3dd4e68e0b79ceb8dbc84173ae80d91ca44"
integrity sha1-EtSj3U5o4Lec6428hBc66A2RykQ=
-is-string@^1.0.4:
- version "1.0.4"
- resolved "https://registry.yarnpkg.com/is-string/-/is-string-1.0.4.tgz#cc3a9b69857d621e963725a24caeec873b826e64"
- integrity sha1-zDqbaYV9Yh6WNyWiTK7shzuCbmQ=
-
-is-subset@^0.1.1:
- version "0.1.1"
- resolved "https://registry.yarnpkg.com/is-subset/-/is-subset-0.1.1.tgz#8a59117d932de1de00f245fcdd39ce43f1e939a6"
- integrity sha1-ilkRfZMt4d4A8kX83TnOQ/HpOaY=
-
is-symbol@^1.0.2:
version "1.0.2"
resolved "https://registry.yarnpkg.com/is-symbol/-/is-symbol-1.0.2.tgz#a055f6ae57192caee329e7a860118b497a950f38"
@@ -11359,10 +11154,10 @@ liferay-amd-loader@4.2.0:
resolved "https://registry.yarnpkg.com/liferay-amd-loader/-/liferay-amd-loader-4.2.0.tgz#c166fa3723a7cf760deefb8e580d8892c6bf436b"
integrity sha512-q+b2oU6zy6gDe6uKqHPY2/L9eUjhZAVatCAC5HNrHd+tMIk+MDBSCiHmRvihoJnmPylT+RZ4gNvWxtVwIQBF/Q==
-liferay-ckeditor@4.11.4-liferay.2:
- version "4.11.4-liferay.2"
- resolved "https://registry.yarnpkg.com/liferay-ckeditor/-/liferay-ckeditor-4.11.4-liferay.2.tgz#e76302c2ba1775121f47dd6477c9bcdfa8cb0657"
- integrity sha512-M1XuKtSkuyh4rVXFS7usZmqE+sFe/tASLGpOSPa04WWTJfTDLl92Chj8qRvRLKoWeM85umgO51yhhSVd4IZgGQ==
+liferay-ckeditor@4.14.1-liferay.10:
+ version "4.14.1-liferay.10"
+ resolved "https://registry.yarnpkg.com/liferay-ckeditor/-/liferay-ckeditor-4.14.1-liferay.10.tgz#5c5e11519c18c33141de95cccdf9dd3c69534b64"
+ integrity sha512-HR6+KJI9jehYii+RXUbKOCoN69CuP4j5oD24s0wu8lLjr9RyzEE17pUJSvrq4+dzrv2E4Xsn9IYEQC2CmVfUfw==
liferay-css-parse@~1.7.1:
version "1.7.1"
@@ -11899,7 +11694,7 @@ lodash.defaults@~2.4.1:
lodash.\_objecttypes "~2.4.1"
lodash.keys "~2.4.1"
-lodash.escape@4.0.1, lodash.escape@^4.0.1:
+lodash.escape@4.0.1:
version "4.0.1"
resolved "https://registry.yarnpkg.com/lodash.escape/-/lodash.escape-4.0.1.tgz#c9044690c21e04294beaa517712fded1fa88de98"
integrity sha1-yQRGkMIeBClL6qUXcS/e0fqI3pg=
@@ -11920,11 +11715,6 @@ lodash.escape@~2.4.1:
lodash.\_reunescapedhtml "~2.4.1"
lodash.keys "~2.4.1"
-lodash.flattendeep@^4.4.0:
- version "4.4.0"
- resolved "https://registry.yarnpkg.com/lodash.flattendeep/-/lodash.flattendeep-4.4.0.tgz#fb030917f86a3134e5bc9bec0d69e0013ddfedb2"
- integrity sha1-+wMJF/hqMTTlvJvsDWngAT3f7bI=
-
lodash.groupby@4.6.0:
version "4.6.0"
resolved "https://registry.yarnpkg.com/lodash.groupby/-/lodash.groupby-4.6.0.tgz#0b08a1dcf68397c397855c3239783832df7403d1"
@@ -11940,16 +11730,11 @@ lodash.isarray@^3.0.0:
resolved "https://registry.yarnpkg.com/lodash.isarray/-/lodash.isarray-3.0.4.tgz#79e4eb88c36a8122af86f844aa9bcd851b5fbb55"
integrity sha1-eeTriMNqgSKvhvhEqpvNhRtfu1U=
-lodash.isequal@4.5.0, lodash.isequal@^4.0.0, lodash.isequal@^4.5.0:
+lodash.isequal@4.5.0, lodash.isequal@^4.0.0:
version "4.5.0"
resolved "https://registry.yarnpkg.com/lodash.isequal/-/lodash.isequal-4.5.0.tgz#415c4478f2bcc30120c22ce10ed3226f7d3e18e0"
integrity sha1-QVxEePK8wwEgwizhDtMib30+GOA=
-lodash.isfunction@3.0.9:
- version "3.0.9"
- resolved "https://registry.yarnpkg.com/lodash.isfunction/-/lodash.isfunction-3.0.9.tgz#06de25df4db327ac931981d1bdb067e5af68d051"
- integrity sha512-AirXNj15uRIMMPihnkInB4i3NHeb4iBtNg9WRWuK2o31S+ePwwNmDPaTL3o7dTJ+VXNZim7rFs4rxN4YU1oUJw==
-
lodash.isobject@~2.4.1:
version "2.4.1"
resolved "https://registry.yarnpkg.com/lodash.isobject/-/lodash.isobject-2.4.1.tgz#5a2e47fe69953f1ee631a7eba1fe64d2d06558f5"
@@ -12059,11 +11844,6 @@ lodash.throttle@^4.1.1:
resolved "https://registry.yarnpkg.com/lodash.throttle/-/lodash.throttle-4.1.1.tgz#c23e91b710242ac70c37f1e1cda9274cc39bf2f4"
integrity sha1-wj6RtxAkKscMN/HhzaknTMOb8vQ=
-lodash.times@^4.3.2:
- version "4.3.2"
- resolved "https://registry.yarnpkg.com/lodash.times/-/lodash.times-4.3.2.tgz#3e1f2565c431754d54ab57f2ed1741939285ca1d"
- integrity sha1-Ph8lZcQxdU1Uq1fy7RdBk5KFyh0=
-
lodash.unescape@4.0.1:
version "4.0.1"
resolved "https://registry.yarnpkg.com/lodash.unescape/-/lodash.unescape-4.0.1.tgz#bf2249886ce514cda112fae9218cdc065211fc9c"
@@ -12076,12 +11856,12 @@ lodash.values@~2.4.1:
dependencies:
lodash.keys "~2.4.1"
-lodash@4.17.14:
- version "4.17.14"
- resolved "https://registry.yarnpkg.com/lodash/-/lodash-4.17.14.tgz#9ce487ae66c96254fe20b599f21b6816028078ba"
- integrity sha512-mmKYbW3GLuJeX+iGP+Y7Gp1AiGHGbXHCOh/jZmrawMmsE7MS4znI3RL2FsjbqOyMayHInjOeykW7PEajUk1/xw==
+lodash@4.17.19:
+ version "4.17.19"
+ resolved "https://registry.yarnpkg.com/lodash/-/lodash-4.17.19.tgz#e48ddedbe30b3321783c5b4301fbd353bc1e4a4b"
+ integrity sha512-JNvd8XER9GQX0v2qJgsaN/mzFCNA5BRe/j8JN9d+tWyGLSodKQHKFicdwNYzWwI3wjRnaKPsGj1XkBjx/F96DQ==
-lodash@>=2.4.0, lodash@^4.0.0, lodash@^4.0.1, lodash@^4.15.0, lodash@^4.17.10, lodash@^4.17.11, lodash@^4.17.12, lodash@^4.17.13, lodash@^4.17.14, lodash@^4.17.4, lodash@^4.17.5, lodash@^4.3.0, lodash@^4.5.0, lodash@~4.17.10:
+lodash@>=2.4.0, lodash@^4.0.0, lodash@^4.0.1, lodash@^4.17.10, lodash@^4.17.11, lodash@^4.17.12, lodash@^4.17.13, lodash@^4.17.14, lodash@^4.17.4, lodash@^4.17.5, lodash@^4.3.0, lodash@^4.5.0, lodash@~4.17.10:
version "4.17.15"
resolved "https://registry.yarnpkg.com/lodash/-/lodash-4.17.15.tgz#b447f6670a0455bbfeedd11392eff330ea097548"
integrity sha512-8xOcRHvCjnocdS5cpwXQXVzmmh5e5+saE2QGoeQmbKmRS6J3VQppPOIt0MnmE+4xlZoumy0GPG0D0MVIQbNA1A==
@@ -12122,7 +11902,7 @@ lolex@1.3.2:
resolved "https://registry.yarnpkg.com/lolex/-/lolex-1.3.2.tgz#7c3da62ffcb30f0f5a80a2566ca24e45d8a01f31"
integrity sha1-fD2mL/yzDw9agKJWbKJORdigHzE=
-loose-envify@^1.0.0, loose-envify@^1.1.0, loose-envify@^1.2.0, loose-envify@^1.3.1, loose-envify@^1.4.0:
+loose-envify@^1.0.0, loose-envify@^1.1.0, loose-envify@^1.4.0:
version "1.4.0"
resolved "https://registry.yarnpkg.com/loose-envify/-/loose-envify-1.4.0.tgz#71ee51fa7be4caec1a63839f7e682d8132d30caf"
integrity sha512-lyuxPGr/Wfhrlem2CL/UcnUc1zcqKAImBDzukY7Y5F/yQiNdko6+fRLevlw1HgMySw7f611UIY408EtxRSoK3Q==
@@ -12859,15 +12639,6 @@ min-indent@^1.0.0:
resolved "https://registry.yarnpkg.com/min-indent/-/min-indent-1.0.0.tgz#cfc45c37e9ec0d8f0a0ec3dd4ef7f7c3abe39256"
integrity sha1-z8RcN+nsDY8KDsPdTvf3w6vjklY=
-mini-create-react-context@^0.3.0:
- version "0.3.2"
- resolved "https://registry.yarnpkg.com/mini-create-react-context/-/mini-create-react-context-0.3.2.tgz#79fc598f283dd623da8e088b05db8cddab250189"
- integrity sha512-2v+OeetEyliMt5VHMXsBhABoJ0/M4RCe7fatd/fBy6SMiKazUSEt3gxxypfnk2SHMkdBYvorHRoQxuGoiwbzAw==
- dependencies:
- "@babel/runtime" "^7.4.0"
- gud "^1.0.0"
- tiny-warning "^1.0.2"
-
mini-css-extract-plugin@^0.7.0:
version "0.7.0"
resolved "https://registry.yarnpkg.com/mini-css-extract-plugin/-/mini-css-extract-plugin-0.7.0.tgz#5ba8290fbb4179a43dd27cca444ba150bee743a0"
@@ -13018,16 +12789,11 @@ mocha@^2.2.5:
supports-color "1.2.0"
to-iso-string "0.0.2"
-moment@2.24.0, moment@^2.22.2:
+moment@^2.22.2:
version "2.24.0"
resolved "https://registry.yarnpkg.com/moment/-/moment-2.24.0.tgz#0d055d53f5052aa653c9f6eb68bb5d12bf5c2b5b"
integrity sha512-bV7f+6l2QigeBBZSM/6yTNq4P2fNpSWj/0e7jQcy87A8e7o2nAfP/34/2ky5Vw4B9S446EtIhodAzkFCcR4dQg==
-moo@^0.4.3:
- version "0.4.3"
- resolved "https://registry.yarnpkg.com/moo/-/moo-0.4.3.tgz#3f847a26f31cf625a956a87f2b10fbc013bfd10e"
- integrity sha512-gFD2xGCl8YFgGHsqJ9NKRVdwlioeW3mI1iqfLNYQOv0+6JRwG58Zk9DIGQgyIaffSYaO1xsKnMaYzzNr1KyIAw==
-
move-concurrently@^1.0.1:
version "1.0.1"
resolved "https://registry.yarnpkg.com/move-concurrently/-/move-concurrently-1.0.1.tgz#be2c005fda32e0b29af1f05d7c4b33214c701f92"
@@ -13137,17 +12903,6 @@ natural-compare@^1.4.0:
resolved "https://registry.yarnpkg.com/natural-compare/-/natural-compare-1.4.0.tgz#4abebfeed7541f2c27acfb29bdbbd15c8d5ba4f7"
integrity sha1-Sr6/7tdUHywnrPspvbvRXI1bpPc=
-nearley@^2.7.10:
- version "2.19.0"
- resolved "https://registry.yarnpkg.com/nearley/-/nearley-2.19.0.tgz#37717781d0fd0f2bfc95e233ebd75678ca4bda46"
- integrity sha512-2v52FTw7RPqieZr3Gth1luAXZR7Je6q3KaDHY5bjl/paDUdMu35fZ8ICNgiYJRr3tf3NMvIQQR1r27AvEr9CRA==
- dependencies:
- commander "^2.19.0"
- moo "^0.4.3"
- railroad-diagrams "^1.0.0"
- randexp "0.4.6"
- semver "^5.4.1"
-
needle@^2.2.1:
version "2.2.4"
resolved "https://registry.yarnpkg.com/needle/-/needle-2.2.4.tgz#51931bff82533b1928b7d1d69e01f1b00ffd2a4e"
@@ -13468,11 +13223,6 @@ number-is-nan@^1.0.0:
resolved "https://registry.yarnpkg.com/number-is-nan/-/number-is-nan-1.0.1.tgz#097b602b53422a522c1afb8790318336941a011d"
integrity sha1-CXtgK1NCKlIsGvuHkDGDNpQaAR0=
-numeral@2.0.6:
- version "2.0.6"
- resolved "https://registry.yarnpkg.com/numeral/-/numeral-2.0.6.tgz#4ad080936d443c2561aed9f2197efffe25f4e506"
- integrity sha1-StCAk21EPCVhrtnyGX7//iX05QY=
-
nwsapi@^2.0.7:
version "2.1.1"
resolved "https://registry.yarnpkg.com/nwsapi/-/nwsapi-2.1.1.tgz#08d6d75e69fd791bdea31507ffafe8c843b67e9c"
@@ -13517,11 +13267,6 @@ object-inspect@^1.6.0:
resolved "https://registry.yarnpkg.com/object-inspect/-/object-inspect-1.6.0.tgz#c70b6cbf72f274aab4c34c0c82f5167bf82cf15b"
integrity sha512-GJzfBZ6DgDAmnuaM3104jR4s1Myxr3Y3zfIyN4z3UdqN69oSRacNK8UhnobDdC+7J2AHCjGwxQubNJfE70SXXQ==
-object-is@^1.0.1:
- version "1.0.1"
- resolved "https://registry.yarnpkg.com/object-is/-/object-is-1.0.1.tgz#0aa60ec9989a0b3ed795cf4d06f62cf1ad6539b6"
- integrity sha1-CqYOyZiaCz7Xlc9NBvYs8a1lObY=
-
object-keys@^1.0.11, object-keys@^1.0.12, object-keys@^1.1.1:
version "1.1.1"
resolved "https://registry.yarnpkg.com/object-keys/-/object-keys-1.1.1.tgz#1c47f272df277f3b1daf061677d9c82e2322c60e"
@@ -13554,7 +13299,7 @@ object.defaults@^1.1.0:
for-own "^1.0.0"
isobject "^3.0.0"
-object.entries@^1.0.4, object.entries@^1.1.0:
+object.entries@^1.1.0:
version "1.1.0"
resolved "https://registry.yarnpkg.com/object.entries/-/object.entries-1.1.0.tgz#2024fc6d6ba246aee38bdb0ffd5cfbcf371b7519"
integrity sha512-l+H6EQ8qzGRxbkHOd5I/aHRhHDKoQXQ8g0BYt4uSweQU1/J6dZUOyWh9a2Vky35YCKjzmgxOzta2hH6kf9HuXA==
@@ -13564,7 +13309,7 @@ object.entries@^1.0.4, object.entries@^1.1.0:
function-bind "^1.1.1"
has "^1.0.3"
-object.fromentries@^2.0.0, "object.fromentries@^2.0.0 || ^1.0.0", object.fromentries@^2.0.1:
+object.fromentries@^2.0.0, "object.fromentries@^2.0.0 || ^1.0.0":
version "2.0.1"
resolved "https://registry.yarnpkg.com/object.fromentries/-/object.fromentries-2.0.1.tgz#050f077855c7af8ae6649f45c80b16ee2d31e704"
integrity sha512-PUQv8Hbg3j2QX0IQYv3iAGCbGcu4yY4KQ92/dhA4sFSixBmSmp13UpDLs6jGK8rBtbmhNNIK99LD2k293jpiGA==
@@ -13605,7 +13350,7 @@ object.pick@^1.2.0, object.pick@^1.3.0:
dependencies:
isobject "^3.0.1"
-object.values@^1.0.4, object.values@^1.1.0:
+object.values@^1.1.0:
version "1.1.0"
resolved "https://registry.yarnpkg.com/object.values/-/object.values-1.1.0.tgz#bf6810ef5da3e5325790eaaa2be213ea84624da9"
integrity sha512-8mf0nKLAoFX6VlNVdhGj31SVYpaNFtUnuoOXWyFEstsWRgU837AK+JYM0iAxwkSzGRbwn8cbFmgbyxj1j4VbXg==
@@ -14044,13 +13789,6 @@ parse5@4.0.0:
resolved "https://registry.yarnpkg.com/parse5/-/parse5-4.0.0.tgz#6d78656e3da8d78b4ec0b906f7c08ef1dfe3f608"
integrity sha512-VrZ7eOd3T1Fk4XWNXMgiGBK/z0MG48BWG2uQNU4I72fkQuKUTZpl+u9k+CxEG0twMVzSmXEEz12z5Fnw1jIQFA==
-parse5@^3.0.1:
- version "3.0.3"
- resolved "https://registry.yarnpkg.com/parse5/-/parse5-3.0.3.tgz#042f792ffdd36851551cf4e9e066b3874ab45b5c"
- integrity sha512-rgO9Zg5LLLkfJF9E6CCmXlSE4UVceloys8JrFqCcHloC3usd/kJCyPDwH2SOlzix2j3xaP9sUX3e8+kvkuleAA==
- dependencies:
- "@types/node" "\*"
-
parseqs@0.0.5:
version "0.0.5"
resolved "https://registry.yarnpkg.com/parseqs/-/parseqs-0.0.5.tgz#d5208a3738e46766e291ba2ea173684921a8b89d"
@@ -14149,18 +13887,6 @@ path-to-regexp@0.1.7:
resolved "https://registry.yarnpkg.com/path-to-regexp/-/path-to-regexp-0.1.7.tgz#df604178005f522f15eb4490e7247a1bfaa67f8c"
integrity sha1-32BBeABfUi8V60SQ5yR6G/qmf4w=
-path-to-regexp@3.0.0:
- version "3.0.0"
- resolved "https://registry.yarnpkg.com/path-to-regexp/-/path-to-regexp-3.0.0.tgz#c981a218f3df543fa28696be2f88e0c58d2e012a"
- integrity sha512-ZOtfhPttCrqp2M1PBBH4X13XlvnfhIwD7yCLx+GoGoXRPQyxGOTdQMpIzPSPKXAJT/JQrdfFrgdJOyAzvgpQ9A==
-
-path-to-regexp@^1.7.0:
- version "1.7.0"
- resolved "https://registry.yarnpkg.com/path-to-regexp/-/path-to-regexp-1.7.0.tgz#59fde0f435badacba103a84e9d3bc64e96b9937d"
- integrity sha1-Wf3g9DW62suhA6hOnTvGTpa5k30=
- dependencies:
- isarray "0.0.1"
-
path-type@^1.0.0:
version "1.1.0"
resolved "https://registry.yarnpkg.com/path-type/-/path-type-1.1.0.tgz#59c44f7ee491da704da415da5a4070ba4f8fe441"
@@ -14584,16 +14310,7 @@ prompts@^2.0.1:
kleur "^3.0.2"
sisteransi "^1.0.0"
-prop-types-exact@^1.2.0:
- version "1.2.0"
- resolved "https://registry.yarnpkg.com/prop-types-exact/-/prop-types-exact-1.2.0.tgz#825d6be46094663848237e3925a98c6e944e9869"
- integrity sha512-K+Tk3Kd9V0odiXFP9fwDHUYRyvK3Nun3GVyPapSIs5OBkITAm15W0CPFD/YKTkMUAbc0b9CUwRQp2ybiBIq+eA==
- dependencies:
- has "^1.0.3"
- object.assign "^4.1.0"
- reflect.ownkeys "^0.2.0"
-
-prop-types@15.7.2, prop-types@^15.5.10, prop-types@^15.5.6, prop-types@^15.5.8, prop-types@^15.6.0, prop-types@^15.6.1, prop-types@^15.6.2, prop-types@^15.7.2:
+prop-types@15.7.2, prop-types@^15.5.10, prop-types@^15.5.8, prop-types@^15.6.0, prop-types@^15.6.1, prop-types@^15.6.2, prop-types@^15.7.2:
version "15.7.2"
resolved "https://registry.yarnpkg.com/prop-types/-/prop-types-15.7.2.tgz#52c41e75b8c87e72b9d9360e0206b99dcbffa6c5"
integrity sha512-8QQikdH7//R2vurIJSutZ1smHYTcLpRWEOlHnzcWHmBYrOGUysKwSsrC89BCiFj3CbrfJ/nXFdJepOVrY1GCHQ==
@@ -14778,24 +14495,11 @@ raf@^3.4.0:
dependencies:
performance-now "^2.1.0"
-railroad-diagrams@^1.0.0:
- version "1.0.0"
- resolved "https://registry.yarnpkg.com/railroad-diagrams/-/railroad-diagrams-1.0.0.tgz#eb7e6267548ddedfb899c1b90e57374559cddb7e"
- integrity sha1-635iZ1SN3t+4mcG5Dlc3RVnN234=
-
ramda@^0.21.0:
version "0.21.0"
resolved "https://registry.yarnpkg.com/ramda/-/ramda-0.21.0.tgz#a001abedb3ff61077d4ff1d577d44de77e8d0a35"
integrity sha1-oAGr7bP/YQd9T/HVd9RN536NCjU=
-randexp@0.4.6:
- version "0.4.6"
- resolved "https://registry.yarnpkg.com/randexp/-/randexp-0.4.6.tgz#e986ad5e5e31dae13ddd6f7b3019aa7c87f60ca3"
- integrity sha512-80WNmd9DA0tmZrw9qQa62GPPWfuXJknrmVmLcxvq4uZBdYqb1wYoKTmnlGUchvVWe0XiLupYkBoXVOxz3C8DYQ==
- dependencies:
- discontinuous-range "1.0.0"
- ret "~0.1.10"
-
randomatic@^3.0.0:
version "3.1.1"
resolved "https://registry.yarnpkg.com/randomatic/-/randomatic-3.1.1.tgz#b776efc59375984e36c537b2f51a1f0aff0da1ed"
@@ -14861,16 +14565,6 @@ rc@^1.0.1, rc@^1.1.6, rc@^1.2.7:
minimist "^1.2.0"
strip-json-comments "~2.0.1"
-react-billboardjs@^1.4.3:
- version "1.5.3"
- resolved "https://registry.yarnpkg.com/react-billboardjs/-/react-billboardjs-1.5.3.tgz#7dad31759ba9131c630b5423ab2b2935c532ebcb"
- integrity sha512-42VloMbgUfiAbux2n2TXtXd9iB93MhtA93SS7dfWXXgfXjdqrEZdd7RDBHBAf2SYFGR67QqULiqrAG3/OT+wEg==
- dependencies:
- billboard.js "^1.6.0"
- fbjs "^1.0.0"
- prop-types "^15.7.2"
- react-parm "^2.3.0"
-
react-clientside-effect@^1.2.0:
version "1.2.2"
resolved "https://registry.yarnpkg.com/react-clientside-effect/-/react-clientside-effect-1.2.2.tgz#6212fb0e07b204e714581dd51992603d1accc837"
@@ -15036,7 +14730,7 @@ react-inspector@^3.0.2:
is-dom "^1.0.9"
prop-types "^15.6.1"
-react-is@^16.6.0, react-is@^16.7.0, react-is@^16.8.1, react-is@^16.8.4, react-is@^16.8.6, react-is@^16.9.0:
+react-is@^16.7.0, react-is@^16.8.1, react-is@^16.8.4, react-is@^16.8.6:
version "16.10.2"
resolved "https://registry.yarnpkg.com/react-is/-/react-is-16.10.2.tgz#984120fd4d16800e9a738208ab1fba422d23b5ab"
integrity sha512-INBT1QEgtcCCgvccr5/86CfD71fw9EPmDxgiJX4I2Ddr6ZsV6iFXsuby+qWJPtmNuMY0zByTsG4468P7nHuNWA==
@@ -15046,11 +14740,6 @@ react-lifecycles-compat@^3.0.2, react-lifecycles-compat@^3.0.4:
resolved "https://registry.yarnpkg.com/react-lifecycles-compat/-/react-lifecycles-compat-3.0.4.tgz#4f1a273afdfc8f3488a8c516bfda78f872352362"
integrity sha512-fBASbA6LnOU9dOU2eW7aQ8xmYBSXUIWr+UmF9b1efZBazGNO+rcXT/icdKnYm2pTwcRylVUYwW7H1PHfLekVzA==
-react-parm@^2.3.0:
- version "2.7.1"
- resolved "https://registry.yarnpkg.com/react-parm/-/react-parm-2.7.1.tgz#bc26afa797d15e377b6f5f239e0a95b05d1eb1de"
- integrity sha512-MLBxiHT2jTXJLe/oMMXn587BaeNUc5GqXTgRtfiEdjQgF0QIwzIybZaeMT1Q6cFfcHzjdiQKjmFQrIIHSaPYNw==
-
react-popper-tooltip@^2.8.3:
version "2.8.3"
resolved "https://registry.yarnpkg.com/react-popper-tooltip/-/react-popper-tooltip-2.8.3.tgz#1c63e7473a96362bd93be6c94fa404470a265197"
@@ -15094,35 +14783,6 @@ react-resize-detector@^4.0.5:
raf-schd "^4.0.0"
resize-observer-polyfill "^1.5.1"
-react-router-dom@5.0.1:
- version "5.0.1"
- resolved "https://registry.yarnpkg.com/react-router-dom/-/react-router-dom-5.0.1.tgz#ee66f4a5d18b6089c361958e443489d6bab714be"
- integrity sha512-zaVHSy7NN0G91/Bz9GD4owex5+eop+KvgbxXsP/O+iW1/Ln+BrJ8QiIR5a6xNPtrdTvLkxqlDClx13QO1uB8CA==
- dependencies:
- "@babel/runtime" "^7.1.2"
- history "^4.9.0"
- loose-envify "^1.3.1"
- prop-types "^15.6.2"
- react-router "5.0.1"
- tiny-invariant "^1.0.2"
- tiny-warning "^1.0.0"
-
-react-router@5.0.1:
- version "5.0.1"
- resolved "https://registry.yarnpkg.com/react-router/-/react-router-5.0.1.tgz#04ee77df1d1ab6cb8939f9f01ad5702dbadb8b0f"
- integrity sha512-EM7suCPNKb1NxcTZ2LEOWFtQBQRQXecLxVpdsP4DW4PbbqYWeRiLyV/Tt1SdCrvT2jcyXAXmVTmzvSzrPR63Bg==
- dependencies:
- "@babel/runtime" "^7.1.2"
- history "^4.9.0"
- hoist-non-react-statics "^3.1.0"
- loose-envify "^1.3.1"
- mini-create-react-context "^0.3.0"
- path-to-regexp "^1.7.0"
- prop-types "^15.6.2"
- react-is "^16.6.0"
- tiny-invariant "^1.0.2"
- tiny-warning "^1.0.0"
-
react-select@^2.2.0:
version "2.4.4"
resolved "https://registry.yarnpkg.com/react-select/-/react-select-2.4.4.tgz#ba72468ef1060c7d46fbb862b0748f96491f1f73"
@@ -15157,23 +14817,6 @@ react-syntax-highlighter@^8.0.1:
prismjs "^1.8.4"
refractor "^2.4.1"
-react-test-renderer@^16.0.0-0:
- version "16.10.2"
- resolved "https://registry.yarnpkg.com/react-test-renderer/-/react-test-renderer-16.10.2.tgz#4d8492f8678c9b43b721a7d79ed0840fdae7c518"
- integrity sha512-k9Qzyev6cTIcIfrhgrFlYQAFxh5EEDO6ALNqYqmKsWVA7Q/rUMTay5nD3nthi6COmYsd4ghVYyi8U86aoeMqYQ==
- dependencies:
- object-assign "^4.1.1"
- prop-types "^15.6.2"
- react-is "^16.8.6"
- scheduler "^0.16.2"
-
-react-text-mask@5.4.3:
- version "5.4.3"
- resolved "https://registry.yarnpkg.com/react-text-mask/-/react-text-mask-5.4.3.tgz#991efb4299e30c2e6c2c46d13f617169463e0d2d"
- integrity sha1-mR77QpnjDC5sLEbRP2FxaUY+DS0=
- dependencies:
- prop-types "^15.5.6"
-
react-textarea-autosize@^7.1.0:
version "7.1.0"
resolved "https://registry.yarnpkg.com/react-textarea-autosize/-/react-textarea-autosize-7.1.0.tgz#3132cb77e65d94417558d37c0bfe415a5afd3445"
@@ -15420,11 +15063,6 @@ redux@^4.0.1:
loose-envify "^1.4.0"
symbol-observable "^1.2.0"
-reflect.ownkeys@^0.2.0:
- version "0.2.0"
- resolved "https://registry.yarnpkg.com/reflect.ownkeys/-/reflect.ownkeys-0.2.0.tgz#749aceec7f3fdf8b63f927a04809e90c5c0b3460"
- integrity sha1-dJrO7H8/34tj+SegSAnpDFwLNGA=
-
refractor@^2.4.1:
version "2.10.0"
resolved "https://registry.yarnpkg.com/refractor/-/refractor-2.10.0.tgz#4cc7efc0028a87924a9b31d82d129dec831a287b"
@@ -15753,11 +15391,6 @@ resolve-from@^5.0.0:
resolved "https://registry.yarnpkg.com/resolve-from/-/resolve-from-5.0.0.tgz#c35225843df8f776df21c57557bc087e9dfdfc69"
integrity sha512-qYg9KP24dD5qka9J47d0aVky0N+b4fTU89LN9iDnjB5waksiC49rvMB0PrUJQGoTmH50XPiqOvAjDfaijGxYZw==
-resolve-pathname@^3.0.0:
- version "3.0.0"
- resolved "https://registry.yarnpkg.com/resolve-pathname/-/resolve-pathname-3.0.0.tgz#99d02224d3cf263689becbb393bc560313025dcd"
- integrity sha512-C7rARubxI8bXFNB/hqcp/4iUeIXJhJZvFPFPiSPRnhU5UPxzMFIl+2E6yY6c4k9giDJAhtV+enfA+G89N6Csng==
-
resolve-url@^0.2.1:
version "0.2.1"
resolved "https://registry.yarnpkg.com/resolve-url/-/resolve-url-0.2.1.tgz#2c637fe77c893afd2a663fe21aa9080068e2052a"
@@ -15833,14 +15466,6 @@ ripemd160@^2.0.0, ripemd160@^2.0.1:
hash-base "^3.0.0"
inherits "^2.0.1"
-rst-selector-parser@^2.2.3:
- version "2.2.3"
- resolved "https://registry.yarnpkg.com/rst-selector-parser/-/rst-selector-parser-2.2.3.tgz#81b230ea2fcc6066c89e3472de794285d9b03d91"
- integrity sha1-gbIw6i/MYGbInjRy3nlChdmwPZE=
- dependencies:
- lodash.flattendeep "^4.4.0"
- nearley "^2.7.10"
-
rsvp@^4.8.4:
version "4.8.4"
resolved "https://registry.yarnpkg.com/rsvp/-/rsvp-4.8.4.tgz#b50e6b34583f3dd89329a2f23a8a2be072845911"
@@ -16000,14 +15625,6 @@ scheduler@^0.15.0:
loose-envify "^1.1.0"
object-assign "^4.1.1"
-scheduler@^0.16.2:
- version "0.16.2"
- resolved "https://registry.yarnpkg.com/scheduler/-/scheduler-0.16.2.tgz#f74cd9d33eff6fc554edfb79864868e4819132c1"
- integrity sha512-BqYVWqwz6s1wZMhjFvLfVR5WXP7ZY32M/wYPo04CcuPM7XZEbV2TBNW7Z0UkguPTl0dWMA59VbNXxK6q+pHItg==
- dependencies:
- loose-envify "^1.1.0"
- object-assign "^4.1.1"
-
schema-utils@^0.4.5:
version "0.4.7"
resolved "https://registry.yarnpkg.com/schema-utils/-/schema-utils-0.4.7.tgz#ba74f597d2be2ea880131746ee17d0a093c68187"
@@ -16058,7 +15675,7 @@ selfsigned@^1.10.4:
dependencies:
node-forge "0.7.5"
-"semver@2 || 3 || 4 || 5", semver@^5.0.1, semver@^5.3.0, semver@^5.4.1, semver@^5.5.0, semver@^5.5.1, semver@^5.6.0, semver@^5.7.0:
+"semver@2 || 3 || 4 || 5", semver@^5.0.1, semver@^5.3.0, semver@^5.4.1, semver@^5.5.0, semver@^5.5.1, semver@^5.6.0:
version "5.7.1"
resolved "https://registry.yarnpkg.com/semver/-/semver-5.7.1.tgz#a954f931aeba508d307bbf069eff0c01c96116f7"
integrity sha512-sauaDf/PZdVgrLTNYHRtpXa1iRiKcaebiKQ1BJdpQlWH2lCvexQdX55snPFyK7QzpudqbCI0qXFfOasHdyNDGQ==
@@ -16874,20 +16491,6 @@ string.prototype.padstart@^3.0.0:
es-abstract "^1.4.3"
function-bind "^1.0.2"
-string.prototype.startswith@0.2.0:
- version "0.2.0"
- resolved "https://registry.yarnpkg.com/string.prototype.startswith/-/string.prototype.startswith-0.2.0.tgz#da68982e353a4e9ac4a43b450a2045d1c445ae7b"
- integrity sha1-2miYLjU6TprEpDtFCiBF0cRFrns=
-
-string.prototype.trim@^1.1.2:
- version "1.2.0"
- resolved "https://registry.yarnpkg.com/string.prototype.trim/-/string.prototype.trim-1.2.0.tgz#75a729b10cfc1be439543dae442129459ce61e3d"
- integrity sha512-9EIjYD/WdlvLpn987+ctkLf0FfvBefOCuiEr2henD8X+7jfwPnyvTdmW8OJhj5p+M0/96mBdynLWkxUr+rHlpg==
- dependencies:
- define-properties "^1.1.3"
- es-abstract "^1.13.0"
- function-bind "^1.1.1"
-
string.prototype.trimleft@^2.1.0:
version "2.1.0"
resolved "https://registry.yarnpkg.com/string.prototype.trimleft/-/string.prototype.trimleft-2.1.0.tgz#6cc47f0d7eb8d62b0f3701611715a3954591d634"
@@ -17262,7 +16865,7 @@ test-exclude@^5.0.0:
read-pkg-up "^4.0.0"
require-main-filename "^1.0.1"
-text-mask-addons@3.8.0, text-mask-addons@^3.7.1:
+text-mask-addons@^3.7.1:
version "3.8.0"
resolved "https://registry.yarnpkg.com/text-mask-addons/-/text-mask-addons-3.8.0.tgz#17b61ef665a4f36811f2ea1f01a223b4be61ab26"
integrity sha1-F7Ye9mWk82gR8uofAaIjtL5hqyY=
@@ -17381,11 +16984,6 @@ tiny-emitter@^2.0.0:
resolved "https://registry.yarnpkg.com/tiny-emitter/-/tiny-emitter-2.1.0.tgz#1d1a56edfc51c43e863cbb5382a72330e3555423"
integrity sha512-NB6Dk1A9xgQPMoGqC5CVXn123gWyte215ONT5Pp5a0yt4nlEoO1ZWeCwpncaekPHXO60i47ihFnZPiRPjRMq4Q==
-tiny-invariant@^1.0.2:
- version "1.0.6"
- resolved "https://registry.yarnpkg.com/tiny-invariant/-/tiny-invariant-1.0.6.tgz#b3f9b38835e36a41c843a3b0907a5a7b3755de73"
- integrity sha512-FOyLWWVjG+aC0UqG76V53yAWdXfH8bO6FNmyZOuUrzDzK8DI3/JRY25UD7+g49JWM1LXwymsKERB+DzI0dTEQA==
-
tiny-lr@^1.1.1:
version "1.1.1"
resolved "https://registry.yarnpkg.com/tiny-lr/-/tiny-lr-1.1.1.tgz#9fa547412f238fedb068ee295af8b682c98b2aab"
@@ -17398,7 +16996,7 @@ tiny-lr@^1.1.1:
object-assign "^4.1.0"
qs "^6.4.0"
-tiny-warning@^1.0.0, tiny-warning@^1.0.2:
+tiny-warning@^1.0.2:
version "1.0.3"
resolved "https://registry.yarnpkg.com/tiny-warning/-/tiny-warning-1.0.3.tgz#94a30db453df4c643d0fd566060d60a875d84754"
integrity sha512-lBN9zLN/oAf68o3zNXYrdCt1kP8WsiGW8Oo2ka41b2IM5JL/S1CTyX1rW0mb/zSuJun0ZUrDxx4sqvYS2FWzPA==
@@ -17913,11 +17511,6 @@ validate-npm-package-license@^3.0.1:
spdx-correct "^3.0.0"
spdx-expression-parse "^3.0.0"
-value-equal@^1.0.1:
- version "1.0.1"
- resolved "https://registry.yarnpkg.com/value-equal/-/value-equal-1.0.1.tgz#1e0b794c734c5c0cade179c437d356d931a34d6c"
- integrity sha512-NOJ6JZCAWr0zlxZt+xqCHNTEKOsrks2HQd4MqhP1qy4z1SkbEP467eNx6TgDKXMvUOb+OENfJCZwM+16n7fRfw==
-
vanilla-text-mask@^5.0.1:
version "5.1.1"
resolved "https://registry.yarnpkg.com/vanilla-text-mask/-/vanilla-text-mask-5.1.1.tgz#f854819b2785191cef651e3ee94869f45855f365"
diff --git a/nbproject/project.properties b/nbproject/project.properties
index 6a04dec36fa7b7..ab6c5d39165464 100644
--- a/nbproject/project.properties
+++ b/nbproject/project.properties
@@ -230,6 +230,7 @@ javac.classpath=\
lib/portal/slf4j-api.jar:\
lib/portal/soap.jar:\
lib/portal/soap-api.jar:\
+ lib/portal/sparse-bit-set.jar:\
lib/portal/spring-aop.jar:\
lib/portal/spring-aspects.jar:\
lib/portal/spring-beans.jar:\
diff --git a/portal-impl/src/com/liferay/portal/action/JSONServiceAction.java b/portal-impl/src/com/liferay/portal/action/JSONServiceAction.java
index 011a96555fa24f..ebb88932d6c67b 100644
--- a/portal-impl/src/com/liferay/portal/action/JSONServiceAction.java
+++ b/portal-impl/src/com/liferay/portal/action/JSONServiceAction.java
@@ -34,6 +34,7 @@
import com.liferay.portal.kernel.util.LocaleUtil;
import com.liferay.portal.kernel.util.LocalizationUtil;
import com.liferay.portal.kernel.util.ParamUtil;
+import com.liferay.portal.kernel.util.PortalUtil;
import com.liferay.portal.kernel.util.SetUtil;
import com.liferay.portal.kernel.util.StringUtil;
import com.liferay.portal.kernel.util.Validator;
@@ -161,7 +162,15 @@ public String getJSON(
e);
}
- return JSONFactoryUtil.serializeThrowable(e);
+ if (PropsValues.JSON\_SERVICE\_SERIALIZE\_THROWABLE) {
+ return JSONFactoryUtil.serializeThrowable(e);
+ }
+
+ PortalUtil.sendError(
+ HttpServletResponse.SC\_INTERNAL\_SERVER\_ERROR, e,
+ httpServletRequest, httpServletResponse);
+
+ return JSONFactoryUtil.getNullJSON();
}
}
diff --git a/portal-impl/src/com/liferay/portal/jsonwebservice/JSONWebServiceServiceAction.java b/portal-impl/src/com/liferay/portal/jsonwebservice/JSONWebServiceServiceAction.java
index 37fce3ef661318..795d1c57da6ce4 100644
--- a/portal-impl/src/com/liferay/portal/jsonwebservice/JSONWebServiceServiceAction.java
+++ b/portal-impl/src/com/liferay/portal/jsonwebservice/JSONWebServiceServiceAction.java
@@ -58,7 +58,11 @@ public String getJSON(
WebKeys.UPLOAD\_EXCEPTION);
if (uploadException != null) {
- return JSONFactoryUtil.serializeThrowable(uploadException);
+ if (PropsValues.JSON\_SERVICE\_SERIALIZE\_THROWABLE) {
+ return JSONFactoryUtil.serializeThrowable(uploadException);
+ }
+
+ return JSONFactoryUtil.getNullJSON();
}
try {
@@ -90,7 +94,11 @@ else if (throwable instanceof NoSuchModelException) {
httpServletResponse.setStatus(HttpServletResponse.SC\_NOT\_FOUND);
- return JSONFactoryUtil.serializeThrowable(throwable);
+ if (PropsValues.JSON\_SERVICE\_SERIALIZE\_THROWABLE) {
+ return JSONFactoryUtil.serializeThrowable(throwable);
+ }
+
+ return JSONFactoryUtil.getNullJSON();
}
else if (throwable instanceof PrincipalException ||
throwable instanceof SecurityException) {
@@ -101,7 +109,11 @@ else if (throwable instanceof PrincipalException ||
httpServletResponse.setStatus(HttpServletResponse.SC\_FORBIDDEN);
- return JSONFactoryUtil.serializeThrowable(throwable);
+ if (PropsValues.JSON\_SERVICE\_SERIALIZE\_THROWABLE) {
+ return JSONFactoryUtil.serializeThrowable(throwable);
+ }
+
+ return JSONFactoryUtil.getNullJSON();
}
else {
status = HttpServletResponse.SC\_INTERNAL\_SERVER\_ERROR;
@@ -116,7 +128,11 @@ else if (throwable instanceof PrincipalException ||
httpServletResponse.setStatus(status);
- return JSONFactoryUtil.serializeThrowable(throwable);
+ if (PropsValues.JSON\_SERVICE\_SERIALIZE\_THROWABLE) {
+ return JSONFactoryUtil.serializeThrowable(throwable);
+ }
+
+ return JSONFactoryUtil.getNullJSON();
}
}
diff --git a/portal-impl/src/com/liferay/portal/service/http/LayoutServiceHttp.java b/portal-impl/src/com/liferay/portal/service/http/LayoutServiceHttp.java
index efb63c7938bd7b..8ca5b7313711c8 100644
--- a/portal-impl/src/com/liferay/portal/service/http/LayoutServiceHttp.java
+++ b/portal-impl/src/com/liferay/portal/service/http/LayoutServiceHttp.java
@@ -833,13 +833,58 @@ public static long getLayoutPlid(
}
public static java.util.List
- getLayouts(HttpPrincipal httpPrincipal, long groupId, String type) {
+ getLayouts(
+ HttpPrincipal httpPrincipal, long groupId,
+ boolean privateLayout, String keywords, String[] types,
+ int start, int end,
+ com.liferay.portal.kernel.util.OrderByComparator
+  obc)
+ throws com.liferay.portal.kernel.exception.PortalException {
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "getLayouts",
\_getLayoutsParameterTypes20);
+ MethodHandler methodHandler = new MethodHandler(
+ methodKey, groupId, privateLayout, keywords, types, start, end,
+ obc);
+
+ Object returnObj = null;
+
+ try {
+ returnObj = TunnelUtil.invoke(httpPrincipal, methodHandler);
+ }
+ catch (Exception e) {
+ if (e instanceof
+ com.liferay.portal.kernel.exception.PortalException) {
+
+ throw (com.liferay.portal.kernel.exception.PortalException)
+ e;
+ }
+
+ throw new com.liferay.portal.kernel.exception.SystemException(
+ e);
+ }
+
+ return (java.util.List)
+ returnObj;
+ }
+ catch (com.liferay.portal.kernel.exception.SystemException se) {
+ \_log.error(se, se);
+
+ throw se;
+ }
+ }
+
+ public static java.util.List
+ getLayouts(HttpPrincipal httpPrincipal, long groupId, String type) {
+
+ try {
+ MethodKey methodKey = new MethodKey(
+ LayoutServiceUtil.class, "getLayouts",
+ \_getLayoutsParameterTypes21);
+
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, type);
@@ -871,7 +916,7 @@ public static long getLayoutPlid(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "getLayouts",
- \_getLayoutsParameterTypes21);
+ \_getLayoutsParameterTypes22);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, type, start, end);
@@ -902,7 +947,7 @@ public static int getLayoutsCount(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "getLayoutsCount",
- \_getLayoutsCountParameterTypes22);
+ \_getLayoutsCountParameterTypes23);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, privateLayout);
@@ -933,7 +978,7 @@ public static int getLayoutsCount(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "getLayoutsCount",
- \_getLayoutsCountParameterTypes23);
+ \_getLayoutsCountParameterTypes24);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, privateLayout, parentLayoutId);
@@ -964,7 +1009,7 @@ public static int getLayoutsCount(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "getLayoutsCount",
- \_getLayoutsCountParameterTypes24);
+ \_getLayoutsCountParameterTypes25);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, privateLayout, parentLayoutId, priority);
@@ -988,13 +1033,52 @@ public static int getLayoutsCount(
}
}
+ public static int getLayoutsCount(
+ HttpPrincipal httpPrincipal, long groupId, boolean privateLayout,
+ String keywords, String[] types)
+ throws com.liferay.portal.kernel.exception.PortalException {
+
+ try {
+ MethodKey methodKey = new MethodKey(
+ LayoutServiceUtil.class, "getLayoutsCount",
+ \_getLayoutsCountParameterTypes26);
+
+ MethodHandler methodHandler = new MethodHandler(
+ methodKey, groupId, privateLayout, keywords, types);
+
+ Object returnObj = null;
+
+ try {
+ returnObj = TunnelUtil.invoke(httpPrincipal, methodHandler);
+ }
+ catch (Exception e) {
+ if (e instanceof
+ com.liferay.portal.kernel.exception.PortalException) {
+
+ throw (com.liferay.portal.kernel.exception.PortalException)
+ e;
+ }
+
+ throw new com.liferay.portal.kernel.exception.SystemException(
+ e);
+ }
+
+ return ((Integer)returnObj).intValue();
+ }
+ catch (com.liferay.portal.kernel.exception.SystemException se) {
+ \_log.error(se, se);
+
+ throw se;
+ }
+ }
+
public static int getLayoutsCount(
HttpPrincipal httpPrincipal, long groupId, String type) {
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "getLayoutsCount",
- \_getLayoutsCountParameterTypes25);
+ \_getLayoutsCountParameterTypes27);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, type);
@@ -1025,7 +1109,7 @@ public static String[] getTempFileNames(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "getTempFileNames",
- \_getTempFileNamesParameterTypes26);
+ \_getTempFileNamesParameterTypes28);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, folderName);
@@ -1064,7 +1148,7 @@ public static boolean hasLayout(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "hasLayout",
- \_hasLayoutParameterTypes27);
+ \_hasLayoutParameterTypes29);
MethodHandler methodHandler = new MethodHandler(
methodKey, uuid, groupId, privateLayout);
@@ -1102,7 +1186,7 @@ public static boolean hasPortletId(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "hasPortletId",
- \_hasPortletIdParameterTypes28);
+ \_hasPortletIdParameterTypes30);
MethodHandler methodHandler = new MethodHandler(
methodKey, plid, portletId);
@@ -1144,7 +1228,7 @@ public static void schedulePublishToLive(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "schedulePublishToLive",
- \_schedulePublishToLiveParameterTypes29);
+ \_schedulePublishToLiveParameterTypes31);
MethodHandler methodHandler = new MethodHandler(
methodKey, sourceGroupId, targetGroupId, privateLayout,
@@ -1187,7 +1271,7 @@ public static void schedulePublishToRemote(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "schedulePublishToRemote",
- \_schedulePublishToRemoteParameterTypes30);
+ \_schedulePublishToRemoteParameterTypes32);
MethodHandler methodHandler = new MethodHandler(
methodKey, sourceGroupId, privateLayout, layoutIdMap,
@@ -1227,7 +1311,7 @@ public static void setLayouts(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "setLayouts",
- \_setLayoutsParameterTypes31);
+ \_setLayoutsParameterTypes33);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, privateLayout, parentLayoutId, layoutIds,
@@ -1263,7 +1347,7 @@ public static void unschedulePublishToLive(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "unschedulePublishToLive",
- \_unschedulePublishToLiveParameterTypes32);
+ \_unschedulePublishToLiveParameterTypes34);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, jobName, groupName);
@@ -1298,7 +1382,7 @@ public static void unschedulePublishToRemote(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "unschedulePublishToRemote",
- \_unschedulePublishToRemoteParameterTypes33);
+ \_unschedulePublishToRemoteParameterTypes35);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, jobName, groupName);
@@ -1332,7 +1416,7 @@ public static com.liferay.portal.kernel.model.Layout updateIconImage(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "updateIconImage",
- \_updateIconImageParameterTypes34);
+ \_updateIconImageParameterTypes36);
MethodHandler methodHandler = new MethodHandler(
methodKey, plid, bytes);
@@ -1380,7 +1464,7 @@ public static com.liferay.portal.kernel.model.Layout updateLayout(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "updateLayout",
- \_updateLayoutParameterTypes35);
+ \_updateLayoutParameterTypes37);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, privateLayout, layoutId, parentLayoutId,
@@ -1422,7 +1506,7 @@ public static com.liferay.portal.kernel.model.Layout updateLayout(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "updateLayout",
- \_updateLayoutParameterTypes36);
+ \_updateLayoutParameterTypes38);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, privateLayout, layoutId, typeSettings);
@@ -1461,7 +1545,7 @@ public static com.liferay.portal.kernel.model.Layout updateLookAndFeel(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "updateLookAndFeel",
- \_updateLookAndFeelParameterTypes37);
+ \_updateLookAndFeelParameterTypes39);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, privateLayout, layoutId, themeId,
@@ -1501,7 +1585,7 @@ public static com.liferay.portal.kernel.model.Layout updateName(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "updateName",
- \_updateNameParameterTypes38);
+ \_updateNameParameterTypes40);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, privateLayout, layoutId, name, languageId);
@@ -1540,7 +1624,7 @@ public static com.liferay.portal.kernel.model.Layout updateName(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "updateName",
- \_updateNameParameterTypes39);
+ \_updateNameParameterTypes41);
MethodHandler methodHandler = new MethodHandler(
methodKey, plid, name, languageId);
@@ -1579,7 +1663,7 @@ public static com.liferay.portal.kernel.model.Layout updateParentLayoutId(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "updateParentLayoutId",
- \_updateParentLayoutIdParameterTypes40);
+ \_updateParentLayoutIdParameterTypes42);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, privateLayout, layoutId, parentLayoutId);
@@ -1617,7 +1701,7 @@ public static com.liferay.portal.kernel.model.Layout updateParentLayoutId(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "updateParentLayoutId",
- \_updateParentLayoutIdParameterTypes41);
+ \_updateParentLayoutIdParameterTypes43);
MethodHandler methodHandler = new MethodHandler(
methodKey, plid, parentPlid);
@@ -1657,7 +1741,7 @@ public static com.liferay.portal.kernel.model.Layout updateParentLayoutId(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "updateParentLayoutIdAndPriority",
- \_updateParentLayoutIdAndPriorityParameterTypes42);
+ \_updateParentLayoutIdAndPriorityParameterTypes44);
MethodHandler methodHandler = new MethodHandler(
methodKey, plid, parentPlid, priority);
@@ -1696,7 +1780,7 @@ public static com.liferay.portal.kernel.model.Layout updatePriority(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "updatePriority",
- \_updatePriorityParameterTypes43);
+ \_updatePriorityParameterTypes45);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, privateLayout, layoutId, priority);
@@ -1735,7 +1819,7 @@ public static com.liferay.portal.kernel.model.Layout updatePriority(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "updatePriority",
- \_updatePriorityParameterTypes44);
+ \_updatePriorityParameterTypes46);
MethodHandler methodHandler = new MethodHandler(
methodKey, groupId, privateLayout, layoutId, nextLayoutId,
@@ -1774,7 +1858,7 @@ public static com.liferay.portal.kernel.model.Layout updatePriority(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "updatePriority",
- \_updatePriorityParameterTypes45);
+ \_updatePriorityParameterTypes47);
MethodHandler methodHandler = new MethodHandler(
methodKey, plid, priority);
@@ -1812,7 +1896,7 @@ public static com.liferay.portal.kernel.model.Layout updateType(
try {
MethodKey methodKey = new MethodKey(
LayoutServiceUtil.class, "updateType",
- \_updateTypeParameterTypes46);
+ \_updateTypeParameterTypes48);
MethodHandler methodHandler = new MethodHandler(
methodKey, plid, type);
@@ -1910,33 +1994,39 @@ public static com.liferay.portal.kernel.model.Layout updateType(
long.class, boolean.class, String.class
};
private static final Class [] \_getLayoutsParameterTypes20 = new Class[] {
- long.class, String.class
+ long.class, boolean.class, String.class, String[].class, int.class,
+ int.class, com.liferay.portal.kernel.util.OrderByComparator.class
};
private static final Class [] \_getLayoutsParameterTypes21 = new Class[] {
+ long.class, String.class
+ };
+ private static final Class [] \_getLayoutsParameterTypes22 = new Class[] {
long.class, String.class, int.class, int.class
};
- private static final Class [] \_getLayoutsCountParameterTypes22 =
- new Class[] {long.class, boolean.class};
private static final Class [] \_getLayoutsCountParameterTypes23 =
- new Class[] {long.class, boolean.class, long.class};
+ new Class[] {long.class, boolean.class};
private static final Class [] \_getLayoutsCountParameterTypes24 =
- new Class[] {long.class, boolean.class, long.class, int.class};
+ new Class[] {long.class, boolean.class, long.class};
private static final Class [] \_getLayoutsCountParameterTypes25 =
+ new Class[] {long.class, boolean.class, long.class, int.class};
+ private static final Class [] \_getLayoutsCountParameterTypes26 =
+ new Class[] {long.class, boolean.class, String.class, String[].class};
+ private static final Class [] \_getLayoutsCountParameterTypes27 =
new Class[] {long.class, String.class};
- private static final Class [] \_getTempFileNamesParameterTypes26 =
+ private static final Class [] \_getTempFileNamesParameterTypes28 =
new Class[] {long.class, String.class};
- private static final Class [] \_hasLayoutParameterTypes27 = new Class[] {
+ private static final Class [] \_hasLayoutParameterTypes29 = new Class[] {
String.class, long.class, boolean.class
};
- private static final Class [] \_hasPortletIdParameterTypes28 =
+ private static final Class [] \_hasPortletIdParameterTypes30 =
new Class[] {long.class, String.class};
- private static final Class [] \_schedulePublishToLiveParameterTypes29 =
+ private static final Class [] \_schedulePublishToLiveParameterTypes31 =
new Class[] {
long.class, long.class, boolean.class, long[].class,
java.util.Map.class, String.class, String.class,
java.util.Date.class, java.util.Date.class, String.class
};
- private static final Class [] \_schedulePublishToRemoteParameterTypes30 =
+ private static final Class [] \_schedulePublishToRemoteParameterTypes32 =
new Class[] {
long.class, boolean.class, java.util.Map.class, java.util.Map.class,
String.class, int.class, String.class, boolean.class, long.class,
@@ -1944,17 +2034,17 @@ public static com.liferay.portal.kernel.model.Layout updateType(
String.class, String.class, java.util.Date.class,
java.util.Date.class, String.class
};
- private static final Class [] \_setLayoutsParameterTypes31 = new Class[] {
+ private static final Class [] \_setLayoutsParameterTypes33 = new Class[] {
long.class, boolean.class, long.class, long[].class,
com.liferay.portal.kernel.service.ServiceContext.class
};
- private static final Class [] \_unschedulePublishToLiveParameterTypes32 =
+ private static final Class [] \_unschedulePublishToLiveParameterTypes34 =
new Class[] {long.class, String.class, String.class};
- private static final Class [] \_unschedulePublishToRemoteParameterTypes33 =
+ private static final Class [] \_unschedulePublishToRemoteParameterTypes35 =
new Class[] {long.class, String.class, String.class};
- private static final Class [] \_updateIconImageParameterTypes34 =
+ private static final Class [] \_updateIconImageParameterTypes36 =
new Class[] {long.class, byte[].class};
- private static final Class [] \_updateLayoutParameterTypes35 =
+ private static final Class [] \_updateLayoutParameterTypes37 =
new Class[] {
long.class, boolean.class, long.class, long.class,
java.util.Map.class, java.util.Map.class, java.util.Map.class,
@@ -1962,36 +2052,36 @@ public static com.liferay.portal.kernel.model.Layout updateType(
boolean.class, java.util.Map.class, boolean.class, byte[].class,
com.liferay.portal.kernel.service.ServiceContext.class
};
- private static final Class [] \_updateLayoutParameterTypes36 =
+ private static final Class [] \_updateLayoutParameterTypes38 =
new Class[] {long.class, boolean.class, long.class, String.class};
- private static final Class [] \_updateLookAndFeelParameterTypes37 =
+ private static final Class [] \_updateLookAndFeelParameterTypes39 =
new Class[] {
long.class, boolean.class, long.class, String.class, String.class,
String.class
};
- private static final Class [] \_updateNameParameterTypes38 = new Class[] {
+ private static final Class [] \_updateNameParameterTypes40 = new Class[] {
long.class, boolean.class, long.class, String.class, String.class
};
- private static final Class [] \_updateNameParameterTypes39 = new Class[] {
+ private static final Class [] \_updateNameParameterTypes41 = new Class[] {
long.class, String.class, String.class
};
- private static final Class [] \_updateParentLayoutIdParameterTypes40 =
+ private static final Class [] \_updateParentLayoutIdParameterTypes42 =
new Class[] {long.class, boolean.class, long.class, long.class};
- private static final Class [] \_updateParentLayoutIdParameterTypes41 =
+ private static final Class [] \_updateParentLayoutIdParameterTypes43 =
new Class[] {long.class, long.class};
private static final Class []
- \_updateParentLayoutIdAndPriorityParameterTypes42 = new Class[] {
+ \_updateParentLayoutIdAndPriorityParameterTypes44 = new Class[] {
long.class, long.class, int.class
};
- private static final Class [] \_updatePriorityParameterTypes43 =
+ private static final Class [] \_updatePriorityParameterTypes45 =
new Class[] {long.class, boolean.class, long.class, int.class};
- private static final Class [] \_updatePriorityParameterTypes44 =
+ private static final Class [] \_updatePriorityParameterTypes46 =
new Class[] {
long.class, boolean.class, long.class, long.class, long.class
};
- private static final Class [] \_updatePriorityParameterTypes45 =
+ private static final Class [] \_updatePriorityParameterTypes47 =
new Class[] {long.class, int.class};
- private static final Class [] \_updateTypeParameterTypes46 = new Class[] {
+ private static final Class [] \_updateTypeParameterTypes48 = new Class[] {
long.class, String.class
};
diff --git a/portal-impl/src/com/liferay/portal/service/http/LayoutServiceSoap.java b/portal-impl/src/com/liferay/portal/service/http/LayoutServiceSoap.java
index 7a929325b3cec4..484d312f016d0b 100644
--- a/portal-impl/src/com/liferay/portal/service/http/LayoutServiceSoap.java
+++ b/portal-impl/src/com/liferay/portal/service/http/LayoutServiceSoap.java
@@ -669,6 +669,28 @@ public static com.liferay.portal.kernel.model.LayoutSoap[] getLayouts(
}
}
+ public static com.liferay.portal.kernel.model.LayoutSoap[] getLayouts(
+ long groupId, boolean privateLayout, String keywords,
+ String[] types, int start, int end,
+ com.liferay.portal.kernel.util.OrderByComparator
+  obc)
+ throws RemoteException {
+
+ try {
+ java.util.List returnValue =
+ LayoutServiceUtil.getLayouts(
+ groupId, privateLayout, keywords, types, start, end, obc);
+
+ return com.liferay.portal.kernel.model.LayoutSoap.toSoapModels(
+ returnValue);
+ }
+ catch (Exception e) {
+ \_log.error(e, e);
+
+ throw new RemoteException(e.getMessage());
+ }
+ }
+
public static com.liferay.portal.kernel.model.LayoutSoap[] getLayouts(
long groupId, String type)
throws RemoteException {
@@ -756,6 +778,24 @@ public static int getLayoutsCount(
}
}
+ public static int getLayoutsCount(
+ long groupId, boolean privateLayout, String keywords,
+ String[] types)
+ throws RemoteException {
+
+ try {
+ int returnValue = LayoutServiceUtil.getLayoutsCount(
+ groupId, privateLayout, keywords, types);
+
+ return returnValue;
+ }
+ catch (Exception e) {
+ \_log.error(e, e);
+
+ throw new RemoteException(e.getMessage());
+ }
+ }
+
public static int getLayoutsCount(long groupId, String type)
throws RemoteException {
diff --git a/portal-impl/src/com/liferay/portal/service/impl/LayoutLocalServiceImpl.java b/portal-impl/src/com/liferay/portal/service/impl/LayoutLocalServiceImpl.java
index 7b7018ba712dc3..9cc8143918e4ea 100644
--- a/portal-impl/src/com/liferay/portal/service/impl/LayoutLocalServiceImpl.java
+++ b/portal-impl/src/com/liferay/portal/service/impl/LayoutLocalServiceImpl.java
@@ -1642,6 +1642,48 @@ public List getLayouts(
String[] types, int start, int end, OrderByComparator obc)
throws PortalException {
+ return getLayouts(
+ groupId, 0, privateLayout, keywords, types, start, end, obc);
+ }
+
+ /\*\*
+ \* Returns a range of all the layouts belonging to the group.
+ \*
+ \* @param groupId the primary key of the group
+ \* @param start the lower bound of the range of layouts
+ \* @param end the upper bound of the range of layouts (not inclusive)
+ \* @param obc the comparator to order the layouts
+ \* @return the matching layouts, or `null` if no matches were
+ \* found
+ \*/
+ @Override
+ public List getLayouts(
+ long groupId, int start, int end, OrderByComparator obc) {
+
+ return layoutPersistence.findByGroupId\_Head(
+ groupId, false, start, end, obc);
+ }
+
+ /\*\*
+ \* Returns a range of all the layouts belonging to the group.
+ \*
+ \* @param groupId the primary key of the group
+ \* @param userId the primary key of the user
+ \* @param privateLayout whether the layout is private to the group
+ \* @param keywords keywords
+ \* @param types layout types
+ \* @param start the lower bound of the range of layouts
+ \* @param end the upper bound of the range of layouts (not inclusive)
+ \* @param obc the comparator to order the layouts
+ \* @return the matching layouts, or `null` if no matches were
+ \* found
+ \*/
+ @Override
+ public List getLayouts(
+ long groupId, long userId, boolean privateLayout, String keywords,
+ String[] types, int start, int end, OrderByComparator obc)
+ throws PortalException {
+
if (Validator.isNull(keywords)) {
return getLayouts(groupId, privateLayout, start, end, obc);
}
@@ -1651,7 +1693,8 @@ public List getLayouts(
Hits hits = indexer.search(
\_buildSearchContext(
- groupId, privateLayout, keywords, types, start, end, obc));
+ groupId, userId, privateLayout, keywords, types, start, end,
+ obc));
List documents = hits.toList();
@@ -1666,24 +1709,6 @@ public List getLayouts(
return layouts;
}
- /\*\*
- \* Returns a range of all the layouts belonging to the group.
- \*
- \* @param groupId the primary key of the group
- \* @param start the lower bound of the range of layouts
- \* @param end the upper bound of the range of layouts (not inclusive)
- \* @param obc the comparator to order the layouts
- \* @return the matching layouts, or `null` if no matches were
- \* found
- \*/
- @Override
- public List getLayouts(
- long groupId, int start, int end, OrderByComparator obc) {
-
- return layoutPersistence.findByGroupId\_Head(
- groupId, false, start, end, obc);
- }
-
/\*\*
\* Returns the layout references for all the layouts that belong to the
\* company and belong to the portlet that matches the preferences.
@@ -1875,8 +1900,28 @@ public int getLayoutsCount(
Group group, boolean privateLayout, String keywords, String[] types)
throws PortalException {
+ return getLayoutsCount(
+ group.getGroupId(), 0, privateLayout, keywords, types);
+ }
+
+ @Override
+ public int getLayoutsCount(long groupId) {
+ return layoutPersistence.countByGroupId\_Head(groupId, false);
+ }
+
+ @Override
+ public int getLayoutsCount(long groupId, boolean privateLayout) {
+ return layoutPersistence.countByG\_P(groupId, privateLayout);
+ }
+
+ @Override
+ public int getLayoutsCount(
+ long groupId, long userId, boolean privateLayout, String keywords,
+ String[] types)
+ throws PortalException {
+
if (Validator.isNull(keywords)) {
- return getLayoutsCount(group, privateLayout);
+ return getLayoutsCount(groupId, privateLayout);
}
Indexer indexer = IndexerRegistryUtil.getIndexer(
@@ -1884,17 +1929,12 @@ public int getLayoutsCount(
Hits hits = indexer.search(
\_buildSearchContext(
- group.getGroupId(), privateLayout, keywords, types,
+ groupId, userId, privateLayout, keywords, types,
QueryUtil.ALL\_POS, QueryUtil.ALL\_POS, null));
return hits.getLength();
}
- @Override
- public int getLayoutsCount(long groupId) {
- return layoutPersistence.countByGroupId\_Head(groupId, false);
- }
-
@Override
public int getLayoutsCount(long groupId, String keywords, String[] types)
throws PortalException {
@@ -3343,6 +3383,15 @@ private SearchContext \_buildSearchContext(
String[] types, int start, int end, OrderByComparator obc)
throws PortalException {
+ return \_buildSearchContext(
+ groupId, 0, privateLayout, keywords, types, start, end, obc);
+ }
+
+ private SearchContext \_buildSearchContext(
+ long groupId, long userId, Boolean privateLayout, String keywords,
+ String[] types, int start, int end, OrderByComparator obc)
+ throws PortalException {
+
SearchContext searchContext = new SearchContext();
searchContext.setAttribute(Field.TITLE, keywords);
@@ -3367,6 +3416,10 @@ private SearchContext \_buildSearchContext(
searchContext.setSorts(\_getSortFromComparator(obc));
}
+ if (userId > 0) {
+ searchContext.setUserId(userId);
+ }
+
QueryConfig queryConfig = searchContext.getQueryConfig();
queryConfig.setHighlightEnabled(false);
diff --git a/portal-impl/src/com/liferay/portal/service/impl/LayoutServiceImpl.java b/portal-impl/src/com/liferay/portal/service/impl/LayoutServiceImpl.java
index b136716c39c697..1694246f258ed5 100644
--- a/portal-impl/src/com/liferay/portal/service/impl/LayoutServiceImpl.java
+++ b/portal-impl/src/com/liferay/portal/service/impl/LayoutServiceImpl.java
@@ -51,6 +51,7 @@
import com.liferay.portal.kernel.util.DigesterUtil;
import com.liferay.portal.kernel.util.GetterUtil;
import com.liferay.portal.kernel.util.ListUtil;
+import com.liferay.portal.kernel.util.OrderByComparator;
import com.liferay.portal.kernel.util.PortletKeys;
import com.liferay.portal.kernel.util.TempFileEntryUtil;
import com.liferay.portal.kernel.util.Validator;
@@ -678,6 +679,22 @@ public List getLayouts(
return filterLayouts(layouts);
}
+ @Override
+ public List getLayouts(
+ long groupId, boolean privateLayout, String keywords,
+ String[] types, int start, int end, OrderByComparator obc)
+ throws PortalException {
+
+ if (Validator.isNull(keywords)) {
+ return layoutPersistence.filterFindByG\_P(
+ groupId, privateLayout, start, end, obc);
+ }
+
+ return layoutLocalService.getLayouts(
+ groupId, getUserId(), privateLayout, keywords, types, start, end,
+ obc);
+ }
+
@Override
public List getLayouts(long groupId, String type) {
return layoutPersistence.filterFindByG\_T\_Head(groupId, type, false);
@@ -714,6 +731,20 @@ public int getLayoutsCount(
groupId, privateLayout, parentLayoutId, priority, false);
}
+ @Override
+ public int getLayoutsCount(
+ long groupId, boolean privateLayout, String keywords,
+ String[] types)
+ throws PortalException {
+
+ if (Validator.isNull(keywords)) {
+ return layoutPersistence.filterCountByG\_P(groupId, privateLayout);
+ }
+
+ return layoutLocalService.getLayoutsCount(
+ groupId, getUserId(), privateLayout, keywords, types);
+ }
+
@Override
public int getLayoutsCount(long groupId, String type) {
return layoutPersistence.filterCountByG\_T\_Head(groupId, type, false);
diff --git a/portal-impl/src/com/liferay/portal/service/impl/UserLocalServiceImpl.java b/portal-impl/src/com/liferay/portal/service/impl/UserLocalServiceImpl.java
index 86b2f87b58e481..4001e16c9456c2 100644
--- a/portal-impl/src/com/liferay/portal/service/impl/UserLocalServiceImpl.java
+++ b/portal-impl/src/com/liferay/portal/service/impl/UserLocalServiceImpl.java
@@ -1205,10 +1205,6 @@ public User addUserWithWorkflow(
workflowServiceContext = (ServiceContext)serviceContext.clone();
}
- workflowServiceContext.setAttribute("autoPassword", autoPassword);
- workflowServiceContext.setAttribute("passwordUnencrypted", password1);
- workflowServiceContext.setAttribute("sendEmail", sendEmail);
-
Map workflowContext =
(Map)workflowServiceContext.removeAttribute(
"workflowContext");
@@ -1217,6 +1213,12 @@ public User addUserWithWorkflow(
workflowContext = Collections.emptyMap();
}
+ workflowServiceContext.setAttributes(
+ new HashMap());
+
+ workflowServiceContext.setAttribute("autoPassword", autoPassword);
+ workflowServiceContext.setAttribute("sendEmail", sendEmail);
+
user = WorkflowHandlerRegistryUtil.startWorkflowInstance(
companyId, WorkflowConstants.DEFAULT\_GROUP\_ID, workflowUserId,
User.class.getName(), userId, user, workflowServiceContext,
@@ -1706,8 +1708,7 @@ public void completeUserRegistration(
boolean autoPassword = ParamUtil.getBoolean(
serviceContext, "autoPassword");
- String password = (String)serviceContext.getAttribute(
- "passwordUnencrypted");
+ String password = StringPool.BLANK;
if (autoPassword) {
if (LDAPSettingsUtil.isPasswordPolicyEnabled(user.getCompanyId())) {
@@ -4900,6 +4901,8 @@ public User updatePassword(
null, ServiceContextThreadLocal.getServiceContext());
}
+ \_invalidateTicket(user);
+
return user;
}
@@ -4931,7 +4934,9 @@ public User updatePasswordManually(
user.setPasswordModifiedDate(passwordModifiedDate);
user.setDigest(StringPool.BLANK);
- userPersistence.update(user);
+ user = userPersistence.update(user);
+
+ \_invalidateTicket(user);
return user;
}
@@ -6982,6 +6987,21 @@ private String \_getLocalizedValue(
return localizedValueMap.get(fallbackLocale);
}
+ private void \_invalidateTicket(User user) throws PortalException {
+ List tickets = ticketLocalService.getTickets(
+ user.getCompanyId(), User.class.getName(), user.getUserId(),
+ TicketConstants.TYPE\_PASSWORD);
+
+ for (Ticket ticket : tickets) {
+ if (!ticket.isExpired()) {
+ ticketLocalService.updateTicket(
+ ticket.getTicketId(), User.class.getName(),
+ user.getUserId(), TicketConstants.TYPE\_PASSWORD,
+ ticket.getExtraInfo(), new Date());
+ }
+ }
+ }
+
private void \_sendNotificationEmail(
String fromAddress, String fromName, String toAddress, User toUser,
String subject, String body,
diff --git a/portal-impl/src/com/liferay/portal/service/impl/UserNotificationEventLocalServiceImpl.java b/portal-impl/src/com/liferay/portal/service/impl/UserNotificationEventLocalServiceImpl.java
index 90636fb1f864e6..cd7a7eba7dffc1 100644
--- a/portal-impl/src/com/liferay/portal/service/impl/UserNotificationEventLocalServiceImpl.java
+++ b/portal-impl/src/com/liferay/portal/service/impl/UserNotificationEventLocalServiceImpl.java
@@ -14,6 +14,11 @@
package com.liferay.portal.service.impl;
+import com.liferay.petra.string.StringBundler;
+import com.liferay.portal.kernel.dao.orm.DynamicQuery;
+import com.liferay.portal.kernel.dao.orm.DynamicQueryFactoryUtil;
+import com.liferay.portal.kernel.dao.orm.Property;
+import com.liferay.portal.kernel.dao.orm.PropertyFactoryUtil;
import com.liferay.portal.kernel.exception.PortalException;
import com.liferay.portal.kernel.interval.IntervalActionProcessor;
import com.liferay.portal.kernel.json.JSONObject;
@@ -32,6 +37,7 @@
import java.util.ArrayList;
import java.util.Collection;
import java.util.List;
+import java.util.Map;
import java.util.concurrent.Callable;
/\*\*
@@ -444,10 +450,40 @@ public int getUserNotificationEventsCount(long userId, int deliveryType) {
@Override
public int getUserNotificationEventsCount(
- long userId, String type, int deliveryType, boolean archived) {
+ long userId, String type, int deliveryType, boolean delivered) {
return userNotificationEventPersistence.countByU\_T\_DT\_D(
- userId, type, deliveryType, archived);
+ userId, type, deliveryType, delivered);
+ }
+
+ @Override
+ public int getUserNotificationEventsCount(
+ long userId, String type, Map payloadParameters) {
+
+ DynamicQuery dynamicQuery = DynamicQueryFactoryUtil.forClass(
+ UserNotificationEvent.class, getClassLoader());
+
+ Property userIdProperty = PropertyFactoryUtil.forName("userId");
+
+ dynamicQuery.add(userIdProperty.eq(userId));
+
+ Property typeProperty = PropertyFactoryUtil.forName("type");
+
+ dynamicQuery.add(typeProperty.eq(type));
+
+ Property payloadProperty = PropertyFactoryUtil.forName("payload");
+
+ for (Map.Entry payloadParameter :
+ payloadParameters.entrySet()) {
+
+ dynamicQuery.add(
+ payloadProperty.like(
+ StringBundler.concat(
+ "%\"", payloadParameter.getKey(), "\":\"",
+ payloadParameter.getValue(), "\"%")));
+ }
+
+ return (int)dynamicQueryCount(dynamicQuery);
}
@Override
diff --git a/portal-impl/src/com/liferay/portal/service/permission/UserPermissionImpl.java b/portal-impl/src/com/liferay/portal/service/permission/UserPermissionImpl.java
index d8435afbca8fea..cbe7502b976271 100644
--- a/portal-impl/src/com/liferay/portal/service/permission/UserPermissionImpl.java
+++ b/portal-impl/src/com/liferay/portal/service/permission/UserPermissionImpl.java
@@ -102,7 +102,9 @@ public boolean contains(
if (!actionId.equals(ActionKeys.VIEW) &&
!permissionChecker.isOmniadmin() &&
- PortalUtil.isOmniadmin(user)) {
+ (PortalUtil.isOmniadmin(user) ||
+ (!permissionChecker.isCompanyAdmin() &&
+ PortalUtil.isCompanyAdmin(user)))) {
return false;
}
diff --git a/portal-impl/src/com/liferay/portal/struts/JSONAction.java b/portal-impl/src/com/liferay/portal/struts/JSONAction.java
index e3e5a0a49c3889..0a275b19ab3469 100644
--- a/portal-impl/src/com/liferay/portal/struts/JSONAction.java
+++ b/portal-impl/src/com/liferay/portal/struts/JSONAction.java
@@ -99,7 +99,16 @@ public ActionForward execute(
\_log.warn(se.getMessage());
}
- json = JSONFactoryUtil.serializeThrowable(se);
+ if (PropsValues.JSON\_SERVICE\_SERIALIZE\_THROWABLE) {
+ json = JSONFactoryUtil.serializeThrowable(se);
+ }
+ else {
+ PortalUtil.sendError(
+ HttpServletResponse.SC\_INTERNAL\_SERVER\_ERROR,
+ se, httpServletRequest, httpServletResponse);
+
+ return null;
+ }
}
catch (Exception e) {
\_log.error(e.getMessage());
diff --git a/portal-impl/src/com/liferay/portal/util/PropsValues.java b/portal-impl/src/com/liferay/portal/util/PropsValues.java
index a193c8e5055a93..0d763fc3111d07 100644
--- a/portal-impl/src/com/liferay/portal/util/PropsValues.java
+++ b/portal-impl/src/com/liferay/portal/util/PropsValues.java
@@ -1460,6 +1460,10 @@ public class PropsValues {
public static final String[] JSON\_SERVICE\_INVALID\_METHOD\_NAMES =
PropsUtil.getArray(PropsKeys.JSON\_SERVICE\_INVALID\_METHOD\_NAMES);
+ public static final boolean JSON\_SERVICE\_SERIALIZE\_THROWABLE =
+ GetterUtil.getBoolean(
+ PropsUtil.get(PropsKeys.JSON\_SERVICE\_SERIALIZE\_THROWABLE));
+
public static final boolean JSON\_WEB\_SERVICE\_ENABLED =
GetterUtil.getBoolean(
PropsUtil.get(PropsKeys.JSON\_WEB\_SERVICE\_ENABLED));
diff --git a/portal-impl/src/portal-developer.properties b/portal-impl/src/portal-developer.properties
index bae01cefb2f0be..8ae94a27376cbf 100644
--- a/portal-impl/src/portal-developer.properties
+++ b/portal-impl/src/portal-developer.properties
@@ -14,6 +14,8 @@ browser.launcher.url=
combo.check.timestamp=true
+json.service.serialize.throwable=true
+
minifier.enabled=false
module.framework.properties.initial.system.check.enabled=true
diff --git a/portal-impl/src/portal.properties b/portal-impl/src/portal.properties
index aa18a93b4b9e60..f7058c4643fd6e 100644
--- a/portal-impl/src/portal.properties
+++ b/portal-impl/src/portal.properties
@@ -7167,6 +7167,16 @@
json.service.invalid.method.names=\
getOSGiServiceIdentifier
+ #
+ # Set this to true to return information about server errors in the JSON
+ # response.
+ #
+ # It is encouraged to set this to false in production environments.
+ #
+ # Env: LIFERAY\_JSON\_PERIOD\_SERVICE\_PERIOD\_SERIALIZE\_PERIOD\_THROWABLE
+ #
+ json.service.serialize.throwable=false
+
##
## JSON Web Service
##
@@ -11298,7 +11308,7 @@
#
# Env: LIFERAY\_LOGIN\_PERIOD\_SECURE\_PERIOD\_FORGOT\_PERIOD\_PASSWORD
#
- login.secure.forgot.password=false
+ login.secure.forgot.password=true
##
## Menu Tag Libraries
diff --git a/portal-kernel/src/com/liferay/portal/kernel/service/LayoutLocalService.java b/portal-kernel/src/com/liferay/portal/kernel/service/LayoutLocalService.java
index 9723d9913b8a33..c1c3ce597282e6 100644
--- a/portal-kernel/src/com/liferay/portal/kernel/service/LayoutLocalService.java
+++ b/portal-kernel/src/com/liferay/portal/kernel/service/LayoutLocalService.java
@@ -937,6 +937,26 @@ public List getLayouts(
public List getLayouts(
long groupId, int start, int end, OrderByComparator obc);
+ /\*\*
+ \* Returns a range of all the layouts belonging to the group.
+ \*
+ \* @param groupId the primary key of the group
+ \* @param userId the primary key of the user
+ \* @param privateLayout whether the layout is private to the group
+ \* @param keywords keywords
+ \* @param types layout types
+ \* @param start the lower bound of the range of layouts
+ \* @param end the upper bound of the range of layouts (not inclusive)
+ \* @param obc the comparator to order the layouts
+ \* @return the matching layouts, or `null` if no matches were
+ found
+ \*/
+ @Transactional(propagation = Propagation.SUPPORTS, readOnly = true)
+ public List getLayouts(
+ long groupId, long userId, boolean privateLayout, String keywords,
+ String[] types, int start, int end, OrderByComparator obc)
+ throws PortalException;
+
/\*\*
\* Returns the layout references for all the layouts that belong to the
\* company and belong to the portlet that matches the preferences.
@@ -1038,6 +1058,15 @@ public int getLayoutsCount(
@Transactional(propagation = Propagation.SUPPORTS, readOnly = true)
public int getLayoutsCount(long groupId);
+ @Transactional(propagation = Propagation.SUPPORTS, readOnly = true)
+ public int getLayoutsCount(long groupId, boolean privateLayout);
+
+ @Transactional(propagation = Propagation.SUPPORTS, readOnly = true)
+ public int getLayoutsCount(
+ long groupId, long userId, boolean privateLayout, String keywords,
+ String[] types)
+ throws PortalException;
+
@Transactional(propagation = Propagation.SUPPORTS, readOnly = true)
public int getLayoutsCount(long groupId, String keywords, String[] types)
throws PortalException;
diff --git a/portal-kernel/src/com/liferay/portal/kernel/service/LayoutLocalServiceUtil.java b/portal-kernel/src/com/liferay/portal/kernel/service/LayoutLocalServiceUtil.java
index e1866ffbedbc55..22080e45aedba4 100644
--- a/portal-kernel/src/com/liferay/portal/kernel/service/LayoutLocalServiceUtil.java
+++ b/portal-kernel/src/com/liferay/portal/kernel/service/LayoutLocalServiceUtil.java
@@ -1119,6 +1119,32 @@ public static com.liferay.portal.kernel.model.Layout getLayoutByIconImageId(
return getService().getLayouts(groupId, start, end, obc);
}
+ /\*\*
+ \* Returns a range of all the layouts belonging to the group.
+ \*
+ \* @param groupId the primary key of the group
+ \* @param userId the primary key of the user
+ \* @param privateLayout whether the layout is private to the group
+ \* @param keywords keywords
+ \* @param types layout types
+ \* @param start the lower bound of the range of layouts
+ \* @param end the upper bound of the range of layouts (not inclusive)
+ \* @param obc the comparator to order the layouts
+ \* @return the matching layouts, or `null` if no matches were
+ found
+ \*/
+ public static java.util.List
+ getLayouts(
+ long groupId, long userId, boolean privateLayout,
+ String keywords, String[] types, int start, int end,
+ com.liferay.portal.kernel.util.OrderByComparator
+  obc)
+ throws com.liferay.portal.kernel.exception.PortalException {
+
+ return getService().getLayouts(
+ groupId, userId, privateLayout, keywords, types, start, end, obc);
+ }
+
/\*\*
\* Returns the layout references for all the layouts that belong to the
\* company and belong to the portlet that matches the preferences.
@@ -1263,6 +1289,19 @@ public static int getLayoutsCount(long groupId) {
return getService().getLayoutsCount(groupId);
}
+ public static int getLayoutsCount(long groupId, boolean privateLayout) {
+ return getService().getLayoutsCount(groupId, privateLayout);
+ }
+
+ public static int getLayoutsCount(
+ long groupId, long userId, boolean privateLayout, String keywords,
+ String[] types)
+ throws com.liferay.portal.kernel.exception.PortalException {
+
+ return getService().getLayoutsCount(
+ groupId, userId, privateLayout, keywords, types);
+ }
+
public static int getLayoutsCount(
long groupId, String keywords, String[] types)
throws com.liferay.portal.kernel.exception.PortalException {
diff --git a/portal-kernel/src/com/liferay/portal/kernel/service/LayoutLocalServiceWrapper.java b/portal-kernel/src/com/liferay/portal/kernel/service/LayoutLocalServiceWrapper.java
index b8d65481cc381a..9fb0343c3a0029 100644
--- a/portal-kernel/src/com/liferay/portal/kernel/service/LayoutLocalServiceWrapper.java
+++ b/portal-kernel/src/com/liferay/portal/kernel/service/LayoutLocalServiceWrapper.java
@@ -1174,6 +1174,33 @@ public java.util.List getLayouts(
return \_layoutLocalService.getLayouts(groupId, start, end, obc);
}
+ /\*\*
+ \* Returns a range of all the layouts belonging to the group.
+ \*
+ \* @param groupId the primary key of the group
+ \* @param userId the primary key of the user
+ \* @param privateLayout whether the layout is private to the group
+ \* @param keywords keywords
+ \* @param types layout types
+ \* @param start the lower bound of the range of layouts
+ \* @param end the upper bound of the range of layouts (not inclusive)
+ \* @param obc the comparator to order the layouts
+ \* @return the matching layouts, or `null` if no matches were
+ found
+ \*/
+ @Override
+ public java.util.List getLayouts(
+ long groupId, long userId, boolean privateLayout,
+ java.lang.String keywords, java.lang.String[] types, int start,
+ int end,
+ com.liferay.portal.kernel.util.OrderByComparator
+  obc)
+ throws com.liferay.portal.kernel.exception.PortalException {
+
+ return \_layoutLocalService.getLayouts(
+ groupId, userId, privateLayout, keywords, types, start, end, obc);
+ }
+
/\*\*
\* Returns the layout references for all the layouts that belong to the
\* company and belong to the portlet that matches the preferences.
@@ -1332,6 +1359,21 @@ public int getLayoutsCount(long groupId) {
return \_layoutLocalService.getLayoutsCount(groupId);
}
+ @Override
+ public int getLayoutsCount(long groupId, boolean privateLayout) {
+ return \_layoutLocalService.getLayoutsCount(groupId, privateLayout);
+ }
+
+ @Override
+ public int getLayoutsCount(
+ long groupId, long userId, boolean privateLayout,
+ java.lang.String keywords, java.lang.String[] types)
+ throws com.liferay.portal.kernel.exception.PortalException {
+
+ return \_layoutLocalService.getLayoutsCount(
+ groupId, userId, privateLayout, keywords, types);
+ }
+
@Override
public int getLayoutsCount(
long groupId, java.lang.String keywords, java.lang.String[] types)
diff --git a/portal-kernel/src/com/liferay/portal/kernel/service/LayoutService.java b/portal-kernel/src/com/liferay/portal/kernel/service/LayoutService.java
index 3fb6c0aa69f0fd..f6d082e6043660 100644
--- a/portal-kernel/src/com/liferay/portal/kernel/service/LayoutService.java
+++ b/portal-kernel/src/com/liferay/portal/kernel/service/LayoutService.java
@@ -25,6 +25,7 @@
import com.liferay.portal.kernel.transaction.Isolation;
import com.liferay.portal.kernel.transaction.Propagation;
import com.liferay.portal.kernel.transaction.Transactional;
+import com.liferay.portal.kernel.util.OrderByComparator;
import java.io.InputStream;
@@ -368,6 +369,12 @@ public List getLayouts(
long groupId, boolean privateLayout, String type)
throws PortalException;
+ @Transactional(propagation = Propagation.SUPPORTS, readOnly = true)
+ public List getLayouts(
+ long groupId, boolean privateLayout, String keywords,
+ String[] types, int start, int end, OrderByComparator obc)
+ throws PortalException;
+
@Transactional(propagation = Propagation.SUPPORTS, readOnly = true)
public List getLayouts(long groupId, String type);
@@ -386,6 +393,12 @@ public int getLayoutsCount(
public int getLayoutsCount(
long groupId, boolean privateLayout, long parentLayoutId, int priority);
+ @Transactional(propagation = Propagation.SUPPORTS, readOnly = true)
+ public int getLayoutsCount(
+ long groupId, boolean privateLayout, String keywords,
+ String[] types)
+ throws PortalException;
+
@Transactional(propagation = Propagation.SUPPORTS, readOnly = true)
public int getLayoutsCount(long groupId, String type);
diff --git a/portal-kernel/src/com/liferay/portal/kernel/service/LayoutServiceUtil.java b/portal-kernel/src/com/liferay/portal/kernel/service/LayoutServiceUtil.java
index c093911d19b6ec..f47f9aed916a49 100644
--- a/portal-kernel/src/com/liferay/portal/kernel/service/LayoutServiceUtil.java
+++ b/portal-kernel/src/com/liferay/portal/kernel/service/LayoutServiceUtil.java
@@ -420,6 +420,18 @@ public static long getLayoutPlid(
return getService().getLayouts(groupId, privateLayout, type);
}
+ public static java.util.List
+ getLayouts(
+ long groupId, boolean privateLayout, String keywords,
+ String[] types, int start, int end,
+ com.liferay.portal.kernel.util.OrderByComparator
+  obc)
+ throws com.liferay.portal.kernel.exception.PortalException {
+
+ return getService().getLayouts(
+ groupId, privateLayout, keywords, types, start, end, obc);
+ }
+
public static java.util.List
getLayouts(long groupId, String type) {
@@ -451,6 +463,15 @@ public static int getLayoutsCount(
groupId, privateLayout, parentLayoutId, priority);
}
+ public static int getLayoutsCount(
+ long groupId, boolean privateLayout, String keywords,
+ String[] types)
+ throws com.liferay.portal.kernel.exception.PortalException {
+
+ return getService().getLayoutsCount(
+ groupId, privateLayout, keywords, types);
+ }
+
public static int getLayoutsCount(long groupId, String type) {
return getService().getLayoutsCount(groupId, type);
}
diff --git a/portal-kernel/src/com/liferay/portal/kernel/service/LayoutServiceWrapper.java b/portal-kernel/src/com/liferay/portal/kernel/service/LayoutServiceWrapper.java
index 6b29650aef379f..1729cb6534799a 100644
--- a/portal-kernel/src/com/liferay/portal/kernel/service/LayoutServiceWrapper.java
+++ b/portal-kernel/src/com/liferay/portal/kernel/service/LayoutServiceWrapper.java
@@ -437,6 +437,18 @@ public java.util.List getLayouts(
return \_layoutService.getLayouts(groupId, privateLayout, type);
}
+ @Override
+ public java.util.List getLayouts(
+ long groupId, boolean privateLayout, java.lang.String keywords,
+ java.lang.String[] types, int start, int end,
+ com.liferay.portal.kernel.util.OrderByComparator
+  obc)
+ throws com.liferay.portal.kernel.exception.PortalException {
+
+ return \_layoutService.getLayouts(
+ groupId, privateLayout, keywords, types, start, end, obc);
+ }
+
@Override
public java.util.List getLayouts(
long groupId, java.lang.String type) {
@@ -473,6 +485,16 @@ public int getLayoutsCount(
groupId, privateLayout, parentLayoutId, priority);
}
+ @Override
+ public int getLayoutsCount(
+ long groupId, boolean privateLayout, java.lang.String keywords,
+ java.lang.String[] types)
+ throws com.liferay.portal.kernel.exception.PortalException {
+
+ return \_layoutService.getLayoutsCount(
+ groupId, privateLayout, keywords, types);
+ }
+
@Override
public int getLayoutsCount(long groupId, java.lang.String type) {
return \_layoutService.getLayoutsCount(groupId, type);
diff --git a/portal-kernel/src/com/liferay/portal/kernel/service/UserNotificationEventLocalService.java b/portal-kernel/src/com/liferay/portal/kernel/service/UserNotificationEventLocalService.java
index 1a858fa59fa906..146cc8691858cd 100644
--- a/portal-kernel/src/com/liferay/portal/kernel/service/UserNotificationEventLocalService.java
+++ b/portal-kernel/src/com/liferay/portal/kernel/service/UserNotificationEventLocalService.java
@@ -35,6 +35,7 @@
import java.util.Collection;
import java.util.List;
+import java.util.Map;
import org.osgi.annotation.versioning.ProviderType;
@@ -434,7 +435,11 @@ public List getUserNotificationEvents(
@Transactional(propagation = Propagation.SUPPORTS, readOnly = true)
public int getUserNotificationEventsCount(
- long userId, String type, int deliveryType, boolean archived);
+ long userId, String type, int deliveryType, boolean delivered);
+
+ @Transactional(propagation = Propagation.SUPPORTS, readOnly = true)
+ public int getUserNotificationEventsCount(
+ long userId, String type, Map payloadParameters);
public UserNotificationEvent sendUserNotificationEvents(
long userId, String portletId, int deliveryType,
diff --git a/portal-kernel/src/com/liferay/portal/kernel/service/UserNotificationEventLocalServiceUtil.java b/portal-kernel/src/com/liferay/portal/kernel/service/UserNotificationEventLocalServiceUtil.java
index 43256a023c5d7c..d3c41a8cbc7fb1 100644
--- a/portal-kernel/src/com/liferay/portal/kernel/service/UserNotificationEventLocalServiceUtil.java
+++ b/portal-kernel/src/com/liferay/portal/kernel/service/UserNotificationEventLocalServiceUtil.java
@@ -665,10 +665,18 @@ public static int getUserNotificationEventsCount(
}
public static int getUserNotificationEventsCount(
- long userId, String type, int deliveryType, boolean archived) {
+ long userId, String type, int deliveryType, boolean delivered) {
return getService().getUserNotificationEventsCount(
- userId, type, deliveryType, archived);
+ userId, type, deliveryType, delivered);
+ }
+
+ public static int getUserNotificationEventsCount(
+ long userId, String type,
+ java.util.Map payloadParameters) {
+
+ return getService().getUserNotificationEventsCount(
+ userId, type, payloadParameters);
}
public static com.liferay.portal.kernel.model.UserNotificationEvent
diff --git a/portal-kernel/src/com/liferay/portal/kernel/service/UserNotificationEventLocalServiceWrapper.java b/portal-kernel/src/com/liferay/portal/kernel/service/UserNotificationEventLocalServiceWrapper.java
index 6f7770c6006c07..ec0d2acb9d9d35 100644
--- a/portal-kernel/src/com/liferay/portal/kernel/service/UserNotificationEventLocalServiceWrapper.java
+++ b/portal-kernel/src/com/liferay/portal/kernel/service/UserNotificationEventLocalServiceWrapper.java
@@ -733,11 +733,20 @@ public int getUserNotificationEventsCount(long userId, int deliveryType) {
@Override
public int getUserNotificationEventsCount(
long userId, java.lang.String type, int deliveryType,
- boolean archived) {
+ boolean delivered) {
return \_userNotificationEventLocalService.
getUserNotificationEventsCount(
- userId, type, deliveryType, archived);
+ userId, type, deliveryType, delivered);
+ }
+
+ @Override
+ public int getUserNotificationEventsCount(
+ long userId, java.lang.String type,
+ java.util.Map payloadParameters) {
+
+ return \_userNotificationEventLocalService.
+ getUserNotificationEventsCount(userId, type, payloadParameters);
}
@Override
diff --git a/portal-kernel/src/com/liferay/portal/kernel/util/PropsKeys.java b/portal-kernel/src/com/liferay/portal/kernel/util/PropsKeys.java
index b693c7e6602f38..638a929aedd3d6 100644
--- a/portal-kernel/src/com/liferay/portal/kernel/util/PropsKeys.java
+++ b/portal-kernel/src/com/liferay/portal/kernel/util/PropsKeys.java
@@ -1697,6 +1697,9 @@ public interface PropsKeys {
public static final String JSON\_SERVICE\_INVALID\_METHOD\_NAMES =
"json.service.invalid.method.names";
+ public static final String JSON\_SERVICE\_SERIALIZE\_THROWABLE =
+ "json.service.serialize.throwable";
+
public static final String JSON\_WEB\_SERVICE\_ENABLED =
"json.web.service.enabled";
diff --git a/portal-kernel/src/com/liferay/portal/kernel/workflow/WorkflowInstanceManager.java b/portal-kernel/src/com/liferay/portal/kernel/workflow/WorkflowInstanceManager.java
index f31ec428e7abdc..5f2858a26e94f1 100644
--- a/portal-kernel/src/com/liferay/portal/kernel/workflow/WorkflowInstanceManager.java
+++ b/portal-kernel/src/com/liferay/portal/kernel/workflow/WorkflowInstanceManager.java
@@ -43,6 +43,13 @@ public WorkflowInstance getWorkflowInstance(
long companyId, long workflowInstanceId)
throws WorkflowException;
+ public default WorkflowInstance getWorkflowInstance(
+ long companyId, long userId, long workflowInstanceId)
+ throws WorkflowException {
+
+ throw new UnsupportedOperationException();
+ }
+
public int getWorkflowInstanceCount(
long companyId, Long userId, String assetClassName,
Long assetClassPK, Boolean completed)
diff --git a/portal-kernel/src/com/liferay/portal/kernel/workflow/WorkflowInstanceManagerUtil.java b/portal-kernel/src/com/liferay/portal/kernel/workflow/WorkflowInstanceManagerUtil.java
index c265e3e4f64e99..d48885b486b0bc 100644
--- a/portal-kernel/src/com/liferay/portal/kernel/workflow/WorkflowInstanceManagerUtil.java
+++ b/portal-kernel/src/com/liferay/portal/kernel/workflow/WorkflowInstanceManagerUtil.java
@@ -54,6 +54,14 @@ public static WorkflowInstance getWorkflowInstance(
companyId, workflowInstanceId);
}
+ public static WorkflowInstance getWorkflowInstance(
+ long companyId, long userId, long workflowInstanceId)
+ throws WorkflowException {
+
+ return getWorkflowInstanceManager().getWorkflowInstance(
+ companyId, userId, workflowInstanceId);
+ }
+
public static int getWorkflowInstanceCount(
long companyId, Long userId, String assetClassName,
Long assetClassPK, Boolean completed)
From 930600998324cf4afd54a8019e3347bb80b4bf58 Mon Sep 17 00:00:00 2001
From: yxingwu
Date: Tue, 11 May 2021 10:31:55 +0800
Subject: [PATCH 08/15] Update README
---
README.markdown | 33 +++++++++++++++++++++++++++++++++
1 file changed, 33 insertions(+)
diff --git a/README.markdown b/README.markdown
index f098879423ad72..5baf5f9f714d58 100644
--- a/README.markdown
+++ b/README.markdown
@@ -7,6 +7,39 @@ information about security in Liferay Portal, please see
\*\*Cumulative diff patch:\*\*
[https://github.com/community-security-team/liferay-portal/compare/7.2.1-ga2...7.2.1-cumulative.patch](https://github.com/community-security-team/liferay-portal/compare/7.2.1-ga2...7.2.1-cumulative.patch)
+The [May 2021](https://github.com/community-security-team/liferay-portal/commit/ce56c3137a8a97ffdad8a3e95ede563dd97c946f) release contains fixes for the following issues:
+[CST-7227](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120741510),
+[CST-7228](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120748003),
+[CVE-2021-29040](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120743429),
+[CVE-2021-29043](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120743515),
+[CVE-2021-29044](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120743548),
+[CVE-2021-29045](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120743484),
+[CVE-2021-29046](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120743501),
+[CVE-2021-29047](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120743467),
+[CVE-2021-29048](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120743601),
+[CVE-2021-29051](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120743580),
+[CVE-2021-29052](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120743159),
+[CVE-TBA-7328](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747063),
+[CVE-TBA-7329](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747107),
+[CVE-TBA-7330](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747590),
+[CVE-TBA-7331](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747627),
+[CVE-TBA-7332](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747720),
+[CVE-TBA-7333](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747742),
+[CVE-TBA-7334](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747782),
+[CVE-TBA-7335](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747817),
+[CVE-TBA-7336](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747840),
+[CVE-TBA-7337](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747869),
+[CVE-TBA-7338](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747906),
+[CVE-TBA-7339](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747934),
+[CVE-TBA-7340](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747953),
+[CVE-TBA-7341](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747972),
+[CVE-TBA-7342](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120748020),
+[CVE-TBA-7343](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120748055),
+[CVE-TBA-7344](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120748276),
+[CVE-TBA-7345](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120748332),
+[CVE-TBA-7346](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120748366),
+[CVE-TBA-7347](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120748389) and updates to external libraries with known vulnerabilities.
+
The [September 2020](https://github.com/community-security-team/liferay-portal/commit/ed211f44d636d07647d7b8e2d1f0b0016866ab15) release contains fixes for the following issues:
[CST-7224](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119784785),
[CST-7225](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119784802),
From 6609681556a713d63050f01ba4c798f098ed43f9 Mon Sep 17 00:00:00 2001
From: yxingwu
Date: Wed, 12 May 2021 09:48:00 +0800
Subject: [PATCH 09/15] Remove the tickets which doesn't affect 7.2
---
README.markdown | 7 -------
1 file changed, 7 deletions(-)
diff --git a/README.markdown b/README.markdown
index 5baf5f9f714d58..463ab9661fa0d7 100644
--- a/README.markdown
+++ b/README.markdown
@@ -13,25 +13,18 @@ The [May 2021](https://github.com/community-security-team/liferay-portal/commit/
[CVE-2021-29040](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120743429),
[CVE-2021-29043](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120743515),
[CVE-2021-29044](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120743548),
-[CVE-2021-29045](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120743484),
-[CVE-2021-29046](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120743501),
-[CVE-2021-29047](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120743467),
-[CVE-2021-29048](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120743601),
[CVE-2021-29051](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120743580),
-[CVE-2021-29052](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120743159),
[CVE-TBA-7328](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747063),
[CVE-TBA-7329](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747107),
[CVE-TBA-7330](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747590),
[CVE-TBA-7331](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747627),
[CVE-TBA-7332](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747720),
[CVE-TBA-7333](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747742),
-[CVE-TBA-7334](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747782),
[CVE-TBA-7335](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747817),
[CVE-TBA-7336](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747840),
[CVE-TBA-7337](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747869),
[CVE-TBA-7338](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747906),
[CVE-TBA-7339](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747934),
-[CVE-TBA-7340](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747953),
[CVE-TBA-7341](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747972),
[CVE-TBA-7342](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120748020),
[CVE-TBA-7343](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120748055),
From fbef1060bf7793ed0d9080a7dd15ae49bcc9d497 Mon Sep 17 00:00:00 2001
From: yxingwu
Date: Tue, 3 Aug 2021 14:50:11 +0800
Subject: [PATCH 10/15] Update README
---
README.markdown | 36 ++++++++++++++++++------------------
1 file changed, 18 insertions(+), 18 deletions(-)
diff --git a/README.markdown b/README.markdown
index 463ab9661fa0d7..1f8e9cbc68710b 100644
--- a/README.markdown
+++ b/README.markdown
@@ -14,24 +14,24 @@ The [May 2021](https://github.com/community-security-team/liferay-portal/commit/
[CVE-2021-29043](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120743515),
[CVE-2021-29044](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120743548),
[CVE-2021-29051](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120743580),
-[CVE-TBA-7328](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747063),
-[CVE-TBA-7329](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747107),
-[CVE-TBA-7330](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747590),
-[CVE-TBA-7331](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747627),
-[CVE-TBA-7332](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747720),
-[CVE-TBA-7333](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747742),
-[CVE-TBA-7335](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747817),
-[CVE-TBA-7336](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747840),
-[CVE-TBA-7337](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747869),
-[CVE-TBA-7338](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747906),
-[CVE-TBA-7339](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747934),
-[CVE-TBA-7341](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747972),
-[CVE-TBA-7342](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120748020),
-[CVE-TBA-7343](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120748055),
-[CVE-TBA-7344](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120748276),
-[CVE-TBA-7345](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120748332),
-[CVE-TBA-7346](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120748366),
-[CVE-TBA-7347](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120748389) and updates to external libraries with known vulnerabilities.
+[CVE-2021-33320](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747590),
+[CVE-2021-33321](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120748055),
+[CVE-2021-33322](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120748020),
+[CVE-2021-33323](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747107),
+[CVE-2021-33324](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747063),
+[CVE-2021-33325](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120748389),
+[CVE-2021-33326](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747869),
+[CVE-2021-33327](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747840),
+[CVE-2021-33328](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747972),
+[CVE-2021-33330](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747720),
+[CVE-2021-33331](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747627),
+[CVE-2021-33332](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120748366),
+[CVE-2021-33333](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747742),
+[CVE-2021-33334](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120748332),
+[CVE-2021-33335](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747906),
+[CVE-2021-33338](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120748276),
+[CVE-2021-33339](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747934),
+[CVE-TBA-7335](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747817) and updates to external libraries with known vulnerabilities.
The [September 2020](https://github.com/community-security-team/liferay-portal/commit/ed211f44d636d07647d7b8e2d1f0b0016866ab15) release contains fixes for the following issues:
[CST-7224](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119784785),
From 1bfe0fddb35dda44f9a0319d3c6377b439971ca7 Mon Sep 17 00:00:00 2001
From: yxingwu
Date: Tue, 31 Aug 2021 09:26:56 +0800
Subject: [PATCH 11/15] August 2021
---
.classpath | 1 +
lib/development/dependencies.properties | 2 +-
lib/portal/dependencies.properties | 5 +-
lib/versions-complete.xml | 2 +-
lib/versions-ext.xml | 6 +-
lib/versions.html | 2 +-
modules/apps/bulk/bulk-rest-api/build.gradle | 2 +-
modules/apps/bulk/bulk-rest-impl/build.gradle | 2 +-
modules/apps/bulk/bulk-rest-test/build.gradle | 6 +-
.../comment/comment-sanitizer/build.gradle | 6 +-
.../data-engine-rest-api/build.gradle | 2 +-
.../data-engine-rest-impl/build.gradle | 2 +-
.../data-engine-rest-test/build.gradle | 6 +-
.../bnd.bnd | 2 +
.../build.gradle | 6 +-
.../META-INF/resource-actions/default.xml | 6 +-
.../export-import-service/build.gradle | 3 +-
.../frontend-js-jquery-web/build.gradle | 17 +
.../frontend-js-jquery-web/package.json | 1 +
.../META-INF/resources/jquery/form.js | 1491 -----------------
.../resources/META-INF/resources/view.jsp | 2 +-
.../headless-admin-taxonomy-api/build.gradle | 2 +-
.../headless-admin-taxonomy-impl/build.gradle | 2 +-
.../headless-admin-taxonomy-test/build.gradle | 6 +-
.../headless-admin-user-api/build.gradle | 2 +-
.../headless-admin-user-impl/build.gradle | 2 +-
.../headless-admin-user-test/build.gradle | 6 +-
.../headless-admin-workflow-api/build.gradle | 2 +-
.../headless-admin-workflow-impl/build.gradle | 2 +-
.../headless-admin-workflow-test/build.gradle | 6 +-
.../headless-delivery-api/build.gradle | 2 +-
.../headless-delivery-impl/build.gradle | 2 +-
.../headless-delivery-test/build.gradle | 6 +-
.../headless-form-api/build.gradle | 2 +-
.../headless-form-impl/build.gradle | 2 +-
.../headless-form-test/build.gradle | 6 +-
.../build.gradle | 6 +-
.../portal-odata-impl/build.gradle | 4 +-
.../build.gradle | 6 +-
.../portal-search-elasticsearch6-impl/bnd.bnd | 6 +
.../build.gradle | 12 +-
.../portal-search-elasticsearch7-impl/bnd.bnd | 6 +
.../build.gradle | 12 +-
.../portal-search-web/build.gradle | 2 +-
.../build.gradle | 2 +-
.../ldap/internal/authenticator/LDAPAuth.java | 5 +
.../portal-store/portal-store-s3/build.gradle | 6 +-
.../portal-template-soy-impl/build.gradle | 2 +-
.../portal-vulcan-api/build.gradle | 6 +-
.../portal-vulcan-impl/build.gradle | 8 +-
.../portal-vulcan-test/build.gradle | 2 +-
.../build.gradle | 6 +-
.../apps/segments/segments-test/build.gradle | 2 +-
.../action/EditServerMVCActionCommand.java | 2 +
.../META-INF/resources/external\_services.jsp | 2 +-
.../resources/META-INF/resources/init.jsp | 1 +
.../resources/META-INF/resources/script.jsp | 29 +-
.../build.gradle | 2 +-
.../required-dependencies/build.gradle | 6 +-
modules/core/portal-bootstrap/build.gradle | 6 +-
.../portal/bootstrap/ModuleFrameworkImpl.java | 4 +
.../system.packages.extra.bnd | 2 +-
modules/yarn.lock | 12 +
nbproject/project.properties | 1 +
.../dao/jdbc/DataSourceFactoryImpl.java | 85 +-
portal-impl/src/portal.properties | 2 +-
.../kernel/util/SubscriptionSender.java | 58 +
67 files changed, 324 insertions(+), 1603 deletions(-)
diff --git a/.classpath b/.classpath
index 38479a0881e41b..ce44cb2e2243d8 100644
--- a/.classpath
+++ b/.classpath
@@ -180,6 +180,7 @@

+

diff --git a/lib/development/dependencies.properties b/lib/development/dependencies.properties
index fe3b9a391d6d59..47139155e96ed0 100644
--- a/lib/development/dependencies.properties
+++ b/lib/development/dependencies.properties
@@ -43,7 +43,7 @@ mail=javax.mail:mail:1.4
mariadb=org.mariadb.jdbc:mariadb-java-client:1.1.9
maven-ant-tasks=org.apache.maven:maven-ant-tasks:2.1.3
mockito=org.mockito:mockito-all:1.9.5
-mysql=mysql:mysql-connector-java:8.0.16
+mysql=mysql:mysql-connector-java:8.0.21
objenesis=org.objenesis:objenesis:2.1
osgi-annotation-versioning=org.osgi:org.osgi.annotation.versioning:1.1.0
p6spy=p6spy:p6spy:1.3
diff --git a/lib/portal/dependencies.properties b/lib/portal/dependencies.properties
index 2f3802df2cbda5..b4138135c51732 100644
--- a/lib/portal/dependencies.properties
+++ b/lib/portal/dependencies.properties
@@ -34,7 +34,7 @@ commons-digester=commons-digester:commons-digester:1.8.1
commons-discovery=commons-discovery:commons-discovery:0.4
commons-exec=org.apache.commons:commons-exec:1.3
commons-fileupload=commons-fileupload:commons-fileupload:1.3.3
-commons-httpclient=commons-httpclient:commons-httpclient:3.1
+commons-httpclient=com.liferay:org.apache.commons.httpclient:3.1.LIFERAY-PATCHED-1
commons-io=commons-io:commons-io:2.5
commons-lang=commons-lang:commons-lang:2.6
commons-logging=commons-logging:commons-logging:1.2
@@ -64,6 +64,7 @@ ical4j=net.fortuna.ical4j:ical4j:1.0-rc3
im4java=org.im4java:im4java:1.2.0
isoparser=com.googlecode.mp4parser:isoparser:1.1.22
jabsorb=com.liferay:org.jabsorb:1.3.2.LIFERAY-PATCHED-1
+jackson-databind=com.liferay:com.fasterxml.jackson.databind:2.10.3.LIFERAY-PATCHED-1
jai-imageio-core=com.github.jai-imageio:jai-imageio-core:1.4.0
jai-imageio-jpeg2000=com.github.jai-imageio:jai-imageio-jpeg2000:1.3.0
jai\_codec=com.sun.media:jai-codec:1.1.3
@@ -186,7 +187,7 @@ xml-apis=xml-apis:xml-apis:1.4.01
xmlsec=org.apache.santuario:xmlsec:1.5.8
xmpcore=com.adobe.xmp:xmpcore:5.1.3
xpp3=xpp3:xpp3\_min:1.1.4c
-xstream=com.thoughtworks.xstream:xstream:1.4.14
+xstream=com.thoughtworks.xstream:xstream:1.4.15
xuggle-xuggler-noarch=com.liferay:xuggle.xuggler.noarch:5.4
xz=org.tukaani:xz:1.8
yui-compressor=com.yahoo.platform.yui:yuicompressor:2.4.8
\ No newline at end of file
diff --git a/lib/versions-complete.xml b/lib/versions-complete.xml
index 5b798666a88418..58fec0e025491a 100644
--- a/lib/versions-complete.xml
+++ b/lib/versions-complete.xml
@@ -5693,7 +5693,7 @@

lib/portal/commons-httpclient.jar
- 3.1.0
+ 3.1.LIFERAY-PATCHED-1
Commons HttpClient
http://hc.apache.org/httpclient-legacy/index.html
diff --git a/lib/versions-ext.xml b/lib/versions-ext.xml
index 3ffbd03cc19e96..70d980c2386dbb 100644
--- a/lib/versions-ext.xml
+++ b/lib/versions-ext.xml
@@ -552,7 +552,7 @@

lib/development/mysql.jar
- 8.0.16
+ 8.0.21
MySQL Connector/J
http://www.mysql.com/products/connector/j
@@ -1387,7 +1387,7 @@

lib/portal/commons-httpclient.jar
- 3.1.0
+ 3.1.LIFERAY-PATCHED-1
Commons HttpClient
http://hc.apache.org/httpclient-legacy/index.html
@@ -3359,7 +3359,7 @@

lib/portal/xstream.jar
- 1.4.14
+ 1.4.15
XStream
http://xstream.codehaus.org
diff --git a/lib/versions.html b/lib/versions.html
index 67cf35b4877995..1c17abdd67e865 100644
--- a/lib/versions.html
+++ b/lib/versions.html
@@ -2494,7 +2494,7 @@  ||- lib/portal/commons-httpclient.jar | 3.1.0 | [Commons HttpClient](http://hc.apache.org/httpclient-legacy/index.html) | [Apache License 2.0](http://www.apache.org/licenses/LICENSE-2.0) + lib/portal/commons-httpclient.jar | 3.1.LIFERAY-PATCHED-1 | [Commons HttpClient](http://hc.apache.org/httpclient-legacy/index.html) | [Apache License 2.0](http://www.apache.org/licenses/LICENSE-2.0) |  | |
diff --git a/modules/apps/bulk/bulk-rest-api/build.gradle b/modules/apps/bulk/bulk-rest-api/build.gradle
index 97fc7730cb94b9..0460a15b7ec65b 100644
--- a/modules/apps/bulk/bulk-rest-api/build.gradle
+++ b/modules/apps/bulk/bulk-rest-api/build.gradle
@@ -1,5 +1,5 @@
dependencies {
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.10.3"
compileOnly group: "com.liferay", name: "com.liferay.petra.function", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.vulcan.api", version: "3.3.0"
diff --git a/modules/apps/bulk/bulk-rest-impl/build.gradle b/modules/apps/bulk/bulk-rest-impl/build.gradle
index 6e9285ea5f0385..9e57f1d100e55d 100644
--- a/modules/apps/bulk/bulk-rest-impl/build.gradle
+++ b/modules/apps/bulk/bulk-rest-impl/build.gradle
@@ -1,5 +1,5 @@
dependencies {
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.10.3"
compileOnly group: "com.liferay", name: "com.liferay.bulk.rest.api", version: "1.3.0"
compileOnly group: "com.liferay", name: "com.liferay.bulk.selection.api", version: "1.0.0"
compileOnly group: "com.liferay", name: "com.liferay.document.library.api", version: "5.0.0"
diff --git a/modules/apps/bulk/bulk-rest-test/build.gradle b/modules/apps/bulk/bulk-rest-test/build.gradle
index 605256ef5dc9ef..deb77a164d3526 100644
--- a/modules/apps/bulk/bulk-rest-test/build.gradle
+++ b/modules/apps/bulk/bulk-rest-test/build.gradle
@@ -1,7 +1,7 @@
dependencies {
- testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
- testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
- testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.10.1"
+ testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.10.3"
+ testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.10.3"
+ testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.10.5.1"
testIntegrationCompile group: "com.liferay", name: "com.liferay.arquillian.extension.junit.bridge", version: "1.0.19"
testIntegrationCompile group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "default"
testIntegrationCompile project(":apps:bulk:bulk-rest-api")
diff --git a/modules/apps/comment/comment-sanitizer/build.gradle b/modules/apps/comment/comment-sanitizer/build.gradle
index 143a2a1aea1953..9e6433eef829f3 100644
--- a/modules/apps/comment/comment-sanitizer/build.gradle
+++ b/modules/apps/comment/comment-sanitizer/build.gradle
@@ -1,11 +1,11 @@
dependencies {
compileInclude group: "com.google.errorprone", name: "error\_prone\_annotations", version: "2.2.0"
compileInclude group: "com.google.guava", name: "failureaccess", version: "1.0.1"
- compileInclude group: "com.google.guava", name: "guava", version: "27.1-jre"
+ compileInclude group: "com.google.guava", name: "guava", version: "30.1.1-jre"
compileInclude group: "com.google.guava", name: "listenablefuture", version: "9999.0-empty-to-avoid-conflict-with-guava"
- compileInclude group: "com.google.j2objc", name: "j2objc-annotations", version: "1.1"
+ compileInclude group: "com.google.j2objc", name: "j2objc-annotations", version: "1.3"
compileInclude group: "com.googlecode.owasp-java-html-sanitizer", name: "owasp-java-html-sanitizer", version: "r239"
- compileInclude group: "org.checkerframework", name: "checker-qual", version: "2.5.2"
+ compileInclude group: "org.checkerframework", name: "checker-qual", version: "3.11.0"
compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "3.0.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "4.0.0"
diff --git a/modules/apps/data-engine/data-engine-rest-api/build.gradle b/modules/apps/data-engine/data-engine-rest-api/build.gradle
index 97fc7730cb94b9..0460a15b7ec65b 100644
--- a/modules/apps/data-engine/data-engine-rest-api/build.gradle
+++ b/modules/apps/data-engine/data-engine-rest-api/build.gradle
@@ -1,5 +1,5 @@
dependencies {
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.10.3"
compileOnly group: "com.liferay", name: "com.liferay.petra.function", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.vulcan.api", version: "3.3.0"
diff --git a/modules/apps/data-engine/data-engine-rest-impl/build.gradle b/modules/apps/data-engine/data-engine-rest-impl/build.gradle
index 700869293ddc12..0f22b4fd5f5c78 100644
--- a/modules/apps/data-engine/data-engine-rest-impl/build.gradle
+++ b/modules/apps/data-engine/data-engine-rest-impl/build.gradle
@@ -3,7 +3,7 @@ dependencies {
compileInclude group: "net.minidev", name: "accessors-smart", version: "1.1"
compileInclude group: "net.minidev", name: "json-smart", version: "2.2.1"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.10.3"
compileOnly group: "com.liferay", name: "com.liferay.captcha.taglib", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.data.engine.api", version: "2.1.0"
compileOnly group: "com.liferay", name: "com.liferay.data.engine.rest.api", version: "9.2.0"
diff --git a/modules/apps/data-engine/data-engine-rest-test/build.gradle b/modules/apps/data-engine/data-engine-rest-test/build.gradle
index 6ef67f3be536fc..763cff2c773c60 100644
--- a/modules/apps/data-engine/data-engine-rest-test/build.gradle
+++ b/modules/apps/data-engine/data-engine-rest-test/build.gradle
@@ -1,7 +1,7 @@
dependencies {
- testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
- testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
- testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.10.1"
+ testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.10.3"
+ testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.10.3"
+ testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.10.5.1"
testIntegrationCompile group: "com.liferay", name: "com.liferay.arquillian.extension.junit.bridge", version: "1.0.19"
testIntegrationCompile group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "default"
testIntegrationCompile project(":apps:data-engine:data-engine-rest-api")
diff --git a/modules/apps/document-library-opener/document-library-opener-google-drive-web/bnd.bnd b/modules/apps/document-library-opener/document-library-opener-google-drive-web/bnd.bnd
index 0f1d9292d2f5d3..930ce0620beda1 100644
--- a/modules/apps/document-library-opener/document-library-opener-google-drive-web/bnd.bnd
+++ b/modules/apps/document-library-opener/document-library-opener-google-drive-web/bnd.bnd
@@ -2,6 +2,8 @@ Bundle-Name: Liferay Document Library Opener Google Drive Web
Bundle-SymbolicName: com.liferay.document.library.opener.google.drive.web
Bundle-Version: 1.0.23
Import-Package:\
+ !com.google.common.util.concurrent.\*,\
+ \
!javax.jdo.\*,\
\
!org.apache.http.\*,\
diff --git a/modules/apps/document-library-opener/document-library-opener-google-drive-web/build.gradle b/modules/apps/document-library-opener/document-library-opener-google-drive-web/build.gradle
index b8110569b63136..6c7cc07125b845 100644
--- a/modules/apps/document-library-opener/document-library-opener-google-drive-web/build.gradle
+++ b/modules/apps/document-library-opener/document-library-opener-google-drive-web/build.gradle
@@ -5,15 +5,15 @@ dependencies {
compileInclude group: "com.google.api-client", name: "google-api-client-servlet", version: "1.23.0"
compileInclude group: "com.google.apis", name: "google-api-services-drive", version: "v3-rev20190311-1.28.0"
compileInclude group: "com.google.apis", name: "google-api-services-oauth2", version: "v2-rev137-1.23.0"
- compileInclude group: "com.google.errorprone", name: "error\_prone\_annotations", version: "2.3.1"
- compileInclude group: "com.google.guava", name: "guava", version: "25.1-jre"
+ compileInclude group: "com.google.errorprone", name: "error\_prone\_annotations", version: "2.5.1"
+ compileInclude group: "com.google.guava", name: "guava", version: "30.1.1-jre"
compileInclude group: "com.google.http-client", name: "google-http-client", version: "1.23.0"
compileInclude group: "com.google.http-client", name: "google-http-client-jackson2", version: "1.23.0"
compileInclude group: "com.google.oauth-client", name: "google-oauth-client", version: "1.31.0"
compileInclude group: "com.google.oauth-client", name: "google-oauth-client-java6", version: "1.31.0"
compileInclude group: "com.google.oauth-client", name: "google-oauth-client-servlet", version: "1.31.0"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.10.3"
compileOnly group: "com.liferay", name: "com.liferay.connected.app.api", version: "1.0.0"
compileOnly group: "com.liferay", name: "com.liferay.document.library.api", version: "5.0.0"
compileOnly group: "com.liferay", name: "com.liferay.document.library.google.drive.api", version: "1.0.0"
diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/src/main/resources/META-INF/resource-actions/default.xml b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/src/main/resources/META-INF/resource-actions/default.xml
index b2895379fed035..0125905fbcef5c 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/src/main/resources/META-INF/resource-actions/default.xml
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-service/src/main/resources/META-INF/resource-actions/default.xml
@@ -16,11 +16,7 @@
ADD\_FORM\_INSTANCE
ADD\_STRUCTURE

-
- ADD\_DATA\_PROVIDER\_INSTANCE
- ADD\_FORM\_INSTANCE
- ADD\_STRUCTURE
-
+

ADD\_DATA\_PROVIDER\_INSTANCE
diff --git a/modules/apps/export-import/export-import-service/build.gradle b/modules/apps/export-import/export-import-service/build.gradle
index 9ca390c928919e..71faf729166301 100644
--- a/modules/apps/export-import/export-import-service/build.gradle
+++ b/modules/apps/export-import/export-import-service/build.gradle
@@ -22,8 +22,7 @@ dependencies {
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "4.0.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "4.34.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.util.java", version: "4.0.0"
- compileOnly group: "com.thoughtworks.xstream", name: "xstream", version: "1.4.14"
-
+ compileOnly group: "com.thoughtworks.xstream", name: "xstream", version: "1.4.15"
compileOnly group: "commons-lang", name: "commons-lang", version: "2.6"
compileOnly group: "javax.portlet", name: "portlet-api", version: "3.0.1"
compileOnly group: "org.apache.felix", name: "org.apache.felix.http.servlet-api", version: "1.1.2"
diff --git a/modules/apps/frontend-js/frontend-js-jquery-web/build.gradle b/modules/apps/frontend-js/frontend-js-jquery-web/build.gradle
index 7f45afd929247f..b059e0f53e1442 100644
--- a/modules/apps/frontend-js/frontend-js-jquery-web/build.gradle
+++ b/modules/apps/frontend-js/frontend-js-jquery-web/build.gradle
@@ -2,6 +2,7 @@ import com.liferay.gradle.util.copy.StripPathSegmentsAction
task buildBootstrapJS(type: Copy)
task buildJQuery(type: Copy)
+task buildJQueryForm(type: Copy)
task buildPopperJS(type: Copy)
File jsDestinationDir = file("tmp/META-INF/resources")
@@ -39,6 +40,21 @@ buildJQuery {
into jqueryDestinationDir
}
+buildJQueryForm {
+ dependsOn buildJQuery
+
+ eachFile new StripPathSegmentsAction(2)
+
+ from npmInstall.nodeModulesDir
+
+ include "@liferay/jquery-form/jquery.form.js"
+
+ includeEmptyDirs = false
+ into jqueryDestinationDir
+
+ rename "jquery.form.js", "form.js"
+}
+
buildPopperJS {
dependsOn buildJQuery
@@ -56,6 +72,7 @@ buildPopperJS {
classes {
dependsOn buildBootstrapJS
dependsOn buildJQuery
+ dependsOn buildJQueryForm
dependsOn buildPopperJS
}
diff --git a/modules/apps/frontend-js/frontend-js-jquery-web/package.json b/modules/apps/frontend-js/frontend-js-jquery-web/package.json
index c9184d0e09cafa..874996850583aa 100644
--- a/modules/apps/frontend-js/frontend-js-jquery-web/package.json
+++ b/modules/apps/frontend-js/frontend-js-jquery-web/package.json
@@ -1,5 +1,6 @@
{
"dependencies": {
+ "@liferay/jquery-form": "3.51.0-liferay.1",
"bootstrap": "4.3.1",
"jquery": "3.5.1",
"popper.js": "1.14.7"
diff --git a/modules/apps/frontend-js/frontend-js-jquery-web/src/main/resources/META-INF/resources/jquery/form.js b/modules/apps/frontend-js/frontend-js-jquery-web/src/main/resources/META-INF/resources/jquery/form.js
index e892544ac8854e..e69de29bb2d1d6 100644
--- a/modules/apps/frontend-js/frontend-js-jquery-web/src/main/resources/META-INF/resources/jquery/form.js
+++ b/modules/apps/frontend-js/frontend-js-jquery-web/src/main/resources/META-INF/resources/jquery/form.js
@@ -1,1491 +0,0 @@
-/\*\*
- \* Copyright (c) 2000-present Liferay, Inc. All rights reserved.
- \*
- \* This library is free software; you can redistribute it and/or modify it under
- \* the terms of the GNU Lesser General Public License as published by the Free
- \* Software Foundation; either version 2.1 of the License, or (at your option)
- \* any later version.
- \*
- \* This library is distributed in the hope that it will be useful, but WITHOUT
- \* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
- \* FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
- \* details.
- \*/
-
-(function(jQuery) {
- /\*!
- \* jQuery Form Plugin
- \* version: 3.51.0-2014.06.20
- \* Requires jQuery v1.5 or later
- \* Copyright (c) 2014 M. Alsup
- \* Examples and documentation at: http://malsup.com/jquery/form/
- \* Project repository: https://github.com/malsup/form
- \* Dual licensed under the MIT and GPL licenses.
- \* https://github.com/malsup/form#copyright-and-license
- \*/
- /\*global ActiveXObject \*/
-
- // AMD support
- (function(factory) {
- 'use strict';
- if (false && typeof define === 'function' && define.amd) {
- // using AMD; register as anon module
- define(['jquery'], factory);
- } else {
- // no AMD; invoke directly
- factory(typeof jQuery != 'undefined' ? jQuery : window.Zepto);
- }
- })(function($) {
- 'use strict';
-
- /\*
- Usage Note:
- -----------
- Do not use both ajaxSubmit and ajaxForm on the same form. These
- functions are mutually exclusive. Use ajaxSubmit if you want
- to bind your own submit handler to the form. For example,
-
- $(document).ready(function() {
- $('#myForm').on('submit', function(e) {
- e.preventDefault(); // <-- important
- $(this).ajaxSubmit({
- target: '#output'
- });
- });
- });
-
- Use ajaxForm when you want the plugin to manage all the event binding
- for you. For example,
-
- $(document).ready(function() {
- $('#myForm').ajaxForm({
- target: '#output'
- });
- });
-
- You can also use ajaxForm with delegation (requires jQuery v1.7+), so the
- form does not have to exist when you invoke ajaxForm:
-
- $('#myForm').ajaxForm({
- delegation: true,
- target: '#output'
- });
-
- When using ajaxForm, the ajaxSubmit function will be invoked for you
- at the appropriate time.
-\*/
-
- /\*\*
- \* Feature detection
- \*/
- var feature = {};
- feature.fileapi = $("").get(0).files !== undefined;
- feature.formdata = window.FormData !== undefined;
-
- var hasProp = !!$.fn.prop;
-
- // attr2 uses prop when it can but checks the return type for
- // an expected string. this accounts for the case where a form
- // contains inputs with names like "action" or "method"; in those
- // cases "prop" returns the element
- $.fn.attr2 = function() {
- if (!hasProp) {
- return this.attr.apply(this, arguments);
- }
- var val = this.prop.apply(this, arguments);
- if ((val && val.jquery) || typeof val === 'string') {
- return val;
- }
- return this.attr.apply(this, arguments);
- };
-
- /\*\*
- \* ajaxSubmit() provides a mechanism for immediately submitting
- \* an HTML form using AJAX.
- \*/
- $.fn.ajaxSubmit = function(options) {
- /\*jshint scripturl:true \*/
-
- // fast fail if nothing selected (http://dev.jquery.com/ticket/2752)
- if (!this.length) {
- log(
- 'ajaxSubmit: skipping submit process - no element selected'
- );
- return this;
- }
-
- var method,
- action,
- url,
- $form = this;
-
- if (typeof options == 'function') {
- options = {success: options};
- } else if (options === undefined) {
- options = {};
- }
-
- method = options.type || this.attr2('method');
- action = options.url || this.attr2('action');
-
- url = typeof action === 'string' ? $.trim(action) : '';
- url = url || window.location.href || '';
- if (url) {
- // clean url (don't include hash vaue)
- url = (url.match(/^([^#]+)/) || [])[1];
- }
-
- options = $.extend(
- true,
- {
- url,
- success: $.ajaxSettings.success,
- type: method || $.ajaxSettings.type,
- iframeSrc: /^https/i.test(window.location.href || '')
- ? 'javascript:false'
- : 'about:blank'
- },
- options
- );
-
- // hook for manipulating the form data before it is extracted;
- // convenient for use with rich editors like tinyMCE or FCKEditor
- var veto = {};
- this.trigger('form-pre-serialize', [this, options, veto]);
- if (veto.veto) {
- log('ajaxSubmit: submit vetoed via form-pre-serialize trigger');
- return this;
- }
-
- // provide opportunity to alter form data before it is serialized
- if (
- options.beforeSerialize &&
- options.beforeSerialize(this, options) === false
- ) {
- log('ajaxSubmit: submit aborted via beforeSerialize callback');
- return this;
- }
-
- var traditional = options.traditional;
- if (traditional === undefined) {
- traditional = $.ajaxSettings.traditional;
- }
-
- var elements = [];
- var qx,
- a = this.formToArray(options.semantic, elements);
- if (options.data) {
- options.extraData = options.data;
- qx = $.param(options.data, traditional);
- }
-
- // give pre-submit callback an opportunity to abort the submit
- if (
- options.beforeSubmit &&
- options.beforeSubmit(a, this, options) === false
- ) {
- log('ajaxSubmit: submit aborted via beforeSubmit callback');
- return this;
- }
-
- // fire vetoable 'validate' event
- this.trigger('form-submit-validate', [a, this, options, veto]);
- if (veto.veto) {
- log(
- 'ajaxSubmit: submit vetoed via form-submit-validate trigger'
- );
- return this;
- }
-
- var q = $.param(a, traditional);
- if (qx) {
- q = q ? q + '&' + qx : qx;
- }
- if (options.type.toUpperCase() == 'GET') {
- options.url += (options.url.indexOf('?') >= 0 ? '&' : '?') + q;
- options.data = null; // data is null for 'get'
- } else {
- options.data = q; // data is the query string for 'post'
- }
-
- var callbacks = [];
- if (options.resetForm) {
- callbacks.push(function() {
- $form.resetForm();
- });
- }
- if (options.clearForm) {
- callbacks.push(function() {
- $form.clearForm(options.includeHidden);
- });
- }
-
- // perform a load on the target only if dataType is not provided
- if (!options.dataType && options.target) {
- var oldSuccess = options.success || function() {};
- callbacks.push(function(data) {
- var fn = options.replaceTarget ? 'replaceWith' : 'html';
- $(options.target)
- [fn](data)
- .each(oldSuccess, arguments);
- });
- } else if (options.success) {
- callbacks.push(options.success);
- }
-
- options.success = function(data, status, xhr) {
- // jQuery 1.4+ passes xhr as 3rd arg
- var context = options.context || this; // jQuery 1.4+ supports scope context
- for (var i = 0, max = callbacks.length; i < max; i++) {
- callbacks[i].apply(context, [
- data,
- status,
- xhr || $form,
- $form
- ]);
- }
- };
-
- if (options.error) {
- var oldError = options.error;
- options.error = function(xhr, status, error) {
- var context = options.context || this;
- oldError.apply(context, [xhr, status, error, $form]);
- };
- }
-
- if (options.complete) {
- var oldComplete = options.complete;
- options.complete = function(xhr, status) {
- var context = options.context || this;
- oldComplete.apply(context, [xhr, status, $form]);
- };
- }
-
- // are there files to upload?
-
- // [value] (issue #113), also see comment:
- // https://github.com/malsup/form/commit/588306aedba1de01388032d5f42a60159eea9228#commitcomment-2180219
- var fileInputs = $('input[type=file]:enabled', this).filter(
- function() {
- return $(this).val() !== '';
- }
- );
-
- var hasFileInputs = fileInputs.length > 0;
- var mp = 'multipart/form-data';
- var multipart =
- $form.attr('enctype') == mp || $form.attr('encoding') == mp;
-
- var fileAPI = feature.fileapi && feature.formdata;
- log('fileAPI :' + fileAPI);
- var shouldUseFrame = (hasFileInputs || multipart) && !fileAPI;
-
- var jqxhr;
-
- // options.iframe allows user to force iframe mode
- // 06-NOV-09: now defaulting to iframe mode if file input is detected
- if (
- options.iframe !== false &&
- (options.iframe || shouldUseFrame)
- ) {
- // hack to fix Safari hang (thanks to Tim Molendijk for this)
- // see: http://groups.google.com/group/jquery-dev/browse\_thread/thread/36395b7ab510dd5d
- if (options.closeKeepAlive) {
- $.get(options.closeKeepAlive, function() {
- jqxhr = fileUploadIframe(a);
- });
- } else {
- jqxhr = fileUploadIframe(a);
- }
- } else if ((hasFileInputs || multipart) && fileAPI) {
- jqxhr = fileUploadXhr(a);
- } else {
- jqxhr = $.ajax(options);
- }
-
- $form.removeData('jqxhr').data('jqxhr', jqxhr);
-
- // clear element array
- for (var k = 0; k < elements.length; k++) {
- elements[k] = null;
- }
-
- // fire 'notify' event
- this.trigger('form-submit-notify', [this, options]);
- return this;
-
- // utility fn for deep serialization
- function deepSerialize(extraData) {
- var serialized = $.param(extraData, options.traditional).split(
- '&'
- );
- var len = serialized.length;
- var result = [];
- var i, part;
- for (i = 0; i < len; i++) {
- // #252; undo param space replacement
- serialized[i] = serialized[i].replace(/\+/g, ' ');
- part = serialized[i].split('=');
- // #278; use array instead of object storage, favoring array serializations
- result.push([
- decodeURIComponent(part[0]),
- decodeURIComponent(part[1])
- ]);
- }
- return result;
- }
-
- // XMLHttpRequest Level 2 file uploads (big hat tip to francois2metz)
- function fileUploadXhr(a) {
- var formdata = new FormData();
-
- for (var i = 0; i < a.length; i++) {
- formdata.append(a[i].name, a[i].value);
- }
-
- if (options.extraData) {
- var serializedData = deepSerialize(options.extraData);
- for (i = 0; i < serializedData.length; i++) {
- if (serializedData[i]) {
- formdata.append(
- serializedData[i][0],
- serializedData[i][1]
- );
- }
- }
- }
-
- options.data = null;
-
- var s = $.extend(true, {}, $.ajaxSettings, options, {
- contentType: false,
- processData: false,
- cache: false,
- type: method || 'POST'
- });
-
- if (options.uploadProgress) {
- // workaround because jqXHR does not expose upload property
- s.xhr = function() {
- var xhr = $.ajaxSettings.xhr();
- if (xhr.upload) {
- xhr.upload.addEventListener(
- 'progress',
- function(event) {
- var percent = 0;
- var position =
- event.loaded ||
- event.position; /\*event.position is deprecated\*/
- var total = event.total;
- if (event.lengthComputable) {
- percent = Math.ceil(
- (position / total) \* 100
- );
- }
- options.uploadProgress(
- event,
- position,
- total,
- percent
- );
- },
- false
- );
- }
- return xhr;
- };
- }
-
- s.data = null;
- var beforeSend = s.beforeSend;
- s.beforeSend = function(xhr, o) {
- //Send FormData() provided by user
- if (options.formData) {
- o.data = options.formData;
- } else {
- o.data = formdata;
- }
- if (beforeSend) {
- beforeSend.call(this, xhr, o);
- }
- };
- return $.ajax(s);
- }
-
- // private function for handling file uploads (hat tip to YAHOO!)
- function fileUploadIframe(a) {
- var form = $form[0],
- el,
- i,
- s,
- g,
- id,
- $io,
- io,
- xhr,
- sub,
- n,
- timedOut,
- timeoutHandle;
- var deferred = $.Deferred();
-
- // #341
- deferred.abort = function(status) {
- xhr.abort(status);
- };
-
- if (a) {
- // ensure that every serialized input is still enabled
- for (i = 0; i < elements.length; i++) {
- el = $(elements[i]);
- if (hasProp) {
- el.prop('disabled', false);
- } else {
- el.removeAttr('disabled');
- }
- }
- }
-
- s = $.extend(true, {}, $.ajaxSettings, options);
- s.context = s.context || s;
- id = 'jqFormIO' + new Date().getTime();
- if (s.iframeTarget) {
- $io = $(s.iframeTarget);
- n = $io.attr2('name');
- if (!n) {
- $io.attr2('name', id);
- } else {
- id = n;
- }
- } else {
- $io = $(
- ''
- );
- $io.css({
- position: 'absolute',
- top: '-1000px',
- left: '-1000px'
- });
- }
- io = $io[0];
-
- xhr = {
- // mock object
- aborted: 0,
- responseText: null,
- responseXML: null,
- status: 0,
- statusText: 'n/a',
- getAllResponseHeaders() {},
- getResponseHeader() {},
- setRequestHeader() {},
- abort(status) {
- var e = status === 'timeout' ? 'timeout' : 'aborted';
- log('aborting upload... ' + e);
- this.aborted = 1;
-
- try {
- // #214, #257
- if (io.contentWindow.document.execCommand) {
- io.contentWindow.document.execCommand('Stop');
- }
- } catch (ignore) {}
-
- $io.attr('src', s.iframeSrc); // abort op in progress
- xhr.error = e;
- if (s.error) {
- s.error.call(s.context, xhr, e, status);
- }
- if (g) {
- $.event.trigger('ajaxError', [xhr, s, e]);
- }
- if (s.complete) {
- s.complete.call(s.context, xhr, e);
- }
- }
- };
-
- g = s.global;
- // trigger ajax global events so that activity/block indicators work like normal
- if (g && 0 === $.active++) {
- $.event.trigger('ajaxStart');
- }
- if (g) {
- $.event.trigger('ajaxSend', [xhr, s]);
- }
-
- if (
- s.beforeSend &&
- s.beforeSend.call(s.context, xhr, s) === false
- ) {
- if (s.global) {
- $.active--;
- }
- deferred.reject();
- return deferred;
- }
- if (xhr.aborted) {
- deferred.reject();
- return deferred;
- }
-
- // add submitting element to data if we know it
- sub = form.clk;
- if (sub) {
- n = sub.name;
- if (n && !sub.disabled) {
- s.extraData = s.extraData || {};
- s.extraData[n] = sub.value;
- if (sub.type == 'image') {
- s.extraData[n + '.x'] = form.clk\_x;
- s.extraData[n + '.y'] = form.clk\_y;
- }
- }
- }
-
- var CLIENT\_TIMEOUT\_ABORT = 1;
- var SERVER\_ABORT = 2;
-
- function getDoc(frame) {
- /\* it looks like contentWindow or contentDocument do not
- \* carry the protocol property in ie8, when running under ssl
- \* frame.document is the only valid response document, since
- \* the protocol is know but not on the other two objects. strange?
- \* "Same origin policy" http://en.wikipedia.org/wiki/Same\_origin\_policy
- \*/
-
- var doc = null;
-
- // IE8 cascading access check
- try {
- if (frame.contentWindow) {
- doc = frame.contentWindow.document;
- }
- } catch (err) {
- // IE8 access denied under ssl & missing protocol
- log('cannot get iframe.contentWindow document: ' + err);
- }
-
- if (doc) {
- // successful getting content
- return doc;
- }
-
- try {
- // simply checking may throw in ie8 under ssl or mismatched protocol
- doc = frame.contentDocument
- ? frame.contentDocument
- : frame.document;
- } catch (err) {
- // last attempt
- log('cannot get iframe.contentDocument: ' + err);
- doc = frame.document;
- }
- return doc;
- }
-
- // Rails CSRF hack (thanks to Yvan Barthelemy)
- var csrf\_token = $('meta[name=csrf-token]').attr('content');
- var csrf\_param = $('meta[name=csrf-param]').attr('content');
- if (csrf\_param && csrf\_token) {
- s.extraData = s.extraData || {};
- s.extraData[csrf\_param] = csrf\_token;
- }
-
- // take a breath so that pending repaints get some cpu time before the upload starts
- function doSubmit() {
- // make sure form attrs are set
- var t = $form.attr2('target'),
- a = $form.attr2('action'),
- mp = 'multipart/form-data',
- et =
- $form.attr('enctype') ||
- $form.attr('encoding') ||
- mp;
-
- // update form attrs in IE friendly way
- form.setAttribute('target', id);
- if (!method || /post/i.test(method)) {
- form.setAttribute('method', 'POST');
- }
- if (a != s.url) {
- form.setAttribute('action', s.url);
- }
-
- // ie borks in some cases when setting encoding
- if (
- !s.skipEncodingOverride &&
- (!method || /post/i.test(method))
- ) {
- $form.attr({
- encoding: 'multipart/form-data',
- enctype: 'multipart/form-data'
- });
- }
-
- // support timout
- if (s.timeout) {
- timeoutHandle = setTimeout(function() {
- timedOut = true;
- cb(CLIENT\_TIMEOUT\_ABORT);
- }, s.timeout);
- }
-
- // look for server aborts
- function checkState() {
- try {
- var state = getDoc(io).readyState;
- log('state = ' + state);
- if (
- state &&
- state.toLowerCase() == 'uninitialized'
- ) {
- setTimeout(checkState, 50);
- }
- } catch (e) {
- log('Server abort: ', e, ' (', e.name, ')');
- cb(SERVER\_ABORT);
- if (timeoutHandle) {
- clearTimeout(timeoutHandle);
- }
- timeoutHandle = undefined;
- }
- }
-
- // add "extra" data to form if provided in options
- var extraInputs = [];
- try {
- if (s.extraData) {
- for (var n in s.extraData) {
- if (s.extraData.hasOwnProperty(n)) {
- // if using the $.param format that allows for multiple values with the same name
- if (
- $.isPlainObject(s.extraData[n]) &&
- s.extraData[n].hasOwnProperty('name') &&
- s.extraData[n].hasOwnProperty('value')
- ) {
- extraInputs.push(
- $(
- ''
- )
- .val(s.extraData[n].value)
- .appendTo(form)[0]
- );
- } else {
- extraInputs.push(
- $(
- ''
- )
- .val(s.extraData[n])
- .appendTo(form)[0]
- );
- }
- }
- }
- }
-
- if (!s.iframeTarget) {
- // add iframe to doc and submit the form
- $io.appendTo('body');
- }
- if (io.attachEvent) {
- io.attachEvent('onload', cb);
- } else {
- io.addEventListener('load', cb, false);
- }
- setTimeout(checkState, 15);
-
- try {
- form.submit();
- } catch (err) {
- // just in case form has element with name/id of 'submit'
- var submitFn = document.createElement('form')
- .submit;
- submitFn.apply(form);
- }
- } finally {
- // reset attrs and remove "extra" input elements
- form.setAttribute('action', a);
- form.setAttribute('enctype', et); // #380
- if (t) {
- form.setAttribute('target', t);
- } else {
- $form.removeAttr('target');
- }
- $(extraInputs).remove();
- }
- }
-
- if (s.forceSync) {
- doSubmit();
- } else {
- setTimeout(doSubmit, 10); // this lets dom updates render
- }
-
- var data,
- doc,
- domCheckCount = 50,
- callbackProcessed;
-
- function cb(e) {
- if (xhr.aborted || callbackProcessed) {
- return;
- }
-
- doc = getDoc(io);
- if (!doc) {
- log('cannot access response document');
- e = SERVER\_ABORT;
- }
- if (e === CLIENT\_TIMEOUT\_ABORT && xhr) {
- xhr.abort('timeout');
- deferred.reject(xhr, 'timeout');
- return;
- } else if (e == SERVER\_ABORT && xhr) {
- xhr.abort('server abort');
- deferred.reject(xhr, 'error', 'server abort');
- return;
- }
-
- if (!doc || doc.location.href == s.iframeSrc) {
- // response not received yet
- if (!timedOut) {
- return;
- }
- }
- if (io.detachEvent) {
- io.detachEvent('onload', cb);
- } else {
- io.removeEventListener('load', cb, false);
- }
-
- var status = 'success',
- errMsg;
- try {
- if (timedOut) {
- throw 'timeout';
- }
-
- var isXml =
- s.dataType == 'xml' ||
- doc.XMLDocument ||
- $.isXMLDoc(doc);
- log('isXml=' + isXml);
- if (
- !isXml &&
- window.opera &&
- (doc.body === null || !doc.body.innerHTML)
- ) {
- if (--domCheckCount) {
- // in some browsers (Opera) the iframe DOM is not always traversable when
- // the onload callback fires, so we loop a bit to accommodate
- log(
- 'requeing onLoad callback, DOM not available'
- );
- setTimeout(cb, 250);
- return;
- }
- // let this fall through because server response could be an empty document
- //log('Could not access iframe DOM after mutiple tries.');
- //throw 'DOMException: not available';
- }
-
- //log('response detected');
- var docRoot = doc.body ? doc.body : doc.documentElement;
- xhr.responseText = docRoot ? docRoot.innerHTML : null;
- xhr.responseXML = doc.XMLDocument
- ? doc.XMLDocument
- : doc;
- if (isXml) {
- s.dataType = 'xml';
- }
- xhr.getResponseHeader = function(header) {
- var headers = {'content-type': s.dataType};
- return headers[header.toLowerCase()];
- };
- // support for XHR 'status' & 'statusText' emulation :
- if (docRoot) {
- xhr.status =
- Number(docRoot.getAttribute('status')) ||
- xhr.status;
- xhr.statusText =
- docRoot.getAttribute('statusText') ||
- xhr.statusText;
- }
-
- var dt = (s.dataType || '').toLowerCase();
- var scr = /(json|script|text)/.test(dt);
- if (scr || s.textarea) {
- // see if user embedded response in textarea
- var ta = doc.getElementsByTagName('textarea')[0];
- if (ta) {
- xhr.responseText = ta.value;
- // support for XHR 'status' & 'statusText' emulation :
- xhr.status =
- Number(ta.getAttribute('status')) ||
- xhr.status;
- xhr.statusText =
- ta.getAttribute('statusText') ||
- xhr.statusText;
- } else if (scr) {
- // account for browsers injecting pre around json response
- var pre = doc.getElementsByTagName('pre')[0];
- var b = doc.getElementsByTagName('body')[0];
- if (pre) {
- xhr.responseText = pre.textContent
- ? pre.textContent
- : pre.innerText;
- } else if (b) {
- xhr.responseText = b.textContent
- ? b.textContent
- : b.innerText;
- }
- }
- } else if (
- dt == 'xml' &&
- !xhr.responseXML &&
- xhr.responseText
- ) {
- xhr.responseXML = toXml(xhr.responseText);
- }
-
- try {
- data = httpData(xhr, dt, s);
- } catch (err) {
- status = 'parsererror';
- xhr.error = errMsg = err || status;
- }
- } catch (err) {
- log('error caught: ', err);
- status = 'error';
- xhr.error = errMsg = err || status;
- }
-
- if (xhr.aborted) {
- log('upload aborted');
- status = null;
- }
-
- if (xhr.status) {
- // we've set xhr.status
- status =
- (xhr.status >= 200 && xhr.status < 300) ||
- xhr.status === 304
- ? 'success'
- : 'error';
- }
-
- // ordering of these callbacks/triggers is odd, but that's how $.ajax does it
- if (status === 'success') {
- if (s.success) {
- s.success.call(s.context, data, 'success', xhr);
- }
- deferred.resolve(xhr.responseText, 'success', xhr);
- if (g) {
- $.event.trigger('ajaxSuccess', [xhr, s]);
- }
- } else if (status) {
- if (errMsg === undefined) {
- errMsg = xhr.statusText;
- }
- if (s.error) {
- s.error.call(s.context, xhr, status, errMsg);
- }
- deferred.reject(xhr, 'error', errMsg);
- if (g) {
- $.event.trigger('ajaxError', [xhr, s, errMsg]);
- }
- }
-
- if (g) {
- $.event.trigger('ajaxComplete', [xhr, s]);
- }
-
- if (g && !--$.active) {
- $.event.trigger('ajaxStop');
- }
-
- if (s.complete) {
- s.complete.call(s.context, xhr, status);
- }
-
- callbackProcessed = true;
- if (s.timeout) {
- clearTimeout(timeoutHandle);
- }
-
- // clean up
- setTimeout(function() {
- if (!s.iframeTarget) {
- $io.remove();
- } else {
- //adding else to clean up existing iframe response.
- $io.attr('src', s.iframeSrc);
- }
- xhr.responseXML = null;
- }, 100);
- }
-
- var toXml =
- $.parseXML ||
- function(s, doc) {
- // use parseXML if available (jQuery 1.5+)
- if (window.ActiveXObject) {
- doc = new ActiveXObject('Microsoft.XMLDOM');
- doc.async = 'false';
- doc.loadXML(s);
- } else {
- doc = new DOMParser().parseFromString(
- s,
- 'text/xml'
- );
- }
- return doc &&
- doc.documentElement &&
- doc.documentElement.nodeName != 'parsererror'
- ? doc
- : null;
- };
- var parseJSON =
- $.parseJSON ||
- function(s) {
- /\*jslint evil:true \*/
- return window['eval']('(' + s + ')');
- };
-
- var httpData = function(xhr, type, s) {
- // mostly lifted from jq1.4.4
-
- var ct = xhr.getResponseHeader('content-type') || '',
- xml =
- type === 'xml' || (!type && ct.indexOf('xml') >= 0),
- data = xml ? xhr.responseXML : xhr.responseText;
-
- if (
- xml &&
- data.documentElement.nodeName === 'parsererror'
- ) {
- if ($.error) {
- $.error('parsererror');
- }
- }
- if (s && s.dataFilter) {
- data = s.dataFilter(data, type);
- }
- if (typeof data === 'string') {
- if (
- type === 'json' ||
- (!type && ct.indexOf('json') >= 0)
- ) {
- data = parseJSON(data);
- } else if (
- type === 'script' ||
- (!type && ct.indexOf('javascript') >= 0)
- ) {
- $.globalEval(data);
- }
- }
- return data;
- };
-
- return deferred;
- }
- };
-
- /\*\*
- \* ajaxForm() provides a mechanism for fully automating form submission.
- \*
- \* The advantages of using this method instead of ajaxSubmit() are:
- \*
- \* 1: This method will include coordinates for  elements (if the element
- \* is used to submit the form).
- \* 2. This method will include the submit element's name/value data (for the element that was
- \* used to submit the form).
- \* 3. This method binds the submit() method to the form for you.
- \*
- \* The options argument for ajaxForm works exactly as it does for ajaxSubmit. ajaxForm merely
- \* passes the options argument along after properly binding events for submit elements and
- \* the form itself.
- \*/
- $.fn.ajaxForm = function(options) {
- options = options || {};
- options.delegation = options.delegation && $.isFunction($.fn.on);
-
- // in jQuery 1.3+ we can fix mistakes with the ready state
- if (!options.delegation && this.length === 0) {
- var o = {s: this.selector, c: this.context};
- if (!$.isReady && o.s) {
- log('DOM not ready, queuing ajaxForm');
- $(function() {
- $(o.s, o.c).ajaxForm(options);
- });
- return this;
- }
- // is your DOM ready? http://docs.jquery.com/Tutorials:Introducing\_$(document).ready()
- log(
- 'terminating; zero elements found by selector' +
- ($.isReady ? '' : ' (DOM not ready)')
- );
- return this;
- }
-
- if (options.delegation) {
- $(document)
- .off('submit.form-plugin', this.selector, doAjaxSubmit)
- .off(
- 'click.form-plugin',
- this.selector,
- captureSubmittingElement
- )
- .on(
- 'submit.form-plugin',
- this.selector,
- options,
- doAjaxSubmit
- )
- .on(
- 'click.form-plugin',
- this.selector,
- options,
- captureSubmittingElement
- );
- return this;
- }
-
- return this.ajaxFormUnbind()
- .bind('submit.form-plugin', options, doAjaxSubmit)
- .bind('click.form-plugin', options, captureSubmittingElement);
- };
-
- // private event handlers
- function doAjaxSubmit(e) {
- /\*jshint validthis:true \*/
- var options = e.data;
- if (!e.isDefaultPrevented()) {
- // if event has been canceled, don't proceed
- e.preventDefault();
- $(e.target).ajaxSubmit(options); // #365
- }
- }
-
- function captureSubmittingElement(e) {
- /\*jshint validthis:true \*/
- var target = e.target;
- var $el = $(target);
- if (!$el.is('[type=submit],[type=image]')) {
- // is this a child element of the submit el? (ex: a span within a button)
- var t = $el.closest('[type=submit]');
- if (t.length === 0) {
- return;
- }
- target = t[0];
- }
- var form = this;
- form.clk = target;
- if (target.type == 'image') {
- if (e.offsetX !== undefined) {
- form.clk\_x = e.offsetX;
- form.clk\_y = e.offsetY;
- } else if (typeof $.fn.offset == 'function') {
- var offset = $el.offset();
- form.clk\_x = e.pageX - offset.left;
- form.clk\_y = e.pageY - offset.top;
- } else {
- form.clk\_x = e.pageX - target.offsetLeft;
- form.clk\_y = e.pageY - target.offsetTop;
- }
- }
- // clear form vars
- setTimeout(function() {
- form.clk = form.clk\_x = form.clk\_y = null;
- }, 100);
- }
-
- // ajaxFormUnbind unbinds the event handlers that were bound by ajaxForm
- $.fn.ajaxFormUnbind = function() {
- return this.unbind('submit.form-plugin click.form-plugin');
- };
-
- /\*\*
- \* formToArray() gathers form element data into an array of objects that can
- \* be passed to any of the following ajax functions: $.get, $.post, or load.
- \* Each object in the array has both a 'name' and 'value' property. An example of
- \* an array for a simple login form might be:
- \*
- \* [ { name: 'username', value: 'jresig' }, { name: 'password', value: 'secret' } ]
- \*
- \* It is this array that is passed to pre-submit callback functions provided to the
- \* ajaxSubmit() and ajaxForm() methods.
- \*/
- $.fn.formToArray = function(semantic, elements) {
- var a = [];
- if (this.length === 0) {
- return a;
- }
-
- var form = this[0];
- var formId = this.attr('id');
- var els = semantic ? form.getElementsByTagName('\*') : form.elements;
- var els2;
-
- if (els && !/MSIE [678]/.test(navigator.userAgent)) {
- // #390
- els = $(els).get(); // convert to standard array
- }
-
- // #386; account for inputs outside the form which use the 'form' attribute
- if (formId) {
- els2 = $(':input[form="' + formId + '"]').get(); // hat tip @thet
- if (els2.length) {
- els = (els || []).concat(els2);
- }
- }
-
- if (!els || !els.length) {
- return a;
- }
-
- var i, j, n, v, el, max, jmax;
- for (i = 0, max = els.length; i < max; i++) {
- el = els[i];
- n = el.name;
- if (!n || el.disabled) {
- continue;
- }
-
- if (semantic && form.clk && el.type == 'image') {
- // handle image inputs on the fly when semantic == true
- if (form.clk == el) {
- a.push({name: n, value: $(el).val(), type: el.type});
- a.push(
- {name: n + '.x', value: form.clk\_x},
- {name: n + '.y', value: form.clk\_y}
- );
- }
- continue;
- }
-
- v = $.fieldValue(el, true);
- if (v && v.constructor == Array) {
- if (elements) {
- elements.push(el);
- }
- for (j = 0, jmax = v.length; j < jmax; j++) {
- a.push({name: n, value: v[j]});
- }
- } else if (feature.fileapi && el.type == 'file') {
- if (elements) {
- elements.push(el);
- }
- var files = el.files;
- if (files.length) {
- for (j = 0; j < files.length; j++) {
- a.push({name: n, value: files[j], type: el.type});
- }
- } else {
- // #180
- a.push({name: n, value: '', type: el.type});
- }
- } else if (v !== null && typeof v != 'undefined') {
- if (elements) {
- elements.push(el);
- }
- a.push({
- name: n,
- value: v,
- type: el.type,
- required: el.required
- });
- }
- }
-
- if (!semantic && form.clk) {
- // input type=='image' are not found in elements array! handle it here
- var $input = $(form.clk),
- input = $input[0];
- n = input.name;
- if (n && !input.disabled && input.type == 'image') {
- a.push({name: n, value: $input.val()});
- a.push(
- {name: n + '.x', value: form.clk\_x},
- {name: n + '.y', value: form.clk\_y}
- );
- }
- }
- return a;
- };
-
- /\*\*
- \* Serializes form data into a 'submittable' string. This method will return a string
- \* in the format: name1=value1&name2=value2
- \*/
- $.fn.formSerialize = function(semantic) {
- //hand off to jQuery.param for proper encoding
- return $.param(this.formToArray(semantic));
- };
-
- /\*\*
- \* Serializes all field elements in the jQuery object into a query string.
- \* This method will return a string in the format: name1=value1&name2=value2
- \*/
- $.fn.fieldSerialize = function(successful) {
- var a = [];
- this.each(function() {
- var n = this.name;
- if (!n) {
- return;
- }
- var v = $.fieldValue(this, successful);
- if (v && v.constructor == Array) {
- for (var i = 0, max = v.length; i < max; i++) {
- a.push({name: n, value: v[i]});
- }
- } else if (v !== null && typeof v != 'undefined') {
- a.push({name: this.name, value: v});
- }
- });
- //hand off to jQuery.param for proper encoding
- return $.param(a);
- };
-
- /\*\*
- \* Returns the value(s) of the element in the matched set. For example, consider the following form:
- \*
- \*
- \*
- \*
- \*
- \*
- \*
- \*
- \*
- \*
- \* var v = $('input[type=text]').fieldValue();
- \* // if no values are entered into the text inputs
- \* v == ['','']
- \* // if values entered into the text inputs are 'foo' and 'bar'
- \* v == ['foo','bar']
- \*
- \* var v = $('input[type=checkbox]').fieldValue();
- \* // if neither checkbox is checked
- \* v === undefined
- \* // if both checkboxes are checked
- \* v == ['B1', 'B2']
- \*
- \* var v = $('input[type=radio]').fieldValue();
- \* // if neither radio is checked
- \* v === undefined
- \* // if first radio is checked
- \* v == ['C1']
- \*
- \* The successful argument controls whether or not the field element must be 'successful'
- \* (per http://www.w3.org/TR/html4/interact/forms.html#successful-controls).
- \* The default value of the successful argument is true. If this value is false the value(s)
- \* for each element is returned.
- \*
- \* Note: This method \*always\* returns an array. If no valid value can be determined the
- \* array will be empty, otherwise it will contain one or more values.
- \*/
- $.fn.fieldValue = function(successful) {
- for (var val = [], i = 0, max = this.length; i < max; i++) {
- var el = this[i];
- var v = $.fieldValue(el, successful);
- if (
- v === null ||
- typeof v == 'undefined' ||
- (v.constructor == Array && !v.length)
- ) {
- continue;
- }
- if (v.constructor == Array) {
- $.merge(val, v);
- } else {
- val.push(v);
- }
- }
- return val;
- };
-
- /\*\*
- \* Returns the value of the field element.
- \*/
- $.fieldValue = function(el, successful) {
- var n = el.name,
- t = el.type,
- tag = el.tagName.toLowerCase();
- if (successful === undefined) {
- successful = true;
- }
-
- if (
- successful &&
- (!n ||
- el.disabled ||
- t == 'reset' ||
- t == 'button' ||
- ((t == 'checkbox' || t == 'radio') && !el.checked) ||
- ((t == 'submit' || t == 'image') &&
- el.form &&
- el.form.clk != el) ||
- (tag == 'select' && el.selectedIndex == -1))
- ) {
- return null;
- }
-
- if (tag == 'select') {
- var index = el.selectedIndex;
- if (index < 0) {
- return null;
- }
- var a = [],
- ops = el.options;
- var one = t == 'select-one';
- var max = one ? index + 1 : ops.length;
- for (var i = one ? index : 0; i < max; i++) {
- var op = ops[i];
- if (op.selected) {
- var v = op.value;
- if (!v) {
- // extra pain for IE...
- v =
- op.attributes &&
- op.attributes.value &&
- !op.attributes.value.specified
- ? op.text
- : op.value;
- }
- if (one) {
- return v;
- }
- a.push(v);
- }
- }
- return a;
- }
- return $(el).val();
- };
-
- /\*\*
- \* Clears the form data. Takes the following actions on the form's input fields:
- \* - input text fields will have their 'value' property set to the empty string
- \* - select elements will have their 'selectedIndex' property set to -1
- \* - checkbox and radio inputs will have their 'checked' property set to false
- \* - inputs of type submit, button, reset, and hidden will \*not\* be effected
- \* - button elements will \*not\* be effected
- \*/
- $.fn.clearForm = function(includeHidden) {
- return this.each(function() {
- $('input,select,textarea', this).clearFields(includeHidden);
- });
- };
-
- /\*\*
- \* Clears the selected form elements.
- \*/
- $.fn.clearFields = $.fn.clearInputs = function(includeHidden) {
- var re = /^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i; // 'hidden' is not in this list
- return this.each(function() {
- var t = this.type,
- tag = this.tagName.toLowerCase();
- if (re.test(t) || tag == 'textarea') {
- this.value = '';
- } else if (t == 'checkbox' || t == 'radio') {
- this.checked = false;
- } else if (tag == 'select') {
- this.selectedIndex = -1;
- } else if (t == 'file') {
- if (/MSIE/.test(navigator.userAgent)) {
- $(this).replaceWith($(this).clone(true));
- } else {
- $(this).val('');
- }
- } else if (includeHidden) {
- // includeHidden can be the value true, or it can be a selector string
- // indicating a special test; for example:
- // $('#myForm').clearForm('.special:hidden')
- // the above would clean hidden inputs that have the class of 'special'
- if (
- (includeHidden === true && /hidden/.test(t)) ||
- (typeof includeHidden == 'string' &&
- $(this).is(includeHidden))
- ) {
- this.value = '';
- }
- }
- });
- };
-
- /\*\*
- \* Resets the form data. Causes all form elements to be reset to their original value.
- \*/
- $.fn.resetForm = function() {
- return this.each(function() {
- // guard against an input with the name of 'reset'
- // note that IE reports the reset function as an 'object'
- if (
- typeof this.reset == 'function' ||
- (typeof this.reset == 'object' && !this.reset.nodeType)
- ) {
- this.reset();
- }
- });
- };
-
- /\*\*
- \* Enables or disables any matching elements.
- \*/
- $.fn.enable = function(b) {
- if (b === undefined) {
- b = true;
- }
- return this.each(function() {
- this.disabled = !b;
- });
- };
-
- /\*\*
- \* Checks/unchecks any matching checkboxes or radio buttons and
- \* selects/deselects and matching option elements.
- \*/
- $.fn.selected = function(select) {
- if (select === undefined) {
- select = true;
- }
- return this.each(function() {
- var t = this.type;
- if (t == 'checkbox' || t == 'radio') {
- this.checked = select;
- } else if (this.tagName.toLowerCase() == 'option') {
- var $sel = $(this).parent('select');
- if (select && $sel[0] && $sel[0].type == 'select-one') {
- // deselect all other options
- $sel.find('option').selected(false);
- }
- this.selected = select;
- }
- });
- };
-
- // expose debug var
- $.fn.ajaxSubmit.debug = false;
-
- // helper fn for console logging
- function log() {
- if (!$.fn.ajaxSubmit.debug) {
- return;
- }
- var msg =
- '[jquery.form] ' + Array.prototype.join.call(arguments, '');
- if (window.console && window.console.log) {
- window.console.log(msg);
- } else if (window.opera && window.opera.postError) {
- window.opera.postError(msg);
- }
- }
- });
-})(window.$);
diff --git a/modules/apps/gogo-shell/gogo-shell-web/src/main/resources/META-INF/resources/view.jsp b/modules/apps/gogo-shell/gogo-shell-web/src/main/resources/META-INF/resources/view.jsp
index bad7461d53eed9..16e1d9a38da5fb 100644
--- a/modules/apps/gogo-shell/gogo-shell-web/src/main/resources/META-INF/resources/view.jsp
+++ b/modules/apps/gogo-shell/gogo-shell-web/src/main/resources/META-INF/resources/view.jsp
@@ -50,7 +50,7 @@ String prompt = (String)SessionMessages.get(renderRequest, "prompt");

-
```
<%= commandOutput %>
```
+
```
<%= HtmlUtil.escape(commandOutput) %>
```

diff --git a/modules/apps/headless/headless-admin-taxonomy/headless-admin-taxonomy-api/build.gradle b/modules/apps/headless/headless-admin-taxonomy/headless-admin-taxonomy-api/build.gradle
index 97fc7730cb94b9..0460a15b7ec65b 100644
--- a/modules/apps/headless/headless-admin-taxonomy/headless-admin-taxonomy-api/build.gradle
+++ b/modules/apps/headless/headless-admin-taxonomy/headless-admin-taxonomy-api/build.gradle
@@ -1,5 +1,5 @@
dependencies {
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.10.3"
compileOnly group: "com.liferay", name: "com.liferay.petra.function", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.vulcan.api", version: "3.3.0"
diff --git a/modules/apps/headless/headless-admin-taxonomy/headless-admin-taxonomy-impl/build.gradle b/modules/apps/headless/headless-admin-taxonomy/headless-admin-taxonomy-impl/build.gradle
index a1a8db42268fd6..9de47c42dcef38 100644
--- a/modules/apps/headless/headless-admin-taxonomy/headless-admin-taxonomy-impl/build.gradle
+++ b/modules/apps/headless/headless-admin-taxonomy/headless-admin-taxonomy-impl/build.gradle
@@ -1,5 +1,5 @@
dependencies {
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.10.3"
compileOnly group: "com.liferay", name: "com.liferay.headless.admin.taxonomy.api", version: "3.3.0"
compileOnly group: "com.liferay", name: "com.liferay.headless.common.spi", version: "5.0.0"
compileOnly group: "com.liferay", name: "com.liferay.petra.function", version: "3.0.0"
diff --git a/modules/apps/headless/headless-admin-taxonomy/headless-admin-taxonomy-test/build.gradle b/modules/apps/headless/headless-admin-taxonomy/headless-admin-taxonomy-test/build.gradle
index 9818d8548c35f2..e8635602827e7f 100644
--- a/modules/apps/headless/headless-admin-taxonomy/headless-admin-taxonomy-test/build.gradle
+++ b/modules/apps/headless/headless-admin-taxonomy/headless-admin-taxonomy-test/build.gradle
@@ -1,7 +1,7 @@
dependencies {
- testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
- testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
- testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.10.1"
+ testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.10.3"
+ testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.10.3"
+ testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.10.5.1"
testIntegrationCompile group: "com.liferay", name: "com.liferay.arquillian.extension.junit.bridge", version: "1.0.19"
testIntegrationCompile group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "default"
testIntegrationCompile project(":apps:headless:headless-admin-taxonomy:headless-admin-taxonomy-api")
diff --git a/modules/apps/headless/headless-admin-user/headless-admin-user-api/build.gradle b/modules/apps/headless/headless-admin-user/headless-admin-user-api/build.gradle
index 97fc7730cb94b9..0460a15b7ec65b 100644
--- a/modules/apps/headless/headless-admin-user/headless-admin-user-api/build.gradle
+++ b/modules/apps/headless/headless-admin-user/headless-admin-user-api/build.gradle
@@ -1,5 +1,5 @@
dependencies {
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.10.3"
compileOnly group: "com.liferay", name: "com.liferay.petra.function", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.vulcan.api", version: "3.3.0"
diff --git a/modules/apps/headless/headless-admin-user/headless-admin-user-impl/build.gradle b/modules/apps/headless/headless-admin-user/headless-admin-user-impl/build.gradle
index ec42ead6dcefe2..6b36492475e540 100644
--- a/modules/apps/headless/headless-admin-user/headless-admin-user-impl/build.gradle
+++ b/modules/apps/headless/headless-admin-user/headless-admin-user-impl/build.gradle
@@ -1,5 +1,5 @@
dependencies {
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.10.3"
compileOnly group: "com.liferay", name: "com.liferay.headless.admin.user.api", version: "9.1.0"
compileOnly group: "com.liferay", name: "com.liferay.headless.common.spi", version: "5.0.0"
compileOnly group: "com.liferay", name: "com.liferay.petra.function", version: "3.0.0"
diff --git a/modules/apps/headless/headless-admin-user/headless-admin-user-test/build.gradle b/modules/apps/headless/headless-admin-user/headless-admin-user-test/build.gradle
index 23f327c01ff518..3d1db7cd889148 100644
--- a/modules/apps/headless/headless-admin-user/headless-admin-user-test/build.gradle
+++ b/modules/apps/headless/headless-admin-user/headless-admin-user-test/build.gradle
@@ -1,7 +1,7 @@
dependencies {
- testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
- testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
- testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.10.1"
+ testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.10.3"
+ testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.10.3"
+ testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.10.5.1"
testIntegrationCompile group: "com.liferay", name: "com.liferay.arquillian.extension.junit.bridge", version: "1.0.19"
testIntegrationCompile group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "default"
testIntegrationCompile project(":apps:headless:headless-admin-user:headless-admin-user-api")
diff --git a/modules/apps/headless/headless-admin-workflow/headless-admin-workflow-api/build.gradle b/modules/apps/headless/headless-admin-workflow/headless-admin-workflow-api/build.gradle
index 97fc7730cb94b9..0460a15b7ec65b 100644
--- a/modules/apps/headless/headless-admin-workflow/headless-admin-workflow-api/build.gradle
+++ b/modules/apps/headless/headless-admin-workflow/headless-admin-workflow-api/build.gradle
@@ -1,5 +1,5 @@
dependencies {
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.10.3"
compileOnly group: "com.liferay", name: "com.liferay.petra.function", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.vulcan.api", version: "3.3.0"
diff --git a/modules/apps/headless/headless-admin-workflow/headless-admin-workflow-impl/build.gradle b/modules/apps/headless/headless-admin-workflow/headless-admin-workflow-impl/build.gradle
index 1fbc7d4b98f3eb..10cc038ef80752 100644
--- a/modules/apps/headless/headless-admin-workflow/headless-admin-workflow-impl/build.gradle
+++ b/modules/apps/headless/headless-admin-workflow/headless-admin-workflow-impl/build.gradle
@@ -1,5 +1,5 @@
dependencies {
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.10.3"
compileOnly group: "com.liferay", name: "com.liferay.blogs.api", version: "5.0.0"
compileOnly group: "com.liferay", name: "com.liferay.headless.admin.workflow.api", version: "3.3.0"
compileOnly group: "com.liferay", name: "com.liferay.message.boards.api", version: "5.0.0"
diff --git a/modules/apps/headless/headless-admin-workflow/headless-admin-workflow-test/build.gradle b/modules/apps/headless/headless-admin-workflow/headless-admin-workflow-test/build.gradle
index e0c4503785cec8..99be130109cbfe 100644
--- a/modules/apps/headless/headless-admin-workflow/headless-admin-workflow-test/build.gradle
+++ b/modules/apps/headless/headless-admin-workflow/headless-admin-workflow-test/build.gradle
@@ -1,7 +1,7 @@
dependencies {
- testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
- testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
- testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.10.1"
+ testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.10.3"
+ testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.10.3"
+ testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.10.5.1"
testIntegrationCompile group: "com.liferay", name: "com.liferay.arquillian.extension.junit.bridge", version: "1.0.19"
testIntegrationCompile group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "default"
testIntegrationCompile project(":apps:headless:headless-admin-workflow:headless-admin-workflow-api")
diff --git a/modules/apps/headless/headless-delivery/headless-delivery-api/build.gradle b/modules/apps/headless/headless-delivery/headless-delivery-api/build.gradle
index 97fc7730cb94b9..0460a15b7ec65b 100644
--- a/modules/apps/headless/headless-delivery/headless-delivery-api/build.gradle
+++ b/modules/apps/headless/headless-delivery/headless-delivery-api/build.gradle
@@ -1,5 +1,5 @@
dependencies {
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.10.3"
compileOnly group: "com.liferay", name: "com.liferay.petra.function", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.vulcan.api", version: "3.3.0"
diff --git a/modules/apps/headless/headless-delivery/headless-delivery-impl/build.gradle b/modules/apps/headless/headless-delivery/headless-delivery-impl/build.gradle
index f41fc008ef4c11..6b98e6c261883d 100644
--- a/modules/apps/headless/headless-delivery/headless-delivery-impl/build.gradle
+++ b/modules/apps/headless/headless-delivery/headless-delivery-impl/build.gradle
@@ -1,5 +1,5 @@
dependencies {
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.10.3"
compileOnly group: "com.liferay", name: "com.liferay.adaptive.media.api", version: "4.0.0"
compileOnly group: "com.liferay", name: "com.liferay.adaptive.media.image.api", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.asset.api", version: "2.0.0"
diff --git a/modules/apps/headless/headless-delivery/headless-delivery-test/build.gradle b/modules/apps/headless/headless-delivery/headless-delivery-test/build.gradle
index e82df2b7ca8eb6..c68d2e527ae3ae 100644
--- a/modules/apps/headless/headless-delivery/headless-delivery-test/build.gradle
+++ b/modules/apps/headless/headless-delivery/headless-delivery-test/build.gradle
@@ -1,7 +1,7 @@
dependencies {
- testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
- testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
- testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.10.1"
+ testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.10.3"
+ testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.10.3"
+ testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.10.5.1"
testIntegrationCompile group: "com.liferay", name: "com.liferay.arquillian.extension.junit.bridge", version: "1.0.19"
testIntegrationCompile group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "default"
testIntegrationCompile project(":apps:blogs:blogs-api")
diff --git a/modules/apps/headless/headless-form/headless-form-api/build.gradle b/modules/apps/headless/headless-form/headless-form-api/build.gradle
index 97fc7730cb94b9..0460a15b7ec65b 100644
--- a/modules/apps/headless/headless-form/headless-form-api/build.gradle
+++ b/modules/apps/headless/headless-form/headless-form-api/build.gradle
@@ -1,5 +1,5 @@
dependencies {
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.10.3"
compileOnly group: "com.liferay", name: "com.liferay.petra.function", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.vulcan.api", version: "3.3.0"
diff --git a/modules/apps/headless/headless-form/headless-form-impl/build.gradle b/modules/apps/headless/headless-form/headless-form-impl/build.gradle
index ed65badf85263a..9eec3e785202c3 100644
--- a/modules/apps/headless/headless-form/headless-form-impl/build.gradle
+++ b/modules/apps/headless/headless-form/headless-form-impl/build.gradle
@@ -1,5 +1,5 @@
dependencies {
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.10.3"
compileOnly group: "com.liferay", name: "com.liferay.document.library.api", version: "5.0.0"
compileOnly group: "com.liferay", name: "com.liferay.dynamic.data.mapping.api", version: "5.5.0"
compileOnly group: "com.liferay", name: "com.liferay.headless.form.api", version: "9.0.0"
diff --git a/modules/apps/headless/headless-form/headless-form-test/build.gradle b/modules/apps/headless/headless-form/headless-form-test/build.gradle
index db42df7205d595..3cf53226a12c8e 100644
--- a/modules/apps/headless/headless-form/headless-form-test/build.gradle
+++ b/modules/apps/headless/headless-form/headless-form-test/build.gradle
@@ -1,7 +1,7 @@
dependencies {
- testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
- testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
- testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.10.1"
+ testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.10.3"
+ testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.10.3"
+ testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.10.5.1"
testIntegrationCompile group: "com.liferay", name: "com.liferay.arquillian.extension.junit.bridge", version: "1.0.19"
testIntegrationCompile group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "default"
testIntegrationCompile project(":apps:headless:headless-form:headless-form-api")
diff --git a/modules/apps/petra/petra-json-web-service-client/build.gradle b/modules/apps/petra/petra-json-web-service-client/build.gradle
index 93c01ca98bbcb6..b37e6d3e9a77fd 100644
--- a/modules/apps/petra/petra-json-web-service-client/build.gradle
+++ b/modules/apps/petra/petra-json-web-service-client/build.gradle
@@ -2,9 +2,9 @@ sourceCompatibility = "1.6"
targetCompatibility = "1.6"
dependencies {
- compileInclude group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
- compileInclude group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
- compileInclude group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.10.1"
+ compileInclude group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.10.3"
+ compileInclude group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.10.3"
+ compileInclude group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.10.5.1"
compileInclude group: "commons-codec", name: "commons-codec", version: "1.7"
compileInclude group: "oauth.signpost", name: "signpost-commonshttp4", version: "1.2.1.2"
compileInclude group: "oauth.signpost", name: "signpost-core", version: "1.2.1.2"
diff --git a/modules/apps/portal-odata/portal-odata-impl/build.gradle b/modules/apps/portal-odata/portal-odata-impl/build.gradle
index 5a744a599b6e71..15b9b7bb32d61e 100644
--- a/modules/apps/portal-odata/portal-odata-impl/build.gradle
+++ b/modules/apps/portal-odata/portal-odata-impl/build.gradle
@@ -1,7 +1,7 @@
dependencies {
compileInclude group: "io.netty", name: "netty-buffer", version: "4.1.50.Final"
compileInclude group: "io.netty", name: "netty-codec", version: "4.1.50.Final"
- compileInclude group: "io.netty", name: "netty-codec-http", version: "4.1.50.Final"
+ compileInclude group: "io.netty", name: "netty-codec-http", version: "4.1.59.Final"
compileInclude group: "io.netty", name: "netty-common", version: "4.1.50.Final"
compileInclude group: "io.netty", name: "netty-handler", version: "4.1.50.Final"
compileInclude group: "io.netty", name: "netty-resolver", version: "4.1.50.Final"
@@ -12,7 +12,7 @@ dependencies {
compileInclude group: "org.apache.olingo", name: "odata-server-core", version: "4.7.1"
compileInclude group: "org.apache.olingo", name: "odata-server-core-ext", version: "4.7.1"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.10.1"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.10.5.1"
compileOnly group: "com.liferay", name: "com.liferay.osgi.util", version: "5.0.0"
compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.odata.api", version: "2.1.0"
diff --git a/modules/apps/portal-remote/portal-remote-jaxrs-whiteboard-jaxb-json/build.gradle b/modules/apps/portal-remote/portal-remote-jaxrs-whiteboard-jaxb-json/build.gradle
index dfc6af98a69faa..f9f833434dd21d 100644
--- a/modules/apps/portal-remote/portal-remote-jaxrs-whiteboard-jaxb-json/build.gradle
+++ b/modules/apps/portal-remote/portal-remote-jaxrs-whiteboard-jaxb-json/build.gradle
@@ -1,7 +1,7 @@
dependencies {
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.10.1"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.10.3"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.10.3"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.10.5.1"
compileOnly group: "com.fasterxml.jackson.jaxrs", name: "jackson-jaxrs-base", version: "2.9.8"
compileOnly group: "com.fasterxml.jackson.jaxrs", name: "jackson-jaxrs-json-provider", version: "2.9.8"
compileOnly group: "com.fasterxml.jackson.module", name: "jackson-module-jaxb-annotations", version: "2.9.8"
diff --git a/modules/apps/portal-search-elasticsearch6/portal-search-elasticsearch6-impl/bnd.bnd b/modules/apps/portal-search-elasticsearch6/portal-search-elasticsearch6-impl/bnd.bnd
index f3431e5ac95801..c148c6633dac95 100644
--- a/modules/apps/portal-search-elasticsearch6/portal-search-elasticsearch6-impl/bnd.bnd
+++ b/modules/apps/portal-search-elasticsearch6/portal-search-elasticsearch6-impl/bnd.bnd
@@ -24,6 +24,8 @@ Import-Package:\
\
!com.ning.compress.\*,\
\
+ !com.oracle.svm.\*,\
+ \
!com.puppycrawl.tools.checkstyle.\*,\
\
!com.sun.jna.\*,\
@@ -38,6 +40,8 @@ Import-Package:\
\
!groovy.\*,\
\
+ !io.netty.internal.\*,\
+ \
!javassist.\*,\
\
!jline.\*,\
@@ -101,6 +105,8 @@ Import-Package:\
\
!org.zeromq.\*,\
\
+ !reactor.blockhound.\*,\
+ \
!sun.security.\*,\
\
com.liferay.portal.search.analysis,\
diff --git a/modules/apps/portal-search-elasticsearch6/portal-search-elasticsearch6-impl/build.gradle b/modules/apps/portal-search-elasticsearch6/portal-search-elasticsearch6-impl/build.gradle
index 9b1574b1e43177..70942d411ed4ee 100644
--- a/modules/apps/portal-search-elasticsearch6/portal-search-elasticsearch6-impl/build.gradle
+++ b/modules/apps/portal-search-elasticsearch6/portal-search-elasticsearch6-impl/build.gradle
@@ -21,10 +21,10 @@ dependencies {
compileInclude group: "com.liferay", name: "org.elasticsearch.xpack.core", version: elasticsearchVersion
compileInclude group: "com.tdunning", name: "t-digest", version: "3.2"
compileInclude group: "com.twitter", name: "jsr166e", version: "1.1.0"
- compileInclude group: "com.unboundid", name: "unboundid-ldapsdk", version: "4.0.2"
+ compileInclude group: "com.unboundid", name: "unboundid-ldapsdk", version: "4.0.14"
compileInclude group: "commons-io", name: "commons-io", version: "2.6"
compileInclude group: "commons-lang", name: "commons-lang", version: "2.6"
- compileInclude group: "io.netty", name: "netty-all", version: "4.1.11.Final"
+ compileInclude group: "io.netty", name: "netty-all", version: "4.1.48.Final"
compileInclude group: "joda-time", name: "joda-time", version: "2.9.5"
compileInclude group: "net.sf.jopt-simple", name: "jopt-simple", version: "5.0.2"
compileInclude group: "net.sf.supercsv", name: "super-csv", version: "2.1.0"
@@ -45,9 +45,9 @@ dependencies {
compileInclude group: "org.apache.lucene", name: "lucene-sandbox", version: luceneVersion
compileInclude group: "org.apache.lucene", name: "lucene-spatial", version: luceneVersion
compileInclude group: "org.apache.lucene", name: "lucene-suggest", version: luceneVersion
- compileInclude group: "org.bouncycastle", name: "bcpg-jdk15on", version: "1.59"
- compileInclude group: "org.bouncycastle", name: "bcpkix-jdk15on", version: "1.59"
- compileInclude group: "org.bouncycastle", name: "bcprov-jdk15on", version: "1.59"
+ compileInclude group: "org.bouncycastle", name: "bcpg-jdk15on", version: "1.61"
+ compileInclude group: "org.bouncycastle", name: "bcpkix-jdk15on", version: "1.61"
+ compileInclude group: "org.bouncycastle", name: "bcprov-jdk15on", version: "1.61"
compileInclude group: "org.elasticsearch", name: "elasticsearch", version: elasticsearchVersion
compileInclude group: "org.elasticsearch", name: "elasticsearch-cli", version: elasticsearchVersion
compileInclude group: "org.elasticsearch", name: "elasticsearch-core", version: elasticsearchVersion
@@ -66,7 +66,7 @@ dependencies {
compileInclude group: "org.ow2.asm", name: "asm-debug-all", version: "5.1"
compileInclude group: "org.yaml", name: "snakeyaml", version: "1.17"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.10.3"
compileOnly group: "com.ibm.icu", name: "icu4j", version: "61.1"
compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.configuration.metatype.api", version: "2.0.0"
diff --git a/modules/apps/portal-search-elasticsearch7/portal-search-elasticsearch7-impl/bnd.bnd b/modules/apps/portal-search-elasticsearch7/portal-search-elasticsearch7-impl/bnd.bnd
index cd5750a1c3084c..09266949fea571 100644
--- a/modules/apps/portal-search-elasticsearch7/portal-search-elasticsearch7-impl/bnd.bnd
+++ b/modules/apps/portal-search-elasticsearch7/portal-search-elasticsearch7-impl/bnd.bnd
@@ -24,6 +24,8 @@ Import-Package:\
\
!com.ning.compress.\*,\
\
+ !com.oracle.svm.\*,\
+ \
!com.puppycrawl.tools.checkstyle.\*,\
\
!com.sun.jna.\*,\
@@ -38,6 +40,8 @@ Import-Package:\
\
!groovy.\*,\
\
+ !io.netty.internal.\*,\
+ \
!javassist.\*,\
\
!jline.\*,\
@@ -101,6 +105,8 @@ Import-Package:\
\
!org.zeromq.\*,\
\
+ !reactor.blockhound.\*,\
+ \
!sun.security.\*,\
\
com.liferay.portal.search.analysis,\
diff --git a/modules/apps/portal-search-elasticsearch7/portal-search-elasticsearch7-impl/build.gradle b/modules/apps/portal-search-elasticsearch7/portal-search-elasticsearch7-impl/build.gradle
index 6cbf21ae57aef9..fed66a0b2648c6 100644
--- a/modules/apps/portal-search-elasticsearch7/portal-search-elasticsearch7-impl/build.gradle
+++ b/modules/apps/portal-search-elasticsearch7/portal-search-elasticsearch7-impl/build.gradle
@@ -20,10 +20,10 @@ dependencies {
compileInclude group: "com.liferay", name: "org.elasticsearch.xpack.core", version: elasticsearchVersion
compileInclude group: "com.tdunning", name: "t-digest", version: "3.2"
compileInclude group: "com.twitter", name: "jsr166e", version: "1.1.0"
- compileInclude group: "com.unboundid", name: "unboundid-ldapsdk", version: "4.0.2"
+ compileInclude group: "com.unboundid", name: "unboundid-ldapsdk", version: "4.0.14"
compileInclude group: "commons-io", name: "commons-io", version: "2.6"
compileInclude group: "commons-lang", name: "commons-lang", version: "2.6"
- compileInclude group: "io.netty", name: "netty-all", version: "4.1.11.Final"
+ compileInclude group: "io.netty", name: "netty-all", version: "4.1.48.Final"
compileInclude group: "joda-time", name: "joda-time", version: "2.9.5"
compileInclude group: "net.sf.jopt-simple", name: "jopt-simple", version: "5.0.2"
compileInclude group: "net.sf.supercsv", name: "super-csv", version: "2.1.0"
@@ -45,9 +45,9 @@ dependencies {
compileInclude group: "org.apache.lucene", name: "lucene-sandbox", version: luceneVersion
compileInclude group: "org.apache.lucene", name: "lucene-spatial", version: luceneVersion
compileInclude group: "org.apache.lucene", name: "lucene-suggest", version: luceneVersion
- compileInclude group: "org.bouncycastle", name: "bcpg-jdk15on", version: "1.59"
- compileInclude group: "org.bouncycastle", name: "bcpkix-jdk15on", version: "1.59"
- compileInclude group: "org.bouncycastle", name: "bcprov-jdk15on", version: "1.59"
+ compileInclude group: "org.bouncycastle", name: "bcpg-jdk15on", version: "1.61"
+ compileInclude group: "org.bouncycastle", name: "bcpkix-jdk15on", version: "1.61"
+ compileInclude group: "org.bouncycastle", name: "bcprov-jdk15on", version: "1.61"
compileInclude group: "org.codelibs.elasticsearch.module", name: "analysis-common", version: elasticsearchVersion
compileInclude group: "org.elasticsearch", name: "elasticsearch", version: elasticsearchVersion
compileInclude group: "org.elasticsearch", name: "elasticsearch-cli", version: elasticsearchVersion
@@ -70,7 +70,7 @@ dependencies {
compileInclude group: "org.ow2.asm", name: "asm-debug-all", version: "5.1"
compileInclude group: "org.yaml", name: "snakeyaml", version: "1.17"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.10.3"
compileOnly group: "com.ibm.icu", name: "icu4j", version: "61.1"
compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.configuration.metatype.api", version: "2.0.0"
diff --git a/modules/apps/portal-search/portal-search-web/build.gradle b/modules/apps/portal-search/portal-search-web/build.gradle
index fa9932ea70c2af..4032b37e839b07 100644
--- a/modules/apps/portal-search/portal-search-web/build.gradle
+++ b/modules/apps/portal-search/portal-search-web/build.gradle
@@ -29,7 +29,7 @@ dependencies {
compileOnly group: "org.osgi", name: "osgi.core", version: "6.0.0"
testCompile group: "commons-configuration", name: "commons-configuration", version: "1.10"
- testCompile group: "commons-httpclient", name: "commons-httpclient", version: "3.1"
+ testCompile group: "com.liferay", name: "org.apache.commons.httpclient", version: "3.1.LIFERAY-PATCHED-1"
testCompile group: "org.jabsorb", name: "jabsorb", version: "1.3.1"
testCompile group: "org.jodd", name: "jodd-bean", version: "3.6.4"
testCompile group: "org.jodd", name: "jodd-json", version: "3.6.4"
diff --git a/modules/apps/portal-security-sso-google/portal-security-sso-google-impl/build.gradle b/modules/apps/portal-security-sso-google/portal-security-sso-google-impl/build.gradle
index 9afdbd5f90ad20..1c75107b3ce702 100644
--- a/modules/apps/portal-security-sso-google/portal-security-sso-google-impl/build.gradle
+++ b/modules/apps/portal-security-sso-google/portal-security-sso-google-impl/build.gradle
@@ -5,7 +5,7 @@ dependencies {
compileInclude group: "com.google.http-client", name: "google-http-client-jackson2", version: "1.21.0"
compileInclude group: "com.google.oauth-client", name: "google-oauth-client", version: "1.31.0"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.10.3"
compileOnly group: "com.google.code.findbugs", name: "jsr305", version: "1.3.9"
compileOnly group: "com.liferay", name: "com.liferay.petra.lang", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "3.0.0"
diff --git a/modules/apps/portal-security/portal-security-ldap-impl/src/main/java/com/liferay/portal/security/ldap/internal/authenticator/LDAPAuth.java b/modules/apps/portal-security/portal-security-ldap-impl/src/main/java/com/liferay/portal/security/ldap/internal/authenticator/LDAPAuth.java
index cbbd6975a9f891..02776bb5f67259 100644
--- a/modules/apps/portal-security/portal-security-ldap-impl/src/main/java/com/liferay/portal/security/ldap/internal/authenticator/LDAPAuth.java
+++ b/modules/apps/portal-security/portal-security-ldap-impl/src/main/java/com/liferay/portal/security/ldap/internal/authenticator/LDAPAuth.java
@@ -26,6 +26,7 @@
import com.liferay.portal.kernel.model.User;
import com.liferay.portal.kernel.security.auth.AuthException;
import com.liferay.portal.kernel.security.auth.Authenticator;
+import com.liferay.portal.kernel.security.auth.PasswordModificationThreadLocal;
import com.liferay.portal.kernel.security.ldap.LDAPSettings;
import com.liferay.portal.kernel.security.pwd.PasswordEncryptor;
import com.liferay.portal.kernel.service.UserLocalService;
@@ -357,6 +358,10 @@ protected int authenticate(
User user = \_ldapUserImporter.importUser(
ldapServerId, companyId, ldapContext, attributes, password);
+ if (!ldapAuthResult.isAuthenticated()) {
+ PasswordModificationThreadLocal.setPasswordModified(false);
+ }
+
// Process LDAP failure codes
String errorMessage = ldapAuthResult.getErrorMessage();
diff --git a/modules/apps/portal-store/portal-store-s3/build.gradle b/modules/apps/portal-store/portal-store-s3/build.gradle
index 39e07f572b4f67..a648cf5776efb2 100644
--- a/modules/apps/portal-store/portal-store-s3/build.gradle
+++ b/modules/apps/portal-store/portal-store-s3/build.gradle
@@ -11,9 +11,9 @@ dependencies {
compileInclude group: "software.amazon.ion", name: "ion-java", version: "1.1.0"
compileOnly group: "biz.aQute.bnd", name: "biz.aQute.bnd.annotation", version: "4.2.0"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.10.1"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.10.3"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.10.3"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.10.5.1"
compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.configuration.metatype.api", version: "2.0.0"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "4.34.0"
diff --git a/modules/apps/portal-template/portal-template-soy-impl/build.gradle b/modules/apps/portal-template/portal-template-soy-impl/build.gradle
index 9bbdba9f756b57..e8730df0306e2f 100644
--- a/modules/apps/portal-template/portal-template-soy-impl/build.gradle
+++ b/modules/apps/portal-template/portal-template-soy-impl/build.gradle
@@ -16,7 +16,7 @@ dependencies {
compileInclude group: "com.google.common.html.types", name: "types", version: "1.0.4"
compileInclude group: "com.google.errorprone", name: "error\_prone\_annotations", version: "2.2.0"
compileInclude group: "com.google.guava", name: "failureaccess", version: "1.0.1"
- compileInclude group: "com.google.guava", name: "guava", version: "27.0.1-jre"
+ compileInclude group: "com.google.guava", name: "guava", version: "30.1.1-jre"
compileInclude group: "com.google.guava", name: "listenablefuture", version: "9999.0-empty-to-avoid-conflict-with-guava"
compileInclude group: "com.google.inject", name: "guice", version: "4.1.0"
compileInclude group: "com.google.inject.extensions", name: "guice-multibindings", version: "4.1.0"
diff --git a/modules/apps/portal-vulcan/portal-vulcan-api/build.gradle b/modules/apps/portal-vulcan/portal-vulcan-api/build.gradle
index 7e99a60c568469..a837d6517bf47a 100644
--- a/modules/apps/portal-vulcan/portal-vulcan-api/build.gradle
+++ b/modules/apps/portal-vulcan/portal-vulcan-api/build.gradle
@@ -2,9 +2,9 @@ dependencies {
compileInclude group: "com.fasterxml.jackson.dataformat", name: "jackson-dataformat-xml", version: "2.9.8"
compileInclude group: "org.yaml", name: "snakeyaml", version: "1.27"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.10.1"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.10.3"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.10.3"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.10.5.1"
compileOnly group: "com.liferay", name: "com.liferay.petra.function", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.petra.string", version: "3.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.odata.api", version: "2.0.0"
diff --git a/modules/apps/portal-vulcan/portal-vulcan-impl/build.gradle b/modules/apps/portal-vulcan/portal-vulcan-impl/build.gradle
index 8f0d0d0ee982a9..c2a27576769018 100644
--- a/modules/apps/portal-vulcan/portal-vulcan-impl/build.gradle
+++ b/modules/apps/portal-vulcan/portal-vulcan-impl/build.gradle
@@ -13,7 +13,7 @@ dependencies {
compileInclude group: "com.fasterxml.jackson.datatype", name: "jackson-datatype-jdk8", version: "2.9.8"
compileInclude group: "com.fasterxml.jackson.jaxrs", name: "jackson-jaxrs-xml-provider", version: "2.9.8"
compileInclude group: "com.google.guava", name: "failureaccess", version: "1.0.1"
- compileInclude group: "com.google.guava", name: "guava", version: "30.0-jre"
+ compileInclude group: "com.google.guava", name: "guava", version: "30.1.1-jre"
compileInclude group: "com.graphql-java", name: "graphql-java", version: "12.0"
compileInclude group: "com.graphql-java", name: "java-dataloader", version: "2.1.1"
compileInclude group: "com.graphql-java-kickstart", name: "graphql-java-servlet", version: "7.5.0"
@@ -32,9 +32,9 @@ dependencies {
compileInclude group: "org.yaml", name: "snakeyaml", version: "1.27"
compileOnly group: "biz.aQute.bnd", name: "biz.aQute.bndlib", version: "4.2.0"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.10.1"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.10.3"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.10.3"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.10.5.1"
compileOnly group: "com.fasterxml.jackson.jaxrs", name: "jackson-jaxrs-json-provider", version: "2.9.8"
compileOnly group: "com.liferay", name: "com.liferay.osgi.service.tracker.collections", version: "4.0.0"
compileOnly group: "com.liferay", name: "com.liferay.osgi.util", version: "5.0.0"
diff --git a/modules/apps/portal-vulcan/portal-vulcan-test/build.gradle b/modules/apps/portal-vulcan/portal-vulcan-test/build.gradle
index 9c954e4315f9ab..2e245316600b1a 100644
--- a/modules/apps/portal-vulcan/portal-vulcan-test/build.gradle
+++ b/modules/apps/portal-vulcan/portal-vulcan-test/build.gradle
@@ -1,5 +1,5 @@
dependencies {
- testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
+ testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.10.3"
testIntegrationCompile group: "com.liferay", name: "com.liferay.arquillian.extension.junit.bridge", version: "1.0.19"
testIntegrationCompile group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "default"
testIntegrationCompile group: "javax.ws.rs", name: "javax.ws.rs-api", version: "2.1"
diff --git a/modules/apps/push-notifications/push-notifications-sender/push-notifications-sender-apple/build.gradle b/modules/apps/push-notifications/push-notifications-sender/push-notifications-sender-apple/build.gradle
index 67014a32218b79..d8b3e48ba9a8a6 100644
--- a/modules/apps/push-notifications/push-notifications-sender/push-notifications-sender-apple/build.gradle
+++ b/modules/apps/push-notifications/push-notifications-sender/push-notifications-sender-apple/build.gradle
@@ -2,9 +2,9 @@ dependencies {
compileInclude group: "com.notnoop.apns", name: "apns", version: "1.0.0.Beta6"
compileOnly group: "biz.aQute.bnd", name: "biz.aQute.bnd.annotation", version: "4.2.0"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.10.1"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.10.3"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.10.3"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.10.5.1"
compileOnly group: "com.liferay", name: "com.liferay.osgi.util", version: "5.0.0"
compileOnly group: "com.liferay", name: "com.liferay.portal.configuration.metatype.api", version: "2.0.0"
compileOnly group: "com.liferay", name: "com.liferay.push.notifications.api", version: "3.0.0"
diff --git a/modules/apps/segments/segments-test/build.gradle b/modules/apps/segments/segments-test/build.gradle
index 047b45b7c2bde7..59f604a63369e2 100644
--- a/modules/apps/segments/segments-test/build.gradle
+++ b/modules/apps/segments/segments-test/build.gradle
@@ -1,5 +1,5 @@
dependencies {
- testIntegrationCompile group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.10.1"
+ testIntegrationCompile group: "com.liferay", name: "com.fasterxml.jackson.databind", version: "2.10.3.LIFERAY-PATCHED-1"
testIntegrationCompile group: "com.liferay", name: "com.liferay.arquillian.extension.junit.bridge", version: "1.0.19"
testIntegrationCompile group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "default"
testIntegrationCompile group: "javax.portlet", name: "portlet-api", version: "3.0.1"
diff --git a/modules/apps/server/server-admin-web/src/main/java/com/liferay/server/admin/web/internal/portlet/action/EditServerMVCActionCommand.java b/modules/apps/server/server-admin-web/src/main/java/com/liferay/server/admin/web/internal/portlet/action/EditServerMVCActionCommand.java
index 18df7036eaae7f..dc24a7ea7ebfbf 100644
--- a/modules/apps/server/server-admin-web/src/main/java/com/liferay/server/admin/web/internal/portlet/action/EditServerMVCActionCommand.java
+++ b/modules/apps/server/server-admin-web/src/main/java/com/liferay/server/admin/web/internal/portlet/action/EditServerMVCActionCommand.java
@@ -436,6 +436,7 @@ protected void runScript(
throws Exception {
String language = ParamUtil.getString(actionRequest, "language");
+ String output = ParamUtil.getString(actionRequest, "output");
String script = ParamUtil.getString(actionRequest, "script");
PortletConfig portletConfig = getPortletConfig(actionRequest);
@@ -456,6 +457,7 @@ protected void runScript(
try {
SessionMessages.add(actionRequest, "language", language);
SessionMessages.add(actionRequest, "script", script);
+ SessionMessages.add(actionRequest, "output", output);
\_scripting.exec(null, portletObjects, language, script);
diff --git a/modules/apps/server/server-admin-web/src/main/resources/META-INF/resources/external\_services.jsp b/modules/apps/server/server-admin-web/src/main/resources/META-INF/resources/external\_services.jsp
index 507a3d8c5828a7..45a2f61a6b5cc5 100644
--- a/modules/apps/server/server-admin-web/src/main/resources/META-INF/resources/external\_services.jsp
+++ b/modules/apps/server/server-admin-web/src/main/resources/META-INF/resources/external\_services.jsp
@@ -67,7 +67,7 @@
XugglerInstallException xie = (XugglerInstallException)errorException;
%>
-
+

diff --git a/modules/apps/server/server-admin-web/src/main/resources/META-INF/resources/init.jsp b/modules/apps/server/server-admin-web/src/main/resources/META-INF/resources/init.jsp
index c5528035beb31e..2f4c2bf25022b9 100644
--- a/modules/apps/server/server-admin-web/src/main/resources/META-INF/resources/init.jsp
+++ b/modules/apps/server/server-admin-web/src/main/resources/META-INF/resources/init.jsp
@@ -45,6 +45,7 @@ page import="com.liferay.portal.kernel.model.\*" %><%@
page import="com.liferay.portal.kernel.model.impl.\*" %><%@
page import="com.liferay.portal.kernel.patcher.PatcherUtil" %><%@
page import="com.liferay.portal.kernel.portlet.PortletURLUtil" %><%@
+page import="com.liferay.portal.kernel.scripting.ScriptingException" %><%@
page import="com.liferay.portal.kernel.scripting.ScriptingUtil" %><%@
page import="com.liferay.portal.kernel.service.\*" %><%@
page import="com.liferay.portal.kernel.servlet.SessionMessages" %><%@
diff --git a/modules/apps/server/server-admin-web/src/main/resources/META-INF/resources/script.jsp b/modules/apps/server/server-admin-web/src/main/resources/META-INF/resources/script.jsp
index 8df7a59fa48553..eafe8402c0c532 100644
--- a/modules/apps/server/server-admin-web/src/main/resources/META-INF/resources/script.jsp
+++ b/modules/apps/server/server-admin-web/src/main/resources/META-INF/resources/script.jsp
@@ -23,6 +23,12 @@ if (SessionMessages.contains(renderRequest, "language")) {
language = (String)SessionMessages.get(renderRequest, "language");
}
+String output = ParamUtil.getString(renderRequest, "output", "text");
+
+if (SessionMessages.contains(renderRequest, "output")) {
+ output = (String)SessionMessages.get(renderRequest, "output");
+}
+
String script = "// ### Groovy Sample ###\n\nnumber = com.liferay.portal.kernel.service.UserLocalServiceUtil.getUsersCount();\n\nout.println(number);";
if (SessionMessages.contains(renderRequest, "script")) {
@@ -32,6 +38,15 @@ if (SessionMessages.contains(renderRequest, "script")) {
String scriptOutput = (String)SessionMessages.get(renderRequest, "scriptOutput");
%>
+
+
+ <%
+ ScriptingException se = (ScriptingException)errorException;
+ %>
+
+
```
<%= HtmlUtil.escape(se.getMessage()) %>
```
+
+
@@ -48,6 +63,11 @@ String scriptOutput = (String)SessionMessages.get(renderRequest, "scriptOutput")

+
+
+
+
+

@@ -55,7 +75,14 @@ String scriptOutput = (String)SessionMessages.get(renderRequest, "scriptOutput")

-
```
<%= scriptOutput %>
```
+
+
+ <%= scriptOutput %>
+
+
+
```
<%= HtmlUtil.escape(scriptOutput) %>
```
+
+

diff --git a/modules/apps/static/portal-osgi-web/portal-osgi-web-wab-generator-impl/build.gradle b/modules/apps/static/portal-osgi-web/portal-osgi-web-wab-generator-impl/build.gradle
index d3bce6e5258c96..bc92ea078e538e 100644
--- a/modules/apps/static/portal-osgi-web/portal-osgi-web-wab-generator-impl/build.gradle
+++ b/modules/apps/static/portal-osgi-web/portal-osgi-web-wab-generator-impl/build.gradle
@@ -17,7 +17,7 @@ dependencies {
compileOnly group: "org.springframework", name: "spring-core", version: "4.1.9.RELEASE"
compileOnly group: "org.springframework", name: "spring-web", version: "4.1.9.RELEASE"
- testCompile group: "commons-httpclient", name: "commons-httpclient", version: "3.1"
+ testCompile group: "com.liferay", name: "org.apache.commons.httpclient", version: "3.1.LIFERAY-PATCHED-1"
testCompile group: "commons-io", name: "commons-io", version: "2.5"
testCompile group: "jaxen", name: "jaxen", version: "1.1.1"
testCompile group: "org.apache.tika", name: "tika-core", version: "1.24"
diff --git a/modules/apps/static/required-dependencies/required-dependencies/build.gradle b/modules/apps/static/required-dependencies/required-dependencies/build.gradle
index 1cc72f13810bbb..0dc3b98ea4804d 100644
--- a/modules/apps/static/required-dependencies/required-dependencies/build.gradle
+++ b/modules/apps/static/required-dependencies/required-dependencies/build.gradle
@@ -13,9 +13,9 @@ configurations {
}
dependencies {
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.10.1"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.10.3"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.10.3"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.10.5.1"
compileOnly group: "com.liferay", name: "javax.servlet.jsp.jstl", version: "1.2.3.LIFERAY-PATCHED-2"
compileOnly group: "com.liferay", name: "org.apache.aries.spifly.dynamic.framework.extension", version: "1.2.3.LIFERAY-PATCHED-1"
compileOnly group: "com.liferay", name: "org.apache.felix.configadmin", version: "1.9.8.LIFERAY-PATCHED-3"
diff --git a/modules/core/portal-bootstrap/build.gradle b/modules/core/portal-bootstrap/build.gradle
index 658ac07fc0e40f..7d488ba01b75fd 100644
--- a/modules/core/portal-bootstrap/build.gradle
+++ b/modules/core/portal-bootstrap/build.gradle
@@ -78,9 +78,9 @@ copySystemPackagesExtraLibs {
dependencies {
compileOnly group: "biz.aQute.bnd", name: "biz.aQute.bnd.annotation", version: "4.2.0"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.9.10"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.9.10"
- compileOnly group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.9.10.1"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-annotations", version: "2.10.3"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-core", version: "2.10.3"
+ compileOnly group: "com.fasterxml.jackson.core", name: "jackson-databind", version: "2.10.5.1"
compileOnly group: "com.liferay", name: "org.eclipse.osgi", version: "3.13.0.LIFERAY-PATCHED-8"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.impl", version: "default"
compileOnly group: "com.liferay.portal", name: "com.liferay.portal.kernel", version: "default"
diff --git a/modules/core/portal-bootstrap/src/main/java/com/liferay/portal/bootstrap/ModuleFrameworkImpl.java b/modules/core/portal-bootstrap/src/main/java/com/liferay/portal/bootstrap/ModuleFrameworkImpl.java
index 46e17dfeaf6c14..1b9fb53a1f29d1 100644
--- a/modules/core/portal-bootstrap/src/main/java/com/liferay/portal/bootstrap/ModuleFrameworkImpl.java
+++ b/modules/core/portal-bootstrap/src/main/java/com/liferay/portal/bootstrap/ModuleFrameworkImpl.java
@@ -999,6 +999,10 @@ public int compare(ZipEntry zipEntry1, ZipEntry zipEntry2) {
private String \_extractFileName(String string) {
int endIndex = string.indexOf(CharPool.DASH);
+ if (string.startsWith("com.fasterxml.jackson.core.jackson")) {
+ endIndex = string.lastIndexOf(CharPool.DASH);
+ }
+
if (endIndex == -1) {
endIndex = string.indexOf(CharPool.QUESTION);
diff --git a/modules/core/portal-bootstrap/system.packages.extra.bnd b/modules/core/portal-bootstrap/system.packages.extra.bnd
index b84f226cac9d36..3d1ac0d4e066d7 100644
--- a/modules/core/portal-bootstrap/system.packages.extra.bnd
+++ b/modules/core/portal-bootstrap/system.packages.extra.bnd
@@ -117,7 +117,7 @@ Export-Package:\
com.sun.syndication.io;version='1.0',\
com.sun.syndication.io.impl;version='1.0',\
\
- com.thoughtworks.xstream.\*;version='1.4.14',\
+ com.thoughtworks.xstream.\*;version='1.4.15',\
\
java\_cup.runtime.\*;version='2.7.1',\
\
diff --git a/modules/yarn.lock b/modules/yarn.lock
index 777656fe36ed22..bf2080bb62d92d 100644
--- a/modules/yarn.lock
+++ b/modules/yarn.lock
@@ -1647,6 +1647,13 @@
"@types/istanbul-reports" "^1.1.1"
"@types/yargs" "^12.0.9"
+"@liferay/jquery-form@3.51.0-liferay.1":
+ version "3.51.0-liferay.1"
+ resolved "https://registry.yarnpkg.com/@liferay/jquery-form/-/jquery-form-3.51.0-liferay.1.tgz#a8e2e2fce01d1e57cd4577c20cdfc9e848c25de3"
+ integrity sha512-azhkvLNK1PSCjboBTmixl82PzTvnoF7ofJv1UvPG2hT33mAuJYaGIgPp+AzGNpcuPhlU2b1X3PoOYsrNlh4D0g==
+ dependencies:
+ jquery ">=1.5"
+
"@mrmlnc/readdir-enhanced@^2.2.1":
version "2.2.1"
resolved "https://registry.yarnpkg.com/@mrmlnc/readdir-enhanced/-/readdir-enhanced-2.2.1.tgz#524af240d1a360527b730475ecfa1344aa540dde"
@@ -10661,6 +10668,11 @@ jquery@3.5.1:
resolved "https://registry.yarnpkg.com/jquery/-/jquery-3.5.1.tgz#d7b4d08e1bfdb86ad2f1a3d039ea17304717abb5"
integrity sha512-XwIBPqcMn57FxfT+Go5pzySnm4KWkT1Tv7gjrpT1srtf8Weynl6R273VJ5GjkRb51IzMp5nbaPjJXMWeju2MKg==
+jquery@>=1.5:
+ version "3.6.0"
+ resolved "https://registry.yarnpkg.com/jquery/-/jquery-3.6.0.tgz#c72a09f15c1bdce142f49dbf1170bdf8adac2470"
+ integrity sha512-JVzAR/AjBvVt2BmYhxRCSYysDsPcssdmTFnzyLEts9qNwmjmu4JTAMYubEfwVOSwpQ1I1sKKFcxhZCI2buerfw==
+
js-base64@^2.1.8:
version "2.5.1"
resolved "https://registry.yarnpkg.com/js-base64/-/js-base64-2.5.1.tgz#1efa39ef2c5f7980bb1784ade4a8af2de3291121"
diff --git a/nbproject/project.properties b/nbproject/project.properties
index ab6c5d39165464..ac90d7efc2a61e 100644
--- a/nbproject/project.properties
+++ b/nbproject/project.properties
@@ -148,6 +148,7 @@ javac.classpath=\
lib/portal/im4java.jar:\
lib/portal/isoparser.jar:\
lib/portal/jabsorb.jar:\
+ lib/portal/jackson-databind.jar:\
lib/portal/jai-imageio-core.jar:\
lib/portal/jai-imageio-jpeg2000.jar:\
lib/portal/jai\_codec.jar:\
diff --git a/portal-impl/src/com/liferay/portal/dao/jdbc/DataSourceFactoryImpl.java b/portal-impl/src/com/liferay/portal/dao/jdbc/DataSourceFactoryImpl.java
index 65da66c8bb7c07..18e84ce2df8844 100644
--- a/portal-impl/src/com/liferay/portal/dao/jdbc/DataSourceFactoryImpl.java
+++ b/portal-impl/src/com/liferay/portal/dao/jdbc/DataSourceFactoryImpl.java
@@ -14,6 +14,7 @@
package com.liferay.portal.dao.jdbc;
+import com.liferay.petra.reflect.ReflectionUtil;
import com.liferay.petra.string.CharPool;
import com.liferay.petra.string.StringBundler;
import com.liferay.portal.dao.jdbc.pool.metrics.C3P0ConnectionPoolMetrics;
@@ -31,6 +32,8 @@
import com.liferay.portal.kernel.jndi.JNDIUtil;
import com.liferay.portal.kernel.log.Log;
import com.liferay.portal.kernel.log.LogFactoryUtil;
+import com.liferay.portal.kernel.util.JavaDetector;
+import com.liferay.portal.kernel.util.PortalClassLoaderUtil;
import com.liferay.portal.kernel.util.PropertiesUtil;
import com.liferay.portal.kernel.util.PropsKeys;
import com.liferay.portal.kernel.util.ServerDetector;
@@ -54,6 +57,8 @@
import java.io.Closeable;
+import java.lang.reflect.Field;
+
import java.net.URL;
import java.net.URLClassLoader;
@@ -62,6 +67,7 @@
import java.sql.SQLException;
import java.util.Enumeration;
+import java.util.List;
import java.util.Map;
import java.util.Properties;
@@ -72,6 +78,9 @@
import javax.naming.Context;
import javax.naming.InitialContext;
+import javax.net.ssl.SSLContext;
+import javax.net.ssl.SSLEngine;
+
import javax.sql.DataSource;
import jodd.bean.BeanUtil;
@@ -125,13 +134,35 @@ else if (dataSource instanceof Closeable) {
@Override
public DataSource initDataSource(Properties properties) throws Exception {
- testDatabaseClass(properties);
+ String jndiName = properties.getProperty("jndi.name");
+ String driverClassName = properties.getProperty("driverClassName");
- \_waitForJDBCConnection(properties);
+ if (JavaDetector.isIBM() &&
+ (Validator.isNotNull(jndiName) ||
+ driverClassName.startsWith("com.mysql.cj"))) {
- String jndiName = properties.getProperty("jndi.name");
+ // https://issues.liferay.com/browse/LPS-120753
+
+ if (Validator.isNull(jndiName)) {
+ testDatabaseClass(driverClassName);
+ }
+
+ try {
+ \_populateIBMCipherSuites(
+ Class.forName("com.mysql.cj.protocol.ExportControlled"));
+ }
+ catch (ClassNotFoundException classNotFoundException) {
+ }
+ }
if (Validator.isNotNull(jndiName)) {
+ Thread currentThread = Thread.currentThread();
+
+ ClassLoader classLoader = currentThread.getContextClassLoader();
+
+ currentThread.setContextClassLoader(
+ PortalClassLoaderUtil.getClassLoader());
+
try {
Properties jndiEnvironmentProperties = PropsUtil.getProperties(
PropsKeys.JNDI\_ENVIRONMENT, true);
@@ -143,6 +174,14 @@ public DataSource initDataSource(Properties properties) throws Exception {
catch (Exception e) {
\_log.error("Unable to lookup " + jndiName, e);
}
+ finally {
+ currentThread.setContextClassLoader(classLoader);
+ }
+ }
+ else {
+ testDatabaseClass(driverClassName);
+
+ \_waitForJDBCConnection(properties);
}
if (\_log.isDebugEnabled()) {
@@ -549,9 +588,7 @@ protected void registerConnectionPoolMetrics(
ConnectionPoolMetrics.class, connectionPoolMetrics);
}
- protected void testDatabaseClass(Properties properties) throws Exception {
- String driverClassName = properties.getProperty("driverClassName");
-
+ protected void testDatabaseClass(String driverClassName) throws Exception {
try {
Class.forName(driverClassName);
}
@@ -585,6 +622,42 @@ protected void testDatabaseClass(Properties properties) throws Exception {
}
}
+ private void \_populateIBMCipherSuites(Class  clazz) {
+ try {
+ SSLContext sslContext = SSLContext.getDefault();
+
+ SSLEngine sslEngine = sslContext.createSSLEngine();
+
+ String[] ibmSupportedCipherSuites =
+ sslEngine.getSupportedCipherSuites();
+
+ if ((ibmSupportedCipherSuites == null) ||
+ (ibmSupportedCipherSuites.length == 0)) {
+
+ return;
+ }
+
+ Field allowedCiphersField = ReflectionUtil.getDeclaredField(
+ clazz, "ALLOWED\_CIPHERS");
+
+ List allowedCiphers = (List)allowedCiphersField.get(
+ null);
+
+ for (String ibmSupportedCipherSuite : ibmSupportedCipherSuites) {
+ if (!allowedCiphers.contains(ibmSupportedCipherSuite)) {
+ allowedCiphers.add(ibmSupportedCipherSuite);
+ }
+ }
+ }
+ catch (Exception exception) {
+ \_log.error(
+ "Unable to populate IBM JDK TLS cipher suite into MySQL " +
+ "Connector/J's allowed cipher list, consider disable SSL " +
+ "for connection",
+ exception);
+ }
+ }
+
private void \_waitForJDBCConnection(Properties properties) {
int maxRetries = PropsValues.RETRY\_JDBC\_ON\_STARTUP\_MAX\_RETRIES;
diff --git a/portal-impl/src/portal.properties b/portal-impl/src/portal.properties
index f7058c4643fd6e..f1bf83be4a880b 100644
--- a/portal-impl/src/portal.properties
+++ b/portal-impl/src/portal.properties
@@ -5877,7 +5877,7 @@
# Env: LIFERAY\_SETUP\_PERIOD\_DATABASE\_PERIOD\_JAR\_PERIOD\_URL\_OPENBRACKET\_COM\_PERIOD\_MYSQL\_PERIOD\_CJ\_PERIOD\_JDBC\_PERIOD\_\_UPPERCASED\_RIVER\_CLOSEBRACKET\_
#
setup.database.jar.name[com.mysql.cj.jdbc.Driver]=mysql.jar
- setup.database.jar.url[com.mysql.cj.jdbc.Driver]=https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.15/mysql-connector-java-8.0.15.jar
+ setup.database.jar.url[com.mysql.cj.jdbc.Driver]=https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.21/mysql-connector-java-8.0.21.jar
#
# Env: LIFERAY\_SETUP\_PERIOD\_DATABASE\_PERIOD\_URL\_OPENBRACKET\_DB\_NUMBER2\_\_CLOSEBRACKET\_
diff --git a/portal-kernel/src/com/liferay/portal/kernel/util/SubscriptionSender.java b/portal-kernel/src/com/liferay/portal/kernel/util/SubscriptionSender.java
index fbec2268742e64..bbc270d13de309 100644
--- a/portal-kernel/src/com/liferay/portal/kernel/util/SubscriptionSender.java
+++ b/portal-kernel/src/com/liferay/portal/kernel/util/SubscriptionSender.java
@@ -346,6 +346,16 @@ public void setCompanyId(long companyId) {
public void setContextAttribute(String key, EscapableObject value) {
\_context.put(key, value);
+
+ \_context.put(
+ \_getFilterKey(key, "attr"),
+ new HTMLAtributeEscapableObject<>(value.getOriginalValue(), true));
+ \_context.put(
+ \_getFilterKey(key, "html"),
+ new HtmlEscapableObject<>(value.getOriginalValue(), true));
+ \_context.put(
+ \_getFilterKey(key, "uri"),
+ new URIEscapableObject<>(value.getOriginalValue(), true));
}
public void setContextAttribute(String key, Object value) {
@@ -970,6 +980,19 @@ private MailTemplateContext \_getBodyMailTemplateContext(
\_getBasicMailTemplateContext(locale));
}
+ private String \_getFilterKey(String key, String escapeMode) {
+ int i = key.lastIndexOf("$]");
+
+ if (i != (key.length() - 2)) {
+ throw new IllegalArgumentException(
+ "Subscription template key is not syntactically correct: " +
+ key);
+ }
+
+ return StringBundler.concat(
+ key.substring(0, i), StringPool.PIPE, escapeMode, "$]");
+ }
+
private  List> \_getHooks(Hook.Event event) {
return (List)\_hooks.computeIfAbsent(event, key -> new ArrayList<>());
}
@@ -1055,4 +1078,39 @@ private void writeObject(ObjectOutputStream objectOutputStream)
\_runtimeSubscribersOVPs = new ArrayList<>();
private final Set \_sentEmailAddresses = new HashSet<>();
+ private static class HTMLAtributeEscapableObject
+ extends EscapableObject {
+
+ public HTMLAtributeEscapableObject(T originalValue) {
+ super(originalValue);
+ }
+
+ public HTMLAtributeEscapableObject(T originalValue, boolean escape) {
+ super(originalValue, escape);
+ }
+
+ @Override
+ protected String escape(T value) {
+ return HtmlUtil.escapeAttribute(String.valueOf(value));
+ }
+
+ }
+
+ private static class URIEscapableObject extends EscapableObject {
+
+ public URIEscapableObject(T originalValue) {
+ super(originalValue);
+ }
+
+ public URIEscapableObject(T originalValue, boolean escape) {
+ super(originalValue, escape);
+ }
+
+ @Override
+ protected String escape(T value) {
+ return URLCodec.encodeURL(String.valueOf(value));
+ }
+
+ }
+
}
\ No newline at end of file
From 82f4ccea1523ac97c62d5b22ebd900baa5d7c321 Mon Sep 17 00:00:00 2001
From: yxingwu
Date: Tue, 31 Aug 2021 10:12:49 +0800
Subject: [PATCH 12/15] Update README
---
README.markdown | 6 ++++++
1 file changed, 6 insertions(+)
diff --git a/README.markdown b/README.markdown
index 1f8e9cbc68710b..790badf8ce167c 100644
--- a/README.markdown
+++ b/README.markdown
@@ -7,6 +7,12 @@ information about security in Liferay Portal, please see
\*\*Cumulative diff patch:\*\*
[https://github.com/community-security-team/liferay-portal/compare/7.2.1-ga2...7.2.1-cumulative.patch](https://github.com/community-security-team/liferay-portal/compare/7.2.1-ga2...7.2.1-cumulative.patch)
+The [August 2021](https://github.com/community-security-team/liferay-portal/commit/1bfe0fddb35dda44f9a0319d3c6377b439971ca7) release contains fixes for the following issues:
+[CVE-TBA-01](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120882392),
+[CVE-TBA-03](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120882437),
+[CVE-TBA-06](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120882524),
+[CVE-TBA-07](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120882562) and updates to external libraries with known vulnerabilities.
+
The [May 2021](https://github.com/community-security-team/liferay-portal/commit/ce56c3137a8a97ffdad8a3e95ede563dd97c946f) release contains fixes for the following issues:
[CST-7227](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120741510),
[CST-7228](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120748003),
From d05fe207c8d3984aaadbe457119af2608bb8761c Mon Sep 17 00:00:00 2001
From: yxingwu
Date: Mon, 4 Apr 2022 12:17:43 +0800
Subject: [PATCH 13/15] Update README
---
README.markdown | 8 ++++----
1 file changed, 4 insertions(+), 4 deletions(-)
diff --git a/README.markdown b/README.markdown
index 790badf8ce167c..c103fdb82feb86 100644
--- a/README.markdown
+++ b/README.markdown
@@ -8,10 +8,10 @@ information about security in Liferay Portal, please see
[https://github.com/community-security-team/liferay-portal/compare/7.2.1-ga2...7.2.1-cumulative.patch](https://github.com/community-security-team/liferay-portal/compare/7.2.1-ga2...7.2.1-cumulative.patch)
The [August 2021](https://github.com/community-security-team/liferay-portal/commit/1bfe0fddb35dda44f9a0319d3c6377b439971ca7) release contains fixes for the following issues:
-[CVE-TBA-01](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120882392),
-[CVE-TBA-03](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120882437),
-[CVE-TBA-06](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120882524),
-[CVE-TBA-07](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120882562) and updates to external libraries with known vulnerabilities.
+[CVE-2021-38269](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120882392),
+[CVE-2021-38263](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120882437),
+[CVE-2021-38268](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120882524),
+[CVE-2021-38266](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120882562) and updates to external libraries with known vulnerabilities.
The [May 2021](https://github.com/community-security-team/liferay-portal/commit/ce56c3137a8a97ffdad8a3e95ede563dd97c946f) release contains fixes for the following issues:
[CST-7227](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120741510),
From 6a088e6b8ab4eb23ad67091fb66d5ab3be66c862 Mon Sep 17 00:00:00 2001
From: yxingwu
Date: Thu, 7 Apr 2022 16:08:47 +0800
Subject: [PATCH 14/15] Update README
---
README.markdown | 2 +-
1 file changed, 1 insertion(+), 1 deletion(-)
diff --git a/README.markdown b/README.markdown
index c103fdb82feb86..09a7722aa82346 100644
--- a/README.markdown
+++ b/README.markdown
@@ -37,7 +37,7 @@ The [May 2021](https://github.com/community-security-team/liferay-portal/commit/
[CVE-2021-33335](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747906),
[CVE-2021-33338](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120748276),
[CVE-2021-33339](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747934),
-[CVE-TBA-7335](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747817) and updates to external libraries with known vulnerabilities.
+[CVE-2022-26596](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/120747817) and updates to external libraries with known vulnerabilities.
The [September 2020](https://github.com/community-security-team/liferay-portal/commit/ed211f44d636d07647d7b8e2d1f0b0016866ab15) release contains fixes for the following issues:
[CST-7224](https://portal.liferay.dev/learn/security/known-vulnerabilities/-/asset\_publisher/HbL5mxmVrnXW/content/id/119784785),
From fc411f0ef8d2247b75a0b6cdacbbda44504bf0f6 Mon Sep 17 00:00:00 2001
From: yxingwu
Date: Tue, 7 Feb 2023 14:29:37 +0800
Subject: [PATCH 15/15] Update README
---
README.markdown | 4 ++--
1 file changed, 2 insertions(+), 2 deletions(-)
diff --git a/README.markdown b/README.markdown
index 09a7722aa82346..7fe4e20fd850b4 100644
--- a/README.markdown
+++ b/README.markdown
@@ -2,7 +2,7 @@
This fork provides security patches for Liferay Portal 7.2.1. For more
information about security in Liferay Portal, please see
-[https://portal.liferay.dev/learn/security](https://portal.liferay.dev/learn/security).
+[https://liferay.dev/portal/security](https://liferay.dev/portal/security).
\*\*Cumulative diff patch:\*\*
[https://github.com/community-security-team/liferay-portal/compare/7.2.1-ga2...7.2.1-cumulative.patch](https://github.com/community-security-team/liferay-portal/compare/7.2.1-ga2...7.2.1-cumulative.patch)
@@ -84,4 +84,4 @@ General Public License for more details.
You should have received a copy of the GNU Lesser General Public License along
with \*Liferay Portal Community Edition\*. If not, see
-[](https://www.gnu.org/licenses/)
\ No newline at end of file
+[](https://www.gnu.org/licenses/)



=== Content from portal.liferay.dev_aa8f7631_20250119_120039.html ===

[Skip to Main Content](#main-content)

[![](/documents/d/guest/logo-svg?download=true)](/)

* [Ask](https://liferay.dev/ask)
* [Blogs](https://liferay.dev/blogs)
* [Chat](https://join.slack.com/t/liferay-community/shared_invite/zt-2qrjrge9d-Ex3aZNesXlNfgtRQjKnidQ)
* [Download](https://www.liferay.com/downloads-community)
* [Feedback](https://liferay.dev/feedback)
* [Help](https://liferay.dev/help)
* [Learn](https://learn.liferay.com)
* [Projects](https://liferay.dev/projects)
* [/dev/24](https://liferay.dev/twentyfour)
* [Log In](https://liferay.dev/c/portal/login?p_l_id=119785690)

# Known Vulnerabilities

* [Overview](https://liferay.dev/portal/security/overview)
* [Reporting Security Issues](https://liferay.dev/portal/security/reporting)
* [Known Vulnerabilities](https://liferay.dev/portal/security/known-vulnerabilities)
* [Hall of Fame](https://liferay.dev/portal/security/hall-of-fame)

#### Releases

* [Liferay Portal 7.4](https://liferay.dev:443/portal/security/known-vulnerabilities/-/categories/121753902)

* [Liferay Portal 7.3](https://liferay.dev:443/portal/security/known-vulnerabilities/-/categories/121753907)

* [Liferay Portal 7.2](https://liferay.dev:443/portal/security/known-vulnerabilities/-/categories/121753910)

* [Liferay Portal 7.1](https://liferay.dev:443/portal/security/known-vulnerabilities/-/categories/121753913)

* [Liferay Portal 7.0](https://liferay.dev:443/portal/security/known-vulnerabilities/-/categories/121753931)

* [Liferay Portal 6.2 CE](https://liferay.dev:443/portal/security/known-vulnerabilities/-/categories/121753958)

* [Liferay Faces](https://liferay.dev:443/portal/security/known-vulnerabilities/-/categories/121606740)

* [Liferay DXP 7.4](https://liferay.dev:443/portal/security/known-vulnerabilities/-/categories/121810441)

* [Liferay DXP 7.3](https://liferay.dev:443/portal/security/known-vulnerabilities/-/categories/121810438)

* [Liferay DXP 7.2](https://liferay.dev:443/portal/security/known-vulnerabilities/-/categories/121810148)

* [LIferay DXP 7.1](https://liferay.dev:443/portal/security/known-vulnerabilities/-/categories/121810145)

* [LIferay DXP 7.0](https://liferay.dev:443/portal/security/known-vulnerabilities/-/categories/121810668)

* [Liferay DXP 2024 Q3](https://liferay.dev:443/portal/security/known-vulnerabilities/-/categories/123105535)

* [Liferay DXP 2024 Q2](https://liferay.dev:443/portal/security/known-vulnerabilities/-/categories/122736692)

* [Liferay DXP 2024 Q1](https://liferay.dev:443/portal/security/known-vulnerabilities/-/categories/122477174)

* [Liferay DXP 2023.Q4](https://liferay.dev:443/portal/security/known-vulnerabilities/-/categories/122393446)

* [Liferay DXP 2023.Q3](https://liferay.dev:443/portal/security/known-vulnerabilities/-/categories/122393443)

[Back](https://liferay.dev:443/portal/security/known-vulnerabilities/-/asset_publisher/jekt/)
### Error

Close

**Error:**The asset could not be found.

*Security advisories for Liferay's enterprise offerings (e.g., Liferay DXP) are only listed here since 2023. Historial advisories are availabe in the [Help Center](https://help.liferay.com/hc/en-us/articles/360016700231-Security-Overview).*

* Community
* [Ask](/ask)
* [Events](https://www.liferay.com/events)
* [Learn](/learn)
* [Meet](/meet)

* Company
* [Blogs](/blogs/)
* [Careers](https://www.liferay.com/careers)
* [Download](/download)
* [Open Source](/open-source)

* Feedback
* Contact Us

Copyright  2025 [Liferay, Inc](http://liferay.com)

Powered by [Liferay Portal CE](http://portal.liferay.dev)

Hidden

We use cookies to deliver personalized content, analyze trends, administer the site, track user movements on the site, and collect demographic information about our user base as a whole. Accept all cookies for the best possible experience on our website or manage your preferences.
[Visit our Privacy Policy](https://www.liferay.com/privacy-policy)

Configuration

Accept All

Decline All


