=== Content from core.trac.wordpress.org_2d9c9952_20250119_111103.html ===


[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Showcase](https://wordpress.org/showcase/)
* [Hosting](https://wordpress.org/hosting/)
* Extend
  + [Themes](https://wordpress.org/themes/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Blocks](https://wordpress.org/blocks/)
  + [Openverse ↗︎](https://openverse.org/)
* Learn
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* Community
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [Events](https://events.wordpress.org/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* About
  + [About WordPress](https://wordpress.org/about/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Make WordPress Core](https://make.wordpress.org/core/)

* [Blog](https://make.wordpress.org/core/)
* [Handbook](https://make.wordpress.org/core/handbook/)
* [Tickets](https://make.wordpress.org/core/reports/)
* [Components](https://make.wordpress.org/core/components/)
* [Browse Source](https://core.trac.wordpress.org/browser "Browse Source")
* [Trac Timeline](https://core.trac.wordpress.org/timeline "Trac Timeline")
* [Create a New Ticket](https://login.wordpress.org/?redirect_to=https://core.trac.wordpress.org/newticket "Create a New Ticket")

Search:

* [Login](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fcore.trac.wordpress.org%2Fchangeset%2F47984)
* [Notifications](https://make.wordpress.org/core/notifications/)

## Context Navigation

* ← [Previous Changeset](/changeset/47983 "Changeset 47983")
* [Next Changeset](/changeset/47985 "Changeset 47985") →

---

# Changeset 47984

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
06/10/2020 07:18:50 PM
([5 years](/timeline?from=2020-06-10T19%3A18%3A50Z&precision=second "See timeline at 06/10/2020 07:18:50 PM") ago)

Author:
whyisjake
Message:

Editor: Ensure latest comments can only be viewed from public posts.

Props: poena, xknown.

Location:
[trunk](/browser/trunk?rev=47984)
Files:

2 edited

* [src/wp-includes/comment-template.php](/browser/trunk/src/wp-includes/comment-template.php?rev=47984 "Show entry in browser")
  (modified)
  ([1 diff](#file0 "Show differences"))
* [tests/phpunit/tests/blocks/render.php](/browser/trunk/tests/phpunit/tests/blocks/render.php?rev=47984 "Show entry in browser")
  (modified)
  ([1 diff](#file1 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [trunk/src/wp-includes/comment-template.php](/changeset/47984/trunk/src/wp-includes/comment-template.php "Show the changeset 47984 restricted to trunk/src/wp-includes/comment-template.php")

  | [r47889](/browser/trunk/src/wp-includes/comment-template.php?rev=47889#L597 "Show revision 47889 of this file in browser") | [r47984](/browser/trunk/src/wp-includes/comment-template.php?rev=47984#L597 "Show revision 47984 of this file in browser") |  |
  | --- | --- | --- |
  | 597 | 597 | \*/ |
  | 598 | 598 | function get\_comment\_excerpt( $comment\_ID = 0 ) { |
  | 599 |  | $comment      = get\_comment( $comment\_ID ); |
  | 600 |  | $comment\_text = strip\_tags( str\_replace( array( "\n", "\r" ), ' ', $comment->comment\_content ) ); |
  |  | 599 | $comment = get\_comment( $comment\_ID ); |
  |  | 600 |  |
  |  | 601 | if ( ! post\_password\_required( $comment->comment\_post\_ID ) ) { |
  |  | 602 | $comment\_text = strip\_tags( str\_replace( array( "\n", "\r" ), ' ', $comment->comment\_content ) ); |
  |  | 603 | } else { |
  |  | 604 | $comment\_text = \_\_( 'Password protected' ); |
  |  | 605 | } |
  | 601 | 606 |  |
  | 602 | 607 | /\* translators: Maximum number of words used in a comment excerpt. \*/ |
* ## [trunk/tests/phpunit/tests/blocks/render.php](/changeset/47984/trunk/tests/phpunit/tests/blocks/render.php "Show the changeset 47984 restricted to trunk/tests/phpunit/tests/blocks/render.php")

  | [r46612](/browser/trunk/tests/phpunit/tests/blocks/render.php?rev=46612#L290 "Show revision 46612 of this file in browser") | [r47984](/browser/trunk/tests/phpunit/tests/blocks/render.php?rev=47984#L290 "Show revision 47984 of this file in browser") |  |
  | --- | --- | --- |
  | 290 | 290 | } |
  | 291 | 291 |  |
  |  | 292 | public function test\_render\_latest\_comments\_on\_password\_protected\_post() { |
  |  | 293 | $post\_id      = self::factory()->post->create( |
  |  | 294 | array( |
  |  | 295 | 'post\_password' => 'password', |
  |  | 296 | ) |
  |  | 297 | ); |
  |  | 298 | $comment\_text = wp\_generate\_password( 10, false ); |
  |  | 299 | self::factory()->comment->create( |
  |  | 300 | array( |
  |  | 301 | 'comment\_post\_ID' => $post\_id, |
  |  | 302 | 'comment\_content' => $comment\_text, |
  |  | 303 | ) |
  |  | 304 | ); |
  |  | 305 | $comments = do\_blocks( '<!-- wp:latest-comments {"commentsToShow":1,"displayExcerpt":true} /-->' ); |
  |  | 306 |  |
  |  | 307 | $this->assertNotContains( $comment\_text, $comments ); |
  |  | 308 | } |
  |  | 309 |  |
  | 292 | 310 | /\*\* |
  | 293 | 311 | \* @ticket 45109 |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=47984)
* [Zip Archive](?format=zip&new=47984)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Privacy](https://wordpress.org/about/privacy/)

* [Showcase](https://wordpress.org/showcase/)
* [Themes](https://wordpress.org/themes/)
* [Plugins](https://wordpress.org/plugins/)
* [Patterns](https://wordpress.org/patterns/)

* [Learn](https://learn.wordpress.org/)
* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [WordPress.tv ↗](https://wordpress.tv/)

* [Get Involved](https://make.wordpress.org/)
* [Events](https://events.wordpress.org/)
* [Donate ↗](https://wordpressfoundation.org/donate/)
* [Five for the Future](https://wordpress.org/five-for-the-future/)

* [WordPress.com ↗](https://wordpress.com/?ref=wporg-footer)
* [Matt ↗](https://ma.tt/)
* [bbPress ↗](https://bbpress.org/)
* [BuddyPress ↗](https://buddypress.org/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our X (formerly Twitter) account](https://www.x.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)
* [Visit our YouTube channel](https://www.youtube.com/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from wordpress.org_e3f0b8f0_20250119_111105.html ===


[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Showcase](https://wordpress.org/showcase/)
* [Hosting](https://wordpress.org/hosting/)
* Extend
  + [Themes](https://wordpress.org/themes/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Blocks](https://wordpress.org/blocks/)
  + [Openverse ↗︎](https://openverse.org/)
* Learn
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* Community
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [Events](https://events.wordpress.org/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* About
  + [About WordPress](https://wordpress.org/about/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
* [Get WordPress](https://wordpress.org/download/)

Search in WordPress.org

[Get WordPress](https://wordpress.org/download/)

[WordPress.org](https://wordpress.org/)

[News](https://wordpress.org/news)

WordPress 5.4.2 Security and Maintenance Release

All posts

Search results

* Categories
  + [All Posts](https://wordpress.org/news/all-posts/)
  + [Awards](https://wordpress.org/news/category/awards/)
  + [Community](https://wordpress.org/news/category/community/)
  + [Design](https://wordpress.org/news/category/design/)
  + [Development](https://wordpress.org/news/category/development/)
  + [Documentation](https://wordpress.org/news/category/documentation/)
  + [Events](https://wordpress.org/news/category/events/)
  + [Features](https://wordpress.org/news/category/features/)
  + [General](https://wordpress.org/news/category/general/)
  + [Interviews](https://wordpress.org/news/category/interviews/)
  + [Meta](https://wordpress.org/news/category/meta/)
  + [Month in WordPress](https://wordpress.org/news/category/month-in-wordpress/)
  + [Performance](https://wordpress.org/news/category/performance/)
  + [Podcast](https://wordpress.org/news/podcast/)
  + [Releases](https://wordpress.org/news/category/releases/)
  + [Security](https://wordpress.org/news/category/security/)
  + [Store](https://wordpress.org/news/category/store/)
  + [Testing](https://wordpress.org/news/category/testing/)
  + [Updates](https://wordpress.org/news/category/updates/)
  + [WordCamp](https://wordpress.org/news/category/wordcamp/)

* Categories
  + [All Posts](https://wordpress.org/news/all-posts/)
  + [Awards](https://wordpress.org/news/category/awards/)
  + [Community](https://wordpress.org/news/category/community/)
  + [Design](https://wordpress.org/news/category/design/)
  + [Development](https://wordpress.org/news/category/development/)
  + [Documentation](https://wordpress.org/news/category/documentation/)
  + [Events](https://wordpress.org/news/category/events/)
  + [Features](https://wordpress.org/news/category/features/)
  + [General](https://wordpress.org/news/category/general/)
  + [Interviews](https://wordpress.org/news/category/interviews/)
  + [Meta](https://wordpress.org/news/category/meta/)
  + [Month in WordPress](https://wordpress.org/news/category/month-in-wordpress/)
  + [Performance](https://wordpress.org/news/category/performance/)
  + [Podcast](https://wordpress.org/news/podcast/)
  + [Releases](https://wordpress.org/news/category/releases/)
  + [Security](https://wordpress.org/news/category/security/)
  + [Store](https://wordpress.org/news/category/store/)
  + [Testing](https://wordpress.org/news/category/testing/)
  + [Updates](https://wordpress.org/news/category/updates/)
  + [WordCamp](https://wordpress.org/news/category/wordcamp/)

June 10, 2020
By [Jake Spurlock](https://profiles.wordpress.org/whyisjake/)
in [Releases](https://wordpress.org/news/category/releases/), [Security](https://wordpress.org/news/category/security/)
# WordPress 5.4.2 Security and Maintenance Release

---

WordPress 5.4.2 is now available!

This security and maintenance release features 23 fixes and enhancements. Plus, it adds a number of security fixes—see the list below.

These bugs affect WordPress versions 5.4.1 and earlier; version 5.4.2 fixes them, so you’ll want to upgrade.

If you haven’t yet updated to 5.4, there are also updated versions of 5.3 and earlier that fix the bugs for you.

### **Security Updates**

WordPress versions 5.4 and earlier are affected by the following bugs, which are fixed in version 5.4.2. If you haven’t yet updated to 5.4, there are also updated versions of 5.3 and earlier that fix the security issues.

* Props to Sam Thomas (jazzy2fives) for finding an XSS issue where authenticated users with low privileges are able to add JavaScript to posts in the block editor.
* Props to Luigi – ([gubello.me](https://www.gubello.me/)) for discovering an XSS issue where authenticated users with upload permissions are able to add JavaScript to media files.
* Props to Ben Bidner of the WordPress Security Team for finding an open redirect issue in *wp\_validate\_redirect()*.
* Props to [Nrimo Ing Pandum](http://apapedulimu.click) for finding an authenticated XSS issue via theme uploads.
* Props to [Simon Scannell of RIPS Technologies](https://blog.ripstech.com/authors/simon-scannell) for finding an issue where *set-screen-option* can be misused by plugins leading to privilege escalation.
* Props to [Carolina Nymark](https://profiles.wordpress.org/poena/) for discovering an issue where comments from password-protected posts and pages could be displayed under certain conditions.

Thank you to all of the reporters for [privately disclosing the vulnerabilities](https://make.wordpress.org/core/handbook/testing/reporting-security-vulnerabilities/). This gave the security team time to fix the vulnerabilities before WordPress sites could be attacked.

One maintenance update was also deployed to versions 5.1, 5.2 and 5.3. See the [related developer note](https://make.wordpress.org/core/2020/06/09/wordpress-5-4-2-prevent-unmoderated-comments-from-search-engine-indexation/) for more information.

You can browse the [full list of changes on Trac](https://core.trac.wordpress.org/query?status=closed&resolution=fixed&milestone=5.4.2&order=priority).

For more info, browse the full list of changes on Trac or check out the Version [5.4.2 documentation page](https://wordpress.org/support/wordpress-version/version-5-4-2/).

WordPress 5.4.2 is a short-cycle maintenance release. The next major release will be [version 5.5](https://make.wordpress.org/core/5-5/).

You can download WordPress 5.4.2 from the button at the top of this page, or visit your**Dashboard → Updates** and click **Update Now**.

If you have sites that support automatic background updates, they’ve already started the update process.

### Thanks and props!

In addition to the security researchers mentioned above, thank you to everyone who helped make WordPress 5.4.2 happen:

[Andrea Fercia](https://profiles.wordpress.org/afercia/), [argentite](https://profiles.wordpress.org/argentite/), [M Asif Rahman](https://profiles.wordpress.org/asif2bd/), [Jb Audras](https://profiles.wordpress.org/audrasjb/), [Ayesh Karunaratne](https://profiles.wordpress.org/ayeshrajans/), [bdcstr](https://profiles.wordpress.org/bdcstr/), [Delowar Hossain](https://profiles.wordpress.org/delowardev/), [Rob Migchels](https://profiles.wordpress.org/dhrrob/), [donmhico](https://profiles.wordpress.org/donmhico/), [Ehtisham Siddiqui](https://profiles.wordpress.org/ehtis/), [Emilie LEBRUN](https://profiles.wordpress.org/emlebrun/), [finomeno](https://profiles.wordpress.org/finomeno/), [garethgillman](https://profiles.wordpress.org/garethgillman/), [Giorgio25b](https://profiles.wordpress.org/giorgio25b/), [Gabriel Maldonado](https://profiles.wordpress.org/gma992/), [Hector F](https://profiles.wordpress.org/h71/), [Ian Belanger](https://profiles.wordpress.org/ianbelanger/), [Aaron Jorbin](https://profiles.wordpress.org/jorbin/), [Mathieu Viet](https://profiles.wordpress.org/imath/), [Javier Casares](https://profiles.wordpress.org/javiercasares/), [Joe McGill](https://profiles.wordpress.org/joemcgill/), [jonkolbert](https://profiles.wordpress.org/jonkolbert/), [Jono Alderson](https://profiles.wordpress.org/jonoaldersonwp/), [Joy](https://profiles.wordpress.org/joyously/), [Tammie Lister](https://profiles.wordpress.org/karmatosed/), [Kjell Reigstad](https://profiles.wordpress.org/kjellr/), [KT](https://profiles.wordpress.org/kthmd/), [markusthiel](https://profiles.wordpress.org/markusthiel/), [Mayank Majeji](https://profiles.wordpress.org/mayankmajeji/), [Mel Choyce-Dwan](https://profiles.wordpress.org/melchoyce/), [mislavjuric](https://profiles.wordpress.org/mislavjuric/), [Mukesh Panchal](https://profiles.wordpress.org/mukesh27/), [Nikhil Bhansi](https://profiles.wordpress.org/nikhilbhansi/), [oakesjosh](https://profiles.wordpress.org/oakesjosh/), [Dominik Schilling](https://profiles.wordpress.org/ocean90/), [Arslan Ahmed](https://profiles.wordpress.org/passoniate/), [Peter Wilson](https://profiles.wordpress.org/peterwilsoncc/), [Carolina Nymark](https://profiles.wordpress.org/poena/), [Stephen Bernhardt](https://profiles.wordpress.org/sabernhardt/), [Sam Fullalove](https://profiles.wordpress.org/samful/), [Alain Schlesser](https://profiles.wordpress.org/schlessera/), [Sergey Biryukov](https://profiles.wordpress.org/sergeybiryukov/), [skarabeq](https://profiles.wordpress.org/skarabeq/), [Daniel Richards](https://profiles.wordpress.org/talldanwp/), [Toni Viemerö](https://profiles.wordpress.org/skithund/), [suzylah](https://profiles.wordpress.org/suzylah/), [Timothy Jacobs](https://profiles.wordpress.org/timothyblynjacobs/), [TeBenachi](https://profiles.wordpress.org/utz119/), [Jake Spurlock](https://profiles.wordpress.org/whyisjake/) and [yuhin](https://profiles.wordpress.org/yuhin/).

Share this:

* [Threads](https://wordpress.org/news/2020/06/wordpress-5-4-2-security-and-maintenance-release/?share=threads&nb=1)
* [Mastodon](https://wordpress.org/news/2020/06/wordpress-5-4-2-security-and-maintenance-release/?share=mastodon&nb=1)
* [Bluesky](https://wordpress.org/news/2020/06/wordpress-5-4-2-security-and-maintenance-release/?share=bluesky&nb=1)
* [X](https://wordpress.org/news/2020/06/wordpress-5-4-2-security-and-maintenance-release/?share=x&nb=1)
* [Facebook](https://wordpress.org/news/2020/06/wordpress-5-4-2-security-and-maintenance-release/?share=facebook&nb=1)
* [LinkedIn](https://wordpress.org/news/2020/06/wordpress-5-4-2-security-and-maintenance-release/?share=linkedin&nb=1)

---

[Previous Equity and the Power of Community](https://wordpress.org/news/2020/06/equity-and-the-power-of-community/)
[Next The Month in WordPress: June 2020](https://wordpress.org/news/2020/07/the-month-in-wordpress-june-2020/)

## Get the Latest Updates

### Subscribe to WordPress News

Email Address

Subscribe

Join 18.7K other subscribers

### WP Briefing — The WordPress Podcast

Learn about where WordPress is going and how you can get involved.

* [Apple Podcasts](https://podcasts.apple.com/us/podcast/wp-briefing/id1551691710)
* [Pocket Casts](https://pca.st/uqvvmt8t)
* [RSS](https://wordpress.org/news/feed/podcast)
* [Spotify](https://open.spotify.com/show/6BxgmE9Qg2TZA8EKZLJ4zS)
* [Stitcher](https://www.stitcher.com/show/wp-briefing)

[Listen to all episodes](https://wordpress.org/news/podcast/)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Privacy](https://wordpress.org/about/privacy/)

* [Showcase](https://wordpress.org/showcase/)
* [Themes](https://wordpress.org/themes/)
* [Plugins](https://wordpress.org/plugins/)
* [Patterns](https://wordpress.org/patterns/)

* [Learn](https://learn.wordpress.org/)
* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [WordPress.tv ↗](https://wordpress.tv/)

* [Get Involved](https://make.wordpress.org/)
* [Events](https://events.wordpress.org/)
* [Donate ↗](https://wordpressfoundation.org/donate/)
* [Five for the Future](https://wordpress.org/five-for-the-future/)

* [WordPress.com ↗](https://wordpress.com/?ref=wporg-footer)
* [Matt ↗](https://ma.tt/)
* [bbPress ↗](https://bbpress.org/)
* [BuddyPress ↗](https://buddypress.org/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our X (formerly Twitter) account](https://www.x.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)
* [Visit our YouTube channel](https://www.youtube.com/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


