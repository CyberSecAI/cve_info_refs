=== Content from bugs.launchpad.net_183b983c_20250119_115322.html ===

[Log in / Register](https://bugs.launchpad.net/ubuntu/%2Bsource/checkinstall/%2Bbug/1861281/%2Blogin)

[![](https://launchpadlibrarian.net/606381979/CoF%2064px.png)](https://launchpad.net/ubuntu)

## [Ubuntu](https://launchpad.net/ubuntu)[checkinstall package](https://launchpad.net/ubuntu/%2Bsource/checkinstall)

* [Overview](https://launchpad.net/ubuntu/%2Bsource/checkinstall)
* [Code](https://code.launchpad.net/ubuntu/%2Bsource/checkinstall)
* [Bugs](https://bugs.launchpad.net/ubuntu/%2Bsource/checkinstall)
* Blueprints
* [Translations](https://translations.launchpad.net/ubuntu/%2Bsource/checkinstall)
* [Answers](https://answers.launchpad.net/ubuntu/%2Bsource/checkinstall)

# checkinstall adds local root exploits to any package with a symlink in it

Bug #1861281 reported by
[Gianni Tedesco](https://launchpad.net/~scara)
on 2020-01-29

[256](/%2Bhelp-bugs/bug-heat.html)

This bug affects 1 person

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [checkinstall (Ubuntu)](https://bugs.launchpad.net/ubuntu/%2Bsource/checkinstall "Latest release: 1.6.2+git20170426.d24a630-5.1, uploaded to main on 2025-01-08 22:28:27.334339+00:00 by Stephen Gelman (ssgelm), maintained by Stephen Gelman (ssgelm)") | Confirmed | Undecided | Unassigned |  |

### Bug Description

I create a tarball using the following script, it's a file, and a symlink to a file.

--8<---

#!/bin/sh

rm -rf usr/bin

mkdir -p usr/bin

echo -e '#!/bin/sh\necho Hi I am `id`' > usr/bin/writable

chmod 755 usr/bin/writable

ln -sf writable usr/bin/vulnerable

tar c usr/bin/writable usr/bin/vulnerable | gzip -c > pkg.tar.gz

--8<---

Then, I make untaring this file the subject of a checkinstall package:

checkinstall \

                --install=no \

                -d0 \

                -y \

                --pakdir=deb \

                --pkgname=vulnerable \

                --pkgversion=13.37 \

                --pkgrelease=1 \

                --nodoc \

                --deldesc=yes \

                --backup \

                -- \

  bash -c "gzip -cd pkg.tar.gz| (cd /; tar xv)"

Then I install this package with dpkg and end up with:

lrwxrwxrwx 1 gianni gianni 8 Jan 29 12:50 /usr/bin/vulnerable -> writable

-rwxrwxrwx 1 gianni gianni 31 Jan 29 12:50 /usr/bin/writable

Oh no, world writable binary, when the original was mode 755. Now a user can modify the contents and wait for root to run the command. Hey presto, local privlege execution and arbitrary code execution.

Looks like this is due to some fubar surround preservation of permissions vs symlinks.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Gianni Tedesco (scara)](https://launchpad.net/~scara) wrote on 2020-01-29: |  |  | [#1](/ubuntu/%2Bsource/checkinstall/%2Bbug/1861281/comments/1) |
| --- | --- | --- | --- |

A related bug, which I don't want to post separately because it's too close to this.

Is that when the tar creation has the symlink and the target in the opposite order, then checkinstall fails totally (note that the command being run works when NOT being run under checkinstall):

checkinstall 1.6.2, Copyright 2009 Felipe Eduardo Sanchez Diaz Duran

           This software is released under the GNU GPL.

\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*

\*\*\*\* Debian package creation selected \*\*\*

\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*

This package will be built according to these values:

0 - Maintainer: [ root@turf ]

1 - Summary: [ Package created with checkinstall 1.6.2 ]

2 - Name: [ vulnerable ]

3 - Version: [ 13.37 ]

4 - Release: [ 2 ]

5 - License: [ GPL ]

6 - Group: [ checkinstall ]

7 - Architecture: [ amd64 ]

8 - Source location: [ checkpwn ]

9 - Alternate source location: [ ]

10 - Requires: [ ]

11 - Provides: [ vulnerable ]

12 - Conflicts: [ ]

13 - Replaces: [ ]

Enter a number to change any of them or press ENTER to continue:

Installing with bash -c gzip -cd rev.tar.gz| (cd /; tar xv)...

========================= Installation results ===========================

usr/bin/vulnerable

tar: usr/bin/vulnerable: Cannot change mode to rwxrwxrwx: No such file or directory

usr/bin/writable

tar: Exiting with failure status due to previous errors

\*\*\*\* Installation failed. Aborting package creation.

Cleaning up...OK

Bye.

A related bug, which I don't want to post separately because it's too close to this.
Is that when the tar creation has the symlink and the target in the opposite order, then checkinstall fails totally (note that the command being run works when NOT being run under checkinstall):
checkinstall 1.6.2, Copyright 2009 Felipe Eduardo Sanchez Diaz Duran
This software is released under the GNU GPL.
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
\*\*\*\* Debian package creation selected \*\*\*
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
This package will be built according to these values:
0 - Maintainer: [ root@turf ]
1 - Summary: [ Package created with checkinstall 1.6.2 ]
2 - Name: [ vulnerable ]
3 - Version: [ 13.37 ]
4 - Release: [ 2 ]
5 - License: [ GPL ]
6 - Group: [ checkinstall ]
7 - Architecture: [ amd64 ]
8 - Source location: [ checkpwn ]
9 - Alternate source location: [ ]
10 - Requires: [ ]
11 - Provides: [ vulnerable ]
12 - Conflicts: [ ]
13 - Replaces: [ ]
Enter a number to change any of them or press ENTER to continue:
Installing with bash -c gzip -cd rev.tar.gz| (cd /; tar xv)...
========================= Installation results ===========================
usr/bin/vulnerable
tar: usr/bin/vulnerable: Cannot change mode to rwxrwxrwx: No such file or directory
usr/bin/writable
tar: Exiting with failure status due to previous errors
\*\*\*\* Installation failed. Aborting package creation.
Cleaning up...OK
Bye.

| **summary**: | - checkinstall may add local root exploits to packages with symlinks in- them+ checkinstall adds local root exploits to any package with a symlink in+ it |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Seth Arnold (seth-arnold)](https://launchpad.net/~seth-arnold) wrote on 2020-02-04: |  |  | [#2](/ubuntu/%2Bsource/checkinstall/%2Bbug/1861281/comments/2) |
| --- | --- | --- | --- |

Hello, nice writeup and reproducer; have you reported these issues upstream yet?

Thanks

Hello, nice writeup and reproducer; have you reported these issues upstream yet?
Thanks

| **information type**: | Private Security → Public Security |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Gianni Tedesco (scara)](https://launchpad.net/~scara) wrote on 2020-02-05: |  |  | [#3](/ubuntu/%2Bsource/checkinstall/%2Bbug/1861281/comments/3) |
| --- | --- | --- | --- |

Ah no, the upstream link I found on launchpad was dead but I think I know what to do with it now.

Ah no, the upstream link I found on launchpad was dead but I think I know what to do with it now.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Gianni Tedesco (scara)](https://launchpad.net/~scara) wrote on 2020-02-05: |  |  | [#4](/ubuntu/%2Bsource/checkinstall/%2Bbug/1861281/comments/4) |
| --- | --- | --- | --- |

Welp, their bugtracker is dead and I wasn't sure about how appropriate the mailing list would be

Welp, their bugtracker is dead and I wasn't sure about how appropriate the mailing list would be

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Gianni Tedesco (scara)](https://launchpad.net/~scara) wrote on 2020-02-05: |  |  | [#5](/ubuntu/%2Bsource/checkinstall/%2Bbug/1861281/comments/5) |
| --- | --- | --- | --- |

Sent an email to the maintainer

Sent an email to the maintainer

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Stephen Gelman (ssgelm)](https://launchpad.net/~ssgelm) wrote on 2020-02-05: |  |  | [#6](/ubuntu/%2Bsource/checkinstall/%2Bbug/1861281/comments/6) |
| --- | --- | --- | --- |

Hi!

I am the Debian maintainer of checkinstall. As you have noticed the upstream appears to be pretty dead. I've tried to contact the original author about the bug tracker being down and have never received a reply. I will see what I can do to fix the security issues you reported in the Debian package which will then be pulled into Ubuntu.

Thanks,

Stephen

Hi!
I am the Debian maintainer of checkinstall. As you have noticed the upstream appears to be pretty dead. I've tried to contact the original author about the bug tracker being down and have never received a reply. I will see what I can do to fix the security issues you reported in the Debian package which will then be pulled into Ubuntu.
Thanks,
Stephen

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Seth Arnold (seth-arnold)](https://launchpad.net/~seth-arnold) wrote on 2020-02-06: |  |  | [#7](/ubuntu/%2Bsource/checkinstall/%2Bbug/1861281/comments/7) |
| --- | --- | --- | --- |

Hello Stephen, pity the original authors have moved on, but I can understand. Thanks for giving this a look.

Thanks

Hello Stephen, pity the original authors have moved on, but I can understand. Thanks for giving this a look.
Thanks

[Marc Deslauriers (mdeslaur)](https://launchpad.net/~mdeslaur)
on 2020-03-11

| Changed in checkinstall (Ubuntu): | |
| --- | --- |
| **status**: | New → Confirmed |

[See full activity log](https://bugs.launchpad.net/ubuntu/%2Bsource/checkinstall/%2Bbug/1861281/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/ubuntu/%2Bsource/checkinstall/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/ubuntu/%2Bsource/checkinstall/%2Bbug/1861281/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/ubuntu/%2Bsource/checkinstall/%2Bbug/1861281/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/ubuntu/%2Bsource/checkinstall/%2Bbug/1861281/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
6394e03
([Get the code!](https://dev.launchpad.net/))


