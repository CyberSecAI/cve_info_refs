=== Content from bugzilla.redhat.com_06358158_20250119_110547.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D2021728)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D2021728)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D2021728)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 2021728

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 2021728**](show_bug.cgi?id=2021728)
(CVE-2020-25721)
- [CVE-2020-25721](https://access.redhat.com/security/cve/CVE-2020-25721) samba: Kerberos acceptors need easy access to stableAD identifiers (eg objectSid)

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2020-25721 samba: Kerberos acceptors need easy access to stableAD identif...

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED NOTABUG | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2020-25721 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [2021729](show_bug.cgi?id=2021729 "CLOSED ERRATA - CVE-2020-25721 samba: Kerberos acceptors need easy access to stableAD identifiers (eg objectSid) [fedora-all]") | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [1976705](show_bug.cgi?id=1976705) | | TreeView+ | [depends on](buglist.cgi?bug_id=2021728&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=2021728&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2021-11-10 03:31 UTC by Huzaifa S. Sidhpurwala | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2023-03-14 12:16 UTC ([History](show_activity.cgi?id=2021728)) | | [CC List:](page.cgi?id=fields.html#cclist) | 16 users (show)  abokovoy anoopcs asn dkarpele gdeschner hvyas iboukris jarrpa jstephen lmohanty madam pfilipen puebele rhs-smb sbose ssorce | | Fixed In Version: | samba 4.15.2, samba 4.14.10, samba 4.13.14 | | | Doc Type: | No Doc Update | | | Doc Text: |  | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2021-11-10 04:27:37 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | | |  |
| --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=2021728#c0)  Huzaifa S. Sidhpurwala    2021-11-10 03:31:32 UTC  ``` As per upstream report:  In order to avoid issues like [CVE-2020-25717](https://access.redhat.com/security/cve/CVE-2020-25717) AD Kerberos accepting services need access to unique, and ideally long-term stable identifiers of a user to perform authorization.  The AD PAC provides this, but the most useful information is kept in a buffer which is NDR encoded, which means that so far in Free Software only Samba and applications which use Samba components under the hood like FreeIPA and SSSD decode PAC.  Recognising that the issues seen in Samba are not unique, Samba now provides an extension to UPN_DNS_INFO, a component of the AD PAC, in a way that can be parsed using basic pointer handling.  From this, future non-Samba based Kerberised applications can easily obtain the user's SID, in the same packing as objectSID in LDAP, confident that the ticket represents a specific user, not matter subsequent renames.  This will allow such non-Samba applications to avoid confusing one Kerberos user for another, even if they have the same string name (due to the gap between time of ticket printing by the KDC and time of ticket acceptance).   ```  [Comment 1](show_bug.cgi?id=2021728#c1)  Huzaifa S. Sidhpurwala    2021-11-10 03:31:59 UTC  ``` Created samba tracking bugs for this issue:  Affects: fedora-all [[bug 2021729](show_bug.cgi?id=2021729 "CLOSED ERRATA - CVE-2020-25721 samba: Kerberos acceptors need easy access to stableAD identifiers (eg objectSid) [fedora-all]")]   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=2021728&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from security.gentoo.org_d0636a05_20250119_110548.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# Samba: Multiple Vulnerabilities — GLSA **202309-06**

Multiple vulnerabilities have been discovered in Samba, the worst of which could result in root remote code execution.

### Affected packages

| Package | **net-fs/samba** on all architectures |
| --- | --- |
| Affected versions | < **4.18.4** |
| Unaffected versions | >= **4.18.4** |

### Background

Samba is a suite of SMB and CIFS client/server programs.

### Description

Multiple vulnerabilities have been discovered in Samba. Please review the CVE identifiers referenced below for details.

### Impact

Please review the referenced CVE identifiers for details.

### Workaround

There is no known workaround at this time.

### Resolution

All Samba users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=net-fs/samba-4.18.4"

```
### References

* [CVE-2007-4559](https://nvd.nist.gov/vuln/detail/CVE-2007-4559)
* [CVE-2016-2124](https://nvd.nist.gov/vuln/detail/CVE-2016-2124)
* [CVE-2020-17049](https://nvd.nist.gov/vuln/detail/CVE-2020-17049)
* [CVE-2020-25717](https://nvd.nist.gov/vuln/detail/CVE-2020-25717)
* [CVE-2020-25718](https://nvd.nist.gov/vuln/detail/CVE-2020-25718)
* [CVE-2020-25719](https://nvd.nist.gov/vuln/detail/CVE-2020-25719)
* [CVE-2020-25721](https://nvd.nist.gov/vuln/detail/CVE-2020-25721)
* [CVE-2020-25722](https://nvd.nist.gov/vuln/detail/CVE-2020-25722)
* [CVE-2021-3670](https://nvd.nist.gov/vuln/detail/CVE-2021-3670)
* [CVE-2021-3738](https://nvd.nist.gov/vuln/detail/CVE-2021-3738)
* [CVE-2021-20251](https://nvd.nist.gov/vuln/detail/CVE-2021-20251)
* [CVE-2021-20316](https://nvd.nist.gov/vuln/detail/CVE-2021-20316)
* [CVE-2021-23192](https://nvd.nist.gov/vuln/detail/CVE-2021-23192)
* [CVE-2021-44141](https://nvd.nist.gov/vuln/detail/CVE-2021-44141)
* [CVE-2021-44142](https://nvd.nist.gov/vuln/detail/CVE-2021-44142)
* [CVE-2022-0336](https://nvd.nist.gov/vuln/detail/CVE-2022-0336)
* [CVE-2022-1615](https://nvd.nist.gov/vuln/detail/CVE-2022-1615)
* [CVE-2022-2031](https://nvd.nist.gov/vuln/detail/CVE-2022-2031)
* [CVE-2022-3437](https://nvd.nist.gov/vuln/detail/CVE-2022-3437)
* [CVE-2022-3592](https://nvd.nist.gov/vuln/detail/CVE-2022-3592)
* [CVE-2022-32742](https://nvd.nist.gov/vuln/detail/CVE-2022-32742)
* [CVE-2022-32743](https://nvd.nist.gov/vuln/detail/CVE-2022-32743)
* [CVE-2022-32744](https://nvd.nist.gov/vuln/detail/CVE-2022-32744)
* [CVE-2022-32745](https://nvd.nist.gov/vuln/detail/CVE-2022-32745)
* [CVE-2022-32746](https://nvd.nist.gov/vuln/detail/CVE-2022-32746)
* [CVE-2022-37966](https://nvd.nist.gov/vuln/detail/CVE-2022-37966)
* [CVE-2022-37967](https://nvd.nist.gov/vuln/detail/CVE-2022-37967)
* [CVE-2022-38023](https://nvd.nist.gov/vuln/detail/CVE-2022-38023)
* [CVE-2022-42898](https://nvd.nist.gov/vuln/detail/CVE-2022-42898)
* [CVE-2022-45141](https://nvd.nist.gov/vuln/detail/CVE-2022-45141)
* [CVE-2023-0225](https://nvd.nist.gov/vuln/detail/CVE-2023-0225)
* [CVE-2023-0614](https://nvd.nist.gov/vuln/detail/CVE-2023-0614)
* [CVE-2023-0922](https://nvd.nist.gov/vuln/detail/CVE-2023-0922)

**Release date**

September 17, 2023

**Latest revision**

September 17, 2023: 1

**Severity**

high

**Exploitable**

remote

**Bugzilla entries**

* [820566](https://bugs.gentoo.org/show_bug.cgi?id=820566)
* [821688](https://bugs.gentoo.org/show_bug.cgi?id=821688)
* [830983](https://bugs.gentoo.org/show_bug.cgi?id=830983)
* [832433](https://bugs.gentoo.org/show_bug.cgi?id=832433)
* [861512](https://bugs.gentoo.org/show_bug.cgi?id=861512)
* [866225](https://bugs.gentoo.org/show_bug.cgi?id=866225)
* [869122](https://bugs.gentoo.org/show_bug.cgi?id=869122)
* [878273](https://bugs.gentoo.org/show_bug.cgi?id=878273)
* [880437](https://bugs.gentoo.org/show_bug.cgi?id=880437)
* [886153](https://bugs.gentoo.org/show_bug.cgi?id=886153)
* [903621](https://bugs.gentoo.org/show_bug.cgi?id=903621)
* [905320](https://bugs.gentoo.org/show_bug.cgi?id=905320)
* [910334](https://bugs.gentoo.org/show_bug.cgi?id=910334)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from bugzilla.samba.org_6dcc20c9_20250119_110548.html ===


The Samba-Bugzilla – Bug 14725
[SECURITY] Andrew's Kerberos Concerns (November 9 2021)
Last modified: 2022-07-20 07:59:52 UTC

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=14725&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=14725&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

[**Bug 14725**](show_bug.cgi?id=14725)
- [SECURITY] Andrew's Kerberos Concerns (November 9 2021)

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
[SECURITY] Andrew's Kerberos Concerns (November 9 2021)

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | Samba 4.1 and newer | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=Samba 4.1 and newer "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | AD: LDB/DSDB/SAMDB ([show other bugs](buglist.cgi?component=AD%3A%20LDB%2FDSDB%2FSAMDB&product=Samba%204.1%20and%20newer&bug_status=__open__)) | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | 4.14.5 | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All All | |  | | | [Importance](page.cgi?id=fields.html#importance): | P5 normal ([vote](page.cgi?id=voting/user.html&bug_id=14725#vote_14725)) | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Samba QA Contact | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") | Samba QA Contact | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [CVE-2020-25721](show_bug.cgi?id=14557 "ASSIGNED - CVE-2020-25721 [SECURITY] KDC canonicalisation and mapping rules: challenges and hardening") [CVE-2020-25717](show_bug.cgi?id=14556 "RESOLVED FIXED - CVE-2020-25717 [SECURITY] A user on the domain can become root on domain members") [CVE-2020-25718](show_bug.cgi?id=14558 "RESOLVED FIXED - CVE-2020-25718 [SECURITY] An RODC can issue (forge) administrator tickets to other servers") [CVE-2020-25719](show_bug.cgi?id=14561 "RESOLVED FIXED - CVE-2020-25719 [SECURITY] AD DC Username based races when no PAC is given") [14563](show_bug.cgi?id=14563 "RESOLVED WONTFIX") [CVE-2020-25722](show_bug.cgi?id=14564 "RESOLVED FIXED - CVE-2020-25722 [SECURITY] AD DC UPN vs samAccountName not checked (top-level bug for AD DC validation issues)") [14724](show_bug.cgi?id=14724 "RESOLVED DUPLICATE") | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [14834](show_bug.cgi?id=14834 "RESOLVED FIXED - [SECURITY] Andrew's Kerberos Concerns and other issues (Nov 9 2021 Release bug)") | |  | Show dependency [tree](showdependencytree.cgi?id=14725&hide_resolved=1) / [graph](showdependencygraph.cgi?id=14725) | |  | | Reported: | 2021-06-02 20:01 UTC by Andrew Bartlett | | --- | --- | | Modified: | 2022-07-20 07:59 UTC ([History](show_activity.cgi?id=14725)) | | CC List: | 6 users (show)  abartlet asn jonessyue jsutton metze requate | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") | * [14781](show_bug.cgi?id=14781 "NEW") * [14899](show_bug.cgi?id=14899 "RESOLVED FIXED - winbindd doesn't start when \"allow trusted domains\" is off") | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | | --- | --- | --- | | [**Combined patchset for master v12 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722)**](attachment.cgi?id=16930 "View the content of the attachment") (1.09 MB, patch)  [2021-11-03 15:58 UTC](#attach_16930 "Go to the comment associated with the attachment"), Stefan Metzmacher | jsutton: review+  metze: ci-passed+ | [Details](attachment.cgi?id=16930&action=edit) | | [**Combined patchset for 4.15 v12 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722)**](attachment.cgi?id=16931 "View the content of the attachment") (1.15 MB, patch)  [2021-11-03 16:00 UTC](#attach_16931 "Go to the comment associated with the attachment"), Stefan Metzmacher | jsutton: review+  metze: ci-passed+ | [Details](attachment.cgi?id=16931&action=edit) | | [**Combined patchset for 4.14 v12 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722)**](attachment.cgi?id=16932 "View the content of the attachment") (1.24 MB, patch)  [2021-11-03 16:01 UTC](#attach_16932 "Go to the comment associated with the attachment"), Stefan Metzmacher | jsutton: review+  metze: ci-passed+ | [Details](attachment.cgi?id=16932&action=edit) | | [**Combined patchset for 4.13 v12 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722)**](attachment.cgi?id=16933 "View the content of the attachment") (1.39 MB, patch)  [2021-11-03 16:02 UTC](#attach_16933 "Go to the comment associated with the attachment"), Stefan Metzmacher | jsutton: review+  metze: ci-passed+ | [Details](attachment.cgi?id=16933&action=edit) | | [**Patch to fix use-after-free regression on top of the combined v12 patchsets (all versions)**](attachment.cgi?id=16943 "View the content of the attachment") (1.86 KB, patch)  [2021-11-04 04:12 UTC](#attach_16943 "Go to the comment associated with the attachment"), Jennifer Sutton | metze: review+  metze: ci-passed+ | [Details](attachment.cgi?id=16943&action=edit) | | [**Combined patchset for master v13 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722)**](attachment.cgi?id=16944 "View the content of the attachment") (1.09 MB, patch)  [2021-11-04 07:35 UTC](#attach_16944 "Go to the comment associated with the attachment"), Jennifer Sutton | metze: review+  metze: ci-passed+ | [Details](attachment.cgi?id=16944&action=edit) | | [**Combined patchset for 4.15 v13 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722)**](attachment.cgi?id=16945 "View the content of the attachment") (1.15 MB, patch)  [2021-11-04 07:36 UTC](#attach_16945 "Go to the comment associated with the attachment"), Jennifer Sutton | metze: review+  metze: ci-passed+ | [Details](attachment.cgi?id=16945&action=edit) | | [**Combined patchset for 4.14 v13 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722)**](attachment.cgi?id=16946 "View the content of the attachment") (1.23 MB, patch)  [2021-11-04 07:37 UTC](#attach_16946 "Go to the comment associated with the attachment"), Jennifer Sutton | metze: review+  metze: ci-passed+ | [Details](attachment.cgi?id=16946&action=edit) | | [**Combined patchset for 4.13 v13 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722)**](attachment.cgi?id=16947 "View the content of the attachment") (1.39 MB, patch)  [2021-11-04 07:39 UTC](#attach_16947 "Go to the comment associated with the attachment"), Jennifer Sutton | metze: review+  metze: ci-passed+ | [Details](attachment.cgi?id=16947&action=edit) | | [**Combined patchset for 4.12 v13 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722) (fileserver tests DISABLED)**](attachment.cgi?id=16949 "View the content of the attachment") (4.89 MB, patch)  [2021-11-04 08:29 UTC](#attach_16949 "Go to the comment associated with the attachment"), Jennifer Sutton | abartlet: review+  metze: ci-passed+ | [Details](attachment.cgi?id=16949&action=edit) | | [**CVE-2020-25721 advisory (mirror of v2)**](attachment.cgi?id=16950 "View the content of the attachment") (4.20 KB, text/plain)  [2021-11-04 09:46 UTC](#attach_16950 "Go to the comment associated with the attachment"), Andrew Bartlett | metze: review+ | [Details](attachment.cgi?id=16950&action=edit) | | [**Combined patchset for 4.10 v13 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722)**](attachment.cgi?id=16973 "View the content of the attachment") (4.99 MB, patch)  [2021-11-09 04:04 UTC](#attach_16973 "Go to the comment associated with the attachment"), Jennifer Sutton | abartlet: review+ | [Details](attachment.cgi?id=16973&action=edit) | | [**Fix regression in "allow trusted domains = false" v4.13**](attachment.cgi?id=16982 "View the content of the attachment") (1.17 KB, application/mbox)  [2021-11-09 19:01 UTC](#attach_16982 "Go to the comment associated with the attachment"), Andrew Walker | *no flags* | [Details](attachment.cgi?id=16982&action=edit) | | [**Fix regression in "allow trusted domains = false" v4.13**](attachment.cgi?id=16983 "View the content of the attachment") (1.17 KB, application/mbox)  [2021-11-09 19:01 UTC](#attach_16983 "Go to the comment associated with the attachment"), Andrew Walker | *no flags* | [Details](attachment.cgi?id=16983&action=edit) | | [**Combined patchset for 4.12 v13 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722) (fileserver tests DISABLED), NO GIT RENAME**](attachment.cgi?id=17431 "View the content of the attachment") (4.91 MB, patch)  [2022-07-19 23:34 UTC](#attach_17431 "Go to the comment associated with the attachment"), Andrew Bartlett | *no flags* | [Details](attachment.cgi?id=17431&action=edit) | | [**Combined patchset for 4.10 v13 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722), NO GIT RENAME**](attachment.cgi?id=17432 "View the content of the attachment") (5.00 MB, patch)  [2022-07-20 07:59 UTC](#attach_17432 "Go to the comment associated with the attachment"), Jennifer Sutton | *no flags* | [Details](attachment.cgi?id=17432&action=edit) | | [Show Obsolete](#a0) (5) [View All](attachment.cgi?bugid=14725&action=viewall&hide_obsolete=1)  [Add an attachment](attachment.cgi?bugid=14725&action=enter) (proposed patch, testcase, etc.) | | |   | Note You need to [log in](show_bug.cgi?id=14725&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=14725#c0)  Andrew Bartlett    2021-06-02 20:01:18 UTC   [Comment 1](show_bug.cgi?id=14725#c1)  Andreas Schneider    2021-08-09 15:56:41 UTC  ``` Created [attachment 16724](attachment.cgi?id=16724) [[details]](attachment.cgi?id=16724&action=edit) wip-mit-kdb-fixes.patch  Attaching WIP patchset here. It probably covers several issues already. ```  [Comment 3](show_bug.cgi?id=14725#c3)  Andrew Bartlett    2021-08-10 07:53:03 UTC  ``` Current proposed release date is Tuesday October 12, 2021 ```  [Comment 4](show_bug.cgi?id=14725#c4)  Andrew Bartlett    2021-08-17 02:31:05 UTC  ``` (In reply to Andreas Schneider from [comment #1](show_bug.cgi?id=14725#c1)) Once we have the PAC validation to fix the bronze-bit issues, I'm pretty sure this will fix [bug 14686](show_bug.cgi?id=14686 "RESOLVED FIXED - [SECURITY] A helpdesk user able to create a machine account could take over the domain").  Thanks!  Tests to prove this are under development, but this is the core of the fix, once the PAC is checked in all the important codepaths. ```  [Comment 9](show_bug.cgi?id=14725#c9)  Andrew Bartlett    2021-10-21 09:07:50 UTC  ``` I hope to start creating a single branch of the master patches, at least for the AD DC soon, but currently only have some random-ish starting points.  Joseph rightly suggests starting with the tests for the KDC behaviour, so I'll probably pick his jsutton24/master-tests branch and then put the security-priv_attrs branch on that, as both of those are close to ready.  I'm currently working to sort out my abartlet/tripple-lock branch and plan to land that next.  The idea is to check that each layer passes CI before adding another, and hopefully avoid going back over the branches multiple times. ```  [Comment 10](show_bug.cgi?id=14725#c10)  Andrew Bartlett    2021-10-22 20:35:18 UTC  ``` My rough plan of action is to land:   - jsutton24/master-tests (once test_krb5_smb is fixed and set to run on more targets)  - security-CVE-2020-2571-member-require-pac-ok  - abartlet/triple-lock-2 (perhaps adding one more test for $ termination).    It is possible I can find a way to make two more tests currently knownfailed in knownfail.d/uac_objectclass_restrict work, but I think we have this better covered in newer tests that make more sense.   - nivanova/create-child-wip once ready  - douglas-SECURITY-upn-spn-on-triple-lock once ready  - the KDC side changes (cherry-pick back out of other branches)  - dsdb structural objectclass swapping test and fix (test still to be developed)  - then evaluate any remaining patches found by rebasing the latest auth_signd branch onto this set. ```  [Comment 11](show_bug.cgi?id=14725#c11)  Andrew Bartlett    2021-10-23 09:16:28 UTC  ``` (In reply to Andrew Bartlett from [comment #10](show_bug.cgi?id=14725#c10)) In a WIP branch:  abartlet/2021-11-master-release-wip-no-pac I have landed  SECURITY-priv_attrs  security-CVE-2021-23192-dcerpc-middle-fraq-ok  (the require-krb5 really meant it patches)  abartlet/tripple-lock  jsutton24/master-tests  security-CVE-2020-2571-member-require-pac-ok  I need to fix up and get sign-off of the test for no_pac behaviour, so we can have a proper test/knownfail fix/remove-knownfail.  Checking for this showed that changing the error code broke the test.   TODO next:  - nivanova/create-child-wip (needs restructure to be on top of this branch and test/knownfail before change)  - we need to select back out the KDC side fixes from jsutton24/auth_signd18 and apply those.   - douglas-SECURITY-upn-spn-on-triple-lock (once fixed) ```  [Comment 12](show_bug.cgi?id=14725#c12)  Andrew Bartlett    2021-10-27 03:38:53 UTC  ``` The patches I think are currently ready-ish are in    abartlet/2021-11-master-release-wip-no-pac-3  We currently have a full pass on CI minus some knownfail issues that Joseph is working on.  This includes the fileserver no-PAC changes, AD DC priv_attrs, tripple-lock and tests for the KDC issues. ```  [Comment 13](show_bug.cgi?id=14725#c13)  Andreas Schneider    2021-10-27 09:39:52 UTC  ``` I think asn-bronze-bit-ok is missing ```  [Comment 16](show_bug.cgi?id=14725#c16)  Andrew Bartlett    2021-10-28 18:41:17 UTC  ``` We will ship with the PAC being mandatory everywhere, including in the KDC, with some release notes.  This is the choice to be consistent at the expense of possible upgrade pain for a very small number of users.  Updated security-CVE-2021-23192-dcerpc-middle-fraq-ok and security-2021-11-master-release-wip-no-pac-metze branches need to be incorporated from metze.  Douglas has the UPN/SPN and ACL changes in douglas-SECURITY-upn-spn-on-triple-lock.  I'm unclear on the status of asn-bronze-bit and where this fits in with regard to the existing patches in jsutton24/abartlet/2021-11-master-release-wip-no-pac-4-kdc-fixes which is the current attempt at branch consolidation. ```  [Comment 17](show_bug.cgi?id=14725#c17)  Andreas Schneider    2021-10-29 06:24:11 UTC  ``` asn-bronze-bit is work in progress and I'm not sure if this will be ready till November 9th. This relies on MIT KRB5 features which are not in a released version. ```  [Comment 18](show_bug.cgi?id=14725#c18)  Andrew Bartlett    2021-10-29 06:32:31 UTC  ``` Thanks.  That means one less branch to integrate, sorry you won't make it, the deadline is essentially now, I'm starting backports and already triaging patches out that can't easily be backported.   Sorry your changes didn't make it. ```  [Comment 19](show_bug.cgi?id=14725#c19)  Andrew Bartlett    2021-10-29 17:54:21 UTC  ``` TODO on this patch-set:  - Joseph has kindly written some more tests for the 'triple lock' of $ / uac / objectclass for modify  - Metze has pointed out a knownfail to be fixed  - I need to fix access checks and extend the testsuite on servicePrincipalName (the falls for the multiple modify elements attack).  - fix selftest failures in 4.14 / 4.13 backports ```  [Comment 20](show_bug.cgi?id=14725#c20)  Andrew Bartlett    2021-10-29 17:55:18 UTC  ``` Also TODO:  - patch squashing  - mark all patches with correct BUG and CVE ```  [Comment 21](show_bug.cgi?id=14725#c21)  Andrew Bartlett    2021-11-03 01:41:54 UTC  ``` Opening this bug up to vendors now.  This is the top level bug for "Andrew's Kerberos Concerns". ```  [Comment 23](show_bug.cgi?id=14725#c23)  Stefan Metzmacher    2021-11-03 15:58:33 UTC  ``` Created [attachment 16930](attachment.cgi?id=16930 "Combined patchset for master v12 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722)") [[details]](attachment.cgi?id=16930&action=edit "Combined patchset for master v12 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722)") Combined patchset for master v12 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722) ```  [Comment 24](show_bug.cgi?id=14725#c24)  Stefan Metzmacher    2021-11-03 16:00:27 UTC  ``` Created [attachment 16931](attachment.cgi?id=16931 "Combined patchset for 4.15 v12 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722)") [[details]](attachment.cgi?id=16931&action=edit "Combined patchset for 4.15 v12 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722)") Combined patchset for 4.15 v12 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722) ```  [Comment 25](show_bug.cgi?id=14725#c25)  Stefan Metzmacher    2021-11-03 16:01:38 UTC  ``` Created [attachment 16932](attachment.cgi?id=16932 "Combined patchset for 4.14 v12 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722)") [[details]](attachment.cgi?id=16932&action=edit "Combined patchset for 4.14 v12 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722)") Combined patchset for 4.14 v12 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722) ```  [Comment 26](show_bug.cgi?id=14725#c26)  Stefan Metzmacher    2021-11-03 16:02:30 UTC  ``` Created [attachment 16933](attachment.cgi?id=16933 "Combined patchset for 4.13 v12 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722)") [[details]](attachment.cgi?id=16933&action=edit "Combined patchset for 4.13 v12 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722)") Combined patchset for 4.13 v12 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722) ```  [Comment 27](show_bug.cgi?id=14725#c27)  Jennifer Sutton    2021-11-03 21:39:36 UTC  ``` Comment on [attachment 16930](attachment.cgi?id=16930 "Combined patchset for master v12 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722)") [[details]](attachment.cgi?id=16930&action=edit "Combined patchset for master v12 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722)") Combined patchset for master v12 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722)  Confirmed patch contents match contents of working branch. ```  [Comment 28](show_bug.cgi?id=14725#c28)  Jennifer Sutton    2021-11-04 04:12:57 UTC  ``` Created [attachment 16943](attachment.cgi?id=16943 "Patch to fix use-after-free regression on top of the combined v12 patchsets (all versions)") [[details]](attachment.cgi?id=16943&action=edit "Patch to fix use-after-free regression on top of the combined v12 patchsets (all versions)") Patch to fix use-after-free regression on top of the combined v12 patchsets (all versions)  Adding a patch to fix a use-after-free regression introduced in the combined patchset. ```  [Comment 35](show_bug.cgi?id=14725#c35)  Andrew Bartlett    2021-11-04 09:46:23 UTC  ``` Created [attachment 16950](attachment.cgi?id=16950 "CVE-2020-25721 advisory (mirror of v2)") [[details]](attachment.cgi?id=16950&action=edit "CVE-2020-25721 advisory (mirror of v2)") CVE-2020-25721 advisory (mirror of v2)  CVE-2020-25721 is a hardening in Samba to allow other software to potentially avoid the impacts of the same kind of issues seen here.    I've not opened up that bug for access yet so I've put a copy up here, as I've been (rightly) asked about it. ```  [Comment 36](show_bug.cgi?id=14725#c36)  Stefan Metzmacher    2021-11-04 16:00:15 UTC  ``` Comment on [attachment 16943](attachment.cgi?id=16943 "Patch to fix use-after-free regression on top of the combined v12 patchsets (all versions)") [[details]](attachment.cgi?id=16943&action=edit "Patch to fix use-after-free regression on top of the combined v12 patchsets (all versions)") Patch to fix use-after-free regression on top of the combined v12 patchsets (all versions)  If you already build patches with the v12 patchsets, just have this fix on top.  Otherwise use the v13 patchsets directly, they have it included. ```  [Comment 37](show_bug.cgi?id=14725#c37)  Denis Cardon    2021-11-05 08:08:46 UTC  ``` CVE-2020-25721 advisory mention the following line : "Additionally, Samba 4.15.2, 4.14.10 and 4.13.14 have been issued as security releases to correct the defect"  It does not mention 4.12, while the patchset for that version has been attached to this bugzilla entry. Is it planned to have also a 4.12.16? ```  [Comment 38](show_bug.cgi?id=14725#c38)  Jennifer Sutton    2021-11-05 10:11:16 UTC  ``` (In reply to Denis Cardon from [comment #37](show_bug.cgi?id=14725#c37)) As I understand it, the v4.12 patches have not been fully tested (specifically, the fileserver tests were disabled in order to pass CI). So a 4.12 release is not planned, but the patches are being provided 'as is' in case they are useful. ```  [Comment 39](show_bug.cgi?id=14725#c39)  Andrew Bartlett    2021-11-05 18:36:46 UTC  ``` (In reply to Joseph Sutton from [comment #38](show_bug.cgi?id=14725#c38)) In the spirit of open source the Samba Team strongly encourages vendors to upload backports made to earlier releases, on an as-is basis, knowing that others may be assisted by that collaboration.  That is the case with the 4.12 work, here done by Catalyst.  The Samba Team is only releasing patches for the supported versions per: <https://wiki.samba.org/index.php/Samba_Release_Planning>  (It was of course a very reasonable question, as we on the Samba Team have bent those rules a little with extra releases, even just recently).  As Joseph notes, as Catalyst's interest in Samba 4.12 is only in the AD DC, the fileserver tests have been disabled.  (The selftest tooling needs further work in the perl code to make that pass). ```  [Comment 40](show_bug.cgi?id=14725#c40)  Stefan Metzmacher    2021-11-08 21:59:45 UTC  ``` The release will happen around 18:00 UTC November 9th. ```  [Comment 41](show_bug.cgi?id=14725#c41)  Jennifer Sutton    2021-11-09 04:04:33 UTC  ``` Created [attachment 16973](attachment.cgi?id=16973 "Combined patchset for 4.10 v13 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722)") [[details]](attachment.cgi?id=16973&action=edit "Combined patchset for 4.10 v13 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722)") Combined patchset for 4.10 v13 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722) ```  [Comment 42](show_bug.cgi?id=14725#c42)  Andrew Bartlett    2021-11-09 10:33:05 UTC  ``` Comment on [attachment 16949](attachment.cgi?id=16949 "Combined patchset for 4.12 v13 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722) (fileserver tests DISABLED)") [[details]](attachment.cgi?id=16949&action=edit "Combined patchset for 4.12 v13 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722) (fileserver tests DISABLED)") Combined patchset for 4.12 v13 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722) (fileserver tests DISABLED)  I'm giving this a positive review based on: * A match of the vast bulk of the 'actual' patch with the reviewed 4.13 patch * the inter-diff shows the disabling of the fileserver tests and some ldb backports that were required * running <https://bugzilla.samba.org/attachment.cgi?id=16881> on [bug 14881](show_bug.cgi?id=14881 "RESOLVED FIXED - Backport bronze bit fixes, tests, and selftest improvements") to produce the patch base and then applying only the 'rest' * comparing the diff of that new tree with a tree reconstructed from this patch  It would still be good to have that script audited, but auditing the result (multi-MB of backported patches) is impractical.  This is why those patches were publicly merged into 4.13 over a number of releases recently. ```  [Comment 43](show_bug.cgi?id=14725#c43)  Andrew Bartlett    2021-11-09 10:57:08 UTC  ``` Comment on [attachment 16973](attachment.cgi?id=16973 "Combined patchset for 4.10 v13 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722)") [[details]](attachment.cgi?id=16973&action=edit "Combined patchset for 4.10 v13 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722)") Combined patchset for 4.10 v13 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722)  This backport is an epic work.  My review is based on the diff of the patch compared with the 4.12 patch (so under the same challenge that the backport script of cherry-picks on [bug 14881](show_bug.cgi?id=14881 "RESOLVED FIXED - Backport bronze bit fixes, tests, and selftest improvements") should be checked).  I've also checked each patch Jospeh marked as having modified, plus the into and trailing patches that fix issues found.  My only comment is that in hindsight I think the fixups to use ad_dc_ntvfs in the knownfails could have been avoided now that the ad_dc_ntvfs alias is added  Well done!  Bringing a patch set back all the way to 4.10 with full tests is incredibly awesome.  We are just fortunate that Samba 4.10 allows Python3.  NOTE WELL: This set changes the testing platform to Ubuntu 18.04 compared with the 16.04 reference Samba 4.10 shipped with, as a more modern Python is required for f-strings in tests.  Effort has been taken to allow a build only with Python 2.7. ```  [Comment 44](show_bug.cgi?id=14725#c44)  Andrew Walker    2021-11-09 19:01:22 UTC  ``` Created [attachment 16982](attachment.cgi?id=16982 "Fix regression in \"allow trusted domains = false\" v4.13") [[details]](attachment.cgi?id=16982&action=edit "Fix regression in \"allow trusted domains = false\" v4.13") Fix regression in "allow trusted domains = false" v4.13  We discovered issue preventing winbindd from starting when "allow trusted domains = false". Attached patch is for v4.13. ```  [Comment 45](show_bug.cgi?id=14725#c45)  Andrew Walker    2021-11-09 19:01:30 UTC  ``` Created [attachment 16983](attachment.cgi?id=16983 "Fix regression in \"allow trusted domains = false\" v4.13") [[details]](attachment.cgi?id=16983&action=edit "Fix regression in \"allow trusted domains = false\" v4.13") Fix regression in "allow trusted domains = false" v4.13  We discovered issue preventing winbindd from starting when "allow trusted domains = false". Attached patch is for v4.13. ```  [Comment 46](show_bug.cgi?id=14725#c46)  Andrew Bartlett    2021-11-09 19:03:20 UTC  ``` The releases are made, removing [EMBARGOED] tag.  The vendor-only restriction will be removed soon once the dust settles. ```  [Comment 47](show_bug.cgi?id=14725#c47)  Stefan Metzmacher    2021-11-09 20:43:25 UTC  ``` (In reply to Andrew Walker from [comment #45](show_bug.cgi?id=14725#c45))  I have a more generic fix for the "allow trusted domains = no" regression, the pipeline is running here: <https://gitlab.com/samba-team/samba/-/merge_requests/2246>  Andrew, can you please test this? ```  [Comment 48](show_bug.cgi?id=14725#c48)  Andrew Bartlett    2021-11-09 20:54:44 UTC  ``` The patches addressing this issue have been pushed to master and security releases made. ```  [Comment 49](show_bug.cgi?id=14725#c49)  Andrew Walker    2021-11-09 20:55:55 UTC  ``` (In reply to Stefan Metzmacher from [comment #47](show_bug.cgi?id=14725#c47))  Yes, that resolves the issue with "allow trusted domains = false". ```  [Comment 50](show_bug.cgi?id=14725#c50)  Andrew Bartlett    2021-11-11 01:24:52 UTC  ``` The regression for "allowed trusted domains = false" case is in the 4.12 patches (by backport) but not the 4.10 patches. ```  [Comment 51](show_bug.cgi?id=14725#c51)  Andrew Bartlett    2021-11-11 01:30:26 UTC  ``` Sorry, wrong see-also link ```  [Comment 52](show_bug.cgi?id=14725#c52)  Andrew Bartlett    2021-11-11 21:02:50 UTC  ``` Removing vendor restriction and all-vendor CC (to avoid spamming all vendors now this is public.  If you are a vendor and wish to be notified about further updates please CC individually. ```  [Comment 53](show_bug.cgi?id=14725#c53)  Andrew Bartlett    2021-11-22 03:41:39 UTC  ``` A note on backporting this issue to earlier versions.  I warned that this would be difficult, and I think the size of [attachment 16973](attachment.cgi?id=16973 "Combined patchset for 4.10 v13 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722)") [[details]](attachment.cgi?id=16973&action=edit "Combined patchset for 4.10 v13 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722)") proves my point well.  However it has been possible as far back as 4.10 while fully tested, thanks to that being the first release we made with python3 fully supported.    Even so, the tests required changing the minimum python3 version up to Python 3.6 as the backported tests start to require the f-string feature.  Backporting earlier may be possible for the careful, but would mean doing the tests manually (in the same way we can run those against a remote windows server).   See my comments on [bug 14561](show_bug.cgi?id=14561 "RESOLVED FIXED - CVE-2020-25719 [SECURITY] AD DC Username based races when no PAC is given") and 15464 about the highest priority patches if upgrading to a supported or supportable release is impossible. ```  [Comment 54](show_bug.cgi?id=14725#c54)  Andrew Bartlett    2021-11-22 03:42:11 UTC  ``` (In reply to Andrew Bartlett from [comment #53](show_bug.cgi?id=14725#c53)) that is (to make it link) [bug 14564](show_bug.cgi?id=14564 "RESOLVED FIXED - CVE-2020-25722 [SECURITY] AD DC UPN vs samAccountName not checked (top-level bug for AD DC validation issues)") ```  [Comment 55](show_bug.cgi?id=14725#c55)  Andrew Bartlett    2022-07-19 23:34:24 UTC  ``` Created [attachment 17431](attachment.cgi?id=17431 "Combined patchset for 4.12 v13 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722) (fileserver tests DISABLED), NO GIT RENAME") [[details]](attachment.cgi?id=17431&action=edit "Combined patchset for 4.12 v13 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722) (fileserver tests DISABLED), NO GIT RENAME") Combined patchset for 4.12 v13 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722) (fileserver tests DISABLED), NO GIT RENAME  This is a re-spin of version 13 of the 4.12 patch for older OS versions that object to git's rename style in patches. ```  [Comment 56](show_bug.cgi?id=14725#c56)  Jennifer Sutton    2022-07-20 07:59:52 UTC  ``` Created [attachment 17432](attachment.cgi?id=17432 "Combined patchset for 4.10 v13 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722), NO GIT RENAME") [[details]](attachment.cgi?id=17432&action=edit "Combined patchset for 4.10 v13 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722), NO GIT RENAME") Combined patchset for 4.10 v13 (CVE-2020-25717 CVE-2020-25721 CVE-2020-25718 CVE-2020-25719 CVE-2020-25722), NO GIT RENAME  This is the same (standard diff format without renames) for the 4.10 patch. ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=14725)
* - [XML](show_bug.cgi?ctype=xml&id=14725)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=14725)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=14725&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=14725&GoAheadAndLogIn=1#forgot)
    Login:

    [x]



=== Content from www.samba.org_c82a4c51_20250119_110549.html ===

## CVE-2020-25721.html:

```

=============================================================
== Subject:     Kerberos acceptors need easy access to stable
==              AD identifiers (eg objectSid)
==
== CVE ID#:     CVE-2020-25721
==
== Versions:    All versions of Samba since Samba 4.0.0
==
== Summary:     Samba as an AD DC now provides a way for Linux
==              applications to obtain a reliable SID (and
==              samAccountName) in issued tickets.
=============================================================

===========
Description
===========

In order to avoid issues like CVE-2020-25717 AD Kerberos accepting
services need access to unique, and ideally long-term stable
identifiers of a user to perform authorization.

The AD PAC provides this, but the most useful information is kept in a
buffer which is NDR encoded, which means that so far in Free Software
only Samba and applications which use Samba components under the hood
like FreeIPA and SSSD decode PAC.

Recognising that the issues seen in Samba are not unique, Samba now
provides an extension to UPN_DNS_INFO, a component of the AD PAC, in a
way that can be parsed using basic pointer handling.

From this, future non-Samba based Kerberised applications can easily obtain
the user's SID, in the same packing as objectSID in LDAP, confident
that the ticket represents a specific user, not matter subsequent
renames.

This will allow such non-Samba applications to avoid confusing one
Kerberos user for another, even if they have the same string name (due
to the gap between time of ticket printing by the KDC and time of
ticket acceptance).

The protocol deployment weakness, as demonstrated with the
CVE-2020-25717 in Samba when deployed in Active Directory, leaves most
Linux and UNIX applications only to rely on the "client name" from the
Kerberos ticket. When the "client name" as seen by the KDC is under an
attacker control across multiple Kerberos requests, such applications
need an additional information to correlate the client name across
those requests.

Directories where only full administrators can create users are not
the concern, the concern is where that user/computer creation right is
delegated in some way, explicitly or via ms-DS-MachineAccountQuota.

==================
Patch Availability
==================

Patches addressing both these issues have been posted to:

    https://www.samba.org/samba/security/

Additionally, Samba 4.15.2, 4.14.10 and 4.13.14 have been issued
as security releases to correct the defect.  Samba administrators are
advised to upgrade to these releases or apply the patch as soon
as possible.

A patch has been written for Heimdal Kerberos to use this feature, and
will be published for possible inclusion shortly after Samba's
security relase.

==================
CVSSv3 calculation
==================

The impact of doing authorization with the string Kerberos cname name
varies by accepting application.

==========
Workaround
==========

It would be prudent to pre-create disabled users in Active Directory
matching on all privileged names not held in Active Directory, eg

 samba-tool user add root -H ldap://$SERVER -U$USERNAME%$PASSWORD --random-password
 samba-tool user add ubuntu -H ldap://$SERVER -U$USERNAME%$PASSWORD --random-password
 ...
 (repeat for eg all system users under 1000 in /etc/passwd or special
 to any other AD-connected services, eg perhaps "admin" for a web-app)

If running a Microsoft Windows Active Directory, Setting
ms-DS-MachineAccountQuota to 0, in the Active Directory domain would
be advised, if possible.

===========================
Credits and further reading
===========================

Originally reported by Andrew Bartlett.

Patches provided by Andrew Bartlett and Joseph Sutton of Catalyst and
the Samba team.

Andrew wishes to give much thanks to NetSPI for the blog
"MachineAccountQuota is USEFUL Sometimes: Exploiting One of Active
Directory's Oddest Settings" by Kevin Robertson[1], on which the full
horror of MachineAccountQuota became clear.

[1] https://www.netspi.com/blog/technical/network-penetration-testing/machineaccountquota-is-useful-sometimes/

==========================================================
== Our Code, Our Bugs, Our Responsibility.
== The Samba Team
==========================================================

```



=== Content from access.redhat.com_3be256da_20250119_130418.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)


