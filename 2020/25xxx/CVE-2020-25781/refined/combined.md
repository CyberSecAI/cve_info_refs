=== Content from github.com_b8326d6c_20250119_122527.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmantisbt%2Fmantisbt%2Fcommit%2F5595c90f11c48164331a20bb9c66098980516e93)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmantisbt%2Fmantisbt%2Fcommit%2F5595c90f11c48164331a20bb9c66098980516e93)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=mantisbt%2Fmantisbt)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[mantisbt](/mantisbt)
/
**[mantisbt](/mantisbt/mantisbt)**
Public

* [Notifications](/login?return_to=%2Fmantisbt%2Fmantisbt) You must be signed in to change notification settings
* [Fork
  728](/login?return_to=%2Fmantisbt%2Fmantisbt)
* [Star
   1.7k](/login?return_to=%2Fmantisbt%2Fmantisbt)

* [Code](/mantisbt/mantisbt)
* [Pull requests
  77](/mantisbt/mantisbt/pulls)
* [Actions](/mantisbt/mantisbt/actions)
* [Security](/mantisbt/mantisbt/security)
* [Insights](/mantisbt/mantisbt/pulse)

Additional navigation options

* [Code](/mantisbt/mantisbt)
* [Pull requests](/mantisbt/mantisbt/pulls)
* [Actions](/mantisbt/mantisbt/actions)
* [Security](/mantisbt/mantisbt/security)
* [Insights](/mantisbt/mantisbt/pulse)

## Commit

[Permalink](/mantisbt/mantisbt/commit/5595c90f11c48164331a20bb9c66098980516e93)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Functions to check view/download ability at bugnote level

[Browse files](/mantisbt/mantisbt/tree/5595c90f11c48164331a20bb9c66098980516e93)
Browse the repository at this point in the history

```
2 new File API functions:
- file_can_view_bugnote_attachments()
- file_can_download_bugnote_attachments

Prerequisite to fix issue #27039
```

* Loading branch information

[![@dregad](https://avatars.githubusercontent.com/u/449891?s=40&v=4)](/dregad)

[dregad](/mantisbt/mantisbt/commits?author=dregad "View all commits by dregad")
committed
Sep 23, 2020

1 parent
[90b8395](/mantisbt/mantisbt/commit/90b839561bbe480814aae63d8e25071ffc6d4ea2)

commit 5595c90

Showing
**1 changed file**
with
**39 additions**
and
**2 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

41 changes: 39 additions & 2 deletions

41
[core/file\_api.php](#diff-b4e556dbc514db85735ab597a219c292c6520543335496b5c3fb9d3a5b2400a0 "core/file_api.php")

Show comments

[View file](/mantisbt/mantisbt/blob/5595c90f11c48164331a20bb9c66098980516e93/core/file_api.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -218,12 +218,13 @@ function file\_bug\_has\_attachments( $p\_bug\_id ) { |
|  |  | \* @param string $p\_action 'view' or 'download' |
|  |  | \* @param int $p\_bug\_id A bug identifier |
|  |  | \* @param int $p\_uploader\_user\_id The user who uploaded the attachment |
|  |  | \* @param int|null $p\_bugnote\_id If specified, will check at bugnote level |
|  |  | \* |
|  |  | \* @return bool |
|  |  | \* |
|  |  | \* @internal Should not be used outside of File API. |
|  |  | \*/ |
|  |  | function file\_can\_view\_or\_download( $p\_action, $p\_bug\_id, $p\_uploader\_user\_id ) { |
|  |  | function file\_can\_view\_or\_download( $p\_action, $p\_bug\_id, $p\_uploader\_user\_id, $p\_bugnote\_id = null ) { |
|  |  | switch( $p\_action ) { |
|  |  | case 'view': |
|  |  | $t\_threshold\_global = 'view\_attachments\_threshold'; |
| Expand All | | @@ -240,7 +241,11 @@ function file\_can\_view\_or\_download( $p\_action, $p\_bug\_id, $p\_uploader\_user\_id ) |
|  |  | $t\_project\_id = bug\_get\_field( $p\_bug\_id, 'project\_id' ); |
|  |  | $t\_access\_global = config\_get( $t\_threshold\_global,null, null, $t\_project\_id ); |
|  |  |  |
|  |  | $t\_can\_access = access\_has\_bug\_level( $t\_access\_global, $p\_bug\_id ); |
|  |  | if( $p\_bugnote\_id === null ) { |
|  |  | $t\_can\_access = access\_has\_bug\_level( $t\_access\_global, $p\_bug\_id ); |
|  |  | } else { |
|  |  | $t\_can\_access = access\_has\_bugnote\_level( $t\_access\_global, $p\_bugnote\_id ); |
|  |  | } |
|  |  | if( $t\_can\_access ) { |
|  |  | return true; |
|  |  | } |
| Expand All | | @@ -262,6 +267,22 @@ function file\_can\_view\_bug\_attachments( $p\_bug\_id, $p\_uploader\_user\_id = null ) |
|  |  | return file\_can\_view\_or\_download( 'view', $p\_bug\_id, $p\_uploader\_user\_id ); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Check if the current user can view attachments for the specified bug note. |
|  |  | \* |
|  |  | \* @param integer $p\_bugnote\_id A bugnote identifier. |
|  |  | \* @param integer $p\_uploader\_user\_id The user who uploaded the attachment. |
|  |  | \* |
|  |  | \* @return boolean |
|  |  | \*/ |
|  |  | function file\_can\_view\_bugnote\_attachments( $p\_bugnote\_id, $p\_uploader\_user\_id = null ) { |
|  |  | if( $p\_bugnote\_id == 0 ) { |
|  |  | return true; |
|  |  | } |
|  |  | $t\_bug\_id = bugnote\_get\_field( $p\_bugnote\_id, 'bug\_id' ); |
|  |  | return file\_can\_view\_or\_download( 'view', $t\_bug\_id, $p\_uploader\_user\_id ); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Check if the current user can download attachments for the specified bug. |
|  |  | \* |
| Expand All | | @@ -274,6 +295,22 @@ function file\_can\_download\_bug\_attachments( $p\_bug\_id, $p\_uploader\_user\_id = nul |
|  |  | return file\_can\_view\_or\_download( 'download', $p\_bug\_id, $p\_uploader\_user\_id ); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Check if the current user can download attachments for the specified bug note. |
|  |  | \* |
|  |  | \* @param integer $p\_bugnote\_id A bugnote identifier. |
|  |  | \* @param integer $p\_uploader\_user\_id The user who uploaded the attachment. |
|  |  | \* |
|  |  | \* @return boolean |
|  |  | \*/ |
|  |  | function file\_can\_download\_bugnote\_attachments( $p\_bugnote\_id, $p\_uploader\_user\_id = null ) { |
|  |  | if( $p\_bugnote\_id == 0 ) { |
|  |  | return true; |
|  |  | } |
|  |  | $t\_bug\_id = bugnote\_get\_field( $p\_bugnote\_id, 'bug\_id' ); |
|  |  | return file\_can\_view\_or\_download( 'download', $t\_bug\_id, $p\_uploader\_user\_id, $p\_bugnote\_id ); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Check if the current user can delete attachments from the specified bug. |
|  |  | \* @param integer $p\_bug\_id A bug identifier. |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `5595c90`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmantisbt%2Fmantisbt%2Fcommit%2F5595c90f11c48164331a20bb9c66098980516e93) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from mantisbt.org_7b46b536_20250119_140354.html ===

Toggle sidebar [MantisBT](/bugs//) Toggle user menu

* mantisbt

  + - [All Projects](/bugs/set_project.php?project_id=0)
    - [mantisbt](/bugs/set_project.php?project_id=1)
    - [Mylyn Connector](/bugs/set_project.php?project_id=20)
    - [Plugin - agileMantis](/bugs/set_project.php?project_id=25)
    - [Plugin - CsvImport](/bugs/set_project.php?project_id=11)
    - [Plugin - CustomerManagement](/bugs/set_project.php?project_id=21)
    - [Plugin - EmailReporting](/bugs/set_project.php?project_id=10)
    - [Plugin - FilterPageEdit](/bugs/set_project.php?project_id=15)
    - [Plugin - InlineColumnConfiguration](/bugs/set_project.php?project_id=14)
    - [Plugin - LinkedCustomFields](/bugs/set_project.php?project_id=16)
    - [Plugin - MantisTouchRedirect](/bugs/set_project.php?project_id=22)
    - [Plugin - RecurrCall](/bugs/set_project.php?project_id=6)
    - [Plugin - RelatedIssuesExport](/bugs/set_project.php?project_id=13)
    - [Plugin - Reminder](/bugs/set_project.php?project_id=7)
    - [Plugin - Tasks](/bugs/set_project.php?project_id=8)
    - [Plugin - Time Tracking](/bugs/set_project.php?project_id=18)
* anonymous
  + [RSS](https://mantisbt.org/bugs/issues_rss.php)
  + [Logout](/bugs/logout_page.php)

* [My View](/bugs/my_view_page.php)
* [View Issues](/bugs/view_all_bug_page.php)
* [Change Log](/bugs/changelog_page.php)
* [Roadmap](/bugs/roadmap_page.php)
* [Wiki](/bugs/wiki.php?type=project&id=1)
* [Repositories](/bugs/plugin.php?page=Source/index)

* Anonymous
[Login](/bugs/login_page.php?return=%2Fbugs%2Fview_user_page.php%3Fid%3D17784)
[Signup for a new account](/bugs/signup_page.php)

#### User Information

| Username | dregad |
| --- | --- |

**Powered by [MantisBT 2.28.0-dev-master-f0c253853](https://www.mantisbt.org "bug tracking software")**

Copyright © 2000 - 2025 MantisBT Team
Contact administrator for assistance

[![Powered by Mantis Bug Tracker: a free and open source web based bug tracking system.](/bugs/images/mantis_logo.png)](https://www.mantisbt.org "Mantis Bug Tracker: a free and open source web based bug tracking system.")

 Page execution time: 0.1569 seconds



=== Content from github.com_b70183fe_20250119_140352.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmantisbt%2Fmantisbt%2Fcommit%2F5595c90f11c48164331a20bb9c66098980516e93)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmantisbt%2Fmantisbt%2Fcommit%2F5595c90f11c48164331a20bb9c66098980516e93)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=mantisbt%2Fmantisbt)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[mantisbt](/mantisbt)
/
**[mantisbt](/mantisbt/mantisbt)**
Public

* [Notifications](/login?return_to=%2Fmantisbt%2Fmantisbt) You must be signed in to change notification settings
* [Fork
  728](/login?return_to=%2Fmantisbt%2Fmantisbt)
* [Star
   1.7k](/login?return_to=%2Fmantisbt%2Fmantisbt)

* [Code](/mantisbt/mantisbt)
* [Pull requests
  77](/mantisbt/mantisbt/pulls)
* [Actions](/mantisbt/mantisbt/actions)
* [Security](/mantisbt/mantisbt/security)
* [Insights](/mantisbt/mantisbt/pulse)

Additional navigation options

* [Code](/mantisbt/mantisbt)
* [Pull requests](/mantisbt/mantisbt/pulls)
* [Actions](/mantisbt/mantisbt/actions)
* [Security](/mantisbt/mantisbt/security)
* [Insights](/mantisbt/mantisbt/pulse)

## Commit

[Permalink](/mantisbt/mantisbt/commit/5595c90f11c48164331a20bb9c66098980516e93)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Functions to check view/download ability at bugnote level

[Browse files](/mantisbt/mantisbt/tree/5595c90f11c48164331a20bb9c66098980516e93)
Browse the repository at this point in the history

```
2 new File API functions:
- file_can_view_bugnote_attachments()
- file_can_download_bugnote_attachments

Prerequisite to fix issue #27039
```

* Loading branch information

[![@dregad](https://avatars.githubusercontent.com/u/449891?s=40&v=4)](/dregad)

[dregad](/mantisbt/mantisbt/commits?author=dregad "View all commits by dregad")
committed
Sep 23, 2020

1 parent
[90b8395](/mantisbt/mantisbt/commit/90b839561bbe480814aae63d8e25071ffc6d4ea2)

commit 5595c90

Showing
**1 changed file**
with
**39 additions**
and
**2 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

41 changes: 39 additions & 2 deletions

41
[core/file\_api.php](#diff-b4e556dbc514db85735ab597a219c292c6520543335496b5c3fb9d3a5b2400a0 "core/file_api.php")

Show comments

[View file](/mantisbt/mantisbt/blob/5595c90f11c48164331a20bb9c66098980516e93/core/file_api.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -218,12 +218,13 @@ function file\_bug\_has\_attachments( $p\_bug\_id ) { |
|  |  | \* @param string $p\_action 'view' or 'download' |
|  |  | \* @param int $p\_bug\_id A bug identifier |
|  |  | \* @param int $p\_uploader\_user\_id The user who uploaded the attachment |
|  |  | \* @param int|null $p\_bugnote\_id If specified, will check at bugnote level |
|  |  | \* |
|  |  | \* @return bool |
|  |  | \* |
|  |  | \* @internal Should not be used outside of File API. |
|  |  | \*/ |
|  |  | function file\_can\_view\_or\_download( $p\_action, $p\_bug\_id, $p\_uploader\_user\_id ) { |
|  |  | function file\_can\_view\_or\_download( $p\_action, $p\_bug\_id, $p\_uploader\_user\_id, $p\_bugnote\_id = null ) { |
|  |  | switch( $p\_action ) { |
|  |  | case 'view': |
|  |  | $t\_threshold\_global = 'view\_attachments\_threshold'; |
| Expand All | | @@ -240,7 +241,11 @@ function file\_can\_view\_or\_download( $p\_action, $p\_bug\_id, $p\_uploader\_user\_id ) |
|  |  | $t\_project\_id = bug\_get\_field( $p\_bug\_id, 'project\_id' ); |
|  |  | $t\_access\_global = config\_get( $t\_threshold\_global,null, null, $t\_project\_id ); |
|  |  |  |
|  |  | $t\_can\_access = access\_has\_bug\_level( $t\_access\_global, $p\_bug\_id ); |
|  |  | if( $p\_bugnote\_id === null ) { |
|  |  | $t\_can\_access = access\_has\_bug\_level( $t\_access\_global, $p\_bug\_id ); |
|  |  | } else { |
|  |  | $t\_can\_access = access\_has\_bugnote\_level( $t\_access\_global, $p\_bugnote\_id ); |
|  |  | } |
|  |  | if( $t\_can\_access ) { |
|  |  | return true; |
|  |  | } |
| Expand All | | @@ -262,6 +267,22 @@ function file\_can\_view\_bug\_attachments( $p\_bug\_id, $p\_uploader\_user\_id = null ) |
|  |  | return file\_can\_view\_or\_download( 'view', $p\_bug\_id, $p\_uploader\_user\_id ); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Check if the current user can view attachments for the specified bug note. |
|  |  | \* |
|  |  | \* @param integer $p\_bugnote\_id A bugnote identifier. |
|  |  | \* @param integer $p\_uploader\_user\_id The user who uploaded the attachment. |
|  |  | \* |
|  |  | \* @return boolean |
|  |  | \*/ |
|  |  | function file\_can\_view\_bugnote\_attachments( $p\_bugnote\_id, $p\_uploader\_user\_id = null ) { |
|  |  | if( $p\_bugnote\_id == 0 ) { |
|  |  | return true; |
|  |  | } |
|  |  | $t\_bug\_id = bugnote\_get\_field( $p\_bugnote\_id, 'bug\_id' ); |
|  |  | return file\_can\_view\_or\_download( 'view', $t\_bug\_id, $p\_uploader\_user\_id ); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Check if the current user can download attachments for the specified bug. |
|  |  | \* |
| Expand All | | @@ -274,6 +295,22 @@ function file\_can\_download\_bug\_attachments( $p\_bug\_id, $p\_uploader\_user\_id = nul |
|  |  | return file\_can\_view\_or\_download( 'download', $p\_bug\_id, $p\_uploader\_user\_id ); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Check if the current user can download attachments for the specified bug note. |
|  |  | \* |
|  |  | \* @param integer $p\_bugnote\_id A bugnote identifier. |
|  |  | \* @param integer $p\_uploader\_user\_id The user who uploaded the attachment. |
|  |  | \* |
|  |  | \* @return boolean |
|  |  | \*/ |
|  |  | function file\_can\_download\_bugnote\_attachments( $p\_bugnote\_id, $p\_uploader\_user\_id = null ) { |
|  |  | if( $p\_bugnote\_id == 0 ) { |
|  |  | return true; |
|  |  | } |
|  |  | $t\_bug\_id = bugnote\_get\_field( $p\_bugnote\_id, 'bug\_id' ); |
|  |  | return file\_can\_view\_or\_download( 'download', $t\_bug\_id, $p\_uploader\_user\_id, $p\_bugnote\_id ); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Check if the current user can delete attachments from the specified bug. |
|  |  | \* @param integer $p\_bug\_id A bug identifier. |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `5595c90`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmantisbt%2Fmantisbt%2Fcommit%2F5595c90f11c48164331a20bb9c66098980516e93) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from mantisbt.org_4f060283_20250119_122529.html ===

Toggle sidebar [MantisBT](/bugs//) Toggle user menu

* mantisbt

  + - [All Projects](/bugs/set_project.php?project_id=0)
    - [mantisbt](/bugs/set_project.php?project_id=1)
    - [Mylyn Connector](/bugs/set_project.php?project_id=20)
    - [Plugin - agileMantis](/bugs/set_project.php?project_id=25)
    - [Plugin - CsvImport](/bugs/set_project.php?project_id=11)
    - [Plugin - CustomerManagement](/bugs/set_project.php?project_id=21)
    - [Plugin - EmailReporting](/bugs/set_project.php?project_id=10)
    - [Plugin - FilterPageEdit](/bugs/set_project.php?project_id=15)
    - [Plugin - InlineColumnConfiguration](/bugs/set_project.php?project_id=14)
    - [Plugin - LinkedCustomFields](/bugs/set_project.php?project_id=16)
    - [Plugin - MantisTouchRedirect](/bugs/set_project.php?project_id=22)
    - [Plugin - RecurrCall](/bugs/set_project.php?project_id=6)
    - [Plugin - RelatedIssuesExport](/bugs/set_project.php?project_id=13)
    - [Plugin - Reminder](/bugs/set_project.php?project_id=7)
    - [Plugin - Tasks](/bugs/set_project.php?project_id=8)
    - [Plugin - Time Tracking](/bugs/set_project.php?project_id=18)
* anonymous
  + [RSS](https://mantisbt.org/bugs/issues_rss.php)
  + [Logout](/bugs/logout_page.php)

* [My View](/bugs/my_view_page.php)
* [View Issues](/bugs/view_all_bug_page.php)
* [Change Log](/bugs/changelog_page.php)
* [Roadmap](/bugs/roadmap_page.php)
* [Wiki](/bugs/wiki.php?type=project&id=1)
* [Repositories](/bugs/plugin.php?page=Source/index)

* Anonymous
[Login](/bugs/login_page.php?return=%2Fbugs%2Fview.php%3Fid%3D27039)
[Signup for a new account](/bugs/signup_page.php)

#### View Issue Details

[Wiki](wiki.php?id=27039)[Related Changesets](#changesets)[Jump to Notes](#bugnotes)

|  | | | | | |
| --- | --- | --- | --- | --- | --- |
| ID | Project | Category | View Status | Date Submitted | Last Update |
| --- | --- | --- | --- | --- | --- |
| 0027039 | mantisbt | security | public | 2020-06-16 05:08 | 2020-09-25 14:53 |
|  | | | | | |
|
| Reporter | [pijama](https://mantisbt.org/bugs/view_user_page.php?id=49274) | Assigned To | [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784) |  | |
| Priority | normal | Severity | minor | Reproducibility | always |
| Status | closed | Resolution | fixed |  | |
| Product Version | 2.23.0 |  | | | |
| Target Version | 2.24.3 | Fixed in Version | 2.24.3 |  | |
|  | | | | | |
|
| Summary | 0027039: CVE-2020-25781: Access to private bug note attachments | | | | |
| Description | Sorry for my English.  The problem. User that has access to project's issue (VS\_PUBLIC) , but has not access to private bug notes of this project issue, can download private bug note attachments directly (by file download url /file\_download.php?file\_id={FILE\_ID}&type=bug).  The possible solution. Need check access for private bug note attachment. Something similar like in [0026893](/bugs/view.php?id=26893 "[closed] APIs expose private attachments to users who has access to issue but not private notes").  Added patch as solution example (file\_download.php[113-129]). | | | | |
| Steps To Reproduce | Create user1 who has public access to project and can download attachment of public issue/bug note Create user2 who has any access to same project and can create private bug note with attachments. By user1 try download private bug note attachment created by user2 using direct link (/file\_download.php?file\_id={FILE\_ID}&type=bug). User1 can do file id substitution in order to determine available file. | | | | |
| Tags | [patch](tag_view_page.php?tag_id=4) | | | | |
| Attached Files | [file\_download.php](file_download.php?file_id=9118&type=bug) (7,471 bytes)    ``` <?php # MantisBT - A PHP based bugtracking system  # MantisBT is free software: you can redistribute it and/or modify # it under the terms of the GNU General Public License as published by # the Free Software Foundation, either version 2 of the License, or # (at your option) any later version. # # MantisBT is distributed in the hope that it will be useful, # but WITHOUT ANY WARRANTY; without even the implied warranty of # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the # GNU General Public License for more details. # # You should have received a copy of the GNU General Public License # along with MantisBT.  If not, see <http://www.gnu.org/licenses/>.  /**  * Add file and redirect to the referring page  *  * @package MantisBT  * @copyright Copyright 2000 - 2002  Kenzaburo Ito - kenito@300baud.org  * @copyright Copyright 2002  MantisBT Team - mantisbt-dev@lists.sourceforge.net  * @link http://www.mantisbt.org  *  * @uses core.php  * @uses access_api.php  * @uses authentication_api.php  * @uses bug_api.php  * @uses config_api.php  * @uses constant_inc.php  * @uses database_api.php  * @uses file_api.php  * @uses gpc_api.php  * @uses http_api.php  * @uses utility_api.php  */  # Prevent output of HTML in the content if errors occur define( 'DISABLE_INLINE_ERROR_REPORTING', true );  $g_bypass_headers = true; # suppress headers as we will send our own later define( 'COMPRESSION_DISABLED', true );  require_once( 'core.php' ); require_api( 'access_api.php' ); require_api( 'authentication_api.php' ); require_api( 'bug_api.php' ); require_api( 'config_api.php' ); require_api( 'constant_inc.php' ); require_api( 'database_api.php' ); require_api( 'file_api.php' ); require_api( 'gpc_api.php' ); require_api( 'http_api.php' ); require_api( 'utility_api.php' );  auth_ensure_user_authenticated();  $f_show_inline = gpc_get_bool( 'show_inline', false );  # To prevent cross-domain inline hotlinking to attachments we require a CSRF # token from the user to show any attachment inline within the browser. # Without this security in place a malicious user could upload a HTML file # attachment and direct a user to file_download.php?file_id=X&type=bug&show_inline=1 # and the malicious HTML content would be rendered in the user's browser, # violating cross-domain security. if( $f_show_inline ) { 	# Disable errors for form_security_validate as we need to send HTTP 	# headers prior to raising an error (the error handler 	# doesn't check that headers have been sent, it just 	# makes the assumption that they've been sent already). 	if( !@form_security_validate( 'file_show_inline' ) ) { 		http_all_headers(); 		trigger_error( ERROR_FORM_TOKEN_INVALID, ERROR ); 	} }  $f_file_id = gpc_get_int( 'file_id' ); $f_type	= gpc_get_string( 'type' );  $c_file_id = (integer)$f_file_id;  # we handle the case where the file is attached to a bug # or attached to a project as a project doc. $t_query = ''; switch( $f_type ) { 	case 'bug': 		$t_query = 'SELECT * FROM {bug_file} WHERE id=' . db_param(); 		break; 	case 'doc': 		$t_query = 'SELECT * FROM {project_file} WHERE id=' . db_param(); 		break; 	default: 		access_denied(); } $t_result = db_query( $t_query, array( $c_file_id ) ); $t_row = db_fetch_array( $t_result ); if( false === $t_row ) { 	# Attachment not found 	error_parameters( $c_file_id ); 	trigger_error( ERROR_FILE_NOT_FOUND, ERROR ); } extract( $t_row, EXTR_PREFIX_ALL, 'v' );  if( $f_type == 'bug' ) { 	$t_project_id = bug_get_field( $v_bug_id, 'project_id' ); } else { 	$t_project_id = $v_project_id; }  # Check access rights switch( $f_type ) { 	case 'bug': 		# This covers access checks for issue attachments 		if( !file_can_download_bug_attachments( $v_bug_id, (int)$v_user_id ) ) { 			access_denied(); 		}  		# This covers access checks for issue note attachments 		$t_attachment_note_id = (int)$v_bugnote_id;  		if( $t_attachment_note_id !== 0 ) { 			if( bugnote_get_field( $t_attachment_note_id, 'view_state' ) != VS_PUBLIC ) {  				$t_attachments_view_threshold = config_get( 'download_attachments_threshold', null, $v_user_id, $t_project_id ); 				if( !access_has_bugnote_level( $t_attachments_view_threshold, $t_attachment_note_id ) ) { 					access_denied(); 				} 			} 		} 		break; 	case 'doc': 		# Check if project documentation feature is enabled. 		if( OFF == config_get( 'enable_project_documentation' ) ) { 			access_denied(); 		}  		access_ensure_project_level( config_get( 'view_proj_doc_threshold' ), $v_project_id ); 		break; }  # throw away output buffer contents (and disable it) to protect download while( @ob_end_clean() ) { }  if( ini_get( 'zlib.output_compression' ) && function_exists( 'ini_set' ) ) { 	ini_set( 'zlib.output_compression', false ); }  http_security_headers();  # Make sure that IE can download the attachments under https. header( 'Pragma: public' );  # To fix an IE bug which causes problems when downloading # attached files via HTTPS, we disable the "Pragma: no-cache" # command when IE is used over HTTPS. global $g_allow_file_cache; if( http_is_protocol_https() && is_browser_internet_explorer() ) { 	# Suppress "Pragma: no-cache" header. } else { 	if( !isset( $g_allow_file_cache ) ) { 		header( 'Pragma: no-cache' ); 	} } header( 'Expires: ' . gmdate( 'D, d M Y H:i:s \G\M\T', time() ) );  header( 'Last-Modified: ' . gmdate( 'D, d M Y H:i:s \G\M\T', $v_date_added ) );  $t_upload_method = config_get( 'file_upload_method' ); $t_filename = file_get_display_name( $v_filename );  # Content headers $t_content_type = $v_file_type;  $t_content_type_override = file_get_content_type_override( $t_filename ); $t_file_info_type = false;  switch( $t_upload_method ) { 	case DISK: 		$t_local_disk_file = file_normalize_attachment_path( $v_diskfile, $t_project_id ); 		if( file_exists( $t_local_disk_file ) ) { 			$t_file_info_type = file_get_mime_type( $t_local_disk_file ); 		} 		break; 	case DATABASE: 		$t_file_info_type = file_get_mime_type_for_content( $v_content ); 		break; 	default: 		trigger_error( ERROR_GENERIC, ERROR );  }  if( $t_file_info_type !== false ) { 	$t_content_type = $t_file_info_type; }  if( $t_content_type_override ) { 	$t_content_type = $t_content_type_override; }  # Decide what should open inline in the browser vs. download as attachment # https://www.thoughtco.com/mime-types-by-content-type-3469108 $t_show_inline = $f_show_inline; $t_mime_force_inline = array( 	'image/jpeg', 'image/gif', 'image/tiff', 'image/bmp', 'image/svg+xml', 'image/png', 	'application/pdf' ); $t_mime_force_attachment = array( 'application/x-shockwave-flash', 'text/html' );  # extract mime type from content type $t_mime_type = explode( ';', $t_content_type, 2 ); $t_mime_type = $t_mime_type[0];  if( in_array( $t_mime_type, $t_mime_force_inline ) ) { 	$t_show_inline = true; } else if( in_array( $t_mime_type, $t_mime_force_attachment ) ) { 	$t_show_inline = false; }  http_content_disposition_header( $t_filename, $t_show_inline );  header( 'Content-Type: ' . $t_content_type ); header( 'Content-Length: ' . $v_filesize );  # Don't let Internet Explorer second-guess our content-type [1] # Also disable Flash content-type sniffing [2] # [1] http://blogs.msdn.com/b/ie/archive/2008/07/02/ie8-security-part-v-comprehensive-protection.aspx # [2] http://50.56.33.56/blog/?p=242 header( 'X-Content-Type-Options: nosniff' );  # dump file content to the connection. switch( $t_upload_method ) { 	case DISK: 		readfile( $t_local_disk_file ); 		break; 	case DATABASE: 		echo $v_content; }  ```   [file\_download.php](file_download.php?file_id=9118&type=bug) (7,471 bytes) | | | | |
|  | | | | | |
|

#### Relationships

[Relationship Graph](bug_relationship_graph.php?bug_id=27039&graph=relation)[Dependency Graph](bug_relationship_graph.php?bug_id=27039&graph=dependency)

| related to | [0026893](view.php?id=26893) | closed | [vboctor](https://mantisbt.org/bugs/view_user_page.php?id=3081) | APIs expose private attachments to users who has access to issue but not private notes |
| --- | --- | --- | --- | --- |
| related to | [0009802](view.php?id=9802) | closed | [vboctor](https://mantisbt.org/bugs/view_user_page.php?id=3081) | Support attachments associated with private notes |
| has duplicate | [0027262](view.php?id=27262) | closed | [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784) | Private files can be downloaded by attacker |
| related to | [0027299](view.php?id=27299) | closed | [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784) | Remove code duplication in File API |
| related to | [0026631](view.php?id=26631) | closed | [vboctor](https://mantisbt.org/bugs/view_user_page.php?id=3081) | file\_get\_visible\_attachments shows private files that should be invisible to the user |

#### Activities

| [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)   [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)  2020-06-16 12:48  developer    [~0064105](view.php?id=27039#c64105 "Direct link to note") | Thanks for the detailed bug report , I confirm the bug.  I will check your proposed patch.  For next time, instead of uploading the whole modified file, could you please provide a unified diff, git patch or even better submit a pull request. |
| --- | --- |
|  | |
| [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)   [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)  2020-09-19 10:56  developer    [~0064454](view.php?id=27039#c64454 "Direct link to note") | [@pijama](https://mantisbt.org/bugs/view_user_page.php?id=49274) I'm planning to request a CVE for this issue, would you like to be credited for the finding, and if so please indicate how. |
|  | |
| [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)   [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)  2020-09-19 11:31  developer    [~0064455](view.php?id=27039#c64455 "Direct link to note") | Proposed fix, test and review comments welcome.   [27039.patch](file_download.php?file_id=9233&type=bug) (14,936 bytes)    ``` From b83248d3cdc7b6cf7d7fbd2262c224186b79ab3d Mon Sep 17 00:00:00 2001 From: Damien Regad <dregad@mantisbt.org> Date: Sat, 12 Sep 2020 22:04:18 +0200 Subject: [PATCH 1/5] New file_can_view_or_download() function  file_can_view_bug_attachments() and file_can_download_bug_attachments() have nearly identical code, the only difference being the names of the configs.  Adding a new internal File API function to avoid code duplication.  Issue #27299 ---  core/file_api.php | 60 ++++++++++++++++++++++++++++++++++++++++-------  1 file changed, 51 insertions(+), 9 deletions(-)  diff --git a/core/file_api.php b/core/file_api.php index a4bee8989..2517aaba2 100644 --- a/core/file_api.php +++ b/core/file_api.php @@ -206,30 +206,72 @@ function file_bug_has_attachments( $p_bug_id ) {  	}  }   +/** + * Check if the current user can view or download attachments. + * + * Generic call used by + * - {@see file_can_view_bug_attachments()} + * - {@see file_can_view_bugnote_attachments} + * - {@see file_can_download_bug_attachments()} + * - {@see file_can_download_bugnote_attachments} + * + * @param string   $p_action            'view' or 'download' + * @param int      $p_bug_id            A bug identifier + * @param int      $p_uploader_user_id  The user who uploaded the attachment + * + * @return bool + * + * @internal Should not be used outside of File API. + */ +function file_can_view_or_download( $p_action, $p_bug_id, $p_uploader_user_id ) { +	switch( $p_action ) { +		case 'view': +			$t_threshold_global = 'view_attachments_threshold'; +			$t_threshold_own = 'allow_view_own_attachments'; +			break; +		case 'download': +			$t_threshold_global = 'download_attachments_threshold'; +			$t_threshold_own = 'allow_download_own_attachments'; +			break; +		default: +			trigger_error( ERROR_GENERIC, ERROR ); +	} + +	$t_project_id = bug_get_field( $p_bug_id, 'project_id' ); +	$t_access_global = config_get( $t_threshold_global,null, null, $t_project_id ); + +	$t_can_access = access_has_bug_level( $t_access_global, $p_bug_id ); +	if( $t_can_access ) { +		return true; +	} + +	$t_uploaded_by_me = auth_get_current_user_id() == $p_uploader_user_id; +	$t_view_own = config_get( $t_threshold_own, null, null, $t_project_id ); +	return $t_uploaded_by_me && $t_view_own; +} +  /**   * Check if the current user can view attachments for the specified bug. + *   * @param integer $p_bug_id           A bug identifier.   * @param integer $p_uploader_user_id A user identifier. + *   * @return boolean   */  function file_can_view_bug_attachments( $p_bug_id, $p_uploader_user_id = null ) { -	$t_uploaded_by_me = auth_get_current_user_id() === $p_uploader_user_id; -	$t_can_view = access_has_bug_level( config_get( 'view_attachments_threshold' ), $p_bug_id ); -	$t_can_view = $t_can_view || ( $t_uploaded_by_me && config_get( 'allow_view_own_attachments' ) ); -	return $t_can_view; +	return file_can_view_or_download( 'view', $p_bug_id, $p_uploader_user_id );  }    /**   * Check if the current user can download attachments for the specified bug. + *   * @param integer $p_bug_id           A bug identifier. - * @param integer $p_uploader_user_id A user identifier. + * @param integer $p_uploader_user_id The user who uploaded the attachment. + *   * @return boolean   */  function file_can_download_bug_attachments( $p_bug_id, $p_uploader_user_id = null ) { -	$t_uploaded_by_me = auth_get_current_user_id() === $p_uploader_user_id; -	$t_can_download = access_has_bug_level( config_get( 'download_attachments_threshold', null, null, bug_get_field( $p_bug_id, 'project_id' ) ), $p_bug_id ); -	$t_can_download = $t_can_download || ( $t_uploaded_by_me && config_get( 'allow_download_own_attachments', null, null, bug_get_field( $p_bug_id, 'project_id' ) ) ); -	return $t_can_download; +	return file_can_view_or_download( 'download', $p_bug_id, $p_uploader_user_id );  }    /** --  2.25.1   From 1a24845b321ac3a5c62bc11524aaab770adc89be Mon Sep 17 00:00:00 2001 From: Damien Regad <dregad@mantisbt.org> Date: Sat, 12 Sep 2020 22:09:06 +0200 Subject: [PATCH 2/5] Functions to check view/download ability at bugnote level  2 new File API functions: - file_can_view_bugnote_attachments() - file_can_download_bugnote_attachments  Prerequisite to fix issue #27039 ---  core/file_api.php | 41 +++++++++++++++++++++++++++++++++++++++--  1 file changed, 39 insertions(+), 2 deletions(-)  diff --git a/core/file_api.php b/core/file_api.php index 2517aaba2..63de3e487 100644 --- a/core/file_api.php +++ b/core/file_api.php @@ -218,12 +218,13 @@ function file_bug_has_attachments( $p_bug_id ) {   * @param string   $p_action            'view' or 'download'   * @param int      $p_bug_id            A bug identifier   * @param int      $p_uploader_user_id  The user who uploaded the attachment + * @param int|null $p_bugnote_id        If specified, will check at bugnote level   *   * @return bool   *   * @internal Should not be used outside of File API.   */ -function file_can_view_or_download( $p_action, $p_bug_id, $p_uploader_user_id ) { +function file_can_view_or_download( $p_action, $p_bug_id, $p_uploader_user_id, $p_bugnote_id = null ) {  	switch( $p_action ) {  		case 'view':  			$t_threshold_global = 'view_attachments_threshold'; @@ -240,7 +241,11 @@ function file_can_view_or_download( $p_action, $p_bug_id, $p_uploader_user_id )  	$t_project_id = bug_get_field( $p_bug_id, 'project_id' );  	$t_access_global = config_get( $t_threshold_global,null, null, $t_project_id );   -	$t_can_access = access_has_bug_level( $t_access_global, $p_bug_id ); +	if( $p_bugnote_id === null ) { +		$t_can_access = access_has_bug_level( $t_access_global, $p_bug_id ); +	} else { +		$t_can_access = access_has_bugnote_level( $t_access_global, $p_bugnote_id ); +	}  	if( $t_can_access ) {  		return true;  	} @@ -262,6 +267,22 @@ function file_can_view_bug_attachments( $p_bug_id, $p_uploader_user_id = null )  	return file_can_view_or_download( 'view', $p_bug_id, $p_uploader_user_id );  }   +/** + * Check if the current user can view attachments for the specified bug note. + * + * @param integer $p_bugnote_id       A bugnote identifier. + * @param integer $p_uploader_user_id The user who uploaded the attachment. + * + * @return boolean + */ +function file_can_view_bugnote_attachments( $p_bugnote_id, $p_uploader_user_id = null ) { +	if( $p_bugnote_id == 0 ) { +		return true; +	} +	$t_bug_id = bugnote_get_field( $p_bugnote_id, 'bug_id' ); +	return file_can_view_or_download( 'view', $t_bug_id, $p_uploader_user_id ); +} +  /**   * Check if the current user can download attachments for the specified bug.   * @@ -274,6 +295,22 @@ function file_can_download_bug_attachments( $p_bug_id, $p_uploader_user_id = nul  	return file_can_view_or_download( 'download', $p_bug_id, $p_uploader_user_id );  }   +/** + * Check if the current user can download attachments for the specified bug note. + * + * @param integer $p_bugnote_id       A bugnote identifier. + * @param integer $p_uploader_user_id The user who uploaded the attachment. + * + * @return boolean + */ +function file_can_download_bugnote_attachments( $p_bugnote_id, $p_uploader_user_id = null ) { +	if( $p_bugnote_id == 0 ) { +		return true; +	} +	$t_bug_id = bugnote_get_field( $p_bugnote_id, 'bug_id' ); +	return file_can_view_or_download( 'download', $t_bug_id, $p_uploader_user_id, $p_bugnote_id ); +} +  /**   * Check if the current user can delete attachments from the specified bug.   * @param integer $p_bug_id           A bug identifier. --  2.25.1   From 2a44141d82ec9aed9e14431b895ee181b9194fc4 Mon Sep 17 00:00:00 2001 From: Damien Regad <dregad@mantisbt.org> Date: Sat, 12 Sep 2020 22:21:09 +0200 Subject: [PATCH 3/5] Check ability to download attachments at bugnote level  This prevents users authorized to download attachments but not to view private bugnotes, from accessing files attached to a private note via `file_download.php?file_id={FILE_ID}&type=bug`.  Includes some minor code cleanup in file_get_visible_attachments(): - use a foreach loop - reuse variables instead of derefenrcing array  Fixes #27039 ---  core/file_api.php | 30 ++++++++++--------------------  file_download.php |  4 +++-  2 files changed, 13 insertions(+), 21 deletions(-)  diff --git a/core/file_api.php b/core/file_api.php index 63de3e487..245b30353 100644 --- a/core/file_api.php +++ b/core/file_api.php @@ -451,31 +451,21 @@ function file_get_visible_attachments( $p_bug_id ) {    	$t_preview_text_ext = config_get( 'preview_text_extensions' );  	$t_preview_image_ext = config_get( 'preview_image_extensions' ); -	$t_attachments_view_threshold = config_get( 'view_attachments_threshold' );    	$t_image_previewed = false; -	for( $i = 0;$i < $t_attachments_count;$i++ ) { -		$t_row = $t_attachment_rows[$i]; +	foreach( $t_attachment_rows as $t_row ) {  		$t_user_id = (int)$t_row['user_id']; +		$t_attachment_note_id = (int)$t_row['bugnote_id'];   -		# This covers access checks for issue attachments -		if( !file_can_view_bug_attachments( $p_bug_id, $t_user_id ) ) { +		if( !file_can_view_bug_attachments( $p_bug_id, $t_user_id ) +		|| !file_can_view_bugnote_attachments( $t_attachment_note_id, $t_user_id ) +		) {  			continue;  		}   -		# This covers access checks for issue note attachments -		$t_attachment_note_id = (int)$t_row['bugnote_id']; -		if( $t_attachment_note_id !== 0 ) { -			if( bugnote_get_field( $t_attachment_note_id, 'view_state' ) != VS_PUBLIC ) { -				if( !access_has_bugnote_level( $t_attachments_view_threshold, $t_attachment_note_id ) ) { -					continue; -				} -			} -		} -  		$t_id = (int)$t_row['id'];  		$t_filename = $t_row['filename']; -		$t_filesize = $t_row['filesize']; +		$t_filesize = (int)$t_row['filesize'];  		$t_diskfile = file_normalize_attachment_path( $t_row['diskfile'], bug_get_field( $p_bug_id, 'project_id' ) );  		$t_date_added = $t_row['date_added'];   @@ -483,14 +473,14 @@ function file_get_visible_attachments( $p_bug_id ) {  		$t_attachment['id'] = $t_id;  		$t_attachment['user_id'] = $t_user_id;  		$t_attachment['display_name'] = file_get_display_name( $t_filename ); -		$t_attachment['size'] = (int)$t_filesize; +		$t_attachment['size'] = $t_filesize;  		$t_attachment['date_added'] = $t_date_added;  		$t_attachment['diskfile'] = $t_diskfile;  		$t_attachment['file_type'] = $t_row['file_type']; -		$t_attachment['bugnote_id'] = (int)$t_row['bugnote_id']; +		$t_attachment['bugnote_id'] = $t_attachment_note_id;   -		$t_attachment['can_download'] = file_can_download_bug_attachments( $p_bug_id, (int)$t_row['user_id'] ); -		$t_attachment['can_delete'] = file_can_delete_bug_attachments( $p_bug_id, (int)$t_row['user_id'] ); +		$t_attachment['can_download'] = file_can_download_bug_attachments( $p_bug_id, $t_user_id ); +		$t_attachment['can_delete'] = file_can_delete_bug_attachments( $p_bug_id, $t_user_id );    		if( $t_attachment['can_download'] ) {  			$t_attachment['download_url'] = 'file_download.php?file_id=' . $t_id . '&type=bug'; diff --git a/file_download.php b/file_download.php index d423681b0..d7404548a 100644 --- a/file_download.php +++ b/file_download.php @@ -110,7 +110,9 @@ if( $f_type == 'bug' ) {  # Check access rights  switch( $f_type ) {  	case 'bug': -		if( !file_can_download_bug_attachments( $v_bug_id, (int)$v_user_id ) ) { +		if( !file_can_download_bug_attachments( $v_bug_id, $v_user_id ) +		|| !file_can_download_bugnote_attachments( $v_bugnote_id, $v_user_id ) +		) {  			access_denied();  		}  		break; --  2.25.1   From 8d9f4346963b2dc5462fb27700f4c60ea4a80a1e Mon Sep 17 00:00:00 2001 From: Damien Regad <dregad@mantisbt.org> Date: Sat, 12 Sep 2020 22:24:21 +0200 Subject: [PATCH 4/5] Improve PHPDoc for file_get_visible_attachments()  ---  core/file_api.php | 26 ++++++++++++++------------  1 file changed, 14 insertions(+), 12 deletions(-)  diff --git a/core/file_api.php b/core/file_api.php index 245b30353..67e4cecef 100644 --- a/core/file_api.php +++ b/core/file_api.php @@ -422,19 +422,21 @@ function file_normalize_attachment_path( $p_diskfile, $p_project_id ) {    /**   * Gets an array of attachments that are visible to the currently logged in user. + *   * Each element of the array contains the following: - * display_name - The attachment display name (i.e. file name dot extension) - * size - The attachment size in bytes. - * date_added - The date where the attachment was added. - * can_download - true: logged in user has access to download the attachment, false: otherwise. - * diskfile - The name of the file on disk.  Typically this is a hash without an extension. - * download_url - The download URL for the attachment (only set if can_download is true). - * exists - Applicable for DISK attachments.  true: file exists, otherwise false. - * can_delete - The logged in user can delete the attachments. - * preview - true: the attachment should be previewable, otherwise false. - * type - Can be "image", "text" or empty for other types. - * alt - The alternate text to be associated with the icon. - * icon - array with icon information, contains 'url' and 'alt' elements. + * - display_name - The attachment display name (i.e. file name dot extension) + * - size - The attachment size in bytes. + * - date_added - The date where the attachment was added. + * - can_download - true: logged in user has access to download the attachment, false: otherwise. + * - diskfile - The name of the file on disk.  Typically this is a hash without an extension. + * - download_url - The download URL for the attachment (only set if can_download is true). + * - exists - Applicable for DISK attachments.  true: file exists, otherwise false. + * - can_delete - The logged in user can delete the attachments. + * - preview - true: the attachment should be previewable, otherwise false. + * - type - Can be "image", "text" or empty for other types. + * - alt - The alternate text to be associated with the icon. + * - icon - array with icon information, contains 'url' and 'alt' elements. + *   * @param integer $p_bug_id A bug identifier.   * @return array   */ --  2.25.1   From 32f1a5f3f4c7e78e4655ca0faaa616d97170c1c9 Mon Sep 17 00:00:00 2001 From: Damien Regad <dregad@mantisbt.org> Date: Sat, 12 Sep 2020 22:25:06 +0200 Subject: [PATCH 5/5] Fix PHPStorm undefined variable warnings  ---  file_download.php | 12 ++++++++++++  1 file changed, 12 insertions(+)  diff --git a/file_download.php b/file_download.php index d7404548a..9ed9b5f44 100644 --- a/file_download.php +++ b/file_download.php @@ -99,6 +99,18 @@ if( false === $t_row ) {  	error_parameters( $c_file_id );  	trigger_error( ERROR_FILE_NOT_FOUND, ERROR );  } +/** + * @var int    $v_bug_id + * @var int    $v_project_id + * @var string $v_diskfile + * @var string $v_filename + * @var int    $v_filesize + * @var string $v_file_type + * @var string $v_content + * @var int    $v_date_added + * @var int    $v_user_id + * @var int    $v_bugnote_id + */  extract( $t_row, EXTR_PREFIX_ALL, 'v' );    if( $f_type == 'bug' ) { --  2.25.1   ```   [27039.patch](file_download.php?file_id=9233&type=bug) (14,936 bytes) |
|  | |
| [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)   [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)  2020-09-19 11:32  developer    [~0064456](view.php?id=27039#c64456 "Direct link to note") | CVE Request 961621 sent |
|  | |
| [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)   [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)  2020-09-20 07:10  developer    [~0064458](view.php?id=27039#c64458 "Direct link to note")  Last edited: 2020-09-20 07:20 | CVE-2020-25781 assigned. |
|  | |
| [vboctor](https://mantisbt.org/bugs/view_user_page.php?id=3081)   [vboctor](https://mantisbt.org/bugs/view_user_page.php?id=3081)  2020-09-20 23:13  manager    [~0064462](view.php?id=27039#c64462 "Direct link to note") | [@dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784) I'm missing where you are checking that if a user is trying to view/download an attachment that is associated with a private note, that they have access to such private note. |
|  | |
| [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)   [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)  2020-09-21 12:23  developer    [~0064470](view.php?id=27039#c64470 "Direct link to note") | [@vboctor](https://mantisbt.org/bugs/view_user_page.php?id=3081) the logic takes place in new File API functions file\_can\_view\_bugnote\_attachments() / file\_can\_download\_bugnote\_attachments().  For the scenario where a is not allowed to view bugnote attachments, file\_get\_visible\_attachments() now excludes them (file\_api.php line 461).  For a direct call to file\_download.php to get bug attachments, if the latter returns false, user gets an access denied error (line 114), see commit *Check ability to download attachments at bugnote level* |
|  | |

#### Related Changesets

| MantisBT: master-2.24 5595c90f  2020-09-12 12:09  [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784) [Details](/bugs/plugin.php?page=Source/view&id=25277) [Diff](https://github.com/mantisbt/mantisbt/commit/5595c90f11c48164331a20bb9c66098980516e93) | Functions to check view/download ability at bugnote level | | Affected Issues[0027039](/bugs/view.php?id=27039 "[closed] CVE-2020-25781: Access to private bug note attachments") |
| --- | --- | --- | --- |
| mod - core/file\_api.php | | [Diff](https://github.com/mantisbt/mantisbt/commit/5595c90f11c48164331a20bb9c66098980516e93) [File](https://github.com/mantisbt/mantisbt/blob/5595c90f11c48164331a20bb9c66098980516e93/core/file_api.php) |
| MantisBT: master-2.24 9de20c09  2020-09-12 12:21  [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784) [Details](/bugs/plugin.php?page=Source/view&id=25278) [Diff](https://github.com/mantisbt/mantisbt/commit/9de20c09e5a557e57159a61657ce62f1a4f578fe) | Check ability to download attachments at bugnote level | | Affected Issues[0027039](/bugs/view.php?id=27039 "[closed] CVE-2020-25781: Access to private bug note attachments") |
| mod - core/file\_api.php | | [Diff](https://github.com/mantisbt/mantisbt/commit/9de20c09e5a557e57159a61657ce62f1a4f578fe) [File](https://github.com/mantisbt/mantisbt/blob/9de20c09e5a557e57159a61657ce62f1a4f578fe/core/file_api.php) |
| mod - file\_download.php | | [Diff](https://github.com/mantisbt/mantisbt/commit/9de20c09e5a557e57159a61657ce62f1a4f578fe) [File](https://github.com/mantisbt/mantisbt/blob/9de20c09e5a557e57159a61657ce62f1a4f578fe/file_download.php) |

**Powered by [MantisBT 2.28.0-dev-master-f0c253853](https://www.mantisbt.org "bug tracking software")**

Copyright © 2000 - 2025 MantisBT Team
Contact administrator for assistance

[![Powered by Mantis Bug Tracker: a free and open source web based bug tracking system.](/bugs/images/mantis_logo.png)](https://www.mantisbt.org "Mantis Bug Tracker: a free and open source web based bug tracking system.")

 Page execution time: 0.1733 seconds



=== Content from github.com_04006ae3_20250119_140351.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmantisbt%2Fmantisbt%2Fcommit%2F9de20c09e5a557e57159a61657ce62f1a4f578fe)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmantisbt%2Fmantisbt%2Fcommit%2F9de20c09e5a557e57159a61657ce62f1a4f578fe)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=mantisbt%2Fmantisbt)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[mantisbt](/mantisbt)
/
**[mantisbt](/mantisbt/mantisbt)**
Public

* [Notifications](/login?return_to=%2Fmantisbt%2Fmantisbt) You must be signed in to change notification settings
* [Fork
  728](/login?return_to=%2Fmantisbt%2Fmantisbt)
* [Star
   1.7k](/login?return_to=%2Fmantisbt%2Fmantisbt)

* [Code](/mantisbt/mantisbt)
* [Pull requests
  77](/mantisbt/mantisbt/pulls)
* [Actions](/mantisbt/mantisbt/actions)
* [Security](/mantisbt/mantisbt/security)
* [Insights](/mantisbt/mantisbt/pulse)

Additional navigation options

* [Code](/mantisbt/mantisbt)
* [Pull requests](/mantisbt/mantisbt/pulls)
* [Actions](/mantisbt/mantisbt/actions)
* [Security](/mantisbt/mantisbt/security)
* [Insights](/mantisbt/mantisbt/pulse)

## Commit

[Permalink](/mantisbt/mantisbt/commit/9de20c09e5a557e57159a61657ce62f1a4f578fe)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Check ability to download attachments at bugnote level

[Browse files](/mantisbt/mantisbt/tree/9de20c09e5a557e57159a61657ce62f1a4f578fe)
Browse the repository at this point in the history

```
This prevents users authorized to download attachments but not to view
private bugnotes, from accessing files attached to a private note via
`file_download.php?file_id={FILE_ID}&type=bug` ([CVE-2020-25781](https://github.com/advisories/GHSA-xjmx-cprh-646r "CVE-2020-25781")).

Includes some minor code cleanup in file_get_visible_attachments():
- use a foreach loop
- reuse variables instead of derefenrcing array

Fixes #27039
```

* Loading branch information

[![@dregad](https://avatars.githubusercontent.com/u/449891?s=40&v=4)](/dregad)

[dregad](/mantisbt/mantisbt/commits?author=dregad "View all commits by dregad")
committed
Sep 23, 2020

1 parent
[5595c90](/mantisbt/mantisbt/commit/5595c90f11c48164331a20bb9c66098980516e93)

commit 9de20c0

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**13 additions**
and
**21 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* core

  + core/file\_api.php
    [file\_api.php](#diff-b4e556dbc514db85735ab597a219c292c6520543335496b5c3fb9d3a5b2400a0)
* file\_download.php
  [file\_download.php](#diff-0a1c0007c2242ba00a85a8255d5c97ae7b593c695f18fe6d69010f994664de8b)

## There are no files selected for viewing

30 changes: 10 additions & 20 deletions

30
[core/file\_api.php](#diff-b4e556dbc514db85735ab597a219c292c6520543335496b5c3fb9d3a5b2400a0 "core/file_api.php")

Show comments

[View file](/mantisbt/mantisbt/blob/9de20c09e5a557e57159a61657ce62f1a4f578fe/core/file_api.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -451,46 +451,36 @@ function file\_get\_visible\_attachments( $p\_bug\_id ) { |
|  |  |  |
|  |  | $t\_preview\_text\_ext = config\_get( 'preview\_text\_extensions' ); |
|  |  | $t\_preview\_image\_ext = config\_get( 'preview\_image\_extensions' ); |
|  |  | $t\_attachments\_view\_threshold = config\_get( 'view\_attachments\_threshold' ); |
|  |  |  |
|  |  | $t\_image\_previewed = false; |
|  |  | for( $i = 0;$i < $t\_attachments\_count;$i++ ) { |
|  |  | $t\_row = $t\_attachment\_rows[$i]; |
|  |  | foreach( $t\_attachment\_rows as $t\_row ) { |
|  |  | $t\_user\_id = (int)$t\_row['user\_id']; |
|  |  | $t\_attachment\_note\_id = (int)$t\_row['bugnote\_id']; |
|  |  |  |
|  |  | # This covers access checks for issue attachments |
|  |  | if( !file\_can\_view\_bug\_attachments( $p\_bug\_id, $t\_user\_id ) ) { |
|  |  | if( !file\_can\_view\_bug\_attachments( $p\_bug\_id, $t\_user\_id ) |
|  |  | || !file\_can\_view\_bugnote\_attachments( $t\_attachment\_note\_id, $t\_user\_id ) |
|  |  | ) { |
|  |  | continue; |
|  |  | } |
|  |  |  |
|  |  | # This covers access checks for issue note attachments |
|  |  | $t\_attachment\_note\_id = (int)$t\_row['bugnote\_id']; |
|  |  | if( $t\_attachment\_note\_id !== 0 ) { |
|  |  | if( bugnote\_get\_field( $t\_attachment\_note\_id, 'view\_state' ) != VS\_PUBLIC ) { |
|  |  | if( !access\_has\_bugnote\_level( $t\_attachments\_view\_threshold, $t\_attachment\_note\_id ) ) { |
|  |  | continue; |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | $t\_id = (int)$t\_row['id']; |
|  |  | $t\_filename = $t\_row['filename']; |
|  |  | $t\_filesize = $t\_row['filesize']; |
|  |  | $t\_filesize = (int)$t\_row['filesize']; |
|  |  | $t\_diskfile = file\_normalize\_attachment\_path( $t\_row['diskfile'], bug\_get\_field( $p\_bug\_id, 'project\_id' ) ); |
|  |  | $t\_date\_added = $t\_row['date\_added']; |
|  |  |  |
|  |  | $t\_attachment = array(); |
|  |  | $t\_attachment['id'] = $t\_id; |
|  |  | $t\_attachment['user\_id'] = $t\_user\_id; |
|  |  | $t\_attachment['display\_name'] = file\_get\_display\_name( $t\_filename ); |
|  |  | $t\_attachment['size'] = (int)$t\_filesize; |
|  |  | $t\_attachment['size'] = $t\_filesize; |
|  |  | $t\_attachment['date\_added'] = $t\_date\_added; |
|  |  | $t\_attachment['diskfile'] = $t\_diskfile; |
|  |  | $t\_attachment['file\_type'] = $t\_row['file\_type']; |
|  |  | $t\_attachment['bugnote\_id'] = (int)$t\_row['bugnote\_id']; |
|  |  | $t\_attachment['bugnote\_id'] = $t\_attachment\_note\_id; |
|  |  |  |
|  |  | $t\_attachment['can\_download'] = file\_can\_download\_bug\_attachments( $p\_bug\_id, (int)$t\_row['user\_id'] ); |
|  |  | $t\_attachment['can\_delete'] = file\_can\_delete\_bug\_attachments( $p\_bug\_id, (int)$t\_row['user\_id'] ); |
|  |  | $t\_attachment['can\_download'] = file\_can\_download\_bug\_attachments( $p\_bug\_id, $t\_user\_id ); |
|  |  | $t\_attachment['can\_delete'] = file\_can\_delete\_bug\_attachments( $p\_bug\_id, $t\_user\_id ); |
|  |  |  |
|  |  | if( $t\_attachment['can\_download'] ) { |
|  |  | $t\_attachment['download\_url'] = 'file\_download.php?file\_id=' . $t\_id . '&type=bug'; |
| Expand Down | |  |

4 changes: 3 additions & 1 deletion

4
[file\_download.php](#diff-0a1c0007c2242ba00a85a8255d5c97ae7b593c695f18fe6d69010f994664de8b "file_download.php")

Show comments

[View file](/mantisbt/mantisbt/blob/9de20c09e5a557e57159a61657ce62f1a4f578fe/file_download.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -110,7 +110,9 @@ |
|  |  | # Check access rights |
|  |  | switch( $f\_type ) { |
|  |  | case 'bug': |
|  |  | if( !file\_can\_download\_bug\_attachments( $v\_bug\_id, (int)$v\_user\_id ) ) { |
|  |  | if( !file\_can\_download\_bug\_attachments( $v\_bug\_id, $v\_user\_id ) |
|  |  | || !file\_can\_download\_bugnote\_attachments( $v\_bugnote\_id, $v\_user\_id ) |
|  |  | ) { |
|  |  | access\_denied(); |
|  |  | } |
|  |  | break; |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `9de20c0`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmantisbt%2Fmantisbt%2Fcommit%2F9de20c09e5a557e57159a61657ce62f1a4f578fe) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_af404c81_20250119_140353.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmanti)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmanti)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

![@manti](https://avatars.githubusercontent.com/u/3117037?s=64&v=4)

**manti**
[Follow](/login?return_to=https%3A%2F%2Fgithub.com%2Fmanti)

[Overview](/manti)
[Repositories
34](/manti?tab=repositories)
[Projects
0](/manti?tab=projects)
[Packages
0](/manti?tab=packages)
[Stars
41](/manti?tab=stars)

More

* [Overview](/manti)
* [Repositories](/manti?tab=repositories)
* [Projects](/manti?tab=projects)
* [Packages](/manti?tab=packages)
* [Stars](/manti?tab=stars)

![@manti](https://avatars.githubusercontent.com/u/3117037?s=64&v=4)

**manti**

[Follow](/login?return_to=https%3A%2F%2Fgithub.com%2Fmanti)

[![View manti's full-sized avatar](https://avatars.githubusercontent.com/u/3117037?v=4)](https://avatars.githubusercontent.com/u/3117037?v=4)

# manti manti

[Follow](/login?return_to=https%3A%2F%2Fgithub.com%2Fmanti)

[39
followers](https://github.com/manti?tab=followers) · [62
following](https://github.com/manti?tab=following)

* Acko
* Bangalore
* X
  [@MantiHS](https://twitter.com/MantiHS)

## [Achievements](/manti?tab=achievements)

[![Achievement: Pair Extraordinaire](https://github.githubassets.com/assets/pair-extraordinaire-default-579438a20e01.png)x4](/manti?achievement=pair-extraordinaire&tab=achievements)[![Achievement: YOLO](https://github.githubassets.com/assets/yolo-default-be0bbff04951.png)](/manti?achievement=yolo&tab=achievements)[![Achievement: Quickdraw](https://github.githubassets.com/assets/quickdraw-default--light-medium-5450fadcbe37.png)](/manti?achievement=quickdraw&tab=achievements)[![Achievement: Arctic Code Vault Contributor](https://github.githubassets.com/assets/arctic-code-vault-contributor-default-df8d74122a06.png)](/manti?achievement=arctic-code-vault-contributor&tab=achievements)[![Achievement: Pull Shark](https://github.githubassets.com/assets/pull-shark-default-498c279a747d.png)x3](/manti?achievement=pull-shark&tab=achievements)
## [Achievements](/manti?tab=achievements)

[![Achievement: Pair Extraordinaire](https://github.githubassets.com/assets/pair-extraordinaire-default-579438a20e01.png)x4](/manti?achievement=pair-extraordinaire&tab=achievements)[![Achievement: YOLO](https://github.githubassets.com/assets/yolo-default-be0bbff04951.png)](/manti?achievement=yolo&tab=achievements)[![Achievement: Quickdraw](https://github.githubassets.com/assets/quickdraw-default--light-medium-5450fadcbe37.png)](/manti?achievement=quickdraw&tab=achievements)[![Achievement: Arctic Code Vault Contributor](https://github.githubassets.com/assets/arctic-code-vault-contributor-default-df8d74122a06.png)](/manti?achievement=arctic-code-vault-contributor&tab=achievements)[![Achievement: Pull Shark](https://github.githubassets.com/assets/pull-shark-default-498c279a747d.png)x3](/manti?achievement=pull-shark&tab=achievements)
## Organizations

[![@code-kshetra](https://avatars.githubusercontent.com/u/3985780?s=64&v=4)](/code-kshetra)

Block or Report

# Block or report manti

**Block user**

Prevent this user from interacting with your repositories and sending you notifications.
Learn more about [blocking users](https://docs.github.com/articles/blocking-a-user-from-your-personal-account).

You must be logged in to block users.

Add an optional note:

Please don't include any personal information such as legal names or email addresses. Maximum 100 characters, markdown supported. This note will be visible to only you.

Block user

**Report abuse**

Contact GitHub support about this user’s behavior.
Learn more about [reporting abuse](https://docs.github.com/articles/reporting-abuse-or-spam).

[Report abuse](/contact/report-abuse?report=manti+%28user%29)

[Overview](/manti)
[Repositories
34](/manti?tab=repositories)
[Projects
0](/manti?tab=projects)
[Packages
0](/manti?tab=packages)
[Stars
41](/manti?tab=stars)

More

* [Overview](/manti)
* [Repositories](/manti?tab=repositories)
* [Projects](/manti?tab=projects)
* [Packages](/manti?tab=packages)
* [Stars](/manti?tab=stars)

## Pinned Loading

1. [schmittjoh/serializer](/schmittjoh/serializer) schmittjoh/serializer Public

   Library for (de-)serializing data of any complexity (supports JSON, and XML)

   PHP

   [2.3k](/schmittjoh/serializer/stargazers)
   [587](/schmittjoh/serializer/forks)
2. [pythonindia/inpycon2015](/pythonindia/inpycon2015) pythonindia/inpycon2015 Public

   PyCon India 2015 site

   HTML

   [9](/pythonindia/inpycon2015/stargazers)
   [15](/pythonindia/inpycon2015/forks)
3. [apache/airflow](/apache/airflow) apache/airflow Public

   Apache Airflow - A platform to programmatically author, schedule, and monitor workflows

   Python

   [38.3k](/apache/airflow/stargazers)
   [14.5k](/apache/airflow/forks)

Something went wrong, please refresh the page to try again.

If the problem persists, check the [GitHub status page](https://www.githubstatus.com/)
or [contact support](/contact).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_888453ae_20250119_140354.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-xjmx-cprh-646r)

**CVE-2020-25781**

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-xjmx-cprh-646r)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2Fadvisories%2F%3Cid%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

1. [GitHub Advisory Database](/advisories)
2. [Unreviewed](/advisories?query=type%3Aunreviewed)
3. [CVE-2020-25781](/advisories/GHSA-xjmx-cprh-646r)

## An issue was discovered in file\_download.php in MantisBT...

Moderate severity

Unreviewed

Published
May 24, 2022
to the GitHub Advisory Database
•
Updated Jan 29, 2023

## Package

No package listed—
[Suggest a package](/advisories/GHSA-xjmx-cprh-646r/improve)

## Affected versions

Unknown

## Patched versions

Unknown

## Description

An issue was discovered in file\_download.php in MantisBT before 2.24.3. Users without access to view private issue notes are able to download the (supposedly private) attachments linked to these notes by accessing the corresponding file download URL directly.

### References

* <https://nvd.nist.gov/vuln/detail/CVE-2020-25781>
* <https://mantisbt.org/bugs/view.php?id=27039>
* [http://github.com/mantisbt/mantisbt/commit/5595c90f11c48164331a20bb9c66098980516e93](https://github.com/mantisbt/mantisbt/commit/5595c90f11c48164331a20bb9c66098980516e93)
* [http://github.com/mantisbt/mantisbt/commit/9de20c09e5a557e57159a61657ce62f1a4f578fe](https://github.com/mantisbt/mantisbt/commit/9de20c09e5a557e57159a61657ce62f1a4f578fe)

Published by the [National Vulnerability Database](https://nvd.nist.gov/vuln/detail/CVE-2020-25781)
Sep 30, 2020

Published to the GitHub Advisory Database
May 24, 2022

Last updated
Jan 29, 2023

### Severity

Moderate

### [EPSS score](https://www.first.org/epss/user-guide)

0.112%
 (46th percentile)

### Weaknesses

[CWE-863](/advisories?query=cwe%3A863)

### CVE ID

CVE-2020-25781

### GHSA ID

GHSA-xjmx-cprh-646r

### Source code

No known source code

Dependabot alerts are not supported on this advisory because it does not have a package from a supported ecosystem with an affected and fixed version.

[Learn more about GitHub language support](https://docs.github.com/get-started/learning-about-github/github-language-support#about-supported-languages)

 Loading

Checking history

See something to contribute?
[Suggest improvements for this vulnerability](/advisories/GHSA-xjmx-cprh-646r/improve).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_53e4601a_20250119_122528.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmantisbt%2Fmantisbt%2Fcommit%2F9de20c09e5a557e57159a61657ce62f1a4f578fe)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmantisbt%2Fmantisbt%2Fcommit%2F9de20c09e5a557e57159a61657ce62f1a4f578fe)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=mantisbt%2Fmantisbt)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[mantisbt](/mantisbt)
/
**[mantisbt](/mantisbt/mantisbt)**
Public

* [Notifications](/login?return_to=%2Fmantisbt%2Fmantisbt) You must be signed in to change notification settings
* [Fork
  728](/login?return_to=%2Fmantisbt%2Fmantisbt)
* [Star
   1.7k](/login?return_to=%2Fmantisbt%2Fmantisbt)

* [Code](/mantisbt/mantisbt)
* [Pull requests
  77](/mantisbt/mantisbt/pulls)
* [Actions](/mantisbt/mantisbt/actions)
* [Security](/mantisbt/mantisbt/security)
* [Insights](/mantisbt/mantisbt/pulse)

Additional navigation options

* [Code](/mantisbt/mantisbt)
* [Pull requests](/mantisbt/mantisbt/pulls)
* [Actions](/mantisbt/mantisbt/actions)
* [Security](/mantisbt/mantisbt/security)
* [Insights](/mantisbt/mantisbt/pulse)

## Commit

[Permalink](/mantisbt/mantisbt/commit/9de20c09e5a557e57159a61657ce62f1a4f578fe)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Check ability to download attachments at bugnote level

[Browse files](/mantisbt/mantisbt/tree/9de20c09e5a557e57159a61657ce62f1a4f578fe)
Browse the repository at this point in the history

```
This prevents users authorized to download attachments but not to view
private bugnotes, from accessing files attached to a private note via
`file_download.php?file_id={FILE_ID}&type=bug` ([CVE-2020-25781](https://github.com/advisories/GHSA-xjmx-cprh-646r "CVE-2020-25781")).

Includes some minor code cleanup in file_get_visible_attachments():
- use a foreach loop
- reuse variables instead of derefenrcing array

Fixes #27039
```

* Loading branch information

[![@dregad](https://avatars.githubusercontent.com/u/449891?s=40&v=4)](/dregad)

[dregad](/mantisbt/mantisbt/commits?author=dregad "View all commits by dregad")
committed
Sep 23, 2020

1 parent
[5595c90](/mantisbt/mantisbt/commit/5595c90f11c48164331a20bb9c66098980516e93)

commit 9de20c0

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**13 additions**
and
**21 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* core

  + core/file\_api.php
    [file\_api.php](#diff-b4e556dbc514db85735ab597a219c292c6520543335496b5c3fb9d3a5b2400a0)
* file\_download.php
  [file\_download.php](#diff-0a1c0007c2242ba00a85a8255d5c97ae7b593c695f18fe6d69010f994664de8b)

## There are no files selected for viewing

30 changes: 10 additions & 20 deletions

30
[core/file\_api.php](#diff-b4e556dbc514db85735ab597a219c292c6520543335496b5c3fb9d3a5b2400a0 "core/file_api.php")

Show comments

[View file](/mantisbt/mantisbt/blob/9de20c09e5a557e57159a61657ce62f1a4f578fe/core/file_api.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -451,46 +451,36 @@ function file\_get\_visible\_attachments( $p\_bug\_id ) { |
|  |  |  |
|  |  | $t\_preview\_text\_ext = config\_get( 'preview\_text\_extensions' ); |
|  |  | $t\_preview\_image\_ext = config\_get( 'preview\_image\_extensions' ); |
|  |  | $t\_attachments\_view\_threshold = config\_get( 'view\_attachments\_threshold' ); |
|  |  |  |
|  |  | $t\_image\_previewed = false; |
|  |  | for( $i = 0;$i < $t\_attachments\_count;$i++ ) { |
|  |  | $t\_row = $t\_attachment\_rows[$i]; |
|  |  | foreach( $t\_attachment\_rows as $t\_row ) { |
|  |  | $t\_user\_id = (int)$t\_row['user\_id']; |
|  |  | $t\_attachment\_note\_id = (int)$t\_row['bugnote\_id']; |
|  |  |  |
|  |  | # This covers access checks for issue attachments |
|  |  | if( !file\_can\_view\_bug\_attachments( $p\_bug\_id, $t\_user\_id ) ) { |
|  |  | if( !file\_can\_view\_bug\_attachments( $p\_bug\_id, $t\_user\_id ) |
|  |  | || !file\_can\_view\_bugnote\_attachments( $t\_attachment\_note\_id, $t\_user\_id ) |
|  |  | ) { |
|  |  | continue; |
|  |  | } |
|  |  |  |
|  |  | # This covers access checks for issue note attachments |
|  |  | $t\_attachment\_note\_id = (int)$t\_row['bugnote\_id']; |
|  |  | if( $t\_attachment\_note\_id !== 0 ) { |
|  |  | if( bugnote\_get\_field( $t\_attachment\_note\_id, 'view\_state' ) != VS\_PUBLIC ) { |
|  |  | if( !access\_has\_bugnote\_level( $t\_attachments\_view\_threshold, $t\_attachment\_note\_id ) ) { |
|  |  | continue; |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | $t\_id = (int)$t\_row['id']; |
|  |  | $t\_filename = $t\_row['filename']; |
|  |  | $t\_filesize = $t\_row['filesize']; |
|  |  | $t\_filesize = (int)$t\_row['filesize']; |
|  |  | $t\_diskfile = file\_normalize\_attachment\_path( $t\_row['diskfile'], bug\_get\_field( $p\_bug\_id, 'project\_id' ) ); |
|  |  | $t\_date\_added = $t\_row['date\_added']; |
|  |  |  |
|  |  | $t\_attachment = array(); |
|  |  | $t\_attachment['id'] = $t\_id; |
|  |  | $t\_attachment['user\_id'] = $t\_user\_id; |
|  |  | $t\_attachment['display\_name'] = file\_get\_display\_name( $t\_filename ); |
|  |  | $t\_attachment['size'] = (int)$t\_filesize; |
|  |  | $t\_attachment['size'] = $t\_filesize; |
|  |  | $t\_attachment['date\_added'] = $t\_date\_added; |
|  |  | $t\_attachment['diskfile'] = $t\_diskfile; |
|  |  | $t\_attachment['file\_type'] = $t\_row['file\_type']; |
|  |  | $t\_attachment['bugnote\_id'] = (int)$t\_row['bugnote\_id']; |
|  |  | $t\_attachment['bugnote\_id'] = $t\_attachment\_note\_id; |
|  |  |  |
|  |  | $t\_attachment['can\_download'] = file\_can\_download\_bug\_attachments( $p\_bug\_id, (int)$t\_row['user\_id'] ); |
|  |  | $t\_attachment['can\_delete'] = file\_can\_delete\_bug\_attachments( $p\_bug\_id, (int)$t\_row['user\_id'] ); |
|  |  | $t\_attachment['can\_download'] = file\_can\_download\_bug\_attachments( $p\_bug\_id, $t\_user\_id ); |
|  |  | $t\_attachment['can\_delete'] = file\_can\_delete\_bug\_attachments( $p\_bug\_id, $t\_user\_id ); |
|  |  |  |
|  |  | if( $t\_attachment['can\_download'] ) { |
|  |  | $t\_attachment['download\_url'] = 'file\_download.php?file\_id=' . $t\_id . '&type=bug'; |
| Expand Down | |  |

4 changes: 3 additions & 1 deletion

4
[file\_download.php](#diff-0a1c0007c2242ba00a85a8255d5c97ae7b593c695f18fe6d69010f994664de8b "file_download.php")

Show comments

[View file](/mantisbt/mantisbt/blob/9de20c09e5a557e57159a61657ce62f1a4f578fe/file_download.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -110,7 +110,9 @@ |
|  |  | # Check access rights |
|  |  | switch( $f\_type ) { |
|  |  | case 'bug': |
|  |  | if( !file\_can\_download\_bug\_attachments( $v\_bug\_id, (int)$v\_user\_id ) ) { |
|  |  | if( !file\_can\_download\_bug\_attachments( $v\_bug\_id, $v\_user\_id ) |
|  |  | || !file\_can\_download\_bugnote\_attachments( $v\_bugnote\_id, $v\_user\_id ) |
|  |  | ) { |
|  |  | access\_denied(); |
|  |  | } |
|  |  | break; |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `9de20c0`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmantisbt%2Fmantisbt%2Fcommit%2F9de20c09e5a557e57159a61657ce62f1a4f578fe) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from mantisbt.org_08f43191_20250119_140350.html ===

Toggle sidebar [MantisBT](/bugs//) Toggle user menu

* mantisbt

  + - [All Projects](/bugs/set_project.php?project_id=0)
    - [mantisbt](/bugs/set_project.php?project_id=1)
    - [Mylyn Connector](/bugs/set_project.php?project_id=20)
    - [Plugin - agileMantis](/bugs/set_project.php?project_id=25)
    - [Plugin - CsvImport](/bugs/set_project.php?project_id=11)
    - [Plugin - CustomerManagement](/bugs/set_project.php?project_id=21)
    - [Plugin - EmailReporting](/bugs/set_project.php?project_id=10)
    - [Plugin - FilterPageEdit](/bugs/set_project.php?project_id=15)
    - [Plugin - InlineColumnConfiguration](/bugs/set_project.php?project_id=14)
    - [Plugin - LinkedCustomFields](/bugs/set_project.php?project_id=16)
    - [Plugin - MantisTouchRedirect](/bugs/set_project.php?project_id=22)
    - [Plugin - RecurrCall](/bugs/set_project.php?project_id=6)
    - [Plugin - RelatedIssuesExport](/bugs/set_project.php?project_id=13)
    - [Plugin - Reminder](/bugs/set_project.php?project_id=7)
    - [Plugin - Tasks](/bugs/set_project.php?project_id=8)
    - [Plugin - Time Tracking](/bugs/set_project.php?project_id=18)
* anonymous
  + [RSS](https://mantisbt.org/bugs/issues_rss.php)
  + [Logout](/bugs/logout_page.php)

* [My View](/bugs/my_view_page.php)
* [View Issues](/bugs/view_all_bug_page.php)
* [Change Log](/bugs/changelog_page.php)
* [Roadmap](/bugs/roadmap_page.php)
* [Wiki](/bugs/wiki.php?type=project&id=1)
* [Repositories](/bugs/plugin.php?page=Source/index)

* Anonymous
[Login](/bugs/login_page.php?return=%2Fbugs%2Fview_user_page.php%3Fid%3D3081)
[Signup for a new account](/bugs/signup_page.php)

#### User Information

| Username | vboctor |
| --- | --- |

**Powered by [MantisBT 2.28.0-dev-master-f0c253853](https://www.mantisbt.org "bug tracking software")**

Copyright © 2000 - 2025 MantisBT Team
Contact administrator for assistance

[![Powered by Mantis Bug Tracker: a free and open source web based bug tracking system.](/bugs/images/mantis_logo.png)](https://www.mantisbt.org "Mantis Bug Tracker: a free and open source web based bug tracking system.")

 Page execution time: 0.1548 seconds


