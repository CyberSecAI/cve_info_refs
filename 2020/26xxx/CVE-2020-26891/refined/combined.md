=== Content from matrix.org_fd471a48_20250119_125734.html ===

[![Matrix logo](/images/matrix-logo-white.svg)](/)



[Spec](https://spec.matrix.org)

Foundation

[About Matrix](/foundation/about/)
[Governing Board Elections 2024](/foundation/governing-board-elections/)

[Blog](/blog/)
[Docs](/docs/)

Ecosystem

[Clients](/ecosystem/clients/)
[Bridges](/ecosystem/bridges/)
[Servers](/ecosystem/servers/)
[Integrations](/ecosystem/integrations/)
[SDKs](/ecosystem/sdks/)
[Hosting](/ecosystem/hosting/)

[Donate](/support)
[Try Matrix](/try-matrix/)

# Synapse 1.21.2 released, and security advisory.

15.10.2020 17:25
—
[Releases](/category/releases),
[Security](/category/security)
—
[Richard van der Hoff](/author/richard-van-der-hoff)

Last update: 15.10.2020 17:16

Hi folks,

Today we have released Synapse 1.21.2, which fixes a couple of minor bugs that crept into the previous release. Full details are below.

Separately, we are advising any administrators who have not yet upgraded to Synapse 1.21.0 or later to do so as soon as possible. Previous versions of Synapse were vulnerable to a cross-site-scripting (XSS) attack; the bug was fixed in Synapse 1.21.0 with [PR #8444](https://github.com/matrix-org/synapse/pull/8444).

The changelog for 1.21.2 is as follows:

# [🔗](#synapse-1-21-2-2020-10-15)Synapse 1.21.2 (2020-10-15)

Debian packages and Docker images have been rebuilt using the latest versions of dependency libraries, including authlib 0.15.1. Please see bugfixes below.

## [🔗](#bugfixes)Bugfixes

* Fix rare bug where sending an event would fail due to a racey assertion. ([#8530](https://github.com/matrix-org/synapse/issues/8530))
* An updated version of the authlib dependency is included in the Docker and Debian images to fix an issue using OpenID Connect. See [#8534](https://github.com/matrix-org/synapse/issues/8534) for details.

## The Foundation needs you

The Matrix.org Foundation is a non-profit and only relies
on donations to operate. Its core mission is to maintain
the Matrix Specification, but it does much more than that.

It maintains the matrix.org homeserver and hosts several
bridges for free. It fights for our collective rights to
digital privacy and dignity.

[Support us](/support)

### Post Contents

* [Synapse 1.21.2 (2020-10-15)](https://matrix.org/blog/2020/10/15/synapse-1-21-2-released-and-security-advisory/#synapse-1-21-2-2020-10-15)
  + [Bugfixes](https://matrix.org/blog/2020/10/15/synapse-1-21-2-released-and-security-advisory/#bugfixes)

[Donate](/support)
[Shop](https://shop.matrix.org)
[Security Disclosure Policy](/security-disclosure-policy)
[Security Hall of Fame](/security-hall-of-fame)
[Code of Conduct](/legal/code-of-conduct)
[Legal](/legal)
[Contact](/contact)
[Site Source](https://github.com/matrix-org/matrix.org/)

[![GitHub](/assets/github.svg)](https://github.com/matrix-org)
[![GitLab](/assets/gitlab.svg)](https://gitlab.matrix.org/)
[![Mastodon](/assets/mastodon.svg)](https://mastodon.matrix.org/%40matrix)
[![Twitter](/assets/twitter.svg)](https://twitter.com/matrixdotorg)
[![YouTube](/assets/youtube.svg)](https://www.youtube.com/channel/UCVFkW-chclhuyYRbmmfwt6w)
[![RSS](/assets/rss.svg)](/atom.xml)

[Copyright Notice](/legal/copyright-notice)



=== Content from github.com_4e15e374_20250119_125729.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fsecurity%2Fadvisories%2FGHSA-3x8c-fmpc-5rmq)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fsecurity%2Fadvisories%2FGHSA-3x8c-fmpc-5rmq)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=matrix-org%2Fsynapse)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Apr 26, 2024. It is now read-only.

[matrix-org](/matrix-org)
/
**[synapse](/matrix-org/synapse)**
Public archive

* [Notifications](/login?return_to=%2Fmatrix-org%2Fsynapse) You must be signed in to change notification settings
* [Fork
  2.1k](/login?return_to=%2Fmatrix-org%2Fsynapse)
* [Star
   11.9k](/login?return_to=%2Fmatrix-org%2Fsynapse)

* [Code](/matrix-org/synapse)
* [Issues
  1.5k](/matrix-org/synapse/issues)
* [Pull requests
  64](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects
  0](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

Additional navigation options

* [Code](/matrix-org/synapse)
* [Issues](/matrix-org/synapse/issues)
* [Pull requests](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

# Cross-site scripting (XSS) vulnerability in the fallback authentication endpoint

Moderate

[clokep](/clokep)
published
GHSA-3x8c-fmpc-5rmq
Oct 16, 2020

## Package

pip

matrix-synapse
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

< 1.21.0

## Patched versions

>= 1.21.0

## Description

### Impact

The fallback authentication endpoint served via Synapse was vulnerable to cross-site scripting (XSS) attacks. The impact depends on the configuration of the domain that Synapse is deployed on, but may allow access to cookies and other browser data, CSRF vulnerabilities, and access to other resources served on the same domain or parent domains.

### Patches

This is fixed by [#8444](https://github.com/matrix-org/synapse/pull/8444), which is included in Synapse v1.21.0.

### Workarounds

If the homeserver is not configured to use reCAPTCHA, consent (terms of service), or single sign-on then the affected endpoint can be blocked at a reverse proxy:

* `/_matrix/client/r0/auth/.*/fallback/web`
* `/_matrix/client/unstable/auth/.*/fallback/web`

### Severity

Moderate

### CVE ID

CVE-2020-26891

### Weaknesses

No CWEs

### Credits

* [![@dkasak](https://avatars.githubusercontent.com/u/463342?s=40&v=4)](/dkasak)
  [dkasak](/dkasak)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_c59c55d4_20250119_125728.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Freleases%2Ftag%2Fv1.21.2)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Freleases%2Ftag%2Fv1.21.2)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=matrix-org%2Fsynapse)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Apr 26, 2024. It is now read-only.

[matrix-org](/matrix-org)
/
**[synapse](/matrix-org/synapse)**
Public archive

* [Notifications](/login?return_to=%2Fmatrix-org%2Fsynapse) You must be signed in to change notification settings
* [Fork
  2.1k](/login?return_to=%2Fmatrix-org%2Fsynapse)
* [Star
   11.9k](/login?return_to=%2Fmatrix-org%2Fsynapse)

* [Code](/matrix-org/synapse/tree/v1.21.2)
* [Issues
  1.5k](/matrix-org/synapse/issues)
* [Pull requests
  64](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects
  0](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

Additional navigation options

* [Code](/matrix-org/synapse/tree/v1.21.2)
* [Issues](/matrix-org/synapse/issues)
* [Pull requests](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

1. [Releases](/matrix-org/synapse/releases)
2. [v1.21.2](/matrix-org/synapse/releases/tag/v1.21.2)

# v1.21.2

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/matrix-org/synapse/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v1.21.2)

 Loading

[View all tags](/matrix-org/synapse/tags)

![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)
[clokep](/clokep)
released this
15 Oct 14:42

·
[5783 commits](/matrix-org/synapse/compare/v1.21.2...develop)
to develop
since this release

[v1.21.2](/matrix-org/synapse/tree/v1.21.2)

This tag was signed with the committer’s **verified signature**.
The key has expired.

[![](https://avatars.githubusercontent.com/u/517124?s=64&v=4)](/clokep)
[clokep](/clokep)
Patrick Cloke

GPG key ID: 33FC58F6A7113048
Expired

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

[`9b8a53c`](/matrix-org/synapse/commit/9b8a53c7b9e1a3ca5f46e417b9fa705f8bacb494)

# Synapse 1.21.2 (2020-10-15)

Debian packages and Docker images have been rebuilt using the latest versions of dependency libraries, including authlib 0.15.1. Please see bugfixes below.

## Security advisory

* HTML pages served via Synapse were vulnerable to cross-site scripting (XSS) attacks. All server administrators are encouraged to upgrade. ([#8444](https://github.com/matrix-org/synapse/pull/8444)) ([CVE-2020-26891](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-26891))

  This fix was originally included in v1.21.0 but was missing a security advisory.

  This was reported by [Denis Kasak](https://github.com/dkasak).

## Bugfixes

* Fix rare bug where sending an event would fail due to a racey assertion. ([#8530](https://github.com/matrix-org/synapse/issues/8530))
* An updated version of the authlib dependency is included in the Docker and Debian images to fix an issue using OpenID Connect. See [#8534](https://github.com/matrix-org/synapse/issues/8534) for details.

 Assets
2

 Loading

All reactions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from avatars.githubusercontent.com_df024e4d_20250119_142505.html ===
�PNG

   
IHDR   (   (   �/:   &IDATx�ėkl��Ͻ���ٝݝ]{���#'�vH qJR�"�!)DUU���@�
P�"4�P$�ZJФ�B�B$�8!�6��:;�ߏ}������[�nH]�b\U�k>X����s�=����b�};�?r����\����������O����K��~�F�� F�z���1[4�����x�;���ۥ]�Z��F�#'�����z&��P����2��r�Ԕ 7�7�3�<<�m�#�k��F������Y%Y\Ȩ�r�t�>i>�֗�+K�����ZNw��h�D�� �n<���/��[\�ѡ3�������ﰋ�U% ���J�b�Q����>����s���v����0�(
��DƸF`�n}�Oo''��O:��t�w?���������v#i�A�w��M��u`"e2��l���o��ܸ�Ƶyu����A���˷m(����|Z�Jy��P9+>�W(:( s���ÄP�%Yv�\6%�G#1EQM� M�'�&'W���"pa-���«�ְ�5m@����:f
F׹��:��c�|
�"&� �͹���WC�8��va`<S�h4J)��� �\��>bk��E�����rB5��J�d��j^F �#��3�� �L �d�c�������Z�H,���H$�5n�Zfu����"0$�y����B�p߭�z�6U0��\C��5t��@ tBB�D��Ƕ�?ݶ��4�-� W��xBU��+\*Jf���u�%
�j�?�ˎ�����j����
�+!� 8�b
@�@��HS5b�p�] o��Φ��=Қ�`aiq�a�h\Mh��(i�0��.��dq�\_�d�c/\_\qh���a)�в
kz�{w��(��%x��K(2)���G\_uHb�B����)�n��1EM$�D" �y9�u����{�Mx 88V�p�׭�t;���>HXD�R�[�aL ���
 ����:�͡�l��0�X d�R P]]6�����YzgO�+ۥ�xX��E�,yLKz����v�L�."�W�L����r��C�ee99^�]�$I`��o�UU��@��8e�#gN��sd�v~�Q�X$�FFTB9��"��f�X��~��?���O�j(����d�R����{�$�d����H�g5+8��H�m��R0p���b`�vDS�H�lfm|���In��M�|����|��'e���X�r;f�&Ivu
)��{w ����o>�:g���ɍ�� �t�l�BQ�u�f��˲L��%
+�L����f���B��KS��#�@'0=';��p�t�M@�i.l\>���5i�h����'�O`S�(IisL?Vo�!&�{$�]]��U�O��
KJ�z�Ls����Ϥ����/�B�ߖr٭Zz��{�B��6o��@Vɤq�Љ�'��$�!J�0F!DP�D聍�l�c��iR�x�[�X'3,F�k?�-�~EmlZ;o�U� �}���\*d��p�S(@ܲ�?��}�e0ɸ�������������L�Q��3��d��P��m~�����������O�2��|�$3�de~����/����>>����s���؋��=\_V�����9n�����,��8;x�r�W�Nf�/���������1\*�|�,�g+�̄=z��r�4
0N!d�(���&��o8T[�`�
��
^j9-YoQ��c���Ԥ�p���I\��-Y�g�]>�O{L/OX�g,���?3��1䲡�6>r�n��͗�n�r�,ԫ{���ʮ�]y�2Q��0A!�ǝ��>�F0�nY�p`���8m��O��EV�q�Hl„�\\_Q��^�pӍ+�;h&1�&P`DX<us�'����{CG���S��\*�M�̸n��^�S�<N{��;JdY�jJLO�n�AY�,�HS�W��+Zߴ��-���\_�Y��`��&���Rm��U=lk�`�@K��i! ��c����\� h˳�\_4���X�P��S�\*�x4Q�Pi�S&5�H��d�Jq��/ۭ^�;=�PO�\_w�8�Ũ��\*����g�\�V��-ȕ�Y�08�%���`��#u�����9��8t���������si�E=���Z�����Y��%{���s�y���>����7�L����Gf0��$�B4lɷ����.�O+;{���/�=�#C�$E�:ꯨ( � ����(�/�\*��9!�x�F�g�.�Ĥ�����E�EsGf��   ��}�>{V��    IEND�B`�

=== Content from github.com_1024ca1b_20250119_142519.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-3x8c-fmpc-5rmq)

**CVE-2020-26891**

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-3x8c-fmpc-5rmq)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2Fadvisories%2F%3Cid%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

1. [GitHub Advisory Database](/advisories)
2. [GitHub Reviewed](/advisories?query=type%3Areviewed)
3. [CVE-2020-26891](/advisories/GHSA-3x8c-fmpc-5rmq)

## Cross-site scripting (XSS) vulnerability in the fallback authentication endpoint

Moderate severity

GitHub Reviewed

Published
Oct 16, 2020
in
[matrix-org/synapse](/matrix-org/synapse)
•
Updated Sep 24, 2024

[Vulnerability details](/advisories/GHSA-3x8c-fmpc-5rmq)
[Dependabot alerts
0](/advisories/GHSA-3x8c-fmpc-5rmq/dependabot)

## Package

pip

matrix-synapse
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

< 1.21.0

## Patched versions

1.21.0

## Description

### Impact

The fallback authentication endpoint served via Synapse was vulnerable to cross-site scripting (XSS) attacks. The impact depends on the configuration of the domain that Synapse is deployed on, but may allow access to cookies and other browser data, CSRF vulnerabilities, and access to other resources served on the same domain or parent domains.

### Patches

This is fixed by #8444, which is included in Synapse v1.21.0.

### Workarounds

If the homeserver is not configured to use reCAPTCHA, consent (terms of service), or single sign-on then the affected endpoint can be blocked at a reverse proxy:

* `/_matrix/client/r0/auth/.*/fallback/web`
* `/_matrix/client/unstable/auth/.*/fallback/web`

### References

* [GHSA-3x8c-fmpc-5rmq](https://github.com/matrix-org/synapse/security/advisories/GHSA-3x8c-fmpc-5rmq "GHSA-3x8c-fmpc-5rmq")
* [matrix-org/synapse#8444](https://github.com/matrix-org/synapse/pull/8444)
* <https://nvd.nist.gov/vuln/detail/CVE-2020-26891>
* <https://github.com/matrix-org/synapse/releases>
* <https://matrix.org/blog/2020/10/15/synapse-1-21-2-released-and-security-advisory>
* <https://github.com/matrix-org/synapse/releases/tag/v1.21.2>
* <https://github.com/pypa/advisory-database/tree/main/vulns/matrix-synapse/PYSEC-2020-238.yaml>

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)
[clokep](/clokep)
published to
[matrix-org/synapse](/matrix-org/synapse/security/advisories/GHSA-3x8c-fmpc-5rmq)
Oct 16, 2020

Reviewed
Oct 16, 2020

Published to the GitHub Advisory Database
Oct 16, 2020

Last updated
Sep 24, 2024

### Severity

Moderate

5.1

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v4 base metrics

##### Exploitability Metrics

Attack Vector
Network

Attack Complexity
Low

Attack Requirements
None

Privileges Required
None

User interaction
Active
##### Vulnerable System Impact Metrics

Confidentiality
None

Integrity
None

Availability
None
##### Subsequent System Impact Metrics

Confidentiality
Low

Integrity
Low

Availability
None

Learn more about base metrics

# CVSS v4 base metrics

##### Exploitability Metrics

Attack Vector:
This metric reflects the context by which vulnerability exploitation is possible. This metric value (and consequently the resulting severity) will be larger the more remote (logically, and physically) an attacker can be in order to exploit the vulnerable system. The assumption is that the number of potential attackers for a vulnerability that could be exploited from across a network is larger than the number of potential attackers that could exploit a vulnerability requiring physical access to a device, and therefore warrants a greater severity.

Attack Complexity:
This metric captures measurable actions that must be taken by the attacker to actively evade or circumvent existing built-in security-enhancing conditions in order to obtain a working exploit. These are conditions whose primary purpose is to increase security and/or increase exploit engineering complexity. A vulnerability exploitable without a target-specific variable has a lower complexity than a vulnerability that would require non-trivial customization. This metric is meant to capture security mechanisms utilized by the vulnerable system.

Attack Requirements:
This metric captures the prerequisite deployment and execution conditions or variables of the vulnerable system that enable the attack. These differ from security-enhancing techniques/technologies (ref Attack Complexity) as the primary purpose of these conditions is not to explicitly mitigate attacks, but rather, emerge naturally as a consequence of the deployment and execution of the vulnerable system.

Privileges Required:
This metric describes the level of privileges an attacker must possess prior to successfully exploiting the vulnerability. The method by which the attacker obtains privileged credentials prior to the attack (e.g., free trial accounts), is outside the scope of this metric. Generally, self-service provisioned accounts do not constitute a privilege requirement if the attacker can grant themselves privileges as part of the attack.

User interaction:
This metric captures the requirement for a human user, other than the attacker, to participate in the successful compromise of the vulnerable system. This metric determines whether the vulnerability can be exploited solely at the will of the attacker, or whether a separate user (or user-initiated process) must participate in some manner.
##### Vulnerable System Impact Metrics

Confidentiality:
This metric measures the impact to the confidentiality of the information managed by the VULNERABLE SYSTEM due to a successfully exploited vulnerability. Confidentiality refers to limiting information access and disclosure to only authorized users, as well as preventing access by, or disclosure to, unauthorized ones.

Integrity:
This metric measures the impact to integrity of a successfully exploited vulnerability. Integrity refers to the trustworthiness and veracity of information. Integrity of the VULNERABLE SYSTEM is impacted when an attacker makes unauthorized modification of system data. Integrity is also impacted when a system user can repudiate critical actions taken in the context of the system (e.g. due to insufficient logging).

Availability:
This metric measures the impact to the availability of the VULNERABLE SYSTEM resulting from a successfully exploited vulnerability. While the Confidentiality and Integrity impact metrics apply to the loss of confidentiality or integrity of data (e.g., information, files) used by the system, this metric refers to the loss of availability of the impacted system itself, such as a networked service (e.g., web, database, email). Since availability refers to the accessibility of information resources, attacks that consume network bandwidth, processor cycles, or disk space all impact the availability of a system.
##### Subsequent System Impact Metrics

Confidentiality:
This metric measures the impact to the confidentiality of the information managed by the SUBSEQUENT SYSTEM due to a successfully exploited vulnerability. Confidentiality refers to limiting information access and disclosure to only authorized users, as well as preventing access by, or disclosure to, unauthorized ones.

Integrity:
This metric measures the impact to integrity of a successfully exploited vulnerability. Integrity refers to the trustworthiness and veracity of information. Integrity of the SUBSEQUENT SYSTEM is impacted when an attacker makes unauthorized modification of system data. Integrity is also impacted when a system user can repudiate critical actions taken in the context of the system (e.g. due to insufficient logging).

Availability:
This metric measures the impact to the availability of the SUBSEQUENT SYSTEM resulting from a successfully exploited vulnerability. While the Confidentiality and Integrity impact metrics apply to the loss of confidentiality or integrity of data (e.g., information, files) used by the system, this metric refers to the loss of availability of the impacted system itself, such as a networked service (e.g., web, database, email). Since availability refers to the accessibility of information resources, attacks that consume network bandwidth, processor cycles, or disk space all impact the availability of a system.

 CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:A/VC:N/VI:N/VA:N/SC:L/SI:L/SA:N

### [EPSS score](https://www.first.org/epss/user-guide)

0.131%
 (49th percentile)

### Weaknesses

[CWE-79](/advisories?query=cwe%3A79)

### CVE ID

CVE-2020-26891

### GHSA ID

GHSA-3x8c-fmpc-5rmq

### Source code

[matrix-org/synapse](https://github.com/matrix-org/synapse)

### Credits

* [![@dkasak](https://avatars.githubusercontent.com/u/463342?s=40&v=4)](/dkasak)
  [dkasak](/dkasak)
  Analyst

 Loading

Checking history

See something to contribute?
[Suggest improvements for this vulnerability](/advisories/GHSA-3x8c-fmpc-5rmq/improve).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_f29c98d3_20250119_142518.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdkasak)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdkasak)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

![@dkasak](https://avatars.githubusercontent.com/u/463342?s=64&v=4)

**dkasak**
[Follow](/login?return_to=https%3A%2F%2Fgithub.com%2Fdkasak)

[Overview](/dkasak)
[Repositories
141](/dkasak?tab=repositories)
[Projects
0](/dkasak?tab=projects)
[Packages
0](/dkasak?tab=packages)
[Stars
70](/dkasak?tab=stars)
[Sponsoring
0](/dkasak?tab=sponsoring)

More

* [Overview](/dkasak)
* [Repositories](/dkasak?tab=repositories)
* [Projects](/dkasak?tab=projects)
* [Packages](/dkasak?tab=packages)
* [Stars](/dkasak?tab=stars)
* [Sponsoring](/dkasak?tab=sponsoring)

![@dkasak](https://avatars.githubusercontent.com/u/463342?s=64&v=4)

**dkasak**

[Follow](/login?return_to=https%3A%2F%2Fgithub.com%2Fdkasak)

[![View dkasak's full-sized avatar](https://avatars.githubusercontent.com/u/463342?v=4)](https://avatars.githubusercontent.com/u/463342?v=4)

# Denis Kasak dkasak

[Follow](/login?return_to=https%3A%2F%2Fgithub.com%2Fdkasak)

Security researcher and programmer from Croatia. Currently working on Matrix stuff. Interested in typed functional programming, category theory, etc.
[72
followers](https://github.com/dkasak?tab=followers) · [4
following](https://github.com/dkasak?tab=following)

* Narsil Consulting
* Croatia
* <https://dkasak.github.io/>
* X
  [@deniskasak](https://twitter.com/deniskasak)
* LinkedIn

  [in/denis-kasak-91461055](https://www.linkedin.com/in/denis-kasak-91461055/)

## [Achievements](/dkasak?tab=achievements)

[![Achievement: Starstruck](https://github.githubassets.com/assets/starstruck-default--light-a594e2a027e0.png)](/dkasak?achievement=starstruck&tab=achievements)[![Achievement: Pair Extraordinaire](https://github.githubassets.com/assets/pair-extraordinaire-default-579438a20e01.png)x3](/dkasak?achievement=pair-extraordinaire&tab=achievements)[![Achievement: YOLO](https://github.githubassets.com/assets/yolo-default-be0bbff04951.png)](/dkasak?achievement=yolo&tab=achievements)[![Achievement: Quickdraw](https://github.githubassets.com/assets/quickdraw-default--light-8f798b35341a.png)](/dkasak?achievement=quickdraw&tab=achievements)[![Achievement: Public Sponsor](https://github.githubassets.com/assets/public-sponsor-default-9fa68986b057.png)](/dkasak?achievement=public-sponsor&tab=achievements)[![Achievement: Pull Shark](https://github.githubassets.com/assets/pull-shark-default-498c279a747d.png)x3](/dkasak?achievement=pull-shark&tab=achievements)[![Achievement: Arctic Code Vault Contributor](https://github.githubassets.com/assets/arctic-code-vault-contributor-default-df8d74122a06.png)](/dkasak?achievement=arctic-code-vault-contributor&tab=achievements)
## [Achievements](/dkasak?tab=achievements)

[![Achievement: Starstruck](https://github.githubassets.com/assets/starstruck-default--light-a594e2a027e0.png)](/dkasak?achievement=starstruck&tab=achievements)[![Achievement: Pair Extraordinaire](https://github.githubassets.com/assets/pair-extraordinaire-default-579438a20e01.png)x3](/dkasak?achievement=pair-extraordinaire&tab=achievements)[![Achievement: YOLO](https://github.githubassets.com/assets/yolo-default-be0bbff04951.png)](/dkasak?achievement=yolo&tab=achievements)[![Achievement: Quickdraw](https://github.githubassets.com/assets/quickdraw-default--light-8f798b35341a.png)](/dkasak?achievement=quickdraw&tab=achievements)[![Achievement: Public Sponsor](https://github.githubassets.com/assets/public-sponsor-default-9fa68986b057.png)](/dkasak?achievement=public-sponsor&tab=achievements)[![Achievement: Pull Shark](https://github.githubassets.com/assets/pull-shark-default-498c279a747d.png)x3](/dkasak?achievement=pull-shark&tab=achievements)[![Achievement: Arctic Code Vault Contributor](https://github.githubassets.com/assets/arctic-code-vault-contributor-default-df8d74122a06.png)](/dkasak?achievement=arctic-code-vault-contributor&tab=achievements)
## Highlights

* [4

  security advisory credits](/advisories?query=credit%3Adkasak)

## Organizations

[![@matrix-org](https://avatars.githubusercontent.com/u/8418310?s=64&v=4)](/matrix-org) [![@element-hq](https://avatars.githubusercontent.com/u/13446337?s=64&v=4)](/element-hq)

Block or Report

# Block or report dkasak

**Block user**

Prevent this user from interacting with your repositories and sending you notifications.
Learn more about [blocking users](https://docs.github.com/articles/blocking-a-user-from-your-personal-account).

You must be logged in to block users.

Add an optional note:

Please don't include any personal information such as legal names or email addresses. Maximum 100 characters, markdown supported. This note will be visible to only you.

Block user

**Report abuse**

Contact GitHub support about this user’s behavior.
Learn more about [reporting abuse](https://docs.github.com/articles/reporting-abuse-or-spam).

[Report abuse](/contact/report-abuse?report=dkasak+%28user%29)

[Overview](/dkasak)
[Repositories
141](/dkasak?tab=repositories)
[Projects
0](/dkasak?tab=projects)
[Packages
0](/dkasak?tab=packages)
[Stars
70](/dkasak?tab=stars)
[Sponsoring
0](/dkasak?tab=sponsoring)

More

* [Overview](/dkasak)
* [Repositories](/dkasak?tab=repositories)
* [Projects](/dkasak?tab=projects)
* [Packages](/dkasak?tab=packages)
* [Stars](/dkasak?tab=stars)
* [Sponsoring](/dkasak?tab=sponsoring)

## Pinned Loading

1. [matrix-org/vodozemac](/matrix-org/vodozemac) matrix-org/vodozemac Public

   An implementation of Olm and Megolm in pure Rust.

   Rust

   [193](/matrix-org/vodozemac/stargazers)
   [32](/matrix-org/vodozemac/forks)
2. [mario](/dkasak/mario) mario Public

   Forked from [poljar/mario](/poljar/mario)

   Mario is a plumber.

   Python
3. [fingerprinter](/dkasak/fingerprinter) fingerprinter Public

   Fingerprint HTML pages for easy bucketing based on similarity.

   Python

   [1](/dkasak/fingerprinter/stargazers)
4. [pymodoro](/dkasak/pymodoro) pymodoro Public

   Forked from [dattanchu/pymodoro](/dattanchu/pymodoro)

   Pymodoro is the Pomodoro for Xmobar or Dzen. It runs and it tells you where you are in your current pomodoro session.

   Python

   [3](/dkasak/pymodoro/stargazers)
   [1](/dkasak/pymodoro/forks)
5. [relative-urls](/dkasak/relative-urls) relative-urls Public

   Extract endpoints from stdin or files.

   Python

   [1](/dkasak/relative-urls/stargazers)
   [1](/dkasak/relative-urls/forks)
6. [sol](/dkasak/sol) sol Public

   A simple renderer (ray tracer) in C++

   C++

Something went wrong, please refresh the page to try again.

If the problem persists, check the [GitHub status page](https://www.githubstatus.com/)
or [contact support](/contact).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_60287a73_20250119_142518.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fpull%2F8444)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fpull%2F8444)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=matrix-org%2Fsynapse)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Apr 26, 2024. It is now read-only.

[matrix-org](/matrix-org)
/
**[synapse](/matrix-org/synapse)**
Public archive

* [Notifications](/login?return_to=%2Fmatrix-org%2Fsynapse) You must be signed in to change notification settings
* [Fork
  2.1k](/login?return_to=%2Fmatrix-org%2Fsynapse)
* [Star
   11.8k](/login?return_to=%2Fmatrix-org%2Fsynapse)

* [Code](/matrix-org/synapse)
* [Issues
  1.5k](/matrix-org/synapse/issues)
* [Pull requests
  64](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects
  0](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

Additional navigation options

* [Code](/matrix-org/synapse)
* [Issues](/matrix-org/synapse/issues)
* [Pull requests](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

# Convert additional templates to Jinja #8444

 Merged

[anoadragon453](/anoadragon453)
merged 5 commits into
[release-v1.21.0](/matrix-org/synapse/tree/release-v1.21.0 "matrix-org/synapse:release-v1.21.0")
from
[clokep/more-templates](/matrix-org/synapse/tree/clokep/more-templates "matrix-org/synapse:clokep/more-templates")

Oct 2, 2020

 Merged

# [Convert additional templates to Jinja](#top) #8444

[anoadragon453](/anoadragon453)
merged 5 commits into
[release-v1.21.0](/matrix-org/synapse/tree/release-v1.21.0 "matrix-org/synapse:release-v1.21.0")
from
[clokep/more-templates](/matrix-org/synapse/tree/clokep/more-templates "matrix-org/synapse:clokep/more-templates")

Oct 2, 2020

[Conversation
5](/matrix-org/synapse/pull/8444)
[Commits
5](/matrix-org/synapse/pull/8444/commits)
[Checks
0](/matrix-org/synapse/pull/8444/checks)
[Files changed](/matrix-org/synapse/pull/8444/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![clokep](https://avatars.githubusercontent.com/u/517124?s=60&v=4)](/clokep)

Copy link

Member

### @clokep **[clokep](/clokep)** commented [Oct 1, 2020](#issue-713141409)

This converts a few more of our inline HTML templates to Jinja. This is somewhat part of [#7280](https://github.com/matrix-org/synapse/issues/7280) and should make it a bit easier to customize these in the future.

Sorry, something went wrong.

All reactions

 [clokep](/clokep)
added 5 commits
[October 1, 2020 14:42](#commits-pushed-f670a75)

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Convert recaptcha to a Jinja template.](/matrix-org/synapse/pull/8444/commits/f670a75f1d537a63632e08483d62c153cd13b310 "Convert recaptcha to a Jinja template.")`

`[f670a75](/matrix-org/synapse/pull/8444/commits/f670a75f1d537a63632e08483d62c153cd13b310)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Convert terms to a Jinja template.](/matrix-org/synapse/pull/8444/commits/d8491ad54bcf99b62ac3b3f67526c2af84d3ae4d "Convert terms to a Jinja template.")`

`[d8491ad](/matrix-org/synapse/pull/8444/commits/d8491ad54bcf99b62ac3b3f67526c2af84d3ae4d)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Convert success to a Jinja template.](/matrix-org/synapse/pull/8444/commits/f6a0266812536343b2ff04c10abea65a44ed48a3 "Convert success to a Jinja template.")`

`[f6a0266](/matrix-org/synapse/pull/8444/commits/f6a0266812536343b2ff04c10abea65a44ed48a3)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Don't require public_baseurl to be set.](/matrix-org/synapse/pull/8444/commits/472324b96bd99be223405cb7223d55cd2482b351 "Don't require public_baseurl to be set.")`

`[472324b](/matrix-org/synapse/pull/8444/commits/472324b96bd99be223405cb7223d55cd2482b351)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Add a changelog.](/matrix-org/synapse/pull/8444/commits/17255e4168fe3e51665454b0bb1de3c1d62bff60 "Add a changelog.")`

`[17255e4](/matrix-org/synapse/pull/8444/commits/17255e4168fe3e51665454b0bb1de3c1d62bff60)`

[![clokep](https://avatars.githubusercontent.com/u/517124?s=60&v=4)](/clokep)

**[clokep](/clokep)**
commented
[Oct 1, 2020](#pullrequestreview-500678071)

 [View reviewed changes](/matrix-org/synapse/pull/8444/files/17255e4168fe3e51665454b0bb1de3c1d62bff60)

[synapse/config/\_base.py](/matrix-org/synapse/pull/8444/files/17255e4168fe3e51665454b0bb1de3c1d62bff60#diff-d3227e00d4de413ffbddf2eb879670a0aebc8aaebde6fcf7d347951c327c3334)

Comment on lines
+246
 to
+249

|  |  | if self.public\_baseurl: |
| --- | --- | --- |
|  |  | env.filters.update( |
|  |  | {"mxc\_to\_http": \_create\_mxc\_to\_http\_filter(self.public\_baseurl)} |
|  |  | ) |

Copy link

Member

Author

### @clokep **[clokep](/clokep)** [Oct 1, 2020](#discussion_r498484805)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Per the conversation in #synapse-dev:matrix.org it seems that `public_baseurl` is not required to be set. I believe any feature that expects to use this template filter already asserts that.

Sorry, something went wrong.

All reactions

Copy link

Member

### @anoadragon453 **[anoadragon453](/anoadragon453)** [Oct 2, 2020](#discussion_r498731113)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Seems so!

Sorry, something went wrong.

All reactions

[![anoadragon453](https://avatars.githubusercontent.com/u/1342360?s=60&v=4)](/anoadragon453)

**[anoadragon453](/anoadragon453)**
approved these changes
[Oct 2, 2020](#pullrequestreview-501010583)

 [View reviewed changes](/matrix-org/synapse/pull/8444/files/17255e4168fe3e51665454b0bb1de3c1d62bff60)

[synapse/config/\_base.py](/matrix-org/synapse/pull/8444/files/17255e4168fe3e51665454b0bb1de3c1d62bff60#diff-d3227e00d4de413ffbddf2eb879670a0aebc8aaebde6fcf7d347951c327c3334)

Comment on lines
+246
 to
+249

|  |  | if self.public\_baseurl: |
| --- | --- | --- |
|  |  | env.filters.update( |
|  |  | {"mxc\_to\_http": \_create\_mxc\_to\_http\_filter(self.public\_baseurl)} |
|  |  | ) |

Copy link

Member

### @anoadragon453 **[anoadragon453](/anoadragon453)** [Oct 2, 2020](#discussion_r498731113)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Seems so!

Sorry, something went wrong.

All reactions

[![@michaelkaye](https://avatars.githubusercontent.com/u/1917473?s=80&u=ba85104805c71cd3fc60eaa3599c5de81d427a9b&v=4)](/michaelkaye)

Copy link

Contributor

### **[michaelkaye](/michaelkaye)** commented [Oct 2, 2020](#issuecomment-702642606)

| I don't know if it's worth renaming the templates to indicate that they're not pure HTML - e.g. ansible community seems to have gravitated towards ".html.j2" for something that needs templating before it's usable. |
| --- |

All reactions

Sorry, something went wrong.

[![@anoadragon453](https://avatars.githubusercontent.com/u/1342360?s=80&u=7f088d81b921aa0a2915a336c647e7813ca85e1a&v=4)](/anoadragon453)

Copy link

Member

### **[anoadragon453](/anoadragon453)** commented [Oct 2, 2020](#issuecomment-702643431) • edited Loading

| [@michaelkaye](https://github.com/michaelkaye) We have a lot of templates that would need to be renamed if that were the case, and it might be a bit strange having only these 3 as `html.j2` and the rest as `html`. Perhaps we can do so in a separate PR where we search for and support both extensions. |
| --- |

All reactions

Sorry, something went wrong.

[![@anoadragon453](https://avatars.githubusercontent.com/u/1342360?s=40&u=7f088d81b921aa0a2915a336c647e7813ca85e1a&v=4)](/anoadragon453)
[anoadragon453](/anoadragon453)
merged commit [`34ff8da`](/matrix-org/synapse/commit/34ff8da83b54024289f515c6d73e6b486574d699)
into
release-v1.21.0

[Oct 2, 2020](https://github.com/matrix-org/synapse/pull/8444#event-3833308753)

 [![@anoadragon453](https://avatars.githubusercontent.com/u/1342360?s=40&u=7f088d81b921aa0a2915a336c647e7813ca85e1a&v=4)](/anoadragon453)
[anoadragon453](/anoadragon453)
deleted the
clokep/more-templates

branch
[October 2, 2020 10:15](#event-3833308835)

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=80&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)

Copy link

Member

Author

### **[clokep](/clokep)** commented [Oct 2, 2020](#issuecomment-702669343)

| I don't know if it's worth renaming the templates to indicate that they're not pure HTML - e.g. ansible community seems to have gravitated towards ".html.j2" for something that needs templating before it's usable.  I agree that it is confusing, but it has generally been our convention to just name them ".html". I added a note to [#7280](https://github.com/matrix-org/synapse/issues/7280) though!. |
| --- |

All reactions

Sorry, something went wrong.

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
mentioned this pull request
[Oct 2, 2020](#ref-issue-600406450)

[Improve customizability and consistency of templates
#7280](/matrix-org/synapse/issues/7280)

Closed

4 tasks

[richvdh](/richvdh)
added a commit
that referenced
this pull request
[Oct 2, 2020](#ref-commit-9de6e9e)
[![@richvdh](https://avatars.githubusercontent.com/u/1389908?s=40&v=4)](/richvdh)

`[move](/matrix-org/synapse/commit/9de6e9e249d7d2940e847b68fe9995154b1a3f74 "move #8444 to 'feature'") [#8444](https://github.com/matrix-org/synapse/pull/8444) [to 'feature'](/matrix-org/synapse/commit/9de6e9e249d7d2940e847b68fe9995154b1a3f74 "move #8444 to 'feature'")`

`[9de6e9e](/matrix-org/synapse/commit/9de6e9e249d7d2940e847b68fe9995154b1a3f74)`

[richvdh](/richvdh)
added a commit
that referenced
this pull request
[Oct 2, 2020](#ref-commit-462e681)
[![@richvdh](https://avatars.githubusercontent.com/u/1389908?s=40&v=4)](/richvdh)

`[Merge tag 'v1.21.0rc2' into develop](/matrix-org/synapse/commit/462e681c792e2fce6769ef80d11045da11fb0842 "Merge tag 'v1.21.0rc2' into develop

Synapse 1.21.0rc2 (2020-10-02)
==============================

Features
--------

- Convert additional templates from inline HTML to Jinja2 templates. ([\#8444](https://github.com/matrix-org/synapse/issues/8444))

Bugfixes
--------

- Fix a regression in v1.21.0rc1 which broke thumbnails of remote media. ([\#8438](https://github.com/matrix-org/synapse/issues/8438))
- Do not expose the experimental `uk.half-shot.msc2778.login.application_service` flow in the login API, which caused a compatibility problem with Element iOS. ([\#8440](https://github.com/matrix-org/synapse/issues/8440))
- Fix malformed log line in new federation \"catch up\" logic. ([\#8442](https://github.com/matrix-org/synapse/issues/8442))
- Fix DB query on startup for negative streams which caused long start up times. Introduced in [\#8374](https://github.com/matrix-org/synapse/issues/8374). ([\#8447](https://github.com/matrix-org/synapse/issues/8447))")`
…

`[462e681](/matrix-org/synapse/commit/462e681c792e2fce6769ef80d11045da11fb0842)`

```
Synapse 1.21.0rc2 (2020-10-02)
==============================

Features
--------

- Convert additional templates from inline HTML to Jinja2 templates. ([\[#8444](https://github.com/matrix-org/synapse/pull/8444)]([#8444](https://github.com/matrix-org/synapse/pull/8444)))

Bugfixes
--------

- Fix a regression in v1.21.0rc1 which broke thumbnails of remote media. ([\[#8438](https://github.com/matrix-org/synapse/pull/8438)]([#8438](https://github.com/matrix-org/synapse/pull/8438)))
- Do not expose the experimental `uk.half-shot.[msc2778](https://github.com/matrix-org/matrix-spec-proposals/pull/2778).login.application_service` flow in the login API, which caused a compatibility problem with Element iOS. ([\[#8440](https://github.com/matrix-org/synapse/pull/8440)]([#8440](https://github.com/matrix-org/synapse/pull/8440)))
- Fix malformed log line in new federation "catch up" logic. ([\[#8442](https://github.com/matrix-org/synapse/pull/8442)]([#8442](https://github.com/matrix-org/synapse/pull/8442)))
- Fix DB query on startup for negative streams which caused long start up times. Introduced in [\[#8374](https://github.com/matrix-org/synapse/pull/8374)]([#8374](https://github.com/matrix-org/synapse/pull/8374)). ([\[#8447](https://github.com/matrix-org/synapse/pull/8447)]([#8447](https://github.com/matrix-org/synapse/pull/8447)))
```

[anoadragon453](/anoadragon453)
added a commit
that referenced
this pull request
[Oct 5, 2020](#ref-commit-d46396d)
[![@anoadragon453](https://avatars.githubusercontent.com/u/1342360?s=40&u=7f088d81b921aa0a2915a336c647e7813ca85e1a&v=4)](/anoadragon453)

`[Merge branch 'develop' of github.com:matrix-org/synapse into anoa/thi…](/matrix-org/synapse/commit/d46396d2683ab212464748a14117995ad8aa0432 "Merge branch 'develop' of github.com:matrix-org/synapse into anoa/third_party_event_rules_public_rooms

* 'develop' of github.com:matrix-org/synapse: (109 commits)
  Add logging on startup/shutdown (#8448)
  Speed up unit tests when using PostgreSQL (#8450)
  Allow background tasks to be run on a separate worker. (#8369)
  move #8444 to 'feature'
  linkify changelog
  1.21.0rc2
  1.21.0rc2
  Fix bug in remote thumbnail search (#8438)
  Include a public_baseurl in configs generated by the demo script. (#8443)
  Fix DB query on startup for negative streams. (#8447)
  Convert additional templates to Jinja (#8444)
  Fix malformed log line in new federation \"catch up\" logic (#8442)
  Add unit test for event persister sharding (#8433)
  Add config option for always using \"userinfo endpoint\" for OIDC  (#7658)
  Do not expose the experimental appservice login flow to clients. (#8440)
  update changelog
  fix a logging error in thumbnailer (#8435)
  changelog fixes
  fix version number
  1.21.0
  ...")`
…

`[d46396d](/matrix-org/synapse/commit/d46396d2683ab212464748a14117995ad8aa0432)`

```
…rd_party_event_rules_public_rooms

* 'develop' of github.com:matrix-org/synapse: (109 commits)
  Add logging on startup/shutdown ([#8448](https://github.com/matrix-org/synapse/pull/8448))
  Speed up unit tests when using PostgreSQL ([#8450](https://github.com/matrix-org/synapse/pull/8450))
  Allow background tasks to be run on a separate worker. ([#8369](https://github.com/matrix-org/synapse/pull/8369))
  move [#8444](https://github.com/matrix-org/synapse/pull/8444) to 'feature'
  linkify changelog
  1.21.0rc2
  1.21.0rc2
  Fix bug in remote thumbnail search ([#8438](https://github.com/matrix-org/synapse/pull/8438))
  Include a public_baseurl in configs generated by the demo script. ([#8443](https://github.com/matrix-org/synapse/pull/8443))
  Fix DB query on startup for negative streams. ([#8447](https://github.com/matrix-org/synapse/pull/8447))
  Convert additional templates to Jinja ([#8444](https://github.com/matrix-org/synapse/pull/8444))
  Fix malformed log line in new federation "catch up" logic ([#8442](https://github.com/matrix-org/synapse/pull/8442))
  Add unit test for event persister sharding ([#8433](https://github.com/matrix-org/synapse/pull/8433))
  Add config option for always using "userinfo endpoint" for OIDC  ([#7658](https://github.com/matrix-org/synapse/pull/7658))
  Do not expose the experimental appservice login flow to clients. ([#8440](https://github.com/matrix-org/synapse/pull/8440))
  update changelog
  fix a logging error in thumbnailer ([#8435](https://github.com/matrix-org/synapse/pull/8435))
  changelog fixes
  fix version number
  1.21.0
  ...
```

[![@richvdh](https://avatars.githubusercontent.com/u/1389908?s=40&v=4)](/richvdh)
[richvdh](/richvdh)
mentioned this pull request
[Oct 15, 2020](#ref-pullrequest-720423724)

[Add Denis to HoF
matrix-org/matrix.org#856](/matrix-org/matrix.org/pull/856)
 Merged

[netbsd-srcmastr](/netbsd-srcmastr)
pushed a commit
to NetBSD/pkgsrc
that referenced
this pull request
[Oct 17, 2020](#ref-commit-0582f7e)
[![@Midar](https://avatars.githubusercontent.com/u/752237?s=40&u=81dfb9be718247c7664693c556bf3fdfb6715545&v=4)](/Midar)

`[Update chat/matrix-synapse to 1.21.2](/NetBSD/pkgsrc/commit/0582f7ebe496c86b2cc0aa9643e9b46b71313a05 "Update chat/matrix-synapse to 1.21.2

Synapse 1.21.2 (2020-10-15)
===========================

Debian packages and Docker images have been rebuilt using the latest versions of dependency libraries, including authlib 0.15.1. Please see bugfixes below.

Security advisory
-----------------

* HTML pages served via Synapse were vulnerable to cross-site scripting (XSS)
  attacks. All server administrators are encouraged to upgrade.
  ([\#8444](https://github.com/matrix-org/synapse/pull/8444))
  ([CVE-2020-26891](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-26891))

  This fix was originally included in v1.21.0 but was missing a security advisory.

  This was reported by [Denis Kasak](https://github.com/dkasak).

Bugfixes
--------

- Fix rare bug where sending an event would fail due to a racey assertion. ([\#8530](https://github.com/matrix-org/synapse/issues/8530))
- An updated version of the authlib dependency is included in the Docker and Debian images to fix an issue using OpenID Connect. See [\#8534](https://github.com/matrix-org/synapse/issues/8534) for details.

Synapse 1.21.1 (2020-10-13)
===========================

This release fixes a regression in v1.21.0 that prevented debian packages from being built.
It is otherwise identical to v1.21.0.

Synapse 1.21.0 (2020-10-12)
===========================

No significant changes since v1.21.0rc3.

As [noted in
v1.20.0](https://github.com/matrix-org/synapse/blob/release-v1.21.0/CHANGES.md#synapse-1200-2020-09-22),
a future release will drop support for accessing Synapse's
[Admin API](https://github.com/matrix-org/synapse/tree/master/docs/admin_api) under the
`/_matrix/client/*` endpoint prefixes. At that point, the Admin API will only
be accessible under `/_synapse/admin`.

Synapse 1.21.0rc3 (2020-10-08)
==============================

Bugfixes
--------

- Fix duplication of events on high traffic servers, caused by PostgreSQL `could not serialize access due to concurrent update` errors. ([\#8456](https://github.com/matrix-org/synapse/issues/8456))

Internal Changes
----------------

- Add Groovy Gorilla to the list of distributions we build `.deb`s for. ([\#8475](https://github.com/matrix-org/synapse/issues/8475))

Synapse 1.21.0rc2 (2020-10-02)
==============================

Features
--------

- Convert additional templates from inline HTML to Jinja2 templates. ([\#8444](https://github.com/matrix-org/synapse/issues/8444))

Bugfixes
--------

- Fix a regression in v1.21.0rc1 which broke thumbnails of remote media. ([\#8438](https://github.com/matrix-org/synapse/issues/8438))
- Do not expose the experimental `uk.half-shot.msc2778.login.application_service` flow in the login API, which caused a compatibility problem with Element iOS. ([\#8440](https://github.com/matrix-org/synapse/issues/8440))
- Fix malformed log line in new federation \"catch up\" logic. ([\#8442](https://github.com/matrix-org/synapse/issues/8442))
- Fix DB query on startup for negative streams which caused long start up times. Introduced in [\#8374](https://github.com/matrix-org/synapse/issues/8374). ([\#8447](https://github.com/matrix-org/synapse/issues/8447))

Synapse 1.21.0rc1 (2020-10-01)
==============================

Features
--------

- Require the user to confirm that their password should be reset after clicking the email confirmation link. ([\#8004](https://github.com/matrix-org/synapse/issues/8004))
- Add an admin API `GET /_synapse/admin/v1/event_reports` to read entries of table `event_reports`. Contributed by @dklimpel. ([\#8217](https://github.com/matrix-org/synapse/issues/8217))
- Consolidate the SSO error template across all configuration. ([\#8248](https://github.com/matrix-org/synapse/issues/8248), [\#8405](https://github.com/matrix-org/synapse/issues/8405))
- Add a configuration option to specify a whitelist of domains that a user can be redirected to after validating their email or phone number. ([\#8275](https://github.com/matrix-org/synapse/issues/8275), [\#8417](https://github.com/matrix-org/synapse/issues/8417))
- Add experimental support for sharding event persister. ([\#8294](https://github.com/matrix-org/synapse/issues/8294), [\#8387](https://github.com/matrix-org/synapse/issues/8387), [\#8396](https://github.com/matrix-org/synapse/issues/8396), [\#8419](https://github.com/matrix-org/synapse/issues/8419))
- Add the room topic and avatar to the room details admin API. ([\#8305](https://github.com/matrix-org/synapse/issues/8305))
- Add an admin API for querying rooms where a user is a member. Contributed by @dklimpel. ([\#8306](https://github.com/matrix-org/synapse/issues/8306))
- Add `uk.half-shot.msc2778.login.application_service` login type to allow appservices to login. ([\#8320](https://github.com/matrix-org/synapse/issues/8320))
- Add a configuration option that allows existing users to log in with OpenID Connect. Contributed by @BBBSnowball and @OmmyZhang. ([\#8345](https://github.com/matrix-org/synapse/issues/8345))
- Add prometheus metrics for replication requests. ([\#8406](https://github.com/matrix-org/synapse/issues/8406))
- Support passing additional single sign-on parameters to the client. ([\#8413](https://github.com/matrix-org/synapse/issues/8413))
- Add experimental reporting of metrics on expensive rooms for state-resolution. ([\#8420](https://github.com/matrix-org/synapse/issues/8420))
- Add experimental prometheus metric to track numbers of \"large\" rooms for state resolutiom. ([\#8425](https://github.com/matrix-org/synapse/issues/8425))
- Add prometheus metrics to track federation delays. ([\#8430](https://github.com/matrix-org/synapse/issues/8430))

Bugfixes
--------

- Fix a bug in the media repository where remote thumbnails with the same size but different crop methods would overwrite each other. Contributed by @deepbluev7. ([\#7124](https://github.com/matrix-org/synapse/issues/7124))
- Fix inconsistent handling of non-existent push rules, and stop tracking the `enabled` state of removed push rules. ([\#7796](https://github.com/matrix-org/synapse/issues/7796))
- Fix a longstanding bug when storing a media file with an empty `upload_name`. ([\#7905](https://github.com/matrix-org/synapse/issues/7905))
- Fix messages not being sent over federation until an event is sent into the same room. ([\#8230](https://github.com/matrix-org/synapse/issues/8230), [\#8247](https://github.com/matrix-org/synapse/issues/8247), [\#8258](https://github.com/matrix-org/synapse/issues/8258), [\#8272](https://github.com/matrix-org/synapse/issues/8272), [\#8322](https://github.com/matrix-org/synapse/issues/8322))
- Fix a longstanding bug where files that could not be thumbnailed would result in an Internal Server Error. ([\#8236](https://github.com/matrix-org/synapse/issues/8236), [\#8435](https://github.com/matrix-org/synapse/issues/8435))
- Upgrade minimum version of `canonicaljson` to version 1.4.0, to fix an unicode encoding issue. ([\#8262](https://github.com/matrix-org/synapse/issues/8262))
- Fix longstanding bug which could lead to incomplete database upgrades on SQLite. ([\#8265](https://github.com/matrix-org/synapse/issues/8265))
- Fix stack overflow when stderr is redirected to the logging system, and the logging system encounters an error. ([\#8268](https://github.com/matrix-org/synapse/issues/8268))
- Fix a bug which cause the logging system to report errors, if `DEBUG` was enabled and no `context` filter was applied. ([\#8278](https://github.com/matrix-org/synapse/issues/8278))
- Fix edge case where push could get delayed for a user until a later event was pushed. ([\#8287](https://github.com/matrix-org/synapse/issues/8287))
- Fix fetching malformed events from remote servers. ([\#8324](https://github.com/matrix-org/synapse/issues/8324))
- Fix `UnboundLocalError` from occuring when appservices send a malformed register request. ([\#8329](https://github.com/matrix-org/synapse/issues/8329))
- Don't send push notifications to expired user accounts. ([\#8353](https://github.com/matrix-org/synapse/issues/8353))
- Fix a regression in v1.19.0 with reactivating users through the admin API. ([\#8362](https://github.com/matrix-org/synapse/issues/8362))
- Fix a bug where during device registration the length of the device name wasn't limited. ([\#8364](https://github.com/matrix-org/synapse/issues/8364))
- Include `guest_access` in the fields that are checked for null bytes when updating `room_stats_state`. Broke in v1.7.2. ([\#8373](https://github.com/matrix-org/synapse/issues/8373))
- Fix theoretical race condition where events are not sent down `/sync` if the synchrotron worker is restarted without restarting other workers. ([\#8374](https://github.com/matrix-org/synapse/issues/8374))
- Fix a bug which could cause errors in rooms with malformed membership events, on servers using sqlite. ([\#8385](https://github.com/matrix-org/synapse/issues/8385))
- Fix \"Re-starting finished log context\" warning when receiving an event we already had over federation. ([\#8398](https://github.com/matrix-org/synapse/issues/8398))
- Fix incorrect handling of timeouts on outgoing HTTP requests. ([\#8400](https://github.com/matrix-org/synapse/issues/8400))
- Fix a regression in v1.20.0 in the `synapse_port_db` script regarding the `ui_auth_sessions_ips` table. ([\#8410](https://github.com/matrix-org/synapse/issues/8410))
- Remove unnecessary 3PID registration check when resetting password via an email address. Bug introduced in v0.34.0rc2. ([\#8414](https://github.com/matrix-org/synapse/issues/8414))

Improved Documentation
----------------------

- Add `/_synapse/client` to the reverse proxy documentation. ([\#8227](https://github.com/matrix-org/synapse/issues/8227))
- Add note to the reverse proxy settings documentation about disabling Apache's mod_security2. Contributed by Julian Fietkau (@jfietkau). ([\#8375](https://github.com/matrix-org/synapse/issues/8375))
- Improve description of `server_name` config option in `homserver.yaml`. ([\#8415](https://github.com/matrix-org/synapse/issues/8415))

Deprecations and Removals
-------------------------

- Drop support for `prometheus_client` older than 0.4.0. ([\#8426](https://github.com/matrix-org/synapse/issues/8426))

Internal Changes
----------------

- Fix tests on distros which disable TLSv1.0. Contributed by @danc86. ([\#8208](https://github.com/matrix-org/synapse/issues/8208))
- Simplify the distributor code to avoid unnecessary work. ([\#8216](https://github.com/matrix-org/synapse/issues/8216))
- Remove the `populate_stats_process_rooms_2` background job and restore functionality to `populate_stats_process_rooms`. ([\#8243](https://github.com/matrix-org/synapse/issues/8243))
- Clean up type hints for `PaginationConfig`. ([\#8250](https://github.com/matrix-org/synapse/issues/8250), [\#8282](https://github.com/matrix-org/synapse/issues/8282))
- Track the latest event for every destination and room for catch-up after federation outage. ([\#8256](https://github.com/matrix-org/synapse/issues/8256))
- Fix non-user visible bug in implementation of `MultiWriterIdGenerator.get_current_token_for_writer`. ([\#8257](https://github.com/matrix-org/synapse/issues/8257))
- Switch to the JSON implementation from the standard library. ([\#8259](https://github.com/matrix-org/synapse/issues/8259))
- Add type hints to `synapse.util.async_helpers`. ([\#8260](https://github.com/matrix-org/synapse/issues/8260))
- Simplify tests that mock asynchronous functions. ([\#8261](https://github.com/matrix-org/synapse/issues/8261))
- Add type hints to `StreamToken` and `RoomStreamToken` classes. ([\#8279](https://github.com/matrix-org/synapse/issues/8279))
- Change `StreamToken.room_key` to be a `RoomStreamToken` instance. ([\#8281](https://github.com/matrix-org/synapse/issues/8281))
- Refactor notifier code to correctly use the max event stream position. ([\#8288](https://github.com/matrix-org/synapse/issues/8288))
- Use slotted classes where possible. ([\#8296](https://github.com/matrix-org/synapse/issues/8296))
- Support testing the local Synapse checkout against the [Complement homeserver test suite](https://github.com/matrix-org/complement/). ([\#8317](https://github.com/matrix-org/synapse/issues/8317))
- Update outdated usages of `metaclass` to python 3 syntax. ([\#8326](https://github.com/matrix-org/synapse/issues/8326))
- Move lint-related dependencies to package-extra field, update CONTRIBUTING.md to utilise this. ([\#8330](https://github.com/matrix-org/synapse/issues/8330), [\#8377](https://github.com/matrix-org/synapse/issues/8377))
- Use the `admin_patterns` helper in additional locations. ([\#8331](https://github.com/matrix-org/synapse/issues/8331))
- Fix test logging to allow braces in log output. ([\#8335](https://github.com/matrix-org/synapse/issues/8335))
- Remove `__future__` imports related to Python 2 compatibility. ([\#8337](https://github.com/matrix-org/synapse/issues/8337))
- Simplify `super()` calls to Python 3 syntax. ([\#8344](https://github.com/matrix-org/synapse/issues/8344))
- Fix bad merge from `release-v1.20.0` branch to `develop`. ([\#8354](https://github.com/matrix-org/synapse/issues/8354))
- Factor out a `_send_dummy_event_for_room` method. ([\#8370](https://github.com/matrix-org/synapse/issues/8370))
- Improve logging of state resolution. ([\#8371](https://github.com/matrix-org/synapse/issues/8371))
- Add type annotations to `SimpleHttpClient`. ([\#8372](https://github.com/matrix-org/synapse/issues/8372))
- Refactor ID generators to use `async with` syntax. ([\#8383](https://github.com/matrix-org/synapse/issues/8383))
- Add `EventStreamPosition` type. ([\#8388](https://github.com/matrix-org/synapse/issues/8388))
- Create a mechanism for marking tests \"logcontext clean\". ([\#8399](https://github.com/matrix-org/synapse/issues/8399))
- A pair of tiny cleanups in the federation request code. ([\#8401](https://github.com/matrix-org/synapse/issues/8401))
- Add checks on startup that PostgreSQL sequences are consistent with their associated tables. ([\#8402](https://github.com/matrix-org/synapse/issues/8402))
- Do not include appservice users when calculating the total MAU for a server. ([\#8404](https://github.com/matrix-org/synapse/issues/8404))
- Typing fixes for `synapse.handlers.federation`. ([\#8422](https://github.com/matrix-org/synapse/issues/8422))
- Various refactors to simplify stream token handling. ([\#8423](https://github.com/matrix-org/synapse/issues/8423))
- Make stream token serializing/deserializing async. ([\#8427](https://github.com/matrix-org/synapse/issues/8427))")`
…

`[0582f7e](/NetBSD/pkgsrc/commit/0582f7ebe496c86b2cc0aa9643e9b46b71313a05)`

```
Synapse 1.21.2 (2020-10-15)
===========================

Debian packages and Docker images have been rebuilt using the latest versions of dependency libraries, including authlib 0.15.1. Please see bugfixes below.

Security advisory
-----------------

* HTML pages served via Synapse were vulnerable to cross-site scripting (XSS)
  attacks. All server administrators are encouraged to upgrade.
  ([\#8444]([matrix-org/synapse#8444](https://github.com/matrix-org/synapse/pull/8444)))
  ([[CVE-2020-26891](https://github.com/advisories/GHSA-3x8c-fmpc-5rmq "CVE-2020-26891")](<https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-26891>))

  This fix was originally included in v1.21.0 but was missing a security advisory.

  This was reported by [Denis Kasak](<https://github.com/dkasak>).

Bugfixes
--------

- Fix rare bug where sending an event would fail due to a racey assertion. ([\#8530]([matrix-org/synapse#8530](https://github.com/matrix-org/synapse/pull/8530)))
- An updated version of the authlib dependency is included in the Docker and Debian images to fix an issue using OpenID Connect. See [\#8534]([matrix-org/synapse#8534](https://github.com/matrix-org/synapse/issues/8534)) for details.

Synapse 1.21.1 (2020-10-13)
===========================

This release fixes a regression in v1.21.0 that prevented debian packages from being built.
It is otherwise identical to v1.21.0.

Synapse 1.21.0 (2020-10-12)
===========================

No significant changes since v1.21.0rc3.

As [noted in
v1.20.0](<https://github.com/matrix-org/synapse/blob/release-v1.21.0/CHANGES.md#synapse-1200-2020-09-22>),
a future release will drop support for accessing Synapse's
[Admin API](<https://github.com/matrix-org/synapse/tree/master/docs/admin_api>) under the
`/_matrix/client/*` endpoint prefixes. At that point, the Admin API will only
be accessible under `/_synapse/admin`.

Synapse 1.21.0rc3 (2020-10-08)
==============================

Bugfixes
--------

- Fix duplication of events on high traffic servers, caused by PostgreSQL `could not serialize access due to concurrent update` errors. ([\#8456]([matrix-org/synapse#8456](https://github.com/matrix-org/synapse/pull/8456)))

Internal Changes
----------------

- Add Groovy Gorilla to the list of distributions we build `.deb`s for. ([\#8475]([matrix-org/synapse#8475](https://github.com/matrix-org/synapse/pull/8475)))

Synapse 1.21.0rc2 (2020-10-02)
==============================

Features
--------

- Convert additional templates from inline HTML to Jinja2 templates. ([\#8444]([matrix-org/synapse#8444](https://github.com/matrix-org/synapse/pull/8444)))

Bugfixes
--------

- Fix a regression in v1.21.0rc1 which broke thumbnails of remote media. ([\#8438]([matrix-org/synapse#8438](https://github.com/matrix-org/synapse/pull/8438)))
- Do not expose the experimental `uk.half-shot.msc2778.login.application_service` flow in the login API, which caused a compatibility problem with Element iOS. ([\#8440]([matrix-org/synapse#8440](https://github.com/matrix-org/synapse/pull/8440)))
- Fix malformed log line in new federation "catch up" logic. ([\#8442]([matrix-org/synapse#8442](https://github.com/matrix-org/synapse/pull/8442)))
- Fix DB query on startup for negative streams which caused long start up times. Introduced in [\#8374]([matrix-org/synapse#8374](https://github.com/matrix-org/synapse/pull/8374)). ([\#8447]([matrix-org/synapse#8447](https://github.com/matrix-org/synapse/pull/8447)))

Synapse 1.21.0rc1 (2020-10-01)
==============================

Features
--------

- Require the user to confirm that their password should be reset after clicking the email confirmation link. ([\#8004]([matrix-org/synapse#8004](https://github.com/matrix-org/synapse/pull/8004)))
- Add an admin API `GET /_synapse/admin/v1/event_reports` to read entries of table `event_reports`. Contributed by [@dklimpel](https://github.com/dklimpel). ([\#8217]([matrix-org/synapse#8217](https://github.com/matrix-org/synapse/pull/8217)))
- Consolidate the SSO error template across all configuration. ([\#8248]([matrix-org/synapse#8248](https://github.com/matrix-org/synapse/pull/8248)), [\#8405]([matrix-org/synapse#8405](https://github.com/matrix-org/synapse/pull/8405)))
- Add a configuration option to specify a whitelist of domains that a user can be redirected to after validating their email or phone number. ([\#8275]([matrix-org/synapse#8275](https://github.com/matrix-org/synapse/pull/8275)), [\#8417]([matrix-org/synapse#8417](https://github.com/matrix-org/synapse/pull/8417)))
- Add experimental support for sharding event persister. ([\#8294]([matrix-org/synapse#8294](https://github.com/matrix-org/synapse/pull/8294)), [\#8387]([matrix-org/synapse#8387](https://github.com/matrix-org/synapse/pull/8387)), [\#8396]([matrix-org/synapse#8396](https://github.com/matrix-org/synapse/pull/8396)), [\#8419]([matrix-org/synapse#8419](https://github.com/matrix-org/synapse/pull/8419)))
- Add the room topic and avatar to the room details admin API. ([\#8305]([matrix-org/synapse#8305](https://github.com/matrix-org/synapse/pull/8305)))
- Add an admin API for querying rooms where a user is a member. Contributed by [@dklimpel](https://github.com/dklimpel). ([\#8306]([matrix-org/synapse#8306](https://github.com/matrix-org/synapse/pull/8306)))
- Add `uk.half-shot.msc2778.login.application_service` login type to allow appservices to login. ([\#8320]([matrix-org/synapse#8320](https://github.com/matrix-org/synapse/pull/8320)))
- Add a configuration option that allows existing users to log in with OpenID Connect. Contributed by [@BBBSnowball](https://github.com/BBBSnowball) and [@OmmyZhang](https://github.com/OmmyZhang). ([\#8345]([matrix-org/synapse#8345](https://github.com/matrix-org/synapse/pull/8345)))
- Add prometheus metrics for replication requests. ([\#8406]([matrix-org/synapse#8406](https://github.com/matrix-org/synapse/pull/8406)))
- Support passing additional single sign-on parameters to the client. ([\#8413]([matrix-org/synapse#8413](https://github.com/matrix-org/synapse/pull/8413)))
- Add experimental reporting of metrics on expensive rooms for state-resolution. ([\#8420]([matrix-org/synapse#8420](https://github.com/matrix-org/synapse/pull/8420)))
- Add experimental prometheus metric to track numbers of "large" rooms for state resolutiom. ([\#8425]([matrix-org/synapse#8425](https://github.com/matrix-org/synapse/pull/8425)))
- Add prometheus metrics to track federation delays. ([\#8430]([matrix-org/synapse#8430](https://github.com/matrix-org/synapse/pull/8430)))

Bugfixes
--------

- Fix a bug in the media repository where remote thumbnails with the same size but different crop methods would overwrite each other. Contributed by [@deepbluev7](https://github.com/deepbluev7). ([\#7124]([matrix-org/synapse#7124](https://github.com/matrix-org/synapse/pull/7124)))
- Fix inconsistent handling of non-existent push rules, and stop tracking the `enabled` state of removed push rules. ([\#7796]([matrix-org/synapse#7796](https://github.com/matrix-org/synapse/pull/7796)))
- Fix a longstanding bug when storing a media file with an empty `upload_name`. ([\#7905]([matrix-org/synapse#7905](https://github.com/matrix-org/synapse/pull/7905)))
- Fix messages not being sent over federation until an event is sent into the same room. ([\#8230]([matrix-org/synapse#8230](https://github.com/matrix-org/synapse/pull/8230)), [\#8247]([matrix-org/synapse#8247](https://github.com/matrix-org/synapse/pull/8247)), [\#8258]([matrix-org/synapse#8258](https://github.com/matrix-org/synapse/pull/8258)), [\#8272]([matrix-org/synapse#8272](https://github.com/matrix-org/synapse/pull/8272)), [\#8322]([matrix-org/synapse#8322](https://github.com/matrix-org/synapse/pull/8322)))
- Fix a longstanding bug where files that could not be thumbnailed would result in an Internal Server Error. ([\#8236]([matrix-org/synapse#8236](https://github.com/matrix-org/synapse/pull/8236)), [\#8435]([matrix-org/synapse#8435](https://github.com/matrix-org/synapse/pull/8435)))
- Upgrade minimum version of `canonicaljson` to version 1.4.0, to fix an unicode encoding issue. ([\#8262]([matrix-org/synapse#8262](https://github.com/matrix-org/synapse/pull/8262)))
- Fix longstanding bug which could lead to incomplete database upgrades on SQLite. ([\#8265]([matrix-org/synapse#8265](https://github.com/matrix-org/synapse/pull/8265)))
- Fix stack overflow when stderr is redirected to the logging system, and the logging system encounters an error. ([\#8268]([matrix-org/synapse#8268](https://github.com/matrix-org/synapse/pull/8268)))
- Fix a bug which cause the logging system to report errors, if `DEBUG` was enabled and no `context` filter was applied. ([\#8278]([matrix-org/synapse#8278](https://github.com/matrix-org/synapse/pull/8278)))
- Fix edge case where push could get delayed for a user until a later event was pushed. ([\#8287]([matrix-org/synapse#8287](https://github.com/matrix-org/synapse/pull/8287)))
- Fix fetching malformed events from remote servers. ([\#8324]([matrix-org/synapse#8324](https://github.com/matrix-org/synapse/pull/8324)))
- Fix `UnboundLocalError` from occuring when appservices send a malformed register request. ([\#8329]([matrix-org/synapse#8329](https://github.com/matrix-org/synapse/pull/8329)))
- Don't send push notifications to expired user accounts. ([\#8353]([matrix-org/synapse#8353](https://github.com/matrix-org/synapse/pull/8353)))
- Fix a regression in v1.19.0 with reactivating users through the admin API. ([\#8362]([matrix-org/synapse#8362](https://github.com/matrix-org/synapse/pull/8362)))
- Fix a bug where during device registration the length of the device name wasn't limited. ([\#8364]([matrix-org/synapse#8364](https://github.com/matrix-org/synapse/pull/8364)))
- Include `guest_access` in the fields that are checked for null bytes when updating `room_stats_state`. Broke in v1.7.2. ([\#8373]([matrix-org/synapse#8373](https://github.com/matrix-org/synapse/pull/8373)))
- Fix theoretical race condition where events are not sent down `/sync` if the synchrotron worker is restarted without restarting other workers. ([\#8374]([matrix-org/synapse#8374](https://github.com/matrix-org/synapse/pull/8374)))
- Fix a bug which could cause errors in rooms with malformed membership events, on servers using sqlite. ([\#8385]([matrix-org/synapse#8385](https://github.com/matrix-org/synapse/pull/8385)))
- Fix "Re-starting finished log context" warning when receiving an event we already had over federation. ([\#8398]([matrix-org/synapse#8398](https://github.com/matrix-org/synapse/pull/8398)))
- Fix incorrect handling of timeouts on outgoing HTTP requests. ([\#8400]([matrix-org/synapse#8400](https://github.com/matrix-org/synapse/pull/8400)))
- Fix a regression in v1.20.0 in the `synapse_port_db` script regarding the `ui_auth_sessions_ips` table. ([\#8410]([matrix-org/synapse#8410](https://github.com/matrix-org/synapse/pull/8410)))
- Remove unnecessary 3PID registration check when resetting password via an email address. Bug introduced in v0.34.0rc2. ([\#8414]([matrix-org/synapse#8414](https://github.com/matrix-org/synapse/pull/8414)))

Improved Documentation
----------------------

- Add `/_synapse/client` to the reverse proxy documentation. ([\#8227]([matrix-org/synapse#8227](https://github.com/matrix-org/synapse/pull/8227)))
- Add note to the reverse proxy settings documentation about disabling Apache's mod_security2. Contributed by Julian Fietkau ([@jfietkau](https://github.com/jfietkau)). ([\#8375]([matrix-org/synapse#8375](https://github.com/matrix-org/synapse/pull/8375)))
- Improve description of `server_name` config option in `homserver.yaml`. ([\#8415]([matrix-org/synapse#8415](https://github.com/matrix-org/synapse/pull/8415)))

Deprecations and Removals
-------------------------

- Drop support for `prometheus_client` older than 0.4.0. ([\#8426]([matrix-org/synapse#8426](https://github.com/matrix-org/synapse/pull/8426)))

Internal Changes
----------------

- Fix tests on distros which disable TLSv1.0. Contributed by [@danc86](https://github.com/danc86). ([\#8208]([matrix-org/synapse#8208](https://github.com/matrix-org/synapse/pull/8208)))
- Simplify the distributor code to avoid unnecessary work. ([\#8216]([matrix-org/synapse#8216](https://github.com/matrix-org/synapse/pull/8216)))
- Remove the `populate_stats_process_rooms_2` background job and restore functionality to `populate_stats_process_rooms`. ([\#8243]([matrix-org/synapse#8243](https://github.com/matrix-org/synapse/pull/8243)))
- Clean up type hints for `PaginationConfig`. ([\#8250]([matrix-org/synapse#8250](https://github.com/matrix-org/synapse/pull/8250)), [\#8282]([matrix-org/synapse#8282](https://github.com/matrix-org/synapse/pull/8282)))
- Track the latest event for every destination and room for catch-up after federation outage. ([\#8256]([matrix-org/synapse#8256](https://github.com/matrix-org/synapse/pull/8256)))
- Fix non-user visible bug in implementation of `MultiWriterIdGenerator.get_current_token_for_writer`. ([\#8257]([matrix-org/synapse#8257](https://github.com/matrix-org/synapse/pull/8257)))
- Switch to the JSON implementation from the standard library. ([\#8259]([matrix-org/synapse#8259](https://github.com/matrix-org/synapse/pull/8259)))
- Add type hints to `synapse.util.async_helpers`. ([\#8260]([matrix-org/synapse#8260](https://github.com/matrix-org/synapse/pull/8260)))
- Simplify tests that mock asynchronous functions. ([\#8261]([matrix-org/synapse#8261](https://github.com/matrix-org/synapse/pull/8261)))
- Add type hints to `StreamToken` and `RoomStreamToken` classes. ([\#8279]([matrix-org/synapse#8279](https://github.com/matrix-org/synapse/pull/8279)))
- Change `StreamToken.room_key` to be a `RoomStreamToken` instance. ([\#8281]([matrix-org/synapse#8281](https://github.com/matrix-org/synapse/pull/8281)))
- Refactor notifier code to correctly use the max event stream position. ([\#8288]([matrix-org/synapse#8288](https://github.com/matrix-org/synapse/pull/8288)))
- Use slotted classes where possible. ([\#8296]([matrix-org/synapse#8296](https://github.com/matrix-org/synapse/pull/8296)))
- Support testing the local Synapse checkout against the [Complement homeserver test suite](<https://github.com/matrix-org/complement/>). ([\#8317]([matrix-org/synapse#8317](https://github.com/matrix-org/synapse/pull/8317)))
- Update outdated usages of `metaclass` to python 3 syntax. ([\#8326]([matrix-org/synapse#8326](https://github.com/matrix-org/synapse/pull/8326)))
- Move lint-related dependencies to package-extra field, update CONTRIBUTING.md to utilise this. ([\#8330]([matrix-org/synapse#8330](https://github.com/matrix-org/synapse/pull/8330)), [\#8377]([matrix-org/synapse#8377](https://github.com/matrix-org/synapse/pull/8377)))
- Use the `admin_patterns` helper in additional locations. ([\#8331]([matrix-org/synapse#8331](https://github.com/matrix-org/synapse/pull/8331)))
- Fix test logging to allow braces in log output. ([\#8335]([matrix-org/synapse#8335](https://github.com/matrix-org/synapse/pull/8335)))
- Remove `__future__` imports related to Python 2 compatibility. ([\#8337]([matrix-org/synapse#8337](https://github.com/matrix-org/synapse/pull/8337)))
- Simplify `super()` calls to Python 3 syntax. ([\#8344]([matrix-org/synapse#8344](https://github.com/matrix-org/synapse/pull/8344)))
- Fix bad merge from `release-v1.20.0` branch to `develop`. ([\#8354]([matrix-org/synapse#8354](https://github.com/matrix-org/synapse/pull/8354)))
- Factor out a `_send_dummy_event_for_room` method. ([\#8370]([matrix-org/synapse#8370](https://github.com/matrix-org/synapse/pull/8370)))
- Improve logging of state resolution. ([\#8371]([matrix-org/synapse#8371](https://github.com/matrix-org/synapse/pull/8371)))
- Add type annotations to `SimpleHttpClient`. ([\#8372]([matrix-org/synapse#8372](https://github.com/matrix-org/synapse/pull/8372)))
- Refactor ID generators to use `async with` syntax. ([\#8383]([matrix-org/synapse#8383](https://github.com/matrix-org/synapse/pull/8383)))
- Add `EventStreamPosition` type. ([\#8388]([matrix-org/synapse#8388](https://github.com/matrix-org/synapse/pull/8388)))
- Create a mechanism for marking tests "logcontext clean". ([\#8399]([matrix-org/synapse#8399](https://github.com/matrix-org/synapse/pull/8399)))
- A pair of tiny cleanups in the federation request code. ([\#8401]([matrix-org/synapse#8401](https://github.com/matrix-org/synapse/pull/8401)))
- Add checks on startup that PostgreSQL sequences are consistent with their associated tables. ([\#8402]([matrix-org/synapse#8402](https://github.com/matrix-org/synapse/pull/8402)))
- Do not include appservice users when calculating the total MAU for a server. ([\#8404]([matrix-org/synapse#8404](https://github.com/matrix-org/synapse/pull/8404)))
- Typing fixes for `synapse.handlers.federation`. ([\#8422]([matrix-org/synapse#8422](https://github.com/matrix-org/synapse/pull/8422)))
- Various refactors to simplify stream token handling. ([\#8423]([matrix-org/synapse#8423](https://github.com/matrix-org/synapse/pull/8423)))
- Make stream token serializing/deserializing async. ([\#8427]([matrix-org/synapse#8427](https://github.com/matrix-org/synapse/pull/8427)))
```

[babolivier](/babolivier)
pushed a commit
that referenced
this pull request
[Sep 1, 2021](#ref-commit-56e2477)
[![@anoadragon453](https://avatars.githubusercontent.com/u/1342360?s=40&u=7f088d81b921aa0a2915a336c647e7813ca85e1a&v=4)](/anoadragon453)

`[Merge commit '6a8fd03ac' into anoa/dinsic_release_1_21_x](/matrix-org/synapse/commit/56e24772189df8b554313f5921c1b3c4740f609a "Merge commit '6a8fd03ac' into anoa/dinsic_release_1_21_x

* commit '6a8fd03ac':
  1.21.0rc2
  1.21.0rc2
  Fix bug in remote thumbnail search (#8438)
  Fix DB query on startup for negative streams. (#8447)
  Convert additional templates to Jinja (#8444)
  Fix malformed log line in new federation \"catch up\" logic (#8442)
  Do not expose the experimental appservice login flow to clients. (#8440)
  update changelog
  fix a logging error in thumbnailer (#8435)
  changelog fixes
  fix version number")`
…

`[56e2477](/matrix-org/synapse/commit/56e24772189df8b554313f5921c1b3c4740f609a)`

```
* commit '6a8fd03ac':
  1.21.0rc2
  1.21.0rc2
  Fix bug in remote thumbnail search ([#8438](https://github.com/matrix-org/synapse/pull/8438))
  Fix DB query on startup for negative streams. ([#8447](https://github.com/matrix-org/synapse/pull/8447))
  Convert additional templates to Jinja ([#8444](https://github.com/matrix-org/synapse/pull/8444))
  Fix malformed log line in new federation "catch up" logic ([#8442](https://github.com/matrix-org/synapse/pull/8442))
  Do not expose the experimental appservice login flow to clients. ([#8440](https://github.com/matrix-org/synapse/pull/8440))
  update changelog
  fix a logging error in thumbnailer ([#8435](https://github.com/matrix-org/synapse/pull/8435))
  changelog fixes
  fix version number
```

[babolivier](/babolivier)
pushed a commit
that referenced
this pull request
[Sep 1, 2021](#ref-commit-e15cca7)
[![@anoadragon453](https://avatars.githubusercontent.com/u/1342360?s=40&u=7f088d81b921aa0a2915a336c647e7813ca85e1a&v=4)](/anoadragon453)

`[Merge commit 'f76194a02' into anoa/dinsic_release_1_21_x](/matrix-org/synapse/commit/e15cca700b4e15f036fa46d8e626d1f488085b12 "Merge commit 'f76194a02' into anoa/dinsic_release_1_21_x

* commit 'f76194a02':
  1.21.0
  Update change log
  1.21.0rc3
  Reduce serialization errors in MultiWriterIdGen (#8456)
  Add Ubuntu 20.10 (Groovy Gorilla) to build scripts. (#8475)
  move #8444 to 'feature'
  linkify changelog")`
…

`[e15cca7](/matrix-org/synapse/commit/e15cca700b4e15f036fa46d8e626d1f488085b12)`

```
* commit 'f76194a02':
  1.21.0
  Update change log
  1.21.0rc3
  Reduce serialization errors in MultiWriterIdGen ([#8456](https://github.com/matrix-org/synapse/pull/8456))
  Add Ubuntu 20.10 (Groovy Gorilla) to build scripts. ([#8475](https://github.com/matrix-org/synapse/pull/8475))
  move [#8444](https://github.com/matrix-org/synapse/pull/8444) to 'feature'
  linkify changelog
```

[Sign up for free](/join?source=comment-repo)
**to subscribe to this conversation on GitHub**.
Already have an account?
[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fpull%2F8444).

Reviewers

[![@anoadragon453](https://avatars.githubusercontent.com/u/1342360?s=40&v=4)](/anoadragon453) [anoadragon453](/anoadragon453)

anoadragon453 approved these changes

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

3 participants

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=52&v=4)](/clokep) [![@michaelkaye](https://avatars.githubusercontent.com/u/1917473?s=52&v=4)](/michaelkaye) [![@anoadragon453](https://avatars.githubusercontent.com/u/1342360?s=52&v=4)](/anoadragon453)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


