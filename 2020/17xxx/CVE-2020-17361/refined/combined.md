=== Content from seclists.org_40022ea0_20250119_123241.html ===

[![](/shared/images/nst-icons.svg#menu)](#menu)
![](/shared/images/nst-icons.svg#close)
[![Home page logo](/images/sitelogo.png)](/)
[Nmap.org](https://nmap.org/)
[Npcap.com](https://npcap.com/)
[Seclists.org](https://seclists.org/)
[Sectools.org](https://sectools.org)
[Insecure.org](https://insecure.org/)

![](/shared/images/nst-icons.svg#search)

[![fulldisclosure logo](/images/fulldisclosure-logo.png)](/fulldisclosure/)
## [Full Disclosure](/fulldisclosure/) mailing list archives

[![Previous](/images/left-icon-16x16.png)](13)
[By Date](date.html#14)
[![Next](/images/right-icon-16x16.png)](15)

[![Previous](/images/left-icon-16x16.png)](13)
[By Thread](index.html#14)
[![Next](/images/right-icon-16x16.png)](15)

![](/shared/images/nst-icons.svg#search)

# Noise-Java ChaChaPolyCipherState.encryptWithAd() insufficient boundary checks

---

*From*: Pietro Oliva via Fulldisclosure <fulldisclosure () seclists org>

*Date*: Wed, 2 Sep 2020 08:00:13 +0000

---

```
Vulnerability title: Noise-Java ChaChaPolyCipherState.encryptWithAd() insufficient boundary checks
Author: Pietro Oliva
CVE: CVE-2020-25021
Vendor: Rhys Weatherley (Creator of Noise Framework's reference implementation in Java)
Product: Noise-Java
Affected version: No version information is currently available.
Fixed version:    Check latest commit and pull request

Description:
The issue is located in the ChaChaPolyCipherState.encryptWithAd() method
defined in ChaChaPolyCipherState.java, where multiple boundary checks are
performed to prevent invalid length or offsets from being specified for the
encrypt or copy operation. However, some checks were found to be either
incomplete or missing, which would likely lead to the following scenarios:
- Out-of-bounds read or write with huge plaintextOffset, negative cipertextOffset,
  or negative length (Depending on the underlying JVM's validation).
- Exception thrown by the JVM instead of Noise-Java throwing ShortBufferException

Impact:
Further checks might be implemented in the JVM and an exception might be thrown
before attempting any operation with invalid arguments.
If that is not the case, OOB read/write or a silent return on invalid arguments
might occur. This could in turn lead to arbitrary code execution in the context
of the JVM, memory disclosure, denial of service, or data loss.

Proof of concept:
Depending on the JVM, running the following code will result in either OOB read
(see CVE-2020-17360 in Avian JVM) or exception being thrown by the JVM:

package com.southernstorm.noise.protocol;

public class poc {

    public static void main(String[] args) {
        byte[] plaintext = "This is my plaintext".getBytes();
        byte[] ciphertext = new byte[plaintext.length];
        CipherState cs = new ChaChaPolyCipherState();

        // Passing a large plaintextOffset should result in a ShortBufferException
        // instead of relying on the JMV's implementation of System.arraycopy.
        try {
                cs.encryptWithAd(null, plaintext, 0x7fffffff, ciphertext, 0, 1);
        }
        catch(Exception e){
                System.out.println("An exception has been thrown: " + e);
        }

    }
}

Evidence:

public int encryptWithAd(byte[] ad, byte[] plaintext, int plaintextOffset,
        byte[] ciphertext, int ciphertextOffset, int length) throws ShortBufferException {
    int space;
    if (ciphertextOffset > ciphertext.length) // BUG: ciphertextOffset could be negative,
                                              // bypassing this length check
        space = 0;
    else
        space = ciphertext.length - ciphertextOffset;
        // BUG: a negative ciphertextOffset would increase the space instead of decreasing it

    if (!haskey) {
        if (length > space) // BUG: this check can be bypassed with negative ciphertextOffset
            throw new ShortBufferException();
        if (plaintext != ciphertext || plaintextOffset != ciphertextOffset)

            /* Multiple issues here:
            1. plaintextOffset is never checked. Depending on the JVM's implementation,
               This could result in OOB read in arraycopy (see CVE-2020-17360 for Avian JVM) or
               exception being thrown.
            2. ciphertextOffset could be negative, bypassing the checks on the length.
               Depending on the JVM, this could result in OOB read/write or exception being thrown.
            3. If the length is negative, depending on the JVM, arraycopy could result in OOB
               read/write, exception being thrown, or silent return (e.g. CVE-2020-17360 in Avian) */

            System.arraycopy(plaintext, plaintextOffset, ciphertext, ciphertextOffset, length);
        return length;
    }
    if (space < 16 || length > (space - 16))
        throw new ShortBufferException();
    setup(ad);

    /* Multiple issues here as well:
        1. plaintextOffset is never checked. this could result in an exception being thrown
           by the JVM.
        2. ciphertextOffset could be negative, bypassing the checks on the length.
           Depending on the JVM, this could result in OOB write in arraycopy or exception being thrown.
        3. length could be negative. Depending on the JVM, this could result in OOB write in arraycopy
           or exception being thrown. */

    encrypt(plaintext, plaintextOffset, ciphertext, ciphertextOffset, length);
    poly.update(ciphertext, ciphertextOffset, length);
    finish(ad, length);
    System.arraycopy(polyKey, 0, ciphertext, ciphertextOffset + length, 16);
    return length + 16;
}

As can be seen in the above code, multiple boundary checks are either missing
or incomplete, allowing for invalid length or offsets to be passed to the JVM's
implementation of System.arraycopy or other methods that handle encryption.
Depending on the JVM in use and how the missing/incomplete checks are exploited,
this could result in either OOB read/write, silent return, or exception thrown
by the underlying JVM. OOB read/write could result in memory/secrets disclosure,
arbitrary code execution in the context of the JVM, or crash.

Mitigating factors:
Unless the JVM has some vulnerability on its own (such as CVE-2020-17360 and
CVE-2020-17361 in Avian JVM), this vulnerability would likely result in an
unhandled exception being thrown and/or crash of the JVM process.

Remediation:
The fixes for this vulnerability can be found below:
<https://github.com/rweather/noise-java/commit/18e86b6f8bea7326934109aa9ffa705ebf4bde90>
<https://github.com/rweather/noise-java/pull/12/files>

Disclosure timeline:
28th Aug 2020  - Vulnerability reported to vendor.
29th Aug 2020  - Patch committed by vendor.
2nd Sept 2020  - Improvement for this patch provided by vulnerability reporter.
2nd Sept 2020  - Vulnerability details are made public.

_______________________________________________
Sent through the Full Disclosure mailing list
<https://nmap.org/mailman/listinfo/fulldisclosure>
Web Archives & RSS: <http://seclists.org/fulldisclosure/>

```

---

[![Previous](/images/left-icon-16x16.png)](13)
[By Date](date.html#14)
[![Next](/images/right-icon-16x16.png)](15)

[![Previous](/images/left-icon-16x16.png)](13)
[By Thread](index.html#14)
[![Next](/images/right-icon-16x16.png)](15)

### Current thread:

* **Noise-Java ChaChaPolyCipherState.encryptWithAd() insufficient boundary checks** *Pietro Oliva via Fulldisclosure (Sep 04)*

![](/shared/images/nst-icons.svg#search)

## [Nmap Security Scanner](https://nmap.org/)

* [Ref Guide](https://nmap.org/book/man.html)* [Install Guide](https://nmap.org/book/install.html)* [Docs](https://nmap.org/docs.html)* [Download](https://nmap.org/download.html)* [Nmap OEM](https://nmap.org/oem/)

## [Npcap packet capture](https://npcap.com/)

* [User's Guide](https://npcap.com/guide/)* [API docs](https://npcap.com/guide/npcap-devguide.html#npcap-api)* [Download](https://npcap.com/#download)* [Npcap OEM](https://npcap.com/oem/)

## [Security Lists](https://seclists.org/)

* [Nmap Announce](https://seclists.org/nmap-announce/)* [Nmap Dev](https://seclists.org/nmap-dev/)* [Full Disclosure](https://seclists.org/fulldisclosure/)* [Open Source Security](https://seclists.org/oss-sec/)* [BreachExchange](https://seclists.org/dataloss/)

## [Security Tools](https://sectools.org)

* [Vuln scanners](https://sectools.org/tag/vuln-scanners/)* [Password audit](https://sectools.org/tag/pass-audit/)* [Web scanners](https://sectools.org/tag/web-scanners/)* [Wireless](https://sectools.org/tag/wireless/)* [Exploitation](https://sectools.org/tag/sploits/)

## [About](https://insecure.org/)

* [About/Contact](https://insecure.org/fyodor/)* [Privacy](https://insecure.org/privacy.html)* [Advertising](https://insecure.org/advertising.html)* [Nmap Public Source License](https://nmap.org/npsl/)

[![](/shared/images/nst-icons.svg#twitter)](https://twitter.com/nmap "Visit us on Twitter")
[![](/shared/images/nst-icons.svg#facebook)](https://facebook.com/nmap "Visit us on Facebook")
[![](/shared/images/nst-icons.svg#github)](https://github.com/nmap/ "Visit us on Github")
[![](/shared/images/nst-icons.svg#reddit)](https://reddit.com/r/nmap/ "Discuss Nmap on Reddit")



=== Content from seclists.org_e98afaa7_20250119_123240.html ===

[![](/shared/images/nst-icons.svg#menu)](#menu)
![](/shared/images/nst-icons.svg#close)
[![Home page logo](/images/sitelogo.png)](/)
[Nmap.org](https://nmap.org/)
[Npcap.com](https://npcap.com/)
[Seclists.org](https://seclists.org/)
[Sectools.org](https://sectools.org)
[Insecure.org](https://insecure.org/)

![](/shared/images/nst-icons.svg#search)

[![fulldisclosure logo](/images/fulldisclosure-logo.png)](/fulldisclosure/)
## [Full Disclosure](/fulldisclosure/) mailing list archives

[![Previous](/images/left-icon-16x16.png)](10)
[By Date](date.html#11)
[![Next](/images/right-icon-16x16.png)](13)

[![Previous](/images/left-icon-16x16.png)](10)
[By Thread](index.html#11)
[![Next](/images/right-icon-16x16.png)](13)

![](/shared/images/nst-icons.svg#search)

# Noise-Java AESGCMFallbackCipherState.encryptWithAd() insufficient boundary checks

---

*From*: Pietro Oliva via Fulldisclosure <fulldisclosure () seclists org>

*Date*: Wed, 2 Sep 2020 07:56:22 +0000

---

```
Vulnerability title: Noise-Java AESGCMFallbackCipherState.encryptWithAd() insufficient boundary checks
Author: Pietro Oliva
CVE: CVE-2020-25022
Vendor: Rhys Weatherley (Creator of Noise Framework's reference implementation in Java)
Product: Noise-Java
Affected version: No version information is currently available.
Fixed version:    Check latest commit and pull request

Description:
The issue is located in the AESGCMFallbackCipherState.encryptWithAd() method
defined in AESGCMFallbackCipherState.java, where multiple boundary checks are
performed to prevent invalid length or offsets from being specified for the
encrypt or copy operation. However, some checks were found to be either
incomplete or missing, which would likely lead to the following scenarios:
- Out-of-bounds read or write with huge plaintextOffset, negative cipertextOffset,
  or negative length (Depending on the underlying JVM's validation).
- Exception thrown by the JVM instead of Noise-Java throwing ShortBufferException

Impact:
Further checks might be implemented in the JVM and an exception might be thrown
before attempting any operation with invalid arguments.
If that is not the case, OOB read/write or a silent return on invalid arguments
might occur. This could in turn lead to arbitrary code execution in the context
of the JVM, memory disclosure, denial of service, or data loss.

Proof of concept:
Depending on the JVM, running the following code will result in either OOB read
(see CVE-2020-17360 in Avian JVM) or exception being thrown by the JVM:

package com.southernstorm.noise.protocol;

public class poc {

    public static void main(String[] args) {
        byte[] plaintext = "This is my plaintext".getBytes();
        byte[] ciphertext = new byte[plaintext.length];
        CipherState cs = new AESGCMFallbackCipherState();

        // Passing a large plaintextOffset should result in  a ShortBufferException
        //   instead of relying on the JMV's implementation of System.arraycopy.
        try {
                cs.encryptWithAd(null, plaintext, 0x7fffffff, ciphertext, 0, 1);
        }
        catch(Exception e){
                System.out.println("An exception has been thrown: " + e);
        }

    }
}

Evidence:

public int encryptWithAd(byte[] ad, byte[] plaintext, int plaintextOffset,
        byte[] ciphertext, int ciphertextOffset, int length)
            throws ShortBufferException {
    int space;
    if (ciphertextOffset > ciphertext.length) // BUG: ciphertextOffset could be negative,
                                              // bypassing this length check
        space = 0;
    else
        space = ciphertext.length - ciphertextOffset;
        // BUG: a negative ciphertextOffset would increase the space instead of decreasing it

    if (!haskey) {
        if (length > space) // BUG: this check can be bypassed with negative ciphertextOffset
            throw new ShortBufferException();
            if (plaintext != ciphertext || plaintextOffset != ciphertextOffset)

            /* Multiple issues here:
            1. plaintextOffset is never checked. Depending on the JVM's implementation,
               This could result in OOB read in arraycopy (see CVE-2020-17360 for Avian JVM) or
               exception being thrown.
            2. ciphertextOffset could be negative, bypassing the checks on the length.
               Depending on the JVM, this could result in OOB read/write or exception being thrown.
            3. If the length is negative, depending on the JVM, arraycopy could result in OOB
               read/write, exception being thrown, or silent return (e.g. CVE-2020-17360 in Avian) */

                System.arraycopy(plaintext, plaintextOffset, ciphertext, ciphertextOffset, length);
            return length;
        }
        if (space < 16 || length > (space - 16)) // BUG: this can be bypassed with negative length
            throw new ShortBufferException();
    setup(ad);

            /* Multiple issues here as well:
            1. plaintextOffset is never checked. this could result in an exception being thrown
               by the JVM.
            2. ciphertextOffset could be negative, bypassing the checks on the length.
               Depending on the JVM, this could result in OOB write in arraycopy or exception being thrown.
            3. length could be negative. Depending on the JVM, this could result in OOB write in arraycopy
               or exception being thrown. */

    encryptCTR(plaintext, plaintextOffset, ciphertext, ciphertextOffset, length);
    ghash.update(ciphertext, ciphertextOffset, length);
    ghash.pad(ad != null ? ad.length : 0, length);
    ghash.finish(ciphertext, ciphertextOffset + length, 16);
    for (int index = 0; index < 16; ++index)
        ciphertext[ciphertextOffset + length + index] ^= hashKey[index];
    return length + 16;
}

As can be seen in the above code, multiple boundary checks are either missing
or incomplete, allowing for invalid length or offsets to be passed to the JVM's
implementation of System.arraycopy or other methods that handle encryption.
Depending on the JVM in use and how the missing/incomplete checks are exploited,
this could result in either OOB read/write, silent return, or exception thrown
by the underlying JVM. OOB read/write could result in memory/secrets disclosure,
arbitrary code execution in the context of the JVM, or crash.

Mitigating factors:
Unless the JVM has some vulnerability on its own (such as CVE-2020-17360 and
CVE-2020-17361 in Avian JVM), this vulnerability would likely result in an
unhandled exception being thrown and/or crash of the JVM process.

Remediation:
The fixes for this vulnerability can be found below:
<https://github.com/rweather/noise-java/commit/18e86b6f8bea7326934109aa9ffa705ebf4bde90>
<https://github.com/rweather/noise-java/pull/12/files>

Disclosure timeline:
28th Aug 2020  - Vulnerability reported to vendor.
29th Aug 2020  - Patch committed by vendor.
2nd Sept 2020  - Improvement for this patch provided by vulnerability reporter.
2nd Sept 2020  - Vulnerability details are made public.

_______________________________________________
Sent through the Full Disclosure mailing list
<https://nmap.org/mailman/listinfo/fulldisclosure>
Web Archives & RSS: <http://seclists.org/fulldisclosure/>

```

---

[![Previous](/images/left-icon-16x16.png)](10)
[By Date](date.html#11)
[![Next](/images/right-icon-16x16.png)](13)

[![Previous](/images/left-icon-16x16.png)](10)
[By Thread](index.html#11)
[![Next](/images/right-icon-16x16.png)](13)

### Current thread:

* **Noise-Java AESGCMFallbackCipherState.encryptWithAd() insufficient boundary checks** *Pietro Oliva via Fulldisclosure (Sep 04)*

![](/shared/images/nst-icons.svg#search)

## [Nmap Security Scanner](https://nmap.org/)

* [Ref Guide](https://nmap.org/book/man.html)* [Install Guide](https://nmap.org/book/install.html)* [Docs](https://nmap.org/docs.html)* [Download](https://nmap.org/download.html)* [Nmap OEM](https://nmap.org/oem/)

## [Npcap packet capture](https://npcap.com/)

* [User's Guide](https://npcap.com/guide/)* [API docs](https://npcap.com/guide/npcap-devguide.html#npcap-api)* [Download](https://npcap.com/#download)* [Npcap OEM](https://npcap.com/oem/)

## [Security Lists](https://seclists.org/)

* [Nmap Announce](https://seclists.org/nmap-announce/)* [Nmap Dev](https://seclists.org/nmap-dev/)* [Full Disclosure](https://seclists.org/fulldisclosure/)* [Open Source Security](https://seclists.org/oss-sec/)* [BreachExchange](https://seclists.org/dataloss/)

## [Security Tools](https://sectools.org)

* [Vuln scanners](https://sectools.org/tag/vuln-scanners/)* [Password audit](https://sectools.org/tag/pass-audit/)* [Web scanners](https://sectools.org/tag/web-scanners/)* [Wireless](https://sectools.org/tag/wireless/)* [Exploitation](https://sectools.org/tag/sploits/)

## [About](https://insecure.org/)

* [About/Contact](https://insecure.org/fyodor/)* [Privacy](https://insecure.org/privacy.html)* [Advertising](https://insecure.org/advertising.html)* [Nmap Public Source License](https://nmap.org/npsl/)

[![](/shared/images/nst-icons.svg#twitter)](https://twitter.com/nmap "Visit us on Twitter")
[![](/shared/images/nst-icons.svg#facebook)](https://facebook.com/nmap "Visit us on Facebook")
[![](/shared/images/nst-icons.svg#github)](https://github.com/nmap/ "Visit us on Github")
[![](/shared/images/nst-icons.svg#reddit)](https://reddit.com/r/nmap/ "Discuss Nmap on Reddit")



=== Content from github.com_718ef262_20250119_123242.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FReadyTalk%2Favian%2Fissues)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FReadyTalk%2Favian%2Fissues)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fissues%2Findex&source=header-repo&source_repo=ReadyTalk%2Favian)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ReadyTalk](/ReadyTalk)
/
**[avian](/ReadyTalk/avian)**
Public

* [Notifications](/login?return_to=%2FReadyTalk%2Favian) You must be signed in to change notification settings
* [Fork
  175](/login?return_to=%2FReadyTalk%2Favian)
* [Star
   1.2k](/login?return_to=%2FReadyTalk%2Favian)

* [Code](/ReadyTalk/avian)
* [Issues
  35](/ReadyTalk/avian/issues)
* [Pull requests
  3](/ReadyTalk/avian/pulls)
* [Actions](/ReadyTalk/avian/actions)
* [Projects
  0](/ReadyTalk/avian/projects)
* [Wiki](/ReadyTalk/avian/wiki)
* [Security](/ReadyTalk/avian/security)
* [Insights](/ReadyTalk/avian/pulse)

Additional navigation options

* [Code](/ReadyTalk/avian)
* [Issues](/ReadyTalk/avian/issues)
* [Pull requests](/ReadyTalk/avian/pulls)
* [Actions](/ReadyTalk/avian/actions)
* [Projects](/ReadyTalk/avian/projects)
* [Wiki](/ReadyTalk/avian/wiki)
* [Security](/ReadyTalk/avian/security)
* [Insights](/ReadyTalk/avian/pulse)

Preview
# Issues

Search Issuesis:issue state:openSearch

[Labels](labels)[Milestones](milestones)[New issue](/login?return_to=)
## Search results

OpenClosedAuthorLabelsProjectsMilestonesAssigneesTypesNewest

* ### [Fails to compile on a modern Linux system, fixed via PR](/ReadyTalk/avian/issues/569)

  Status: Open.#569 In ReadyTalk/avian;· [paulie-g](/ReadyTalk/avian/issues?q=is%3Aissue%20state%3Aopen%20author%3Apaulie-g)  opened on Mar 31, 2019
* ### [File Descriptor Leak in NIO](/ReadyTalk/avian/issues/566)

  Status: Open.#566 In ReadyTalk/avian;· [mretallack](/ReadyTalk/avian/issues?q=is%3Aissue%20state%3Aopen%20author%3Amretallack)  opened on Oct 17, 2018
* ### [java/lang/annotation/AnnotationFormatError: Unexpected end of annotations.](/ReadyTalk/avian/issues/565)

  Status: Open.#565 In ReadyTalk/avian;· [chinacharis](/ReadyTalk/avian/issues?q=is%3Aissue%20state%3Aopen%20author%3Achinacharis)  opened on Sep 25, 2018
* ### [invokedynamic leads to accessing null dynamicTable in addDynamic.](/ReadyTalk/avian/issues/564)

  Status: Open.#564 In ReadyTalk/avian;· [Poddster](/ReadyTalk/avian/issues?q=is%3Aissue%20state%3Aopen%20author%3APoddster)  opened on Sep 7, 2018
* ### [Yet another lambda problem](/ReadyTalk/avian/issues/563)

  Status: Open.#563 In ReadyTalk/avian;· [teras](/ReadyTalk/avian/issues?q=is%3Aissue%20state%3Aopen%20author%3Ateras)  opened on Jul 11, 2018
* ### [Getting a ClassCastException when trying to get class annotations](/ReadyTalk/avian/issues/562)

  Status: Open.#562 In ReadyTalk/avian;· [amirabiri](/ReadyTalk/avian/issues?q=is%3Aissue%20state%3Aopen%20author%3Aamirabiri)  opened on Jun 22, 2018
* ### [Is possible to build a GUI using Swing/JavaFX or at least AWT??](/ReadyTalk/avian/issues/558)

  Status: Open.#558 In ReadyTalk/avian;· [RealAquilus](/ReadyTalk/avian/issues?q=is%3Aissue%20state%3Aopen%20author%3ARealAquilus)  opened on Apr 3, 2018
* ### [Is it possible to embed Avian in C/C++ ?](/ReadyTalk/avian/issues/553)

  Status: Open.#553 In ReadyTalk/avian;· [metacritical](/ReadyTalk/avian/issues?q=is%3Aissue%20state%3Aopen%20author%3Ametacritical)  opened on Jan 15, 2018
* ### [Error trying to run tomcat hello server](/ReadyTalk/avian/issues/537)

  Status: Open.#537 In ReadyTalk/avian;· [AntonBikineev](/ReadyTalk/avian/issues?q=is%3Aissue%20state%3Aopen%20author%3AAntonBikineev)  opened on Jun 27, 2017
* ### [Simple task for embedding avian](/ReadyTalk/avian/issues/528)

  Status: Open.#528 In ReadyTalk/avian;· [nedtwigg](/ReadyTalk/avian/issues?q=is%3Aissue%20state%3Aopen%20author%3Anedtwigg)  opened on Mar 28, 2017
* ### [Error: conflicting types for 'Java\_java\_lang\_Class\_forName0'](/ReadyTalk/avian/issues/519)

  Status: Open.#519 In ReadyTalk/avian;· [somecoolword](/ReadyTalk/avian/issues?q=is%3Aissue%20state%3Aopen%20author%3Asomecoolword)  opened on Feb 2, 2017
* ### [Build with bionic](/ReadyTalk/avian/issues/518)

  Status: Open.#518 In ReadyTalk/avian;· [Wetitpig](/ReadyTalk/avian/issues?q=is%3Aissue%20state%3Aopen%20author%3AWetitpig)  opened on Feb 1, 2017

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from seclists.org_64e0b207_20250119_123241.html ===

[![](/shared/images/nst-icons.svg#menu)](#menu)
![](/shared/images/nst-icons.svg#close)
[![Home page logo](/images/sitelogo.png)](/)
[Nmap.org](https://nmap.org/)
[Npcap.com](https://npcap.com/)
[Seclists.org](https://seclists.org/)
[Sectools.org](https://sectools.org)
[Insecure.org](https://insecure.org/)

![](/shared/images/nst-icons.svg#search)

[![fulldisclosure logo](/images/fulldisclosure-logo.png)](/fulldisclosure/)
## [Full Disclosure](/fulldisclosure/) mailing list archives

[![Previous](/images/left-icon-16x16.png)](11)
[By Date](date.html#13)
[![Next](/images/right-icon-16x16.png)](14)

[![Previous](/images/left-icon-16x16.png)](11)
[By Thread](index.html#13)
[![Next](/images/right-icon-16x16.png)](14)

![](/shared/images/nst-icons.svg#search)

# Noise-Java AESGCMOnCtrCipherState.encryptWithAd() insufficient boundary checks

---

*From*: Pietro Oliva via Fulldisclosure <fulldisclosure () seclists org>

*Date*: Wed, 2 Sep 2020 07:58:30 +0000

---

```
Vulnerability title: Noise-Java AESGCMOnCtrCipherState.encryptWithAd() insufficient boundary checks
Author: Pietro Oliva
CVE: CVE-2020-25023
Vendor: Rhys Weatherley (Creator of Noise Framework's reference implementation in Java)
Product: Noise-Java
Affected version: No version information is currently available.
Fixed version:    Check latest commit and pull request

Description:
The issue is located in the AESGCMOnCtrCipherState.encryptWithAd() method
defined in AESGCMOnCtrCipherState.java, where multiple boundary checks are
performed to prevent invalid length or offsets from being specified for the
encrypt or copy operation. However, some checks were found to be either
incomplete or missing, which would likely lead to the following scenarios:
- Out-of-bounds read or write with huge plaintextOffset, negative cipertextOffset,
  or negative length (Depending on the underlying JVM's validation).
- Exception thrown by the JVM instead of Noise-Java throwing ShortBufferException

Impact:
Further checks might be implemented in the JVM and an exception might be thrown
before attempting any operation with invalid arguments.
If that is not the case, OOB read/write or a silent return on invalid arguments
might occur. This could in turn lead to arbitrary code execution in the context
of the JVM, memory disclosure, denial of service, or data loss.

Proof of concept:
Depending on the JVM, running the following code will result in either OOB read
(see CVE-2020-17360 in Avian JVM) or exception being thrown by the JVM:

package com.southernstorm.noise.protocol;

public class poc {

    public static void main(String[] args) {
        byte[] plaintext = "This is my plaintext".getBytes();
        byte[] ciphertext = new byte[plaintext.length];
        CipherState cs = new AESGCMOnCtrCipherState();

        // Passing a large plaintextOffset should result in a ShortBufferException
        // instead of relying on the JMV's implementation of System.arraycopy.
        try {
                cs.encryptWithAd(null, plaintext, 0x7fffffff, ciphertext, 0, 1);
        }
        catch(Exception e){
                System.out.println("An exception has been thrown: " + e);
        }

    }
}

Evidence:

public int encryptWithAd(byte[] ad, byte[] plaintext, int plaintextOffset,
        byte[] ciphertext, int ciphertextOffset, int length)
            throws ShortBufferException {
    int space;
    if (ciphertextOffset > ciphertext.length) // BUG: ciphertextOffset could be negative,
                                              // bypassing this length check
        space = 0;
    else
        space = ciphertext.length - ciphertextOffset;
        // BUG: a negative ciphertextOffset would increase the space instead of decreasing it
    if (keySpec == null) {
        if (length > space) // BUG: this check can be bypassed with negative ciphertextOffset
            throw new ShortBufferException();
        if (plaintext != ciphertext || plaintextOffset != ciphertextOffset)

            /* Multiple issues here:
            1. plaintextOffset is never checked. Depending on the JVM's implementation,
               This could result in OOB read in arraycopy (see CVE-2020-17360 for Avian JVM) or
               exception being thrown.
            2. ciphertextOffset could be negative, bypassing the checks on the length.
               Depending on the JVM, this could result in OOB read/write or exception being thrown.
            3. If the length is negative, depending on the JVM, arraycopy could result in OOB
               read/write, exception being thrown, or silent return (e.g. CVE-2020-17360 in Avian) */

            System.arraycopy(plaintext, plaintextOffset, ciphertext, ciphertextOffset, length);
        return length;
    }
    if (space < 16 || length > (space - 16)) // BUG: this can be bypassed with negative length
        throw new ShortBufferException();
    try {
        setup(ad);

            /* Multiple issues here as well:
            1. plaintextOffset is never checked. this could result in an exception being thrown
               by the JVM.
            2. ciphertextOffset could be negative, bypassing the checks on the length.
               Depending on the JVM, this could result in OOB write in arraycopy or exception being thrown.
            3. length could be negative. Depending on the JVM, this could result in OOB write in arraycopy
               or exception being thrown. */

        int result = cipher.update(plaintext, plaintextOffset, length, ciphertext, ciphertextOffset);
        cipher.doFinal(ciphertext, ciphertextOffset + result);
    } catch (InvalidKeyException e) {
        // Shouldn't happen.
        throw new IllegalStateException(e);
    } catch (InvalidAlgorithmParameterException e) {
        // Shouldn't happen.
        throw new IllegalStateException(e);
    } catch (IllegalBlockSizeException e) {
        // Shouldn't happen.
        throw new IllegalStateException(e);
    } catch (BadPaddingException e) {
        // Shouldn't happen.
        throw new IllegalStateException(e);
    }
    ghash.update(ciphertext, ciphertextOffset, length);
    ghash.pad(ad != null ? ad.length : 0, length);
    ghash.finish(ciphertext, ciphertextOffset + length, 16);
    for (int index = 0; index < 16; ++index)
        ciphertext[ciphertextOffset + length + index] ^= hashKey[index];
        return length + 16;
    }

As can be seen in the above code, multiple boundary checks are either missing
or incomplete, allowing for invalid length or offsets to be passed to the JVM's
implementation of System.arraycopy or other methods that handle encryption.
Depending on the JVM in use and how the missing/incomplete checks are exploited,
this could result in either OOB read/write, silent return, or exception thrown
by the underlying JVM. OOB read/write could result in memory/secrets disclosure,
arbitrary code execution in the context of the JVM, or crash.

Mitigating factors:
Unless the JVM has some vulnerability on its own (such as CVE-2020-17360 and
CVE-2020-17361 in Avian JVM), this vulnerability would likely result in an
unhandled exception being thrown and/or crash of the JVM process.

Remediation:
The fixes for this vulnerability can be found below:
<https://github.com/rweather/noise-java/commit/18e86b6f8bea7326934109aa9ffa705ebf4bde90>
<https://github.com/rweather/noise-java/pull/12/files>

Disclosure timeline:
28th Aug 2020  - Vulnerability reported to vendor.
29th Aug 2020  - Patch committed by vendor.
2nd Sept 2020  - Improvement for this patch provided by vulnerability reporter.
2nd Sept 2020  - Vulnerability details are made public.

_______________________________________________
Sent through the Full Disclosure mailing list
<https://nmap.org/mailman/listinfo/fulldisclosure>
Web Archives & RSS: <http://seclists.org/fulldisclosure/>

```

---

[![Previous](/images/left-icon-16x16.png)](11)
[By Date](date.html#13)
[![Next](/images/right-icon-16x16.png)](14)

[![Previous](/images/left-icon-16x16.png)](11)
[By Thread](index.html#13)
[![Next](/images/right-icon-16x16.png)](14)

### Current thread:

* **Noise-Java AESGCMOnCtrCipherState.encryptWithAd() insufficient boundary checks** *Pietro Oliva via Fulldisclosure (Sep 04)*

![](/shared/images/nst-icons.svg#search)

## [Nmap Security Scanner](https://nmap.org/)

* [Ref Guide](https://nmap.org/book/man.html)* [Install Guide](https://nmap.org/book/install.html)* [Docs](https://nmap.org/docs.html)* [Download](https://nmap.org/download.html)* [Nmap OEM](https://nmap.org/oem/)

## [Npcap packet capture](https://npcap.com/)

* [User's Guide](https://npcap.com/guide/)* [API docs](https://npcap.com/guide/npcap-devguide.html#npcap-api)* [Download](https://npcap.com/#download)* [Npcap OEM](https://npcap.com/oem/)

## [Security Lists](https://seclists.org/)

* [Nmap Announce](https://seclists.org/nmap-announce/)* [Nmap Dev](https://seclists.org/nmap-dev/)* [Full Disclosure](https://seclists.org/fulldisclosure/)* [Open Source Security](https://seclists.org/oss-sec/)* [BreachExchange](https://seclists.org/dataloss/)

## [Security Tools](https://sectools.org)

* [Vuln scanners](https://sectools.org/tag/vuln-scanners/)* [Password audit](https://sectools.org/tag/pass-audit/)* [Web scanners](https://sectools.org/tag/web-scanners/)* [Wireless](https://sectools.org/tag/wireless/)* [Exploitation](https://sectools.org/tag/sploits/)

## [About](https://insecure.org/)

* [About/Contact](https://insecure.org/fyodor/)* [Privacy](https://insecure.org/privacy.html)* [Advertising](https://insecure.org/advertising.html)* [Nmap Public Source License](https://nmap.org/npsl/)

[![](/shared/images/nst-icons.svg#twitter)](https://twitter.com/nmap "Visit us on Twitter")
[![](/shared/images/nst-icons.svg#facebook)](https://facebook.com/nmap "Visit us on Facebook")
[![](/shared/images/nst-icons.svg#github)](https://github.com/nmap/ "Visit us on Github")
[![](/shared/images/nst-icons.svg#reddit)](https://reddit.com/r/nmap/ "Discuss Nmap on Reddit")


