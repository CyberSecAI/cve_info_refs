=== Content from blog.sonarsource.com_e87aea8d_20250119_114353.html ===
NEW![Sonar has entered a definitive agreement to acquire Tidelift! Read the press release.](/company/press-releases/sonar-to-acquire-tidelift/) [![](data:image/svg+xml;charset=utf-8...)![sonar logo ](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/8e59bcad-6e39-41dc-abd9-a0e251e8d63f/Sonar%20%282%29.svg?w=128&h=32&auto=format&fit=clip)![sonar logo ](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/8e59bcad-6e39-41dc-abd9-a0e251e8d63f/Sonar%20%282%29.svg?w=128&h=32&auto=format&fit=clip)](/ "Home")

* Solutions

  Use Cases

  [AI-assisted & quality-assured codeEnsure code generated by AI assistants is of the highest quality](/solutions/ai/)[DevOps transformationHarness the full potential of DevOps by reducing roll backs and improving quality of releases](/solutions/devops-transformation/)[Code coverageEnsure code quality and security by facilitating faster debugging through clear visibility of coverage gaps.](/solutions/code-coverage/) [Reduce & manage technical debtMaximize innovation by proactively managing technical debt](/solutions/reduce-technical-debt/)[Secure by designIntegrate code security in compliance with NIST Secure Software Development Framework](/solutions/secure-by-design-code/)[All Use CasesRead more about Sonar Use cases with blog articles, technical articles and developer guides](/solutions/use-cases/)

  Clean Code

  [What is clean codeA detailed definition of Clean Code](/solutions/clean-code/)[Power of clean codeBusiness success built on Clean Code](/solutions/power-of-clean-code/)[Security starts with Clean CodeStatic Application Security Testing with Sonar](/solutions/security/)[Clean as You CodeOur unique approach to Clean Code](/solutions/our-unique-approach/)

  Something For Everyone

  [For DevelopersFind and fix issues as you code](/solutions/for-developers/)[For DevOpsBuild your apps on Clean Code foundations](/solutions/infrastructure-as-code/)[For EnterpriseClean Code delivery from development to production](/solutions/for-enterprise/)[For the Public SectorClean Code for the public sector](/solutions/public-sector/)
* Products

  Industry Leading Products

  [![]()![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/aa3b1f02-f1b0-448f-a3f2-a1bd32923a08/SQ_Logo_Cloud_Light%20Backgrounds.svg?w=176&h=48&auto=format&fit=crop)Formerly SonarCloudCloud-based static analysis tool for your CI/CD workflows](/products/sonarcloud/)[![]()![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/bdac1871-464e-4051-88db-7df20c3bfffa/SQ_Logo_Server_Light%20Backgrounds.svg?w=176&h=48&auto=format&fit=crop)Formerly SonarQubeSelf-managed static analysis tool for continuous codebase inspection](/products/sonarqube/)[![]()![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/49f23af2-a29b-4d0f-95d7-ffd361f375e1/SQ_Logo_IDE_Light%20Backgrounds.svg?w=176&h=48&auto=format&fit=crop)Formerly SonarLintFree IDE extension that provides on-the-fly analysis and coding guidance](/products/sonarlint/)

  Languages and Frameworks

  [Java](/knowledge/languages/java/)[JavaScript](/knowledge/languages/js/)[TypeScript](/knowledge/languages/ts/)[Python](/knowledge/languages/python/)[C#](/knowledge/languages/csharp/)[C++](/knowledge/languages/cpp/)[C](/knowledge/languages/c/)[PHP](/knowledge/languages/php/)[Kotlin](/knowledge/languages/kotlin/)[See All](/lp/knowledge/languages/)
* Resources

  Learn About Clean Code

  [BlogStay connected with our latest development news and articles](/blog/)[Events hubLet's meet up online or in person - browse our conferences and webinars, or watch previous talks](/resources/events/)[Customer StoriesCheck out Sonar implementation success stories](/resources/customer-stories/)[White PapersFind in-depth articles on clean code](/resources/white-papers/)[LearnDeveloper learning hub - covering essential topics](/learn/)[Solution BriefsOur library of solution briefs](/resources/solution-briefs/)

  Go In Depth

  [SonarQube Server DocumentationFind more information on the technical details of SonarQube Server](https://docs.sonarsource.com/sonarqube/latest/)[SonarQube Cloud DocumentationFind more information on the technical details of SonarQube Cloud](https://docs.sonarsource.com/sonarcloud/)[SonarQube for IDE DocumentationFind more information on the technical details of SonarQube IDE](https://docs.sonarsource.com/sonarlint/)[Explore SonarpediaExplore our publicly available multi-language rules database](https://rules.sonarsource.com/)[LanguagesSee our multi-language coverage](/knowledge/languages/)
* Company

  Deliver Better Software

  [About UsSonar’s industry leading solution enables developers to write clean code and remediate existing code organically](/company/about/)[CareersJoin our growing team](/company/careers/)[Commitment to open sourceOur commitment to transparency, security, and continuous improvement](/solutions/commitment-to-open-source/)[CommunityGet latest updates, suggest features, and share your knowledge](https://community.sonarsource.com/)[PartnersSonar partners with the best resellers to bring Clean Code closer to you](/company/partners/)[Contact usHave questions? Get in touch](/company/contact/)

  Media

  [NewsroomNews announcements, media coverage, and more](/company/newsroom/)[CoverageFind articles about Sonar in the news](/company/coverage/)[Press ReleasesThe latest Sonar updates](/company/press-releases/)[CustomersAn overview of customers using Sonar by industry](/company/customers/)[Press KitExecutive headshots, quick stats, customer logos, and more](/company/press-kit/)
[Start for free](/open-source-editions/)[Explore pricing](/plans-and-pricing/)
Search modal toggle button[Start for free](/open-source-editions/)[Explore pricing](/plans-and-pricing/)Mobile menu toggle button

Blog post

# Code vulnerabilities put health records at risk

![](data:image/svg+xml;charset=utf-8...)![Dennis Brinkrolf photo]()![Dennis Brinkrolf photo](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/4e33a3d4-6781-4fe3-aaa3-0ec178d00386/d118d723-bccb-4102-9d5c-ccf1a2a99e5f_dennis_brinkrolf.png?w=400&h=400&auto=format&fit=crop)

Dennis Brinkrolf

Security Researcher

October 28, 2020

Date

* [Security](/blog/tag/security/)
![](data:image/svg+xml;charset=utf-8...)![OpenEMR is the most popular open source software for electronic health record and medical practice management. It is used world-wide to manage sensitive patient data, including informatio...](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/c0d98af7-6fcf-4743-b562-af6b7a610cab/cover-92be9e22-afe0-4a95-a91d-f479e8a89281_hero%2Brisk.png?w=1200&h=600&auto=format&fit=crop)![OpenEMR is the most popular open source software for electronic health record and medical practice management. It is used world-wide to manage sensitive patient data, including informatio...](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/c0d98af7-6fcf-4743-b562-af6b7a610cab/cover-92be9e22-afe0-4a95-a91d-f479e8a89281_hero%2Brisk.png?w=1200&h=600&auto=format&fit=crop)

OpenEMR is the most popular open source software for electronic health record and medical practice management. It is used world-wide to manage sensitive patient data, including information about medications, laboratory values, and diseases. Patients use OpenEMR to schedule appointments, communicate with physicians, and pay online invoices. Specifically in these tumultuous times of an ongoing pandemic, this is highly sensitive data and protecting it is a concern for everyone, and particularly in the U.S.. Companies in America are required to protect individually identifiable and electronic health information by the Health Insurance Portability and Accountability Act (HIPAA).

During our security research of popular web applications, we discovered several code vulnerabilities in OpenEMR 5.0.2.1. A combination of these vulnerabilities allowed remote attackers to execute arbitrary system commands on any OpenEMR server that uses the Patient Portal component. This can lead to the compromise of sensitive patient data, or worse, to a compromise of critical infrastructure.

In this blog post we analyze the technical root cause of three vulnerabilities and demonstrate how attackers could have built a chain for exploitation. We reported all issues responsibly to the affected vendor who rated the fixes as critical and released a [security patch](https://www.open-emr.org/wiki/index.php/OpenEMR_Patches "security patch") in August immediately to protect all users.

## Impact

During the analysis of OpenEMR 5.0.2.1 we found the following code vulnerabilities:

1. Command Injection (admin privileges) (CVE-2020-36243)
2. Persistent XSS (admin privileges) (CVE-2021-32103)
3. Insecure API permissions (unauthenticated) (CVE-2021-32101)
4. SQL Injection (user privileges) (CVE-2021-32102, CVE-2021-32104)

The vulnerabilities impact OpenEMR's Patient Portal that needs to be active and accessible for online patients. A remote attacker can then insert a malicious JavaScript payload (XSS) into any user account. This works even when the portal's registration feature for new users is disabled.

Depending on the privilege role of the victim, further vulnerabilities in the backend can be exploited when a victim’s browser executes the XSS payload unconsciously. For example, if the victim is an administrator, the attacker can take over the entire server via a Command Injection vulnerability that allows to execute OS system commands. Other, lower privileged user sessions can be misused to exploit SQL injection vulnerabilities that enable to steal patient data from the database.

For demonstration purposes we’ve created a short video that shows how quick and easy a server is compromised.

## Technical Analysis

In the following section, we dive into three of the code vulnerabilities we found in OpenEMR. These can be combined by an attacker to gain pre-auth command execution in the Patient Portal of OpenEMR 5.0.2.1 when targeting an administrator user.

### 1. Command Injection Vulnerability (CVE-2020-36243)

The most critical vulnerability hides in the backend of OpenEMR. Here, administrators can use a feature to create data backups. For this purpose, different SQL queries are constructed dynamically that are later executed **as system commands** when creating the backup file. The following (simplified) code shows the critical code where these system commands are created depending on the operating system (OS).

**interface/main/backup.php**

```
 5   foreach ($_POST['form_sel_layouts'] as $layoutid) {
 6      if (IS_WINDOWS) {
 8         $cmd .= " echo DELETE FROM layout_options WHERE form_id = '" .
                           add_escape_custom($layoutid) . "'; >> " .
                           escapeshellarg($EXPORT_FILE) . " & ";
 9      }
10      else {
11         $cmd .= "echo \"DELETE FROM layout_options WHERE form_id = '" .
                           add_escape_custom($layoutid) . "';\" >> " .
                           escapeshellarg($EXPORT_FILE) . ";";
12      }
13   }
14
15   exec($cmd);
```

In line 5, the values in the HTTP POST parameter `form_sel_layouts` are received and used as `$layoutid` variables. Then these values are concatenated into an OS command `$cmd` in line 11.

As we can see here, the user-controlled input `$layoutid` is sanitized with the help of the function `add_escape_custom()`. This custom function is defined in the OpenEMR code base and makes use of the PHP built-in function `mysqli_real_escape_string()` that is known to protect against SQL injection vulnerabilities. Finally, the concatenated OS command string is executed in line 19. At first sight, it looks like the developers carefully sanitized all user inputs.

To understand why the sanitization is not sufficient in this code we need to understand how commands are executed. When we look at the final value of the variable `$cmd` in line 15, the shell command looks like the following at runtime:

```
echo "DELETE FROM layout_options WHERE form_id = '$layoutid';"  >> /tmp/export;
```

Here, the variable `$layoutid` contains a user-controlled value. But why does the `add_escape_custom()` function not fully protect against a Command Injection vulnerability?

Let’s assume the attacker sends the following payload:

```
?form_sel_layouts[]='sonar";source
```

This would result in the following shell command:

```
echo "DELETE FROM layout_options WHERE form_id = ' \'sonar\";source';"  >> /tmp/export;
```

As we can see, the quotes are escaped and an attacker cannot break out of the single quotes `'`. A SQL injection is successfully prevented. Double quotes `"` are also escaped by `mysqli_real_escape_string()` and we are not breaking out of the `echo` command either. However, there is another way to exploit a Command Injection vulnerability.

An attacker can send the following payload:

```
?form_sel_layouts[]=`touch sonarsource.txt;`
```

Note the backtick characters ```` in our payload. This would end up in the shell command like this:

```
echo "DELETE FROM layout_options WHERE form_id = '`touch sonarsource.txt;`';"  >> /tmp/export;
```

The problem here is that the `echo` shell command uses double quotes and thus allows to execute sub commands in Linux by using characters like backticks ```` or `$()`. Once our backticks are found within the system command, our new, injected command is executed and the output result is inserted into the initial command. From here, an attacker can fully compromise the system and read sensitive data.

**Patch**

It is tempting to use the PHP built-in function`escapeshellarg()` as a patch since it is designed to escape all malicious characters needed for a Command Injection attack. However, in this case this function would introduce a SQL injection vulnerability instead because `escapeshellarg()` introduces new single quotes. These single quotes would break the SQL query and probably that is the reason why it was not used here in the first place.

As a solution to protect against both vulnerability types, it is enough to simply swap the single and double quotes.

```
echo 'DELETE FROM layout_options WHERE form_id = "$layoutid";' >> /tmp/export;
```

A SQL injection vulnerability is then still prevented because the double quote `"` characters are escaped. More importantly, *command substitution* can no longer be opened because now the argument of `echo` is in single quotes `'`, which don't allow sub commands.

### 2. Persistent Cross-Site Scripting Vulnerability (CVE-2021-32103)

So far an attacker can only trigger the Command Injection vulnerability manually if he or she logs in as an admin. With the help of another code vulnerability, the attack can be carried out with the help of a valid administrator that triggers the exploitation unknowingly. We discovered a Persistent Cross-Site Scripting vulnerability that enables this kind of attack.

The attacker’s payload is hidden within the last name of a user account. This last name can be changed in line 4 of the following code. Note that this action can only be performed by an administrator (we will come back to this in the next section).

**interface/usergroup/usergroup\_admin.php**

```
1   if (isset($_POST["privatemode"]) && $_POST["privatemode"] =="user_admin") {
2      if ($_POST["mode"] == "update") {
3         if ($_POST["lname"]) {
4            sqlStatement("update users set lname=? where id= ? ", array($_POST["lname"], $_POST["id"]));
5         }
6      }
7   }
```

The new last name is stored permanently in the database table *users*. At a different code location, this name is read from the database again to present it in the frontend. This happens, for example, when an administrator changes the password of the renamed user.

**interface/usergroup/user\_info.php**

```
2   $userid = $_SESSION['authId'];
3   $user_name = getUserIDInfo($userid);
4   $user_full_name = $user_name['fname'] . " " . $user_name['lname'];
5   ?>
6   <legend><?php echo xlt('Change Password for') . " " . $user_full_name; ?></legend>
```

Here, in line 6, the user name is embedded into the HTML output without any sanitization.

This allows injection of malicious HTML code into the response page that will be rendered by the administrator’s browser. When `<script>` tags are injected into the last name, then malicious JavaScript code can be executed that will be able to control the victim's browser and its further activities. For example, it can be used to trigger the previously introduced Command Injection vulnerability that only an administrator can execute (Cross-Site Scripting).

**Patch**

This vulnerability can be easily prevented by using the popular PHP function `htmlspecialchars()` in line 6. It encodes special HTML characters into HTML entities (e.g. `<` into `&lt;`) and thus prevents that malicious JavaScript code can be embedded into the name.

```
echo htmlspecialchars($user_full_name, ENT_QUOTES);
```
### 3. Insecure API Permissions (CVE-2021-32101)

So far, we have learned about a Command Injection vulnerability that can be triggered by an administrator. And we’ve learned about a persistent XSS vulnerability that can also be used to trigger the Command Injection from a victim. However, to plant the XSS payload we again need administrator privileges. As long as the administrator itself, who has access to all data anyway, is not malicious there should be no risk - right? This is true, as long as the permission system is secure.

In OpenEMR, the Patient Portal has its own API interface to control all portal actions, for example for editing a user account. This API uses the *Phreeze*framework as a dispatcher that forwards requests to the respective component. Before this dispatcher is executed, the authentication is verified in the following include file.

**portal/patient/\_machine\_config.php**

```
3   OpenEMR\Common\Session\SessionUtil::portalSessionStart();
4   if (isset($_SESSION['pid'])
    && (isset($_SESSION['patient_portal_onsite_two'])
    || $_SESSION['register'] === true)) {
5   	$pid = $_SESSION['pid'];
6   	$ignoreAuth = true;
7   } else {
8   	$ignoreAuth = false;
9   	}
10   }
```

It creates a new session and checks in line 4 if the user is already on the portal page or whether she is currently trying to register. In this case, the authentication check is deactivated in line 6 (`$ignoreAuth = true`). Otherwise, the authentication check is active and the user has to authenticate.

Let's have a look at how the registration works in the Patient Portal. In the following code you can see the simplified *register.php*. In lines 4-6, the interesting session variables are set that indicate that we are within a new registration process.

**portal/account/register.php**

```
4   OpenEMR\Common\Session\SessionUtil::portalSessionStart();
5   $_SESSION['authUser'] = 'portal-user';
6   $_SESSION['pid'] = true;
7   $_SESSION['register'] = true;
```

No further checks are made and the session variable is not destroyed at the end of the file. An attacker could therefore make the first HTTP request to *register.php* which creates a session and sets the session variable `$_SESSION['register']` to *true*. Then, without completing the registration, the attacker can access the dispatcher and bypass the authentication because `$ignoreAuth` is set to *true*.

Once the authentication is bypassed, it is possible to use all features of the API as a *registered*Patient Portal user. This means an attacker can access all patient data or change the email address and passwords of the patients even if registration to the Patient Portal is closed.

Of special interest is the user controller of the API which can be used to change information of any backend user like the administrator. The attacker can now take advantage of the previously introduced Persistent XSS vulnerability by adding an XSS payload to the last name of the admin user. This XSS payload can then execute JavaScript code that exploits the Command Injection vulnerability. Ultimately, all three vulnerabilities are combined and lead to a pre-auth Command Execution in OpenEMR 5.0.2.1.

## Timeline

| **Date** | **What** |
| --- | --- |
| 24.02.2020 | We reported the vulnerabilities to the OpenEMR team |
| 29.04.2020 | OpenEMR team addresses the first vulnerabilities with a patch |
| 11.08.2020 | OpenEMR team releases another security patch |

## Summary

In this blog post we analyzed three code vulnerabilities found in OpenEMR, a widely adopted open source solution for electronic health records. The combination of these vulnerabilities can lead to a complete takeover of the OpenEMR application and put patient data as well as the infrastructure at risk. We’ve evaluated the root causes in the PHP code base and described how to fix them. Due to the severity of the issues, we postponed the release of these details for several months. If you are hosting an OpenEMR instance and have not yet updated your installation, we highly recommend that you do so now. Last but not least, we would like to thank the OpenEMR team who quickly released a patch version 5.0.2.2 after our reports.

Please stay healthy and secure!

*You can join the discussion about this vulnerability in*[*our community forum*](https://community.sonarsource.com/t/openemr-5-0-2-1-command-injection-vulnerability-puts-health-records-at-risk/33592 "our community forum")*.*

#### SHARE

[twitter](https://twitter.com/share?text=undefined)[facebook](https://www.facebook.com/sharer/sharer.php?u=undefined)[linkedin](https://www.linkedin.com/sharing/share-offsite/?url=undefined)mail[Go to SonarSource homepage![](data:image/svg+xml;charset=utf-8...)![sonar logo ]()![sonar logo ](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/8e59bcad-6e39-41dc-abd9-a0e251e8d63f/Sonar%20%282%29.svg?w=160&h=40&auto=format&fit=crop)](/)

* **Sonar Solutions**
  + [SAST](/solutions/security/)
  + [What is clean code](/solutions/clean-code/)
  + [Power of clean code](/solutions/power-of-clean-code/)
  + [Clean as you code](/solutions/our-unique-approach/)
  + [AI-assisted & quality-assured code](/solutions/ai/)
  + [DevOps transformation](/solutions/devops-transformation/)
  + [Outsourcing software development](/solutions/reduce-outsourcing-software-development-risk/)
  + [Reduce & manage technical debt](/solutions/reduce-technical-debt/)
  + [Secure by design](/solutions/secure-by-design-code/)
  + [Code coverage](/solutions/code-coverage/)
  + [Code review](/solutions/code-review/)
  + [For developers](/solutions/for-developers/)
  + [For enterprise](/solutions/for-enterprise/)
  + [Infrastructure as code](/solutions/infrastructure-as-code/)
  + [Public sector](/solutions/public-sector/)
* **Products**
  + [SonarQube for IDE](/products/sonarlint/)
  + [SonarQube Server](/products/sonarqube/)
  + [SonarQube Cloud](/products/sonarcloud/)**Pricing**
  + [Start for free](/open-source-editions/)
  + [Explore pricing](/plans-and-pricing/)
* **Company**
  + [About](/company/about/)
  + [Careers](/company/careers/)
  + [Commitment to open source](/solutions/commitment-to-open-source/)
  + [Customers](/company/customers/)
  + [Partners](/company/partners/)
  + [Contact us](/company/contact/)
  + [Accessibility](/accessibility/)
  + [NEW! Brand identity](/brand-identity/)**Media**
  + [Coverage](/company/coverage/)
  + [Press releases](/company/press-releases/)
* **Resources**
  + [Events hub](/resources/events/)
  + [Customer stories](/resources/customer-stories/)
  + [White papers](/resources/white-papers/)
  + [Learn](/learn/guide/)
  + [Community](https://community.sonarsource.com/)
  + [Support](/support/)
* **Knowledge**
  + [Explore Sonarpedia](https://rules.sonarsource.com/)
  + [Blog](/blog/)
  + [Languages](/knowledge/languages/)
  + [SonarQube Server Documentation](https://docs.sonarsource.com/sonarqube/latest/)
  + [SonarQube Cloud Documentation](https://docs.sonarsource.com/sonarcloud/)
  + [SonarQube for IDE Documentation](https://docs.sonarsource.com/sonarlint/)

* [Legal documentation](/legal/)
* [Trust center](/trust-center/)

* [Follow SonarSource on Twitter](https://twitter.com/sonarsource)
* [Follow SonarSource on Linkedin](https://www.linkedin.com/company/sonarsource/)

© 2008-2025 SonarSource SA. All rights reserved. SONAR, SONARSOURCE, SONARQUBE, and CLEAN AS YOU CODE are trademarks of SonarSource SA.



=== Content from community.open-emr.org_1992ba79_20250119_114353.html ===


![OpenEMR Community](data:image/svg;base64...)
Loading

[OpenEMR Community](/)

# [OpenEMR 5.0.2 Patch 5 has been released](/t/openemr-5-0-2-patch-5-has-been-released/15431)

[News](/c/news/14)

[brady.miller](https://community.open-emr.org/u/brady.miller)
(Brady Miller)

November 5, 2020, 3:26am

1

The 5th patch for OpenEMR 5.0.2 has been released:

<https://www.open-emr.org/wiki/index.php/OpenEMR_Patches>

This patch includes a security fix (since this vulnerability was made public recently, decided to get out a quick patch) :

* Security fix - reported by Dennis Brinkrolf (RIPS Technologies) and fixed by Brady Miller

1 Like

[murugappan](https://community.open-emr.org/u/murugappan)
(Murugappan Ramanathan)

August 18, 2021, 1:58pm

2

Hi,

I clicked the link for the patch but was directed to Version 6.0.0 patch instead. Where is the patches for version 5.0.2, please?

[stephenwaite](https://community.open-emr.org/u/stephenwaite)
(Stephen Waite)

August 18, 2021, 2:26pm

3

further down that [page](https://www.open-emr.org/wiki/index.php/Old_Outdated_OpenEMR_Patches)

[murugappan](https://community.open-emr.org/u/murugappan)
(Murugappan Ramanathan)

August 18, 2021, 8:24pm

4

I am so sorry i did not see it. Thank you so much.

* [Home](/)
* [Categories](/categories)
* [Guidelines](/guidelines)
* [Terms of Service](/tos)
* [Privacy Policy](/privacy)

Powered by [Discourse](https://www.discourse.org), best viewed with JavaScript enabled



=== Content from community.sonarsource.com_3e0d047d_20250119_114354.html ===


[Sonar Community](/)

# [[Tech Story] OpenEMR 5.0.2.1: Command Injection vulnerability puts health records at risk](/t/tech-story-openemr-5-0-2-1-command-injection-vulnerability-puts-health-records-at-risk/33592)

[Clean Code](/c/clean-code/announce/20)

[Sonar Updates](/c/clean-code/announce/20)

[security](https://community.sonarsource.com/tag/security),
[php](https://community.sonarsource.com/tag/php)

[Johannes.Dahse](https://community.sonarsource.com/u/Johannes.Dahse)
(Johannes Dahse)

October 28, 2020, 3:30pm

1

OpenEMR is the most popular open source software for electronic health record and medical practice management. It is used world-wide to manage sensitive patient data, including information about medications, laboratory values, and diseases. Patients use OpenEMR to schedule appointments, communicate with physicians, and pay online invoices. Specifically in these tumultuous times of an ongoing pandemic, this is highly sensitive data that needs protection.

During our security research of popular web applications, we discovered several critical code vulnerabilities in OpenEMR 5.0.2.1:

* Command Injection (admin privileges)
* Persistent XSS (admin privileges)
* Insecure API permissions (unauthenticated)
* SQL Injection (user privileges)

A combination of these vulnerabilities allowed remote attackers to execute arbitrary system commands on any OpenEMR server that uses the Patient Portal component. This can lead to the compromise of sensitive patient data, or worse, to a compromise of critical infrastructure. We reported all issues responsibly to the affected vendor who rated the fixes as critical and released a [security patch](https://www.open-emr.org/wiki/index.php/OpenEMR_Patches) in August immediately to protect all users.

We have published a blog post with a technical root cause analysis of three code vulnerabilities, how these could be chained by an attacker during exploitation (including a video), and how the vulnerable code was patched.

[Read the blog post](https://blog.sonarsource.com/openemr-5-0-2-1-command-injection-vulnerability)

4 Likes

* [Home](/)
* [Categories](/categories)
* [Guidelines](/guidelines)
* [Terms of Service](https://www.sonarsource.com/legal/website-terms-of-use/)
* [Privacy Policy](https://www.sonarsource.com/company/privacy/)

Powered by [Discourse](https://www.discourse.org), best viewed with JavaScript enabled

[The new SonarQube free tier is here! Sign up to scan your private projects for free.](https://www.sonarsource.com/products/sonarcloud/signup-free/)



=== Content from www.open-emr.org_d393344d_20250119_114354.html ===

[![](/wiki/skins/Openemr/images/openemr-logo-wiki.svg)](/)

* [Features](/wiki/index.php/OpenEMR_Features)
* [Demo](/demo)
* [Download](/wiki/index.php/OpenEMR_Downloads)
* [Modules](/modules)
* [Blog](/blog)
* [Docs](/wiki)
* [Forum](https://community.open-emr.org/)
* [Chat](/chat)
* Support
  [Professional Support Vendors](/wiki/index.php/Professional_Support)
  [Costs and Support Options](/support)
  [Community Support](https://community.open-emr.org/)
  [Free Basic Live Chat Support](/chat)

# OpenEMR Patches

From OpenEMR Project Wiki

## Contents

* [1 7.0.3 Patch (11/24/24)](#7.0.3_Patch_.2811.2F24.2F24.29)
  + [1.1 Download link](#Download_link)
  + [1.2 Description](#Description)
  + [1.3 Installation instructions](#Installation_instructions)
    - [1.3.1 Windows](#Windows)
    - [1.3.2 Linux](#Linux)
  + [1.4 Fixes and New Features](#Fixes_and_New_Features)
  + [1.5 List of files (7.0.2) Patch 3](#List_of_files_.287.0.2.29_Patch_3)
* [2 Previous Patches](#Previous_Patches)
# 7.0.3 Patch (11/24/24)

### Download link

[7-0-2-Patch-3.zip](https://www.open-emr.org/patch/7-0-2-Patch-3.zip "https://www.open-emr.org/patch/7-0-2-Patch-3.zip") (MD5 sum: e59f19bc90c5a1459ddbd415916f2a0d)

### Description

This is the 3rd patch and also includes changes from prior patch.

### Installation instructions

#### Windows

1. Extract the zipped file into the openemr web directory, and say yes to copying over files
2. Open web browser and go to http://your\_server\_name\_or\_ip/openemr/sql\_patch.php
(this script will run automatically and patch the database)
(if you are using the [Multisite Module](/wiki/index.php/OpenEMR_Multiple_Sites_Module "OpenEMR Multiple Sites Module"), then skip step 2 and [follow these instructions](/wiki/index.php/OpenEMR_Multiple_Sites_Module#Patches "OpenEMR Multiple Sites Module"))
3. Delete the sql\_patch.php file from the openemr web directory
#### Linux

1. Move the patch file to the openemr web directory, then type 'unzip 7-0-2-Patch-3.zip', and confirm ok to copy over files.
2. Open web browser and go to http://your\_server\_name\_or\_ip/openemr/sql\_patch.php
(this script will run automatically and patch the database)
(if you are using the [Multisite Module](/wiki/index.php/OpenEMR_Multiple_Sites_Module "OpenEMR Multiple Sites Module"), then skip step 2 and [follow these instructions](/wiki/index.php/OpenEMR_Multiple_Sites_Module#Patches "OpenEMR Multiple Sites Module"))
3. Delete the sql\_patch.php file from the openemr web directory

### Fixes and New Features

* [Click here to see CHANGELOG for detailed listing of new features and fixes.](https://github.com/openemr/openemr/blob/master/CHANGELOG.md#7023---2024-11-24)
* Some highlights include ( \*\* are highlights from most recent patch):

* ONC b11 Decision Support Interventions (DSI)\*\*
* Miscellaneous -> New Documents select patient fix.\*\*
* Miscellaneous -> New restyled Office Notes with edit and delete.\*\*
* Two new Radio Group keys of any size for use with portal Document Templates.\*\*
* Major Patient Portal styling refactor and bug fixes. Must see!
* Completed Patient Document Template Forms from Dashboard Demographics Patient Documents.
* Updated Weno eRX module for better logging and new feature in widget to allow any registered Weno Location selection for ePrescribe.
* Update, fix and tested OfficeAlly Insurance Eligibility.
* Improved insurances handling.
* Added RingCentral vendor back to FaxSMS module.
* New Email client in FaxSMS module for appointment notifications.
* Many bug fixes in FaxSMS module.
* Fax disposition feature update.
* Upgraded FHIR and encounter Questionnaires LForms with new release and optional original, light and dark themes. See Config.
* Many Billing fixes e.g. Patient and Insurance edit redirects fixed in Billing Manager.
* SMART on FHIR and FHIR API bug fixes.
* [New Weno EZ eRx module](https://community.open-emr.org/t/new-weno-module-install-and-setup/21995)
* Updated etherFax module with new TIFF capabilities. [Click here for upgrade information.](https://community.open-emr.org/t/openemr-fax-and-or-sms-module-guide/20273#using-etherfax-4)
* Added Real World Testing Report for 2024
* Billing Manager.
* [Modules Manager overhaul with new features including MM action listener class.](https://github.com/openemr/openemr/issues/7247)
* UB04 837i Institutional billing fixes and updates.
* Clinical Decision Rules engine fixes.
* Security fixes (Reported by Roger Meyer, Vinicius Ribeiro and A3h1nt).
* Upgrading from older versions

### List of files (7.0.2) Patch 3

Since there are quite a few files please list them on the command line with `unzip -l 7-0-2-Patch-3.zip` or open up the zip archive with your favorite utility.

# Previous Patches

[Previous OpenEMR version patches](/wiki/index.php/Old_Outdated_OpenEMR_Patches "Old Outdated OpenEMR Patches")

Retrieved from "<https://www.open-emr.org/wiki/index.php?title=OpenEMR_Patches&oldid=36101>"

[Categories](/wiki/index.php/Special%3ACategories "Special:Categories"):

* [Download](/wiki/index.php/Category%3ADownload "Category:Download")
* [Patch](/wiki/index.php/Category%3APatch "Category:Patch")

## Navigation menu

[# OpenEMR Project Wiki](/wiki/index.php/OpenEMR_Wiki_Home_Page)

### Search

### Personal tools

* [Log in](/wiki/index.php?title=Special:UserLogin&returnto=OpenEMR+Patches "You are encouraged to log in; however, it is not mandatory [o]")

### Namespaces

* [Page](/wiki/index.php/OpenEMR_Patches "View the content page [c]")
* [Discussion](/wiki/index.php?title=Talk:OpenEMR_Patches&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

### Variants

### Views

* [View](/wiki/index.php/OpenEMR_Patches)
* [View source](/wiki/index.php?title=OpenEMR_Patches&action=edit "This page is protected.
  You can view its source [e]")
* [History](/wiki/index.php?title=OpenEMR_Patches&action=history "Past revisions of this page [h]")

### More

### wiki navigation

* [Main wiki page](/wiki/index.php/OpenEMR_Wiki_Home_Page)
* [Categories](/wiki/index.php/Special%3ACategories)
* [Recent changes](/wiki/index.php/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Random page](/wiki/index.php/Special%3ARandom "Load a random page [x]")
* [Help](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Help%3AContents "The place to find out")

### Tools

* [What links here](/wiki/index.php/Special%3AWhatLinksHere/OpenEMR_Patches "A list of all wiki pages that link here [j]")
* [Related changes](/wiki/index.php/Special%3ARecentChangesLinked/OpenEMR_Patches "Recent changes in pages linked from this page [k]")
* [Special pages](/wiki/index.php/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/wiki/index.php?title=OpenEMR_Patches&oldid=36101 "Permanent link to this revision of the page")
* [Page information](/wiki/index.php?title=OpenEMR_Patches&action=info "More information about this page")

* [![GNU Free Documentation License 1.3](/wiki/resources/assets/licenses/gnu-fdl.png)](http://www.gnu.org/copyleft/fdl.html)
* [![Powered by MediaWiki](/wiki/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)

* This page was last edited on 25 November 2024, at 06:04.
* Content is available under [GNU Free Documentation License 1.3](http://www.gnu.org/copyleft/fdl.html) unless otherwise noted.

* [Privacy policy](/wiki/index.php/OpenEMR_Project_Wiki%3APrivacy_policy "OpenEMR Project Wiki:Privacy policy")
* [About OpenEMR Project Wiki](/wiki/index.php/OpenEMR_Project_Wiki%3AAbout "OpenEMR Project Wiki:About")
* [Disclaimers](/wiki/index.php/OpenEMR_Project_Wiki%3AGeneral_disclaimer "OpenEMR Project Wiki:General disclaimer")


