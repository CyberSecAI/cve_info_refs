=== Content from syzkaller.appspot.com_ff519425_20250119_112242.html ===


| [syzbot](/upstream) | Android 5.10 Android 5.15 Android 5.4 Android 6.1 FreeBSD Linux Linux 5.15 Linux 6.1 NetBSD OpenBSD gVisor | [sign-in](https://syzkaller.appspot.com/_ah/conflogin?continue=https://syzkaller.appspot.com/bug%3Fid%3D4bf11aa05c4ca51ce0df86e500fce486552dc8d2) | [mailing list](https://groups.google.com/forum/#!forum/syzkaller) | [source](https://github.com/google/syzkaller) | [docs](https://github.com/google/syzkaller/blob/master/docs/syzbot.md) |
| --- | --- | --- |

[ðŸž Open [1660]](/upstream)

[â‰¡ Subsystems](/upstream/subsystems)

[ðŸž Fixed [5980]](/upstream/fixed)

[ðŸž Invalid [14712]](/upstream/invalid)

[â¬‡ Missing Backports [129]](/upstream/backports)

[â‰¡ Crashes](/upstream/graph/crashes)

ðŸ“ˆGraphs
[KernelÂ Health](/upstream/graph/bugs)
[Bugs/Month](/upstream/graph/found-bugs)
[BugÂ Lifetimes](/upstream/graph/lifetimes)
[Fuzzing](/upstream/graph/fuzzing)

ðŸ“ˆCoverage
[Total](/upstream/graph/coverage?period=quarter)
[RepoÂ Heatmap](/upstream/graph/coverage_heatmap?period=month)
[SubsystemsÂ Heatmap](/upstream/graph/coverage_subsystems_heatmap?period=month)

ðŸ’¬ Send us feedback

**KASAN: slab-out-of-bounds Read in hci\_extended\_inquiry\_result\_evt**

Status: [fixed on 2020/09/16 22:51](https://groups.google.com/d/msgid/syzkaller-bugs/00000000000095a5f205a9e43b69%40google.com)

Subsystems:
[bluetooth](/upstream/s/bluetooth)

[[Documentation on labels]](https://github.com/google/syzkaller/blob/master/docs/syzbot.md#labels)

Reported-by: syzbot+d8489a79b781849b9c46@syzkaller.appspotmail.com

**Fix commit:**
51c19bf3d5cf
[Bluetooth: Fix slab-out-of-bounds read in hci\_extended\_inquiry\_result\_evt()](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=51c19bf3d5cfaa66571e4b88ba2a6f6295311101)

First crash: 1660d, last: 1628d

â–¶
â–¼
Duplicate bugs (1)

duplicates (1):

| Title | Repro | Cause bisect | Fix bisect | Count | Last | Reported | Patched | Status |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| [KMSAN: uninit-value in hci\_event\_packet](/bug?extid=4918ee47ac82d51de00d) [bluetooth](/upstream/s/bluetooth) | C |  |  | 40 | 1618d | [2107d](https://groups.google.com/d/msgid/syzkaller-bugs/0000000000005bb0ae05867271c1%40google.com) | 0/28 | [closed as dup on 2020/07/24 21:34](https://groups.google.com/d/msgid/syzkaller-bugs/0000000000005bb0ae05867271c1%40google.com) |

â–¶
â–¼
Discussions (9)

| Title | Replies (including bot) | Last reply |
| --- | --- | --- |
| [[Linux-kernel-mentees] [PATCH] net/bluetooth: Fix slab-out-of-bounds read in hci\_extended\_inquiry\_result\_evt()](https://lore.kernel.org/all/20200709051802.185168-1-yepeilin.cs%40gmail.com/T/) | 7 (7) | 2021/07/01 21:06 |
| [[PATCH 4.4 000/149] 4.4.233-rc1 review](https://lore.kernel.org/all/20200820092125.688850368%40linuxfoundation.org/T/) | 163 (163) | 2020/10/31 20:04 |
| [[PATCH 4.9 000/212] 4.9.233-rc1 review](https://lore.kernel.org/all/20200820091602.251285210%40linuxfoundation.org/T/) | 220 (220) | 2020/08/21 09:40 |
| [[PATCH 4.14 000/228] 4.14.194-rc1 review](https://lore.kernel.org/all/20200820091607.532711107%40linuxfoundation.org/T/) | 234 (234) | 2020/08/21 06:59 |
| [[PATCH 4.19 00/48] 4.19.139-rc1 review](https://lore.kernel.org/all/20200810151804.199494191%40linuxfoundation.org/T/) | 61 (61) | 2020/08/11 16:45 |
| [[PATCH 5.8 00/38] 5.8.1-rc1 review](https://lore.kernel.org/all/20200810151803.920113428%40linuxfoundation.org/T/) | 46 (46) | 2020/08/11 16:20 |
| [[PATCH 5.7 00/79] 5.7.15-rc1 review](https://lore.kernel.org/all/20200810151812.114485777%40linuxfoundation.org/T/) | 83 (83) | 2020/08/11 14:23 |
| [[PATCH 5.4 00/67] 5.4.58-rc1 review](https://lore.kernel.org/all/20200810151809.438685785%40linuxfoundation.org/T/) | 71 (71) | 2020/08/11 14:23 |
| [KASAN: slab-out-of-bounds Read in hci\_extended\_inquiry\_result\_evt](https://lore.kernel.org/all/00000000000095a5f205a9e43b69%40google.com/T/) | 0 (1) | 2020/07/08 01:43 |

â–¶
â–¼
Similar bugs (2)

| Kernel | Title | Repro | Cause bisect | Fix bisect | Count | Last | Reported | Patched | Status |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| linux-4.19 | [KASAN: slab-out-of-bounds Read in hci\_extended\_inquiry\_result\_evt](/bug?extid=5b7fc04f9e1c6b046b9f) | C |  | done | 6 | 1625d | [1659d](https://groups.google.com/d/msgid/syzkaller-lts-bugs/0000000000005f95a005a9a03684%40google.com) | 1/1 | [fixed on 2020/09/09 05:22](https://groups.google.com/d/msgid/syzkaller-lts-bugs/0000000000005f95a005a9a03684%40google.com) |
| linux-4.14 | [KASAN: slab-out-of-bounds Read in hci\_extended\_inquiry\_result\_evt](/bug?extid=96761b8d6446f0a881b0) | C |  | done | 5 | 1625d | [1631d](https://groups.google.com/d/msgid/syzkaller-lts-bugs/0000000000004f5ba405abe3316e%40google.com) | 1/1 | [fixed on 2020/09/09 05:22](https://groups.google.com/d/msgid/syzkaller-lts-bugs/0000000000004f5ba405abe3316e%40google.com) |

**Sample crash report:**

```
==================================================================
BUG: KASAN: slab-out-of-bounds in memcpy [include/linux/string.h:406](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/linux/string.h?id=3208167a865e862fff5045d7910387941ff7e114#n406) [inline]
BUG: KASAN: slab-out-of-bounds in bacpy [include/net/bluetooth/bluetooth.h:274](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/net/bluetooth/bluetooth.h?id=3208167a865e862fff5045d7910387941ff7e114#n274) [inline]
BUG: KASAN: slab-out-of-bounds in hci_extended_inquiry_result_evt.isra.0+0x1be/0x5e0 [net/bluetooth/hci_event.c:4397](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/bluetooth/hci_event.c?id=3208167a865e862fff5045d7910387941ff7e114#n4397)
Read of size 6 at addr ffff8880a62b2208 by task kworker/u5:0/1531

CPU: 1 PID: 1531 Comm: kworker/u5:0 Not tainted 5.8.0-syzkaller #0
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011
Workqueue: hci0 hci_rx_work
Call Trace:
 __dump_stack [lib/dump_stack.c:77](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/lib/dump_stack.c?id=3208167a865e862fff5045d7910387941ff7e114#n77) [inline]
 dump_stack+0x18f/0x20d [lib/dump_stack.c:118](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/lib/dump_stack.c?id=3208167a865e862fff5045d7910387941ff7e114#n118)
 print_address_description.constprop.0.cold+0xae/0x436 [mm/kasan/report.c:383](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/mm/kasan/report.c?id=3208167a865e862fff5045d7910387941ff7e114#n383)
 __kasan_report [mm/kasan/report.c:513](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/mm/kasan/report.c?id=3208167a865e862fff5045d7910387941ff7e114#n513) [inline]
 kasan_report.cold+0x1f/0x37 [mm/kasan/report.c:530](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/mm/kasan/report.c?id=3208167a865e862fff5045d7910387941ff7e114#n530)
 check_memory_region_inline [mm/kasan/generic.c:186](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/mm/kasan/generic.c?id=3208167a865e862fff5045d7910387941ff7e114#n186) [inline]
 check_memory_region+0x13d/0x180 [mm/kasan/generic.c:192](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/mm/kasan/generic.c?id=3208167a865e862fff5045d7910387941ff7e114#n192)
 memcpy+0x20/0x60 [mm/kasan/common.c:105](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/mm/kasan/common.c?id=3208167a865e862fff5045d7910387941ff7e114#n105)
 memcpy [include/linux/string.h:406](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/linux/string.h?id=3208167a865e862fff5045d7910387941ff7e114#n406) [inline]
 bacpy [include/net/bluetooth/bluetooth.h:274](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/net/bluetooth/bluetooth.h?id=3208167a865e862fff5045d7910387941ff7e114#n274) [inline]
 hci_extended_inquiry_result_evt.isra.0+0x1be/0x5e0 [net/bluetooth/hci_event.c:4397](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/bluetooth/hci_event.c?id=3208167a865e862fff5045d7910387941ff7e114#n4397)
 hci_event_packet+0x2828/0x86f5 [net/bluetooth/hci_event.c:6127](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/bluetooth/hci_event.c?id=3208167a865e862fff5045d7910387941ff7e114#n6127)
 hci_rx_work+0x22e/0xb10 [net/bluetooth/hci_core.c:4705](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/bluetooth/hci_core.c?id=3208167a865e862fff5045d7910387941ff7e114#n4705)
 process_one_work+0x94c/0x1670 [kernel/workqueue.c:2269](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/workqueue.c?id=3208167a865e862fff5045d7910387941ff7e114#n2269)
 worker_thread+0x64c/0x1120 [kernel/workqueue.c:2415](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/workqueue.c?id=3208167a865e862fff5045d7910387941ff7e114#n2415)
 kthread+0x3b5/0x4a0 [kernel/kthread.c:291](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/kthread.c?id=3208167a865e862fff5045d7910387941ff7e114#n291)
 ret_from_fork+0x1f/0x30 [arch/x86/entry/entry_64.S:293](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/x86/entry/entry_64.S?id=3208167a865e862fff5045d7910387941ff7e114#n293)

Allocated by task 6831:
 save_stack+0x1b/0x40 [mm/kasan/common.c:48](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/mm/kasan/common.c?id=3208167a865e862fff5045d7910387941ff7e114#n48)
 set_track [mm/kasan/common.c:56](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/mm/kasan/common.c?id=3208167a865e862fff5045d7910387941ff7e114#n56) [inline]
 __kasan_kmalloc.constprop.0+0xc2/0xd0 [mm/kasan/common.c:494](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/mm/kasan/common.c?id=3208167a865e862fff5045d7910387941ff7e114#n494)
 __kmalloc_reserve [net/core/skbuff.c:142](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/core/skbuff.c?id=3208167a865e862fff5045d7910387941ff7e114#n142) [inline]
 __alloc_skb+0xae/0x550 [net/core/skbuff.c:210](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/core/skbuff.c?id=3208167a865e862fff5045d7910387941ff7e114#n210)
 alloc_skb [include/linux/skbuff.h:1083](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/linux/skbuff.h?id=3208167a865e862fff5045d7910387941ff7e114#n1083) [inline]
 bt_skb_alloc [include/net/bluetooth/bluetooth.h:377](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/net/bluetooth/bluetooth.h?id=3208167a865e862fff5045d7910387941ff7e114#n377) [inline]
 vhci_get_user [drivers/bluetooth/hci_vhci.c:165](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/bluetooth/hci_vhci.c?id=3208167a865e862fff5045d7910387941ff7e114#n165) [inline]
 vhci_write+0xbd/0x450 [drivers/bluetooth/hci_vhci.c:285](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/bluetooth/hci_vhci.c?id=3208167a865e862fff5045d7910387941ff7e114#n285)
 call_write_iter [include/linux/fs.h:1909](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/linux/fs.h?id=3208167a865e862fff5045d7910387941ff7e114#n1909) [inline]
 new_sync_write+0x422/0x650 [fs/read_write.c:503](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/read_write.c?id=3208167a865e862fff5045d7910387941ff7e114#n503)
 vfs_write+0x59d/0x6b0 [fs/read_write.c:578](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/read_write.c?id=3208167a865e862fff5045d7910387941ff7e114#n578)
 ksys_write+0x12d/0x250 [fs/read_write.c:631](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/read_write.c?id=3208167a865e862fff5045d7910387941ff7e114#n631)
 do_syscall_64+0x60/0xe0 [arch/x86/entry/common.c:384](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/x86/entry/common.c?id=3208167a865e862fff5045d7910387941ff7e114#n384)
 entry_SYSCALL_64_after_hwframe+0x44/0xa9

Freed by task 6653:
 save_stack+0x1b/0x40 [mm/kasan/common.c:48](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/mm/kasan/common.c?id=3208167a865e862fff5045d7910387941ff7e114#n48)
 set_track [mm/kasan/common.c:56](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/mm/kasan/common.c?id=3208167a865e862fff5045d7910387941ff7e114#n56) [inline]
 kasan_set_free_info [mm/kasan/common.c:316](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/mm/kasan/common.c?id=3208167a865e862fff5045d7910387941ff7e114#n316) [inline]
 __kasan_slab_free+0xf5/0x140 [mm/kasan/common.c:455](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/mm/kasan/common.c?id=3208167a865e862fff5045d7910387941ff7e114#n455)
 __cache_free [mm/slab.c:3426](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/mm/slab.c?id=3208167a865e862fff5045d7910387941ff7e114#n3426) [inline]
 kfree+0x103/0x2c0 [mm/slab.c:3757](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/mm/slab.c?id=3208167a865e862fff5045d7910387941ff7e114#n3757)
 load_elf_binary+0x356b/0x4831 [fs/binfmt_elf.c:1207](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/binfmt_elf.c?id=3208167a865e862fff5045d7910387941ff7e114#n1207)
 search_binary_handler [fs/exec.c:1749](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/exec.c?id=3208167a865e862fff5045d7910387941ff7e114#n1749) [inline]
 exec_binprm [fs/exec.c:1790](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/exec.c?id=3208167a865e862fff5045d7910387941ff7e114#n1790) [inline]
 __do_execve_file+0x1652/0x2ee0 [fs/exec.c:1926](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/exec.c?id=3208167a865e862fff5045d7910387941ff7e114#n1926)
 do_execveat_common [fs/exec.c:1980](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/exec.c?id=3208167a865e862fff5045d7910387941ff7e114#n1980) [inline]
 do_execve+0x35/0x50 [fs/exec.c:1997](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/exec.c?id=3208167a865e862fff5045d7910387941ff7e114#n1997)
 __do_sys_execve [fs/exec.c:2073](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/exec.c?id=3208167a865e862fff5045d7910387941ff7e114#n2073) [inline]
 __se_sys_execve [fs/exec.c:2068](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/exec.c?id=3208167a865e862fff5045d7910387941ff7e114#n2068) [inline]
 __x64_sys_execve+0x7c/0xa0 [fs/exec.c:2068](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/exec.c?id=3208167a865e862fff5045d7910387941ff7e114#n2068)
 do_syscall_64+0x60/0xe0 [arch/x86/entry/common.c:384](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/x86/entry/common.c?id=3208167a865e862fff5045d7910387941ff7e114#n384)
 entry_SYSCALL_64_after_hwframe+0x44/0xa9

The buggy address belongs to the object at ffff8880a62b2000
 which belongs to the cache kmalloc-512 of size 512
The buggy address is located 8 bytes to the right of
 512-byte region [ffff8880a62b2000, ffff8880a62b2200)
The buggy address belongs to the page:
page:ffffea000298ac80 refcount:1 mapcount:0 mapping:0000000000000000 index:0x0
flags: 0xfffe0000000200(slab)
raw: 00fffe0000000200 ffffea0002735e48 ffffea00025e3f88 ffff8880aa000a80
raw: 0000000000000000 ffff8880a62b2000 0000000100000004 0000000000000000
page dumped because: kasan: bad access detected

Memory state around the buggy address:
 ffff8880a62b2100: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
 ffff8880a62b2180: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
>ffff8880a62b2200: fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc
                      ^
 ffff8880a62b2280: fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc
 ffff8880a62b2300: fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc
==================================================================

```

Crashes (16):
| Time | Kernel | Commit | Syzkaller | Config | Log | Report | Syz repro | C repro | VM info | Assets ([help?](https://github.com/google/syzkaller/blob/master/docs/syzbot_assets.md)) | Manager | Title |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 2020/08/04 13:23 | upstream | [3208167a865e](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?id=3208167a865e862fff5045d7910387941ff7e114) | [196277c4](https://github.com/google/syzkaller/commits/196277c4035b5442b7a259953677543566c9b9a9) | [.config](/text?tag=KernelConfig&x=aba78ac60df87306) | [console log](/text?tag=CrashLog&x=10b3af04900000) | [report](/text?tag=CrashReport&x=17db1aa4900000) | [syz](/text?tag=ReproSyz&x=105a8d66900000) | [C](/text?tag=ReproC&x=15ca2f46900000) |  |  | ci-upstream-kasan-gce-root |  |
| 2020/08/02 21:47 | upstream | [ac3a0c847296](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?id=ac3a0c8472969a03c0496ae774b3a29eb26c8d5a) | [63a73341](https://github.com/google/syzkaller/commits/63a7334112fa63edb0c0a3f317d3d92135a6ead9) | [.config](/text?tag=KernelConfig&x=c0cfcf935bcc94d2) | [console log](/text?tag=CrashLog&x=1324002a900000) | [report](/text?tag=CrashReport&x=11866fca900000) | [syz](/text?tag=ReproSyz&x=131a44fc900000) | [C](/text?tag=ReproC&x=16ce53a2900000) |  |  | ci-upstream-kasan-gce-selinux-root |  |
| 2020/07/04 14:51 | upstream | [7cc2a8ea1048](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?id=7cc2a8ea104820dd9e702202621e8fd4d9f6c8cf) | [51095195](https://github.com/google/syzkaller/commits/510951950dc0ee69cfdaf746061d3dbe31b49fd8) | [.config](/text?tag=KernelConfig&x=7be693511b29b338) | [console log](/text?tag=CrashLog&x=10261e7b100000) | [report](/text?tag=CrashReport&x=140c42d5100000) | [syz](/text?tag=ReproSyz&x=12d62e6d100000) | [C](/text?tag=ReproC&x=1061f66d100000) |  |  | ci-upstream-kasan-gce-root |  |
| 2020/07/04 13:08 | upstream | [7cc2a8ea1048](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?id=7cc2a8ea104820dd9e702202621e8fd4d9f6c8cf) | [51095195](https://github.com/google/syzkaller/commits/510951950dc0ee69cfdaf746061d3dbe31b49fd8) | [.config](/text?tag=KernelConfig&x=7be693511b29b338) | [console log](/text?tag=CrashLog&x=1543f0b7100000) | [report](/text?tag=CrashReport&x=12e760a3100000) | [syz](/text?tag=ReproSyz&x=171806a7100000) | [C](/text?tag=ReproC&x=14b442d5100000) |  |  | ci-upstream-kasan-gce-selinux-root |  |
| 2020/07/04 01:55 | upstream | [7cc2a8ea1048](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?id=7cc2a8ea104820dd9e702202621e8fd4d9f6c8cf) | [51095195](https://github.com/google/syzkaller/commits/510951950dc0ee69cfdaf746061d3dbe31b49fd8) | [.config](/text?tag=KernelConfig&x=7be693511b29b338) | [console log](/text?tag=CrashLog&x=11eee39b100000) | [report](/text?tag=CrashReport&x=129f0f87100000) | [syz](/text?tag=ReproSyz&x=111132a7100000) | [C](/text?tag=ReproC&x=17a4dc83100000) |  |  | ci-upstream-kasan-gce |  |
| 2020/07/04 11:09 | upstream | [7cc2a8ea1048](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?id=7cc2a8ea104820dd9e702202621e8fd4d9f6c8cf) | [51095195](https://github.com/google/syzkaller/commits/510951950dc0ee69cfdaf746061d3dbe31b49fd8) | [.config](/text?tag=KernelConfig&x=7be693511b29b338) | [console log](/text?tag=CrashLog&x=17fdf0b7100000) | [report](/text?tag=CrashReport&x=100cdc83100000) | [syz](/text?tag=ReproSyz&x=147e2987100000) | [C](/text?tag=ReproC&x=142acfd3100000) |  |  | ci-upstream-kasan-gce-386 |  |
| 2020/07/04 07:39 | linux-next | [9e50b94b3eb0](https://git.kernel.org/pub/scm/linux/kernel/git/next/linux-next.git/log/?id=9e50b94b3eb0d859a2586b5a40d7fd6e5afd9210) | [51095195](https://github.com/google/syzkaller/commits/510951950dc0ee69cfdaf746061d3dbe31b49fd8) | [.config](/text?tag=KernelConfig&x=f99cc0faa1476ed6) | [console log](/text?tag=CrashLog&x=12dea8cb100000) | [report](/text?tag=CrashReport&x=17e4f755100000) | [syz](/text?tag=ReproSyz&x=134e8aa7100000) | [C](/text?tag=ReproC&x=11110fe5100000) |  |  | ci-upstream-linux-next-kasan-gce-root |  |
| 2020/08/02 12:17 | upstream | [ac3a0c847296](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?id=ac3a0c8472969a03c0496ae774b3a29eb26c8d5a) | [63a73341](https://github.com/google/syzkaller/commits/63a7334112fa63edb0c0a3f317d3d92135a6ead9) | [.config](/text?tag=KernelConfig&x=c0cfcf935bcc94d2) | [console log](/text?tag=CrashLog&x=17170078900000) | [report](/text?tag=CrashReport&x=12a01292900000) |  |  |  |  | ci-upstream-kasan-gce-root |  |
| 2020/08/02 12:15 | upstream | [ac3a0c847296](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?id=ac3a0c8472969a03c0496ae774b3a29eb26c8d5a) | [63a73341](https://github.com/google/syzkaller/commits/63a7334112fa63edb0c0a3f317d3d92135a6ead9) | [.config](/text?tag=KernelConfig&x=c0cfcf935bcc94d2) | [console log](/text?tag=CrashLog&x=11173c32900000) | [report](/text?tag=CrashReport&x=12ea4fb8900000) |  |  |  |  | ci-upstream-kasan-gce-selinux-root |  |
| 2020/08/02 11:20 | upstream | [ac3a0c847296](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?id=ac3a0c8472969a03c0496ae774b3a29eb26c8d5a) | [63a73341](https://github.com/google/syzkaller/commits/63a7334112fa63edb0c0a3f317d3d92135a6ead9) | [.config](/text?tag=KernelConfig&x=c0cfcf935bcc94d2) | [console log](/text?tag=CrashLog&x=174dcf6c900000) | [report](/text?tag=CrashReport&x=17568570900000) |  |  |  |  | ci-upstream-kasan-gce-root |  |
| 2020/08/02 11:15 | upstream | [ac3a0c847296](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?id=ac3a0c8472969a03c0496ae774b3a29eb26c8d5a) | [63a73341](https://github.com/google/syzkaller/commits/63a7334112fa63edb0c0a3f317d3d92135a6ead9) | [.config](/text?tag=KernelConfig&x=c0cfcf935bcc94d2) | [console log](/text?tag=CrashLog&x=1289f078900000) | [report](/text?tag=CrashReport&x=13cd540a900000) |  |  |  |  | ci-upstream-kasan-gce-selinux-root |  |
| 2020/07/21 09:43 | upstream | [4fa640dc5230](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?id=4fa640dc52302b5e62b01b05c755b055549633ae) | [d88894e6](https://github.com/google/syzkaller/commits/d88894e6773ab63ac8b3f4b2edbae88290aaf0d6) | [.config](/text?tag=KernelConfig&x=f87a5e4232fdb267) | [console log](/text?tag=CrashLog&x=1218c440900000) | [report](/text?tag=CrashReport&x=154a5e27100000) |  |  |  |  | ci-upstream-kasan-gce |  |
| 2020/07/17 12:22 | upstream | [f8456690ba8e](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?id=f8456690ba8eb18ea4714e68554e242a04f65cff) | [54b3c45e](https://github.com/google/syzkaller/commits/54b3c45e2881a2cc71d06d21f0ca39b6e47666db) | [.config](/text?tag=KernelConfig&x=a160d1053fc89af5) | [console log](/text?tag=CrashLog&x=117a11b3100000) | [report](/text?tag=CrashReport&x=1003ded0900000) |  |  |  |  | ci-upstream-kasan-gce |  |
| 2020/07/17 12:18 | upstream | [f8456690ba8e](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?id=f8456690ba8eb18ea4714e68554e242a04f65cff) | [54b3c45e](https://github.com/google/syzkaller/commits/54b3c45e2881a2cc71d06d21f0ca39b6e47666db) | [.config](/text?tag=KernelConfig&x=a160d1053fc89af5) | [console log](/text?tag=CrashLog&x=13ac4d3b100000) | [report](/text?tag=CrashReport&x=13dec1b3100000) |  |  |  |  | ci-upstream-kasan-gce-selinux-root |  |
| 2020/07/17 12:17 | upstream | [07a56bb875af](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?id=07a56bb875afbe39dabbf6ba7b83783d166863db) | [54b3c45e](https://github.com/google/syzkaller/commits/54b3c45e2881a2cc71d06d21f0ca39b6e47666db) | [.config](/text?tag=KernelConfig&x=600b4abe8ad1f838) | [console log](/text?tag=CrashLog&x=12b32693100000) | [report](/text?tag=CrashReport&x=1349c5ab100000) |  |  |  |  | ci-qemu-upstream |  |
| 2020/07/04 01:36 | upstream | [7cc2a8ea1048](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?id=7cc2a8ea104820dd9e702202621e8fd4d9f6c8cf) | [51095195](https://github.com/google/syzkaller/commits/510951950dc0ee69cfdaf746061d3dbe31b49fd8) | [.config](/text?tag=KernelConfig&x=7be693511b29b338) | [console log](/text?tag=CrashLog&x=12d3c5e3100000) | [report](/text?tag=CrashReport&x=14f2b10f100000) |  |  |  |  | ci-upstream-kasan-gce |  |

*\* ~~Struck through~~ repros no longer work on HEAD.*


=== Content from syzkaller.appspot.com_ac360646_20250119_112242.html ===
// https://syzkaller.appspot.com/bug?id=4bf11aa05c4ca51ce0df86e500fce486552dc8d2
// autogenerated by syzkaller (https://github.com/google/syzkaller)
#define \_GNU\_SOURCE
#include
#include
#include
#include
#include
#include
#include
#include
#include
#include
#include
#include
#include
#include
#include
#include
#include
#include
#include
#include
#include
#include
#include
#include
#include
static bool write\_file(const char\* file, const char\* what, ...)
{
char buf[1024];
va\_list args;
va\_start(args, what);
vsnprintf(buf, sizeof(buf), what, args);
va\_end(args);
buf[sizeof(buf) - 1] = 0;
int len = strlen(buf);
int fd = open(file, O\_WRONLY | O\_CLOEXEC);
if (fd == -1)
return false;
if (write(fd, buf, len) != len) {
int err = errno;
close(fd);
errno = err;
return false;
}
close(fd);
return true;
}
const int kInitNetNsFd = 239;
static long syz\_init\_net\_socket(volatile long domain, volatile long type,
volatile long proto)
{
int netns = open("/proc/self/ns/net", O\_RDONLY);
if (netns == -1)
return netns;
if (setns(kInitNetNsFd, 0))
return -1;
int sock = syscall(\_\_NR\_socket, domain, type, proto);
int err = errno;
if (setns(netns, 0))
exit(1);
close(netns);
errno = err;
return sock;
}
#define BTPROTO\_HCI 1
#define ACL\_LINK 1
#define SCAN\_PAGE 2
typedef struct {
uint8\_t b[6];
} \_\_attribute\_\_((packed)) bdaddr\_t;
#define HCI\_COMMAND\_PKT 1
#define HCI\_EVENT\_PKT 4
#define HCI\_VENDOR\_PKT 0xff
struct hci\_command\_hdr {
uint16\_t opcode;
uint8\_t plen;
} \_\_attribute\_\_((packed));
struct hci\_event\_hdr {
uint8\_t evt;
uint8\_t plen;
} \_\_attribute\_\_((packed));
#define HCI\_EV\_CONN\_COMPLETE 0x03
struct hci\_ev\_conn\_complete {
uint8\_t status;
uint16\_t handle;
bdaddr\_t bdaddr;
uint8\_t link\_type;
uint8\_t encr\_mode;
} \_\_attribute\_\_((packed));
#define HCI\_EV\_CONN\_REQUEST 0x04
struct hci\_ev\_conn\_request {
bdaddr\_t bdaddr;
uint8\_t dev\_class[3];
uint8\_t link\_type;
} \_\_attribute\_\_((packed));
#define HCI\_EV\_REMOTE\_FEATURES 0x0b
struct hci\_ev\_remote\_features {
uint8\_t status;
uint16\_t handle;
uint8\_t features[8];
} \_\_attribute\_\_((packed));
#define HCI\_EV\_CMD\_COMPLETE 0x0e
struct hci\_ev\_cmd\_complete {
uint8\_t ncmd;
uint16\_t opcode;
} \_\_attribute\_\_((packed));
#define HCI\_OP\_WRITE\_SCAN\_ENABLE 0x0c1a
#define HCI\_OP\_READ\_BUFFER\_SIZE 0x1005
struct hci\_rp\_read\_buffer\_size {
uint8\_t status;
uint16\_t acl\_mtu;
uint8\_t sco\_mtu;
uint16\_t acl\_max\_pkt;
uint16\_t sco\_max\_pkt;
} \_\_attribute\_\_((packed));
#define HCI\_OP\_READ\_BD\_ADDR 0x1009
struct hci\_rp\_read\_bd\_addr {
uint8\_t status;
bdaddr\_t bdaddr;
} \_\_attribute\_\_((packed));
#define HCI\_EV\_LE\_META 0x3e
struct hci\_ev\_le\_meta {
uint8\_t subevent;
} \_\_attribute\_\_((packed));
#define HCI\_EV\_LE\_CONN\_COMPLETE 0x01
struct hci\_ev\_le\_conn\_complete {
uint8\_t status;
uint16\_t handle;
uint8\_t role;
uint8\_t bdaddr\_type;
bdaddr\_t bdaddr;
uint16\_t interval;
uint16\_t latency;
uint16\_t supervision\_timeout;
uint8\_t clk\_accurancy;
} \_\_attribute\_\_((packed));
struct hci\_dev\_req {
uint16\_t dev\_id;
uint32\_t dev\_opt;
};
struct vhci\_vendor\_pkt {
uint8\_t type;
uint8\_t opcode;
uint16\_t id;
};
#define HCIDEVUP \_IOW('H', 201, int)
#define HCISETSCAN \_IOW('H', 221, int)
static int vhci\_fd = -1;
static void hci\_send\_event\_packet(int fd, uint8\_t evt, void\* data,
size\_t data\_len)
{
struct iovec iv[3];
struct hci\_event\_hdr hdr;
hdr.evt = evt;
hdr.plen = data\_len;
uint8\_t type = HCI\_EVENT\_PKT;
iv[0].iov\_base = &type
iv[0].iov\_len = sizeof(type);
iv[1].iov\_base = &hdr
iv[1].iov\_len = sizeof(hdr);
iv[2].iov\_base = data;
iv[2].iov\_len = data\_len;
if (writev(fd, iv, sizeof(iv) / sizeof(struct iovec)) < 0)
exit(1);
}
static void hci\_send\_event\_cmd\_complete(int fd, uint16\_t opcode, void\* data,
size\_t data\_len)
{
struct iovec iv[4];
struct hci\_event\_hdr hdr;
hdr.evt = HCI\_EV\_CMD\_COMPLETE;
hdr.plen = sizeof(struct hci\_ev\_cmd\_complete) + data\_len;
struct hci\_ev\_cmd\_complete evt\_hdr;
evt\_hdr.ncmd = 1;
evt\_hdr.opcode = opcode;
uint8\_t type = HCI\_EVENT\_PKT;
iv[0].iov\_base = &type
iv[0].iov\_len = sizeof(type);
iv[1].iov\_base = &hdr
iv[1].iov\_len = sizeof(hdr);
iv[2].iov\_base = &evt\_hdr;
iv[2].iov\_len = sizeof(evt\_hdr);
iv[3].iov\_base = data;
iv[3].iov\_len = data\_len;
if (writev(fd, iv, sizeof(iv) / sizeof(struct iovec)) < 0)
exit(1);
}
static bool process\_command\_pkt(int fd, char\* buf, ssize\_t buf\_size)
{
struct hci\_command\_hdr\* hdr = (struct hci\_command\_hdr\*)buf;
if (buf\_size < (ssize\_t)sizeof(struct hci\_command\_hdr) ||
hdr->plen != buf\_size - sizeof(struct hci\_command\_hdr)) {
exit(1);
}
switch (hdr->opcode) {
case HCI\_OP\_WRITE\_SCAN\_ENABLE: {
uint8\_t status = 0;
hci\_send\_event\_cmd\_complete(fd, hdr->opcode, &status, sizeof(status));
return true;
}
case HCI\_OP\_READ\_BD\_ADDR: {
struct hci\_rp\_read\_bd\_addr rp = {0};
rp.status = 0;
memset(&rp.bdaddr, 0xaa, 6);
hci\_send\_event\_cmd\_complete(fd, hdr->opcode, &rp, sizeof(rp));
return false;
}
case HCI\_OP\_READ\_BUFFER\_SIZE: {
struct hci\_rp\_read\_buffer\_size rp = {0};
rp.status = 0;
rp.acl\_mtu = 1021;
rp.sco\_mtu = 96;
rp.acl\_max\_pkt = 4;
rp.sco\_max\_pkt = 6;
hci\_send\_event\_cmd\_complete(fd, hdr->opcode, &rp, sizeof(rp));
return false;
}
}
char dummy[0xf9] = {0};
hci\_send\_event\_cmd\_complete(fd, hdr->opcode, dummy, sizeof(dummy));
return false;
}
static void\* event\_thread(void\* arg)
{
while (1) {
char buf[1024] = {0};
ssize\_t buf\_size = read(vhci\_fd, buf, sizeof(buf));
if (buf\_size < 0)
exit(1);
if (buf\_size > 0 && buf[0] == HCI\_COMMAND\_PKT) {
if (process\_command\_pkt(vhci\_fd, buf + 1, buf\_size - 1))
break;
}
}
return NULL;
}
#define HCI\_HANDLE\_1 200
#define HCI\_HANDLE\_2 201
static void initialize\_vhci()
{
int hci\_sock = syz\_init\_net\_socket(AF\_BLUETOOTH, SOCK\_RAW, BTPROTO\_HCI);
if (hci\_sock < 0)
exit(1);
vhci\_fd = open("/dev/vhci", O\_RDWR);
if (vhci\_fd == -1)
exit(1);
const int kVhciFd = 241;
if (dup2(vhci\_fd, kVhciFd) < 0)
exit(1);
close(vhci\_fd);
vhci\_fd = kVhciFd;
struct vhci\_vendor\_pkt vendor\_pkt;
if (read(vhci\_fd, &vendor\_pkt, sizeof(vendor\_pkt)) != sizeof(vendor\_pkt))
exit(1);
if (vendor\_pkt.type != HCI\_VENDOR\_PKT)
exit(1);
pthread\_t th;
if (pthread\_create(&th, NULL, event\_thread, NULL))
exit(1);
if (ioctl(hci\_sock, HCIDEVUP, vendor\_pkt.id) && errno != EALREADY)
exit(1);
struct hci\_dev\_req dr = {0};
dr.dev\_id = vendor\_pkt.id;
dr.dev\_opt = SCAN\_PAGE;
if (ioctl(hci\_sock, HCISETSCAN, &dr))
exit(1);
struct hci\_ev\_conn\_request request;
memset(&request, 0, sizeof(request));
memset(&request.bdaddr, 0xaa, 6);
\*(uint8\_t\*)&request.bdaddr.b[5] = 0x10;
request.link\_type = ACL\_LINK;
hci\_send\_event\_packet(vhci\_fd, HCI\_EV\_CONN\_REQUEST, &request,
sizeof(request));
struct hci\_ev\_conn\_complete complete;
memset(&complete, 0, sizeof(complete));
complete.status = 0;
complete.handle = HCI\_HANDLE\_1;
memset(&complete.bdaddr, 0xaa, 6);
\*(uint8\_t\*)&complete.bdaddr.b[5] = 0x10;
complete.link\_type = ACL\_LINK;
complete.encr\_mode = 0;
hci\_send\_event\_packet(vhci\_fd, HCI\_EV\_CONN\_COMPLETE, &complete,
sizeof(complete));
struct hci\_ev\_remote\_features features;
memset(&features, 0, sizeof(features));
features.status = 0;
features.handle = HCI\_HANDLE\_1;
hci\_send\_event\_packet(vhci\_fd, HCI\_EV\_REMOTE\_FEATURES, &features,
sizeof(features));
struct {
struct hci\_ev\_le\_meta le\_meta;
struct hci\_ev\_le\_conn\_complete le\_conn;
} le\_conn;
memset(â‰¤\_conn, 0, sizeof(le\_conn));
le\_conn.le\_meta.subevent = HCI\_EV\_LE\_CONN\_COMPLETE;
memset(â‰¤\_conn.le\_conn.bdaddr, 0xaa, 6);
\*(uint8\_t\*)â‰¤\_conn.le\_conn.bdaddr.b[5] = 0x11;
le\_conn.le\_conn.role = 1;
le\_conn.le\_conn.handle = HCI\_HANDLE\_2;
hci\_send\_event\_packet(vhci\_fd, HCI\_EV\_LE\_META, â‰¤\_conn, sizeof(le\_conn));
pthread\_join(th, NULL);
close(hci\_sock);
}
static long syz\_emit\_vhci(volatile long a0, volatile long a1)
{
if (vhci\_fd < 0)
return (uintptr\_t)-1;
char\* data = (char\*)a0;
uint32\_t length = a1;
return write(vhci\_fd, data, length);
}
static void setup\_common()
{
if (mount(0, "/sys/fs/fuse/connections", "fusectl", 0, 0)) {
}
}
static void loop();
static void sandbox\_common()
{
prctl(PR\_SET\_PDEATHSIG, SIGKILL, 0, 0, 0);
setpgrp();
setsid();
int netns = open("/proc/self/ns/net", O\_RDONLY);
if (netns == -1)
exit(1);
if (dup2(netns, kInitNetNsFd) < 0)
exit(1);
close(netns);
struct rlimit rlim;
rlim.rlim\_cur = rlim.rlim\_max = (200 << 20);
setrlimit(RLIMIT\_AS, &rlim);
rlim.rlim\_cur = rlim.rlim\_max = 32 << 20;
setrlimit(RLIMIT\_MEMLOCK, &rlim);
rlim.rlim\_cur = rlim.rlim\_max = 136 << 20;
setrlimit(RLIMIT\_FSIZE, &rlim);
rlim.rlim\_cur = rlim.rlim\_max = 1 << 20;
setrlimit(RLIMIT\_STACK, &rlim);
rlim.rlim\_cur = rlim.rlim\_max = 0;
setrlimit(RLIMIT\_CORE, &rlim);
rlim.rlim\_cur = rlim.rlim\_max = 256;
setrlimit(RLIMIT\_NOFILE, &rlim);
if (unshare(CLONE\_NEWNS)) {
}
if (unshare(CLONE\_NEWIPC)) {
}
if (unshare(0x02000000)) {
}
if (unshare(CLONE\_NEWUTS)) {
}
if (unshare(CLONE\_SYSVSEM)) {
}
typedef struct {
const char\* name;
const char\* value;
} sysctl\_t;
static const sysctl\_t sysctls[] = {
{"/proc/sys/kernel/shmmax", "16777216"},
{"/proc/sys/kernel/shmall", "536870912"},
{"/proc/sys/kernel/shmmni", "1024"},
{"/proc/sys/kernel/msgmax", "8192"},
{"/proc/sys/kernel/msgmni", "1024"},
{"/proc/sys/kernel/msgmnb", "1024"},
{"/proc/sys/kernel/sem", "1024 1048576 500 1024"},
};
unsigned i;
for (i = 0; i < sizeof(sysctls) / sizeof(sysctls[0]); i++)
write\_file(sysctls[i].name, sysctls[i].value);
}
static int wait\_for\_loop(int pid)
{
if (pid < 0)
exit(1);
int status = 0;
while (waitpid(-1, &status, \_\_WALL) != pid) {
}
return WEXITSTATUS(status);
}
static void drop\_caps(void)
{
struct \_\_user\_cap\_header\_struct cap\_hdr = {};
struct \_\_user\_cap\_data\_struct cap\_data[2] = {};
cap\_hdr.version = \_LINUX\_CAPABILITY\_VERSION\_3;
cap\_hdr.pid = getpid();
if (syscall(SYS\_capget, âˆ©\_hdr, âˆ©\_data))
exit(1);
const int drop = (1 << CAP\_SYS\_PTRACE) | (1 << CAP\_SYS\_NICE);
cap\_data[0].effective &= ~drop;
cap\_data[0].permitted &= ~drop;
cap\_data[0].inheritable &= ~drop;
if (syscall(SYS\_capset, âˆ©\_hdr, âˆ©\_data))
exit(1);
}
static int do\_sandbox\_none(void)
{
if (unshare(CLONE\_NEWPID)) {
}
int pid = fork();
if (pid != 0)
return wait\_for\_loop(pid);
setup\_common();
sandbox\_common();
drop\_caps();
if (unshare(CLONE\_NEWNET)) {
}
initialize\_vhci();
loop();
exit(1);
}
void loop(void)
{
memcpy((void\*)0x20000080, "\x04\x2f\x4c\x20", 4);
syz\_emit\_vhci(0x20000080, 7);
}
int main(void)
{
syscall(\_\_NR\_mmap, 0x1ffff000ul, 0x1000ul, 0ul, 0x32ul, -1, 0ul);
syscall(\_\_NR\_mmap, 0x20000000ul, 0x1000000ul, 7ul, 0x32ul, -1, 0ul);
syscall(\_\_NR\_mmap, 0x21000000ul, 0x1000ul, 0ul, 0x32ul, -1, 0ul);
do\_sandbox\_none();
return 0;
}


=== Content from git.kernel.org_962e8096_20250119_112241.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master vsnprintf |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=51c19bf3d5cfaa66571e4b88ba2a6f6295311101)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=51c19bf3d5cfaa66571e4b88ba2a6f6295311101)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=51c19bf3d5cfaa66571e4b88ba2a6f6295311101)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=51c19bf3d5cfaa66571e4b88ba2a6f6295311101)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Peilin Ye <yepeilin.cs@gmail.com> | 2020-07-10 12:09:15 -0400 |
| --- | --- | --- |
| committer | Marcel Holtmann <marcel@holtmann.org> | 2020-07-10 19:08:32 +0200 |
| commit | [51c19bf3d5cfaa66571e4b88ba2a6f6295311101](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=51c19bf3d5cfaa66571e4b88ba2a6f6295311101) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=51c19bf3d5cfaa66571e4b88ba2a6f6295311101)) | |
| tree | [6cf9d3177bc98e38e12a72ebce4ebb141923fc14](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=51c19bf3d5cfaa66571e4b88ba2a6f6295311101) | |
| parent | [51b64c476a5ddc66d3459f14e98e5de9211e9e24](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=51b64c476a5ddc66d3459f14e98e5de9211e9e24) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=51c19bf3d5cfaa66571e4b88ba2a6f6295311101&id2=51b64c476a5ddc66d3459f14e98e5de9211e9e24)) | |
| download | [linux-51c19bf3d5cfaa66571e4b88ba2a6f6295311101.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-51c19bf3d5cfaa66571e4b88ba2a6f6295311101.tar.gz) | |

Bluetooth: Fix slab-out-of-bounds read in hci\_extended\_inquiry\_result\_evt()Check upon `num\_rsp` is insufficient. A malformed event packet with a
large `num\_rsp` number makes hci\_extended\_inquiry\_result\_evt() go out
of bounds. Fix it.
This patch fixes the following syzbot bug:
https://syzkaller.appspot.com/bug?id=4bf11aa05c4ca51ce0df86e500fce486552dc8d2
Reported-by: syzbot+d8489a79b781849b9c46@syzkaller.appspotmail.com
Cc: stable@vger.kernel.org
Signed-off-by: Peilin Ye <yepeilin.cs@gmail.com>
Acked-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Marcel Holtmann <marcel@holtmann.org>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=51c19bf3d5cfaa66571e4b88ba2a6f6295311101)

| -rw-r--r-- | [net/bluetooth/hci\_event.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/net/bluetooth/hci_event.c?id=51c19bf3d5cfaa66571e4b88ba2a6f6295311101) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/net/bluetooth/hci\_event.c b/net/bluetooth/hci\_event.cindex 03a0759f2fc25c..13d8802b813734 100644--- a/[net/bluetooth/hci\_event.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/bluetooth/hci_event.c?id=51b64c476a5ddc66d3459f14e98e5de9211e9e24)+++ b/[net/bluetooth/hci\_event.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/bluetooth/hci_event.c?id=51c19bf3d5cfaa66571e4b88ba2a6f6295311101)@@ -4375,7 +4375,7 @@ static void hci\_extended\_inquiry\_result\_evt(struct hci\_dev \*hdev,  BT\_DBG("%s num\_rsp %d", hdev->name, num\_rsp); - if (!num\_rsp)+ if (!num\_rsp || skb->len < num\_rsp \* sizeof(\*info) + 1) return;  if (hci\_dev\_test\_flag(hdev, HCI\_PERIODIC\_INQ)) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-19 11:21:18 +0000



=== Content from cdn.kernel.org_8e07279c_20250119_112240.html ===
commit 5f49ff2540e2c2799cde0cfaf6af9e1f824cd393
Author: Greg Kroah-Hartman
Date: Tue Aug 11 15:48:12 2020 +0200
Linux 5.8.1
Tested-by: Shuah Khan
Signed-off-by: Greg Kroah-Hartman
commit b08bdb1dfc66d8c87c28c445e36762bfa5746c3a
Author: Guenter Roeck
Date: Fri Aug 7 07:45:21 2020 -0700
arm64: kaslr: Use standard early random function
commit 9bceb80b3cc483e6763c39a4928402fa82815d3e upstream.
Commit 585524081ecd ("random: random.h should include archrandom.h, not
the other way around") tries to fix a problem with recursive inclusion
of linux/random.h and arch/archrandom.h for arm64. Unfortunately, this
results in the following compile error if ARCH\_RANDOM is disabled.
arch/arm64/kernel/kaslr.c: In function 'kaslr\_early\_init':
arch/arm64/kernel/kaslr.c:128:6: error: implicit declaration of function '\_\_early\_cpu\_has\_rndr'; did you mean '\_\_early\_pfn\_to\_nid'? [-Werror=implicit-function-declaration]
if (\_\_early\_cpu\_has\_rndr()) {
^~~~~~~~~~~~~~~~~~~~
\_\_early\_pfn\_to\_nid
arch/arm64/kernel/kaslr.c:131:7: error: implicit declaration of function '\_\_arm64\_rndr' [-Werror=implicit-function-declaration]
if (\_\_arm64\_rndr(&raw))
^~~~~~~~~~~~
The problem is that arch/archrandom.h is only included from
linux/random.h if ARCH\_RANDOM is enabled. If not, \_\_arm64\_rndr() and
\_\_early\_cpu\_has\_rndr() are undeclared, causing the problem.
Use arch\_get\_random\_seed\_long\_early() instead of arm64 specific
functions to solve the problem.
Reported-by: Qian Cai
Fixes: 585524081ecd ("random: random.h should include archrandom.h, not the other way around")
Cc: Qian Cai
Cc: Mark Brown
Reviewed-by: Mark Rutland
Reviewed-by: Mark Brown
Tested-by: Mark Brown
Signed-off-by: Guenter Roeck
Signed-off-by: Linus Torvalds
Cc: Sedat Dilek
Signed-off-by: Greg Kroah-Hartman
commit cdb665888c69a094292475c739f7fc462f9d79eb
Author: Linus Torvalds
Date: Wed Aug 5 12:39:48 2020 -0700
random: random.h should include archrandom.h, not the other way around
commit 585524081ecdcde1c719e63916c514866d898217 upstream.
This is hopefully the final piece of the crazy puzzle with random.h
dependencies.
And by "hopefully" I obviously mean "Linus is a hopeless optimist".
Reported-and-tested-by: Daniel DÃ­az
Acked-by: Guenter Roeck
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 6ccec4279301e21cf98d2ab8458fb1f2f610b898
Author: Linus Torvalds
Date: Fri Jul 31 07:51:14 2020 +0200
random32: move the pseudo-random 32-bit definitions to prandom.h
commit c0842fbc1b18c7a044e6ff3e8fa78bfa822c7d1a upstream.
The addition of percpu.h to the list of includes in random.h revealed
some circular dependencies on arm64 and possibly other platforms. This
include was added solely for the pseudo-random definitions, which have
nothing to do with the rest of the definitions in this file but are
still there for legacy reasons.
This patch moves the pseudo-random parts to linux/prandom.h and the
percpu.h include with it, which is now guarded by \_LINUX\_PRANDOM\_H and
protected against recursive inclusion.
A further cleanup step would be to remove this from
entirely, and make people who use the prandom infrastructure include
just the new header file. That's a bit of a churn patch, but grepping
for "prandom\_" and "next\_pseudo\_random32" "struct rnd\_state" should
catch most users.
But it turns out that that nice cleanup step is fairly painful, because
a \_lot\_ of code currently seems to depend on the implicit include of
, which can currently come in a lot of ways, including
such fairly core headfers as .
So the "nice cleanup" part may or may never happen.
Fixes: 1c9df907da83 ("random: fix circular include dependency on arm64 after addition of percpu.h")
Tested-by: Guenter Roeck
Acked-by: Willy Tarreau
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 37b9e5781ba9007a1252cc39fdcfa4abbff5aa96
Author: Bruno Meneguele
Date: Mon Jul 13 13:48:30 2020 -0300
ima: move APPRAISE\_BOOTPARAM dependency on ARCH\_POLICY to runtime
commit 311aa6aafea446c2f954cc19d66425bfed8c4b0b upstream.
The IMA\_APPRAISE\_BOOTPARAM config allows enabling different "ima\_appraise="
modes - log, fix, enforce - at run time, but not when IMA architecture
specific policies are enabled. Â This prevents properly labeling the
filesystem on systems where secure boot is supported, but not enabled on the
platform. Â Only when secure boot is actually enabled should these IMA
appraise modes be disabled.
This patch removes the compile time dependency and makes it a runtime
decision, based on the secure boot state of that platform.
Test results as follows:
-> x86-64 with secure boot enabled
[ 0.015637] Kernel command line: <...> ima\_policy=appraise\_tcb ima\_appraise=fix
[ 0.015668] ima: Secure boot enabled: ignoring ima\_appraise=fix boot parameter option
-> powerpc with secure boot disabled
[ 0.000000] Kernel command line: <...> ima\_policy=appraise\_tcb ima\_appraise=fix
[ 0.000000] Secure boot mode disabled
-> Running the system without secure boot and with both options set:
CONFIG\_IMA\_APPRAISE\_BOOTPARAM=y
CONFIG\_IMA\_ARCH\_POLICY=y
Audit prompts "missing-hash" but still allow execution and, consequently,
filesystem labeling:
type=INTEGRITY\_DATA msg=audit(07/09/2020 12:30:27.778:1691) : pid=4976
uid=root auid=root ses=2
subj=unconfined\_u:unconfined\_r:unconfined\_t:s0-s0:c0.c1023 op=appraise\_data
cause=missing-hash comm=bash name=/usr/bin/evmctl dev="dm-0" ino=493150
res=no
Cc: stable@vger.kernel.org
Fixes: d958083a8f64 ("x86/ima: define arch\_get\_ima\_policy() for x86")
Signed-off-by: Bruno Meneguele
Cc: stable@vger.kernel.org # 5.0
Signed-off-by: Mimi Zohar
Signed-off-by: Greg Kroah-Hartman
commit f9e3fa8953147cd778d3e49dfeb84bf307730b63
Author: Nicolas Chauvet
Date: Sat Jul 18 12:07:10 2020 +0200
PCI: tegra: Revert tegra124 raw\_violation\_fixup
commit e7b856dfcec6d3bf028adee8c65342d7035914a1 upstream.
As reported in https://bugzilla.kernel.org/206217 , raw\_violation\_fixup
is causing more harm than good in some common use-cases.
This patch is a partial revert of commit:
191cd6fb5d2c ("PCI: tegra: Add SW fixup for RAW violations")
and fixes the following regression since then.
\* Description:
When both the NIC and MMC are used one can see the following message:
NETDEV WATCHDOG: enp1s0 (r8169): transmit queue 0 timed out
and
pcieport 0000:00:02.0: AER: Uncorrected (Non-Fatal) error received: 0000:01:00.0
r8169 0000:01:00.0: AER: PCIe Bus Error: severity=Uncorrected (Non-Fatal), type=Transaction Layer, (Requester ID)
r8169 0000:01:00.0: AER: device [10ec:8168] error status/mask=00004000/00400000
r8169 0000:01:00.0: AER: [14] CmpltTO (First)
r8169 0000:01:00.0: AER: can't recover (no error\_detected callback)
pcieport 0000:00:02.0: AER: device recovery failed
After that, the ethernet NIC is not functional anymore even after
reloading the r8169 module. After a reboot, this is reproducible by
copying a large file over the NIC to the MMC.
For some reason this is not reproducible when files are copied to a tmpfs.
\* Little background on the fixup, by Manikanta Maddireddy:
"In the internal testing with dGPU on Tegra124, CmplTO is reported by
dGPU. This happened because FIFO queue in AFI(AXI to PCIe) module
get full by upstream posted writes. Back to back upstream writes
interleaved with infrequent reads, triggers RAW violation and CmpltTO.
This is fixed by reducing the posted write credits and by changing
updateFC timer frequency. These settings are fixed after stress test.
In the current case, RTL NIC is also reporting CmplTO. These settings
seems to be aggravating the issue instead of fixing it."
Link: https://lore.kernel.org/r/20200718100710.15398-1-kwizart@gmail.com
Fixes: 191cd6fb5d2c ("PCI: tegra: Add SW fixup for RAW violations")
Signed-off-by: Nicolas Chauvet
Signed-off-by: Lorenzo Pieralisi
Reviewed-by: Manikanta Maddireddy
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 6f5f284ac0a17f305b7ad6e2893a2064185cbe23
Author: Christophe Leroy
Date: Thu Jul 2 11:52:03 2020 +0000
powerpc/kasan: Fix shadow pages allocation failure
commit 41ea93cf7ba4e0f0cc46ebfdda8b6ff27c67bc91 upstream.
Doing kasan pages allocation in MMU\_init is too early, kernel doesn't
have access yet to the entire memory space and memblock\_alloc() fails
when the kernel is a bit big.
Do it from kasan\_init() instead.
Fixes: 2edb16efc899 ("powerpc/32: Add KASAN support")
Fixes: d2a91cef9bbd ("powerpc/kasan: Fix shadow pages allocation failure")
Cc: stable@vger.kernel.org
Reported-by: Erhard F.
Signed-off-by: Christophe Leroy
Signed-off-by: Michael Ellerman
Link: https://bugzilla.kernel.org/show\_bug.cgi?id=208181
Link: https://lore.kernel.org/r/63048fcea8a1c02f75429ba3152f80f7853f87fc.1593690707.git.christophe.leroy@csgroup.eu
Signed-off-by: Greg Kroah-Hartman
commit 4fed32566a038a55c9fbad4a3cee9c7a0533d1fa
Author: Christophe Leroy
Date: Thu Jul 2 11:52:02 2020 +0000
Revert "powerpc/kasan: Fix shadow pages allocation failure"
commit b506923ee44ae87fc9f4de16b53feb313623e146 upstream.
This reverts commit d2a91cef9bbdeb87b7449fdab1a6be6000930210.
This commit moved too much work in kasan\_init(). The allocation
of shadow pages has to be moved for the reason explained in that
patch, but the allocation of page tables still need to be done
before switching to the final hash table.
First revert the incorrect commit, following patch redoes it
properly.
Fixes: d2a91cef9bbd ("powerpc/kasan: Fix shadow pages allocation failure")
Cc: stable@vger.kernel.org
Reported-by: Erhard F.
Signed-off-by: Christophe Leroy
Signed-off-by: Michael Ellerman
Link: https://bugzilla.kernel.org/show\_bug.cgi?id=208181
Link: https://lore.kernel.org/r/3667deb0911affbf999b99f87c31c77d5e870cd2.1593690707.git.christophe.leroy@csgroup.eu
Signed-off-by: Greg Kroah-Hartman
commit ff35fac0d075af156a2b46759c0898a889faeb09
Author: Frank van der Linden
Date: Tue Jun 23 22:39:18 2020 +0000
xattr: break delegations in {set,remove}xattr
commit 08b5d5014a27e717826999ad20e394a8811aae92 upstream.
set/removexattr on an exported filesystem should break NFS delegations.
This is true in general, but also for the upcoming support for
RFC 8726 (NFSv4 extended attribute support). Make sure that they do.
Additionally, they need to grow a \_locked variant, since callers might
call this with i\_rwsem held (like the NFS server code).
Cc: stable@vger.kernel.org # v4.9+
Cc: linux-fsdevel@vger.kernel.org
Cc: Al Viro
Signed-off-by: Frank van der Linden
Signed-off-by: Chuck Lever
Signed-off-by: Greg Kroah-Hartman
commit 325811793d3442005ffb71b73fb0dd1aa209ae61
Author: Dmitry Osipenko
Date: Thu Jul 9 20:11:59 2020 +0300
gpio: max77620: Fix missing release of interrupt
commit 2a5e6f7eede8cd1c4bac0b8ec6491cec4e75c99a upstream.
The requested interrupt is never released by the driver. Fix this by
using the resource-managed variant of request\_threaded\_irq().
Fixes: ab3dd9cc24d4 ("gpio: max77620: Fix interrupt handling")
Signed-off-by: Dmitry Osipenko
Reviewed-by: Andy Shevchenko
Acked-by: Laxman Dewangan
Cc:  # 5.5+
Link: https://lore.kernel.org/r/20200709171203.12950-3-digetx@gmail.com
Signed-off-by: Linus Walleij
Signed-off-by: Greg Kroah-Hartman
commit 344c69a060496cb44315faf024a4f7477976d301
Author: Johan Hovold
Date: Mon Jun 1 15:39:45 2020 +0200
leds: 88pm860x: fix use-after-free on unbind
commit eca21c2d8655387823d695b26e6fe78cf3975c05 upstream.
Several MFD child drivers register their class devices directly under
the parent device. This means you cannot blindly do devres conversions
so that deregistration ends up being tied to the parent device,
something which leads to use-after-free on driver unbind when the class
device is released while still being registered.
Fixes: 375446df95ee ("leds: 88pm860x: Use devm\_led\_classdev\_register")
Cc: stable  # 4.6
Cc: Amitoj Kaur Chawla
Signed-off-by: Johan Hovold
Signed-off-by: Pavel Machek
Signed-off-by: Greg Kroah-Hartman
commit 6796fca30e0a3d64ab35703c8bbc392bb87089ce
Author: Johan Hovold
Date: Mon Jun 1 15:39:47 2020 +0200
leds: lm3533: fix use-after-free on unbind
commit d584221e683bbd173738603b83a315f27d27d043 upstream.
Several MFD child drivers register their class devices directly under
the parent device. This means you cannot blindly do devres conversions
so that deregistration ends up being tied to the parent device,
something which leads to use-after-free on driver unbind when the class
device is released while still being registered.
Fixes: 50154e29e5cc ("leds: lm3533: Use devm\_led\_classdev\_register")
Cc: stable  # 4.6
Cc: Amitoj Kaur Chawla
Signed-off-by: Johan Hovold
Signed-off-by: Pavel Machek
Signed-off-by: Greg Kroah-Hartman
commit 6e99065db5b90ccc365a5364e275e13d16cde52a
Author: Johan Hovold
Date: Mon Jun 1 15:39:46 2020 +0200
leds: da903x: fix use-after-free on unbind
commit 6f4aa35744f69ed9b0bf5a736c9ca9b44bc1dcea upstream.
Several MFD child drivers register their class devices directly under
the parent device. This means you cannot blindly do devres conversions
so that deregistration ends up being tied to the parent device,
something which leads to use-after-free on driver unbind when the class
device is released while still being registered.
Fixes: eed16255d66b ("leds: da903x: Use devm\_led\_classdev\_register")
Cc: stable  # 4.6
Cc: Amitoj Kaur Chawla
Signed-off-by: Johan Hovold
Signed-off-by: Pavel Machek
Signed-off-by: Greg Kroah-Hartman
commit 405c0f5604374a8f626a400fcf225574e9a07230
Author: Johan Hovold
Date: Mon Jun 1 15:39:48 2020 +0200
leds: lm36274: fix use-after-free on unbind
commit a0972fff09479dd09b731360a3a0b09e4fb4d415 upstream.
Several MFD child drivers register their class devices directly under
the parent device. This means you cannot use devres so that
deregistration ends up being tied to the parent device, something which
leads to use-after-free on driver unbind when the class device is
released while still being registered.
Fixes: 11e1bbc116a7 ("leds: lm36274: Introduce the TI LM36274 LED driver")
Cc: stable  # 5.3
Cc: Dan Murphy
Signed-off-by: Johan Hovold
Signed-off-by: Pavel Machek
Signed-off-by: Greg Kroah-Hartman
commit 2cbb6111b385f1b9f0130e4b309047242ba2e9a8
Author: Johan Hovold
Date: Mon Jun 1 15:39:49 2020 +0200
leds: wm831x-status: fix use-after-free on unbind
commit 47a459ecc800a17109d0c496a4e21e478806ee40 upstream.
Several MFD child drivers register their class devices directly under
the parent device. This means you cannot blindly do devres conversions
so that deregistration ends up being tied to the parent device,
something which leads to use-after-free on driver unbind when the class
device is released while still being registered.
Fixes: 8d3b6a4001ce ("leds: wm831x-status: Use devm\_led\_classdev\_register")
Cc: stable  # 4.6
Cc: Amitoj Kaur Chawla
Signed-off-by: Johan Hovold
Signed-off-by: Pavel Machek
Signed-off-by: Greg Kroah-Hartman
commit eb3d82abc335624a5e8ecfb75aba0b684e2dc4db
Author: Greg Kroah-Hartman
Date: Thu Jul 16 13:53:46 2020 +0200
mtd: properly check all write ioctls for permissions
commit f7e6b19bc76471ba03725fe58e0c218a3d6266c3 upstream.
When doing a "write" ioctl call, properly check that we have permissions
to do so before copying anything from userspace or anything else so we
can "fail fast". This includes also covering the MEMWRITE ioctl which
previously missed checking for this.
Cc: Miquel Raynal
Cc: Richard Weinberger
Cc: Vignesh Raghavendra
Cc: stable
Signed-off-by: Greg Kroah-Hartman
[rw: Fixed locking issue]
Signed-off-by: Richard Weinberger
Signed-off-by: Greg Kroah-Hartman
commit 0ca4ebe9d6350e758e40683f08fd93cb4539e0b7
Author: Yunhai Zhang
Date: Tue Jul 28 09:58:03 2020 +0800
vgacon: Fix for missing check in scrollback handling
commit ebfdfeeae8c01fcb2b3b74ffaf03876e20835d2d upstream.
vgacon\_scrollback\_update() always leaves enbough room in the scrollback
buffer for the next call, but if the console size changed that room
might not actually be enough, and so we need to re-check.
The check should be in the loop since vgacon\_scrollback\_cur->tail is
updated in the loop and count may be more than 1 when triggered by CSI M,
as Jiri's PoC:
#include
#include
#include
#include
#include
#include
#include
int main(int argc, char\*\* argv)
{
int fd = open("/dev/tty1", O\_RDWR);
unsigned short size[3] = {25, 200, 0};
ioctl(fd, 0x5609, size); // VT\_RESIZE
write(fd, "\e[1;1H", 6);
for (int i = 0; i < 30; i++)
write(fd, "\e[10M", 5);
}
It leads to various crashes as vgacon\_scrollback\_update writes out of
the buffer:
BUG: unable to handle page fault for address: ffffc900001752a0
#PF: supervisor write access in kernel mode
#PF: error\_code(0x0002) - not-present page
RIP: 0010:mutex\_unlock+0x13/0x30
...
Call Trace:
n\_tty\_write+0x1a0/0x4d0
tty\_write+0x1a0/0x2e0
Or to KASAN reports:
BUG: KASAN: slab-out-of-bounds in vgacon\_scroll+0x57a/0x8ed
This fixes CVE-2020-14331.
Reported-by: å¼ äº‘æµ·
Reported-by: Yang Yingliang
Reported-by: Kyungtae Kim
Fixes: 15bdab959c9b ([PATCH] vgacon: Add support for soft scrollback)
Cc: stable@vger.kernel.org
Cc: linux-fbdev@vger.kernel.org
Cc: Linus Torvalds
Cc: Solar Designer
Cc: "Srivatsa S. Bhat"
Cc: Anthony Liguori
Cc: Yang Yingliang
Cc: Bartlomiej Zolnierkiewicz
Cc: Jiri Slaby
Signed-off-by: Yunhai Zhang
Link: https://lore.kernel.org/r/9fb43895-ca91-9b07-ebfd-808cf854ca95@nsfocus.com
Signed-off-by: Greg Kroah-Hartman
commit b8eb3d95c2d4c2c2889b674c47c0e5493884558e
Author: Kees Cook
Date: Thu Jun 25 13:37:02 2020 -0700
lkdtm/heap: Avoid edge and middle of slabs
commit e12145cf1c3a8077e6d9f575711e38dd7d8a3ebc upstream.
Har har, after I moved the slab freelist pointer into the middle of the
slab, now it looks like the contents are getting poisoned. Adjust the
test to avoid the freelist pointer again.
Fixes: 3202fa62fb43 ("slub: relocate freelist pointer to middle of object")
Cc: stable@vger.kernel.org
Signed-off-by: Kees Cook
Link: https://lore.kernel.org/r/20200625203704.317097-3-keescook@chromium.org
Signed-off-by: Greg Kroah-Hartman
commit 3266873640b76a22e41057c0d644dc14a5a392bb
Author: Matthias Maennich
Date: Thu Jun 4 18:41:45 2020 +0200
scripts: add dummy report mode to add\_namespace.cocci
commit 55c7549819e438f40a3ef1d8ac5c38b73390bcb7 upstream.
When running `make coccicheck` in report mode using the
add\_namespace.cocci file, it will fail for files that contain
MODULE\_LICENSE. Those match the replacement precondition, but spatch
errors out as virtual.ns is not set.
In order to fix that, add the virtual rule nsdeps and only do search and
replace if that rule has been explicitly requested.
In order to make spatch happy in report mode, we also need a dummy rule,
as otherwise it errors out with "No rules apply". Using a script:python
rule appears unrelated and odd, but this is the shortest I could come up
with.
Adjust scripts/nsdeps accordingly to set the nsdeps rule when run trough
`make nsdeps`.
Suggested-by: Julia Lawall
Fixes: c7c4e29fb5a4 ("scripts: add\_namespace: Fix coccicheck failed")
Cc: YueHaibing
Cc: jeyu@kernel.org
Cc: cocci@systeme.lip6.fr
Cc: stable@vger.kernel.org
Signed-off-by: Matthias Maennich
Reported-by: Shuah Khan
Acked-by: Julia Lawall
Link: https://lore.kernel.org/r/20200604164145.173925-1-maennich@google.com
Signed-off-by: Greg Kroah-Hartman
commit 5ec142a2e9e6542372f80c42184c8dfb97c69f14
Author: Eric Biggers
Date: Wed Jul 8 13:15:20 2020 -0700
Smack: fix use-after-free in smk\_write\_relabel\_self()
commit beb4ee6770a89646659e6a2178538d2b13e2654e upstream.
smk\_write\_relabel\_self() frees memory from the task's credentials with
no locking, which can easily cause a use-after-free because multiple
tasks can share the same credentials structure.
Fix this by using prepare\_creds() and commit\_creds() to correctly modify
the task's credentials.
Reproducer for "BUG: KASAN: use-after-free in smk\_write\_relabel\_self":
#include
#include
#include
static void \*thrproc(void \*arg)
{
int fd = open("/sys/fs/smackfs/relabel-self", O\_WRONLY);
for (;;) write(fd, "foo", 3);
}
int main()
{
pthread\_t t;
pthread\_create(&t, NULL, thrproc, NULL);
thrproc(NULL);
}
Reported-by: syzbot+e6416dabb497a650da40@syzkaller.appspotmail.com
Fixes: 38416e53936e ("Smack: limited capability for changing process label")
Cc:  # v4.4+
Signed-off-by: Eric Biggers
Signed-off-by: Casey Schaufler
Signed-off-by: Greg Kroah-Hartman
commit 382c0fa38c0e1341e4704fb65c0435630c6f8421
Author: Jann Horn
Date: Mon Jul 27 14:04:24 2020 +0200
binder: Prevent context manager from incrementing ref 0
commit 4b836a1426cb0f1ef2a6e211d7e553221594f8fc upstream.
Binder is designed such that a binder\_proc never has references to
itself. If this rule is violated, memory corruption can occur when a
process sends a transaction to itself; see e.g.
.
There is a remaining edgecase through which such a transaction-to-self
can still occur from the context of a task with BINDER\_SET\_CONTEXT\_MGR
access:
- task A opens /dev/binder twice, creating binder\_proc instances P1
and P2
- P1 becomes context manager
- P2 calls ACQUIRE on the magic handle 0, allocating index 0 in its
handle table
- P1 dies (by closing the /dev/binder fd and waiting a bit)
- P2 becomes context manager
- P2 calls ACQUIRE on the magic handle 0, allocating index 1 in its
handle table
[this triggers a warning: "binder: 1974:1974 tried to acquire
reference to desc 0, got 1 instead"]
- task B opens /dev/binder once, creating binder\_proc instance P3
- P3 calls P2 (via magic handle 0) with (void\*)1 as argument (two-way
transaction)
- P2 receives the handle and uses it to call P3 (two-way transaction)
- P3 calls P2 (via magic handle 0) (two-way transaction)
- P2 calls P2 (via handle 1) (two-way transaction)
And then, if P2 does \*NOT\* accept the incoming transaction work, but
instead closes the binder fd, we get a crash.
Solve it by preventing the context manager from using ACQUIRE on ref 0.
There shouldn't be any legitimate reason for the context manager to do
that.
Additionally, print a warning if someone manages to find another way to
trigger a transaction-to-self bug in the future.
Cc: stable@vger.kernel.org
Fixes: 457b9a6f09f0 ("Staging: android: add binder driver")
Acked-by: Todd Kjos
Signed-off-by: Jann Horn
Reviewed-by: Martijn Coenen
Link: https://lore.kernel.org/r/20200727120424.1627555-1-jannh@google.com
Signed-off-by: Greg Kroah-Hartman
commit 3a75ed41c7abb37948267c282371d49955129035
Author: Adam Ford
Date: Tue Jun 30 13:26:36 2020 -0500
omapfb: dss: Fix max fclk divider for omap36xx
commit 254503a2b186caa668a188dbbd7ab0d25149c0a5 upstream.
The drm/omap driver was fixed to correct an issue where using a
divider of 32 breaks the DSS despite the TRM stating 32 is a valid
number. Through experimentation, it appears that 31 works, and
it is consistent with the value used by the drm/omap driver.
This patch fixes the divider for fbdev driver instead of the drm.
Fixes: f76ee892a99e ("omapfb: copy omapdss & displays for omapfb")
Cc:  #4.5+
Signed-off-by: Adam Ford
Reviewed-by: Tomi Valkeinen
Cc: Dave Airlie
Cc: Rob Clark
[b.zolnierkie: mark patch as applicable to stable 4.5+ (was 4.9+)]
Signed-off-by: Bartlomiej Zolnierkiewicz
Link: https://patchwork.freedesktop.org/patch/msgid/20200630182636.439015-1-aford173@gmail.com
Signed-off-by: Greg Kroah-Hartman
commit be1c835747f90451a780583c10f67b98bb79ba7e
Author: Peilin Ye
Date: Fri Jul 10 17:45:26 2020 -0400
Bluetooth: Prevent out-of-bounds read in hci\_inquiry\_result\_with\_rssi\_evt()
commit 629b49c848ee71244203934347bd7730b0ddee8d upstream.
Check `num\_rsp` before using it as for-loop counter. Add `unlock` label.
Cc: stable@vger.kernel.org
Signed-off-by: Peilin Ye
Signed-off-by: Marcel Holtmann
Signed-off-by: Greg Kroah-Hartman
commit f00e01212d7812b005ac770f812109cfe57c25c1
Author: Peilin Ye
Date: Fri Jul 10 17:39:18 2020 -0400
Bluetooth: Prevent out-of-bounds read in hci\_inquiry\_result\_evt()
commit 75bbd2ea50ba1c5d9da878a17e92eac02fe0fd3a upstream.
Check `num\_rsp` before using it as for-loop counter.
Cc: stable@vger.kernel.org
Signed-off-by: Peilin Ye
Signed-off-by: Marcel Holtmann
Signed-off-by: Greg Kroah-Hartman
commit cc09a53b7252eeffd2c1d403d215dd0f3aad1f5d
Author: Peilin Ye
Date: Fri Jul 10 12:09:15 2020 -0400
Bluetooth: Fix slab-out-of-bounds read in hci\_extended\_inquiry\_result\_evt()
commit 51c19bf3d5cfaa66571e4b88ba2a6f6295311101 upstream.
Check upon `num\_rsp` is insufficient. A malformed event packet with a
large `num\_rsp` number makes hci\_extended\_inquiry\_result\_evt() go out
of bounds. Fix it.
This patch fixes the following syzbot bug:
https://syzkaller.appspot.com/bug?id=4bf11aa05c4ca51ce0df86e500fce486552dc8d2
Reported-by: syzbot+d8489a79b781849b9c46@syzkaller.appspotmail.com
Cc: stable@vger.kernel.org
Signed-off-by: Peilin Ye
Acked-by: Greg Kroah-Hartman
Signed-off-by: Marcel Holtmann
Signed-off-by: Greg Kroah-Hartman
commit 51af3c37364349476dda5cbf1711f1f0dbc9df7e
Author: Dinghao Liu
Date: Tue Jul 28 15:21:51 2020 +0800
Staging: rtl8188eu: rtw\_mlme: Fix uninitialized variable authmode
commit 11536442a3b4e1de6890ea5e805908debb74f94a upstream.
The variable authmode can be uninitialized. The danger would be if
it equals to \_WPA\_IE\_ID\_ (0xdd) or \_WPA2\_IE\_ID\_ (0x33). We can avoid
this by setting it to zero instead. This is the approach that was
used in the rtl8723bs driver.
Fixes: 7b464c9fa5cc ("staging: r8188eu: Add files for new driver - part 4")
Co-developed-by: Dan Carpenter
Signed-off-by: Dan Carpenter
Signed-off-by: Dinghao Liu
Cc: stable
Link: https://lore.kernel.org/r/20200728072153.9202-1-dinghao.liu@zju.edu.cn
Signed-off-by: Greg Kroah-Hartman
commit 22e041f720e6c40af47da65ddc33678ec9767c55
Author: Rustam Kovhaev
Date: Thu Jul 16 08:13:26 2020 -0700
staging: rtl8712: handle firmware load failure
commit b4383c971bc5263efe2b0915ba67ebf2bf3f1ee5 upstream.
when firmware fails to load we should not call unregister\_netdev()
this patch fixes a race condition between rtl871x\_load\_fw\_cb() and
r871xu\_dev\_remove() and fixes the bug reported by syzbot
Reported-by: syzbot+80899a8a8efe8968cde7@syzkaller.appspotmail.com
Link: https://syzkaller.appspot.com/bug?extid=80899a8a8efe8968cde7
Signed-off-by: Rustam Kovhaev
Cc: stable
Link: https://lore.kernel.org/r/20200716151324.1036204-1-rkovhaev@gmail.com
Signed-off-by: Greg Kroah-Hartman
commit 7fa3a6e9061c1ac4824341e71b5abbc3b48a263d
Author: Suren Baghdasaryan
Date: Thu Jul 30 12:26:32 2020 -0700
staging: android: ashmem: Fix lockdep warning for write operation
commit 3e338d3c95c735dc3265a86016bb4c022ec7cadc upstream.
syzbot report [1] describes a deadlock when write operation against an
ashmem fd executed at the time when ashmem is shrinking its cache results
in the following lock sequence:
Possible unsafe locking scenario:
CPU0 CPU1
---- ----
lock(fs\_reclaim);
lock(&sb->s\_type->i\_mutex\_key#13);
lock(fs\_reclaim);
lock(&sb->s\_type->i\_mutex\_key#13);
kswapd takes fs\_reclaim and then inode\_lock while generic\_perform\_write
takes inode\_lock and then fs\_reclaim. However ashmem does not support
writing into backing shmem with a write syscall. The only way to change
its content is to mmap it and operate on mapped memory. Therefore the race
that lockdep is warning about is not valid. Resolve this by introducing a
separate lockdep class for the backing shmem inodes.
[1]: https://lkml.kernel.org/lkml/0000000000000b5f9d059aa2037f@google.com/
Reported-by: syzbot+7a0d9d0b26efefe61780@syzkaller.appspotmail.com
Signed-off-by: Suren Baghdasaryan
Cc: stable
Reviewed-by: Joel Fernandes (Google)
Link: https://lore.kernel.org/r/20200730192632.3088194-1-surenb@google.com
Signed-off-by: Greg Kroah-Hartman
commit 98228ec8440f2e84dbcefdd313900463ed0aa494
Author: Takashi Iwai
Date: Tue Aug 4 20:58:15 2020 +0200
ALSA: seq: oss: Serialize ioctls
commit 80982c7e834e5d4e325b6ce33757012ecafdf0bb upstream.
Some ioctls via OSS sequencer API may race and lead to UAF when the
port create and delete are performed concurrently, as spotted by a
couple of syzkaller cases. This patch is an attempt to address it by
serializing the ioctls with the existing register\_mutex.
Basically OSS sequencer API is an obsoleted interface and was designed
without much consideration of the concurrency. There are very few
applications with it, and the concurrent performance isn't asked,
hence this "big hammer" approach should be good enough.
Reported-by: syzbot+1a54a94bd32716796edd@syzkaller.appspotmail.com
Reported-by: syzbot+9d2abfef257f3e2d4713@syzkaller.appspotmail.com
Suggested-by: Hillf Danton
Cc:
Link: https://lore.kernel.org/r/20200804185815.2453-1-tiwai@suse.de
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit f990beaaff08b388ef60430e7a88d49ec216f925
Author: Connor McAdams
Date: Sun Aug 2 20:29:27 2020 -0400
ALSA: hda/ca0132 - Fix AE-5 microphone selection commands.
commit 7fe3530427e52dd53cd7366914864e29215180a4 upstream.
The ca0113 command had the wrong group\_id, 0x48 when it should've been
0x30. The front microphone selection should now work.
Signed-off-by: Connor McAdams
Cc:
Link: https://lore.kernel.org/r/20200803002928.8638-3-conmanx360@gmail.com
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit e0b12b2ba9ede50ca342d5b44c97d1f0dc174c64
Author: Connor McAdams
Date: Sun Aug 2 20:29:25 2020 -0400
ALSA: hda/ca0132 - Fix ZxR Headphone gain control get value.
commit a00dc409de455b64e6cb2f6d40cdb8237cdb2e83 upstream.
When the ZxR headphone gain control was added, the ca0132\_switch\_get
function was not updated, which meant that the changes to the control
state were not saved when entering/exiting alsamixer.
Signed-off-by: Connor McAdams
Cc:
Link: https://lore.kernel.org/r/20200803002928.8638-1-conmanx360@gmail.com
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit b743b82bdfa80bd45211a015419a305c2755a9d9
Author: Connor McAdams
Date: Sun Aug 2 20:29:26 2020 -0400
ALSA: hda/ca0132 - Add new quirk ID for Recon3D.
commit cc5edb1bd3f7bfe450f767b12423f6673822427b upstream.
Add a new quirk ID for the Recon3D, as tested by me.
Signed-off-by: Connor McAdams
Cc:
Link: https://lore.kernel.org/r/20200803002928.8638-2-conmanx360@gmail.com
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit ea441daae389bf706a0722fe241993c0adf3cf9e
Author: Huacai Chen
Date: Sun Aug 2 17:26:40 2020 +0800
ALSA: hda/realtek: Add alc269/alc662 pin-tables for Loongson-3 laptops
commit f1ec5be17b9aafbc5f573da023850566b43d8e5e upstream.
There are several Loongson-3 based laptops produced by CZC or Lemote,
they use alc269/alc662 codecs and need specific pin-tables, this patch
add their pin-tables.
Signed-off-by: Huacai Chen
Cc:
Link: https://lore.kernel.org/r/1596360400-32425-1-git-send-email-chenhc@lemote.com
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 88f484351d8f6510e68706cfbb0701b4e83389fd
Author: Hui Wang
Date: Mon Aug 3 14:46:38 2020 +0800
Revert "ALSA: hda: call runtime\_allow() for all hda controllers"
commit 07c9983b567d0ef33aefc063299de95a987e12a8 upstream.
This reverts commit 9a6418487b56 ("ALSA: hda: call runtime\_allow()
for all hda controllers").
The reverted patch already introduced some regressions on some
machines:
- on gemini-lake machines, the error of "azx\_get\_response timeout"
happens in the hda driver.
- on the machines with alc662 codec, the audio jack detection doesn't
work anymore.
Fixes: 9a6418487b56 ("ALSA: hda: call runtime\_allow() for all hda controllers")
BugLink: https://bugzilla.kernel.org/show\_bug.cgi?id=208511
Cc:
Signed-off-by: Hui Wang
Link: https://lore.kernel.org/r/20200803064638.6139-1-hui.wang@canonical.com
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit a7e7da4400925c04474bf8f2e0e5d517e0bfb18e
Author: Forest Crossman
Date: Mon Jul 27 23:24:08 2020 -0500
usb: xhci: Fix ASMedia ASM1142 DMA addressing
commit ec37198acca7b4c17b96247697406e47aafe0605 upstream.
I've confirmed that the ASMedia ASM1142 has the same problem as the
ASM2142/ASM3142, in that it too reports that it supports 64-bit DMA
addresses when in fact it does not. As with the ASM2142/ASM3142, this
can cause problems on systems where the upper bits matter, and adding
the XHCI\_NO\_64BIT\_SUPPORT quirk completely fixes the issue.
Acked-by: Mathias Nyman
Signed-off-by: Forest Crossman
Cc: stable
Link: https://lore.kernel.org/r/20200728042408.180529-3-cyrozap@gmail.com
Signed-off-by: Greg Kroah-Hartman
commit 2ef10b5be9a54817aa49d4610acb60e31233ae11
Author: Forest Crossman
Date: Mon Jul 27 23:24:07 2020 -0500
usb: xhci: define IDs for various ASMedia host controllers
commit 1841cb255da41e87bed9573915891d056f80e2e7 upstream.
Not all ASMedia host controllers have a device ID that matches its part
number. #define some of these IDs to make it clearer at a glance which
chips require what quirks.
Acked-by: Mathias Nyman
Signed-off-by: Forest Crossman
Link: https://lore.kernel.org/r/20200728042408.180529-2-cyrozap@gmail.com
Cc: stable
Signed-off-by: Greg Kroah-Hartman
commit 3d73faca68faf89f515e3a8e3a1019ca426cf683
Author: Greg Kroah-Hartman
Date: Sun Jul 26 11:49:39 2020 +0200
USB: iowarrior: fix up report size handling for some devices
commit 17a82716587e9d7c3b246a789add490b2b5dcab6 upstream.
In previous patches that added support for new iowarrior devices, the
handling of the report size was not done correct.
Fix that up and update the copyright date for the driver
Reworked from an original patch written by Christoph Jung.
Fixes: bab5417f5f01 ("USB: misc: iowarrior: add support for the 100 device")
Fixes: 5f6f8da2d7b5 ("USB: misc: iowarrior: add support for the 28 and 28L devices")
Fixes: 461d8deb26a7 ("USB: misc: iowarrior: add support for 2 OEMed devices")
Cc: stable
Reported-by: Christoph Jung
Link: https://lore.kernel.org/r/20200726094939.1268978-1-gregkh@linuxfoundation.org
Signed-off-by: Greg Kroah-Hartman
commit a7ee4b448513641bf143239c0a397037dcbd2904
Author: Erik Ekman
Date: Fri Jul 17 20:51:18 2020 +0200
USB: serial: qcserial: add EM7305 QDL product ID
commit d2a4309c1ab6df424b2239fe2920d6f26f808d17 upstream.
When running qmi-firmware-update on the Sierra Wireless EM7305 in a Toshiba
laptop, it changed product ID to 0x9062 when entering QDL mode:
usb 2-4: new high-speed USB device number 78 using xhci\_hcd
usb 2-4: New USB device found, idVendor=1199, idProduct=9062, bcdDevice= 0.00
usb 2-4: New USB device strings: Mfr=1, Product=2, SerialNumber=0
usb 2-4: Product: EM7305
usb 2-4: Manufacturer: Sierra Wireless, Incorporated
The upgrade could complete after running
# echo 1199 9062 > /sys/bus/usb-serial/drivers/qcserial/new\_id
qcserial 2-4:1.0: Qualcomm USB modem converter detected
usb 2-4: Qualcomm USB modem converter now attached to ttyUSB0
Signed-off-by: Erik Ekman
Link: https://lore.kernel.org/r/20200717185118.3640219-1-erik@kryo.se
Cc: stable@vger.kernel.org
Signed-off-by: Johan Hovold
Signed-off-by: Greg Kroah-Hartman
commit e912cdc8d2257b378c2392d8688c281588848ad4
Author: Stanley Chu
Date: Mon Jul 6 14:07:07 2020 +0800
scsi: ufs: Fix and simplify setup\_xfer\_req variant operation
commit 6edfdcfe285e499994b94a0f93e1f46ab2398162 upstream.
Add missing setup\_xfer\_req() call in ufshcd\_issue\_devman\_upiu\_cmd() in
ufs-bsg path. Relocate existing setup\_xfer\_req() calls to a common place,
i.e., ufshcd\_send\_command(), to simplify the driver.
Link: https://lore.kernel.org/r/20200706060707.32608-3-stanley.chu@mediatek.com
Acked-by: Avri Altman
Signed-off-by: Stanley Chu
Signed-off-by: Martin K. Petersen
Signed-off-by: Greg Kroah-Hartman


=== Content from sites.google.com_047cfa7b_20250119_112241.html ===
Search this siteEmbedded FilesSkip to main contentSkip to navigation[![](https://lh5.googleusercontent.com/ril6jkoEO6ORitxrIMAS1ECEY9fEB7-3RX0LjuFvEkZPssza9EzLgrJYRBG0P-TuV5_0eGD2CqrLMa6KVGiz5A=w16383)](/view/syzscope/home)[SyzScope](/view/syzscope/home)

* [Home](/view/syzscope/home)
* [About SyzScope](/view/syzscope/about-syzscope)
[![](https://lh5.googleusercontent.com/ril6jkoEO6ORitxrIMAS1ECEY9fEB7-3RX0LjuFvEkZPssza9EzLgrJYRBG0P-TuV5_0eGD2CqrLMa6KVGiz5A=w16383)SyzScope](/view/syzscope/home)
# KASAN: slab-out-of-bounds Read in hci\_extended\_inquiry\_result\_evt

dashboard: <https://syzkaller.appspot.com/bug?id=4bf11aa05c4ca51ce0df86e500fce486552dc8d2>

SyzScope detected 1 arbitrary value write about this bug.

Fuzzer tested kernel version: [3208167a](https://www.google.com/url?q=https%3A%2F%2Fgit.kernel.org%2Fpub%2Fscm%2Flinux%2Fkernel%2Fgit%2Ftorvalds%2Flinux.git%2Flog%2F%3Fid%3D3208167a865e862fff5045d7910387941ff7e114&sa=D&sntz=1&usg=AOvVaw2hn5vzMVqCjucYcG8f2DHW)

Upstream patch: [Bluetooth: Fix slab-out-of-bounds read in hci\_extended\_inquiry\_result\_evt()](https://www.google.com/url?q=https%3A%2F%2Fgit.kernel.org%2Fpub%2Fscm%2Flinux%2Fkernel%2Fgit%2Ftorvalds%2Flinux.git%2Fcommit%2F%3Fid%3D51c19bf3d5cfaa66571e4b88ba2a6f6295311101&sa=D&sntz=1&usg=AOvVaw2AdVVmuFaMm7tp00uWI2-K)

## Primitive 1: Arbitrary value write in hci\_extended\_inquiry\_result\_evt

### Bug impact analysis:

*bacpy* is calling *memcpy*, the UAF read happens there.

for (; num\_rsp; num\_rsp--, info++) {

 **u32** **flags**;

 bool name\_known;

 **bacpy**(&data.bdaddr, &info->bdaddr); //info was freed, here comes the UAF read and arbitrary value write

 data.pscan\_rep\_mode = info->pscan\_rep\_mode; //Arbitrary value write

 data.pscan\_period\_mode = info->pscan\_period\_mode; //Arbitrary value write

 data.pscan\_mode = 0x00;

 **memcpy**(data.dev\_class, info->dev\_class, 3); //Arbitrary value write

 data.clock\_offset = info->clock\_offset; //Arbitrary value write

 data.rssi = info->rssi; //Arbitrary value write

 data.ssp\_mode = 0x01;

Then we have tons of arbitrary value write because *info* was freed

### Trace in high level:

 |check\_memory\_region mm/kasan/generic.c:186

 |memcpy mm/kasan/common.c:105(Triggered the OOB read bug)

|hci\_extended\_inquiry\_result\_evt net/bluetooth/hci\_event.c:4398

|hci\_extended\_inquiry\_result\_evt net/bluetooth/hci\_event.c:4403(Triggered a new bug: Arbitrary value write)

### Trace in detail:

0xffffffff84e2972b

hci\_extended\_inquiry\_result\_evt net/bluetooth/hci\_event.c:4398(Triggered the OOB read bug)

--------------------------------------

0xffffffff84e29734

hci\_extended\_inquiry\_result\_evt net/bluetooth/hci\_event.c:4398

--------------------------------------

0xffffffff84e29746

hci\_extended\_inquiry\_result\_evt net/bluetooth/hci\_event.c:4399

--------------------------------------

0xffffffff84e29770

hci\_extended\_inquiry\_result\_evt net/bluetooth/hci\_event.c:4402

--------------------------------------

0xffffffff84e2977e

hci\_extended\_inquiry\_result\_evt net/bluetooth/hci\_event.c:4402

--------------------------------------

0xffffffff84e29790

hci\_extended\_inquiry\_result\_evt net/bluetooth/hci\_event.c:4403(Triggered a new bug: Arbitrary value write)

--------------------------------------

Total 15 basic block

[Email] | [Address] | [Phone number]

Google SitesReport abusePage detailsPage updated Google SitesReport abuseThis site uses cookies from Google to deliver its services and to analyze traffic. Information about your use of this site is shared with Google. By clicking "accept", you agree to its use of cookies. [Cookie Policy](https://www.google.com/policies/technologies/cookies/)RejectAccept
