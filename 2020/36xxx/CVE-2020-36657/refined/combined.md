=== Content from bugs.gentoo.org_1241bc0e_20250119_130545.html ===

[![Gentoo Websites Logo](extensions/Gentoo/web/gentoo_org.png)](/ "Go to the Gentoo Bugzilla homepage")
Go to:
[Gentoo Home](https://www.gentoo.org/)
[Documentation](https://www.gentoo.org/support/documentation/)
[Forums](https://forums.gentoo.org/)
[Lists](https://www.gentoo.org/get-involved/mailing-lists/)
[Bugs](/)
[Planet](https://planet.gentoo.org/)
[Store](https://www.gentoo.org/inside-gentoo/stores/)
[Wiki](https://wiki.gentoo.org/)
**[Get Gentoo!](https://www.gentoo.org/downloads/)**

Gentoo's Bugzilla – Bug 630810
<app-misc/uptimed-0.4.6-r1: root privilege escalation via "chown -R" in pkg\_postinst
Last modified: 2023-05-03 10:08:27 UTC node [vulture]

* [Home](./)
* | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=630810&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=630810&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

[**Bug 630810**](show_bug.cgi?id=630810)
(CVE-2020-36657)
- <app-misc/uptimed-0.4.6-r1: root privilege escalation via "chown -R" in pkg\_postinst

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
<app-misc/uptimed-0.4.6-r1: root privilege escalation via "chown -R" in pkg\_p...

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2020-36657 | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | Gentoo Security | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=Gentoo Security "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Vulnerabilities ([show other bugs](buglist.cgi?component=Vulnerabilities&product=Gentoo%20Security&bug_status=__open__)) | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All Linux | |  | | | [Importance](page.cgi?id=fields.html#importance): | Normal normal | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Gentoo Security | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") | B1 [glsa+] | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") | PullRequest | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [864943](show_bug.cgi?id=864943 "RESOLVED FIXED - app-misc/uptimed-0.4.6-r1 stablereq") | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | Show dependency [tree](showdependencytree.cgi?id=630810&hide_resolved=1) | |  | | Reported: | 2017-09-12 14:51 UTC by Michael Orlitzky | | --- | --- | | Modified: | 2023-05-03 10:08 UTC ([History](show_activity.cgi?id=630810)) | | CC List: | 4 users (show)  conikost kfm polynomial-c security-audit | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") | * <https://github.com/gentoo/gentoo/pull/26820> | | [Package list:](page.cgi?id=fields.html#cf_stabilisation_atoms "Contains a list of packages (and optionally, architectures) to keyword or stabilize. One fully qualified package per line, optionally followed by a space-delimited list of architectures for that package.") |  | | [Runtime testing required:](page.cgi?id=fields.html#cf_runtime_testing_required "Indicate what level of testing is required. For manual testing following instructions in the bug, choose \"Manual\". For only compile-testing, choose \"No\". For where tests must pass, choose \"Yes\".") | --- | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | | --- | --- | --- | | [Add an attachment](attachment.cgi?bugid=630810&action=enter) (proposed patch, testcase, etc.) | | |   | Note You need to [log in](show_bug.cgi?id=630810&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](#c0)  Michael Orlitzky   gentoo-dev  2017-09-12 14:51:17 UTC  ``` The uptimed ebuilds call chown recursively on the live root filesystem in pkg_postinst:    pkg_postinst() {       einfo "Fixing permissions in /var/spool/${PN}"       chown -R uptimed:uptimed /var/spool/${PN}       ...  The uptimed user can place a hard link in /var/spool/uptimed pointing to a sensitive root-owned file, and the next time that uptimed is emerged, that file will be given to the uptimed user. For example,    1. emerge uptimed   2. sudo su -s /bin/sh -c 'ln /etc/passwd /var/spool/uptimed/x' uptimed   3. emerge uptimed   4. the file /etc/passwd is owned by uptimed:uptimed ```  [Comment 1](#c1)  Lars Wendler (Polynomial-C) (RETIRED)   gentoo-dev  2019-04-20 20:34:29 UTC  ``` commit 8029ba6c8920e379ea1f5f71afc297bfd30925b3 Author: Lars Wendler <polynomial-c@gentoo.org> Date:   Sat Apr 20 22:31:38 2019      app-misc/uptimed: Attempt to fix privilege escalation in pkg_postinst      Bug: <https://bugs.gentoo.org/630810>     Package-Manager: Portage-2.3.64, Repoman-2.3.12     Signed-off-by: Lars Wendler <polynomial-c@gentoo.org> ```  [Comment 2](#c2)  Michael Orlitzky   gentoo-dev  2019-04-21 15:31:20 UTC  ``` Unfortunately this suffers from the same problem:  -       chown -R uptimed:uptimed /var/spool/${PN} +       local spooldir="/var/spool/${PN}" +       if [[ -d "${spooldir}" ]] ; then +               einfo "Fixing permissions in ${spooldir}" +               find ${spooldir} -type f -print0 \ +                       | xargs --null chown uptimed:uptimed || die +       fi  In fact, symlinks will work now too (not just hard links). What is it supposed to fix? Maybe I can suggest a better way. ```  [Comment 3](#c3)  Lars Wendler (Polynomial-C) (RETIRED)   gentoo-dev  2019-04-24 08:52:15 UTC  ``` (In reply to Michael Orlitzky from [comment #2](show_bug.cgi?id=630810#c2)) > Unfortunately this suffers from the same problem: >  > -       chown -R uptimed:uptimed /var/spool/${PN} > +       local spooldir="/var/spool/${PN}" > +       if [[ -d "${spooldir}" ]] ; then > +               einfo "Fixing permissions in ${spooldir}" > +               find ${spooldir} -type f -print0 \ > +                       | xargs --null chown uptimed:uptimed || die > +       fi >  > In fact, symlinks will work now too (not just hard links). What is it > supposed to fix? Maybe I can suggest a better way.   I don't see how this suffers from the same problem. There's now a test if spooldir is a directory (and no symlink), and the find call only operates on files. ```  [Comment 4](#c4)  Michael Orlitzky   gentoo-dev  2019-04-24 11:39:50 UTC  ``` (In reply to Lars Wendler (Polynomial-C) from [comment #3](show_bug.cgi?id=630810#c3)) >  > I don't see how this suffers from the same problem. There's now a test if > spooldir is a directory (and no symlink), and the find call only operates on > files.  The directory was never the problem, it's a file *in* the directory. The same thing works:    sudo su -s /bin/sh -c 'ln /etc/passwd /var/spool/uptimed/x' uptimed  The uptimed user creates a link called "x" in /var/spool/uptimed pointing to a file of his choosing. The call to chown then gives him ownership of that file. ```  [Comment 5](#c5)  Lars Wendler (Polynomial-C) (RETIRED)   gentoo-dev  2019-04-24 11:45:06 UTC  ``` (In reply to Michael Orlitzky from [comment #4](show_bug.cgi?id=630810#c4)) > (In reply to Lars Wendler (Polynomial-C) from [comment #3](show_bug.cgi?id=630810#c3)) > >  > > I don't see how this suffers from the same problem. There's now a test if > > spooldir is a directory (and no symlink), and the find call only operates on > > files. >  > The directory was never the problem, it's a file *in* the directory. The > same thing works: >  >   sudo su -s /bin/sh -c 'ln /etc/passwd /var/spool/uptimed/x' uptimed >  > The uptimed user creates a link called "x" in /var/spool/uptimed pointing to > a file of his choosing. The call to chown then gives him ownership of that > file.  But the chown does not act on the symlink because find only hands over files to xargs and that calls chown without -R parameter... ```  [Comment 6](#c6)  Michael Orlitzky   gentoo-dev  2019-04-24 11:57:44 UTC  ``` (In reply to Lars Wendler (Polynomial-C) from [comment #5](show_bug.cgi?id=630810#c5)) >  > But the chown does not act on the symlink because find only hands over files > to xargs and that calls chown without -R parameter...  Contrary to all common sense, chown follows symlinks and hardlinks by default. ```  [Comment 7](#c7)  Lars Wendler (Polynomial-C) (RETIRED)   gentoo-dev  2019-04-24 12:11:30 UTC  ``` Sorry, you're right. Hardlinks are the real issue. Dunno how to not make chown act on them... ```  [Comment 8](#c8)  Michael Orlitzky   gentoo-dev  2019-04-24 12:20:12 UTC  ``` There are a lot of half-fixes that you can pile on:    * Use the -user, -group, and -perm flags to "find" so that you only find     files that need fixing.    * Add --no-dereference to chown to keep it from following symlinks (there's     a race condition in the implementation, but it's as small as you can make     it).    * Use the --from flag with chown to ensure that an attacker can't swap one     file for a link with a different owner/group.    * If you're fixing something during an upgrade, you can check the     REPLACING_VERSIONS variable to ensure that you don't mess with things     during a fresh install.  Ultimately the right answer depends on what you're trying to fix though. ```  [Comment 9](#c9)  Lars Wendler (Polynomial-C) (RETIRED)   gentoo-dev  2019-04-24 12:25:24 UTC  ``` commit 559aeb8ce8d3fe7c6c5f8618f93995252d1683fd Author: Lars Wendler <polynomial-c@gentoo.org> Date:   Wed Apr 24 14:20:02 2019      app-misc/uptimed: Another attempt to fix privilege escalation          Bug: <https://bugs.gentoo.org/630810>     Package-Manager: Portage-2.3.64, Repoman-2.3.12     Signed-off-by: Lars Wendler <polynomial-c@gentoo.org>   I'm using    find ${spooldir} -type f -links 1   now which should neither hand over symlinks nor hardlinks to xargs. ```  [Comment 10](#c10)  Michael Orlitzky   gentoo-dev  2019-04-24 12:27:55 UTC  ``` >  > I'm using >  >   find ${spooldir} -type f -links 1  >  > now which should neither hand over symlinks nor hardlinks to xargs.  If the uptimed user creates 1,000,000 empty files in that directory, he will have several minutes between the "find" call and the "chown" call to replace the last one with a link. ```  [Comment 11](#c11)  Robin Johnson   archtester Gentoo Infrastructure gentoo-dev Security  2020-04-03 23:16:33 UTC  ``` Unrestricting and reassigning to security@ per [bug #705894](show_bug.cgi?id=705894 "RESOLVED FIXED - bugzilla: de-embargo old security bugs") ```  [Comment 12](#c12)  Robin Johnson   archtester Gentoo Infrastructure gentoo-dev Security  2020-04-03 23:18:11 UTC  ``` unrestricting per [bug 705894](show_bug.cgi?id=705894 "RESOLVED FIXED - bugzilla: de-embargo old security bugs") ```  [Comment 13](#c13)  Sam James   archtester Gentoo Infrastructure gentoo-dev Security  2020-05-21 22:50:19 UTC  ``` (In reply to Michael Orlitzky from [comment #10](show_bug.cgi?id=630810#c10)) > >  > > I'm using > >  > >   find ${spooldir} -type f -links 1  > >  > > now which should neither hand over symlinks nor hardlinks to xargs. >  > If the uptimed user creates 1,000,000 empty files in that directory, he will > have several minutes between the "find" call and the "chown" call to replace > the last one with a link.  Can we ask the user to make the changes, if necessary, instead? ```  [Comment 14](#c14)  Michael Orlitzky   gentoo-dev  2020-05-21 23:05:50 UTC  ``` (In reply to Sam James (sec padawan) from [comment #13](show_bug.cgi?id=630810#c13)) >  > Can we ask the user to make the changes, if necessary, instead?  What problem is this pkg_postinst() intended to fix? If the permissions are perpetually wrong, then there's a bug somewhere else, and asking the user to fix them repeatedly is just punting the problem to him or her. We should fix the thing that creates files with the wrong permissions.  If the permissions were wrong once and have never been wrong since, we can probably just delete this code now since the bug is so old.  (For future reference, though, there are suggestions on my pkg_postinst article for how to minimize the risk of a one-time fix.) ```  [Comment 15](#c15)  John Helmert III   archtester Gentoo Infrastructure gentoo-dev Security  2022-08-11 04:20:06 UTC  ``` On a fresh install, and without that `find` in pkg_postinst, /var/spool/uptimed is correctly owned by uptimed, so we should be able to just get rid of that code. PR incoming. ```  [Comment 16](#c16)  Larry the Git Cow   gentoo-dev  2022-08-11 18:22:55 UTC  ``` The bug has been referenced in the following commit(s):  <https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=106d5ab4c5c1ec11f14e74dfb0ebcc4b72197b53>  commit 106d5ab4c5c1ec11f14e74dfb0ebcc4b72197b53 Author:     John Helmert III <ajak@gentoo.org> AuthorDate: 2022-08-11 04:15:20 +0000 Commit:     John Helmert III <ajak@gentoo.org> CommitDate: 2022-08-11 18:22:43 +0000      app-misc/uptimed: drop ownership changes in pkg_postinst          Bug: <https://bugs.gentoo.org/630810>     Signed-off-by: John Helmert III <ajak@gentoo.org>   app-misc/uptimed/uptimed-0.4.6-r1.ebuild | 45 ++++++++++++++++++++++++++++++++  1 file changed, 45 insertions(+) ```  [Comment 17](#c17)  John Helmert III   archtester Gentoo Infrastructure gentoo-dev Security  2022-08-11 18:29:20 UTC  ``` Please stabilize when ready. ```  [Comment 18](#c18)  Conrad Kostecki   gentoo-dev  2022-08-12 09:29:56 UTC  ``` 0.4.6-r1 is stable. I will shortly drop 0.4.6. ```  [Comment 19](#c19)  Larry the Git Cow   gentoo-dev  2022-08-12 09:32:12 UTC  ``` The bug has been referenced in the following commit(s):  <https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=5865dc98aaebfb7ef663189b3f1cda20f8fb6bac>  commit 5865dc98aaebfb7ef663189b3f1cda20f8fb6bac Author:     Conrad Kostecki <conikost@gentoo.org> AuthorDate: 2022-08-12 09:31:41 +0000 Commit:     Conrad Kostecki <conikost@gentoo.org> CommitDate: 2022-08-12 09:31:49 +0000      app-misc/uptimed: drop 0.4.6          Bug: <https://bugs.gentoo.org/630810>     Signed-off-by: Conrad Kostecki <conikost@gentoo.org>   app-misc/uptimed/uptimed-0.4.6.ebuild | 54 -----------------------------------  1 file changed, 54 deletions(-) ```  [Comment 20](#c20)  John Helmert III   archtester Gentoo Infrastructure gentoo-dev Security  2022-08-13 23:00:26 UTC  ``` Thanks! ```  [Comment 21](#c21)  John Helmert III   archtester Gentoo Infrastructure gentoo-dev Security  2023-01-25 19:12:05 UTC  ``` CVE requested ```  [Comment 22](#c22)  John Helmert III   archtester Gentoo Infrastructure gentoo-dev Security  2023-01-26 17:04:31 UTC  ``` GLSA request filed ```  [Comment 23](#c23)  Larry the Git Cow   gentoo-dev  2023-05-03 10:05:41 UTC  ``` The bug has been referenced in the following commit(s):  <https://gitweb.gentoo.org/data/glsa.git/commit/?id=e41b043f23f11bc4b5fda291e24c2b334fb28552>  commit e41b043f23f11bc4b5fda291e24c2b334fb28552 Author:     GLSAMaker <glsamaker@gentoo.org> AuthorDate: 2023-05-03 10:03:26 +0000 Commit:     Sam James <sam@gentoo.org> CommitDate: 2023-05-03 10:05:28 +0000      [ GLSA 202305-14 ] uptimed: Root Privilege Escalation          Bug: <https://bugs.gentoo.org/630810>     Signed-off-by: GLSAMaker <glsamaker@gentoo.org>     Signed-off-by: Sam James <sam@gentoo.org>   glsa-202305-14.xml | 42 ++++++++++++++++++++++++++++++++++++++++++  1 file changed, 42 insertions(+) ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=630810)
* - [XML](show_bug.cgi?ctype=xml&id=630810)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=630810)
* - [Clone In The Same
  Product](enter_bug.cgi?cloned_bug_id=630810&product=Gentoo%20Security)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=630810&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=630810&GoAheadAndLogIn=1#forgot)
    Login:

    [x]



=== Content from bugs.gentoo.org_2254f6eb_20250119_110744.html ===

[![Gentoo Websites Logo](extensions/Gentoo/web/gentoo_org.png)](/ "Go to the Gentoo Bugzilla homepage")
Go to:
[Gentoo Home](https://www.gentoo.org/)
[Documentation](https://www.gentoo.org/support/documentation/)
[Forums](https://forums.gentoo.org/)
[Lists](https://www.gentoo.org/get-involved/mailing-lists/)
[Bugs](/)
[Planet](https://planet.gentoo.org/)
[Store](https://www.gentoo.org/inside-gentoo/stores/)
[Wiki](https://wiki.gentoo.org/)
**[Get Gentoo!](https://www.gentoo.org/downloads/)**

Gentoo's Bugzilla – Bug 630810
<app-misc/uptimed-0.4.6-r1: root privilege escalation via "chown -R" in pkg\_postinst
Last modified: 2023-05-03 10:08:27 UTC node [vulture]

* [Home](./)
* | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=630810&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=630810&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

[**Bug 630810**](show_bug.cgi?id=630810)
(CVE-2020-36657)
- <app-misc/uptimed-0.4.6-r1: root privilege escalation via "chown -R" in pkg\_postinst

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
<app-misc/uptimed-0.4.6-r1: root privilege escalation via "chown -R" in pkg\_p...

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2020-36657 | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | Gentoo Security | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=Gentoo Security "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Vulnerabilities ([show other bugs](buglist.cgi?component=Vulnerabilities&product=Gentoo%20Security&bug_status=__open__)) | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All Linux | |  | | | [Importance](page.cgi?id=fields.html#importance): | Normal normal | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Gentoo Security | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") | B1 [glsa+] | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") | PullRequest | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [864943](show_bug.cgi?id=864943 "RESOLVED FIXED - app-misc/uptimed-0.4.6-r1 stablereq") | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | Show dependency [tree](showdependencytree.cgi?id=630810&hide_resolved=1) | |  | | Reported: | 2017-09-12 14:51 UTC by Michael Orlitzky | | --- | --- | | Modified: | 2023-05-03 10:08 UTC ([History](show_activity.cgi?id=630810)) | | CC List: | 4 users (show)  conikost kfm polynomial-c security-audit | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") | * <https://github.com/gentoo/gentoo/pull/26820> | | [Package list:](page.cgi?id=fields.html#cf_stabilisation_atoms "Contains a list of packages (and optionally, architectures) to keyword or stabilize. One fully qualified package per line, optionally followed by a space-delimited list of architectures for that package.") |  | | [Runtime testing required:](page.cgi?id=fields.html#cf_runtime_testing_required "Indicate what level of testing is required. For manual testing following instructions in the bug, choose \"Manual\". For only compile-testing, choose \"No\". For where tests must pass, choose \"Yes\".") | --- | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | | --- | --- | --- | | [Add an attachment](attachment.cgi?bugid=630810&action=enter) (proposed patch, testcase, etc.) | | |   | Note You need to [log in](show_bug.cgi?id=630810&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](#c0)  Michael Orlitzky   gentoo-dev  2017-09-12 14:51:17 UTC  ``` The uptimed ebuilds call chown recursively on the live root filesystem in pkg_postinst:    pkg_postinst() {       einfo "Fixing permissions in /var/spool/${PN}"       chown -R uptimed:uptimed /var/spool/${PN}       ...  The uptimed user can place a hard link in /var/spool/uptimed pointing to a sensitive root-owned file, and the next time that uptimed is emerged, that file will be given to the uptimed user. For example,    1. emerge uptimed   2. sudo su -s /bin/sh -c 'ln /etc/passwd /var/spool/uptimed/x' uptimed   3. emerge uptimed   4. the file /etc/passwd is owned by uptimed:uptimed ```  [Comment 1](#c1)  Lars Wendler (Polynomial-C) (RETIRED)   gentoo-dev  2019-04-20 20:34:29 UTC  ``` commit 8029ba6c8920e379ea1f5f71afc297bfd30925b3 Author: Lars Wendler <polynomial-c@gentoo.org> Date:   Sat Apr 20 22:31:38 2019      app-misc/uptimed: Attempt to fix privilege escalation in pkg_postinst      Bug: <https://bugs.gentoo.org/630810>     Package-Manager: Portage-2.3.64, Repoman-2.3.12     Signed-off-by: Lars Wendler <polynomial-c@gentoo.org> ```  [Comment 2](#c2)  Michael Orlitzky   gentoo-dev  2019-04-21 15:31:20 UTC  ``` Unfortunately this suffers from the same problem:  -       chown -R uptimed:uptimed /var/spool/${PN} +       local spooldir="/var/spool/${PN}" +       if [[ -d "${spooldir}" ]] ; then +               einfo "Fixing permissions in ${spooldir}" +               find ${spooldir} -type f -print0 \ +                       | xargs --null chown uptimed:uptimed || die +       fi  In fact, symlinks will work now too (not just hard links). What is it supposed to fix? Maybe I can suggest a better way. ```  [Comment 3](#c3)  Lars Wendler (Polynomial-C) (RETIRED)   gentoo-dev  2019-04-24 08:52:15 UTC  ``` (In reply to Michael Orlitzky from [comment #2](show_bug.cgi?id=630810#c2)) > Unfortunately this suffers from the same problem: >  > -       chown -R uptimed:uptimed /var/spool/${PN} > +       local spooldir="/var/spool/${PN}" > +       if [[ -d "${spooldir}" ]] ; then > +               einfo "Fixing permissions in ${spooldir}" > +               find ${spooldir} -type f -print0 \ > +                       | xargs --null chown uptimed:uptimed || die > +       fi >  > In fact, symlinks will work now too (not just hard links). What is it > supposed to fix? Maybe I can suggest a better way.   I don't see how this suffers from the same problem. There's now a test if spooldir is a directory (and no symlink), and the find call only operates on files. ```  [Comment 4](#c4)  Michael Orlitzky   gentoo-dev  2019-04-24 11:39:50 UTC  ``` (In reply to Lars Wendler (Polynomial-C) from [comment #3](show_bug.cgi?id=630810#c3)) >  > I don't see how this suffers from the same problem. There's now a test if > spooldir is a directory (and no symlink), and the find call only operates on > files.  The directory was never the problem, it's a file *in* the directory. The same thing works:    sudo su -s /bin/sh -c 'ln /etc/passwd /var/spool/uptimed/x' uptimed  The uptimed user creates a link called "x" in /var/spool/uptimed pointing to a file of his choosing. The call to chown then gives him ownership of that file. ```  [Comment 5](#c5)  Lars Wendler (Polynomial-C) (RETIRED)   gentoo-dev  2019-04-24 11:45:06 UTC  ``` (In reply to Michael Orlitzky from [comment #4](show_bug.cgi?id=630810#c4)) > (In reply to Lars Wendler (Polynomial-C) from [comment #3](show_bug.cgi?id=630810#c3)) > >  > > I don't see how this suffers from the same problem. There's now a test if > > spooldir is a directory (and no symlink), and the find call only operates on > > files. >  > The directory was never the problem, it's a file *in* the directory. The > same thing works: >  >   sudo su -s /bin/sh -c 'ln /etc/passwd /var/spool/uptimed/x' uptimed >  > The uptimed user creates a link called "x" in /var/spool/uptimed pointing to > a file of his choosing. The call to chown then gives him ownership of that > file.  But the chown does not act on the symlink because find only hands over files to xargs and that calls chown without -R parameter... ```  [Comment 6](#c6)  Michael Orlitzky   gentoo-dev  2019-04-24 11:57:44 UTC  ``` (In reply to Lars Wendler (Polynomial-C) from [comment #5](show_bug.cgi?id=630810#c5)) >  > But the chown does not act on the symlink because find only hands over files > to xargs and that calls chown without -R parameter...  Contrary to all common sense, chown follows symlinks and hardlinks by default. ```  [Comment 7](#c7)  Lars Wendler (Polynomial-C) (RETIRED)   gentoo-dev  2019-04-24 12:11:30 UTC  ``` Sorry, you're right. Hardlinks are the real issue. Dunno how to not make chown act on them... ```  [Comment 8](#c8)  Michael Orlitzky   gentoo-dev  2019-04-24 12:20:12 UTC  ``` There are a lot of half-fixes that you can pile on:    * Use the -user, -group, and -perm flags to "find" so that you only find     files that need fixing.    * Add --no-dereference to chown to keep it from following symlinks (there's     a race condition in the implementation, but it's as small as you can make     it).    * Use the --from flag with chown to ensure that an attacker can't swap one     file for a link with a different owner/group.    * If you're fixing something during an upgrade, you can check the     REPLACING_VERSIONS variable to ensure that you don't mess with things     during a fresh install.  Ultimately the right answer depends on what you're trying to fix though. ```  [Comment 9](#c9)  Lars Wendler (Polynomial-C) (RETIRED)   gentoo-dev  2019-04-24 12:25:24 UTC  ``` commit 559aeb8ce8d3fe7c6c5f8618f93995252d1683fd Author: Lars Wendler <polynomial-c@gentoo.org> Date:   Wed Apr 24 14:20:02 2019      app-misc/uptimed: Another attempt to fix privilege escalation          Bug: <https://bugs.gentoo.org/630810>     Package-Manager: Portage-2.3.64, Repoman-2.3.12     Signed-off-by: Lars Wendler <polynomial-c@gentoo.org>   I'm using    find ${spooldir} -type f -links 1   now which should neither hand over symlinks nor hardlinks to xargs. ```  [Comment 10](#c10)  Michael Orlitzky   gentoo-dev  2019-04-24 12:27:55 UTC  ``` >  > I'm using >  >   find ${spooldir} -type f -links 1  >  > now which should neither hand over symlinks nor hardlinks to xargs.  If the uptimed user creates 1,000,000 empty files in that directory, he will have several minutes between the "find" call and the "chown" call to replace the last one with a link. ```  [Comment 11](#c11)  Robin Johnson   archtester Gentoo Infrastructure gentoo-dev Security  2020-04-03 23:16:33 UTC  ``` Unrestricting and reassigning to security@ per [bug #705894](show_bug.cgi?id=705894 "RESOLVED FIXED - bugzilla: de-embargo old security bugs") ```  [Comment 12](#c12)  Robin Johnson   archtester Gentoo Infrastructure gentoo-dev Security  2020-04-03 23:18:11 UTC  ``` unrestricting per [bug 705894](show_bug.cgi?id=705894 "RESOLVED FIXED - bugzilla: de-embargo old security bugs") ```  [Comment 13](#c13)  Sam James   archtester Gentoo Infrastructure gentoo-dev Security  2020-05-21 22:50:19 UTC  ``` (In reply to Michael Orlitzky from [comment #10](show_bug.cgi?id=630810#c10)) > >  > > I'm using > >  > >   find ${spooldir} -type f -links 1  > >  > > now which should neither hand over symlinks nor hardlinks to xargs. >  > If the uptimed user creates 1,000,000 empty files in that directory, he will > have several minutes between the "find" call and the "chown" call to replace > the last one with a link.  Can we ask the user to make the changes, if necessary, instead? ```  [Comment 14](#c14)  Michael Orlitzky   gentoo-dev  2020-05-21 23:05:50 UTC  ``` (In reply to Sam James (sec padawan) from [comment #13](show_bug.cgi?id=630810#c13)) >  > Can we ask the user to make the changes, if necessary, instead?  What problem is this pkg_postinst() intended to fix? If the permissions are perpetually wrong, then there's a bug somewhere else, and asking the user to fix them repeatedly is just punting the problem to him or her. We should fix the thing that creates files with the wrong permissions.  If the permissions were wrong once and have never been wrong since, we can probably just delete this code now since the bug is so old.  (For future reference, though, there are suggestions on my pkg_postinst article for how to minimize the risk of a one-time fix.) ```  [Comment 15](#c15)  John Helmert III   archtester Gentoo Infrastructure gentoo-dev Security  2022-08-11 04:20:06 UTC  ``` On a fresh install, and without that `find` in pkg_postinst, /var/spool/uptimed is correctly owned by uptimed, so we should be able to just get rid of that code. PR incoming. ```  [Comment 16](#c16)  Larry the Git Cow   gentoo-dev  2022-08-11 18:22:55 UTC  ``` The bug has been referenced in the following commit(s):  <https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=106d5ab4c5c1ec11f14e74dfb0ebcc4b72197b53>  commit 106d5ab4c5c1ec11f14e74dfb0ebcc4b72197b53 Author:     John Helmert III <ajak@gentoo.org> AuthorDate: 2022-08-11 04:15:20 +0000 Commit:     John Helmert III <ajak@gentoo.org> CommitDate: 2022-08-11 18:22:43 +0000      app-misc/uptimed: drop ownership changes in pkg_postinst          Bug: <https://bugs.gentoo.org/630810>     Signed-off-by: John Helmert III <ajak@gentoo.org>   app-misc/uptimed/uptimed-0.4.6-r1.ebuild | 45 ++++++++++++++++++++++++++++++++  1 file changed, 45 insertions(+) ```  [Comment 17](#c17)  John Helmert III   archtester Gentoo Infrastructure gentoo-dev Security  2022-08-11 18:29:20 UTC  ``` Please stabilize when ready. ```  [Comment 18](#c18)  Conrad Kostecki   gentoo-dev  2022-08-12 09:29:56 UTC  ``` 0.4.6-r1 is stable. I will shortly drop 0.4.6. ```  [Comment 19](#c19)  Larry the Git Cow   gentoo-dev  2022-08-12 09:32:12 UTC  ``` The bug has been referenced in the following commit(s):  <https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=5865dc98aaebfb7ef663189b3f1cda20f8fb6bac>  commit 5865dc98aaebfb7ef663189b3f1cda20f8fb6bac Author:     Conrad Kostecki <conikost@gentoo.org> AuthorDate: 2022-08-12 09:31:41 +0000 Commit:     Conrad Kostecki <conikost@gentoo.org> CommitDate: 2022-08-12 09:31:49 +0000      app-misc/uptimed: drop 0.4.6          Bug: <https://bugs.gentoo.org/630810>     Signed-off-by: Conrad Kostecki <conikost@gentoo.org>   app-misc/uptimed/uptimed-0.4.6.ebuild | 54 -----------------------------------  1 file changed, 54 deletions(-) ```  [Comment 20](#c20)  John Helmert III   archtester Gentoo Infrastructure gentoo-dev Security  2022-08-13 23:00:26 UTC  ``` Thanks! ```  [Comment 21](#c21)  John Helmert III   archtester Gentoo Infrastructure gentoo-dev Security  2023-01-25 19:12:05 UTC  ``` CVE requested ```  [Comment 22](#c22)  John Helmert III   archtester Gentoo Infrastructure gentoo-dev Security  2023-01-26 17:04:31 UTC  ``` GLSA request filed ```  [Comment 23](#c23)  Larry the Git Cow   gentoo-dev  2023-05-03 10:05:41 UTC  ``` The bug has been referenced in the following commit(s):  <https://gitweb.gentoo.org/data/glsa.git/commit/?id=e41b043f23f11bc4b5fda291e24c2b334fb28552>  commit e41b043f23f11bc4b5fda291e24c2b334fb28552 Author:     GLSAMaker <glsamaker@gentoo.org> AuthorDate: 2023-05-03 10:03:26 +0000 Commit:     Sam James <sam@gentoo.org> CommitDate: 2023-05-03 10:05:28 +0000      [ GLSA 202305-14 ] uptimed: Root Privilege Escalation          Bug: <https://bugs.gentoo.org/630810>     Signed-off-by: GLSAMaker <glsamaker@gentoo.org>     Signed-off-by: Sam James <sam@gentoo.org>   glsa-202305-14.xml | 42 ++++++++++++++++++++++++++++++++++++++++++  1 file changed, 42 insertions(+) ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=630810)
* - [XML](show_bug.cgi?ctype=xml&id=630810)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=630810)
* - [Clone In The Same
  Product](enter_bug.cgi?cloned_bug_id=630810&product=Gentoo%20Security)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=630810&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=630810&GoAheadAndLogIn=1#forgot)
    Login:

    [x]



=== Content from security.gentoo.org_9c3cec11_20250119_110746.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# uptimed: Root Privilege Escalation — GLSA **202305-14**

A vulnerability has been discovered in uptimed which could result in root privilege escalation.

### Affected packages

| Package | **app-misc/uptimed** on all architectures |
| --- | --- |
| Affected versions | < **0.4.6-r1** |
| Unaffected versions | >= **0.4.6-r1** |

### Background

uptimed is a system uptime record daemon that keeps track of your highest uptimes.

### Description

Via unnecessary file ownership modifications in the pkg\_postinst ebuild phase, the uptimed user could change arbitrary files to be owned by the uptimed user at emerge-time.

### Impact

The uptimed user could achieve root privileges when the uptimed package is emerged.

### Workaround

There is no known workaround at this time.

### Resolution

All uptimed users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=app-misc/uptimed-0.4.6-r1"

```
### References

* [CVE-2020-36657](https://nvd.nist.gov/vuln/detail/CVE-2020-36657)

**Release date**

May 03, 2023

**Latest revision**

May 03, 2023: 1

**Severity**

high

**Exploitable**

remote

**Bugzilla entries**

* [630810](https://bugs.gentoo.org/show_bug.cgi?id=630810)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**


