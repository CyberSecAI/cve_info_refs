=== Content from github.com_9889a73b_20250119_111054.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fissues%2F70)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fissues%2F70)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=home-assistant%2Fplugin-dns)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[home-assistant](/home-assistant)
/
**[plugin-dns](/home-assistant/plugin-dns)**
Public

* [Notifications](/login?return_to=%2Fhome-assistant%2Fplugin-dns) You must be signed in to change notification settings
* [Fork
  15](/login?return_to=%2Fhome-assistant%2Fplugin-dns)
* [Star
   21](/login?return_to=%2Fhome-assistant%2Fplugin-dns)

* [Code](/home-assistant/plugin-dns)
* [Issues
  3](/home-assistant/plugin-dns/issues)
* [Pull requests
  0](/home-assistant/plugin-dns/pulls)
* [Actions](/home-assistant/plugin-dns/actions)
* [Security](/home-assistant/plugin-dns/security)
* [Insights](/home-assistant/plugin-dns/pulse)

Additional navigation options

* [Code](/home-assistant/plugin-dns)
* [Issues](/home-assistant/plugin-dns/issues)
* [Pull requests](/home-assistant/plugin-dns/pulls)
* [Actions](/home-assistant/plugin-dns/actions)
* [Security](/home-assistant/plugin-dns/security)
* [Insights](/home-assistant/plugin-dns/pulse)

# Home Assistant OS leaks private host names to cloudflare DNS service (CVE-2020-36517)¬†#70

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosed[#86](https://github.com/home-assistant/plugin-dns/pull/86)Closed[Home Assistant OS leaks private host names to cloudflare DNS service (CVE-2020-36517)](#top)#70[#86](https://github.com/home-assistant/plugin-dns/pull/86)Copy link![@mtdcr](https://avatars.githubusercontent.com/u/925299?v=4&size=80)
## Description

![@mtdcr](https://avatars.githubusercontent.com/u/925299?v=4&size=48)[mtdcr](https://github.com/mtdcr)opened [on Jan 15, 2022](https://github.com/home-assistant/plugin-dns/issues/70#issue-1104812559)
### Describe the issue you are experiencing

Home Assistant OS always gets configured to load-balance between my DNS resolver and Cloudflare's. I already looked under every stone, but there's no way to disable this behavior using configuration options.

So if I use DNS names configured by my router instead of hard-coding IP addresses, HA will switch over to Cloudflare from time to time and leak my internal hostnames to their service. Of course resolution fails in this case, too. Note that this is not caused by the hard-coded fallback option, but by the hard-coded load-balancing option.

One way to avoid this could be blocking 1.1.1.1 and 1.0.0.1 in my firewall, but then HA's DNS resolver goes berserk flooding my firewall logs with multiple connection attempts per second. Also, this will break further whenever developers decide to switch their user base from Cloudflare to a new data collection service.

### What operating system image do you use?

ova (for Virtual Machines)

### What version of Home Assistant Operating System is installed?

7.1

### Did you upgrade the Operating System.

Yes

### Steps to reproduce the issue

1. Insert local hostname in HA config
2. Notice recurring failures in name resolution
3. Notice packets going to 1.0.0.1 and 1.1.1.1

### Anything in the Supervisor logs that might be useful for us?

```
-
```
### Anything in the Host logs that might be useful for us?

```
Typical output of `ha dns log` when the service gets blocked.
~~~
[INFO] 127.0.0.1:44130 - 10230 "NS IN . udp 17 false 512" NOERROR - 0 30.001023101s
[ERROR] plugin/errors: 2 . NS: dial tcp 1.1.1.1:853: i/o timeout
[INFO] 127.0.0.1:51517 - 36166 "NS IN . udp 17 false 512" NOERROR - 0 30.000661016s
[ERROR] plugin/errors: 2 . NS: dial tcp 1.0.0.1:853: i/o timeout
[INFO] 127.0.0.1:34985 - 13557 "NS IN . udp 17 false 512" NOERROR - 0 30.001216215s
[ERROR] plugin/errors: 2 . NS: dial tcp 1.0.0.1:853: i/o timeout
[INFO] 127.0.0.1:39902 - 40031 "NS IN . udp 17 false 512" NOERROR - 0 30.000821668s
[ERROR] plugin/errors: 2 . NS: dial tcp 1.1.1.1:853: i/o timeout
[INFO] 127.0.0.1:43380 - 37784 "NS IN . udp 17 false 512" NOERROR - 0 30.000649803s
[ERROR] plugin/errors: 2 . NS: dial tcp 1.0.0.1:853: i/o timeout
[INFO] 127.0.0.1:60231 - 1526 "NS IN . udp 17 false 512" NOERROR - 0 30.000941436s
[ERROR] plugin/errors: 2 . NS: dial tcp 1.0.0.1:853: i/o timeout
[INFO] 127.0.0.1:42409 - 17159 "NS IN . udp 17 false 512" NOERROR - 0 30.001298402s
[ERROR] plugin/errors: 2 . NS: dial tcp 1.1.1.1:853: i/o timeout
[INFO] 127.0.0.1:37011 - 7485 "NS IN . udp 17 false 512" NOERROR - 0 30.00056859s
[ERROR] plugin/errors: 2 . NS: dial tcp 1.0.0.1:853: i/o timeout
[INFO] 127.0.0.1:46069 - 34633 "NS IN . udp 17 false 512" NOERROR - 0 30.001109111s
[ERROR] plugin/errors: 2 . NS: dial tcp 1.0.0.1:853: i/o timeout
[INFO] 127.0.0.1:52199 - 55341 "NS IN . udp 17 false 512" NOERROR - 0 30.000769912s
[ERROR] plugin/errors: 2 . NS: dial tcp 1.0.0.1:853: i/o timeout
[INFO] 127.0.0.1:44575 - 61374 "NS IN . udp 17 false 512" NOERROR - 0 30.000521003s
[ERROR] plugin/errors: 2 . NS: dial tcp 1.1.1.1:853: i/o timeout
[INFO] 127.0.0.1:59716 - 56622 "NS IN . udp 17 false 512" NOERROR - 0 30.001314379s
[ERROR] plugin/errors: 2 . NS: dial tcp 1.0.0.1:853: i/o timeout
[INFO] 127.0.0.1:43202 - 11517 "NS IN . udp 17 false 512" NOERROR - 0 30.000960835s
[ERROR] plugin/errors: 2 . NS: dial tcp 1.1.1.1:853: i/o timeout
~~~
```
### System Health information

*No response*

### Additional information

*No response*

üëç6
## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_5f1ba08a_20250119_111052.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fissues%2F6)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fissues%2F6)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=home-assistant%2Fplugin-dns)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[home-assistant](/home-assistant)
/
**[plugin-dns](/home-assistant/plugin-dns)**
Public

* [Notifications](/login?return_to=%2Fhome-assistant%2Fplugin-dns) You must be signed in to change notification settings
* [Fork
  15](/login?return_to=%2Fhome-assistant%2Fplugin-dns)
* [Star
   21](/login?return_to=%2Fhome-assistant%2Fplugin-dns)

* [Code](/home-assistant/plugin-dns)
* [Issues
  3](/home-assistant/plugin-dns/issues)
* [Pull requests
  0](/home-assistant/plugin-dns/pulls)
* [Actions](/home-assistant/plugin-dns/actions)
* [Security](/home-assistant/plugin-dns/security)
* [Insights](/home-assistant/plugin-dns/pulse)

Additional navigation options

* [Code](/home-assistant/plugin-dns)
* [Issues](/home-assistant/plugin-dns/issues)
* [Pull requests](/home-assistant/plugin-dns/pulls)
* [Actions](/home-assistant/plugin-dns/actions)
* [Security](/home-assistant/plugin-dns/security)
* [Insights](/home-assistant/plugin-dns/pulse)

# DNS server settings ignored for resolving lan hosts.¬†#6

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosed[#8](https://github.com/home-assistant/plugin-dns/pull/8)Closed[DNS server settings ignored for resolving lan hosts.](#top)#6[#8](https://github.com/home-assistant/plugin-dns/pull/8)Copy linkLabels[upstream](https://github.com/home-assistant/plugin-dns/issues?q=state%3Aopen%20label%3A%22upstream%22)![@Zixim](https://avatars.githubusercontent.com/u/7814664?u=6d1b94162b1cee3cd950aa8f2b82af7b9d618f0a&v=4&size=80)
## Description

![@Zixim](https://avatars.githubusercontent.com/u/7814664?u=6d1b94162b1cee3cd950aa8f2b82af7b9d618f0a&v=4&size=48)[Zixim](https://github.com/Zixim)opened [on Oct 9, 2020](https://github.com/home-assistant/plugin-dns/issues/6#issue-719313704)

**HassOS release with the issue:**

* Frontend -> Configuration -> Info

```
arch	x86_64
chassis	vm
dev	false
docker	true
docker_version	19.03.11
hassio	true
host_os	HassOS 4.13
installation_type	Home Assistant OS
os_name	Linux
os_version	5.4.63
python_version	3.8.5
supervisor	247
timezone	Europe/Brussels
version	0.115.6
virtualenv	false

```

* Or use this command: hass --version

```
‚ûú  ~ hass --version
zsh: command not found: hass

```

**Journal logs:**

```
Oct 09 08:11:07 homeassistant 85843c26f66f[386]: [INFO] 127.0.0.1:35481 - 43627 "A IN influx.local. udp 30 false 512" NXDOMAIN qr,rd,ra 105 0.090119317s
Oct 09 08:11:07 homeassistant 85843c26f66f[386]: [INFO] 172.30.32.1:48509 - 43627 "A IN influx.local. udp 30 false 512" NXDOMAIN qr,rd,ra 105 0.091012247s
Oct 09 08:11:08 homeassistant 85843c26f66f[386]: [INFO] 127.0.0.1:36749 - 57069 "A IN syncthingx.local. udp 34 false 512" NXDOMAIN qr,rd,ra 109 0.024540873s
Oct 09 08:11:08 homeassistant 85843c26f66f[386]: [INFO] 172.30.32.1:38087 - 57069 "A IN syncthingx.local. udp 34 false 512" NXDOMAIN qr,rd,ra 109 0.025081218s
Oct 09 08:11:08 homeassistant 85843c26f66f[386]: [INFO] 127.0.0.1:35481 - 57327 "AAAA IN syncthingx.local. udp 34 false 512" NXDOMAIN qr,rd,ra 109 0.096807474s
Oct 09 08:11:08 homeassistant 85843c26f66f[386]: [INFO] 172.30.32.1:38087 - 57327 "AAAA IN syncthingx.local. udp 34 false 512" NXDOMAIN qr,rd,ra 109 0.097437652s

```

**Description of problem:**

***TLDR : After some time (X hours) , HA stops using the user-defined DNS server, thus no longer being able to resolve hosts on the LAN.***

HA is configured to use a local DNS server :

```
‚ûú  ~ ha dns info
host: 172.30.32.3
locals:
- dns://192.168.11.2
servers:
- dns://192.168.11.2
version: "9"
version_latest: "9"
‚ûú  ~

```

Trying to resolve a local host fails :

```
‚ûú  ~ nslookup influx.local
Server:         172.30.32.3
Address:        172.30.32.3#53

** server can't find influx.local: NXDOMAIN

```

On the DNS server side, the logs show no request arriving for that lookup.

*Forcing* the lookup to use the specific DNS server works :

```
‚ûú  ~ nslookup influx.local 192.168.11.2
Server:         192.168.11.2
Address:        192.168.11.2#53

Name:   influx.local
Address: 192.168.11.134

```

And in this case, the DNS logging indeed confirms name resolution :

```
Oct  9 08:21:20 dnsmasq[344]: query[A] influx.local from 192.168.11.5
Oct  9 08:21:20 dnsmasq[344]: query[AAAA] influx.local from 192.168.11.5

```
### Doing the same on the HassOS host works without ant kind of issue :

```
# nslookup influx.local
Server:         192.168.11.2
Address:        192.168.11.2:53

Name:   influx.local
Address: 192.168.11.134

Non-authoritative answer:

#

```
### Additional info :

* Doing a `ha dns restart` solves the issue, for a while (X hours), but it always returns to being broken.
* I migrated to HassOS a month or 2 ago, previously been running Hassio for a few years.
* In a Hassio setup, this issue *never* happened.
* HassOS based setup has had this from my first install.
* Pleading for help on Discord yielded very little response, no useful response at all.
* Others are having the same issue, and are also being ignored : <https://community.home-assistant.io/t/local-dns/178108>
## Metadata

### Assignees

No one assigned

### Labels

[upstream](https://github.com/home-assistant/plugin-dns/issues?q=state%3Aopen%20label%3A%22upstream%22)
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_f6c185b7_20250119_111103.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fpull%2F59)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fpull%2F59)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=home-assistant%2Fplugin-dns)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[home-assistant](/home-assistant)
/
**[plugin-dns](/home-assistant/plugin-dns)**
Public

* [Notifications](/login?return_to=%2Fhome-assistant%2Fplugin-dns) You must be signed in to change notification settings
* [Fork
  15](/login?return_to=%2Fhome-assistant%2Fplugin-dns)
* [Star
   21](/login?return_to=%2Fhome-assistant%2Fplugin-dns)

* [Code](/home-assistant/plugin-dns)
* [Issues
  3](/home-assistant/plugin-dns/issues)
* [Pull requests
  0](/home-assistant/plugin-dns/pulls)
* [Actions](/home-assistant/plugin-dns/actions)
* [Security](/home-assistant/plugin-dns/security)
* [Insights](/home-assistant/plugin-dns/pulse)

Additional navigation options

* [Code](/home-assistant/plugin-dns)
* [Issues](/home-assistant/plugin-dns/issues)
* [Pull requests](/home-assistant/plugin-dns/pulls)
* [Actions](/home-assistant/plugin-dns/actions)
* [Security](/home-assistant/plugin-dns/security)
* [Insights](/home-assistant/plugin-dns/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fhome-assistant%2Fplugin-dns%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fhome-assistant%2Fplugin-dns%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Fix local DNS resolution issue #59

 Closed

[fenichelar](/fenichelar)
wants to merge
1
commit into
[home-assistant:master](/home-assistant/plugin-dns/tree/master "home-assistant/plugin-dns:master")
from
fenichelar:local-dns

 Closed

# [Fix local DNS resolution issue](#top) #59

[fenichelar](/fenichelar)
wants to merge
1
commit into
[home-assistant:master](/home-assistant/plugin-dns/tree/master "home-assistant/plugin-dns:master")
from
fenichelar:local-dns

[Conversation
43](/home-assistant/plugin-dns/pull/59)
[Commits
1](/home-assistant/plugin-dns/pull/59/commits)
[Checks
0](/home-assistant/plugin-dns/pull/59/checks)
[Files changed](/home-assistant/plugin-dns/pull/59/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![fenichelar](https://avatars.githubusercontent.com/u/3437075?s=60&v=4)](/fenichelar)

Copy link

### @fenichelar **[fenichelar](/fenichelar)** commented [Sep 28, 2021](#issue-1010091171)

1. Always try local DNS before Cloudflare
2. If DNS servers are configured manually and via DHCP, only use manually configured DNS servers not both

Note, this does not remove Cloudflare DNS server fallback.

Sorry, something went wrong.

All reactions

[![@homeassistant](https://avatars.githubusercontent.com/u/23041403?s=40&u=47513de918772e42a8a77298dd8714123c97321c&v=4)](/homeassistant)
[homeassistant](/homeassistant)
added
the
[cla-signed](/home-assistant/plugin-dns/labels/cla-signed)
label
[Sep 28, 2021](#event-5375916283)

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=40&v=4)](/fenichelar)

`[Fix local DNS resolution issue](/home-assistant/plugin-dns/pull/59/commits/d5a9e507f5933f10a160268b71cace51277f3771 "Fix local DNS resolution issue")`

`[d5a9e50](/home-assistant/plugin-dns/pull/59/commits/d5a9e507f5933f10a160268b71cace51277f3771)`

[![frenck](https://avatars.githubusercontent.com/u/195327?s=60&v=4)](/frenck)

**[frenck](/frenck)**
requested changes
[Sep 28, 2021](#pullrequestreview-765862661)

 [View reviewed changes](/home-assistant/plugin-dns/pull/59/files/d5a9e507f5933f10a160268b71cace51277f3771)

Copy link

Member

### @frenck **[frenck](/frenck)** left a comment ‚Ä¢ edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

> 2. If DNS servers are configured manually and via DHCP, only use manually configured DNS servers not both

Fallback should be used. The possibility of disabling fallback can be added using within these scopes:

[#56 (review)](https://github.com/home-assistant/plugin-dns/pull/56#pullrequestreview-765166109)

The solution in this PR does not match that. You already knew that, as that previous PR is yours as well... yet you choose to ignore it?

Sorry, something went wrong.

 üëé
4
 sym0nd0, pkoretic, ryanwalder, and 9True reacted with thumbs down emoji

All reactions

* üëé
  4 reactions

[![@Zixim](https://avatars.githubusercontent.com/u/7814664?s=80&u=6d1b94162b1cee3cd950aa8f2b82af7b9d618f0a&v=4)](/Zixim)

### This comment has been minimized.

[Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fpull%2F59)

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 28, 2021](#issuecomment-929551977) ‚Ä¢ edited Loading

| [@frenck](https://github.com/frenck) Can you please elaborate? Fallback is used:   [plugin-dns/rootfs/usr/share/tempio/corefile](https://github.com/home-assistant/plugin-dns/blob/d5a9e507f5933f10a160268b71cace51277f3771/rootfs/usr/share/tempio/corefile#L20)  Line 20 in [d5a9e50](/home-assistant/plugin-dns/commit/d5a9e507f5933f10a160268b71cace51277f3771)   |  | fallback REFUSED,SERVFAIL,NXDOMAIN . dns://127.0.0.1:5553 | | --- | --- |    I think there is some confusion on how coredns works.   The solution in this PR does not match that. You already knew that, as that previous PR is yours as well... yet you choose to ignore it?  This is a different issue. |
| --- | --- | --- |

 üëç
3
 Zixim, sym0nd0, and pkoretic reacted with thumbs up emoji

All reactions

* üëç
  3 reactions

Sorry, something went wrong.

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 28, 2021](#issuecomment-929556112)

| This PR has nothing to do with failover. Right now, if DNS servers are both manually configured and provided via DHCP, then both the manually configured and DHCP provided servers are used for load balancing. The manually configured DNS servers should overwrite the DHCP provided servers. |
| --- |

 üëç
2
 sym0nd0 and pkoretic reacted with thumbs up emoji

All reactions

* üëç
  2 reactions

Sorry, something went wrong.

[![@frenck](https://avatars.githubusercontent.com/u/195327?s=80&u=c0f88e376380f7a811559aa54d5096a66f6d3488&v=4)](/frenck)

Copy link

Member

### **[frenck](/frenck)** commented [Sep 28, 2021](#issuecomment-929558764)

| The manually configured DNS servers should overwrite the DHCP provided servers.  I understand that is what you are trying to achieve, yet, we consider the DHCP servers a possible fallback/route as well, which is removed when servers have been manually set up.  So, for the OS-based installs, resolving anything is considered more important than anything else. |
| --- |

All reactions

Sorry, something went wrong.

[![@alexdelprete](https://avatars.githubusercontent.com/u/7027842?s=80&u=7f577acb229619c8dcb799cae5f9f5afb2a48d48&v=4)](/alexdelprete)

### This comment has been minimized.

[Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fpull%2F59)

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 28, 2021](#issuecomment-929559413)

| [@frenck](https://github.com/frenck)  So, for the OS-based installs, resolving anything is considered more important than anything else.  The current implementation doesn't resolve local dns names.... |
| --- |

All reactions

Sorry, something went wrong.

[![@Zixim](https://avatars.githubusercontent.com/u/7814664?s=80&u=6d1b94162b1cee3cd950aa8f2b82af7b9d618f0a&v=4)](/Zixim)

### This comment has been minimized.

[Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fpull%2F59)

[![@frenck](https://avatars.githubusercontent.com/u/195327?s=80&u=c0f88e376380f7a811559aa54d5096a66f6d3488&v=4)](/frenck)

Copy link

Member

### **[frenck](/frenck)** commented [Sep 28, 2021](#issuecomment-929561431) ‚Ä¢ edited Loading

| The current implementation doesn't resolve local dns names...  It does actually; for example, it gets mDNS local domains as known here: <https://github.com/home-assistant/plugin-dns/tree/master/plugins/mdns>; main reason for this is to work around issues with multicasting and Docker.  As for my personal setup, I used even split DNS with custom local domains in the current method.  Pascal said that even if those things are implemented, the system would be considered unsupported, can you confirm? If so, why?  Because customizations on a managed systems are simply not supported by the core team. |
| --- |

All reactions

Sorry, something went wrong.

[![@Zixim](https://avatars.githubusercontent.com/u/7814664?s=80&u=6d1b94162b1cee3cd950aa8f2b82af7b9d618f0a&v=4)](/Zixim)

### This comment has been minimized.

[Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fpull%2F59)

[![@jjvandenberg](https://avatars.githubusercontent.com/u/66120846?s=80&v=4)](/jjvandenberg)

### This comment has been minimized.

[Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fpull%2F59)

[![@alexdelprete](https://avatars.githubusercontent.com/u/7027842?s=80&u=7f577acb229619c8dcb799cae5f9f5afb2a48d48&v=4)](/alexdelprete)

### This comment has been minimized.

[Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fpull%2F59)

[![@alexdelprete](https://avatars.githubusercontent.com/u/7027842?s=80&u=7f577acb229619c8dcb799cae5f9f5afb2a48d48&v=4)](/alexdelprete)

### This comment has been minimized.

[Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fpull%2F59)

[![@alexdelprete](https://avatars.githubusercontent.com/u/7027842?s=80&u=7f577acb229619c8dcb799cae5f9f5afb2a48d48&v=4)](/alexdelprete)

### This comment has been minimized.

[Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fpull%2F59)

[![@frenck](https://avatars.githubusercontent.com/u/195327?s=80&u=c0f88e376380f7a811559aa54d5096a66f6d3488&v=4)](/frenck)

Copy link

Member

### **[frenck](/frenck)** commented [Sep 28, 2021](#issuecomment-929583477)

| You said you were willing to discuss anything  This is not a generic discussion but a PR review. Your comments are general architectural comments and opinions on decisions made in the past for good reasons and are not reflecting the actual code being reviewed here. Please use or community forums or Discord chat if you'd like to discuss these types of things with others.  Thanks. |
| --- |

 üëé
3
 sym0nd0, synthead, and mcblum reacted with thumbs down emoji

All reactions

* üëé
  3 reactions

Sorry, something went wrong.

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 28, 2021](#issuecomment-929584065)

| [@frenck](https://github.com/frenck) do you want to discuss via email or something? I'm looking for directions on how to move forward |
| --- |

 üëç
1
 sym0nd0 reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![@frenck](https://avatars.githubusercontent.com/u/195327?s=80&u=c0f88e376380f7a811559aa54d5096a66f6d3488&v=4)](/frenck)

Copy link

Member

### **[frenck](/frenck)** commented [Sep 28, 2021](#issuecomment-929585957) ‚Ä¢ edited Loading

| [@frenck](https://github.com/frenck) do you want to discuss via email or something? I'm looking for directions on how to move forward  No? The direction to move forward has been pointed out already. I'm not sure what else you want from me at this moment. The project is willing to accept the capability of disabling fallback methods within the parameters pointed out already. |
| --- |

 üëé
3
 sym0nd0, mcblum, and krysiswbk reacted with thumbs down emoji

All reactions

* üëé
  3 reactions

Sorry, something went wrong.

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 28, 2021](#issuecomment-929586919)

| I'm not sure what else you want from me at this moment.  I asked a few follow up question and never got a response... |
| --- |

All reactions

Sorry, something went wrong.

[![@frenck](https://avatars.githubusercontent.com/u/195327?s=80&u=c0f88e376380f7a811559aa54d5096a66f6d3488&v=4)](/frenck)

Copy link

Member

### **[frenck](/frenck)** commented [Sep 28, 2021](#issuecomment-929587687)

| I asked a few follow up question and never got a response...  Sorry, maybe I missed something because of all the side spamming in this review. Could you point me out the question? |
| --- |

All reactions

Sorry, something went wrong.

[![@alexdelprete](https://avatars.githubusercontent.com/u/7027842?s=80&u=7f577acb229619c8dcb799cae5f9f5afb2a48d48&v=4)](/alexdelprete)

### This comment has been minimized.

[Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fpull%2F59)

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 28, 2021](#issuecomment-929592228)

| That will not solve the main issue which we solved with this. If you want this then you need to do the following:  What issue?   1. Is the concern that no DNS servers will be configured (either via DHCP or manually)? 2. Or is the concern that DNS servers will be configured (either via DHCP or manually) but won't respond to DNS queries Maybe due to DNS server failure, incorrect DNS server IPs being configured, firewall rules, etc. 3. Or is the concern that DNS servers will be configured (either via DHCP or manually) but won't forward queries and will return NXDOMAIN for all external domains? 4. Something else?   Open a PR to Supervisor and add an option to disable fallback which marks your system as unsupported and extend it to the API + tests   1. What should be config flag be called? 2. What should its type be?   Create an PR to the developer documentation for having it there  Okay  Create an PR to CLI repository for using that options  Okay  Create an PR to this repository to get this options in place  How should this work? My goal would be to find a way to make HA use the DNS server provided via DHCP and nothing else. |
| --- |

All reactions

Sorry, something went wrong.

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 28, 2021](#issuecomment-929594398)

| [@frenck](https://github.com/frenck) Would it make more sense to just have a way to disable `plugin-dns` and have HA core use DHCP provided or manually configured DNS servers directly? |
| --- |

All reactions

Sorry, something went wrong.

[![@frenck](https://avatars.githubusercontent.com/u/195327?s=80&u=c0f88e376380f7a811559aa54d5096a66f6d3488&v=4)](/frenck)

Copy link

Member

### **[frenck](/frenck)** commented [Sep 28, 2021](#issuecomment-929600314) ‚Ä¢ edited Loading

| What issue?  Multiple! The OS is aimed at the average Joe running this at home, with limited knowledge. We have had to deal with many many many different issues and network configurations (and misconfiguration) causing an absolute flood of issues. This has slowly (over time) resulted in what you see here.  Most of the issues currently still there, are often the result of customizations or advanced network setup. This is fine, however, that is not the target audience. As a matter of fact, the number of DNS / name resolving issues hasn't been as low as it is right now.  Broken local DNS, wrongly set up split DNS, misconfigured ad blockers, DNS loops, DNS of provides down causing issues, misconfigured Docker setups or virtual machines, wrongly configured firewalls, and many more.  What should be config flag be called? What should its type be?  A feature flag? I would say a boolean? Name... I dunno, something descriptive, however, that is just a name. Make it something descriptive, in the review of that specific PR that can be discussed (and adjustments to a name can be made quickly in general).  How should this work? My goal would be to find a way to make HA use the DNS server provided via DHCP and nothing else.  Add a flag to the supervisor and describe, pass the flag to the configuration of the DNS plugin so it can use it during the configuration generation.  However, that is a bit out of scope for this PR as described I would say.  Would it make more sense to just have a way to disable plugin-dns and have HA core use DHCP provided or manually configured DNS servers directly?  I don't think so, that will cause a different world of issues, as multiple parts of the system will assume it is there. |
| --- |

All reactions

Sorry, something went wrong.

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 28, 2021](#issuecomment-929619818)

| Broken local DNS, wrongly set up split DNS, misconfigured ad blockers, DNS loops, DNS of provides down causing issues, misconfigured Docker setups or virtual machines, wrongly configured firewalls, and many more.  Cloudflare DNS is currently setup as both a forwarding DNS server and a failover DNS server. I don't understand why this was done. It is hard to discuss a PR allowing this behavior to be changed when the reason for the behavior is unclear. Do you know why Cloudflare DNS was setup as both a forwarding DNS server and a failover DNS server?  Add a flag to the supervisor and describe, pass the flag to the configuration of the DNS plugin so it can use it during the configuration generation.  But what configuration would this result in?   1. Would it forward only to manually configured DNS servers (if configured) and DHCP provided DNS servers otherwise? 2. Would it forward to both manually configured and DHCP provided DNS servers? 3. What about the Docker DNS server? 4. Something else?   However, that is a bit out of scope for this PR as described I would say.  How do I discuss a PR I am working on then? |
| --- |

All reactions

Sorry, something went wrong.

[![@frenck](https://avatars.githubusercontent.com/u/195327?s=80&u=c0f88e376380f7a811559aa54d5096a66f6d3488&v=4)](/frenck)

Copy link

Member

### **[frenck](/frenck)** commented [Sep 28, 2021](#issuecomment-929624075) ‚Ä¢ edited Loading

| Cloudflare DNS is currently setup as both a forwarding DNS server and a failover DNS server. I don't understand why this was done. It is hard to discuss a PR allowing this behavior to be changed when the reason for the behavior is unclear  Resolving anything is more important than solving nothing. The reason I gave in my last answer.  But what configuration would this result in?  Disabling any fallback I would say? That is the goal you are trying to achieve, right?  How do I discuss a PR I am working on then?  This PR is titled: "Fix local DNS resolution issue", you are now discussing adding a supervisor feature flags for disabling fallback. I'm sorry, but that feels offtopic and not related to the content written in this PR (nor can this PR be modified to achieve that even remotely). |
| --- |

All reactions

Sorry, something went wrong.

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 28, 2021](#issuecomment-929631034)

| (nor can this PR be modified to achieve that even remotely).  The first PR you closed could have... but it has been locked so I can't ask for feedback now. Read the discussion in the PR, I actually asked about a feature flag before you even reviewed it. There was a lot of off topic discussion, but not from me. I have just been trying to get feedback on my PR.  I give up :( nevermind |
| --- |

 üëç
3
 sym0nd0, psxx, and mcblum reacted with thumbs up emoji

All reactions

* üëç
  3 reactions

Sorry, something went wrong.

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=40&v=4)](/fenichelar)
[fenichelar](/fenichelar)
closed this
[Sep 28, 2021](#event-5376636707)

[![@alexdelprete](https://avatars.githubusercontent.com/u/7027842?s=80&u=7f577acb229619c8dcb799cae5f9f5afb2a48d48&v=4)](/alexdelprete)

### This comment has been minimized.

[Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fpull%2F59)

[![@frenck](https://avatars.githubusercontent.com/u/195327?s=80&u=c0f88e376380f7a811559aa54d5096a66f6d3488&v=4)](/frenck)

Copy link

Member

### **[frenck](/frenck)** commented [Sep 28, 2021](#issuecomment-929632714)

| The first PR you closed could have  Sorry it did not, the feature flag needs to be added to the supervisor as described before. None of the PRs I closed added a flag to the supervisor.  There was a lot of off topic discussion, but not from me.  Yeah I know, sorry about that, its really distracting :(  I give up :( nevermind  :( If you change your mind and are up for a shot, let me know |
| --- |

All reactions

Sorry, something went wrong.

[![@frenck](https://avatars.githubusercontent.com/u/195327?s=80&u=c0f88e376380f7a811559aa54d5096a66f6d3488&v=4)](/frenck)

Copy link

Member

### **[frenck](/frenck)** commented [Sep 28, 2021](#issuecomment-929633394)

| [@alexdelprete](https://github.com/alexdelprete) This formal and final warning. That the last comment is unneeded and condescending (and not the first) another one will result in a ban. |
| --- |

 üëé
11
 sym0nd0, Spazholio, Sloth-on-meth, cameri, psxx, thebatfink, synthead, mcblum, miniminne, ondrejmo, and pojlFDlxCOvZ4Kg8y1l4 reacted with thumbs down emoji

All reactions

* üëé
  11 reactions

Sorry, something went wrong.

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 28, 2021](#issuecomment-929638225)

| Sorry it did not, the feature flag needs to be added to the supervisor as described before. None of the PRs I closed added a flag to the supervisor.  Supervisor just contains the flag, not the logic for what the flag does. I would assume it makes more sense to discuss what the flag does in the `plugin-dns` repo than the `supervisor` repo. We are essentially talking about wrapping my existing PR behind a flag, all of the code is still applicable, it would just be wrapped in an if statement.  :( If you change your mind and are up for a shot, let me know  If you are willing to work with me, I would like to tackle this. But I am not going to start working on the PR for supervisor to add a flag until after we figure out what the flag actually does. I don't know about you, but I write code THEN documentation, not the other way around.  I will submit a new PR to `plugin-dns` for us to discuss shortly. The change will be behind a feature flag that doesn't yet exist. I will submit PRs to add the feature flag after. |
| --- |

All reactions

Sorry, something went wrong.

[![@frenck](https://avatars.githubusercontent.com/u/195327?s=80&u=c0f88e376380f7a811559aa54d5096a66f6d3488&v=4)](/frenck)

Copy link

Member

### **[frenck](/frenck)** commented [Sep 28, 2021](#issuecomment-929639387) ‚Ä¢ edited Loading

| I don't know about you, but I write code THEN documentation, not the other way around.  This is not about adding documentation, this is about adding the controls. If there aren't controls and flags created in the supervisor, there will be nothing to test or control to implement.  As for documentation that will be required before merging the final PRs üòâ  I will submit a new PR to plugin-dns for us to discuss shortly.  If you do, please do that in conjunction with the matching supervisor and CLI PRs that go with it. |
| --- |

All reactions

Sorry, something went wrong.

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 28, 2021](#issuecomment-929642967)

| [@frenck](https://github.com/frenck)  If you do, please do that in conjunction with the matching supervisor and CLI PRs that go with it.  So you are saying you won't discuss the change here until after I write the PR for supervisor and CLI? So if you provide feedback on this PR that requires a change then I will have to rewrite all 3 PRs... doesn't it make more sense to review the DNS change and confirm it is good before implementing the flag? |
| --- |

 üëç
3
 sym0nd0, psxx, and ondrejmo reacted with thumbs up emoji

All reactions

* üëç
  3 reactions

Sorry, something went wrong.

[![@frenck](https://avatars.githubusercontent.com/u/195327?s=80&u=c0f88e376380f7a811559aa54d5096a66f6d3488&v=4)](/frenck)

Copy link

Member

### **[frenck](/frenck)** commented [Sep 28, 2021](#issuecomment-929643970) ‚Ä¢ edited Loading

| The dns part is the smallest part of the implementation and a fairly simple of statement handling the state of the flag (thus barely interesting or discussable imho) The other parts require way more implementation, code and tests. |
| --- |

All reactions

Sorry, something went wrong.

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 28, 2021](#issuecomment-929646694)

| The dns part is the smallest part of the implementation and a fairly simple of statement handling the state of the flag (thus barely interesting or discuss Anne imho) The other parts require way more implementation, code and tests.  But I don't know what change to make in supervisor until we discuss this. There is a high probability that using more than one feature flag is the best way forward. Or maybe you don't want to use multiple flags but instead use a string config option. I think you will understand once I submit a PR. |
| --- |

All reactions

Sorry, something went wrong.

[![@frenck](https://avatars.githubusercontent.com/u/195327?s=80&u=c0f88e376380f7a811559aa54d5096a66f6d3488&v=4)](/frenck)

Copy link

Member

### **[frenck](/frenck)** commented [Sep 28, 2021](#issuecomment-929648147) ‚Ä¢ edited Loading

| I don't think it's that difficult: use dns fallback or not. If the fallback is disabled only use the configured DNS servers... ü§∑‚Äç‚ôÇÔ∏è we don't need multiple flag for that. |
| --- |

All reactions

Sorry, something went wrong.

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 28, 2021](#issuecomment-929653973)

| I don't think it's that difficult: use dns fallback or not. If the fallback is disabled only use the configured DNS servers... ü§∑‚Äç‚ôÇÔ∏è we don't need multiple flash for that.  How should the following scenarios be handled?  DNS servers have been provided both manually and via DHCP.   1. Use manually provided DNS servers only 2. Use DHCP provided DNS servers only 3. Use both manually provided DNS servers and DHCP provided DNS servers in the forward line (what order?) 4. Use manually provided DNS servers in the forward line and DHCP in the fallback line 5. Use DHCP provided DNS servers in the forward line and manually provided in the fallback line   And this is assuming we aren't including the Docker DNS server anywhere. Should the Docker DNS server be used? |
| --- |

All reactions

Sorry, something went wrong.

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 28, 2021](#issuecomment-929655552)

| Maybe instead of a single `failover` feature flag, having a `dns_mode` flag makes more sense. With the following options:  `automatic` - current behavior `DHCP` - use DHCP provided DNS servers only `manual` - use manually provided DNS servers only `docker` - use Docker DNS server only |
| --- |

All reactions

Sorry, something went wrong.

[![@frenck](https://avatars.githubusercontent.com/u/195327?s=80&u=c0f88e376380f7a811559aa54d5096a66f6d3488&v=4)](/frenck)

Copy link

Member

### **[frenck](/frenck)** commented [Sep 28, 2021](#issuecomment-929657805)

| I really don't think we should handle those cases at all from a flags perspective.  If the single flag is turning off fallback: In case manual server are provided use those, else use DHCP provided one. |
| --- |

All reactions

Sorry, something went wrong.

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 28, 2021](#issuecomment-929659099)

| If the single flag is turning off fallback: In case manual server are provided use those, else use DHCP provided one.  Ok. What about Docker DNS server? Only use Docker if no servers are provided manually or via DHCP? |
| --- |

All reactions

Sorry, something went wrong.

[![@frenck](https://avatars.githubusercontent.com/u/195327?s=80&u=c0f88e376380f7a811559aa54d5096a66f6d3488&v=4)](/frenck)

Copy link

Member

### **[frenck](/frenck)** commented [Sep 28, 2021](#issuecomment-929659936)

| Docker dns has no part in this, nor does it need to be. It will match the already available info, as the supervisor manages the network settings. |
| --- |

All reactions

Sorry, something went wrong.

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 28, 2021](#issuecomment-929661842)

| [@frenck](https://github.com/frenck) The case I am trying to handle is if no servers are provided manually and no servers are provided via DHCP? Should the forward line just contain `dns://127.0.0.11`? |
| --- |

All reactions

Sorry, something went wrong.

[![@itsdeltalol](https://avatars.githubusercontent.com/u/8211549?s=80&v=4)](/itsdeltalol)

Copy link

### **[itsdeltalol](/itsdeltalol)** commented [Nov 25, 2021](#issuecomment-979210767)

| What issue?  Multiple! The OS is aimed at the average Joe running this at home, with limited knowledge. We have had to deal with many many many different issues and network configurations (and misconfiguration) causing an absolute flood of issues. This has slowly (over time) resulted in what you see here.  Hey, this describes me pretty well, I have some really limited knowledge, probably don't even belong in this discussion, but I'm having trouble getting Home Assistant to recognize the .local hosts that raspberry pi custom builds tend to set up. I have like three of them and I'm really going to hate to have to re-do each card when that device powers up and gets a new IP. It'd be really good if there was a thing to handle that. |
| --- |

All reactions

Sorry, something went wrong.

[![@Zixim](https://avatars.githubusercontent.com/u/7814664?s=80&u=6d1b94162b1cee3cd950aa8f2b82af7b9d618f0a&v=4)](/Zixim)

Copy link

### **[Zixim](/Zixim)** commented [Nov 27, 2021](#issuecomment-980797747)

| "a thing to handle that".. well that would be DNS...except HAOS devs have decided to break it, for "reasons". |
| --- |

 üëç
2
 sym0nd0 and psxx reacted with thumbs up emoji

All reactions

* üëç
  2 reactions

Sorry, something went wrong.

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fpull%2F59)

Reviewers

[![@frenck](https://avatars.githubusercontent.com/u/195327?s=40&v=4)](/frenck) [frenck](/frenck)

frenck requested changes

Assignees

No one assigned

Labels

[cla-signed](/home-assistant/plugin-dns/labels/cla-signed)

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

7 participants

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=52&v=4)](/fenichelar) [![@Zixim](https://avatars.githubusercontent.com/u/7814664?s=52&v=4)](/Zixim) [![@frenck](https://avatars.githubusercontent.com/u/195327?s=52&v=4)](/frenck) [![@alexdelprete](https://avatars.githubusercontent.com/u/7027842?s=52&v=4)](/alexdelprete) [![@jjvandenberg](https://avatars.githubusercontent.com/u/66120846?s=52&v=4)](/jjvandenberg) [![@itsdeltalol](https://avatars.githubusercontent.com/u/8211549?s=52&v=4)](/itsdeltalol) [![@homeassistant](https://avatars.githubusercontent.com/u/23041403?s=52&v=4)](/homeassistant)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_c08145a3_20250119_111047.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fissues%2F22)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fissues%2F22)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=home-assistant%2Fplugin-dns)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[home-assistant](/home-assistant)
/
**[plugin-dns](/home-assistant/plugin-dns)**
Public

* [Notifications](/login?return_to=%2Fhome-assistant%2Fplugin-dns) You must be signed in to change notification settings
* [Fork
  15](/login?return_to=%2Fhome-assistant%2Fplugin-dns)
* [Star
   21](/login?return_to=%2Fhome-assistant%2Fplugin-dns)

* [Code](/home-assistant/plugin-dns)
* [Issues
  3](/home-assistant/plugin-dns/issues)
* [Pull requests
  0](/home-assistant/plugin-dns/pulls)
* [Actions](/home-assistant/plugin-dns/actions)
* [Security](/home-assistant/plugin-dns/security)
* [Insights](/home-assistant/plugin-dns/pulse)

Additional navigation options

* [Code](/home-assistant/plugin-dns)
* [Issues](/home-assistant/plugin-dns/issues)
* [Pull requests](/home-assistant/plugin-dns/pulls)
* [Actions](/home-assistant/plugin-dns/actions)
* [Security](/home-assistant/plugin-dns/security)
* [Insights](/home-assistant/plugin-dns/pulse)

# Use of CloudFlare DNS, Privacy Breach¬†#22

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[Use of CloudFlare DNS, Privacy Breach](#top)#22Copy link![@tescophil](https://avatars.githubusercontent.com/u/59442445?u=7abbc5f7e155e31c3b5830b65eaea3d2103aa199&v=4&size=80)
## Description

![@tescophil](https://avatars.githubusercontent.com/u/59442445?u=7abbc5f7e155e31c3b5830b65eaea3d2103aa199&v=4&size=48)[tescophil](https://github.com/tescophil)opened [on Jan 18, 2021](https://github.com/home-assistant/plugin-dns/issues/22#issue-788210168)

The CoreDNS module is Home assistant is using CloudFlare DNS-over-TLS by default. This is basically exfilling my private data to a commercial 3rd party without my permission. There is no currently no way to disable this functionality.

The CoreDNS module also attempts to lookup IPv6 AAAA records using CloudFlare when IPv6 is disabled in the supervisor network configuration.

Hardcoded DNS is a breach of privacy and trust, either remove it completely, or provide an option to disable it.

üëç36üòÑ1
## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_eb8c2d03_20250119_111045.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fissues%2F17)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fissues%2F17)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=home-assistant%2Fplugin-dns)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[home-assistant](/home-assistant)
/
**[plugin-dns](/home-assistant/plugin-dns)**
Public

* [Notifications](/login?return_to=%2Fhome-assistant%2Fplugin-dns) You must be signed in to change notification settings
* [Fork
  15](/login?return_to=%2Fhome-assistant%2Fplugin-dns)
* [Star
   21](/login?return_to=%2Fhome-assistant%2Fplugin-dns)

* [Code](/home-assistant/plugin-dns)
* [Issues
  3](/home-assistant/plugin-dns/issues)
* [Pull requests
  0](/home-assistant/plugin-dns/pulls)
* [Actions](/home-assistant/plugin-dns/actions)
* [Security](/home-assistant/plugin-dns/security)
* [Insights](/home-assistant/plugin-dns/pulse)

Additional navigation options

* [Code](/home-assistant/plugin-dns)
* [Issues](/home-assistant/plugin-dns/issues)
* [Pull requests](/home-assistant/plugin-dns/pulls)
* [Actions](/home-assistant/plugin-dns/actions)
* [Security](/home-assistant/plugin-dns/security)
* [Insights](/home-assistant/plugin-dns/pulse)

# DNS Plugin is ignoring my local DNS on startup¬†#17

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[DNS Plugin is ignoring my local DNS on startup](#top)#17Copy link![@superm1](https://avatars.githubusercontent.com/u/494526?v=4&size=80)
## Description

![@superm1](https://avatars.githubusercontent.com/u/494526?v=4&size=48)[superm1](https://github.com/superm1)opened [on Dec 8, 2020](https://github.com/home-assistant/plugin-dns/issues/17#issue-759762237)

I've noticed that when I power cycle my machine running HassOS, that local DNS resolution doesn't work at all. Nearly all of my ESP8266 devices rely upon local DNS resolution so most devices stop working. The local DNS is set via DHCP. I don't set any upstream DNS, everything is supposed to be forwarded through my local DNS.

I've found that I can get it resolved by running `ha dns restart` at which point my local DNS server starts getting used.

```
# ping lgwebostv.localdomain
ping: bad address 'lgwebostv.localdomain`
# ha dns restart
Processing... Done.
# ping lgwebostv.localdomain
PING lgwebostv.localdomain (192.168.20.62): 56 data bytes

```

I've got Hassio supervisor 2020.12.6 on stable channel (HassOS 4.17; deployment production).

## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_4249f5e1_20250119_111050.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fissues%2F53)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fissues%2F53)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=home-assistant%2Fplugin-dns)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[home-assistant](/home-assistant)
/
**[plugin-dns](/home-assistant/plugin-dns)**
Public

* [Notifications](/login?return_to=%2Fhome-assistant%2Fplugin-dns) You must be signed in to change notification settings
* [Fork
  15](/login?return_to=%2Fhome-assistant%2Fplugin-dns)
* [Star
   21](/login?return_to=%2Fhome-assistant%2Fplugin-dns)

* [Code](/home-assistant/plugin-dns)
* [Issues
  3](/home-assistant/plugin-dns/issues)
* [Pull requests
  0](/home-assistant/plugin-dns/pulls)
* [Actions](/home-assistant/plugin-dns/actions)
* [Security](/home-assistant/plugin-dns/security)
* [Insights](/home-assistant/plugin-dns/pulse)

Additional navigation options

* [Code](/home-assistant/plugin-dns)
* [Issues](/home-assistant/plugin-dns/issues)
* [Pull requests](/home-assistant/plugin-dns/pulls)
* [Actions](/home-assistant/plugin-dns/actions)
* [Security](/home-assistant/plugin-dns/security)
* [Insights](/home-assistant/plugin-dns/pulse)

# Don't hard-code upstream DNS resolvers¬†#53

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[Don't hard-code upstream DNS resolvers](#top)#53Copy link![@blalor](https://avatars.githubusercontent.com/u/109915?v=4&size=80)
## Description

![@blalor](https://avatars.githubusercontent.com/u/109915?v=4&size=48)[blalor](https://github.com/blalor)opened [on Aug 17, 2021](https://github.com/home-assistant/plugin-dns/issues/53#issue-972238371)

Applications should not hard-code their own DNS resolvers; they should use the configuration provided by the network (via DHCP) or by the user, perhaps with an overridable default if no other option exists. This is an anti-pattern:

[plugin-dns/rootfs/usr/share/tempio/corefile](https://github.com/home-assistant/plugin-dns/blob/be7b7e7fc4460ef31483882e743ba4e3b62fe8c4/rootfs/usr/share/tempio/corefile#L30)

Line 30
in
[be7b7e7](/home-assistant/plugin-dns/commit/be7b7e7fc4460ef31483882e743ba4e3b62fe8c4)

|  | forward . tls://1.1.1.1 tls://1.0.0.1 { |
| --- | --- |

## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_46fa984b_20250119_111059.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fpull%2F56)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fpull%2F56)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=home-assistant%2Fplugin-dns)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[home-assistant](/home-assistant)
/
**[plugin-dns](/home-assistant/plugin-dns)**
Public

* [Notifications](/login?return_to=%2Fhome-assistant%2Fplugin-dns) You must be signed in to change notification settings
* [Fork
  15](/login?return_to=%2Fhome-assistant%2Fplugin-dns)
* [Star
   21](/login?return_to=%2Fhome-assistant%2Fplugin-dns)

* [Code](/home-assistant/plugin-dns)
* [Issues
  3](/home-assistant/plugin-dns/issues)
* [Pull requests
  0](/home-assistant/plugin-dns/pulls)
* [Actions](/home-assistant/plugin-dns/actions)
* [Security](/home-assistant/plugin-dns/security)
* [Insights](/home-assistant/plugin-dns/pulse)

Additional navigation options

* [Code](/home-assistant/plugin-dns)
* [Issues](/home-assistant/plugin-dns/issues)
* [Pull requests](/home-assistant/plugin-dns/pulls)
* [Actions](/home-assistant/plugin-dns/actions)
* [Security](/home-assistant/plugin-dns/security)
* [Insights](/home-assistant/plugin-dns/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fhome-assistant%2Fplugin-dns%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fhome-assistant%2Fplugin-dns%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Remove hardcoded DNS servers #56

 Closed

[fenichelar](/fenichelar)
wants to merge
1
commit into
[home-assistant:master](/home-assistant/plugin-dns/tree/master "home-assistant/plugin-dns:master")
from
fenichelar:master

 Closed

# [Remove hardcoded DNS servers](#top) #56

[fenichelar](/fenichelar)
wants to merge
1
commit into
[home-assistant:master](/home-assistant/plugin-dns/tree/master "home-assistant/plugin-dns:master")
from
fenichelar:master

[Conversation
54](/home-assistant/plugin-dns/pull/56)
[Commits
1](/home-assistant/plugin-dns/pull/56/commits)
[Checks
0](/home-assistant/plugin-dns/pull/56/checks)
[Files changed](/home-assistant/plugin-dns/pull/56/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![fenichelar](https://avatars.githubusercontent.com/u/3437075?s=60&v=4)](/fenichelar)

Copy link

### @fenichelar **[fenichelar](/fenichelar)** commented [Sep 24, 2021](#issue-1006881703) ‚Ä¢ edited Loading

If DNS servers have been manually configured, use the manually configured DNS servers only. Otherwise if DNS servers have been supplied by DHCP, use the DNS servers supplied by DHCP only. Otherwise use Docker Embedded DNS server.

[#20](https://github.com/home-assistant/plugin-dns/issues/20)

Sorry, something went wrong.

All reactions

[![@homeassistant](https://avatars.githubusercontent.com/u/23041403?s=80&u=47513de918772e42a8a77298dd8714123c97321c&v=4)](/homeassistant)

Copy link

### **[homeassistant](/homeassistant)** commented [Sep 24, 2021](#issuecomment-926961777)

| Hi [@fenichelar](https://github.com/fenichelar),  It seems you haven't yet signed a CLA. Please do so [here](https://home-assistant.io/developers/cla_sign_start/?pr=home-assistant/plugin-dns#56).  Once you do that we will be able to review and accept this pull request.  Thanks! |
| --- |

All reactions

Sorry, something went wrong.

[![@homeassistant](https://avatars.githubusercontent.com/u/23041403?s=40&u=47513de918772e42a8a77298dd8714123c97321c&v=4)](/homeassistant)
[homeassistant](/homeassistant)
added
[cla-needed](/home-assistant/plugin-dns/labels/cla-needed)
[cla-signed](/home-assistant/plugin-dns/labels/cla-signed)
and removed
[cla-needed](/home-assistant/plugin-dns/labels/cla-needed)
labels
[Sep 24, 2021](#event-5358703684)

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 24, 2021](#issuecomment-926964474)

| The logic is consistent with the way most systems work:   1. DNS servers can be manually configured and if they are, then only the manually configured DNS servers are used. 2. DNS servers can be configured via DHCP and if they are and no DNS servers have been manually configured, then only the DNS servers configured via DHCP are used.   As an additional fallback, if no DNS servers are manually configured or configured via DHCP, it will use Cloudflare's DNS servers. Most systems don't have functionality like this so DNS requests would just fail, but this may help reduce user issues.  [@tescophil](https://github.com/tescophil) [@gjdoornink](https://github.com/gjdoornink) [@alexdelprete](https://github.com/alexdelprete) |
| --- |

All reactions

Sorry, something went wrong.

[![@gjdoornink](https://avatars.githubusercontent.com/u/6190460?s=80&v=4)](/gjdoornink)

Copy link

### **[gjdoornink](/gjdoornink)** commented [Sep 24, 2021](#issuecomment-926972529)

| I do not think it is necessary, or even correct, to remove the Docker Embedded DNS server (dns://127.0.0.11). Home Assistant can be deployed in multiple ways. Removing the Docker Embedded DNS server might very well impair non standard Docker based deployments. Which might very well, likely even, result in {.servers} being empty.  As far as I interpret the corefile template, it does not treat the Docker Embedded DNS server as a fallback server, but it ensures that either a DHCP supplied DNS server is used or a Docker supplied DNS server. IMHO this seams quite sensible. |
| --- |

All reactions

Sorry, something went wrong.

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 24, 2021](#issuecomment-926974641)

| [@gjdoornink](https://github.com/gjdoornink) I updated the logic. Expanded for readability:  ``` {{ if .servers }}   {{ join " " .servers }} {{ else if .locals }}   {{ join " " .locals }} {{ else }}   dns://127.0.0.11:53 dns://127.0.0.1:5553 {{ end }}  ```  Thoughts? |
| --- |

All reactions

Sorry, something went wrong.

[![@gjdoornink](https://avatars.githubusercontent.com/u/6190460?s=80&v=4)](/gjdoornink)

Copy link

### **[gjdoornink](/gjdoornink)** commented [Sep 25, 2021](#issuecomment-927123699)

| [@fenichelar](https://github.com/fenichelar) To me it seams you have now introduced an issue similar to the one pull request [#55](https://github.com/home-assistant/plugin-dns/pull/55) aims to fix. |
| --- |

All reactions

Sorry, something went wrong.

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 25, 2021](#issuecomment-927128359)

| [@gjdoornink](https://github.com/gjdoornink) How? |
| --- |

All reactions

Sorry, something went wrong.

[![@gjdoornink](https://avatars.githubusercontent.com/u/6190460?s=80&v=4)](/gjdoornink)

Copy link

### **[gjdoornink](/gjdoornink)** commented [Sep 25, 2021](#issuecomment-927134045)

| [@fenichelar](https://github.com/fenichelar)  The hosts in the forward statement form a pool of load balanced DNS resolvers. How the requests are distributed to the resolvers in the pool is determined by the policy. But regardless of which policy is used, requests for local host names will eventually be sent to any of the resolvers in the pool. This means that a certain amount of requests for local host names will inevitably be sent to one of the cloudflare servers and those requests will fail. In pull request [#55](https://github.com/home-assistant/plugin-dns/pull/55) I aimed to fix a single use case since I did not feel comfortable overhauling the entire structure without first discussing the feasibility of such a change with the original authors. If I had the opportunity to do so, my question would be why dns://127.0.0.1:5553 is part of both the forward statement and the fallback statement and not only part of the fallback statement.  But since you are suggesting a more encompassing change ... :-)  Original corefile, without manually configured DNS servers, but with DHCP assigned DNS server: forward . dns://192.168.0.1 dns://127.0.0.1:5553 {  Your corefile, without manually configured DNS servers and without DHCP assigned DNS server: forward . dns://127.0.0.11:53 dns://127.0.0.1:5553 {  All requests to dns://127.0.0.1:5553 are forwarded to cloudflare servers which cannot resolve hosts in the local network/docker infrastructure. dns://192.168.0.1 is a local resolver that can resolve local hosts and, typically, non-local hosts by forwarding requests to other non-local DNS servers. dns://127.0.0.11:53 is also a local resolver that can resolve local Docker hosts (e.g. containers) and, if so configured through Docker, other local and non-local hosts by forwarding requests to other DNS servers. |
| --- |

All reactions

Sorry, something went wrong.

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 25, 2021](#issuecomment-927135785) ‚Ä¢ edited Loading

| [@gjdoornink](https://github.com/gjdoornink) I'm not following what the issue is.  Your corefile, without manually configured DNS servers and without DHCP assigned DNS server: forward . dns://127.0.0.11:53 dns://127.0.0.1:5553 {  Yes. This is the same way it behaves today and the same way it behaves with your PR. If you don't provide DNS servers to Home Assistant that are capable of resolving local domain names, then it won't be able to resolve local domain names. There is nothing we can do about this. |
| --- |

All reactions

Sorry, something went wrong.

[![@gjdoornink](https://avatars.githubusercontent.com/u/6190460?s=80&v=4)](/gjdoornink)

Copy link

### **[gjdoornink](/gjdoornink)** commented [Sep 25, 2021](#issuecomment-927136599)

| [@fenichelar](https://github.com/fenichelar) What I am trying to express is that the forward statement should not contain DNS resolvers that cannot resolve hosts in the local network, since that inevitably leads to DNS resolve errors and the corresponding problems in Home Assistant. |
| --- |

All reactions

Sorry, something went wrong.

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 25, 2021](#issuecomment-927137174) ‚Ä¢ edited Loading

| [@gjdoornink](https://github.com/gjdoornink)  What I am trying to express is that the forward statement should not contain DNS resolvers that cannot resolve hosts in the local network, since that inevitably leads to DNS resolve errors and the corresponding problems in Home Assistant.  If there are DNS servers that can resolve local domain names, then I agree. But if no DNS servers that can resolve local domain names are known to Home Assistant, then the forward line will contain DNS servers that can't resolve local domains. The only alternative would be to not have any forwarding configured.  Maybe the best way to communicate would be to just let me know what you are thinking for the forwarding line. I'm open to suggestions for my PR. I like your PR but it doesn't solve the problem I am having (I don't want DNS requests to be sent to Cloudflare under any circumstances because the requests are blocked so it just causes noisy logs and slow DNS failures). The issue I am having has been reported by many others as well. So I am trying to solve both of our problems with this PR üòÑ .  ``` {{ if .servers }}   {{ join " " .servers }} {{ else if .locals }}   {{ join " " .locals }} {{ else }}   dns://127.0.0.11:53 dns://127.0.0.1:5553 {{ end }}  ```  How would you change the above? |
| --- |

All reactions

Sorry, something went wrong.

[![@gjdoornink](https://avatars.githubusercontent.com/u/6190460?s=80&v=4)](/gjdoornink)

Copy link

### **[gjdoornink](/gjdoornink)** commented [Sep 25, 2021](#issuecomment-927138287) ‚Ä¢ edited Loading

| [@fenichelar](https://github.com/fenichelar)  It can indeed be difficult to communicate across an ocean and a language barrier :-)  My statement is that dns://127.0.0.11:53 is also a local resolver just as the DHCP assigned DNS server.  Your pull request tries to resolve a different issue than mine, that is clear.  If I were in your shoes, I would reinstate the following line: fallback REFUSED,SERVFAIL,NXDOMAIN . dns://127.0.0.1:5553 and replace: {{ else }} dns://127.0.0.11:53 dns://127.0.0.1:5553 {{ end }} with: {{ else }} dns://127.0.0.11:53 {{ end }}  But I have not tested this, of course :-)  Kind regards, |
| --- |

All reactions

Sorry, something went wrong.

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 25, 2021](#issuecomment-927139632)

| [@gjdoornink](https://github.com/gjdoornink)  ``` fallback REFUSED,SERVFAIL,NXDOMAIN . dns://127.0.0.1:5553  ```  The above line is what is causing my issue. If my DNS server returns any of these errors, then I do not want Home Assistant to try Cloudflare's DNS server. The errors are intentionally returned in many cases (DNSSec failure, domain blocking, domain not found, etc.)  Thoughts on this?  ``` {{ if .servers }}   forward . {{ join " " .servers }} {     except local.hass.io     policy sequential     health_check 1m   } {{ else if .locals }}   forward . {{ join " " .locals }} {     except local.hass.io     policy sequential     health_check 1m   } {{ else }}   forward . dns://127.0.0.11:53 {     except local.hass.io     policy sequential     health_check 1m   }   fallback REFUSED,SERVFAIL,NXDOMAIN . dns://127.0.0.1:5553 {{ end }}  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@gjdoornink](https://avatars.githubusercontent.com/u/6190460?s=80&v=4)](/gjdoornink)

Copy link

### **[gjdoornink](/gjdoornink)** commented [Sep 25, 2021](#issuecomment-927143297)

| [@fenichelar](https://github.com/fenichelar) I doubt that what you want is possible by only changing corefile. IMHO a more sensible approach would be the possibility to configure/override the external fallback DNS servers through some Home Assistant/plugin-dns configuration option, possibly by means of an extension to the 'ha dns' command. But I must admit that such a project is well outside my own selfish interests (and available time) :-) |
| --- |

All reactions

Sorry, something went wrong.

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 25, 2021](#issuecomment-927152536)

| [@gjdoornink](https://github.com/gjdoornink) What is wrong with the corefile I provided?  I feel like we are overcomplicating this. Think about how DNS works in ever other device you have (computers, phones, streaming boxes, game consoles, camera, etc.). If DNS servers are manually configured, those DNS servers are used and no other servers. If DNS servers are provided via DHCP, those DNS servers are used and no other servers. Failover is handled by providing multiple DNS servers manually or via DHCP.  In every other device I have, if the configured DNS server returns `NXDOMAIN`, then the device treats this as the domain doesn't exist (which is what it is supposed to do). Why does Home Assistant not trust the DNS servers response and instead try the DNS request again using Cloudflare's DNS servers? Really, why do we want Home Assistant to have this behavior? I can't think of anything else that works this way?  And this has significant drawbacks:  From my Mac:  ``` $ dig blahblah.google.com  ; <<>> DiG 9.10.6 <<>> blahblah.google.com ;; global options: +cmd ;; Got answer: ;; ->>HEADER<<- opcode: QUERY, status: NXDOMAIN, id: 20954 ;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 1  ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 1432 ;; QUESTION SECTION: ;blahblah.google.com.		IN	A  ;; AUTHORITY SECTION: google.com.		57	IN	SOA	ns1.google.com. dns-admin.google.com. 398687860 900 900 1800 60  ;; Query time: 3 msec ;; SERVER: 10.1.0.1#53(10.1.0.1) ;; WHEN: Sat Sep 25 12:51:52 EDT 2021 ;; MSG SIZE  rcvd: 98  ```  From Home Assistant:  ``` $ dig blahblah.google.com  ; <<>> DiG 9.16.20 <<>> blahblah.google.com ;; global options: +cmd ;; Got answer: ;; ->>HEADER<<- opcode: QUERY, status: NXDOMAIN, id: 62546 ;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 1  ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 4096 ; COOKIE: 097bd1bc1d16dcf7 (echoed) ;; QUESTION SECTION: ;blahblah.google.com.		IN	A  ;; AUTHORITY SECTION: google.com.		60	IN	SOA	ns1.google.com. dns-admin.google.com. 398687860 900 900 1800 60  ;; Query time: 48 msec ;; SERVER: 127.0.0.11#53(127.0.0.11) ;; WHEN: Sat Sep 25 12:51:57 EDT 2021 ;; MSG SIZE  rcvd: 140  ```  Both my Mac and Home Assistant are connected to the same network, same switch, same DNS server provided via DHCP. Yet Home Assistant took 16 times as long to determine the domain doesn't exist. And this is with Cloudflare not being blocked by my firewall.  And here is an example for DNSSec failure:  Mac:  ``` $ dig sigfail.verteiltesysteme.net  ; <<>> DiG 9.10.6 <<>> sigfail.verteiltesysteme.net ;; global options: +cmd ;; Got answer: ;; ->>HEADER<<- opcode: QUERY, status: SERVFAIL, id: 56067 ;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1  ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 1432 ;; QUESTION SECTION: ;sigfail.verteiltesysteme.net.	IN	A  ;; Query time: 2 msec ;; SERVER: 10.1.0.1#53(10.1.0.1) ;; WHEN: Sat Sep 25 12:51:26 EDT 2021 ;; MSG SIZE  rcvd: 57  ```  Home Assistant:  ``` $ dig sigfail.verteiltesysteme.net  ; <<>> DiG 9.16.20 <<>> sigfail.verteiltesysteme.net ;; global options: +cmd ;; Got answer: ;; ->>HEADER<<- opcode: QUERY, status: SERVFAIL, id: 27 ;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1  ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 4096 ; COOKIE: c83f04165d38f348 (echoed) ;; QUESTION SECTION: ;sigfail.verteiltesysteme.net.	IN	A  ;; Query time: 280 msec ;; SERVER: 127.0.0.11#53(127.0.0.11) ;; WHEN: Sat Sep 25 12:51:14 EDT 2021 ;; MSG SIZE  rcvd: 69  ```  Home Assistant was 140 times slower.  I only left Cloudflare in the corefile because I wanted to change as little as possible and solve the issue. But I really don't think any DNS server should be hardcoded like that. What other device has hardcoded DNS servers? Personally, I think the config should be:  ``` .:53 {     log {{ if not .debug }}{         class error     }{{ end }}     errors     loop     {{ if .debug }}debug{{ end }}     hosts /config/hosts {         fallthrough     }     template ANY AAAA local.hass.io hassio {         rcode NOERROR     }     mdns     forward . {{ if .servers }}{{ join " " .servers }}{{ else if .locals }}{{ join " " .locals }}{{ else }}dns://127.0.0.11:53{{ end }} {         except local.hass.io         policy sequential         health_check 1m     }     cache 600 }  ```  Which makes Home Assistant behave just like every other device does. I don't understand why we need hardcoded DNS servers. |
| --- |

All reactions

Sorry, something went wrong.

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=40&v=4)](/fenichelar)

`[Remove hardcoded DNS servers](/home-assistant/plugin-dns/pull/56/commits/efa0011b98c849ac0cf21d15bad805a960821d41 "Remove hardcoded DNS servers")`

`[efa0011](/home-assistant/plugin-dns/pull/56/commits/efa0011b98c849ac0cf21d15bad805a960821d41)`

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=40&v=4)](/fenichelar)
[fenichelar](/fenichelar)
changed the title
~~Improve DNS server selection~~
Remove hardcoded DNS servers
[Sep 25, 2021](#event-5360059090)

[![@Zixim](https://avatars.githubusercontent.com/u/7814664?s=80&u=6d1b94162b1cee3cd950aa8f2b82af7b9d618f0a&v=4)](/Zixim)

Copy link

### **[Zixim](/Zixim)** commented [Sep 26, 2021](#issuecomment-927257390) ‚Ä¢ edited Loading

| what would happen if : user is running Home Assistant OS, user hasn't set a DNS server, user isn't using DHCP ?  Requests would go to the Docker embedded server ( dns://127.0.0.11:53 ), right ? Is the docker embedded dns even active in Home Assistant OS ?  I think this might be the reason why the core devs added cloudflare servers.  Any solution to this dns mess shouldn't remove the ultimate fallback, even though in any half-decent network setup this shouldn't ever happen. |
| --- |

All reactions

Sorry, something went wrong.

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 26, 2021](#issuecomment-927260264) ‚Ä¢ edited Loading

| [@Zixim](https://github.com/Zixim)  user is running Home Assistant OS, user hasn't set a DNS server, user isn't using DHCP ? Requests would go to the Docker embedded server ( dns://127.0.0.11:53 ), right ?  Yes  Is the docker embedded dns even active in Home Assistant OS ?  I'm not sure but the way it currently works if no DNS servers are configured manually or with DHCP is that requests are sent to the Docker Embedded DNS server and then Cloudflare. I just removed Cloudflare but kept the rest of the logic essentially the same.  Any solution to this dns mess shouldn't remove the ultimate fallback, even though in any half-decent network setup this shouldn't ever happen.  Can you explain why you think Home Assistant should have a failover DNS server if one is not provided manually or through DHCP? I think DNS requests should fail in this scenario. Does you computer, phone, streaming box, game console, printer, or any other network device have a failover DNS server? Mine don't. Home Assistant is the only device in my network that has a hard coded failover DNS server as far as I know. I truly don't understand why Home Assistant should be any different than every other device. I know making Home Assistant "just work" is an important goal, but Apple has the same goal with their products and neither Macs nor iOS devices have a hard coded failover DNS servers. If DNS doesn't work in your network, none of your devices are going to work. I think Home Assistant not working in this scenario is not only acceptable, it is appropriate.  That being said, I am certainly happy to contribute on a PR that makes failing over to Cloudflare's DNS servers optional. But I am not sure I am familiar enough with supervisor (where the config option would be managed) to try and tackle this on my own. |
| --- |

All reactions

Sorry, something went wrong.

[![@Zixim](https://avatars.githubusercontent.com/u/7814664?s=80&u=6d1b94162b1cee3cd950aa8f2b82af7b9d618f0a&v=4)](/Zixim)

Copy link

### **[Zixim](/Zixim)** commented [Sep 26, 2021](#issuecomment-927264570)

| Can you explain why you think Home Assistant should have a failover DNS server if one is not provided manually or through DHCP?  It *shouldn't* have a failover. I fully agree with your reasoning. My only concern is that this PR might get refused/ignored because it is contrary to what core devs have decided.  That being said, I am certainly happy to contribute on a PR that makes failing over to Cloudflare's DNS servers optional. But I am not sure I am familiar enough with supervisor (where the config option would be managed) to try and tackle this on my own.  Couldn't your logic/PR be extended to add the failover into the corefile ? Much like this part (for port 5553) in the corefile :  ``` .:5553 {     log {{ if not .debug }}{         class error     }{{ end }}     errors     {{ if .debug }}debug{{ end }}     forward . tls://1.1.1.1 tls://1.0.0.1 {         tls_servername cloudflare-dns.com         except local.hass.io         health_check 5m     }     cache 600 }  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@tescophil](https://avatars.githubusercontent.com/u/59442445?s=80&u=7abbc5f7e155e31c3b5830b65eaea3d2103aa199&v=4)](/tescophil)

Copy link

### **[tescophil](/tescophil)** commented [Sep 26, 2021](#issuecomment-927269480)

| For me, Core DNS was always a solution looking for a problem, DNS has worked the same way for decades and does not need 'fixing''  HA should use DNS servers configured by DHCP or the user directly. If none are set, or the ones that are set fail, then HA should just fail. Adding a fallback is just moving a network problem elsewhere and making it more difficult to trace and resolve.  Personally I think hard coded DNS of any kind is a breach of the users privacy and trust and should be removed.  If the core devs believe that there should be a fallback (as I believe they do, having had four requests to change this over the last 12 months rejected), then:  Firstly it should just use plain port 53 unencrypted DNS, not DoT. This is because port 53 DNS requests can easily be redirected to a local/alternate DNS server at the network firewall, this cannot be done with DoT requests as the SSL cert of a local DoT server will not match the requested domain.  Secondly, the fallback server should only be contacted on SERVFAIL, because NXDOMAIN and REFUSED are not errors.  Thirdly, currently if the fallback is blocked, a cascading failure mode occurs. HA gets stuck in a loop sending millions of DNS request to the fallback to the point where all other components become unresponsive. (the fallback for the fallback is the fallback). Clearly if the fallback fails, it's should not be contacted again. |
| --- |

All reactions

Sorry, something went wrong.

[![@Zixim](https://avatars.githubusercontent.com/u/7814664?s=80&u=6d1b94162b1cee3cd950aa8f2b82af7b9d618f0a&v=4)](/Zixim)

Copy link

### **[Zixim](/Zixim)** commented [Sep 26, 2021](#issuecomment-927276758)

| perhaps trying a parallel PR which does nothing more than removing NXDOMAIN and REFUSED from the corefile ? |
| --- |

All reactions

Sorry, something went wrong.

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 26, 2021](#issuecomment-927356676) ‚Ä¢ edited Loading

| [@tescophil](https://github.com/tescophil) [@Zixim](https://github.com/Zixim)  If the core devs believe that there should be a fallback (as I believe they do, having had four requests to change this over the last 12 months rejected), then:  Maybe they do, maybe they don't. At least some of the requests were hostile and just turned into unproductive name calling. I also haven't seen any PRs. Submitting an issue asking a maintainer to do something (particularly in an aggressive tone) and submitting a PR are very different. I'm not trying to point fingers at anyone, I am just saying that I think a productive conversation with the maintainers should be had about this PR before we come to the conclusion that this PR or a variation of it will not be accepted üòÑ.  Secondly, the fallback server should only be contacted on SERVFAIL, because NXDOMAIN and REFUSED are not errors.  perhaps trying a parallel PR which does nothing more than removing NXDOMAIN and REFUSED from the corefile ?  `SERVFAIL` is an expected response when DNSSEC chain verification fails. It should not result in the fallback servers being used either. This is why I completed removed the hardcoded failover for all responses and not just for `NXDOMAIN` and `REFUSED` responses.  Below is an **incomplete** list of potential paths forward:   1. Completely remove the hard coded DNS fallback servers (what this PR currently does). 2. Provide an option to disable the DNS fallback servers (wrap the changes made in this PR behind a new configuration flag). I can't imagine anyone would be against this approach. The only reason I haven't just done this is because I am not familiar enough with the Home Assistant code base to do it. Where are all the places the configuration flag has to be added and documented? But if someone can give me some high level directions, I can start working in it. 3. Only use DNS fallback servers is DNS servers were provided by DHCP. Basic users that use DHCP would have fallback DNS servers. More advanced users could manually set their DNS servers to disable the fallback DNS servers. This is basically option 2 above but uses the manually configured list of DNS servers being present as the configuration flag. Meaning we don't need to add a new configuration flag. I can easily implement this PR if that is what is decided.   Hopefully one of the maintainers can response providing some directions on how they want to proceed. I'm optimistic we can figure this out üòÑ. |
| --- |

 ‚ù§Ô∏è
2
 Zixim and billgertz reacted with heart emoji

All reactions

* ‚ù§Ô∏è
  2 reactions

Sorry, something went wrong.

[![@alexdelprete](https://avatars.githubusercontent.com/u/7027842?s=80&u=7f577acb229619c8dcb799cae5f9f5afb2a48d48&v=4)](/alexdelprete)

Copy link

### **[alexdelprete](/alexdelprete)** commented [Sep 26, 2021](#issuecomment-927377147)

| In 25y of IT experience as a system and network administrator, I never found a server software, or an enterprise sw, or an automation sw in this case, that extends the network configuration of the user/environment in which it runs, by auto-provisioning such an important thing as a FALLBACK DNS server. It's a bad design and practice. If the environment is not properly configured, it is CORRECT that the sw doesn't work, it should simply throw an error. Network configuration should never be decided by an app, it is up to the user/admin to make those choices. If they don't have the skills to decide, it means they're using standard DHCP, and that's it.  Can you simply imagine a WEB SERVER "fallbacking" to a fixed external DNS server? Gosh...it would be considered a serious security violation.  I really can't understand what was the idea behind the fallback enry in that configuration. If some dev could transparently explain what was the logic behind that decision, we could maybe understand better what most people consider a bad implementation.  If the network environment is not properly configured, it is absolutely correct that HA doesn't work. HA should throw an error when it has DNS issues, like properly designed apps/frameworks/enterprise sw do, that's it.  Furthermore, those benchmarks I read about DNS performance in HA would explain a lot of timeout/connection errors we see in HA logs. DNS is a critical service, it should be reliable, fast, efficient. Actual implementation is not at the level of quality we expect from HA.  All this discussion about this DNS/networking architecture is almost surreal... |
| --- |

All reactions

Sorry, something went wrong.

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 26, 2021](#issuecomment-927389872)

| [@alexdelprete](https://github.com/alexdelprete)  If the network environment is not properly configured, it is absolutely correct that HA doesn't work. HA should throw an error when it has DNS issues, like properly designed apps/frameworks/enterprise sw do, that's it.  I think you are bringing up a good point. We need to make sure that Home Assistant logs a clear error message if no DNS servers have been provided via DHCP or manually. It would also be good if Home Assistant logged clear error messages if the health checks to the DNS servers fail. I will dig into what the logs look like today under these scenarios and see if any improvements can be made. |
| --- |

All reactions

Sorry, something went wrong.

[![@billgertz](https://avatars.githubusercontent.com/u/3613249?s=80&u=ce96c04d465ead72d9a4d499f967fbaea6d76d5a&v=4)](/billgertz)

Copy link

### **[billgertz](/billgertz)** commented [Sep 27, 2021](#issuecomment-927741926)

| [@fenichelar](https://github.com/fenichelar)  Agree that this is a good point - I ran into this as I was investigating issues caused by robots aggressively scanning intentionally exposed web servers. Doing due diligence and troubleshooting when I ran into this CloudFlare DoH problem. (Yes it's a problem, as I had made no conscious choice as the Security Architect for this functional requirement). Had to do a lot of digging to realize what was going on. Disturbed as this is neither a configurable item nor is it mentioned in the documentation.  This *must* be documented so that the requirement is known and security administrators will expect this in their logs.  I would hope the developers would allow an option to, um, opt out. If not that then at least *clearly document* what is going on. |
| --- |

All reactions

Sorry, something went wrong.

[![@tescophil](https://avatars.githubusercontent.com/u/59442445?s=80&u=7abbc5f7e155e31c3b5830b65eaea3d2103aa199&v=4)](/tescophil)

Copy link

### **[tescophil](/tescophil)** commented [Sep 27, 2021](#issuecomment-927761921)

| I have had discussions with the devs in the past on this subject, and it boils down to this: They believe that more 'issues' will be raised, that they then have to deal with, if a fallback DNS service is removed.  Implementing a fallback DNS is more common than you would think, and is done by small and large organisations alike. eg. All Google devices (Google Home Hub, Google Speakers Nest Hubs, Chromecast, Android Phones, Nest Thermostats etc.) are all hard coded to use Googles public DNS servers, some as a fallback, and some just ignore any local DNS settings all together.  The difference is when, for example, you block access to Google public DNS on your local network, these devices carry on working without issues using the locally configured DNS. HA does not. Block access to CloudFlair on your local network and HA goes into meltdown, sending out millions of requests until eventually the system becomes overloaded and fails.  IMHO removing this all together would be the best option, but if it has to stay, then at least fix the 'meltdown' issue if access to the fallback is blocked, and/or move away from DoT and use basic DNS on Port 53 which can be easily redirected to a local service. |
| --- |

All reactions

Sorry, something went wrong.

[![@alexdelprete](https://avatars.githubusercontent.com/u/7027842?s=80&u=7f577acb229619c8dcb799cae5f9f5afb2a48d48&v=4)](/alexdelprete)

Copy link

### **[alexdelprete](/alexdelprete)** commented [Sep 27, 2021](#issuecomment-928459354) ‚Ä¢ edited Loading

| They believe that more 'issues' will be raised, that they then have to deal with, if a fallback DNS service is removed.  If that is true, they should implement a configurable option to disable it, leaving it as default (horrible decision). You can't create problems to many people because you "think" you might have more issues. Let these things be configurable, hardcoding these kind of things is really a bad choice, especially for an open-source solution.  Implementing a fallback DNS is more common than you would think, and is done by small and large organisations alike  Sorry but I mentioned enteprise software and apps, not hardware devices designed explicitly to work with cloud. And even in that case, it is bad practice and design. My firewall disables all kind of dns traffic from LAN to WAN. I enforce usage of my local DNS server, had to do it exactly because many bad designed firmware in devices behave like that. But you'll never find a commercial enterprise app with a fallback dns not configurable, because it's an awful design choice.  Block access to CloudFlair on your local network and HA goes into meltdown  My firewall/router (OPNsense) has been configured to block all DNS traffic to the internet, except from the DNS server itself, that that runs on the firewall. HA doesn't meltdown, it works. But I stumbled across the DNS problem because sometimes, only some times, it starts wanting to use the CloudFlare servers, and it can't, so it starts not working. But 95% of the time it works fine. I didn't notice the "millions of queries" issue. What I noticed is that generally, HA is really SLOW in resolving hostnames, because of the awful dns design/implementation. |
| --- |

All reactions

Sorry, something went wrong.

3 hidden items

Load more‚Ä¶

[![@pvizeli](https://avatars.githubusercontent.com/u/15338540?s=40&u=610c2bc2f528d62761ee2792799a85608fd42234&v=4)](/pvizeli)
[pvizeli](/pvizeli)
closed this
[Sep 28, 2021](#event-5372289352)

[![@pvizeli](https://avatars.githubusercontent.com/u/15338540?s=40&u=610c2bc2f528d62761ee2792799a85608fd42234&v=4)](/pvizeli)
[pvizeli](/pvizeli)
mentioned this pull request
[Sep 28, 2021](#ref-pullrequest-1005805267)

[Prevent intermittent DNS failures when DNS server in local network is used.
#55](/home-assistant/plugin-dns/pull/55)
 Closed

[![@Zixim](https://avatars.githubusercontent.com/u/7814664?s=80&u=6d1b94162b1cee3cd950aa8f2b82af7b9d618f0a&v=4)](/Zixim)

Copy link

### **[Zixim](/Zixim)** commented [Sep 28, 2021](#issuecomment-929086537)

| Are there any core maintainers seeing this that can help provide some direction on what we are trying to accomplish with failover?  core maintainer :  That will not solve the main issue which we solved with this.  May we know what is/was the main issue that you solved with this ? |
| --- |

All reactions

Sorry, something went wrong.

[![@alexdelprete](https://avatars.githubusercontent.com/u/7027842?s=80&u=7f577acb229619c8dcb799cae5f9f5afb2a48d48&v=4)](/alexdelprete)

Copy link

### **[alexdelprete](/alexdelprete)** commented [Sep 28, 2021](#issuecomment-929312875) ‚Ä¢ edited Loading

| That will not solve the main issue which we solved with this  May we kindly ask to know what is the "main issue" you tried to solve? Maybe there are better ways to solve it, without creating other issues.  * Open a PR to Supervisor and add an option to disable fallback which marks your system as unsupported and extend it to the API + tests * Create an PR to the developer documentation for having it there * Create an PR to CLI repository for using that options * Create an PR to this repository to get this options in place  So, if we suggest to disable the fallback, explaining why, you ask for all kinds of PR and options to be implemented, but when you implemented the fallback, you didn't provide everything needed to enable/disable it. May I kindly ask why you didn't put that option in first place when you decided for the hard-coded fallback?  Last question: why would a system with a disabled fallback option be considered "unsupported"?  I really hope HA is still an open-source project, because it seems like when users have different opinions vs the official devs, there are too many imposed obstacles to overcome. Collaboration should be the way to pursue, not the opposite.  The DNS implementation of HA is clearly badly designed and inefficient ([@fenichelar](https://github.com/fenichelar) benchmarked it, it is amazingly slow and buggy). We're asking to improve it because we love HA and would like the product to be better than it currently is. I look forward to devs helping us help them realize that there's much to improve regarding DNS. But that doesn't seem the case...  You guys, with all other contributors, made an incredible product, it's a shame that a fundamental functionality of the system is not at the same general level, but the worst thing is you don't even want to discuss about it.  BTW: you also closed [#55](https://github.com/home-assistant/plugin-dns/pull/55) which has nothing to do with [#56](https://github.com/home-assistant/plugin-dns/pull/56), it tackles a totally separate issue (yes, DNS has several issues). |
| --- |

 üëç
2
 billgertz and Zixim reacted with thumbs up emoji

All reactions

* üëç
  2 reactions

Sorry, something went wrong.

[![@alexdelprete](https://avatars.githubusercontent.com/u/7027842?s=80&u=7f577acb229619c8dcb799cae5f9f5afb2a48d48&v=4)](/alexdelprete)

Copy link

### **[alexdelprete](/alexdelprete)** commented [Sep 28, 2021](#issuecomment-929327495) ‚Ä¢ edited Loading

| So, when I block access to CloudFlair on my network, after a few hours I see this:  I don't have that kind of behaviour, but sometimes I have the problem that for some strange reasons HA decides to use cloudflare also for local resolution, and it obviously fails because any DNS lookup to the internet is blocked. See [#55](https://github.com/home-assistant/plugin-dns/pull/55).  This is what I see in the dns logs, with internet dns traffic blocked (default rule in my firewall):  [image](https://user-images.githubusercontent.com/7027842/135115667-821632f2-a68b-4fa4-9b3e-6f73dd24f687.png)  Would love to reproduce the same issue you have... |
| --- |

All reactions

Sorry, something went wrong.

[![@billgertz](https://avatars.githubusercontent.com/u/3613249?s=40&u=ce96c04d465ead72d9a4d499f967fbaea6d76d5a&v=4)](/billgertz)
[billgertz](/billgertz)
mentioned this pull request
[Sep 28, 2021](#ref-issue-1009901228)

[Document Fallback Behaviour and Functional Requirements
home-assistant/home-assistant.io#19511](/home-assistant/home-assistant.io/issues/19511)

Closed

[![@billgertz](https://avatars.githubusercontent.com/u/3613249?s=80&u=ce96c04d465ead72d9a4d499f967fbaea6d76d5a&v=4)](/billgertz)

Copy link

### **[billgertz](/billgertz)** commented [Sep 28, 2021](#issuecomment-929342561) ‚Ä¢ edited Loading

| As you can see from the reference blurb above I'm asking that his behavior and associated functional requirements be documented. As it stands now this is a hidden feature and causing some heartburn and performance issues for some of us.  Let's see if we can get this documented. |
| --- |

 üëÄ
1
 Zixim reacted with eyes emoji

All reactions

* üëÄ
  1 reaction

Sorry, something went wrong.

[![@alexdelprete](https://avatars.githubusercontent.com/u/7027842?s=80&u=7f577acb229619c8dcb799cae5f9f5afb2a48d48&v=4)](/alexdelprete)

Copy link

### **[alexdelprete](/alexdelprete)** commented [Sep 28, 2021](#issuecomment-929344789)

| Let's see if we can get this documented.  I agree that documenting it would be more appropriate, but it wouldn't solve the fundamental issue.  At least we would know the reasons behind the decision to enforce a harcoded fallback without opt-out option. Will be very interesting reading it. |
| --- |

All reactions

Sorry, something went wrong.

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 28, 2021](#issuecomment-929365775)

| [@alexdelprete](https://github.com/alexdelprete) I am able to reproduce the [@tescophil](https://github.com/tescophil) described. Try running `dig blahblahblah.google.com` on HA. You should get an `NXDOMAIN` response from your DNS server, which will cause HA to try Cloudflare. You may also want to try `dig sigfail.verteiltesysteme.net`. Does your local DNS server support DNSSEC? |
| --- |

All reactions

Sorry, something went wrong.

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 28, 2021](#issuecomment-929368143)

| [@pvizeli](https://github.com/pvizeli) Would a PR that changes the Cloudflare DNS servers to UDP instead of TLS be accepted? This would allow the DNS queries to be redirected to a different server while still providing failover like it does today. |
| --- |

All reactions

Sorry, something went wrong.

[![@alexdelprete](https://avatars.githubusercontent.com/u/7027842?s=80&u=7f577acb229619c8dcb799cae5f9f5afb2a48d48&v=4)](/alexdelprete)

Copy link

### **[alexdelprete](/alexdelprete)** commented [Sep 28, 2021](#issuecomment-929382011)

| Does your local DNS server support DNSSEC?  yes, all those green locks you see mean "DNSSEC validated" query. That's AdGuardHome on OPNsense, that acts as LAN DNS server, it then forwards all requests to unbound on OPNsense that is properly configured for DNSSEC, etc. I use AdGuard to filter, and unbound to do the real requests.  [image](https://user-images.githubusercontent.com/7027842/135124465-b2a201ad-ec1c-4d7e-8d25-252e9f09513c.png)  These are the DIG tests:  [image](https://user-images.githubusercontent.com/7027842/135126601-93ab0973-ae82-4df2-a3ae-e5420a9bb86f.png) [image](https://user-images.githubusercontent.com/7027842/135126621-dc280650-e983-4b13-b253-ce2a94d2c6c8.png)  I don't see all those queries... |
| --- |

All reactions

Sorry, something went wrong.

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 28, 2021](#issuecomment-929387569)

| [@alexdelprete](https://github.com/alexdelprete) You won't see the queries because they use TLS. Setup packet logging in your pfSense firewall rules that block TCP port 853 and you should see all of the traffic. |
| --- |

All reactions

Sorry, something went wrong.

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 28, 2021](#issuecomment-929392544) ‚Ä¢ edited Loading

| [@alexdelprete](https://github.com/alexdelprete) [image](https://user-images.githubusercontent.com/3437075/135128878-c1d9311e-22b7-4efb-b058-5867ccbf9951.png)I had to disable the rules because it broke HA, but that is how you can see the traffic HA produces. |
| --- |

All reactions

Sorry, something went wrong.

[![@alexdelprete](https://avatars.githubusercontent.com/u/7027842?s=80&u=7f577acb229619c8dcb799cae5f9f5afb2a48d48&v=4)](/alexdelprete)

Copy link

### **[alexdelprete](/alexdelprete)** commented [Sep 28, 2021](#issuecomment-929395048) ‚Ä¢ edited Loading

| You won't see the queries because they use TLS. Setup packet logging in your pfSense firewall rules that block TCP port 853 and you should see all of the traffic.  I know, I checked for 1.1.1.1 and 1.0.0.1 in the logs, I see no records after the dig.  [image](https://user-images.githubusercontent.com/7027842/135129256-92144c1b-0d3b-4cdc-86cb-99429af54d95.png) |
| --- |

All reactions

Sorry, something went wrong.

[![@frenck](https://avatars.githubusercontent.com/u/195327?s=80&u=c0f88e376380f7a811559aa54d5096a66f6d3488&v=4)](/frenck)

Copy link

Member

### **[frenck](/frenck)** commented [Sep 28, 2021](#issuecomment-929395099)

| This PR has been closed and possible/acceptable guidance has been provided. Meanwhile the discussion goes on and is no longer about the code provided in this PR but slowly becoming a more generic discussion. Please use our community forum or Discord chat for these purposes.  Thanks!  ../Frenck |
| --- |

All reactions

Sorry, something went wrong.

[![@alexdelprete](https://avatars.githubusercontent.com/u/7027842?s=80&u=7f577acb229619c8dcb799cae5f9f5afb2a48d48&v=4)](/alexdelprete)

Copy link

### **[alexdelprete](/alexdelprete)** commented [Sep 28, 2021](#issuecomment-929397277)

| Please use our community forum or Discord chat for these purposes.  Frenck, what's the appropriate discord channel to discuss DNS? |
| --- |

All reactions

Sorry, something went wrong.

[![@frenck](https://avatars.githubusercontent.com/u/195327?s=80&u=c0f88e376380f7a811559aa54d5096a66f6d3488&v=4)](/frenck)

Copy link

Member

### **[frenck](/frenck)** commented [Sep 28, 2021](#issuecomment-929399183)

| depends on what you'd like to discuss, probably helps to ask around on Discord for that matter, not GitHub. |
| --- |

All reactions

Sorry, something went wrong.

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 28, 2021](#issuecomment-929399525) ‚Ä¢ edited Loading

| [@frenck](https://github.com/frenck)  Meanwhile the discussion goes on and is no longer about the code provided in this PR but slowly becoming a more generic discussion.  I am very much still focused on updating this PR.  We are hoping to get an answer to this question: [#56 (comment)](https://github.com/home-assistant/plugin-dns/pull/56#issuecomment-929086537)  Are there any core maintainers seeing this that can help provide some direction on what we are trying to accomplish with failover?  Can you please help us understand? The current failover implementation causes a lot of problems. For example, if internet connectivity is lost, HA slows to a halt on low powered devices because of the constant attempts to establish a TLS connection to Cloudflare. We are trying to understand what the goal of failover is so that this PR can be adjusted accordinly.  Also, can you help with this?  Would a PR that changes the Cloudflare DNS servers to UDP instead of TLS be accepted? This would allow the DNS queries to be redirected to a different server while still providing failover like it does today. |
| --- |

All reactions

Sorry, something went wrong.

[![@frenck](https://avatars.githubusercontent.com/u/195327?s=80&u=c0f88e376380f7a811559aa54d5096a66f6d3488&v=4)](/frenck)

Copy link

Member

### **[frenck](/frenck)** commented [Sep 28, 2021](#issuecomment-929402322)

| I am very much still focused on updating this PR.  Also, can you help with this?  This PR is closed. |
| --- |

 üëé
2
 billgertz and Zixim reacted with thumbs down emoji

All reactions

* üëé
  2 reactions

Sorry, something went wrong.

[![@billgertz](https://avatars.githubusercontent.com/u/3613249?s=80&u=ce96c04d465ead72d9a4d499f967fbaea6d76d5a&v=4)](/billgertz)

Copy link

### **[billgertz](/billgertz)** commented [Sep 28, 2021](#issuecomment-929405296)

| Thanks for the help :-/ |
| --- |

All reactions

Sorry, something went wrong.

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 28, 2021](#issuecomment-929408987)

| [@frenck](https://github.com/frenck) We are all just trying to solve the problems we are facing. Two different PRs were implemented and both closed. When we try to discuss what PR would be accepted, we just get shot down.  We appreciate the small amount of guidance received. But we were told to go do a bunch of software development if we want to solve this problem but when we try to get more guidance, we can't get any information.  If you don't want to have this conversation on GitHub, then can you provide the specific location you want to have it?  I understand there has been some hostility towards HA maintainers about this issue in the past. But that was coming from different people, don't punish us for their behavior. |
| --- |

 üëç
1
 billgertz reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![@frenck](https://avatars.githubusercontent.com/u/195327?s=80&u=c0f88e376380f7a811559aa54d5096a66f6d3488&v=4)](/frenck)

Copy link

Member

### **[frenck](/frenck)** commented [Sep 28, 2021](#issuecomment-929415956)

| [@frenck](https://github.com/frenck) We are all just trying to solve the problems we are facing.  I'm trying to stop notifications and discussions on a closed PR; especially it's no longer discussing the actual code inside this PR. It generates tons of notifications that aren't actionable to any of us.  When we try to discuss what PR would be accepted, we just get shot down.  See: [#56 (review)](https://github.com/home-assistant/plugin-dns/pull/56#pullrequestreview-765166109)  If you don't want to have this conversation on GitHub, then can you provide the specific location you want to have it?  See: [#56 (comment)](https://github.com/home-assistant/plugin-dns/pull/56#issuecomment-929395099)  I understand there has been some hostility towards HA maintainers about this issue in the past. But that was coming from different people, don't punish us for their behavior.  We are not punishing, we don't consider it an issue, but are open for a change as written above. |
| --- |

All reactions

Sorry, something went wrong.

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 28, 2021](#issuecomment-929451477)

| I'm trying to stop notifications and discussions on a closed PR; especially it's no longer discussing the actual code inside this PR  I am trying to discuss the code in this PR. I want to update the code so that it is accepted.  See: [#56](https://github.com/home-assistant/plugin-dns/pull/56) (review)  Can you add any more details to this comment? Specifically:  That will not solve the main issue which we solved with this. If you want this then you need to do the following:  What issue?  Open a PR to Supervisor and add an option to disable fallback which marks your system as unsupported and extend it to the API + tests  What should be config flag be called? What should its type be?  Create an PR to the developer documentation for having it there  Okay  Create an PR to CLI repository for using that options  Okay  Create an PR to this repository to get this options in place  What specifically should this flag do? Remove the Cloudflare DNS servers from the forward line, failover line, or both?  See: [#56](https://github.com/home-assistant/plugin-dns/pull/56) (comment)  Does that mean Discord is the right place?  We are not punishing, we don't consider it an issue, but are open for a change as written above.  Are you saying that when Home Assistant losses internet connectivity the constant flood of TCP connection attempts slowing down HA is expected and therefore isn't an issue, is an unrelated issue, or is not something you have been able to reproduce? |
| --- |

All reactions

Sorry, something went wrong.

[![@alexdelprete](https://avatars.githubusercontent.com/u/7027842?s=80&u=7f577acb229619c8dcb799cae5f9f5afb2a48d48&v=4)](/alexdelprete)

Copy link

### **[alexdelprete](/alexdelprete)** commented [Sep 28, 2021](#issuecomment-929455992) ‚Ä¢ edited Loading

| I'm trying to stop notifications and discussions on a closed PR  You can reopen it. If somebody decided to close it because there's no will for a serious discussion, doesn't mean it's a valid reason to close a PR and then use the closing as a reason not to discuss. Looks like a good method to you, but it's clear it's a method to avoid discussions.  we don't consider it an issue  That's the real issue that is neither logic nor understandable: can you, Pascal, or someone else explain why it's not an issue for you and it's an issue for many other people? We provided several arguments for which it IS an issue, but haven't read any serious factual argument from the ones who close PRs because they don't consider this an issue.  You might as well close any possibility to open a PR for the DNS plugin, would avoid these discussions entirely. :)  but are open for a change as written above.  That is not true: Pascal said that even following those guidelines, the systems that opt-out would be considered "unsupported". The reason for this? Not discussed, undisclosed. |
| --- |

 ‚ù§Ô∏è
2
 fenichelar and billgertz reacted with heart emoji

All reactions

* ‚ù§Ô∏è
  2 reactions

Sorry, something went wrong.

[![@alexdelprete](https://avatars.githubusercontent.com/u/7027842?s=80&u=7f577acb229619c8dcb799cae5f9f5afb2a48d48&v=4)](/alexdelprete)

Copy link

### **[alexdelprete](/alexdelprete)** commented [Sep 28, 2021](#issuecomment-929473626)

| Are you saying that when Home Assistant losses internet connectivity the constant flood of TCP connection attempts slowing down HA is expected and therefore isn't an issue, is an unrelated issue, or is not something you have been able to reproduce?  It's not an issue for them, full stop. They don't care if it's an issue for other users. The PR is closed, so you can't even discuss, because...it's closed, in agreement with who opened it. ;) |
| --- |

 üëç
2
 billgertz and Zixim reacted with thumbs up emoji

All reactions

* üëç
  2 reactions

Sorry, something went wrong.

[![@jjvandenberg](https://avatars.githubusercontent.com/u/66120846?s=80&v=4)](/jjvandenberg)

### This comment has been minimized.

[Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fpull%2F56)

[![@Zixim](https://avatars.githubusercontent.com/u/7814664?s=80&u=6d1b94162b1cee3cd950aa8f2b82af7b9d618f0a&v=4)](/Zixim)

Copy link

### **[Zixim](/Zixim)** commented [Sep 28, 2021](#issuecomment-929549881)

| also, stop mentioning Them, you'll get muzzled. Ivory tower developing & gatekeeping FTW... |
| --- |

All reactions

Sorry, something went wrong.

[![@frenck](https://avatars.githubusercontent.com/u/195327?s=80&u=c0f88e376380f7a811559aa54d5096a66f6d3488&v=4)](/frenck)

Copy link

Member

### **[frenck](/frenck)** commented [Sep 28, 2021](#issuecomment-929552979)

| I'm happy to discuss anything, all I asked was to stop discussing this on a closed PR.  Yet, seems like that is ignored completely and additionally some snarky comments need to be made, which is really sad and doesn't motivate me at all...  Locking down this PR as resolved/heated/off-topic. |
| --- |

All reactions

Sorry, something went wrong.

[![@home-assistant](https://avatars.githubusercontent.com/u/13844975?s=40&v=4)](/home-assistant)
[home-assistant](/home-assistant)
locked as **off-topic** and limited conversation to collaborators
[Sep 28, 2021](#event-5376084193)

[![@balloob](https://avatars.githubusercontent.com/u/1444314?s=80&v=4)](/balloob)

Copy link

Member

### **[balloob](/balloob)** commented [Sep 28, 2021](#issuecomment-929700917)

| We make the decisions we do because with Home Assistant OS we are offering a solutions to users that works, for users that want to focus on about home automation, not system administration.  We used to get a ton of issues with people incorrectly configuring their DNS and then Home Assistant stops working. All those issues disappeared when we did this.  If you're interested in doing DNS stuff, probably Home Assistant OS is not for you. Consider using a Supervised or Container installation.  Now Pascal did mention a way the forwarding can be resolved, but that people in this PR consider too much work nor do commenters agree with it being marked as unsupported. You can't have it all. Stray off the easy path, accept the consequences. If you want it to remain supported, it means it becomes *our* problem, because we are supporting it then. We are not interested in taking up any extra work that a) slows down any future improvements and b) benefits only a minority of our users.  And as usual, any topic about DNS ends up with insults towards us, so it's closed.  We are not interested in further discussing this topic. |
| --- |

All reactions

Sorry, something went wrong.

[Sign up for free](/join?source=comment-repo)
**to subscribe to this conversation on GitHub**.
Already have an account?
[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fpull%2F56).

Reviewers

[![@pvizeli](https://avatars.githubusercontent.com/u/15338540?s=40&v=4)](/pvizeli) [pvizeli](/pvizeli)

pvizeli requested changes

Assignees

No one assigned

Labels

[cla-signed](/home-assistant/plugin-dns/labels/cla-signed)

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

11 participants

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=52&v=4)](/fenichelar) [![@homeassistant](https://avatars.githubusercontent.com/u/23041403?s=52&v=4)](/homeassistant) [![@gjdoornink](https://avatars.githubusercontent.com/u/6190460?s=52&v=4)](/gjdoornink) [![@Zixim](https://avatars.githubusercontent.com/u/7814664?s=52&v=4)](/Zixim) [![@tescophil](https://avatars.githubusercontent.com/u/59442445?s=52&v=4)](/tescophil) [![@alexdelprete](https://avatars.githubusercontent.com/u/7027842?s=52&v=4)](/alexdelprete) [![@billgertz](https://avatars.githubusercontent.com/u/3613249?s=52&v=4)](/billgertz) [![@frenck](https://avatars.githubusercontent.com/u/195327?s=52&v=4)](/frenck) [![@jjvandenberg](https://avatars.githubusercontent.com/u/66120846?s=52&v=4)](/jjvandenberg) [![@balloob](https://avatars.githubusercontent.com/u/1444314?s=52&v=4)](/balloob) [![@pvizeli](https://avatars.githubusercontent.com/u/15338540?s=52&v=4)](/pvizeli)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_215c47d9_20250119_111055.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fpull%2F55)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fpull%2F55)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=home-assistant%2Fplugin-dns)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[home-assistant](/home-assistant)
/
**[plugin-dns](/home-assistant/plugin-dns)**
Public

* [Notifications](/login?return_to=%2Fhome-assistant%2Fplugin-dns) You must be signed in to change notification settings
* [Fork
  15](/login?return_to=%2Fhome-assistant%2Fplugin-dns)
* [Star
   21](/login?return_to=%2Fhome-assistant%2Fplugin-dns)

* [Code](/home-assistant/plugin-dns)
* [Issues
  3](/home-assistant/plugin-dns/issues)
* [Pull requests
  0](/home-assistant/plugin-dns/pulls)
* [Actions](/home-assistant/plugin-dns/actions)
* [Security](/home-assistant/plugin-dns/security)
* [Insights](/home-assistant/plugin-dns/pulse)

Additional navigation options

* [Code](/home-assistant/plugin-dns)
* [Issues](/home-assistant/plugin-dns/issues)
* [Pull requests](/home-assistant/plugin-dns/pulls)
* [Actions](/home-assistant/plugin-dns/actions)
* [Security](/home-assistant/plugin-dns/security)
* [Insights](/home-assistant/plugin-dns/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fhome-assistant%2Fplugin-dns%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fhome-assistant%2Fplugin-dns%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Prevent intermittent DNS failures when DNS server in local network is used. #55

 Closed

[gjdoornink](/gjdoornink)
wants to merge
1
commit into
[home-assistant:master](/home-assistant/plugin-dns/tree/master "home-assistant/plugin-dns:master")
from
gjdoornink:issue/issue-dns-forward-optional-external

 Closed

# [Prevent intermittent DNS failures when DNS server in local network is used.](#top) #55

[gjdoornink](/gjdoornink)
wants to merge
1
commit into
[home-assistant:master](/home-assistant/plugin-dns/tree/master "home-assistant/plugin-dns:master")
from
gjdoornink:issue/issue-dns-forward-optional-external

[Conversation
8](/home-assistant/plugin-dns/pull/55)
[Commits
1](/home-assistant/plugin-dns/pull/55/commits)
[Checks
0](/home-assistant/plugin-dns/pull/55/checks)
[Files changed](/home-assistant/plugin-dns/pull/55/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![gjdoornink](https://avatars.githubusercontent.com/u/6190460?s=60&v=4)](/gjdoornink)

Copy link

### @gjdoornink **[gjdoornink](/gjdoornink)** commented [Sep 23, 2021](#issue-1005805267) ‚Ä¢ edited Loading

Since the default forward policy is configured for sequential load balancing do not use dns://127.0.0.1:5553 when a DNS server is specified either through DHCP ('.locals') or the local configuration ('.servers') since this will result in intermittent DNS lookup errors for hosts in the local network that are only known through the specified DNS servers.

To expand a bit, when a DNS server is specified either through DHCP ('.locals') or the local configuration ('.servers') the forward line will become something like: forward . 'dns://192.168.0.1 dns://127.0.0.1:5553'.

This means that DNS lookups for hosts in the local network (192.168.0.0/24) will, depending on the circumstances, be forwarded either 192.168.0.1 or 127.0.0.1:5553. When the DNS lookup for a host in the local network is forwarded to 127.0.0.1:5553, the lookup will fail.

edit: I had .locals and .servers the wrong way around, this is now fixed in the text above.

Sorry, something went wrong.

 üëç
3
 alexdelprete, fenichelar, and Zixim reacted with thumbs up emoji

All reactions

* üëç
  3 reactions

[![@gjdoornink](https://avatars.githubusercontent.com/u/6190460?s=40&v=4)](/gjdoornink)

`[Since the policy is configured for sequential load balancing do not u‚Ä¶](/home-assistant/plugin-dns/pull/55/commits/ad16ddb7f06c61c5676ab73a0bbf82ee50dd8ea1 "Since the policy is configured for sequential load balancing do not use dns ://127.0.0.1:5553 when a DNS server is specified either through DHCP ('.servers') or the local configuration ('.locals') since this will result in intermittent DNS lookup errors for hosts in the local network that are only known through the specified DNS servers.")`
 ‚Ä¶

`[ad16ddb](/home-assistant/plugin-dns/pull/55/commits/ad16ddb7f06c61c5676ab73a0bbf82ee50dd8ea1)`

```
‚Ä¶se dns ://127.0.0.1:5553 when a DNS server is specified either through DHCP ('.servers') or the local configuration ('.locals') since this will result in intermittent DNS lookup errors for hosts in the local network that are only known through the specified DNS servers.
```

[![@homeassistant](https://avatars.githubusercontent.com/u/23041403?s=80&u=47513de918772e42a8a77298dd8714123c97321c&v=4)](/homeassistant)

Copy link

### **[homeassistant](/homeassistant)** commented [Sep 23, 2021](#issuecomment-926119487)

| Hi [@gjdoornink](https://github.com/gjdoornink),  It seems you haven't yet signed a CLA. Please do so [here](https://home-assistant.io/developers/cla_sign_start/?pr=home-assistant/plugin-dns#55).  Once you do that we will be able to review and accept this pull request.  Thanks! |
| --- |

All reactions

Sorry, something went wrong.

[![@homeassistant](https://avatars.githubusercontent.com/u/23041403?s=40&u=47513de918772e42a8a77298dd8714123c97321c&v=4)](/homeassistant)
[homeassistant](/homeassistant)
added
[cla-needed](/home-assistant/plugin-dns/labels/cla-needed)
[cla-signed](/home-assistant/plugin-dns/labels/cla-signed)
and removed
[cla-needed](/home-assistant/plugin-dns/labels/cla-needed)
labels
[Sep 23, 2021](#event-5352192516)

[![@gjdoornink](https://avatars.githubusercontent.com/u/6190460?s=40&v=4)](/gjdoornink)
[gjdoornink](/gjdoornink)
mentioned this pull request
[Sep 23, 2021](#ref-issue-774861780)

[Not resolving local host names
#20](/home-assistant/plugin-dns/issues/20)

Closed

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

### **[fenichelar](/fenichelar)** commented [Sep 23, 2021](#issuecomment-926229613)

| [@gjdoornink](https://github.com/gjdoornink) [@alexdelprete](https://github.com/alexdelprete)  I thought `.servers` was the list of manually configured DNS servers and `.locals` was the list of DHCP configured DNS servers? Do I have that backwards?  ``` {{ join " " .servers }} {{ if len .locals | eq 0 }}   dns://127.0.0.11 {{ else }}   {{ join " " .locals }} {{ end }} {{ if and (len .servers | eq 0) (len .locals | eq 0) }}   dns://127.0.0.1:5553 {{ end }}  ```  I am a bit confused by the 3rd line above. Why is `dns://127.0.0.11` being added if there are no local servers configured?  Correct me if I am wrong, but it looks like this will still result in the Cloudflare DNS servers being used if any of these errors are returned by the DHCP/locally configured DNS server: `REFUSED,SERVFAIL,NXDOMAIN`.  Maybe it makes sense to have the DNS `mode` configurable:   * `dhcp` - Use DHCP provided DNS servers only * `manual` - Use manually configured DNS servers only * `cloudflare` - Use Cloudflare DNS servers only * `automatic` (default) - Use manually configured DNS servers, DHCP provided DNS servers, and Cloudflare DNS servers (current behavior before this PR)   I run my own DNS resolver and use DNS based blocking. DNS queries sent to external servers are blocked. Home Assistant constantly tries to connect to Cloudflare and fails. Even with the change in this PR, Home Assistant would still try to connect to Cloudflare if my DNS server returned `NXDOMAIN`. So I would run `dhcp` because my DHCP server returns my DNS server.  This would also benefit people who want the privacy benefits of using Cloudflare's DNS server instead of their ISP's DNS server. They could simply set the mode to `cloudflare` and **all** requests would be securely be sent to Cloudflare.  ``` {{if .mode | eq "automatic"}} forward . {{ join " " .servers }} {{ join " " .locals }} dns://127.0.0.1:5553 {     except local.hass.io     policy sequential     health_check 1m } fallback REFUSED,SERVFAIL,NXDOMAIN . dns://127.0.0.1:5553 {{end}}  {{if .mode | eq "cloudflare"}} forward . dns://127.0.0.1:5553 {     except local.hass.io     policy sequential     health_check 1m } {{end}}  {{if .mode | eq "manual"}} forward . {{ join " " .servers }} {     except local.hass.io     policy sequential     health_check 1m } {{end}}  {{if .mode | eq "dhcp"}} forward . {{ join " " .locals }} {     except local.hass.io     policy sequential     health_check 1m } {{end}}  ```  I removed the `dns://127.0.0.11` line from the `automatic` section because I don't see any reason for it to be there. But it could put back if it serves a purpose.  Thoughts? |
| --- |

All reactions

Sorry, something went wrong.

[![@gjdoornink](https://avatars.githubusercontent.com/u/6190460?s=80&v=4)](/gjdoornink)

Copy link

Author

### **[gjdoornink](/gjdoornink)** commented [Sep 24, 2021](#issuecomment-926907470) ‚Ä¢ edited Loading

| [@fenichelar](https://github.com/fenichelar)  I thought .servers was the list of manually configured DNS servers and .locals was the list of DHCP configured DNS servers? Do I have that backwards?  No, it seems I had it backwards, sorry about that :-)  I am a bit confused by the 3rd line above. Why is dns://127.0.0.11 being added if there are no local servers configured?  Since I had it backwards, dns://127.0.0.11 is only added if no DNS server is assigned through DHCP.  Maybe it makes sense to have the DNS mode configurable  It might, but the purpose of this patch is only to fix the intermittent failures of resolving hosts in the local network. IMHO other changes are better served as a separate issue or pull request.  I removed the dns://127.0.0.11 line from the automatic section because I don't see any reason for it to be there. But it could put back if it serves a purpose.  I do assume there was and is a reason and a purpose and, after going through a lot of the related discussions, I assume it has to do with ensuring a fallback is always present.  Kind regards, |
| --- |

All reactions

Sorry, something went wrong.

[![gjdoornink](https://avatars.githubusercontent.com/u/6190460?s=60&v=4)](/gjdoornink)

**[gjdoornink](/gjdoornink)**
commented
[Sep 24, 2021](#pullrequestreview-763466683)

 [View reviewed changes](/home-assistant/plugin-dns/pull/55/files/ad16ddb7f06c61c5676ab73a0bbf82ee50dd8ea1)

Copy link

Author

### @gjdoornink **[gjdoornink](/gjdoornink)** left a comment ‚Ä¢ edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

The commit message has ('.locals') and ('.servers') the wrong way around.

Sorry, something went wrong.

All reactions

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

### **[fenichelar](/fenichelar)** commented [Sep 24, 2021](#issuecomment-926951104)

| I do assume there was and is a reason and a purpose and, after going through a lot of the related discussions, I assume it has to do with ensuring a fallback is always present.  I'm not sure. I believe `dns://127.0.0.11` would just point to the block the forward statement is already in. I feel like this might be a bug. |
| --- |

All reactions

Sorry, something went wrong.

[![@gjdoornink](https://avatars.githubusercontent.com/u/6190460?s=80&v=4)](/gjdoornink)

Copy link

Author

### **[gjdoornink](/gjdoornink)** commented [Sep 24, 2021](#issuecomment-926957702)

| I'm not sure. I believe `dns://127.0.0.11` would just point to the block the forward statement is already in. I feel like this might be a bug.  I believe that 127.0.0.11 is the Embedded DNS Server of Docker. |
| --- |

All reactions

Sorry, something went wrong.

[![@gjdoornink](https://avatars.githubusercontent.com/u/6190460?s=40&v=4)](/gjdoornink)
[gjdoornink](/gjdoornink)
mentioned this pull request
[Sep 25, 2021](#ref-pullrequest-1006881703)

[Remove hardcoded DNS servers
#56](/home-assistant/plugin-dns/pull/56)
 Closed

[![@pvizeli](https://avatars.githubusercontent.com/u/15338540?s=80&u=610c2bc2f528d62761ee2792799a85608fd42234&v=4)](/pvizeli)

Copy link

Member

### **[pvizeli](/pvizeli)** commented [Sep 28, 2021](#issuecomment-928997475)

| See [#56 (review)](https://github.com/home-assistant/plugin-dns/pull/56#pullrequestreview-765166109) |
| --- |

All reactions

Sorry, something went wrong.

[![@pvizeli](https://avatars.githubusercontent.com/u/15338540?s=40&u=610c2bc2f528d62761ee2792799a85608fd42234&v=4)](/pvizeli)
[pvizeli](/pvizeli)
closed this
[Sep 28, 2021](#event-5372292731)

[![@gjdoornink](https://avatars.githubusercontent.com/u/6190460?s=80&v=4)](/gjdoornink)

Copy link

Author

### **[gjdoornink](/gjdoornink)** commented [Sep 28, 2021](#issuecomment-929022740)

| [@pvizeli](https://github.com/pvizeli)  IMHO you are missing the point of this pull request. This pull request is not about preventing Home Assistant from using external DNS resolvers. This pull request is about the fact that using a local DNS resolver together with an external DNS resolver in the .forward statement will eventually result in DNS resolve errors of the hosts in the local network. This is caused due to the fact that .forward is not about defining fallback servers, but about defining a load-balancing pool. Implementing the 'solution' you described in your comment in pull request [#56](https://github.com/home-assistant/plugin-dns/pull/56) does not resolve the issue this PR aims to fix. I would kindly ask you to reconsider your position |
| --- |

 üëç
6
 alexdelprete, billgertz, keytotime, mario-tux, Jordi1990, and blubbel42 reacted with thumbs up emoji

All reactions

* üëç
  6 reactions

Sorry, something went wrong.

[![@alexdelprete](https://avatars.githubusercontent.com/u/7027842?s=40&v=4)](/alexdelprete)
[alexdelprete](/alexdelprete)
mentioned this pull request
[Nov 9, 2021](#ref-issue-1045593958)

[HomeAssistant CoreDNS timeout settings
bentasker/HomeAssistantAddons#3](/bentasker/HomeAssistantAddons/issues/3)

Open

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fpull%2F55)

Reviewers

No reviews

Assignees

No one assigned

Labels

[cla-signed](/home-assistant/plugin-dns/labels/cla-signed)

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

4 participants

[![@gjdoornink](https://avatars.githubusercontent.com/u/6190460?s=52&v=4)](/gjdoornink) [![@homeassistant](https://avatars.githubusercontent.com/u/23041403?s=52&v=4)](/homeassistant) [![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=52&v=4)](/fenichelar) [![@pvizeli](https://avatars.githubusercontent.com/u/15338540?s=52&v=4)](/pvizeli)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.co_86065a3c_20250119_130725.html ===

[Skip to content](#start-of-content)

GitHub Copilot is now available for free.
[Learn more](https://github.com/features/copilot/?utm_source=github&utm_medium=banner&utm_campaign=copilotfree-bannerheader)

## Navigation Menu

Toggle navigation

[Sign in](/login)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F&source=header-home)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

# Build and ship software on a single, collaborative platform

Join the world‚Äôs most widely adopted AI-powered developer platform.

Enter your emailSign up for GitHub[Try GitHub Copilot](/features/copilot)
## GitHub features

A demonstration animation of a code editor using GitHub Copilot Chat, where the user requests GitHub Copilot to refactor duplicated logic and extract it into a reusable function for a given code snippet.

CodePlanCollaborateAutomateSecure

Build code quickly and more securely with GitHub Copilot embedded throughout your workflows.

## GitHub is used by

![Shopify](https://github.githubassets.com/assets/shopify-3fed3011ac81.svg)![EY](https://github.githubassets.com/assets/ey-7434b194d68c.svg)![Figma](https://github.githubassets.com/assets/figma-04e0038c0fef.svg)![Duolingo](https://github.githubassets.com/assets/duolingo-ea3a0aa56fa5.svg)![New York Times](https://github.githubassets.com/assets/newyorktimes-9d76d7f338f5.svg)![Mercado Libre](https://github.githubassets.com/assets/mercado-libre-762f679589f2.svg)![American Airlines](https://github.githubassets.com/assets/american-airlines-a2b13c8fbe08.svg)![Ford](https://github.githubassets.com/assets/ford-2fb5195a4c7c.svg)![Mercedes Benz](https://github.githubassets.com/assets/mercedes-b9190458c80e.svg)![Soci√©t√© G√©n√©rale](https://github.githubassets.com/assets/societe-generale-7a3414490494.svg)![Vodafone](https://github.githubassets.com/assets/vodafone-6e0f322de6cd.svg)![Philips](https://github.githubassets.com/assets/philips-8087a5f95f5c.svg)![SAP](https://github.githubassets.com/assets/sap-ea7dcd02e37d.svg)![Infosys](https://github.githubassets.com/assets/infosys-7587455de0bd.svg)![Spotify](https://github.githubassets.com/assets/spotify-591ecb426c1e.svg)![Shopify](https://github.githubassets.com/assets/shopify-3fed3011ac81.svg)![EY](https://github.githubassets.com/assets/ey-7434b194d68c.svg)![Figma](https://github.githubassets.com/assets/figma-04e0038c0fef.svg)![Duolingo](https://github.githubassets.com/assets/duolingo-ea3a0aa56fa5.svg)![New York Times](https://github.githubassets.com/assets/newyorktimes-9d76d7f338f5.svg)![Mercado Libre](https://github.githubassets.com/assets/mercado-libre-762f679589f2.svg)![American Airlines](https://github.githubassets.com/assets/american-airlines-a2b13c8fbe08.svg)![Ford](https://github.githubassets.com/assets/ford-2fb5195a4c7c.svg)![Mercedes Benz](https://github.githubassets.com/assets/mercedes-b9190458c80e.svg)![Soci√©t√© G√©n√©rale](https://github.githubassets.com/assets/societe-generale-7a3414490494.svg)![Vodafone](https://github.githubassets.com/assets/vodafone-6e0f322de6cd.svg)![Philips](https://github.githubassets.com/assets/philips-8087a5f95f5c.svg)![SAP](https://github.githubassets.com/assets/sap-ea7dcd02e37d.svg)![Infosys](https://github.githubassets.com/assets/infosys-7587455de0bd.svg)![Spotify](https://github.githubassets.com/assets/spotify-591ecb426c1e.svg)
## Accelerate performance

With GitHub Copilot embedded throughout the platform, you can simplify your toolchain, automate tasks, and improve the developer experience.

![](https://github.githubassets.com/assets/particles-de1dd20f3008.png)A Copilot chat window with extensions enabled. The user inputs the @ symbol to reveal a list of five Copilot Extensions. @Sentry is selected from the list, which shifts the window to a chat directly with that extension. There are three sample prompts at the bottom of the chat window, allowing the user to Get incident information, Edit status on incident, or List the latest issues. The last one is activated to send the prompt: @Sentry List the latest issues. The extension then lists several new issues and their metadata.
### Work 55% faster.1 Increase productivity with AI-powered coding assistance, including code completion, chat, and more.

1[Survey: The AI wave continues to grow on software development teams, 2024.](https://github.blog/news-insights/research/survey-ai-wave-grows/)

[Explore GitHub Copilot](/features/copilot)![Duolingo](https://github.githubassets.com/assets/logo-duolingo-14477f9e54a6.svg)

Duolingo boosts developer speed by 25% with GitHub Copilot

[Read customer story](/customer-stories/duolingo)![Gartner](https://github.githubassets.com/assets/logo-gartner-aa8c2e452b64.svg)

2024 Gartner¬Æ Magic Quadrant‚Ñ¢ for AI Code Assistants

[Read report](https://www.gartner.com/doc/reprints?id=1-2IKO4MPE&ct=240819&st=sb)![](https://github.githubassets.com/assets/accordion-1-ce487d44c0bf.webp)![](https://github.githubassets.com/assets/accordion-2-730955545f07.webp)![](https://github.githubassets.com/assets/accordion-3-52ca331d22ea.webp)![](https://github.githubassets.com/assets/accordion-4-a26744b70ff7.webp)
### Automate any workflow

Optimize your process with simple and secured CI/CD.

A list of workflows displays a heading ‚Äò45,167 workflow runs‚Äô at the top. Below are five rows of completed workflows accompanied by their completion time and their duration formatted in minutes and seconds.[Discover GitHub Actions](/features/actions)
### Get up and running in seconds

Start building instantly with a comprehensive dev environment in the cloud.

A GitHub Codespaces setup for the landing page of a game called OctoInvaders. On the left is a code editor with some HTML and Javascript files open. On the right is a live render of the page. In front of this split editor window is a screenshot of two active GitHub Codespaces environments with their branch names and a button to ‚ÄòCreate codespace on main.‚Äô[Check out GitHub Codespaces](/features/codespaces)
### Build on the go

Manage projects and chat with GitHub Copilot from anywhere.

Two smartphone screens side by side. The left screen shows a Notification inbox, listing issues and pull requests from different repositories like TensorFlow and GitHub‚Äôs OctoArcade octoinvaders. The right screen shows a new conversation in GitHub Copilot chat.[Download GitHub Mobile](/mobile)
### Integrate the tools you love

Sync with 17,000+ integrations and a growing library of Copilot Extensions.

A grid of fifty app tiles displays logos for integrations and extensions for companies like Stripe, Slack, and Docker. The tiles extend beyond the bounds of the image to indicate a wide array of apps. [Visit GitHub Marketplace](/marketplace)
## Built-in application security where found means fixed

Use AI to find and fix vulnerabilities‚Äîfreeing your teams to ship more secure software faster.

![](https://github.githubassets.com/assets/particles-de1dd20f3008.png)
### Apply fixes in seconds. Spend less time fixing vulnerabilities and more time building features with Copilot Autofix.

[Explore GitHub Advanced Security](/enterprise/advanced-security)![Copilot Autofix identifies vulnerable code and provides an explanation, together with a secure code suggestion to remediate the vulnerability.](https://github.githubassets.com/assets/hero-64ecd484397f.webp)

Solve security debt. Leverage AI-assisted security campaigns to reduce application vulnerabilities and zero-day attacks.

[Discover security campaigns](/enterprise/advanced-security)![A security campaign screen displays the campaign‚Äôs progress bar with 97% completed of 701 alerts. A total of 23 alerts are left with 13 in progress, and the campaign started 20 days ago. The status below shows that there are 7 days left in the campaign with a due date of November 15, 2024.](https://github.githubassets.com/assets/pillar-1-dd667a921f55.webp)

Dependencies you can depend on. Update vulnerable dependencies with supported fixes for breaking changes.

[Learn about Dependabot](/features/security/software-supply-chain)![List of dependencies defined in a requirements .txt file.](https://github.githubassets.com/assets/pillar-2-ff69e872920a.webp)

Your secrets, your business: protected.  Detect, prevent, and remediate leaked secrets across your organization.

[Read about secret scanning](/features/security/code)![GitHub push protection confirms and displays an active secret, and blocks the push.](https://github.githubassets.com/assets/pillar-3-0a063e2daae2.webp)
### 7x fastervulnerability fixes with GitHub2

2This 7X times factor is based on data from the industry‚Äôs longest running analysis of fix rates Veracode State of Software Security 2023, which cites the average time to fix 50% of flaws as 198 days vs. GitHub‚Äôs fix rates of 72% of flaws with in 28 days which is at a minimum of 7X faster when compared.

### 90% coverage[of alert types in all supported languages with Copilot Autofix](https://docs.github.com/en/code-security/code-scanning/managing-your-code-scanning-configuration/codeql-query-suites)

## Work together, achieve more

Collaborate with your teams, use management tools that sync with your projects, and code from anywhere‚Äîall on a single, integrated platform.

![](https://github.githubassets.com/assets/particles-de1dd20f3008.png)![A project management dashboard showing tasks for the ‚ÄòOctoArcade Invaders‚Äô project, with tasks grouped under project phase categories like ‚ÄòPrototype,‚Äô ‚ÄòBeta,‚Äô and ‚ÄòLaunch‚Äô in a table layout. One of the columns displays sub-issue progress bars with percentages for each issue.](https://github.githubassets.com/assets/hero-961322485af6.webp)
### Your workflows, your way. Plan effectively with an adaptable spreadsheet that syncs with your work.

[Jump into GitHub Projects](/features/issues)‚Äú
> It helps us onboard new software engineers and get them productive right away. We have all our source code, issues, and pull requests in one place... GitHub is a complete platform that frees us from menial tasks and enables us to do our best work.

Fabian FaulhaberApplication manager at Mercedes-Benz

![](https://github.githubassets.com/assets/accordion-1-38ad6b6d1b20.webp)![](https://github.githubassets.com/assets/accordion-2-c0a62cfc31a1.webp)![](https://github.githubassets.com/assets/accordion-3-5d5d222f1830.webp)![](https://github.githubassets.com/assets/accordion-4-7abff9233556.webp)
### Keep track of your tasks

Create issues and manage projects with tools that adapt to your code.

Display of task tracking within an issue, showing the status of related sub-issues and their connection to the main issue.[Explore GitHub Issues](/features/issues)
### Share ideas and ask questions

Create space for open-ended conversations alongside your project.

A GitHub Discussions thread where a GitHub user suggests a power-up idea involving Hubot revealing a path and protecting Mona. The post has received 5 upvotes and several reactions. Below, three other users add to the discussion, suggesting Hubot could provide different power-ups depending on levels and appreciating the collaboration idea.[Discover GitHub Discussions](/features/discussions)
### Review code changes together

Create review processes that improve code quality and fit neatly into your workflow.

Two code review approvals by helios-ackmore and amanda-knox, which are followed by three successful checks for ‚ÄòBuild,‚Äô ‚ÄòTest,‚Äô and ‚ÄòPublish.‚Äô[Learn about code review](/features/code-review)
### Fund open source projects

Become an open source partner and support the tools and libraries that power your work.

A GitHub Sponsors popup displays ‚Äò$15,000 a month‚Äô with a progress bar showing 87% towards a $15,000 goal.[Dive into GitHub Sponsors](/sponsors)
## From startups to enterprises, GitHub scales with teams of any size in any industry.

By industryBy sizeBy use case

---

[![](https://github.githubassets.com/assets/figma-62d390a52419.webp)![Figma](https://github.githubassets.com/assets/figma-9b0c642e96b8.svg)Technology

Figma streamlines development and strengthens security

Read customer story](https://github.com/customer-stories/figma)[![](https://github.githubassets.com/assets/mercedes-benz-d8f89b041561.webp)![Mercedes-Benz](https://github.githubassets.com/assets/mercedes-benz-60ddd54043e7.svg)Automotive

Mercedes-Benz standardizes source code and automates onboarding

Read customer story](https://github.com/customer-stories/mercedes-benz)[![](https://github.githubassets.com/assets/mercado-libre-579cb5447302.webp)![Mercado Libre](https://github.githubassets.com/assets/mercado-libre-2d6d610fa873.svg)Financial services

Mercado Libre cuts coding time by 50%

Read customer story](https://github.com/customer-stories/mercado-libre)[Explore customer stories](/customer-stories)

---

[View all solutions](/solutions)
## Millions of developers and businesses call GitHub home

Whether you‚Äôre scaling your development process or just learning how to code, GitHub is where you belong. Join the world‚Äôs most widely adopted AI-powered developer platform to build the technologies that redefine what‚Äôs possible.

Enter your emailSign up for GitHub[Try GitHub Copilot](/features/copilot)

## Site-wide Links

### Subscribe to our developer newsletter

Get tips, technical guides, and best practices. Twice a month. Right in your inbox.

[Subscribe](https://resources.github.com/newsletter/)

### Product

* [Features](/features)
* [Enterprise](/enterprise)
* [Copilot](/features/copilot)
* [Security](/security)
* [Pricing](/pricing)
* [Team](/team)
* [Resources](https://resources.github.com)
* [Roadmap](https://github.com/github/roadmap)
* [Compare GitHub](https://resources.github.com/devops/tools/compare)

### Platform

* [Developer API](https://docs.github.com/get-started/exploring-integrations/about-building-integrations)
* [Partners](https://partner.github.com)
* [Education](https://github.com/edu)
* [GitHub CLI](https://cli.github.com)
* [GitHub Desktop](https://desktop.github.com)
* [GitHub Mobile](https://github.com/mobile)

### Support

* [Docs](https://docs.github.com)
* [Community Forum](https://github.community)
* [Professional Services](https://services.github.com)
* [Premium Support](/enterprise/premium-support)
* [Skills](https://skills.github.com)
* [Status](https://www.githubstatus.com)
* [Contact GitHub](https://support.github.com?tags=dotcom-footer)

### Company

* [About](https://github.com/about)
* [Customer stories](/customer-stories?type=enterprise)
* [Blog](https://github.blog)
* [The ReadME Project](/readme)
* [Careers](https://github.careers)
* [Newsroom](/newsroom)
* [Inclusion](/about/diversity)
* [Social Impact](https://socialimpact.github.com)
* [Shop](https://shop.github.com)

* ¬© 2025 GitHub, Inc.
* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
  ([Updated 02/2024](https://github.com/github/site-policy/pull/582))
* [Sitemap](/sitemap)
* [What is Git?](/git-guides)
* Manage cookies
* Do not share my personal information

* [GitHub on LinkedIn](https://www.linkedin.com/company/github)
* [Instagram
  GitHub on Instagram](https://www.instagram.com/github)
* [GitHub on YouTube](https://www.youtube.com/github)
* [GitHub on X](https://x.com/github)
* [TikTok
  GitHub on TikTok](https://www.tiktok.com/%40github)
* [Twitch
  GitHub on Twitch](https://www.twitch.tv/github)
* [GitHub‚Äôs organization on GitHub](https://github.com/github)

You can‚Äôt perform that action at this time.



=== Content from github.com_854dd701_20250119_111101.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fpull%2F58)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fpull%2F58)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=home-assistant%2Fplugin-dns)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[home-assistant](/home-assistant)
/
**[plugin-dns](/home-assistant/plugin-dns)**
Public

* [Notifications](/login?return_to=%2Fhome-assistant%2Fplugin-dns) You must be signed in to change notification settings
* [Fork
  15](/login?return_to=%2Fhome-assistant%2Fplugin-dns)
* [Star
   21](/login?return_to=%2Fhome-assistant%2Fplugin-dns)

* [Code](/home-assistant/plugin-dns)
* [Issues
  3](/home-assistant/plugin-dns/issues)
* [Pull requests
  0](/home-assistant/plugin-dns/pulls)
* [Actions](/home-assistant/plugin-dns/actions)
* [Security](/home-assistant/plugin-dns/security)
* [Insights](/home-assistant/plugin-dns/pulse)

Additional navigation options

* [Code](/home-assistant/plugin-dns)
* [Issues](/home-assistant/plugin-dns/issues)
* [Pull requests](/home-assistant/plugin-dns/pulls)
* [Actions](/home-assistant/plugin-dns/actions)
* [Security](/home-assistant/plugin-dns/security)
* [Insights](/home-assistant/plugin-dns/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fhome-assistant%2Fplugin-dns%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fhome-assistant%2Fplugin-dns%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Use UDP instead of TLS for failover DNS servers #58

 Closed

[fenichelar](/fenichelar)
wants to merge
1
commit into
[home-assistant:master](/home-assistant/plugin-dns/tree/master "home-assistant/plugin-dns:master")
from
fenichelar:master

 Closed

# [Use UDP instead of TLS for failover DNS servers](#top) #58

[fenichelar](/fenichelar)
wants to merge
1
commit into
[home-assistant:master](/home-assistant/plugin-dns/tree/master "home-assistant/plugin-dns:master")
from
fenichelar:master

[Conversation
8](/home-assistant/plugin-dns/pull/58)
[Commits
1](/home-assistant/plugin-dns/pull/58/commits)
[Checks
0](/home-assistant/plugin-dns/pull/58/checks)
[Files changed](/home-assistant/plugin-dns/pull/58/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![fenichelar](https://avatars.githubusercontent.com/u/3437075?s=60&v=4)](/fenichelar)

Copy link

### @fenichelar **[fenichelar](/fenichelar)** commented [Sep 28, 2021](#issue-1010033257)

This will allow the requests to be redirected and will reduce the performance impact caused by Home Assistant losing connectivity to Cloudflare's DNS servers due to internet loss, blocking, etc.

Sorry, something went wrong.

All reactions

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=40&v=4)](/fenichelar)

`[Use UDP instead of TLS for failover DNS servers](/home-assistant/plugin-dns/pull/58/commits/ada95bf425610531b9dca4bccbb2e5bad30df75c "Use UDP instead of TLS for failover DNS servers")`

`[ada95bf](/home-assistant/plugin-dns/pull/58/commits/ada95bf425610531b9dca4bccbb2e5bad30df75c)`

[![@homeassistant](https://avatars.githubusercontent.com/u/23041403?s=40&u=47513de918772e42a8a77298dd8714123c97321c&v=4)](/homeassistant)
[homeassistant](/homeassistant)
added
the
[cla-signed](/home-assistant/plugin-dns/labels/cla-signed)
label
[Sep 28, 2021](#event-5375565119)

[![@Zixim](https://avatars.githubusercontent.com/u/7814664?s=80&u=6d1b94162b1cee3cd950aa8f2b82af7b9d618f0a&v=4)](/Zixim)

### This comment has been minimized.

[Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fpull%2F58)

[![@frenck](https://avatars.githubusercontent.com/u/195327?s=80&u=c0f88e376380f7a811559aa54d5096a66f6d3488&v=4)](/frenck)

Copy link

Member

### **[frenck](/frenck)** commented [Sep 28, 2021](#issuecomment-929555424) ‚Ä¢ edited Loading

| Originally it used UDP and was replaced by TLS because of enhanced privacy reasons (community-driven/requested for good reasons).  This is reducing security for a custom workaround, I don't think this is solving anything to be honest. |
| --- |

 üòÑ
2
 Zixim and tagno25 reacted with laugh emoji

All reactions

* üòÑ
  2 reactions

Sorry, something went wrong.

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 28, 2021](#issuecomment-929570598)

| [@frenck](https://github.com/frenck)  This is reducing security for a custom workaround, I don't think this is solving anything to be honest.  This isn't a custom workaround. The issue with TLS is that if connectivity to the internet is lost, HA constantly tries to open a TLS connection. By constantly, I mean many times a second. This overloads HA on low powered devices. |
| --- |

All reactions

Sorry, something went wrong.

[![@frenck](https://avatars.githubusercontent.com/u/195327?s=80&u=c0f88e376380f7a811559aa54d5096a66f6d3488&v=4)](/frenck)

Copy link

Member

### **[frenck](/frenck)** commented [Sep 28, 2021](#issuecomment-929574668)

| I understand, however, this PR has a different side effect (privacy) which is more important.  This PR cannot be accepted in its current format for that reason. Please note, TLS here has been added because of the community (originally we didn't use it).  Nevertheless, thanks for willing to contribute üëç |
| --- |

All reactions

Sorry, something went wrong.

[![@frenck](https://avatars.githubusercontent.com/u/195327?s=40&u=c0f88e376380f7a811559aa54d5096a66f6d3488&v=4)](/frenck)
[frenck](/frenck)
closed this
[Sep 28, 2021](#event-5376236305)

[![@alexdelprete](https://avatars.githubusercontent.com/u/7027842?s=80&u=7f577acb229619c8dcb799cae5f9f5afb2a48d48&v=4)](/alexdelprete)

### This comment has been minimized.

[Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fpull%2F58)

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=80&v=4)](/fenichelar)

Copy link

Author

### **[fenichelar](/fenichelar)** commented [Sep 28, 2021](#issuecomment-929576928)

| [@frenck](https://github.com/frenck)  I understand, however, this PR has a different side effect (privacy) which is more important.  I don't understand this comment. TLS is only used for the fallback servers, not the primary servers. This only improves privacy when there is a DNS failure. If the focus was privacy, wouldn't you want to use TLS on the primary servers? |
| --- |

 üëç
3
 jjvandenberg, Zixim, and tagno25 reacted with thumbs up emoji

All reactions

* üëç
  3 reactions

Sorry, something went wrong.

[![@frenck](https://avatars.githubusercontent.com/u/195327?s=80&u=c0f88e376380f7a811559aa54d5096a66f6d3488&v=4)](/frenck)

Copy link

Member

### **[frenck](/frenck)** commented [Sep 28, 2021](#issuecomment-929578736)

| If the focus was privacy, wouldn't you want to use TLS on the primary servers?  Partly agree, yet, it would be external communication that would be encrypted instead of not (even in a fallback situation). However, that doesn't change the fact this was changed to what it is for the above-given reasoning; which we are not willing to revert again. |
| --- |

All reactions

Sorry, something went wrong.

[![@bentasker](https://avatars.githubusercontent.com/u/2900301?s=80&v=4)](/bentasker)

Copy link

### **[bentasker](/bentasker)** commented [Nov 9, 2021](#issuecomment-964235903)

| [@frenck](https://github.com/frenck) When DoT is used, `coredns` can cause packet storms, whilst with UDP it does not (see [#64](https://github.com/home-assistant/plugin-dns/issues/64) for more info) - there are tangible side effects to the decision to use DoT rather than UDP.  I think you should revisit the decision to use DoT, at least until a better way to mitigate the issue can be identified.  I'm more than happy to create a PR for it, but having stumbled across this one figured better to flag up than to submit what'll essentially be a duplicate. |
| --- |

 üëç
5
 fenichelar, alexdelprete, Zixim, AndrewDaws, and tagno25 reacted with thumbs up emoji

All reactions

* üëç
  5 reactions

Sorry, something went wrong.

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fpull%2F58)

Reviewers

No reviews

Assignees

No one assigned

Labels

[cla-signed](/home-assistant/plugin-dns/labels/cla-signed)

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

6 participants

[![@fenichelar](https://avatars.githubusercontent.com/u/3437075?s=52&v=4)](/fenichelar) [![@Zixim](https://avatars.githubusercontent.com/u/7814664?s=52&v=4)](/Zixim) [![@frenck](https://avatars.githubusercontent.com/u/195327?s=52&v=4)](/frenck) [![@alexdelprete](https://avatars.githubusercontent.com/u/7027842?s=52&v=4)](/alexdelprete) [![@bentasker](https://avatars.githubusercontent.com/u/2900301?s=52&v=4)](/bentasker) [![@homeassistant](https://avatars.githubusercontent.com/u/23041403?s=52&v=4)](/homeassistant)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from avatars.githubusercontent.com_67d8cdcc_20250119_130725.html ===
ÔøΩÔøΩÔøΩÔøΩ JFIF  ` `  ÔøΩÔøΩ ;CREATOR: gd-jpeg v1.0 (using IJG JPEG v62), quality = 90
ÔøΩÔøΩ C 



ÔøΩÔøΩ C  

ÔøΩÔøΩ  P P" ÔøΩÔøΩ           
ÔøΩÔøΩ ÔøΩ   } !1AQa"q2ÔøΩÔøΩÔøΩ#BÔøΩÔøΩRÔøΩÔøΩ$3brÔøΩ
%&'()\*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyzÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ        
ÔøΩÔøΩ ÔøΩ  w !1AQaq"2ÔøΩBÔøΩÔøΩÔøΩÔøΩ #3RÔøΩbrÔøΩ
$4ÔøΩ%ÔøΩ&'()\*56789:CDEFGHIJSTUVWXYZcdefghijstuvwxyzÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ   ? ÔøΩSÔøΩÔøΩ( ÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩKÔøΩkKÔøΩÔøΩÔøΩ:Œß{ÔøΩÔøΩÔøΩC"ƒí\ÔøΩÔøΩ/ÔøΩ!ÔøΩÔøΩ8'ÔøΩ ÔøΩ\*'8”ãÔøΩÔøΩÔøΩWvFÔøΩƒüÔøΩÔøΩ?ÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÃ∂ÔøΩÔøΩ(!ÔøΩÔøΩÔøΩÔøΩ#ÔøΩ%ÔøΩ'vÔøΩÔøΩÔøΩ◊äÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩwÔøΩWÔøΩu
:qÔøΩÔøΩ#iÔøΩÔøΩÔøΩÔøΩqÔøΩ]9ÔøΩÔøΩEÔøΩM«©YÔøΩ ÔøΩÔøΩÔøΩ ƒøuOÔøΩÔøΩÔøΩÔøΩ ÔøΩFÔøΩmÔøΩf}/ÔøΩÔøΩLÔøΩoÔøΩ[>\_rÔøΩÔøΩ<ÔÄÄ;H$mÔøΩ\ÔãøeÔøΩﬂÜÔøΩ
ÔøΩÔøΩ
Z-ÔøΩ÷ûLÔøΩk3;ÔøΩK5ÔøΩ- ÔøΩÔøΩ…éC"ÔøΩ`0ÔøΩÔøΩÔøΩÔøΩ;ÔøΩqfXÔøΩtÔøΩTÔøΩSÔøΩÔøΩÔøΩzwÔøΩOMÔøΩÔøΩ≈ÖÔøΩ-ÔøΩÔøΩÔøΩÔøΩ|ÔøΩÔøΩÔøΩ|`ÔøΩt:ÔøΩÔøΩRiÔøΩÔøΩÔøΩÔøΩ}[GÔøΩFÔøΩÔøΩNÔøΩ
ÔøΩ"0ÔøΩ0ÔøΩpkÔøΩÔøΩÔøΩ!%8ÔøΩEÔøΩ3ÔøΩÔøΩhQEXÔøΩ$ÔøΩÔøΩxÔøΩÔøΩGÔøΩ<3ÔøΩÔøΩÔøΩIÔøΩÔøΩÔøΩ/ÔøΩcÔøΩÔøΩÔøΩb ÔøΩ+‰øéÔøΩ.ÔøΩÔøΩkwÔøΩÔøΩÔøΩÔøΩ“ùF’µKÔøΩÔøΩmMÔøΩ6$QnÔøΩÔøΩdÔøΩÏ†åÔøΩdcÔøΩNyÔøΩÔøΩZ1{{ÔøΩÔøΩÔøΩÔøΩÔøΩolÔøΩÔøΩÔøΩgÔøΩwÔøΩÔøΩÔøΩ\*ÔøΩiÔøΩÔøΩ›ª7)%ÔøΩÈ§îÔøΩÔøΩÔøΩÔøΩÔøΩyÔøΩQÔøΩ{ÔøΩÔøΩÔøΩÔøΩ/ÔøΩ iÔøΩ@vÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩK}&("ÔøΩ ÔøΩÔøΩÔøΩo⁄∑„Ü≥ÔøΩOxNy
ÔÜº+ÔøΩjÔøΩNÔøΩÔøΩ\DÔøΩÔøΩÔøΩ]] åÔøΩÔøΩvFÔøΩqÔøΩ.yftÔøΩ"\ÔøΩS·èÑÔøΩÔøΩ|AmwÔøΩÔøΩ$ÔøΩoiÔøΩ]ÔøΩIt◊ó
ÔøΩÔøΩ"HÔøΩA8$ÔøΩ` IÔøΩ\_:ÔøΩÔøΩÔøΩ9aqÔøΩajÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ=<ÔøΩ6ÔøΩÔøΩÔøΩÔøΩ?ÔøΩÔøΩÔøΩ
+ÔøΩŒ°ÔøΩÔøΩCÔøΩÔøΩÔøΩs\_›ÇmÔøΩ?ÔøΩÔøΩeÔøΩ nÔøΩÔøΩÔøΩÔøΩ⁄©hÔøΩ\_ÔøΩ=cÔøΩÔøΩÔøΩ3KÔøΩÔøΩ?ÔøΩÔøΩ}ÔøΩÔøΩ^»çÔøΩÔøΩFfnÔøΩÔøΩ◊≠ÔøΩ?ÔøΩÔøΩÔøΩÔøΩgÔøΩÔøΩ^ÔøΩÔøΩÔøΩÏç≠ÔøΩÔøΩÔøΩ:ÔøΩwÔøΩ ÔøΩI'ÔøΩN›ßÔøΩÔøΩu}O+iÌçª'ÔøΩ YQÔøΩ€öÔøΩÔøΩOÔøΩÔøΩÔøΩ:ÔøΩÔøΩ=›ùÔøΩ·¶áOÔøΩ{qvÔøΩÔøΩv<ÔøΩÔøΩUÔøΩp3ÔøΩ~2ÔøΩhTÔøΩi’ïÔøΩÔøΩjÔøΩKzÔøΩÔøΩÔøΩÔøΩ,ÔøΩ= îR^[ÔøΩÔøΩskzOÔøΩÔøΩ2x3ÔøΩVWIÔøΩÔøΩÔøΩÔøΩÔøΩ‘¶ÔøΩIÔøΩ·äóÔøΩÔøΩÔøΩ|ÔøΩ√ÜÔøΩIÔøΩÔøΩÔøΩ<}$E~EOÔøΩRÔøΩÔøΩ«ÄuÔøΩ9ÔøΩEi‚ê∞ÔøΩÔøΩÔøΩÔøΩfMÔøΩL
(ÔøΩÔøΩÔøΩ.WÔøΩA;A-ÔøΩÔøΩÔøΩFÔøΩÔøΩÔøΩcÔøΩ5 ÔøΩ,#ÔøΩj-&ÔøΩgÔøΩYxÔøΩÔøΩÔøΩ1vÔøΩÔøΩ8{ÔøΩx<ÔøΩRÔøΩÔøΩ6ÔøΩÔøΩÔøΩYyÔøΩÔøΩiÔøΩÔøΩ[[f'ÔøΩuSKÔøΩÔøΩÔøΩ€îWÔøΩx7ÔøΩÔøΩÔøΩÔøΩmÔøΩ-ÔøΩÔøΩo'iÔøΩRQyÔøΩÔøΩÔøΩ&1ÔøΩÔøΩ?ÔøΩÔøΩ^◊ßjvÔøΩ≈î7ÔøΩ7PÔøΩZLÔøΩÔøΩÔøΩ@ÔøΩÔøΩzaÔøΩJÔøΩÔøΩ8ÔøΩ8ÔøΩÔøΩJIÔøΩpÔøΩ>ÔøΩÔøΩÔøΩ oÔøΩ„çµÔøΩ1ÔøΩﬁúdÔøΩY)ÔøΩJÔøΩÔøΩÁÅêÔøΩTWÔøΩÔøΩÔøΩ)eÔøΩAÔøΩŒ¥)WÔøΩsÔøΩÔøΩÔøΩÔøΩ&6ÔøΩÔøΩÔøΩ&ÔøΩÔøΩ#"ÔøΩWÔøΩÔøΩÔøΩ9ÔøΩ„®µÔøΩ.0,ÔøΩÔøΩÔøΩÔøΩ,ZÔøΩBeÔøΩÔøΩÔøΩ.#VoA"3ÔøΩÔøΩÔøΩ‘óÔøΩÔøΩÔøΩ-ÔøΩAyÔøΩÔøΩÔøΩ:6ÔøΩÔøΩGÔøΩÿáVpGÔøΩ`gÔøΩ]/QoxGE’•O.[ÔøΩn]GbÔøΩÔøΩÔøΩÔøΩZ/ÔøΩ&ÔøΩÔøΩt
:ÔøΩÔøΩÔøΩSÔøΩÔøΩÔøΩÔøΩ."ÔøΩ%ÔøΩ $[ÿìÔøΩÔøΩÔøΩ-ÔøΩÔøΩÔøΩÔøΩXÔøΩkCÔøΩ!ÔøΩÔøΩÔøΩÔøΩH"EÔøΩÔøΩÔøΩ(ÔøΩx MvÔøΩ{TaZÔøΩÔøΩÔøΩÔøΩwÔøΩÔøΩÔøΩzÔøΩZÔøΩÔøΩÔøΩÔøΩÔøΩbÔøΩÔøΩyœâ4ÔøΩKiZÔøΩÔøΩ◊¨Di=ÔøΩ4sÔøΩÔøΩ¬ÄÔøΩ/ÔøΩÔøΩ' ÔøΩWmÔøΩ=ÔøΩ<ÔøΩ.ÔøΩÔøΩ;[ÔøΩ'RÔøΩ@ÔøΩÔøΩÔøΩ2ÔøΩÔøΩÔøΩDpﬁ∏<ÔøΩÔøΩ\*<ÔøΩÔøΩÔøΩ$ÔøΩ>NUNÏïãÔøΩÔøΩ
WÔøΩ«âevy,4ÔøΩg1^ÔøΩ0ÔøΩ?ﬁµÔøΩaÔøΩÔøΩÔøΩÔøΩaÔøΩ`ÔøΩOÔøΩÔøΩ>ÔøΩÔøΩthÔøΩÔøΩVÔøΩiÔøΩÔøΩiÔøΩÔøΩ+ÔøΩ#@0 ÀòVÔøΩÔøΩÔøΩcÔøΩÔøΩMBÔøΩ6ÔøΩVÔøΩO6ÔøΩÔøΩÔøΩÔøΩÔøΩ,{NÔøΩ
ÔøΩÔøΩÔøΩmÔøΩÔøΩÔøΩÔøΩ4+ÔøΩ?imJ;M7ÔøΩHÔøΩU‘§ÔøΩÔøΩÔøΩ8ÔøΩgÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩjÔøΩÔøΩÔøΩÔøΩMZÔøΩÔøΩ71ÔøΩ◊àGÔøΩÔøΩKQÔøΩrA^vwwÔøΩ’ÑwÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩ{n\ÔøΩÔøΩÔøΩÔøΩk0jÔøΩ ÔøΩlÔøΩÔøΩ.ÔøΩ1ÔøΩGwÔøΩÔøΩ
ÔøΩ[ÔøΩOÔøΩÔøΩ]ÔøΩUe1ÔøΩÔøΩI#ÔøΩÔøΩÔøΩÔøΩÔøΩ7ÔøΩÔøΩ;ÔøΩ|<ÔøΩgÔøΩÔøΩ√ûÔøΩÔøΩÔøΩÔøΩÔøΩEÔøΩÔøΩÔøΩP<ÔøΩÔøΩDRÔøΩ ÔøΩÔøΩgÔøΩ:ÔøΩ…æÔøΩÔøΩÔøΩÔøΩÔøΩOÔøΩ\*ÔøΩ:ÔøΩÔøΩÔøΩx~;ÔøΩ"ÔøΩÔøΩ) hÔøΩYÔøΩU!n6ÔøΩoÔøΩ|ÔøΩÔøΩÔøΩjÔøΩÔøΩÔøΩQÔøΩÔøΩ+tÔøΩÔøΩGÔøΩÔøΩx|VjÔøΩGÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ|ÔøΩ«Ω~ÔøΩ?ÔøΩÔøΩÔøΩÔøΩÔøΩ-ÔøΩÔøΩ}wÔøΩÔøΩiÔøΩ4ÔøΩ
ÔøΩÔøΩ]ÔøΩ4ÔøΩÔøΩCqwƒ∂ÔøΩÔøΩTÔøΩq+ÔøΩÔøΩÔøΩÔøΩÔøΩ~^ÔøΩÔøΩÔøΩÔøΩmKÔøΩZÔøΩÔøΩÔøΩÔøΩÔøΩSx[ÔøΩÔøΩ!ÔøΩsqÔøΩIÔøΩCÔøΩKÔøΩÔøΩaÔøΩ^ÔøΩ\_ÔøΩÔøΩ\*ÔøΩuÔøΩÔøΩ\_ÔøΩÔøΩÔøΩÔøΩ√†xÔøΩKÔøΩ3ÔøΩ√¨]yÔøΩiÔøΩÔøΩc<$bÔøΩrÔøΩmÔøΩÔøΩ;ÔøΩÔøΩÔøΩw¬π4ÔøΩ-uÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩxVmCeÔøΩÔøΩr|ÔøΩÔøΩ5V]ÔøΩ;wd aÔøΩÔøΩÔøΩ ßÔøΩÔøΩQÔøΩÔøΩÔøΩÔøΩÔøΩdÔøΩe\*ÔøΩÔøΩ\_=7ÔøΩEÔøΩÔøΩ]/ÔøΩÔøΩÔøΩ|—Ø<\_ÔøΩSJÔøΩtÔøΩWDÔøΩÔøΩÔøΩÔøΩZÔøΩ$”º/ÔøΩÔøΩÔøΩb7ÔøΩb8]ÔøΩ:ÔøΩ>ÔøΩÔøΩÔøΩ ÔøΩÔøΩ+ÔøΩMIÔøΩ{;DÔøΩ5ÔøΩ*ÔøΩÔøΩÔøΩÔøΩUÔøΩÔøΩxÔøΩƒ∑MÔøΩÔøΩÔøΩJÔøΩ\_>ÔøΩÔøΩÔøΩÔøΩ ^ÔøΩ7-ÔøΩ\_ÔøΩÔøΩÔøΩ"ÔøΩÔøΩÔøΩÔøΩÔøΩQo\_+ÔøΩOÔøΩÔøΩÔøΩÔøΩ\*\ÔøΩÔøΩ\_sÔøΩÔøΩ}ÔøΩhVÔøΩ-4ÔøΩ.ÔøΩ++XÔøΩPÔøΩ¬∏TQÔøΩ
ÔøΩE–íJÔøΩÔøΩ ÔøΩÔøΩiÔøΩH\xÔøΩ Y+wanÔøΩÔøΩivÔøΩoÔøΩÔøΩÔøΩ,ÔøΩ
ÔøΩyƒëÔøΩÔøΩÔøΩÔøΩ|ÔøΩÔøΩÔøΩ6ÔøΩ4[ÌôÇÔøΩuÔøΩ'ÔøΩÔøΩLn   ÔøΩÔøΩvÔøΩ\*ÔøΩaN|ÔøΩJ2ÔøΩÔøΩÔøΩÔøΩÔøΩDÔøΩ\*qqÔøΩÔøΩCÔøΩ"ÔøΩÔøΩ~#D:=ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩK4MÔøΩSaÔøΩuHÔøΩÔøΩ|AÔøΩÔøΩOy6ÔøΩÔøΩÔøΩ\_iÔøΩ\9ÔøΩuWsÔøΩÔøΩZÔøΩ\*≈ìÔøΩ?ÔøΩ‰ìísÔøΩÔøΩx()ÔøΩ5ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ\*ÔøΩÔøΩÔøΩgÔøΩÔøΩOwÔøΩ\ÔøΩÔøΩu{ÔøΩÔøΩÔøΩÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ3ÔøΩcÔøΩÔøΩ;ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ#y$ÔøΩÔøΩKo
–Å÷æcÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩk=WAÔøΩ&CÔøΩÔøΩÔøΩÔøΩZ\9<ÔøΩY>ÔøΩv;ÔøΩÔøΩ6:ÔøΩÔøΩÔøΩbÔøΩÔøΩxkIÔøΩ^ÔøΩ>ÔøΩÔøΩÈ∂∫ÔøΩÔøΩ8ÔøΩ-ÔøΩÔøΩ+,n=’ÅÔøΩgÔøΩ“äO'MÔøΩ⁄ØÔøΩÔøΩÔøΩÔøΩÔøΩaÔøΩFMÔøΩÔøΩ=ÔøΩÔøΩÔøΩ ÔøΩÔøΩ|ÔøΩÔøΩÔøΩ"oÔøΩVw|zÔøΩcnÔøΩÔøΩ:JGÔøΩ}ÔøΩÔøΩSÔøΩÔøΩ\*ÔøΩnÔøΩÔøΩb+ÔøΩ?ÔøΩÔøΩÔøΩÔøΩ dÔøΩÔøΩÔøΩÔøΩ≈ÖÔøΩ'ÔøΩmRcÔøΩ‹öÔøΩÔøΩÔøΩIKÔøΩs'ÔøΩ/VXcSFÔøΩÊëí<ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ”ì"„Ä†WsÔøΩ8xGXÔøΩuuÔøΩ4ÔøΩÔøΩoÔøΩ5Y&M:MÔøΩ5ÔøΩ(c!–êAXAÔøΩy ÔøΩ^ÔøΩ#ÔøΩÔøΩVÔøΩÔøΩI/fÔøΩÔøΩ'tÔøΩÔøΩKM”≤}◊ôÔøΩ8LÔøΩUÔøΩR2ÔøΩÔøΩN€ûÔøΩEWIÔøΩÔøΩÔøΩ*

=== Content from github.com_570e1485_20250119_111048.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fissues%2F50)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fissues%2F50)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=home-assistant%2Fplugin-dns)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[home-assistant](/home-assistant)
/
**[plugin-dns](/home-assistant/plugin-dns)**
Public

* [Notifications](/login?return_to=%2Fhome-assistant%2Fplugin-dns) You must be signed in to change notification settings
* [Fork
  15](/login?return_to=%2Fhome-assistant%2Fplugin-dns)
* [Star
   21](/login?return_to=%2Fhome-assistant%2Fplugin-dns)

* [Code](/home-assistant/plugin-dns)
* [Issues
  3](/home-assistant/plugin-dns/issues)
* [Pull requests
  0](/home-assistant/plugin-dns/pulls)
* [Actions](/home-assistant/plugin-dns/actions)
* [Security](/home-assistant/plugin-dns/security)
* [Insights](/home-assistant/plugin-dns/pulse)

Additional navigation options

* [Code](/home-assistant/plugin-dns)
* [Issues](/home-assistant/plugin-dns/issues)
* [Pull requests](/home-assistant/plugin-dns/pulls)
* [Actions](/home-assistant/plugin-dns/actions)
* [Security](/home-assistant/plugin-dns/security)
* [Insights](/home-assistant/plugin-dns/pulse)

# performance impact after dns update to 2021.06.0¬†#50

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[performance impact after dns update to 2021.06.0](#top)#50Copy link![@milutt](https://avatars.githubusercontent.com/u/23743120?v=4&size=80)
## Description

![@milutt](https://avatars.githubusercontent.com/u/23743120?v=4&size=48)[milutt](https://github.com/milutt)opened [on Jun 30, 2021](https://github.com/home-assistant/plugin-dns/issues/50#issue-933637335)

Since dns upgrade to 2021.06.0, my complete hassio setup is having performance issues.

I am running haos on Raspberry Pi 1B. It's an old pi, but before dns 2021.06.0 everything was running without issues and I had no reason to upgrade hardware.

Since dns upgrade, coredns will eventually get stuck at more than 60% CPU usage constantly and everything else slows down to the level that it's unusable.

Even 'ha dns restart' is failing with time out.

It's happening also with clean image install without configuring any integrations.

When I downgrade to dns 2021.04.0 using 'ha dns update --version 2021.04.0', CPU usage is back to normal and whole system is responsive.

Downgrading dns is not permanent fix as it gets automatically updated back to last version and CPU load increases again.

**Is there an option to permanently downgrade to dns 2021.04.0 or disable DoT completely (if TLS is causing too much load on rpi1)?**

**dns logs using 2021.06.01:**

[INFO] 127.0.0.1:45539 - 6781 "NS IN . udp 17 false 512" NOERROR - 0 30.016215226s

[ERROR] plugin/errors: 2 . NS: tls: DialWithDialer timed out

[INFO] 127.0.0.1:47240 - 31621 "NS IN . udp 17 false 512" NOERROR - 0 30.014927277s

[ERROR] plugin/errors: 2 . NS: tls: DialWithDialer timed out

[INFO] 127.0.0.1:39746 - 20863 "NS IN . udp 17 false 512" NOERROR - 0 30.018269213s

[ERROR] plugin/errors: 2 . NS: tls: DialWithDialer timed out

[INFO] 127.0.0.1:40733 - 54343 "NS IN . udp 17 false 512" NOERROR - 0 30.006049544s

[ERROR] plugin/errors: 2 . NS: tls: DialWithDialer timed out

[INFO] 127.0.0.1:47464 - 56063 "NS IN . udp 17 false 512" NOERROR - 0 35.378188925s

[ERROR] plugin/errors: 2 . NS: tls: DialWithDialer timed out

[INFO] 127.0.0.1:33661 - 11713 "NS IN . udp 17 false 512" NOERROR - 0 30.888139468s

[ERROR] plugin/errors: 2 . NS: tls: DialWithDialer timed out

[INFO] 127.0.0.1:54301 - 4260 "NS IN . udp 17 false 512" NOERROR - 0 30.002718645s

[ERROR] plugin/errors: 2 . NS: tls: DialWithDialer timed out

[INFO] 127.0.0.1:33394 - 6453 "NS IN . udp 17 false 512" NOERROR - 0 30.032896855s

[ERROR] plugin/errors: 2 . NS: tls: DialWithDialer timed out

[INFO] 127.0.0.1:35429 - 10631 "NS IN . udp 17 false 512" NOERROR - 0 30.012585403s

[ERROR] plugin/errors: 2 . NS: tls: DialWithDialer timed out

**dns logs using 2021.04.0 (everything else the same, just downgraded dns):**

[INFO] 172.30.32.1:39653 - 7139 "PTR IN 43.178.168.192.in-addr.arpa. udp 45 false 512" NXDOMAIN qr,aa,rd,ra 45 0.142744402s

[INFO] 172.30.32.1:47120 - 56986 "PTR IN 1.178.168.192.in-addr.arpa. udp 44 false 512" NXDOMAIN qr,aa,rd,ra 44 0.04007399s

[INFO] 172.30.32.1:42934 - 43274 "PTR IN 2.0.17.172.in-addr.arpa. udp 41 false 512" NXDOMAIN qr,aa,rd,ra 41 0.074434124s

[INFO] 172.30.32.1:60416 - 61087 "PTR IN 80.178.168.192.in-addr.arpa. udp 45 false 512" NXDOMAIN qr,aa,rd,ra 45 0.035992093s

[INFO] 172.30.32.1:48272 - 61848 "PTR IN 84.178.168.192.in-addr.arpa. udp 45 false 512" NXDOMAIN qr,aa,rd,ra 45 0.024411385s

[INFO] 172.30.32.1:52543 - 46777 "PTR IN 43.178.168.192.in-addr.arpa. udp 45 false 512" NXDOMAIN qr,aa,rd,ra 45 0.107825254s

[INFO] 172.30.32.1:44524 - 31012 "PTR IN 1.178.168.192.in-addr.arpa. udp 44 false 512" NXDOMAIN qr,aa,rd,ra 44 0.047429792s

[INFO] 172.30.32.1:49698 - 36720 "PTR IN 2.0.17.172.in-addr.arpa. udp 41 false 512" NXDOMAIN qr,aa,rd,ra 41 0.032395175s

[INFO] 172.30.32.1:35650 - 10995 "PTR IN 80.178.168.192.in-addr.arpa. udp 45 false 512" NXDOMAIN qr,aa,rd,ra 45 0.043622889s

[INFO] 172.30.32.1:39872 - 23006 "PTR IN 84.178.168.192.in-addr.arpa. udp 45 false 512" NXDOMAIN qr,aa,rd,ra 45 0.046617813s

[INFO] 172.30.32.1:60757 - 62788 "PTR IN 43.178.168.192.in-addr.arpa. udp 45 false 512" NXDOMAIN qr,aa,rd,ra 45 0.10125965s

[INFO] 172.30.32.1:43480 - 13081 "PTR IN 1.178.168.192.in-addr.arpa. udp 44 false 512" NXDOMAIN qr,aa,rd,ra 44 0.050008839s

[INFO] 172.30.32.1:39897 - 45303 "PTR IN 2.0.17.172.in-addr.arpa. udp 41 false 512" NXDOMAIN qr,aa,rd,ra 41 0.091132884s

[INFO] 172.30.32.1:54320 - 64334 "PTR IN 80.178.168.192.in-addr.arpa. udp 45 false 512" NXDOMAIN qr,aa,rd,ra 45 0.116535295s

[INFO] 172.30.32.1:59641 - 63561 "PTR IN 84.178.168.192.in-addr.arpa. udp 45 false 512" NXDOMAIN qr,aa,rd,ra 45 0.049265856s

[INFO] 172.30.32.1:54196 - 61682 "PTR IN 43.178.168.192.in-addr.arpa. udp 45 false 512" NXDOMAIN qr,aa,rd,ra 45 0.029521276s

[INFO] 172.30.32.1:33093 - 37580 "PTR IN 1.178.168.192.in-addr.arpa. udp 44 false 512" NXDOMAIN qr,aa,rd,ra 44 0.038741049s

[INFO] 172.30.32.1:44545 - 42001 "PTR IN 2.0.17.172.in-addr.arpa. udp 41 false 512" NXDOMAIN qr,aa,rd,ra 41 0.032553201s

[INFO] 172.30.32.1:37139 - 44637 "PTR IN 80.178.168.192.in-addr.arpa. udp 45 false 512" NXDOMAIN qr,aa,rd,ra 45 2.032197136s

[INFO] 172.30.32.1:43724 - 10416 "PTR IN 84.178.168.192.in-addr.arpa. udp 45 false 512" NXDOMAIN qr,aa,rd,ra 45 0.104368439s

core-2021.6.6

supervisor-2021.06.6

Home Assistant OS 6.1

CPU armv6l

## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_8bcfefd4_20250119_111053.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fissues%2F64)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fissues%2F64)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=home-assistant%2Fplugin-dns)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[home-assistant](/home-assistant)
/
**[plugin-dns](/home-assistant/plugin-dns)**
Public

* [Notifications](/login?return_to=%2Fhome-assistant%2Fplugin-dns) You must be signed in to change notification settings
* [Fork
  15](/login?return_to=%2Fhome-assistant%2Fplugin-dns)
* [Star
   21](/login?return_to=%2Fhome-assistant%2Fplugin-dns)

* [Code](/home-assistant/plugin-dns)
* [Issues
  3](/home-assistant/plugin-dns/issues)
* [Pull requests
  0](/home-assistant/plugin-dns/pulls)
* [Actions](/home-assistant/plugin-dns/actions)
* [Security](/home-assistant/plugin-dns/security)
* [Insights](/home-assistant/plugin-dns/pulse)

Additional navigation options

* [Code](/home-assistant/plugin-dns)
* [Issues](/home-assistant/plugin-dns/issues)
* [Pull requests](/home-assistant/plugin-dns/pulls)
* [Actions](/home-assistant/plugin-dns/actions)
* [Security](/home-assistant/plugin-dns/security)
* [Insights](/home-assistant/plugin-dns/pulse)

# CoreDNS is misconfigured leading to unexpected healthcheck behaviour¬†#64

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[CoreDNS is misconfigured leading to unexpected healthcheck behaviour](#top)#64Copy link![@bentasker](https://avatars.githubusercontent.com/u/2900301?v=4&size=80)
## Description

![@bentasker](https://avatars.githubusercontent.com/u/2900301?v=4&size=48)[bentasker](https://github.com/bentasker)opened [on Nov 6, 2021](https://github.com/home-assistant/plugin-dns/issues/64#issue-1046544256)

CoreDNS is configured to healthcheck the Cloudflare fallback every 5 minutes, however in practice, a check is performed once a minute (and retries are generated when it fails).

The `fallback` directive also causes healthchecks at startup, which can create substantial query rates.

This is also why users have reported seeing small packet storms when Cloudflare is not reachable (by [@lialosiu](https://github.com/lialosiu) [here](https://github.com/home-assistant/plugin-dns/issues/20#issuecomment-917354758) and [@tescophil](https://github.com/tescophil) [here](https://github.com/home-assistant/plugin-dns/pull/56#issuecomment-928967969)).

The intended behaviour appears to be to check once every 5 minutes

```
    forward . tls://1.1.1.1 tls://1.0.0.1 {
        tls_servername cloudflare-dns.com
        except local.hass.io
        health_check 5m
    }

```

However, that is not the only check being performed, because the encompassing server block is referenced elsewhere

```
    forward . {{ join " " .servers }} {{ if len .locals | eq 0 }}dns://127.0.0.11{{ else }}{{ join " " .locals }}{{ end }} dns://127.0.0.1:5553 {
        except local.hass.io
        policy sequential
        health_check 1m
    }

```

A check will be run once a minute against `127.0.0.1:5553` as well as the locals (if present) - from further testing it *appears* those will only begin once you've had an initial failure which leads `coredns` to move onto the next forward host.

We can see this is the case by enabling coredns' prometheus endpoints and pointing telegraf at them

[![Screenshot_20211106_150804](https://user-images.githubusercontent.com/2900301/140615827-5ef365e7-7925-4213-818d-9086b5f85c99.png)](https://user-images.githubusercontent.com/2900301/140615827-5ef365e7-7925-4213-818d-9086b5f85c99.png)

That's failures per minute - each failure represents a single query (where healthchecks are concerned for `example.org`) sent to `127.0.0.1:5553`.

However, to `127.0.0.1:5553` (and any other upstream for that matter) it's just another query, so when it's query to it's upstream (one of `1.1.1.1` or `1.0.0.1`) fails, it retries and we end up with new packets hitting the wire, one after the other.

~~In terms of the fix, it's not clear *why* the fallback behaviour is implemented/hardcoded in the first place (I couldn't find any architecture discussions on it in that repo, perhaps I missed them), but the correct way to have implemented this would be one of the following options

Option 1: not include `127.0.0.1:5553` in the forwards statement at all (as it's handled by the fallback).

```
    forward . {{ join " " .servers }} {{ if len .locals | eq 0 }}dns://127.0.0.11{{ else }}{{ join " " .locals }}{{ end }} {
        except local.hass.io
        policy sequential
        health_check 1m
    }
    fallback REFUSED,SERVFAIL,NXDOMAIN . dns://127.0.0.1:5553

```

(It'd need some logic to handle empty locals)

Option 2: Not use a separate server block

```
    forward . {{ join " " .servers }} {{ if len .locals | eq 0 }}dns://127.0.0.11{{ else }}{{ join " " .locals }}{{ end }} tls://1.1.1.1 tls://1.0.0.1 {
        except local.hass.io
        policy sequential
        health_check 1m
       tls_servername cloudflare-dns.com
    }
    fallback REFUSED,SERVFAIL,NXDOMAIN . dns://127.0.0.1:5553

```

(perhaps there some other reason an entire separate server block was stood up, but I don't see any reference to it).

* You could also add some config to handle `example.org` locally (so the healthcheck against `:5553` isn't passed upstream), but that's more horrid than the current setup.
* Turning off healthchecks against the locals is likely to be undesirable due to then having to wait for `coredns`'s timeouts if a local does go down, so I've not included that

The reason this isn't a PR is because it's blocked by a decision on approach.~~

Correction: The much bigger issue is actually the `fallback` statement, see [#64 (comment)](https://github.com/home-assistant/plugin-dns/issues/64#issuecomment-963524772)

### Additional Observations

Whilst capturing telemetry there were a few things I noticed which might help inform a decision on the above

When in use, the Cloudflare fallback introduces a significant level of latency:

[![Screenshot_20211106_145548](https://user-images.githubusercontent.com/2900301/140616462-5ced84d4-92c7-4917-ade6-fe75b651d734.png)](https://user-images.githubusercontent.com/2900301/140616462-5ced84d4-92c7-4917-ade6-fe75b651d734.png)

At the network level, Cloudflare is only 10-15ms away, but the average query duration for CF upstreams is half a second. The presumption is that's due to DoT overheads, but unfortunately `coredns` doesn't currently expose metrics that can help verify this.

I'd posit therefore that as well as fixing the healthcheck issue

* The choice to have cloudflare enabled/disabled should be available to the user
* If mandatory, the choice to use DoT should be open to the user

But, realistically, if this issue is fixed so that healthchecks aren't amplified onto the network, then users who want to block CF DoT at the perimeter will be able to do so without HA gradually attempting to flood the network.

I like `coredns`, but it does feel rather out of place in an appliance - it's approach to dynamic timeouts isn't really very well tuned to the foibles of domestic connections/networks.

üëç5
## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_5d0465b4_20250119_111049.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fissues%2F51)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fissues%2F51)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=home-assistant%2Fplugin-dns)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[home-assistant](/home-assistant)
/
**[plugin-dns](/home-assistant/plugin-dns)**
Public

* [Notifications](/login?return_to=%2Fhome-assistant%2Fplugin-dns) You must be signed in to change notification settings
* [Fork
  15](/login?return_to=%2Fhome-assistant%2Fplugin-dns)
* [Star
   21](/login?return_to=%2Fhome-assistant%2Fplugin-dns)

* [Code](/home-assistant/plugin-dns)
* [Issues
  3](/home-assistant/plugin-dns/issues)
* [Pull requests
  0](/home-assistant/plugin-dns/pulls)
* [Actions](/home-assistant/plugin-dns/actions)
* [Security](/home-assistant/plugin-dns/security)
* [Insights](/home-assistant/plugin-dns/pulse)

Additional navigation options

* [Code](/home-assistant/plugin-dns)
* [Issues](/home-assistant/plugin-dns/issues)
* [Pull requests](/home-assistant/plugin-dns/pulls)
* [Actions](/home-assistant/plugin-dns/actions)
* [Security](/home-assistant/plugin-dns/security)
* [Insights](/home-assistant/plugin-dns/pulse)

# Dns stops resolving within hours¬†#51

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[Dns stops resolving within hours](#top)#51Copy link![@idfxken](https://avatars.githubusercontent.com/u/24717892?u=f66c6357e72ef21976812b5ad49931e6f2487e10&v=4&size=80)
## Description

![@idfxken](https://avatars.githubusercontent.com/u/24717892?u=f66c6357e72ef21976812b5ad49931e6f2487e10&v=4&size=48)[idfxken](https://github.com/idfxken)opened [on Jul 11, 2021](https://github.com/home-assistant/plugin-dns/issues/51#issue-941525972)

Ha is configured with a local dns resolver, while all other means of resolving are blocked on our home automation subnet.

When (re)started, HA dns runs perfectly fine, and can resolve all queries through the assigned server.

```
ha dns info
host: 172.30.32.3
locals:
- dns://192.168.111.1
servers:
- dns://192.168.111.1
update_available: false
version: 2021.06.0
version_latest: 2021.06.0
~ $ ping google.be
PING google.be (142.251.36.35): 56 data bytes

```

After a few hours, the resolver just stops resolving through the programmed server. and switches to dot 1.0.0.1/1.1.1.1:853 for all dns requests, which are all refused by the router ofcourse. Somehow HA jforgot, that 192.168.1111.1 is its assigned dns server.

Edit: logs from the second the issue starts:

> [ERROR] plugin/errors: 2 . NS: tls: DialWithDialer timed out
>
> [INFO] 127.0.0.1:44137 - 6201 "NS IN . udp 40 true 2048" NOERROR - 0 1.001374795s
>
> [ERROR] plugin/errors: 2 . NS: tls: DialWithDialer timed out
>
> [INFO] 172.30.33.3:50563 - 6201 "NS IN . udp 40 false 4096" SERVFAIL qr,rd 17 6.071750661s
>
> [INFO] 127.0.0.1:45411 - 6201 "NS IN . udp 40 true 2048" NOERROR - 0 1.00095742s
>
> [ERROR] plugin/errors: 2 . NS: tls: DialWithDialer timed out
>
> [INFO] 127.0.0.1:44137 - 6201 "NS IN . udp 40 true 2048" NOERROR - 0 1.000966169s
>
> [ERROR] plugin/errors: 2 . NS: tls: DialWithDialer timed out
>
> [INFO] 172.30.33.3:52280 - 6201 "NS IN . udp 40 false 4096" SERVFAIL qr,rd 17 6.008133092s
>
> [INFO] 127.0.0.1:47155 - 3762 "A IN version.home-assistant.io. udp 54 true 2048" NOERROR - 0 1.004052137s
>
> [ERROR] plugin/errors: 2 version.home-assistant.io. A: tls: DialWithDialer timed out
>
> [INFO] 127.0.0.1:44272 - 3762 "A IN version.home-assistant.io. udp 54 true 2048" NOERROR - 0 1.000851399s
>
> [ERROR] plugin/errors: 2 version.home-assistant.io. A: tls: DialWithDialer timed out
>
> [INFO] 172.30.32.2:57753 - 3762 "A IN version.home-assistant.io. udp 43 false 512" SERVFAIL qr,rd 43 2.013838761s
>
> [INFO] 127.0.0.1:44704 - 15932 "A IN data.buienradar.nl. udp 47 true 2048" NOERROR - 0 1.001158626s
>
> [ERROR] plugin/errors: 2 data.buienradar.nl. A: tls: DialWithDialer timed out
>
> [INFO] 127.0.0.1:33818 - 16449 "AAAA IN data.buienradar.nl. udp 47 true 2048" NOERROR - 0 1.003631786s
>
> [ERROR] plugin/errors: 2 data.buienradar.nl. AAAA: tls: DialWithDialer timed out
>
> [INFO] 127.0.0.1:60988 - 15932 "A IN data.buienradar.nl. udp 47 true 2048" NOERROR - 0 1.000984262s
>
> [ERROR] plugin/errors: 2 data.buienradar.nl. A: tls: DialWithDialer timed out
>
> [INFO] 172.30.32.1:45411 - 15932 "A IN data.buienradar.nl. udp 36 false 512" SERVFAIL qr,rd 36 2.005486429s
>
> [INFO] 172.30.32.1:45411 - 15932 "A IN data.buienradar.nl. udp 36 false 512" SERVFAIL qr,aa,rd 36 0.00011969s
>
> [INFO] 172.30.32.1:45411 - 15932 "A IN data.buienradar.nl. udp 36 false 512" SERVFAIL qr,aa,rd 36 0.000257307s
>
> [INFO] 127.0.0.1:33982 - 16449 "AAAA IN data.buienradar.nl. udp 47 true 2048" NOERROR - 0 1.001272358s
>
> [ERROR] plugin/errors: 2 data.buienradar.nl. AAAA: tls: DialWithDialer timed out
>
> [INFO] 172.30.32.1:45411 - 15932 "A IN data.buienradar.nl. udp 36 false 512" SERVFAIL qr,aa,rd 36 0.000378729s
>
> [INFO] 172.30.32.1:45411 - 15932 "A IN data.buienradar.nl. udp 36 false 512" SERVFAIL qr,aa,rd 36 0.000304851s
>
> [INFO] 172.30.32.1:45411 - 16449 "AAAA IN data.buienradar.nl. udp 36 false 512" SERVFAIL qr,rd 36 2.010680479s
>
> [INFO] 172.30.32.1:45411 - 16449 "AAAA IN data.buienradar.nl. udp 36 false 512" SERVFAIL qr,aa,rd 36 0.000205219s
>
> [INFO] 172.30.32.1:45411 - 15932 "A IN data.buienradar.nl. udp 36 false 512" SERVFAIL qr,aa,rd 36 0.000374101s
>
> [INFO] 172.30.32.1:45411 - 15932 "A IN data.buienradar.nl. udp 36 false 512" SERVFAIL qr,aa,rd 36 0.000223414s
>
> [INFO] 172.30.32.1:45411 - 16449 "AAAA IN data.buienradar.nl. udp 36 false 512" SERVFAIL qr,aa,rd 36 0.000147082s
>
> [INFO] 172.30.32.1:45411 - 16449 "AAAA IN data.buienradar.nl. udp 36 false 512" SERVFAIL qr,aa,rd 36 0.000172155s
>
> [INFO] 172.30.32.1:45411 - 15932 "A IN data.buienradar.nl. udp 36 false 512" SERVFAIL qr,aa,rd 36 0.001195803s
>
> [INFO] 127.0.0.1:56238 - 58622 "A IN een.be. udp 35 true 2048" NOERROR - 0 1.001122865s
>
> [ERROR] plugin/errors: 2 een.be. A: tls: DialWithDialer timed out

## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_16d19a39_20250119_130723.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fpull%2F86)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fpull%2F86)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=home-assistant%2Fplugin-dns)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[home-assistant](/home-assistant)
/
**[plugin-dns](/home-assistant/plugin-dns)**
Public

* [Notifications](/login?return_to=%2Fhome-assistant%2Fplugin-dns) You must be signed in to change notification settings
* [Fork
  15](/login?return_to=%2Fhome-assistant%2Fplugin-dns)
* [Star
   21](/login?return_to=%2Fhome-assistant%2Fplugin-dns)

* [Code](/home-assistant/plugin-dns)
* [Issues
  3](/home-assistant/plugin-dns/issues)
* [Pull requests
  0](/home-assistant/plugin-dns/pulls)
* [Actions](/home-assistant/plugin-dns/actions)
* [Security](/home-assistant/plugin-dns/security)
* [Insights](/home-assistant/plugin-dns/pulse)

Additional navigation options

* [Code](/home-assistant/plugin-dns)
* [Issues](/home-assistant/plugin-dns/issues)
* [Pull requests](/home-assistant/plugin-dns/pulls)
* [Actions](/home-assistant/plugin-dns/actions)
* [Security](/home-assistant/plugin-dns/security)
* [Insights](/home-assistant/plugin-dns/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fhome-assistant%2Fplugin-dns%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fhome-assistant%2Fplugin-dns%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# No SERVFAIL and no forwarding multicast names #86

 Merged

[pvizeli](/pvizeli)
merged 2 commits into
[master](/home-assistant/plugin-dns/tree/master "home-assistant/plugin-dns:master")
from
[nxdomain-not-servfail](/home-assistant/plugin-dns/tree/nxdomain-not-servfail "home-assistant/plugin-dns:nxdomain-not-servfail")

Apr 25, 2022

 Merged

# [No SERVFAIL and no forwarding multicast names](#top) #86

[pvizeli](/pvizeli)
merged 2 commits into
[master](/home-assistant/plugin-dns/tree/master "home-assistant/plugin-dns:master")
from
[nxdomain-not-servfail](/home-assistant/plugin-dns/tree/nxdomain-not-servfail "home-assistant/plugin-dns:nxdomain-not-servfail")

Apr 25, 2022

[Conversation
5](/home-assistant/plugin-dns/pull/86)
[Commits
2](/home-assistant/plugin-dns/pull/86/commits)
[Checks
0](/home-assistant/plugin-dns/pull/86/checks)
[Files changed](/home-assistant/plugin-dns/pull/86/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![mdegat01](https://avatars.githubusercontent.com/u/2037026?s=60&v=4)](/mdegat01)

Copy link

Contributor

### @mdegat01 **[mdegat01](/mdegat01)** commented [Apr 21, 2022](#issue-1211656397) ‚Ä¢ edited Loading

Fixes [#85](https://github.com/home-assistant/plugin-dns/issues/85) by responding with an NXDOMAIN if a `local.hass.io` name is not found in our hosts file. We are authoritative on that domain in networks with supervisor and so there's no reason to keep looking if we can't find it.

Additionally fixes [#70](https://github.com/home-assistant/plugin-dns/issues/70). When reviewing the SERVFAILS that occurred when an LLMNR name was looked up (single name, no TLD) I realized that generally only bad things happen if we continue looking up multicast names past the MDNS plug-in. Since the MDNS plug-in asks the host for an answer it will get an answer for any multicast names as long as the host has one. And if the host doesn't its unlikely any of the other potential forwarding servers will either. But trying will likely leak private host names to external resolvers.

There is a risk with this. It is possible to add a dns rewrite entry for something like `my-server.local` in some DNS servers instead of properly using MDNS. This will no longer resolve after this change for users doing this because `systemd-resolved` also [refuses to forward multicast names to other resolvers](https://github.com/systemd/systemd/blob/2afb2f4a9d6a497dfbe1983fbe1bac297a8dc52b/src/resolve/resolved-dns-scope.c#L797-L813). But given what we are doing has caused a CVE and I think we should follow `systemd-resolved` example and stop at the MDNS plugin as well.

Note that if we cannot reach `systemd-resolved` (can occur only on an unsupported system) then the MDNS plugin continues to pass the request along as normal. It can't answer any queries in this situation so that is the best it can do.

Sorry, something went wrong.

All reactions

 [mdegat01](/mdegat01)
added 2 commits
[April 21, 2022 14:36](#commits-pushed-3aad767)

[![@mdegat01](https://avatars.githubusercontent.com/u/2037026?s=40&v=4)](/mdegat01)

`[Return NXDOMAIN instead of SERVFAIL](/home-assistant/plugin-dns/pull/86/commits/3aad767c80e8d49b80450e83806d6144f20b9181 "Return NXDOMAIN instead of SERVFAIL")`

`[3aad767](/home-assistant/plugin-dns/pull/86/commits/3aad767c80e8d49b80450e83806d6144f20b9181)`

[![@mdegat01](https://avatars.githubusercontent.com/u/2037026?s=40&v=4)](/mdegat01)

`[Actually reorder template and return noerror](/home-assistant/plugin-dns/pull/86/commits/5f39e6bf3f047a7d58a3da518a6e0f076f96e477 "Actually reorder template and return noerror")`

`[5f39e6b](/home-assistant/plugin-dns/pull/86/commits/5f39e6bf3f047a7d58a3da518a6e0f076f96e477)`

[![@homeassistant](https://avatars.githubusercontent.com/u/23041403?s=40&u=47513de918772e42a8a77298dd8714123c97321c&v=4)](/homeassistant)
[homeassistant](/homeassistant)
added
the
[cla-signed](/home-assistant/plugin-dns/labels/cla-signed)
label
[Apr 21, 2022](#event-6474635631)

 [![@mdegat01](https://avatars.githubusercontent.com/u/2037026?s=40&v=4)](/mdegat01)
[mdegat01](/mdegat01)
requested a review
from [pvizeli](/pvizeli)
[April 21, 2022 23:49](#event-6474639080)

[![@mdegat01](https://avatars.githubusercontent.com/u/2037026?s=40&v=4)](/mdegat01)
[mdegat01](/mdegat01)
added
the
[bug](/home-assistant/plugin-dns/labels/bug)
Something isn't working
label
[Apr 21, 2022](#event-6474642120)

[![@mdegat01](https://avatars.githubusercontent.com/u/2037026?s=80&v=4)](/mdegat01)

Copy link

Contributor

Author

### **[mdegat01](/mdegat01)** commented [Apr 21, 2022](#issuecomment-1105866342)

| FYI some more context in the discussion [here](https://github.com/home-assistant/supervisor/issues/3581) |
| --- |

All reactions

Sorry, something went wrong.

[![@KevinCathcart](https://avatars.githubusercontent.com/u/90725?s=80&v=4)](/KevinCathcart)

Copy link

### **[KevinCathcart](/KevinCathcart)** commented [Apr 22, 2022](#issuecomment-1106531633)

| It is worth mentioning this only fixes [#70](https://github.com/home-assistant/plugin-dns/issues/70) for dotless domains and .local domains.  If somebody types in a fully qualified local domain name, (such as my device.home.arpa, or device.attlocal.net, or device.mshome.net), and their local dns server is down, we could still leak those domains to cloudflare. But the only way to avoid that would be an option to disable fallback. This is because other than home.arpa, none of those other suffixes are special, so they should not be handled specially by general purpose dns servers, so even running a recursive resolver would leak final hostnames, albeit only to the nameservers for those domains.  But again, it is the best we can possibly do, other than adding an option to disable fallback, or things like letting users specify a blacklist of domains not allowed to fallback. |
| --- |

All reactions

Sorry, something went wrong.

[![@mdegat01](https://avatars.githubusercontent.com/u/2037026?s=80&v=4)](/mdegat01)

Copy link

Contributor

Author

### **[mdegat01](/mdegat01)** commented [Apr 22, 2022](#issuecomment-1106545543)

| [@KevinCathcart](https://github.com/KevinCathcart) fair point. Fortunately I'm was already working on that üòÑ [home-assistant/supervisor#3586](https://github.com/home-assistant/supervisor/pull/3586) |
| --- |

All reactions

Sorry, something went wrong.

[![pvizeli](https://avatars.githubusercontent.com/u/15338540?s=60&v=4)](/pvizeli)

**[pvizeli](/pvizeli)**
approved these changes
[Apr 25, 2022](#pullrequestreview-951470627)

 [View reviewed changes](/home-assistant/plugin-dns/pull/86/files/5f39e6bf3f047a7d58a3da518a6e0f076f96e477)

[![@pvizeli](https://avatars.githubusercontent.com/u/15338540?s=40&u=610c2bc2f528d62761ee2792799a85608fd42234&v=4)](/pvizeli)
[pvizeli](/pvizeli)
merged commit [`8e0ea74`](/home-assistant/plugin-dns/commit/8e0ea74e46bd85579948b0e3b1e0bbad35bbacc7)
into
master

[Apr 25, 2022](https://github.com/home-assistant/plugin-dns/pull/86#event-6488181569)

 [![@delete-merged-branch](https://avatars.githubusercontent.com/in/14757?s=40&v=4)](/apps/delete-merged-branch)
[delete-merged-branch](/apps/delete-merged-branch)
bot
deleted the
nxdomain-not-servfail

branch
[April 25, 2022 07:51](#event-6488182009)

[![@agners](https://avatars.githubusercontent.com/u/34061?s=80&u=08277b845f40247f6792ec9e66cb23976b0b7d4c&v=4)](/agners)

Copy link

Member

### **[agners](/agners)** commented [Apr 25, 2022](#issuecomment-1108244646)

| This is because other than home.arpa, none of those other suffixes are special, so they should not be handled specially by general purpose dns servers, so even running a recursive resolver would leak final hostnames, albeit only to the nameservers for those domains.  There is a list of reserved top-level domains in [RFC2606](https://www.rfc-editor.org/rfc/rfc2606.html). [There have been attempts](https://tools.ietf.org/id/draft-chapin-additional-reserved-tlds-01.html) to extend the list with commonly used (currently not assigned) top level domains. Since those are invalid at the top level, I think it would be quite reasonable to add those to our list as well. |
| --- |

All reactions

Sorry, something went wrong.

[![@mdegat01](https://avatars.githubusercontent.com/u/2037026?s=80&v=4)](/mdegat01)

Copy link

Contributor

Author

### **[mdegat01](/mdegat01)** commented [Apr 25, 2022](#issuecomment-1108654477) ‚Ä¢ edited Loading

| [@agners](https://github.com/agners) I see your point but that gets tricky. The problem with other reserved TLDs is they require a local DNS server. Like we do need to send those to some resolver its just ideally we should only be sending them to an internal resolver, not an external one.  And unfortunately with those I can't just make a statement like "if the host can't resolve them then no one can". Because the user has a way to add a DNS server just to HA and override the DHCP provided one. Which means it is entirely possible HA can resolve a name with one of those other special TLDs and the host's systemd-resolved can't.  In order to satisfy that request I believe we'd need to identify which resolvers were internal and which were external and only forward requests with those TLDs to internal ones. Which would be a lot more complicated because to my knowledge coredns has no way to do that, you just make a list of resolvers to forward to. Or we offload all DNS work to systemd-resolved (not just MDNS and LLMNR) but Pascal said that created other issues. |
| --- |

All reactions

Sorry, something went wrong.

[![@KevinCathcart](https://avatars.githubusercontent.com/u/90725?s=40&v=4)](/KevinCathcart)
[KevinCathcart](/KevinCathcart)
mentioned this pull request
[Apr 27, 2022](#ref-issue-1208968710)

[Dotless hostnames for local network fail to resolve
home-assistant/supervisor#3581](/home-assistant/supervisor/issues/3581)

Closed

[![@pmagyar](https://avatars.githubusercontent.com/u/58977600?s=40&v=4)](/pmagyar)
[pmagyar](/pmagyar)
mentioned this pull request
[May 1, 2024](#ref-issue-2254579572)

[DNS issues in HA Addon
hcpy2-0/hcpy#55](/hcpy2-0/hcpy/issues/55)

Closed

[![@brettonw](https://avatars.githubusercontent.com/u/2028973?s=40&v=4)](/brettonw)
[brettonw](/brettonw)
mentioned this pull request
[Jul 28, 2024](#ref-issue-2428260088)

[Apex hostname won't resolve
brettonw/neptune-apex#8](/brettonw/neptune-apex/issues/8)

Closed

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fpull%2F86)

Reviewers

[![@pvizeli](https://avatars.githubusercontent.com/u/15338540?s=40&v=4)](/pvizeli) [pvizeli](/pvizeli)

pvizeli approved these changes

Assignees

No one assigned

Labels

[bug](/home-assistant/plugin-dns/labels/bug)
Something isn't working
[cla-signed](/home-assistant/plugin-dns/labels/cla-signed)

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

 [Returns SERVFAIL instead of NXDOMAIN for non existent containers](https://github.com/home-assistant/plugin-dns/issues/85)

 [Home Assistant OS leaks private host names to cloudflare DNS service (CVE-2020-36517)](https://github.com/home-assistant/plugin-dns/issues/70)

5 participants

[![@mdegat01](https://avatars.githubusercontent.com/u/2037026?s=52&v=4)](/mdegat01) [![@KevinCathcart](https://avatars.githubusercontent.com/u/90725?s=52&v=4)](/KevinCathcart) [![@agners](https://avatars.githubusercontent.com/u/34061?s=52&v=4)](/agners) [![@pvizeli](https://avatars.githubusercontent.com/u/15338540?s=52&v=4)](/pvizeli) [![@homeassistant](https://avatars.githubusercontent.com/u/23041403?s=52&v=4)](/homeassistant)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_1e7e4cd6_20250119_111051.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fissues%2F54)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fissues%2F54)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=home-assistant%2Fplugin-dns)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[home-assistant](/home-assistant)
/
**[plugin-dns](/home-assistant/plugin-dns)**
Public

* [Notifications](/login?return_to=%2Fhome-assistant%2Fplugin-dns) You must be signed in to change notification settings
* [Fork
  15](/login?return_to=%2Fhome-assistant%2Fplugin-dns)
* [Star
   21](/login?return_to=%2Fhome-assistant%2Fplugin-dns)

* [Code](/home-assistant/plugin-dns)
* [Issues
  3](/home-assistant/plugin-dns/issues)
* [Pull requests
  0](/home-assistant/plugin-dns/pulls)
* [Actions](/home-assistant/plugin-dns/actions)
* [Security](/home-assistant/plugin-dns/security)
* [Insights](/home-assistant/plugin-dns/pulse)

Additional navigation options

* [Code](/home-assistant/plugin-dns)
* [Issues](/home-assistant/plugin-dns/issues)
* [Pull requests](/home-assistant/plugin-dns/pulls)
* [Actions](/home-assistant/plugin-dns/actions)
* [Security](/home-assistant/plugin-dns/security)
* [Insights](/home-assistant/plugin-dns/pulse)

# .local named devices (i.e. ESPHOME devices) only resolve for a few minutes after booting HA¬†#54

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[.local named devices (i.e. ESPHOME devices) only resolve for a few minutes after booting HA](#top)#54Copy link![@jjvandenberg](https://avatars.githubusercontent.com/u/66120846?v=4&size=80)
## Description

![@jjvandenberg](https://avatars.githubusercontent.com/u/66120846?v=4&size=48)[jjvandenberg](https://github.com/jjvandenberg)opened [on Aug 25, 2021](https://github.com/home-assistant/plugin-dns/issues/54#issue-979542869)

ESPhome devices show up being "Online" only a few minutes after booting the system. After that, they turn to "Offline", although they are still online. mDNS resolving seems to breakdown within a few minutes after rebooting the OS.

Running Home Assistant Operating System, which is, according to the site, the recommended installation method.

## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from community.home-assistant.io_f2a74654_20250119_111044.html ===


![Home Assistant Community](data:image/svg;base64...)
Loading

[Home Assistant Community](/)

# [HA OS DNS Setting - Configuration not respected?](/t/ha-os-dns-setting-configuration-not-respected/356572)

[Configuration](/c/configuration/11)

[le\_top](https://community.home-assistant.io/u/le_top)

November 14, 2021, 3:26pm

1

I am surprised about the network address resolution in HA.

I have an OPNSense firewall that provides its own IP as the DNS server and when examining the DNS configuration using `ha dns info`, I get:

```
[core-ssh ~]$ ha dns info
host: 172.30.32.3
locals:
- dns://10.33.2.254
servers: []
update_available: false
version: 2021.06.0
version_latest: 2021.06.0

```

On my firewall, I override some DNS entries to point to the local network address (10.X.X.X) rather than the public (dynamic) network address.

So I want MYPUBLICDOMAIN to resolve to 10.33.2.X (which depends on the subdomain as well).

When I resolve my network address using `nslookup MYPUBLICDOMAIN`, I get my public address, and when I do `nslookup MYPUBLICDOMAIN 10.33.2.254`, I get 10.33.2.175 back.

A ping to MYPUBLICDOMAIN resolves in a ping to the public network address.

The anwser is more or less found in the dns log, which can be read using `ha dns log`:

```
[ERROR] plugin/errors: 2 . NS: dial tcp 1.1.1.1:853: i/o timeout
[INFO] 127.0.0.1:52905 - 61064 "NS IN . udp 17 false 512" NOERROR - 0 30.000761029s
[ERROR] plugin/errors: 2 . NS: dial tcp 1.0.0.1:853: i/o timeout
[INFO] 172.30.32.2:36022 - 17994 "A IN version.home-assistant.io. udp 43 false 512" NOERROR - 0 4.006484812s

```

So the local dns service is checking addresses on cloudflare - WTH ?! That‚Äôs not what I want - my firewall is acting as a DNS filter as well (it seems that I‚Äôll need to find a way to block those alternative DNS services).

The expected behavior is to use the configuration provided by the DHCP server first. I would also not use a third party service unless getting acceptation from the user. And maybe let him choose between Cloudflare, freenom.world, google, etc.

How to make this work properly?

To point to my local dns service first, I did this:

```
 ha dns option --servers dns://10.33.2.254 --servers dns://80.80.80.80 --servers dns://80.80.81.81

```

But IMHO that‚Äôs not something that should be required!

[Note: I am also adding a rule to my firewall: [HOWTO - Redirect all DNS Requests to Opnsense](https://forum.opnsense.org/index.php?topic=9245.0) - `nslookup MYPUBLICDOMAIN 1.0.0.1` now shows my local address as well]

2 Likes

[Improve Privacy, Stop using hardcoded DNS](https://community.home-assistant.io/t/improve-privacy-stop-using-hardcoded-dns/273496/85)

[Installing Home Assistant OS using Proxmox 8](https://community.home-assistant.io/t/installing-home-assistant-os-using-proxmox-8/201835/561)

[Receive SMS in HA?](https://community.home-assistant.io/t/receive-sms-in-ha/104127/28)

[francisp](https://community.home-assistant.io/u/francisp)
(Francis)

November 14, 2021, 3:54pm

2

There is a long thread about this on this forum. Short result: if you don‚Äôt like this behavior, don‚Äôt use HA OS or HA Supervised, but switch to HA Container or HA Core.

1 Like

[le\_top](https://community.home-assistant.io/u/le_top)

November 14, 2021, 4:00pm

3

Well, were not really informed about it before installing it. AFAIK the general default behavior is to first check the DNS provided by the DHCP service

Anyway, my firewall now fixes it for whatever device tries to bypass the local DNS this way.

[koying](https://community.home-assistant.io/u/koying)
(Chris B)

November 14, 2021, 4:08pm

4

TBH, Supervised installing a half-dozen containers (and now requiring an ‚ÄúOS agent‚Äù) should be a big warning sign that it does more than it should ![:wink:](https://community.home-assistant.io/images/emoji/twitter/wink.png?v=10 ":wink:")

2 Likes

[le\_top](https://community.home-assistant.io/u/le_top)

November 14, 2021, 4:29pm

5

I do not know how many hidden containers it installs, but having separate containers is a good thing to isolate services. So it‚Äôs not an indicator that it does more than it should for me, but give a positive impression instead.

My reported containers are: ‚ÄúTerminal & SSH‚Äù, ‚ÄúCheck Home Assistant configuration‚Äù, ‚ÄúMosquitto broker‚Äù, ‚ÄúFile editor‚Äù, ‚ÄúCustom deps deployment‚Äù, ‚ÄúSQLite web‚Äù, ‚ÄúGrafana‚Äù . So that‚Äôs half a dozen but I am sure that they are not all there.

[koying](https://community.home-assistant.io/u/koying)
(Chris B)

November 14, 2021, 4:48pm

6

My point is: Why does an application like HomeAssistant needs to install a DNS server of it‚Äôs own in your/my LAN in the first place‚Ä¶

[francisp](https://community.home-assistant.io/u/francisp)
(Francis)

November 14, 2021, 4:50pm

7

Look at the one‚Äôs starting with Hassio:

[![image](https://community-assets.home-assistant.io/optimized/3X/8/0/801907ca99db3753b7879fb110724277d8af7c42_2_690x386.png)
image970√ó543 53.4 KB](https://community-assets.home-assistant.io/original/3X/8/0/801907ca99db3753b7879fb110724277d8af7c42.png "image")

[le\_top](https://community.home-assistant.io/u/le_top)

November 15, 2021, 12:34am

8

[@francisp](/u/francisp) How did you get that list? I‚Äôld love to be able to intervene on the containers (I am running two systems: on on a Pi and another one on a Nuc).

[@koying](/u/koying) As far as I understand, the DNS server is an Add-on that can be added by choice - as I did not see any use for it, I did not add it.

The description says: ‚ÄúFor example, you can have your Home Assistant domain resolve with an internal address inside your network.‚Äù.

So yes, that is what I did on my firewall - my publicdomain is resolved to a local IP inside my network.

That addon allows you to add static IPs, etc.

Then of course the DNS server would also require the DHCP server to be installed so that you can tell your clients that they should not use the internet router.

As long as those are choices, that‚Äôs fine by me, sending of DNS queries to a party not ‚Äúdictated‚Äù by my setup is another. I know that some information for usage statistics is sent to Nabu Casa in several ways which is pretty much unavoidable if you configure a system for automatic updates.

Base on the list provided by [@francisp](/u/francisp) , I am in favor of this approach and I do not consider it to be excessive - it‚Äôs almost not enough because there could be one container per integration - that might help avoid restarting my ZHA every time I make a change to the configuration that requires an HA restart which stops my ZHA for a moment, and puts some of the devices to a temporary sleep - I even have a few that do not recover all the time from such an interruption.

[tmjpugh](https://community.home-assistant.io/u/tmjpugh)
(Tmjpugh)

November 15, 2021, 2:31am

9

![](https://community.home-assistant.io/letter_avatar/le_top/48/5_f40856482fe1e45ac8f1605885140a2d.png) le\_top:
> How did you get that list?

Looks like Portainer

[francisp](https://community.home-assistant.io/u/francisp)
(Francis)

November 15, 2021, 4:21am

10

Indeed, Portainer.

[koying](https://community.home-assistant.io/u/koying)
(Chris B)

November 15, 2021, 7:05am

11

![](https://community.home-assistant.io/letter_avatar/le_top/48/5_f40856482fe1e45ac8f1605885140a2d.png) le\_top:
> As far as I understand, the DNS server is an Add-on that can be added by choice - as I did not see any use for it, I did not add it.

Nope. hassio-dns is not optional, and you have it, whether you like it or not, as you noticed, basically.

[k8gg](https://community.home-assistant.io/u/k8gg)

November 15, 2021, 8:18am

12

![](https://community.home-assistant.io/letter_avatar/le_top/48/5_f40856482fe1e45ac8f1605885140a2d.png) le\_top:
> Anyway, my firewall now fixes it for whatever device tries to bypass the local DNS this way.

Sidebar, and I‚Äôm interested: what do the firewall rules look like around this?

I mean, blocking local devices from reaching out to 1.1.1.1 is only half of the fight, right?

Now back to the subject - With the levels of control you are looking for, the install method of HAOS might not be for you. Consider either Core or Container methods.

[le\_top](https://community.home-assistant.io/u/le_top)

November 15, 2021, 3:06pm

13

* Unfortunately, Portainer is discontinued - it would have been nice for monitoring/restarting only.
* `hassio-dns is not optional`- Ok, I can‚Äôt check because I cant install portainer - while the configuration looks more like a ‚Äúresolv.conf‚Äù than a DNS Server, there is a [full DNS server as far as information goes]
* [@k8gg](/u/k8gg) I provided the HOWTO in my initial post - basically you add a rule to the firewall matching all outbound requests to port 53 and route the to the firewall‚Äôs local DNS server. So I did not add a rule to block 1.1.1.1 and 1.0.0.1 specifically, but this reroutes all historical DNS requests (it does not block *all* DNS request types). There is probably a list out there with all ‚Äúpublic‚Äù DNS services so that you could block their IPs.
* Control: I am not looking for *full* control - there‚Äôs stuff I like in HAOS - I do not have to care so much for the host os, etc.

[koying](https://community.home-assistant.io/u/koying)
(Chris B)

November 15, 2021, 5:23pm

14

![](https://community.home-assistant.io/letter_avatar/le_top/48/5_f40856482fe1e45ac8f1605885140a2d.png) le\_top:
> while the configuration looks more like a ‚Äúresolv.conf‚Äù than a DNS Server

I think you are confusing one of the addons and the actual plugin.

`hassio-dns` is a full CoreDNS server, and I don‚Äôt remember any configuration options on the user side (I stopped using Supervised when a root os-agent was requested above all the stuff that was already installed).

![](//community-assets.home-assistant.io/original/3X/b/a/bad3e5f9ad67c1ddf145107ce7032ac1d7b22563.svg)
[GitHub](https://github.com/home-assistant/plugin-dns)

![](https://community-assets.home-assistant.io/optimized/4X/6/6/e/66ee229197e3693b1ec167e3435129080b0dfe24_2_690x388.png)
### [GitHub - home-assistant/plugin-dns: CoreDNS implementation for Home Assistant](https://github.com/home-assistant/plugin-dns)

CoreDNS implementation for Home Assistant. Contribute to home-assistant/plugin-dns development by creating an account on GitHub.

[francisp](https://community.home-assistant.io/u/francisp)
(Francis)

November 15, 2021, 5:28pm

15

![](https://community.home-assistant.io/letter_avatar/le_top/48/5_f40856482fe1e45ac8f1605885140a2d.png) le\_top:
> Unfortunately, Portainer is discontinued

Where did you get that idea ? Portainer has been replaced by Portainer-ce, but they are essentially the same.

[koying](https://community.home-assistant.io/u/koying)
(Chris B)

November 16, 2021, 7:22am

16

The portainer *addon* is discontinued. They *really* don‚Äôt want you to install anything else‚Ä¶

[![image](https://community-assets.home-assistant.io/original/4X/b/f/c/bfcc116f2e66a75d197149196811d28e4bbdcc6b.png)
image876√ó146 5.91 KB](https://community-assets.home-assistant.io/original/4X/b/f/c/bfcc116f2e66a75d197149196811d28e4bbdcc6b.png "image")

[francisp](https://community.home-assistant.io/u/francisp)
(Francis)

November 16, 2021, 7:30am

17

I did not know that. I still have it installed on my HA instances.

[Tamsy](https://community.home-assistant.io/u/Tamsy)
(Tamsy)

November 16, 2021, 7:43am

18

Luckily i installed Portainer as an Add-on ~2 weeks ago. But I noticed with core-2021.11.3 the icon has suddenly changed.

Well, it was used a lot for unsupported **porposes** ‚Ä¶ ![:rofl:](https://community.home-assistant.io/images/emoji/twitter/rofl.png?v=10 ":rofl:")

The noose tightens for HA supervised users.

[koying](https://community.home-assistant.io/u/koying)
(Chris B)

November 16, 2021, 9:41am

19

I‚Äôve been a bit harsh with the DNS plugin: it basically mimic what docker is doing in bridge mode to resolve docker containers, specifically addons here, in host mode.

I‚Äôve done some tests in a VM, and DNS resolution works fine: it *does* go to my internal DNS without tweakings.

Cloudlare is only a fallback if the default DNS cannot be reached.

OP, you didn‚Äôt tell what kind of installation you have: HassOS on device? HassOS in VM? Supervised?

[baz123](https://community.home-assistant.io/u/baz123)
(Brian)

November 16, 2021, 9:52am

20

It was a toys out of the pram moment I think ![:cry:](https://community.home-assistant.io/images/emoji/twitter/cry.png?v=10 ":cry:")

Note the message ‚Äúused for unsupported purposes‚Äù‚Ä¶

**[next page ‚Üí](/t/ha-os-dns-setting-configuration-not-respected/356572?page=2)**

* [Home](/)
* [Categories](/categories)
* [FAQ/Guidelines](/guidelines)
* [Terms of Service](https://www.home-assistant.io/tos/)
* [Privacy Policy](https://www.home-assistant.io/privacy/)

Powered by [Discourse](https://www.discourse.org), best viewed with JavaScript enabled



=== Content from github.com_bed21130_20250119_111046.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fissues%2F20)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhome-assistant%2Fplugin-dns%2Fissues%2F20)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=home-assistant%2Fplugin-dns)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[home-assistant](/home-assistant)
/
**[plugin-dns](/home-assistant/plugin-dns)**
Public

* [Notifications](/login?return_to=%2Fhome-assistant%2Fplugin-dns) You must be signed in to change notification settings
* [Fork
  15](/login?return_to=%2Fhome-assistant%2Fplugin-dns)
* [Star
   21](/login?return_to=%2Fhome-assistant%2Fplugin-dns)

* [Code](/home-assistant/plugin-dns)
* [Issues
  3](/home-assistant/plugin-dns/issues)
* [Pull requests
  0](/home-assistant/plugin-dns/pulls)
* [Actions](/home-assistant/plugin-dns/actions)
* [Security](/home-assistant/plugin-dns/security)
* [Insights](/home-assistant/plugin-dns/pulse)

Additional navigation options

* [Code](/home-assistant/plugin-dns)
* [Issues](/home-assistant/plugin-dns/issues)
* [Pull requests](/home-assistant/plugin-dns/pulls)
* [Actions](/home-assistant/plugin-dns/actions)
* [Security](/home-assistant/plugin-dns/security)
* [Insights](/home-assistant/plugin-dns/pulse)

# Not resolving local host names¬†#20

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[Not resolving local host names](#top)#20Copy link![@ssummer](https://avatars.githubusercontent.com/u/4182874?v=4&size=80)
## Description

![@ssummer](https://avatars.githubusercontent.com/u/4182874?v=4&size=48)[ssummer](https://github.com/ssummer)opened [on Dec 26, 2020](https://github.com/home-assistant/plugin-dns/issues/20#issue-774861780)

In home assistant, if I use hostnames in configuration.yaml they fail to resolve (eg using platform snmp ). Using the corresponding IP addresses works, but is far from ideal and means I have to use fixed IP addresses and configuration becomes less unreadable and requires more maintenance.

Trying to work out what is the root issue is, has led me to hassio-dns seemingly not working as I would expect. The homeassistant docker container appears to be using 172.30.32.3 for dns which is the hassio-dns container. From within the homeassistant container this local hostname fails to resolve:

dig pdu3.netality.co.uk

and I can see from the dig output it is going out to the Internet to do the DNS lookup.

But

dig pdu3.netality.co.uk @192.168.66.1

from home assistant does work (not surprisingly).

The strange thing is from within the hassio-dns container, fully qualified and unqualified local hostname lookups do work:

dig pdu3.netality.co.uk

dig pdu3

But

dig pdu3.netality.co.uk @172.30.32.3

does not work (unsurprisingly).

What I would expect is that fully qualified and unqualified hostnames should resolve as I have set the search domain to netality.co.uk and dns server to 192.168.66.1 in HassOS.

I don't think this has ever worked with hassio-dns.

Versions:

armhf-hassio-dns:2020.11.0

raspberrypi2-homeassistant:2020.12.1

armhf-hassio-supervisor:latest (2020.12.7)

HassOS: 5.9

üëç3
## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.


