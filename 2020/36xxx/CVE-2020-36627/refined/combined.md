=== Content from github.com_4d1dacfe_20250119_120956.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgo-macaron%2Fi18n%2Fcommit%2F329b0c4844cc16a5a253c011b55180598e707735)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgo-macaron%2Fi18n%2Fcommit%2F329b0c4844cc16a5a253c011b55180598e707735)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=go-macaron%2Fi18n)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[go-macaron](/go-macaron)
/
**[i18n](/go-macaron/i18n)**
Public

* [Notifications](/login?return_to=%2Fgo-macaron%2Fi18n) You must be signed in to change notification settings
* [Fork
  10](/login?return_to=%2Fgo-macaron%2Fi18n)
* [Star
   12](/login?return_to=%2Fgo-macaron%2Fi18n)

* [Code](/go-macaron/i18n)
* [Issues
  0](/go-macaron/i18n/issues)
* [Pull requests
  0](/go-macaron/i18n/pulls)
* [Actions](/go-macaron/i18n/actions)
* [Security](/go-macaron/i18n/security)
* [Insights](/go-macaron/i18n/pulse)

Additional navigation options

* [Code](/go-macaron/i18n)
* [Issues](/go-macaron/i18n/issues)
* [Pull requests](/go-macaron/i18n/pulls)
* [Actions](/go-macaron/i18n/actions)
* [Security](/go-macaron/i18n/security)
* [Insights](/go-macaron/i18n/pulse)

## Commit

[Permalink](/go-macaron/i18n/commit/329b0c4844cc16a5a253c011b55180598e707735)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

security: fix Open Redirection vulnerability

[Browse files](/go-macaron/i18n/tree/329b0c4844cc16a5a253c011b55180598e707735)
Browse the repository at this point in the history

* Loading branch information

[![@unknwon](https://avatars.githubusercontent.com/u/2946214?s=40&v=4)](/unknwon)

[unknwon](/go-macaron/i18n/commits?author=unknwon "View all commits by unknwon")
committed
Feb 16, 2020

1 parent
[326bc77](/go-macaron/i18n/commit/326bc77d7eb1d9a2362a904ef97ab922c9c68082)

commit 329b0c4

 Show file tree

 Hide file tree

Showing
**5 changed files**
with
**141 additions**
and
**102 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* .gitignore
  [.gitignore](#diff-bc37d034bad564583790a46f19d807abfe519c5671395fd494d8cce506c42947)
* go.mod
  [go.mod](#diff-33ef32bf6c23acb95f5902d7097b7a1d5128ca061167ec0716715b0b9eeaa5f6)
* go.sum
  [go.sum](#diff-3295df7234525439d778f1b282d146a4f1ff6b415248aaac074e8042d9f42d63)
* i18n.go
  [i18n.go](#diff-2c06dd03e73e3259f1acd4f6818c100907e3928a6701b16a732005491c929faf)
* i18n\_test.go
  [i18n\_test.go](#diff-1dc1bd125f4b2e4541cbd10be8932945da477862c5124c4f0abe362c6b92ef45)

## There are no files selected for viewing

1 change: 1 addition & 0 deletions

1
[.gitignore](#diff-bc37d034bad564583790a46f19d807abfe519c5671395fd494d8cce506c42947 ".gitignore")

Show comments

[View file](/go-macaron/i18n/blob/329b0c4844cc16a5a253c011b55180598e707735/.gitignore)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1 @@ |
|  |  | /.idea |

3 changes: 1 addition & 2 deletions

3
[go.mod](#diff-33ef32bf6c23acb95f5902d7097b7a1d5128ca061167ec0716715b0b9eeaa5f6 "go.mod")

Show comments

[View file](/go-macaron/i18n/blob/329b0c4844cc16a5a253c011b55180598e707735/go.mod)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -3,8 +3,7 @@ module github.com/go-macaron/i18n |
|  |  | go 1.12 |
|  |  |  |
|  |  | require ( |
|  |  | github.com/smartystreets/goconvey v0.0.0-20190731233626-505e41936337 |
|  |  | github.com/unknwon/com v0.0.0-20190804042917-757f69c95f3e |
|  |  | github.com/stretchr/testify v1.4.0 |
|  |  | github.com/unknwon/i18n v0.0.0-20190805065654-5c6446a380b6 |
|  |  | golang.org/x/text v0.3.2 |
|  |  | gopkg.in/macaron.v1 v1.3.4 |
| Expand Down | |  |

13 changes: 11 additions & 2 deletions

13
[go.sum](#diff-3295df7234525439d778f1b282d146a4f1ff6b415248aaac074e8042d9f42d63 "go.sum")

Show comments

[View file](/go-macaron/i18n/blob/329b0c4844cc16a5a253c011b55180598e707735/go.sum)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,21 +1,26 @@ |
|  |  | github.com/davecgh/go-spew v1.1.0 h1:ZDRjVQ15GmhC3fiQ8ni8+OwkZQO4DARzQgrnXU1Liz8= |
|  |  | github.com/davecgh/go-spew v1.1.0/go.mod h1:J7Y8YcW2NihsgmVo/mv3lAwl/skON4iLHjSsI+c5H38= |
|  |  | github.com/go-macaron/inject v0.0.0-20160627170012-d8a0b8677191 h1:NjHlg70DuOkcAMqgt0+XA+NHwtu66MkTVVgR4fFWbcI= |
|  |  | github.com/go-macaron/inject v0.0.0-20160627170012-d8a0b8677191/go.mod h1:VFI2o2q9kYsC4o7VP1HrEVosiZZTd+MVT3YZx4gqvJw= |
|  |  | github.com/gopherjs/gopherjs v0.0.0-20181017120253-0766667cb4d1/go.mod h1:wJfORRmW1u3UXTncJ5qlYoELFm8eSnnEO6hX4iZ3EWY= |
|  |  | github.com/gopherjs/gopherjs v0.0.0-20181103185306-d547d1d9531e h1:JKmoR8x90Iww1ks85zJ1lfDGgIiMDuIptTOhJq+zKyg= |
|  |  | github.com/gopherjs/gopherjs v0.0.0-20181103185306-d547d1d9531e/go.mod h1:wJfORRmW1u3UXTncJ5qlYoELFm8eSnnEO6hX4iZ3EWY= |
|  |  | github.com/gopherjs/gopherjs v0.0.0-20190430165422-3e4dfb77656c h1:7lF+Vz0LqiRidnzC1Oq86fpX1q/iEv2KJdrCtttYjT4= |
|  |  | github.com/gopherjs/gopherjs v0.0.0-20190430165422-3e4dfb77656c/go.mod h1:wJfORRmW1u3UXTncJ5qlYoELFm8eSnnEO6hX4iZ3EWY= |
|  |  | github.com/jtolds/gls v4.2.1+incompatible/go.mod h1:QJZ7F/aHp+rZTRtaJ1ow/lLfFfVYBRgL+9YlvaHOwJU= |
|  |  | github.com/jtolds/gls v4.20.0+incompatible h1:xdiiI2gbIgH/gLH7ADydsJ1uDOEzR8yvV7C0MuV77Wo= |
|  |  | github.com/jtolds/gls v4.20.0+incompatible/go.mod h1:QJZ7F/aHp+rZTRtaJ1ow/lLfFfVYBRgL+9YlvaHOwJU= |
|  |  | github.com/pmezard/go-difflib v1.0.0 h1:4DBwDE0NGyQoBHbLQYPwSUPoCMWR5BEzIk/f1lZbAQM= |
|  |  | github.com/pmezard/go-difflib v1.0.0/go.mod h1:iKH77koFhYxTK1pcRnkKkqfTogsbg7gZNVY4sRDYZ/4= |
|  |  | github.com/smartystreets/assertions v0.0.0-20180927180507-b2de0cb4f26d/go.mod h1:OnSkiWE9lh6wB0YB77sQom3nweQdgAjqCqsofrRNTgc= |
|  |  | github.com/smartystreets/assertions v0.0.0-20190116191733-b6c0e53d7304 h1:Jpy1PXuP99tXNrhbq2BaPz9B+jNAvH1JPQQpG/9GCXY= |
|  |  | github.com/smartystreets/assertions v0.0.0-20190116191733-b6c0e53d7304/go.mod h1:OnSkiWE9lh6wB0YB77sQom3nweQdgAjqCqsofrRNTgc= |
|  |  | github.com/smartystreets/assertions v1.0.1 h1:voD4ITNjPL5jjBfgR/r8fPIIBrliWrWHeiJApdr3r4w= |
|  |  | github.com/smartystreets/assertions v1.0.1/go.mod h1:kHHU4qYBaI3q23Pp3VPrmWhuIUrLW/7eUrw0BU5VaoM= |
|  |  | github.com/smartystreets/goconvey v0.0.0-20181108003508-044398e4856c/go.mod h1:XDJAKZRPZ1CvBcN2aX5YOUTYGHki24fSF0Iv48Ibg0s= |
|  |  | github.com/smartystreets/goconvey v0.0.0-20190731233626-505e41936337 h1:WN9BUFbdyOsSH/XohnWpXOlq9NBD5sGAB2FciQMUEe8= |
|  |  | github.com/smartystreets/goconvey v0.0.0-20190731233626-505e41936337/go.mod h1:syvi0/a8iFYH4r/RixwvyeAJjdLS9QV7WQ/tjFTllLA= |
|  |  | github.com/stretchr/objx v0.1.0/go.mod h1:HFkY916IF+rwdDfMAkV7OtwuqBVzrE8GR6GFx+wExME= |
|  |  | github.com/stretchr/testify v1.4.0 h1:2E4SXV/wtOkTonXsotYi4li6zVWxYlZuYNCXe9XRJyk= |
|  |  | github.com/stretchr/testify v1.4.0/go.mod h1:j7eGeouHqKxXV5pUuKE4zz7dFj8WfuZ+81PSLYec5m4= |
|  |  | github.com/unknwon/com v0.0.0-20190804042917-757f69c95f3e h1:GSGeB9EAKY2spCABz6xOX5DbxZEXolK+nBSvmsQwRjM= |
|  |  | github.com/unknwon/com v0.0.0-20190804042917-757f69c95f3e/go.mod h1:tOOxU81rwgoCLoOVVPHb6T/wt8HZygqH5id+GNnlCXM= |
|  |  | github.com/unknwon/i18n v0.0.0-20190805065654-5c6446a380b6 h1:sRrkJEHtNoaSvyXMbRgofEOX4/3gMiraevQKJdIBhYE= |
| Expand All | | @@ -37,7 +42,11 @@ golang.org/x/text v0.3.2/go.mod h1:bEr9sfX3Q8Zfm5fL9x+3itogRgK3+ptLWKqgva+5dAk= |
|  |  | golang.org/x/tools v0.0.0-20180917221912-90fa682c2a6e/go.mod h1:n7NCudcB/nEzxVGmLbDWY5pfWTLqBcC2KZ6jyYvM4mQ= |
|  |  | golang.org/x/tools v0.0.0-20190328211700-ab21143f2384/go.mod h1:LCzVGOaR6xXOjkQ3onu1FJEFr0SW1gC7cKk1uF8kGRs= |
|  |  | golang.org/x/tools v0.0.0-20190802220118-1d1727260058/go.mod h1:jcCCGcm9btYwXyDqrUWc6MKQKKGJCWEQ3AfLSRIbEuI= |
|  |  | gopkg.in/check.v1 v0.0.0-20161208181325-20d25e280405 h1:yhCVgyC4o1eVCa2tZl7eS0r+SDo693bJlVdllGtEeKM= |
|  |  | gopkg.in/check.v1 v0.0.0-20161208181325-20d25e280405/go.mod h1:Co6ibVJAznAaIkqp8huTwlJQCZ016jof/cbN4VW5Yz0= |
|  |  | gopkg.in/ini.v1 v1.46.0 h1:VeDZbLYGaupuvIrsYCEOe/L/2Pcs5n7hdO1ZTjporag= |
|  |  | gopkg.in/ini.v1 v1.46.0/go.mod h1:pNLf8WUiyNEtQjuu5G5vTm06TEv9tsIgeAvK8hOrP4k= |
|  |  | gopkg.in/macaron.v1 v1.3.4 h1:HvIscOwxhFhx3swWM/979wh2QMYyuXrNmrF9l+j3HZs= |
|  |  | gopkg.in/macaron.v1 v1.3.4/go.mod h1:/RoHTdC8ALpyJ3+QR36mKjwnT1F1dyYtsGM9Ate6ZFI= |
|  |  | gopkg.in/yaml.v2 v2.2.2 h1:ZCJp+EgiOT7lHqUV2J862kp8Qj64Jo6az82+3Td9dZw= |
|  |  | gopkg.in/yaml.v2 v2.2.2/go.mod h1:hI93XBmqTisBFMUTm0b8Fm+jr3Dg1NNxqwp+5A1VGuI= |

18 changes: 11 additions & 7 deletions

18
[i18n.go](#diff-2c06dd03e73e3259f1acd4f6818c100907e3928a6701b16a732005491c929faf "i18n.go")

Show comments

[View file](/go-macaron/i18n/blob/329b0c4844cc16a5a253c011b55180598e707735/i18n.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -17,19 +17,23 @@ package i18n |
|  |  |  |
|  |  | import ( |
|  |  | "fmt" |
|  |  | "os" |
|  |  | "path" |
|  |  | "strings" |
|  |  |  |
|  |  | "github.com/unknwon/com" |
|  |  | "github.com/unknwon/i18n" |
|  |  | "golang.org/x/text/language" |
|  |  | "gopkg.in/macaron.v1" |
|  |  | ) |
|  |  |  |
|  |  | const \_VERSION = "0.4.1" |
|  |  |  |
|  |  | func Version() string { |
|  |  | return \_VERSION |
|  |  | // isFile returns true if given path is a file, |
|  |  | // or returns false when it's a directory or does not exist. |
|  |  | func isFile(filePath string) bool { |
|  |  | f, e := os.Stat(filePath) |
|  |  | if e != nil { |
|  |  | return false |
|  |  | } |
|  |  | return !f.IsDir() |
|  |  | } |
|  |  |  |
|  |  | // initLocales initializes language type list and Accept-Language header matcher. |
| Expand All | | @@ -41,7 +45,7 @@ func initLocales(opt Options) language.Matcher { |
|  |  | // Append custom locale file. |
|  |  | custom := []interface{}{} |
|  |  | customPath := path.Join(opt.CustomDirectory, fname) |
|  |  | if com.IsFile(customPath) { |
|  |  | if isFile(customPath) { |
|  |  | custom = append(custom, customPath) |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -221,7 +225,7 @@ func I18n(options ...Options) macaron.Handler { |
|  |  | ctx.Data["RestLangs"] = restLangs |
|  |  |  |
|  |  | if opt.Redirect && isNeedRedir { |
|  |  | ctx.Redirect(opt.SubURL + ctx.Req.RequestURI[:strings.Index(ctx.Req.RequestURI, "?")]) |
|  |  | ctx.Redirect(opt.SubURL + path.Clean(ctx.Req.RequestURI[:strings.Index(ctx.Req.RequestURI, "?")])) |
|  |  | } |
|  |  | } |
|  |  | } |

208 changes: 117 additions & 91 deletions

208
[i18n\_test.go](#diff-1dc1bd125f4b2e4541cbd10be8932945da477862c5124c4f0abe362c6b92ef45 "i18n_test.go")

Show comments

[View file](/go-macaron/i18n/blob/329b0c4844cc16a5a253c011b55180598e707735/i18n_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -15,118 +15,144 @@ |
|  |  | package i18n |
|  |  |  |
|  |  | import ( |
|  |  | "errors" |
|  |  | "net/http" |
|  |  | "net/http/httptest" |
|  |  | "testing" |
|  |  |  |
|  |  | . "github.com/smartystreets/goconvey/convey" |
|  |  | "github.com/stretchr/testify/assert" |
|  |  | "gopkg.in/macaron.v1" |
|  |  | ) |
|  |  |  |
|  |  | func Test\_Version(t \*testing.T) { |
|  |  | Convey("Check package version", t, func() { |
|  |  | So(Version(), ShouldEqual, \_VERSION) |
|  |  | }) |
|  |  | } |
|  |  |  |
|  |  | func Test\_I18n(t \*testing.T) { |
|  |  | Convey("Use i18n middleware", t, func() { |
|  |  | Convey("No langauge", func() { |
|  |  | defer func() { |
|  |  | So(recover(), ShouldNotBeNil) |
|  |  | }() |
|  |  | func TestI18n(t \*testing.T) { |
|  |  | t.Run("no language", func(t \*testing.T) { |
|  |  | defer func() { |
|  |  | assert.Equal(t, "no language is specified", recover()) |
|  |  | }() |
|  |  |  |
|  |  | m := macaron.New() |
|  |  | m.Use(I18n(Options{})) |
|  |  | }) |
|  |  | m := macaron.New() |
|  |  | m.Use(I18n(Options{})) |
|  |  | }) |
|  |  |  |
|  |  | Convey("Languages and names not match", func() { |
|  |  | defer func() { |
|  |  | So(recover(), ShouldNotBeNil) |
|  |  | }() |
|  |  | t.Run("languages and names not match", func(t \*testing.T) { |
|  |  | defer func() { |
|  |  | assert.Equal(t, "length of langs is not same as length of names", recover()) |
|  |  | }() |
|  |  |  |
|  |  | m := macaron.New() |
|  |  | m.Use(I18n(Options{ |
|  |  | Langs: []string{"en-US"}, |
|  |  | })) |
|  |  | }) |
|  |  | m := macaron.New() |
|  |  | m.Use(I18n(Options{ |
|  |  | Langs: []string{"en-US"}, |
|  |  | })) |
|  |  | }) |
|  |  |  |
|  |  | Convey("Invalid directory", func() { |
|  |  | defer func() { |
|  |  | So(recover(), ShouldNotBeNil) |
|  |  | }() |
|  |  |  |
|  |  | m := macaron.New() |
|  |  | m.Use(I18n(Options{ |
|  |  | Directory: "404", |
|  |  | Langs: []string{"en-US"}, |
|  |  | Names: []string{"English"}, |
|  |  | })) |
|  |  | }) |
|  |  | t.Run("invalid directory", func(t \*testing.T) { |
|  |  | defer func() { |
|  |  | assert.Equal(t, errors.New("fail to set message file(en-US): open 404/locale\_en-US.ini: no such file or directory"), recover()) |
|  |  | }() |
|  |  |  |
|  |  | m := macaron.New() |
|  |  | m.Use(I18n(Options{ |
|  |  | Directory: "404", |
|  |  | Langs: []string{"en-US"}, |
|  |  | Names: []string{"English"}, |
|  |  | })) |
|  |  | }) |
|  |  |  |
|  |  | Convey("With correct options", func() { |
|  |  | m := macaron.New() |
|  |  | m.Use(I18n(Options{ |
|  |  | Files: map[string][]byte{"locale\_en-US.ini": []byte("")}, |
|  |  | Langs: []string{"en-US"}, |
|  |  | Names: []string{"English"}, |
|  |  | })) |
|  |  | m.Get("/", func() {}) |
|  |  | t.Run("with correct options", func(t \*testing.T) { |
|  |  | m := macaron.New() |
|  |  | m.Use(I18n(Options{ |
|  |  | Files: map[string][]byte{"locale\_en-US.ini": []byte("")}, |
|  |  | Langs: []string{"en-US"}, |
|  |  | Names: []string{"English"}, |
|  |  | })) |
|  |  | m.Get("/", func() {}) |
|  |  |  |
|  |  | resp := httptest.NewRecorder() |
|  |  | req, err := http.NewRequest("GET", "/", nil) |
|  |  | if err != nil { |
|  |  | t.Fatal(err) |
|  |  | } |
|  |  | m.ServeHTTP(resp, req) |
|  |  | }) |
|  |  |  |
|  |  | resp := httptest.NewRecorder() |
|  |  | req, err := http.NewRequest("GET", "/", nil) |
|  |  | So(err, ShouldBeNil) |
|  |  | m.ServeHTTP(resp, req) |
|  |  | t.Run("set by Accept-Language", func(t \*testing.T) { |
|  |  | m := macaron.New() |
|  |  | m.Use(I18n(Options{ |
|  |  | Langs: []string{"en-US", "zh-CN", "it-IT"}, |
|  |  | Names: []string{"English", "简体中文", "Italiano"}, |
|  |  | })) |
|  |  | m.Get("/", func(l Locale) { |
|  |  | assert.Equal(t, "it-IT", l.Language()) |
|  |  | }) |
|  |  |  |
|  |  | Convey("Set by redirect of URL parameter", func() { |
|  |  | m := macaron.New() |
|  |  | m.Use(I18n(Options{ |
|  |  | Langs: []string{"en-US"}, |
|  |  | Names: []string{"English"}, |
|  |  | Redirect: true, |
|  |  | })) |
|  |  | m.Get("/", func() {}) |
|  |  | resp := httptest.NewRecorder() |
|  |  | req, err := http.NewRequest("GET", "/", nil) |
|  |  | if err != nil { |
|  |  | t.Fatal(err) |
|  |  | } |
|  |  | req.Header.Set("Accept-Language", "it") |
|  |  | m.ServeHTTP(resp, req) |
|  |  | }) |
|  |  |  |
|  |  | resp := httptest.NewRecorder() |
|  |  | req, err := http.NewRequest("GET", "/?lang=en-US", nil) |
|  |  | So(err, ShouldBeNil) |
|  |  | req.RequestURI = "/?lang=en-US" |
|  |  | m.ServeHTTP(resp, req) |
|  |  | t.Run("set to default language", func(t \*testing.T) { |
|  |  | m := macaron.New() |
|  |  | m.Use(I18n(Options{ |
|  |  | Langs: []string{"en-US", "zh-CN", "it-IT"}, |
|  |  | Names: []string{"English", "简体中文", "Italiano"}, |
|  |  | })) |
|  |  | m.Get("/", func(l Locale) { |
|  |  | assert.Equal(t, "en-US", l.Language()) |
|  |  | }) |
|  |  |  |
|  |  | Convey("Set by Accept-Language", func() { |
|  |  | m := macaron.New() |
|  |  | m.Use(I18n(Options{ |
|  |  | Langs: []string{"en-US", "zh-CN", "it-IT"}, |
|  |  | Names: []string{"English", "简体中文", "Italiano"}, |
|  |  | })) |
|  |  | m.Get("/", func(l Locale) { |
|  |  | So(l.Language(), ShouldEqual, "it-IT") |
|  |  | }) |
|  |  | resp := httptest.NewRecorder() |
|  |  | req, err := http.NewRequest("GET", "/", nil) |
|  |  | if err != nil { |
|  |  | t.Fatal(err) |
|  |  | } |
|  |  | req.Header.Set("Accept-Language", "ru") |
|  |  | m.ServeHTTP(resp, req) |
|  |  | }) |
|  |  | } |
|  |  |  |
|  |  | func TestRedirect(t \*testing.T) { |
|  |  | m := macaron.New() |
|  |  | m.Use(I18n(Options{ |
|  |  | Langs: []string{"en-US"}, |
|  |  | Names: []string{"English"}, |
|  |  | Redirect: true, |
|  |  | })) |
|  |  | m.Get("/", func() {}) |
|  |  |  |
|  |  | tests := []struct { |
|  |  | url string |
|  |  | expURL string |
|  |  | }{ |
|  |  | { |
|  |  | url: "/?lang=en-US", |
|  |  | expURL: "/", |
|  |  | }, { |
|  |  | url: "//example.com?lang=en-US", |
|  |  | expURL: "/example.com", |
|  |  | }, { |
|  |  | url: "/abc/../../../example.com?lang=en-US", |
|  |  | expURL: "/example.com", |
|  |  | }, { |
|  |  | url: "/../abc/../example.com?lang=en-US", |
|  |  | expURL: "/example.com", |
|  |  | }, |
|  |  | } |
|  |  | for \_, test := range tests { |
|  |  | t.Run("", func(t \*testing.T) { |
|  |  | resp := httptest.NewRecorder() |
|  |  | req, err := http.NewRequest("GET", "/", nil) |
|  |  | So(err, ShouldBeNil) |
|  |  | req.Header.Set("Accept-Language", "it") |
|  |  | req, err := http.NewRequest("GET", test.url, nil) |
|  |  | if err != nil { |
|  |  | t.Fatal(err) |
|  |  | } |
|  |  | req.RequestURI = test.url |
|  |  | m.ServeHTTP(resp, req) |
|  |  | }) |
|  |  |  |
|  |  | Convey("Set to default language", func() { |
|  |  | m := macaron.New() |
|  |  | m.Use(I18n(Options{ |
|  |  | Langs: []string{"en-US", "zh-CN", "it-IT"}, |
|  |  | Names: []string{"English", "简体中文", "Italiano"}, |
|  |  | })) |
|  |  | m.Get("/", func(l Locale) { |
|  |  | So(l.Language(), ShouldEqual, "en-US") |
|  |  | }) |
|  |  |  |
|  |  | resp := httptest.NewRecorder() |
|  |  | req, err := http.NewRequest("GET", "/", nil) |
|  |  | So(err, ShouldBeNil) |
|  |  | req.Header.Set("Accept-Language", "ru") |
|  |  | m.ServeHTTP(resp, req) |
|  |  | assert.Equal(t, http.StatusFound, resp.Code) |
|  |  | assert.Equal(t, "<a href=\""+test.expURL+"\">Found</a>.\n\n", resp.Body.String()) |
|  |  | }) |
|  |  | }) |
|  |  | } |
|  |  | } |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `329b0c4`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgo-macaron%2Fi18n%2Fcommit%2F329b0c4844cc16a5a253c011b55180598e707735) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_ddb903ab_20250119_120957.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgo-macaron%2Fi18n%2Freleases%2Ftag%2Fv0.5.0)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgo-macaron%2Fi18n%2Freleases%2Ftag%2Fv0.5.0)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=go-macaron%2Fi18n)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[go-macaron](/go-macaron)
/
**[i18n](/go-macaron/i18n)**
Public

* [Notifications](/login?return_to=%2Fgo-macaron%2Fi18n) You must be signed in to change notification settings
* [Fork
  10](/login?return_to=%2Fgo-macaron%2Fi18n)
* [Star
   12](/login?return_to=%2Fgo-macaron%2Fi18n)

* [Code](/go-macaron/i18n/tree/v0.5.0)
* [Issues
  0](/go-macaron/i18n/issues)
* [Pull requests
  0](/go-macaron/i18n/pulls)
* [Actions](/go-macaron/i18n/actions)
* [Security](/go-macaron/i18n/security)
* [Insights](/go-macaron/i18n/pulse)

Additional navigation options

* [Code](/go-macaron/i18n/tree/v0.5.0)
* [Issues](/go-macaron/i18n/issues)
* [Pull requests](/go-macaron/i18n/pulls)
* [Actions](/go-macaron/i18n/actions)
* [Security](/go-macaron/i18n/security)
* [Insights](/go-macaron/i18n/pulse)

[Releases](/go-macaron/i18n/releases)
[Tags](/go-macaron/i18n/tags)

# v0.5.0

* [v0.5.0](/go-macaron/i18n/tree/v0.5.0)
* [`d63b93d`](/go-macaron/i18n/commit/d63b93da5902d9af0488c78dfad18f4ecca7ca3a)
* Unverified

  # Unverified

  This user has not yet uploaded their public signing key.

  GPG key ID: B43718D76E30A238

  [Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits)
* Compare

  Choose a tag to compare

  Could not load tags

  Nothing to show

  [{{ refName }}
  default](/go-macaron/i18n/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v0.5.0)

   Loading

  [View all tags](/go-macaron/i18n/tags)

[v0.5.0](/go-macaron/i18n/releases/tag/v0.5.0)

* [v0.5.0](/go-macaron/i18n/tree/v0.5.0)
* [`d63b93d`](/go-macaron/i18n/commit/d63b93da5902d9af0488c78dfad18f4ecca7ca3a)
* Compare

  Choose a tag to compare

  Could not load tags

  Nothing to show

  [{{ refName }}
  default](/go-macaron/i18n/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v0.5.0)

   Loading

  [View all tags](/go-macaron/i18n/tags)
* Unverified

  # Unverified

  This user has not yet uploaded their public signing key.

  GPG key ID: B43718D76E30A238

  [Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits)

![@unknwon](https://avatars.githubusercontent.com/u/2946214?s=40&v=4)
[unknwon](/unknwon)
tagged this
16 Feb 16:52

```
ci: upload coverage to Codecov
```

 Assets
2

 Loading

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


